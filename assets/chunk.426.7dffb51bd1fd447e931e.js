/*! For license information please see chunk.426.7dffb51bd1fd447e931e.js.LICENSE.txt */
(globalThis.webpackChunk_ember_auto_import_=globalThis.webpackChunk_ember_auto_import_||[]).push([[426],{89(e,t,n){"use strict"
n.r(t),n.d(t,{DataLoci:()=>_,EmptyLoci:()=>y,EveryLoci:()=>m,Loci:()=>C,areDataLociEqual:()=>x,isDataLoci:()=>b,isDataLociEmpty:()=>S,isEmptyLoci:()=>v,isEveryLoci:()=>g})
var r=n(48393),i=n(28626),o=n(79111),a=n(14294),s=n(32775),l=n(44688),c=n(92384),u=n(9043),d=n(10314),p=n(12288),h=n(60939),f=n(67538)
const m={kind:"every-loci"}
function g(e){return!!e&&"every-loci"===e.kind}const y={kind:"empty-loci"}
function v(e){return!!e&&"empty-loci"===e.kind}function b(e){return!!e&&"data-loci"===e.kind}function x(e,t){if(!(0,u.bN)(e.data,t.data)||e.tag!==t.tag)return!1
if(e.elements.length!==t.elements.length)return!1
for(let n=0,r=e.elements.length;n<r;++n)if(!(0,u.bN)(e.elements[n],t.elements[n]))return!1
return!0}function S(e){return 0===e.elements.length}function _(e,t,n,r,i){return{kind:"data-loci",tag:e,data:t,elements:n,getBoundingSphere:r,getLabel:i}}var C
!function(e){const t=new d.Z("98")
function n(e,t){var n
if("every-loci"!==e.kind&&"empty-loci"!==e.kind)return t||(t=(0,a.f8)()),"structure-loci"===e.kind?a.f8.copy(t,e.structure.boundary.sphere):"element-loci"===e.kind?a.f8.copy(t,r.StructureElement.Loci.getBoundary(e).sphere):"bond-loci"===e.kind?i.gn.getBoundingSphere(e,t):"shape-loci"===e.kind?a.f8.copy(t,e.shape.geometry.boundingSphere):"group-loci"===e.kind?o.$.getBoundingSphere(e,t):"data-loci"===e.kind?null===(n=e.getBoundingSphere)||void 0===n?void 0:n.call(e,t):"volume-loci"===e.kind?h.f.getBoundingSphere(e.volume,t):"isosurface-loci"===e.kind?h.f.Isosurface.getBoundingSphere(e.volume,e.isoValue,t):"cell-loci"===e.kind?h.f.Cell.getBoundingSphere(e.volume,e.elements,t):"segment-loci"===e.kind?h.f.Segment.getBoundingSphere(e.volume,e.elements,t):void 0}e.getBundleBoundingSphere=function(e){const r=e.loci.map(e=>n(e)).filter(e=>!!e)
t.reset()
for(const n of r)t.includePositionRadius(n.center,n.radius)
t.finishedIncludeStep()
for(const n of r)t.radiusPositionRadius(n.center,n.radius)
return t.getSphere()},e.areEqual=function(e,t){return!(!g(e)||!g(t))||!(!v(e)||!v(t))||(b(e)&&b(t)?x(e,t):l.oE.isLoci(e)&&l.oE.isLoci(t)?l.oE.areLociEqual(e,t):r.StructureElement.Loci.is(e)&&r.StructureElement.Loci.is(t)?r.StructureElement.Loci.areEqual(e,t):i.gn.isLoci(e)&&i.gn.isLoci(t)?i.gn.areLociEqual(e,t):o.y.isLoci(e)&&o.y.isLoci(t)?o.y.areLociEqual(e,t):o.$.isLoci(e)&&o.$.isLoci(t)?o.$.areLociEqual(e,t):h.f.isLoci(e)&&h.f.isLoci(t)?h.f.areLociEqual(e,t):h.f.Isosurface.isLoci(e)&&h.f.Isosurface.isLoci(t)?h.f.Isosurface.areLociEqual(e,t):h.f.Cell.isLoci(e)&&h.f.Cell.isLoci(t)?h.f.Cell.areLociEqual(e,t):!(!h.f.Segment.isLoci(e)||!h.f.Segment.isLoci(t))&&h.f.Segment.areLociEqual(e,t))},e.isEvery=function(e){return!!e&&"every-loci"===e.kind},e.isEmpty=function(e){return!g(e)&&(!!v(e)||(b(e)?S(e):l.oE.isLoci(e)?l.oE.isLociEmpty(e):r.StructureElement.Loci.is(e)?r.StructureElement.Loci.isEmpty(e):i.gn.isLoci(e)?i.gn.isLociEmpty(e):o.y.isLoci(e)?o.y.isLociEmpty(e):o.$.isLoci(e)?o.$.isLociEmpty(e):h.f.isLoci(e)?h.f.isLociEmpty(e):h.f.Isosurface.isLoci(e)?h.f.Isosurface.isLociEmpty(e):h.f.Cell.isLoci(e)?h.f.Cell.isLociEmpty(e):!!h.f.Segment.isLoci(e)&&h.f.Segment.isLociEmpty(e)))},e.remap=function(e,t){return t instanceof l.oE&&(r.StructureElement.Loci.is(e)?e=r.StructureElement.Loci.remap(e,t):l.oE.isLoci(e)?e=l.oE.remapLoci(e,t):i.gn.isLoci(e)&&(e=i.gn.remapLoci(e,t))),e},e.getBoundingSphere=n
const u=a.f8.zero()
e.getCenter=function(e,t){const r=n(e,u)
return r?s.eB.copy(t||(0,s.eB)(),r.center):void 0},e.getPrincipalAxes=function(e){if("every-loci"!==e.kind&&"empty-loci"!==e.kind)return"structure-loci"===e.kind?r.StructureElement.Loci.getPrincipalAxes(l.oE.toStructureElementLoci(e.structure)):"element-loci"===e.kind?r.StructureElement.Loci.getPrincipalAxes(e):void("bond-loci"!==e.kind&&"shape-loci"!==e.kind&&"group-loci"!==e.kind&&"data-loci"!==e.kind&&"volume-loci"!==e.kind&&"isosurface-loci"!==e.kind&&"cell-loci"!==e.kind&&e.kind)}
const m={element:e=>e,residue:e=>r.StructureElement.Loci.is(e)?r.StructureElement.Loci.extendToWholeResidues(e,!0):e,chain:e=>r.StructureElement.Loci.is(e)?r.StructureElement.Loci.extendToWholeChains(e):e,entity:e=>r.StructureElement.Loci.is(e)?r.StructureElement.Loci.extendToWholeEntities(e):e,model:e=>r.StructureElement.Loci.is(e)?r.StructureElement.Loci.extendToWholeModels(e):e,operator:e=>r.StructureElement.Loci.is(e)?r.StructureElement.Loci.extendToWholeOperators(e):e,structure:e=>r.StructureElement.Loci.is(e)?l.oE.toStructureElementLoci(e.structure):o.$.isLoci(e)?o.y.Loci(e.shape):h.f.Cell.isLoci(e)||h.f.Isosurface.isLoci(e)?h.f.Loci(e.volume,f.IX.ofLength(e.volume.instances.length)):e,elementInstances:e=>r.StructureElement.Loci.is(e)?r.StructureElement.Loci.extendToAllInstances(e):e,residueInstances:e=>r.StructureElement.Loci.is(e)?r.StructureElement.Loci.extendToAllInstances(r.StructureElement.Loci.extendToWholeResidues(e,!0)):e,chainInstances:e=>r.StructureElement.Loci.is(e)?r.StructureElement.Loci.extendToAllInstances(r.StructureElement.Loci.extendToWholeChains(e)):e}
function y(e,t){return m[t](e)}e.GranularityOptions=c.t.objectToOptions(m,e=>{switch(e){case"element":return"Atom/Coarse Element"
case"elementInstances":return["Atom/Coarse Element Instances","With Symmetry"]
case"structure":return"Structure/Shape"
default:return e.indexOf("Instances")?[(0,p.Mk)(e),"With Symmetry"]:(0,p.Mk)(e)}}),e.simpleGranularity=function(e){return e.replace("Instances","")},e.applyGranularity=y,e.normalize=function(e,t,n=!1){return("element"!==t||n)&&i.gn.isLoci(e)&&(e=i.gn.toStructureElementLoci(e)),l.oE.isLoci(e)&&(e=l.oE.toStructureElementLoci(e.structure)),r.StructureElement.Loci.is(e)&&(e=r.StructureElement.Loci.remap(e,e.structure.root)),t&&(e=y(e,t)),e}}(C||(C={}))},356(e,t,n){"use strict"
function r(e){return Math.hypot(...e)}n.r(t),n.d(t,{default:()=>i,hypot:()=>r})
var i=(0,n(10336).helper)(r)},386(e,t,n){"use strict"
n.d(t,{_i:()=>T,ij:()=>P,FB:()=>A,DG:()=>B,NQ:()=>I})
var r=n(9043),i=n(36568),o=n(31683),a=n(95916),s=n(83164),l=n(19708),c=n(85362),u=n(46357),d=n(32775),p=n(14294),h=n(24060),f=n(5638)
const m={drawCount:(0,l.Xb)("number"),instanceCount:(0,l.Xb)("number"),stride:(0,l.Xb)("number"),uGroupCount:(0,l.w5)("i","material"),aTransform:(0,l.Yz)("float32",16,1),aInstance:(0,l.Yz)("float32",1,1),aSample:(0,l.Yz)("float32",1,0),uGeoTexDim:(0,l.w5)("v2","material"),tPosition:(0,l.$G)("texture","rgba","float","nearest","material"),tGroup:(0,l.$G)("texture","rgba","float","nearest","material"),uColorTexDim:(0,l.w5)("v2","material"),tColor:(0,l.$G)("texture","rgba","ubyte","nearest","material"),dColorType:(0,l.$F)("string",["group","groupInstance","vertex","vertexInstance"]),uCurrentSlice:(0,l.w5)("f"),uCurrentX:(0,l.w5)("f"),uCurrentY:(0,l.w5)("f"),uBboxMin:(0,l.w5)("v3","material"),uBboxSize:(0,l.w5)("v3","material"),uResolution:(0,l.w5)("f","material")},g="color-accumulate",y="color-count"
function v(e,t){const n=new Float32Array(e)
for(let r=0;r<e;++r)n[r]=r*t
return n}const b={...u.du,tColor:(0,l.$G)("texture","rgba","float","nearest"),tCount:(0,l.$G)("texture","alpha","float","nearest"),uTexSize:(0,l.w5)("v2")},x="color-normalize"
function S(e,t,n,l,S){const{drawBuffers:_}=l.extensions
if(!_)throw new Error("need WebGL draw buffers")
f.g$&&l.timer.mark("calcTextureMeshColorSmoothing")
const{gl:C,resources:w,state:T,extensions:{colorBufferHalfFloat:A,textureHalfFloat:I}}=l,P=e.colorType.endsWith("Instance"),B=p.DJ.fromSphere3D((0,p.DJ)(),P?e.boundingSphere:e.invariantBoundingSphere),E=1+t,k=p.DJ.expand((0,p.DJ)(),B,d.eB.create(E,E,E)),D=1/t,M=p.DJ.scale((0,p.DJ)(),k,D),R=p.DJ.size((0,d.eB)(),M)
d.eB.ceil(R,R),d.eB.add(R,R,d.eB.create(2,2,2))
const{min:O}=k,[L,N,F]=R,{texDimX:z,texDimY:j,texCols:V}=function(e){const t=e[0]*e[1]*e[2],n=Math.sqrt(t),r=Math.pow(2,Math.ceil(Math.log(n)/Math.log(2)))
let i=0,o=e[1],a=1,s=e[2]
return r<e[0]*e[2]?(s=Math.floor(r/e[0]),a=Math.ceil(e[2]/s),i=s*e[0],o*=a):i=e[0]*e[2],{texDimX:i,texDimY:o,texRows:a,texCols:s,powerOfTwoSize:o<r?r:2*r}}(R)
l.namedFramebuffers[g]||(l.namedFramebuffers[g]=l.resources.framebuffer())
const U=l.namedFramebuffers[g];(0,h.C6)(C)?(l.namedTextures[g]||(l.namedTextures[g]=A&&I?w.texture("image-float16","rgba","fp16","nearest"):w.texture("image-float32","rgba","float","nearest")),l.namedTextures[y]||(l.namedTextures[y]=w.texture("image-float32","alpha","float","nearest"))):(l.namedTextures[g]||(l.namedTextures[g]=w.texture("image-float32","rgba","float","nearest")),l.namedTextures[y]||(l.namedTextures[y]=w.texture("image-float32","rgba","float","nearest")))
const G=l.namedTextures[g],H=l.namedTextures[y]
G.define(z,j),H.define(z,j),G.attachFramebuffer(U,0),H.attachFramebuffer(U,1)
const q=function(e,t,n,o,l){if(e.namedComputeRenderables[g]){const i=d.eB.sub((0,d.eB)(),n.max,n.min),a=e.namedComputeRenderables[g].values,s=Math.round(t.vertexCount/l);(s>a.drawCount.ref.value||l!==a.stride.ref.value)&&r.IQ.update(a.aSample,v(s,l)),r.IQ.updateIfChanged(a.drawCount,s),r.IQ.updateIfChanged(a.instanceCount,t.instanceCount),r.IQ.updateIfChanged(a.stride,l),r.IQ.updateIfChanged(a.uGroupCount,t.groupCount),r.IQ.update(a.aTransform,t.transformBuffer),r.IQ.update(a.aInstance,t.instanceBuffer),r.IQ.update(a.uGeoTexDim,d.ZY.set(a.uGeoTexDim.ref.value,t.positionTexture.getWidth(),t.positionTexture.getHeight())),r.IQ.update(a.tPosition,t.positionTexture),r.IQ.update(a.tGroup,t.groupTexture),r.IQ.update(a.uColorTexDim,d.ZY.set(a.uColorTexDim.ref.value,t.colorData.getWidth(),t.colorData.getHeight())),r.IQ.update(a.tColor,t.colorData),r.IQ.updateIfChanged(a.dColorType,t.colorType),r.IQ.updateIfChanged(a.uCurrentSlice,0),r.IQ.updateIfChanged(a.uCurrentX,0),r.IQ.updateIfChanged(a.uCurrentY,0),r.IQ.update(a.uBboxMin,n.min),r.IQ.update(a.uBboxSize,i),r.IQ.updateIfChanged(a.uResolution,o),e.namedComputeRenderables[g].update()}else e.namedComputeRenderables[g]=function(e,t,n,o,l){const c=d.eB.sub((0,d.eB)(),n.max,n.min),u=Math.round(t.vertexCount/l),p={drawCount:r.IQ.create(u),instanceCount:r.IQ.create(t.instanceCount),stride:r.IQ.create(l),uGroupCount:r.IQ.create(t.groupCount),aTransform:r.IQ.create(t.transformBuffer),aInstance:r.IQ.create(t.instanceBuffer),aSample:r.IQ.create(v(u,l)),uGeoTexDim:r.IQ.create(d.ZY.create(t.positionTexture.getWidth(),t.positionTexture.getHeight())),tPosition:r.IQ.create(t.positionTexture),tGroup:r.IQ.create(t.groupTexture),uColorTexDim:r.IQ.create(d.ZY.create(t.colorData.getWidth(),t.colorData.getHeight())),tColor:r.IQ.create(t.colorData),dColorType:r.IQ.create(t.colorType),uCurrentSlice:r.IQ.create(0),uCurrentX:r.IQ.create(0),uCurrentY:r.IQ.create(0),uBboxMin:r.IQ.create(n.min),uBboxSize:r.IQ.create(c),uResolution:r.IQ.create(o)},h={...m},f=(0,a.NG)("accumulate","\nprecision highp float;\n\n#include common\n#include read_from_texture\n\nuniform int uGroupCount;\n\nattribute float aSample;\n#define SampleID int(aSample)\n\nattribute mat4 aTransform;\nattribute float aInstance;\n\nuniform vec2 uGeoTexDim;\nuniform sampler2D tPosition;\nuniform sampler2D tGroup;\n\nuniform vec2 uColorTexDim;\nuniform sampler2D tColor;\n\nvarying vec3 vPosition;\nvarying vec4 vColor;\n\nuniform vec3 uBboxSize;\nuniform vec3 uBboxMin;\nuniform float uResolution;\n\nvoid main() {\n    vec3 position = readFromTexture(tPosition, SampleID, uGeoTexDim).xyz;\n    float group = unpackRGBToInt(readFromTexture(tGroup, SampleID, uGeoTexDim).rgb);\n\n    position = (aTransform * vec4(position, 1.0)).xyz;\n    gl_PointSize = 7.0;\n    vPosition = (position - uBboxMin) / uResolution;\n    gl_Position = vec4(((position - uBboxMin) / uBboxSize) * 2.0 - 1.0, 1.0);\n\n    #if defined(dColorType_group)\n        vColor = readFromTexture(tColor, group, uColorTexDim);\n    #elif defined(dColorType_groupInstance)\n        vColor = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim);\n    #endif\n}\n","\nprecision highp float;\n\nvarying vec3 vPosition;\nvarying vec4 vColor;\n\nuniform float uCurrentSlice;\nuniform float uCurrentX;\nuniform float uCurrentY;\nuniform float uResolution;\n\nconst float p = 2.0;\n\nvoid main() {\n    vec2 v = gl_FragCoord.xy - vec2(uCurrentX, uCurrentY) - 0.5;\n    vec3 fragPos = vec3(v.x, v.y, uCurrentSlice);\n    float dist = distance(fragPos, vPosition);\n    if (dist > p) discard;\n\n    float f = p - dist;\n    gl_FragColor = vColor * f;\n    gl_FragData[1] = vec4(f);\n}\n",{drawBuffers:"required"}),g=(0,s.$h)(e,"points",f,h,p)
return(0,i._)(g,p)}(e,t,n,o,l)
return e.namedComputeRenderables[g]}(l,e,k,t,n)
T.currentRenderItemId=-1,U.bind(),_.drawBuffers([_.COLOR_ATTACHMENT0,_.COLOR_ATTACHMENT1])
const{uCurrentSlice:Q,uCurrentX:$,uCurrentY:X}=q.values
f.g$&&l.timer.mark("ColorAccumulate.render"),function(e){const{gl:t,state:n}=e
n.disable(t.CULL_FACE),n.enable(t.BLEND),n.disable(t.DEPTH_TEST),n.enable(t.SCISSOR_TEST),n.depthMask(!1),n.clearColor(0,0,0,0),n.blendFunc(t.ONE,t.ONE),n.blendEquation(t.FUNC_ADD)}(l),T.viewport(0,0,z,j),T.scissor(0,0,z,j),C.clear(C.COLOR_BUFFER_BIT),r.IQ.update(X,0)
let W=0,Y=0,Z=0
for(let i=0;i<F;++i)W>=V&&(W-=V,Y+=N,Z=0,r.IQ.update(X,Y)),r.IQ.update($,Z),r.IQ.update(Q,i),T.viewport(Z,Y,L,N),T.scissor(Z,Y,L,N),q.render(),++W,Z+=L
G.detachFramebuffer(U,0),H.detachFramebuffer(U,1),_.drawBuffers([C.COLOR_ATTACHMENT0,C.NONE]),f.g$&&l.timer.markEnd("ColorAccumulate.render"),f.g$&&l.timer.mark("ColorNormalize.render"),S&&!(0,o.NP)(S)||(S=w.texture("image-uint8","rgba","ubyte","linear")),S.define(z,j)
const K=function(e,t,n){if(e.namedComputeRenderables[x]){const i=e.namedComputeRenderables[x].values
r.IQ.update(i.tColor,t),r.IQ.update(i.tCount,n),r.IQ.update(i.uTexSize,d.ZY.set(i.uTexSize.ref.value,t.getWidth(),t.getHeight())),e.namedComputeRenderables[x].update()}else e.namedComputeRenderables[x]=function(e,t,n){const o={...u.OM,tColor:r.IQ.create(t),tCount:r.IQ.create(n),uTexSize:r.IQ.create(d.ZY.create(t.getWidth(),t.getHeight()))},l={...b},p=(0,a.NG)("normalize",c.e,"\nprecision highp float;\nprecision highp sampler2D;\n\nuniform sampler2D tColor;\nuniform sampler2D tCount;\nuniform vec2 uTexSize;\n\nvoid main(void) {\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n    vec4 color = texture2D(tColor, coords);\n    float count = texture2D(tCount, coords).r;\n\n    gl_FragColor = color / count;\n}\n"),h=(0,s.$h)(e,"triangles",p,l,o)
return(0,i._)(h,o)}(e,t,n)
return e.namedComputeRenderables[x]}(l,G,H)
T.currentRenderItemId=-1,function(e){const{gl:t,state:n}=e
n.disable(t.CULL_FACE),n.enable(t.BLEND),n.disable(t.DEPTH_TEST),n.enable(t.SCISSOR_TEST),n.depthMask(!1),n.clearColor(0,0,0,0),n.blendFunc(t.ONE,t.ONE),n.blendEquation(t.FUNC_ADD)}(l),S.attachFramebuffer(U,0),T.viewport(0,0,z,j),T.scissor(0,0,z,j),C.clear(C.COLOR_BUFFER_BIT),K.render(),f.g$&&l.timer.markEnd("ColorNormalize.render")
const J=d.Zb.create(O[0],O[1],O[2],D),ee=P?"volumeInstance":"volume"
return f.g$&&l.timer.markEnd("calcTextureMeshColorSmoothing"),{texture:S,gridDim:R,gridTexDim:d.ZY.create(z,j),gridTransform:J,type:ee}}const _="color-smoothing-rgb",C="color-smoothing-rgba",w="color-smoothing-alpha"
function T(e,t,n,i,o){if("group"!==(a=e.dColorType.ref.value)&&"groupInstance"!==a)return
var a
n*=3,i.namedTextures[_]||(i.namedTextures[_]=i.resources.texture("image-uint8","rgb","ubyte","nearest"))
const s=i.namedTextures[_]
s.load(e.tColor.ref.value)
const l=S({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:s,colorType:e.dColorType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,n,i,o)
r.IQ.updateIfChanged(e.dColorType,l.type),r.IQ.update(e.tColorGrid,l.texture),r.IQ.update(e.uColorTexDim,l.gridTexDim),r.IQ.update(e.uColorGridDim,l.gridDim),r.IQ.update(e.uColorGridTransform,l.gridTransform)}function A(e,t,n,i,o){if("groupInstance"!==e.dOverpaintType.ref.value)return
n*=3,i.namedTextures[C]||(i.namedTextures[C]=i.resources.texture("image-uint8","rgba","ubyte","nearest"))
const a=i.namedTextures[C]
a.load(e.tOverpaint.ref.value)
const s=S({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:a,colorType:e.dOverpaintType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,n,i,o)
r.IQ.updateIfChanged(e.dOverpaintType,s.type),r.IQ.update(e.tOverpaintGrid,s.texture),r.IQ.update(e.uOverpaintTexDim,s.gridTexDim),r.IQ.update(e.uOverpaintGridDim,s.gridDim),r.IQ.update(e.uOverpaintGridTransform,s.gridTransform)}function I(e,t,n,i,o){if("groupInstance"!==e.dTransparencyType.ref.value)return
n*=3,i.namedTextures[w]||(i.namedTextures[w]=i.resources.texture("image-uint8","alpha","ubyte","nearest"))
const a=i.namedTextures[w]
a.load(e.tTransparency.ref.value)
const s=S({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:a,colorType:e.dTransparencyType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,n,i,o)
r.IQ.updateIfChanged(e.dTransparencyType,s.type),r.IQ.update(e.tTransparencyGrid,s.texture),r.IQ.update(e.uTransparencyTexDim,s.gridTexDim),r.IQ.update(e.uTransparencyGridDim,s.gridDim),r.IQ.update(e.uTransparencyGridTransform,s.gridTransform)}function P(e,t,n,i,o){if("groupInstance"!==e.dEmissiveType.ref.value)return
n*=3,i.namedTextures[w]||(i.namedTextures[w]=i.resources.texture("image-uint8","alpha","ubyte","nearest"))
const a=i.namedTextures[w]
a.load(e.tEmissive.ref.value)
const s=S({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:a,colorType:e.dEmissiveType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,n,i,o)
r.IQ.updateIfChanged(e.dEmissiveType,s.type),r.IQ.update(e.tEmissiveGrid,s.texture),r.IQ.update(e.uEmissiveTexDim,s.gridTexDim),r.IQ.update(e.uEmissiveGridDim,s.gridDim),r.IQ.update(e.uEmissiveGridTransform,s.gridTransform)}function B(e,t,n,i,o){if("groupInstance"!==e.dSubstanceType.ref.value)return
n*=3,i.namedTextures[C]||(i.namedTextures[C]=i.resources.texture("image-uint8","rgba","ubyte","nearest"))
const a=i.namedTextures[C]
a.load(e.tSubstance.ref.value)
const s=S({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:a,colorType:e.dSubstanceType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,n,i,o)
r.IQ.updateIfChanged(e.dSubstanceType,s.type),r.IQ.update(e.tSubstanceGrid,s.texture),r.IQ.update(e.uSubstanceTexDim,s.gridTexDim),r.IQ.update(e.uSubstanceGridDim,s.gridDim),r.IQ.update(e.uSubstanceGridTransform,s.gridTransform)}},497(e,t,n){"use strict"
function r(e){var t=e(function(e){Error.call(e),e.stack=(new Error).stack})
return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}n.d(t,{L:()=>r})},717(e,t,n){"use strict"
n.d(t,{K4:()=>r,OQ:()=>T,YG:()=>A})
var r,i,o=n(93104),a=n(70292),s=n(89748),l=n(23968),c=n(10212),u=n(15769),d=n(24762),p=n(60658),h=n(39791),f=n(65746),m=n(48393),g=n(23782),y=n(29472),v=n(12372),b=n(87095),x=n(7808),S=n(70012),_=n(64367),C=n(28901),w=n(50558)
function T(e,t){const n=r.fromFrame(e,void 0,void 0,t),i=(0,y.z)(n.data.db,!0)
return a.Task.create("Create mmCIF Model",e=>(0,l.X)(i,n,e))}function A(e){const t=i.fromFrame(e)
return a.Task.create("Create CCD Models",n=>async function(e,t,n){const r=await I(e,t,{coordinateType:"ideal",cartn_x:"pdbx_model_Cartn_x_ideal",cartn_y:"pdbx_model_Cartn_y_ideal",cartn_z:"pdbx_model_Cartn_z_ideal"},n),i=await I(e,t,{coordinateType:"model",cartn_x:"model_Cartn_x",cartn_y:"model_Cartn_y",cartn_z:"model_Cartn_z"},n),a=[]
r&&a.push(r),i&&a.push(i)
for(let s=0,l=a.length;s<l;++s)o.K.TrajectoryInfo.set(a[s],{index:s,size:a.length})
return new m.ArrayTrajectory(a)}(t.data.db,i.fromFrame(e),n))}async function I(e,t,n,r){const{chem_comp:o,chem_comp_atom:a,chem_comp_bond:s}=e,{coordinateType:c,cartn_x:u,cartn_y:p,cartn_z:f}=n,m=o.name.value(0),g=o.id.value(0),{atom_id:S,charge:_,comp_id:C,pdbx_ordinal:w,type_symbol:T}=a,A=a._rowCount,I=[]
for(let i=0;i<A;i++)a[u].valueKind(i)>0||(I[I.length]=i)
const P=I.length,B=d.VP.ofConst("A",P,d.VP.Schema.str),E=d.VP.ofConst(1,P,d.VP.Schema.int),k=d.VP.ofConst("1",P,d.VP.Schema.str),D=d.VP.ofConst(1,P,d.VP.Schema.float),M=d.VP.ofConst(1,P,d.VP.Schema.int),R=d.VP.view(S,I),O=d.VP.view(C,I),L=d.VP.view(a[u],I),N=d.VP.view(a[p],I),F=d.VP.view(a[f],I),z=d.VP.view(w,I),j=d.VP.view(T,I),V=d.VP.view(_,I),U=d.XI.ofPartialColumns(y.e.atom_site,{auth_asym_id:B,auth_atom_id:R,auth_comp_id:O,auth_seq_id:E,Cartn_x:L,Cartn_y:N,Cartn_z:F,id:z,label_asym_id:B,label_atom_id:R,label_comp_id:O,label_seq_id:E,label_entity_id:k,occupancy:D,type_symbol:j,pdbx_PDB_model_num:M,pdbx_formal_charge:V},P),G=new v.V
G.setNames([[g,`${m} (${c})`]]),G.getEntityId(g,b.MoleculeType.Unknown,"A")
const H=new x.N(E,T)
H.setNames([[g,`${m} (${c})`]]),H.add(g,0)
const q=(0,y.z)({entity:G.getEntityTable(),chem_comp:H.getChemCompTable(),atom_site:U}),Q=await(0,l.X)(q,t,r)
if(!Q.representative)return
const $=Q.representative,X=h.X.getEntriesFromChemCompBond(s)
return h.X.Provider.set($,{data:s,entries:X}),i.CoordinateType.set($,c),Q.representative}c.i.Provider.formatRegistry.add("mmCIF",function(e){if(r.is(e.sourceData))return c.i.fromData(e.sourceData.data.db)}),u.v.Provider.formatRegistry.add("mmCIF",function(e){if(!r.is(e.sourceData))return
const{struct_conf:t,struct_sheet_range:n}=e.sourceData.data.db
return u.v.fromStruct(t,n,e.atomicHierarchy)}),p._.Provider.formatRegistry.add("mmCIF",function(e){if(!r.is(e.sourceData))return
const{atom_site_anisotrop:t}=e.sourceData.data.db
return{data:d.XI.ofColumns(p._.Schema,t),elementToAnsiotrop:p._.getElementToAnsiotrop(e.atomicConformation.atomId,t.id)}},function(e){return!!r.is(e.sourceData)&&e.sourceData.data.db.atom_site_anisotrop.U.isDefined}),h.X.Provider.formatRegistry.add("mmCIF",function(e){if(!r.is(e.sourceData))return
const{chem_comp_bond:t}=e.sourceData.data.db
return 0!==t._rowCount?{data:t,entries:h.X.getEntriesFromChemCompBond(t)}:void 0}),f.A.Provider.formatRegistry.add("mmCIF",function(e){if(!r.is(e.sourceData))return
const{struct_conn:t}=e.sourceData.data.db
if(0===t._rowCount)return
const n=f.A.getEntriesFromStructConn(t,e),i=new Set
for(const r of n)r.partnerA.residueIndex!==r.partnerB.residueIndex&&i.add((0,S.bd)(r.partnerA.residueIndex,r.partnerB.residueIndex))
return{data:t,byAtomIndex:f.A.getAtomIndexFromEntries(n),residueCantorPairs:i,entries:n}}),_.z.Provider.formatRegistry.add("mmCIF",function(e){if(!r.is(e.sourceData))return
const{molstar_bond_site:t}=(0,C.Pd)(w.G,e.sourceData.data.frame)
if(0===t._rowCount)return
const n=new Map,{atomId:i}=e.atomicConformation
for(let r=0;r<i.rowCount;r++)n.set(i.value(r),r)
const o=[],a=[],s=[],l=[],{atom_id_1:c,atom_id_2:u,value_order:p,type_id:h}=t
for(let r=0;r<t._rowCount;r++){o.push(n.get(c.value(r))),a.push(n.get(u.value(r)))
let e=b.BondType.Flag.None,t=1
switch(p.value(r)){case"sing":t=1
break
case"doub":t=2
break
case"trip":t=3
break
case"quad":t=4
break
case"arom":t=1,e=b.BondType.Flag.Aromatic}switch(h.value(r)){case"covale":e|=b.BondType.Flag.Covalent
break
case"disulf":e|=b.BondType.Flag.Covalent|b.BondType.Flag.Disulfide
break
case"hydrog":e|=b.BondType.Flag.HydrogenBond
break
case"metalc":e|=b.BondType.Flag.MetallicCoordination}s.push(t),l.push(e)}return _.z.fromData({pairs:{indexA:d.VP.ofIntArray(o),indexB:d.VP.ofIntArray(a),order:d.VP.ofIntArray(s),flag:d.VP.ofArray({array:l,schema:d.VP.Schema.int})},count:e.atomicHierarchy.atoms._rowCount},{maxDistance:1/0})}),g.T.Provider.formatRegistry.add("mmCIF",g.T.fromMmCif,g.T.hasData),function(e){e.is=function(e){return"mmCIF"===(null==e?void 0:e.kind)},e.fromFrame=function(e,t,n,r){return t||(t=s.f$.schema.mmCIF(e)),{kind:"mmCIF",name:t._name,data:{db:t,file:r,frame:e,source:n}}}}(r||(r={})),function(e){const t="__CcdCoordinateType__"
e.CoordinateType={get:e=>e._staticPropertyData[t],set:(e,n)=>e._staticPropertyData[t]=n},e.is=function(e){return"CCD"===(null==e?void 0:e.kind)},e.fromFrame=function(e,t){return t||(t=s.f$.schema.CCD(e)),{kind:"CCD",name:t._name,data:{db:t,frame:e}}}}(i||(i={}))},734(e,t,n){"use strict"
function r(e,t){if(void 0===t||0===+t)return Math.round(e)
if(t=+t,null===(e=+e)||isNaN(e)||"number"!=typeof t||t%1!=0)return NaN
if(e<0)return-r(-e,t)
let n=e.toString().split("e")
return n=(e=Math.round(+`${n[0]}e${n[1]?+n[1]-t:-t}`)).toString().split("e"),+`${n[0]}e${n[1]?+n[1]+t:t}`}function i([e],t){if(t){if(t.decimals)return r(e,-t.decimals)
if(t.exp)return r(e,t.exp)}return Math.round(e)}n.r(t),n.d(t,{default:()=>o,round:()=>i})
var o=(0,n(10336).helper)(i)},1496(e,t,n){"use strict"
n.d(t,{E:()=>r,g:()=>a})
var r,i=n(9043),o=n(24762)
function a(e,t){return{value:e,unit:t}}!function(e){e.create=function(e,t,n){const r=!!e[0].cell,o=!!e[0].velocities,a=!!e[0].forces
return{id:i.kk.create22(),frames:e,hasCell:r,hasVelocities:o,hasForces:a,deltaTime:t,timeOffset:n}},e.getAtomicConformation=function(e,t,l){var c,u
let{x:d,y:p,z:h}=e
return e.xyzOrdering.frozen?l?e.xyzOrdering.isIdentity?(d=a(d,l),p=a(p,l),h=a(h,l)):(0,i.af)(e.xyzOrdering.index,l)||(d=r(d,e.xyzOrdering.index,l),p=r(p,e.xyzOrdering.index,l),h=r(h,e.xyzOrdering.index,l)):e.xyzOrdering.isIdentity||(d=s(d,e.xyzOrdering.index),p=s(p,e.xyzOrdering.index),h=s(h,e.xyzOrdering.index)):l&&(e.xyzOrdering.isIdentity?(e.xyzOrdering.isIdentity=!1,e.xyzOrdering.index=l,n(d,l),n(p,l),n(h,l)):(0,i.af)(e.xyzOrdering.index,l)||(d=r(d,e.xyzOrdering.index,l),p=r(p,e.xyzOrdering.index,l),h=r(h,e.xyzOrdering.index,l))),e.xyzOrdering.frozen=!0,{id:i.kk.create22(),atomId:t.atomId,occupancy:null!==(c=t.occupancy)&&void 0!==c?c:o.VP.ofConst(1,e.elementCount,o.VP.Schema.int),B_iso_or_equiv:null!==(u=t.B_iso_or_equiv)&&void 0!==u?u:o.VP.ofConst(0,e.elementCount,o.VP.Schema.float),xyzDefined:!0,x:d,y:p,z:h}}
const t=[.123]
function n(e,n){const r=t
for(let t=0,i=e.length;t<i;t++)r[t]=e[n[t]]
for(let t=0,i=e.length;t<i;t++)e[t]=r[t]}function r(e,t,n){const r=new Float32Array(e.length)
for(let i=0,o=e.length;i<o;i++)r[i]=e[t[n[i]]]
return r}function a(e,t){const n=new Float32Array(e.length)
for(let r=0,i=e.length;r<i;r++)n[r]=e[t[r]]
return n}function s(e,t){const n=new Float32Array(e.length)
for(let r=0,i=e.length;r<i;r++)n[t[r]]=e[r]
return n}}(r||(r={}))},1654(e,t,n){"use strict"
function r(e,t,n=-1){const r=new Float32Array(3*e),i=-1===n?e<=4?Math.sqrt(2)/2:.6:n,o=t?1:0
for(let a=0,s=e;a<s;++a){const t=(2*a+o)/e*Math.PI
r[3*a]=Math.cos(t)*i,r[3*a+1]=Math.sin(t)*i,r[3*a+2]=0}return r}n.d(t,{n:()=>r})},1712(e,t,n){"use strict"
n.d(t,{CL:()=>a,JA:()=>c,Qx:()=>s,VI:()=>o,cG:()=>l})
var r=n(12288),i=n(45996)
const o={reds:(0,i.Q5)("Reds","sequential","Reds, sequential color scheme from ColorBrewer 2.0",[16774640,16703698,16563105,16552562,16476746,15678252,13309981,10817301,6750221]),oranges:(0,i.Q5)("Oranges","sequential","Oranges, sequential color scheme from ColorBrewer 2.0",[16774635,16705230,16634018,16625259,16616764,15821075,14239745,10892803,8333060]),greens:(0,i.Q5)("Greens","sequential","Greens, sequential color scheme from ColorBrewer 2.0",[16252149,15070688,13101504,10607003,7652470,4303709,2329413,27948,17435]),blues:(0,i.Q5)("Blues","sequential","Blues, sequential color scheme from ColorBrewer 2.0",[16251903,14609399,13032431,10406625,7057110,4362950,2191797,545180,536683]),purples:(0,i.Q5)("Purples","sequential","Purples, sequential color scheme from ColorBrewer 2.0",[16579581,15724021,14342891,12369372,10394312,8420794,6967715,5515151,4128893]),greys:(0,i.Q5)("Greys","sequential","Greys, sequential color scheme from ColorBrewer 2.0",[16777215,15790320,14277081,12434877,9868950,7566195,5395026,2434341,0]),"orange-red":(0,i.Q5)("Orange-Red","sequential","OrRd, sequential color scheme from ColorBrewer 2.0",[16775148,16705736,16635038,16628612,16551257,15689032,14102559,11730944,8323072]),"blue-green":(0,i.Q5)("Blue-Green","sequential","BuGn, sequential color scheme from ColorBrewer 2.0",[16252157,15070713,13429990,10082505,6734500,4304502,2329413,27948,17435]),"purple-blue-green":(0,i.Q5)("Purple-Blue-Green","sequential","PuBuGn, sequential color scheme from ColorBrewer 2.0",[16775163,15524592,13685222,10927579,6793679,3576e3,164234,93273,83510]),"green-blue":(0,i.Q5)("Green-Blue","sequential","GnBu, sequential color scheme from ColorBrewer 2.0",[16252144,14742491,13429701,11066805,8113348,5157843,2854078,551084,540801]),"purple-blue":(0,i.Q5)("Purple-Blue","sequential","PuBu, sequential color scheme from ColorBrewer 2.0",[16775163,15525874,13685222,10927579,7645647,3576e3,356528,285325,145496]),"blue-purple":(0,i.Q5)("Blue-Purple","sequential","BuPu, sequential color scheme from ColorBrewer 2.0",[16252157,14740724,12571622,10403034,9213638,9202609,8929693,8458108,5046347]),"red-purple":(0,i.Q5)("Red-Purple","sequential","RdPu, sequential color scheme from ColorBrewer 2.0",[16775155,16638173,16565696,16424885,16214177,14496919,11403646,7995767,4784234]),"purple-red":(0,i.Q5)("Purple-Red","sequential","PuRd, sequential color scheme from ColorBrewer 2.0",[16250105,15196655,13941210,13210823,14640560,15149450,13505110,9961539,6750239]),"yellow-orange-red":(0,i.Q5)("Yellow-Orange-Red","sequential","YlOrRd, sequential color scheme from ColorBrewer 2.0",[16777164,16772512,16701814,16691788,16616764,16535082,14883356,12386342,8388646]),"yellow-orange-brown":(0,i.Q5)("Yellow-Orange-Brown","sequential","YlOrBr, sequential color scheme from ColorBrewer 2.0",[16777189,16775100,16704401,16696399,16685353,15495188,13388802,10040324,6694150]),"yellow-green":(0,i.Q5)("Yellow-Green","sequential","YlGn, sequential color scheme from ColorBrewer 2.0",[16777189,16252089,14282915,11394446,7915129,4303709,2327619,26679,17705]),"yellow-green-blue":(0,i.Q5)("Yellow-Green-Blue","sequential","YlGnBu, sequential color scheme from ColorBrewer 2.0",[16777177,15595697,13101492,8375739,4306628,1937856,2252456,2438292,531800]),"red-blue":(0,i.Q5)("Red-Blue","diverging","RdBu, diverging color scheme from ColorBrewer 2.0",[6750239,11671595,14049357,16033154,16636871,16250871,13755888,9618910,4428739,2188972,340065]),"red-grey":(0,i.Q5)("Red-Grey","diverging","RdGy, diverging color scheme from ColorBrewer 2.0",[6750239,11671595,14049357,16033154,16636871,16777215,14737632,12237498,8882055,5066061,1710618]),"pink-yellow-green":(0,i.Q5)("Pink-Yellow-Green","diverging","PiYG, diverging color scheme from ColorBrewer 2.0",[9306450,12917629,14579630,15840986,16638191,16250871,15136208,12116358,8371265,5083681,2581529]),"brown-white-green":(0,i.Q5)("Brown-White-Green","diverging","BrBG, diverging color scheme from ColorBrewer 2.0",[5517317,9195786,12550445,14664317,16181443,16119285,13101797,8441281,3512207,91742,15408]),"purple-green":(0,i.Q5)("Purple-Green","diverging","PRGn, diverging color scheme from ColorBrewer 2.0",[4194379,7744131,10055851,12756431,15193320,16250871,14282963,10935200,5942881,1800247,17435]),"purple-orange":(0,i.Q5)("Purple-Orange","diverging","PuOr, diverging color scheme from ColorBrewer 2.0",[2949195,5515144,8418220,11709394,14211819,16250871,16703670,16627811,14713364,11753478,8338184]),"orange-purple":(0,i.Q5)("Orange-Purple","diverging","Reversed PuOr, diverging color scheme from ColorBrewer 2.0",[8338184,11753478,14713364,16627811,16703670,16250871,14211819,11709394,8418220,5515144,2949195]),"red-yellow-green":(0,i.Q5)("Red-Yellow-Green","diverging","RdYlGn, diverging color scheme from ColorBrewer 2.0",[10813478,14102567,16018755,16625249,16703627,16777151,14282635,10934634,6733155,1742928,26679]),"red-yellow-blue":(0,i.Q5)("Red-Yellow-Blue","diverging","RdYlBu, diverging color scheme from ColorBrewer 2.0",[10813478,14102567,16018755,16625249,16703632,16777151,14742520,11262441,7646673,4552116,3225237]),spectral:(0,i.Q5)("Spectral","diverging","Spectral, diverging color scheme from ColorBrewer 2.0",[10355010,13975119,16018755,16625249,16703627,16777151,15136152,11263396,6734501,3311805,6180770]),magma:(0,i.Q5)("Magma","sequential","Magma, sequential color scheme from Matplotlib, perceptually uniform shades of black-red-white",[4,131595,328726,591648,920363,1314358,1708098,2167117,2691418,3346535,3870576,4460406,4985210,5510013,5969279,6560384,7019905,7676289,8135554,8660609,9185665,9710720,10235519,10826110,11351164,12007289,12532343,13057395,13516656,14042475,14567784,14962532,15357537,15687006,16017244,16216156,16349533,16483167,16551011,16619112,16686957,16689523,16692347,16694658,16696970,16699282,16701594,16638627,16640940,16577718,16580031]),"magma-no-black":(0,i.Q5)("Magma (no black)","sequential","Magma, sequential color scheme from Matplotlib, perceptually uniform shades of black-red-white (with the black region removed)",[4329332,4853881,5378684,5903742,6363263,6888576,7413633,7938689,8463745,8988801,9513600,10038655,10563454,11088508,11613562,12138360,12728949,13254258,13714030,14239338,14699366,15094114,15489119,15753309,16017499,16216411,16350045,16483424,16551523,16619368,16621934,16689780,16692091,16694402,16696969,16633746,16636058,16638371,16575148,16577461,16514239]),inferno:(0,i.Q5)("Inferno","sequential","Inferno, sequential color scheme from Matplotlib, perceptually uniform shades of black-red-yellow",[4,131596,328727,657186,1050925,1444665,1969221,2427985,3082843,3737955,4328040,4852843,5377645,5902702,6427502,6952814,7477870,8133997,8659051,9184105,9643623,10168676,10693729,11218782,11743834,12334932,12794703,13254730,13583429,14109502,14504250,14833460,15162926,15427112,15757088,15955993,16154643,16288012,16421383,16489222,16557322,16559634,16497183,16434218,16305463,16176966,16048470,15919721,15921789,16120210,16580516]),"inferno-no-black":(0,i.Q5)("Inferno (no black)","sequential","Inferno, sequential color scheme from Matplotlib, perceptually uniform shades of black-red-yellow (with the black region removed)",[4721514,5246316,5771373,6296430,6821486,7346542,7871597,8396651,8921450,9446504,9971557,10496610,10956127,11481435,12006486,12466258,12926285,13386056,13780802,14241085,14570295,14965297,15229227,15558693,15757342,15956248,16154897,16288267,16421638,16489734,16492043,16494612,16496926,16368426,16305463,16111429,15982678,15853928,15856253,16119953,16580260]),plasma:(0,i.Q5)("Plasma","sequential","Plasma, sequential color scheme from Matplotlib, perceptually uniform shades of blue-red-yellow",[1771148,2426257,3081365,3671193,4195228,4784799,5308834,5833124,6357158,6815911,7340200,7864744,8324007,8783782,9309348,9769377,10164126,10624154,11018902,11413393,11808141,12137352,12466307,12795519,13124730,13453685,13717361,14046573,14309992,14573668,14837344,15035483,15299159,15497299,15695438,15893834,16091974,16224833,16357693,16425017,16557877,16625457,16627245,16629289,16631334,16567845,16438820,16310052,16115494,15921190,15726625]),viridis:(0,i.Q5)("Viridis","sequential","Viridis, sequential color scheme from Matplotlib, perceptually uniform shades of blue-green-yellow",[4524123,4656994,4658793,4726127,4727668,4663929,4599933,4535937,4406404,4276870,4081800,3952010,3822475,3627148,3497356,3302029,3172237,3042446,2912654,2782862,2652814,2523022,2393229,2328973,2198924,2069132,2004874,2005897,2007175,2139525,2337154,2666111,3060348,3520376,4045684,4570991,5227369,5883748,6605661,7392854,8180303,8967495,9819967,10672695,11525166,12443174,13295646,14148121,15000344,15852828,16639780]),cividis:(0,i.Q5)("Cividis","sequential","Cividis, sequential color scheme from Matplotlib, perceptually uniform shades of blue-grey-yellow, should look effectively identical to colorblind and non-colorblind users",[8273,9305,10079,76644,339560,668266,1062508,1390957,1916270,2375790,2835566,3295342,3754862,4214638,4543085,5068397,5462638,5856878,6185326,6579567,6908272,7236721,7499890,7828595,8091764,8354933,8617846,8946551,9209463,9472888,9736056,10064760,10327928,10656632,10985591,11379830,11708532,12102770,12497264,12891501,13285994,13745766,14140259,14600287,14994522,15389014,15717970,16046926,16310347,16508232,16640581]),twilight:(0,i.Q5)("Twilight","cyclical","Twilight, cyclical color scheme from Matplotlib, perceptually uniform shades of white-blue-black-red-white",[14670305,14211037,13554648,12766675,11847630,10993866,10139847,9351365,8628419,8036290,7509952,7048895,6718653,6519739,6386105,6252470,6184114,6181293,6112935,6044831,5976470,5777291,5447293,5052270,4592479,4067665,3674181,3281211,3150646,3543352,4067644,4657728,5379141,6166345,6953549,7741007,8463184,9120336,9777743,10304079,10830671,11291984,11687762,12083541,12348505,12613471,12878439,13077872,13211771,13411209,13545111,13809830,14074293,14338756,14537169,14735067,14801121]),"set-2":(0,i.Q5)("Set-2","qualitative","Set2, categorical color scheme from ColorBrewer 2.0",[6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947]),accent:(0,i.Q5)("Accent","qualitative","Accent, categorical color scheme from ColorBrewer 2.0",[8374655,12496596,16629894,16777113,3697840,15729279,12540695,6710886]),"set-1":(0,i.Q5)("Set-1","qualitative","Set1, categorical color scheme from ColorBrewer 2.0",[14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607,10066329]),"set-3":(0,i.Q5)("Set-3","qualitative","Set3, categorical color scheme from ColorBrewer 2.0",[9294791,16777139,12499674,16482418,8434131,16626786,11787881,16567781,14277081,12353725,13429701,16772463]),"dark-2":(0,i.Q5)("Dark-2","qualitative","Dark2, categorical color scheme from ColorBrewer 2.0",[1810039,14245634,7696563,15149450,6727198,15117058,10909213,6710886]),paired:(0,i.Q5)("Paired","qualitative","Paired, categorical color scheme from ColorBrewer 2.0",[10931939,2062516,11722634,3383340,16489113,14883356,16629615,16744192,13284054,6962586,16777113,11622696]),"pastel-2":(0,i.Q5)("Pastel-2","qualitative","Pastel2, categorical color scheme from ColorBrewer 2.0",[11789005,16633260,13358568,16042724,15136201,16773806,15852236,13421772]),"pastel-1":(0,i.Q5)("Pastel-1","qualitative","Pastel1, categorical color scheme from ColorBrewer 2.0",[16495790,11783651,13429701,14601188,16701862,16777164,15063229,16636652,15921906]),turbo:(0,i.Q5)("Turbo","sequential","Turbo color scheme from D3.js, improved (smooth) rainbow colormap for visualization",[2299675,3547990,4337541,4799658,4934343,4872413,4613867,4289780,3900152,3510520,3120629,2796271,2602726,2474716,2477264,2611140,2875575,3270826,3731101,4387984,5109892,5897080,6815085,7798371,8781145,9829201,10811209,11858498,12774460,13755446,14605618,15389486,16042283,16563496,16757029,16753699,16750369,16746782,16743196,16608538,16146200,15487253,14763026,13973263,13052940,12198408,11344133,10621442,9965056,9571328,9440256]),"turbo-no-black":(0,i.Q5)("Turbo (no black)","sequential","Turbo color scheme from D3.js, improved (smooth) rainbow colormap for visualization, with black region removed",[4866485,4872413,4354034,3770361,3120629,2667241,2475736,2611140,3073454,3928216,5109892,6487408,8126047,9829201,11531332,13167162,14605618,15780908,16693543,16753699,16748063,16741916,16146200,15026195,13644558,12198408,10818563,9833728]),warm:(0,i.Q5)("Warm","sequential","Warm, sequential color scheme from D3.js",[7225514,7684013,8208303,8797873,9322162,9846195,10370483,10960051,11484338,12008625,12532911,13057452,13581737,14040742,14434210,14959005,15352473,15746196,16074382,16402824,16665475,16731772,16732790,16733808,16734826,16735843,16737117,16738135,16739409,16740939,16742471,16743746,16745277,16747065,16748598,16487987,16162097,15901743,15575598,15184174,14858031,14466608,14140466,13748788,13422648,13030972,12704833,12378438,12052044,11791187,11530331]),cool:(0,i.Q5)("Cool","sequential","Cool, sequential color scheme from D3.js",[7225514,7095217,6899639,6769597,6574275,6313160,6117837,5856977,5596117,5335513,5009115,4748510,4422368,4161761,3835361,3575009,3314401,3053791,2793438,2598363,2337752,2208213,2013137,1883340,1819335,1755074,1691068,1692086,1758640,1825706,1957795,2155164,2352790,2615695,2878601,3207042,3600764,3994230,4453489,4912492,5437031,5961315,6551391,7140956,7730778,8386136,8975703,9630807,10285911,10940761,11530331]),"cubehelix-default":(0,i.Q5)("CubehelixDefault","sequential","CubehelixDefault, sequential color scheme from D3.js",[0,525064,984594,1313308,1576742,1709360,1776697,1712705,1649479,1520715,1457486,1394254,1396557,1529674,1662534,2057794,2518076,3109175,3765555,4618288,5536047,6519343,7568178,8550967,9599551,10516809,11368789,12155235,12745329,13270146,13663891,13861539,13928371,13929921,13800654,13606106,13411811,13217514,12957935,12829170,12700403,12768243,12835826,13099761,13428976,13823727,14349039,14939888,15530483,16186616,16777215]),rainbow:(0,i.Q5)("Rainbow","cyclical","Rainbow, cyclical color scheme from D3.js",[7225514,8208303,9322162,10370483,11484338,12532911,13581737,14434210,15352473,16074382,16665475,16732790,16734826,16737117,16739409,16742471,16745277,16748598,16162097,15575598,14858031,14140466,13422648,12704833,12052044,11530331,10285911,8975703,7730777,6485855,5437031,4453489,3600764,2878601,2352790,1957795,1758896,1691068,1819335,2013137,2337752,2793438,3314401,3835617,4422368,5009115,5596117,6117837,6574275,6899639,7225514]),sinebow:(0,i.Q5)("Sinebow","cyclical","Sinebow, cyclical color scheme from D3.js",[16728128,16666162,16473382,16149788,15695122,15174923,14458117,13740802,12892928,11978752,10999043,9953287,8972813,7860757,6879262,5831722,4849463,3931972,3079507,2357858,1635442,1109378,648082,317858,118193,49087,111053,303833,561890,1081837,1602292,2319098,3036157,3884287,4798463,5778172,6823928,7804402,8916458,9897952,10945493,11927752,12845243,13697708,14419357,15141773,15667837,16129133,16459357,16659022,16728128]),"category-10":(0,i.Q5)("Category10","qualitative","Category10, categorical color scheme from D3.js / tab10 from Matplotlib (default in Matplotlib)",[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175]),"observable-10":(0,i.Q5)("Observable10","qualitative","Observable10, categorical color scheme from D3.js",[4352464,15708440,16740956,7128496,3975505,16747191,10773490,9944053,10251086,9738400]),"tableau-10":(0,i.Q5)("Tableau10","qualitative","Tableau10, categorical color scheme from D3.js",[5142951,15896108,14767961,7780274,5873999,15583561,11500193,16752039,10253663,12234923]),"simple-rainbow":(0,i.Q5)("Simple rainbow","sequential","Simple 5-color rainbow (blue-green-yellow-orange-red)",[3367393,3516485,16383744,15501073,12526114]),"red-white-blue":(0,i.Q5)("Red-White-Blue","diverging","Diverging color scheme with red-white-blue",[12526114,16777215,3367393]),"many-distinct":(0,i.Q5)("Many-Distinct","qualitative","Customized color scheme combining colors from multiple standard schemes (Dark2, Set1, Set2)",[1810039,14245634,7696563,15149450,6727198,15117058,10909213,6710886,14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607,10066329,6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947])},a=Object.keys(o).map(e=>[e,o[e].label,(0,r.ZH)(o[e].type),o[e].description]),s=a.filter(e=>"sequential"===o[e[0]].type||"diverging"===o[e[0]].type||"cyclical"===o[e[0]].type),l=a.filter(e=>"qualitative"===o[e[0]].type)
function c(e){return e in o?o[e]:(console.warn(`unknown color list named '${e}'`),o["red-yellow-blue"])}},2092(e,t,n){"use strict"
n.d(t,{I8:()=>u,Or:()=>r})
var r,i=n(32773),o=n(6941),a=n(81916)
function s(e,t){return(0,a.HR)(o.d3.Dictionary({0:(0,o.ef)(e)}),e,t)}function l(e,t){return(0,a.HR)(o.d3.List(e,{nonEmpty:!0}),e,t)}function c(e,t,n){return(0,a.HR)(o.d3.Dictionary({0:(0,o.ef)(e),1:(0,o.ef)(e)}),t,n)}!function(e){e.AnyVar=i.Z.Variable("a",i.Z.Any),e.AnyValueVar=i.Z.Variable("a",i.Z.Any),e.ConstrainedVar=i.Z.Variable("a",i.Z.Any,!0),e.Regex=i.Z.Value("Core","Regex"),e.Set=t=>i.Z.Container("Core","Set",t||e.AnyValueVar),e.List=t=>i.Z.Container("Core","List",t||e.AnyVar),e.Fn=(t,n)=>i.Z.Container("Core","Fn",t||e.AnyVar,n),e.Flags=(e,t)=>i.Z.Container("Core","Flags",e,t),e.BitFlags=e.Flags(i.Z.Num,"BitFlags")}(r||(r={})),o.d3.Dictionary({0:(0,o.ef)(i.Z.Num),1:(0,o.ef)(i.Z.Num)})
const u={"@header":"Language Primitives",type:{"@header":"Types",bool:(0,a.HR)(o.d3.Dictionary({0:(0,o.ef)(i.Z.AnyValue)}),i.Z.Bool,"Convert a value to boolean."),num:(0,a.HR)(o.d3.Dictionary({0:(0,o.ef)(i.Z.AnyValue)}),i.Z.Num,"Convert a value to number."),str:(0,a.HR)(o.d3.Dictionary({0:(0,o.ef)(i.Z.AnyValue)}),i.Z.Str,"Convert a value to string."),regex:(0,a.HR)(o.d3.Dictionary({0:(0,o.ef)(i.Z.Str,{description:"Expression"}),1:(0,o.ef)(i.Z.Str,{isOptional:!0,description:"Flags, e.g. 'i' for ignore case"})}),r.Regex,"Creates a regular expression from a string using the ECMAscript syntax."),list:(0,a.HR)(o.d3.List(r.AnyVar),r.List()),set:(0,a.HR)(o.d3.List(r.AnyValueVar),r.Set()),bitflags:(0,a.HR)(o.d3.Dictionary({0:(0,o.ef)(i.Z.Num)}),r.BitFlags,"Interpret a number as bitflags."),compositeKey:(0,a.HR)(o.d3.List(i.Z.AnyValue),i.Z.AnyValue)},logic:{"@header":"Logic",not:s(i.Z.Bool),and:l(i.Z.Bool),or:l(i.Z.Bool)},ctrl:{"@header":"Control",eval:(0,a.HR)(o.d3.Dictionary({0:(0,o.ef)(r.Fn(r.AnyVar))}),r.AnyVar,"Evaluate a function."),fn:(0,a.HR)(o.d3.Dictionary({0:(0,o.ef)(r.AnyVar)}),r.Fn(r.AnyVar),'Wrap an expression to a "lazy" function.'),if:(0,a.HR)(o.d3.Dictionary({0:(0,o.ef)(i.Z.Bool,{description:"Condition"}),1:(0,o.ef)(i.Z.Variable("a",i.Z.Any),{description:"If true"}),2:(0,o.ef)(i.Z.Variable("b",i.Z.Any),{description:"If false"})}),i.Z.Union([i.Z.Variable("a",i.Z.Any),i.Z.Variable("b",i.Z.Any)])),assoc:(0,a.HR)(o.d3.Dictionary({0:(0,o.ef)(i.Z.Str,{description:"Name"}),1:(0,o.ef)(i.Z.Variable("a",i.Z.Any),{description:"Value to assign"})}),i.Z.Variable("a",i.Z.Any))},rel:{"@header":"Relational",eq:c(i.Z.Variable("a",i.Z.AnyValue,!0),i.Z.Bool),neq:c(i.Z.Variable("a",i.Z.AnyValue,!0),i.Z.Bool),lt:c(i.Z.Num,i.Z.Bool),lte:c(i.Z.Num,i.Z.Bool),gr:c(i.Z.Num,i.Z.Bool),gre:c(i.Z.Num,i.Z.Bool),inRange:(0,a.HR)(o.d3.Dictionary({0:(0,o.ef)(i.Z.Num,{description:"Value to test"}),1:(0,o.ef)(i.Z.Num,{description:"Minimum value"}),2:(0,o.ef)(i.Z.Num,{description:"Maximum value"})}),i.Z.Bool,"Check if the value of the 1st argument is >= 2nd and <= 3rd.")},math:{"@header":"Math",add:l(i.Z.Num),sub:l(i.Z.Num),mult:l(i.Z.Num),div:c(i.Z.Num,i.Z.Num),pow:c(i.Z.Num,i.Z.Num),mod:c(i.Z.Num,i.Z.Num),min:l(i.Z.Num),max:l(i.Z.Num),cantorPairing:c(i.Z.Num,i.Z.Num),sortedCantorPairing:c(i.Z.Num,i.Z.Num),invertCantorPairing:(0,a.HR)(o.d3.Dictionary({0:(0,o.ef)(i.Z.Num)}),r.List(i.Z.Num)),floor:s(i.Z.Num),ceil:s(i.Z.Num),roundInt:s(i.Z.Num),trunc:s(i.Z.Num),abs:s(i.Z.Num),sign:s(i.Z.Num),sqrt:s(i.Z.Num),cbrt:s(i.Z.Num),sin:s(i.Z.Num),cos:s(i.Z.Num),tan:s(i.Z.Num),asin:s(i.Z.Num),acos:s(i.Z.Num),atan:s(i.Z.Num),sinh:s(i.Z.Num),cosh:s(i.Z.Num),tanh:s(i.Z.Num),exp:s(i.Z.Num),log:s(i.Z.Num),log10:s(i.Z.Num),atan2:c(i.Z.Num,i.Z.Num)},str:{"@header":"Strings",concat:l(i.Z.Str),match:(0,a.HR)(o.d3.Dictionary({0:(0,o.ef)(r.Regex),1:(0,o.ef)(i.Z.Str)}),i.Z.Bool)},list:{"@header":"Lists",getAt:(0,a.HR)(o.d3.Dictionary({0:(0,o.ef)(r.List()),1:(0,o.ef)(i.Z.Num)}),r.AnyVar),equal:(0,a.HR)(o.d3.Dictionary({0:(0,o.ef)(r.List()),1:(0,o.ef)(r.List())}),i.Z.Bool)},set:{"@header":"Sets",has:(0,a.HR)(o.d3.Dictionary({0:(0,o.ef)(r.Set(r.ConstrainedVar)),1:(0,o.ef)(r.ConstrainedVar)}),i.Z.Bool,"Check if the the 1st argument includes the value of the 2nd."),isSubset:(0,a.HR)(o.d3.Dictionary({0:(0,o.ef)(r.Set(r.ConstrainedVar)),1:(0,o.ef)(r.Set(r.ConstrainedVar))}),i.Z.Bool,"Check if the the 1st argument is a subset of the 2nd.")},flags:{"@header":"Flags",hasAny:(0,a.HR)(o.d3.Dictionary({0:(0,o.ef)(r.Flags(r.ConstrainedVar)),1:(0,o.ef)(r.Flags(r.ConstrainedVar))}),i.Z.Bool,"Check if the the 1st argument has at least one of the 2nd one's flags."),hasAll:(0,a.HR)(o.d3.Dictionary({0:(0,o.ef)(r.Flags(r.ConstrainedVar)),1:(0,o.ef)(r.Flags(r.ConstrainedVar))}),i.Z.Bool,"Check if the the 1st argument has all 2nd one's flags.")}};(0,a.ec)(u)
const d=(0,a.br)(u)
!function(){const e=Object.create(null)
for(const t of d)e[t.id]=t}()},2375(e,t,n){"use strict"
n.r(t),n.d(t,{CoordinatesFromDcd:()=>an,CoordinatesFromLammpstraj:()=>un,CoordinatesFromNctraj:()=>cn,CoordinatesFromTrr:()=>ln,CoordinatesFromXtc:()=>sn,CustomModelProperties:()=>Qn,CustomStructureProperties:()=>Xn,ModelFromTrajectory:()=>kn,ModelWithCoordinates:()=>Ln,MultiStructureSelectionFromBundle:()=>zn,MultiStructureSelectionFromExpression:()=>Fn,ShapeFromPly:()=>Yn,StructureComplexElement:()=>Hn,StructureComplexElementTypes:()=>Un,StructureComponent:()=>qn,StructureFromModel:()=>Mn,StructureFromTrajectory:()=>Dn,StructureInstances:()=>On,StructureSelectionFromBundle:()=>Vn,StructureSelectionFromExpression:()=>Nn,StructureSelectionFromScript:()=>jn,TopologyFromPrmtop:()=>pn,TopologyFromPsf:()=>dn,TopologyFromTop:()=>hn,TrajectoryFromBlob:()=>gn,TrajectoryFromCifCore:()=>Pn,TrajectoryFromCube:()=>In,TrajectoryFromGRO:()=>xn,TrajectoryFromLammpsData:()=>_n,TrajectoryFromLammpsTrajData:()=>Cn,TrajectoryFromMOL:()=>wn,TrajectoryFromMOL2:()=>An,TrajectoryFromMmCif:()=>vn,TrajectoryFromModelAndCoordinates:()=>mn,TrajectoryFromPDB:()=>bn,TrajectoryFromSDF:()=>Tn,TrajectoryFromXYZ:()=>Sn,TransformStructureConformation:()=>Rn,getTrajectory:()=>fn})
var r=n(10196),i=n(70292),o=n(94274),a=n(24762),s=n(10134),l=n(97016)
function c(e,t){return{tokenizer:e,header:{title:"",timeInPs:0,hasVelocities:!1,precision:{position:0,velocity:0},box:[0,0,0]},numberOfAtoms:0,runtimeCtx:t}}function u(e){const{tokenizer:t,header:n}=e
let r=s._F.readLine(t)
0===r.trim().length&&(r=s._F.readLine(t))
const i=r.lastIndexOf("t=")
i>=0?(n.timeInPs=parseFloat(r.substring(i+2)),n.title=r.substring(0,i).trim(),n.title&&","===n.title[n.title.length-1]&&(n.title=n.title.substring(0,n.title.length-1))):n.title=r}function d(e){const{tokenizer:t}=e
s._F.markLine(t)
const n=s._F.getTokenString(t)
e.numberOfAtoms=parseInt(n)}async function p(e){const{tokenizer:t,numberOfAtoms:n}=e,r=await s._F.readLinesAsync(t,n,e.runtimeCtx,1e5),i=t.data.substring(r.indices[0],r.indices[1]).substring(20).match(/\.\d+/g),o=6===i.length
e.header.hasVelocities=o,e.header.precision.position=i[0].length-1,e.header.precision.velocity=o?i[3].length-1:0
const c=e.header.precision.position+5,u=20+3*c,d=e.header.precision.velocity+4,p=function(e){return function(t,n,r){return function(e,t,n,r){const{data:i,indices:o,count:c}=e,{valueType:u}=r,d="str"===u?e=>{const r=o[2*e]+t,a=o[2*e+1]
if(r>=a)return""
let l=r+n
return l>a&&(l=a),(0,s.qk)(i,r,l)}:"int"===u?e=>{const r=o[2*e]+t
return r>o[2*e+1]?0:(0,l.jj)(i,r,r+n)}:e=>{const r=o[2*e]+t
return r>o[2*e+1]?0:(0,l.Al)(i,r,r+n)}
return{schema:r,__array:void 0,isDefined:!0,rowCount:c,value:d,valueKind:e=>a.VP.ValueKinds.Present,toArray:e=>a.iu.createAndFillArray(c,d,e),areValuesEqual:(e,t)=>d(e)===d(t)}}(e,t,n,r)}}(r),h=a.VP.Undefined(e.numberOfAtoms,a.VP.Schema.float)
return{count:e.numberOfAtoms,residueNumber:p(0,5,a.VP.Schema.int),residueName:p(5,5,a.VP.Schema.str),atomName:p(10,5,a.VP.Schema.str),atomNumber:p(15,5,a.VP.Schema.int),x:p(20,c,a.VP.Schema.float),y:p(20+c,c,a.VP.Schema.float),z:p(20+2*c,c,a.VP.Schema.float),vx:o?p(u,d,a.VP.Schema.float):h,vy:o?p(u+d,d,a.VP.Schema.float):h,vz:o?p(u+2*d,d,a.VP.Schema.float):h}}function h(e){const{tokenizer:t}=e,n=s._F.readLine(t).trim().split(/\s+/g)
e.header.box=[+n[0],+n[1],+n[2]]}var f=n(32775),m=n(54749),g=n(83794),y=n(10596),v=n(79111),b=n(70012),x=n(63356),S=n(92384),_=n(50709),C=n(95538),w=n(12288),T=n(80813)
function A(e){const t=e&&e.getElement("vertex"),n=e&&e.getElement("material"),r={group:"",vRed:"",vGreen:"",vBlue:"",mRed:"",mGreen:"",mBlue:""},i=[["",""]],o=[["",""]]
if(t){for(let e=0,n=t.propertyNames.length;e<n;++e){const n=t.propertyNames[e],r=t.propertyTypes[e]
"uchar"!==r&&"uint8"!==r&&"ushort"!==r&&"uint16"!==r&&"uint"!==r&&"uint32"!==r&&"int"!==r||i.push([n,n]),"uchar"!==r&&"uint8"!==r||o.push([n,n])}t.propertyNames.includes("atomid")?r.group="atomid":t.propertyNames.includes("material_index")&&(r.group="material_index"),t.propertyNames.includes("red")&&(r.vRed="red"),t.propertyNames.includes("green")&&(r.vGreen="green"),t.propertyNames.includes("blue")&&(r.vBlue="blue")}const a=[["",""]]
if(n){for(let e=0,t=n.propertyNames.length;e<t;++e){const t=n.propertyNames[e],r=n.propertyTypes[e]
"uchar"!==r&&"uint8"!==r||a.push([t,t])}n.propertyNames.includes("red")&&(r.mRed="red"),n.propertyNames.includes("green")&&(r.mGreen="green"),n.propertyNames.includes("blue")&&(r.mBlue="blue")}const s=r.vRed&&r.vGreen&&r.vBlue?"vertex":r.mRed&&r.mGreen&&r.mBlue?"material":"uniform"
return{...y.e.Params,coloring:S.t.MappedStatic(s,{vertex:S.t.Group({red:S.t.Select(r.vRed,o,{label:"Red Property"}),green:S.t.Select(r.vGreen,o,{label:"Green Property"}),blue:S.t.Select(r.vBlue,o,{label:"Blue Property"})},{isFlat:!0}),material:S.t.Group({red:S.t.Select(r.mRed,a,{label:"Red Property"}),green:S.t.Select(r.mGreen,a,{label:"Green Property"}),blue:S.t.Select(r.mBlue,a,{label:"Blue Property"})},{isFlat:!0}),uniform:S.t.Group({color:S.t.Color(_.ColorNames.grey),saturation:S.t.Numeric(0,{min:-6,max:6,step:.1}),lightness:S.t.Numeric(0,{min:-6,max:6,step:.1})},{isFlat:!0})}),grouping:S.t.MappedStatic(r.group?"vertex":"none",{vertex:S.t.Group({group:S.t.Select(r.group,i,{label:"Group Property"})},{isFlat:!0}),none:S.t.Group({})})}}const I=A()
function P(e,t,n,r,i){const{vertices:o,normals:a,groups:s}=n,l=r.getProperty("x"),c=r.getProperty("y"),u=r.getProperty("z")
if(!l||!c||!u)throw new Error("missing coordinate properties")
const d=r.getProperty("nx"),p=r.getProperty("ny"),h=r.getProperty("nz"),f=!!d&&!!p&&!!h
for(let m=e;m<t;++m)b.Gm.add3(o,l.value(m),c.value(m),u.value(m)),f&&b.Gm.add3(a,d.value(m),p.value(m),h.value(m)),b.Gm.add(s,i[m])}function B(e,t,n,r){const{indices:i}=n
for(let o=e;o<t;++o){const{entries:e,count:t}=r.value(o)
3===t?b.Gm.add3(i,e[0],e[1],e[2]):4===t&&(b.Gm.add3(i,e[2],e[1],e[0]),b.Gm.add3(i,e[2],e[0],e[3]))}}const E=a.VP.Schema.int
function k(e,t,n){const{coloring:r}=n,{rowCount:i}=e
let o,s,l
if("vertex"===r.name)o=e.getProperty(r.params.red)||a.VP.ofConst(127,i,E),s=e.getProperty(r.params.green)||a.VP.ofConst(127,i,E),l=e.getProperty(r.params.blue)||a.VP.ofConst(127,i,E)
else if("material"===r.name)o=t&&t.getProperty(r.params.red)||a.VP.ofConst(127,i,E),s=t&&t.getProperty(r.params.green)||a.VP.ofConst(127,i,E),l=t&&t.getProperty(r.params.blue)||a.VP.ofConst(127,i,E)
else{let e=r.params.color
e=m.Color.saturate(e,r.params.saturation),e=m.Color.lighten(e,r.params.lightness)
const[t,n,c]=m.Color.toRgb(e)
o=a.VP.ofConst(t,i,E),s=a.VP.ofConst(n,i,E),l=a.VP.ofConst(c,i,E)}return{kind:r.name,red:o,green:s,blue:l}}function D(e,t,n,r){const{kind:i,red:o,green:a,blue:s}=n,{ids:l,map:c,label:u}=r,{source:d,transforms:p}=e
return v.y.create("ply-mesh",d,t,e=>{const t="material"===i?e:c[e]
return m.Color.fromRgb(o.value(t),a.value(t),s.value(t))},()=>1,e=>`${u} ${l[e]}`,p)}function M(){let e,t,n,r,i,o
return async(a,s,l,c)=>{const u=s.source.getElement("vertex")
if(!u)throw new Error("missing vertex element")
const d=s.source.getElement("face")
if(!d)throw new Error("missing face element")
const p=s.source.getElement("material")
let h=!1,f=!1
return e&&e===s||(h=!0),t&&S.t.isParamEqual(I.grouping,t.grouping,l.grouping)||(h=!0),t&&S.t.isParamEqual(I.coloring,t.coloring,l.coloring)||(f=!0),h?(i=k(u,p,l),o=function(e,t){const{grouping:n}=t,{rowCount:r}=e,i="vertex"===n.name?e.getProperty(n.params.group):void 0,o="vertex"===n.name?(0,w.Mk)(n.params.group):"Vertex",a=i?i.toArray({array:Uint32Array}):(0,x.WE)(new Uint32Array(r)),s=i?(0,x._M)(a):r-1,l=new Uint32Array(s+1)
for(let c=0,u=a.length;c<u;++c)l[a[c]]=c
return{ids:a,map:l,label:o}}(u,l),r=await async function(e,t,n,r,i){const o=g.P.createState(t.rowCount,t.rowCount/4,i),a=t.getProperty("x"),s=t.getProperty("y"),l=t.getProperty("z")
if(!a||!s||!l)throw new Error("missing coordinate properties")
const c=t.getProperty("nx"),u=t.getProperty("ny"),d=t.getProperty("nz"),p=!!c&&!!u&&!!d,h=1e5
for(let m=0,g=t.rowCount;m<g;m+=h)P(m,Math.min(m+h,g),o,t,r),e.shouldUpdate&&await e.update({message:"adding ply mesh vertices",current:m,max:g})
for(let m=0,g=n.rowCount;m<g;m+=h)B(m,Math.min(m+h,g),o,n),e.shouldUpdate&&await e.update({message:"adding ply mesh faces",current:m,max:g})
const f=g.P.getMesh(o)
return p||y.e.computeNormals(f),T.IQ.updateIfChanged(f.varyingGroup,!0),f}(a,u,d,o.ids,c&&c.geometry),n=D(s,r,i,o)):f&&(i=k(u,p,l),n=D(s,r,i,o)),e=s,t=(0,C.Go)(l),n}}var R=n(1496),O=n(87423)
function L(){return L.empty()}!function(e){function t(e,t){return{size:e,anglesInRadians:t}}function n(){return t((0,f.eB)(),(0,f.eB)())}e.create=t,e.empty=n,e.fromBasis=function(e,r,i){const o=f.eB.magnitude(e),a=f.eB.magnitude(r),s=f.eB.magnitude(i),l=Math.acos(f.eB.dot(r,i)/(a*s)),c=Math.acos(f.eB.dot(e,i)/(o*s)),u=Math.acos(f.eB.dot(e,r)/(o*a))
return o<=0||a<=0||s<=0||l>=Math.PI||c>=Math.PI||u>=Math.PI?n():t(f.eB.create(o,a,s),f.eB.create(l,c,u))}}(L||(L={}))
var N=n(23325)
function F(e,t,n,r){let i=n,o=r-1,a=t.charCodeAt(i)
for(;(32===a||a>=48&&a<=57)&&i<=o;)a=t.charCodeAt(++i)
for(a=t.charCodeAt(o);(32===a||a>=48&&a<=57)&&o>=i;)a=t.charCodeAt(--o)
if(++o,i===o)return s.tM.add(e,i,o)
if(i+1===o)return s.tM.add(e,i,o)
if(a=t.charCodeAt(i),i+2===o){const n=t.charCodeAt(i+1)
if(!((78!==a&&110!==a||65!==n&&97!==n)&&(67!==a&&99!==a||76!==n&&108!==n)&&(70!==a&&102!==a||69!==n&&101!==n)&&(83!==a&&115!==a||73!==n&&105!==n)&&(66!==a&&98!==a||82!==n&&114!==n)&&(65!==a&&97!==a||83!==n&&115!==n)))return s.tM.add(e,i,i+2)}if(67===a||99===a||72===a||104===a||78===a||110===a||79===a||111===a||80===a||112===a||83===a||115===a)return s.tM.add(e,i,i+1)
s.tM.add(e,i,i)}const z=new Set(["NA","CL","FE","SI","BR","AS","LI"]),j=new Set(["C","H","N","O","P","S","F","B"]),V=/^[\s\d]+|[\s\d]+$/g
function U(e,t){const n=(e=e.replace(V,"").toUpperCase()).length
if(0===n)return e
if(1===n)return e
if(z.has(e))return e
if(3===n&&t===e){if("SOD"===e)return"NA"
if("POT"===e)return"K"
if("CES"===e)return"CS"
if("CAL"===e)return"CA"
if("CLA"===e)return"CL"}return j.has(e[0])?e[0]:""}var G=n(87095),H=n(7808),q=n(28269)
const Q="ABCDEFGHIJKLMNOPQRSTUVWXYZ",$=(0,q.E)(function(e){let t=e,n=0,r=Q[t%26]
for(;t>=26;)t=Math.floor(t/26),r+=Q[t%26],n+=1
return n>=5&&console.warn("getChainId overflow"),r})
var X,W=n(12372),Y=n(29472),Z=n(23968),K=n(94603)
function J(e,t){const n=e.atomName,r=e.residueName,i=new Array(e.count),o=new Array(e.count),s=new Uint32Array(e.count),l=new Uint32Array(e.count),c=new Array(e.count),u=new W.V,d=new H.N(e.residueNumber,e.atomName)
let p="",h=0,f="",m=0,g=G.MoleculeType.Unknown,y=-1
for(let a=0,x=e.count;a<x;++a){const t=e.residueNumber.value(a)
if(t!==y){const n=e.residueName.value(a),r=(0,G.getMoleculeType)(d.add(n,a).type,n)
r===g&&(t===y+1||99999===y&&0===t)||(f=$(h),h+=1,m=0),p=u.getEntityId(n,r,f),m+=1,y=t,g=r}i[a]=p,o[a]=f,s[a]=m,l[a]=a,c[a]=U(e.atomName.value(a),e.residueName.value(a))}const v=a.VP.ofStringArray(o),b=a.XI.ofPartialColumns(Y.e.atom_site,{auth_asym_id:v,auth_atom_id:n,auth_comp_id:r,auth_seq_id:e.residueNumber,Cartn_x:a.VP.ofFloatArray(a.VP.mapToArray(e.x,e=>10*e,Float32Array)),Cartn_y:a.VP.ofFloatArray(a.VP.mapToArray(e.y,e=>10*e,Float32Array)),Cartn_z:a.VP.ofFloatArray(a.VP.mapToArray(e.z,e=>10*e,Float32Array)),id:a.VP.ofIntArray(l),label_asym_id:v,label_atom_id:n,label_comp_id:r,label_seq_id:a.VP.ofIntArray(s),label_entity_id:a.VP.ofStringArray(i),occupancy:a.VP.ofConst(1,e.count,a.VP.Schema.float),type_symbol:a.VP.ofStringArray(c),pdbx_PDB_model_num:a.VP.ofConst(t,e.count,a.VP.Schema.int)},e.count)
return(0,Y.z)({entity:u.getEntityTable(),chem_comp:d.getChemCompTable(),atom_site:b})}!function(e){e.is=function(e){return"gro"===(null==e?void 0:e.kind)},e.fromGro=function(e){return{kind:"gro",name:e.structures[0].header.title,data:e}}}(X||(X={}))
var ee=n(717),te=n(89748)
function ne(e,t){const n=(e,n)=>(t.substr(e,n)||"").trim(),r={entry_id:te.RF.ofString(e),length_a:te.RF.ofString(n(6,9)),length_b:te.RF.ofString(n(15,9)),length_c:te.RF.ofString(n(24,9)),angle_alpha:te.RF.ofString(n(33,7)),angle_beta:te.RF.ofString(n(40,7)),angle_gamma:te.RF.ofString(n(47,7)),Z_PDB:te.RF.ofString(n(66,4)),pdbx_unique_axis:te.RF.ofString("?")},i={entry_id:te.RF.ofString(e),"space_group_name_H-M":te.RF.ofString(n(55,11)),Int_Tables_number:te.RF.ofString("?"),cell_setting:te.RF.ofString("?"),space_group_name_Hall:te.RF.ofString("?")}
return[te.xA.ofFields("cell",r),te.xA.ofFields("symmetry",i)]}function re(e,t){return{id:e,details:t,groups:[]}}function ie(e,t,n){const r=[]
let i,o,a,s=1,l=1
const c=t=>e.data.substring(e.indices[2*t],e.indices[2*t+1])
for(let g=t;g<n;g++){let e=c(g)
if("BIOMOLECULE:"===e.substr(11,12)){const t=e.substr(23).trim()
let n=`Biomolecule ${t}`
e=c(g+1),"APPLY THE FOLLOWING TO CHAINS:"!==e.substr(11,30)&&(g++,n=e.substr(11).trim()),i=re(t,n),r.push(i)}else if("BIOMT"===e.substr(13,5)){const t=e.split(/\s+/),n=parseInt(e[18])-1
0===n&&(a=f.$I.identity(),o.operators.push({id:s++,matrix:a})),f.$I.setValue(a,n,0,parseFloat(t[4])),f.$I.setValue(a,n,1,parseFloat(t[5])),f.$I.setValue(a,n,2,parseFloat(t[6])),f.$I.setValue(a,n,3,parseFloat(t[7]))}else if("APPLY THE FOLLOWING TO CHAINS:"===e.substr(11,30)||"                   AND CHAINS:"===e.substr(11,30)){"APPLY"===e.substr(11,5)&&(o={chains:[],operators:[]},i.groups.push(o))
const t=e.substr(41,30).split(",")
for(let e=0,n=t.length;e<n;++e){const n=t[e].trim()
n&&o.chains.push(n)}}else if("APPLYING THE FOLLOWING TO CHAINS:"===e.substr(11,33)){i=re(`${l}`,`Biomolecule ${l}`),r.push(i),l+=1,o={chains:[],operators:[]},i.groups.push(o),g++,e=c(g)
const t=e.substr(11,69).split(",")
for(let e=0,n=t.length;e<n;++e){const n=t[e].trim()
n&&o.chains.push(n)}}}if(0===r.length)return[]
const u={id:te.RF.ofStrings(r.map(e=>e.id)),details:te.RF.ofStrings(r.map(e=>e.details))},d=[]
for(const f of r)for(const e of f.groups)d.push({assembly_id:f.id,oper_expression:e.operators.map(e=>e.id).join(","),asym_id_list:e.chains.join(",")})
const p={assembly_id:te.RF.ofStrings(d.map(e=>e.assembly_id)),oper_expression:te.RF.ofStrings(d.map(e=>e.oper_expression)),asym_id_list:te.RF.ofStrings(d.map(e=>e.asym_id_list))},h=[]
for(const g of r)for(const e of g.groups)for(const t of e.operators){const e={id:""+t.id,type:"?",name:"?",symmetry_operation:"?"}
for(let n=0;n<3;n++){for(let r=0;r<3;r++)e[`matrix[${n+1}][${r+1}]`]=""+f.$I.getValue(t.matrix,n,r)
e[`vector[${n+1}]`]=""+f.$I.getValue(t.matrix,n,3)}h.push(e)}const m={id:te.RF.ofStrings(h.map(e=>e.id)),type:te.RF.ofStrings(h.map(e=>e.type)),name:te.RF.ofStrings(h.map(e=>e.name)),symmetry_operation:te.RF.ofStrings(h.map(e=>e.symmetry_operation))}
for(let f=0;f<3;f++){for(let t=0;t<3;t++){const e=`matrix[${f+1}][${t+1}]`
m[e]=te.RF.ofStrings(h.map(t=>t[e]))}const e=`vector[${f+1}]`
m[e]=te.RF.ofStrings(h.map(t=>t[e]))}return[te.xA.ofFields("pdbx_struct_assembly",u),te.xA.ofFields("pdbx_struct_assembly_gen",p),te.xA.ofFields("pdbx_struct_oper_list",m)]}function oe(e,t,n){const r=[]
let i
const o=t=>e.data.substring(e.indices[2*t],e.indices[2*t+1])
for(let c=t;c<n;c++){const e=o(c),t=e.split(/\s+/),n=parseInt(e[5])-1
0===n&&(i=f.$I.identity(),r.push(i)),f.$I.setValue(i,n,0,parseFloat(t[2])),f.$I.setValue(i,n,1,parseFloat(t[3])),f.$I.setValue(i,n,2,parseFloat(t[4])),f.$I.setValue(i,n,3,parseFloat(t[5]))}if(0===r.length)return[]
const a=[]
let s=1
for(const c of r){const e={id:"ncsop"+s++,code:".",details:"."}
for(let t=0;t<3;t++){for(let n=0;n<3;n++)e[`matrix[${t+1}][${n+1}]`]=""+f.$I.getValue(c,t,n)
e[`vector[${t+1}]`]=""+f.$I.getValue(c,t,3)}a.push(e)}const l={id:te.RF.ofStrings(a.map(e=>e.id)),code:te.RF.ofStrings(a.map(e=>e.code)),details:te.RF.ofStrings(a.map(e=>e.details))}
for(let c=0;c<3;c++){for(let t=0;t<3;t++){const e=`matrix[${c+1}][${t+1}]`
l[e]=te.RF.ofStrings(a.map(t=>t[e]))}const e=`vector[${c+1}]`
l[e]=te.RF.ofStrings(a.map(t=>t[e]))}return[te.xA.ofFields("struct_ncs_oper",l)]}const ae={1:"helx_rh_al_p",2:"helx_rh_om_p",3:"helx_rh_pi_p",4:"helx_rh_ga_p",5:"helx_rh_3t_p",6:"helx_lh_al_p",7:"helx_lh_om_p",8:"helx_lh_ga_p",9:"helx_rh_27_p",10:"helx_rh_pp_p"}
function se(e,t,n){const r=[],i=t=>e.data.substring(e.indices[2*t],e.indices[2*t+1])
for(let a=t;a<n;a++){const e=i(a)
r.push({serNum:e.substring(7,10).trim(),helixID:e.substring(11,14).trim(),initResName:e.substring(15,19).trim(),initChainID:e.substring(19,20).trim(),initSeqNum:e.substring(21,25).trim(),initICode:e.substring(25,26).trim(),endResName:e.substring(27,31).trim(),endChainID:e.substring(31,34).trim(),endSeqNum:e.substring(33,37).trim(),endICode:e.substring(37,38).trim(),helixClass:e.substring(38,40).trim(),comment:e.substring(40,70).trim(),length:e.substring(71,76).trim()})}const o=te.RF.ofStrings(r.map(e=>e.initChainID)),s=te.RF.ofStrings(r.map(e=>e.initResName)),l=te.RF.ofStrings(r.map(e=>e.endChainID)),c=te.RF.ofStrings(r.map(e=>e.endResName)),u={beg_label_asym_id:o,beg_label_comp_id:s,beg_label_seq_id:te.RF.ofUndefined(r.length,a.VP.Schema.int),beg_auth_asym_id:o,beg_auth_comp_id:s,beg_auth_seq_id:te.RF.ofStrings(r.map(e=>e.initSeqNum)),conf_type_id:te.RF.ofStrings(r.map(e=>{return t=e.helixClass,ae[t]||"helx_p"
var t})),details:te.RF.ofStrings(r.map(e=>e.comment)),end_label_asym_id:l,end_label_comp_id:c,end_label_seq_id:te.RF.ofUndefined(r.length,a.VP.Schema.int),end_auth_asym_id:l,end_auth_comp_id:c,end_auth_seq_id:te.RF.ofStrings(r.map(e=>e.endSeqNum)),id:te.RF.ofStrings(r.map(e=>e.serNum)),pdbx_beg_PDB_ins_code:te.RF.ofStrings(r.map(e=>e.initICode)),pdbx_end_PDB_ins_code:te.RF.ofStrings(r.map(e=>e.endICode)),pdbx_PDB_helix_class:te.RF.ofStrings(r.map(e=>e.helixClass)),pdbx_PDB_helix_length:te.RF.ofStrings(r.map(e=>e.length)),pdbx_PDB_helix_id:te.RF.ofStrings(r.map(e=>e.helixID))}
return te.xA.ofFields("struct_conf",u)}function le(e,t,n){const r=[],i=t=>e.data.substring(e.indices[2*t],e.indices[2*t+1])
for(let p=t;p<n;p++){const e=i(p)
r.push({strand:e.substring(7,10).trim(),sheetID:e.substring(11,14).trim(),numStrands:e.substring(14,16).trim(),initResName:e.substring(17,21).trim(),initChainID:e.substring(21,22).trim(),initSeqNum:e.substring(22,26).trim(),initICode:e.substring(26,27).trim(),endResName:e.substring(28,32).trim(),endChainID:e.substring(32,33).trim(),endSeqNum:e.substring(33,37).trim(),endICode:e.substring(37,38).trim(),sense:e.substring(38,40).trim(),curAtom:e.substring(41,45).trim(),curResName:e.substring(45,49).trim(),curChainId:e.substring(49,50).trim(),curResSeq:e.substring(50,54).trim(),curICode:e.substring(54,55).trim(),prevAtom:e.substring(56,60).trim(),prevResName:e.substring(60,64).trim(),prevChainId:e.substring(64,65).trim(),prevResSeq:e.substring(65,69).trim(),prevICode:e.substring(69,70).trim()})}const o=te.RF.ofStrings(r.map(e=>e.initChainID)),a=te.RF.ofStrings(r.map(e=>e.initResName)),s=te.RF.ofStrings(r.map(e=>e.initSeqNum)),l=te.RF.ofStrings(r.map(e=>e.endChainID)),c=te.RF.ofStrings(r.map(e=>e.endResName)),u=te.RF.ofStrings(r.map(e=>e.endSeqNum)),d={beg_label_asym_id:o,beg_label_comp_id:a,beg_label_seq_id:s,beg_auth_asym_id:o,beg_auth_comp_id:a,beg_auth_seq_id:s,end_label_asym_id:l,end_label_comp_id:l,end_label_seq_id:u,end_auth_asym_id:l,end_auth_comp_id:c,end_auth_seq_id:u,id:te.RF.ofStrings(r.map(e=>e.strand)),sheet_id:te.RF.ofStrings(r.map(e=>e.sheetID)),pdbx_beg_PDB_ins_code:te.RF.ofStrings(r.map(e=>e.initICode)),pdbx_end_PDB_ins_code:te.RF.ofStrings(r.map(e=>e.endICode))}
return te.xA.ofFields("struct_sheet_range",d)}const ce={MOL_ID:"",MOLECULE:"",CHAIN:"",FRAGMENT:"",SYNONYM:"",EC:"",ENGINEERED:"",MUTATION:"",OTHER_DETAILS:""}
function ue(e,t,n){const r=t=>e.data.substring(e.indices[2*t],e.indices[2*t+1])
let i,o={chains:[],description:""}
const a=[]
for(let l=t;l<n;l++){const e=r(l).substr(10,70).trim(),t=e.indexOf(":"),n=e.substring(0,t)
let s
n in ce?(i=n,s=e.substring(t+2)):s=e,s=s.replace(/;$/,""),"MOL_ID"===i?(o={chains:[],description:""},a.push(o)):"MOLECULE"===i?(o.description&&(o.description+=" "),o.description+=s):"CHAIN"===i&&Array.prototype.push.apply(o.chains,s.split(/\s*,\s*/))}const s=[]
for(const l of a)for(const e of l.chains)s.push({description:l.description,chains:[e]})
return s}function de(e,t,n){const r=t=>e.data.substring(e.indices[2*t],e.indices[2*t+1]),i=new Map
for(let o=t;o<n;o++){const e=r(o),t=e.substr(11,3).trim(),n=e.substr(15).trim()
i.has(t)?i.set(t,`${i.get(t)} ${n}`):i.set(t,n)}return i}var pe=n(96883)
class he{constructor(e,t,n,r){this.asymIds=e,this.modelNums=t,this.terIndices=n,this.hasAssemblies=r,this.asymIdCounts=new Map,this.currModelNum=void 0,this.currAsymId="",this.currLabelAsymId=""}clear(){this.asymIdCounts.clear(),this.currModelNum=void 0}get(e){const t=this.asymIds.value(e)
if(this.hasAssemblies)return t
const n=this.modelNums[e]
if(n!==this.currModelNum?(this.asymIdCounts.clear(),this.currModelNum=n,this.currLabelAsymId=t):this.currAsymId!==t&&(this.currAsymId=t,this.currLabelAsymId=t),this.asymIdCounts.has(t)){if(this.terIndices.has(e)){const e=this.asymIdCounts.get(t)+1
this.asymIdCounts.set(t,e),this.currLabelAsymId=`${t}_${e}`}}else this.asymIdCounts.set(t,0)
return this.currLabelAsymId}}function fe(e,t,n,r,i,o){const{data:a}=n,l=i-r
s.tM.addToken(e.group_PDB,s._F.trim(n,r,r+6)),s._F.trim(n,r+6,r+11),e.id[e.index]=n.data.substring(n.tokenStart,n.tokenEnd),s.tM.addToken(e.auth_atom_id,s._F.trim(n,r+12,r+16)),32===a.charCodeAt(r+16)?s.tM.add(e.label_alt_id,0,0):s.tM.add(e.label_alt_id,r+16,r+17),s.tM.addToken(e.auth_comp_id,s._F.trim(n,r+17,r+21)),s.tM.add(e.auth_asym_id,r+21,r+22),s.tM.addToken(e.auth_seq_id,s._F.trim(n,r+22,r+26)),32===a.charCodeAt(r+26)?s.tM.add(e.pdbx_PDB_ins_code,0,0):s.tM.add(e.pdbx_PDB_ins_code,r+26,r+27),s.tM.addToken(e.Cartn_x,s._F.trim(n,r+30,r+38)),s.tM.addToken(e.Cartn_y,s._F.trim(n,r+38,r+46)),s.tM.addToken(e.Cartn_z,s._F.trim(n,r+46,r+54)),s.tM.addToken(e.occupancy,s._F.trim(n,r+54,r+60)),l>=66?s.tM.addToken(e.B_iso_or_equiv,s._F.trim(n,r+60,r+66)):s.tM.add(e.B_iso_or_equiv,0,0),o&&s.tM.addToken(e.partial_charge,s._F.trim(n,r+70,r+76)),l>=78&&!o?(s._F.trim(n,r+76,r+78),n.tokenStart<n.tokenEnd?s.tM.addToken(e.type_symbol,n):F(e.type_symbol,a,r+12,r+16)):F(e.type_symbol,a,r+12,r+16),e.pdbx_PDB_model_num[e.index]=t,e.index++}function me(e){const t=te.RF.ofTokens(e.pdbx_auth_seq_id),n=te.RF.ofTokens(e.pdbx_auth_comp_id),r=te.RF.ofTokens(e.pdbx_auth_asym_id),i=te.RF.ofTokens(e.pdbx_auth_atom_id),o={id:te.RF.ofStrings(e.id),type_symbol:te.RF.ofTokens(e.type_symbol),pdbx_label_atom_id:i,pdbx_label_alt_id:te.RF.ofTokens(e.pdbx_label_alt_id),pdbx_label_comp_id:n,pdbx_label_asym_id:r,pdbx_label_seq_id:t,pdbx_PDB_ins_code:te.RF.ofTokens(e.pdbx_PDB_ins_code),pdbx_auth_seq_id:t,pdbx_auth_comp_id:n,pdbx_auth_asym_id:r,pdbx_auth_atom_id:i}
return o["U[1][1]"]=te.RF.ofNumbers(e["U[1][1]"]),o["U[2][2]"]=te.RF.ofNumbers(e["U[2][2]"]),o["U[3][3]"]=te.RF.ofNumbers(e["U[3][3]"]),o["U[1][2]"]=te.RF.ofNumbers(e["U[1][2]"]),o["U[1][3]"]=te.RF.ofNumbers(e["U[1][3]"]),o["U[2][3]"]=te.RF.ofNumbers(e["U[2][3]"]),o}function ge(e,t,n,r,i){const{data:o}=n,a=i-r
s._F.trim(n,r+6,r+11),e.id[e.index]=o.substring(n.tokenStart,n.tokenEnd),s.tM.addToken(e.pdbx_auth_atom_id,s._F.trim(n,r+12,r+16)),32===o.charCodeAt(r+16)?s.tM.add(e.pdbx_label_alt_id,0,0):s.tM.add(e.pdbx_label_alt_id,r+16,r+17),s.tM.addToken(e.pdbx_auth_comp_id,s._F.trim(n,r+17,r+21)),s.tM.add(e.pdbx_auth_asym_id,r+21,r+22),s.tM.addToken(e.pdbx_auth_seq_id,s._F.trim(n,r+22,r+26)),32===o.charCodeAt(r+26)?s.tM.add(e.pdbx_PDB_ins_code,0,0):s.tM.add(e.pdbx_PDB_ins_code,r+26,r+27),e["U[1][1]"][e.index]=(0,l.jj)(o,r+28,r+35)/1e4,e["U[2][2]"][e.index]=(0,l.jj)(o,r+35,r+42)/1e4,e["U[3][3]"][e.index]=(0,l.jj)(o,r+42,r+49)/1e4,e["U[1][2]"][e.index]=(0,l.jj)(o,r+49,r+56)/1e4,e["U[1][3]"][e.index]=(0,l.jj)(o,r+56,r+63)/1e4,e["U[2][3]"][e.index]=(0,l.jj)(o,r+63,r+70)/1e4,a>=78?(s._F.trim(n,r+76,r+78),n.tokenStart<n.tokenEnd?s.tM.addToken(e.type_symbol,n):F(e.type_symbol,o,r+12,r+16)):F(e.type_symbol,o,r+12,r+16),e.index++}var ye=n(5638)
function ve(e,t,n,r){const i=e.substring(t,n)
r.id_code=i.substring(62,66).trim()||void 0,r.dep_date=i.substring(50,59).trim()||void 0,r.classification=i.substring(10,50).trim()||void 0}function be(e,t,n,r){const i=r.length
if(i>n-t)return!1
for(let o=0;o<i;o++)if(e.charCodeAt(t+o)!==r.charCodeAt(o))return!1
return!0}async function xe(e){const{lines:t}=e,{data:n,indices:r}=t,i=(0,s._F)(n),o=!!e.isPdbqt
let l=0,c=0
for(let a=0,s=t.count;a<s;a++){const e=r[2*a],t=r[2*a+1]
switch(n.charAt(e)){case"A":be(n,e,t,"ATOM  ")?l++:be(n,e,t,"ANISOU")&&c++
break
case"H":be(n,e,t,"HETATM")&&l++}}const u={},d=function(e,t){const n=()=>s.tM.create(e,2*t)
return{index:0,group_PDB:n(),id:[],auth_atom_id:n(),label_alt_id:n(),auth_comp_id:n(),auth_asym_id:n(),auth_seq_id:n(),pdbx_PDB_ins_code:n(),Cartn_x:n(),Cartn_y:n(),Cartn_z:n(),occupancy:n(),B_iso_or_equiv:n(),type_symbol:n(),pdbx_PDB_model_num:[],label_entity_id:[],partial_charge:n()}}(n,l),p=function(e,t){const n=()=>new Float32Array(t),r=()=>s.tM.create(e,2*t)
return{index:0,count:t,id:[],type_symbol:r(),pdbx_label_atom_id:r(),pdbx_label_alt_id:r(),pdbx_label_comp_id:r(),pdbx_label_asym_id:r(),pdbx_label_seq_id:r(),pdbx_PDB_ins_code:r(),"U[1][1]":n(),"U[2][2]":n(),"U[3][3]":n(),"U[1][2]":n(),"U[1][3]":n(),"U[2][3]":n(),pdbx_auth_seq_id:r(),pdbx_auth_comp_id:r(),pdbx_auth_asym_id:r(),pdbx_auth_atom_id:r()}}(n,c),h=new W.V,f=[],m=[]
let g,y=0,v="",b=!1
const x=new Set
for(let a=0,s=t.count;a<s;a++){let s=r[2*a],l=r[2*a+1]
switch(n.charAt(s)){case"A":be(n,s,l,"ATOM  ")?(y||(y++,v=""+y),fe(d,v,i,s,l,o)):be(n,s,l,"ANISOU")&&ge(p,0,i,s,l)
break
case"C":if(be(n,s,l,"CRYST1"))f.push(...ne(e.id||"?",n.substring(s,l)))
else if(be(n,s,l,"CONECT")){let e=a+1
for(;s=r[2*e],l=r[2*e+1],be(n,s,l,"CONECT");)e++
g?ye.Bb&&console.log("only single CONECT block allowed, ignoring others"):g=[a,e],a=e-1}else if(be(n,s,l,"COMPND")){let e=a+1
for(;s=r[2*e],l=r[2*e+1],be(n,s,l,"COMPND");)e++
h.setCompounds(ue(t,a,e)),a=e-1}break
case"H":if(be(n,s,l,"HEADER"))ve(n,s,l,u)
else if(be(n,s,l,"HETATM"))y||(y++,v=""+y),fe(d,v,i,s,l,o)
else if(be(n,s,l,"HELIX")){let e=a+1
for(;s=r[2*e],l=r[2*e+1],be(n,s,l,"HELIX");)e++
f.push(se(t,a,e)),a=e-1}else if(be(n,s,l,"HETNAM")){let e=a+1
for(;s=r[2*e],l=r[2*e+1],be(n,s,l,"HETNAM");)e++
m.push(...Array.from(de(t,a,e).entries())),a=e-1}break
case"M":if(be(n,s,l,"MODEL ")&&(y++,v=""+y),be(n,s,l,"MTRIX")){let e=a+1
for(;s=r[2*e],l=r[2*e+1],be(n,s,l,"MTRIX");)e++
f.push(...oe(t,a,e)),a=e-1}break
case"O":break
case"R":if(be(n,s,l,"REMARK 350")){let e=a+1
for(;s=r[2*e],l=r[2*e+1],be(n,s,l,"REMARK 350");)e++
f.push(...ie(t,a,e)),a=e-1,b=!0}break
case"S":if(be(n,s,l,"SHEET")){let e=a+1
for(;s=r[2*e],l=r[2*e+1],be(n,s,l,"SHEET");)e++
f.push(le(t,a,e)),a=e-1}break
case"T":be(n,s,l,"TER")&&x.add(d.index)}}if(u.id_code){const e={id:te.RF.ofString(u.id_code)}
f.push(te.xA.ofFields("entry",e))}if(u.classification){const e={pdbx_keywords:te.RF.ofString(u.classification)}
f.push(te.xA.ofFields("struct_keywords",e))}if(u.dep_date){const e={recvd_initial_deposition_date:te.RF.ofString(u.dep_date)}
f.push(te.xA.ofFields("pdbx_database_status",e))}const S=a.VP.ofIntTokens(d.auth_seq_id),_=a.VP.ofStringTokens(d.auth_atom_id),C=a.VP.ofStringTokens(d.auth_comp_id),w=a.VP.ofStringTokens(d.auth_asym_id),T=new he(w,d.pdbx_PDB_model_num,x,b),A=new H.N(S,_)
A.setNames(m),h.setNames(m)
for(let a=0,s=C.rowCount;a<s;++a){const e=C.value(a),t=(0,G.getMoleculeType)(A.add(e,a).type,e),n=T.get(a)
d.label_entity_id[a]=h.getEntityId(e,t,n)}const I=function(e,t){t.clear()
const n=te.RF.ofStrings(e.pdbx_PDB_model_num),r=te.RF.ofTokens(e.auth_asym_id),i=te.RF.ofTokens(e.auth_seq_id),o=te.RF.ofTokens(e.pdbx_PDB_ins_code),s=te.RF.ofTokens(e.auth_atom_id),l=te.RF.ofTokens(e.auth_comp_id),c=te.RF.ofStrings(e.id)
let u=n.str(0),d=r.str(0),p=i.int(0),h=o.str(0),f=p
const m=new Map,g=new Map,y=[],v=[],b=[]
let x=!1
for(let a=0,w=c.rowCount;a<w;++a)if(""!==o.str(a)){x=!0
break}for(let a=0,w=c.rowCount;a<w;++a){const e=n.str(a),l=r.str(a),c=i.int(a),S=o.str(a)
let _=s.str(a)
if(e!==u?(m.clear(),g.clear(),u=e,d=l,p=c,h=S,f=c):d!==l?(g.clear(),d=l,p=c,h=S,f=c):p!==c?(g.clear(),p===f?f=c:f+=1,p=c,h=S):h!==S&&(g.clear(),h=S,f+=1),y[a]=t.get(a),g.has(_)){const e=g.get(_)+1
g.set(_,e),_=`${_}_${e}`}else g.set(_,0)
v[a]=_,x&&(b[a]=f)}const S=a.VP.ofStringArray(y),_=a.VP.ofStringArray(v),C=x?te.RF.ofColumn(a.VP.ofIntArray(b)):te.RF.ofUndefined(e.index,a.VP.Schema.int)
return{auth_asym_id:r,auth_atom_id:s,auth_comp_id:l,auth_seq_id:i,B_iso_or_equiv:te.RF.ofTokens(e.B_iso_or_equiv),Cartn_x:te.RF.ofTokens(e.Cartn_x),Cartn_y:te.RF.ofTokens(e.Cartn_y),Cartn_z:te.RF.ofTokens(e.Cartn_z),group_PDB:te.RF.ofTokens(e.group_PDB),id:c,label_alt_id:te.RF.ofTokens(e.label_alt_id),label_asym_id:te.RF.ofColumn(S),label_atom_id:te.RF.ofColumn(_),label_comp_id:l,label_seq_id:C,label_entity_id:te.RF.ofStrings(e.label_entity_id),occupancy:(0,pe.Yb)(e.occupancy)?te.RF.ofUndefined(e.index,a.VP.Schema.float):te.RF.ofTokens(e.occupancy),type_symbol:te.RF.ofTokens(e.type_symbol),pdbx_PDB_ins_code:te.RF.ofTokens(e.pdbx_PDB_ins_code),pdbx_PDB_model_num:n,partial_charge:te.RF.ofTokens(e.partial_charge)}}(d,T)
o||delete I.partial_charge,g&&f.push(function(e,t,n,r){const i={}
for(let I=0,P=r.id.rowCount;I<P;++I)i[r.id.str(I)]=I
const o=t=>e.data.substring(e.indices[2*t],e.indices[2*t+1]),a=[],s=[],l=[],c=[],u=[],d=[],p=[],h=[],f=[],m=[],g=[],y=[],v=[],b=[],x=[],S=[11,16,21,26]
let _=1,C=-1,w={},T=!1
for(let I=t;I<n;I++){const e=o(I),t=i[parseInt(e.substr(6,5))]
if(void 0!==t){C!==t&&(C=t,w={})
for(let n=0;n<4;++n){const o=parseInt(e.substr(S[n],5))
if(Number.isNaN(o))continue
const C=i[o]
void 0!==C&&(t>C||(void 0===w[C]?(w[C]=_-1,a.push(`covale${_}`),s.push("covale"),l.push(1),c.push(r.label_asym_id.str(t)),u.push(r.label_seq_id.int(t)),d.push(r.auth_seq_id.int(t)),p.push(r.label_atom_id.str(t)),h.push(r.label_alt_id.str(t)),f.push(r.pdbx_PDB_ins_code.str(t)),m.push(r.label_asym_id.str(C)),g.push(r.label_seq_id.int(C)),y.push(r.auth_seq_id.int(C)),v.push(r.label_atom_id.str(C)),b.push(r.label_alt_id.str(C)),x.push(r.pdbx_PDB_ins_code.str(C)),_+=1):(l[w[C]]+=1,T=!0)))}}}const A={id:te.RF.ofStrings(a),conn_type_id:te.RF.ofStrings(s),ptnr1_label_asym_id:te.RF.ofStrings(c),ptnr1_label_seq_id:te.RF.ofNumbers(u),ptnr1_auth_seq_id:te.RF.ofNumbers(d),ptnr1_label_atom_id:te.RF.ofStrings(p),pdbx_ptnr1_label_alt_id:te.RF.ofStrings(h),pdbx_ptnr1_PDB_ins_code:te.RF.ofStrings(f),ptnr2_label_asym_id:te.RF.ofStrings(m),ptnr2_label_seq_id:te.RF.ofNumbers(g),ptnr2_auth_seq_id:te.RF.ofNumbers(y),ptnr2_label_atom_id:te.RF.ofStrings(v),pdbx_ptnr2_label_alt_id:te.RF.ofStrings(b),pdbx_ptnr2_PDB_ins_code:te.RF.ofStrings(x)}
if(T){const e=["sing","doub","trpl","quad"]
A.pdbx_value_order=te.RF.ofStrings(l.map(t=>e[t-1]||"sing"))}return te.xA.ofFields("struct_conn",A)}(t,g[0],g[1],I))
const P={entity:te.xA.ofTable("entity",h.getEntityTable()),chem_comp:te.xA.ofTable("chem_comp",A.getChemCompTable()),atom_site:te.xA.ofFields("atom_site",I),atom_site_anisotrop:te.xA.ofFields("atom_site_anisotrop",me(p))}
for(const a of f)P[a.name]=a
return{header:e.id||"PDB",categoryNames:Object.keys(P),categories:P}}var Se,_e=n(33191)
!function(e){e.is=function(e){return"pdb"===(null==e?void 0:e.kind)},e.create=function(e){return{kind:"pdb",name:e.id||"",data:e}}}(Se||(Se={}))
var Ce,we=n(76515)
!function(e){e.is=function(e){return"psf"===(null==e?void 0:e.kind)},e.fromPsf=function(e){return{kind:"psf",name:e.id,data:e}}}(Ce||(Ce={}))
var Te,Ae=n(48393),Ie=n(99302),Pe=n(7928),Be=n(43472),Ee=n(9043),ke=n(80178),De=n(85554)
!function(e){function t(e,t){const n=Pe.Script.is(t)?t:void 0,r=Pe.Script.is(t)?Pe.Script.toExpression(t):t
return{script:n,expression:r,compiled:(0,De.wE)(r),originalStructure:e,currentStructure:e}}function n(e,t){return e.compiled(new Ae.QueryContext(t))}e.isUnchanged=function(e,t,n){return e.currentStructure===n&&(Pe.Script.is(t)?!!e.script&&Pe.Script.areEqual(e.script,t):e.expression===t)},e.create=t,e.run=n,e.createAndRun=function(e,r){const i=t(e,r)
return{entry:i,selection:n(i,e)}},e.updateStructure=function(e,t){return e.currentStructure=t,e.compiled(new Ae.QueryContext(t))},e.updateStructureObject=function(e,t,n){const r=Ae.StructureSelection.unionStructure(t)
e.label=`${n||"Selection"}`,e.description=Ae.Structure.elementDescription(r),e.data=r}}(Te||(Te={}))
var Me=n(39298),Re=n(66187),Oe=n(91229)
function Le(e){switch(e){case 7:return-3
case 6:return-2
case 5:return-1
case 0:case 4:return 0
case 3:return 1
case 2:return 2
case 1:return 3
default:return console.error(`Value ${e} is outside the 0-7 range, defaulting to 0.`),0}}function Ne(e,t){const n=s.tM.create(e.data,2*t),r=s.tM.create(e.data,2*t),i=s.tM.create(e.data,2*t),o=s.tM.create(e.data,2*t),l=s.tM.create(e.data,2*t)
for(let a=0;a<t;++a){s._F.markLine(e)
const{tokenStart:t,position:a}=e
s._F.trim(e,t,t+10),s.tM.addUnchecked(n,e.tokenStart,e.tokenEnd),s._F.trim(e,t+10,t+20),s.tM.addUnchecked(r,e.tokenStart,e.tokenEnd),s._F.trim(e,t+20,t+30),s.tM.addUnchecked(i,e.tokenStart,e.tokenEnd),s._F.trim(e,t+31,t+34),s.tM.addUnchecked(o,e.tokenStart,e.tokenEnd),s._F.trim(e,t+36,t+39),s.tM.addUnchecked(l,e.tokenStart,e.tokenEnd),e.position=a}return{count:t,x:(0,pe.do)(n)(a.VP.Schema.float),y:(0,pe.do)(r)(a.VP.Schema.float),z:(0,pe.do)(i)(a.VP.Schema.float),type_symbol:(0,pe.do)(o)(a.VP.Schema.str),formal_charge:(0,pe.do)(l)(a.VP.Schema.int)}}function Fe(e,t){const n=s.tM.create(e.data,2*t),r=s.tM.create(e.data,2*t),i=s.tM.create(e.data,2*t)
for(let o=0;o<t;++o){s._F.markLine(e)
const{tokenStart:t,position:o}=e
s._F.trim(e,t,t+3),s.tM.addUnchecked(n,e.tokenStart,e.tokenEnd),s._F.trim(e,t+3,t+6),s.tM.addUnchecked(r,e.tokenStart,e.tokenEnd),s._F.trim(e,t+6,t+9),s.tM.addUnchecked(i,e.tokenStart,e.tokenEnd),e.position=o}return{count:t,atomIdxA:(0,pe.do)(n)(a.VP.Schema.int),atomIdxB:(0,pe.do)(r)(a.VP.Schema.int),order:(0,pe.do)(i)(a.VP.Schema.int)}}function ze(e,t,n){s._F.trim(e,t+6,t+9)
const r=parseInt(s._F.getTokenString(e))
for(let i=0;i<r;++i){const r=9+8*i
s._F.trim(e,t+r,t+r+4)
const o=s._F.getTokenString(e)
n.atomIdx.push(+o),s._F.trim(e,t+r+4,t+r+8)
const a=s._F.getTokenString(e)
n.charge.push(+a)}s._F.eatLine(e)}function je(e){const t=e.trim().split(/\s+/g),n=[]
for(let r=1;r<t.length;r+=2){const e=+t[r],i=+t[r+1]||0
n.push({atomIdx:e,kind:i})}return n}function Ve(e){const t={atomIdx:[],charge:[]}
let n
for(;e.position<e.length;){const{position:r}=e
s._F.trim(e,r+3,r+6)
const i=s._F.getTokenString(e)
if("END"===i)break
switch(s._F.eatLine(e),i){case"CHG":ze(e,r,t)
break
case"APO":n=je(s._F.getTokenString(e).substring(3))}}return{formalCharges:{atomIdx:a.VP.ofIntArray(t.atomIdx),charge:a.VP.ofIntArray(t.charge)},attachmentPoints:n}}var Ue,Ge=n(64367)
async function He(e,t,n){const{atoms:r,bonds:i,formalCharges:o}=e,s=a.VP.ofConst("MOL",e.atoms.count,a.VP.Schema.str),l=a.VP.ofConst("A",e.atoms.count,a.VP.Schema.str),c=a.VP.asArrayColumn(r.type_symbol),u=a.VP.ofConst(1,r.count,a.VP.Schema.int),d=new Int32Array(e.atoms.count)
if(o.atomIdx.rowCount>0)for(let a=0;a<o.atomIdx.rowCount;a++)d[o.atomIdx.value(a)-1]=o.charge.value(a)
else for(let a=0;a<e.atoms.count;a++)d[a]=Le(r.formal_charge.value(a))
const p=a.XI.ofPartialColumns(Y.e.atom_site,{auth_asym_id:l,auth_atom_id:c,auth_comp_id:s,auth_seq_id:u,Cartn_x:a.VP.asArrayColumn(r.x,Float32Array),Cartn_y:a.VP.asArrayColumn(r.y,Float32Array),Cartn_z:a.VP.asArrayColumn(r.z,Float32Array),id:a.VP.range(1,r.count),label_asym_id:l,label_atom_id:c,label_comp_id:s,label_seq_id:u,label_entity_id:a.VP.ofConst("1",r.count,a.VP.Schema.str),occupancy:a.VP.ofConst(1,r.count,a.VP.Schema.float),type_symbol:c,pdbx_PDB_model_num:a.VP.ofConst(1,r.count,a.VP.Schema.int),pdbx_formal_charge:a.VP.ofIntArray(d)},r.count),h=new W.V
h.setNames([["MOL","Unknown Entity"]]),h.getEntityId("MOL",G.MoleculeType.Unknown,"A")
const f=new H.N(u,c)
f.setNames([["MOL","Unknown Molecule"]]),f.add("MOL",0)
const m=(0,Y.z)({entity:h.getEntityTable(),chem_comp:f.getChemCompTable(),atom_site:p}),g=await(0,Z.X)(m,null!=t?t:Ue.create(e),n)
if(g.frameCount>0){const e=a.VP.ofIntArray(a.VP.mapToArray(i.atomIdxA,e=>e-1,Int32Array)),t=a.VP.ofIntArray(a.VP.mapToArray(i.atomIdxB,e=>e-1,Int32Array)),n=a.VP.asArrayColumn(i.order,Int32Array),o=Ge.z.fromData({pairs:{indexA:e,indexB:t,order:n},count:r.count},{maxDistance:1/0})
Ge.z.Provider.set(g.representative,o)}return g}!function(e){e.is=function(e){return"mol"===(null==e?void 0:e.kind)},e.create=function(e){return{kind:"mol",name:e.title,data:e}}}(Ue||(Ue={}))
var qe,Qe,$e=n(14294),Xe=n(10212),We=n(60658)
We._.Provider.formatRegistry.add("cifCore",function(e){if(!qe.is(e.sourceData))return
const{atom_site:t,atom_site_aniso:n}=e.sourceData.data.db
return{data:a.XI.ofPartialColumns(We._.Schema,{U:n.u},n._rowCount),elementToAnsiotrop:We._.getElementToAnsiotropFromLabel(t.label,n.label)}},function(e){return!!qe.is(e.sourceData)&&e.sourceData.data.db.atom_site_aniso.u.isDefined}),function(e){e.is=function(e){return"cifCore"===(null==e?void 0:e.kind)},e.fromFrame=function(e,t){return t||(t=te.f$.schema.cifCore(e)),{kind:"cifCore",name:t.database_code.depnum_ccdc_archive.value(0)||t.database_code.depnum_ccdc_fiz.value(0)||t.database_code.icsd.value(0)||t.database_code.mdf.value(0)||t.database_code.nbs.value(0)||t.database_code.csd.value(0)||t.database_code.cod.value(0)||t._name,data:{db:t,frame:e}}}}(qe||(qe={})),function(e){e.is=function(e){return"cube"===(null==e?void 0:e.kind)},e.create=function(e){return{kind:"cube",name:e.header.comment1,data:e}}}(Qe||(Qe={}))
const{skipWhitespace:Ye,eatValue:Ze,markLine:Ke,getTokenString:Je,skipStrictWhitespace:et}=s._F
function tt(e,t){return{tokenizer:e,molecule:{mol_name:"",num_atoms:0,num_bonds:0,num_subst:0,num_feat:0,num_sets:0,mol_type:"",charge_type:"",status_bits:"",mol_comment:""},runtimeCtx:t}}const nt=/\s+/g
function rt(e){const{tokenizer:t,molecule:n}=e
for(;"@<TRIPOS>MOLECULE"!==Je(t)&&t.position<t.data.length;)Ke(t)
Ke(t),n.mol_name=Je(t),Ke(t)
const r=Je(t).trim().split(nt)
n.num_atoms=parseInt(r[0]),n.num_bonds=parseInt(r[1]),n.num_subst=parseInt(r[2]),n.num_feat=parseInt(r[3]),n.num_sets=parseInt(r[4]),Ke(t)
const i=Je(t)
if(i.startsWith("@<TRIPOS>"))return
n.mol_type=i,Ke(t)
const o=Je(t)
if(o.startsWith("@<TRIPOS>"))return
n.charge_type=o,Ke(t)
const a=Je(t)
if(a.startsWith("@<TRIPOS>"))return
n.status_bits=a,Ke(t)
const s=Je(t)
s.startsWith("@<TRIPOS>")||(n.mol_comment=s)}function it(e,t,n){let r=0
for(let i=0;i<e;i++){let e=0
for(Ye(n);et(n),n.tokenStart=n.position,Ze(n),n.tokenStart!==n.tokenEnd;){const r=t[e++]
r&&s.tM.addUnchecked(r,n.tokenStart,n.tokenEnd)}e>r&&(r=e)
for(let n=e;n<t.length;n++)s.tM.addUnchecked(t[n],0,0)}return r+1}async function ot(e){const{tokenizer:t,molecule:n}=e
for(;"@<TRIPOS>ATOM"!==Je(t)&&t.position<t.data.length;)Ke(t)
const r=t.position,o=t.lineNumber,l=s.tM.create(t.data,2*n.num_atoms),c=s.tM.create(t.data,2*n.num_atoms),u=s.tM.create(t.data,2*n.num_atoms),d=s.tM.create(t.data,2*n.num_atoms),p=s.tM.create(t.data,2*n.num_atoms),h=s.tM.create(t.data,2*n.num_atoms),f=s.tM.create(t.data,2*n.num_atoms),m=s.tM.create(t.data,2*n.num_atoms),g=s.tM.create(t.data,2*n.num_atoms),y=s.tM.create(t.data,2*n.num_atoms),v=a.VP.Undefined(n.num_atoms,a.VP.Schema.float),b=a.VP.Undefined(n.num_atoms,a.VP.Schema.int),x=a.VP.Undefined(n.num_atoms,a.VP.Schema.str)
t.position=r,t.lineNumber=o
let S=0
const _=[l,c,u,d,p,h,f,m,g,y],{length:C}=t
let w=0
return await(0,i.chunkedSubtask)(e.runtimeCtx,1e5,void 0,e=>{const r=Math.min(n.num_atoms-w,e)
return S=Math.max(S,it(r,_,t)),w+=r,r},e=>e.update({message:"Parsing...",current:t.position,max:C})),{count:n.num_atoms,atom_id:(0,pe.do)(l)(a.VP.Schema.int),atom_name:(0,pe.do)(c)(a.VP.Schema.str),x:(0,pe.do)(u)(a.VP.Schema.float),y:(0,pe.do)(d)(a.VP.Schema.float),z:(0,pe.do)(p)(a.VP.Schema.float),atom_type:S>5?(0,pe.do)(h)(a.VP.Schema.str):x,subst_id:S>6?(0,pe.do)(f)(a.VP.Schema.int):b,subst_name:S>7?(0,pe.do)(m)(a.VP.Schema.str):x,charge:S>8?(0,pe.do)(g)(a.VP.Schema.float):v,status_bits:S>9?(0,pe.do)(y)(a.VP.Schema.str):x}}async function at(e){const{tokenizer:t,molecule:n}=e
for(;"@<TRIPOS>BOND"!==Je(t)&&t.position<t.data.length;)Ke(t)
const r=t.position,o=t.lineNumber,l=s.tM.create(t.data,2*n.num_bonds),c=s.tM.create(t.data,2*n.num_bonds),u=s.tM.create(t.data,2*n.num_bonds),d=s.tM.create(t.data,2*n.num_bonds),p=s.tM.create(t.data,2*n.num_bonds),h=a.VP.Undefined(n.num_bonds,a.VP.Schema.str)
t.position=r,t.lineNumber=o
let f=0
const m=[l,c,u,d,p],{length:g}=t
let y=0
return await(0,i.chunkedSubtask)(e.runtimeCtx,1e5,void 0,e=>{const r=Math.min(n.num_bonds-y,e)
return f=Math.max(f,it(r,m,t)),y+=r,r},e=>e.update({message:"Parsing...",current:t.position,max:g})),{count:n.num_bonds,bond_id:(0,pe.do)(l)(a.VP.Schema.int),origin_atom_id:(0,pe.do)(c)(a.VP.Schema.int),target_atom_id:(0,pe.do)(u)(a.VP.Schema.int),bond_type:(0,pe.do)(d)(a.VP.Schema.str),status_bits:f>4?(0,pe.do)(p)(a.VP.Schema.str):h}}async function st(e){const{tokenizer:t,molecule:n}=e
if(0===n.num_subst)return
for(;"@<TRIPOS>SUBSTRUCTURE"!==Je(t)&&t.position<t.data.length;)Ke(t)
const r=t.position,o=t.lineNumber,l=s.tM.create(t.data,2*n.num_subst),c=s.tM.create(t.data,2*n.num_subst),u=s.tM.create(t.data,2*n.num_subst),d=s.tM.create(t.data,2*n.num_subst),p=s.tM.create(t.data,2*n.num_subst),h=s.tM.create(t.data,2*n.num_subst),f=s.tM.create(t.data,2*n.num_subst),m=s.tM.create(t.data,2*n.num_subst),g=s.tM.create(t.data,2*n.num_subst),y=a.VP.Undefined(n.num_subst,a.VP.Schema.int),v=a.VP.Undefined(n.num_subst,a.VP.Schema.str)
t.position=r,t.lineNumber=o
let b=0
const x=[l,c,u,d,p,h,f,m,g],{length:S}=t
let _=0
return await(0,i.chunkedSubtask)(e.runtimeCtx,1e5,void 0,e=>{const r=Math.min(n.num_subst-_,e)
return b=Math.max(b,it(r,x,t)),_+=r,r},e=>e.update({message:"Parsing...",current:t.position,max:S})),{count:n.num_subst,subst_id:(0,pe.do)(l)(a.VP.Schema.int),subst_name:(0,pe.do)(c)(a.VP.Schema.str),root_atom:(0,pe.do)(u)(a.VP.Schema.int),subst_type:b>3?(0,pe.do)(d)(a.VP.Schema.str):v,dict_type:b>4?(0,pe.do)(p)(a.VP.Schema.str):v,chain:b>5?(0,pe.do)(h)(a.VP.Schema.str):v,sub_type:b>6?(0,pe.do)(f)(a.VP.Schema.str):v,inter_bonds:b>7?(0,pe.do)(m)(a.VP.Schema.int):y,status_bits:b>8?(0,pe.do)(g)(a.VP.Schema.str):v}}function lt(e){const{tokenizer:t}=e
for(;t.position<t.data.length;){const e=Je(t)
if("@<TRIPOS>MOLECULE"===e)return
if("@<TRIPOS>CRYSIN"===e)break
Ke(t)}if(t.position>=t.data.length)return
Ke(t)
const n=Je(t).trim().split(nt)
return{a:parseFloat(n[0]),b:parseFloat(n[1]),c:parseFloat(n[2]),alpha:parseFloat(n[3]),beta:parseFloat(n[4]),gamma:parseFloat(n[5]),spaceGroup:parseInt(n[6],10),setting:parseInt(n[7],10)}}function ct(e){if(1!==e.setting)return
const t=$e.O8.create(e.spaceGroup,f.eB.create(e.a,e.b,e.c),f.eB.scale((0,f.eB)(),f.eB.create(e.alpha,e.beta,e.gamma),Math.PI/180))
return{spacegroup:$e.is.create(t),assemblies:[],isNonStandardCrystalFrame:!1,ncsOperators:[]}}var ut
!function(e){e.is=function(e){return"mol2"===(null==e?void 0:e.kind)},e.create=function(e){return{kind:"mol2",name:e.name,data:e}}}(ut||(ut={}))
const dt=new Uint32Array([0,0,0,0,0,0,0,0,0,8,10,12,16,20,25,32,40,50,64,80,101,128,161,203,256,322,406,512,645,812,1024,1290,1625,2048,2580,3250,4096,5060,6501,8192,10321,13003,16384,20642,26007,32768,41285,52015,65536,82570,104031,131072,165140,208063,262144,330280,416127,524287,660561,832255,1048576,1321122,1664510,2097152,2642245,3329021,4194304,5284491,6658042,8388607,10568983,13316085,16777216])
var pt,ht
function ft(){throw new Error("(xdrfile error) Undefined error.")}function mt(e){let t=e.position>=e.data.length-1?0:+s._F.readLine(e)
isNaN(t)&&(t=0)
const n=s._F.readLine(e),r=new Float64Array(t),i=new Float64Array(t),o=new Float64Array(t),l=new Array(t)
for(let a=0;a<t;++a){const t=s._F.readLineTrim(e).split(/\s+/g)
l[a]=t[0],r[a]=+t[1],i[a]=+t[2],o[a]=+t[3]}return{count:t,comment:n,x:a.VP.ofFloatArray(r),y:a.VP.ofFloatArray(i),z:a.VP.ofFloatArray(o),type_symbol:a.VP.ofStringArray(l)}}!function(e){e.sizeOfInt=function(e){let t=1,n=0
for(;e>=t&&n<32;)n++,t<<=1
return n}
const t=new Uint8Array(32)
e.sizeOfInts=function(e,n){let r=1,i=0
t[0]=1
for(let a=0;a<e;a++){let e,i=0
for(e=0;e<r;e++)i+=t[e]*n[a],t[e]=255&i,i>>=8
for(;0!==i;)t[e++]=255&i,i>>=8
r=e}let o=1
for(r--;t[r]>=o;)i++,o*=2
return i+8*r}
const n=new ArrayBuffer(24)
e.buf=new Int32Array(n)
const r=new Uint32Array(n)
function i(t,n,i){let o=i
const a=(1<<o)-1
let s=r[1],l=r[2],c=e.buf[0],u=0
for(;o>=8;)l=l<<8|t[n+c++],u|=l>>s<<o-8,o-=8
return o>0&&(s<o&&(s+=8,l=l<<8|t[n+c++]),s-=o,u|=l>>s&(1<<o)-1),u&=a,e.buf[0]=c,e.buf[1]=s,e.buf[2]=l,u}function o(t,n){let i=r[2]
const o=e.buf[0]
return i=i<<8|t[n+o],e.buf[0]=o+1,e.buf[2]=i,i>>r[1]&255}e.decodeBits=i
const a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
e.decodeInts=function(e,t,n,r,s){let l=n,c=0
for(a[0]=0,a[1]=0,a[2]=0,a[3]=0;l>8;)a[c++]=o(e,t),l-=8
l>0&&(a[c++]=i(e,t,l))
for(let i=2;i>0;i--){let e=0
const t=r[i]
for(let n=c-1;n>=0;n--){e=e<<8|a[n]
const r=e/t|0
a[n]=r,e-=r*t}s[i]=e}s[0]=a[0]|a[1]<<8|a[2]<<16|a[3]<<24}}(pt||(pt={})),function(e){e.is=function(e){return"xyz"===(null==e?void 0:e.kind)},e.create=function(e){return{kind:"xyz",name:"xyz",data:e}}}(ht||(ht={}))
const gt={lj:{mass:"unitless",distance:"unitless",time:"unitless",energy:"unitless",velocity:"unitless",force:"unitless",torque:"unitless",temperature:"unitless",pressure:"unitless",viscosity:"unitless",charge:"unitless",density:"unitless",scale:1},real:{mass:"grams/mole",distance:"Angstroms",time:"femtoseconds",energy:"Kcal/mol",velocity:"Angstroms/femtosecond",force:"Kcal/mol-Angstrom",torque:"Kcal/mol",temperature:"Kelvin",pressure:"atmospheres",viscosity:"Poise",charge:"multiple of electron charge",dipole:"charge*Angstroms",electricField:"volts/Angstrom",density:"g/cm^3",scale:1},metal:{mass:"grams/mole",distance:"Angstroms",time:"picoseconds",energy:"eV",velocity:"Angstroms/picosecond",force:"eV/Angstrom",torque:"eV",temperature:"Kelvin",pressure:"bars",viscosity:"Poise",charge:"multiple of electron charge",dipole:"charge*Angstroms",electricField:"volts/Angstrom",density:"g/cm^3",scale:1},si:{mass:"kilograms",distance:"meters",time:"seconds",energy:"Joules",velocity:"meters/second",force:"Newtons",torque:"Newton-meters",temperature:"Kelvin",pressure:"Pascals",viscosity:"Pascal*second",charge:"Coulombs",dipole:"Coulombs*meters",electricField:"volts/meter",density:"kg/m^3",scale:1},cgs:{mass:"grams",distance:"centimeters",time:"seconds",energy:"ergs",velocity:"centimeters/second",force:"dynes",torque:"dyne-centimeters",temperature:"Kelvin",pressure:"dyne/cm^2",viscosity:"Poise",charge:"statcoulombs",dipole:"statcoul-cm",electricField:"statvolt/cm",density:"g/cm^3",scale:1},electron:{mass:"atomic mass units",distance:"Bohr",time:"femtoseconds",energy:"Hartrees",velocity:"Bohr/atomic time units",force:"Hartrees/Bohr",temperature:"Kelvin",pressure:"Pascals",charge:"multiple of electron charge",dipole:"Debye",electricField:"volts/cm",density:"unitless",torque:"",viscosity:"",scale:.529177},micro:{mass:"picograms",distance:"micrometers",time:"microseconds",energy:"picogram-micrometer^2/microsecond^2",velocity:"micrometers/microsecond",force:"picogram-micrometer/microsecond^2",torque:"picogram-micrometer^2/microsecond^2",temperature:"Kelvin",pressure:"picogram/(micrometer-microsecond^2)",viscosity:"picogram/(micrometer-microsecond)",charge:"picocoulombs",dipole:"picocoulomb-micrometer",electricField:"volt/micrometer",density:"pg/m^3",scale:1},nano:{mass:"attograms",distance:"nanometers",time:"nanoseconds",energy:"attogram-nanometer^2/nanosecond^2",velocity:"nanometers/nanosecond",force:"attogram-nanometer/nanosecond^2",torque:"attogram-nanometer^2/nanosecond^2",temperature:"Kelvin",pressure:"attogram/(nanometer-nanosecond^2)",viscosity:"attogram/(nanometer-nanosecond)",charge:"multiple of electron charge",dipole:"charge-nanometer",electricField:"volt/nanometer",density:"ag/nm^3",scale:10}},yt=["real","metal","si","cgs","electron","micro","nano","lj"],{readLine:vt,skipWhitespace:bt,eatValue:xt,eatLine:St,markStart:_t}=s._F,Ct=/\s+/
async function wt(e,t,n){const{tokenizer:r}=e,o=s.tM.create(r.data,2*t),l=s.tM.create(r.data,2*t),c=s.tM.create(r.data,2*t),u=s.tM.create(r.data,2*t),d=s.tM.create(r.data,2*t),p=s.tM.create(r.data,2*t),h=s.tM.create(r.data,2*t),f={full:[o,l,c,u,d,p,h],atomic:[o,c,d,p,h],bond:[o,l,c,d,p,h]},m=f[n].length,{position:g}=r
vt(r).trim(),r.position=g
const{length:y}=r
let v=0
return await(0,i.chunkedSubtask)(e.runtimeCtx,1e5,void 0,e=>{const i=Math.min(t-v,e)
for(let t=0;t<i;++t){for(let e=0;e<m;++e){bt(r),_t(r),xt(r)
const t=f[n][e]
t&&s.tM.addUnchecked(t,r.tokenStart,r.tokenEnd)}St(r),_t(r)}return v+=i,i},e=>e.update({message:"Parsing...",current:r.position,max:y})),{count:t,atomId:(0,pe.do)(o)(a.VP.Schema.int),moleculeId:(0,pe.do)(l)(a.VP.Schema.int),atomType:(0,pe.do)(c)(a.VP.Schema.int),charge:(0,pe.do)(u)(a.VP.Schema.float),x:(0,pe.do)(d)(a.VP.Schema.float),y:(0,pe.do)(p)(a.VP.Schema.float),z:(0,pe.do)(h)(a.VP.Schema.float)}}async function Tt(e,t){const{tokenizer:n}=e,r=s.tM.create(n.data,2*t),o=s.tM.create(n.data,2*t),l=s.tM.create(n.data,2*t),c=s.tM.create(n.data,2*t),{length:u}=n
let d=0
return await(0,i.chunkedSubtask)(e.runtimeCtx,10,void 0,e=>{const i=Math.min(t-d,e)
for(let t=0;t<i;++t)for(let e=0;e<4;++e)switch(bt(n),_t(n),xt(n),e){case 0:s.tM.addUnchecked(r,n.tokenStart,n.tokenEnd)
break
case 1:s.tM.addUnchecked(o,n.tokenStart,n.tokenEnd)
break
case 2:s.tM.addUnchecked(l,n.tokenStart,n.tokenEnd)
break
case 3:s.tM.addUnchecked(c,n.tokenStart,n.tokenEnd)}return d+=i,i},e=>e.update({message:"Parsing...",current:n.position,max:u})),{count:t,bondId:(0,pe.do)(r)(a.VP.Schema.int),bondType:(0,pe.do)(o)(a.VP.Schema.int),atomIdA:(0,pe.do)(l)(a.VP.Schema.int),atomIdB:(0,pe.do)(c)(a.VP.Schema.int)}}const At=["full","atomic","bond"]
var It
!function(e){e.is=function(e){return"data"===(null==e?void 0:e.kind)},e.create=function(e){return{kind:"data",name:"data",data:e}}}(It||(It={}))
const{readLine:Pt,skipWhitespace:Bt,eatValue:Et,eatLine:kt,markStart:Dt}=s._F
async function Mt(e,t,n){const{tokenizer:r}=e,o=Object.fromEntries(n.map((e,t)=>[e,t])),l=n.findIndex(e=>"x"===e[0]),c=n.findIndex(e=>"y"===e[0]),u=n.findIndex(e=>"z"===e[0]),d=n[l],p=s.tM.create(r.data,2*t),h=s.tM.create(r.data,2*t),f=s.tM.create(r.data,2*t),m=s.tM.create(r.data,2*t),g=s.tM.create(r.data,2*t),y=s.tM.create(r.data,2*t),{position:v}=r
r.position=v
const b=n.length,{length:x}=r
let S=0
return await(0,i.chunkedSubtask)(e.runtimeCtx,1e5,void 0,e=>{const n=Math.min(t-S,e)
for(let t=0;t<n;++t){for(let e=0;e<b;++e)switch(Bt(r),Dt(r),Et(r),e){case o.id:s.tM.addUnchecked(p,r.tokenStart,r.tokenEnd)
break
case o.mol:s.tM.addUnchecked(h,r.tokenStart,r.tokenEnd)
break
case o.type:s.tM.addUnchecked(f,r.tokenStart,r.tokenEnd)
break
case l:s.tM.addUnchecked(m,r.tokenStart,r.tokenEnd)
break
case c:s.tM.addUnchecked(g,r.tokenStart,r.tokenEnd)
break
case u:s.tM.addUnchecked(y,r.tokenStart,r.tokenEnd)}kt(r),Dt(r)}return S+=n,n},e=>e.update({message:"Parsing...",current:r.position,max:x})),{count:t,atomMode:d,atomId:(0,pe.do)(p)(a.VP.Schema.int),moleculeId:(0,pe.do)(h)(a.VP.Schema.int),atomType:(0,pe.do)(f)(a.VP.Schema.int),x:(0,pe.do)(m)(a.VP.Schema.float),y:(0,pe.do)(g)(a.VP.Schema.float),z:(0,pe.do)(y)(a.VP.Schema.float)}}function Rt(e){return i.Task.create("Parse Lammp Trajectory",async t=>await async function(e,t){const n=(0,s._F)(e),i=function(e,t){return{tokenizer:e,runtimeCtx:t}}(n,t),o={frames:[],times:[],bounds:[],timeOffset:0,deltaTime:0},a=o.frames
let l=0,c=0
for(;n.tokenEnd<n.length;){const e=Pt(i.tokenizer).trim()
if(e.includes("ITEM: TIMESTEP"))c=parseInt(Pt(i.tokenizer).trim()),o.times.push(c)
else if(e.includes("ITEM: NUMBER OF ATOMS"))l=parseInt(Pt(i.tokenizer).trim())
else if(e.includes("ITEM: ATOMS")){const t=e.split(" ").slice(2),n=await Mt(i,l,t)
a.push(n)}else if(e.includes("ITEM: BOX BOUNDS")){const t=e.split("ITEM: BOX BOUNDS ")[1].split(" "),n=t[0],r=t[1],a=t[2],s=Pt(i.tokenizer).trim().split(" "),l=Pt(i.tokenizer).trim().split(" "),c=Pt(i.tokenizer).trim().split(" "),u=parseFloat(s[0]),d=parseFloat(s[1]),p=parseFloat(l[0]),h=parseFloat(l[1]),f=parseFloat(c[0]),m=parseFloat(c[1])
o.bounds.push({lower:[u,p,f],length:[d-u,h-p,m-f],periodicity:[n,r,a]})}}return o.times.length>=1&&(o.timeOffset=o.times[0]),o.times.length>=2&&(o.deltaTime=o.times[1]-o.times[0]),r.H.success(o)}(e,t))}var Ot,Lt=n(94050)
function Nt(e,t="real"){return i.Task.create("Parse Lammps Trajectory",async n=>{await n.update("Converting to coordinates")
const r=gt[t].scale,i=(0,R.g)(e.deltaTime,"step"),o=(0,R.g)(e.timeOffset,i.unit),a={x:0,y:0,z:0},s={x:1,y:1,z:1},l=e.frames[0].atomMode.includes("s"),c=[]
for(let t=0,u=e.frames.length;t<u;++t){const n=e.bounds[t]
l&&(s.x=n.length[0],s.y=n.length[1],s.z=n.length[2],a.x=n.lower[0],a.y=n.lower[1],a.z=n.lower[2])
const u=e.frames[t].count,d=new Float32Array(u),p=new Float32Array(u),h=new Float32Array(u)
let f=0
for(let i=0;i<u;i++)d[f]=(e.frames[t].x.value(i)*s.x+a.x)*r,p[f]=(e.frames[t].y.value(i)*s.y+a.y)*r,h[f]=(e.frames[t].z.value(i)*s.z+a.z)*r,f++
c.push({elementCount:e.frames[t].count,x:d,y:p,z:h,xyzOrdering:{isIdentity:!0},time:(0,R.g)(o.value+i.value*t,i.unit)})}return R.E.create(c,i,o)})}function Ft(e){s._F.skipWhitespace(e),s._F.eatValue(e)}function zt(e,t){const{position:n}=e
s._F.skipWhitespace(e),s._F.eatValue(e),s._F.trim(e,n,e.position),s.tM.addUnchecked(t,e.tokenStart,e.tokenEnd)}!function(e){e.is=function(e){return"lammpstrj"===(null==e?void 0:e.kind)},e.create=function(e){return{kind:"lammpstrj",name:"lammpstrj",data:e}}}(Ot||(Ot={}))
const jt="$$$$"
function Vt(e){const t=s._F.readLine(e).trim(),n=s._F.readLine(e).trim(),r=s._F.readLine(e).trim(),i=s._F.readLine(e),o=i.trim().endsWith("V3000"),{atomCount:l,bondCount:c}=o?function(e){const t=s.tM.create(e.data,1),n=s.tM.create(e.data,1)
return s._F.eatLine(e),Ft(e),Ft(e),Ft(e),zt(e,t),zt(e,n),s._F.eatLine(e),{atomCount:(0,pe.do)(t)(a.VP.Schema.int).value(0),bondCount:(0,pe.do)(n)(a.VP.Schema.int).value(0)}}(e):function(e){return{atomCount:+e.substr(0,3),bondCount:+e.substr(3,3)}}(i)
if(Number.isNaN(l)||Number.isNaN(c)){for(;e.position<e.length&&!s._F.readLine(e).startsWith(jt););return}const u={atomIdx:a.VP.ofConst(0,l,a.VP.Schema.int),charge:a.VP.ofConst(0,l,a.VP.Schema.int)},d=o?function(e,t){const n=s.tM.create(e.data,2*t),r=s.tM.create(e.data,2*t),i=s.tM.create(e.data,2*t),o=s.tM.create(e.data,2*t)
for(let a=0;a<t;++a){s._F.markLine(e),Ft(e),Ft(e),Ft(e)
const{position:t}=e
zt(e,o),zt(e,n),zt(e,r),zt(e,i),e.position=t}return s._F.eatLine(e),s._F.eatLine(e),{count:t,x:(0,pe.do)(n)(a.VP.Schema.float),y:(0,pe.do)(r)(a.VP.Schema.float),z:(0,pe.do)(i)(a.VP.Schema.float),type_symbol:(0,pe.do)(o)(a.VP.Schema.str),formal_charge:a.VP.ofConst(0,t,a.VP.Schema.int)}}(e,l):Ne(e,l),p=o?function(e,t){const n=s.tM.create(e.data,2*t),r=s.tM.create(e.data,2*t),i=s.tM.create(e.data,2*t)
for(let o=0;o<t;++o){s._F.markLine(e),Ft(e),Ft(e),Ft(e)
const{position:t}=e
zt(e,i),zt(e,n),zt(e,r),e.position=t}return s._F.eatLine(e),s._F.eatLine(e),{count:t,atomIdxA:(0,pe.do)(n)(a.VP.Schema.float),atomIdxB:(0,pe.do)(r)(a.VP.Schema.float),order:(0,pe.do)(i)(a.VP.Schema.float)}}(e,c):Fe(e,c),h=o?{formalCharges:u}:Ve(e),f=function(e){const t=s.tM.create(e.data,32),n=s.tM.create(e.data,32)
for(;e.position<e.length;){const r=s._F.readLine(e)
if(r.startsWith(jt))break
if(r&&r.startsWith("> ")){s.tM.add(t,e.tokenStart+2,e.tokenEnd),s._F.markLine(e)
const r=e.tokenStart
let i=e.tokenEnd,o=!1
for(;e.position<e.length;){const t=s._F.readLine(e)
if(!t||t.startsWith(jt)||t.startsWith("> ")){s.tM.add(n,r,i),o=!0
break}i=e.tokenEnd}o||s.tM.add(n,r,i)}}return{dataHeader:(0,pe.do)(t)(a.VP.Schema.str),data:(0,pe.do)(n)(a.VP.Schema.str)}}(e)
return{molFile:{title:t,program:n,comment:r,atoms:d,bonds:p,...h},dataItems:f}}var Ut
function Gt(e){return i.Task.create("Parse SDF",t=>He(e.molFile,Ut.create(e),t))}!function(e){e.is=function(e){return"sdf"===(null==e?void 0:e.kind)},e.create=function(e){return{kind:"sdf",name:e.molFile.title,data:e}}}(Ut||(Ut={}))
const Ht=[]
class qt{constructor(e,t={}){this._mark=0,this._marks=[],this.offset=0,this.littleEndian=!0
let n=!1
void 0===e&&(e=8192),"number"==typeof e?e=new ArrayBuffer(e):n=!0
const r=t.offset?t.offset>>>0:0,i=e.byteLength-r
let o=r
e instanceof ArrayBuffer||e instanceof SharedArrayBuffer||(e.byteLength!==e.buffer.byteLength&&(o=e.byteOffset+r),e=e.buffer),this._lastWrittenByte=n?i:0,this.buffer=e,this.length=i,this.byteLength=i,this.byteOffset=o,this._data=new DataView(this.buffer,o,i)}available(e=1){return this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e){return void 0===e&&(e=1),this.offset+=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop()
if(void 0===e)throw new Error("Mark stack empty")
return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e){if(void 0===e&&(e=1),!this.available(e)){const t=2*(this.offset+e),n=new Uint8Array(t)
n.set(new Uint8Array(this.buffer)),this.buffer=n.buffer,this.length=this.byteLength=t,this._data=new DataView(this.buffer)}return this}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e){void 0===e&&(e=1)
const t=new Uint8Array(e)
for(let n=0;n<e;n++)t[n]=this.readByte()
return t}readInt16(){const e=this._data.getInt16(this.offset,this.littleEndian)
return this.offset+=2,e}readUint16(){const e=this._data.getUint16(this.offset,this.littleEndian)
return this.offset+=2,e}readInt32(){const e=this._data.getInt32(this.offset,this.littleEndian)
return this.offset+=4,e}readUint32(){const e=this._data.getUint32(this.offset,this.littleEndian)
return this.offset+=4,e}readFloat32(){const e=this._data.getFloat32(this.offset,this.littleEndian)
return this.offset+=4,e}readFloat64(){const e=this._data.getFloat64(this.offset,this.littleEndian)
return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e=1){Ht.length=e
for(let t=0;t<e;t++)Ht[t]=this.readChar()
return Ht.join("")}writeBoolean(e=!1){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length)
for(let t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t])
return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(let t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t))
return this}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this._lastWrittenByte)}_updateLastWrittenByte(){this.offset>this._lastWrittenByte&&(this._lastWrittenByte=this.offset)}}function Qt(e,t){if(e)throw new TypeError("Not a valid NetCDF v3.x file: "+t)}function $t(e){e.offset%4!=0&&e.skip(4-e.offset%4)}function Xt(e){const t=e.readUint32(),n=e.readChars(t)
return $t(e),n}function Wt(e){switch(Number(e)){case 1:return"byte"
case 2:return"char"
case 3:return"short"
case 4:return"int"
case 5:return"float"
case 6:return"double"
default:return"undefined"}}function Yt(e){switch(Number(e)){case 1:case 2:return 1
case 3:return 2
case 4:case 5:return 4
case 6:return 8
default:return-1}}function Zt(e){switch(String(e)){case"byte":return 1
case"char":return 2
case"short":return 3
case"int":return 4
case"float":return 5
case"double":return 6
default:return-1}}function Kt(e,t){if(1!==e){const n=new Array(e)
for(let r=0;r<e;r++)n[r]=t()
return n}return t()}function Jt(e,t,n){switch(t){case 1:return e.readBytes(n)
case 2:return 0===(r=e.readChars(n)).charCodeAt(r.length-1)?r.substring(0,r.length-1):r
case 3:return Kt(n,e.readInt16.bind(e))
case 4:return Kt(n,e.readInt32.bind(e))
case 5:return Kt(n,e.readFloat32.bind(e))
case 6:return Kt(n,e.readFloat64.bind(e))
default:return void Qt(!0,"non valid type "+t)}var r}function en(e){let t
const n=e.readUint32()
if(0===n)return Qt(0!==e.readUint32(),"wrong empty tag for list of attributes"),[]
{Qt(12!==n,"wrong tag for list of attributes")
const r=e.readUint32()
t=new Array(r)
for(let n=0;n<r;n++){const r=Xt(e),i=e.readUint32()
Qt(i<1||i>6,"non valid type "+i)
const o=e.readUint32(),a=Jt(e,i,o)
$t(e),t[n]={name:r,type:Wt(i),value:a}}}return t}class tn{constructor(e){const t=new qt(e)
t.setBigEndian(),Qt("CDF"!==t.readChars(3),"should start with CDF")
const n=t.readByte()
Qt(n>2,"unknown version"),this.header=function(e,t){const n={recordDimension:{length:e.readUint32()}}
n.version=t
const r=function(e){let t,n,r
const i=e.readUint32()
if(0===i)return Qt(0!==e.readUint32(),"wrong empty tag for list of dimensions"),[]
{Qt(10!==i,"wrong tag for list of dimensions")
const o=e.readUint32()
t=new Array(o)
for(let i=0;i<o;i++){const o=Xt(e),a=e.readUint32()
0===a&&(n=i,r=o),t[i]={name:o,size:a}}return{dimensions:t,recordId:n,recordName:r}}}(e)
n.recordDimension.id=r.recordId,n.recordDimension.name=r.recordName,n.dimensions=r.dimensions,n.globalAttributes=en(e)
const i=function(e,t,n){const r=e.readUint32()
let i,o=0
if(0===r)return Qt(0!==e.readUint32(),"wrong empty tag for list of variables"),[]
{Qt(11!==r,"wrong tag for list of variables")
const a=e.readUint32()
i=new Array(a)
for(let r=0;r<a;r++){const a=Xt(e),s=e.readUint32(),l=new Array(s)
for(let t=0;t<s;t++)l[t]=e.readUint32()
const c=en(e),u=e.readUint32()
Qt(u<1&&u>6,"non valid type "+u)
const d=e.readUint32()
let p=e.readUint32()
2===n&&(Qt(p>0,"offsets larger than 4GB not supported"),p=e.readUint32()),l[0]===t&&(o+=d),i[r]={name:a,dimensions:l,attributes:c,type:Wt(u),size:d,offset:p,record:l[0]===t}}}return{variables:i,recordStep:o}}(e,r.recordId,t)
return n.variables=i.variables,n.recordDimension.recordStep=i.recordStep,n}(t,n),this.buffer=t}get version(){return 1===this.header.version?"classic format":"64-bit offset format"}get recordDimension(){return this.header.recordDimension}get dimensions(){return this.header.dimensions}get globalAttributes(){return this.header.globalAttributes}get variables(){return this.header.variables}hasDataVariable(e){return this.header.variables&&-1!==this.header.variables.findIndex(t=>t.name===e)}getDataVariable(e){var t
let n
if(n="string"==typeof e?null===(t=this.header.variables)||void 0===t?void 0:t.find(t=>t.name===e):e,void 0===n)throw new Error("variable not found")
return this.buffer.seek(n.offset),n.record?function(e,t,n){const r=Zt(t.type),i=t.size?t.size/Yt(r):1,o=n.length,a=new Array(o),s=n.recordStep
for(let l=0;l<o;l++){const t=e.offset
a[l]=Jt(e,r,i),e.seek(t+s)}return a}(this.buffer,n,this.header.recordDimension):function(e,t){const n=Zt(t.type),r=t.size/Yt(n),i=new Array(r)
for(let o=0;o<r;o++)i[o]=Jt(e,n,1)
return i}(this.buffer,n)}}var nn,rn
!function(e){e.is=function(e){return"prmtop"===(null==e?void 0:e.kind)},e.fromPrmtop=function(e){return{kind:"prmtop",name:e.title.join(" ")||"PRMTOP",data:e}}}(nn||(nn={})),function(e){e.is=function(e){return"top"===(null==e?void 0:e.kind)},e.fromTop=function(e){return{kind:"top",name:e.system||"TOP",data:e}}}(rn||(rn={}))
var on=n(42127)
const an=Me.H.BuiltIn({name:"coordinates-from-dcd",display:{name:"Parse DCD",description:"Parse DCD binary data."},from:[Me.O.Data.Binary],to:Me.O.Molecule.Coordinates})({apply:({a:e})=>i.Task.create("Parse DCD",async t=>{const n=await(a=e.data,i.Task.create("Parse DCD",async e=>{try{const e=function(e){const t=new DataView(e.buffer),n=Object.create(null),r=[]
let i=0
const a=new Int32Array(e.buffer,0,23),s=a[0]!==t.getInt32(0)
if(84!==a[0]){const n=e.byteLength
for(let e=0;e<n;e+=4)t.setFloat32(e,t.getFloat32(e),!0)}if(84!==a[0])throw new Error("dcd bad format, header block start")
if("CORD"!==String.fromCharCode(t.getUint8(4),t.getUint8(5),t.getUint8(6),t.getUint8(7)))throw new Error("dcd bad format, format string")
let l=!1,c=!1,u=!1
if(0!==a[22]&&(l=!0,0!==a[12]&&(c=!0),1===a[13]&&(u=!0)),n.NSET=a[2],n.ISTART=a[3],n.NSAVC=a[4],n.NAMNF=a[10],n.DELTA=l?t.getFloat32(44,s):t.getFloat64(44,s),84!==a[22])throw new Error("dcd bad format, header block end")
i=i+84+8
const d=t.getInt32(i,s),p=i+1
if((d-4)%80!=0)throw new Error("dcd bad format, title block start")
if(n.TITLE=(0,o.$q)(e.subarray(p,d)),t.getInt32(p+d+4-1,s)!==d)throw new Error("dcd bad format, title block end")
if(i=i+d+8,4!==t.getInt32(i,s))throw new Error("dcd bad format, natom block start")
if(n.NATOM=t.getInt32(i+4,s),4!==t.getInt32(i+8,s))throw new Error("dcd bad format, natom block end")
if(i=i+4+8,n.NAMNF>0)throw new Error("dcd format with fixed atoms unsupported, aborting")
const h=n.NATOM,f=4*h
for(let o=0,m=n.NSET;o<m;++o){const n=Object.create(null)
n.elementCount=h,c&&(i+=4,n.cell=[t.getFloat64(i,s),t.getFloat64(i+1,s),t.getFloat64(i+16,s),t.getFloat64(i+24,s),t.getFloat64(i+32,s),t.getFloat64(i+40,s)],i+=48,i+=4)
for(let r=0;r<3;++r){if(t.getInt32(i,s)!==f)throw new Error(`dcd bad format, coord block start: ${o}, ${r}`)
i+=4
const a=new Float32Array(e.buffer,i,h)
if(0===r?n.x=a:1===r?n.y=a:n.z=a,i+=f,t.getInt32(i,s)!==f)throw new Error(`dcd bad format, coord block end: ${o}, ${r}`)
i+=4}u&&(i+=4+t.getInt32(i,s)+4),r.push(n)}return{header:n,frames:r}}(a)
return r.H.success(e)}catch(e){return r.H.error(e)}})).runInContext(t)
var a
if(n.isError)throw new Error(n.message)
const s=await function(e){return i.Task.create("Parse DCD",async t=>{await t.update("Converting to coordinates")
const{header:n}=e,r=n.DELTA?(0,R.g)(20.45482949774598*n.DELTA,"ps"):(0,R.g)(1,"step"),i=n.ISTART>=1?(0,R.g)((n.ISTART-1)*r.value,r.unit):(0,R.g)(0,r.unit),o=[]
for(let a=0,s=e.frames.length;a<s;++a){const t=e.frames[a],n={elementCount:t.elementCount,time:(0,R.g)(i.value+r.value*a,r.unit),x:t.x,y:t.y,z:t.z,xyzOrdering:{isIdentity:!0}}
if(t.cell){const e=t.cell
e[1]>=-1&&e[1]<=1&&e[3]>=-1&&e[3]<=1&&e[4]>=-1&&e[4]<=1?n.cell=L.create(f.eB.create(e[0],e[2],e[5]),f.eB.create((0,O.pu)(90-90*Math.asin(e[1])/O.fC),(0,O.pu)(90-90*Math.asin(e[3])/O.fC),(0,O.pu)(90-90*Math.asin(e[4])/O.fC))):e[0]<0||e[1]<0||e[2]<0||e[3]<0||e[4]<0||e[5]<0||e[3]>180||e[4]>180||e[5]>180?n.cell=L.fromBasis(f.eB.create(e[0],e[1],e[3]),f.eB.create(e[1],e[2],e[4]),f.eB.create(e[3],e[4],e[5])):n.cell=L.create(f.eB.create(e[0],e[2],e[5]),f.eB.create((0,O.pu)((0,N.T)(e[1],0,N.p)?90:e[1]),(0,O.pu)((0,N.T)(e[3],0,N.p)?90:e[3]),(0,O.pu)((0,N.T)(e[4],0,N.p)?90:e[4])))}o.push(n)}return R.E.create(o,r,i)})}(n.result).runInContext(t)
return new Me.O.Molecule.Coordinates(s,{label:e.label,description:"Coordinates"})})}),sn=Me.H.BuiltIn({name:"coordinates-from-xtc",display:{name:"Parse XTC",description:"Parse XTC binary data."},from:[Me.O.Data.Binary],to:Me.O.Molecule.Coordinates})({apply:({a:e})=>i.Task.create("Parse XTC",async t=>{const n=await(o=e.data,i.Task.create("Parse XTC",async e=>{try{e.update({canAbort:!0,message:"Parsing trajectory..."})
const t=await async function(e,t){const n=new DataView(t.buffer,t.byteOffset),r={frames:[],boxes:[],times:[],timeOffset:0,deltaTime:0},i=r.frames,o=r.boxes,a=r.times,s=[0,0,0,0,0,0],l=[0,0,0],c=[0,0,0],u=[0,0,0],d=[.1,.1,.1],p=[.1,.1,.1]
let h=0
const f=pt.buf
for(;;){let r
const m=n.getInt32(h+4)
h+=12,a.push(n.getFloat32(h)),h+=4
const g=new Float32Array(9)
for(let e=0;e<9;++e)g[e]=10*n.getFloat32(h),h+=4
if(o.push(g),m<=9){r={count:m,x:new Float32Array(m),y:new Float32Array(m),z:new Float32Array(m)},h+=4
for(let e=0;e<m;++e)r.x[e]=n.getFloat32(h),r.y[e]=n.getFloat32(h+4),r.z[e]=n.getFloat32(h+8),h+=12}else{f[0]=f[1]=f[2]=0,l[0]=l[1]=l[2]=0,u[0]=u[1]=u[2]=0,c[0]=c[1]=c[2]=0,d[0]=d[1]=d[2]=0,p[0]=p[1]=p[2]=0,r={count:m,x:new Float32Array(m),y:new Float32Array(m),z:new Float32Array(m)}
let e=0
const i=n.getInt32(h)
h+=4
const o=n.getFloat32(h)
let a
h+=4,s[0]=n.getInt32(h),s[1]=n.getInt32(h+4),s[2]=n.getInt32(h+8),s[3]=n.getInt32(h+12),s[4]=n.getInt32(h+16),s[5]=n.getInt32(h+20),l[0]=s[3]-s[0]+1,l[1]=s[4]-s[1]+1,l[2]=s[5]-s[2]+1,h+=24,(l[0]|l[1]|l[2])>16777215?(c[0]=pt.sizeOfInt(l[0]),c[1]=pt.sizeOfInt(l[1]),c[2]=pt.sizeOfInt(l[2]),a=0):a=pt.sizeOfInts(3,l)
let g=n.getInt32(h)
h+=4
let y=g-1
y=9>y?9:y
let v=dt[y]/2|0,b=dt[g]/2|0
u[0]=u[1]=u[2]=dt[g]
const x=4*Math.ceil(n.getInt32(h)/4)
h+=4
const S=1/o
let _=0,C=0
for(d[0]=d[1]=d[2]=0;C<i;){0===a?(d[0]=pt.decodeBits(t,h,c[0]),d[1]=pt.decodeBits(t,h,c[1]),d[2]=pt.decodeBits(t,h,c[2])):pt.decodeInts(t,h,a,l,d),C++,d[0]+=s[0],d[1]+=s[1],d[2]+=s[2],p[0]=d[0],p[1]=d[1],p[2]=d[2]
let n=0
if(1===pt.decodeBits(t,h,1)&&(_=pt.decodeBits(t,h,5),n=_%3,_-=n,n--),_>0){d[0]=d[1]=d[2]=0
for(let n=0;n<_;n+=3){if(pt.decodeInts(t,h,g,u,d),C++,d[0]+=p[0]-b,d[1]+=p[1]-b,d[2]+=p[2]-b,0===n){let t=d[0]
d[0]=p[0],p[0]=t,t=d[1],d[1]=p[1],p[1]=t,t=d[2],d[2]=p[2],p[2]=t,r.x[e]=p[0]*S,r.y[e]=p[1]*S,r.z[e]=p[2]*S,e++}else p[0]=d[0],p[1]=d[1],p[2]=d[2]
r.x[e]=d[0]*S,r.y[e]=d[1]*S,r.z[e]=d[2]*S,e++}}else r.x[e]=d[0]*S,r.y[e]=d[1]*S,r.z[e]=d[2]*S,e++
g+=n,n<0?(b=v,v=g>9?dt[g-1]/2|0:0):n>0&&(v=b,b=dt[g]/2|0),u[0]=u[1]=u[2]=dt[g],0!==u[0]&&0!==u[1]&&0!==u[2]||ft()}h+=x}for(let e=0;e<m;e++)r.x[e]*=10,r.y[e]*=10,r.z[e]*=10
if(i.push(r),e.shouldUpdate&&await e.update({current:h,max:t.length}),h>=t.length)break}return a.length>=1&&(r.timeOffset=a[0]),a.length>=2&&(r.deltaTime=a[1]-a[0]),r}(e,o)
return r.H.success(t)}catch(e){return r.H.error(""+e)}})).runInContext(t)
var o
if(n.isError)throw new Error(n.message)
const a=await function(e){return i.Task.create("Parse XTC",async t=>{await t.update("Converting to coordinates")
const n=(0,R.g)(e.deltaTime,"step"),r=(0,R.g)(e.timeOffset,n.unit),i=[]
for(let o=0,a=e.frames.length;o<a;++o){const t=e.boxes[o],a=f.eB.fromArray((0,f.eB)(),t,0),s=f.eB.fromArray((0,f.eB)(),t,3),l=f.eB.fromArray((0,f.eB)(),t,6)
i.push({elementCount:e.frames[o].count,cell:L.fromBasis(a,s,l),x:e.frames[o].x,y:e.frames[o].y,z:e.frames[o].z,xyzOrdering:{isIdentity:!0},time:(0,R.g)(r.value+n.value*o,n.unit)})}return R.E.create(i,n,r)})}(n.result).runInContext(t)
return new Me.O.Molecule.Coordinates(a,{label:e.label,description:"Coordinates"})})}),ln=Me.H.BuiltIn({name:"coordinates-from-trr",display:{name:"Parse TRR",description:"Parse TRR binary data."},from:[Me.O.Data.Binary],to:Me.O.Molecule.Coordinates})({apply:({a:e})=>i.Task.create("Parse TRR",async t=>{const n=await(o=e.data,i.Task.create("Parse TRR",async e=>{try{e.update({canAbort:!0,message:"Parsing trajectory..."})
const t=await async function(e){const t=new DataView(e.buffer),n={frames:[],boxes:[],times:[],timeOffset:0,deltaTime:0},r=n.frames,i=n.boxes,o=n.times
let a=0
for(;;){a+=8
const n=t.getInt32(a)
a+=4,a+=n
const s=t.getInt32(a+8),l=t.getInt32(a+12),c=t.getInt32(a+16),u=t.getInt32(a+28),d=t.getInt32(a+32),p=t.getInt32(a+36),h=t.getInt32(a+40)
a+=52
const f=s/9,m=3*h
if(8===f?o.push(t.getFloat64(a)):o.push(t.getFloat32(a)),a+=2*f,s){const e=new Float32Array(9)
if(8===f)for(let n=0;n<9;++n)e[n]=10*t.getFloat64(a),a+=8
else for(let n=0;n<9;++n)e[n]=10*t.getFloat32(a),a+=4
i.push(e)}if(a+=l,a+=c,u){const n=new Float32Array(h),i=new Float32Array(h),o=new Float32Array(h)
if(8===f)for(let e=0;e<h;++e)n[e]=10*t.getFloat64(a),i[e]=10*t.getFloat64(a+8),o[e]=10*t.getFloat64(a+16),a+=24
else{const t=new Uint32Array(e.buffer,a,m)
for(let e=0;e<m;++e){const n=t[e]
t[e]=(255&n)<<24|(65280&n)<<8|n>>8&65280|n>>24&255}const r=new Float32Array(e.buffer,a,m)
for(let e=0;e<h;++e)n[e]=10*r[3*e],i[e]=10*r[3*e+1],o[e]=10*r[3*e+2],a+=12}r.push({count:h,x:n,y:i,z:o})}if(a+=d,a+=p,a>=e.byteLength)break}return o.length>=1&&(n.timeOffset=o[0]),o.length>=2&&(n.deltaTime=o[1]-o[0]),n}(o)
return r.H.success(t)}catch(e){return r.H.error(""+e)}})).runInContext(t)
var o
if(n.isError)throw new Error(n.message)
const a=await function(e){return i.Task.create("Parse TRR",async t=>{await t.update("Converting to coordinates")
const n=(0,R.g)(e.deltaTime,"step"),r=(0,R.g)(e.timeOffset,n.unit),i=[]
for(let o=0,a=e.frames.length;o<a;++o){const t=e.boxes[o],a=f.eB.fromArray((0,f.eB)(),t,0),s=f.eB.fromArray((0,f.eB)(),t,3),l=f.eB.fromArray((0,f.eB)(),t,6)
i.push({elementCount:e.frames[o].count,cell:L.fromBasis(a,s,l),x:e.frames[o].x,y:e.frames[o].y,z:e.frames[o].z,xyzOrdering:{isIdentity:!0},time:(0,R.g)(r.value+n.value*o,n.unit)})}return R.E.create(i,n,r)})}(n.result).runInContext(t)
return new Me.O.Molecule.Coordinates(a,{label:e.label,description:"Coordinates"})})}),cn=Me.H.BuiltIn({name:"coordinates-from-nctraj",display:{name:"Parse NCTRAJ",description:"Parse NCTRAJ binary data."},from:[Me.O.Data.Binary],to:Me.O.Molecule.Coordinates})({apply:({a:e})=>i.Task.create("Parse NCTRAJ",async t=>{const n=await(o=e.data,i.Task.create("Parse NCTRAJ",async e=>{try{e.update({canAbort:!0,message:"Parsing trajectory..."})
const t=await async function(e){const t=new tn(e.buffer),n={coordinates:[],time:[],timeOffset:0,deltaTime:1}
for(const r of t.getDataVariable("coordinates"))n.coordinates.push(r)
if(t.hasDataVariable("velocities")){const e=[]
for(const n of t.getDataVariable("velocities"))e.push(n)
n.velocities=e}if(t.hasDataVariable("forces")){const e=[]
for(const n of t.getDataVariable("forces"))e.push(n)
n.forces=e}if(t.hasDataVariable("cell_lengths")){const e=[]
for(const n of t.getDataVariable("cell_lengths"))e.push(n)
n.cell_lengths=e}if(t.hasDataVariable("cell_angles")){const e=[]
for(const n of t.getDataVariable("cell_angles"))e.push(n)
n.cell_angles=e}if(t.hasDataVariable("time")){const e=[]
for(const n of t.getDataVariable("time"))e.push(n)
n.time=e}return n.time&&(n.time.length>=1&&(n.timeOffset=n.time[0]),n.time.length>=2&&(n.deltaTime=n.time[1]-n.time[0])),n}(o)
return r.H.success(t)}catch(e){return r.H.error(""+e)}})).runInContext(t)
var o
if(n.isError)throw new Error(n.message)
const a=await function(e){return i.Task.create("Parse NCTRAJ",async t=>{await t.update("Converting to coordinates")
const n=(0,R.g)(e.deltaTime,"step"),r=(0,R.g)(e.timeOffset,n.unit),i=[]
for(let o=0,a=e.coordinates.length;o<a;++o){const t=e.coordinates[o],a=t.length/3,s=new Float32Array(a),l=new Float32Array(a),c=new Float32Array(a)
for(let e=0,n=t.length;e<n;e+=3)s[e/3]=t[e],l[e/3]=t[e+1],c[e/3]=t[e+2]
const u={elementCount:a,x:s,y:l,z:c,xyzOrdering:{isIdentity:!0},time:(0,R.g)(r.value+n.value*o,n.unit)}
if(e.cell_lengths){const t=e.cell_lengths[o],n=f.eB.scale((0,f.eB)(),f.eB.unitX,t[0]),r=f.eB.scale((0,f.eB)(),f.eB.unitY,t[1]),i=f.eB.scale((0,f.eB)(),f.eB.unitZ,t[2])
u.cell=L.fromBasis(n,r,i)}i.push(u)}return R.E.create(i,n,r)})}(n.result).runInContext(t)
return new Me.O.Molecule.Coordinates(a,{label:e.label,description:"Coordinates"})})}),un=Me.H.BuiltIn({name:"coordinates-from-lammpstraj",display:{name:"Parse LAMMPSTRAJ",description:"Parse LAMMPSTRAJ data."},from:[Me.O.Data.String],to:Me.O.Molecule.Coordinates})({apply:({a:e})=>i.Task.create("Parse LAMMPSTRAJ",async t=>{const n=await Rt(e.data).runInContext(t)
if(n.isError)throw new Error(n.message)
const r=await Nt(n.result).runInContext(t)
return new Me.O.Molecule.Coordinates(r,{label:e.label,description:"Coordinates"})})}),dn=Me.H.BuiltIn({name:"topology-from-psf",display:{name:"PSF Topology",description:"Create topology from PSF."},from:[Me.O.Format.Psf],to:Me.O.Molecule.Topology})({apply:({a:e})=>i.Task.create("Create Topology",async t=>{const n=await function(e){return i.Task.create("Parse PSF",async t=>{const n=Ce.fromPsf(e),r=function(e){const t=new Array(e.count),n=new Array(e.count),r=new Uint32Array(e.count),i=new Uint32Array(e.count),o=new Array(e.count),s=new W.V,l=new H.N(e.residueId,e.atomName)
let c="",u=0,d="",p=0,h=e.segmentName.value(0),f=!1,m=G.MoleculeType.Unknown,g=-1
for(let a=0,v=e.count;a<v;++a){const y=e.residueId.value(a),v=e.segmentName.value(a)
if(h!==v?(d=$(u),u+=1,p=0,f=!0,h=v):f=!1,f||y!==g){const t=e.residueName.value(a),n=(0,G.getMoleculeType)(l.add(t,a).type,t)
f||n===m&&y===g+1||(d=$(u),u+=1,p=0),c=s.getEntityId(t,n,d),p+=1,g=y,m=n}t[a]=c,n[a]=d,r[a]=p,i[a]=a,o[a]=U(e.atomName.value(a),e.residueName.value(a))}const y=a.XI.ofPartialColumns(Y.e.atom_site,{auth_asym_id:e.segmentName,auth_atom_id:e.atomName,auth_comp_id:e.residueName,auth_seq_id:e.residueId,id:a.VP.ofIntArray(i),label_asym_id:a.VP.ofStringArray(n),label_atom_id:e.atomName,label_comp_id:e.residueName,label_seq_id:a.VP.ofIntArray(r),label_entity_id:a.VP.ofStringArray(t),occupancy:a.VP.ofConst(1,e.count,a.VP.Schema.float),type_symbol:a.VP.ofStringArray(o),pdbx_PDB_model_num:a.VP.ofConst(1,e.count,a.VP.Schema.int)},e.count)
return(0,Y.z)({entity:s.getEntityTable(),chem_comp:l.getChemCompTable(),atom_site:y})}(e.atoms),{atomIdA:i,atomIdB:o}=e.bonds,s={indexA:a.VP.ofLambda({value:e=>i.value(e)-1,rowCount:i.rowCount,schema:i.schema}),indexB:a.VP.ofLambda({value:e=>o.value(e)-1,rowCount:o.rowCount,schema:o.schema}),order:a.VP.ofConst(1,e.bonds.count,a.VP.Schema.int)}
return we.c.create(e.id,r,s,n)})}(e.data).runInContext(t)
return new Me.O.Molecule.Topology(n,{label:n.label||e.label,description:"Topology"})})}),pn=Me.H.BuiltIn({name:"topology-from-prmtop",display:{name:"PRMTOP Topology",description:"Create topology from PRMTOP."},from:[Me.O.Format.Prmtop],to:Me.O.Molecule.Topology})({apply:({a:e})=>i.Task.create("Create Topology",async t=>{const n=await function(e){return i.Task.create("Parse PRMTOP",async t=>{const n=nn.fromPrmtop(e),r=function(e){const{pointers:t,residuePointer:n,residueLabel:r,atomName:i}=e,o=t.NATOM,s=t.NRES,l=new Uint32Array(o),c=[],u=(e,t,n)=>{const i=r.value(e)
for(let r=t,o=n;r<o;++r)l[r]=e+1,c[r]=i}
for(let a=0,B=s-1;a<B;++a)u(a,n.value(a)-1,n.value(a+1)-1)
u(s-1,n.value(s-1)-1,o)
const d=a.VP.ofIntArray(l),p=a.VP.ofStringArray(c),h=new Array(o),f=new Array(o),m=new Uint32Array(o),g=new Uint32Array(o),y=new W.V,v=new H.N(d,i)
let b="",x=0,S="",_=0,C=G.MoleculeType.Unknown,w=-1
for(let a=0,B=o;a<B;++a){const e=d.value(a)
if(e!==w){const t=p.value(a),n=(0,G.getMoleculeType)(v.add(t,a).type,t)
n!==C&&(S=$(x),x+=1,_=0),b=y.getEntityId(t,n,S),_+=1,w=e,C=n}h[a]=b,f[a]=S,m[a]=_,g[a]=a}const T=a.VP.ofIntArray(g),A=a.VP.ofStringArray(f),I=new Array(o)
for(let a=0;a<o;++a)I[a]=U(i.value(a),p.value(a))
const P=a.XI.ofPartialColumns(Y.e.atom_site,{auth_asym_id:A,auth_atom_id:a.VP.asArrayColumn(i),auth_comp_id:p,auth_seq_id:d,id:a.VP.asArrayColumn(T),label_asym_id:A,label_atom_id:a.VP.asArrayColumn(i),label_comp_id:p,label_seq_id:a.VP.ofIntArray(m),label_entity_id:a.VP.ofStringArray(h),occupancy:a.VP.ofConst(1,o,a.VP.Schema.float),type_symbol:a.VP.ofStringArray(I),pdbx_PDB_model_num:a.VP.ofConst(1,o,a.VP.Schema.int)},o)
return(0,Y.z)({entity:y.getEntityTable(),chem_comp:v.getChemCompTable(),atom_site:P})}(e),{pointers:{NBONH:i,NBONA:o},bondsIncHydrogen:s,bondsWithoutHydrogen:l}=e,c=i+o,u={indexA:a.VP.ofLambda({value:e=>e<i?s.value(3*e)/3:l.value(3*(e-i))/3,rowCount:c,schema:a.VP.Schema.int}),indexB:a.VP.ofLambda({value:e=>e<i?s.value(3*e+1)/3:l.value(3*(e-i)+1)/3,rowCount:c,schema:a.VP.Schema.int}),order:a.VP.ofConst(1,c,a.VP.Schema.int)}
return we.c.create(e.title.join(" ")||"PRMTOP",r,u,n)})}(e.data).runInContext(t)
return new Me.O.Molecule.Topology(n,{label:n.label||e.label,description:"Topology"})})}),hn=Me.H.BuiltIn({name:"topology-from-top",display:{name:"TOP Topology",description:"Create topology from TOP."},from:[Me.O.Format.Top],to:Me.O.Molecule.Topology})({apply:({a:e})=>i.Task.create("Create Topology",async t=>{const n=await function(e){return i.Task.create("Parse TOP",async t=>{const n=rn.fromTop(e),r=function(e){const{molecules:t,compounds:n}=e,r={}
let i=0
for(let B=0,E=t._rowCount;B<E;++B){const e=t.compound.value(B),o=t.molCount.value(B),{atoms:s}=n[e]
a.VP.asArrayColumn(s.atom),a.VP.asArrayColumn(s.resnr),a.VP.asArrayColumn(s.residu),i+=o*s._rowCount
let l=s.resnr.value(0)
r[e]=!0
for(let t=1,n=s._rowCount;t<n;++t){const n=s.resnr.value(t)
if(n!==l){r[e]=!1
break}l=n}}const o=new Array(i),s=new Uint32Array(i),l=new Array(i)
let c=0
for(let a=0,B=t._rowCount;a<B;++a){const e=t.compound.value(a),i=t.molCount.value(a),{atoms:u}=n[e],d=r[e]
for(let t=0;t<i;++t)for(let e=0,n=u._rowCount;e<n;++e)o[c]=u.atom.value(e),s[c]=u.resnr.value(e),l[c]=u.residu.value(e),d&&(s[c]+=t),c+=1}const u=a.VP.ofStringArray(o),d=a.VP.ofIntArray(s),p=a.VP.ofStringArray(l),h=new Array(i),f=new Array(i),m=new Uint32Array(i),g=new Uint32Array(i),y=new W.V,v=new H.N(d,u)
let b="",x=0,S="",_=0,C=G.MoleculeType.Unknown,w=-1
for(let a=0,B=i;a<B;++a){const e=d.value(a)
if(e!==w){const t=p.value(a),n=(0,G.getMoleculeType)(v.add(t,a).type,t)
n!==C&&(S=$(x),x+=1,_=0),b=y.getEntityId(t,n,S),_+=1,w=e,C=n}h[a]=b,f[a]=S,m[a]=_,g[a]=a}const T=a.VP.ofIntArray(g),A=a.VP.ofStringArray(f),I=new Array(i)
for(let a=0;a<i;++a)I[a]=U(u.value(a),p.value(a))
const P=a.XI.ofPartialColumns(Y.e.atom_site,{auth_asym_id:A,auth_atom_id:a.VP.asArrayColumn(u),auth_comp_id:p,auth_seq_id:d,id:a.VP.asArrayColumn(T),label_asym_id:A,label_atom_id:a.VP.asArrayColumn(u),label_comp_id:p,label_seq_id:a.VP.ofIntArray(m),label_entity_id:a.VP.ofStringArray(h),occupancy:a.VP.ofConst(1,i,a.VP.Schema.float),type_symbol:a.VP.ofStringArray(I),pdbx_PDB_model_num:a.VP.ofConst(1,i,a.VP.Schema.int)},i)
return(0,Y.z)({entity:y.getEntityTable(),chem_comp:v.getChemCompTable(),atom_site:P})}(e),i=function(e){const{molecules:t,compounds:n}=e,r=[],i=[]
let o=0
for(let a=0,s=t._rowCount;a<s;++a){const e=t.compound.value(a),s=t.molCount.value(a),{atoms:l,bonds:c}=n[e]
if(c)for(let t=0;t<s;++t){for(let e=0,t=c._rowCount;e<t;++e)r.push(c.ai.value(e)-1+o),i.push(c.aj.value(e)-1+o)
o+=l._rowCount}else if("TIP3"===e)for(let t=0;t<s;++t)r.push(0+o),i.push(1+o),r.push(0+o),i.push(2+o),o+=l._rowCount
else o+=s*l._rowCount}return{indexA:a.VP.ofIntArray(r),indexB:a.VP.ofIntArray(i),order:a.VP.ofConst(1,r.length,a.VP.Schema.int)}}(e)
return we.c.create(e.system||"TOP",r,i,n)})}(e.data).runInContext(t)
return new Me.O.Molecule.Topology(n,{label:n.label||e.label,description:"Topology"})})})
async function fn(e,t,n){if(t.type===Me.O.Molecule.Topology.type){const r=t.data
return await Ae.Model.trajectoryFromTopologyAndCoordinates(r,n).runInContext(e)}if(t.type===Me.O.Molecule.Model.type){const e=t.data
return Ae.Model.trajectoryFromModelAndCoordinates(e,n)}throw new Error("no model/topology found")}const mn=Me.H.BuiltIn({name:"trajectory-from-model-and-coordinates",display:{name:"Trajectory from Topology & Coordinates",description:"Create a trajectory from existing model/topology and coordinates."},from:Me.O.Root,to:Me.O.Molecule.Trajectory,params:{modelRef:S.t.Text("",{isHidden:!0}),coordinatesRef:S.t.Text("",{isHidden:!0})}})({apply:({params:e,dependencies:t})=>i.Task.create("Create trajectory from model/topology and coordinates",async n=>{const r=t[e.coordinatesRef].data,i=await fn(n,t[e.modelRef],r),o={label:"Trajectory",description:`${i.frameCount} model${1===i.frameCount?"":"s"}`}
return new Me.O.Molecule.Trajectory(i,o)})}),gn=Me.H.BuiltIn({name:"trajectory-from-blob",display:{name:"Parse Blob",description:"Parse format blob into a single trajectory."},from:Me.O.Format.Blob,to:Me.O.Molecule.Trajectory})({apply:({a:e})=>i.Task.create("Parse Format Blob",async t=>{const n=[]
for(const o of e.data){if("cif"!==o.kind)continue
const e=o.data.blocks[0],r=await(0,ee.OQ)(e).runInContext(t)
if(0===r.frameCount)throw new Error("No models found.")
for(let o=0;o<r.frameCount;o++){const e=await i.Task.resolveInContext(r.getFrameAtIndex(o),t)
n.push(e)}}for(let e=0;e<n.length;e++)Ae.Model.TrajectoryInfo.set(n[e],{index:e,size:n.length})
const r={label:"Trajectory",description:`${n.length} model${1===n.length?"":"s"}`}
return new Me.O.Molecule.Trajectory(new Ae.ArrayTrajectory(n),r)})})
function yn(e){return{label:`${e.representative.entry}`,description:`${e.frameCount} model${1===e.frameCount?"":"s"}`}}const vn=Me.H.BuiltIn({name:"trajectory-from-mmcif",display:{name:"Trajectory from mmCIF",description:"Identify and create all separate models in the specified CIF data block"},from:Me.O.Format.Cif,to:Me.O.Molecule.Trajectory,params(e){if(!e)return{loadAllBlocks:S.t.Optional(S.t.Boolean(!1,{description:"If True, ignore Block Header and Block Index parameters and parse all datablocks into a single trajectory."})),blockHeader:S.t.Optional(S.t.Text(void 0,{description:"Header of the block to parse. If not specifed, Block Index parameter applies.",hideIf:e=>!0===e.loadAllBlocks})),blockIndex:S.t.Optional(S.t.Numeric(0,{min:0,step:1},{description:"Zero-based index of the block to parse. Only applies when Block Header parameter is not specified.",hideIf:e=>!0===e.loadAllBlocks||e.blockHeader}))}
const{blocks:t}=e.data,n=t.map(e=>[e.header,e.header])
return n.push(["","[Use Block Index]"]),{loadAllBlocks:S.t.Optional(S.t.Boolean(!1,{description:"If True, ignore Block Header and Block Index parameters and parse all data blocks into a single trajectory."})),blockHeader:S.t.Optional(S.t.Select(t[0]&&t[0].header,n,{description:"Header of the block to parse. If not specifed, Block Index parameter applies.",hideIf:e=>!0===e.loadAllBlocks})),blockIndex:S.t.Optional(S.t.Numeric(0,{min:0,step:1,max:t.length-1},{description:"Zero-based index of the block to parse. Only applies when Block Header parameter is not specified.",hideIf:e=>!0===e.loadAllBlocks||e.blockHeader}))}}})({isApplicable:e=>e.data.blocks.length>0,apply:({a:e,params:t})=>i.Task.create("Parse mmCIF",async n=>{var r
let o
if(t.loadAllBlocks){const t=[]
for(const r of e.data.blocks){n.shouldUpdate&&await n.update(`Parsing ${r.header}...`)
const e=await(0,ee.OQ)(r).runInContext(n)
for(let r=0;r<e.frameCount;r++)t.push(await i.Task.resolveInContext(e.getFrameAtIndex(r),n))}o=new Ae.ArrayTrajectory(t)}else{const i=t.blockHeader||e.data.blocks[null!==(r=t.blockIndex)&&void 0!==r?r:0].header,a=e.data.blocks.find(e=>e.header===i)
if(!a)throw new Error(`Data block '${[i]}' not found.`)
o=!a.categoryNames.includes("chem_comp_atom")||a.categoryNames.includes("atom_site")||a.categoryNames.includes("ihm_sphere_obj_site")||a.categoryNames.includes("ihm_gaussian_obj_site")?await(0,ee.OQ)(a,e.data).runInContext(n):await(0,ee.YG)(a).runInContext(n)}if(0===o.frameCount)throw new Error("No models found.")
const a=yn(o)
return new Me.O.Molecule.Trajectory(o,a)})}),bn=Me.H.BuiltIn({name:"trajectory-from-pdb",display:{name:"Parse PDB",description:"Parse PDB string and create trajectory."},from:[Me.O.Data.String],to:Me.O.Molecule.Trajectory,params:{isPdbqt:S.t.Boolean(!1)}})({apply:({a:e,params:t})=>i.Task.create("Parse PDB",async n=>{const o=await function(e,t,n=!1){return i.Task.create("Parse PDB",async i=>r.H.success({lines:await s._F.readAllLinesAsync(e,i),id:t,isPdbqt:n}))}(e.data,e.label,t.isPdbqt).runInContext(n)
if(o.isError)throw new Error(o.message)
const l=await(c=o.result,i.Task.create("Parse PDB",async e=>{var t
await e.update("Converting to mmCIF")
const n=await xe(c),r=ee.K4.fromFrame(n,void 0,Se.create(c)),i=(0,Y.z)(r.data.db,!0),o=await(0,Z.X)(i,r,e),s=null===(t=n.categories.atom_site)||void 0===t?void 0:t.getField("partial_charge")
if(s&&1===o.frameCount){const e=o.representative,t=e.atomicHierarchy.atomSourceIndex,n=a.VP.isIdentity(t)?void 0:t.toArray({array:Int32Array}),r=s.toFloatArray(),i=n?a.VP.ofFloatArray(a.VP.mapToArray(t,e=>r[e],Float32Array)):a.VP.ofFloatArray(r)
_e.j.Provider.set(e,{data:i,type:"GASTEIGER"})}return o})).runInContext(n)
var c
const u=yn(l)
return new Me.O.Molecule.Trajectory(l,u)})}),xn=Me.H.BuiltIn({name:"trajectory-from-gro",display:{name:"Parse GRO",description:"Parse GRO string and create trajectory."},from:[Me.O.Data.String],to:Me.O.Molecule.Trajectory})({apply:({a:e})=>i.Task.create("Parse GRO",async t=>{const n=await(o=e.data,i.Task.create("Parse GRO",async e=>await async function(e,t){const n=(0,s._F)(e)
await t.update({message:"Parsing...",current:0,max:e.length})
const i=[]
for(;n.position<e.length;){const e=c(n,t)
u(e),d(e)
const r=await p(e)
h(e),i.push({header:e.header,atoms:r})}const o={structures:i}
return r.H.success(o)}(o,e))).runInContext(t)
var o
if(n.isError)throw new Error(n.message)
const a=await(l=n.result,i.Task.create("Parse GRO",async e=>{const t=X.fromGro(l),n=[]
for(let r=0,i=l.structures.length;r<i;++r){const i=J(l.structures[r].atoms,r+1),o=await(0,Z.X)(i,t,e)
1===o.frameCount&&n.push(o.representative)}return new K.P(n)})).runInContext(t)
var l
const f=yn(a)
return new Me.O.Molecule.Trajectory(a,f)})}),Sn=Me.H.BuiltIn({name:"trajectory-from-xyz",display:{name:"Parse XYZ",description:"Parse XYZ string and create trajectory."},from:[Me.O.Data.String],to:Me.O.Molecule.Trajectory})({apply:({a:e})=>i.Task.create("Parse XYZ",async t=>{const n=await(o=e.data,i.Task.create("Parse Mol",async()=>function(e){const t=(0,s._F)(e),n=[]
for(;;){const e=mt(t)
if(0===e.count)break
n.push(e)}const i={molecules:n}
return r.H.success(i)}(o))).runInContext(t)
var o
if(n.isError)throw new Error(n.message)
const l=await(u=n.result,i.Task.create("Parse XYZ",e=>function(e,t){const{molecules:n}=e
let r=0
for(const a of n)r+=a.count
const i=new Array(r),o=new Int32Array(r),s=new Float32Array(r),l=new Float32Array(r),c=new Float32Array(r),u=new Int32Array(r)
let d=0
for(let a=0;a<n.length;a++){const e=n[a]
for(let t=0;t<e.count;t++)i[d]=e.type_symbol.value(t),s[d]=e.x.value(t),l[d]=e.y.value(t),c[d]=e.z.value(t),o[d]=t,u[d]=a,d++}const p=a.VP.ofConst("MOL",r,a.VP.Schema.str),h=a.VP.ofConst("A",r,a.VP.Schema.str),f=a.VP.ofConst(1,r,a.VP.Schema.int),m=a.VP.ofStringArray(i),g=a.XI.ofPartialColumns(Y.e.atom_site,{auth_asym_id:h,auth_atom_id:m,auth_comp_id:p,auth_seq_id:f,Cartn_x:a.VP.ofFloatArray(s),Cartn_y:a.VP.ofFloatArray(l),Cartn_z:a.VP.ofFloatArray(c),id:a.VP.ofIntArray(o),label_asym_id:h,label_atom_id:m,label_comp_id:p,label_seq_id:f,label_entity_id:a.VP.ofConst("1",r,a.VP.Schema.str),occupancy:a.VP.ofConst(1,r,a.VP.Schema.float),type_symbol:m,pdbx_PDB_model_num:a.VP.ofIntArray(u)},r),y=new W.V
y.setNames([["MOL","Unknown Entity"]]),y.getEntityId("MOL",G.MoleculeType.Unknown,"A")
const v=new H.N(f,m)
v.setNames([["MOL","Unknown Molecule"]]),v.add("MOL",0)
const b=(0,Y.z)({entity:y.getEntityTable(),chem_comp:v.getChemCompTable(),atom_site:g})
return(0,Z.X)(b,ht.create(e),t)}(u,e))).runInContext(t),c=yn(l)
var u
return new Me.O.Molecule.Trajectory(l,c)})}),_n=Me.H.BuiltIn({name:"trajectory-from-lammps-data",display:{name:"Parse Lammps Data",description:"Parse Lammps Data from string and create trajectory."},from:[Me.O.Data.String],to:Me.O.Molecule.Trajectory,params:{unitsStyle:S.t.Select("real",S.t.arrayToOptions(yt))}})({apply:({a:e,params:t})=>i.Task.create("Parse Lammps Data",async n=>{const o=await(l=e.data,i.Task.create("Parse LammpsData",async e=>await async function(e,t){const n=(0,s._F)(e),i=function(e,t){return{tokenizer:e,runtimeCtx:t}}(n,t)
let o,l,c=0,u=0,d="full"
for(;n.tokenEnd<n.length;){const e=vt(i.tokenizer).trim()
if(e.includes("atoms"))c=parseInt(e.split(Ct)[0])
else if(e.includes("bonds"))u=parseInt(e.split(Ct)[0])
else if(e.includes("Masses"));else if(e.includes("Atoms")){const t=e.split("#")
if(t.length>1){const e=t[1].trim()
At.includes(e)?d=e:console.warn(`Unknown atom style: ${e}`)}o=await wt(i,c,d)}else e.includes("Bonds")&&(l=await Tt(i,u))}if(void 0===o)return r.H.error("no atoms data")
void 0===l&&(l={count:0,bondId:a.VP.ofIntArray([]),bondType:a.VP.ofIntArray([]),atomIdA:a.VP.ofIntArray([]),atomIdB:a.VP.ofIntArray([])})
const p={atoms:o,bonds:l}
return r.H.success(p)}(l,e))).runInContext(n)
var l
if(o.isError)throw new Error(o.message)
const c=await(d=o.result,p=t.unitsStyle,void 0===p&&(p="real"),i.Task.create("Parse Lammps Data",e=>async function(e,t,n="real"){const{atoms:r,bonds:i}=e,o=[],s=r.count,l=gt[n].scale,c=new Array(s),u=new Int32Array(s),d=new Float32Array(s),p=new Float32Array(s),h=new Float32Array(s),f=new Int32Array(s)
let m=0
for(let a=0;a<s;a++)c[m]=r.atomType.value(a).toString(),d[m]=r.x.value(a)*l,p[m]=r.y.value(a)*l,h[m]=r.z.value(a)*l,u[m]=r.atomId.value(a)-1,f[m]=0,m++
const g=a.VP.ofConst("MOL",s,a.VP.Schema.str),y=a.VP.ofLambda({value:e=>r.moleculeId.value(e).toString(),rowCount:s,schema:a.VP.Schema.str}),v=a.VP.ofConst(1,s,a.VP.Schema.int),b=a.VP.ofStringArray(c),x=a.XI.ofPartialColumns(Y.e.atom_site,{auth_asym_id:y,auth_atom_id:b,auth_comp_id:g,auth_seq_id:v,Cartn_x:a.VP.ofFloatArray(d),Cartn_y:a.VP.ofFloatArray(p),Cartn_z:a.VP.ofFloatArray(h),id:a.VP.ofIntArray(u),label_asym_id:y,label_atom_id:b,label_comp_id:g,label_seq_id:v,label_entity_id:a.VP.ofConst("1",s,a.VP.Schema.str),occupancy:a.VP.ofConst(1,s,a.VP.Schema.float),type_symbol:b,pdbx_PDB_model_num:a.VP.ofIntArray(f)},s),S=new W.V
S.setNames([["MOL","Unknown Entity"]]),S.getEntityId("MOL",G.MoleculeType.Unknown,"A")
const _=new H.N(v,b)
_.setNames([["MOL","Unknown Molecule"]]),_.add("MOL",0)
const C=(0,Y.z)({entity:S.getEntityTable(),chem_comp:_.getChemCompTable(),atom_site:x}),w=await(0,Z.X)(C,It.create(e),t)
if(w.frameCount>0){const e=w.representative
if(0!==i.count){const t=a.VP.ofIntArray(a.VP.mapToArray(i.atomIdA,e=>e-1,Int32Array)),n=a.VP.ofIntArray(a.VP.mapToArray(i.atomIdB,e=>e-1,Int32Array)),o=i.bondId,s=a.VP.ofConst(1,i.count,a.VP.Schema.int),l=a.VP.ofConst(G.BondType.Flag.Covalent,i.count,a.VP.Schema.int),c=Ge.z.fromData({pairs:{key:o,indexA:t,indexB:n,order:s,flag:l},count:r.count},{maxDistance:1/0})
Ge.z.Provider.set(e,c)}_e.j.Provider.set(e,{data:r.charge,type:"NO_CHARGES"}),o.push(e)}return new Ae.ArrayTrajectory(o)}(d,e,p))).runInContext(n),u=yn(c)
var d,p
return new Me.O.Molecule.Trajectory(c,u)})}),Cn=Me.H.BuiltIn({name:"trajectory-from-lammps-traj-data",display:{name:"Parse Lammps traj Data",description:"Parse Lammps Traj Data string and create trajectory."},from:[Me.O.Data.String],to:Me.O.Molecule.Trajectory,params:{unitsStyle:S.t.Select("real",S.t.arrayToOptions(yt))}})({apply:({a:e,params:t})=>i.Task.create("Parse Lammps Data",async n=>{const r=await Rt(e.data).runInContext(n)
if(r.isError)throw new Error(r.message)
const o=await(l=r.result,c=t.unitsStyle,void 0===c&&(c="real"),i.Task.create("Parse Lammps Traj Data",e=>async function(e,t,n="real"){const r=e.frames[0],i=r.count,o=r.atomMode,s=e.bounds[0],l={x:0,y:0,z:0},c={x:1,y:1,z:1},u=gt[n].scale
o.includes("s")&&(c.x=s.length[0],c.y=s.length[1],c.z=s.length[2],l.x=s.lower[0],l.y=s.lower[1],l.z=s.lower[2])
const d=new Array(i),p=new Int32Array(i),h=new Float32Array(i),f=new Float32Array(i),m=new Float32Array(i),g=new Int32Array(i)
let y=0
for(let a=0;a<i;a++)d[y]=r.atomType.value(a).toString(),h[y]=(r.x.value(a)*c.x+l.x)*u,f[y]=(r.y.value(a)*c.y+l.y)*u,m[y]=(r.z.value(a)*c.z+l.z)*u,p[y]=r.atomId.value(a),g[y]=0,y++
const v=a.VP.ofConst("MOL",i,a.VP.Schema.str),b=a.VP.ofLambda({value:e=>r.moleculeId.value(e).toString(),rowCount:i,schema:a.VP.Schema.str}),x=a.VP.ofConst(1,i,a.VP.Schema.int),S=a.VP.ofStringArray(d),_=a.XI.ofPartialColumns(Y.e.atom_site,{auth_asym_id:b,auth_atom_id:S,auth_comp_id:v,auth_seq_id:x,Cartn_x:a.VP.ofFloatArray(h),Cartn_y:a.VP.ofFloatArray(f),Cartn_z:a.VP.ofFloatArray(m),id:a.VP.ofIntArray(p),label_asym_id:b,label_atom_id:S,label_comp_id:v,label_seq_id:x,label_entity_id:a.VP.ofConst("1",i,a.VP.Schema.str),occupancy:a.VP.ofConst(1,i,a.VP.Schema.float),type_symbol:S,pdbx_PDB_model_num:a.VP.ofIntArray(g)},i),C=new W.V
C.setNames([["MOL","Unknown Entity"]]),C.getEntityId("MOL",G.MoleculeType.Unknown,"A")
const w=new H.N(x,S)
w.setNames([["MOL","Unknown Molecule"]]),w.add("MOL",0)
const T=(0,Y.z)({entity:C.getEntityTable(),chem_comp:w.getChemCompTable(),atom_site:_}),A=(await(0,Z.X)(T,Ot.create(e),t)).representative,I=await Nt(e,n).runInContext(t)
return Lt.Kx.trajectoryFromModelAndCoordinates(A,I)}(l,e,c))).runInContext(n),s=yn(o)
var l,c
return new Me.O.Molecule.Trajectory(o,s)})}),wn=Me.H.BuiltIn({name:"trajectory-from-mol",display:{name:"Parse MOL",description:"Parse MOL string and create trajectory."},from:[Me.O.Data.String],to:Me.O.Molecule.Trajectory})({apply:({a:e})=>i.Task.create("Parse MOL",async t=>{const n=await(o=e.data,i.Task.create("Parse Mol",async()=>function(e){const t=(0,s._F)(e),n=s._F.readLine(t).trim(),i=s._F.readLine(t).trim(),o=s._F.readLine(t).trim(),a=s._F.readLine(t),l=+a.substr(0,3),c=+a.substr(3,3),u={title:n,program:i,comment:o,atoms:Ne(t,l),bonds:Fe(t,c),...Ve(t)}
return r.H.success(u)}(o))).runInContext(t)
var o
if(n.isError)throw new Error(n.message)
const a=await(l=n.result,i.Task.create("Parse MOL",e=>He(l,void 0,e))).runInContext(t)
var l
const c=yn(a)
return new Me.O.Molecule.Trajectory(a,c)})}),Tn=Me.H.BuiltIn({name:"trajectory-from-sdf",display:{name:"Parse SDF",description:"Parse SDF string and create trajectory."},from:[Me.O.Data.String],to:Me.O.Molecule.Trajectory})({apply:({a:e})=>i.Task.create("Parse SDF",async t=>{const n=await(o=e.data,i.Task.create("Parse Sdf",async()=>function(e){const t=(0,s._F)(e),n=[]
for(;t.position<t.length;){const e=Vt(t)
e&&n.push(e)}return r.H.success({compounds:n})}(o))).runInContext(t)
var o
if(n.isError)throw new Error(n.message)
const a=[]
for(const e of n.result.compounds){const n=await Gt(e).runInContext(t)
for(let e=0;e<n.frameCount;e++)a.push(await i.Task.resolveInContext(n.getFrameAtIndex(e),t))}const l=new Ae.ArrayTrajectory(a),c=yn(l)
return new Me.O.Molecule.Trajectory(l,c)})}),An=Me.H.BuiltIn({name:"trajectory-from-mol2",display:{name:"Parse MOL2",description:"Parse MOL2 string and create trajectory."},from:[Me.O.Data.String],to:Me.O.Molecule.Trajectory})({apply:({a:e})=>i.Task.create("Parse MOL2",async t=>{const n=await(o=e.data,l=e.label,i.Task.create("Parse MOL2",async e=>await async function(e,t,n){const i=(0,s._F)(t)
e.update({message:"Parsing...",current:0,max:t.length})
const o=[]
for(;i.position<t.length;){const t=tt(i,e)
rt(t)
const n=await ot(t),r=await at(t),a=await st(t),s=lt(t)
for(o.push({molecule:t.molecule,atoms:n,bonds:r,substructures:a,crysin:s}),Ye(i);"@<TRIPOS>MOLECULE"!==Je(i)&&i.position<i.data.length;)Ke(i)}const a={name:n,structures:o}
return r.H.success(a)}(e,o,l))).runInContext(t)
var o,l
if(n.isError)throw new Error(n.message)
const c=await(d=n.result,i.Task.create("Parse MOL2",e=>async function(e,t){const n=[]
for(let r=0,i=e.structures.length;r<i;++r){const{molecule:i,atoms:o,bonds:s,substructures:l,crysin:c}=e.structures[r],u=new Array(o.count),d=new Array(o.count),p=new Array(o.count),h=new Array(o.count),f=new Array(o.count)
let m=!1
for(let e=0;e<o.count;++e)if(o.atom_type.value(e).includes(".")){m=!0
break}const g=new Map
if(l)for(let e=0;e<l.count;++e){const t=l.root_atom.value(e),n=l.chain.value(e),r=l.sub_type.value(e)
g.set(t,{chain:n,subType:r})}const y=new W.V,v=new H.N(o.subst_id,o.atom_name)
let b,x="",S=0,_="",C=G.MoleculeType.Unknown,w=-1
for(let e=0;e<o.count;++e){const t=o.subst_name.value(e),n=o.subst_id.value(e)
let r=t.replace(/\d+$/,"")||"MOL"
const i=t.match(/(\d+)$/)
f[e]=i?parseInt(i[1]):n
const a=g.get(o.atom_id.value(e))
if(a&&(b=a),b&&b.subType&&"UNK"!==b.subType&&(r=b.subType),p[e]=m?o.atom_type.value(e).split(".")[0].toUpperCase():U(o.atom_name.value(e),r),h[e]=r,n!==w){const t=(0,G.getMoleculeType)(v.add(r,e).type,r);(null==b?void 0:b.chain)?_=b.chain:t===C&&n===w+1||(_=$(S),S+=1),x=y.getEntityId(r,t,_),w=n,C=t}u[e]=x,d[e]=_}const T=a.VP.ofStringArray(p),A=a.VP.ofStringArray(h),I=a.VP.ofStringArray(u),P=a.VP.ofStringArray(d),B=a.VP.asArrayColumn(o.atom_name),E=a.VP.ofIntArray(f),k=a.XI.ofPartialColumns(Y.e.atom_site,{auth_asym_id:P,auth_atom_id:B,auth_comp_id:A,auth_seq_id:E,Cartn_x:a.VP.asArrayColumn(o.x,Float32Array),Cartn_y:a.VP.asArrayColumn(o.y,Float32Array),Cartn_z:a.VP.asArrayColumn(o.z,Float32Array),id:a.VP.asArrayColumn(o.atom_id),label_asym_id:P,label_atom_id:B,label_comp_id:A,label_seq_id:o.subst_id,label_entity_id:I,occupancy:a.VP.ofConst(1,o.count,a.VP.Schema.float),type_symbol:T,pdbx_PDB_model_num:a.VP.ofConst(r,o.count,a.VP.Schema.int)},o.count),D=(0,Y.z)({entity:y.getEntityTable(),chem_comp:v.getChemCompTable(),atom_site:k}),M=await(0,Z.X)(D,ut.create(e),t)
if(M.frameCount>0){const e=a.VP.ofIntArray(a.VP.mapToArray(s.origin_atom_id,e=>e-1,Int32Array)),t=a.VP.ofIntArray(a.VP.mapToArray(s.target_atom_id,e=>e-1,Int32Array)),r=s.bond_id,l=a.VP.ofIntArray(a.VP.mapToArray(s.bond_type,e=>{switch(e){case"ar":case"am":case"un":return 1
case"du":case"nc":return 0
default:return parseInt(e)}},Int8Array)),u=a.VP.ofIntArray(a.VP.mapToArray(s.bond_type,e=>{switch(e){case"ar":case"am":return G.BondType.Flag.Aromatic|G.BondType.Flag.Covalent
case"du":case"nc":return G.BondType.Flag.None
default:return G.BondType.Flag.Covalent}},Int8Array)),d=Ge.z.fromData({pairs:{key:r,indexA:e,indexB:t,order:l,flag:u},count:o.count},{maxDistance:c?-1:1/0}),p=M.representative
if(Ge.z.Provider.set(p,d),_e.j.Provider.set(p,{data:o.charge,type:i.charge_type}),c){const e=ct(c)
e&&Xe.i.Provider.set(p,e)}n.push(p)}}return new Ae.ArrayTrajectory(n)}(d,e))).runInContext(t),u=yn(c)
var d
return new Me.O.Molecule.Trajectory(c,u)})}),In=Me.H.BuiltIn({name:"trajectory-from-cube",display:{name:"Parse Cube",description:"Parse Cube file to create a trajectory."},from:Me.O.Format.Cube,to:Me.O.Molecule.Trajectory})({apply:({a:e})=>i.Task.create("Parse MOL",async t=>{const n=await(o=e.data,i.Task.create("Parse Cube",e=>async function(e,t){const{atoms:n}=e,r=a.VP.ofConst("MOL",e.atoms.count,a.VP.Schema.str),i=a.VP.ofConst("A",e.atoms.count,a.VP.Schema.str),o=a.VP.ofArray({array:a.VP.mapToArray(n.number,e=>(0,G.getElementFromAtomicNumber)(e)),schema:a.VP.Schema.Aliased(a.VP.Schema.str)}),s=a.VP.ofConst(1,n.count,a.VP.Schema.int),l=a.XI.ofPartialColumns(Y.e.atom_site,{auth_asym_id:i,auth_atom_id:o,auth_comp_id:r,auth_seq_id:s,Cartn_x:a.VP.asArrayColumn(n.x,Float32Array),Cartn_y:a.VP.asArrayColumn(n.y,Float32Array),Cartn_z:a.VP.asArrayColumn(n.z,Float32Array),id:a.VP.range(0,n.count-1),label_asym_id:i,label_atom_id:o,label_comp_id:r,label_seq_id:s,label_entity_id:a.VP.ofConst("1",n.count,a.VP.Schema.str),occupancy:a.VP.ofConst(1,n.count,a.VP.Schema.float),type_symbol:o,pdbx_PDB_model_num:a.VP.ofConst(1,n.count,a.VP.Schema.int)},n.count),c=new W.V
c.setNames([["MOL","Unknown Entity"]]),c.getEntityId("MOL",G.MoleculeType.Unknown,"A")
const u=new H.N(s,o)
u.setNames([["MOL","Unknown Molecule"]]),u.add("MOL",0)
const d=(0,Y.z)({entity:c.getEntityTable(),chem_comp:u.getChemCompTable(),atom_site:l})
return await(0,Z.X)(d,Qe.create(e),t)}(o,e))).runInContext(t),r=yn(n)
var o
return new Me.O.Molecule.Trajectory(n,r)})}),Pn=Me.H.BuiltIn({name:"trajectory-from-cif-core",display:{name:"Parse CIF Core",description:"Identify and create all separate models in the specified CIF data block"},from:Me.O.Format.Cif,to:Me.O.Molecule.Trajectory,params(e){if(!e)return{blockHeader:S.t.Optional(S.t.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."}))}
const{blocks:t}=e.data
return{blockHeader:S.t.Optional(S.t.Select(t[0]&&t[0].header,t.map(e=>[e.header,e.header]),{description:"Header of the block to parse"}))}}})({apply:({a:e,params:t})=>i.Task.create("Parse CIF Core",async n=>{const r=t.blockHeader||e.data.blocks[0].header,o=e.data.blocks.find(e=>e.header===r)
if(!o)throw new Error(`Data block '${[r]}' not found.`)
const s=await function(e){const t=qe.fromFrame(e)
return i.Task.create("Parse CIF Core",e=>async function(e,t,n){var r
const i=e.atom_site._rowCount,o=a.VP.ofConst("MOL",i,a.VP.Schema.str),s=a.VP.ofConst("A",i,a.VP.Schema.str),l=a.VP.ofConst(1,i,a.VP.Schema.int),c=function(e){const{cell:t,space_group:n}=e,r=function(e){const t=e.it_number.value(0),n=e["name_h-m_full"].value(0).replace("-"," ")
return e.it_number.isDefined?(e["name_h-m_full"].isDefined,t):n}(n),i=$e.O8.create(r,f.eB.create(t.length_a.value(0),t.length_b.value(0),t.length_c.value(0)),f.eB.scale((0,f.eB)(),f.eB.create(t.angle_alpha.value(0),t.angle_beta.value(0),t.angle_gamma.value(0)),Math.PI/180))
return{spacegroup:$e.is.create(i),assemblies:[],isNonStandardCrystalFrame:!1,ncsOperators:[]}}(e),u=c.spacegroup.cell.fromFractional,{fract_x:d,fract_y:p,fract_z:h}=e.atom_site,m=new Float32Array(i),g=new Float32Array(i),y=new Float32Array(i),v=(0,f.eB)()
for(let a=0;a<i;++a)f.eB.set(v,d.value(a),p.value(a),h.value(a)),f.eB.transformMat4(v,v,u),m[a]=v[0],g[a]=v[1],y[a]=v[2]
const{type_symbol:x,label:S}=e.atom_site
let _,C
if(x.isDefined){const e=new Array(i),t=new Int8Array(i)
for(let n=0;n<i;++n){const r=x.value(n),i=r.length
"+"===r[i-1]?(e[n]=r.substring(0,i-2),t[n]=parseInt(r[i-2])):"+"===r[i-2]?(e[n]=r.substring(0,i-2),t[n]=parseInt(r[i-1])):"-"===r[i-1]?(e[n]=r.substring(0,i-2),t[n]=-parseInt(r[i-2])):"-"===r[i-2]?(e[n]=r.substring(0,i-2),t[n]=-parseInt(r[i-1])):(e[n]=r,t[n]=0)}_=a.VP.ofStringArray(e),C=a.VP.ofIntArray(t)}else{const e=new Array(i)
for(let t=0;t<i;++t)e[t]=U(S.value(t),"")
_=a.VP.ofStringArray(e),C=a.VP.Undefined(i,a.VP.Schema.int)}const w=a.XI.ofPartialColumns(Y.e.atom_site,{auth_asym_id:s,auth_atom_id:S,auth_comp_id:o,auth_seq_id:l,Cartn_x:a.VP.ofFloatArray(m),Cartn_y:a.VP.ofFloatArray(g),Cartn_z:a.VP.ofFloatArray(y),id:a.VP.range(0,i-1),label_asym_id:s,label_atom_id:S,label_comp_id:o,label_seq_id:l,label_entity_id:a.VP.ofConst("1",i,a.VP.Schema.str),occupancy:e.atom_site.occupancy.isDefined?e.atom_site.occupancy:a.VP.ofConst(1,i,a.VP.Schema.float),type_symbol:_,pdbx_formal_charge:C,pdbx_PDB_model_num:a.VP.ofConst(1,i,a.VP.Schema.int),B_iso_or_equiv:e.atom_site.u_iso_or_equiv},i),T=e.chemical.name_common.value(0)||e.chemical.name_systematic.value(0)||e.chemical_formula.sum.value(0),A=new W.V
A.setNames([["MOL",T||"Unknown Entity"]]),A.getEntityId("MOL",G.MoleculeType.Unknown,"A")
const I=new H.N(l,e.atom_site.type_symbol)
I.setNames([["MOL",T||"Unknown Molecule"]]),I.add("MOL",0)
const P=(0,Y.z)({entity:A.getEntityTable(),chem_comp:I.getChemCompTable(),atom_site:w}),B=await(0,Z.X)(P,t,n)
if(B.frameCount>0){const n=B.representative
Xe.i.Provider.set(n,c)
const o=e.geom_bond._rowCount
if(o>0){const s={},{label:l}=e.atom_site
for(let e=0,t=l.rowCount;e<t;++e)s[l.value(e)]=e
const c=null===(r=t.data.frame.categories.ccdc_geom_bond_type)||void 0===r?void 0:r.getField(""),u=[],d=[],p=[],h=[],f=[],m=new Set
let g=0
const{atom_site_label_1:y,atom_site_label_2:v,valence:x,distance:S}=e.geom_bond
for(let e=0;e<o;++e){const t=s[y.value(e)],n=s[v.value(e)],r=t<n?(0,b.m1)(t,n):(0,b.m1)(n,t)
if(!m.has(r)){if(m.add(r),u[g]=t,d[g]=n,h[g]=S.value(e)||-1,c){const t=c.str(e)
"D"===t?(p[g]=2,f[g]=G.BondType.Flag.Covalent):"A"===t?(p[g]=1,f[g]=G.BondType.Flag.Covalent|G.BondType.Flag.Aromatic):(p[g]=1,f[g]=G.BondType.Flag.Covalent)}else f[g]=G.BondType.Flag.Covalent,p[g]=x.isDefined?x.value(e):1
g+=1}}Ge.z.Provider.set(n,Ge.z.fromData({pairs:{indexA:a.VP.ofIntArray(u),indexB:a.VP.ofIntArray(d),order:a.VP.ofIntArray(p),distance:a.VP.ofFloatArray(h),flag:a.VP.ofIntArray(f)},count:i}))}}return B}(t.data.db,t,e))}(o).runInContext(n)
if(0===s.frameCount)throw new Error("No models found.")
const l=yn(s)
return new Me.O.Molecule.Trajectory(s,l)})}),Bn=e=>e+1,En=e=>e-1,kn=Me.H.BuiltIn({name:"model-from-trajectory",display:{name:"Molecular Model",description:"Create a molecular model from specified index in a trajectory."},from:Me.O.Molecule.Trajectory,to:Me.O.Molecule.Model,params:e=>e?{modelIndex:S.t.Converted(Bn,En,S.t.Numeric(1,{min:1,max:e.data.frameCount,step:1},{description:"Model Index",immediateUpdate:!0}))}:{modelIndex:S.t.Numeric(0,{},{description:"Zero-based index of the model",immediateUpdate:!0})}})({isApplicable:e=>e.data.frameCount>0,apply:({a:e,params:t})=>i.Task.create("Model from Trajectory",async n=>{let r=Math.round(t.modelIndex)%e.data.frameCount
r<0&&(r+=e.data.frameCount)
const o=await i.Task.resolveInContext(e.data.getFrameAtIndex(r),n),a=`Model ${r+1}`,s=1===e.data.frameCount?void 0:`of ${e.data.frameCount}`
return new Me.O.Molecule.Model(o,{label:a,description:s})}),interpolate:(e,t,n)=>({modelIndex:n>=1?t.modelIndex:e.modelIndex+Math.floor((t.modelIndex-e.modelIndex+1)*n)}),dispose({b:e}){null==e||e.data.customProperties.dispose()}}),Dn=Me.H.BuiltIn({name:"structure-from-trajectory",display:{name:"Structure from Trajectory",description:"Create a molecular structure from a trajectory."},from:Me.O.Molecule.Trajectory,to:Me.O.Molecule.Structure})({apply:({a:e})=>i.Task.create("Build Structure",async t=>{const n=await Ae.Structure.ofTrajectory(e.data,t),r={label:"Ensemble",description:Ae.Structure.elementDescription(n)}
return new Me.O.Molecule.Structure(n,r)}),dispose({b:e}){null==e||e.data.customPropertyDescriptors.dispose()}}),Mn=Me.H.BuiltIn({name:"structure-from-model",display:{name:"Structure",description:"Create a molecular structure (model, assembly, or symmetry) from the specified model."},from:Me.O.Molecule.Model,to:Me.O.Molecule.Structure,params:e=>ke.z.getParams(e&&e.data)})({canAutoUpdate:({oldParams:e,newParams:t})=>ke.z.canAutoUpdate(e.type,t.type),apply:({a:e,params:t},n)=>i.Task.create("Build Structure",async r=>ke.z.create(n,r,e.data,t&&t.type)),update:({a:e,b:t,oldParams:n,newParams:r})=>(0,Ee.bD)(n,r)?t.data.model===e.data?Be.xE.UpdateResult.Unchanged:Ae.Model.areHierarchiesEqual(e.data,t.data.model)?(t.data=t.data.remapModel(e.data),Be.xE.UpdateResult.Updated):Be.xE.UpdateResult.Recreate:Be.xE.UpdateResult.Recreate,dispose({b:e}){null==e||e.data.customPropertyDescriptors.dispose()}}),Rn=Me.H.BuiltIn({name:"transform-structure-conformation",display:{name:"Transform Conformation"},isDecorator:!0,from:Me.O.Molecule.Structure,to:Me.O.Molecule.Structure,params:{transform:on.Eh}})({canAutoUpdate:({newParams:e})=>"matrix"!==e.transform.name,apply({a:e,params:t}){const n=(0,on.tO)(t.transform)?e.data.boundary.sphere.center:f.eB.unit,r=(0,on.zk)(t.transform,n),i=Ae.Structure.transform(e.data,r)
return new Me.O.Molecule.Structure(i,{label:e.label,description:`${e.description} [Transformed]`})},dispose({b:e}){null==e||e.data.customPropertyDescriptors.dispose()}}),On=Me.H.BuiltIn({name:"structure-instances",display:{name:"Structure Instances"},isDecorator:!0,from:Me.O.Molecule.Structure,to:Me.O.Molecule.Structure,params:{transforms:S.t.ObjectList({transform:on.Eh},()=>"Transform")}})({canAutoUpdate:()=>!0,apply({a:e,params:t}){const n=t.transforms.some(e=>(0,on.tO)(e.transform))?e.data.boundary.sphere.center:f.eB.unit,r=t.transforms.map(e=>(0,on.zk)(e.transform,n))
if(!r.length)return e
const i=Ae.Structure.instances(e.data,r)
return new Me.O.Molecule.Structure(i,{label:e.label,description:`${e.description} [Instanced]`})},dispose({b:e}){null==e||e.data.customPropertyDescriptors.dispose()}}),Ln=Me.H.BuiltIn({name:"model-with-coordinates",display:{name:"Model With Coordinates",description:"Updates the current model with provided coordinate frame"},from:Me.O.Molecule.Model,to:Me.O.Molecule.Model,params:{frameIndex:S.t.Optional(S.t.Numeric(0,void 0,{isHidden:!0})),frameCount:S.t.Optional(S.t.Numeric(1,void 0,{isHidden:!0})),atomicCoordinateFrame:S.t.Optional(S.t.Value(void 0,{isHidden:!0}))},isDecorator:!0})({apply({a:e,params:t}){var n,r
if(!t.atomicCoordinateFrame)return e
const i={...e.data,atomicConformation:Ae.Model.getAtomicConformationFromFrame(e.data,t.atomicCoordinateFrame)}
return Ae.Model.TrajectoryInfo.set(i,{index:null!==(n=t.frameIndex)&&void 0!==n?n:0,size:null!==(r=t.frameCount)&&void 0!==r?r:1}),new Me.O.Molecule.Model(i,{label:e.label,description:e.description})},update:({a:e,b:t,oldParams:n,newParams:r})=>{var i,o
return n.atomicCoordinateFrame===r.atomicCoordinateFrame?Be.xE.UpdateResult.Unchanged:(r.atomicCoordinateFrame?t.data={...t.data,atomicConformation:Ae.Model.getAtomicConformationFromFrame(t.data,r.atomicCoordinateFrame)}:t.data=e.data,Ae.Model.TrajectoryInfo.set(t.data,{index:null!==(i=r.frameIndex)&&void 0!==i?i:0,size:null!==(o=r.frameCount)&&void 0!==o?o:1}),Be.xE.UpdateResult.Updated)}}),Nn=Me.H.BuiltIn({name:"structure-selection-from-expression",display:{name:"Selection",description:"Create a molecular structure from the specified expression."},from:Me.O.Molecule.Structure,to:Me.O.Molecule.Structure,params:()=>({expression:S.t.Value(Ie.MolScriptBuilder.struct.generator.all,{isHidden:!0}),label:S.t.Optional(S.t.Text("",{isHidden:!0}))})})({apply({a:e,params:t,cache:n}){const{selection:r,entry:i}=Te.createAndRun(e.data,t.expression)
if(n.entry=i,Ae.StructureSelection.isEmpty(r))return Be.BM.Null
const o=Ae.StructureSelection.unionStructure(r),a={label:`${t.label||"Selection"}`,description:Ae.Structure.elementDescription(o)}
return new Me.O.Molecule.Structure(o,a)},update:({a:e,b:t,oldParams:n,newParams:r,cache:i})=>{if(n.expression!==r.expression)return Be.xE.UpdateResult.Recreate
const o=i.entry
if(o.currentStructure===e.data)return Be.xE.UpdateResult.Unchanged
const a=Te.updateStructure(o,e.data)
return Ae.StructureSelection.isEmpty(a)?Be.xE.UpdateResult.Null:(Te.updateStructureObject(t,a,r.label),Be.xE.UpdateResult.Updated)},dispose({b:e}){null==e||e.data.customPropertyDescriptors.dispose()}}),Fn=Me.H.BuiltIn({name:"structure-multi-selection-from-expression",display:{name:"Multi-structure Measurement Selection",description:"Create selection object from multiple structures."},from:Me.O.Root,to:Me.O.Molecule.Structure.Selections,params:()=>({selections:S.t.ObjectList({key:S.t.Text(void 0,{description:"A unique key."}),ref:S.t.Text(),groupId:S.t.Optional(S.t.Text()),expression:S.t.Value(Ie.MolScriptBuilder.struct.generator.empty)},e=>e.ref,{isHidden:!0}),isTransitive:S.t.Optional(S.t.Boolean(!1,{isHidden:!0,description:"Remap the selections from the original structure if structurally equivalent."})),label:S.t.Optional(S.t.Text("",{isHidden:!0}))})})({apply({params:e,cache:t,dependencies:n}){const r=new Map,i=[]
let o=0
for(const s of e.selections){const{selection:e,entry:t}=Te.createAndRun(n[s.ref].data,s.expression)
r.set(s.key,t)
const a=Ae.StructureSelection.toLociWithSourceUnits(e)
i.push({key:s.key,structureRef:s.ref,loci:a,groupId:s.groupId}),o+=Ae.StructureElement.Loci.size(a)}t.entries=r
const a={label:`${e.label||"Multi-selection"}`,description:`${e.selections.length} source(s), ${o} element(s) total`}
return new Me.O.Molecule.Structure.Selections(i,a)},update:({b:e,oldParams:t,newParams:n,cache:r,dependencies:i})=>{if(!!t.isTransitive!=!!n.isTransitive)return Be.xE.UpdateResult.Recreate
const o=r.entries,a=new Map,s=new Map
for(const d of e.data)s.set(d.key,d)
let l=!1,c=0
const u=[]
for(const d of n.selections){const e=i[d.ref].data
let t=!1
if(o.has(d.key)){const r=o.get(d.key)
if(Te.isUnchanged(r,d.expression,e)&&s.has(d.key)){const e=s.get(d.key)
e.groupId!==d.groupId&&(e.groupId=d.groupId,l=!0),a.set(d.key,r),u.push(e),c+=Ae.StructureElement.Loci.size(e.loci)
continue}if(r.expression!==d.expression)t=!0
else{let t=!1
if(n.isTransitive)if(Ae.Structure.areUnitIdsAndIndicesEqual(r.originalStructure,e)){const t=Te.run(r,r.originalStructure)
r.currentStructure=e,a.set(d.key,r)
const n=Ae.StructureElement.Loci.remap(Ae.StructureSelection.toLociWithSourceUnits(t),e)
u.push({key:d.key,structureRef:d.ref,loci:n,groupId:d.groupId}),c+=Ae.StructureElement.Loci.size(n),l=!0}else t=!0
else t=!0
if(t){l=!0
const t=Te.updateStructure(r,e)
a.set(d.key,r)
const n=Ae.StructureSelection.toLociWithSourceUnits(t)
u.push({key:d.key,structureRef:d.ref,loci:n,groupId:d.groupId}),c+=Ae.StructureElement.Loci.size(n)}}}else t=!0
if(t){l=!0
const{selection:t,entry:n}=Te.createAndRun(e,d.expression)
a.set(d.key,n)
const r=Ae.StructureSelection.toLociWithSourceUnits(t)
u.push({key:d.key,structureRef:d.ref,loci:r,groupId:d.groupId}),c+=Ae.StructureElement.Loci.size(r)}}return l?(r.entries=a,e.data=u,e.label=`${n.label||"Multi-selection"}`,e.description=`${u.length} source(s), ${c} element(s) total`,Be.xE.UpdateResult.Updated):Be.xE.UpdateResult.Unchanged}}),zn=Me.H.BuiltIn({name:"structure-multi-selection-from-bundle",display:{name:"Multi-structure Measurement Selection",description:"Create selection object from multiple structures."},from:Me.O.Root,to:Me.O.Molecule.Structure.Selections,params:()=>({selections:S.t.ObjectList({key:S.t.Text(void 0,{description:"A unique key."}),ref:S.t.Text(),groupId:S.t.Optional(S.t.Text()),bundle:S.t.Value(Ae.StructureElement.Bundle.Empty)},e=>e.ref,{isHidden:!0}),isTransitive:S.t.Optional(S.t.Boolean(!1,{isHidden:!0,description:"Remap the selections from the original structure if structurally equivalent."})),label:S.t.Optional(S.t.Text("",{isHidden:!0}))})})({apply({params:e,cache:t,dependencies:n}){const r=new Map,i=[]
let o=0
for(const s of e.selections){const e=n[s.ref].data,t=Ae.StructureElement.Bundle.toLoci(s.bundle,e)
i.push({key:s.key,structureRef:s.ref,loci:t,groupId:s.groupId}),o+=Ae.StructureElement.Loci.size(t),r.set(s.key,{source:e})}t.entries=r
const a={label:`${e.label||"Multi-selection"}`,description:`${e.selections.length} source(s), ${o} element(s) total`}
return new Me.O.Molecule.Structure.Selections(i,a)},update:({b:e,oldParams:t,newParams:n,cache:r,dependencies:i})=>{if(!!t.isTransitive!=!!n.isTransitive)return Be.xE.UpdateResult.Recreate
const o=r.entries,a=new Map,s=new Map
for(const p of t.selections)s.set(p.key,p.bundle)
const l=new Map
for(const p of e.data)l.set(p.key,p)
let c=!1,u=0
const d=[]
for(const p of n.selections){let e=!1
if(o.has(p.key)){const t=i[p.ref].data,n=o.get(p.key),r=s.get(p.key)
if(r&&t===n.source&&p.bundle.hash===n.source.hashCode&&Ae.StructureElement.Bundle.areEqual(p.bundle,r)){const e=l.get(p.key)
e.groupId!==p.groupId&&(e.groupId=p.groupId,c=!0),a.set(p.key,n),d.push(e),u+=Ae.StructureElement.Loci.size(e.loci)
continue}e=!0}else e=!0
if(e){c=!0
const e=i[p.ref].data,t=Ae.StructureElement.Bundle.toLoci(p.bundle,e)
d.push({key:p.key,structureRef:p.ref,loci:t,groupId:p.groupId}),u+=Ae.StructureElement.Loci.size(t),a.set(p.key,{source:e})}}return c?(r.entries=a,e.data=d,e.label=`${n.label||"Multi-selection"}`,e.description=`${d.length} source(s), ${u} element(s) total`,Be.xE.UpdateResult.Updated):Be.xE.UpdateResult.Unchanged}}),jn=Me.H.BuiltIn({name:"structure-selection-from-script",display:{name:"Selection",description:"Create a molecular structure from the specified script."},from:Me.O.Molecule.Structure,to:Me.O.Molecule.Structure,params:()=>({script:S.t.Script({language:"mol-script",expression:"(sel.atom.atom-groups :residue-test (= atom.resname ALA))"}),label:S.t.Optional(S.t.Text(""))})})({apply({a:e,params:t,cache:n}){const{selection:r,entry:i}=Te.createAndRun(e.data,t.script)
n.entry=i
const o=Ae.StructureSelection.unionStructure(r),a={label:`${t.label||"Selection"}`,description:Ae.Structure.elementDescription(o)}
return new Me.O.Molecule.Structure(o,a)},update:({a:e,b:t,oldParams:n,newParams:r,cache:i})=>{if(!Pe.Script.areEqual(n.script,r.script))return Be.xE.UpdateResult.Recreate
const o=i.entry
if(o.currentStructure===e.data)return Be.xE.UpdateResult.Unchanged
const a=Te.updateStructure(o,e.data)
return Te.updateStructureObject(t,a,r.label),Be.xE.UpdateResult.Updated},dispose({b:e}){null==e||e.data.customPropertyDescriptors.dispose()}}),Vn=Me.H.BuiltIn({name:"structure-selection-from-bundle",display:{name:"Selection",description:"Create a molecular structure from the specified structure-element bundle."},from:Me.O.Molecule.Structure,to:Me.O.Molecule.Structure,params:()=>({bundle:S.t.Value(Ae.StructureElement.Bundle.Empty,{isHidden:!0}),label:S.t.Optional(S.t.Text("",{isHidden:!0}))})})({apply({a:e,params:t,cache:n}){if(t.bundle.hash!==e.data.hashCode)return Be.BM.Null
n.source=e.data
const r=Ae.StructureElement.Bundle.toStructure(t.bundle,e.data)
if(0===r.elementCount)return Be.BM.Null
const i={label:`${t.label||"Selection"}`,description:Ae.Structure.elementDescription(r)}
return new Me.O.Molecule.Structure(r,i)},update:({a:e,b:t,oldParams:n,newParams:r,cache:i})=>{if(!Ae.StructureElement.Bundle.areEqual(n.bundle,r.bundle))return Be.xE.UpdateResult.Recreate
if(r.bundle.hash!==e.data.hashCode)return Be.xE.UpdateResult.Null
if(i.source===e.data)return Be.xE.UpdateResult.Unchanged
i.source=e.data
const o=Ae.StructureElement.Bundle.toStructure(r.bundle,e.data)
return 0===o.elementCount?Be.xE.UpdateResult.Null:(t.label=`${r.label||"Selection"}`,t.description=Ae.Structure.elementDescription(o),t.data=o,Be.xE.UpdateResult.Updated)},dispose({b:e}){null==e||e.data.customPropertyDescriptors.dispose()}}),Un={polymer:"polymer",protein:"protein",nucleic:"nucleic",water:"water",branched:"branched",ligand:"ligand","non-standard":"non-standard",coarse:"coarse","atomic-sequence":"atomic-sequence","atomic-het":"atomic-het",spheres:"spheres"},Gn=S.t.objectToOptions(Un),Hn=Me.H.BuiltIn({name:"structure-complex-element",display:{name:"Complex Element",description:"Create a molecular structure from the specified model."},from:Me.O.Molecule.Structure,to:Me.O.Molecule.Structure,params:{type:S.t.Select("atomic-sequence",Gn,{isHidden:!0})}})({apply({a:e,params:t}){let n,r
switch(t.type){case"polymer":n=Re.StructureSelectionQueries.polymer.query,r="Polymer"
break
case"protein":n=Re.StructureSelectionQueries.protein.query,r="Protein"
break
case"nucleic":n=Re.StructureSelectionQueries.nucleic.query,r="Nucleic"
break
case"water":n=Ae.Queries.internal.water(),r="Water"
break
case"branched":n=Re.StructureSelectionQueries.branchedPlusConnected.query,r="Branched"
break
case"ligand":n=Re.StructureSelectionQueries.ligandPlusConnected.query,r="Ligand"
break
case"non-standard":n=Re.StructureSelectionQueries.nonStandardPolymer.query,r="Non-standard"
break
case"coarse":n=Re.StructureSelectionQueries.coarse.query,r="Coarse"
break
case"atomic-sequence":n=Ae.Queries.internal.atomicSequence(),r="Sequence"
break
case"atomic-het":n=Ae.Queries.internal.atomicHet(),r="HET Groups/Ligands"
break
case"spheres":n=Ae.Queries.internal.spheres(),r="Coarse Spheres"
break
default:(0,Oe.dr)(t.type)}const i=n(new Ae.QueryContext(e.data)),o=Ae.StructureSelection.unionStructure(i)
return 0===o.elementCount?Be.BM.Null:new Me.O.Molecule.Structure(o,{label:r,description:Ae.Structure.elementDescription(o)})},dispose({b:e}){null==e||e.data.customPropertyDescriptors.dispose()}}),qn=Me.H.BuiltIn({name:"structure-component",display:{name:"Component",description:"A molecular structure component."},from:Me.O.Molecule.Structure,to:Me.O.Molecule.Structure,params:()=>({type:S.t.MappedStatic("static",{static:S.t.Text("polymer"),expression:S.t.Value(Ie.MolScriptBuilder.struct.generator.all),bundle:S.t.Value(Ae.StructureElement.Bundle.Empty),script:S.t.Script({language:"mol-script",expression:"(sel.atom.all)"})},{isHidden:!0}),nullIfEmpty:S.t.Optional(S.t.Boolean(!0,{isHidden:!0})),label:S.t.Text("",{isHidden:!0})})})({apply:({a:e,params:t,cache:n})=>function(e,t,n){n.source=e
let r,i=Ae.Structure.Empty
switch(t.type.name){case"static":{let n
switch(t.type.params){case"all":n=Re.StructureSelectionQueries.all.query,r="All"
break
case"polymer":n=Re.StructureSelectionQueries.polymer.query,r="Polymer"
break
case"protein":n=Re.StructureSelectionQueries.protein.query,r="Protein"
break
case"nucleic":n=Re.StructureSelectionQueries.nucleic.query,r="Nucleic"
break
case"water":n=Ae.Queries.internal.water(),r="Water"
break
case"ion":n=Re.StructureSelectionQueries.ion.query,r="Ion"
break
case"lipid":n=Re.StructureSelectionQueries.lipid.query,r="Lipid"
break
case"branched":n=Re.StructureSelectionQueries.branchedPlusConnected.query,r="Branched"
break
case"ligand":n=Re.StructureSelectionQueries.ligandPlusConnected.query,r="Ligand"
break
case"non-standard":n=Re.StructureSelectionQueries.nonStandardPolymer.query,r="Non-standard"
break
case"coarse":n=Re.StructureSelectionQueries.coarse.query,r="Coarse"
break
default:(0,Oe.dr)(t.type)}const o=n(new Ae.QueryContext(e))
i=Ae.StructureSelection.unionStructure(o)
break}case"script":case"expression":{const{selection:r,entry:o}=Te.createAndRun(e,t.type.params)
n.entry=o,i=Ae.StructureSelection.unionStructure(r)
break}case"bundle":if(t.type.params.hash!==e.hashCode)break
i=Ae.StructureElement.Bundle.toStructure(t.type.params,e)}if(t.nullIfEmpty&&0===i.elementCount)return Be.BM.Null
const o={label:`${t.label||r||"Component"}`,description:Ae.Structure.elementDescription(i)}
return new Me.O.Molecule.Structure(i,o)}(e.data,t,n),update:({a:e,b:t,oldParams:n,newParams:r,cache:i})=>function(e,t,n,r,i){if(n.type.name!==r.type.name)return Be.xE.UpdateResult.Recreate
let o=!1
switch(r.type.name){case"static":return n.type.params!==r.type.params?Be.xE.UpdateResult.Recreate:Ae.Structure.areEquivalent(e,i.source)?t.data.model===e.model?Be.xE.UpdateResult.Unchanged:Ae.Model.areHierarchiesEqual(e.model,t.data.model)?(t.data=t.data.remapModel(e.model),Be.xE.UpdateResult.Updated):Be.xE.UpdateResult.Recreate:Be.xE.UpdateResult.Recreate
case"script":if(!Pe.Script.areEqual(n.type.params,r.type.params))return Be.xE.UpdateResult.Recreate
case"expression":{if(n.type.params!==r.type.params)return Be.xE.UpdateResult.Recreate
if(e===i.source)break
const a=i.entry,s=Te.updateStructure(a,e)
i.source=e,t.data=Ae.StructureSelection.unionStructure(s),Te.updateStructureObject(t,s,r.label),o=!0
break}case"bundle":if(e===i.source&&Ae.StructureElement.Bundle.areEqual(n.type.params,r.type.params))break
i.source=e,r.type.params.hash!==e.hashCode?(o=0!==t.data.elementCount,t.data=0===t.data.elementCount?t.data:Ae.Structure.Empty):(o=!0,t.data=Ae.StructureElement.Bundle.toStructure(r.type.params,e))}if(o){if(r.nullIfEmpty&&0===t.data.elementCount)return Be.xE.UpdateResult.Null
t.description=Ae.Structure.elementDescription(t.data)}return n.label!==r.label&&(o=!0,t.label=`${r.label||t.label}`),o?Be.xE.UpdateResult.Updated:Be.xE.UpdateResult.Unchanged}(e.data,t,n,r,i),dispose({b:e}){null==e||e.data.customPropertyDescriptors.dispose()}}),Qn=Me.H.BuiltIn({name:"custom-model-properties",display:{name:"Custom Model Properties"},isDecorator:!0,from:Me.O.Molecule.Model,to:Me.O.Molecule.Model,params:(e,t)=>t.customModelProperties.getParams(null==e?void 0:e.data)})({apply:({a:e,params:t},n)=>i.Task.create("Custom Props",async r=>(await $n(e.data,n,r,t),new Me.O.Molecule.Model(e.data,{label:e.label,description:e.description}))),update:({a:e,b:t,oldParams:n,newParams:r},o)=>i.Task.create("Custom Props",async i=>{t.data=e.data,t.label=e.label,t.description=e.description
for(const t of n.autoAttach){const n=o.customModelProperties.get(t)
n&&e.data.customProperties.reference(n.descriptor,!1)}return await $n(e.data,o,i,r),Be.xE.UpdateResult.Updated}),dispose({b:e}){null==e||e.data.customProperties.dispose()}})
async function $n(e,t,n,r){const i={runtime:n,assetManager:t.managers.asset,errorContext:t.errorContext},{autoAttach:o,properties:a}=r
for(const s of Object.keys(a)){const n=t.customModelProperties.get(s),r=a[s]
if(o.includes(s)||n.isHidden)try{await n.attach(i,e,r,!0)}catch(e){t.log.warn(`Error attaching model prop '${s}': ${e}`)}else n.set(e,r)}}const Xn=Me.H.BuiltIn({name:"custom-structure-properties",display:{name:"Custom Structure Properties"},isDecorator:!0,from:Me.O.Molecule.Structure,to:Me.O.Molecule.Structure,params:(e,t)=>t.customStructureProperties.getParams(null==e?void 0:e.data.root)})({apply:({a:e,params:t},n)=>i.Task.create("Custom Props",async r=>(await Wn(e.data.root,n,r,t),new Me.O.Molecule.Structure(e.data,{label:e.label,description:e.description}))),update:({a:e,b:t,oldParams:n,newParams:r},o)=>e.data!==t.data?Be.xE.UpdateResult.Recreate:i.Task.create("Custom Props",async i=>{t.data=e.data,t.label=e.label,t.description=e.description
for(const t of n.autoAttach){const n=o.customStructureProperties.get(t)
n&&e.data.customPropertyDescriptors.reference(n.descriptor,!1)}return await Wn(e.data.root,o,i,r),Be.xE.UpdateResult.Updated}),dispose({b:e}){null==e||e.data.customPropertyDescriptors.dispose()}})
async function Wn(e,t,n,r){const i={runtime:n,assetManager:t.managers.asset,errorContext:t.errorContext},{autoAttach:o,properties:a}=r
for(const s of Object.keys(a)){const n=t.customStructureProperties.get(s),r=a[s]
if(o.includes(s)||n.isHidden)try{await n.attach(i,e,r,!0)}catch(e){t.log.warn(`Error attaching structure prop '${s}': ${e}`)}else n.set(e,r)}}const Yn=Me.H.BuiltIn({name:"shape-from-ply",display:{name:"Shape from PLY",description:"Create Shape from PLY data"},from:Me.O.Format.Ply,to:Me.O.Shape.Provider,params:e=>({transforms:S.t.Optional(S.t.Value([],{isHidden:!0})),label:S.t.Optional(S.t.Text("",{isHidden:!0}))})})({apply:({a:e,params:t})=>i.Task.create("Create shape from PLY",async n=>{const r=await function(e,t){return i.Task.create("Shape Provider",async n=>({label:"Mesh",data:{source:e,transforms:null==t?void 0:t.transforms},params:A(e),getShape:M(),geometryUtils:y.e.Utils}))}(e.data,t).runInContext(n),o={label:t.label||"Shape"}
return new Me.O.Shape.Provider(r,o)})})},2492(e,t,n){"use strict"
n.r(t),n.d(t,{BooleanTransform:()=>o,DateTransform:()=>a,NumberTransform:()=>l,StringTransform:()=>c,default:()=>i})
var r=n(4471)
const i=n.n(r)()
class o{deserialize(e,t){return null==e&&!0===t?.allowNull?null:"boolean"==typeof e?e:"string"==typeof e?/^(true|t|1)$/i.test(e):"number"==typeof e&&1===e}serialize(e,t){return null==e&&!0===t?.allowNull?null:Boolean(e)}static create(){return new this}}class a{deserialize(e,t){if("string"==typeof e){let t=e.indexOf("+")
return-1!==t&&e.length-5===t?(t+=3,new Date(e.slice(0,t)+":"+e.slice(t))):new Date(e)}return"number"==typeof e?new Date(e):null==e?e:null}serialize(e,t){return e instanceof Date&&!isNaN(e)?e.toISOString():null}static create(){return new this}}function s(e){return e==e&&e!==1/0&&e!==-1/0}class l{deserialize(e,t){if(""===e||null==e)return null
{const t=Number(e)
return s(t)?t:null}}serialize(e,t){if(""===e||null==e)return null
{const t=Number(e)
return s(t)?t:null}}static create(){return new this}}class c{deserialize(e,t){return e||""===e?String(e):null}serialize(e,t){return e||""===e?String(e):null}static create(){return new this}}},3111(e,t,n){"use strict"
n.d(t,{D:()=>c,S:()=>r})
var r,i=n(42529),o=n(55165),a=n(92384),s=n(95538)
function l(e){return e.map(e=>[e.name,e.provider.label,e.provider.category])}!function(e){function t(){return{color:i.J.Empty,size:o.F.Empty}}e.create=function(e,n,r,i){i=i||t()
const o=r.colorTheme,a=r.sizeTheme
return i.color=e.colorThemeRegistry.create(o.name,n,o.params),i.size=e.sizeThemeRegistry.create(a.name,n,a.params),i},e.createEmpty=t,e.ensureDependencies=async function(e,t,n,r){var i,o
await(null===(i=t.colorThemeRegistry.get(r.colorTheme.name).ensureCustomProperties)||void 0===i?void 0:i.attach(e,n)),await(null===(o=t.sizeThemeRegistry.get(r.sizeTheme.name).ensureCustomProperties)||void 0===o?void 0:o.attach(e,n))},e.releaseDependencies=function(e,t,n){var r,i
null===(r=e.colorThemeRegistry.get(n.colorTheme.name).ensureCustomProperties)||void 0===r||r.detach(t),null===(i=e.sizeThemeRegistry.get(n.sizeTheme.name).ensureCustomProperties)||void 0===i||i.detach(t)}}(r||(r={}))
class c{get default(){return this._list[0]}get list(){return this._list}get types(){return l(this._list)}constructor(e,t){this.emptyProvider=t,this._list=[],this._map=new Map,this._name=new Map,(0,s.IF)(e,(e,t)=>{if(e.name!==t)throw new Error(`Fix build in themes to have matching names. ${e.name} ${t}`)
this.add(e)})}sort(){this._list.sort((e,t)=>e.provider.category===t.provider.category?e.provider.label<t.provider.label?-1:e.provider.label>t.provider.label?1:0:e.provider.category<t.provider.category?-1:1)}add(e){if(this._map.has(e.name))throw new Error(`${e.name} already registered.`)
const t=e.name
this._list.push({name:t,provider:e}),this._map.set(t,e),this._name.set(e,t),this.sort()}remove(e){this._list.splice(this._list.findIndex(t=>t.name===e.name),1)
const t=this._map.get(e.name)
t&&(this._map.delete(e.name),this._name.delete(t))}has(e){return this._map.has(e.name)}get(e){return this._map.get(e)||this.emptyProvider}getName(e){if(!this._name.has(e))throw new Error(`'${e.label}' is not a registered theme provider.`)
return this._name.get(e)}create(e,t,n={}){const r=this.get(e)
return r.factory(t,{...a.t.getDefaultValues(r.getParams(t)),...n})}getApplicableList(e){return this._list.filter(t=>t.provider.isApplicable(e))}getApplicableTypes(e){return l(this.getApplicableList(e))}clear(){this._list.length=0,this._map.clear(),this._name.clear()}}},3203(e,t,n){"use strict"
!function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),e.exports=n(76715)},4360(e,t,n){"use strict"
n.d(t,{H:()=>wt})
var r=n(16625),i=n(92384),o=n(90050),a=n(10596),s=n(56642),l=n(17684),c=n(22703),u=n(3111),d=n(42594),p=n(23729),h=n(89),f=n(41036),m=n(42529),g=n(9043),y=n(68187),v=n(65081),b=n(32775),x=n(9726),S=n(30372),_=n(70292),C=n(91229),w=n(17782),T=n(55165),A=n(88434),I=n(20321)
function P(e,t,n,r,i){const o=e.instances.length,a=new Float32Array(16*o)
for(let s=0;s<o;++s)b.$I.toArray(e.instances[s].transform,a,16*s)
return(0,d.l1)(a,o,t,n,r,i)}function B(e,t){const{defaultProps:n,createGeometry:r,createLocationIterator:i,getLoci:a,eachLocation:s,setUpdateState:d,mustRecreate:b,dispose:x}=e,{updateValues:S,updateBoundingSphere:_,updateRenderableState:B,createPositionIterator:E}=e.geometryUtils,k=f.rj.create()
let D,M,R,O,L,N,F,z,j,V,U=Object.assign({},n),G=u.S.createEmpty(),H=-1
function q(e){if(k.createNew){if(j=i(O,L),!e)throw new Error("expected geometry to be given")
D=function(e,t,n,r,i,o){const{createValues:a,createRenderableState:s}=c.V.getUtils(t),l=a(t,P(e,t.boundingSphere,i.cellSize,i.batchSize),n,r,i),u=s(i)
return(0,p.o)(t.kind,l,u,o)}(O,e,j,R,M,t),V=E(e,D.values)}else{if(!D)throw new Error("expected renderObject to be available")
if((k.updateColor||k.updateSize||k.updateTransform)&&(j=i(O,L)),k.updateTransform){const{instanceCount:e,groupCount:t}=j
M.instanceGranularity?(0,w.Km)(e,"instance",D.values):(0,w.Km)(e*t,"groupInstance",D.values)}if(k.updateMatrix&&P(O,z.boundingSphere,M.cellSize,M.batchSize,D.values),k.createGeometry){if(!e)throw new Error("expected geometry to be given")
g.IQ.updateIfChanged(D.values.drawCount,c.V.getDrawCount(e)),g.IQ.updateIfChanged(D.values.uVertexCount,c.V.getVertexCount(e)),g.IQ.updateIfChanged(D.values.uGroupCount,j.groupCount)}(k.updateTransform||k.createGeometry)&&(_(D.values,e||z),V=E(e||z,D.values)),k.updateSize&&"uSize"in D.values&&(0,y.v3)(j,R.size,D.values),k.updateColor&&(0,v.D1)(j,V,R.color,D.values),S(D.values,M),B(D.state,M)}U=M,G=R,N=O,F=L,e&&(z=e,H+=1)}function Q(e,t){return(0,h.isEveryLoci)(e)?U.instanceGranularity?t(A.I.ofBounds(0,j.instanceCount)):t(A.I.ofBounds(0,j.groupCount*j.instanceCount)):U.instanceGranularity?function(e,t,n,r){let i=!1
if(o.f.Cell.isLoci(e)){if(o.f.Cell.isLociEmpty(e))return!1
if(!o.f.areEquivalent(e.volume,t))return!1
for(const{instances:t}of e.elements)I.C.forEach(t,e=>{r(A.I.ofSingleton(e))&&(i=!0)})}else if(o.f.Segment.isLoci(e)){if(o.f.Segment.isLociEmpty(e))return!1
if(!o.f.areEquivalent(e.volume,t))return!1
for(const{segments:t,instances:o}of e.elements)I.C.has(t,n)&&I.C.forEach(o,e=>{r(A.I.ofSingleton(e))&&(i=!0)})}else if(o.f.Isosurface.isLoci(e)){if(o.f.Isosurface.isLociEmpty(e))return!1
if(A.I.is(e.instances))r(e.instances)&&(i=!0)
else for(let t=0,n=e.instances.length;t<n;++t)r(A.I.ofSingleton(t))&&(i=!0)}else if(o.f.isLoci(e)){if(o.f.isLociEmpty(e))return!1
if(A.I.is(e.instances))r(e.instances)&&(i=!0)
else for(let t=0,n=e.instances.length;t<n;++t)r(A.I.ofSingleton(t))&&(i=!0)}return i}(e,N,F,t):s(e,N,F,U,t)}return{get groupCount(){return j?j.count:0},get renderObject(){return D},get geometryVersion(){return H},async createOrUpdate(e,t,n={},i){if(function(e,t,n,r){if(!n&&!N)throw new Error("missing volume")
M=Object.assign({},U,t),R=e,O=n,L=r,f.rj.reset(k),D?o.x.areEquivalent(O.grid,N.grid)&&!o.f.areInstanceTransformsEqual(O,N)?k.updateTransform=!0:o.f.areEquivalent(O,N)&&L===F||(k.createNew=!0):k.createNew=!0,k.createNew?k.createGeometry=!0:(d(k,n,M,U,R,G),m.J.areEqual(e.color,G.color)||(k.updateColor=!0),T.F.areEqual(e.size,G.size)||(k.updateSize=!0),M.instanceGranularity===U.instanceGranularity&&M.cellSize===U.cellSize&&M.batchSize===U.batchSize||(k.updateTransform=!0),k.updateTransform&&(k.updateMatrix=!0),k.updateSize&&!("uSize"in D.values)&&(k.createGeometry=!0),k.createGeometry&&(k.updateColor=!0,k.updateSize=!0))}(t,n,(null==i?void 0:i.volume)||N,(null==i?void 0:i.key)||F),k.createGeometry){const t=r(e,O,L,R,M,z)
return(0,C.$X)(t)?t.then(q):q(t)}q()},getLoci:e=>D?a(e,N,F,U,D.id):h.EmptyLoci,eachLocation(e){for(j.reset();j.hasNext;){const{location:t,isSecondary:n}=j.move()
e(t,n)}},mark:(e,t)=>l.b.mark(D,e,t,Q),setVisibility(e){l.b.setVisibility(D,e)},setAlphaFactor(e){l.b.setAlphaFactor(D,e)},setPickable(e){l.b.setPickable(D,e)},setColorOnly(e){l.b.setColorOnly(D,e)},setTransform(e,t){l.b.setTransform(D,e,t)},setOverpaint:e=>l.b.setOverpaint(D,e,Q,!0),setTransparency:e=>l.b.setTransparency(D,e,Q,!0),setEmissive:e=>l.b.setEmissive(D,e,Q,!0),setSubstance:e=>l.b.setSubstance(D,e,Q,!0),setClipping:e=>l.b.setClipping(D,e,Q,!0),setThemeStrength(e){l.b.setThemeStrength(D,e)},destroy(){null==x||x(z),D&&(D.state.disposed=!0,D=void 0)},mustRecreate:b}}function E(e,t,n,o,a,s=()=>[-1]){let l=0
const{webgl:c}=t,d=new S.B,m=new r.YL.GeometryState,g=(0,p.Q0)(),y=[],v=r.YL.createState(),x=new Map
let C,w,T,A,I=u.S.createEmpty()
async function P(e,t){var n
let r=x.get(t)
return r?(null===(n=r.mustRecreate)||void 0===n?void 0:n.call(r,{volume:C,key:t},A,c))&&(r.destroy(),r=o(g,C,t,A,c),x.set(t,r)):(r=o(g,C,t,A,c),x.set(t,r)),r.createOrUpdate({webgl:c,runtime:e},I,A,{volume:C,key:t})}return{label:e,get groupCount(){let e=0
return x.forEach(t=>{t.renderObject&&(e+=t.groupCount)}),e},get props(){return A},get params(){return T},get state(){return v},get theme(){return I},get geometryVersion(){return m.version},renderObjects:y,updated:d,createOrUpdate:function(e={},r){r&&r!==C&&(T=n(t,r),C=r,A||(A=i.t.getDefaultValues(T)))
const o=(0,f.m$)(Object.assign({},A,e),C)
return Object.assign(A,e,o),w=s(A),_.Task.create("Creating or updating VolumeRepresentation",async e=>{const t=new Set(x.keys())
for(let n=0,r=w.length;n<r;++n){const r=w[n]
t.delete(r)
const i=P(e,r)
i&&await i}t.forEach(e=>{var t
null===(t=x.get(e))||void 0===t||t.destroy(),x.delete(e)}),y.length=0,x.forEach(e=>{e.renderObject&&(y.push(e.renderObject),m.add(e.renderObject.id,e.geometryVersion))}),m.snapshot(),d.next(l++)})},setState:function(e){const{visible:t,alphaFactor:n,pickable:i,overpaint:o,transparency:a,emissive:s,substance:l,clipping:c,transform:u,themeStrength:d,syncManually:p,markerActions:h}=e,f={}
void 0!==t&&(f.visible=t),void 0!==n&&(f.alphaFactor=n),void 0!==i&&(f.pickable=i),void 0!==o&&(f.overpaint=o),void 0!==a&&(f.transparency=a),void 0!==s&&(f.emissive=s),void 0!==l&&(f.substance=l),void 0!==c&&(f.clipping=c),void 0!==d&&(f.themeStrength=d),void 0===u||b.$I.areEqual(u,v.transform,b.p8)||(f.transform=u),void 0!==p&&(f.syncManually=p),void 0!==h&&(f.markerActions=h),x.forEach(e=>function(e,t){void 0!==t.visible&&e&&e.setVisibility(t.visible),void 0!==t.alphaFactor&&e&&e.setAlphaFactor(t.alphaFactor),void 0!==t.pickable&&e&&e.setPickable(t.pickable),void 0!==t.overpaint&&e&&e.setOverpaint(t.overpaint),void 0!==t.transparency&&e&&e.setTransparency(t.transparency),void 0!==t.emissive&&e&&e.setEmissive(t.emissive),void 0!==t.substance&&e&&e.setSubstance(t.substance),void 0!==t.clipping&&e&&e.setClipping(t.clipping),void 0!==t.transform&&e&&e.setTransform(t.transform),void 0!==t.themeStrength&&e&&e.setThemeStrength(t.themeStrength)}(e,f)),r.YL.updateState(v,e)},setTheme:function(e){I=e},getLoci:e=>{let t=h.EmptyLoci
return x.forEach(n=>{const r=n.getLoci(e);(0,h.isEmptyLoci)(r)||(t=r)}),t},getAllLoci:()=>[a(C,A)],eachLocation:e=>{x.forEach(t=>{t.eachLocation(e)})},mark:function(e,t){let n=!1
return x.forEach(r=>{n=r.mark(e,t)||n}),n},destroy:function(){x.forEach(e=>e.destroy()),x.clear()}}}x.iy.Params
var k=n(30084),D=n(71196),M=n(63356),R=n(89432),O=n(70948),L=n(20276),N=n(33205),F=n(80813)
const z={isoValue:o.f.IsoValueParam,wrap:i.t.Select("auto",i.t.arrayToOptions(["off","on","auto"]))},j={...z,tryUseGpu:i.t.Boolean(!0),gpuDataType:i.t.Select("byte",i.t.arrayToOptions(["byte","float","halfFloat"]),{hideIf:e=>!e.tryUseGpu})}
function V(e,t){return"on"===t||"off"!==t&&"xyz"===e.periodicity}function U(e,t){if(e.grid.cells.data.length<Math.pow(10,3))return!1
const n=e.grid.cells.space.dimensions,{powerOfTwoSize:r}=(0,R.Ud)(n,1)
return r<=t.maxTextureSize/2}function G(e,t,n,r,s){return r.tryUseGpu&&s&&function(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.drawBuffers}(s)&&U(t,s)?function(e){return B({defaultProps:i.t.getDefaultValues(X),createGeometry:Y,createLocationIterator:R.w6,getLoci:q,eachLocation:Q,setUpdateState:(e,t,n,r)=>{e.createGeometry=!o.f.IsoValue.areSame(n.isoValue,r.isoValue,t.grid.stats)||n.gpuDataType!==r.gpuDataType||n.wrap!==r.wrap},geometryUtils:O.X.Utils,mustRecreate:(e,t,n)=>!t.tryUseGpu||!n||!U(e.volume,n),dispose:e=>{e.vertexTexture.ref.value.destroy(),e.groupTexture.ref.value.destroy(),e.normalTexture.ref.value.destroy(),e.doubleBuffer.destroy()}},e)}(e):function(e){return B({defaultProps:i.t.getDefaultValues(X),createGeometry:$,createLocationIterator:R.w6,getLoci:q,eachLocation:Q,setUpdateState:(e,t,n,r)=>{e.createGeometry=!o.f.IsoValue.areSame(n.isoValue,r.isoValue,t.grid.stats)||n.wrap!==r.wrap},geometryUtils:a.e.Utils,mustRecreate:(e,t,n)=>t.tryUseGpu&&!!n&&U(e.volume,n)},e)}(e)}function H(e,t){const n=A.I.ofLength(e.instances.length)
return o.f.Isosurface.Loci(e,t.isoValue,n)}function q(e,t,n,r,i){const{objectId:a,groupId:s,instanceId:l}=e
if(i===a){const e=o.f.PickingGranularity.get(t),n=I.C.ofSingleton(l)
if("volume"===e)return o.f.Loci(t,n)
if("object"===e||s===D.$.Null)return o.f.Isosurface.Loci(t,r.isoValue,n)
{const e=A.I.ofSingleton(s)
return o.f.Cell.Loci(t,[{indices:e,instances:n}])}}return h.EmptyLoci}function Q(e,t,n,r,i){return(0,R.bk)(e,t,{isoValue:r.isoValue},i)}async function $(e,t,n,r,i,l){e.runtime.update({message:"Marching cubes..."})
let c=t.grid.cells
V(t,i.wrap)&&(c=(0,R.Md)(t).grid.cells)
const u=(0,M.WE)(new Int32Array(t.grid.cells.data.length)),d=await(0,s.O)({isoLevel:o.f.IsoValue.toAbsolute(i.isoValue,t.grid.stats).absoluteValue,scalarField:c,idField:b.qY.create(c.space,b.qY.Data1(u))},l).runAsChild(e.runtime),p=o.x.getGridToCartesianTransform(t.grid)
return a.e.transform(d,p),e.webgl&&!e.webgl.isWebGL2?(a.e.uniformTriangleGroup(d,!1),F.IQ.updateIfChanged(d.varyingGroup,!1)):F.IQ.updateIfChanged(d.varyingGroup,!0),d.setBoundingSphere(o.f.Isosurface.getBoundingSphere(t,i.isoValue)),d}const X={...a.e.Params,...O.X.Params,...z,...j,quality:{...a.e.Params.quality,isEssential:!1}}
var W
function Y(e,t,n,r,i,a){const{webgl:s}=e
if(!s)throw new Error("webgl context required to create volume isosurface texture-mesh")
if(t.grid.cells.data.length<=1)return O.X.createEmpty(a)
V(t,i.wrap)&&(t=(0,R.Md)(t))
const{max:l,min:c}=t.grid.stats,u=l-c,d=o.f.IsoValue.toAbsolute(i.isoValue,t.grid.stats).absoluteValue,p=(d-c)/u,h=t.grid.cells.space.axisOrderSlowToFast,f=t.grid.cells.data.length,m=o.f.getBoundingSphere(t),g=e=>{const{texture:n,gridDimension:r,gridTexDim:o,gridDataDim:a,gridTexScale:l,transform:c}=W.get(t,s,i),u=null==e?void 0:e.doubleBuffer.get(),g=(0,L._)(s,n,r,o,a,l,c,p,d<0,!1,h,!0,null==u?void 0:u.vertex,null==u?void 0:u.group,null==u?void 0:u.normal)
return O.X.create(g.vertexCount,f,g.vertexTexture,g.groupTexture,g.normalTexture,m,e)},y=g(a)
return y.meta.webgl=s,y.meta.reset=()=>{W.clear(t),g(y)},y}async function Z(e,t,n,r,i,a){e.runtime.update({message:"Marching cubes..."})
let l=t.grid.cells
V(t,i.wrap)&&(l=(0,R.Md)(t).grid.cells)
const c=(0,M.WE)(new Int32Array(t.grid.cells.data.length)),u=await(0,s.e)({isoLevel:o.f.IsoValue.toAbsolute(i.isoValue,t.grid.stats).absoluteValue,scalarField:l,idField:b.qY.create(l.space,b.qY.Data1(c))},a).runAsChild(e.runtime),d=o.x.getGridToCartesianTransform(t.grid)
return k.q.transform(u,d),u.setBoundingSphere(o.f.Isosurface.getBoundingSphere(t,i.isoValue)),u}!function(e){const t="volume-isosurface-texture"
e.descriptor=(0,N.e)({name:t}),e.clear=function(e){delete e._propertyData[t]},e.get=function(n,r,i){var a,s
const{gpuDataType:l}=i,c=V(n,i.wrap),u=o.x.getGridToCartesianTransform(n.grid),d=b.eB.clone(n.grid.cells.space.dimensions),{width:p,height:h,powerOfTwoSize:f}=(0,R.Ud)(d,1),m=b.eB.create(p,h,0),g=b.eB.subScalar((0,b.eB)(),d,c?1:0),y=b.ZY.create(p/f,h/f)
if(f>r.maxTextureSize/2)throw new Error("volume too large for gpu isosurface extraction")
const v="halfFloat"!==l||r.extensions.textureHalfFloat?l:"float"
if((null===(a=n._propertyData[t])||void 0===a?void 0:a.dataType)!==v||(null===(s=n._propertyData[t])||void 0===s?void 0:s.wrap)!==c){const i="byte"===v?r.resources.texture("image-uint8","alpha","ubyte","linear"):"halfFloat"===v?r.resources.texture("image-float16","alpha","fp16","linear"):r.resources.texture("image-float32","alpha","float","linear")
n._propertyData[t]={texture:i,dataType:v,wrap:c},i.define(f,f),i.load((0,R.sz)(n,"data",1,v),!0),n.customProperties.add(e.descriptor),n.customProperties.assets(e.descriptor,[{dispose:()=>i.destroy()}])}return d[0]+=1,d[1]+=1,{texture:n._propertyData[t].texture,transform:u,gridDimension:d,gridTexDim:m,gridDataDim:g,gridTexScale:y}}}(W||(W={}))
const K={...k.q.Params,...z,quality:{...k.q.Params.quality,isEssential:!1},sizeFactor:i.t.Numeric(3,{min:0,max:10,step:.1})}
function J(e){return B({defaultProps:i.t.getDefaultValues(K),createGeometry:Z,createLocationIterator:R.w6,getLoci:q,eachLocation:Q,setUpdateState:(e,t,n,r)=>{e.createGeometry=!o.f.IsoValue.areSame(n.isoValue,r.isoValue,t.grid.stats)||n.wrap!==r.wrap},geometryUtils:k.q.Utils},e)}const ee={solid:(e,t)=>E("Isosurface mesh",e,t,G,H),wireframe:(e,t)=>E("Isosurface wireframe",e,t,J,H)},te={...X,...K,visuals:i.t.MultiSelect(["solid"],i.t.objectToOptions(ee)),bumpFrequency:i.t.Numeric(1,{min:0,max:10,step:.1},x.iy.ShadingCategory)},ne={name:"isosurface",label:"Isosurface",description:"Displays a triangulated isosurface of volumetric data.",factory:function(e,t){return r.YL.createMulti("Isosurface",e,t,r.YL.StateBuilder,ee)},getParams:function(e,t){const n=i.t.clone(te)
return n.isoValue=o.f.createIsoValueParam(o.f.IsoValue.relative(2),t.grid.stats),n},defaultValues:i.t.getDefaultValues(te),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>!o.f.isEmpty(e)&&!o.f.Segmentation.get(e)}
var re=n(95538),ie=n(71712),oe=n(81871),ae=n(37392),se=n(54749),le=n(53138),ce=n(37411),ue=n(6539),de=n(87423),pe=n(39250),he=n(97564),fe=n(52349)
const me={...ie._V.Params,quality:{...ie._V.Params.quality,isEssential:!1},dimension:i.t.MappedStatic("x",{x:i.t.Numeric(0,{min:0,max:0,step:1},{immediateUpdate:!0}),y:i.t.Numeric(0,{min:0,max:0,step:1},{immediateUpdate:!0}),z:i.t.Numeric(0,{min:0,max:0,step:1},{immediateUpdate:!0}),relativeX:i.t.Numeric(0,{min:0,max:1,step:.01},{immediateUpdate:!0}),relativeY:i.t.Numeric(0,{min:0,max:1,step:.01},{immediateUpdate:!0}),relativeZ:i.t.Numeric(0,{min:0,max:1,step:.01},{immediateUpdate:!0})},{isEssential:!0,hideIf:e=>"grid"!==e.mode,description:"Slice position in grid coordinates."}),isoValue:o.f.IsoValueParam,mode:i.t.Select("grid",i.t.arrayToOptions(["grid","frame","plane"]),{description:"Grid: slice through the volume along the grid axes in integer steps. Frame: slice through the volume along arbitrary axes in any step size. Plane: an arbitrary plane defined by point and normal."}),offset:i.t.Numeric(0,{min:-1,max:1,step:.01},{isEssential:!0,immediateUpdate:!0,hideIf:e=>"frame"!==e.mode,description:"Relative offset from center."}),axis:i.t.Select("a",i.t.arrayToOptions(["a","b","c"]),{isEssential:!0,hideIf:e=>"frame"!==e.mode,description:"Axis of the frame."}),rotation:i.t.Group({axis:i.t.Vec3(ce.e.create(1,0,0),{},{description:"Axis of rotation"}),angle:i.t.Numeric(0,{min:-180,max:180,step:1},{immediateUpdate:!0,description:"Axis rotation angle in Degrees"})},{isExpanded:!0,hideIf:e=>"frame"!==e.mode}),plane:i.t.Group({point:i.t.Vec3(ce.e.create(0,0,0),{},{description:"Plane point"}),normal:i.t.Vec3(ce.e.create(1,0,0),{},{description:"Plane normal"})},{isExpanded:!0,hideIf:e=>"plane"!==e.mode})}
async function ge(e,t,n,r,i,a){switch(i.mode){case"frame":return async function(e,t,n,r,i,a){const{offset:s,isoValue:l}=i,{size:c,major:u,minor:d,normal:p,center:h,trim:f,resolution:m}=function(e,t){const{axis:n,rotation:r,mode:i}=t,a=o.x.getGridToCartesianTransform(e.grid),s=pe.$.invert((0,pe.$)(),a),[l,c,u]=e.grid.cells.space.dimensions,d=l,p=c,h=u,f=ce.e.create(d,0,0),m=ce.e.create(0,p,0),g=ce.e.create(0,0,h),y=Math.max(d,p,h)/Math.max(l,c,u),v=ce.e.create(0,0,0),b=ce.e.create(d,p,h)
ce.e.transformMat4(v,v,a),ce.e.transformMat4(b,b,a)
const x=ce.e.center((0,ce.e)(),b,v),S=(0,ce.e)(),_=(0,ce.e)(),C=(0,ce.e)(),w=(0,ce.e)()
if("c"===n?(ce.e.set(S,d,p,h),ce.e.copy(_,f),ce.e.copy(C,m),ce.e.copy(w,g)):"b"===n?(ce.e.set(S,d,h,p),ce.e.copy(_,f),ce.e.copy(w,m),ce.e.copy(C,g)):(ce.e.set(S,p,h,d),ce.e.copy(w,f),ce.e.copy(_,m),ce.e.copy(C,g)),0!==r.angle){const e=(0,ce.e)()
ce.e.scaleAndAdd(e,e,f,r.axis[0]),ce.e.scaleAndAdd(e,e,m,r.axis[1]),ce.e.scaleAndAdd(e,e,g,r.axis[2]),ce.e.normalize(e,e)
const t=pe.$.fromRotation((0,pe.$)(),(0,de.pu)(r.angle),e)
ce.e.transformDirection(_,_,t),ce.e.transformDirection(C,C,t),ce.e.transformDirection(w,w,t)}if("frame"===i){const e=ce.e.distance(v,b),t=ce.e.distance(v,b)*Math.SQRT2
ce.e.set(S,t,t,e)}return ce.e.transformDirection(_,_,a),ce.e.transformDirection(C,C,a),ce.e.transformDirection(w,w,a),{size:S,major:_,minor:C,normal:w,center:x,trim:{type:3,center:ce.e.create(d/2,p/2,h/2),scale:ce.e.create(d,p,h),rotation:ue.k.identity(),transform:s},resolution:y}}(t,i),g=1/m,y=ce.e.create(c[0],c[1],1),v=ce.e.setMagnitude((0,ce.e)(),p,c[2]/2),b=Math.floor(c[1]*g),x=Math.floor(c[0]*g),S=pe.$.identity(),_=(0,ce.e)(),C=(0,ce.e)()
return ce.e.add(_,h,u),pe.$.targetTo(S,h,_,d),ce.e.scaleAndAdd(C,h,v,s),pe.$.setTranslation(S,C),pe.$.mul(S,S,pe.$.rotY90),pe.$.scale(S,S,y),ye(t,r,{m:S,width:b,height:x},l,f,a)}(0,t,0,r,i,a)
case"grid":return async function(e,t,n,r,i,a){const{dimension:{name:s},isoValue:l}=i,{cells:{space:c,data:u},stats:d}=t.grid,{min:p,max:h}=d,f="uniform"===r.color.granularity,m="color"in r.color&&r.color.color?r.color.color:()=>(0,se.Color)(16777215),{width:g,height:y,x:v,y:b,z:x,x0:S,y0:_,z0:C,nx:w,ny:T,nz:A}=be(t.grid,i),I=new Float32Array("x"===s||"relativeX"===s?[v,0,0,v,b,0,v,0,x,v,b,x]:"y"===s||"relativeY"===s?[0,b,0,v,b,0,0,b,x,v,b,x]:[0,0,x,0,b,x,v,0,x,v,b,x]),P=new Uint8Array(g*y*4),B=function(e,t){const{space:n}=e.cells,{width:r,height:i,x0:o,y0:a,z0:s,nx:l,ny:c,nz:u}=be(e,t),d=new Uint8Array(r*i*4)
let p=0
for(let h=a;h<c;++h)for(let e=o;e<l;++e)for(let t=s;t<u;++t)(0,le.Gu)(n.dataOffset(e,h,t),d,p),p+=4
return d}(t.grid,i),E=new Float32Array(g*y),k=o.x.getGridToCartesianTransform(t.grid),D=(0,oe.tu)((0,ce.e)(),(0,ce.e)())
let M=0
for(let o=_;o<T;++o)for(let e=S;e<w;++e)for(let t=C;t<A;++t){ce.e.set(D.position,e,o,t),ce.e.transformMat4(D.position,D.position,k),se.Color.toArray(m(D,!1),P,M)
const n=(0,he.S8)(c.get(u,e,o,t),p,h)
f&&(P[M]*=n,P[M+1]*=n,P[M+2]*=n),E[M/4]=n,M+=4}const R={width:g,height:y,array:P,flipY:!0},O={width:g,height:y,array:B,flipY:!0},L={width:g,height:y,array:E,flipY:!0},N=o.x.getGridToCartesianTransform(t.grid);(0,ae.pi)(N,I,0,4)
const F=ie._V.createEmptyTrim(),z=(0,he.qE)((0,he.S8)(o.f.IsoValue.toAbsolute(l,d).absoluteValue,p,h),0,1),j=ie._V.create(R,I,O,L,F,z,a)
return j.setBoundingSphere(o.f.getBoundingSphere(t)),j}(0,t,0,r,i,a)
case"plane":return async function(e,t,n,r,i,a){const{plane:{point:s,normal:l},isoValue:c}=i,u=pe.$.fromPlane((0,pe.$)(),l,s),d=o.x.getGridToCartesianTransform(t.grid),p=pe.$.invert((0,pe.$)(),d),[h,f,m]=t.grid.cells.space.dimensions,g=h,y=f,v=m,b=1/(Math.max(g,y,v)/Math.max(h,f,m)),x=ce.e.distance(ce.e.create(0,0,0),ce.e.create(g,y,v))*Math.SQRT2,S=ce.e.set((0,ce.e)(),x,x,x)
return pe.$.mul(u,u,pe.$.rotY90),pe.$.scale(u,u,S),ye(t,r,{m:u,width:Math.floor(S[1]*b),height:Math.floor(S[0]*b)},c,{type:3,center:ce.e.create(g/2,y/2,v/2),scale:ce.e.create(g,y,v),rotation:ue.k.identity(),transform:p},a)}(0,t,0,r,i,a)
default:(0,C.dr)(i.mode)}}function ye(e,t,n,r,i,a){const{m:s,width:l,height:c}=n,{cells:{space:u},stats:d}=e.grid,{min:p,max:h}=d,f="uniform"===t.color.granularity,m="color"in t.color&&t.color.color?t.color.color:()=>(0,se.Color)(16777215),g=(0,ce.e)(),y=o.x.getGridToCartesianTransform(e.grid),v=pe.$.invert((0,pe.$)(),y),[b,x,S]=u.dimensions,_=new Uint8Array(l*c*4),C=new Uint8Array(l*c*4),w=new Float32Array(l*c),T=(0,ce.e)(),A=(0,oe.tu)((0,ce.e)(),(0,ce.e)()),I=o.x.makeGetTrilinearlyInterpolated(e.grid,"none")
let P=0
for(let o=0;o<c;++o)for(let e=0;e<l;++e){const t=(0,he.qE)(e+.5,0,l-1)/l-.5,n=(0,he.qE)(o+.5,0,c-1)/c-.5
ce.e.set(g,n,-t,0),ce.e.transformMat4(g,g,s),ce.e.copy(T,g),ce.e.transformMat4(T,T,v)
const r=Math.trunc(T[0]),i=Math.trunc(T[1]),a=Math.trunc(T[2])
ce.e.copy(A.position,g)
const d=m(A,!1)
se.Color.toArray(d,_,P)
const y=(0,he.S8)(I(g),p,h)
f&&(_[P]*=y,_[P+1]*=y,_[P+2]*=y),w[P/4]=y,r>=0&&r<b&&i>=0&&i<x&&a>=0&&a<S&&(0,le.Gu)(u.dataOffset(r,i,a),C,P),P+=4}const B={width:l,height:c,array:_,flipY:!0},E={width:l,height:c,array:C,flipY:!0},k={width:l,height:c,array:w,flipY:!0},D=new Float32Array([-.5,.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0]);(0,ae.pi)(s,D,0,4)
const M=(0,he.qE)((0,he.S8)(o.f.IsoValue.toAbsolute(r,d).absoluteValue,p,h),0,1),R=ie._V.create(B,D,E,k,i,M,a)
return R.setBoundingSphere(o.f.getBoundingSphere(e)),R}function ve(e,t){return(0,he.qE)(Math.round((e-1)*t),0,e-1)}function be(e,t){const{dimension:{name:n,params:r}}=t,{space:i}=e.cells
let o,a,s,l,c,u=0,d=0,p=0,[h,f,m]=i.dimensions
return"x"===n?(s=r,l=f,c=m,o=m,a=f,u=s,h=u+1):"y"===n?(s=h,l=r,c=m,o=m,a=h,d=l,f=d+1):"z"===n?(s=h,l=f,c=r,o=h,a=f,p=c,m=p+1):"relativeX"===n?(s=ve(h,r),l=f,c=m,o=m,a=f,u=s,h=u+1):"relativeY"===n?(s=h,l=ve(f,r),c=m,o=m,a=h,d=l,f=d+1):(s=h,l=f,c=ve(m,r),o=h,a=f,p=c,m=p+1),{width:o,height:a,x:s,y:l,z:c,x0:u,y0:d,z0:p,nx:h,ny:f,nz:m}}function xe(e,t,n){if("grid"===n.mode){const r=function(e,t){const{space:n}=e.cells,{width:r,height:i,x0:o,y0:a,z0:s,nx:l,ny:c,nz:u}=be(e,t),d=new Uint32Array(r*i)
let p=0
for(let h=a;h<c;++h)for(let e=o;e<l;++e)for(let t=s;t<u;++t)d[p]=n.dataOffset(e,h,t),p+=1
return d}(e.grid,n),i=fe.X.ofUnsortedArray(r)
return o.f.Cell.Loci(e,[{indices:i,instances:t}])}return o.f.Loci(e,t)}function Se(e,t){return xe(e,A.I.ofLength(e.instances.length),t)}function _e(e,t,n,r,i){const{objectId:a,groupId:s,instanceId:l}=e
if(i===a){const e=o.f.PickingGranularity.get(t),n=I.C.ofSingleton(l)
if("volume"===e)return o.f.Loci(t,n)
if("object"===e||s===D.$.Null)return xe(t,n,r)
{const e=A.I.ofSingleton(s)
return o.f.Cell.Loci(t,[{indices:e,instances:n}])}}return h.EmptyLoci}function Ce(e,t,n,r,i){return(0,R.bk)(e,t,void 0,i)}function we(e){return B({defaultProps:i.t.getDefaultValues(me),createGeometry:ge,createLocationIterator:R.w6,getLoci:_e,eachLocation:Ce,setUpdateState:(e,t,n,r,i,a)=>{e.createGeometry=!(n.dimension.name===r.dimension.name&&n.dimension.params===r.dimension.params&&n.mode===r.mode&&ce.e.equals(n.rotation.axis,r.rotation.axis)&&n.rotation.angle===r.rotation.angle&&n.offset===r.offset&&n.axis===r.axis&&ce.e.equals(n.plane.point,r.plane.point)&&ce.e.equals(n.plane.normal,r.plane.normal)&&o.f.IsoValue.areSame(n.isoValue,r.isoValue,t.grid.stats)&&m.J.areEqual(i.color,a.color))},geometryUtils:ie._V.Utils},e)}const Te={name:"slice",label:"Slice",description:"Slice of volume rendered as image with interpolation.",factory:function(e,t){return E("Slice",e,t,we,Se)},getParams:function(e,t){const n=i.t.clone(me),r=t.grid.cells.space.dimensions
return n.dimension=i.t.MappedStatic("x",{x:i.t.Numeric(0,{min:0,max:r[0]-1,step:1},{immediateUpdate:!0}),y:i.t.Numeric(0,{min:0,max:r[1]-1,step:1},{immediateUpdate:!0}),z:i.t.Numeric(0,{min:0,max:r[2]-1,step:1},{immediateUpdate:!0}),relativeX:i.t.Numeric(0,{min:0,max:1,step:.01},{immediateUpdate:!0}),relativeY:i.t.Numeric(0,{min:0,max:1,step:.01},{immediateUpdate:!0}),relativeZ:i.t.Numeric(0,{min:0,max:1,step:.01},{immediateUpdate:!0})},{isEssential:!0,hideIf:e=>"grid"!==e.mode}),n.isoValue=o.f.createIsoValueParam(o.f.IsoValue.absolute(t.grid.stats.min),t.grid.stats),n},defaultValues:i.t.getDefaultValues(me),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>!o.f.isEmpty(e)&&!o.f.Segmentation.get(e)}
var Ae=n(14294),Ie=n(40362)
function Pe(e,t){const n=(0,Ae.DJ)()
return Ae.DJ.add(n,e),Ae.DJ.transform(n,n,t),n}function Be(e){if("matrix"===e.transform.kind)return{unitToCartn:b.$I.mul((0,b.$I)(),e.transform.matrix,b.$I.fromScaling((0,b.$I)(),e.cells.space.dimensions)),cellDim:b.$I.getScaling((0,b.eB)(),e.transform.matrix)}
const t=e.transform.fractionalBox,n=Ae.DJ.size((0,b.eB)(),t)
return{unitToCartn:b.$I.mul3((0,b.$I)(),e.transform.cell.fromFractional,b.$I.fromTranslation((0,b.$I)(),t.min),b.$I.fromScaling((0,b.$I)(),n)),cellDim:b.eB.div((0,b.eB)(),e.transform.cell.size,e.cells.space.dimensions)}}async function Ee(e,t,n,r,i,a){const{runtime:s,webgl:l}=e
if(void 0===l)throw new Error("DirectVolumeVisual requires `webgl` in VisualContext")
return l.isWebGL2?function(e,t,n,r,i){const a=n.grid.cells.space.dimensions
if(Math.max(...a)>t.max3dTextureSize/2)throw new Error("volume too large for direct-volume rendering")
const s="halfFloat"!==r.dataType||t.extensions.textureHalfFloat?r.dataType:"float",l=(0,R.tO)(n,s),c=o.x.getGridToCartesianTransform(n.grid),u=Pe(a,c)
let d
d=i&&i.dataType.ref.value===s?i.gridTexture.ref.value:"byte"===s?t.resources.texture("volume-uint8","rgba","ubyte","linear"):"halfFloat"===s?t.resources.texture("volume-float16","rgba","fp16","linear"):t.resources.texture("volume-float32","rgba","float","linear"),d.load(l)
const{unitToCartn:p,cellDim:h}=Be(n.grid),f=n.grid.cells.space.axisOrderSlowToFast
return Ie.E.create(u,a,c,p,h,d,n.grid.stats,!1,f,s,i)}(0,l,t,i,a):function(e,t,n,r,i){const a=n.grid.cells.space.dimensions,{width:s,height:l}=(0,R.Ud)(a)
if(Math.max(s,l)>t.maxTextureSize/2)throw new Error("volume too large for direct-volume rendering")
const c="halfFloat"!==r.dataType||t.extensions.textureHalfFloat?r.dataType:"float",u=(0,R.sz)(n,"normals",0,c),d=o.x.getGridToCartesianTransform(n.grid),p=Pe(a,d)
let h
h=i&&i.dataType.ref.value===c?i.gridTexture.ref.value:"byte"===c?t.resources.texture("image-uint8","rgba","ubyte","linear"):"halfFloat"===c?t.resources.texture("image-float16","rgba","fp16","linear"):t.resources.texture("image-float32","rgba","float","linear"),h.load(u)
const{unitToCartn:f,cellDim:m}=Be(n.grid),g=n.grid.cells.space.axisOrderSlowToFast
return Ie.E.create(p,a,d,f,m,h,n.grid.stats,!1,g,c,i)}(0,l,t,i,a)}function ke(e,t){const n=A.I.ofLength(e.instances.length)
return o.f.Loci(e,n)}function De(e,t,n,r,i){const{objectId:a,groupId:s,instanceId:l}=e
if(i===a){const e=I.C.ofSingleton(l),n=A.I.ofSingleton(s)
return o.f.Cell.Loci(t,[{indices:n,instances:e}])}return h.EmptyLoci}function Me(e,t,n,r,i){return(0,R.bk)(e,t,void 0,i)}const Re={...Ie.E.Params,quality:{...Ie.E.Params.quality,isEssential:!1},dataType:i.t.Select("byte",i.t.arrayToOptions(["byte","float","halfFloat"]))}
function Oe(e){return B({defaultProps:i.t.getDefaultValues(Re),createGeometry:Ee,createLocationIterator:R.w6,getLoci:De,eachLocation:Me,setUpdateState:(e,t,n,r)=>{e.createGeometry=n.dataType!==r.dataType},geometryUtils:Ie.E.Utils,dispose:e=>{e.gridTexture.ref.value.destroy()}},e)}const Le={name:"direct-volume",label:"Direct Volume",description:"Direct rendering of volumetric data.",factory:function(e,t){return E("Direct Volume",e,t,Oe,ke)},getParams:function(e,t){const n=i.t.clone(Re)
return n.controlPoints.getVolume=()=>t,n},defaultValues:i.t.getDefaultValues(Re),defaultColorTheme:{name:"volume-value"},defaultSizeTheme:{name:"uniform"},locationKinds:["position-location","direct-location"],isApplicable:e=>!o.f.isEmpty(e)&&!o.f.Segmentation.get(e)}
var Ne=n(52057)
const Fe={segments:i.t.Converted(e=>e.map(e=>`${e}`),e=>e.map(e=>parseInt(e)),i.t.MultiSelect(["0"],i.t.arrayToOptions(["0"]),{isEssential:!0}))}
function ze(e,t){if(e.grid.cells.data.length<Math.pow(10,3))return!1
const n=e.grid.cells.space.dimensions,{powerOfTwoSize:r}=(0,R.Ud)(n,1)
return r<=t.maxTextureSize/2}const je=(0,b.$I)()
function Ve(e,t){const n=o.x.getGridToCartesianTransform(e),r=b.$I.fromTranslation(je,t.min)
return b.$I.mul((0,b.$I)(),n,r)}function Ue(e,t,n,r,s){return r.tryUseGpu&&s&&function(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.drawBuffers}(s)&&ze(t,s)?function(e){return B({defaultProps:i.t.getDefaultValues($e),createGeometry:We,createLocationIterator:(e,t)=>{const n=o.f.Segment.Location(e,t)
return(0,oe.iQ)(e.grid.cells.data.length,e.instances?e.instances.length:1,1,()=>n)},getLoci:He,eachLocation:qe,setUpdateState:(e,t,n,r)=>{},geometryUtils:O.X.Utils,mustRecreate:(e,t,n)=>!t.tryUseGpu||!n||!ze(e.volume,n),dispose:e=>{e.vertexTexture.ref.value.destroy(),e.groupTexture.ref.value.destroy(),e.normalTexture.ref.value.destroy(),e.doubleBuffer.destroy()}},e)}(e):function(e){return B({defaultProps:i.t.getDefaultValues($e),createGeometry:Qe,createLocationIterator:(e,t)=>{const n=o.f.Segment.Location(e,t)
return(0,oe.iQ)(e.grid.cells.data.length,e.instances?e.instances.length:1,1,()=>n)},getLoci:He,eachLocation:qe,setUpdateState:(e,t,n,r)=>{},geometryUtils:a.e.Utils,mustRecreate:(e,t,n)=>t.tryUseGpu&&!!n&&ze(e.volume,n)},e)}(e)}function Ge(e,t){const n=fe.X.ofUnsortedArray(t.segments),r=A.I.ofLength(e.instances.length)
return o.f.Segment.Loci(e,[{segments:n,instances:r}])}function He(e,t,n,r,i){const{objectId:a,groupId:s,instanceId:l}=e
if(i===a){const e=o.f.PickingGranularity.get(t),r=I.C.ofSingleton(l)
if("volume"===e)return o.f.Loci(t,r)
if("object"===e||s===D.$.Null){const e=I.C.ofSingleton(n)
return o.f.Segment.Loci(t,[{segments:e,instances:r}])}{const e=A.I.ofSingleton(s)
return o.f.Cell.Loci(t,[{indices:e,instances:r}])}}return h.EmptyLoci}function qe(e,t,n,r,i){const o=fe.X.ofSingleton(n)
return(0,R.bk)(e,t,{segments:o},i)}async function Qe(e,t,n,r,i,l){const c=o.f.Segmentation.get(t)
if(!c)throw new Error("missing volume segmentation")
e.runtime.update({message:"Marching cubes..."})
const u=Ne.D.clone(c.bounds[n])
Ne.D.expand(u,u,b.eB.create(2,2,2))
const d=function(e,t,n){const r=n.data,i=n.space.dataOffset,o=Ne.D.size((0,b.eB)(),t),[a,s,l]=o,c=a-1,u=s-1,d=l-1,[p,h,f]=t.min,[m,g,y]=t.max,v=[...n.space.axisOrderSlowToFast],x=b.qY.Space(o,v,Uint8Array),S=b.qY.create(x,x.create()),_=S.data,C=x.set
for(let b=0;b<l;++b)for(let t=0;t<s;++t)for(let n=0;n<a;++n){const o=e.includes(r[i(n+p,t+h,b+f)])?255:0,a=e.includes(r[i(Math.min(c+m,n+1+p),t+h,b+f)])?255:0,s=e.includes(r[i(Math.max(0,n-1+p),t+h,b+f)])?255:0,l=e.includes(r[i(n+p,Math.min(u+g,t+1+h),b+f)])?255:0,v=e.includes(r[i(n+p,Math.max(0,t-1+h),b+f)])?255:0,x=e.includes(r[i(n+p,t+h,Math.min(d+y,b+1+f))])?255:0,S=e.includes(r[i(n+p,t+h,Math.max(0,b-1+f))])?255:0
C(_,n,t,b,Math.round((o+o+a+s+l+v+x+S)/8))}return S}(Array.from(c.segments.get(n).values()),u,t.grid.cells),p=(0,M.WE)(new Int32Array(d.data.length)),h=await(0,s.O)({isoLevel:128,scalarField:d,idField:b.qY.create(d.space,b.qY.Data1(p))},l).runAsChild(e.runtime),f=Ve(t.grid,u)
a.e.transform(h,f),e.webgl&&!e.webgl.isWebGL2?(a.e.uniformTriangleGroup(h,!1),F.IQ.updateIfChanged(h.varyingGroup,!1)):F.IQ.updateIfChanged(h.varyingGroup,!0)
const m=A.I.ofLength(t.instances.length),g=I.C.ofSingleton(n)
return h.setBoundingSphere(o.f.Segment.getBoundingSphere(t,[{segments:g,instances:m}])),h}const $e={...a.e.Params,...O.X.Params,...Fe,quality:{...a.e.Params.quality,isEssential:!1},tryUseGpu:i.t.Boolean(!0)},Xe="segment-texture"
async function We(e,t,n,r,i,a){if(!e.webgl)throw new Error("webgl context required to create volume segment texture-mesh")
if(t.grid.cells.data.length<=1)return O.X.createEmpty(a)
const{texture:s,gridDimension:l,gridTexDim:c,gridDataDim:u,gridTexScale:d,transform:p}=function(e,t,n){const r=o.f.Segmentation.get(e)
if(!r)throw new Error("missing volume segmentation")
const{resources:i}=n,a=Ne.D.clone(r.bounds[t])
Ne.D.expand(a,a,b.eB.create(2,2,2))
const s=Ve(e.grid,a),l=Ne.D.size((0,b.eB)(),a),{width:c,height:u,powerOfTwoSize:d}=(0,R.Ud)(l,1),p=b.eB.create(c,u,0),h=b.eB.clone(l),f=b.ZY.create(c/d,u/d)
if(d>n.maxTextureSize/2)throw new Error("volume too large for gpu segment extraction")
n.namedTextures[Xe]||(n.namedTextures[Xe]=i.texture("image-uint8","alpha","ubyte","linear"))
const m=n.namedTextures[Xe]
m.define(d,d)
const g=Array.from(r.segments.get(t).values())
return m.load((0,R.td)(e,g,a,1),!0),l[0]+=1,l[1]+=1,{texture:m,transform:s,gridDimension:l,gridTexDim:p,gridDataDim:h,gridTexScale:f}}(t,n,e.webgl),h=t.grid.cells.space.axisOrderSlowToFast,f=null==a?void 0:a.doubleBuffer.get(),m=(0,L._)(e.webgl,s,l,c,u,d,p,.5,!1,!1,h,!0,null==f?void 0:f.vertex,null==f?void 0:f.group,null==f?void 0:f.normal),g=t.grid.cells.data.length,y=A.I.ofLength(t.instances.length),v=I.C.ofSingleton(n),x=o.f.Segment.getBoundingSphere(t,[{segments:v,instances:y}])
return O.X.create(m.vertexCount,g,m.vertexTexture,m.groupTexture,m.normalTexture,x,a)}function Ye(e){return fe.X.ofUnsortedArray(e.segments)}const Ze={segment:(e,t)=>E("Segment mesh",e,t,Ue,Ge,Ye)},Ke={...$e,visuals:i.t.MultiSelect(["segment"],i.t.objectToOptions(Ze)),bumpFrequency:i.t.Numeric(1,{min:0,max:10,step:.1},x.iy.ShadingCategory)},Je={name:"segment",label:"Segment",description:"Displays a triangulated segment of volumetric data.",factory:function(e,t){return r.YL.createMulti("Segment",e,t,r.YL.StateBuilder,Ze)},getParams:function(e,t){const n=i.t.clone(Ke),r=o.f.Segmentation.get(t)
if(r){const e=Array.from(r.segments.keys())
n.segments=i.t.Converted(e=>e.map(e=>`${e}`),e=>e.map(e=>parseInt(e)),i.t.MultiSelect(e.map(e=>`${e}`),i.t.arrayToOptions(e.map(e=>`${e}`)),{isEssential:!0}))}return n},defaultValues:i.t.getDefaultValues(Ke),defaultColorTheme:{name:"volume-segment"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>!o.f.isEmpty(e)&&!!o.f.Segmentation.get(e)}
var et=n(32520),tt=n(83794),nt=n(47134),rt=n(10268),it=n(27011),ot=n(65580),at=n(38442)
const st={isoValue:o.f.IsoValueParam,perturbPositions:i.t.Boolean(!1)},lt={...et.v.Params,...a.e.Params,...st,tryUseImpostor:i.t.Boolean(!0),detail:i.t.Numeric(0,{min:0,max:3,step:1},x.iy.CustomQualityParamInfo)}
function ct(e,t,n,r,s){return r.tryUseImpostor&&s&&s.extensions.fragDepth&&s.extensions.textureFloat?function(e){return B({defaultProps:i.t.getDefaultValues(lt),createGeometry:ht,createLocationIterator:R.w6,getLoci:bt,eachLocation:xt,setUpdateState:(e,t,n,r,i,a)=>{e.createGeometry=!o.f.IsoValue.areSame(n.isoValue,r.isoValue,t.grid.stats)||n.perturbPositions!==r.perturbPositions},geometryUtils:et.v.Utils,mustRecreate:(e,t,n)=>!t.tryUseImpostor||!n},e)}(e):function(e){return B({defaultProps:i.t.getDefaultValues(lt),createGeometry:ft,createLocationIterator:R.w6,getLoci:bt,eachLocation:xt,setUpdateState:(e,t,n,r,i,a)=>{e.createGeometry=!o.f.IsoValue.areSame(n.isoValue,r.isoValue,t.grid.stats)||n.perturbPositions!==r.perturbPositions||n.sizeFactor!==r.sizeFactor||n.detail!==r.detail},geometryUtils:a.e.Utils,mustRecreate:(e,t,n)=>t.tryUseImpostor&&!!n},e)}(e)}function ut(e){return{...b.$I.extractBasis(e),maxScale:b.$I.getMaxScaleOnAxis(e)}}const dt=(0,ce.e)()
function pt({x:e,y:t,z:n,maxScale:r}){const i=(Math.random()-.5)*r,o=(Math.random()-.5)*r,a=(Math.random()-.5)*r
return ce.e.scale(dt,e,i),ce.e.scaleAndAdd(dt,dt,t,o),ce.e.scaleAndAdd(dt,dt,n,a),dt}function ht(e,t,n,r,i,a){const{cells:{space:s,data:l},stats:c}=t.grid,u=o.x.getGridToCartesianTransform(t.grid),d=o.f.IsoValue.toAbsolute(i.isoValue,c).absoluteValue,p=(0,ce.e)(),[h,f,m]=s.dimensions,g=Math.ceil(h*f*m/10),y=nt.Q.create(g,Math.ceil(g/2),a),v=d<0,b=i.perturbPositions?ut(u):void 0
for(let o=0;o<m;++o)for(let e=0;e<f;++e)for(let t=0;t<h;++t){const n=s.get(l,t,e,o)
if(!v&&n<d||v&&n>d)continue
const r=s.dataOffset(t,e,o)
if(b){ce.e.set(p,t,e,o),ce.e.transformMat4(p,p,u)
const n=pt(b)
ce.e.add(p,p,n)}else ce.e.set(p,t,e,o),ce.e.transformMat4(p,p,u)
y.add(p[0],p[1],p[2],r)}const x=y.getSpheres()
return x.setBoundingSphere(o.f.Isosurface.getBoundingSphere(t,i.isoValue)),x}function ft(e,t,n,r,i,a){const{detail:s,sizeFactor:l}=i,{cells:{space:c,data:u},stats:d}=t.grid,p=o.x.getGridToCartesianTransform(t.grid),h=o.f.IsoValue.toAbsolute(i.isoValue,d).absoluteValue,f=(0,ce.e)(),[m,g,y]=c.dimensions,v=Math.ceil(m*g*y/10)*(0,it.J)(s),b=tt.P.createState(v,Math.ceil(v/2),a),x=o.f.Cell.Location(t),S=r.size.size,_=h<0,C=i.perturbPositions?ut(p):void 0
for(let o=0;o<y;++o)for(let e=0;e<g;++e)for(let t=0;t<m;++t){const n=c.get(u,t,e,o)
if(!_&&n<h||_&&n>h)continue
const r=c.dataOffset(t,e,o)
x.cell=r
const i=S(x)*l
if(C){ce.e.set(f,t,e,o),ce.e.transformMat4(f,f,p)
const n=pt(C)
ce.e.add(f,f,n)}else ce.e.set(f,t,e,o),ce.e.transformMat4(f,f,p)
b.currentGroup=r,(0,rt.X)(b,f,i,s)}const w=tt.P.getMesh(b)
return w.setBoundingSphere(o.f.Isosurface.getBoundingSphere(t,i.isoValue)),w}const mt={...ot.O.Params,...st}
function gt(e){return B({defaultProps:i.t.getDefaultValues(mt),createGeometry:yt,createLocationIterator:R.w6,getLoci:bt,eachLocation:xt,setUpdateState:(e,t,n,r,i,a)=>{e.createGeometry=!o.f.IsoValue.areSame(n.isoValue,r.isoValue,t.grid.stats)||n.perturbPositions!==r.perturbPositions},geometryUtils:ot.O.Utils},e)}function yt(e,t,n,r,i,a){const{cells:{space:s,data:l},stats:c}=t.grid,u=o.x.getGridToCartesianTransform(t.grid),d=o.f.IsoValue.toAbsolute(i.isoValue,c).absoluteValue,p=(0,ce.e)(),[h,f,m]=s.dimensions,g=Math.ceil(h*f*m/10),y=at.N.create(g,Math.ceil(g/2),a),v=d<0,b=i.perturbPositions?ut(u):void 0
for(let o=0;o<m;++o)for(let e=0;e<f;++e)for(let t=0;t<h;++t){const n=s.get(l,t,e,o)
if(!v&&n<d||v&&n>d)continue
const r=s.dataOffset(t,e,o)
if(b){ce.e.set(p,t,e,o),ce.e.transformMat4(p,p,u)
const n=pt(b)
ce.e.add(p,p,n)}else ce.e.set(p,t,e,o),ce.e.transformMat4(p,p,u)
y.add(p[0],p[1],p[2],r)}const x=y.getPoints()
return x.setBoundingSphere(o.f.Isosurface.getBoundingSphere(t,i.isoValue)),x}function vt(e,t){const n=A.I.ofLength(e.instances.length)
return o.f.Isosurface.Loci(e,t.isoValue,n)}function bt(e,t,n,r,i){const{objectId:a,groupId:s,instanceId:l}=e
if(i===a){const e=o.f.PickingGranularity.get(t),n=I.C.ofSingleton(l)
if("volume"===e)return o.f.Loci(t,n)
if("object"===e||s===D.$.Null)return o.f.Isosurface.Loci(t,r.isoValue,n)
{const e=A.I.ofSingleton(s)
return o.f.Cell.Loci(t,[{indices:e,instances:n}])}}return h.EmptyLoci}function xt(e,t,n,r,i){return(0,R.bk)(e,t,{isoValue:r.isoValue},i)}const St={sphere:(e,t)=>E("Dot sphere",e,t,ct,vt),point:(e,t)=>E("Dot point",e,t,gt,vt)},_t={...lt,...mt,visuals:i.t.MultiSelect(["sphere"],i.t.objectToOptions(St)),bumpFrequency:i.t.Numeric(1,{min:0,max:10,step:.1},x.iy.ShadingCategory)},Ct={name:"dot",label:"Dot",description:"Displays dots of volumetric data.",factory:function(e,t){return r.YL.createMulti("Dot",e,t,r.YL.StateBuilder,St)},getParams:function(e,t){const n=i.t.clone(_t)
return n.isoValue=o.f.createIsoValueParam(o.f.IsoValue.relative(2),t.grid.stats),n},defaultValues:i.t.getDefaultValues(_t),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>!o.f.isEmpty(e)&&!o.f.Segmentation.get(e)}
class wt extends r.lN{constructor(){super(),(0,re.IF)(wt.BuiltIn,(e,t)=>{if(e.name!==t)throw new Error(`Fix BuiltInVolumeRepresentations to have matching names. ${e.name} ${t}`)
this.add(e)})}}!function(e){e.BuiltIn={"direct-volume":Le,dot:Ct,isosurface:ne,segment:Je,slice:Te}}(wt||(wt={}))},4482(e,t,n){"use strict"
function r([e]){return Math.sqrt(e)}n.r(t),n.d(t,{default:()=>i,sqrt:()=>r})
var i=(0,n(10336).helper)(r)},4485(e,t,n){"use strict"
n.d(t,{W:()=>i,x:()=>r})
const r="0.3.0"
var i
!function(e){let t,n
!function(e){e[e.Int8=1]="Int8",e[e.Int16=2]="Int16",e[e.Int32=3]="Int32",e[e.Uint8=4]="Uint8",e[e.Uint16=5]="Uint16",e[e.Uint32=6]="Uint32"}(t=e.IntDataType||(e.IntDataType={})),function(e){e[e.Float32=32]="Float32",e[e.Float64=33]="Float64"}(n=e.FloatDataType||(e.FloatDataType={})),e.getDataType=function(t){let n
return n=t instanceof Int8Array?e.IntDataType.Int8:t instanceof Int16Array?e.IntDataType.Int16:t instanceof Int32Array?e.IntDataType.Int32:t instanceof Uint8Array?e.IntDataType.Uint8:t instanceof Uint16Array?e.IntDataType.Uint16:t instanceof Uint32Array?e.IntDataType.Uint32:t instanceof Float32Array?e.FloatDataType.Float32:t instanceof Float64Array?e.FloatDataType.Float64:e.IntDataType.Int32,n},e.isSignedIntegerDataType=function(e){if(e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array)return!0
for(let t=0,n=e.length;t<n;t++)if(t<0)return!1
return!0}}(i||(i={}))},4800(e,t,n){"use strict"
n.d(t,{VH:()=>u,rj:()=>i,ss:()=>l,uu:()=>c})
var r=n(46712)
function i(e,t,n){for(let r=0,i=n.length;r<i;r++){const i=n.charCodeAt(r)
if(i<128)e[t++]=i>>>0&127
else if(i<2048)e[t++]=i>>>6&31|192,e[t++]=i>>>0&63|128
else if(i<65536)e[t++]=i>>>12&15|224,e[t++]=i>>>6&63|128,e[t++]=i>>>0&63|128
else{if(!(i<1114112))throw new Error("bad codepoint "+i)
e[t++]=i>>>18&7|240,e[t++]=i>>>12&63|128,e[t++]=i>>>6&63|128,e[t++]=i>>>0&63|128}}}const o=function(){const e=[]
for(let t=0;t<1024;t++)e[t]=String.fromCharCode(t)
return e}()
function a(e){throw new Error(e)}const s="undefined"!=typeof TextDecoder?new TextDecoder:void 0
function l(e,t=0,n=e.length){if(s){const r=t||n!==e.length?e.subarray(t,t+n):e
return s.decode(r)}return function(e,t,n){const r=o
let i,s=0
const l=[]
for(let o=t,c=t+n;o<c;o++){const t=e[o]
128&t?192==(224&t)?l[s++]=r[(15&t)<<6|63&e[++o]]:224==(240&t)?l[s++]=String.fromCharCode((15&t)<<12|(63&e[++o])<<6|63&e[++o]):240==(248&t)?l[s++]=String.fromCharCode((7&t)<<18|(63&e[++o])<<12|(63&e[++o])<<6|63&e[++o]):a("Invalid byte "+t.toString(16)):l[s++]=r[t],512===s&&(i=i||[],i[i.length]=l.join(""),s=0)}return i?(s>0&&(i[i.length]=l.slice(0,s).join("")),i.join("")):l.slice(0,s).join("")}(e,t,n)}function c(e,t=0,n=e.length){if(n<=r.Mx)return l(e,t,n)
const i=r.Sn.fromUtf8Data(e,t,t+n)
return i.length<=r.Mx?i.toString():i}function u(e){let t=0
for(let n=0,r=e.length;n<r;n++){const r=e.charCodeAt(n)
r<128?t+=1:r<2048?t+=2:r<65536?t+=3:r<1114112?t+=4:a("bad codepoint "+r)}return t}},5378(e,t,n){"use strict"
n.d(t,{pm:()=>u,yR:()=>d,hM:()=>c,Vs:()=>p})
var r=n(57959),i=n(70429),o=n(7888),a=n(5638)
const s="undefined"!=typeof performance&&!!performance.mark&&performance.measure&&a.g$
var l
function c(e,t,n=250){const r=f(e,t,n)
return y(e,new S(r,r.root))}function u(e,t,n=250){const r=f(e,t,n)
return new S(r,r.root)}function d(e,t){return y(t,e)}function p(e,t,n){return e.runChild(t,n)}function h(e){return{taskId:e.id,taskName:e.name,message:"",startedTime:0,canAbort:!0,isIndeterminate:!0,current:0,max:0}}function f(e,t,n){const r={abortRequested:!1,treeAborted:!1,reason:""}
return{updateRateMs:n,lastNotified:(0,i.t)(),observer:t,abortToken:r,taskId:e.id,root:{progress:h(e),children:[]},tryAbort:(o=r,e=>{o.abortRequested=!0,o.reason=e||o.reason})}
var o}function m(e){return{progress:{...e.progress},children:e.children.map(m)}}function g(e){return e.progress.canAbort&&e.children.every(g)}async function y(e,t){l.markStart(e),t.node.progress.startedTime=(0,i.t)()
try{const n=await e.f(t)
return l.markEnd(e),l.measure(e),t.info.abortToken.abortRequested&&v(t.info),n}catch(n){throw r.Y.isAbort(n)&&(t.isAborted=!0,t.node.children.length>0&&await new Promise(e=>{t.onChildrenFinished=e}),e.onAbort&&e.onAbort()),n}}function v(e){throw e.abortToken.treeAborted||(e.abortToken.treeAborted=!0,b(e.root),x(e,(0,i.t)())),r.Y.Aborted(e.abortToken.reason)}function b(e){const t=e.progress
t.isIndeterminate=!0,t.canAbort=!1,t.message="Aborting..."
for(const n of e.children)b(n)}function x(e,t){e.lastNotified=t
const n=function(e){return{root:m(e.root),canAbort:g(e.root),requestAbort:e.tryAbort}}(e)
e.observer(n)}!function(e){function t(e){return`startTask${e.id}`}function n(e){return`endTask${e.id}`}e.markStart=function(e){s&&performance.mark(t(e))},e.markEnd=function(e){s&&performance.mark(n(e))},e.measure=function(e){s&&performance.measure(` ${e.name}`,t(e),n(e))}}(l||(l={}))
class S{checkAborted(){this.info.abortToken.abortRequested&&(this.isAborted=!0,v(this.info))}get shouldUpdate(){return this.checkAborted(),(0,i.t)()-this.lastUpdatedTime>this.info.updateRateMs}updateProgress(e){if(this.checkAborted(),!e)return
const t=this.node.progress
"string"==typeof e?(t.message=e,t.isIndeterminate=!0):(void 0!==e.canAbort&&(t.canAbort=e.canAbort),void 0!==e.message&&(t.message=e.message),void 0!==e.current&&(t.current=e.current),void 0!==e.max&&(t.max=e.max),t.isIndeterminate=void 0===t.current||void 0===t.max,void 0!==e.isIndeterminate&&(t.isIndeterminate=e.isIndeterminate))}update(e,t){if(this.lastUpdatedTime=(0,i.t)(),this.updateProgress(e),!t)return x(this.info,this.lastUpdatedTime),this.checkAborted(),o._.immediatePromise()}async runChild(e,t){this.updateProgress(t)
const n={progress:h(e),children:[]},i=this.node.children
i.push(n)
const o=new S(this.info,n)
try{return await y(e,o)}catch(e){if(r.Y.isAbort(e)&&this.isAborted)return
throw e}finally{const e=i.indexOf(n)
if(e>=0){for(let t=e,n=i.length-1;t<n;t++)i[t]=i[t+1]
i.pop()}0===i.length&&this.onChildrenFinished&&this.onChildrenFinished()}}constructor(e,t){this.isSynchronous=!1,this.isExecuting=!0,this.lastUpdatedTime=0,this.onChildrenFinished=void 0,this.node=t,this.info=e}}},5422(e,t,n){"use strict"
n.r(t),n.d(t,{DefaultFocusLociBindings:()=>T,DefaultLociLabelProvider:()=>w,DefaultSelectLociBindings:()=>S,FocusLoci:()=>I,HighlightLoci:()=>x,SelectLoci:()=>C})
var r=n(40038),i=n(39298),o=n(83748),a=n(48187),s=n(48604),l=n(43472),c=n(99321),u=n(9052),d=n(92384),p=n(89),h=n(48393),f=n(63356)
const m=c.qt,g=c.Fs,y=u.O.Trigger,v={hoverHighlightOnly:(0,u.O)([y(m.Flag.None)],"Highlight","Hover element using ${triggers}"),hoverHighlightOnlyExtend:(0,u.O)([y(m.Flag.None,g.create({shift:!0}))],"Extend highlight","From selected to hovered element along polymer using ${triggers}")},b={bindings:d.t.Value(v,{isHidden:!0}),ignore:d.t.Value([],{isHidden:!0}),preferAtoms:d.t.Boolean(!1,{description:"Always prefer atoms over bonds"}),mark:d.t.Boolean(!0)},x=a.A.create({name:"representation-highlight-loci",category:"interaction",ctor:class extends a.A.Handler{constructor(){super(...arguments),this.lociMarkProvider=(e,t)=>{this.ctx.canvas3d&&this.params.mark&&this.ctx.canvas3d.mark(e,t)}}getLoci(e){return this.params.preferAtoms&&h.Bond.isLoci(e)&&2===e.bonds.length?h.Bond.toFirstStructureElementLoci(e):e}register(){this.subscribeObservable(this.ctx.behaviors.interaction.hover,({current:e,buttons:t,modifiers:n})=>{if(!this.ctx.canvas3d||this.ctx.isBusy)return
const r=this.getLoci(e.loci)
if(this.params.ignore.includes(r.kind))return void this.ctx.managers.interactivity.lociHighlights.highlightOnly({repr:e.repr,loci:p.EmptyLoci})
let i=!1
u.O.match(this.params.bindings.hoverHighlightOnly,t,n)&&(this.ctx.managers.interactivity.lociHighlights.highlightOnly({loci:r}),i=!0),u.O.match(this.params.bindings.hoverHighlightOnlyExtend,t,n)&&(this.ctx.managers.interactivity.lociHighlights.highlightOnlyExtend({loci:r}),i=!0),i||this.ctx.managers.interactivity.lociHighlights.highlightOnly({repr:e.repr,loci:p.EmptyLoci})}),this.ctx.managers.interactivity.lociHighlights.addProvider(this.lociMarkProvider)}unregister(){this.ctx.managers.interactivity.lociHighlights.removeProvider(this.lociMarkProvider)}},params:()=>b,display:{name:"Highlight Loci on Canvas"}}),S={clickSelect:u.O.Empty,clickSelectOnly:u.O.Empty,clickToggle:(0,u.O)([y(m.Flag.Primary,g.create())],"Toggle selection","Click on element using ${triggers}"),clickToggleExtend:(0,u.O)([y(m.Flag.Primary,g.create({shift:!0}))],"Toggle extended selection","Click on element using ${triggers} to extend selection along polymer"),clickDeselect:u.O.Empty,clickDeselectAllOnEmpty:(0,u.O)([y(m.Flag.Primary,g.create())],"Deselect all","Click on nothing using ${triggers}")},_={bindings:d.t.Value(S,{isHidden:!0}),ignore:d.t.Value([],{isHidden:!0}),preferAtoms:d.t.Boolean(!1,{description:"Always prefer atoms over bonds"}),mark:d.t.Boolean(!0)},C=a.A.create({name:"representation-select-loci",category:"interaction",ctor:class extends a.A.Handler{getLoci(e){return this.params.preferAtoms&&h.Bond.isLoci(e)&&2===e.bonds.length?h.Bond.toFirstStructureElementLoci(e):e}applySelectMark(e,t){const n=this.ctx.state.data.cells.get(e)
if(n&&i.O.isRepresentation3D(n.obj)){this.spine.current=n
const e=this.spine.getRootOfType(i.O.Molecule.Structure)
if(e){t&&this.lociMarkProvider({loci:h.Structure.Loci(e.data)},r.xi.Deselect)
const n=this.ctx.managers.structure.selection.getLoci(e.data)
this.lociMarkProvider({loci:n},r.xi.Select)}}}register(){const e=e=>!p.Loci.isEmpty(e),t=[["clickSelect",e=>this.ctx.managers.interactivity.lociSelects.select(e),e],["clickToggle",e=>this.ctx.managers.interactivity.lociSelects.toggle(e),e],["clickToggleExtend",e=>this.ctx.managers.interactivity.lociSelects.toggleExtend(e),e],["clickSelectOnly",e=>this.ctx.managers.interactivity.lociSelects.selectOnly(e),e],["clickDeselect",e=>this.ctx.managers.interactivity.lociSelects.deselect(e),e],["clickDeselectAllOnEmpty",()=>this.ctx.managers.interactivity.lociSelects.deselectAll(),e=>p.Loci.isEmpty(e)]]
t.sort((e,t)=>{const n=this.params.bindings[e[0]],r=this.params.bindings[t[0]],i=0===n.triggers.length?0:(0,f._M)(n.triggers.map(e=>g.size(e.modifiers)))
return(0===r.triggers.length?0:(0,f._M)(r.triggers.map(e=>g.size(e.modifiers))))-i}),this.subscribeObservable(this.ctx.behaviors.interaction.click,({current:e,button:n,modifiers:r})=>{if(!this.ctx.canvas3d||this.ctx.isBusy||!this.ctx.selectionMode)return
const i=this.getLoci(e.loci)
if(!this.params.ignore.includes(i.kind))for(const[o,a,s]of t)if(u.O.match(this.params.bindings[o],n,r)&&(!s||s(i))){a({repr:e.repr,loci:i})
break}}),this.ctx.managers.interactivity.lociSelects.addProvider(this.lociMarkProvider),this.subscribeObservable(this.ctx.state.events.object.created,({ref:e})=>this.applySelectMark(e)),this.subscribeObservable(this.ctx.state.events.object.updated,({ref:e,obj:t,oldObj:n,oldData:r,action:o})=>{const a=this.ctx.state.data.cells.get(e)
if(a&&i.O.Molecule.Structure.is(a.obj)){const a=t.data,s="recreate"===o?null==n?void 0:n.data:"in-place"===o?r:void 0
if(s&&h.Structure.areEquivalent(a,s)&&h.Structure.areHierarchiesEqual(a,s))return
const c=this.ctx.state.data.select(l.QX.children(e).ofType(i.O.Molecule.Structure.Representation3D))
for(const e of c)this.applySelectMark(e.transform.ref,!0)}})}unregister(){this.ctx.managers.interactivity.lociSelects.removeProvider(this.lociMarkProvider)}constructor(e,t){super(e,t),this.lociMarkProvider=(e,t)=>{this.ctx.canvas3d&&this.params.mark&&this.ctx.canvas3d.mark({loci:e.loci},t)},this.spine=new s.P.Impl(e.state.data.cells)}},params:()=>_,display:{name:"Select Loci on Canvas"}}),w=a.A.create({name:"default-loci-label-provider",category:"interaction",ctor:class{register(){this.ctx.managers.lociLabels.addProvider(this.f)}unregister(){this.ctx.managers.lociLabels.removeProvider(this.f)}constructor(e){this.ctx=e,this.f={label:e=>{const t=[]
if(h.StructureElement.Loci.is(e)){const n=new Set
for(const{unit:t}of e.elements){const r=h.StructureElement.Location.create(e.structure,t,t.elements[0]),i=h.StructureProperties.entity.pdbx_description(r).join(", ")
n.add(i)}1===n.size&&n.forEach(e=>t.push(e))}return t.push((0,o.YQ)(e)),t.filter(e=>!!e).join("</br>")},group:e=>e.toString().replace(/Model [0-9]+/g,"Models"),priority:100}}},display:{name:"Provide Default Loci Label"}}),T={clickFocus:(0,u.O)([y(m.Flag.Primary,g.create()),y(m.Flag.Trigger)],"Representation Focus","Click element using ${triggers}"),clickFocusAdd:(0,u.O)([y(m.Flag.Primary,g.create({control:!0})),y(m.Flag.Primary,g.create({meta:!0}))],"Representation Focus Add","Click element using ${triggers}"),clickFocusExtend:(0,u.O)([y(m.Flag.Primary,g.create({shift:!0}))],"Representation Focus Extend","Click on element using ${triggers}"),clickFocusSelectMode:(0,u.O)([],"Representation Focus (Selection Mode)","Click element using ${triggers}"),clickFocusAddSelectMode:(0,u.O)([],"Representation Focus Add (Selection Mode)","Click element using ${triggers}"),clickFocusExtendSelectMode:(0,u.O)([],"Representation Focus Extend (Selection Mode)","Click on element using ${triggers}")},A={bindings:d.t.Value(T,{isHidden:!0})},I=a.A.create({name:"representation-focus-loci",category:"interaction",ctor:class extends a.A.Handler{register(){this.subscribeObservable(this.ctx.behaviors.interaction.click,({current:e,button:t,modifiers:n})=>{var r,i,o,a,s,l,c
const{clickFocus:d,clickFocusAdd:h,clickFocusExtend:f,clickFocusSelectMode:m,clickFocusAddSelectMode:g,clickFocusExtendSelectMode:y}=this.params.bindings,v=this.ctx.selectionMode?m:d,b=u.O.match(v,t,n),x=this.ctx.selectionMode?g:h,S=u.O.match(x,t,n),_=this.ctx.selectionMode?y:f,C=u.O.match(_,t,n)
if(!b&&!S&&!C)return
const w=null!==(a=null===(o=null===(i=null===(r=e.repr)||void 0===r?void 0:r.props)||void 0===i?void 0:i.snapshotKey)||void 0===o?void 0:o.trim())&&void 0!==a?a:""
if(!this.ctx.selectionMode&&b&&w)return void this.ctx.managers.snapshot.applyKey(w)
const T=null===(l=null===(s=e.repr)||void 0===s?void 0:s.props)||void 0===l?void 0:l.markdownCommands
if(!this.ctx.selectionMode&&b&&"object"==typeof T&&Object.keys(T).length>0)return void this.ctx.managers.markdownExtensions.tryExecute("click",T)
const{granularity:A}=this.ctx.managers.interactivity.props
if("residue"!==A&&"element"!==A)return
const I=p.Loci.normalize(e.loci,"residue"),P=this.ctx.managers.structure.focus.current
if(P&&p.Loci.areEqual(P.loci,I))this.ctx.managers.structure.focus.clear()
else if(b)this.ctx.managers.structure.focus.setFromLoci(I)
else{C?this.ctx.managers.structure.focus.extendFromLoci(I):this.ctx.managers.structure.focus.toggleFromLoci(I)
const e=null===(c=this.ctx.managers.structure.focus.current)||void 0===c?void 0:c.loci
e&&this.ctx.managers.camera.focusLoci(e)}})}},params:()=>A,display:{name:"Representation Focus Loci on Canvas"}})},5638(e,t,n){"use strict"
n.d(t,{Bb:()=>i,EF:()=>l,Zq:()=>r,fv:()=>s,g$:()=>o})
let r=function(){try{return!0}catch(e){return!1}}(),i=function(){try{const e=process.env.DEBUG
return"*"===e||"molstar"===e}catch(e){return!1}}(),o=!1
const a=[]
function s(e){a.includes(e)||a.push(e)}function l(e){const t=a.indexOf(e);-1!==t&&a.splice(t,1)}},6130(e,t,n){"use strict"
n.r(t),n.d(t,{default:()=>a,lcm:()=>o})
var r=n(10336),i=n(10828)
function o([e=0,t=0]){return 0===e||0===t?0:Math.abs(e*t)/(0,i.gcd)([e,t])}var a=(0,r.helper)(o)},6539(e,t,n){"use strict"
n.d(t,{k:()=>c})
var r=n(69755),i=n(37411),o=n(23325),a=n(91229),s=n(39250),l=n(97564)
function c(){return c.zero()}!function(e){function t(){const e=[.1,0,0,0]
return e[0]=0,e}function n(){const e=t()
return e[3]=1,e}function c(e,t,r,i){const o=n()
return o[0]=e,o[1]=t,o[2]=r,o[3]=i,o}function u(e,t,n){n*=.5
const r=Math.sin(n)
return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e}function d(e,t,n,r){const i=t[0],o=t[1],a=t[2],s=t[3]
let l,c,u,d,p,h=n[0],f=n[1],m=n[2],g=n[3]
return c=i*h+o*f+a*m+s*g,c<0&&(c=-c,h=-h,f=-f,m=-m,g=-g),1-c>1e-6?(l=Math.acos(c),u=Math.sin(l),d=Math.sin((1-r)*l)/u,p=Math.sin(r*l)/u):(d=1-r,p=r),e[0]=d*i+p*h,e[1]=d*o+p*f,e[2]=d*a+p*m,e[3]=d*s+p*g,e}function p(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function h(e,t){const n=t[0]+t[4]+t[8]
let r
if(n>0)r=Math.sqrt(n+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r
else{let n=0
t[4]>t[0]&&(n=1),t[8]>t[3*n+n]&&(n=2)
const i=(n+1)%3,o=(n+2)%3
r=Math.sqrt(t[3*n+n]-t[3*i+i]-t[3*o+o]+1),e[n]=.5*r,r=.5/r,e[3]=(t[3*i+o]-t[3*o+i])*r,e[i]=(t[3*i+n]+t[3*n+i])*r,e[o]=(t[3*o+n]+t[3*n+o])*r}return e}e.zero=t,e.identity=n,e.setIdentity=function(e){e[0]=0,e[1]=0,e[2]=0,e[3]=1},e.hasNaN=function(e){return Number.isNaN(e[0])||Number.isNaN(e[1])||Number.isNaN(e[2])||Number.isNaN(e[3])},e.create=c,e.setAxisAngle=u,e.getAxisAngle=function(e,t){const n=2*Math.acos(t[3]),r=Math.sin(n/2)
return 0!==r?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),n},e.multiply=function(e,t,n){const r=t[0],i=t[1],o=t[2],a=t[3],s=n[0],l=n[1],c=n[2],u=n[3]
return e[0]=r*u+a*s+i*c-o*l,e[1]=i*u+a*l+o*s-r*c,e[2]=o*u+a*c+r*l-i*s,e[3]=a*u-r*s-i*l-o*c,e},e.rotateX=function(e,t,n){n*=.5
const r=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(n),l=Math.cos(n)
return e[0]=r*l+a*s,e[1]=i*l+o*s,e[2]=o*l-i*s,e[3]=a*l-r*s,e},e.rotateY=function(e,t,n){n*=.5
const r=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(n),l=Math.cos(n)
return e[0]=r*l-o*s,e[1]=i*l+a*s,e[2]=o*l+r*s,e[3]=a*l-i*s,e},e.rotateZ=function(e,t,n){n*=.5
const r=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(n),l=Math.cos(n)
return e[0]=r*l+i*s,e[1]=i*l-r*s,e[2]=o*l+a*s,e[3]=a*l-o*s,e},e.calculateW=function(e,t){const n=t[0],r=t[1],i=t[2]
return e[0]=n,e[1]=r,e[2]=i,e[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i)),e},e.slerp=d,e.invert=function(e,t){const n=t[0],r=t[1],i=t[2],o=t[3],a=n*n+r*r+i*i+o*o,s=a?1/a:0
return e[0]=-n*s,e[1]=-r*s,e[2]=-i*s,e[3]=o*s,e},e.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},e.dot=p,e.fromMat3=h
const f=[0,0,0,0,0,0,0,0,0,0,0,0]
function m(e,t){return r.U.fromMat4(f,t),h(e,f)}e.fromMat4=m,e.fromEuler=function(e,t,n){const[r,i,o]=t,s=Math.cos(r/2),l=Math.cos(i/2),c=Math.cos(o/2),u=Math.sin(r/2),d=Math.sin(i/2),p=Math.sin(o/2)
switch(n){case"XYZ":e[0]=u*l*c+s*d*p,e[1]=s*d*c-u*l*p,e[2]=s*l*p+u*d*c,e[3]=s*l*c-u*d*p
break
case"YXZ":e[0]=u*l*c+s*d*p,e[1]=s*d*c-u*l*p,e[2]=s*l*p-u*d*c,e[3]=s*l*c+u*d*p
break
case"ZXY":e[0]=u*l*c-s*d*p,e[1]=s*d*c+u*l*p,e[2]=s*l*p+u*d*c,e[3]=s*l*c-u*d*p
break
case"ZYX":e[0]=u*l*c-s*d*p,e[1]=s*d*c+u*l*p,e[2]=s*l*p-u*d*c,e[3]=s*l*c+u*d*p
break
case"YZX":e[0]=u*l*c+s*d*p,e[1]=s*d*c+u*l*p,e[2]=s*l*p-u*d*c,e[3]=s*l*c-u*d*p
break
case"XZY":e[0]=u*l*c-s*d*p,e[1]=s*d*c-u*l*p,e[2]=s*l*p+u*d*c,e[3]=s*l*c+u*d*p
break
default:(0,a.dr)(n)}return e}
const g=[0,0,0]
e.fromUnitVec3=function(e,t,n){let r=i.e.dot(t,n)+1
return r<o.p?(r=0,Math.abs(t[0])>Math.abs(t[2])?i.e.set(g,-t[1],t[0],0):i.e.set(g,0,-t[2],t[1])):i.e.cross(g,t,n),e[0]=g[0],e[1]=g[1],e[2]=g[2],e[3]=r,v(e,e),e}
const y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
function v(e,t){const n=t[0],r=t[1],i=t[2],o=t[3]
let a=n*n+r*r+i*i+o*o
return a>0&&(a=1/Math.sqrt(a),e[0]=n*a,e[1]=r*a,e[2]=i*a,e[3]=o*a),e}e.fromBasis=function(e,t,n,r){return s.$.fromBasis(y,t,n,r),m(e,y)},e.clone=function(e){const n=t()
return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n},e.fromObj=function(e){return c(e.x,e.y,e.z,e.w)},e.toObj=function(e){return{x:e[0],y:e[1],z:e[2],w:e[3]}},e.toArray=function(e,t,n){return t[n+0]=e[0],t[n+1]=e[1],t[n+2]=e[2],t[n+3]=e[3],t},e.fromArray=function(e,t,n){return e[0]=t[n+0],e[1]=t[n+1],e[2]=t[n+2],e[3]=t[n+3],e},e.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},e.set=function(e,t,n,r,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e},e.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},e.equals=function(e,t){const n=e[0],r=e[1],i=e[2],a=e[3],s=t[0],l=t[1],c=t[2],u=t[3]
return Math.abs(n-s)<=o.p*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-l)<=o.p*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-c)<=o.p*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(a-u)<=o.p*Math.max(1,Math.abs(a),Math.abs(u))},e.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},e.magnitude=function(e){const t=e[0],n=e[1],r=e[2],i=e[3]
return Math.sqrt(t*t+n*n+r*r+i*i)},e.squaredMagnitude=function(e){const t=e[0],n=e[1],r=e[2],i=e[3]
return t*t+n*n+r*r+i*i},e.angle=function(e,t){return 2*Math.acos(Math.abs((0,l.qE)(p(e,t),-1,1)))},e.normalize=v
const b=[0,0,0],x=[1,0,0],S=[0,1,0]
e.rotationTo=function(e,t,n){const r=i.e.dot(t,n)
return r<-.999999?(i.e.cross(b,x,t),i.e.magnitude(b)<1e-6&&i.e.cross(b,S,t),i.e.normalize(b,b),u(e,b,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(i.e.cross(b,t,n),e[0]=b[0],e[1]=b[1],e[2]=b[2],e[3]=1+r,v(e,e))}
const _=t(),C=t()
e.sqlerp=function(e,t,n,r,i,o){return d(_,t,i,o),d(C,n,r,o),d(e,_,C,2*o*(1-o)),e}
const w=[0,0,0,0,0,0,0,0,0]
e.setAxes=function(e,t,n,r){return w[0]=n[0],w[3]=n[1],w[6]=n[2],w[1]=r[0],w[4]=r[1],w[7]=r[2],w[2]=-t[0],w[5]=-t[1],w[8]=-t[2],v(e,h(e,w))},e.toString=function(e,t){return`[${e[0].toPrecision(t)} ${e[1].toPrecision(t)} ${e[2].toPrecision(t)}  ${e[3].toPrecision(t)}]`},e.Identity=n()}(c||(c={}))},6941(e,t,n){"use strict"
n.d(t,{Bm:()=>l,EX:()=>a,d3:()=>r,ef:()=>o,vy:()=>s})
var r,i=n(18207)
function o(e,t){const{description:n,isOptional:r=!1,isRest:i=!1,defaultValue:o}=t||{}
return{type:e,isOptional:r,isRest:i,defaultValue:o,description:n}}function a(e,t,n,r){const o=function(e){return i.Expression.Apply(i.Expression.Symbol(o.id),e)}
return o.info={namespace:"",name:e,description:r},o.id="",o.args=t,o.type=n,o}function s(e,t,n,o){const a=function(e){return i.Expression.Apply(i.Expression.Symbol(a.id),e)}
return a.info={namespace:e,name:t,description:o},a.id=`${e}.${t}`,a.args=r.None,a.type=n,a}function l(e){const t=e
return"function"==typeof t&&!!t.info&&!!t.args&&"string"==typeof t.info.namespace&&!!t.type}!function(e){function t(e){return{kind:"dictionary",map:e,"@type":0}}e.None=t({}),e.Dictionary=t,e.List=function(e,t){const{nonEmpty:n=!1}=t||{}
return{kind:"list",type:e,nonEmpty:n,"@type":0}}}(r||(r={}))},6950(e,t,n){"use strict"
n.d(t,{Cd:()=>C,N$:()=>A,p3:()=>_})
var r,i=n(39298)
class o extends(i.O.Create({name:"Volume Streaming",typeClass:"Object"})){}!function(e){let t
!function(e){e.Float32="float32",e.Int8="int8"}(t=e.ValueType||(e.ValueType={}))}(r||(r={}))
var a=n(92384),s=n(70292),l=n(32896),c=n(90050),u=n(43472),d=n(42231),p=n(94528),h=n(32117),f=n(4360),m=n(3111),g=n(14294),y=n(32775),v=n(19288),b=n(48393),x=n(23782)
function S(e,t,n,r){e.push({source:"em"===t?{name:"em",params:{isoValue:c.f.IsoValue.absolute(r||0)}}:{name:"x-ray",params:{}},dataId:n})}const _=u.KW.build({display:{name:"Volume Streaming"},from:i.O.Molecule.Structure,params(e,t){const n=(0,d.AR)(e&&e.data),r=(0,d.rO)(n,e&&e.data)
return{method:a.t.Select(n,[["em","EM"],["x-ray","X-Ray"]]),entries:a.t.ObjectList({id:a.t.Text(r[0]||"")},({id:e})=>e,{defaultValue:r.map(e=>({id:e}))}),defaultView:a.t.Select("em"===n?"auto":"selection-box",p.h.ViewTypeOptions),options:a.t.Group({serverUrl:a.t.Text(t.config.get(v.PluginConfig.VolumeStreaming.DefaultServer)||"https://ds.litemol.org"),behaviorRef:a.t.Text("",{isHidden:!0}),emContourProvider:a.t.Select("emdb",[["emdb","EMDB"],["pdbe","PDBe"]],{isHidden:!0}),channelParams:a.t.Value({},{isHidden:!0})})}},isApplicable:(e,t,n)=>{const r=n.config.get(v.PluginConfig.VolumeStreaming.CanStream)
return r?r(e.data,n):1===e.data.models.length&&b.Model.probablyHasDensityMap(e.data.models[0])}})(({ref:e,state:t,params:n},r)=>s.Task.create("Volume Streaming",async i=>{const o=[]
for(let t=0,a=n.entries.length;t<a;++t){const a=n.entries[t].id.toLowerCase()
let s
if("em"===n.method){if(!a.toUpperCase().startsWith("EMD")){await i.update("Getting EMDB info...")
const t=await(0,d.t9)(r,i,a)
for(let a=0,s=t.length;a<s;++a){const s=t[a]
let l
try{l=await(0,d.lL)(n.options.emContourProvider,r,i,s)}catch(e){console.info(`Could not get map info for ${s}: ${e}`)
continue}S(o,n.method,s,l||0)}continue}try{s=await(0,d.lL)(n.options.emContourProvider,r,i,a)}catch(e){console.info(`Could not get map info for ${a}: ${e}`)
continue}}S(o,n.method,a,s||0)}const s=t.build().to(e).applyOrUpdateTagged(p.h.RootTag,T,{serverUrl:n.options.serverUrl,entries:o})
await s.commit()
const l=s.selector
if(!l.isOk)return
const c=t.tree.children.get(l.ref);(null==c?void 0:c.size)>0&&await r.managers.structure.hierarchy.remove(null==c?void 0:c.toArray())
const u=l.cell.obj,h=t.build().to(s.ref).apply(A,a.t.getDefaultValues(p.h.createParams({data:u.data,defaultView:n.defaultView,channelParams:n.options.channelParams})),{ref:n.options.behaviorRef?n.options.behaviorRef:void 0})
"em"===n.method?h.apply(I,{channel:"em"},{state:{isGhost:!0},tags:"em"}):(h.apply(I,{channel:"2fo-fc"},{state:{isGhost:!0},tags:"2fo-fc"}),h.apply(I,{channel:"fo-fc(+ve)"},{state:{isGhost:!0},tags:"fo-fc(+ve)"}),h.apply(I,{channel:"fo-fc(-ve)"},{state:{isGhost:!0},tags:"fo-fc(-ve)"})),await t.updateTree(h).runInContext(i)})),C=u.KW.build({display:{name:"Boxify Volume Streaming",description:"Make the current box permanent."},from:p.h,isApplicable:e=>"selection-box"===e.data.params.entry.params.view.name})(({a:e,ref:t,state:n},r)=>{const i=e.data.params
if("selection-box"!==i.entry.params.view.name)return
const o=g.DJ.create(y.eB.clone(i.entry.params.view.params.bottomLeft),y.eB.clone(i.entry.params.view.params.topRight)),a=i.entry.params.view.params.radius
g.DJ.expand(o,o,y.eB.create(a,a,a))
const s={...i,entry:{name:i.entry.name,params:{...i.entry.params,view:{name:"box",params:{bottomLeft:o.min,topRight:o.max}}}}}
return n.updateTree(n.build().to(t).update(s))}),w={dataId:a.t.Text(""),source:a.t.MappedStatic("x-ray",{em:a.t.Group({isoValue:c.f.createIsoValueParam(c.f.IsoValue.relative(1))}),"x-ray":a.t.Group({})})},T=i.H.BuiltIn({name:"create-volume-streaming-info",display:{name:"Volume Streaming Info"},from:i.O.Molecule.Structure,to:o,params:e=>({serverUrl:a.t.Text("https://ds.litemol.org"),entries:a.t.ObjectList(w,({dataId:e})=>e,{defaultValue:[{dataId:"",source:{name:"x-ray",params:{}}}]})})})({apply:({a:e,params:t},n)=>s.Task.create("",async r=>{const i=[]
for(let e=0,o=t.entries.length;e<o;++e){const o=t.entries[e],a=o.dataId,s="em"===o.source.name?o.source.params.isoValue:c.f.IsoValue.relative(1)
await r.update("Getting server header...")
const u=await n.fetch({url:(0,l.r)(t.serverUrl,`${o.source.name}/${a.toLocaleLowerCase()}`),type:"json"}).runInContext(r)
i.push({dataId:a,kind:o.source.name,header:u,emDefaultContourLevel:s})}const a={serverUrl:t.serverUrl,entries:i,structure:e.data}
return new o(a,{label:"Volume Server",description:`${i.map(e=>e.dataId).join(", ")}`})})}),A=i.H.BuiltIn({name:"create-volume-streaming-behavior",display:{name:"Volume Streaming Behavior"},from:o,to:p.h,params:e=>p.h.createParams({data:e&&e.data})})({canAutoUpdate:({oldParams:e,newParams:t})=>e.entry.params.view===t.entry.params.view||"selection-box"===t.entry.params.view.name||"camera-target"===t.entry.params.view.name||"off"===t.entry.params.view.name,apply:({a:e,params:t},n)=>s.Task.create("Volume streaming",async r=>{const i=new p.h.Behavior(n,e.data)
return await i.update(t),new p.h(i,{label:"Volume Streaming",description:i.getDescription()})}),update:({a:e,b:t,oldParams:n,newParams:r})=>s.Task.create("Update Volume Streaming",async e=>{if(n.entry.name!==r.entry.name&&"em"in r.entry.params.channels){const{emDefaultContourLevel:e}=t.data.infoMap.get(r.entry.name)
e&&(r.entry.params.channels.em.isoValue=e)}const i=await t.data.update(r)?u.xE.UpdateResult.Updated:u.xE.UpdateResult.Unchanged
return t.description=t.data.getDescription(),i})}),I=i.H.BuiltIn({name:"create-volume-streaming-visual",display:{name:"Volume Streaming Visual"},from:p.h,to:i.O.Volume.Representation3D,params:{channel:a.t.Select("em",p.h.ChannelTypeOptions,{isHidden:!0})}})({apply:({a:e,params:t,spine:n},r)=>s.Task.create("Volume Representation",async o=>{var a,s
const l=e.data.channels[t.channel]
if(!l)return u.BM.Null
const c=P(e.data,t.channel),d=f.H.BuiltIn.isosurface,p=c.type.params||{},h=d.factory({webgl:null===(a=r.canvas3d)||void 0===a?void 0:a.webgl,...r.representation.volume.themes},d.getParams)
h.setTheme(m.S.create(r.representation.volume.themes,{volume:l.data},c))
const g=null===(s=n.getAncestorOfType(i.O.Molecule.Structure))||void 0===s?void 0:s.data,y=0===(null==g?void 0:g.models.length)?void 0:x.T.get(null==g?void 0:g.models[0])
return await h.createOrUpdate(p,l.data).runInContext(o),y&&h.setState({transform:y}),new i.O.Volume.Representation3D({repr:h,sourceData:l.data},{label:`${Math.round(100*l.isoValue.relativeValue)/100}  [${t.channel}]`})}),update:({a:e,b:t,newParams:n,spine:r},i)=>s.Task.create("Volume Representation",async r=>{const o=e.data.channels[n.channel]
if(!o)return u.xE.UpdateResult.Unchanged
const a=t.data.repr.state.visible,s=P(e.data,n.channel),l={...t.data.repr.props,...s.type.params}
return t.data.repr.setTheme(m.S.create(i.representation.volume.themes,{volume:o.data},s)),await t.data.repr.createOrUpdate(l,o.data).runInContext(r),t.data.repr.setState({visible:a}),t.data.sourceData=o.data,u.xE.UpdateResult.Updated})})
function P(e,t){const n=e.channels[t]
return h.VolumeRepresentation3DHelpers.getDefaultParamsStatic(e.plugin,"isosurface",{isoValue:n.isoValue,alpha:n.opacity,visuals:n.wireframe?["wireframe"]:["solid"]},"uniform",{value:n.color})}},7221(e,t,n){"use strict"
n.d(t,{$J:()=>P,AR:()=>T,Dt:()=>A,FC:()=>I,LT:()=>k,UQ:()=>O,VZ:()=>b,gU:()=>y,hi:()=>w,nR:()=>x,oc:()=>D,rS:()=>_,uh:()=>S,v3:()=>R,yS:()=>C})
var r=n(48393),i=n(32775),o=n(42594),a=n(67538),s=n(89),l=n(87933),c=n(63356),u=n(92384),d=n(93036),p=n(14294),h=n(22493),f=n(5638)
const m=i.$I.toArray
let g=!1
function y(e){if(e){if(e.extensions.fragDepth&&e.extensions.textureFloat)return!0
if(f.Bb&&!g){const t=[]
e.extensions.fragDepth||t.push("fragDepth"),e.extensions.textureFloat||t.push("textureFloat"),console.warn(`Missing "${t.join('", "')}" extensions required for "sphere impostors". Falling back to "sphere mesh".`),g=!0}}else f.Bb&&!g&&(console.warn('WebGL required for "sphere impostors". Falling back to "sphere mesh".'),g=!0)
return!1}let v=!1
function b(e){if(e){if(e.extensions.fragDepth)return!0
if(f.Bb&&!v){const t=[]
e.extensions.fragDepth||t.push("fragDepth"),console.warn(`Missing "${t.join('", "')}" extensions required for "cylinder impostors". Falling back to "cylinder mesh".`),v=!0}}else f.Bb&&!v&&(console.warn('WebGL required for "cylinder impostors". Falling back to "cylinder mesh".'),v=!0)
return!1}function x(e,t,n){const{elements:i,model:o}=t
if(-1!==a.CD.indexOf(i,n)){const{index:s,offsets:l}=o.atomicHierarchy.residueAtomSegments,c=s[n],u=[]
for(let e=l[c],t=l[c+1];e<t;++e){const t=a.CD.indexOf(i,e);-1!==t&&u.push(t)}const d=a.CD.ofSortedArray(a.X9.ofSortedArray(u))
return r.StructureElement.Loci(e,[{unit:t,indices:d}])}return s.EmptyLoci}function S(e,t,n){const{elements:i,model:o}=t,{label_alt_id:s}=o.atomicHierarchy.atoms,l=s.value(n)
if(-1!==a.CD.indexOf(i,n)){const{index:r}=o.atomicHierarchy.residueAtomSegments
return _(e,t,r[n],l)}return r.StructureElement.Loci(e,[])}function _(e,t,n,i){const{elements:o,model:s}=t,{label_alt_id:l}=s.atomicHierarchy.atoms,{offsets:c}=s.atomicHierarchy.residueAtomSegments,u=[]
for(let r=c[n],p=c[n+1];r<p;++r){const e=a.CD.indexOf(o,r)
if(-1!==e){const t=l.value(r)
i!==t&&""!==t||u.push(e)}}const d=a.CD.ofSortedArray(a.X9.ofSortedArray(u))
return r.StructureElement.Loci(e,[{unit:t,indices:d}])}function C(e,t,n,r,i,a){const{child:s}=e.structure,l=t&&s?e.group.units.filter(e=>s.unitMap.has(e.id)):e.group.units,c=l.length,u=16*c,d=a&&a.aTransform.ref.value.length>=u?a.aTransform.ref.value:new Float32Array(u)
for(let o=0;o<c;o++)m(l[o].conformation.operator.matrix,d,16*o)
return(0,o.l1)(d,c,n,r,i,a)}const w=u.t.objectToOptions({atomic:{},spheres:{},gaussians:{}})
function T(e,t){for(let n=0,i=e.length;n<i;++n){if(r.Unit.isAtomic(t)&&"atomic"===e[n])return!0
if(r.Unit.isSpheres(t)&&"spheres"===e[n])return!0
if(r.Unit.isGaussians(t)&&"gaussians"===e[n])return!0}return!1}function A(e,t,n=5e8){const r=p.DJ.size((0,i.eB)(),e)
i.eB.ceil(r,r),r.sort((e,t)=>t-e)
const o=Math.floor(Math.cbrt(n)*Math.cbrt(n)),a=r[0]*r[1]
return{area:a,areaCells:Math.ceil(a/(t*t)),maxAreaCells:o}}function I(e,t,n=5e8){const{area:r,areaCells:i,maxAreaCells:o}=A(e,t.resolution,n),a=i>o?Math.sqrt(r/o):t.resolution
return{...t,resolution:a}}const P={ignoreHydrogens:u.t.Boolean(!1,{description:"Whether or not to include hydrogen atoms in the surface calculation."}),ignoreHydrogensVariant:u.t.Select("all",u.t.arrayToOptions(["all","non-polar"])),traceOnly:u.t.Boolean(!1,{description:"Whether or not to only use trace atoms in the surface calculation."}),includeParent:u.t.Boolean(!1,{description:"Include elements of the parent structure in surface calculation to get a surface patch of the current structure."})},B=(u.t.getDefaultValues(P),(0,i.eB)())
function E(e,t,n,r){return i.eB.squaredDistance(i.eB.set(B,e,t,n),r)}function k(e,t,n,i){const{ignoreHydrogens:o,ignoreHydrogensVariant:s,traceOnly:l,includeParent:u}=i,p=u?e.root.unitMap.get(t.id):t,h=u&&p!==t,{x:f,y:m,z:g}=function(e){switch(e.kind){case r.Unit.Kind.Atomic:return e.model.atomicConformation
case r.Unit.Kind.Spheres:return e.model.coarseConformation.spheres
case r.Unit.Kind.Gaussians:return e.model.coarseConformation.gaussians}}(p),{elements:y}=p,{center:v,radius:b}=t.boundary.sphere,x=(b+11)*(b+11)
let S,_
if(o||l||h){const t=[],n=[]
for(let r=0,i=y.length;r<i;++r){const i=y[r]
o&&R(e,p,i,s)||l&&!O(p,i)||h&&E(f[i],m[i],g[i],v)>x||(t.push(i),n.push(r))}S=a.X9.ofSortedArray(t),_=n}else S=y,_=(0,c.WE)(new Int32Array(S.length))
u&&p!==t&&function(e,t,n){let r=0
const i=t.length
for(let o=0,s=n.length;o<s;++o){const s=a.X9.indexOfInRange(t,n[o],r,i);-1===s?e[o]=-2:(e[o]=s,r=s)}}(_,t.elements,S)
const C={indices:S,x:f,y:m,z:g,id:_},w=h?(0,d.r)(C):t.boundary,T=r.StructureElement.Location.create(e,p)
return{position:C,boundary:w,radius:e=>(T.element=e,n.size(T))}}function D(e,t,n){const{ignoreHydrogens:i,ignoreHydrogensVariant:o,traceOnly:s,includeParent:l}=n,u=l&&!!e.parent,p=r.StructureElement.Location.create(e.root),{center:h,radius:f}=e.boundary.sphere,m=(f+11)*(f+11)
let g,y,v,b,x,S
if(i||s||u){const{getSerialIndex:n}=e.serialMapping,r=u?e.root.units:e.units,l=[],c=[],d=[],f=[],_=[]
for(let g=0,y=r.length;g<y;++g){const y=r[g],{elements:v,conformation:b}=y,x=e.unitMap.get(y.id)
p.unit=y
for(let r=0,g=v.length;r<g;++r){const g=v[r]
if(i&&R(e,y,g,o))continue
if(s&&!O(y,g))continue
const S=b.x(g),C=b.y(g),w=b.z(g)
u&&E(S,C,w,h)>m||(l.push(S),c.push(C),d.push(w),p.element=g,f.push(t.size(p)),u?-1===(x?a.X9.indexOf(x.elements,g):-1)?_.push(-2):_.push(n(x,g)):_.push(n(y,g)))}}g=l,y=c,v=d,b=f,x=_,S=a.CD.ofRange(0,x.length)}else{const{elementCount:n}=e,r=new Float32Array(n),i=new Float32Array(n),o=new Float32Array(n),s=new Float32Array(n)
for(let a=0,l=0,c=e.units.length;a<c;++a){const n=e.units[a],{elements:c,conformation:u}=n
p.unit=n
for(let e=0,a=c.length;e<a;++e){const n=c[e],a=l+e
r[a]=u.x(n),i[a]=u.y(n),o[a]=u.z(n),p.element=n,s[a]=t.size(p)}l+=c.length}g=r,y=i,v=o,b=s,x=(0,c.WE)(new Uint32Array(n)),S=a.CD.ofRange(0,x.length)}const _={indices:S,x:g,y:y,z:v,id:x}
return{position:_,boundary:u?(0,d.r)(_):e.boundary,radius:e=>b[e]}}const M=l.K9.H
function R(e,t,n,i){if(r.Unit.isCoarse(t))return!1
if(t.model.atomicHierarchy.derived.atom.atomicNumber[n]!==M)return!1
if("all"===i)return!0
const o=(0,h.GE)(e,t,a.X9.indexOf(t.elements,n))
return!(!o||"polar"!==i)||!o&&"non-polar"===i}function O(e,t){if(r.Unit.isCoarse(e))return!0
const n=e.model.atomicHierarchy.atoms.label_atom_id.value(t)
return"CA"===n||"BB"===n||"P"===n}},7773(e,t,n){"use strict"
n.d(t,{YU:()=>g})
var r=n(54749),i=n(92384),o=n(88720),a=n(56294),s=n(85032),l=n(61361),c=n(70012),u=n(93076)
const d=(0,r.Color)(13421772),p=(0,r.ColorMap)({HydrogenBond:2851770,Hydrophobic:8421504,HalogenBond:4259775,Ionic:15779860,MetalCoordination:9191577,CationPi:16744448,PiStacking:9220966,WeakHydrogenBond:12967404}),h=[["Hydrogen Bond",p.HydrogenBond],["Hydrophobic",p.Hydrophobic],["Halogen Bond",p.HalogenBond],["Ionic",p.Ionic],["Metal Coordination",p.MetalCoordination],["Cation Pi",p.CationPi],["Pi Stacking",p.PiStacking],["Weak HydrogenBond",p.WeakHydrogenBond]]
function f(e){switch(e){case a.X8.HydrogenBond:return p.HydrogenBond
case a.X8.Hydrophobic:return p.Hydrophobic
case a.X8.HalogenBond:return p.HalogenBond
case a.X8.Ionic:return p.Ionic
case a.X8.MetalCoordination:return p.MetalCoordination
case a.X8.CationPi:return p.CationPi
case a.X8.PiStacking:return p.PiStacking
case a.X8.WeakHydrogenBond:return p.WeakHydrogenBond
case a.X8.Unknown:return d}}const m={},g={name:"interaction-type",label:"Interaction Type",category:u.N.Misc,factory:function e(t,n){let r
const i=t.structure?o.r.get(t.structure):void 0,a=i?(0,c.vb)(i.id,i.version):-1
return r=i&&i.value?e=>{if(l.OG.isLocation(e)){const{unitsContacts:t,contacts:n}=e.data.interactions,{unitA:r,unitB:i,indexA:o,indexB:a}=e.element
if(r===i){const e=t.get(r.id),n=e.getDirectedEdgeIndex(o,a)
return f(e.edgeProps.type[n])}{const e=n.getEdgeIndex(o,r.id,a,i.id)
return f(n.edges[e].props.type)}}return d}:()=>d,{factory:e,granularity:"group",color:r,props:n,contextHash:a,description:"Assigns colors according the interaction type of a link.",legend:(0,s.h)(h)}},getParams:function(e){return m},defaultValues:i.t.getDefaultValues(m),isApplicable:e=>!!e.structure,ensureCustomProperties:{attach:(e,t)=>t.structure?o.r.attach(e,t.structure,void 0,!0):Promise.resolve(),detach:e=>e.structure&&o.r.ref(e.structure,!1)}}},7808(e,t,n){"use strict"
n.d(t,{N:()=>f})
var r=n(24762),i=n(87095),o=n(42261),a=n(29472),s=n(11350)
const l=[new Set(["CA"]),new Set(["C"]),new Set(["N"])],c=[new Set(["P","O3'","O3*"]),new Set(["C4'","C4*"]),new Set(["O2'","O2*","F2'","F2*"])],u=[new Set(["P","O3'","O3*"]),new Set(["C3'","C3*"]),new Set(["O2'","O2*","F2'","F2*"])],d=new Set(["FMN","NCN","FNS","FMA","ATP","ADP","AMP","GTP","GDP","GMP","LIG"]),p=function(){const e=new Map
return[{id:"HIS",name:"HISTIDINE",type:"l-peptide linking"},{id:"ARG",name:"ARGININE",type:"l-peptide linking"},{id:"LYS",name:"LYSINE",type:"l-peptide linking"},{id:"ILE",name:"ISOLEUCINE",type:"l-peptide linking"},{id:"PHE",name:"PHENYLALANINE",type:"l-peptide linking"},{id:"LEU",name:"LEUCINE",type:"l-peptide linking"},{id:"TRP",name:"TRYPTOPHAN",type:"l-peptide linking"},{id:"ALA",name:"ALANINE",type:"l-peptide linking"},{id:"MET",name:"METHIONINE",type:"l-peptide linking"},{id:"CYS",name:"CYSTEINE",type:"l-peptide linking"},{id:"ASN",name:"ASPARAGINE",type:"l-peptide linking"},{id:"VAL",name:"VALINE",type:"l-peptide linking"},{id:"GLY",name:"GLYCINE",type:"peptide linking"},{id:"SER",name:"SERINE",type:"l-peptide linking"},{id:"GLN",name:"GLUTAMINE",type:"l-peptide linking"},{id:"TYR",name:"TYROSINE",type:"l-peptide linking"},{id:"ASP",name:"ASPARTIC ACID",type:"l-peptide linking"},{id:"GLU",name:"GLUTAMIC ACID",type:"l-peptide linking"},{id:"THR",name:"THREONINE",type:"l-peptide linking"},{id:"PRO",name:"PROLINE",type:"l-peptide linking"},{id:"SEC",name:"SELENOCYSTEINE",type:"l-peptide linking"},{id:"PYL",name:"PYRROLYSINE",type:"l-peptide linking"},{id:"MSE",name:"SELENOMETHIONINE",type:"l-peptide linking"},{id:"SEP",name:"PHOSPHOSERINE",type:"l-peptide linking"},{id:"TPO",name:"PHOSPHOTHREONINE",type:"l-peptide linking"},{id:"PTR",name:"O-PHOSPHOTYROSINE",type:"l-peptide linking"},{id:"PCA",name:"PYROGLUTAMIC ACID",type:"l-peptide linking"},{id:"A",name:"ADENOSINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"C",name:"CYTIDINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"T",name:"THYMIDINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"G",name:"GUANOSINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"I",name:"INOSINIC ACID",type:"rna linking"},{id:"U",name:"URIDINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"DA",name:"2'-DEOXYADENOSINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DC",name:"2'-DEOXYCYTIDINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DT",name:"THYMIDINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DG",name:"2'-DEOXYGUANOSINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DI",name:"2'-DEOXYINOSINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DU",name:"2'-DEOXYURIDINE-5'-MONOPHOSPHATE",type:"dna linking"}].forEach(t=>e.set(t.id,t)),e}(),h=function(){const e=new Map
return[{id:"ZN2",name:"ZINC ION",type:"ion"},{id:"SOD",name:"SODIUM ION",type:"ion"},{id:"CES",name:"CESIUM ION",type:"ion"},{id:"CLA",name:"CHLORIDE ION",type:"ion"},{id:"CAL",name:"CALCIUM ION",type:"ion"},{id:"POT",name:"POTASSIUM ION",type:"ion"}].forEach(t=>e.set(t.id,t)),e}()
class f{set(e){this.comps.set(e.id,e),this.ids.push(e.id),this.names.push(e.name),this.types.push(e.type),this.mon_nstd_flags.push(i.PolymerNames.has(e.id)?"y":"n")}getAtomIds(e){const t=new Set,n=this.seqId.value(e)
for(;e<this.seqId.rowCount&&this.seqId.value(e)===n;)t.add(this.atomId.value(e)),e+=1
return t}hasAtomIds(e,t){for(let n=0,r=t.length;n<r;++n)if(!o.M.areIntersecting(e,t[n]))return!1
return!0}getType(e){return this.hasAtomIds(e,l)?"peptide linking":this.hasAtomIds(e,c)?"rna linking":this.hasAtomIds(e,u)?"dna linking":"other"}has(e){return this.comps.has(e)}get(e){return this.comps.get(e)}add(e,t){if(!this.has(e))if(p.has(e))this.set(p.get(e))
else if(i.WaterNames.has(e))this.set({id:e,name:"WATER",type:"non-polymer"})
else if(d.has(e.toUpperCase()))this.set({id:e,name:this.namesMap.get(e)||e,type:"non-polymer"})
else if(s.yt.has(e.toUpperCase()))this.set({id:e,name:this.namesMap.get(e)||e,type:"saccharide"})
else{const n=this.getAtomIds(t)
if(1===n.size&&h.has(e))this.set(h.get(e))
else{const t=this.getType(n)
this.set({id:e,name:this.namesMap.get(e)||e,type:t})}}return this.get(e)}getChemCompTable(){return r.XI.ofPartialColumns(a.e.chem_comp,{id:r.VP.ofStringArray(this.ids),name:r.VP.ofStringArray(this.names),type:r.VP.ofStringAliasArray(this.types),mon_nstd_flag:r.VP.ofStringAliasArray(this.mon_nstd_flags)},this.ids.length)}setNames(e){e.forEach(e=>this.namesMap.set(e[0],e[1]))}constructor(e,t){this.seqId=e,this.atomId=t,this.namesMap=new Map,this.comps=new Map,this.ids=[],this.names=[],this.types=[],this.mon_nstd_flags=[]}}},7818(e,t,n){"use strict"
n.d(t,{t:()=>p})
var r=n(92384),i=n(70012),o=n(88524),a=n(59457),s=n(91229)
const l=new Uint16Array([0,1,2,1,3,2]),c=i.Gm.add3,u=i.Gm.add2,d=i.Gm.add
var p
!function(e){e.create=function(e={},t=2048,n=1024,p){t*=2,n*=2
const h=i.Gm.create(Float32Array,3,n,p?p.centerBuffer.ref.value:t),f=i.Gm.create(Float32Array,2,n,p?p.mappingBuffer.ref.value:t),m=i.Gm.create(Float32Array,1,n,p?p.depthBuffer.ref.value:t),g=i.Gm.create(Uint32Array,3,n,p?p.indexBuffer.ref.value:t),y=i.Gm.create(Float32Array,1,n,p?p.groupBuffer.ref.value:t),v=i.Gm.create(Float32Array,2,n,p?p.tcoordBuffer.ref.value:t),b={...r.t.getDefaultValues(o.E.Params),...e},{attachment:x,background:S,backgroundMargin:_,tether:C,tetherLength:w,tetherBaseWidth:T}=b,A=(0,a.pS)(b),I=.4*_,P=A.buffer/A.lineHeight,B=(e,t,n,r,i)=>{c(h,e,t,n),d(m,r),d(y,i)}
return{add:(e,t,n,r,i,o,a)=>{let d=0
const p=e.length
for(let s=0;s<p;++s)d+=A.get(e[s]).nw-2*P
let m,y
if(m=x.startsWith("top")?.8:x.startsWith("middle")?.4:0,y=x.endsWith("right")?d:x.endsWith("center")?d/2:0,C)switch(x){case"bottom-left":y-=w/2+I+.1,m-=w/2+I
break
case"bottom-center":m-=w+I
break
case"bottom-right":y+=w/2+I+.1,m-=w/2+I
break
case"middle-left":y-=w+I+.1
break
case"middle-center":break
case"middle-right":y+=w+I+.1
break
case"top-left":y-=w/2+I+.1,m+=w/2+I
break
case"top-center":m+=w+I
break
case"top-right":y+=w/2+I+.1,m+=w/2+I}const b=(-y-I-.1)*o,_=(d-y+I+.1)*o,E=(.8-m+I)*o,k=(-m-I)*o
if(S){u(f,b,E),u(f,b,k),u(f,_,E),u(f,_,k)
const e=h.elementCount
for(let o=0;o<4;++o)u(v,10,10),B(t,n,r,i,a)
c(g,e+l[0],e+l[1],e+l[2]),c(g,e+l[3],e+l[4],e+l[5])}if(C){let e,l,d,p,m,y,S,C
const A=w*o,I=T*o
switch(x){case"bottom-left":e=b-A/2,d=b+I/2,m=b,S=b,l=k-A/2,p=k,y=k+I/2,C=k
break
case"bottom-center":e=0,d=I/2,m=-I/2,S=0,l=k-A,p=k,y=k,C=k
break
case"bottom-right":e=_+A/2,d=_,m=_-I/2,S=_,l=k-A/2,p=k+I/2,y=k,C=k
break
case"middle-left":e=b-A,d=b,m=b,S=b,l=0,p=-I/2,y=I/2,C=0
break
case"middle-center":e=0,d=0,m=0,S=0,l=0,p=0,y=0,C=0
break
case"middle-right":e=_+A,d=_,m=_,S=_,l=0,p=I/2,y=-I/2,C=0
break
case"top-left":e=b-A/2,d=b+I/2,m=b,S=b,l=E+A/2,p=E,y=E-I/2,C=E
break
case"top-center":e=0,d=I/2,m=-I/2,S=0,l=E+A,p=E,y=E,C=E
break
case"top-right":e=_+A/2,d=_,m=_-I/2,S=_,l=E+A/2,p=E-I/2,y=E,C=E
break
default:(0,s.dr)(x)}u(f,e,l),u(f,d,p),u(f,m,y),u(f,S,C)
const P=h.elementCount
for(let o=0;o<4;++o)u(v,10,10),B(t,n,r,i,a)
c(g,P,P+1,P+3),c(g,P,P+3,P+2)}y+=P,m+=P
let D=0
for(let s=0;s<p;++s){const d=A.get(e[s]),p=(D-y)*o,b=(D+d.nw-y)*o,x=(d.nh-m)*o,S=-m*o
u(f,p,x),u(f,p,S),u(f,b,x),u(f,b,S)
const _=A.texture.width,C=A.texture.height
u(v,d.x/_,d.y/C),u(v,d.x/_,(d.y+d.h)/C),u(v,(d.x+d.w)/_,d.y/C),u(v,(d.x+d.w)/_,(d.y+d.h)/C),D+=d.nw-2*P
const w=h.elementCount
for(let e=0;e<4;++e)B(t,n,r,i,a)
c(g,w+l[0],w+l[1],w+l[2]),c(g,w+l[3],w+l[4],w+l[5])}},getText:()=>{const e=A.texture,t=i.Gm.compact(h,!0),n=i.Gm.compact(f,!0),r=i.Gm.compact(m,!0),a=i.Gm.compact(g,!0),s=i.Gm.compact(y,!0),l=i.Gm.compact(v,!0)
return o.E.create(e,t,n,r,a,s,l,g.elementCount/2,p)}}}}(p||(p={}))},7888(e,t,n){"use strict"
n.d(t,{_:()=>o})
const r="undefined"!=typeof setImmediate?"undefined"!=typeof window?{setImmediate:(e,...t)=>window.setImmediate(e,...t),clearImmediate:e=>window.clearImmediate(e)}:{setImmediate:setImmediate,clearImmediate:clearImmediate}:function(){const e=function(){const e="undefined"!=typeof window&&window,t="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,n="undefined"!=typeof global&&global
return e||n||t}(),t={},n="undefined"!=typeof document?document:void 0
let r,i=1
function o(e){delete t[e]}function a(e){const n=t[e]
o(e),function(e){const t=e.callback,n=e.args
switch(n.length){case 0:t()
break
case 1:t(n[0])
break
case 2:t(n[0],n[1])
break
case 3:t(n[0],n[1],n[2])
break
default:t.apply(void 0,n)}}(n)}return"undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?r=function(e){process.nextTick(function(){a(e)})}:function(){if(e&&e.postMessage&&!e.importScripts){let t=!0
const n=e.onmessage
return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?function(){const t="setImmediate$"+Math.random()+"$",n=function(n){n.source===e&&"string"==typeof n.data&&0===n.data.indexOf(t)&&a(+n.data.slice(t.length))}
window.addEventListener?window.addEventListener("message",n,!1):window.attachEvent("onmessage",n),r=function(e){window.postMessage(t+e,"*")}}():"undefined"!=typeof MessageChannel?function(){const e=new MessageChannel
e.port1.onmessage=function(e){a(e.data)},r=function(t){e.port2.postMessage(t)}}():n&&"onreadystatechange"in n.createElement("script")?function(){const e=n.documentElement
r=function(t){let r=n.createElement("script")
r.onreadystatechange=function(){a(t),r.onreadystatechange=null,e.removeChild(r),r=null},e.appendChild(r)}}():r=function(e){setTimeout(a,0,e)},{setImmediate:function(e,...n){"function"!=typeof e&&(e=new Function(""+e))
const o={callback:e,args:n}
return t[i]=o,r(i),i++},clearImmediate:o}}()
function i(e){r.setImmediate(e)}const o={setImmediate:r.setImmediate,clearImmediate:r.clearImmediate,immediatePromise:()=>new Promise(i),delay:(e,t=void 0)=>new Promise(n=>setTimeout(n,e,t))}},7928(e,t,n){"use strict"
n.r(t),n.d(t,{Script:()=>yt})
var r=n(78660),i=n(18207),o=n(6941),a=n(25176),s=n(32773),l=n(29915),c=n(99302)
function u(e){return Object.keys(e).filter(e=>!isNaN(e)).map(e=>+e).sort((e,t)=>e-t).map(t=>e[t])}function d(e,t,n){return e&&void 0!==e[t]?e[t]:n}function p(e,...t){return{kind:"alias",aliases:t,symbol:e}}function h(e,t,...n){return e.info.namespace="molscript-macro",e.id=`molscript-macro.${e.info.name}`,{kind:"macro",symbol:e,translate:t,aliases:[e.info.name,...n]}}function f(e){return"alias"===e.kind||"macro"===e.kind}const m=[["Core symbols",p(a.AN.core.type.bool,"bool"),p(a.AN.core.type.num,"num"),p(a.AN.core.type.str,"str"),p(a.AN.core.type.regex,"regex"),p(a.AN.core.type.list,"list"),p(a.AN.core.type.set,"set"),p(a.AN.core.type.compositeKey,"composite-key"),p(a.AN.core.logic.not,"not"),p(a.AN.core.logic.and,"and"),p(a.AN.core.logic.or,"or"),p(a.AN.core.ctrl.if,"if"),p(a.AN.core.ctrl.fn,"fn"),p(a.AN.core.ctrl.eval,"eval"),p(a.AN.core.math.add,"add","+"),p(a.AN.core.math.sub,"sub","-"),p(a.AN.core.math.mult,"mult","*"),p(a.AN.core.math.div,"div","/"),p(a.AN.core.math.pow,"pow","**"),p(a.AN.core.math.mod,"mod"),p(a.AN.core.math.min,"min"),p(a.AN.core.math.max,"max"),p(a.AN.core.math.cantorPairing,"cantor-pairing"),p(a.AN.core.math.sortedCantorPairing,"sorted-cantor-pairing"),p(a.AN.core.math.invertCantorPairing,"invert-cantor-pairing"),p(a.AN.core.math.floor,"floor"),p(a.AN.core.math.ceil,"ceil"),p(a.AN.core.math.roundInt,"round"),p(a.AN.core.math.trunc,"trunc"),p(a.AN.core.math.abs,"abs"),p(a.AN.core.math.sign,"sign"),p(a.AN.core.math.sqrt,"sqrt"),p(a.AN.core.math.cbrt,"cbrt"),p(a.AN.core.math.sin,"sin"),p(a.AN.core.math.cos,"cos"),p(a.AN.core.math.tan,"tan"),p(a.AN.core.math.asin,"asin"),p(a.AN.core.math.acos,"acos"),p(a.AN.core.math.atan,"atan"),p(a.AN.core.math.sinh,"sinh"),p(a.AN.core.math.cosh,"cosh"),p(a.AN.core.math.tanh,"tanh"),p(a.AN.core.math.exp,"exp"),p(a.AN.core.math.log,"log"),p(a.AN.core.math.log10,"log10"),p(a.AN.core.math.atan2,"atan2"),p(a.AN.core.rel.eq,"eq","="),p(a.AN.core.rel.neq,"neq","!="),p(a.AN.core.rel.lt,"lt","<"),p(a.AN.core.rel.lte,"lte","<="),p(a.AN.core.rel.gr,"gr",">"),p(a.AN.core.rel.gre,"gre",">="),p(a.AN.core.rel.inRange,"in-range"),p(a.AN.core.str.concat,"concat"),p(a.AN.core.str.match,"regex.match"),p(a.AN.core.list.getAt,"list.get"),p(a.AN.core.set.has,"set.has"),p(a.AN.core.set.isSubset,"set.subset")],["Structure",["Types",p(a.AN.structureQuery.type.entityType,"ent-type"),p(a.AN.structureQuery.type.authResidueId,"auth-resid"),p(a.AN.structureQuery.type.labelResidueId,"label-resid"),p(a.AN.structureQuery.type.ringFingerprint,"ringfp"),p(a.AN.structureQuery.type.bondFlags,"bond-flags")],["Slots",p(a.AN.structureQuery.slot.elementSetReduce,"atom.set.reduce.value")],["Generators",p(a.AN.structureQuery.generator.atomGroups,"sel.atom.atom-groups"),p(a.AN.structureQuery.generator.queryInSelection,"sel.atom.query-in-selection"),p(a.AN.structureQuery.generator.rings,"sel.atom.rings"),p(a.AN.structureQuery.generator.empty,"sel.atom.empty"),p(a.AN.structureQuery.generator.all,"sel.atom.all"),p(a.AN.structureQuery.generator.bondedAtomicPairs,"sel.atom.bonded-pairs"),h((0,o.EX)("sel.atom.atoms",o.d3.Dictionary({0:(0,o.ef)(s.Z.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to each atom."})}),l.O.ElementSelection,"A selection of singleton atom sets."),e=>c.MolScriptBuilder.struct.generator.atomGroups({"atom-test":d(e,0,!0)})),h((0,o.EX)("sel.atom.res",o.d3.Dictionary({0:(0,o.ef)(s.Z.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to the 1st atom of each residue."})}),l.O.ElementSelection,"A selection of atom sets grouped by residue."),e=>c.MolScriptBuilder.struct.generator.atomGroups({"residue-test":d(e,0,!0),"group-by":c.MolScriptBuilder.ammp("residueKey")})),h((0,o.EX)("sel.atom.chains",o.d3.Dictionary({0:(0,o.ef)(s.Z.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to the 1st atom of each chain."})}),l.O.ElementSelection,"A selection of atom sets grouped by chain."),e=>c.MolScriptBuilder.struct.generator.atomGroups({"chain-test":d(e,0,!0),"group-by":c.MolScriptBuilder.ammp("chainKey")}))],["Modifiers",p(a.AN.structureQuery.modifier.queryEach,"sel.atom.query-each"),p(a.AN.structureQuery.modifier.intersectBy,"sel.atom.intersect-by"),p(a.AN.structureQuery.modifier.exceptBy,"sel.atom.except-by"),p(a.AN.structureQuery.modifier.unionBy,"sel.atom.union-by"),p(a.AN.structureQuery.modifier.union,"sel.atom.union"),p(a.AN.structureQuery.modifier.cluster,"sel.atom.cluster"),p(a.AN.structureQuery.modifier.includeSurroundings,"sel.atom.include-surroundings"),p(a.AN.structureQuery.modifier.surroundingLigands,"sel.atom.surrounding-ligands"),p(a.AN.structureQuery.modifier.includeConnected,"sel.atom.include-connected"),p(a.AN.structureQuery.modifier.expandProperty,"sel.atom.expand-property")],["Filters",p(a.AN.structureQuery.filter.pick,"sel.atom.pick"),p(a.AN.structureQuery.filter.first,"sel.atom.first"),p(a.AN.structureQuery.filter.withSameAtomProperties,"sel.atom.with-same-atom-properties"),p(a.AN.structureQuery.filter.intersectedBy,"sel.atom.intersected-by"),p(a.AN.structureQuery.filter.within,"sel.atom.within"),p(a.AN.structureQuery.filter.isConnectedTo,"sel.atom.is-connected-to")],["Combinators",p(a.AN.structureQuery.combinator.intersect,"sel.atom.intersect"),p(a.AN.structureQuery.combinator.merge,"sel.atom.merge"),p(a.AN.structureQuery.combinator.distanceCluster,"sel.atom.dist-cluster")],["Atom Set Properties",p(a.AN.structureQuery.atomSet.atomCount,"atom.set.atom-count"),p(a.AN.structureQuery.atomSet.countQuery,"atom.set.count-query"),p(a.AN.structureQuery.atomSet.reduce,"atom.set.reduce"),p(a.AN.structureQuery.atomSet.propertySet,"atom.set.property")],["Atom Properties",p(a.AN.structureQuery.atomProperty.core.elementSymbol,"atom.el"),p(a.AN.structureQuery.atomProperty.core.vdw,"atom.vdw"),p(a.AN.structureQuery.atomProperty.core.mass,"atom.mass"),p(a.AN.structureQuery.atomProperty.core.atomicNumber,"atom.atomic-number"),p(a.AN.structureQuery.atomProperty.core.x,"atom.x"),p(a.AN.structureQuery.atomProperty.core.y,"atom.y"),p(a.AN.structureQuery.atomProperty.core.z,"atom.z"),p(a.AN.structureQuery.atomProperty.core.sourceIndex,"atom.src-index"),p(a.AN.structureQuery.atomProperty.core.operatorName,"atom.op-name"),p(a.AN.structureQuery.atomProperty.core.instanceId,"atom.instance-id"),p(a.AN.structureQuery.atomProperty.core.operatorKey,"atom.op-key"),p(a.AN.structureQuery.atomProperty.core.modelIndex,"atom.model-index"),p(a.AN.structureQuery.atomProperty.core.modelLabel,"atom.model-label"),p(a.AN.structureQuery.atomProperty.core.modelEntryId,"atom.model-entry-id"),p(a.AN.structureQuery.atomProperty.core.atomKey,"atom.key"),p(a.AN.structureQuery.atomProperty.core.bondCount,"atom.bond-count"),p(a.AN.structureQuery.atomProperty.topology.connectedComponentKey,"atom.key.molecule"),p(a.AN.structureQuery.atomProperty.macromolecular.authResidueId,"atom.auth-resid"),p(a.AN.structureQuery.atomProperty.macromolecular.labelResidueId,"atom.label-resid"),p(a.AN.structureQuery.atomProperty.macromolecular.residueKey,"atom.key.res"),p(a.AN.structureQuery.atomProperty.macromolecular.chainKey,"atom.key.chain"),p(a.AN.structureQuery.atomProperty.macromolecular.entityKey,"atom.key.entity"),p(a.AN.structureQuery.atomProperty.macromolecular.isHet,"atom.is-het"),p(a.AN.structureQuery.atomProperty.macromolecular.id,"atom.id"),p(a.AN.structureQuery.atomProperty.macromolecular.label_atom_id,"atom.label_atom_id"),p(a.AN.structureQuery.atomProperty.macromolecular.label_alt_id,"atom.label_alt_id","atom.altloc"),p(a.AN.structureQuery.atomProperty.macromolecular.label_comp_id,"atom.label_comp_id"),p(a.AN.structureQuery.atomProperty.macromolecular.label_asym_id,"atom.label_asym_id"),p(a.AN.structureQuery.atomProperty.macromolecular.label_entity_id,"atom.label_entity_id"),p(a.AN.structureQuery.atomProperty.macromolecular.label_seq_id,"atom.label_seq_id"),p(a.AN.structureQuery.atomProperty.macromolecular.auth_atom_id,"atom.auth_atom_id","atom.name"),p(a.AN.structureQuery.atomProperty.macromolecular.auth_comp_id,"atom.auth_comp_id","atom.resname"),p(a.AN.structureQuery.atomProperty.macromolecular.auth_asym_id,"atom.auth_asym_id","atom.chain"),p(a.AN.structureQuery.atomProperty.macromolecular.auth_seq_id,"atom.auth_seq_id","atom.resno"),p(a.AN.structureQuery.atomProperty.macromolecular.pdbx_PDB_ins_code,"atom.pdbx_PDB_ins_code","atom.inscode"),p(a.AN.structureQuery.atomProperty.macromolecular.pdbx_formal_charge,"atom.pdbx_formal_charge"),p(a.AN.structureQuery.atomProperty.macromolecular.occupancy,"atom.occupancy"),p(a.AN.structureQuery.atomProperty.macromolecular.B_iso_or_equiv,"atom.B_iso_or_equiv","atom.bfactor"),p(a.AN.structureQuery.atomProperty.macromolecular.entityType,"atom.entity-type"),p(a.AN.structureQuery.atomProperty.macromolecular.entitySubtype,"atom.entity-subtype"),p(a.AN.structureQuery.atomProperty.macromolecular.entityPrdId,"atom.entity-prd-id"),p(a.AN.structureQuery.atomProperty.macromolecular.entityDescription,"atom.entity-description"),p(a.AN.structureQuery.atomProperty.macromolecular.objectPrimitive,"atom.object-primitive"),p(a.AN.structureQuery.atomProperty.macromolecular.chemCompType,"atom.chem-comp-type"),p(a.AN.structureQuery.atomProperty.macromolecular.secondaryStructureKey,"atom.key.sec-struct"),p(a.AN.structureQuery.atomProperty.macromolecular.isModified,"atom.is-modified"),p(a.AN.structureQuery.atomProperty.macromolecular.modifiedParentName,"atom.modified-parent"),p(a.AN.structureQuery.atomProperty.ihm.hasSeqId,"atom.ihm.has-seq-id"),p(a.AN.structureQuery.atomProperty.ihm.overlapsSeqIdRange,"atom.ihm.overlaps-seq-id-range")],["Bond Properties",p(a.AN.structureQuery.bondProperty.order,"bond.order"),p(a.AN.structureQuery.bondProperty.length,"bond.length"),p(a.AN.structureQuery.bondProperty.key,"bond.key"),p(a.AN.structureQuery.bondProperty.atomA,"bond.atom-a"),p(a.AN.structureQuery.bondProperty.atomB,"bond.atom-b"),h((0,o.EX)("bond.is",o.d3.List(l.O.BondFlag),s.Z.Bool,`Test if the current bond has at least one (or all if partial = false) of the specified flags: ${s.Z.oneOfValues(l.O.BondFlag).join(", ")}`),e=>c.MolScriptBuilder.core.flags.hasAny([c.MolScriptBuilder.struct.bondProperty.flags(),c.MolScriptBuilder.struct.type.bondFlags(u(e))]))]]],g=[]
!function e(t){for(const n of t)f(n)?g.push(n):n instanceof Array&&e(n)}(m)
const y=function(){const e=[],t=Object.create(null),n=r.t.create(),i=r.t.create()
for(const o of g){for(const n of o.aliases){if(e.push([n,o]),t[n])throw new Error(`Alias '${n}' already in use.`)
t[n]=o}const a=o.symbol.args
if("dictionary"===a.kind)for(const e of Object.keys(a.map)){isNaN(e)&&r.t.add(n,e,e)
const t=a.map[e]
"oneof"===t.type.kind&&s.Z.oneOfValues(t.type).forEach(e=>r.t.add(i,e,e))}else"oneof"===a.type.kind&&s.Z.oneOfValues(a.type).forEach(e=>r.t.add(i,e,e))}return{symbolList:e,symbolMap:t,namedArgs:n.array,constants:i.array}}(),v=(y.constants,y.namedArgs,y.symbolMap)
function b(e){if(i.Expression.isLiteral(e))return e
if(i.Expression.isSymbol(e)){if(!v[e.name])return e
const t=v[e.name]
if("alias"===t.kind)return i.Expression.Symbol(v[e.name].symbol.id)
throw t.translate([])}const t=i.Expression.isSymbol(e.head)&&!!v[e.head.name]&&"macro"===v[e.head.name].kind,n=t?e.head:b(e.head),r=n!==e.head
if(!e.args)return t?b(e.head):r?i.Expression.Apply(n):e
let o,a=!1
if(i.Expression.isArgumentsArray(e.args)){o=[]
for(let t=0,n=e.args.length;t<n;t++){const n=e.args[t],r=b(n)
n!==r&&(a=!0),o[o.length]=r}if(a||(o=e.args),!t&&!r&&!a)return e}else{o={}
for(const t of Object.keys(e.args)){const n=e.args[t],r=b(n)
n!==r&&(a=!0),o[t]=r}if(!t&&!r&&!a)return e
a||(o=e.args)}if(t){const t=v[e.head.name]
return"macro"!==t.kind?i.Expression.Apply(n,o):t.translate(o)}return i.Expression.Apply(n,o)}function x(e){return b(e)}y.symbolList
class S{constructor(e){this._=e}parse(e){const t=this.skip(S.eof)._(e,0)
return t.status?{success:!0,value:t.value}:{success:!1,index:A(e,t.furthest),expected:t.expected}}tryParse(e){const t=this.parse(e)
if(t.success)return t.value
{const o=(r=e,`expected ${n=(i=t).expected,1===n.length?n[0]:"one of "+n.join(", ")}${function(e,t){const n=t.index,r=n.offset
if(r===e.length)return", got the end of the input"
const i=r>0?"'...":"'",o=e.length-r>12?"...'":"'"
return` at line ${n.line} column ${n.column}, got ${i}${e.slice(r,r+12)}${o}`}(r,i)}`)
throw new Error(o)}var n,r,i}or(e){return S.alt(this,e)}trim(e){return this.wrap(e,e)}wrap(e,t){return _(1,"string"==typeof e?S.string(e):e,this,"string"==typeof t?S.string(t):t)}thru(e){return e(this)}then(e){return _(1,this,e)}many(){return new S((e,t)=>{const n=[]
let r
for(;;){if(r=T(this._(e,t),r),!r.status)return T(C(t,n),r)
if(t===r.index)throw new Error("infinite loop detected in .many() parser --- calling .many() on a parser which can accept zero characters is usually the cause")
t=r.index,n.push(r.value)}})}times(e,t){const n=void 0===t?e:t
return new S((t,r)=>{const i=[]
let o,a,s
for(s=0;s<e;s++){if(o=this._(t,r),a=T(o,a),!o.status)return a
r=o.index,i.push(o.value)}for(;s<n&&(o=this._(t,r),a=T(o,a),o.status);s+=1)r=o.index,i.push(o.value)
return T(C(r,i),a)})}result(e){return this.map(()=>e)}atMost(e){return this.times(0,e)}atLeast(e){return S.seq(this.times(e),this.many()).map(e=>[...e[0],...e[1]])}map(e){return new S((t,n)=>{const r=this._(t,n)
return r.status?T(C(r.index,e(r.value)),r):r})}skip(e){return _(0,this,e)}mark(){return S.seq(S.index,this,S.index).map(e=>({start:e[0],value:e[1],end:e[2]}))}node(e){return S.seq(S.index,this,S.index).map(t=>({name:e,start:t[0],value:t[1],end:t[2]}))}sepBy(e){return S.sepBy(this,e)}sepBy1(e){return S.sepBy1(this,e)}lookahead(e){return this.skip(S.lookahead(e))}notFollowedBy(e){return this.skip(S.notFollowedBy(e))}desc(e){return new S((t,n)=>{const r=this._(t,n)
return r.status||(r.expected=[e]),r})}fallback(e){return this.or(S.succeed(e))}ap(e){return S.seq(e,this).map(([e,t])=>e(t))}chain(e){return new S((t,n)=>{const r=this._(t,n)
return r.status?T(e(r.value)._(t,r.index),r):r})}}function _(e,...t){const n=t.length
return new S((r,i)=>{let o,a,s=i
for(let l=0;l<n;l++){if(o=T(t[l]._(r,s),o),!o.status)return o
e===l&&(a=o.value),s=o.index}return T(C(s,a),o)})}function C(e,t){return{status:!0,index:e,value:t}}function w(e,t){return{status:!1,furthest:e,expected:[t]}}function T(e,t){if(!t||e.status||t.status||e.furthest>t.furthest)return e
const n=e.furthest===t.furthest?function(e,t){const n=e.length,r=t.length
if(0===n)return t
if(0===r)return e
const i=new Set,o=[]
for(let a=0;a<n;a++)i.has(e[a])||(o[o.length]=e[a],i.add(e[a]))
for(let a=0;a<r;a++)i.has(t[a])||(o[o.length]=t[a],i.add(t[a]))
return o.sort(),o}(e.expected,t.expected):t.expected
return{status:e.status,furthest:t.furthest,expected:n}}function A(e,t){const n=e.slice(0,t).split("\n")
return{offset:t,line:n.length,column:n[n.length-1].length+1}}!function(e){function t(...t){const n=t.length
return new e((e,r)=>{let i
const o=new Array(n)
let a=r
for(let s=0;s<n;s++){if(i=T(t[s]._(e,a),i),!i.status)return i
o[s]=i.value,a=i.index}return T(C(a,o),i)})}function n(...t){return 0===t.length?s("zero alternates"):new e((e,n)=>{let r
for(let i=0;i<t.length;i++)if(r=T(t[i]._(e,n),r),r.status)return r
return r})}function r(e,n){return t(e,n.then(e).many()).map(e=>[e[0],...e[1]])}function i(t){const n=`'${t}'`
if(1===t.length){const r=t.charCodeAt(0)
return new e((e,i)=>e.charCodeAt(i)===r?C(i+1,t):w(i,n))}return new e((e,r)=>{const i=r+t.length
return e.slice(r,i)===t?C(i,t):w(r,n)})}function o(t,n=0){const r=function(e){return RegExp("^(?:"+e.source+")",function(e){const t=""+e
return t.slice(t.lastIndexOf("/")+1)}(e))}(t),i=""+t
return new e((e,t)=>{const o=r.exec(e.slice(t))
if(o){if(0<=n&&n<=o.length){const e=o[0],r=o[n]
return C(t+e.length,r)}return w(t,`invalid match group (0 to ${o.length}) in ${i}`)}return w(t,i)})}function a(t){return new e((e,n)=>C(n,t))}function s(t){return new e((e,n)=>w(n,t))}function l(t){return new e((e,n)=>{const r=e.charAt(n)
return n<e.length&&t(r)?C(n+1,r):w(n,"a character "+t)})}function c(t){const n=new e((e,r)=>{const i=t()._
return n._=i,i(e,r)})
return n}e.seqMap=function(e,n,r){const i=[].slice.call(arguments)
if(0===i.length)throw new Error("seqMap needs at least one argument")
const o=i.pop()
return function(e){if("function"!=typeof e)throw new Error("not a function: "+e)}(o),t.apply(null,i).map(function(e){return o.apply(null,e)})},e.createLanguage=function(e){const t={}
for(const n of Object.keys(e))(function(n){t[n]=c(()=>e[n](t))})(n)
return t},e.seq=t,e.alt=n,e.sepBy=function(e,t){return r(e,t).or(a([]))},e.sepBy1=r,e.string=i,e.regexp=o,e.succeed=a,e.fail=s,e.lookahead=function t(n){if(function(e){return e instanceof S}(n))return new e((e,t)=>{const r=n._(e,t)
return r.status&&(r.index=t,r.value=null),r})
if("string"==typeof n)return t(i(n))
if(n instanceof RegExp)return t(o(n))
throw new Error("not a string, regexp, or parser: "+n)},e.notFollowedBy=function(t){return new e((e,n)=>{const r=t._(e,n)
return r.status?w(n,'not "'+e.slice(n,r.index)+'"'):C(n,null)})},e.test=l,e.oneOf=function(e){return l(t=>e.indexOf(t)>=0)},e.noneOf=function(e){return l(t=>e.indexOf(t)<0)},e.range=function(e,t){return l(n=>e<=n&&n<=t).desc(e+"-"+t)},e.takeWhile=function(t){return new e((e,n)=>{let r=n
for(;r<e.length&&t(e.charAt(r));)r++
return C(r,e.slice(n,r))})},e.lazy=c,e.empty=function(){return s("empty")},e.index=new e(function(e,t){return C(t,A(e,t))}),e.anyChar=new e((e,t)=>t>=e.length?w(t,"any character"):C(t+1,e.charAt(t))),e.all=new e(function(e,t){return C(e.length,e.slice(t))}),e.eof=new e(function(e,t){return t<e.length?w(t,"EOF"):C(t,null)}),e.digit=o(/[0-9]/).desc("a digit"),e.digits=o(/[0-9]*/).desc("optional digits"),e.letter=o(/[a-z]/i).desc("a letter"),e.letters=o(/[a-z]*/i).desc("optional letters"),e.optWhitespace=o(/\s*/).desc("optional whitespace"),e.whitespace=o(/\s+/).desc("whitespace"),e.cr=i("\r"),e.lf=i("\n"),e.crlf=i("\r\n"),e.newline=n(e.crlf,e.lf,e.cr).desc("newline"),e.end=n(e.newline,e.eof),e.of=function(e){return a(e)},e.regex=function(e){return o(e)}}(S||(S={}))
var I,P=n(91229)
!function(e){let t
!function(e){e.str=function(e){return{kind:"string",value:e}},e.symb=function(e){return{kind:"symbol",value:e}},e.list=function(e,t){return{kind:"list",bracket:e,nodes:t}},e.comment=function(e){return{kind:"comment",value:e}}}(t||(t={}))
const n=S.regexp(/[\n\r\s]*/),r=S.lazy(()=>S.alt(o,h,a,s).trim(n)),o=S.takeWhile(e=>"`"!==e).trim("`").map(t.str),a=S.regexp(/[^()\[\]{};`,\n\r\s]+/).map(t.symb),s=S.regexp(/\s*;+([^\n\r]*)\n/,1).map(t.comment),l=r.many(),u=l.wrap("(",")").map(e=>t.list("(",e)),d=l.wrap("[","]").map(e=>t.list("[",e)),p=l.wrap("{","}").map(e=>t.list("{",e)),h=S.alt(u,d,p),f=r.many()
function m(e){switch(e.kind){case"string":return e.value
case"symbol":{const t=e.value
if(t.length>1)switch(t.charAt(0)){case".":return c.MolScriptBuilder.atomName(t.substr(1))
case"_":return c.MolScriptBuilder.struct.type.elementSymbol([t.substr(1)])}return"true"===t||"false"!==t&&(function(e){return/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/.test(e)&&!isNaN(+e)}(t)?+t:i.Expression.Symbol(t))}case"list":switch(e.bracket){case"[":return c.MolScriptBuilder.core.type.list(g(e.nodes).map(m))
case"{":return c.MolScriptBuilder.core.type.set(g(e.nodes).map(m))
case"(":{if("comment"===e.nodes[0].kind)throw new Error("Invalid expression")
const t=m(e.nodes[0])
return i.Expression.Apply(t,function(e){if(e.length<=1)return
if(!function(e){for(let t=1,n=e.length;t<n;t++){const n=e[t]
if("symbol"===n.kind&&n.value.length>1&&":"===n.value.charAt(0))return!0}return!1}(e)){const t=[]
for(let n=1,r=e.length;n<r;n++){const r=e[n]
"comment"!==r.kind&&(t[t.length]=m(r))}return t}const t={}
let n=!0,r=0
for(let i=1,o=e.length;i<o;i++){const a=e[i]
if("comment"!==a.kind)if("symbol"===a.kind&&a.value.length>1&&":"===a.value.charAt(0)){const r=a.value.substr(1)
for(++i;i<o&&"comment"===e[i].kind;)i++
if(i>=o)throw new Error(`There must be a value foolowed a named arg ':${r}'.`)
if("comment"===e[i].kind)throw new Error("Invalid expression")
t[r]=m(e[i]),isNaN(+r)&&(n=!1)}else t[r++]=m(a)}if(n){const e=Object.keys(t).map(e=>+e).sort((e,t)=>e-t)
let n=!0
for(let t=0,r=e.length;t<r;t++)if(e[t]!==t){n=!1
break}if(n){const n=[]
for(let r=0,i=e.length;r<i;r++)n[r]=t[r]
return n}}return t}(e.nodes))}default:(0,P.dr)(e.bracket)}default:(0,P.dr)(e)}}function g(e){let t=!1
for(let n=0,r=e.length;n<r;n++)if("comment"===e[n].kind){t=!0
break}return t?e.filter(e=>"comment"!==e.kind):e}e.parse=function(e){const t=function(e){return f.tryParse(e)}(e),n=[]
for(const r of t)"comment"!==r.kind&&(n[n.length]=m(r))
return n}}(I||(I={}))
var B=n(12288)
const E=c.MolScriptBuilder
function k(e,t,n){const r=S.lazy(()=>S.seq(e,r).map(e=>n(...e)).or(t))
return r}function D(e,t,n){return S.seqMap(t,e.many(),(e,t)=>t.reduce((e,t)=>n(t,e),e))}function M(e,t,n){return S.seqMap(t,S.seq(e,t).many(),(e,t)=>t.reduce((e,t)=>{const[r,i]=t
return n(r,e,i)},e))}function R(e,t){return e.reduce((e,t)=>{const n=t.isUnsupported?z(`operator '${t.name}' not supported`):t.map
return t.type(t.rule,e,n)},t)}function O(e,t=0){return S.optWhitespace.then(S.regexp(e,t).skip(S.optWhitespace))}function L(e,t=0){return S.regexp(e,t).skip(S.optWhitespace)}function N(e,t=0){return S.optWhitespace.then(S.regexp(e,t))}function F(e,t){const n=t?`${e}|${(0,B.Nt)(t)}`:e
return O(RegExp(`(${n})\\s+([-+]?[0-9]*\\.?[0-9]+)\\s+OF`,"i"),2).map(parseFloat)}function z(e){return function(){throw new Error(e)}}function j(e){return 1===e.length?e[0]:e.length>1?E.core.logic.and(e):void 0}function V(e,t){if(!t||void 0===t.op||void 0===t.val)return t&&void 0!==t.flags?E.core.flags.hasAny([e,t.flags]):t&&void 0!==t.min&&void 0!==t.max?E.core.rel.inRange([e,t.min,t.max]):Array.isArray(t)?t.length>1?E.core.set.has([E.core.type.set(t),e]):E.core.rel.eq([e,t[0]]):E.core.rel.eq([e,t])
{const n=[e,t.val]
switch(t.op){case"=":return E.core.rel.eq(n)
case"!=":return E.core.rel.neq(n)
case">":return E.core.rel.gr(n)
case"<":return E.core.rel.lt(n)
case">=":return E.core.rel.gre(n)
case"<=":return E.core.rel.lte(n)
default:throw new Error(`operator '${t.op}' not supported`)}}}function U(e){return E.struct.generator.queryInSelection({0:e,query:E.struct.generator.all(),"in-complement":!0})}function G(e,t){return e.length<t.length?1:-1}function H(e,t){const n=(t?[e].concat(t):[e]).sort(G).map(B.Nt).join("|")
return RegExp(`${n}`,"i")}function q(e){const t=[]
return Object.keys(e).sort(G).forEach(n=>{const r=e[n],i=z(`property '${n}' not supported`),o=S.regexp(r.regex).map(e=>(r.isUnsupported&&i(),V(r.property,r.map(e)))),a=S.regexp(H(n,r.abbr)).trim(S.optWhitespace),s=e=>E.struct.generator.atomGroups({[r.level]:e})
r.isNumeric?t.push(a.then(S.seq(S.regexp(/>=|<=|=|!=|>|</).trim(S.optWhitespace),S.regexp(r.regex).map(r.map))).map(e=>(r.isUnsupported&&i(),V(r.property,{op:e[0],val:e[1]}))).map(s)):t.push(a.then(o).map(s))}),t}function Q(e){const t=[]
return Object.keys(e).sort(G).forEach(n=>{const r=e[n],i=r.map?r.map:z(`keyword '${n}' not supported`),o=S.regexp(H(n,r.abbr)).map(i)
t.push(o)}),t}function $(e,t){const n=[]
return Object.keys(e).sort(G).forEach(r=>{const i=e[r],o=z(`property '${r}' not supported`),a=S.regexp(H(r,i.abbr)).lookahead(t).map(()=>(i.isUnsupported&&o(),i.property))
n.push(a)}),n}function X(e,t,n,r){const i=[]
for(const o in e)i.push(o),e[o].abbr&&i.push(...e[o].abbr)
for(const o in t)i.push(o),t[o].abbr&&i.push(...t[o].abbr)
return n.forEach(e=>{i.push(e.name),e.abbr&&i.push(...e.abbr)}),i}function W(e){return E.core.type.set(e.map(E.atomName))}function Y(e){return E.struct.generator.queryInSelection({0:e,query:E.struct.generator.all()})}function Z(e,t,n){switch(e.head.name){case"structure-query.atom-property.macromolecular.label_atom_id":return E.atomName(t)
case"structure-query.atom-property.core.element-symbol":return E.es(t)
case"structure-query.atom-property.macromolecular.secondary-structure-flags":return n&&(t=[n[t.toUpperCase()]||"none"]),E.struct.type.secondaryStructureFlags([t])
default:return t}}const K=["entityKey","label_entity_id","entityType"],J=["chainKey","label_asym_id","label_entity_id","auth_asym_id","entityType"],ee=["residueKey","label_comp_id","label_seq_id","auth_comp_id","auth_seq_id","pdbx_formal_charge","secondaryStructureKey","secondaryStructureFlags","isModified","modifiedParentName"]
function te(e){if(e.head.name.startsWith("structure-query.atom-property.macromolecular.")){const t=e.head.name.substr(45)
if(K.includes(t))return"entity-test"
if(J.includes(t))return"chain-test"
if(ee.includes(t))return"residue-test"}return"atom-test"}const ne=["structure-query.atom-property.macromolecular.secondary-structure-flags"]
function re(e){return E.struct.generator.atomGroups({"residue-test":E.core.set.has([E.core.type.set(e),E.ammp("label_comp_id")])})}const ie=c.MolScriptBuilder,oe=/[-+]?[0-9]*\.?[0-9]+/,ae=/[0-9]+/
function se(e){return e}const le={none:"none",turn:"turn",sheet:"beta",helix:"helix",dna:"dna",rna:"rna",carbohydrate:"carbohydrate",helix310:"3-10",helixalpha:"alpha",helixpi:"pi",0:"none",1:"turn",2:"beta",3:"helix",4:"dna",5:"rna",6:"carbohydrate",7:"3-10",8:"alpha",9:"pi"}
function ce(e){if(e.head){if(e.head.name&&"core.type.regex"===e.head.name&&(e=e.args[0].replace(/^\^|\$$/g,"")),e=le[e.toString().toLowerCase()]||"none",-1!==["dna","rna","carbohydrate"].indexOf(e))throw new Error("values 'dna', 'rna', 'carbohydrate' not yet supported for 'structure' property")
return ie.struct.type.secondaryStructureFlags([e])}}const ue={adpmax:{"@desc":"the maximum anisotropic displacement parameter for the selected atom","@examples":[""],isUnsupported:!0,regex:oe,map:e=>parseFloat(e),level:"atom-test"},adpmin:{"@desc":"the minimum anisotropic displacement parameter for the selected atom","@examples":[""],isUnsupported:!0,regex:oe,map:e=>parseFloat(e),level:"atom-test"},altloc:{"@desc":"PDB alternate location identifier","@examples":["altloc = A"],regex:/[a-zA-Z0-9]/,map:se,level:"atom-test",property:ie.ammp("label_alt_id")},altname:{"@desc":"an alternative name given to atoms by some file readers (for example, P2N)","@examples":[""],isUnsupported:!0,regex:/[a-zA-Z0-9]/,map:se,level:"atom-test"},atomID:{"@desc":"special atom IDs for PDB atoms assigned by Jmol","@examples":[""],isUnsupported:!0,regex:ae,map:e=>parseInt(e),level:"atom-test"},atomIndex:{"@desc":"atom 0-based index; a unique number for each atom regardless of the number of models loaded","@examples":[""],isUnsupported:!0,regex:ae,map:e=>parseInt(e),level:"atom-test"},atomName:{"@desc":"atom name","@examples":["atomName = CA"],regex:/[a-zA-Z0-9]+/,map:e=>ie.atomName(e),level:"atom-test",property:ie.ammp("label_atom_id")},atomno:{"@desc":'sequential number; you can use "@" instead of "atomno=" -- for example, select @33 or Var x = @33 or @35',"@examples":[""],isUnsupported:!0,regex:ae,map:e=>parseInt(e),level:"atom-test"},atomType:{"@desc":"atom type (mol2, AMBER files) or atom name (other file types)","@examples":["atomType = OH"],regex:/[a-zA-Z0-9]+/,map:e=>ie.atomName(e),level:"atom-test",property:ie.ammp("label_atom_id")},atomX:{"@desc":"Cartesian X coordinate (or just X)","@examples":["x = 4.2"],abbr:["X"],isNumeric:!0,regex:oe,map:e=>parseFloat(e),level:"atom-test",property:ie.acp("x")},atomY:{"@desc":"Cartesian Y coordinate (or just Y)","@examples":["y < 42"],abbr:["Y"],isNumeric:!0,regex:oe,map:e=>parseFloat(e),level:"atom-test",property:ie.acp("y")},atomZ:{"@desc":"Cartesian Z coordinate (or just Z)","@examples":["Z > 10"],abbr:["Z"],isNumeric:!0,regex:oe,map:e=>parseFloat(e),level:"atom-test",property:ie.acp("z")},bondcount:{"@desc":"covalent bond count","@examples":["bondcount = 0"],isNumeric:!0,regex:ae,map:e=>parseInt(e),level:"atom-test",property:ie.acp("bondCount")},bondingRadius:{"@desc":"radius used for auto bonding; synonymous with ionic and ionicRadius","@examples":[""],abbr:["ionic","ionicRadius"],isUnsupported:!0,regex:oe,map:e=>parseFloat(e),level:"atom-test"},cell:{"@desc":'crystallographic unit cell, expressed either in lattice integer notation (111-999) or as a coordinate in ijk space, where {1 1 1} is the same as 555. ANDing two cells, for example select cell=555 and cell=556, selects the atoms on the common face. (Note: in the specifc case of CELL, only "=" is allowed as a comparator.)',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},configuration:{"@desc":'Only in the context {configuration=n}, this option selects the set of atoms with either no ALTLOC specified or those atoms having this index into the array of altlocs within its model. So, for example, if the model has altloc "A" and "B", select configuration=1 is equivalent to select altloc="" or altloc="A", and print {configuration=2} is equivalent to print {altloc="" or altloc="B"}. Configuration 0 is "all atoms in a model having configurations", and an invalid configuration number gives no atoms. (Note: in the specifc case of CONFIGURATION, only "=" is allowed as a comparator.)',"@examples":[""],isUnsupported:!0,regex:ae,map:e=>parseInt(e),level:"atom-test"},chain:{"@desc":'protein chain. For newer CIF files allowing multicharacter chain specifications, use quotations marks: select chain="AA". For these multicharacter desigations, case is not checked unless the CIF file has lower-case chain designations.',"@examples":["chain = A",'chain = "AA"'],regex:/[a-zA-Z0-9]+/,map:se,level:"chain-test",property:ie.ammp("auth_asym_id")},chainNo:{"@desc":'chain number; sequentially counted from 1 for each model; chainNo == 0 means"no chain" or PDB chain identifier indicated as a blank (Jmol 14.0).',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},color:{"@desc":"the atom color","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},covalentRadius:{"@desc":"covalent bonding radius, synonymous with covalent. Not used by Jmol, but could be used, for example, in {*}.spacefill={*}.covalentRadius.all.","@examples":[""],abbr:["covalent"],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},cs:{"@desc":"chemical shift calculated using computational results that include magnetic shielding tensors.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},element:{"@desc":'element symbol. The value of this parameter depends upon the context. Used with select structure=x, x can be either the quoted element symbol, "H", "He", "Li", etc. or atomic number. In all other contexts, the value is the element symbol. When the atom is a specific isotope, the string will contain the isotope number -- "13C", for example.',"@examples":["element=Fe"],regex:/[a-zA-Z]+/,map:e=>ie.es(e),level:"atom-test",property:ie.acp("elementSymbol")},elemno:{"@desc":"atomic element number","@examples":["elemno=8"],regex:/[0-9\s{}-]+/,map:e=>parseInt(e),level:"atom-test",property:ie.acp("atomicNumber")},eta:{"@desc":"Based on Carlos M. Duarte, Leven M. Wadley, and Anna Marie Pyle, RNA structure comparison, motif search and discovery using a reduced representation of RNA conformational space, Nucleic Acids Research, 2003, Vol. 31, No. 16 4755-4761. The parameter eta is the C4'[i-1]-P[i]-C4'[i]-P[i+1] dihedral angle; theta is the P[i]-C4'[i]-P[i+1]-C4'[i+1] dihedral angle. Both are measured on a 0-360 degree scale because they are commonly near 180 degrees. Using the commands plot PROPERTIES eta theta resno; select visible;wireframe only one can create these authors' \"RNA worm\" graph.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},theta:{"@desc":"Based on Carlos M. Duarte, Leven M. Wadley, and Anna Marie Pyle, RNA structure comparison, motif search and discovery using a reduced representation of RNA conformational space, Nucleic Acids Research, 2003, Vol. 31, No. 16 4755-4761. The parameter eta is the C4'[i-1]-P[i]-C4'[i]-P[i+1] dihedral angle; theta is the P[i]-C4'[i]-P[i+1]-C4'[i+1] dihedral angle. Both are measured on a 0-360 degree scale because they are commonly near 180 degrees. Using the commands plot PROPERTIES eta theta resno; select visible;wireframe only one can create these authors' \"RNA worm\" graph.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},file:{"@desc":"file number containing this atom","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},formalCharge:{"@desc":"formal charge","@examples":["formalCharge=1"],regex:oe,map:e=>parseFloat(e),level:"atom-test",property:ie.ammp("pdbx_formal_charge")},format:{"@desc":"format (label) of the atom.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},fXyz:{"@desc":"fractional XYZ coordinates","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},fX:{"@desc":"fractional X coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},fY:{"@desc":"fractional Y coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},fZ:{"@desc":"fractional Z coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},fuxyz:{"@desc":"fractional XYZ coordinates in the unitcell coordinate system","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},fux:{"@desc":"fractional X coordinate in the unitcell coordinate system","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},fuy:{"@desc":"fractional Y coordinate in the unitcell coordinate system","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},fuz:{"@desc":"fractional Z coordinate in the unit cell coordinate system","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},group:{"@desc":"3-letter residue code","@examples":["group = ALA"],regex:/[a-zA-Z0-9]{1,3}/,map:se,level:"residue-test",property:ie.ammp("label_comp_id")},group1:{"@desc":"single-letter residue code (amino acids only)","@examples":["group1 = G"],regex:/[a-zA-Z]/,map:se,level:"residue-test",property:ie.ammp("label_comp_id")},groupID:{"@desc":"group ID number: A unique ID for each amino acid or nucleic acid residue in a PDB file. 0  noGroup 1-5  ALA, ARG, ASN, ASP, CYS 6-10  GLN, GLU, GLY, HIS, ILE 11-15  LEU, LYS, MET, PHE, PRO 16-20  SER, THR, TRP, TYR, VAL 21-23  ASX, GLX, UNK 24-29  A, +A, G, +G, I, +I 30-35  C, +C, T, +T, U, +U Additional unique numbers are assigned arbitrarily by Jmol and cannot be used reproducibly.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},groupindex:{"@desc":"overall group index","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},hydrophobicity:{"@desc":"Aminoacid residue scale of hydrophobicity based on Rose, G. D., Geselowitz, A. R., Lesser, G. J., Lee, R. H., and Zehfus, M. H. (1985). Hydrophobicity of amino acid residues in globular proteins, Science, 229(4716):834-838.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},identify:{"@desc":"for a PDB/mmCIF file, a label such as [ILE]7^1:A.CD1%A/3 #47, which includes the group ([ILE]), residue number with optional insertion code (7^1), chain (:A), atom name (CD1), alternate location if present (%A), PDB model number (/3, for NMR models when one file is loaded; /file.model such as /2.3 if more than one file is loaded), and atom number (#47). For non-PDB data, the information is shorter -- for example, H15/2.1 #6, indicating atom name (H15), full file.model number (/2.1), and atom number (#6). If only a single model is loaded, %[identify] does not include the model number.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},insertion:{"@desc":"protein residue insertion code","@examples":["insertion=A"],regex:/[a-zA-Z0-9]/,map:se,level:"atom-test",property:ie.ammp("pdbx_PDB_ins_code")},label:{"@desc":"current atom label (same as format)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},mass:{"@desc":"atomic mass -- especially useful with appended .max or .sum","@examples":["mass > 13"],regex:oe,map:e=>parseFloat(e),level:"atom-test",property:ie.acp("mass")},model:{"@desc":"model number","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},modelindex:{"@desc":"a unique number for each model, starting with 0 and spanning all models in all files","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},modO:{"@desc":"currently calculated occupancy from modulation (0 to 100; NaN if atom has no occupancy modulation)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},modXYZ:{"@desc":"currently calculated displacement modulation (for incommensurately modulated structures). Also modX, modY, modZ for individual components. For atoms without modultion, {xx}.modXYZ is -1 and {xx}.modX is NaN, and in a label %[modXYZ] and %[modX] are blank.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},molecule:{"@desc":"molecule number","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},monomer:{"@desc":"monomer number (group number) in a polymer (usually a chain), starting with 1, or 0 if not part of a biopolymer -- that is, not a connected carbohydrate, amino acid, or nucleic acid (Jmol 14.3.15)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},ms:{"@desc":"magnetic shielding calculated from file-loaded tensors.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},occupancy:{"@desc":'CIF file site occupancy. In SELECT command comparisons ("select occupancy < 90"), an integer n implies measurement on a 0-100 scale; also, in the context %[occupancy] or %q for a label, the reported number is a percentage. In all other cases, such as when %Q is used in a label or when a decimal number is used in a comparison, the scale is 0.0 - 1.0.',"@examples":["occupancy < 1"],regex:oe,map:e=>parseFloat(e),level:"atom-test",property:ie.ammp("occupancy")},partialCharge:{"@desc":"partial charge","@examples":[""],isUnsupported:!0,regex:oe,map:e=>parseFloat(e),level:"atom-test"},phi:{"@desc":"protein group PHI angle for atom's residue","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},polymer:{"@desc":"sequential polymer number in a model, starting with 1.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},polymerLength:{"@desc":"polymer length","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},property_xx:{"@desc":"a property created using the DATA command","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},psi:{"@desc":"protein group PSI angle for the atom's residue","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},radius:{"@desc":'currently displayed radius -- In SELECT command comparisons ("select radius=n"), integer n implies Rasmol units 1/250 Angstroms; in all other cases or when a decimal number is used, the units are Angstroms.',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},resno:{"@desc":"PDB residue number, not including insertion code (see also seqcode, below)","@examples":["resno = 100"],regex:/-?[0-9]+/,map:e=>parseInt(e),level:"residue-test",property:ie.ammp("auth_seq_id")},selected:{"@desc":"1.0 if atom is selected; 0.0 if not","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},sequence:{"@desc":'PDB one-character sequence code, as a string of characters, with "?" indicated where single-character codes are not available',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},seqcode:{"@desc":'PDB residue number, including insertion code (for example, 234^2; "seqcode" option added in Jmol 14.3.16)',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},seqid:{"@desc":"(mmCIF only) the value from _atom_site.label_seq_id; a pointer to _entity_poly_seq.num in the ENTITY_POLY_SEQ category specifying the sequence of monomers in a polymer. Allowance is made for the possibility of microheterogeneity in a sample by allowing a given sequence number to be correlated with more than one monomer id. (Jmol 14.2.3)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},shape:{"@desc":'hybridization geometry such as "tetrahedral"',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},site:{"@desc":"crystallographic site number","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},spacefill:{"@desc":"currently displayed radius","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},straightness:{"@desc":'quaternion-derived straightness (second derivative of the quaternion describing the orientation of the residue. This quantity will have different values depending upon the setting of quaternionFrame as "A" (alpha-carbon/phosphorus atom only), "C" (alpha-carbon/pyrimidine or purine base based), "P" (carbonyl-carbon peptide plane/phosphorus tetrahedron based), or "N" (amide-nitrogen based). The default is alpha-carbon based, which corresponds closely to the following combination of Ramachandran angles involving three consecutive residues i-1, i, and i+1: -psii-1 - phii + psii + phii+1.',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},strucno:{"@desc":"a unique number for each helix, sheet, or turn in a model, starting with 1.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},structure:{"@desc":'The value of this parameter depends upon the context. Used with select structure=x, x can be either the quoted keyword "none", "turn", "sheet", "helix", "dna", "rna", or "carbohydrate" or a respective number 0-6. In the context {*}.structure, the return value is a number; in the context label %[structure], the return is one of the six keywords.',"@examples":['structure="helix"',"structure=3"],regex:/none|turn|sheet|helix|dna|rna|carbohydrate|[0-6]/i,map:se,level:"residue-test",property:"structure"},substructure:{"@desc":'like structure, the value of this parameter depends upon the context. Used with select substructure=x, x can be either the quoted keyword "none", "turn", "sheet", "helix", "dna", "rna", "carbohydrate", "helix310", "helixalpha", or "helixpi", or the respective number 0-9. In the context {*}.substructure, the return value is a number; in the context label %[substructure], the return is one of the nine keywords.',"@examples":['substructure = "alphahelix"',"substructure =9"],regex:/none|turn|sheet|helix|dna|rna|carbohydrate|helix310|helixalpha|helixpi|[0-9]/i,map:se,level:"residue-test",property:"structure"},surfacedistance:{"@desc":"A value related to the distance of an atom to a nominal molecular surface. 0 indicates at the surface. Positive numbers are minimum distances in Angstroms from the given atom to the surface.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},symop:{"@desc":'the first symmetry operation code that generated this atom by Jmol; an integer starting with 1. See also symmetry, below. This operator is only present if the file contains space group information and the file was loaded using the {i, j, k} option so as to generate symmetry-based atoms. To select only the original atoms prior to application of symmetry, you can either use "SYMOP=n", where n is the symmetry operator corresponding to "x,y,z", or you can specify instead simply "NOT symmetry" the way you might specify "NOT hydrogen". Note that atoms in special positions will have multiple operator matches. These atoms can be selected using the keyword SPECIALPOSITION. The special form select SYMOP=nijk selects a specific translation of atoms from the given crystallographic symmetry operation. Comparators <, <=, >, >=, and != can be used and only apply to the ijk part of the designation. The ijk are relative, not absolute. Thus, symop=2555 selects for atoms that have been transformed by symop=2 but not subjected to any further translation. select symop=1555 is identical to select not symmetry. All other ijk are relative to these selections for 555. If the model was loaded using load "filename.cif" {444 666 1}, where the 1 indicates that all symmetry-generated atoms are to be packed within cell 555 and then translated to fill the other 26 specified cells, then select symop=3555 is nearly the same as select symop=3 and cell=555. (The difference being that cell=555 selects for all atoms that are on any edge of the cell, while symop=3555 does not.) However, the situation is different if instead the model was loaded using load "filename.cif" {444 666 0}, where the 0 indicates that symmetry-generated atoms are to be placed exactly where their symmetry operator would put them (x,-y,z being different then from x, 1-y, z). In that case, select symop=3555 is for all atoms that have been generated using symmetry operation 3 but have not had any additional translations applied to the x,y,z expression found in the CIF file. If, for example, symmetry operation 3 is -x,-y,-z, then load "filename.cif" {444 666 0} will place an atom originally at {1/2, 1/2, 1/2} at positions {-1/2, -1/2, -1/2} (symop=3555) and {-3/2, -3/2, -3/2} (symop=3444) and 24 other sites.',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},symmetry:{"@desc":'as "symmetry" or in a label as lower-case "o" gives list of crystallographic symmetry operators generating this atom with lattice designations,such as 3555; upper-case "%O" in a label gives a list without the lattice designations. See also symop, above.',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},temperature:{"@desc":"yes  yes  temperature factor (B-factor)","@examples":["temperature >= 20"],regex:oe,map:e=>parseFloat(e),level:"atom-test",property:ie.ammp("B_iso_or_equiv")},unitXyz:{"@desc":"unit cell XYZ coordinates","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},uX:{"@desc":"unit cell X coordinate normalized to [0,1)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},uY:{"@desc":"unit cell Y coordinate normalized to [0,1)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},uZ:{"@desc":"unit cell Z coordinate normalized to [0,1)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},valence:{"@desc":"the valence of an atom (sum of bonds, where double bond counts as 2 and triple bond counts as 3","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},vanderwaals:{"@desc":"van der Waals radius","@examples":["vanderwaals >2"],regex:oe,map:e=>parseFloat(e),level:"atom-test",property:ie.acp("vdw")},vectorScale:{"@desc":"vibration vector scale","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},volume:{"@desc":"approximate van der Waals volume for this atom. Note, {*}.volume gives an average; use {*}.volume.sum to get total volume.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},vXyz:{"@desc":"vibration vector, or individual components as %vx %vy %vz. For atoms without vibration vectors, {xx}.vXyz is -1; in a label, %[vxyz] is blank.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},vX:{"@desc":"vibration vector X coordinate; for atoms without vibration vector, {xx}.vX is NaN (same for vY and vZ)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},vY:{"@desc":"vibration vector Y coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},vZ:{"@desc":"vibration vector Z coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"},xyz:{"@desc":"Cartesian XYZ coordinates; select xyz > 1.0 selects atoms more than one Angstrom from the origin.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:se,level:"atom-test"}},de=c.MolScriptBuilder,pe=[{"@desc":"Selects atoms that are not included in s1.","@examples":["not ARG"],name:"not",type:k,rule:S.alt(S.regex(/NOT/i).skip(S.whitespace),S.string("!").skip(S.optWhitespace)),map:(e,t)=>U(t)},{"@desc":"Selects atoms included in both s1 and s2.","@examples":["ASP and .CA"],name:"and",type:M,rule:O(/AND|&/i),map:(e,t,n)=>de.struct.modifier.intersectBy({0:t,by:n})},{"@desc":"Selects atoms included in either s1 or s2.","@examples":["ASP or GLU"],name:"or",type:M,rule:O(/OR|\||,/i),map:(e,t,n)=>de.struct.combinator.merge([t,n])}],he=c.MolScriptBuilder,fe={acidic:["ASP","GLU"],aliphatic:["ALA","GLY","ILE","LEU","VAL"],amino:["ALA","ARG","ASN","ASP","CYS","GLN","GLU","GLY","HIS","ILE","LEU","LYS","MET","PHE","PRO","SER","THR","TRP","TYR","VAL","ASX","GLX","UNK"],aromatic:["HIS","PHE","TRP","TYR"],basic:["ARG","HIS","LYS"],buried:["ALA","CYS","ILE","LEU","MET","PHE","TRP","VAL"],cg:["CYT","C","GUA","G"],cyclic:["HIS","PHE","PRO","TRP","TYR"],hydrophobic:["ALA","GLY","ILE","LEU","MET","PHE","PRO","TRP","TYR","VAL"],large:["ARG","GLU","GLN","HIS","ILE","LEU","LYS","MET","PHE","TRP","TYR"],medium:["ASN","ASP","CYS","PRO","THR","VAL"],small:["ALA","GLY","SER"],nucleic:["G","C","A","T","U","I","DG","DC","DA","DT","DU","DI","+G","+C","+A","+T","+U","+I"]},me=["P","O3'","O5'","C5'","C4'","C3'","OP1","OP2","O3*","O5*","C5*","C4*","C3*","C2'","C1'","O4'","O2'"],ge=["C","N","CA"]
function ye(){return he.struct.combinator.merge([he.struct.generator.atomGroups({"residue-test":he.core.set.has([he.set(...fe.nucleic),he.ammp("label_comp_id")])}),he.struct.filter.pick({0:he.struct.generator.atomGroups({"group-by":he.ammp("residueKey")}),test:he.core.logic.and([he.core.rel.eq([he.struct.atomSet.atomCount(),1]),he.core.rel.eq([he.ammp("label_atom_id"),he.atomName("P")])])}),he.struct.filter.pick({0:he.struct.generator.atomGroups({"group-by":he.ammp("residueKey")}),test:he.core.logic.or([he.core.set.isSubset([W(["C1'","C2'","O3'","C3'","C4'","C5'","O5'"]),he.ammpSet("label_atom_id")]),he.core.set.isSubset([W(["C1*","C2*","O3*","C3*","C4*","C5*","O5*"]),he.ammpSet("label_atom_id")])])})])}const ve={all:{"@desc":"all atoms; same as *",abbr:["*"],map:()=>he.struct.generator.all()},bonded:{"@desc":"covalently bonded",map:()=>he.struct.generator.atomGroups({"atom-test":he.core.rel.gr([he.struct.atomProperty.core.bondCount({flags:he.struct.type.bondFlags(["covalent","metallic","sulfide"])}),0])})},clickable:{"@desc":"actually visible -- having some visible aspect such as wireframe, spacefill, or a label showing, or the alpha-carbon or phosphorus atom in a biomolecule that is rendered with only cartoon, rocket, or other biomolecule-specific shape."},connected:{"@desc":"bonded in any way, including hydrogen bonds",map:()=>he.struct.generator.atomGroups({"atom-test":he.core.rel.gr([he.struct.atomProperty.core.bondCount({flags:he.struct.type.bondFlags()}),0])})},displayed:{"@desc":"displayed using the display or hide command; not necessarily visible"},hidden:{"@desc":"hidden using the display or hide command"},none:{"@desc":"no atoms",map:()=>he.struct.generator.empty()},selected:{"@desc":"atoms that have been selected; defaults to all when a file is first loaded"},thisModel:{"@desc":'atoms in the current frame set, as defined by frame, model, or animation commands. If more than one model is in this set, "thisModel" refers to all of them, regardless of atom displayed/hidden status.'},visible:{"@desc":"visible in any way, including PDB residue atoms for which a cartoon or other such rendering makes their group visible, even if they themselves are not visible."},subset:{"@desc":"the currently defined subset. Note that if a subset is currently defined, then select/display all is the same as select/display subset, restrict none is the same as restrict not subset. In addition, select not subset selects nothing."},specialPosition:{"@desc":"atoms in crystal structures that are at special positions - that is, for which there is more than one operator that leads to them."},unitcell:{"@desc":"atoms within the current unitcell, which may be offset. This includes atoms on the faces and at the vertices of the unitcell."},polyhedra:{"@desc":"all central atoms for which polyhedra have been created. See also polyhera(n), below. (Jmol 14.4)"},nonmetal:{"@desc":"_H,_He,_B,_C,_N,_O,_F,_Ne,_Si,_P,_S,_Cl,_Ar,_As,_Se,_Br,_Kr,_Te,_I,_Xe,_At,_Rn",map:()=>he.struct.generator.atomGroups({"atom-test":he.core.set.has([he.set(...["H","He","B","C","N","O","F","Ne","Si","P","S","Cl","Ar","As","Se","Br","Kr","Te","I","Xe","At","Rn"].map(he.es)),he.acp("elementSymbol")])})},metal:{"@desc":"!nonmetal",map:()=>he.struct.generator.atomGroups({"atom-test":he.core.logic.not([he.core.set.has([he.set(...["H","He","B","C","N","O","F","Ne","Si","P","S","Cl","Ar","As","Se","Br","Kr","Te","I","Xe","At","Rn"].map(he.es)),he.acp("elementSymbol")])])})},alkaliMetal:{"@desc":"_Li,_Na,_K,_Rb,_Cs,_Fr",map:()=>he.struct.generator.atomGroups({"atom-test":he.core.set.has([he.set(...["Li","Na","K","Rb","Cs","Fr"].map(he.es)),he.acp("elementSymbol")])})},alkalineEarth:{"@desc":"_Be,_Mg,_Ca,_Sr,_Ba,_Ra",map:()=>he.struct.generator.atomGroups({"atom-test":he.core.set.has([he.set(...["Be","Mg","Ca","Sr","Ba","Ra"].map(he.es)),he.acp("elementSymbol")])})},nobleGas:{"@desc":"_He,_Ne,_Ar,_Kr,_Xe,_Rn",map:()=>he.struct.generator.atomGroups({"atom-test":he.core.set.has([he.set(...["He","Ne","Ar","Kr","Xe","Rn"].map(he.es)),he.acp("elementSymbol")])})},metalloid:{"@desc":"_B,_Si,_Ge,_As,_Sb,_Te",map:()=>he.struct.generator.atomGroups({"atom-test":he.core.set.has([he.set(...["B","Si","Ge","As","Sb","Te"].map(he.es)),he.acp("elementSymbol")])})},transitionMetal:{"@desc":"(includes La and Ac) elemno>=21 and elemno<=30, elemno=57, elemno=89, elemno>=39 and elemno<=48, elemno>=72 and elemno<=80, elemno>=104 and elemno<=112",map:()=>he.struct.generator.atomGroups({"atom-test":he.core.logic.or([he.core.rel.inRange([he.acp("atomicNumber"),21,30]),he.core.rel.inRange([he.acp("atomicNumber"),39,48]),he.core.rel.inRange([he.acp("atomicNumber"),72,80]),he.core.rel.inRange([he.acp("atomicNumber"),104,112]),he.core.set.has([he.set(57,89),he.acp("atomicNumber")])])})},lanthanide:{"@desc":"(does not include La) elemno>57 and elemno<=71",map:()=>he.struct.generator.atomGroups({"atom-test":he.core.rel.inRange([he.acp("atomicNumber"),57,71])})},actinide:{"@desc":"(does not include Ac) elemno>89 and elemno<=103",map:()=>he.struct.generator.atomGroups({"atom-test":he.core.rel.inRange([he.acp("atomicNumber"),89,103])})},isaromatic:{"@desc":"atoms connected with the AROMATIC, AROMATICSINGLE, or AROMATICDOUBLE bond types",map:()=>he.struct.generator.atomGroups({"atom-test":he.core.rel.gr([he.struct.atomProperty.core.bondCount({flags:he.struct.type.bondFlags(["aromatic"])}),0])})},carbohydrate:{"@desc":""},ions:{"@desc":'(specifically the PDB designations "PO4" and "SO4")'},ligand:{"@desc":'(originally "hetero and not solvent"; changed to "!(protein,nucleic,water,UREA)" for Jmol 12.2)'},nucleic:{"@desc":'any group that (a) has one of the following group names: G, C, A, T, U, I, DG, DC, DA, DT, DU, DI, +G, +C, +A, +T, +U, +I; or (b) can be identified as a group that is only one atom, with name "P"; or (c) has all of the following atoms (prime, \', can replace * here): C1*, C2*, C3*, O3*, C4*, C5*, and O5*.',map:()=>ye()},purine:{"@desc":"any nucleic group that (a) has one of the following group names: A, G, I, DA, DG, DI, +A, +G, or +I; or (b) also has atoms N7, C8, and N9.",map:()=>he.struct.modifier.intersectBy({0:ye(),by:he.struct.combinator.merge([he.struct.generator.atomGroups({"residue-test":he.core.set.has([he.set("A","G","I","DA","DG","DI","+A","+G","+I"),he.ammp("label_comp_id")])}),he.struct.filter.pick({0:he.struct.generator.atomGroups({"group-by":he.ammp("residueKey")}),test:he.core.set.isSubset([W(["N7","C8","N9"]),he.ammpSet("label_atom_id")])})])})},pyrimidine:{"@desc":"any nucleic group that (a) has one of the following group names: C, T, U, DC, DT, DU, +C, +T, +U; or (b) also has atom O2.",map:()=>he.struct.modifier.intersectBy({0:ye(),by:he.struct.combinator.merge([he.struct.generator.atomGroups({"residue-test":he.core.set.has([he.set("C","T","U","DC","DT","DU","+C","+T","+U"),he.ammp("label_comp_id")])}),he.struct.filter.pick({0:he.struct.generator.atomGroups({"group-by":he.ammp("residueKey")}),test:he.core.logic.or([he.core.set.has([he.ammpSet("label_atom_id"),he.atomName("O2*")]),he.core.set.has([he.ammpSet("label_atom_id"),he.atomName("O2'")])])})])})},dna:{"@desc":"any nucleic group that (a) has one of the following group names: DG, DC, DA, DT, DU, DI, T, +G, +C, +A, +T; or (b) has neither atom O2* or O2'.",map:()=>he.struct.modifier.intersectBy({0:ye(),by:he.struct.combinator.merge([he.struct.generator.atomGroups({"residue-test":he.core.set.has([he.set("DG","DC","DA","DT","DU","DI","T","+G","+C","+A","+T"),he.ammp("label_comp_id")])}),he.struct.filter.pick({0:he.struct.generator.atomGroups({"group-by":he.ammp("residueKey")}),test:he.core.logic.not([he.core.logic.or([he.core.set.has([he.ammpSet("label_atom_id"),he.atomName("O2*")]),he.core.set.has([he.ammpSet("label_atom_id"),he.atomName("O2'")])])])})])})},rna:{"@desc":"any nucleic group that (a) has one of the following group names: G, C, A, U, I, +U, +I; or (b) has atom O2* or O2'.",map:()=>he.struct.modifier.intersectBy({0:ye(),by:he.struct.combinator.merge([he.struct.generator.atomGroups({"residue-test":he.core.set.has([he.set("G","C","A","U","I","+U","+I"),he.ammp("label_comp_id")])}),he.struct.filter.pick({0:he.struct.generator.atomGroups({"group-by":he.ammp("residueKey")}),test:he.core.logic.or([he.core.set.has([he.ammpSet("label_atom_id"),he.atomName("O2*")]),he.core.set.has([he.ammpSet("label_atom_id"),he.atomName("O2'")])])})])})},protein:{"@desc":'defined as a group that (a) has one of the following group names: ALA, ARG, ASN, ASP, CYS, GLN, GLU, GLY, HIS, ILE, LEU, LYS, MET, PHE, PRO, SER, THR, TRP, TYR, VAL, ASX, GLX, or UNK; or (b) contains PDB atom designations [C, O, CA, and N] bonded correctly; or (c) does not contain "O" but contains [C, CA, and N] bonded correctly; or (d) has only one atom, which has name CA and does not have the group name CA (indicating a calcium atom).',map:()=>he.struct.generator.atomGroups({"residue-test":he.core.set.has([he.set(...fe.amino),he.ammp("label_comp_id")])})},acidic:{"@desc":"ASP GLU",map:()=>re(fe.acidic)},acyclic:{"@desc":"amino and not cyclic",map:()=>he.struct.modifier.intersectBy({0:re(fe.amino),by:U(re(fe.cyclic))})},aliphatic:{"@desc":"ALA GLY ILE LEU VAL",map:()=>re(fe.aliphatic)},amino:{"@desc":"all twenty standard amino acids, plus ASX, GLX, UNK",map:()=>re(fe.amino)},aromatic:{"@desc":'HIS PHE TRP TYR (see also "isaromatic" for aromatic bonds)',map:()=>re(fe.aromatic)},basic:{"@desc":"ARG HIS LYS",map:()=>re(fe.basic)},buried:{"@desc":"ALA CYS ILE LEU MET PHE TRP VAL",map:()=>re(fe.buried)},charged:{"@desc":"same as acidic or basic -- ASP GLU, ARG HIS LYS",map:()=>re(fe.acidic.concat(fe.basic))},cyclic:{"@desc":"HIS PHE PRO TRP TYR",map:()=>re(fe.cyclic)},helix:{"@desc":"secondary structure-related.",map:()=>he.struct.generator.atomGroups({"residue-test":he.core.flags.hasAny([he.struct.type.secondaryStructureFlags(["helix"]),he.ammp("secondaryStructureFlags")])})},helixalpha:{"@desc":"secondary structure-related.",map:()=>he.struct.generator.atomGroups({"residue-test":he.core.flags.hasAny([he.struct.type.secondaryStructureFlags(["alpha"]),he.ammp("secondaryStructureFlags")])})},helix310:{"@desc":"secondary structure-related.",map:()=>he.struct.generator.atomGroups({"residue-test":he.core.flags.hasAny([he.struct.type.secondaryStructureFlags(["3-10"]),he.ammp("secondaryStructureFlags")])})},helixpi:{"@desc":"secondary structure-related.",map:()=>he.struct.generator.atomGroups({"residue-test":he.core.flags.hasAny([he.struct.type.secondaryStructureFlags(["pi"]),he.ammp("secondaryStructureFlags")])})},hetero:{"@desc":"PDB atoms designated as HETATM",map:()=>he.struct.generator.atomGroups({"atom-test":he.ammp("isHet")})},hydrophobic:{"@desc":"ALA GLY ILE LEU MET PHE PRO TRP TYR VAL",map:()=>re(fe.hydrophobic)},large:{"@desc":"ARG GLU GLN HIS ILE LEU LYS MET PHE TRP TYR",map:()=>re(fe.large)},medium:{"@desc":"ASN ASP CYS PRO THR VAL",map:()=>re(fe.medium)},negative:{"@desc":"same as acidic -- ASP GLU",map:()=>re(fe.acidic)},neutral:{"@desc":"amino and not (acidic or basic)",map:()=>he.struct.modifier.intersectBy({0:re(fe.amino),by:U(re(fe.acidic.concat(fe.basic)))})},polar:{"@desc":"amino and not hydrophobic",map:()=>he.struct.modifier.intersectBy({0:re(fe.amino),by:U(re(fe.hydrophobic))})},positive:{"@desc":"same as basic -- ARG HIS LYS",map:()=>re(fe.basic)},sheet:{"@desc":"secondary structure-related",map:()=>he.struct.generator.atomGroups({"residue-test":he.core.flags.hasAny([he.struct.type.secondaryStructureFlags(["sheet"]),he.ammp("secondaryStructureFlags")])})},small:{"@desc":"ALA GLY SER",map:()=>re(fe.small)},surface:{"@desc":"amino and not buried",map:()=>he.struct.modifier.intersectBy({0:re(fe.amino),by:U(re(fe.buried))})},turn:{"@desc":"secondary structure-related",map:()=>he.struct.generator.atomGroups({"residue-test":he.core.flags.hasAny([he.struct.type.secondaryStructureFlags(["turn"]),he.ammp("secondaryStructureFlags")])})},alpha:{"@desc":"(*.CA)",map:()=>he.struct.generator.atomGroups({"atom-test":he.core.rel.eq([he.atomName("CA"),he.ammp("label_atom_id")])})},base:{"@desc":"(nucleic bases)"},backbone:{"@desc":"(*.C, *.CA, *.N, and all nucleic other than the bases themselves)",abbr:["mainchain"],map:()=>he.struct.combinator.merge([he.struct.modifier.intersectBy({0:he.struct.generator.atomGroups({"residue-test":he.core.set.has([he.core.type.set(fe.amino),he.ammp("label_comp_id")])}),by:he.struct.generator.atomGroups({"atom-test":he.core.set.has([he.core.type.set(ge),he.ammp("label_atom_id")])})}),he.struct.modifier.intersectBy({0:he.struct.generator.atomGroups({"residue-test":he.core.set.has([he.core.type.set(fe.nucleic),he.ammp("label_comp_id")])}),by:he.struct.generator.atomGroups({"atom-test":he.core.set.has([he.core.type.set(me),he.ammp("label_atom_id")])})})])},sidechain:{"@desc":"((protein or nucleic) and not backbone)"},spine:{"@desc":"(*.CA, *.N, *.C for proteins; *.P, *.O3', *.O5', *.C3', *.C4', *.C5 for nucleic acids)"},leadatom:{"@desc":"(*.CA, *.P, and terminal *.O5')"},solvent:{"@desc":'PDB "HOH", water, also the connected set of H-O-H in any model'}},be=c.MolScriptBuilder,xe=[{"@desc":"value comparisons","@examples":[],name:"=",abbr:["=="],type:M,rule:S.regexp(/\s*(LIKE|>=|<=|=|!=|>|<)\s*/i,1),map:(e,t,n)=>{let r
if("structure"===t?r=be.core.flags.hasAny([be.ammp("secondaryStructureFlags"),ce(n)]):"structure"===n?r=be.core.flags.hasAny([be.ammp("secondaryStructureFlags"),ce(t)]):void 0!==t.head?"core.type.regex"===t.head.name&&(r=be.core.str.match([t,be.core.type.str([n])])):void 0!==n.head?"core.type.regex"===n.head.name&&(r=be.core.str.match([n,be.core.type.str([t])])):"LIKE"===e.toUpperCase()&&(r=t.head?be.core.str.match([be.core.type.regex([`^${n}$`,"i"]),be.core.type.str([t])]):be.core.str.match([be.core.type.regex([`^${t}$`,"i"]),be.core.type.str([n])])),!r)switch(t.head&&(n=Z(t,n)),n.head&&(t=Z(n,t)),e){case"=":r=be.core.rel.eq([t,n])
break
case"!=":r=be.core.rel.neq([t,n])
break
case">":r=be.core.rel.gr([t,n])
break
case"<":r=be.core.rel.lt([t,n])
break
case">=":r=be.core.rel.gre([t,n])
break
case"<=":r=be.core.rel.lte([t,n])
break
default:throw new Error(`value operator '${e}' not supported`)}return be.struct.generator.atomGroups({"atom-test":r})}}]
function Se(e){const[t,n,r,i,o,a,s]=e[1],l={}
o&&(l["chain-test"]=be.core.rel.eq([be.ammp("auth_asym_id"),o]))
const c=[]
t&&c.push(be.core.rel.eq([be.ammp("label_comp_id"),t])),n&&c.push(be.core.logic.and([be.core.rel.gre([be.ammp("auth_seq_id"),n[0]]),be.core.rel.lte([be.ammp("auth_seq_id"),n[1]])])),r&&c.push(be.core.rel.eq([be.ammp("auth_seq_id"),r])),i&&c.push(be.core.rel.eq([be.ammp("pdbx_PDB_ins_code"),i])),c.length&&(l["residue-test"]=j(c))
const u=[]
return a&&u.push(be.core.rel.eq([be.ammp("auth_atom_id"),a])),s&&u.push(be.core.rel.eq([be.ammp("label_alt_id"),s])),u.length&&(l["atom-test"]=j(u)),be.struct.generator.atomGroups(l)}const _e=S.createLanguage({Integer:()=>S.regexp(/-?[0-9]+/).map(Number).desc("integer"),Parens:function(e){return S.alt(e.Parens,e.Operator,e.Expression).wrap(S.regexp(/\(\s*/),S.regexp(/\s*\)/))},Expression:function(e){return S.alt(e.Keywords,e.AtomExpression.map(Se),e.Within.map(e=>be.struct.modifier.includeSurroundings({0:e[1],radius:e[0]})),e.ValueQuery,e.Element.map(e=>be.struct.generator.atomGroups({"atom-test":be.core.rel.eq([be.acp("elementSymbol"),be.struct.type.elementSymbol(e)])})),e.Resname.map(e=>be.struct.generator.atomGroups({"residue-test":be.core.rel.eq([be.ammp("label_comp_id"),e])})))},Operator:function(e){return R(pe,S.alt(e.Parens,e.Expression))},AtomExpression:function(e){return S.seq(S.lookahead(e.AtomPrefix),S.seq(e.BracketedResname.or(S.of(null)),e.ResnoRange.or(S.of(null)),e.Resno.or(S.of(null)),e.Inscode.or(S.of(null)),e.Chainname.or(S.of(null)),e.Atomname.or(S.of(null)),e.Altloc.or(S.of(null)),e.Model.or(S.of(null)))).desc("expression")},AtomPrefix:()=>S.regexp(/[\[0-9:^%/.-]/).desc("atom-prefix"),Chainname:()=>S.regexp(/:([A-Za-z]{1,3})/,1).desc("chainname"),Model:()=>S.regexp(/\/([0-9]+)/,1).map(Number).desc("model"),Element:()=>S.regexp(/_([A-Za-z]{1,3})/,1).desc("element"),Atomname:()=>S.regexp(/\.([a-zA-Z0-9]{1,4})/,1).map(be.atomName).desc("atomname"),Resname:()=>S.regexp(/[a-zA-Z0-9]{1,4}/).desc("resname"),Resno:e=>e.Integer.desc("resno"),Altloc:()=>S.regexp(/%([a-zA-Z0-9])/,1).desc("altloc"),Inscode:()=>S.regexp(/\^([a-zA-Z0-9])/,1).desc("inscode"),BracketedResname:()=>S.regexp(/\[([a-zA-Z0-9]{1,4})\]/,1).desc("bracketed-resname"),ResnoRange:e=>S.seq(e.Integer.skip(S.seq(S.optWhitespace,S.string("-"),S.optWhitespace)),e.Integer).desc("resno-range"),Within:e=>S.regexp(/within/i).skip(S.regexp(/\s*\(\s*/)).then(S.seq(e.Integer.skip(S.regexp(/\s*,\s*/)),e.Query)).skip(S.regexp(/\)/)),Keywords:()=>S.alt(...Q(ve)).desc("keyword"),Query:function(e){return S.alt(e.Operator,e.Parens,e.Expression).trim(S.optWhitespace)},Number:function(){return S.regexp(/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/).map(Number).desc("number")},String:function(){const e=X(ue,ve,pe).sort(G).map(B.Nt).join("|")
return S.alt(S.regexp(new RegExp(`(?!(${e}))[A-Z0-9_]+`,"i")),S.regexp(/'((?:[^"\\]|\\.)*)'/,1),S.regexp(/"((?:[^"\\]|\\.)*)"/,1).map(e=>be.core.type.regex([`^${e}$`,"i"]))).desc("string")},Value:function(e){return S.alt(e.Number,e.String)},ValueParens:function(e){return S.alt(e.ValueParens,e.ValueOperator,e.ValueExpressions).wrap(S.string("("),S.string(")"))},ValuePropertyNames:function(){return S.alt(...$(ue,/LIKE|>=|<=|=|!=|>|<|\)|\s/i))},ValueOperator:function(e){return R(xe,S.alt(e.ValueParens,e.ValueExpressions))},ValueExpressions:function(e){return S.alt(e.Value,e.ValuePropertyNames)},ValueQuery:function(e){return S.alt(e.ValueOperator.map(e=>{if(e.head){if(e.head.name.startsWith("structure-query.generator"))return e}else if("string"==typeof e&&e.length<=4)return be.struct.generator.atomGroups({"residue-test":be.core.rel.eq([be.ammp("label_comp_id"),e])})
throw new Error(`values must be part of an comparison, value '${e}'`)}))}}),Ce=c.MolScriptBuilder,we=/[-+]?[0-9]*\.?[0-9]+/
function Te(e){return e.split("+").map(e=>e.replace(/^["']|["']$/g,""))}function Ae(e){if(e.includes("-")&&e.includes("+")){const t=e.split("+").map(e=>e.replace(/^["']|["']$/g,"")),n=[]
return t.forEach(e=>{if(e.includes("-")&&!e.startsWith("-")){const[t,r]=e.split("-").map(e=>parseInt(e))
for(let e=t;e<=r;e++)n.push(e)}else if(e.includes("-")&&e.startsWith("-")&&e.match(/[0-9]+-[-0-9]+/)){const t=-parseInt(e.split("-")[1])
let r
r=e.includes("--")?-parseInt(e.split("-")[3]):parseInt(e.split("-")[2])
for(let e=t;e<=r;e++)n.push(e)}else e.includes("-")&&e.startsWith("-")&&e.match(/[0-9]+-[-0-9]+/),n.push(parseInt(e))}),n}if(e.includes("-")&&!e.includes("+")){const t=[]
if(e.startsWith("-"))if(e.startsWith("-")&&e.match(/[0-9]+-[-0-9]+/)){const n=-parseInt(e.split("-")[1])
let r
r=e.includes("--")?-parseInt(e.split("-")[3]):parseInt(e.split("-")[2])
for(let e=n;e<=r;e++)t.push(e)}else e.startsWith("-")&&e.match(/[0-9]+-[-0-9]+/),t.push(parseInt(e))
else{const[n,r]=e.split("-").map(e=>parseInt(e))
for(let e=n;e<=r;e++)t.push(e)}return t}return!e.includes("-")&&e.includes("+")?Te(e).map(e=>parseInt(e)):[parseInt(e)]}const Ie={H:"helix",S:"beta",L:"none"},Pe={symbol:{"@desc":"chemical-symbol-list: list of 1- or 2-letter chemical symbols from the periodic table","@examples":["symbol O+N"],abbr:["e."],regex:/[a-zA-Z'"+]+/,map:function(e){return e.split("+").map(Ce.struct.type.elementSymbol)},level:"atom-test",property:Ce.acp("elementSymbol")},name:{"@desc":"atom-name-list: list of up to 4-letter codes for atoms in proteins or nucleic acids","@examples":["name CA+CB+CG+CD"],abbr:["n."],regex:/[a-zA-Z0-9'"+]+/,map:function(e){return e.split("+").map(Ce.atomName)},level:"atom-test",property:Ce.ammp("label_atom_id")},resn:{"@desc":"residue-name-list: list of 3-letter codes for amino acids or list of up to 2-letter codes for nucleic acids","@examples":["resn ASP+GLU+ASN+GLN","resn A+G"],abbr:["resname","r."],regex:/[a-zA-Z0-9'"+]+/,map:Te,level:"residue-test",property:Ce.ammp("label_comp_id")},resi:{"@desc":"residue-identifier-list list of up to 4-digit residue numbers or residue-identifier-range","@examples":["resi 1+10+100+1000","resi 1-10"],abbr:["resident","residue","resid","i."],regex:/[0-9+-]+/,map:Ae,level:"residue-test",property:Ce.ammp("auth_seq_id")},alt:{"@desc":"alternate-conformation-identifier-list list of single letters","@examples":["alt A+B",'alt ""','alt ""+A'],abbr:[],regex:/[a-zA-Z0-9'"+]+/,map:Te,level:"atom-test",property:Ce.ammp("label_alt_id")},chain:{"@desc":"chain-identifier-list list of single letters or sometimes numbers","@examples":["chain A"],abbr:["c."],regex:/[a-zA-Z0-9'"+]+/,map:Te,level:"chain-test",property:Ce.ammp("auth_asym_id")},segi:{"@desc":"segment-identifier-list list of up to 4 letter identifiers","@examples":["segi lig"],abbr:["segid","s."],regex:/[a-zA-Z0-9'"+]+/,map:Te,level:"chain-test",property:Ce.ammp("label_asym_id")},flag:{"@desc":"flag-number a single integer from 0 to 31","@examples":["flag 0"],isUnsupported:!0,abbr:["f."],regex:/[0-9]+/,map:e=>parseInt(e),level:"atom-test"},numeric_type:{"@desc":"type-number a single integer","@examples":["nt. 5"],isUnsupported:!0,abbr:["nt."],regex:/[0-9]+/,map:e=>parseInt(e),level:"atom-test"},text_type:{"@desc":"type-string a list of up to 4 letter codes","@examples":["text_type HA+HC"],isUnsupported:!0,abbr:["tt."],regex:/[a-zA-Z0-9'"+]+/,map:Te,level:"atom-test"},id:{"@desc":"external-index-number a single integer","@examples":["id 23"],regex:/[0-9+-]+/,map:Ae,level:"atom-test",property:Ce.ammp("id")},index:{"@desc":"internal-index-number a single integer","@examples":["index 11"],regex:/[0-9+-]+/,map:Ae,level:"atom-test",property:Ce.ammp("id")},ss:{"@desc":"secondary-structure-type list of single letters. Helical regions should be assigned H and sheet regions S. Loop regions can either be assigned L or be blank.","@examples":["ss H+S+L",'ss S+""'],abbr:[],regex:/[a-zA-Z'"+]+/,map:function(e){return{flags:Ce.struct.type.secondaryStructureFlags(e.toUpperCase().split("+").map(e=>Ie[e]||"none"))}},level:"residue-test",property:Ce.ammp("secondaryStructureFlags")},b:{"@desc":"comparison-operator b-factor-value a real number","@examples":["b > 10"],isNumeric:!0,abbr:[],regex:we,map:e=>parseFloat(e),level:"atom-test",property:Ce.ammp("B_iso_or_equiv")},q:{"@desc":"comparison-operator occupancy-value a real number","@examples":["q <0.50"],isNumeric:!0,abbr:[],regex:we,map:e=>parseFloat(e),level:"atom-test",property:Ce.ammp("occupancy")},formal_charge:{"@desc":"comparison-operator formal charge-value an integer","@examples":["fc. = -1"],isNumeric:!0,abbr:["fc."],regex:we,map:e=>parseFloat(e),level:"atom-test",property:Ce.ammp("pdbx_formal_charge")},partial_charge:{"@desc":"comparison-operator partial charge-value a real number","@examples":["pc. > 1"],isUnsupported:!0,isNumeric:!0,abbr:["pc."],regex:we,map:e=>parseFloat(e),level:"atom-test"},elem:{"@desc":'str  atomic element symbol string ("X" if undefined)',"@examples":["elem N"],regex:/[a-zA-Z0-9]{1,3}/,map:e=>Ce.es(e),level:"atom-test",property:Ce.acp("elementSymbol")}},Be=c.MolScriptBuilder,Ee=[{"@desc":"Selects atoms that are not included in s1.","@examples":["NOT resn ALA","not (resi 42 or chain A)","!resi 42 or chain A"],name:"not",type:k,rule:S.alt(S.regexp(/NOT/i).skip(S.whitespace),S.string("!").skip(S.optWhitespace)),map:(e,t)=>U(t)},{"@desc":"Selects atoms included in both s1 and s2.","@examples":["chain A AND name CA"],name:"and",type:M,rule:O(/AND|&/i),map:(e,t,n)=>Be.struct.modifier.intersectBy({0:t,by:n})},{"@desc":"Selects atoms included in either s1 or s2.","@examples":["chain A OR chain B"],name:"or",type:M,rule:O(/OR|\|/i),map:(e,t,n)=>Be.struct.combinator.merge([t,n])},{"@desc":"Selects atoms in s1 whose identifiers name, resi, resn, chain and segi all match atoms in s2.","@examples":["chain A IN chain B"],name:"in",type:M,rule:O(/IN/i),map:(e,t,n)=>Be.struct.filter.withSameAtomProperties({0:t,source:n,property:Be.core.type.compositeKey([Be.ammp("label_atom_id"),Be.ammp("label_seq_id"),Be.ammp("label_comp_id"),Be.ammp("auth_asym_id"),Be.ammp("label_asym_id")])})},{"@desc":"Selects atoms in s1 whose identifiers name and resi match atoms in s2.","@examples":["chain A LIKE chain B"],name:"like",type:M,rule:O(/LIKE|l\./i),map:(e,t,n)=>Be.struct.filter.withSameAtomProperties({0:t,source:n,property:Be.core.type.compositeKey([Be.ammp("label_atom_id"),Be.ammp("label_seq_id")])})},{"@desc":"Selects all atoms whose van der Waals radii are separated from the van der Waals radii of s1 by a minimum of X Angstroms.","@examples":["solvent GAP 2"],name:"gap",type:D,rule:N(/GAP\s+([-+]?[0-9]*\.?[0-9]+)/i,1).map(e=>parseFloat(e)),map:(e,t)=>Be.struct.filter.within({0:Be.struct.generator.all(),target:t,"atom-radius":Be.acp("vdw"),"max-radius":e,invert:!0})},{"@desc":"Selects atoms with centers within X Angstroms of the center of any atom in s1.","@examples":["resname LIG AROUND 1"],name:"around",abbr:["a."],type:D,rule:N(/(AROUND|a\.)\s+([-+]?[0-9]*\.?[0-9]+)/i,2).map(e=>parseFloat(e)),map:(e,t)=>Be.struct.modifier.exceptBy({0:Be.struct.filter.within({0:Be.struct.generator.all(),target:t,"max-radius":e}),by:t})},{"@desc":"Expands s1 by all atoms within X Angstroms of the center of any atom in s1.","@examples":["chain A EXPAND 3"],name:"expand",abbr:["x."],type:D,rule:N(/(EXPAND|x\.)\s+([-+]?[0-9]*\.?[0-9]+)/i,2).map(e=>parseFloat(e)),map:(e,t)=>Be.struct.modifier.includeSurroundings({0:t,radius:e})},{"@desc":"Selects atoms in s1 that are within X Angstroms of any atom in s2.","@examples":["chain A WITHIN 3 OF chain B"],name:"within",abbr:["w."],type:M,rule:F("WITHIN","w."),map:(e,t,n)=>Be.struct.filter.within({0:t,target:n,"max-radius":e})},{"@desc":"Same as within, but excludes s2 from the selection (and thus is identical to s1 and s2 around X).","@examples":["chain A NEAR_TO 3 OF chain B"],name:"near_to",abbr:["nto."],type:M,rule:F("NEAR_TO","nto."),map:(e,t,n)=>Be.struct.modifier.exceptBy({0:Be.struct.filter.within({0:t,target:n,"max-radius":e}),by:n})},{"@desc":"Selects atoms in s1 that are at least X Anstroms away from s2.","@examples":["solvent BEYOND 2 OF chain A"],name:"beyond",abbr:["be."],type:M,rule:F("BEYOND","be."),map:(e,t,n)=>Be.struct.modifier.exceptBy({0:Be.struct.filter.within({0:t,target:n,"max-radius":e,invert:!0}),by:n})},{"@desc":"Expands selection to complete residues.","@examples":["BYRESIDUE name N"],name:"byresidue",abbr:["byresi","byres","br."],type:k,rule:L(/BYRESIDUE|byresi|byres|br\./i),map:(e,t)=>Y(Be.struct.modifier.expandProperty({0:Be.struct.modifier.union({0:t}),property:Be.ammp("residueKey")}))},{"@desc":"Completely selects all alpha carbons in all residues covered by a selection.","@examples":["BYCALPHA chain A"],name:"bycalpha",abbr:["bca."],type:k,rule:L(/BYCALPHA|bca\./i),map:(e,t)=>Be.struct.generator.queryInSelection({0:Be.struct.modifier.expandProperty({0:Be.struct.modifier.union({0:t}),property:Be.ammp("residueKey")}),query:Be.struct.generator.atomGroups({"atom-test":Be.core.rel.eq([Be.atomName("CA"),Be.ammp("label_atom_id")])})})},{"@desc":"Expands selection to complete molecules.","@examples":["BYMOLECULE resi 20-30"],name:"bymolecule",isUnsupported:!0,abbr:["bymol","bm."],type:k,rule:L(/BYMOLECULE|bymol|bm\./i),map:(e,t)=>Y(Be.struct.modifier.expandProperty({0:Be.struct.modifier.union({0:t}),property:Be.atp("connectedComponentKey")}))},{"@desc":"Expands selection to complete fragments.","@examples":["BYFRAGMENT resi 10"],name:"byfragment",abbr:["byfrag","bf."],isUnsupported:!0,type:k,rule:L(/BYFRAGMENT|byfrag|bf\./i),map:(e,t)=>[e,t]},{"@desc":"Expands selection to complete segments.","@examples":["BYSEGMENT resn CYS"],name:"bysegment",abbr:["bysegi","byseg","bs."],type:k,rule:L(/BYSEGMENT|bysegi|byseg|bs\./i),map:(e,t)=>Y(Be.struct.modifier.expandProperty({0:Be.struct.modifier.union({0:t}),property:Be.ammp("chainKey")}))},{"@desc":"Expands selection to complete objects.","@examples":["BYOBJECT chain A"],name:"byobject",abbr:["byobj","bo."],isUnsupported:!0,type:k,rule:L(/BYOBJECT|byobj|bo\./i),map:(e,t)=>[e,t]},{"@desc":"Expands selection to unit cell.","@examples":["BYCELL chain A"],name:"bycell",isUnsupported:!0,type:k,rule:L(/BYCELL/i),map:(e,t)=>[e,t]},{"@desc":"All rings of size  7 which have at least one atom in s1.","@examples":["BYRING resn HEM"],name:"byring",type:k,rule:L(/BYRING/i),map:(e,t)=>Y(Be.struct.modifier.intersectBy({0:Be.struct.filter.pick({0:Be.struct.generator.rings(),test:Be.core.logic.and([Be.core.rel.lte([Be.struct.atomSet.atomCount(),7]),Be.core.rel.gr([Be.struct.atomSet.countQuery([t]),1])])}),by:t}))},{"@desc":"Selects atoms directly bonded to s1, excludes s1.","@examples":["NEIGHBOR resn CYS"],name:"neighbor",type:k,abbr:["nbr."],rule:L(/NEIGHBOR|nbr\./i),map:(e,t)=>Be.struct.modifier.exceptBy({0:Y(Be.struct.modifier.includeConnected({0:Be.struct.modifier.union({0:t}),"bond-test":!0})),by:t})},{"@desc":"Selects atoms directly bonded to s1, may include s1.","@examples":["BOUND_TO name CA"],name:"bound_to",abbr:["bto."],type:k,rule:L(/BOUND_TO|bto\./i),map:(e,t)=>Y(Be.struct.modifier.includeConnected({0:Be.struct.modifier.union({0:t})}))},{"@desc":"Extends s1 by X bonds connected to atoms in s1.","@examples":["resname LIG EXTEND 3"],name:"extend",abbr:["xt."],type:D,rule:N(/(EXTEND|xt\.)\s+([0-9]+)/i,2).map(e=>parseInt(e)),map:(e,t)=>Y(Be.struct.modifier.includeConnected({0:Be.struct.modifier.union({0:t}),"bond-test":!0,"layer-count":e}))}],ke=c.MolScriptBuilder,De={nucleic:["A","C","T","G","U","DA","DC","DT","DG","DU"],protein:["ALA","ARG","ASN","ASP","CYS","CYX","GLN","GLU","GLY","HIS","HID","HIE","HIP","ILE","LEU","LYS","MET","MSE","PHE","PRO","SER","THR","TRP","TYR","VAL"],solvent:["HOH","WAT","H20","TIP","SOL"]},Me=["P","O3'","O5'","C5'","C4'","C3'","OP1","OP2","O3*","O5*","C5*","C4*","C3*","C2'","C1'","O4'","O2'"],Re=["C","N","CA","O"]
function Oe(){return ke.struct.combinator.merge([ke.struct.modifier.intersectBy({0:ke.struct.generator.atomGroups({"residue-test":ke.core.set.has([ke.core.type.set(De.protein),ke.ammp("label_comp_id")])}),by:ke.struct.generator.atomGroups({"atom-test":ke.core.set.has([ke.core.type.set(Re),ke.ammp("label_atom_id")])})}),ke.struct.modifier.intersectBy({0:ke.struct.generator.atomGroups({"residue-test":ke.core.set.has([ke.core.type.set(De.nucleic),ke.ammp("label_comp_id")])}),by:ke.struct.generator.atomGroups({"atom-test":ke.core.set.has([ke.core.type.set(Me),ke.ammp("label_atom_id")])})})])}const Le={all:{"@desc":"All atoms currently loaded into PyMOL",abbr:["*"],map:()=>ke.struct.generator.all()},none:{"@desc":"No atoms (empty selection)",map:()=>ke.struct.generator.empty()},hydrogens:{"@desc":"All hydrogen atoms currently loaded into PyMOL",abbr:["hydro","h."],map:()=>ke.struct.generator.atomGroups({"atom-test":ke.core.rel.eq([ke.acp("elementSymbol"),ke.es("H")])})},hetatm:{"@desc":"All atoms loaded from Protein Data Bank HETATM records",abbr:["het"],map:()=>ke.struct.generator.atomGroups({"atom-test":ke.core.rel.eq([ke.ammp("isHet"),!0])})},visible:{"@desc":"All atoms in enabled objects with at least one visible representation",abbr:["v."]},polymer:{"@desc":"All atoms on the polymer (not het). Finds atoms with residue identifiers matching a known polymer, such a peptide and DNA.",abbr:["pol."],map:()=>ke.struct.generator.atomGroups({"residue-test":ke.core.set.has([ke.core.type.set(De.nucleic.concat(De.protein)),ke.ammp("label_comp_id")])})},sidechain:{"@desc":"Polymer non-backbone atoms (new in PyMOL 1.6.1)",abbr:["sc."],map:()=>ke.struct.modifier.exceptBy({0:ke.struct.generator.atomGroups({"residue-test":ke.core.set.has([ke.core.type.set(De.nucleic.concat(De.protein)),ke.ammp("label_comp_id")])}),by:Oe()})},present:{"@desc":"All atoms with defined coordinates in the current state (used in creating movies)",abbr:["pr."]},center:{"@desc":"Pseudo-atom at the center of the scene"},origin:{"@desc":"Pseudo-atom at the origin of rotation"},enabled:{"@desc":"All enabled objects or selections from the object list."},masked:{"@desc":"All masked atoms.",abbr:["msk."]},protected:{"@desc":"All protected atoms.",abbr:["pr."]},bonded:{"@desc":"All bonded atoms",map:()=>ke.struct.generator.atomGroups({"atom-test":ke.core.rel.gr([ke.struct.atomProperty.core.bondCount({flags:ke.struct.type.bondFlags(["covalent","metallic","sulfide"])}),0])})},donors:{"@desc":"All hydrogen bond donor atoms.",abbr:["don."]},acceptors:{"@desc":"All hydrogen bond acceptor atoms.",abbr:["acc."]},fixed:{"@desc":"All fixed atoms.",abbr:["fxd."]},restrained:{"@desc":"All restrained atoms.",abbr:["rst."]},organic:{"@desc":"All atoms in non-polymer organic compounds (e.g. ligands, buffers). Finds carbon-containing molecules that do not match known polymers.",abbr:["org."],map:()=>Y(ke.struct.modifier.expandProperty({0:ke.struct.modifier.union([ke.struct.generator.queryInSelection({0:ke.struct.generator.atomGroups({"residue-test":ke.core.logic.not([ke.core.set.has([ke.core.type.set(De.nucleic.concat(De.protein)),ke.ammp("label_comp_id")])])}),query:ke.struct.generator.atomGroups({"atom-test":ke.core.rel.eq([ke.es("C"),ke.acp("elementSymbol")])})})]),property:ke.ammp("residueKey")}))},inorganic:{"@desc":"All non-polymer inorganic atoms/ions. Finds atoms in molecules that do not contain carbon and do not match any known solvent residues.",abbr:["ino."],map:()=>Y(ke.struct.modifier.expandProperty({0:ke.struct.modifier.union([ke.struct.filter.pick({0:ke.struct.generator.atomGroups({"residue-test":ke.core.logic.not([ke.core.set.has([ke.core.type.set(De.nucleic.concat(De.protein).concat(De.solvent)),ke.ammp("label_comp_id")])]),"group-by":ke.ammp("residueKey")}),test:ke.core.logic.not([ke.core.set.has([ke.struct.atomSet.propertySet([ke.acp("elementSymbol")]),ke.es("C")])])})]),property:ke.ammp("residueKey")}))},solvent:{"@desc":"All water molecules. The hardcoded solvent residue identifiers are currently: HOH, WAT, H20, TIP, SOL.",abbr:["sol."],map:()=>ke.struct.generator.atomGroups({"residue-test":ke.core.set.has([ke.core.type.set(De.solvent),ke.ammp("label_comp_id")])})},guide:{"@desc":"All protein CA and nucleic acid C4*/C4",map:()=>ke.struct.combinator.merge([ke.struct.generator.atomGroups({"atom-test":ke.core.rel.eq([ke.atomName("CA"),ke.ammp("label_atom_id")]),"residue-test":ke.core.set.has([ke.core.type.set(De.protein),ke.ammp("label_comp_id")])}),ke.struct.generator.atomGroups({"atom-test":ke.core.set.has([W(["C4*","C4'"]),ke.ammp("label_atom_id")]),"residue-test":ke.core.set.has([ke.core.type.set(De.nucleic),ke.ammp("label_comp_id")])})])},metals:{"@desc":"All metal atoms (new in PyMOL 1.6.1)"},backbone:{"@desc":"Polymer backbone atoms (new in PyMOL 1.6.1)",abbr:["bb."],map:()=>Oe()},"polymer.protein":{"@desc":"Protein (New in PyMOL 2.1)",abbr:["polymer.protein"],map:()=>ke.struct.generator.atomGroups({"residue-test":ke.core.set.has([ke.core.type.set(De.protein),ke.ammp("label_comp_id")])})},"polymer.nucleic":{"@desc":"Nucleic Acid (New in PyMOL 2.1)",abbr:["polymer.nucleic"],map:()=>ke.struct.generator.atomGroups({"residue-test":ke.core.set.has([ke.core.type.set(De.nucleic),ke.ammp("label_comp_id")])})}},Ne=c.MolScriptBuilder,Fe=function(e){const t={}
return Object.keys(e).sort(G).forEach(n=>{const r=e[n],i=z(`property '${n}' not supported`),o=S.regexp(r.regex).map(e=>(r.isUnsupported&&i(),V(r.property,r.map(e))))
r.isNumeric||(t[n]=o)}),t}(Pe),ze=S.string("/")
function je(e){return e.or(S.of(null))}function Ve(e){const t={},n={}
for(const r in e){const t=Pe[r]
if(!t)throw new Error(`property '${r}' not supported, value '${e[r]}'`)
null!==e[r]&&(n[t.level]||(n[t.level]=[]),n[t.level].push(e[r]))}for(const r in n)t[r]=j(n[r])
return Ne.struct.generator.atomGroups(t)}const Ue=S.createLanguage({Parens:function(e){return S.alt(e.Parens,e.Operator,e.Expression).wrap(S.string("("),S.string(")"))},Expression:function(e){return S.alt(e.Keywords,e.AtomSelectionMacro.map(Ve),e.NamedAtomProperties,e.Pepseq,e.Rep,e.Object)},AtomSelectionMacro:function(e){return S.alt(ze.then(S.alt(S.seq(je(e.ObjectProperty).skip(ze),je(Fe.segi).skip(ze),je(Fe.chain).skip(ze),je(Fe.resi).skip(ze),je(Fe.name)).map(e=>({object:e[0],segi:e[1],chain:e[2],resi:e[3],name:e[4]})),S.seq(je(e.ObjectProperty).skip(ze),je(Fe.segi).skip(ze),je(Fe.chain).skip(ze),je(Fe.resi)).map(e=>({object:e[0],segi:e[1],chain:e[2],resi:e[3]})),S.seq(je(e.ObjectProperty).skip(ze),je(Fe.segi).skip(ze),je(Fe.chain)).map(e=>({object:e[0],segi:e[1],chain:e[2]})),S.seq(je(e.ObjectProperty).skip(ze),je(Fe.segi)).map(e=>({object:e[0],segi:e[1]})),S.seq(je(e.ObjectProperty)).map(e=>({object:e[0]})))),S.alt(S.seq(je(e.ObjectProperty).skip(ze),je(Fe.segi).skip(ze),je(Fe.chain).skip(ze),je(Fe.resi).skip(ze),je(Fe.name)).map(e=>({object:e[0],segi:e[1],chain:e[2],resi:e[3],name:e[4]})),S.seq(je(Fe.segi).skip(ze),je(Fe.chain).skip(ze),je(Fe.resi).skip(ze),je(Fe.name)).map(e=>({segi:e[0],chain:e[1],resi:e[2],name:e[3]})),S.seq(je(Fe.chain).skip(ze),je(Fe.resi).skip(ze),je(Fe.name)).map(e=>({chain:e[0],resi:e[1],name:e[2]})),S.seq(je(Fe.resi).skip(ze),je(Fe.name)).map(e=>({resi:e[0],name:e[1]}))))},NamedAtomProperties:function(){return S.alt(...q(Pe))},Keywords:()=>S.alt(...Q(Le)),ObjectProperty:()=>{const e=X(Pe,Le,Ee).sort(G).map(B.Nt).join("|")
return S.regexp(new RegExp(`(?!(${e}))[A-Z0-9_]+`,"i"))},Object:e=>e.ObjectProperty.notFollowedBy(ze).map(e=>{throw new Error(`property 'object' not supported, value '${e}'`)}),Pepseq:()=>S.regexp(/(PEPSEQ|ps\.)\s+([a-z]+)/i,2).map(z("operator 'pepseq' not supported")),Rep:()=>S.regexp(/REP\s+(lines|spheres|mesh|ribbon|cartoon|sticks|dots|surface|labels|extent|nonbonded|nb_spheres|slice|extent|slice|dashes|angles|dihedrals|cgo|cell|callback|everything)/i,1).map(z("operator 'rep' not supported")),Operator:function(e){return R(Ee,S.alt(e.Parens,e.Expression,e.Operator))},Query:function(e){return S.alt(e.Operator,e.Parens,e.Expression).trim(S.optWhitespace)}}),Ge=c.MolScriptBuilder,He=/[-+]?[0-9]*\.?[0-9]+/,qe=/[+]?[0-9]+/,Qe=/[-+]?[0-9]+/
function $e(e){return e}const Xe={T:"turn",E:"sheet",B:"strand",H:"alpha",G:"3-10",I:"pi",C:"none"}
function We(e){return Ge.struct.type.secondaryStructureFlags([Xe[e.toUpperCase()]||"none"])}const Ye={name:{"@desc":"str    atom name","@examples":["name CA"],regex:/[a-zA-Z0-9]+/,map:Ge.atomName,level:"atom-test",property:Ge.ammp("label_atom_id")},type:{"@desc":"str    atom type","@examples":["type C3"],isUnsupported:!0,regex:/[a-zA-Z0-9]+/,map:$e,level:"atom-test"},index:{"@desc":"num    the atom number, starting at 0","@examples":["index 10"],isNumeric:!0,regex:qe,map:e=>parseInt(e)-1,level:"atom-test",property:Ge.ammp("id")},serial:{"@desc":"num    the atom number, starting at 1","@examples":["serial 11"],isNumeric:!0,regex:qe,map:e=>parseInt(e),level:"atom-test",property:Ge.ammp("id")},atomicnumber:{"@desc":"num    atomic number (0 if undefined)","@examples":["atomicnumber 13"],isNumeric:!0,regex:qe,map:e=>parseInt(e),level:"atom-test",property:Ge.acp("atomicNumber")},element:{"@desc":'str  atomic element symbol string ("X" if undefined)',"@examples":["element N"],regex:/[a-zA-Z0-9]{1,3}/,map:e=>Ge.es(e),level:"atom-test",property:Ge.acp("elementSymbol")},altloc:{"@desc":"str  alternate location/conformation identifier","@examples":["altloc C"],regex:/[a-zA-Z0-9]+/,map:$e,level:"atom-test",property:Ge.ammp("label_alt_id")},chain:{"@desc":"str  the one-character chain identifier","@examples":["chain A"],regex:/[a-zA-Z0-9]+/,map:$e,level:"residue-test",property:Ge.ammp("auth_asym_id")},residue:{"@desc":"num  a set of connected atoms with the same residue number","@examples":["residue < 11","residue 11"],isNumeric:!0,regex:Qe,map:e=>parseInt(e),level:"residue-test",property:Ge.ammp("auth_seq_id")},fragment:{"@desc":"num  a set of connected residues","@examples":["fragment 42"],isUnsupported:!0,isNumeric:!0,regex:Qe,map:e=>parseInt(e),level:"residue-test"},pfrag:{"@desc":"num  a set of connected protein residues","@examples":["pfrag 42"],isUnsupported:!0,isNumeric:!0,regex:Qe,map:e=>parseInt(e),level:"residue-test"},nfrag:{"@desc":"num  a set of connected nucleic residues","@examples":["nfrag 42"],isUnsupported:!0,isNumeric:!0,regex:Qe,map:e=>parseInt(e),level:"residue-test"},sequence:{"@desc":"str  a sequence given by one letter names","@examples":["sequence PGATTACA"],isUnsupported:!0,regex:/[a-zA-Z0-9]+/,map:$e,level:"residue-test"},numbonds:{"@desc":"num  number of bonds","@examples":["numbonds = 2","numbonds >= 3"],isNumeric:!0,regex:qe,map:e=>parseInt(e),level:"atom-test",property:Ge.acp("bondCount")},resname:{"@desc":"str  residue name","@examples":["resname ALA"],regex:/[a-zA-Z0-9]+/,map:$e,level:"residue-test",property:Ge.ammp("auth_comp_id")},resid:{"@desc":"num  residue id","@examples":["resid 42"],isNumeric:!0,regex:Qe,map:e=>parseInt(e),level:"residue-test",property:Ge.ammp("auth_seq_id")},segname:{"@desc":"str  segment name","@examples":["segname B"],regex:/[a-zA-Z0-9]+/,map:$e,level:"residue-test",property:Ge.ammp("label_asym_id")},x:{"@desc":"float  x coordinate","@examples":["x 42"],isNumeric:!0,regex:He,map:e=>parseFloat(e),level:"atom-test",property:Ge.acp("x")},y:{"@desc":"float  y coordinate","@examples":["y > 1.7"],isNumeric:!0,regex:He,map:e=>parseFloat(e),level:"atom-test",property:Ge.acp("y")},z:{"@desc":"float  z coordinate","@examples":["z < 11","z > -21"],isNumeric:!0,regex:He,map:e=>parseFloat(e),level:"atom-test",property:Ge.acp("z")},radius:{"@desc":"float  atomic radius","@examples":["radius > 1.3"],isNumeric:!0,regex:He,map:e=>parseFloat(e),level:"atom-test",property:Ge.acp("vdw")},mass:{"@desc":"float  atomic mass","@examples":["mass > 2"],isNumeric:!0,regex:He,map:e=>parseFloat(e),level:"atom-test",property:Ge.acp("mass")},charge:{"@desc":"float  atomic charge","@examples":["charge > 0","charge 1"],isNumeric:!0,regex:He,map:e=>parseFloat(e),level:"atom-test",property:Ge.ammp("pdbx_formal_charge")},beta:{"@desc":"float  temperature factor","@examples":["beta < 20","beta > 35"],isNumeric:!0,regex:He,map:e=>parseFloat(e),level:"atom-test",property:Ge.ammp("B_iso_or_equiv")},occupancy:{"@desc":"float  occupancy","@examples":["occupancy 1","occupancy < 1"],isNumeric:!0,regex:He,map:e=>parseFloat(e),level:"atom-test",property:Ge.ammp("occupancy")},user:{"@desc":"float  time-varying user-specified value","@examples":["user < 0.1"],isUnsupported:!0,isNumeric:!0,regex:He,map:e=>parseFloat(e),level:"atom-test"},rasmol:{"@desc":"str  translates Rasmol selection string to VMD","@examples":["rasmol 'all'"],isUnsupported:!0,regex:/[^']*/,map:$e,level:"atom-test"},structure:{"@desc":"str  single letter name for the secondary structure","@examples":["structure H","structure H E"],regex:/T|E|B|H|G|I|C/i,map:We,level:"atom-test",property:Ge.ammp("secondaryStructureFlags")},phi:{"@desc":"float  phi backbone conformational angles","@examples":["phi < 160"],isUnsupported:!0,isNumeric:!0,regex:He,map:e=>parseFloat(e),level:"residue-test"},psi:{"@desc":"float  psi backbone conformational angles","@examples":["psi < 160"],isUnsupported:!0,isNumeric:!0,regex:He,map:e=>parseFloat(e),level:"residue-test"},ufx:{"@desc":"num  force to apply in the x coordinate","@examples":["ufx 1"],isUnsupported:!0,isNumeric:!0,regex:He,map:e=>parseInt(e),level:"atom-test"},ufy:{"@desc":"num  force to apply in the y coordinate","@examples":["ufy 1"],isUnsupported:!0,isNumeric:!0,regex:He,map:e=>parseInt(e),level:"atom-test"},ufz:{"@desc":"num  force to apply in the z coordinate","@examples":["ufz 1"],isUnsupported:!0,isNumeric:!0,regex:He,map:e=>parseInt(e),level:"atom-test"}},Ze=c.MolScriptBuilder,Ke=Object.keys(Ye).sort(G).filter(e=>!Ye[e].isUnsupported).join("|"),Je=[{"@desc":"Selects atoms that are not included in s1.","@examples":["not protein"],name:"not",type:k,rule:S.regexp(/NOT/i).skip(S.whitespace),map:(e,t)=>U(t)},{"@desc":"Selects atoms within a specified distance of a selection","@examples":["within 5 of name FE"],name:"within",type:k,rule:L(/WITHIN\s+([-+]?[0-9]*\.?[0-9]+)\s+OF/i,1).map(e=>parseFloat(e)),map:(e,t)=>Ze.struct.modifier.includeSurroundings({0:t,radius:e})},{"@desc":"Exclusive within, equivalent to (within 3 of X) and not X","@examples":["exwithin 10 of resname HEM"],name:"exwithin",type:k,rule:L(/EXWITHIN\s+([-+]?[0-9]*\.?[0-9]+)\s+OF/i,1).map(e=>parseFloat(e)),map:(e,t)=>Ze.struct.modifier.exceptBy({0:Ze.struct.modifier.includeSurroundings({0:t,radius:e}),by:t})},{"@desc":"Selects atoms which have the same keyword as the atoms in a given selection","@examples":["same resid as name FE"],name:"same",type:k,rule:L(new RegExp(`SAME\\s+(${Ke})\\s+AS`,"i"),1).map(e=>Ye[e].property),map:(e,t)=>Ze.struct.filter.withSameAtomProperties({0:Ze.struct.generator.all(),source:t,property:e})},{"@desc":"Selects atoms included in both s1 and s2.","@examples":["backbone and protein"],name:"and",type:M,rule:S.alt(O(/AND/i),S.whitespace),map:(e,t,n)=>Ze.struct.modifier.intersectBy({0:t,by:n})},{"@desc":"Selects atoms included in either s1 or s2.","@examples":["water or protein"],name:"or",type:M,rule:O(/OR/i),map:(e,t,n)=>Ze.struct.combinator.merge([t,n])}],et=c.MolScriptBuilder
function tt(){return et.struct.filter.pick({0:et.struct.generator.atomGroups({"group-by":et.ammp("residueKey")}),test:et.core.set.isSubset([W(["C","N","CA","O"]),et.ammpSet("label_atom_id")])})}function nt(){return et.struct.filter.pick({0:et.struct.generator.atomGroups({"group-by":et.ammp("residueKey")}),test:et.core.logic.and([et.core.set.isSubset([W(["P"]),et.ammpSet("label_atom_id")]),et.core.logic.or([et.core.set.isSubset([W(["O3'","C3'","C4'","C5'","O5'"]),et.ammpSet("label_atom_id")]),et.core.set.isSubset([W(["O3*","C3*","C4*","C5*","O5*"]),et.ammpSet("label_atom_id")])])])})}function rt(){return et.struct.combinator.merge([et.struct.generator.queryInSelection({0:tt(),query:et.struct.generator.atomGroups({"atom-test":et.core.set.has([W(ot.protein),et.ammp("label_atom_id")])})}),et.struct.generator.queryInSelection({0:nt(),query:et.struct.generator.atomGroups({"atom-test":et.core.set.has([W(ot.nucleic),et.ammp("label_atom_id")])})})])}function it(e){return et.struct.generator.atomGroups({"residue-test":et.core.flags.hasAll([et.ammp("secondaryStructureFlags"),et.struct.type.secondaryStructureFlags(e)])})}const ot={nucleic:["P","O3'","O5'","C5'","C4'","C3'","OP1","OP2","O3*","O5*","C5*","C4*","C3*"],protein:["C","N","CA","O"]},at={acidic:["ASP","GLU"],aliphatic:["ALA","GLY","ILE","LEU","VAL"],aromatic:["HIS","PHE","TRP","TYR"],at:["ADA","A","THY","T"],basic:["ARG","HIS","LYS"],buried:["ALA","LEU","VAL","ILE","PHE","CYS","MET","TRP"],cg:["CYT","C","GUA","G"],cyclic:["HIS","PHE","PRO","TRP","TYR"],hydrophobic:["ALA","LEU","VAL","ILE","PRO","PHE","MET","TRP"],medium:["VAL","THR","ASP","ASN","PRO","CYS","ASX","PCA","HYP"],neutral:["VAL","PHE","GLN","TYR","HIS","CYS","MET","TRP","ASX","GLX","PCA","HYP"],purine:["ADE","A","GUA","G"],pyrimidine:["CYT","C","THY","T","URI","U"],small:["ALA","GLY","SER"],water:["H2O","HH0","OHH","HOH","OH2","SOL","WAT","TIP","TIP2","TIP3","TIP4"]},st={all:{"@desc":"everything",map:()=>et.struct.generator.all()},none:{"@desc":"nothing",map:()=>et.struct.generator.empty()},protein:{"@desc":"a residue with atoms named C, N, CA, and O",map:()=>tt()},nucleic:{"@desc":"a residue with atoms named P, O1P, O2P and either O3', C3', C4', C5', O5' or O3*, C3*, C4*, C5*, O5*. This definition assumes that the base is phosphorylated, an assumption which will be corrected in the future.",map:()=>nt()},backbone:{"@desc":"the C, N, CA, and O atoms of a protein and the equivalent atoms in a nucleic acid.",map:()=>rt()},sidechain:{"@desc":"non-backbone atoms and bonds",map:()=>U(rt())},water:{"@desc":"all atoms with the resname H2O, HH0, OHH, HOH, OH2, SOL, WAT, TIP, TIP2, TIP3 or TIP4",abbr:["waters"],map:()=>re(at.water)},at:{"@desc":"residues named ADA A THY T",map:()=>re(at.at)},acidic:{"@desc":"residues named ASP GLU",map:()=>re(at.acidic)},acyclic:{"@desc":'"protein and not cyclic"',map:()=>et.struct.modifier.intersectBy({0:tt(),by:U(re(at.cyclic))})},aliphatic:{"@desc":"residues named ALA GLY ILE LEU VAL",map:()=>re(at.aliphatic)},alpha:{"@desc":"atom's residue is an alpha helix",map:()=>it(["alpha"])},amino:{"@desc":"a residue with atoms named C, N, CA, and O",map:()=>tt()},aromatic:{"@desc":"residues named HIS PHE TRP TYR",map:()=>re(at.aromatic)},basic:{"@desc":"residues named ARG HIS LYS",map:()=>re(at.basic)},bonded:{"@desc":"atoms for which numbonds > 0",map:()=>Y(et.struct.filter.pick({0:et.struct.modifier.includeConnected({0:et.struct.generator.all(),"bond-test":et.core.flags.hasAny([et.struct.bondProperty.flags(),et.struct.type.bondFlags(["covalent","metallic","sulfide"])])}),test:et.core.rel.gr([et.struct.atomSet.atomCount(),1])}))},buried:{"@desc":"residues named ALA LEU VAL ILE PHE CYS MET TRP",map:()=>re(at.buried)},cg:{"@desc":"residues named CYT C GUA G",map:()=>re(at.cg)},charged:{"@desc":'"basic or acidic"',map:()=>re(at.basic.concat(at.acidic))},cyclic:{"@desc":"residues named HIS PHE PRO TRP TYR",map:()=>re(at.cyclic)},hetero:{"@desc":'"not (protein or nucleic)"',map:()=>U(et.struct.combinator.merge([tt(),nt()]))},hydrogen:{"@desc":'name "[0-9]?H.*"',map:()=>et.struct.generator.atomGroups({"atom-test":et.core.str.match([et.core.type.regex(["^[0-9]?[H].*$","i"]),et.core.type.str([et.ammp("label_atom_id")])])})},large:{"@desc":'"protein and not (small or medium)"',map:()=>et.struct.modifier.intersectBy({0:tt(),by:U(re(at.small.concat(at.medium)))})},medium:{"@desc":"residues named VAL THR ASP ASN PRO CYS ASX PCA HYP",map:()=>re(at.medium)},neutral:{"@desc":"residues named VAL PHE GLN TYR HIS CYS MET TRP ASX GLX PCA HYP",map:()=>re(at.neutral)},hydrophobic:{"@desc":"hydrophobic resname ALA LEU VAL ILE PRO PHE MET TRP",map:()=>re(at.hydrophobic)},polar:{"@desc":'"protein and not hydrophobic"',map:()=>et.struct.modifier.intersectBy({0:tt(),by:U(re(at.hydrophobic))})},purine:{"@desc":"residues named ADE A GUA G",map:()=>re(at.purine)},pyrimidine:{"@desc":"residues named CYT C THY T URI U",map:()=>re(at.pyrimidine)},small:{"@desc":"residues named ALA GLY SER",map:()=>re(at.small)},surface:{"@desc":'"protein and not buried"',map:()=>et.struct.modifier.intersectBy({0:tt(),by:U(re(at.buried))})},alpha_helix:{"@desc":"atom's residue is in an alpha helix",map:()=>it(["alpha"])},pi_helix:{"@desc":"atom's residue is in a pi helix",map:()=>it(["pi"])},helix_3_10:{"@desc":"atom's residue is in a 3-10 helix",map:()=>it(["3-10"])},helix:{"@desc":"atom's residue is in an alpha or pi or 3-10 helix",map:()=>it(["helix"])},extended_beta:{"@desc":"atom's residue is a beta sheet",map:()=>it(["sheet"])},bridge_beta:{"@desc":"atom's residue is a beta sheet",map:()=>it(["strand"])},sheet:{"@desc":"atom's residue is a beta sheet",map:()=>it(["beta"])},turn:{"@desc":"atom's residue is in a turn conformation",map:()=>it(["turn"])},coil:{"@desc":"atom's residue is in a coil conformation",map:()=>et.struct.modifier.intersectBy({0:tt(),by:it(["none"])})}},lt=c.MolScriptBuilder,ct={sqr:{"@desc":"square of x","@examples":["sqr(2)"],map:e=>lt.core.math.pow([e,2])},sqrt:{"@desc":"square root of x","@examples":["sqrt(2)"],map:e=>lt.core.math.sqrt([e])},abs:{"@desc":"absolute value of x","@examples":["abs(2)"],map:e=>lt.core.math.abs([e])},floor:{"@desc":"largest integer not greater than x","@examples":["floor(2)"],map:e=>lt.core.math.floor([e])},ceil:{"@desc":"smallest integer not less than x","@examples":["ceil(2)"],map:e=>lt.core.math.ceil([e])},sin:{"@desc":"sine of x","@examples":["sin(2)"],map:e=>lt.core.math.sin([e])},cos:{"@desc":"cosine of x","@examples":["cos(2)"],map:e=>lt.core.math.cos([e])},tan:{"@desc":"tangent of x","@examples":["tan(2)"],map:e=>lt.core.math.tan([e])},atan:{"@desc":"arctangent of x","@examples":["atan(2)"],map:e=>lt.core.math.atan([e])},asin:{"@desc":"arcsin of x","@examples":["asin(2)"],map:e=>lt.core.math.asin([e])},acos:{"@desc":"arccos of x","@examples":["acos(2)"],map:e=>lt.core.math.acos([e])},sinh:{"@desc":"hyperbolic sine of x","@examples":["sinh(2)"],map:e=>lt.core.math.sinh([e])},cosh:{"@desc":"hyperbolic cosine of x","@examples":["cosh(2)"],map:e=>lt.core.math.cosh([e])},tanh:{"@desc":"hyperbolic tangent of x","@examples":["tanh(2)"],map:e=>lt.core.math.tanh([e])},exp:{"@desc":"e to the power x","@examples":["exp(2)"],map:e=>lt.core.math.exp([e])},log:{"@desc":"natural log of x","@examples":["log(2)"],map:e=>lt.core.math.log([e])},log10:{"@desc":"log base 10 of x","@examples":["log10(2)"],map:e=>lt.core.math.log10([e])}},ut=c.MolScriptBuilder,dt=[{"@desc":"multiplication, division","@examples":[],name:"mul-div",type:M,rule:S.regexp(/\s*(\*|\/)\s*/,1),map:(e,t,n)=>{switch(e){case"*":return ut.core.math.mult([t,n])
case"/":return ut.core.math.div([t,n])
default:throw new Error(`value operator '${e}' not supported`)}}},{"@desc":"addition, substraction","@examples":[],name:"add-sub",type:M,rule:S.regexp(/\s*(-|\+)\s*/,1),map:(e,t,n)=>{switch(e){case"-":return ut.core.math.sub([t,n])
case"+":return ut.core.math.add([t,n])
default:throw new Error(`value operator '${e}' not supported`)}}},{"@desc":"value comparisons","@examples":[],name:"comparison",type:M,rule:S.alt(S.regexp(/\s*(=~|==|>=|<=|=|!=|>|<)\s*/,1),S.whitespace.result("=")),map:(e,t,n)=>{let r
if(void 0!==t.head?("structure-query.atom-property.macromolecular.secondary-structure-flags"===t.head.name&&(r=ut.core.flags.hasAny([t,We(n)])),"core.type.regex"===t.head.name&&(r=ut.core.str.match([t,ut.core.type.str([n])]))):void 0!==n.head?("structure-query.atom-property.macromolecular.secondary-structure-flags"===n.head.name&&(r=ut.core.flags.hasAny([n,We(t)])),"core.type.regex"===n.head.name&&(r=ut.core.str.match([n,ut.core.type.str([t])]))):"=~"===e&&(r=t.head?ut.core.str.match([ut.core.type.regex([`^${n}$`,"i"]),ut.core.type.str([t])]):ut.core.str.match([ut.core.type.regex([`^${t}$`,"i"]),ut.core.type.str([n])])),!r)switch(t.head&&(n=Z(t,n)),n.head&&(t=Z(n,t)),e){case"=":case"==":r=ut.core.rel.eq([t,n])
break
case"!=":r=ut.core.rel.neq([t,n])
break
case">":r=ut.core.rel.gr([t,n])
break
case"<":r=ut.core.rel.lt([t,n])
break
case">=":r=ut.core.rel.gre([t,n])
break
case"<=":r=ut.core.rel.lte([t,n])
break
default:throw new Error(`value operator '${e}' not supported`)}return ut.struct.generator.atomGroups({"atom-test":r})}}],pt=S.createLanguage({Parens:function(e){return S.alt(e.Parens,e.Operator,e.Expression).wrap(S.string("("),S.string(")"))},Expression:function(e){return S.alt(e.RangeListProperty,e.ValueQuery,e.Keywords)},NamedAtomProperties:function(){return S.alt(...q(Ye))},Keywords:()=>S.alt(...Q(st)),ValueRange:function(e){return S.seq(e.Value.skip(S.regexp(/\s+TO\s+/i)),e.Value).map(e=>({range:e}))},RangeListProperty:function(e){return S.seq(S.alt(...$(Ye,/\s/)).skip(S.whitespace),S.alt(e.ValueRange,e.Value).sepBy1(S.whitespace)).map(e=>{const[t,n]=e,r=[],i=[]
n.forEach(e=>{e.range?i.push(ut.core.rel.inRange([t,e.range[0],e.range[1]])):r.push(Z(t,e,Xe))})
const o=1===(a=i).length?a[0]:a.length>1?E.core.logic.or(a):void 0
var a
const s=function(e,t){if(ne.includes(e.head.name)){const n=t[0].head,r=[]
return t.forEach(e=>r.push(...e.args[0])),E.core.flags.hasAny([e,{head:n,args:r}])}return 1===t.length?E.core.rel.eq([e,t[0]]):t.length>1?E.core.set.has([E.core.type.set(t),e]):void 0}(t,r)
let l
return l=o&&s?ut.core.logic.or([o,s]):o||s,ut.struct.generator.atomGroups({[te(t)]:l})})},Operator:function(e){return R(Je,S.alt(e.Parens,e.Expression,e.ValueQuery))},Query:function(e){return S.alt(e.Operator,e.Parens,e.Expression).trim(S.optWhitespace)},Number:function(){return S.regexp(/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/).map(Number).desc("number")},String:function(){const e=X(Ye,st,Je).sort(G).map(B.Nt).join("|")
return S.alt(S.regexp(new RegExp(`(?!(${e}))[A-Z0-9_]+`,"i")),S.regexp(/'((?:[^"\\]|\\.)*)'/,1),S.regexp(/"((?:[^"\\]|\\.)*)"/,1).map(e=>ut.core.type.regex([`^${e}$`,"i"]))).desc("string")},Value:function(e){return S.alt(e.Number,e.String)},ValueParens:function(e){return S.alt(e.ValueParens,e.ValueOperator,e.ValueExpressions).wrap(S.string("("),S.string(")"))},ValuePropertyNames:function(){return S.alt(...$(Ye,/=~|==|>=|<=|=|!=|>|<|\)|\s|\+|-|\*|\//i))},ValueOperator:function(e){return R(dt,S.alt(e.ValueParens,e.ValueExpressions))},ValueExpressions:function(e){return S.alt(e.ValueFunctions,e.Value,e.ValuePropertyNames)},ValueFunctions:function(e){return S.alt(...function(e,t){const n=[],r=S.regexp(/\(\s*/),i=S.regexp(/\s*\)/)
return Object.keys(e).sort(G).forEach(o=>{const a=e[o],s=a.map?a.map:z(`function '${o}' not supported`),l=S.regexp(new RegExp(o,"i")).skip(r).then(t).skip(i).map(s)
n.push(l)}),n}(ct,e.ValueOperator))},ValueQuery:function(e){return S.alt(e.ValueOperator.map(e=>{if(e.head.name&&e.head.name.startsWith("structure-query.generator"))return e
throw new Error(`values must be part of an comparison, value '${e}'`)}))}}),ht={pymol:e=>Ue.Query.tryParse(e),vmd:e=>pt.Query.tryParse(e),jmol:e=>_e.Query.tryParse(e)},ft=ht
var mt=n(48393),gt=n(85554)
function yt(e,t){return{expression:e,language:t}}!function(e){function t(e){switch(e.language){case"mol-script":const n=(t=e.expression,I.parse(t))
if(0===n.length)throw new Error("No query")
return x(n[0])
case"pymol":case"jmol":case"vmd":return function(e,t){try{return ft[e](t)}catch(e){throw console.error(e.message),e}}(e.language,e.expression)
default:(0,P.dr)(e.language)}var t}function n(e){const n=t(e)
return(0,gt.wE)(n)}e.Info={"mol-script":"Mol-Script",pymol:"PyMOL",vmd:"VMD",jmol:"Jmol"},e.is=function(e){return!!e&&"string"==typeof e.expression&&!!e.language},e.areEqual=function(e,t){return e.language===t.language&&e.expression===t.expression},e.toExpression=t,e.toQuery=n,e.toLoci=function(e,t){const r=n(e)(new mt.QueryContext(t))
return mt.StructureSelection.toLociWithSourceUnits(r)},e.getStructureSelection=function(e,t,n){const r="function"==typeof e?e(c.MolScriptBuilder):e
return(0,gt.wE)(r)(new mt.QueryContext(t,n))}}(yt||(yt={}))},8054(e,t,n){"use strict"
n.r(t),n.d(t,{DownloadFile:()=>p,OpenFiles:()=>d})
var r=n(43472),i=n(70292),o=n(32372),a=n(33204),s=n(92384),l=n(47944),c=n(39298)
async function u(e,t,n,r){var i,o,s,l
const c=(0,a.o)(null!==(o=null===(i=e.file)||void 0===i?void 0:i.name)&&void 0!==o?o:""),u=t.dataFormats.binaryExtensions.has(c.ext),{data:d}=await t.builders.data.readFile({file:e,isBinary:u}),p="auto"===n?t.dataFormats.auto(c,null===(s=d.cell)||void 0===s?void 0:s.obj):t.dataFormats.get(n)
if(!p)return t.log.warn(`OpenFiles: could not find data provider for '${c.ext}'`),void await t.state.data.build().delete(d).commit()
const h=await p.parse(t,d)
r&&await(null===(l=p.visuals)||void 0===l?void 0:l.call(p,t,h))}const d=r.KW.build({display:{name:"Open Files",description:"Load one or more files and optionally create default visuals"},from:c.O.Root,params:(e,t)=>{const{extensions:n,options:r}=t.dataFormats
return{files:s.t.FileList({accept:Array.from(n.values()).map(e=>`.${e}`).join(",")+",.gz,.zip",multiple:!0}),format:s.t.MappedStatic("auto",{auto:s.t.EmptyGroup(),specific:s.t.Select(r[0][0],r)}),visuals:s.t.Boolean(!0,{description:"Add default visuals"})}}})(({params:e,state:t},n)=>i.Task.create("Open Files",async r=>{n.behaviors.layout.leftPanelTabName.next("data"),await t.transaction(async()=>{if(null!==e.files)for(const t of e.files)try{if(t.file&&t.name.toLowerCase().endsWith(".zip")){const i=await(0,l.$1)(r,await t.file.arrayBuffer())
for(const[t,r]of Object.entries(i)){if(!(r instanceof Uint8Array)||0===r.length)continue
const i=o.V.File(new File([r],t))
await u(i,n,"auto",e.visuals)}}else{const r="auto"===e.format.name?"auto":e.format.params
await u(t,n,r,e.visuals)}}catch(e){console.error(e),n.log.error(`Error opening file '${t.name}'`)}else n.log.error("No file(s) selected")}).runInContext(r)})),p=r.KW.build({display:{name:"Download File",description:"Load one or more file from an URL"},from:c.O.Root,params:(e,t)=>{const n=[...t.dataFormats.options,["zip","Zip"],["gzip","Gzip"]]
return{url:s.t.Url(""),format:s.t.Select(n[0][0],n),isBinary:s.t.Boolean(!1),visuals:s.t.Boolean(!0,{description:"Add default visuals"})}}})(({params:e,state:t},n)=>i.Task.create("Open Files",async r=>{n.behaviors.layout.leftPanelTabName.next("data"),await t.transaction(async()=>{var t,i,s
try{if("zip"===e.format||"gzip"===e.format){const s=await n.builders.data.download({url:e.url,isBinary:!0})
if("zip"===e.format){const i=await(0,l.$1)(r,(null===(t=s.obj)||void 0===t?void 0:t.data).buffer)
for(const[t,r]of Object.entries(i)){if(!(r instanceof Uint8Array)||0===r.length)continue
const i=o.V.File(new File([r],t))
await u(i,n,"auto",e.visuals)}}else{const t=o.V.getUrl(e.url),r=(0,a.o)(t).name
await u(o.V.File(new File([null===(i=s.obj)||void 0===i?void 0:i.data],r)),n,"auto",e.visuals)}}else{const t=n.dataFormats.get(e.format)
if(!t)return void n.log.warn(`DownloadFile: could not find data provider for '${e.format}'`)
const r=await n.builders.data.download({url:e.url,isBinary:e.isBinary}),i=await t.parse(n,r)
e.visuals&&await(null===(s=t.visuals)||void 0===s?void 0:s.call(t,n,i))}}catch(t){console.error(t),n.log.error(`Error downloading '${"string"==typeof e.url?e.url:e.url.url}'`)}}).runInContext(r)}))},8294(e,t,n){"use strict"
n.d(t,{u:()=>r})
var r,i=n(67538),o=n(70012),a=n(14294),s=n(32775),l=n(70292),c=n(94050),u=n(44195),d=n(20356),p=n(97960),h=n(10212),f=n(68329)
function m(e){return u.RT.generators.atoms({chainTest:u.RT.pred.and(u.RT.pred.eq(e=>f.Z.unit.operator_name(e.element),a.JX.DefaultName),u.RT.pred.inSet(e=>f.Z.chain.label_asym_id(e.element),e))})}function g(e,t,n,r,i,o){const{spacegroup:l,ncsOperators:c}=e,u=[],{toFractional:d}=l.cell,p=s.eB.transformMat4((0,s.eB)(),o,d),h=a.is.getSymmetryOperatorRef(l,t,n,r,i,p)
if(c&&c.length)for(let f=0,m=c.length;f<m;++f){const e=c[f],t=s.$I.mul((0,s.$I)(),h.matrix,e.matrix),n=a.JX.create(`${h.name} ${e.name}`,t,{assembly:h.assembly,ncsId:e.ncsId,hkl:h.hkl,spgrOp:h.spgrOp})
u.push(n)}else u.push(h)
return u}function y(e,t,n,r){const{spacegroup:i,ncsOperators:o}=e,s=o&&o.length||0,l=[]
!s&&t[0]<=0&&n[0]>=0&&t[1]<=0&&n[1]>=0&&t[2]<=0&&n[2]>=0&&(l[0]=a.is.getSymmetryOperator(i,0,0,0,0))
for(let a=0;a<i.operators.length;a++)for(let i=t[0];i<=n[0];i++)for(let o=t[1];o<=n[1];o++)for(let c=t[2];c<=n[2];c++)(s||0!==a||0!==i||0!==o||0!==c)&&l.push(...g(e,a,i,o,c,r))
return l}function v(e,t){const n=d.o.Builder({label:e.label,dynamicBonds:e.dynamicBonds}),{units:r}=e
for(const i of t)for(const e of r)n.addWithOperator(e,i)
return n.getStructure()}!function(e){function t(e,t){return e.invariantId===t.invariantId&&e.model.id===t.model.id&&i.X9.areEqual(e.elements,t.elements)}function n(){return(0,o.BI)(p.N.hashUnit,t)}e.buildAssembly=function(e,t){return l.Task.create("Build Assembly",async n=>{const r=e.models
if(1!==r.length)throw new Error("Can only build assemblies from structures based on 1 model.")
const i=c.vw.findAssembly(r[0],t)
if(!i)throw new Error(`Assembly '${t}' is not defined.`)
const o=a.JX.create(i.id,s.$I.identity(),{assembly:{id:i.id,operId:0,operList:[]}}),l=d.o.Builder({coordinateSystem:o,label:e.label,dynamicBonds:e.dynamicBonds}),p=new u.cY(e)
for(const e of i.operatorGroups){const t=e.selector(p)
if(0===u.cv.structureCount(t))continue
const{units:n}=u.cv.unionStructure(t)
for(const r of e.operators)for(const e of n)l.addWithOperator(e,r)}return l.getStructure()})},e.buildSymmetryAssembly=function(e,t,n){return l.Task.create("Build Symmetry Assembly",async r=>{const i=e.models
if(1!==i.length)throw new Error("Can only build symmetry assemblies from structures based on 1 model.")
const o=(0,s.eB)(),a=d.o.Builder({label:e.label,representativeModel:i[0],dynamicBonds:e.dynamicBonds}),l=new u.cY(e)
for(const e of t){const t=m(e.asymIds)(l)
if(0===u.cv.structureCount(t))continue
const{units:r}=u.cv.unionStructure(t)
for(const{index:i,shift:[s,l,c]}of e.operators){const e=g(n,i,s,l,c,o)
for(const t of r)for(const n of e)a.addWithOperator(t,n)}}return a.getStructure()})},e.builderSymmetryMates=function(e,t){return l.Task.create("Find Symmetry Mates",n=>async function(e,t,n){const r=t.models
if(1!==r.length)throw new Error("Can only build symmetries from structures based on 1 model.")
const i=h.i.Provider.get(r[0])
if(!i)return t
const{spacegroup:o}=i
if(a.O8.isZero(o.cell))return t
e.shouldUpdate&&await e.update("Initialing...")
const l=function(e,t){return e._operators_333&&s.eB.equals(t,e._operators_333.ref)||(e._operators_333={ref:s.eB.clone(t),operators:y(e,s.eB.create(-3,-3,-3),s.eB.create(3,3,3),t)}),e._operators_333.operators}(i,c.Kx.getCenter(r[0])),u=t.lookup3d,p=new Set
function f(e,t){return`${e.invariantId}|${t.name}`}const m=d.o.Builder({label:t.label,dynamicBonds:t.dynamicBonds}),{units:g}=t,v=s.eB.zero()
for(const a of l){for(const e of g){const t=e.lookup3d.boundary.sphere
s.eB.transformMat4(v,t.center,a.matrix)
const r=u.findUnitIndices(v[0],v[1],v[2],t.radius+n)
for(let i=0,o=r.count;i<o;i++){if(!g[r.indices[i]].lookup3d.check(v[0],v[1],v[2],t.radius+n))continue
const o=f(e,a)
p.has(o)||(m.addWithOperator(e,a),p.add(o))}}e.shouldUpdate&&await e.update("Building symmetry...")}return m.getStructure()}(n,e,t))},e.buildSymmetryRange=function(e,t,n){return l.Task.create("Build Symmetry",r=>async function(e,t,n,r){const i=t.models
if(1!==i.length)throw new Error("Can only build symmetries from structures based on 1 model.")
const o=h.i.Provider.get(i[0])
if(!o)return t
const{spacegroup:s}=o
return a.O8.isZero(s.cell)?t:v(t,y(o,n,r,c.Kx.getCenter(i[0])))}(0,e,t,n))},e.buildNcs=function(e){return l.Task.create("Build NCS",t=>async function(e,t){const n=t.models
if(1!==n.length)throw new Error("Can only build NCS from structures based on 1 model.")
const r=h.i.Provider.get(n[0])
if(!r)return t
const i=r.ncsOperators
return i&&i.length?v(t,i):t}(0,e))},e.areUnitsEquivalent=t,e.UnitEquivalenceBuilder=n,e.computeTransformGroups=function(e){const t=n()
for(const n of e.units)t.add(n.id,n)
const r=[]
for(const n of t.groups)r.push(p.N.SymmetryGroup(n.map(t=>e.unitMap.get(t))))
return r},e.areTransformGroupsEquivalent=function(e,t){if(e.length!==t.length)return!1
for(let n=0,r=e.length;n<r;++n){const r=e[n].units,o=t[n].units
if(r.length!==o.length)return!1
if(e[n].hashCode!==t[n].hashCode)return!1
for(let e=0,t=r.length;e<t;e++)if(r[e].conformation!==o[e].conformation)return!1
if(!i.X9.areEqual(e[n].elements,t[n].elements))return!1}return!0}}(r||(r={}))},8507(e,t,n){"use strict"
n.d(t,{O6:()=>c,Yd:()=>l,ZL:()=>s,kD:()=>r,on:()=>u,v3:()=>p})
const r={forceCompute:!1,noCompute:!1,maxRadius:4},i={H:0,h:0,D:0,d:0,T:0,t:0,He:2,HE:2,he:2,Li:3,LI:3,li:3,Be:4,BE:4,be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,f:9,Ne:10,NE:10,ne:10,Na:11,NA:11,na:11,Mg:12,MG:12,mg:12,Al:13,AL:13,al:13,Si:14,SI:14,si:14,P:15,p:15,S:16,s:16,Cl:17,CL:17,cl:17,Ar:18,AR:18,ar:18,K:19,k:19,Ca:20,CA:20,ca:20,Sc:21,SC:21,sc:21,Ti:22,TI:22,ti:22,V:23,v:23,Cr:24,CR:24,cr:24,Mn:25,MN:25,mn:25,Fe:26,FE:26,fe:26,Co:27,CO:27,co:27,Ni:28,NI:28,ni:28,Cu:29,CU:29,cu:29,Zn:30,ZN:30,zn:30,Ga:31,GA:31,ga:31,Ge:32,GE:32,ge:32,As:33,AS:33,as:33,Se:34,SE:34,se:34,Br:35,BR:35,br:35,Kr:36,KR:36,kr:36,Rb:37,RB:37,rb:37,Sr:38,SR:38,sr:38,Y:39,y:39,Zr:40,ZR:40,zr:40,Nb:41,NB:41,nb:41,Mo:42,MO:42,mo:42,Tc:43,TC:43,tc:43,Ru:44,RU:44,ru:44,Rh:45,RH:45,rh:45,Pd:46,PD:46,pd:46,Ag:47,AG:47,ag:47,Cd:48,CD:48,cd:48,In:49,IN:49,in:49,Sn:50,SN:50,sn:50,Sb:51,SB:51,sb:51,Te:52,TE:52,te:52,I:53,i:53,Xe:54,XE:54,xe:54,Cs:55,CS:55,cs:55,Ba:56,BA:56,ba:56,La:57,LA:57,la:57,Ce:58,CE:58,ce:58,Pr:59,PR:59,pr:59,Nd:60,ND:60,nd:60,Pm:61,PM:61,pm:61,Sm:62,SM:62,sm:62,Eu:63,EU:63,eu:63,Gd:64,GD:64,gd:64,Tb:65,TB:65,tb:65,Dy:66,DY:66,dy:66,Ho:67,HO:67,ho:67,Er:68,ER:68,er:68,Tm:69,TM:69,tm:69,Yb:70,YB:70,yb:70,Lu:71,LU:71,lu:71,Hf:72,HF:72,hf:72,Ta:73,TA:73,ta:73,W:74,w:74,Re:75,RE:75,re:75,Os:76,OS:76,os:76,Ir:77,IR:77,ir:77,Pt:78,PT:78,pt:78,Au:79,AU:79,au:79,Hg:80,HG:80,hg:80,Tl:81,TL:81,tl:81,Pb:82,PB:82,pb:82,Bi:83,BI:83,bi:83,Po:84,PO:84,po:84,At:85,AT:85,at:85,Rn:86,RN:86,rn:86,Fr:87,FR:87,fr:87,Ra:88,RA:88,ra:88,Ac:89,AC:89,ac:89,Th:90,TH:90,th:90,Pa:91,PA:91,pa:91,U:92,u:92,Np:93,NP:93,np:93,Pu:94,PU:94,pu:94,Am:95,AM:95,am:95,Cm:96,CM:96,cm:96,Bk:97,BK:97,bk:97,Cf:98,CF:98,cf:98,Es:99,ES:99,es:99,Fm:100,FM:100,fm:100,Md:101,MD:101,md:101,No:102,NO:102,no:102,Lr:103,LR:103,lr:103,Rf:104,RF:104,rf:104,Db:105,DB:105,db:105,Sg:106,SG:106,sg:106,Bh:107,BH:107,bh:107,Hs:108,HS:108,hs:108,Mt:109,MT:109,mt:109},o={0:1.42,1:1.42,3:2.7,4:2.7,6:1.75,7:1.6,8:1.52,11:2.7,12:2.7,13:2.7,14:1.9,15:2,16:1.9,17:1.8,19:2.7,20:2.7,21:2.7,22:2.7,23:2.7,24:2.7,25:2.7,26:2.7,27:2.7,28:2.7,29:2.7,30:2.7,31:2.7,33:2.68,37:2.7,38:2.7,39:2.7,40:2.7,41:2.7,42:2.7,43:2.7,44:2.7,45:2.7,46:2.7,47:2.7,48:2.7,49:2.7,50:2.7,55:2.7,56:2.7,57:2.7,58:2.7,59:2.7,60:2.7,61:2.7,62:2.7,63:2.7,64:2.7,65:2.7,66:2.7,67:2.7,68:2.7,69:2.7,70:2.7,71:2.7,72:2.7,73:2.7,74:2.7,75:2.7,76:2.7,77:2.7,78:2.7,79:2.7,80:2.7,81:2.7,82:2.7,83:2.7,87:2.7,88:2.7,89:2.7,90:2.7,91:2.7,92:2.7,93:2.7,94:2.7,95:2.7,96:2.7,97:2.7,98:2.7,99:2.7,100:2.7,101:2.7,102:2.7,103:2.7,104:2.7,105:2.7,106:2.7,107:2.7,108:2.7,109:2.88},a={0:.8,20:1.31,27:1.2,35:1.15,44:1.1,54:1,60:1.84,72:1.88,84:1.75,85:1.56,86:1.76,98:1.6,99:1.68,100:1.63,112:1.6,113:1.59,114:1.36,129:1.45,135:1.47,144:1.6,152:1.45,170:1.4,180:1.55,202:2.4,222:2.24,224:1.91,225:1.98,243:2.02,269:2,293:1.9,316:1.8,420:2.37,480:2.3,512:2.3,544:2.3,612:2.1,629:1.54,665:1,813:2.6,854:2.27,894:1.93,896:2.1,937:2.05,938:2.06,981:1.62,1258:2.68,1309:2.33,1484:1,1763:2.14,1823:2.48,1882:2.1,1944:1.72,2380:2.34,3367:2.44,3733:2.11,3819:2.6,3821:2.36,4736:2.75,5724:2.73,5959:2.63,6519:2.84,6750:2.87,8991:2.81},s=function(){const e=["LI","NA","K","RB","CS","FR","BE","MG","CA","SR","BA","RA","AL","GA","IN","SN","TL","PB","BI","SC","TI","V","CR","MN","FE","CO","NI","CU","ZN","Y","ZR","NB","MO","TC","RU","RH","PD","AG","CD","LA","HF","TA","W","RE","OS","IR","PT","AU","HG","AC","RF","DB","SG","BH","HS","MT","CE","PR","ND","PM","SM","EU","GD","TB","DY","HO","ER","TM","YB","LU","TH","PA","U","NP","PU","AM","CM","BK","CF","ES","FM","MD","NO","LR"],t=new Set
for(const n of e)t.add(i[n])
return t}()
function l(e){const t=i[e]
return void 0===t?-1:t}function c(e){if(e<0)return 2.001
const t=o[e]
return void 0===t?2.001:t}function u(e,t,n,r){const i=function(e,t){if(e<0||t<0)return-1
const n=a[(r=e,i=t,r<i?(r+i)*(r+i+1)/2+i:(r+i)*(r+i+1)/2+r)]
var r,i
return void 0===n?-1:n}(e,t)
return i>0?i:t<0?n:(n+r)/1.95}const d=i.H
function p(e){return e===d}},8726(e,t,n){"use strict"
n.d(t,{T:()=>o})
var r=n(20610),i=n(91660)
function o(e,t){return(0,r.N)(function(n,r){var o=0
n.subscribe((0,i._)(r,function(n){r.next(e.call(t,n,o++))}))})}},8738(e,t,n){"use strict"
n.r(t),n.d(t,{buildSignalConfig:()=>s})
var r=n(44463),i=n(71223),o=n(55606)
const a=o.dirtyTag
function s(e){const t=e.wellknown.Array
return{createSignal:(e,n)=>n===t?[(0,r.tagForProperty)(e,n),(0,r.tagForProperty)(e,"length"),(0,r.tagForProperty)(e,"[]")]:(0,r.tagForProperty)(e,n),consumeSignal(e){if(Array.isArray(e))return(0,o.consumeTag)(e[0]),(0,o.consumeTag)(e[1]),void(0,o.consumeTag)(e[2]);(0,o.consumeTag)(e)},notifySignal(e){if(Array.isArray(e))return a(e[0]),a(e[1]),void a(e[2])
a(e)},createMemo:(e,t,n)=>{{const i=(0,r.tagForProperty)(e,t),a=(0,o.createCache)(n)
let s
const l=()=>{s=(0,o.getValue)(a)}
return()=>{const e=(0,o.track)(l)
return(0,o.updateTag)(i,e),(0,o.consumeTag)(e),s}}},willSyncFlushWatchers:()=>!!i._backburner.currentInstance&&!0!==i._backburner._autorun,waitFor:async e=>e}}},8881(e,t,n){"use strict"
n.d(t,{SK:()=>Se,co:()=>be,Pv:()=>xe})
var r=n(46357),i=n(19708),o=n(95916),a=n(9043),s=n(83164),l=n(36568),c=n(32775),u=n(92384),d=n(85362),p=n(54749),h=n(5638)
const f={edgeThresholdMin:u.t.Numeric(.0312,{min:.0312,max:.0833,step:1e-4},{description:"Trims the algorithm from processing darks."}),edgeThresholdMax:u.t.Numeric(.063,{min:.063,max:.333,step:.001},{description:"The minimum amount of local contrast required to apply algorithm."}),iterations:u.t.Numeric(12,{min:0,max:16,step:1},{description:"Number of edge exploration steps."}),subpixelQuality:u.t.Numeric(.3,{min:0,max:1,step:.01},{description:"Choose the amount of sub-pixel aliasing removal."})}
class m{constructor(e,t){this.webgl=e,this.renderable=function(e,t){const n=t.getWidth(),i=t.getHeight(),o={...r.OM,tColor:a.IQ.create(t),uTexSizeInv:a.IQ.create(c.ZY.create(1/n,1/i)),dEdgeThresholdMin:a.IQ.create(.0312),dEdgeThresholdMax:a.IQ.create(.125),dIterations:a.IQ.create(12),dSubpixelQuality:a.IQ.create(.3)},u={...g},d=(0,s.$h)(e,"triangles",y,u,o)
return(0,l._)(d,o)}(e,t)}updateState(e){const{gl:t,state:n}=this.webgl
n.enable(t.SCISSOR_TEST),n.disable(t.BLEND),n.disable(t.DEPTH_TEST),n.depthMask(!1)
const{x:r,y:i,width:o,height:a}=e
n.viewport(r,i,o,a),n.scissor(r,i,o,a),n.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT)}setSize(e,t){a.IQ.update(this.renderable.values.uTexSizeInv,c.ZY.set(this.renderable.values.uTexSizeInv.ref.value,1/e,1/t))}update(e,t){const{values:n}=this.renderable,{edgeThresholdMin:r,edgeThresholdMax:i,iterations:o,subpixelQuality:s}=t
let l=!1
n.tColor.ref.value!==e&&(a.IQ.update(this.renderable.values.tColor,e),l=!0),n.dEdgeThresholdMin.ref.value!==r&&(l=!0),a.IQ.updateIfChanged(n.dEdgeThresholdMin,r),n.dEdgeThresholdMax.ref.value!==i&&(l=!0),a.IQ.updateIfChanged(n.dEdgeThresholdMax,i),n.dIterations.ref.value!==o&&(l=!0),a.IQ.updateIfChanged(n.dIterations,o),n.dSubpixelQuality.ref.value!==s&&(l=!0),a.IQ.updateIfChanged(n.dSubpixelQuality,s),l&&this.renderable.update()}render(e,t){h.g$&&this.webgl.timer.mark("FxaaPass.render"),t?t.bind():this.webgl.bindDrawingBuffer(),this.updateState(e),this.renderable.render(),h.g$&&this.webgl.timer.markEnd("FxaaPass.render")}}const g={...r.du,tColor:(0,i.$G)("texture","rgba","ubyte","linear"),uTexSizeInv:(0,i.w5)("v2"),dEdgeThresholdMin:(0,i.$F)("number"),dEdgeThresholdMax:(0,i.$F)("number"),dIterations:(0,i.$F)("number"),dSubpixelQuality:(0,i.$F)("number")},y=(0,o.NG)("fxaa",d.e,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tColor;\nuniform vec2 uTexSizeInv;\n\n// adapted from https://github.com/kosua20/Rendu\n// MIT License Copyright (c) 2017 Simon Rodriguez\n\n#define QUALITY(q) ((q) < 5 ? 1.0 : ((q) > 5 ? ((q) < 10 ? 2.0 : ((q) < 11 ? 4.0 : 8.0)) : 1.5))\n\nfloat rgb2luma(vec3 rgb){\n    return sqrt(dot(rgb, vec3(0.299, 0.587, 0.114)));\n}\n\nfloat sampleLuma(vec2 uv) {\n    return rgb2luma(texture2D(tColor, uv).rgb);\n}\n\nfloat sampleLuma(vec2 uv, float uOffset, float vOffset) {\n    uv += uTexSizeInv * vec2(uOffset, vOffset);\n    return sampleLuma(uv);\n}\n\nvoid main(void) {\n    vec2 coords = gl_FragCoord.xy * uTexSizeInv;\n    vec2 inverseScreenSize = uTexSizeInv;\n\n    vec4 colorCenter = texture2D(tColor, coords);\n\n    // Luma at the current fragment\n    float lumaCenter = rgb2luma(colorCenter.rgb);\n\n    // Luma at the four direct neighbours of the current fragment.\n    float lumaDown = sampleLuma(coords, 0.0, -1.0);\n    float lumaUp = sampleLuma(coords, 0.0, 1.0);\n    float lumaLeft = sampleLuma(coords, -1.0, 0.0);\n    float lumaRight = sampleLuma(coords, 1.0, 0.0);\n\n    // Find the maximum and minimum luma around the current fragment.\n    float lumaMin = min(lumaCenter, min(min(lumaDown, lumaUp), min(lumaLeft, lumaRight)));\n    float lumaMax = max(lumaCenter, max(max(lumaDown, lumaUp), max(lumaLeft, lumaRight)));\n\n    // Compute the delta.\n    float lumaRange = lumaMax - lumaMin;\n\n    // If the luma variation is lower that a threshold (or if we are in a really dark area),\n    // we are not on an edge, don't perform any AA.\n    if (lumaRange < max(dEdgeThresholdMin, lumaMax * dEdgeThresholdMax)) {\n        gl_FragColor = colorCenter;\n        return;\n    }\n\n    // Query the 4 remaining corners lumas.\n    float lumaDownLeft = sampleLuma(coords, -1.0, -1.0);\n    float lumaUpRight = sampleLuma(coords, 1.0, 1.0);\n    float lumaUpLeft = sampleLuma(coords, -1.0, 1.0);\n    float lumaDownRight = sampleLuma(coords, 1.0, -1.0);\n\n    // Combine the four edges lumas (using intermediary variables for future computations\n    // with the same values).\n    float lumaDownUp = lumaDown + lumaUp;\n    float lumaLeftRight = lumaLeft + lumaRight;\n\n    // Same for corners\n    float lumaLeftCorners = lumaDownLeft + lumaUpLeft;\n    float lumaDownCorners = lumaDownLeft + lumaDownRight;\n    float lumaRightCorners = lumaDownRight + lumaUpRight;\n    float lumaUpCorners = lumaUpRight + lumaUpLeft;\n\n    // Compute an estimation of the gradient along the horizontal and vertical axis.\n    float edgeHorizontal = abs(-2.0 * lumaLeft + lumaLeftCorners) + abs(-2.0 * lumaCenter + lumaDownUp) * 2.0 + abs(-2.0 * lumaRight + lumaRightCorners);\n    float edgeVertical = abs(-2.0 * lumaUp + lumaUpCorners) + abs(-2.0 * lumaCenter + lumaLeftRight) * 2.0 + abs(-2.0 * lumaDown + lumaDownCorners);\n\n    // Is the local edge horizontal or vertical ?\n    bool isHorizontal = (edgeHorizontal >= edgeVertical);\n\n    // Choose the step size (one pixel) accordingly.\n    float stepLength = isHorizontal ? inverseScreenSize.y : inverseScreenSize.x;\n\n    // Select the two neighboring texels lumas in the opposite direction to the local edge.\n    float luma1 = isHorizontal ? lumaDown : lumaLeft;\n    float luma2 = isHorizontal ? lumaUp : lumaRight;\n    // Compute gradients in this direction.\n    float gradient1 = luma1 - lumaCenter;\n    float gradient2 = luma2 - lumaCenter;\n\n    // Which direction is the steepest ?\n    bool is1Steepest = abs(gradient1) >= abs(gradient2);\n\n    // Gradient in the corresponding direction, normalized.\n    float gradientScaled = 0.25 * max(abs(gradient1), abs(gradient2));\n\n    // Average luma in the correct direction.\n    float lumaLocalAverage = 0.0;\n    if(is1Steepest){\n        // Switch the direction\n        stepLength = -stepLength;\n        lumaLocalAverage = 0.5 * (luma1 + lumaCenter);\n    } else {\n        lumaLocalAverage = 0.5 * (luma2 + lumaCenter);\n    }\n\n    // Shift UV in the correct direction by half a pixel.\n    vec2 currentUv = coords;\n    if(isHorizontal){\n        currentUv.y += stepLength * 0.5;\n    } else {\n        currentUv.x += stepLength * 0.5;\n    }\n\n    // Compute offset (for each iteration step) in the right direction.\n    vec2 offset = isHorizontal ? vec2(inverseScreenSize.x, 0.0) : vec2(0.0, inverseScreenSize.y);\n    // Compute UVs to explore on each side of the edge, orthogonally.\n    // The QUALITY allows us to step faster.\n    vec2 uv1 = currentUv - offset * QUALITY(0);\n    vec2 uv2 = currentUv + offset * QUALITY(0);\n\n    // Read the lumas at both current extremities of the exploration segment,\n    // and compute the delta wrt to the local average luma.\n    float lumaEnd1 = sampleLuma(uv1);\n    float lumaEnd2 = sampleLuma(uv2);\n    lumaEnd1 -= lumaLocalAverage;\n    lumaEnd2 -= lumaLocalAverage;\n\n    // If the luma deltas at the current extremities is larger than the local gradient,\n    // we have reached the side of the edge.\n    bool reached1 = abs(lumaEnd1) >= gradientScaled;\n    bool reached2 = abs(lumaEnd2) >= gradientScaled;\n    bool reachedBoth = reached1 && reached2;\n\n    // If the side is not reached, we continue to explore in this direction.\n    if(!reached1){\n        uv1 -= offset * QUALITY(1);\n    }\n    if(!reached2){\n        uv2 += offset * QUALITY(1);\n    }\n\n    // If both sides have not been reached, continue to explore.\n    if(!reachedBoth){\n        for(int i = 2; i < dIterations; i++){\n            // If needed, read luma in 1st direction, compute delta.\n            if(!reached1){\n                lumaEnd1 = sampleLuma(uv1);\n                lumaEnd1 = lumaEnd1 - lumaLocalAverage;\n            }\n            // If needed, read luma in opposite direction, compute delta.\n            if(!reached2){\n                lumaEnd2 = sampleLuma(uv2);\n                lumaEnd2 = lumaEnd2 - lumaLocalAverage;\n            }\n            // If the luma deltas at the current extremities is larger than the local gradient,\n            // we have reached the side of the edge.\n            reached1 = abs(lumaEnd1) >= gradientScaled;\n            reached2 = abs(lumaEnd2) >= gradientScaled;\n            reachedBoth = reached1 && reached2;\n\n            // If the side is not reached, we continue to explore in this direction,\n            // with a variable quality.\n            if(!reached1){\n                uv1 -= offset * QUALITY(i);\n            }\n            if(!reached2){\n                uv2 += offset * QUALITY(i);\n            }\n\n            // If both sides have been reached, stop the exploration.\n            if(reachedBoth){\n                break;\n            }\n        }\n    }\n\n    // Compute the distances to each side edge of the edge (!).\n    float distance1 = isHorizontal ? (coords.x - uv1.x) : (coords.y - uv1.y);\n    float distance2 = isHorizontal ? (uv2.x - coords.x) : (uv2.y - coords.y);\n\n    // In which direction is the side of the edge closer ?\n    bool isDirection1 = distance1 < distance2;\n    float distanceFinal = min(distance1, distance2);\n\n    // Thickness of the edge.\n    float edgeThickness = (distance1 + distance2);\n\n    // Is the luma at center smaller than the local average ?\n    bool isLumaCenterSmaller = lumaCenter < lumaLocalAverage;\n\n    // If the luma at center is smaller than at its neighbour,\n    // the delta luma at each end should be positive (same variation).\n    bool correctVariation1 = (lumaEnd1 < 0.0) != isLumaCenterSmaller;\n    bool correctVariation2 = (lumaEnd2 < 0.0) != isLumaCenterSmaller;\n\n    // Only keep the result in the direction of the closer side of the edge.\n    bool correctVariation = isDirection1 ? correctVariation1 : correctVariation2;\n\n    // UV offset: read in the direction of the closest side of the edge.\n    float pixelOffset = - distanceFinal / edgeThickness + 0.5;\n\n    // If the luma variation is incorrect, do not offset.\n    float finalOffset = correctVariation ? pixelOffset : 0.0;\n\n    // Sub-pixel shifting\n    // Full weighted average of the luma over the 3x3 neighborhood.\n    float lumaAverage = (1.0 / 12.0) * (2.0 * (lumaDownUp + lumaLeftRight) + lumaLeftCorners + lumaRightCorners);\n    // Ratio of the delta between the global average and the center luma,\n    // over the luma range in the 3x3 neighborhood.\n    float subPixelOffset1 = clamp(abs(lumaAverage - lumaCenter) / lumaRange, 0.0, 1.0);\n    float subPixelOffset2 = (-2.0 * subPixelOffset1 + 3.0) * subPixelOffset1 * subPixelOffset1;\n    // Compute a sub-pixel offset based on this delta.\n    float subPixelOffsetFinal = subPixelOffset2 * subPixelOffset2 * float(dSubpixelQuality);\n\n    // Pick the biggest of the two offsets.\n    finalOffset = max(finalOffset, subPixelOffsetFinal);\n\n    // Compute the final UV coordinates.\n    vec2 finalUv = coords;\n    if(isHorizontal){\n        finalUv.y += finalOffset * stepLength;\n    } else {\n        finalUv.x += finalOffset * stepLength;\n    }\n\n    // Read the color at the new UV coordinates, and use it.\n    gl_FragColor = texture2D(tColor, finalUv);\n}\n")
var v=n(31683),b=n(66006)
const x={edgeThreshold:u.t.Numeric(.1,{min:.05,max:.15,step:.01}),maxSearchSteps:u.t.Numeric(16,{min:0,max:32,step:1})}
class S{get supported(){return this._supported}constructor(e,t){if(this.webgl=e,this._supported=!1,"undefined"==typeof HTMLImageElement)return void(h.Bb&&console.log('Missing "HTMLImageElement" required for "SMAA"'))
const n=t.getWidth(),i=t.getHeight()
this.edgesTarget=e.createRenderTarget(n,i,!1,"uint8","linear"),this.weightsTarget=e.createRenderTarget(n,i,!1,"uint8","linear"),this.edgesRenderable=function(e,t){const n=t.getWidth(),i=t.getHeight(),o={...r.OM,tColor:a.IQ.create(t),uTexSizeInv:a.IQ.create(c.ZY.create(1/n,1/i)),uViewport:a.IQ.create((0,c.Zb)()),dEdgeThreshold:a.IQ.create(.1)},u={..._},d=(0,s.$h)(e,"triangles",C,u,o)
return(0,l._)(d,o)}(e,t),this.weightsRenderable=function(e,t){const n=t.getWidth(),i=t.getHeight(),o=e.resources.texture("image-uint8","rgb","ubyte","linear"),u=e.resources.texture("image-uint8","rgba","ubyte","nearest"),d={...r.OM,tEdges:a.IQ.create(t),tArea:a.IQ.create(o),tSearch:a.IQ.create(u),uTexSizeInv:a.IQ.create(c.ZY.create(1/n,1/i)),uViewport:a.IQ.create((0,c.Zb)()),dMaxSearchSteps:a.IQ.create(16)};(0,v.pg)("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAIAAACOVPcQAACBeklEQVR42u39W4xlWXrnh/3WWvuciIzMrKxrV8/0rWbY0+SQFKcb4owIkSIFCjY9AC1BT/LYBozRi+EX+cV+8IMsYAaCwRcBwjzMiw2jAWtgwC8WR5Q8mDFHZLNHTarZGrLJJllt1W2qKrsumZWZcTvn7L3W54e1vrXX3vuciLPPORFR1XE2EomorB0nVuz//r71re/y/1eMvb4Cb3N11xV/PP/2v4UBAwJG/7H8urx6/25/Gf8O5hypMQ0EEEQwAqLfoN/Z+97f/SW+/NvcgQk4sGBJK6H7N4PFVL+K+e0N11yNfkKvwUdwdlUAXPHHL38oa15f/i/46Ih6SuMSPmLAYAwyRKn7dfMGH97jaMFBYCJUgotIC2YAdu+LyW9vvubxAP8kAL8H/koAuOKP3+q6+xGnd5kdYCeECnGIJViwGJMAkQKfDvB3WZxjLKGh8VSCCzhwEWBpMc5/kBbjawT4HnwJfhr+pPBIu7uu+OOTo9vsmtQcniMBGkKFd4jDWMSCRUpLjJYNJkM+IRzQ+PQvIeAMTrBS2LEiaiR9b/5PuT6Ap/AcfAFO4Y3dA3DFH7/VS+M8k4baEAQfMI4QfbVDDGIRg7GKaIY52qAjTAgTvGBAPGIIghOCYAUrGFNgzA7Q3QhgCwfwAnwe5vDejgG44o/fbm1C5ZlYQvQDARPAIQGxCWBM+wWl37ZQESb4gImexGMDouhGLx1Cst0Saa4b4AqO4Hk4gxo+3DHAV/nx27p3JziPM2pVgoiia5MdEzCGULprIN7gEEeQ5IQxEBBBQnxhsDb5auGmAAYcHMA9eAAz8PBol8/xij9+C4Djlim4gJjWcwZBhCBgMIIYxGAVIkH3ZtcBuLdtRFMWsPGoY9rN+HoBji9VBYdwD2ZQg4cnO7OSq/z4rU5KKdwVbFAjNojCQzTlCLPFSxtamwh2jMUcEgg2Wm/6XgErIBhBckQtGN3CzbVacERgCnfgLswhnvqf7QyAq/z4rRZm1YglYE3affGITaZsdIe2FmMIpnOCap25I6jt2kCwCW0D1uAD9sZctNGXcQIHCkINDQgc78aCr+zjtw3BU/ijdpw3zhCwcaONwBvdeS2YZKkJNJsMPf2JKEvC28RXxxI0ASJyzQCjCEQrO4Q7sFArEzjZhaFc4cdv+/JFdKULM4px0DfUBI2hIsy06BqLhGTQEVdbfAIZXYMPesq6VoCHICzUyjwInO4Y411//LYLs6TDa9wvg2CC2rElgAnpTBziThxaL22MYhzfkghz6GAs2VHbbdM91VZu1MEEpupMMwKyVTb5ij9+u4VJG/5EgEMMmFF01cFai3isRbKbzb+YaU/MQbAm2XSMoUPAmvZzbuKYRIFApbtlrfFuUGd6vq2hXNnH78ZLh/iFhsQG3T4D1ib7k5CC6vY0DCbtrohgLEIClXiGtl10zc0CnEGIhhatLBva7NP58Tvw0qE8yWhARLQ8h4+AhQSP+I4F5xoU+VilGRJs6wnS7ruti/4KvAY/CfdgqjsMy4pf8fodQO8/gnuX3f/3xi3om1/h7THr+co3x93PP9+FBUfbNUjcjEmhcrkT+8K7ml7V10Jo05mpIEFy1NmCJWx9SIKKt+EjAL4Ez8EBVOB6havuT/rByPvHXK+9zUcfcbb254+9fydJknYnRr1oGfdaiAgpxu1Rx/Rek8KISftx3L+DfsLWAANn8Hvw0/AFeAGO9DFV3c6D+CcWbL8Dj9e7f+T1k8AZv/d7+PXWM/Z+VvdCrIvuAKO09RpEEQJM0Ci6+B4xhTWr4cZNOvhktabw0ta0rSJmqz3Yw5/AKXwenod7cAhTmBSPKf6JBdvH8IP17h95pXqw50/+BFnj88fev4NchyaK47OPhhtI8RFSvAfDSNh0Ck0p2gLxGkib5NJj/JWCr90EWQJvwBzO4AHcgztwAFN1evHPUVGwfXON+0debT1YeGON9Yy9/63X+OguiwmhIhQhD7l4sMqlG3D86Suc3qWZ4rWjI1X7u0Ytw6x3rIMeIOPDprfe2XzNgyj6PahhBjO4C3e6puDgXrdg+/5l948vF3bqwZetZ+z9Rx9zdIY5pInPK4Nk0t+l52xdK2B45Qd87nM8fsD5EfUhIcJcERw4RdqqH7Yde5V7m1vhNmtedkz6EDzUMF/2jJYWbC+4fzzA/Y+/8PPH3j9dcBAPIRP8JLXd5BpAu03aziOL3VVHZzz3CXWDPWd+SH2AnxIqQoTZpo9Ckc6HIrFbAbzNmlcg8Ag8NFDDAhbJvTBZXbC94P7t68EXfv6o+21gUtPETU7bbkLxvNKRFG2+KXzvtObonPP4rBvsgmaKj404DlshFole1Glfh02fE7bYR7dZ82oTewIBGn1Md6CG6YUF26X376oevOLzx95vhUmgblI6LBZwTCDY7vMq0op5WVXgsObOXJ+1x3qaBl9j1FeLxbhU9w1F+Wiba6s1X/TBz1LnUfuYDi4r2C69f1f14BWfP+p+W2GFKuC9phcELMYRRLur9DEZTUdEH+iEqWdaM7X4WOoPGI+ZYD2+wcQ+y+ioHUZ9dTDbArzxmi/bJI9BND0Ynd6lBdve/butBw8+f/T9D3ABa3AG8W3VPX4hBin+bj8dMMmSpp5pg7fJ6xrBFE2WQQEWnV8Qg3FbAWzYfM1rREEnmvkN2o1+acG2d/9u68GDzx91v3mAjb1zkpqT21OipPKO0b9TO5W0nTdOmAQm0TObts3aBKgwARtoPDiCT0gHgwnbArzxmtcLc08HgF1asN0C4Ms/fvD5I+7PhfqyXE/b7RbbrGyRQRT9ARZcwAUmgdoz0ehJ9Fn7QAhUjhDAQSw0bV3T3WbNa59jzmiP6GsWbGXDX2ytjy8+f9T97fiBPq9YeLdBmyuizZHaqXITnXiMUEEVcJ7K4j3BFPurtB4bixW8wTpweL8DC95szWMOqucFYGsWbGU7p3TxxxefP+r+oTVktxY0v5hbq3KiOKYnY8ddJVSBxuMMVffNbxwIOERShst73HZ78DZrHpmJmH3K6sGz0fe3UUj0eyRrSCGTTc+rjVNoGzNSv05srAxUBh8IhqChiQgVNIIBH3AVPnrsnXQZbLTm8ammv8eVXn/vWpaTem5IXRlt+U/LA21zhSb9cye6jcOfCnOwhIAYXAMVTUNV0QhVha9xjgA27ODJbLbmitt3tRN80lqG6N/khgot4ZVlOyO4WNg3OIMzhIZQpUEHieg2im6F91hB3I2tubql6BYNN9Hj5S7G0G2tahslBWKDnOiIvuAEDzakDQKDNFQT6gbn8E2y4BBubM230YIpBnDbMa+y3dx0n1S0BtuG62lCCXwcY0F72T1VRR3t2ONcsmDjbmzNt9RFs2LO2hQNyb022JisaI8rAWuw4HI3FuAIhZdOGIcdjLJvvObqlpqvWTJnnQbyi/1M9O8UxWhBs//H42I0q1Yb/XPGONzcmm+ri172mHKvZBpHkJaNJz6v9jxqiklDj3U4CA2ugpAaYMWqNXsdXbmJNd9egCnJEsphXNM+MnK3m0FCJ5S1kmJpa3DgPVbnQnPGWIDspW9ozbcO4K/9LkfaQO2KHuqlfFXSbdNzcEcwoqNEFE9zcIXu9/6n/ym/BC/C3aJLzEKPuYVlbFnfhZ8kcWxV3dbv4bKl28566wD+8C53aw49lTABp9PWbsB+knfc/Li3eVizf5vv/xmvnPKg5ihwKEwlrcHqucuVcVOxEv8aH37E3ZqpZypUulrHEtIWKUr+txHg+ojZDGlwnqmkGlzcVi1dLiNSJiHjfbRNOPwKpx9TVdTn3K05DBx4psIk4Ei8aCkJahRgffk4YnEXe07T4H2RR1u27E6wfQsBDofUgjFUFnwC2AiVtA+05J2zpiDK2Oa0c5fmAecN1iJzmpqFZxqYBCYhFTCsUNEmUnIcZ6aEA5rQVhEywG6w7HSW02XfOoBlQmjwulOFQAg66SvJblrTEX1YtJ3uG15T/BH1OfOQeuR8g/c0gdpT5fx2SKbs9EfHTKdM8A1GaJRHLVIwhcGyydZsbifAFVKl5EMKNU2Hryo+06BeTgqnxzYjThVySDikbtJPieco75lYfKAJOMEZBTjoITuWHXXZVhcUDIS2hpiXHV9Ku4u44bN5OYLDOkJo8w+xJSMbhBRHEdEs9JZUCkQrPMAvaHyLkxgkEHxiNkx/x2YB0mGsQ8EUWj/stW5YLhtS5SMu+/YBbNPDCkGTUybN8krRLBGPlZkVOA0j+a1+rkyQKWGaPHPLZOkJhioQYnVZ2hS3zVxMtgC46KuRwbJNd9nV2PHgb36F194ecf/Yeu2vAFe5nm/bRBFrnY4BauE8ERmZRFUn0k8hbftiVYSKMEme2dJCJSCGYAlNqh87bXOPdUkGy24P6d1ll21MBqqx48Fvv8ZHH8HZFY7j/uAq1xMJUFqCSUlJPmNbIiNsmwuMs/q9CMtsZsFO6SprzCS1Z7QL8xCQClEelpjTduDMsmWD8S1PT152BtvmIGvUeDA/yRn83u/x0/4qxoPHjx+PXY9pqX9bgMvh/Nz9kpP4pOe1/fYf3axUiMdHLlPpZCNjgtNFAhcHEDxTumNONhHrBduW+vOyY++70WWnPXj98eA4kOt/mj/5E05l9+O4o8ePx67HFqyC+qSSnyselqjZGaVK2TadbFLPWAQ4NBhHqDCCV7OTpo34AlSSylPtIdd2AJZlyzYQrDJ5lcWGNceD80CunPLGGzsfD+7wRb95NevJI5docQ3tgCyr5bGnyaPRlmwNsFELViOOx9loebGNq2moDOKpHLVP5al2cymWHbkfzGXL7kfRl44H9wZy33tvt+PB/Xnf93e+nh5ZlU18wCiRUa9m7kib9LYuOk+hudQNbxwm0AQqbfloimaB2lM5fChex+ylMwuTbfmXQtmWlenZljbdXTLuOxjI/fDDHY4Hjx8/Hrse0zXfPFxbUN1kKqSCCSk50m0Ajtx3ub9XHBKHXESb8iO6E+qGytF4nO0OG3SXzbJlhxBnKtKyl0NwybjvYCD30aMdjgePHz8eu56SVTBbgxJMliQ3Oauwg0QHxXE2Ez/EIReLdQj42Gzb4CLS0YJD9xUx7bsi0vJi5mUbW1QzL0h0PFk17rtiIPfJk52MB48fPx67npJJwyrBa2RCCQRTbGZSPCxTPOiND4G2pYyOQ4h4jINIJh5wFU1NFZt+IsZ59LSnDqBjZ2awbOku+yInunLcd8VA7rNnOxkPHj9+PGY9B0MWJJNozOJmlglvDMXDEozdhQWbgs/U6oBanGzLrdSNNnZFjOkmbi5bNt1lX7JLLhn3vXAg9/h4y/Hg8ePHI9dzQMEkWCgdRfYykYKnkP7D4rIujsujaKPBsB54vE2TS00ccvFY/Tth7JXeq1hz+qgVy04sAJawTsvOknHfCwdyT062HA8eP348Zj0vdoXF4pilKa2BROed+9fyw9rWRXeTFXESMOanvDZfJuJaSXouQdMdDJZtekZcLLvEeK04d8m474UDuaenW44Hjx8/Xns9YYqZpszGWB3AN/4VHw+k7WSFtJ3Qicuqb/NlVmgXWsxh570xg2UwxUw3WfO6B5nOuO8aA7lnZxuPB48fPx6znm1i4bsfcbaptF3zNT78eFPtwi1OaCNOqp1x3zUGcs/PN++AGD1+fMXrSVm2baTtPhPahbPhA71wIHd2bXzRa69nG+3CraTtPivahV/55tXWg8fyRY/9AdsY8VbSdp8V7cKrrgdfM//z6ILQFtJ2nxHtwmuoB4/kf74+gLeRtvvMaBdeSz34+vifx0YG20jbfTa0C6+tHrwe//NmOG0L8EbSdp8R7cLrrQe/996O+ai3ujQOskpTNULa7jOjXXj99eCd8lHvoFiwsbTdZ0a78PrrwTvlo966pLuRtB2fFe3Cm6oHP9kNH/W2FryxtN1nTLvwRurBO+Kj3pWXHidtx2dFu/Bm68Fb81HvykuPlrb7LGkX3mw9eGs+6h1Y8MbSdjegXcguQLjmevDpTQLMxtJ2N6NdyBZu9AbrwVvwUW+LbteULUpCdqm0HTelXbhNPe8G68Gb8lFvVfYfSNuxvrTdTWoXbozAzdaDZzfkorOj1oxVxlIMlpSIlpLrt8D4hrQL17z+c3h6hU/wv4Q/utps4+bm+6P/hIcf0JwQ5oQGPBL0eKPTYEXTW+eL/2DKn73J9BTXYANG57hz1cEMviVf/4tf5b/6C5pTQkMIWoAq7hTpOJjtAM4pxKu5vg5vXeUrtI09/Mo/5H+4z+Mp5xULh7cEm2QbRP2tFIKR7WM3fPf/jZ3SWCqLM2l4NxID5zB72HQXv3jj/8mLR5xXNA5v8EbFQEz7PpRfl1+MB/hlAN65qgDn3wTgH13hK7T59bmP+NIx1SHHU84nLOITt3iVz8mNO+lPrjGAnBFqmioNn1mTyk1ta47R6d4MrX7tjrnjYUpdUbv2rVr6YpVfsGG58AG8Ah9eyUN8CX4WfgV+G8LVWPDGb+Zd4cU584CtqSbMKxauxTg+dyn/LkVgA+IR8KHtejeFKRtTmLLpxN6mYVLjYxwXf5x2VofiZcp/lwKk4wGOpYDnoIZPdg/AAbwMfx0+ge9dgZvYjuqKe4HnGnykYo5TvJbG0Vj12JagRhwKa44H95ShkZa5RyLGGdfYvG7aw1TsF6iapPAS29mNS3NmsTQZCmgTzFwgL3upCTgtBTRwvGMAKrgLn4evwin8+afJRcff+8izUGUM63GOOuAs3tJkw7J4kyoNreqrpO6cYLQeFUd7TTpr5YOTLc9RUUogUOVJQ1GYJaFLAW0oTmKyYS46ZooP4S4EON3xQ5zC8/CX4CnM4c1PE8ApexpoYuzqlP3d4S3OJP8ZDK7cKWNaTlqmgDiiHwl1YsE41w1zT4iRTm3DBqxvOUsbMKKDa/EHxagtnta072ejc3DOIh5ojvh8l3tk1JF/AV6FU6jh3U8HwEazLgdCLYSQ+MYiAI2ltomkzttUb0gGHdSUUgsIYjTzLG3mObX4FBRaYtpDVNZrih9TgTeYOBxsEnN1gOCTM8Bsw/ieMc75w9kuAT6A+/AiHGvN/+Gn4KRkiuzpNNDYhDGFndWRpE6SVfm8U5bxnSgVV2jrg6JCKmneqey8VMFgq2+AM/i4L4RUbfSi27lNXZ7R7W9RTcq/q9fk4Xw3AMQd4I5ifAZz8FcVtm9SAom/dyN4lczJQW/kC42ZrHgcCoIf1oVMKkVItmMBi9cOeNHGLqOZk+QqQmrbc5YmYgxELUUN35z2iohstgfLIFmcMV7s4CFmI74L9+EFmGsi+tGnAOD4Yk9gIpo01Y4cA43BWGygMdr4YZekG3OBIUXXNukvJS8tqa06e+lSDCtnqqMFu6hWHXCF+WaYt64m9QBmNxi7Ioy7D+fa1yHw+FMAcPt7SysFLtoG4PXAk7JOA3aAxBRqUiAdU9Yp5lK3HLSRFtOim0sa8euEt08xvKjYjzeJ2GU7YawexrnKI9tmobInjFXCewpwriY9+RR4aaezFhMhGCppKwom0ChrgFlKzyPKkGlTW1YQrE9HJqu8hKGgMc6hVi5QRq0PZxNfrYNgE64utmRv6KKHRpxf6VDUaOvNP5jCEx5q185My/7RKz69UQu2im5k4/eownpxZxNLwiZ1AZTO2ZjWjkU9uaB2HFn6Q3u0JcsSx/qV9hTEApRzeBLDJQXxYmTnq7bdLa3+uqFrxLJ5w1TehnNHx5ECvCh2g2c3hHH5YsfdaSKddztfjQ6imKFGSyFwlLzxEGPp6r5IevVjk1AMx3wMqi1NxDVjLBiPs9tbsCkIY5we5/ML22zrCScFxnNtzsr9Wcc3CnD+pYO+4VXXiDE0oc/vQQ/fDK3oPESJMYXNmJa/DuloJZkcTpcYE8lIH8Dz8DJMiynNC86Mb2lNaaqP/+L7f2fcE/yP7/Lde8xfgSOdMxvOixZf/9p3+M4hT1+F+zApxg9XfUvYjc8qX2lfOOpK2gNRtB4flpFu9FTKCp2XJRgXnX6olp1zyYjTKJSkGmLE2NjUr1bxFM4AeAAHBUFIeSLqXR+NvH/M9fOnfHzOD2vCSyQJKzfgsCh+yi/Mmc35F2fUrw7miW33W9hBD1vpuUojFphIyvg7aTeoymDkIkeW3XLHmguMzbIAJejN6B5MDrhipE2y6SoFRO/AK/AcHHZHNIfiWrEe/C6cr3f/yOvrQKB+zMM55/GQdLDsR+ifr5Fiuu+/y+M78LzOE5dsNuXC3PYvYWd8NXvphLSkJIasrlD2/HOqQ+RjcRdjKTGWYhhVUm4yxlyiGPuMsZR7sMCHUBeTuNWA7if+ifXgc/hovftHXs/DV+Fvwe+f8shzMiMcweFgBly3//vwJfg5AN4450fn1Hd1Rm1aBLu22Dy3y3H2+OqMemkbGZ4jozcDjJf6596xOLpC0eMTHbKnxLxH27uZ/bMTGs2jOaMOY4m87CfQwF0dw53oa1k80JRuz/XgS+8fX3N9Af4qPIMfzKgCp4H5TDGe9GGeFPzSsZz80SlPTxXjgwJmC45njzgt2vbQ4b4OAdUK4/vWhO8d8v6EE8fMUsfakXbPpFJeLs2ubM/qdm/la3WP91uWhxXHjoWhyRUq2iJ/+5mA73zwIIo+LoZ/SgvIRjAd1IMvvn98PfgOvAJfhhm8scAKVWDuaRaK8aQ9f7vuPDH6Bj47ZXau7rqYJ66mTDwEDU6lLbCjCK0qTXyl5mnDoeNRxanj3FJbaksTk0faXxHxLrssgPkWB9LnA/MFleXcJozzjwsUvUG0X/QCve51qkMDXp9mtcyOy3rwBfdvVJK7D6/ACSzg3RoruIq5UDeESfEmVclDxnniU82vxMLtceD0hGZWzBNPMM/jSPne2OVatiTKUpY5vY7gc0LdUAWeWM5tH+O2I66AOWw9xT2BuyRVLGdoDHUsVRXOo/c+ZdRXvFfnxWyIV4upFLCl9eAL7h8Zv0QH8Ry8pA2cHzQpGesctVA37ZtklBTgHjyvdSeKY/RZw/kJMk0Y25cSNRWSigQtlULPTw+kzuJPeYEkXjQRpoGZobYsLF79pyd1dMRHInbgFTZqNLhDqiIsTNpoex2WLcy0/X6rHcdMMQvFSd5dWA++4P7xv89deACnmr36uGlL69bRCL6BSZsS6c0TU2TKK5gtWCzgAOOwQcurqk9j8whvziZSMLcq5hbuwBEsYjopUBkqw1yYBGpLA97SRElEmx5MCInBY5vgLk94iKqSWmhIGmkJ4Bi9m4L645J68LyY4wsFYBfUg5feP/6gWWm58IEmKQM89hq7KsZNaKtP5TxxrUZZVkNmMJtjbKrGxLNEbHPJxhqy7lAmbC32ZqeF6lTaknRWcYaFpfLUBh/rwaQycCCJmW15Kstv6jRHyJFry2C1ahkkIW0LO75s61+owxK1y3XqweX9m5YLM2DPFeOjn/iiqCKJ+yKXF8t5Yl/kNsqaSCryxPq5xWTFIaP8KSW0RYxqupaUf0RcTNSSdJZGcKYdYA6kdtrtmyBckfKXwqk0pHpUHlwWaffjNRBYFPUDWa8e3Lt/o0R0CdisKDM89cX0pvRHEfM8ca4t0s2Xx4kgo91MPQJ/0c9MQYq0co8MBh7bz1fio0UUHLR4aAIOvOmoYO6kwlEVODSSTliWtOtH6sPkrtctF9ZtJ9GIerBskvhdVS5cFNv9s1BU0AbdUgdK4FG+dRnjFmDTzniRMdZO1QhzMK355vigbdkpz9P6qjUGE5J2qAcXmwJ20cZUiAD0z+pGMx6xkzJkmEf40Hr4qZfVg2XzF9YOyoV5BjzVkUJngKf8lgNYwKECEHrCNDrWZzMlflS3yBhr/InyoUgBc/lKT4pxVrrC6g1YwcceK3BmNxZcAtz3j5EIpqguh9H6wc011YN75cKDLpFDxuwkrPQmUwW4KTbj9mZTwBwLq4aQMUZbHm1rylJ46dzR0dua2n3RYCWZsiHROeywyJGR7mXKlpryyCiouY56sFkBWEnkEB/raeh/Sw4162KeuAxMQpEkzy5alMY5wamMsWKKrtW2WpEWNnReZWONKWjrdsKZarpFjqCslq773PLmEhM448Pc3+FKr1+94vv/rfw4tEcu+lKTBe4kZSdijBrykwv9vbCMPcLQTygBjzVckSLPRVGslqdunwJ4oegtFOYb4SwxNgWLCmD7T9kVjTv5YDgpo0XBmN34Z/rEHp0sgyz7lngsrm4lvMm2Mr1zNOJYJ5cuxuQxwMGJq/TP5emlb8fsQBZviK4t8hFL+zbhtlpwaRSxQRWfeETjuauPsdGxsBVdO7nmP4xvzSoT29pRl7kGqz+k26B3Oy0YNV+SXbbQas1ctC/GarskRdFpKczVAF1ZXnLcpaMuzVe6lZ2g/1ndcvOVgRG3sdUAY1bKD6achijMPdMxV4muKVorSpiDHituH7rSTs7n/4y5DhRXo4FVBN4vO/zbAcxhENzGbHCzU/98Mcx5e7a31kWjw9FCe/zNeYyQjZsWb1uc7U33pN4Mji6hCLhivqfa9Ss6xLg031AgfesA/l99m9fgvnaF9JoE6bYKmkGNK3aPbHB96w3+DnxFm4hs0drLsk7U8kf/N/CvwQNtllna0rjq61sH8L80HAuvwH1tvBy2ChqWSCaYTaGN19sTvlfzFD6n+iKTbvtayfrfe9ueWh6GJFoxLdr7V72a5ZpvHcCPDzma0wTO4EgbLyedxstO81n57LYBOBzyfsOhUKsW1J1BB5vr/tz8RyqOFylQP9Tvst2JALsC5lsH8PyQ40DV4ANzYa4dedNiKNR1s+x2wwbR7q4/4cTxqEk4LWDebfisuo36JXLiWFjOtLrlNWh3K1rRS4xvHcDNlFnNmWBBAl5SWaL3oPOfnvbr5pdjVnEaeBJSYjuLEkyLLsWhKccadmOphZkOPgVdalj2QpSmfOsADhMWE2ZBu4+EEJI4wKTAuCoC4xwQbWXBltpxbjkXJtKxxabo9e7tyhlgb6gNlSbUpMh+l/FaqzVwewGu8BW1Zx7pTpQDJUjb8tsUTW6+GDXbMn3mLbXlXJiGdggxFAoUrtPS3wE4Nk02UZG2OOzlk7fRs7i95QCLo3E0jtrjnM7SR3uS1p4qtS2nJ5OwtQVHgOvArLBFijZUV9QtSl8dAY5d0E0hM0w3HS2DpIeB6m/A1+HfhJcGUq4sOxH+x3f5+VO+Ds9rYNI7zPXOYWPrtf8bYMx6fuOAX5jzNR0PdsuON+X1f7EERxMJJoU6GkTEWBvVolVlb5lh3tKCg6Wx1IbaMDdJ+9sUCc5KC46hKGCk3IVOS4TCqdBNfUs7Kd4iXf2RjnT/LLysJy3XDcHLh/vde3x8DoGvwgsa67vBk91G5Pe/HbOe7xwym0NXbtiuuDkGO2IJDh9oQvJ4cY4vdoqLDuoH9Zl2F/ofsekn8lkuhIlhQcffUtSjytFyp++p6NiE7Rqx/lodgKVoceEp/CP4FfjrquZaTtj2AvH5K/ywpn7M34K/SsoYDAdIN448I1/0/wveW289T1/lX5xBzc8N5IaHr0XMOQdHsIkDuJFifj20pBm5jzwUv9e2FhwRsvhAbalCIuIw3bhJihY3p6nTFFIZgiSYjfTf3aXuOjmeGn4bPoGvwl+CFzTRczBIuHBEeImHc37/lGfwZR0cXzVDOvaKfNHvwe+suZ771K/y/XcBlsoN996JpBhoE2toYxOznNEOS5TJc6Id5GEXLjrWo+LEWGNpPDU4WAwsIRROu+1vM+0oW37z/MBN9kqHnSArwPfgFJ7Cq/Ai3Ie7g7ncmI09v8sjzw9mzOAEXoIHxURueaAce5V80f/DOuuZwHM8vsMb5wBzOFWM7wymTXPAEvm4vcFpZ2ut0VZRjkiP2MlmLd6DIpbGSiHOjdnUHN90hRYmhTnmvhzp1iKDNj+b7t5hi79lWGwQ+HN9RsfFMy0FXbEwhfuczKgCbyxYwBmcFhhvo/7a44v+i3XWcwDP86PzpGQYdWh7csP5dBvZ1jNzdxC8pBGuxqSW5vw40nBpj5JhMwvOzN0RWqERHMr4Lv1kWX84xLR830G3j6yqZ1a8UstTlW+qJPOZ+sZ7xZPKTJLhiNOAFd6tk+jrTH31ncLOxid8+nzRb128HhUcru/y0Wn6iT254YPC6FtVSIMoW2sk727AhvTtrWKZTvgsmckfXYZWeNRXx/3YQ2OUxLDrbHtN11IwrgXT6c8dATDwLniYwxzO4RzuQqTKSC5gAofMZ1QBK3zQ4JWobFbcvJm87FK+6JXrKahLn54m3p+McXzzYtP8VF/QpJuh1OwieElEoI1pRxPS09FBrkq2tWCU59+HdhNtTIqKm8EBrw2RTOEDpG3IKo2Y7mFdLm3ZeVjYwVw11o/oznceMve4CgMfNym/utA/d/ILMR7gpXzRy9eDsgLcgbs8O2Va1L0zzIdwGGemTBuwROHeoMShkUc7P+ISY3KH5ZZeWqO8mFTxQYeXTNuzvvK5FGPdQfuu00DwYFY9dyhctEt+OJDdnucfpmyhzUJzfsJjr29l8S0bXBfwRS9ZT26tmMIdZucch5ZboMz3Nio3nIOsYHCGoDT4kUA9MiXEp9Xsui1S8th/kbWIrMBxDGLodWUQIWcvnXy+9M23xPiSMOiRPqM+YMXkUN3gXFrZJwXGzUaMpJfyRS9ZT0lPe8TpScuRlbMHeUmlaKDoNuy62iWNTWNFYjoxFzuJs8oR+RhRx7O4SVNSXpa0ZJQ0K1LAHDQ+D9IepkMXpcsq5EVCvClBUIzDhDoyKwDw1Lc59GbTeORivugw1IcuaEOaGWdNm+Ps5fQ7/tm0DjMegq3yM3vb5j12qUId5UZD2oxDSEWOZMSqFl/W+5oynWDa/aI04tJRQ2eTXusg86SQVu/nwSYwpW6wLjlqIzwLuxGIvoAvul0PS+ZNz0/akp/pniO/8JDnGyaCkzbhl6YcqmK/69prxPqtpx2+Km9al9sjL+rwMgHw4jE/C8/HQ3m1vBuL1fldbzd8mOueVJ92syqdEY4KJjSCde3mcRw2TA6szxedn+zwhZMps0XrqEsiUjnC1hw0TELC2Ek7uAAdzcheXv1BYLagspxpzSAoZZUsIzIq35MnFQ9DOrlNB30jq3L4pkhccKUAA8/ocvN1Rzx9QyOtERs4CVsJRK/DF71kPYrxYsGsm6RMh4cps5g1DOmM54Ly1ii0Hd3Y/BMk8VWFgBVmhqrkJCPBHAolwZaWzLR9Vb7bcWdX9NyUYE+uB2BKfuaeBUcjDljbYVY4DdtsVWvzRZdWnyUzDpjNl1Du3aloAjVJTNDpcIOVVhrHFF66lLfJL1zJr9PQ2nFJSBaKoDe+sAvLufZVHVzYh7W0h/c6AAZ+7Tvj6q9j68G/cTCS/3n1vLKHZwNi+P+pS0WkZNMBMUl+LDLuiE4omZy71r3UFMwNJV+VJ/GC5ixVUkBStsT4gGKh0Gm4Oy3qvq7Lbmq24nPdDuDR9deR11XzP4vFu3TYzfnIyiSVmgizUYGqkIXNdKTY9pgb9D2Ix5t0+NHkVzCdU03suWkkVZAoCONCn0T35gAeW38de43mf97sMOpSvj4aa1KYUm58USI7Wxxes03bAZdRzk6UtbzMaCQ6IxO0dy7X+XsjoD16hpsBeGz9dfzHj+R/Hp8nCxZRqkEDTaCKCSywjiaoMJ1TITE9eg7Jqnq8HL6gDwiZb0u0V0Rr/rmvqjxKuaLCX7ZWXTvAY+uvm3z8CP7nzVpngqrJpZKwWnCUjIviYVlirlGOzPLI3SMVyp/elvBUjjDkNhrtufFFErQ8pmdSlbK16toBHlt/HV8uHMX/vEGALkV3RJREiSlopxwdMXOZPLZ+ix+kAHpMKIk8UtE1ygtquttwxNhphrIZ1IBzjGF3IIGxGcBj6q8bHJBG8T9vdsoWrTFEuebEZuVxhhClH6P5Zo89OG9fwHNjtNQTpD0TG9PJLEYqvEY6Rlxy+ZZGfL0Aj62/bnQCXp//eeM4KzfQVJbgMQbUjlMFIm6TpcfWlZje7NBSV6IsEVmumWIbjiloUzQX9OzYdo8L1wjw2PrrpimONfmfNyzKklrgnEkSzT5QWYQW40YShyzqsRmMXbvVxKtGuYyMKaU1ugenLDm5Ily4iT14fP11Mx+xJv+zZ3MvnfdFqxU3a1W/FTB4m3Qfsyc1XUcdVhDeUDZXSFHHLQj/Y5jtC7ZqM0CXGwB4bP11i3LhOvzPGygYtiUBiwQV/4wFO0majijGsafHyRLu0yG6q35cL1rOpVxr2s5cM2jJYMCdc10Aj6q/blRpWJ//+dmm5psMl0KA2+AFRx9jMe2WbC4jQxnikd4DU8TwUjRVacgdlhmr3bpddzuJ9zXqr2xnxJfzP29RexdtjDVZqzkqa6PyvcojGrfkXiJ8SEtml/nYskicv0ivlxbqjemwUjMw5evdg8fUX9nOiC/lf94Q2i7MURk9nW1MSj5j8eAyV6y5CN2S6qbnw3vdA1Iwq+XOSCl663udN3IzLnrt+us25cI1+Z83SXQUldqQq0b5XOT17bGpLd6ssN1VMPf8c+jG8L3NeCnMdF+Ra3fRa9dft39/LuZ/3vwHoHrqGmQFafmiQw6eyzMxS05K4bL9uA+SKUQzCnSDkqOGokXyJvbgJ/BHI+qvY69//4rl20NsmK2ou2dTsyIALv/91/8n3P2Aao71WFGi8KKv1fRC5+J67Q/507/E/SOshqN5TsmYIjVt+kcjAx98iz/4SaojbIV1rexE7/C29HcYD/DX4a0rBOF5VTu7omsb11L/AWcVlcVZHSsqGuXLLp9ha8I//w3Mv+T4Ew7nTBsmgapoCrNFObIcN4pf/Ob/mrvHTGqqgAupL8qWjWPS9m/31jAe4DjA+4+uCoQoT/zOzlrNd3qd4SdphFxsUvYwGWbTWtISc3wNOWH+kHBMfc6kpmpwPgHWwqaSUG2ZWWheYOGQGaHB+eQ/kn6b3pOgLV+ODSn94wDvr8Bvb70/LLuiPPEr8OGVWfDmr45PZyccEmsVXZGe1pRNX9SU5+AVQkNTIVPCHF/jGmyDC9j4R9LfWcQvfiETmgMMUCMN1uNCakkweZsowdYobiMSlnKA93u7NzTXlSfe+SVbfnPQXmg9LpYAQxpwEtONyEyaueWM4FPjjyjG3uOaFmBTWDNgBXGEiQpsaWhnAqIijB07Dlsy3fUGeP989xbWkyf+FF2SNEtT1E0f4DYYVlxFlbaSMPIRMk/3iMU5pME2SIWJvjckciebkQuIRRyhUvkHg/iUljG5kzVog5hV7vIlCuBrmlhvgPfNHQM8lCf+FEGsYbMIBC0qC9a0uuy2wLXVbLBaP5kjHokCRxapkQyzI4QEcwgYHRZBp+XEFTqXFuNVzMtjXLJgX4gAid24Hjwc4N3dtVSe+NNiwTrzH4WVUOlDobUqr1FuAgYllc8pmzoVrELRHSIW8ViPxNy4xwjBpyR55I6J220qQTZYR4guvUICJiSpr9gFFle4RcF/OMB7BRiX8sSfhpNSO3lvEZCQfLUVTKT78Ek1LRLhWN+yLyTnp8qWUZ46b6vxdRGXfHVqx3eI75YaLa4iNNiK4NOW7wPW6lhbSOF9/M9qw8e/aoB3d156qTzxp8pXx5BKAsYSTOIIiPkp68GmTq7sZtvyzBQaRLNxIZ+paozHWoLFeExIhRBrWitHCAHrCF7/thhD8JhYz84wg93QRV88wLuLY8zF8sQ36qF1J455bOlgnELfshKVxYOXKVuKx0jaj22sczTQqPqtV/XDgpswmGTWWMSDw3ssyUunLLrVPGjYRsH5ggHeHSWiV8kT33ycFSfMgkoOK8apCye0J6VW6GOYvffgU9RWsukEi2kUV2nl4dOYUzRik9p7bcA4ggdJ53LxKcEe17B1R8eqAd7dOepV8sTXf5lhejoL85hUdhDdknPtKHFhljOT+bdq0hxbm35p2nc8+Ja1Iw+tJykgp0EWuAAZYwMVwac5KzYMslhvgHdHRrxKnvhTYcfKsxTxtTETkjHO7rr3zjoV25lAQHrqpV7bTiy2aXMmUhTBnKS91jhtR3GEoF0oLnWhWNnYgtcc4N0FxlcgT7yz3TgNIKkscx9jtV1ZKpWW+Ub1tc1eOv5ucdgpx+FJy9pgbLE7xDyXb/f+hLHVGeitHOi6A7ybo3sF8sS7w7cgdk0nJaOn3hLj3uyD0Zp5pazFIUXUpuTTU18d1EPkDoX8SkmWTnVIozEdbTcZjoqxhNHf1JrSS/AcvHjZ/SMHhL/7i5z+POsTUh/8BvNfYMTA8n+yU/MlTZxSJDRStqvEuLQKWwDctMTQogUDyQRoTQG5Kc6oQRE1yV1jCA7ri7jdZyK0sYTRjCR0Hnnd+y7nHxNgTULqw+8wj0mQKxpYvhjm9uSUxg+TTy7s2GtLUGcywhXSKZN275GsqlclX90J6bRI1aouxmgL7Q0Nen5ziM80SqMIo8cSOo+8XplT/5DHNWsSUr/6lLN/QQ3rDyzLruEW5enpf7KqZoShEduuSFOV7DLX7Ye+GmXb6/hnNNqKsVXuMDFpb9Y9eH3C6NGEzuOuI3gpMH/I6e+zDiH1fXi15t3vA1czsLws0TGEtmPEJdiiFPwlwKbgLHAFk4P6ZyPdymYYHGE0dutsChQBl2JcBFlrEkY/N5bQeXQ18gjunuMfMfsBlxJSx3niO485fwO4fGD5T/+3fPQqkneWVdwnw/3bMPkW9Wbqg+iC765Zk+xcT98ibKZc2EdgHcLoF8cSOo/Oc8fS+OyEULF4g4sJqXVcmfMfsc7A8v1/yfGXmL9I6Fn5pRwZhsPv0TxFNlAfZCvG+Oohi82UC5f/2IsJo0cTOm9YrDoKhFPEUr/LBYTUNht9zelHXDqwfPCIw4owp3mOcIQcLttWXFe3VZ/j5H3cIc0G6oPbCR+6Y2xF2EC5cGUm6wKC5tGEzhsWqw5hNidUiKX5gFWE1GXh4/Qplw4sVzOmx9QxU78g3EF6wnZlEN4FzJ1QPSLEZz1KfXC7vd8ssGdIbNUYpVx4UapyFUHzJoTOo1McSkeNn1M5MDQfs4qQuhhX5vQZFw8suwWTcyYTgioISk2YdmkhehG4PkE7w51inyAGGaU+uCXADabGzJR1fn3lwkty0asIo8cROm9Vy1g0yDxxtPvHDAmpu+PKnM8Ix1wwsGw91YJqhteaWgjYBmmQiebmSpwKKzE19hx7jkzSWOm66oPbzZ8Yj6kxVSpYjVAuvLzYMCRo3oTQecOOjjgi3NQ4l9K5/hOGhNTdcWVOTrlgYNkEXINbpCkBRyqhp+LdRB3g0OU6rMfW2HPCFFMV9nSp+uB2woepdbLBuJQyaw/ZFysXrlXwHxI0b0LovEkiOpXGA1Ijagf+KUNC6rKNa9bQnLFqYNkEnMc1uJrg2u64ELPBHpkgWbmwKpJoDhMwNbbGzAp7Yg31wS2T5rGtzit59PrKhesWG550CZpHEzpv2NGRaxlNjbMqpmEIzygJqQfjypycs2pg2cS2RY9r8HUqkqdEgKTWtWTKoRvOBPDYBltja2SO0RGjy9UHtxwRjA11ujbKF+ti5cIR9eCnxUg6owidtyoU5tK4NLji5Q3HCtiyF2IqLGYsHViOXTXOYxucDqG0HyttqYAKqYo3KTY1ekyDXRAm2AWh9JmsVh/ccg9WJ2E8YjG201sPq5ULxxX8n3XLXuMInbft2mk80rRGjCGctJ8/GFdmEQ9Ug4FlE1ll1Y7jtiraqm5Fe04VV8lvSVBL8hiPrfFVd8+7QH3Qbu2ipTVi8cvSGivc9cj8yvH11YMHdNSERtuOslM97feYFOPKzGcsI4zW0YGAbTAOaxCnxdfiYUmVWslxiIblCeAYr9VYR1gM7GmoPrilunSxxeT3DN/2eBQ9H11+nk1adn6VK71+5+Jfct4/el10/7KBZfNryUunWSCPxPECk1rdOv1WVSrQmpC+Tl46YD3ikQYcpunSQgzVB2VHFhxHVGKDgMEY5GLlQnP7FMDzw7IacAWnO6sBr12u+XanW2AO0wQ8pknnFhsL7KYIqhkEPmEXFkwaN5KQphbkUmG72wgw7WSm9RiL9QT925hkjiVIIhphFS9HKI6/8QAjlpXqg9W2C0apyaVDwKQwrwLY3j6ADR13ZyUNByQXHQu6RY09Hu6zMqXRaNZGS/KEJs0cJEe9VH1QdvBSJv9h09eiRmy0V2uJcqHcShcdvbSNg5fxkenkVprXM9rDVnX24/y9MVtncvbKY706anNl3ASll9a43UiacVquXGhvq4s2FP62NGKfQLIQYu9q1WmdMfmUrDGt8eDS0cXozH/fjmUH6Jruvm50hBDSaEU/2Ru2LEN/dl006TSc/g7tfJERxGMsgDUEr104pfWH9lQaN+M4KWQjwZbVc2rZVNHsyHal23wZtIs2JJqtIc/WLXXRFCpJkfE9jvWlfFbsNQ9pP5ZBS0zKh4R0aMFj1IjTcTnvi0Zz2rt7NdvQb2mgbju1plsH8MmbnEk7KbK0b+wC2iy3aX3szW8xeZvDwET6hWZYwqTXSSG+wMETKum0Dq/q+x62gt2ua2ppAo309TRk9TPazfV3qL9H8z7uhGqGqxNVg/FKx0HBl9OVUORn8Q8Jx9gFttGQUDr3tzcXX9xGgN0EpzN9mdZ3GATtPhL+CjxFDmkeEU6x56kqZRusLzALXVqkCN7zMEcqwjmywDQ6OhyUe0Xao1Qpyncrg6wKp9XfWDsaZplElvQ/b3sdweeghorwBDlHzgk1JmMc/wiERICVy2VJFdMjFuLQSp3S0W3+sngt2njwNgLssFGVQdJ0tu0KH4ky1LW4yrbkuaA6Iy9oz/qEMMXMMDWyIHhsAyFZc2peV9hc7kiKvfULxCl9iddfRK1f8kk9qvbdOoBtOg7ZkOZ5MsGrSHsokgLXUp9y88smniwWyuFSIRVmjplga3yD8Uij5QS1ZiM4U3Qw5QlSm2bXjFe6jzzBFtpg+/YBbLAWG7OPynNjlCw65fukGNdkJRf7yM1fOxVzbxOJVocFoYIaGwH22mIQkrvu1E2nGuebxIgW9U9TSiukPGU+Lt++c3DJPKhyhEEbXCQLUpae2exiKy6tMPe9mDRBFCEMTWrtwxN8qvuGnt6MoihKWS5NSyBhbH8StXoAz8PLOrRgLtOT/+4vcu+7vDLnqNvztOq7fmd8sMmY9Xzn1zj8Dq8+XVdu2Nv0IIySgEdQo3xVHps3Q5i3fLFsV4aiqzAiBhbgMDEd1uh8qZZ+lwhjkgokkOIv4xNJmyncdfUUzgB4oFMBtiu71Xumpz/P+cfUP+SlwFExwWW62r7b+LSPxqxn/gvMZ5z9C16t15UbNlq+jbGJtco7p8wbYlL4alSyfWdeuu0j7JA3JFNuVAwtst7F7FhWBbPFNKIUORndWtLraFLmMu7KFVDDOzqkeaiN33YAW/r76wR4XDN/yN1z7hejPau06EddkS/6XThfcz1fI/4K736fO48vlxt2PXJYFaeUkFS8U15XE3428xdtn2kc8GQlf1vkIaNRRnOMvLTWrZbElEHeLWi1o0dlKPAh1MVgbbVquPJ5+Cr8LU5/H/+I2QlHIU2ClXM9G8v7Rr7oc/hozfUUgsPnb3D+I+7WF8kNO92GY0SNvuxiE+2Bt8prVJTkzE64sfOstxuwfxUUoyk8VjcTlsqe2qITSFoSj6Epd4KsT6BZOWmtgE3hBfir8IzZDwgV4ZTZvD8VvPHERo8v+vL1DASHTz/i9OlKueHDjK5Rnx/JB1Vb1ioXdBra16dmt7dgik10yA/FwJSVY6XjA3oy4SqM2frqDPPSRMex9qs3XQtoWxMj7/Er8GWYsXgjaVz4OYumP2+9kbxvny/6kvWsEBw+fcb5bInc8APdhpOSs01tEqIkoiZjbAqKMruLbJYddHuHFRIyJcbdEdbl2sVLaySygunutBg96Y2/JjKRCdyHV+AEFtTvIpbKIXOamknYSiB6KV/0JetZITgcjjk5ZdaskBtWO86UF0ap6ozGXJk2WNiRUlCPFir66lzdm/SLSuK7EUdPz8f1z29Skq6F1fXg8+5UVR6bszncP4Tn4KUkkdJ8UFCY1zR1i8RmL/qQL3rlei4THG7OODlnKko4oI01kd3CaM08Ia18kC3GNoVaO9iDh+hWxSyTXFABXoau7Q6q9OxYg/OVEMw6jdbtSrJ9cBcewGmaZmg+bvkUnUUaGr+ZfnMH45Ivevl61hMcXsxYLFTu1hTm2zViCp7u0o5l+2PSUh9bDj6FgYypufBDhqK2+oXkiuHFHR3zfj+9PtA8oR0xnqX8qn+sx3bFODSbbF0X8EUvWQ8jBIcjo5bRmLOljDNtcqNtOe756h3l0VhKa9hDd2l1eqmsnh0MNMT/Cqnx6BInumhLT8luljzQ53RiJeA/0dxe5NK0o2fA1+GLXr6eNQWHNUOJssQaTRlGpLHKL9fD+IrQzTOMZS9fNQD4AnRNVxvTdjC+fJdcDDWQcyB00B0t9BDwTxXgaAfzDZ/DBXzRnfWMFRwuNqocOmX6OKNkY63h5n/fFcB28McVHqnXZVI27K0i4rDLNE9lDKV/rT+udVbD8dFFu2GGZ8mOt0kAXcoX3ZkIWVtw+MNf5NjR2FbivROHmhV1/pj2egv/fMGIOWTIWrV3Av8N9imV9IWml36H6cUjqEWNv9aNc+veb2sH46PRaHSuMBxvtW+twxctq0z+QsHhux8Q7rCY4Ct8lqsx7c6Sy0dl5T89rIeEuZKoVctIk1hNpfavER6yyH1Vvm3MbsUHy4ab4hWr/OZPcsRBphnaV65/ZcdYPNNwsjN/djlf9NqCw9U5ExCPcdhKxUgLSmfROpLp4WSUr8ojdwbncbvCf+a/YzRaEc6QOvXcGO256TXc5Lab9POvB+AWY7PigWYjzhifbovuunzRawsO24ZqQQAqguBtmpmPB7ysXJfyDDaV/aPGillgz1MdQg4u5MYaEtBNNHFjkRlSpd65lp4hd2AVPTfbV7FGpyIOfmNc/XVsPfg7vzaS/3nkvLL593ANLvMuRMGpQIhiF7kUEW9QDpAUbTWYBcbp4WpacHHY1aacqQyjGZS9HI3yCBT9kUZJhVOD+zUDvEH9ddR11fzPcTDQ5TlgB0KwqdXSavk9BC0pKp0WmcuowSw07VXmXC5guzSa4p0UvRw2lbDiYUx0ExJJRzWzi6Gm8cnEkfXXsdcG/M/jAJa0+bmCgdmQ9CYlNlSYZOKixmRsgiFxkrmW4l3KdFKv1DM8tk6WxPYJZhUUzcd8Kdtgrw/gkfXXDT7+avmfVak32qhtkg6NVdUS5wgkru1YzIkSduTW1FDwVWV3JQVJVuieTc0y4iDpFwc7/BvSalvKdQM8sv662cevz/+8sQVnjVAT0W2wLllw1JiMhJRxgDjCjLQsOzSFSgZqx7lAW1JW0e03yAD3asC+GD3NbQhbe+mN5GXH1F83KDOM4n/e5JIuH4NpdQARrFPBVptUNcjj4cVMcFSRTE2NpR1LEYbYMmfWpXgP9KejaPsLUhuvLCsVXznAG9dfx9SR1ud/3hZdCLHb1GMdPqRJgqDmm76mHbvOXDtiO2QPUcKo/TWkQ0i2JFXpBoo7vij1i1Lp3ADAo+qvG3V0rM//vFnnTE4hxd5Ka/Cor5YEdsLVJyKtDgVoHgtW11pWSjolPNMnrlrVj9Fv2Qn60twMwKPqr+N/wvr8z5tZcDsDrv06tkqyzESM85Ycv6XBWA2birlNCXrI6VbD2lx2L0vQO0QVTVVLH4SE67fgsfVXv8n7sz7/85Z7cMtbE6f088wSaR4kCkCm10s6pKbJhfqiUNGLq+0gLWC6eUAZFPnLjwqtKd8EwGvWX59t7iPW4X/eAN1svgRVSY990YZg06BD1ohLMtyFTI4pKTJsS9xREq9EOaPWiO2gpms7397x6nQJkbh+Fz2q/rqRROX6/M8bJrqlVW4l6JEptKeUFuMYUbtCQ7CIttpGc6MY93x1r1vgAnRXvY5cvwWPqb9uWQm+lP95QxdNMeWhOq1x0Db55C7GcUv2ZUuN6n8iKzsvOxibC//Yfs9Na8r2Rlz02vXXDT57FP/zJi66/EJSmsJKa8QxnoqW3VLQ+jZVUtJwJ8PNX1NQCwfNgdhhHD9on7PdRdrdGPF28rJr1F+3LBdeyv+8yYfLoMYet1vX4upNAjVvwOUWnlNXJXlkzk5Il6kqeoiL0C07qno+/CYBXq/+utlnsz7/Mzvy0tmI4zm4ag23PRN3t/CWryoUVJGm+5+K8RJ0V8Hc88/XHUX/HfiAq7t+BH+x6v8t438enWmdJwFA6ZINriLGKv/95f8lT9/FnyA1NMVEvQyaXuu+gz36f/DD73E4pwqpLcvm/o0Vle78n//+L/NPvoefp1pTJye6e4A/D082FERa5/opeH9zpvh13cNm19/4v/LDe5xMWTi8I0Ta0qKlK27AS/v3/r+/x/2GO9K2c7kVMonDpq7//jc5PKCxeNPpFVzaRr01wF8C4Pu76hXuX18H4LduTr79guuFD3n5BHfI+ZRFhY8w29TYhbbLi/bvBdqKE4fUgg1pBKnV3FEaCWOWyA+m3WpORZr/j+9TKJtW8yBTF2/ZEODI9/QavHkVdGFp/Pjn4Q+u5hXapsP5sOH+OXXA1LiKuqJxiMNbhTkbdJTCy4llEt6NnqRT4dhg1V3nbdrm6dYMecA1yTOL4PWTE9L5VzPFlLBCvlG58AhehnN4uHsAYinyJ+AZ/NkVvELbfOBUuOO5syBIEtiqHU1k9XeISX5bsimrkUUhnGDxourN8SgUsCZVtKyGbyGzHXdjOhsAvOAswSRyIBddRdEZWP6GZhNK/yjwew9ehBo+3jEADu7Ay2n8mDc+TS7awUHg0OMzR0LABhqLD4hJEh/BEGyBdGlSJoXYXtr+3HS4ijzVpgi0paWXtdruGTknXBz+11qT1Q2inxaTzQCO46P3lfLpyS4fou2PH/PupwZgCxNhGlj4IvUuWEsTkqMWm6i4xCSMc9N1RDQoCVcuGItJ/MRWefais+3synowi/dESgJjkilnWnBTGvRWmaw8oR15257t7CHmCf8HOn7cwI8+NQBXMBEmAa8PMRemrNCEhLGEhDQKcGZWS319BX9PFBEwGTbRBhLbDcaV3drFcDqk5kCTd2JF1Wp0HraqBx8U0wwBTnbpCadwBA/gTH/CDrcCs93LV8E0YlmmcyQRQnjBa8JESmGUfIjK/7fkaDJpmD2QptFNVJU1bbtIAjjWQizepOKptRjbzR9Kag6xZmMLLjHOtcLT3Tx9o/0EcTT1XN3E45u24AiwEypDJXihKjQxjLprEwcmRKclaDNZCVqr/V8mYWyFADbusiY5hvgFoU2vio49RgJLn5OsReRFN6tabeetiiy0V7KFHT3HyZLx491u95sn4K1QQSPKM9hNT0wMVvAWbzDSVdrKw4zRjZMyJIHkfq1VAVCDl/bUhNKlGq0zGr05+YAceXVPCttVk0oqjVwMPt+BBefx4yPtGVkUsqY3CHDPiCM5ngupUwCdbkpd8kbPrCWHhkmtIKLEetF2499eS1jZlIPGYnlcPXeM2KD9vLS0bW3ktYNqUllpKLn5ZrsxlIzxvDu5eHxzGLctkZLEY4PgSOg2IUVVcUONzUDBEpRaMoXNmUc0tFZrTZquiLyKxrSm3DvIW9Fil+AkhXu5PhEPx9mUNwqypDvZWdKlhIJQY7vn2OsnmBeOWnYZ0m1iwbbw1U60by5om47iHRV6fOgzjMf/DAZrlP40Z7syxpLK0lJ0gqaAK1c2KQKu7tabTXkLFz0sCftuwX++MyNeNn68k5Buq23YQhUh0SNTJa1ioQ0p4nUG2y0XilF1JqODqdImloPS4Bp111DEWT0jJjVv95uX9BBV7eB3bUWcu0acSVM23YZdd8R8UbQUxJ9wdu3oMuhdt929ME+mh6JXJ8di2RxbTi6TbrDquqV4aUKR2iwT6aZbyOwEXN3DUsWr8Hn4EhwNyHuXHh7/pdaUjtR7vnDh/d8c9xD/s5f501eQ1+CuDiCvGhk1AN/4Tf74RfxPwD3toLarR0zNtsnPzmS64KIRk861dMWCU8ArasG9T9H0ZBpsDGnjtAOM2+/LuIb2iIUGXNgl5ZmKD/Tw8TlaAuihaFP5yrw18v4x1898zIdP+DDAX1bM3GAMvPgRP/cJn3zCW013nrhHkrITyvYuwOUkcHuKlRSW5C6rzIdY4ppnF7J8aAJbQepgbJYBjCY9usGXDKQxq7RZfh9eg5d1UHMVATRaD/4BHK93/1iAgYZ/+jqPn8Dn4UExmWrpa3+ZOK6MvM3bjwfzxNWA2dhs8+51XHSPJiaAhGSpWevEs5xHLXcEGFXYiCONySH3fPWq93JIsBiSWvWyc3CAN+EcXoT7rCSANloPPoa31rt/5PUA/gp8Q/jDD3hyrjzlR8VkanfOvB1XPubt17vzxAfdSVbD1pzAnfgyF3ycadOTOTXhpEUoLC1HZyNGW3dtmjeXgr2r56JNmRwdNNWaQVBddd6rh4MhviEB9EFRD/7RGvePvCbwAL4Mx/D6M541hHO4D3e7g6PafdcZVw689z7NGTwo5om7A8sPhccT6qKcl9NJl9aM/9kX+e59Hh1yPqGuCCZxuITcsmNaJ5F7d0q6J3H48TO1/+M57085q2icdu2U+W36Ldllz9Agiv4YGljoEN908EzvDOrBF98/vtJwCC/BF2AG75xxEmjmMIcjxbjoaxqOK3/4hPOZzhMPBpYPG44CM0dTVm1LjLtUWWVz1Bcf8tEx0zs8O2A2YVHRxKYOiy/aOVoAaMu0i7ubu43njjmd4ibMHU1sIDHaQNKrZND/FZYdk54oCXetjq7E7IVl9eAL7t+oHnwXXtLx44czzoRFHBztYVwtH1d+NOMkupZ5MTM+gUmq90X+Bh9zjRlmaQ+m7YMqUL/veemcecAtOJ0yq1JnVlN27di2E0+Klp1tAJ4KRw1eMI7aJjsO3R8kPSI3fUFXnIOfdQe86sIIVtWDL7h//Ok6vj8vwDk08NEcI8zz7OhBy+WwalzZeZ4+0XniRfst9pAJqQHDGLzVQ2pheZnnv1OWhwO43/AgcvAEXEVVpa4db9sGvNK8wjaENHkfFQ4Ci5i7dqnQlPoLQrHXZDvO3BIXZbJOBrOaEbML6sFL798I4FhKihjHMsPjBUZYCMFr6nvaArxqXPn4lCa+cHfSa2cP27g3Z3ziYTRrcbQNGLQmGF3F3cBdzzzX7AILx0IB9rbwn9kx2G1FW3Inic+ZLIsVvKR8Zwfj0l1fkqo8LWY1M3IX14OX3r9RKTIO+d9XzAI8qRPGPn/4NC2n6o4rN8XJ82TOIvuVA8zLKUHRFgBCetlDZlqR1gLKjS39xoE7Bt8UvA6BxuEDjU3tFsEijgA+615tmZkXKqiEENrh41iLDDZNq4pKTWR3LZfnos81LOuNa15cD956vLMsJd1rqYp51gDUQqMYm2XsxnUhD2jg1DM7SeuJxxgrmpfISSXVIJIS5qJJSvJPEQ49DQTVIbYWJ9QWa/E2+c/oPK1drmC7WSfJRNKBO5Yjvcp7Gc3dmmI/Xh1kDTEuiSnWqQf37h+fTMhGnDf6dsS8SQfQWlqqwXXGlc/PEZ/SC5mtzIV0nAshlQdM/LvUtYutrEZ/Y+EAFtq1k28zQhOwLr1AIeANzhF8t9qzTdZf2qRKO6MWE9ohBYwibbOmrFtNmg3mcS+tB28xv2uKd/agYCvOP+GkSc+0lr7RXzyufL7QbkUpjLjEWFLqOIkAGu2B0tNlO9Eau2W1qcOUvVRgKzypKIQZ5KI3q0MLzqTNRYqiZOqmtqloIRlmkBHVpHmRYV6/HixbO6UC47KOFJnoMrVyr7wYz+SlW6GUaghYbY1I6kkxA2W1fSJokUdSh2LQ1GAimRGm0MT+uu57H5l7QgOWxERpO9moLRPgTtquWCfFlGlIjQaRly9odmzMOWY+IBO5tB4sW/0+VWGUh32qYk79EidWKrjWuiLpiVNGFWFRJVktyeXWmbgBBzVl8anPuXyNJlBJOlKLTgAbi/EYHVHxWiDaVR06GnHQNpJcWcK2jJtiCfG2sEHLzuI66sGrMK47nPIInPnu799935aOK2cvmvubrE38ZzZjrELCmXM2hM7UcpXD2oC3+ECVp7xtIuxptJ0jUr3sBmBS47TVxlvJ1Sqb/E0uLdvLj0lLr29ypdd/eMX3f6lrxGlKwKQxEGvw0qHbkbwrF3uHKwVENbIV2wZ13kNEF6zD+x24aLNMfDTCbDPnEikZFyTNttxWBXDaBuM8KtI2rmaMdUY7cXcUPstqTGvBGSrFWIpNMfbdea990bvAOC1YX0qbc6smDS1mPxSJoW4fwEXvjMmhlijDRq6qale6aJEuFGoppYDoBELQzLBuh/mZNx7jkinv0EtnUp50lO9hbNK57lZaMAWuWR5Yo9/kYwcYI0t4gWM47Umnl3YmpeBPqSyNp3K7s2DSAS/39KRuEN2bS4xvowV3dFRMx/VFcp2Yp8w2nTO9hCXtHG1kF1L4KlrJr2wKfyq77R7MKpFKzWlY9UkhYxyHWW6nBWPaudvEAl3CGcNpSXPZ6R9BbBtIl6cHL3gIBi+42CYXqCx1gfGWe7Ap0h3luyXdt1MKy4YUT9xSF01G16YEdWsouW9mgDHd3veyA97H+Ya47ZmEbqMY72oPztCGvK0onL44AvgC49saZKkWRz4veWljE1FHjbRJaWv6ZKKtl875h4CziFCZhG5rx7tefsl0aRT1bMHZjm8dwL/6u7wCRysaQblQoG5yAQN5zpatMNY/+yf8z+GLcH/Qn0iX2W2oEfXP4GvwQHuIL9AYGnaO3zqAX6946nkgqZNnUhx43DIdQtMFeOPrgy/y3Yd85HlJWwjLFkU3kFwq28xPnuPhMWeS+tDLV9Otllq7pQCf3uXJDN9wFDiUTgefHaiYbdfi3b3u8+iY6TnzhgehI1LTe8lcd7s1wJSzKbahCRxKKztTLXstGAiu3a6rPuQs5pk9TWAan5f0BZmGf7Ylxzzk/A7PAs4QPPPAHeFQ2hbFHszlgZuKZsJcUmbDC40sEU403cEjczstOEypa+YxevL4QBC8oRYqWdK6b7sK25tfE+oDZgtOQ2Jg8T41HGcBE6fTWHn4JtHcu9S7uYgU5KSCkl/mcnq+5/YBXOEr6lCUCwOTOM1taOI8mSxx1NsCXBEmLKbMAg5MkwbLmpBaFOPrNSlO2HnLiEqW3tHEwd8AeiQLmn+2gxjC3k6AxREqvKcJbTEzlpLiw4rNZK6oJdidbMMGX9FULKr0AkW+2qDEPBNNm5QAt2Ik2nftNWHetubosHLo2nG4vQA7GkcVCgVCgaDixHqo9UUn1A6OshapaNR/LPRYFV8siT1cCtJE0k/3WtaNSuUZYKPnsVIW0xXWnMUxq5+En4Kvw/MqQmVXnAXj9Z+9zM98zM/Agy7F/qqj2Nh67b8HjFnPP3iBn/tkpdzwEJX/whIcQUXOaikeliCRGUk7tiwF0rItwMEhjkZ309hikFoRAmLTpEXWuHS6y+am/KB/fM50aLEhGnSMwkpxzOov4H0AvgovwJ1iGzDLtJn/9BU+fAINfwUe6FHSLhu83viV/+/HrOePX+STT2B9uWGbrMHHLldRBlhS/CJQmcRxJFqZica01XixAZsYiH1uolZxLrR/SgxVIJjkpQP4PE9sE59LKLr7kltSBogS5tyszzH8Fvw8/AS8rNOg0xUS9fIaHwb+6et8Q/gyvKRjf5OusOzGx8evA/BP4IP11uN/grca5O0lcsPLJ5YjwI4QkJBOHa0WdMZYGxPbh2W2nR9v3WxEWqgp/G3+6VZbRLSAAZ3BhdhAaUL33VUSw9yjEsvbaQ9u4A/gGXwZXoEHOuU1GSj2chf+Mo+f8IcfcAxfIKVmyunRbYQVnoevwgfw3TXXcw++xNuP4fhyueEUNttEduRVaDttddoP0eSxLe2LENk6itYxlrxBNBYrNNKSQmeaLcm9c8UsaB5WyO6675yyQIAWSDpBVoA/gxmcwEvwoDv0m58UE7gHn+fJOa8/Ywan8EKRfjsopF83eCglX/Sfr7OeaRoQfvt1CGvIDccH5BCvw1sWIzRGC/66t0VTcLZQZtm6PlAasbOJ9iwWtUo7biktTSIPxnR24jxP1ZKaqq+2RcXM9OrBAm/AAs7hDJ5bNmGb+KIfwCs8a3jnjBrOFeMjHSCdbKr+2uOLfnOd9eiA8Hvvwwq54VbP2OqwkB48Ytc4YEOiH2vTXqodabfWEOzso4qxdbqD5L6tbtNPECqbhnA708DZH4QOJUXqScmUlks7Ot6FBuZw3n2mEbaUX7kDzxHOOQk8nKWMzAzu6ZZ8sOFw4RK+6PcuXo9tB4SbMz58ApfKDXf3szjNIIbGpD5TKTRxGkEMLjLl+K3wlWXBsCUxIDU+jbOiysESqAy1MGUJpXgwbTWzNOVEziIXZrJ+VIztl1PUBxTSo0dwn2bOmfDRPD3TRTGlfbCJvO9KvuhL1hMHhB9wPuPRLGHcdOWG2xc0U+5bQtAJT0nRTewXL1pgk2+rZAdeWmz3jxAqfNQQdzTlbF8uJ5ecEIWvTkevAHpwz7w78QujlD/Lr491bD8/1vhM2yrUQRrWXNQY4fGilfctMWYjL72UL/qS9eiA8EmN88nbNdour+PBbbAjOjIa4iBhfFg6rxeKdEGcL6p3EWR1Qq2Qkhs2DrnkRnmN9tG2EAqmgPw6hoL7Oza7B+3SCrR9tRftko+Lsf2F/mkTndN2LmzuMcKTuj/mX2+4Va3ki16+nnJY+S7MefpkidxwnV+4wkXH8TKnX0tsYzYp29DOOoSW1nf7nTh2akYiWmcJOuTidSaqESrTYpwjJJNVGQr+rLI7WsqerHW6Kp/oM2pKuV7T1QY9gjqlZp41/WfKpl56FV/0kvXQFRyeQ83xaTu5E8p5dNP3dUF34ihyI3GSpeCsywSh22ZJdWto9winhqifb7VRvgktxp13vyjrS0EjvrRfZ62uyqddSWaWYlwTPAtJZ2oZ3j/Sgi/mi+6vpzesfAcWNA0n8xVyw90GVFGuZjTXEQy+6GfLGLMLL523f5E0OmxVjDoOuRiH91RKU+vtoCtH7TgmvBLvtFXWLW15H9GTdVw8ow4IlRLeHECN9ym1e9K0I+Cbnhgv4Yu+aD2HaQJ80XDqOzSGAV4+4yCqBxrsJAX6ZTIoX36QnvzhhzzMfFW2dZVLOJfo0zbce5OvwXMFaZ81mOnlTVXpDZsQNuoYWveketKb5+6JOOsgX+NTm7H49fUTlx+WLuWL7qxnOFh4BxpmJx0p2gDzA/BUARuS6phR+pUsY7MMboAHx5xNsSVfVZcYSwqCKrqon7zM+8ecCkeS4nm3rINuaWvVNnMRI1IRpxTqx8PZUZ0Br/UEduo3B3hNvmgZfs9gQPj8vIOxd2kndir3awvJ6BLvoUuOfFWNYB0LR1OQJoUySKb9IlOBx74q1+ADC2G6rOdmFdJcD8BkfualA+BdjOOzP9uUhGUEX/TwhZsUduwRr8wNuXKurCixLBgpQI0mDbJr9dIqUuV+92ngkJZ7xduCk2yZKbfWrH1VBiTg9VdzsgRjW3CVXCvAwDd+c1z9dWw9+B+8MJL/eY15ZQ/HqvTwVdsZn5WQsgRRnMaWaecu3jFvMBEmgg+FJFZsnSl0zjB9OqPYaBD7qmoVyImFvzi41usesV0julaAR9dfR15Xzv9sEruRDyk1nb+QaLU67T885GTls6YgcY+UiMa25M/pwGrbCfzkvR3e0jjtuaFtnwuagHTSb5y7boBH119HXhvwP487jJLsLJ4XnUkHX5sLbS61dpiAXRoZSCrFJ+EjpeU3puVfitngYNo6PJrAigKktmwjyQdZpfq30mmtulaAx9Zfx15Xzv+cyeuiBFUs9zq8Kq+XB9a4PVvph3GV4E3y8HENJrN55H1X2p8VyqSKwVusJDKzXOZzplWdzBUFK9e+B4+uv468xvI/b5xtSAkBHQaPvtqWzllVvEOxPbuiE6+j2pvjcKsbvI7txnRErgfH7LdXqjq0IokKzga14GzQ23SSbCQvO6r+Or7SMIr/efOkkqSdMnj9mBx2DRsiY29Uj6+qK9ZrssCKaptR6HKURdwUYeUWA2kPzVKQO8ku2nU3Anhs/XWkBx3F/7wJtCTTTIKftthue1ty9xvNYLY/zo5KSbIuKbXpbEdSyeRyYdAIwKY2neyoc3+k1XUaufYga3T9daMUx/r8z1s10ITknIO0kuoMt+TB8jK0lpayqqjsJ2qtXAYwBU932zinimgmd6mTRDnQfr88q36NAI+tv24E8Pr8zxtasBqx0+xHH9HhlrwsxxNUfKOHQaZBITNf0uccj8GXiVmXAuPEAKSdN/4GLHhs/XWj92dN/uetNuBMnVR+XWDc25JLjo5Mg5IZIq226tmCsip2zZliL213YrTlL2hcFjpCduyim3M7/eB16q/blQsv5X/esDRbtJeabLIosWy3ycavwLhtxdWzbMmHiBTiVjJo6lCLjXZsi7p9PEPnsq6X6wd4bP11i0rD5fzPm/0A6brrIsllenZs0lCJlU4abakR59enZKrKe3BZihbTxlyZ2zl1+g0wvgmA166/bhwDrcn/7Ddz0eWZuJvfSESug6NzZsox3Z04FIxz0mUjMwVOOVTq1CQ0AhdbBGVdjG/CgsfUX7esJl3K/7ytWHRv683praW/8iDOCqWLLhpljDY1ZpzK75QiaZoOTpLKl60auHS/97oBXrv+umU9+FL+5+NtLFgjqVLCdbmj7pY5zPCPLOHNCwXGOcLquOhi8CmCWvbcuO73XmMUPab+ug3A6/A/78Bwe0bcS2+tgHn4J5pyS2WbOck0F51Vq3LcjhLvZ67p1ABbaL2H67bg78BfjKi/jr3+T/ABV3ilLmNXTI2SpvxWBtt6/Z//D0z/FXaGbSBgylzlsEGp+5//xrd4/ae4d8DUUjlslfIYS3t06HZpvfQtvv0N7AHWqtjP2pW08QD/FLy//da38vo8PNlKHf5y37Dxdfe/oj4kVIgFq3koLReSR76W/bx//n9k8jonZxzWTANVwEniDsg87sOSd/z7//PvMp3jQiptGVWFX2caezzAXwfgtzYUvbr0iozs32c3Uge7varH+CNE6cvEYmzbPZ9hMaYDdjK4V2iecf6EcEbdUDVUARda2KzO/JtCuDbNQB/iTeL0EG1JSO1jbXS+nLxtPMDPw1fh5+EPrgSEKE/8Gry5A73ui87AmxwdatyMEBCPNOCSKUeRZ2P6Myb5MRvgCHmA9ywsMifU+AYXcB6Xa5GibUC5TSyerxyh0j6QgLVpdyhfArRTTLqQjwe4HOD9s92D4Ap54odXAPBWLAwB02igG5Kkc+piN4lvODIFGAZgT+EO4Si1s7fjSR7vcQETUkRm9O+MXyo9OYhfe4xt9STQ2pcZRLayCV90b4D3jR0DYAfyxJ+eywg2IL7NTMXna7S/RpQ63JhWEM8U41ZyQGjwsVS0QBrEKLu8xwZsbi4wLcCT+OGidPIOCe1PiSc9Qt+go+vYqB7cG+B9d8cAD+WJPz0Am2gxXgU9IneOqDpAAXOsOltVuMzpdakJXrdPCzXiNVUpCeOos5cxnpQT39G+XVLhs1osQVvJKPZyNq8HDwd4d7pNDuWJPxVX7MSzqUDU6gfadKiNlUFTzLeFHHDlzO4kpa7aiKhBPGKwOqxsBAmYkOIpipyXcQSPlRTf+Tii0U3EJGaZsDER2qoB3h2hu0qe+NNwUooYU8y5mILbJe6OuX+2FTKy7bieTDAemaQyQ0CPthljSWO+xmFDIYiESjM5xKd6Ik5lvLq5GrQ3aCMLvmCA9wowLuWJb9xF59hVVP6O0CrBi3ZjZSNOvRy+I6klNVRJYRBaEzdN+imiUXQ8iVF8fsp+W4JXw7WISW7fDh7lptWkCwZ4d7QTXyBPfJMYK7SijjFppGnlIVJBJBYj7eUwtiP1IBXGI1XCsjNpbjENVpSAJ2hq2LTywEly3hUYazt31J8w2+aiLx3g3fohXixPfOMYm6zCGs9LVo9MoW3MCJE7R5u/WsOIjrqBoHUO0bJE9vxBpbhsd3+Nb4/vtPCZ4oZYCitNeYuC/8UDvDvy0qvkiW/cgqNqRyzqSZa/s0mqNGjtKOoTm14zZpUauiQgVfqtQiZjq7Q27JNaSK5ExRcrGCXO1FJYh6jR6CFqK7bZdQZ4t8g0rSlPfP1RdBtqaa9diqtzJkQ9duSryi2brQXbxDwbRUpFMBHjRj8+Nt7GDKgvph9okW7LX47gu0SpGnnFQ1S1lYldOsC7hYteR574ZuKs7Ei1lBsfdz7IZoxzzCVmmVqaSySzQbBVAWDek+N4jh9E/4VqZrJjPwiv9BC1XcvOWgO8275CVyBPvAtTVlDJfZkaZGU7NpqBogAj/xEHkeAuJihWYCxGN6e8+9JtSegFXF1TrhhLGP1fak3pebgPz192/8gB4d/6WT7+GdYnpH7hH/DJzzFiYPn/vjW0SgNpTNuPIZoAEZv8tlGw4+RLxy+ZjnKa5NdFoC7UaW0aduoYse6+bXg1DLg6UfRYwmhGEjqPvF75U558SANrElK/+MdpXvmqBpaXOa/MTZaa1DOcSiLaw9j0NNNst3c+63c7EKTpkvKHzu6bPbP0RkuHAVcbRY8ijP46MIbQeeT1mhA+5PV/inyDdQipf8LTvMXbwvoDy7IruDNVZKTfV4CTSRUYdybUCnGU7KUTDxLgCknqUm5aAW6/1p6eMsOYsphLzsHrE0Y/P5bQedx1F/4yPHnMB3/IOoTU9+BL8PhtjuFKBpZXnYNJxTuv+2XqolKR2UQgHhS5novuxVySJhBNRF3SoKK1XZbbXjVwWNyOjlqWJjrWJIy+P5bQedyldNScP+HZ61xKSK3jyrz+NiHG1hcOLL/+P+PDF2gOkekKGiNWKgJ+8Z/x8Iv4DdQHzcpZyF4v19I27w9/yPGDFQvmEpKtqv/TLiWMfn4sofMm9eAH8Ao0zzh7h4sJqYtxZd5/D7hkYPneDzl5idlzNHcIB0jVlQ+8ULzw/nc5/ojzl2juE0apD7LRnJxe04dMz2iOCFNtGFpTuXA5AhcTRo8mdN4kz30nVjEC4YTZQy4gpC7GlTlrePKhGsKKgeXpCYeO0MAd/GH7yKQUlXPLOasOH3FnSphjHuDvEu4gB8g66oNbtr6eMbFIA4fIBJkgayoXriw2XEDQPJrQeROAlY6aeYOcMf+IVYTU3XFlZufMHinGywaW3YLpObVBAsbjF4QJMsVUSayjk4voPsHJOQfPWDhCgDnmDl6XIRerD24HsGtw86RMHOLvVSHrKBdeVE26gKB5NKHzaIwLOmrqBWJYZDLhASG16c0Tn+CdRhWDgWXnqRZUTnPIHuMJTfLVpkoYy5CzylHVTGZMTwkGAo2HBlkQplrJX6U+uF1wZz2uwS1SQ12IqWaPuO4baZaEFBdukksJmkcTOm+YJSvoqPFzxFA/YUhIvWxcmSdPWTWwbAKVp6rxTtPFUZfKIwpzm4IoMfaYQLWgmlG5FME2gdBgm+J7J+rtS/XBbaVLsR7bpPQnpMFlo2doWaVceHk9+MkyguZNCJ1He+kuHTWyQAzNM5YSUg/GlTk9ZunAsg1qELVOhUSAK0LABIJHLKbqaEbHZLL1VA3VgqoiOKXYiS+HRyaEKgsfIqX64HYWbLRXy/qWoylIV9gudL1OWBNgBgTNmxA6b4txDT4gi3Ri7xFSLxtXpmmYnzAcWDZgY8d503LFogz5sbonDgkKcxGsWsE1OI+rcQtlgBBCSOKD1mtqYpIU8cTvBmAT0yZe+zUzeY92fYjTtGipXLhuR0ePoHk0ofNWBX+lo8Z7pAZDk8mEw5L7dVyZZoE/pTewbI6SNbiAL5xeygW4xPRuLCGbhcO4RIeTMFYHEJkYyEO9HmJfXMDEj/LaH781wHHZEtqSQ/69UnGpzH7LKIAZEDSPJnTesJTUa+rwTepI9dLJEawYV+ZkRn9g+QirD8vF8Mq0jFQ29js6kCS3E1+jZIhgPNanHdHFqFvPJLHqFwQqbIA4jhDxcNsOCCQLDomaL/dr5lyJaJU6FxPFjO3JOh3kVMcROo8u+C+jo05GjMF3P3/FuDLn5x2M04xXULPwaS6hBYki+MrMdZJSgPHlcB7nCR5bJ9Kr5ACUn9jk5kivdd8tk95SOGrtqu9lr2IhK65ZtEl7ZKrp7DrqwZfRUSN1el7+7NJxZbywOC8neNKTch5vsTEMNsoCCqHBCqIPRjIPkm0BjvFODGtto99rCl+d3wmHkW0FPdpZtC7MMcVtGFQjJLX5bdQ2+x9ypdc313uj8xlsrfuLgWXz1cRhZvJYX0iNVBRcVcmCXZs6aEf3RQF2WI/TcCbKmGU3IOoDJGDdDub0+hYckt6PlGu2BcxmhbTdj/klhccLGJMcqRjMJP1jW2ETqLSWJ/29MAoORluJ+6LPffBZbi5gqi5h6catQpmOT7/OFf5UorRpLzCqcMltBLhwd1are3kztrSzXO0LUbXRQcdLh/RdSZ+swRm819REDrtqzC4es6Gw4JCKlSnjYVpo0xeq33PrADbFLL3RuCmObVmPN+24kfa+AojDuM4umKe2QwCf6EN906HwjujaitDs5o0s1y+k3lgbT2W2i7FJdnwbLXhJUBq/9liTctSmFC/0OqUinb0QddTWamtjbHRFuWJJ6NpqZ8vO3fZJ37Db+2GkaPYLGHs7XTTdiFQJ68SkVJFVmY6McR5UycflNCsccHFaV9FNbR4NttLxw4pQ7wJd066Z0ohVbzihaxHVExd/ay04oxUKWt+AsdiQ9OUyZ2krzN19IZIwafSTFgIBnMV73ADj7V/K8u1MaY2sJp2HWm0f41tqwajEvdHWOJs510MaAqN4aoSiPCXtN2KSi46dUxHdaMquar82O1x5jqhDGvqmoE9LfxcY3zqA7/x3HA67r9ZG4O6Cuxu12/+TP+eLP+I+HErqDDCDVmBDO4larujNe7x8om2rMug0MX0rL1+IWwdwfR+p1TNTyNmVJ85ljWzbWuGv8/C7HD/izjkHNZNYlhZcUOKVzKFUxsxxN/kax+8zPWPSFKw80rJr9Tizyj3o1gEsdwgWGoxPezDdZ1TSENE1dLdNvuKL+I84nxKesZgxXVA1VA1OcL49dFlpFV5yJMhzyCmNQ+a4BqusPJ2bB+xo8V9u3x48VVIEPS/mc3DvAbXyoYr6VgDfh5do5hhHOCXMqBZUPhWYbWZECwVJljLgMUWOCB4MUuMaxGNUQDVI50TQ+S3kFgIcu2qKkNSHVoM0SHsgoZxP2d5HH8B9woOk4x5bPkKtAHucZsdykjxuIpbUrSILgrT8G7G5oCW+K0990o7E3T6AdW4TilH5kDjds+H64kS0mz24grtwlzDHBJqI8YJQExotPvoC4JBq0lEjjQkyBZ8oH2LnRsQ4Hu1QsgDTJbO8fQDnllitkxuVskoiKbRF9VwzMDvxHAdwB7mD9yCplhHFEyUWHx3WtwCbSMMTCUCcEmSGlg4gTXkHpZXWQ7kpznK3EmCHiXInqndkQjunG5kxTKEeGye7jWz9cyMR2mGiFQ15ENRBTbCp+Gh86vAyASdgmJq2MC6hoADQ3GosP0QHbnMHjyBQvQqfhy/BUbeHd5WY/G/9LK/8Ka8Jd7UFeNWEZvzPb458Dn8DGLOe3/wGL/4xP+HXlRt+M1PE2iLhR8t+lfgxsuh7AfO2AOf+owWhSZRYQbd622hbpKWKuU+XuvNzP0OseRDa+mObgDHJUSc/pKx31QdKffQ5OIJpt8GWjlgTwMc/w5MPCR/yl1XC2a2Yut54SvOtMev55Of45BOat9aWG27p2ZVORRvnEk1hqWMVUmqa7S2YtvlIpspuF1pt0syuZS2NV14mUidCSfzQzg+KqvIYCMljIx2YK2AO34fX4GWdu5xcIAb8MzTw+j/lyWM+Dw/gjs4GD6ehNgA48kX/AI7XXM/XAN4WHr+9ntywqoCakCqmKP0rmQrJJEErG2Upg1JObr01lKQy4jskWalKYfJ/EDLMpjNSHFEUAde2fltaDgmrNaWQ9+AAb8I5vKjz3L1n1LriB/BXkG/wwR9y/oRX4LlioHA4LzP2inzRx/DWmutRweFjeP3tNeSGlaE1Fde0OS11yOpmbIp2u/jF1n2RRZviJM0yBT3IZl2HWImKjQOxIyeU325b/qWyU9Moj1o07tS0G7qJDoGHg5m8yeCxMoEH8GU45tnrNM84D2l297DQ9t1YP7jki/7RmutRweEA77/HWXOh3HCxkRgldDQkAjNTMl2Iloc1qN5JfJeeTlyTRzxURTdn1Ixv2uKjs12AbdEWlBtmVdk2k7FFwj07PCZ9XAwW3dG+8xKzNFr4EnwBZpy9Qzhh3jDXebBpYcpuo4fQ44u+fD1dweEnHzI7v0xuuOALRUV8rXpFyfSTQYkhd7IHm07jpyhlkCmI0ALYqPTpUxXS+z4jgDj1Pflvmz5ecuItpIBxyTHpSTGWd9g1ApfD/bvwUhL4nT1EzqgX7cxfCcNmb3mPL/qi9SwTHJ49oj5ZLjccbTG3pRmlYi6JCG0mQrAt1+i2UXTZ2dv9IlQpN5naMYtviaXlTrFpoMsl3bOAFEa8sqPj2WCMrx3Yjx99qFwO59Aw/wgx+HlqNz8oZvA3exRDvuhL1jMQHPaOJ0+XyA3fp1OfM3qObEVdhxjvynxNMXQV4+GJyvOEFqeQBaIbbO7i63rpxCltdZShPFxkjM2FPVkn3TG+Rp9pO3l2RzFegGfxGDHIAh8SteR0C4HopXzRF61nheDw6TFN05Ebvq8M3VKKpGjjO6r7nhudTEGMtYM92HTDaR1FDMXJ1eThsbKfywyoWwrzRSXkc51flG3vIid62h29bIcFbTGhfV+faaB+ohj7dPN0C2e2lC96+XouFByen9AsunLDJZ9z7NExiUc0OuoYW6UZkIyx2YUR2z6/TiRjyKMx5GbbjLHvHuf7YmtKghf34LJfx63Yg8vrvN2zC7lY0x0tvKezo4HmGYDU+Gab6dFL+KI761lDcNifcjLrrr9LWZJctG1FfU1uwhoQE22ObjdfkSzY63CbU5hzs21WeTddH2BaL11Gi7lVdlxP1nkxqhnKhVY6knS3EPgVGg1JpN5cP/hivujOelhXcPj8HC/LyI6MkteVjlolBdMmF3a3DbsuAYhL44dxzthWSN065xxUd55Lmf0wRbOYOqH09/o9WbO2VtFdaMb4qBgtFJoT1SqoN8wPXMoXLb3p1PUEhxfnnLzGzBI0Ku7FxrKsNJj/8bn/H8fPIVOd3rfrklUB/DOeO+nkghgSPzrlPxluCMtOnDL4Yml6dK1r3vsgMxgtPOrMFUZbEUbTdIzii5beq72G4PD0DKnwjmBULUVFmy8t+k7fZ3pKc0Q4UC6jpVRqS9Umv8bxw35flZVOU1X7qkjnhZlsMbk24qQ6Hz7QcuL6sDC0iHHki96Uh2UdvmgZnjIvExy2TeJdMDZNSbdZyAHe/Yd1xsQhHiKzjh7GxQ4yqMPaywPkjMamvqrYpmO7Knad+ZQC5msCuAPWUoxrxVhrGv7a+KLXFhyONdTMrZ7ke23qiO40ZJUyzgYyX5XyL0mV7NiUzEs9mjtbMN0dERqwyAJpigad0B3/zRV7s4PIfXSu6YV/MK7+OrYe/JvfGMn/PHJe2fyUdtnFrKRNpXV0Y2559aWPt/G4BlvjTMtXlVIWCnNyA3YQBDmYIodFz41PvXPSa6rq9lWZawZ4dP115HXV/M/tnFkkrBOdzg6aP4pID+MZnTJ1SuuB6iZlyiox4HT2y3YBtkUKWooacBQUDTpjwaDt5poBHl1/HXltwP887lKKXxNUEyPqpGTyA699UqY/lt9yGdlUKra0fFWS+36iylVWrAyd7Uw0CZM0z7xKTOduznLIjG2Hx8cDPLb+OvK6Bv7n1DYci4CxUuRxrjBc0bb4vD3rN5Zz36ntLb83eVJIB8LiIzCmn6SMPjlX+yNlTjvIGjs+QzHPf60Aj62/jrzG8j9vYMFtm1VoRWCJdmw7z9N0t+c8cxZpPeK4aTRicS25QhrVtUp7U578chk4q04Wx4YoQSjFryUlpcQ1AbxZ/XVMknIU//OGl7Q6z9Zpxi0+3yFhSkjUDpnCIUhLWVX23KQ+L9vKvFKI0ZWFQgkDLvBoylrHNVmaw10zwCPrr5tlodfnf94EWnQ0lFRWy8pW9LbkLsyUVDc2NSTHGDtnD1uMtchjbCeb1mpxFP0YbcClhzdLu6lfO8Bj6q+bdT2sz/+8SZCV7VIxtt0DUn9L7r4cLYWDSXnseEpOGFuty0qbOVlS7NNzs5FOGJUqQpl2Q64/yBpZf90sxbE+//PGdZ02HSipCbmD6NItmQ4Lk5XUrGpDMkhbMm2ZVheNYV+VbUWTcv99+2NyX1VoafSuC+AN6q9bFIMv5X/eagNWXZxEa9JjlMwNWb00akGUkSoepp1/yRuuqHGbUn3UdBSTxBU6SEVklzWRUkPndVvw2PrrpjvxOvzPmwHc0hpmq82npi7GRro8dXp0KXnUQmhZbRL7NEVp1uuZmO45vuzKsHrktS3GLWXODVjw+vXXLYx4Hf7njRPd0i3aoAGX6W29GnaV5YdyDj9TFkakje7GHYzDoObfddHtOSpoi2SmzJHrB3hM/XUDDEbxP2/oosszcRlehWXUvzHv4TpBVktHqwenFo8uLVmy4DKLa5d3RtLrmrM3aMFr1183E4sewf+85VWeg1c5ag276NZrM9IJVNcmLEvDNaV62aq+14IAOGFsBt973Ra8Xv11YzXwNfmft7Jg2oS+XOyoC8/cwzi66Dhmgk38kUmP1CUiYWOX1bpD2zWXt2FCp7uq8703APAa9dfNdscR/M/bZLIyouVxqJfeWvG9Je+JVckHQ9+CI9NWxz+blX/KYYvO5n2tAP/vrlZ7+8/h9y+9qeB/Hnt967e5mevX10rALDWK//FaAT5MXdBXdP0C/BAes792c40H+AiAp1e1oH8HgH94g/Lttx1gp63op1eyoM/Bvw5/G/7xFbqJPcCXnmBiwDPb/YKO4FX4OjyCb289db2/Noqicw4i7N6TVtoz8tNwDH+8x/i6Ae7lmaQVENzJFb3Di/BFeAwz+Is9SjeQySpPqbLFlNmyz47z5a/AF+AYFvDmHqibSXTEzoT4Gc3OALaqAP4KPFUJ6n+1x+rGAM6Zd78bgJ0a8QN4GU614vxwD9e1Amy6CcskNrczLx1JIp6HE5UZD/DBHrFr2oNlgG4Odv226BodoryjGJ9q2T/AR3vQrsOCS0ctXZi3ruLlhpFDJYl4HmYtjQCP9rhdn4suySLKDt6wLcC52h8xPlcjju1fn+yhuw4LZsAGUuo2b4Fx2UwQu77uqRHXGtg92aN3tQCbFexc0uk93vhTXbct6y7MulLycoUljx8ngDMBg1tvJjAazpEmOtxlzclvj1vQf1Tx7QlPDpGpqgtdSKz/d9/hdy1vTfFHSmC9dGDZbLiezz7Ac801HirGZsWjydfZyPvHXL/Y8Mjzg8BxTZiuwKz4Eb8sBE9zznszmjvFwHKPIWUnwhqfVRcd4Ck0K6ate48m1oOfrX3/yOtvAsJ8zsPAM89sjnddmuLuDPjX9Bu/L7x7xpMzFk6nWtyQfPg278Gn4Aekz2ZgOmU9eJ37R14vwE/BL8G3aibCiWMWWDQ0ZtkPMnlcGeAu/Ag+8ZyecU5BPuy2ILD+sQqyZhAKmn7XZd+jIMTN9eBL7x95xVLSX4On8EcNlXDqmBlqS13jG4LpmGbkF/0CnOi3H8ETOIXzmnmtb0a16Tzxj1sUvQCBiXZGDtmB3KAefPH94xcUa/6vwRn80GOFyjEXFpba4A1e8KQfFF+259tx5XS4egYn8fQsLGrqGrHbztr+uByTahWuL1NUGbDpsnrwBfePPwHHIf9X4RnM4Z2ABWdxUBlqQ2PwhuDxoS0vvqB1JzS0P4h2nA/QgTrsJFn+Y3AOjs9JFC07CGWX1oNX3T/yHOzgDjwPn1PM3g9Jk9lZrMEpxnlPmBbjyo2+KFXRU52TJM/2ALcY57RUzjObbjqxVw++4P6RAOf58pcVsw9Daje3htriYrpDOonre3CudSe6bfkTEgHBHuDiyu5MCsc7BHhYDx7ePxLjqigXZsw+ijMHFhuwBmtoTPtOxOrTvYJDnC75dnUbhfwu/ZW9AgYd+peL68HD+0emKquiXHhWjJg/UrkJYzuiaL3E9aI/ytrCvAd4GcYZMCkSQxfUg3v3j8c4e90j5ZTPdvmJJGHnOCI2nHS8081X013pHuBlV1gB2MX1YNmWLHqqGN/TWmG0y6clJWthxNUl48q38Bi8vtMKyzzpFdSDhxZ5WBA5ZLt8Jv3895DduBlgbPYAj8C4B8hO68FDkoh5lydC4FiWvBOVqjYdqjiLv92t8yPDjrDaiHdUD15qkSURSGmXJwOMSxWAXYwr3zaAufJ66l+94vv3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/wHuD9tQd4f+0B3l97gPfXHuD9tQd4f+0B3l97gG8LwP8G/AL8O/A5OCq0Ys2KIdv/qOIXG/4mvFAMF16gZD+2Xvu/B8as5+8bfllWyg0zaNO5bfXj6vfhhwD86/Aq3NfRS9t9WPnhfnvCIw/CT8GLcFTMnpntdF/z9V+PWc/vWoIH+FL3Znv57PitcdGP4R/C34avw5fgRVUInCwbsn1yyA8C8zm/BH8NXoXnVE6wVPjdeCI38kX/3+Ct9dbz1pTmHFRu+Hm4O9Ch3clr99negxfwj+ER/DR8EV6B5+DuQOnTgUw5rnkY+FbNU3gNXh0o/JYTuWOvyBf9FvzX663HH/HejO8LwAl8Hl5YLTd8q7sqA3wbjuExfAFegQdwfyDoSkWY8swzEf6o4Qyewefg+cHNbqMQruSL/u/WWc+E5g7vnnEXgDmcDeSGb/F4cBcCgT+GGRzDU3hZYburAt9TEtHgbM6JoxJ+6NMzzTcf6c2bycv2+KK/f+l6LBzw5IwfqZJhA3M472pWT/ajKxnjv4AFnMEpnBTPND6s2J7qHbPAqcMK74T2mZ4VGB9uJA465It+/eL1WKhYOD7xHOkr1ajK7d0C4+ke4Hy9qXZwpgLr+Znm/uNFw8xQOSy8H9IzjUrd9+BIfenYaylf9FsXr8fBAadnPIEDna8IBcwlxnuA0/Wv6GAWPd7dDIKjMdSWueAsBj4M7TOd06qBbwDwKr7oleuxMOEcTuEZTHWvDYUO7aHqAe0Bbq+HEFRzOz7WVoTDQkVds7A4sIIxfCQdCefFRoIOF/NFL1mPab/nvOakSL/Q1aFtNpUb/nFOVX6gzyg/1nISyDfUhsokIzaBR9Kxm80s5mK+6P56il1jXic7nhQxsxSm3OwBHl4fFdLqi64nDQZvqE2at7cWAp/IVvrN6/BFL1mPhYrGMBfOi4PyjuSGf6wBBh7p/FZTghCNWGgMzlBbrNJoPJX2mW5mwZfyRffXo7OFi5pZcS4qZUrlViptrXtw+GQoyhDPS+ANjcGBNRiLCQDPZPMHuiZfdFpPSTcQwwKYdRNqpkjm7AFeeT0pJzALgo7g8YYGrMHS0iocy+YTm2vyRUvvpXCIpQ5pe666TJrcygnScUf/p0NDs/iAI/nqDHC8TmQT8x3NF91l76oDdQGwu61Z6E0ABv7uO1dbf/37Zlv+Zw/Pbh8f1s4Avur6657/+YYBvur6657/+YYBvur6657/+YYBvur6657/+aYBvuL6657/+VMA8FXWX/f8zzcN8BXXX/f8zzcNMFdbf93zP38KLPiK6697/uebtuArrr/u+Z9vGmCusP6653/+1FjwVdZf9/zPN7oHX339dc//fNMu+irrr3v+50+Bi+Zq6697/uebA/jz8Pudf9ht/fWv517J/XUzAP8C/BAeX9WCDrUpZ3/dEMBxgPcfbtTVvsYV5Yn32u03B3Ac4P3b8I+vxNBKeeL9dRMAlwO83959qGO78sT769oB7g3w/vGVYFzKE++v6wV4OMD7F7tckFkmT7y/rhHgpQO8b+4Y46XyxPvrugBeNcB7BRiX8sT767oAvmCA9woAHsoT76+rBJjLBnh3txOvkifeX1dswZcO8G6N7sXyxPvr6i340gHe3TnqVfLE++uKAb50gHcXLnrX8sR7gNdPRqwzwLu7Y/FO5Yn3AK9jXCMGeHdgxDuVJ75VAI8ljP7PAb3/RfjcZfePHBB+79dpfpH1CanN30d+mT1h9GqAxxJGM5LQeeQ1+Tb+EQJrElLb38VHQ94TRq900aMIo8cSOo+8Dp8QfsB8zpqE1NO3OI9Zrj1h9EV78PqE0WMJnUdeU6E+Jjyk/hbrEFIfeWbvId8H9oTRFwdZaxJGvziW0Hn0gqYB/wyZ0PwRlxJST+BOw9m77Amj14ii1yGM/txYQudN0qDzGe4EqfA/5GJCagsHcPaEPWH0esekSwmjRxM6b5JEcZ4ww50ilvAOFxBSx4yLW+A/YU8YvfY5+ALC6NGEzhtmyZoFZoarwBLeZxUhtY4rc3bKnjB6TKJjFUHzJoTOozF2YBpsjcyxDgzhQ1YRUse8+J4wenwmaylB82hC5w0zoRXUNXaRBmSMQUqiWSWkLsaVqc/ZE0aPTFUuJWgeTei8SfLZQeMxNaZSIzbII4aE1Nmr13P2hNHjc9E9guYNCZ032YlNwESMLcZiLQHkE4aE1BFg0yAR4z1h9AiAGRA0jyZ03tyIxWMajMPWBIsxYJCnlITU5ShiHYdZ94TR4wCmSxg9jtB5KyPGYzymAYexWEMwAPIsAdYdV6aObmNPGD0aYLoEzaMJnTc0Ygs+YDw0GAtqxBjkuP38bMRWCHn73xNGjz75P73WenCEJnhwyVe3AEe8TtKdJcYhBl97wuhNAObK66lvD/9J9NS75v17wuitAN5fe4D31x7g/bUHeH/tAd5fe4D3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/w/toDvAd4f/24ABzZ8o+KLsSLS+Pv/TqTb3P4hKlQrTGh+fbIBT0Axqznnb+L/V2mb3HkN5Mb/nEHeK7d4IcDld6lmDW/iH9E+AH1MdOw/Jlu2T1xNmY98sv4wHnD7D3uNHu54WUuOsBTbQuvBsPT/UfzNxGYzwkP8c+Yz3C+r/i6DcyRL/rZ+utRwWH5PmfvcvYEt9jLDS/bg0/B64DWKrQM8AL8FPwS9beQCe6EMKNZYJol37jBMy35otdaz0Bw2H/C2Smc7+WGB0HWDELBmOByA3r5QONo4V+DpzR/hFS4U8wMW1PXNB4TOqYz9urxRV++ntWCw/U59Ty9ebdWbrgfRS9AYKKN63ZokZVygr8GZ/gfIhZXIXPsAlNjPOLBby5c1eOLvmQ9lwkOy5x6QV1j5TYqpS05JtUgUHUp5toHGsVfn4NX4RnMCe+AxTpwmApTYxqMxwfCeJGjpXzRF61nbcHhUBPqWze9svwcHJ+S6NPscKrEjug78Dx8Lj3T8D4YxGIdxmJcwhi34fzZUr7olevZCw5vkOhoClq5zBPZAnygD/Tl9EzDh6kl3VhsHYcDEb+hCtJSvuiV69kLDm+WycrOTArHmB5/VYyP6jOVjwgGawk2zQOaTcc1L+aLXrKeveDwZqlKrw8U9Y1p66uK8dEzdYwBeUQAY7DbyYNezBfdWQ97weEtAKYQg2xJIkuveAT3dYeLGH+ShrWNwZgN0b2YL7qznr3g8JYAo5bQBziPjx7BPZ0d9RCQp4UZbnFdzBddor4XHN4KYMrB2qHFRIzzcLAHQZ5the5ovui94PCWAPefaYnxIdzRwdHCbuR4B+tbiy96Lzi8E4D7z7S0mEPd+eqO3cT53Z0Y8SV80XvB4Z0ADJi/f7X113f+7p7/+UYBvur6657/+YYBvur6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+VMA8FXWX/f8z58OgK+y/rrnf75RgLna+uue//lTA/CV1V/3/M837aKvvv6653++UQvmauuve/7nTwfAV1N/3fM/fzr24Cuuv+75nz8FFnxl9dc9//MOr/8/glixwRuUfM4AAAAASUVORK5CYII=",d.tArea,o),(0,v.pg)("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII=",d.tSearch,u)
const p={...w},h=(0,s.$h)(e,"triangles",T,p,d)
return(0,l._)(h,d)}(e,this.edgesTarget.texture),this.blendRenderable=function(e,t,n){const i=t.getWidth(),o=t.getHeight(),u={...r.OM,tColor:a.IQ.create(t),tWeights:a.IQ.create(n),uTexSizeInv:a.IQ.create(c.ZY.create(1/i,1/o)),uViewport:a.IQ.create((0,c.Zb)())},d={...A},p=(0,s.$h)(e,"triangles",I,d,u)
return(0,l._)(p,u)}(e,t,this.weightsTarget.texture),this._supported=!0}getByteCount(){return this.supported?this.edgesTarget.getByteCount()+this.weightsTarget.getByteCount():0}updateState(e){const{gl:t,state:n}=this.webgl
n.enable(t.SCISSOR_TEST),n.disable(t.BLEND),n.disable(t.DEPTH_TEST),n.depthMask(!1)
const{x:r,y:i,width:o,height:s}=e
n.viewport(r,i,o,s),n.scissor(r,i,o,s),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT),a.IQ.update(this.edgesRenderable.values.uViewport,b.LM.toVec4(this.edgesRenderable.values.uViewport.ref.value,e)),a.IQ.update(this.weightsRenderable.values.uViewport,b.LM.toVec4(this.weightsRenderable.values.uViewport.ref.value,e)),a.IQ.update(this.blendRenderable.values.uViewport,b.LM.toVec4(this.blendRenderable.values.uViewport.ref.value,e))}setSize(e,t){const n=this.edgesTarget.getWidth(),r=this.edgesTarget.getHeight()
e===n&&t===r||(this.edgesTarget.setSize(e,t),this.weightsTarget.setSize(e,t),a.IQ.update(this.edgesRenderable.values.uTexSizeInv,c.ZY.set(this.edgesRenderable.values.uTexSizeInv.ref.value,1/e,1/t)),a.IQ.update(this.weightsRenderable.values.uTexSizeInv,c.ZY.set(this.weightsRenderable.values.uTexSizeInv.ref.value,1/e,1/t)),a.IQ.update(this.blendRenderable.values.uTexSizeInv,c.ZY.set(this.blendRenderable.values.uTexSizeInv.ref.value,1/e,1/t)))}update(e,t){let n=!1
this.edgesRenderable.values.tColor.ref.value!==e&&(a.IQ.update(this.edgesRenderable.values.tColor,e),n=!0),this.edgesRenderable.values.dEdgeThreshold.ref.value!==t.edgeThreshold&&(a.IQ.update(this.edgesRenderable.values.dEdgeThreshold,t.edgeThreshold),n=!0),n&&this.edgesRenderable.update(),this.weightsRenderable.values.dMaxSearchSteps.ref.value!==t.maxSearchSteps&&(a.IQ.update(this.weightsRenderable.values.dMaxSearchSteps,t.maxSearchSteps),this.weightsRenderable.update()),this.blendRenderable.values.tColor.ref.value!==e&&(a.IQ.update(this.blendRenderable.values.tColor,e),this.blendRenderable.update())}render(e,t){h.g$&&this.webgl.timer.mark("SmaaPass.render"),this.edgesTarget.bind(),this.updateState(e),this.edgesRenderable.render(),this.weightsTarget.bind(),this.updateState(e),this.weightsRenderable.render(),t?t.bind():this.webgl.bindDrawingBuffer(),this.updateState(e),this.blendRenderable.render(),h.g$&&this.webgl.timer.markEnd("SmaaPass.render")}}const _={...r.du,tColor:(0,i.$G)("texture","rgba","ubyte","linear"),uTexSizeInv:(0,i.w5)("v2"),uViewport:(0,i.w5)("v4"),dEdgeThreshold:(0,i.$F)("number")},C=(0,o.NG)("smaa-edges","\nprecision highp float;\n\nattribute vec2 aPosition;\nuniform vec2 uQuadScale;\n\nuniform vec2 uTexSizeInv;\nuniform vec4 uViewport;\n\nvarying vec2 vUv;\nvarying vec4 vOffset[3];\n\nvoid SMAAEdgeDetectionVS(vec2 texCoord) {\n    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-1.0, 0.0, 0.0, 1.0); // WebGL port note: Changed sign in W component\n    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(1.0, 0.0, 0.0, -1.0); // WebGL port note: Changed sign in W component\n    vOffset[2] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-2.0, 0.0, 0.0, 2.0); // WebGL port note: Changed sign in W component\n}\n\nvoid main() {\n    vec2 scale = uViewport.zw * uTexSizeInv;\n    vec2 shift = uViewport.xy * uTexSizeInv;\n    vUv = (aPosition + 1.0) * 0.5 * scale + shift;\n    SMAAEdgeDetectionVS(vUv);\n    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;\n    gl_Position = vec4(position, 0.0, 1.0);\n}\n","\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tColor;\nuniform vec2 uTexSizeInv;\n\nvarying vec2 vUv;\nvarying vec4 vOffset[3];\n\nvec4 SMAAColorEdgeDetectionPS(vec2 texcoord, vec4 offset[3], sampler2D colorTex) {\n    vec2 threshold = vec2(dEdgeThreshold, dEdgeThreshold);\n\n    // Calculate color deltas:\n    vec4 delta;\n    vec3 C = texture2D(colorTex, texcoord).rgb;\n\n    vec3 Cleft = texture2D(colorTex, offset[0].xy).rgb;\n    vec3 t = abs(C - Cleft);\n    delta.x = max(max(t.r, t.g), t.b);\n\n    vec3 Ctop = texture2D(colorTex, offset[0].zw).rgb;\n    t = abs(C - Ctop);\n    delta.y = max(max(t.r, t.g), t.b);\n\n    // We do the usual threshold:\n    vec2 edges = step(threshold, delta.xy);\n\n    // Then discard if there is no edge:\n    if (dot(edges, vec2(1.0, 1.0 )) == 0.0)\n        discard;\n\n    // Calculate right and bottom deltas:\n    vec3 Cright = texture2D(colorTex, offset[1].xy).rgb;\n    t = abs( C - Cright );\n    delta.z = max(max(t.r, t.g), t.b);\n\n    vec3 Cbottom  = texture2D(colorTex, offset[1].zw).rgb;\n    t = abs(C - Cbottom);\n    delta.w = max(max(t.r, t.g), t.b);\n\n    // Calculate the maximum delta in the direct neighborhood:\n    float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w );\n\n    // Calculate left-left and top-top deltas:\n    vec3 Cleftleft  = texture2D(colorTex, offset[2].xy).rgb;\n    t = abs( C - Cleftleft );\n    delta.z = max(max(t.r, t.g), t.b);\n\n    vec3 Ctoptop = texture2D(colorTex, offset[2].zw).rgb;\n    t = abs(C - Ctoptop);\n    delta.w = max(max(t.r, t.g), t.b);\n\n    // Calculate the final maximum delta:\n    maxDelta = max(max(maxDelta, delta.z), delta.w);\n\n    // Local contrast adaptation in action:\n    edges.xy *= step(0.5 * maxDelta, delta.xy);\n\n    return vec4(edges, 0.0, 0.0);\n}\n\nvoid main() {\n    gl_FragColor = SMAAColorEdgeDetectionPS(vUv, vOffset, tColor);\n}\n"),w={...r.du,tEdges:(0,i.$G)("texture","rgba","ubyte","linear"),tArea:(0,i.$G)("texture","rgb","ubyte","linear"),tSearch:(0,i.$G)("texture","rgba","ubyte","nearest"),uTexSizeInv:(0,i.w5)("v2"),uViewport:(0,i.w5)("v4"),dMaxSearchSteps:(0,i.$F)("number")},T=(0,o.NG)("smaa-weights","\nprecision highp float;\n\nattribute vec2 aPosition;\nuniform vec2 uQuadScale;\n\nuniform vec2 uTexSizeInv;\nuniform vec4 uViewport;\n\nvarying vec2 vUv;\nvarying vec4 vOffset[3];\nvarying vec2 vPixCoord;\n\nvoid SMAABlendingWeightCalculationVS(vec2 texCoord) {\n    vPixCoord = texCoord / uTexSizeInv;\n\n    // We will use these offsets for the searches later on (see @PSEUDO_GATHER4):\n    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-0.25, 0.125, 1.25, 0.125); // WebGL port note: Changed sign in Y and W components\n    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-0.125, 0.25, -0.125, -1.25); // WebGL port note: Changed sign in Y and W components\n\n    // And these for the searches, they indicate the ends of the loops:\n    vOffset[2] = vec4(vOffset[0].xz, vOffset[1].yw) + vec4(-2.0, 2.0, -2.0, 2.0) * uTexSizeInv.xxyy * float(dMaxSearchSteps);\n}\n\nvoid main() {\n    vec2 scale = uViewport.zw * uTexSizeInv;\n    vec2 shift = uViewport.xy * uTexSizeInv;\n    vUv = (aPosition + 1.0) * 0.5 * scale + shift;\n    SMAABlendingWeightCalculationVS(vUv);\n    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;\n    gl_Position = vec4(position, 0.0, 1.0);\n}\n","\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\n#define SMAASampleLevelZeroOffset(tex, coord, offset) texture2D(tex, coord + float(offset) * uTexSizeInv, 0.0)\n\n#define SMAA_AREATEX_MAX_DISTANCE 16\n#define SMAA_AREATEX_PIXEL_SIZE (1.0 / vec2(160.0, 560.0))\n#define SMAA_AREATEX_SUBTEX_SIZE (1.0 / 7.0)\n\nuniform sampler2D tEdges;\nuniform sampler2D tArea;\nuniform sampler2D tSearch;\nuniform vec2 uTexSizeInv;\n\nvarying vec2 vUv;\nvarying vec4 vOffset[3];\nvarying vec2 vPixCoord;\n\n#if __VERSION__ == 100\n    vec2 round(vec2 x) {\n        return sign(x) * floor(abs(x) + 0.5);\n    }\n#endif\n\nfloat SMAASearchLength(sampler2D searchTex, vec2 e, float bias, float scale) {\n    // Not required if searchTex accesses are set to point:\n    // float2 SEARCH_TEX_PIXEL_SIZE = 1.0 / float2(66.0, 33.0);\n    // e = float2(bias, 0.0) + 0.5 * SEARCH_TEX_PIXEL_SIZE +\n    //     e * float2(scale, 1.0) * float2(64.0, 32.0) * SEARCH_TEX_PIXEL_SIZE;\n    e.r = bias + e.r * scale;\n    return 255.0 * texture2D(searchTex, e, 0.0).r;\n}\n\nfloat SMAASearchXLeft(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {\n    /**\n     * @PSEUDO_GATHER4\n     * This texCoord has been offset by (-0.25, -0.125) in the vertex shader to\n     * sample between edge, thus fetching four edges in a row.\n     * Sampling with different offsets in each direction allows to disambiguate\n     * which edges are active from the four fetched ones.\n     */\n    vec2 e = vec2(0.0, 1.0);\n\n    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for\n        e = texture2D( edgesTex, texCoord, 0.0).rg;\n        texCoord -= vec2(2.0, 0.0) * uTexSizeInv;\n        if (!(texCoord.x > end && e.g > 0.8281 && e.r == 0.0)) break;\n    }\n\n    // We correct the previous (-0.25, -0.125) offset we applied:\n    texCoord.x += 0.25 * uTexSizeInv.x;\n\n    // The searches are bias by 1, so adjust the coords accordingly:\n    texCoord.x += uTexSizeInv.x;\n\n    // Disambiguate the length added by the last step:\n    texCoord.x += 2.0 * uTexSizeInv.x; // Undo last step\n    texCoord.x -= uTexSizeInv.x * SMAASearchLength(searchTex, e, 0.0, 0.5);\n\n    return texCoord.x;\n}\n\nfloat SMAASearchXRight(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {\n    vec2 e = vec2( 0.0, 1.0 );\n\n    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for\n        e = texture2D(edgesTex, texCoord, 0.0).rg;\n        texCoord += vec2(2.0, 0.0) * uTexSizeInv;\n        if (!(texCoord.x < end && e.g > 0.8281 && e.r == 0.0)) break;\n    }\n\n    texCoord.x -= 0.25 * uTexSizeInv.x;\n    texCoord.x -= uTexSizeInv.x;\n    texCoord.x -= 2.0 * uTexSizeInv.x;\n    texCoord.x += uTexSizeInv.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );\n\n    return texCoord.x;\n}\n\nfloat SMAASearchYUp(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {\n    vec2 e = vec2( 1.0, 0.0 );\n\n    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for\n        e = texture2D(edgesTex, texCoord, 0.0).rg;\n        texCoord += vec2(0.0, 2.0) * uTexSizeInv; // WebGL port note: Changed sign\n        if (!(texCoord.y > end && e.r > 0.8281 && e.g == 0.0)) break;\n    }\n\n    texCoord.y -= 0.25 * uTexSizeInv.y; // WebGL port note: Changed sign\n    texCoord.y -= uTexSizeInv.y; // WebGL port note: Changed sign\n    texCoord.y -= 2.0 * uTexSizeInv.y; // WebGL port note: Changed sign\n    texCoord.y += uTexSizeInv.y * SMAASearchLength(searchTex, e.gr, 0.0, 0.5); // WebGL port note: Changed sign\n\n    return texCoord.y;\n}\n\nfloat SMAASearchYDown(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {\n    vec2 e = vec2( 1.0, 0.0 );\n\n    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for\n        e = texture2D(edgesTex, texCoord, 0.0).rg;\n        texCoord -= vec2( 0.0, 2.0 ) * uTexSizeInv; // WebGL port note: Changed sign\n        if (!(texCoord.y < end && e.r > 0.8281 && e.g == 0.0)) break;\n    }\n\n    texCoord.y += 0.25 * uTexSizeInv.y; // WebGL port note: Changed sign\n    texCoord.y += uTexSizeInv.y; // WebGL port note: Changed sign\n    texCoord.y += 2.0 * uTexSizeInv.y; // WebGL port note: Changed sign\n    texCoord.y -= uTexSizeInv.y * SMAASearchLength(searchTex, e.gr, 0.5, 0.5); // WebGL port note: Changed sign\n\n    return texCoord.y;\n}\n\nvec2 SMAAArea(sampler2D areaTex, vec2 dist, float e1, float e2, float offset) {\n    // Rounding prevents precision errors of bilinear filtering:\n    vec2 texCoord = float(SMAA_AREATEX_MAX_DISTANCE) * round(4.0 * vec2(e1, e2)) + dist;\n\n    // We do a scale and bias for mapping to texel space:\n    texCoord = SMAA_AREATEX_PIXEL_SIZE * texCoord + (0.5 * SMAA_AREATEX_PIXEL_SIZE);\n\n    // Move to proper place, according to the subpixel offset:\n    texCoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;\n\n    return texture2D(areaTex, texCoord, 0.0).rg;\n}\n\nvec4 SMAABlendingWeightCalculationPS(vec2 texCoord, vec2 pixCoord, vec4 offset[3], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices) {\n    vec4 weights = vec4(0.0, 0.0, 0.0, 0.0);\n\n    vec2 e = texture2D(edgesTex, texCoord).rg;\n\n    if (e.g > 0.0) { // Edge at north\n        vec2 d;\n\n        // Find the distance to the left:\n        vec2 coords;\n        coords.x = SMAASearchXLeft(edgesTex, searchTex, offset[0].xy, offset[2].x );\n        coords.y = offset[1].y; // offset[1].y = texCoord.y - 0.25 * uTexSizeInv.y (@CROSSING_OFFSET)\n        d.x = coords.x;\n\n        // Now fetch the left crossing edges, two at a time using bilinear\n        // filtering. Sampling at -0.25 (see @CROSSING_OFFSET) enables to\n        // discern what value each edge has:\n        float e1 = texture2D(edgesTex, coords, 0.0).r;\n\n        // Find the distance to the right:\n        coords.x = SMAASearchXRight(edgesTex, searchTex, offset[0].zw, offset[2].y);\n        d.y = coords.x;\n\n        // We want the distances to be in pixel units (doing this here allow to\n        // better interleave arithmetic and memory accesses):\n        d = d / uTexSizeInv.x - pixCoord.x;\n\n        // SMAAArea below needs a sqrt, as the areas texture is compressed\n        // quadratically:\n        vec2 sqrt_d = sqrt(abs(d));\n\n        // Fetch the right crossing edges:\n        coords.y -= 1.0 * uTexSizeInv.y; // WebGL port note: Added\n        float e2 = SMAASampleLevelZeroOffset(edgesTex, coords, ivec2(1, 0)).r;\n\n        // Ok, we know how this pattern looks like, now it is time for getting\n        // the actual area:\n        weights.rg = SMAAArea(areaTex, sqrt_d, e1, e2, float(subsampleIndices.y));\n    }\n\n    if (e.r > 0.0) { // Edge at west\n        vec2 d;\n\n        // Find the distance to the top:\n        vec2 coords;\n\n        coords.y = SMAASearchYUp(edgesTex, searchTex, offset[1].xy, offset[2].z );\n        coords.x = offset[0].x; // offset[1].x = texCoord.x - 0.25 * uTexSizeInv.x;\n        d.x = coords.y;\n\n        // Fetch the top crossing edges:\n        float e1 = texture2D(edgesTex, coords, 0.0).g;\n\n        // Find the distance to the bottom:\n        coords.y = SMAASearchYDown(edgesTex, searchTex, offset[1].zw, offset[2].w);\n        d.y = coords.y;\n\n        // We want the distances to be in pixel units:\n        d = d / uTexSizeInv.y - pixCoord.y;\n\n        // SMAAArea below needs a sqrt, as the areas texture is compressed\n        // quadratically:\n        vec2 sqrt_d = sqrt(abs(d));\n\n        // Fetch the bottom crossing edges:\n        coords.y -= 1.0 * uTexSizeInv.y; // WebGL port note: Added\n        float e2 = SMAASampleLevelZeroOffset(edgesTex, coords, ivec2(0, 1)).g;\n\n        // Get the area for this direction:\n        weights.ba = SMAAArea(areaTex, sqrt_d, e1, e2, float(subsampleIndices.x));\n    }\n\n    return weights;\n}\n\nvoid main() {\n    gl_FragColor = SMAABlendingWeightCalculationPS(vUv, vPixCoord, vOffset, tEdges, tArea, tSearch, ivec4(0.0));\n}\n"),A={...r.du,tColor:(0,i.$G)("texture","rgba","ubyte","linear"),tWeights:(0,i.$G)("texture","rgba","ubyte","linear"),uTexSizeInv:(0,i.w5)("v2"),uViewport:(0,i.w5)("v4")},I=(0,o.NG)("smaa-blend","\nprecision highp float;\n\nattribute vec2 aPosition;\nuniform vec2 uQuadScale;\n\nuniform vec2 uTexSizeInv;\nuniform vec4 uViewport;\n\nvarying vec2 vUv;\nvarying vec4 vOffset[2];\n\nvoid SMAANeighborhoodBlendingVS(vec2 texCoord) {\n    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-1.0, 0.0, 0.0, 1.0); // WebGL port note: Changed sign in W component\n    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(1.0, 0.0, 0.0, -1.0); // WebGL port note: Changed sign in W component\n}\n\nvoid main() {\n    vec2 scale = uViewport.zw * uTexSizeInv;\n    vec2 shift = uViewport.xy * uTexSizeInv;\n    vUv = (aPosition + 1.0) * 0.5 * scale + shift;\n    SMAANeighborhoodBlendingVS(vUv);\n    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;\n    gl_Position = vec4(position, 0.0, 1.0);\n}\n","\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tWeights;\nuniform sampler2D tColor;\nuniform vec2 uTexSizeInv;\n\nvarying vec2 vUv;\nvarying vec4 vOffset[2];\n\nvec4 SMAANeighborhoodBlendingPS(vec2 texCoord, vec4 offset[2], sampler2D colorTex, sampler2D blendTex) {\n    // Fetch the blending weights for current pixel:\n    vec4 a;\n    a.xz = texture2D(blendTex, texCoord).xz;\n    a.y = texture2D(blendTex, offset[1].zw).g;\n    a.w = texture2D(blendTex, offset[1].xy).a;\n\n    // Is there any blending weight with a value greater than 0.0?\n    if (dot(a, vec4(1.0, 1.0, 1.0, 1.0)) < 1e-5) {\n        return texture2D(colorTex, texCoord, 0.0);\n    } else {\n        // Up to 4 lines can be crossing a pixel (one through each edge). We\n        // favor blending by choosing the line with the maximum weight for each\n        // direction:\n        vec2 offset;\n        offset.x = a.a > a.b ? a.a : -a.b; // left vs. right\n        offset.y = a.g > a.r ? -a.g : a.r; // top vs. bottom // WebGL port note: Changed signs\n\n        // Then we go in the direction that has the maximum weight:\n        if (abs(offset.x) > abs(offset.y)) { // horizontal vs. vertical\n            offset.y = 0.0;\n        } else {\n            offset.x = 0.0;\n        }\n\n        // Fetch the opposite color and lerp by hand:\n        vec4 C = texture2D(colorTex, texCoord, 0.0);\n        texCoord += sign(offset) * uTexSizeInv;\n        vec4 Cop = texture2D(colorTex, texCoord, 0.0);\n        float s = abs(offset.x) > abs(offset.y) ? abs(offset.x) : abs(offset.y);\n\n        // WebGL port note: Added gamma correction\n        C.xyz = pow(C.xyz, vec3(2.2));\n        Cop.xyz = pow(Cop.xyz, vec3(2.2));\n        vec4 mixed = mix(C, Cop, s);\n        mixed.xyz = pow(mixed.xyz, vec3(1.0 / 2.2));\n\n        return mixed;\n    }\n}\n\nvoid main() {\n    gl_FragColor = SMAANeighborhoodBlendingPS(vUv, vOffset, tColor, tWeights);\n}\n")
var P=n(39250),B=n(80813),E=n(91763),k=n(37411),D=n(16124),M=n(32372),R=n(17370),O=n(87423),L=n(69755),N=n(91229),F=n(97564)
function z(){return z.zero()}!function(e){function t(){const e=[.1,0,0]
return e[0]=0,e}function n(e,t,n,r){return e[0]=t,e[0]=n,e[0]=r,e}function r(e,t,n){const r=t[0],i=t[4],o=t[8],a=t[1],s=t[5],l=t[9],c=t[2],u=t[6],d=t[10]
switch(n){case"XYZ":e[1]=Math.asin((0,F.qE)(o,-1,1)),Math.abs(o)<.9999999?(e[0]=Math.atan2(-l,d),e[2]=Math.atan2(-i,r)):(e[0]=Math.atan2(u,s),e[2]=0)
break
case"YXZ":e[0]=Math.asin(-(0,F.qE)(l,-1,1)),Math.abs(l)<.9999999?(e[1]=Math.atan2(o,d),e[2]=Math.atan2(a,s)):(e[1]=Math.atan2(-c,r),e[2]=0)
break
case"ZXY":e[0]=Math.asin((0,F.qE)(u,-1,1)),Math.abs(u)<.9999999?(e[1]=Math.atan2(-c,d),e[2]=Math.atan2(-i,s)):(e[1]=0,e[2]=Math.atan2(a,r))
break
case"ZYX":e[1]=Math.asin(-(0,F.qE)(c,-1,1)),Math.abs(c)<.9999999?(e[0]=Math.atan2(u,d),e[2]=Math.atan2(a,r)):(e[0]=0,e[2]=Math.atan2(-i,s))
break
case"YZX":e[2]=Math.asin((0,F.qE)(a,-1,1)),Math.abs(a)<.9999999?(e[0]=Math.atan2(-l,s),e[1]=Math.atan2(-c,r)):(e[0]=0,e[1]=Math.atan2(o,d))
break
case"XZY":e[2]=Math.asin(-(0,F.qE)(i,-1,1)),Math.abs(i)<.9999999?(e[0]=Math.atan2(u,s),e[1]=Math.atan2(o,r)):(e[0]=Math.atan2(-l,d),e[1]=0)
break
default:(0,N.dr)(n)}return e}e.zero=t,e.create=function(e,n,r){const i=t()
return i[0]=e,i[1]=n,i[2]=r,i},e.set=n,e.clone=function(e){const n=t()
return n[0]=e[0],n[1]=e[1],n[2]=e[2],n},e.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},e.fromMat4=r
const i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
e.fromQuat=function(e,t,n){return P.$.fromQuat(i,t),r(e,i,n)},e.fromVec3=function(e,t){return n(e,t[0],t[1],t[2])},e.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},e.fromArray=function(e,t,n){return e[0]=t[n+0],e[1]=t[n+1],e[2]=t[n+2],e},e.toArray=function(e,t,n){return t[n+0]=e[0],t[n+1]=e[1],t[n+2]=e[2],t}}(z||(z={}))
const j={opacity:u.t.Numeric(1,{min:0,max:1,step:.01}),saturation:u.t.Numeric(0,{min:-1,max:1,step:.01}),lightness:u.t.Numeric(0,{min:-1,max:1,step:.01})},V={faces:u.t.MappedStatic("urls",{urls:u.t.Group({nx:u.t.Text("",{label:"Negative X / Left"}),ny:u.t.Text("",{label:"Negative Y / Bottom"}),nz:u.t.Text("",{label:"Negative Z / Back"}),px:u.t.Text("",{label:"Positive X / Right"}),py:u.t.Text("",{label:"Positive Y / Top"}),pz:u.t.Text("",{label:"Positive Z / Front"})},{isExpanded:!0,label:"URLs"}),files:u.t.Group({nx:u.t.File({label:"Negative X / Left",accept:"image/*"}),ny:u.t.File({label:"Negative Y / Bottom",accept:"image/*"}),nz:u.t.File({label:"Negative Z / Back",accept:"image/*"}),px:u.t.File({label:"Positive X / Right",accept:"image/*"}),py:u.t.File({label:"Positive Y / Top",accept:"image/*"}),pz:u.t.File({label:"Positive Z / Front",accept:"image/*"})},{isExpanded:!0,label:"Files"})}),blur:u.t.Numeric(0,{min:0,max:1,step:.01},{description:'Note, this only works in WebGL2 or when "EXT_shader_texture_lod" is available.'}),rotation:u.t.Group({x:u.t.Numeric(0,{min:0,max:360,step:1},{immediateUpdate:!0}),y:u.t.Numeric(0,{min:0,max:360,step:1},{immediateUpdate:!0}),z:u.t.Numeric(0,{min:0,max:360,step:1},{immediateUpdate:!0})}),...j},U={source:u.t.MappedStatic("url",{url:u.t.Text(""),file:u.t.File({accept:"image/*"})}),blur:u.t.Numeric(0,{min:0,max:1,step:.01},{description:'Note, this only works in WebGL2 or with power-of-two images and when "EXT_shader_texture_lod" is available.'}),...j,coverage:u.t.Select("viewport",u.t.arrayToOptions(["viewport","canvas"]))},G={topColor:u.t.Color((0,p.Color)(14540253)),bottomColor:u.t.Color((0,p.Color)(15658734)),ratio:u.t.Numeric(.5,{min:0,max:1,step:.01}),coverage:u.t.Select("viewport",u.t.arrayToOptions(["viewport","canvas"]))},H={centerColor:u.t.Color((0,p.Color)(14540253)),edgeColor:u.t.Color((0,p.Color)(15658734)),ratio:u.t.Numeric(.5,{min:0,max:1,step:.01}),coverage:u.t.Select("viewport",u.t.arrayToOptions(["viewport","canvas"]))},q={variant:u.t.MappedStatic("off",{off:u.t.EmptyGroup(),skybox:u.t.Group(V,{isExpanded:!0}),image:u.t.Group(U,{isExpanded:!0}),horizontalGradient:u.t.Group(G,{isExpanded:!0}),radialGradient:u.t.Group(H,{isExpanded:!0})},{label:"Environment"})}
class Q{constructor(e,t,n,i){this.webgl=e,this.assetManager=t,this.camera=new E.i,this.target=(0,k.e)(),this.position=(0,k.e)(),this.dir=(0,k.e)(),this.bgColor=(0,k.e)(),this.renderable=function(e,t,n){const i={drawCount:B.IQ.create(6),instanceCount:B.IQ.create(1),aPosition:B.IQ.create(r.Wp),tSkybox:B.IQ.create((0,v.z6)()),tImage:B.IQ.create((0,v.z6)()),uImageScale:B.IQ.create((0,D.Z)()),uImageOffset:B.IQ.create((0,D.Z)()),uTexSize:B.IQ.create(D.Z.create(t,n)),uViewport:B.IQ.create((0,R.Z)()),uViewportAdjusted:B.IQ.create(!0),uViewDirectionProjectionInverse:B.IQ.create((0,P.$)()),uGradientColorA:B.IQ.create((0,k.e)()),uGradientColorB:B.IQ.create((0,k.e)()),uGradientRatio:B.IQ.create(.5),uBlur:B.IQ.create(0),uOpacity:B.IQ.create(1),uSaturation:B.IQ.create(0),uLightness:B.IQ.create(0),uRotation:B.IQ.create(L.U.identity()),dVariant:B.IQ.create("skybox")},o={...Z},a=(0,s.$h)(e,"triangles",K,o,i)
return(0,l._)(a,i)}(e,n,i)}setSize(e,t){const[n,r]=this.renderable.values.uTexSize.ref.value
e===n&&t===r||B.IQ.update(this.renderable.values.uTexSize,D.Z.set(this.renderable.values.uTexSize.ref.value,e,t))}clearSkybox(){void 0!==this.skybox&&(this.skybox.texture.destroy(),this.skybox.assets.forEach(e=>this.assetManager.release(e)),this.skybox=void 0)}updateSkybox(e,t,n){var r
const i=null===(r=this.skybox)||void 0===r?void 0:r.props.faces,o=t.faces.params
if(!(o.nx&&o.ny&&o.nz&&o.px&&o.py&&o.pz))return this.clearSkybox(),void(null==n||n(!1))
if(this.skybox&&i&&(a=t.faces,s=this.skybox.props.faces,X(a)===X(s)))null==n||n(!1)
else{this.clearSkybox()
const{texture:e,assets:r}=function(e,t,n,r){const i=function(e,t){return"urls"===t.name?{nx:M.V.getUrlAsset(e,t.params.nx),ny:M.V.getUrlAsset(e,t.params.ny),nz:M.V.getUrlAsset(e,t.params.nz),px:M.V.getUrlAsset(e,t.params.px),py:M.V.getUrlAsset(e,t.params.py),pz:M.V.getUrlAsset(e,t.params.pz)}:{nx:t.params.nx,ny:t.params.ny,nz:t.params.nz,px:t.params.px,py:t.params.py,pz:t.params.pz}}(t,n),o=function(e,t){const n=t=>e.resolve(t,"binary").run().then(e=>new Blob([e.data]))
return{nx:n(t.nx),ny:n(t.ny),nz:n(t.nz),px:n(t.px),py:n(t.py),pz:n(t.pz)}}(t,i),a=[i.nx,i.ny,i.nz,i.px,i.py,i.pz]
return"undefined"==typeof HTMLImageElement?(console.error('Missing "HTMLImageElement" required for background skybox'),null==r||r(!0),{texture:(0,v.z6)(),assets:a}):{texture:e.resources.cubeTexture(o,!0,r),assets:a}}(this.webgl,this.assetManager,t.faces,e=>{this.skybox&&(this.skybox.loaded=!e),null==n||n(!0)})
this.skybox={texture:e,props:{...t},assets:r,loaded:!1},B.IQ.update(this.renderable.values.tSkybox,e),this.renderable.update()}var a,s
if(!this.skybox)return
let l=e
"orthographic"===e.state.mode&&(this.camera.setState({...e.state,mode:"perspective"}),this.camera.update(),l=this.camera)
const c=this.renderable.values.uViewDirectionProjectionInverse.ref.value
P.$.isZero(e.headRotation)?(k.e.sub(this.dir,l.state.position,l.state.target),k.e.setMagnitude(this.dir,this.dir,.1),k.e.copy(this.position,this.dir),P.$.lookAt(c,this.position,this.target,l.state.up)):P.$.invert(c,e.headRotation),P.$.mul(c,l.projection,c),P.$.invert(c,c),B.IQ.update(this.renderable.values.uViewDirectionProjectionInverse,c)
const u=this.renderable.values.uRotation.ref.value
L.U.fromEuler(u,z.create((0,O.pu)(t.rotation.x),(0,O.pu)(t.rotation.y),(0,O.pu)(t.rotation.z)),"XYZ"),B.IQ.update(this.renderable.values.uRotation,u),B.IQ.updateIfChanged(this.renderable.values.uBlur,t.blur),B.IQ.updateIfChanged(this.renderable.values.uOpacity,t.opacity),B.IQ.updateIfChanged(this.renderable.values.uSaturation,t.saturation),B.IQ.updateIfChanged(this.renderable.values.uLightness,t.lightness),B.IQ.updateIfChanged(this.renderable.values.dVariant,"skybox"),this.renderable.update()}clearImage(){void 0!==this.image&&(this.image.texture.destroy(),this.assetManager.release(this.image.asset),this.image=void 0)}updateImage(e,t){if(!e.source.params)return this.clearImage(),void(null==t||t(!1))
if(this.image&&this.image.props.source.params&&(n=e.source,r=this.image.props.source,Y(n)===Y(r)))null==t||t(!1)
else{this.clearImage()
const{texture:n,asset:r}=function(e,t,n,r){var i
const o="url"===n.name?null!==(i=t.tryFindFilename(n.params))&&void 0!==i?i:M.V.getUrlAsset(t,n.params):n.params
if("undefined"==typeof HTMLImageElement)return console.error('Missing "HTMLImageElement" required for background image'),null==r||r(!0),{texture:(0,v.z6)(),asset:o}
const a=e.resources.texture("image-uint8","rgba","ubyte","linear"),s=new Image
return s.onload=()=>{a.load(s),(e.isWebGL2||(0,O.r6)(s.width)&&(0,O.r6)(s.height))&&a.mipmap(),null==r||r()},s.onerror=()=>{null==r||r(!0)},t.resolve(o,"binary").run().then(e=>{const t=new Blob([e.data])
s.src=URL.createObjectURL(t)}),{texture:a,asset:o}}(this.webgl,this.assetManager,e.source,e=>{this.image&&(this.image.loaded=!e),null==t||t(!0)})
this.image={texture:n,props:{...e},asset:r,loaded:!1},B.IQ.update(this.renderable.values.tImage,n),this.renderable.update()}var n,r
this.image&&(B.IQ.updateIfChanged(this.renderable.values.uBlur,e.blur),B.IQ.updateIfChanged(this.renderable.values.uOpacity,e.opacity),B.IQ.updateIfChanged(this.renderable.values.uSaturation,e.saturation),B.IQ.updateIfChanged(this.renderable.values.uLightness,e.lightness),B.IQ.updateIfChanged(this.renderable.values.uViewportAdjusted,"viewport"===e.coverage),B.IQ.updateIfChanged(this.renderable.values.dVariant,"image"),this.renderable.update())}updateImageScaling(){var e,t
const n=this.renderable.values,[r,i]=n.uTexSize.ref.value,o=(null===(e=this.image)||void 0===e?void 0:e.texture.getWidth())||0,a=(null===(t=this.image)||void 0===t?void 0:t.texture.getHeight())||0,s=r/i
s<o/a?B.IQ.update(n.uImageScale,D.Z.set(n.uImageScale.ref.value,o*i/a,i)):B.IQ.update(n.uImageScale,D.Z.set(n.uImageScale.ref.value,r,a*r/o))
const[l,c]=n.uImageScale.ref.value,u=l/c
u>s?B.IQ.update(n.uImageOffset,D.Z.set(n.uImageOffset.ref.value,(1-s/u)/2,0)):B.IQ.update(n.uImageOffset,D.Z.set(n.uImageOffset.ref.value,0,(1-u/s)/2))}updateGradient(e,t,n,r,i){B.IQ.update(this.renderable.values.uGradientColorA,p.Color.toVec3Normalized(this.renderable.values.uGradientColorA.ref.value,e)),B.IQ.update(this.renderable.values.uGradientColorB,p.Color.toVec3Normalized(this.renderable.values.uGradientColorB.ref.value,t)),B.IQ.updateIfChanged(this.renderable.values.uGradientRatio,n),B.IQ.updateIfChanged(this.renderable.values.uViewportAdjusted,i),B.IQ.updateIfChanged(this.renderable.values.dVariant,r),this.renderable.update()}update(e,t,n){if("off"===t.variant.name)return this.clearSkybox(),this.clearImage(),void(null==n||n(!1))
"skybox"===t.variant.name?(this.clearImage(),this.updateSkybox(e,t.variant.params,n)):"image"===t.variant.name?(this.clearSkybox(),this.updateImage(t.variant.params,n)):"horizontalGradient"===t.variant.name?(this.clearSkybox(),this.clearImage(),this.updateGradient(t.variant.params.topColor,t.variant.params.bottomColor,t.variant.params.ratio,t.variant.name,"viewport"===t.variant.params.coverage),null==n||n(!1)):"radialGradient"===t.variant.name&&(this.clearSkybox(),this.clearImage(),this.updateGradient(t.variant.params.centerColor,t.variant.params.edgeColor,t.variant.params.ratio,t.variant.name,"viewport"===t.variant.params.coverage),null==n||n(!1))
const{x:r,y:i,width:o,height:a}=e.viewport
B.IQ.update(this.renderable.values.uViewport,R.Z.set(this.renderable.values.uViewport.ref.value,r,i,o,a))}_isEnabled(e){return!!(this.skybox&&this.skybox.loaded||this.image&&this.image.loaded||"horizontalGradient"===e.variant.name||"radialGradient"===e.variant.name)}isEnabled(e){return e.enabled&&this._isEnabled(e.background)}isReady(){return!!(this.skybox&&this.skybox.loaded||this.image&&this.image.loaded||"horizontalGradient"===this.renderable.values.dVariant.ref.value||"radialGradient"===this.renderable.values.dVariant.ref.value)}clear(e,t,n){const{gl:r,state:i}=this.webgl
this._isEnabled(e)?(t?i.clearColor(0,0,0,0):(p.Color.toVec3Normalized(this.bgColor,n),i.clearColor(this.bgColor[0],this.bgColor[1],this.bgColor[2],1)),r.clear(r.COLOR_BUFFER_BIT),i.enable(r.BLEND),i.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA)):(i.clearColor(0,0,0,1),r.clear(r.COLOR_BUFFER_BIT))}render(e){this._isEnabled(e)&&this.isReady()&&("image"===this.renderable.values.dVariant.ref.value&&this.updateImageScaling(),h.g$&&this.webgl.timer.mark("BackgroundPass.render"),this.renderable.render(),h.g$&&this.webgl.timer.markEnd("BackgroundPass.render"))}dispose(){this.clearSkybox(),this.clearImage()}}const $="background-skybox"
function X(e){var t,n,r,i,o,a
return"urls"===e.name?`${$}_${e.params.nx}|${e.params.ny}|${e.params.nz}|${e.params.px}|${e.params.py}|${e.params.pz}`:`${$}_${null===(t=e.params.nx)||void 0===t?void 0:t.id}|${null===(n=e.params.ny)||void 0===n?void 0:n.id}|${null===(r=e.params.nz)||void 0===r?void 0:r.id}|${null===(i=e.params.px)||void 0===i?void 0:i.id}|${null===(o=e.params.py)||void 0===o?void 0:o.id}|${null===(a=e.params.pz)||void 0===a?void 0:a.id}`}const W="background-image"
function Y(e){var t
return"url"===e.name?`${W}_${e.params}`:`${W}_${null===(t=e.params)||void 0===t?void 0:t.id}`}const Z={drawCount:(0,i.Xb)("number"),instanceCount:(0,i.Xb)("number"),aPosition:(0,i.Yz)("float32",2,0),tSkybox:(0,i.$G)("texture","rgba","ubyte","linear"),tImage:(0,i.$G)("texture","rgba","ubyte","linear"),uImageScale:(0,i.w5)("v2"),uImageOffset:(0,i.w5)("v2"),uTexSize:(0,i.w5)("v2"),uViewport:(0,i.w5)("v4"),uViewportAdjusted:(0,i.w5)("b"),uViewDirectionProjectionInverse:(0,i.w5)("m4"),uGradientColorA:(0,i.w5)("v3"),uGradientColorB:(0,i.w5)("v3"),uGradientRatio:(0,i.w5)("f"),uBlur:(0,i.w5)("f"),uOpacity:(0,i.w5)("f"),uSaturation:(0,i.w5)("f"),uLightness:(0,i.w5)("f"),uRotation:(0,i.w5)("m3"),dVariant:(0,i.$F)("string",["skybox","image","verticalGradient","horizontalGradient","radialGradient"])},K=(0,o.NG)("background","\nprecision mediump float;\n\nattribute vec2 aPosition;\n\nvarying vec4 vPosition;\n\nvoid main() {\n    vPosition = vec4(aPosition, 1.0, 1.0);\n    gl_Position = vec4(aPosition, 1.0, 1.0);\n}\n","\nprecision mediump float;\nprecision mediump samplerCube;\nprecision mediump sampler2D;\n\n#if defined(dVariant_skybox)\n    uniform samplerCube tSkybox;\n    uniform mat4 uViewDirectionProjectionInverse;\n    uniform float uBlur;\n    uniform float uOpacity;\n    uniform float uSaturation;\n    uniform float uLightness;\n    uniform mat3 uRotation;\n#elif defined(dVariant_image)\n    uniform sampler2D tImage;\n    uniform vec2 uImageScale;\n    uniform vec2 uImageOffset;\n    uniform float uBlur;\n    uniform float uOpacity;\n    uniform float uSaturation;\n    uniform float uLightness;\n#elif defined(dVariant_horizontalGradient) || defined(dVariant_radialGradient)\n    uniform vec3 uGradientColorA;\n    uniform vec3 uGradientColorB;\n    uniform float uGradientRatio;\n#endif\n\nuniform vec2 uTexSize;\nuniform vec4 uViewport;\nuniform bool uViewportAdjusted;\nvarying vec4 vPosition;\n\n// TODO: add as general pp option to remove banding?\n// Iestyn's RGB dither from http://alex.vlachos.com/graphics/Alex_Vlachos_Advanced_VR_Rendering_GDC2015.pdf\nvec3 ScreenSpaceDither(vec2 vScreenPos) {\n    vec3 vDither = vec3(dot(vec2(171.0, 231.0), vScreenPos.xy));\n    vDither.rgb = fract(vDither.rgb / vec3(103.0, 71.0, 97.0));\n    return vDither.rgb / 255.0;\n}\n\nvec3 saturateColor(vec3 c, float amount) {\n    // https://www.w3.org/TR/WCAG21/#dfn-relative-luminance\n    const vec3 W = vec3(0.2125, 0.7154, 0.0721);\n    vec3 intensity = vec3(dot(c, W));\n    return mix(intensity, c, 1.0 + amount);\n}\n\nvec3 lightenColor(vec3 c, float amount) {\n    return c + amount;\n}\n\nvoid main() {\n    #if defined(dVariant_skybox)\n        vec4 t = uViewDirectionProjectionInverse * vPosition;\n        #ifdef enabledShaderTextureLod\n            gl_FragColor = textureCubeLodEXT(tSkybox, uRotation * normalize(t.xyz / t.w), uBlur * 8.0);\n        #else\n            gl_FragColor = textureCube(tSkybox, uRotation * normalize(t.xyz / t.w));\n        #endif\n        gl_FragColor.a = uOpacity;\n        gl_FragColor.rgb = lightenColor(saturateColor(gl_FragColor.rgb, uSaturation), uLightness);\n    #elif defined(dVariant_image)\n        vec2 coords;\n        if (uViewportAdjusted) {\n            coords = ((gl_FragCoord.xy - uViewport.xy) * (uTexSize / uViewport.zw) / uImageScale) + uImageOffset;\n        } else {\n            coords = (gl_FragCoord.xy / uImageScale) + uImageOffset;\n        }\n        #ifdef enabledShaderTextureLod\n            gl_FragColor = texture2DLodEXT(tImage, vec2(coords.x, 1.0 - coords.y), uBlur * 8.0);\n        #else\n            gl_FragColor = texture2D(tImage, vec2(coords.x, 1.0 - coords.y));\n        #endif\n        gl_FragColor.a = uOpacity;\n        gl_FragColor.rgb = lightenColor(saturateColor(gl_FragColor.rgb, uSaturation), uLightness);\n    #elif defined(dVariant_horizontalGradient)\n        float d;\n        if (uViewportAdjusted) {\n            d = ((gl_FragCoord.y - uViewport.y) * (uTexSize.y / uViewport.w) / uTexSize.y) + 1.0 - (uGradientRatio * 2.0);\n        } else {\n            d = (gl_FragCoord.y / uTexSize.y) + 1.0 - (uGradientRatio * 2.0);\n        }\n        gl_FragColor = vec4(mix(uGradientColorB, uGradientColorA, clamp(d, 0.0, 1.0)), 1.0);\n        gl_FragColor.rgb += ScreenSpaceDither(gl_FragCoord.xy);\n    #elif defined(dVariant_radialGradient)\n        float d;\n        if (uViewportAdjusted) {\n            d = distance(vec2(0.5), (gl_FragCoord.xy - uViewport.xy) * (uTexSize / uViewport.zw) / uTexSize) + uGradientRatio - 0.5;\n        } else {\n            d = distance(vec2(0.5), gl_FragCoord.xy / uTexSize) + uGradientRatio - 0.5;\n        }\n        gl_FragColor = vec4(mix(uGradientColorB, uGradientColorA, 1.0 - clamp(d, 0.0, 1.0)), 1.0);\n        gl_FragColor.rgb += ScreenSpaceDither(gl_FragCoord.xy);\n    #endif\n}\n",{shaderTextureLod:"optional"}),J={sharpness:u.t.Numeric(.5,{min:0,max:1,step:.05}),denoise:u.t.Boolean(!0)}
class ee{constructor(e,t){this.webgl=e,this.renderable=function(e,t){const n=t.getWidth(),i=t.getHeight(),o={...r.OM,tColor:a.IQ.create(t),uTexSizeInv:a.IQ.create(c.ZY.create(1/n,1/i)),uSharpness:a.IQ.create(.5),dDenoise:a.IQ.create(!0)},u={...te},d=(0,s.$h)(e,"triangles",ne,u,o)
return(0,l._)(d,o)}(e,t)}updateState(e){const{gl:t,state:n}=this.webgl
n.enable(t.SCISSOR_TEST),n.disable(t.BLEND),n.disable(t.DEPTH_TEST),n.depthMask(!1)
const{x:r,y:i,width:o,height:a}=e
n.viewport(r,i,o,a),n.scissor(r,i,o,a),n.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT)}setSize(e,t){a.IQ.update(this.renderable.values.uTexSizeInv,c.ZY.set(this.renderable.values.uTexSizeInv.ref.value,1/e,1/t))}update(e,t){const{values:n}=this.renderable,{sharpness:r,denoise:i}=t
let o=!1
n.tColor.ref.value!==e&&(a.IQ.update(this.renderable.values.tColor,e),o=!0),a.IQ.updateIfChanged(n.uSharpness,2-2*Math.pow(r,.25)),n.dDenoise.ref.value!==i&&(o=!0),a.IQ.updateIfChanged(n.dDenoise,i),o&&this.renderable.update()}render(e,t){h.g$&&this.webgl.timer.mark("CasPass.render"),t?t.bind():this.webgl.bindDrawingBuffer(),this.updateState(e),this.renderable.render(),h.g$&&this.webgl.timer.markEnd("CasPass.render")}}const te={...r.du,tColor:(0,i.$G)("texture","rgba","ubyte","linear"),uTexSizeInv:(0,i.w5)("v2"),uSharpness:(0,i.w5)("f"),dDenoise:(0,i.$F)("boolean")},ne=(0,o.NG)("cas",d.e,"\nprecision mediump float;\nprecision mediump sampler2D;\n\nuniform sampler2D tColor;\nuniform vec2 uTexSizeInv;\n\nuniform float uSharpness;\n\n// adapted from https://www.shadertoy.com/view/stXSWB\n\n/*\n* FidelityFX Super Resolution scales up a low resolution\n* image, while adding fine detail.\n*\n* MIT Open License\n*\n* https://gpuopen.com/fsr\n*\n* Left: FSR processed\n* Right: Original texture, bilinear interpolation\n*\n* Mouse at top: Sharpness 0 stops (maximum)\n* Mouse at bottom: Sharpness 2 stops (minimum)\n*\n* It works in two passes-\n*   EASU upsamples the image with a clamped Lanczos kernel.\n*   RCAS sharpens the image at the target resolution.\n*\n* I needed to make a few changes to improve readability and\n* WebGL compatibility in an algorithm I don't fully understand.\n* Expect bugs.\n*\n* Shader not currently running for WebGL1 targets (eg. mobile Safari)\n*\n* There is kind of no point to using FSR in Shadertoy, as it renders buffers\n* at full target resolution. But this might be useful for WebGL based demos\n* running smaller-than-target render buffers.\n*\n* For sharpening with a full resolution render buffer,\n* FidelityFX CAS is a better option.\n* https://www.shadertoy.com/view/ftsXzM\n*\n* For readability and compatibility, these optimisations have been removed:\n*   * Fast approximate inverse and inversesqrt\n*   * textureGather fetches (not WebGL compatible)\n*   * Multiplying by reciprocal instead of division\n*\n* Apologies to AMD for the numerous slowdowns and errors I have introduced.\n*\n*/\n\n/***** RCAS *****/\n#define FSR_RCAS_LIMIT (0.25-(1.0/16.0))\n\n// Input callback prototypes that need to be implemented by calling shader\nvec4 FsrRcasLoadF(vec2 p);\n//------------------------------------------------------------------------------------------------------------------------------\nvoid FsrRcasCon(\n    out float con,\n    // The scale is {0.0 := maximum, to N>0, where N is the number of stops (halving) of the reduction of sharpness}.\n    float sharpness\n) {\n    // Transform from stops to linear value.\n    con = exp2(-sharpness);\n}\n\nvec3 FsrRcasF(\n    vec2 ip, // Integer pixel position in output.\n    float con\n) {\n    // Constant generated by RcasSetup().\n    // Algorithm uses minimal 3x3 pixel neighborhood.\n    //    b\n    //  d e f\n    //    h\n    vec2 sp = vec2(ip);\n    vec3 b = FsrRcasLoadF(sp + vec2( 0,-1)).rgb;\n    vec3 d = FsrRcasLoadF(sp + vec2(-1, 0)).rgb;\n    vec3 e = FsrRcasLoadF(sp).rgb;\n    vec3 f = FsrRcasLoadF(sp + vec2( 1, 0)).rgb;\n    vec3 h = FsrRcasLoadF(sp + vec2( 0, 1)).rgb;\n\n    // Luma times 2.\n    float bL = b.g + .5 * (b.b + b.r);\n    float dL = d.g + .5 * (d.b + d.r);\n    float eL = e.g + .5 * (e.b + e.r);\n    float fL = f.g + .5 * (f.b + f.r);\n    float hL = h.g + .5 * (h.b + h.r);\n\n    // Noise detection.\n    #ifdef dDenoise\n        float nz = .25 * (bL + dL + fL + hL) - eL;\n        nz=clamp(\n            abs(nz)\n            /(\n                max(max(bL,dL),max(eL,max(fL,hL)))\n                -min(min(bL,dL),min(eL,min(fL,hL)))\n            ),\n            0., 1.\n        );\n        nz=1.-.5*nz;\n    #endif\n\n    // Min and max of ring.\n    vec3 mn4 = min(b, min(f, h));\n    vec3 mx4 = max(b, max(f, h));\n\n    // Immediate constants for peak range.\n    vec2 peakC = vec2(1., -4.);\n\n    // Limiters, these need to be high precision RCPs.\n    vec3 hitMin = mn4 / (4. * mx4);\n    vec3 hitMax = (peakC.x - mx4) / (4.* mn4 + peakC.y);\n    vec3 lobeRGB = max(-hitMin, hitMax);\n    float lobe = max(\n        -FSR_RCAS_LIMIT,\n        min(max(lobeRGB.r, max(lobeRGB.g, lobeRGB.b)), 0.)\n    )*con;\n\n    // Apply noise removal.\n    #ifdef dDenoise\n        lobe *= nz;\n    #endif\n\n    // Resolve, which needs the medium precision rcp approximation to avoid visible tonality changes.\n    return (lobe * (b + d + h + f) + e) / (4. * lobe + 1.);\n}\n\n\nvec4 FsrRcasLoadF(vec2 p) {\n    return texture2D(tColor, p * uTexSizeInv);\n}\n\nvoid main() {\n    // Set up constants\n    float con;\n    FsrRcasCon(con, uSharpness);\n\n    // Perform RCAS pass\n    vec3 col = FsrRcasF(gl_FragCoord.xy, con);\n\n    gl_FragColor = vec4(col, FsrRcasLoadF(gl_FragCoord.xy).a);\n}\n")
var re=n(18460),ie=n(38547),oe=n(42872),ae=n(56811)
const se={steps:u.t.Numeric(1,{min:1,max:64,step:1}),maxDistance:u.t.Numeric(3,{min:0,max:256,step:1}),tolerance:u.t.Numeric(1,{min:0,max:10,step:.1})}
class le{static isEnabled(e){return e.enabled&&"off"!==e.shadow.name}constructor(e,t,n,i){this.webgl=e,this.invProjection=c.$I.identity(),this.invHeadRotation=c.$I.identity(),this.target=e.createRenderTarget(t,n,!1),this.renderable=function(e,t){const n=t.getWidth(),i=t.getHeight(),u={...r.OM,tDepth:a.IQ.create(t),uTexSize:a.IQ.create(c.ZY.create(n,i)),uProjection:a.IQ.create(c.$I.identity()),uInvProjection:a.IQ.create(c.$I.identity()),uBounds:a.IQ.create((0,c.Zb)()),dOrthographic:a.IQ.create(0),uNear:a.IQ.create(1),uFar:a.IQ.create(1e4),dSteps:a.IQ.create(1),uMaxDistance:a.IQ.create(3),uTolerance:a.IQ.create(1),uLightDirection:a.IQ.create([]),uLightColor:a.IQ.create([]),dLightCount:a.IQ.create(0),uAmbientColor:a.IQ.create((0,c.eB)())},p={...ce},h=(0,o.NG)("shadows",d.e,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\n#include common\n\nuniform sampler2D tDepth;\nuniform vec2 uTexSize;\nuniform vec4 uBounds;\n\nuniform float uNear;\nuniform float uFar;\n\n#if dLightCount != 0\n    uniform vec3 uLightDirection[dLightCount];\n    uniform vec3 uLightColor[dLightCount];\n#endif\n\nuniform vec3 uAmbientColor;\n\nuniform mat4 uProjection;\nuniform mat4 uInvProjection;\n\nuniform float uMaxDistance;\nuniform float uTolerance;\n\n// Map full [0,1] coords -> bounds [0,1] coords\nvec2 fullCoordsToBoundsCoords(vec2 fullCoords) {\n    return (fullCoords - uBounds.xy) / (uBounds.zw - uBounds.xy);\n}\n\n// Map bounds [0,1] coords -> full [0,1] coords\nvec2 boundsCoordsToFullCoords(vec2 boundsCoords) {\n    return uBounds.xy + (uBounds.zw - uBounds.xy) * boundsCoords;\n}\n\nbool isBackground(const in float depth) {\n    return depth == 1.0;\n}\n\nbool outsideBounds(const in vec2 p) {\n    return p.x < uBounds.x || p.y < uBounds.y || p.x > uBounds.z || p.y > uBounds.w;\n}\n\nfloat getViewZ(const in float depth) {\n    #if dOrthographic == 1\n        return orthographicDepthToViewZ(depth, uNear, uFar);\n    #else\n        return perspectiveDepthToViewZ(depth, uNear, uFar);\n    #endif\n}\n\nfloat getDepth(const in vec2 coords) {\n    #ifdef depthTextureSupport\n        return texture2D(tDepth, coords).r;\n    #else\n        return unpackRGBAToDepth(texture2D(tDepth, coords));\n    #endif\n}\n\nfloat screenFade(const in vec2 coords) {\n    vec2 c = (coords - uBounds.xy) / (uBounds.zw - uBounds.xy);\n    vec2 fade = max(12.0 * abs(c - 0.5) - 5.0, vec2(0.0));\n    return saturate(1.0 - dot(fade, fade));\n}\n\n// based on https://panoskarabelas.com/posts/screen_space_shadows/\nvec3 screenSpaceShadow(const in vec3 position, const in vec3 lightDirection, const in vec3 lightColor, const in float stepLength) {\n    // Ray position and direction (in view-space)\n    vec3 rayPos = position;\n    vec3 rayDir = -lightDirection;\n\n    // Compute ray step\n    vec3 rayStep = rayDir * stepLength;\n\n    // Ray march towards the light\n    vec4 rayCoords = vec4(0.0);\n    for (int i = 0; i < dSteps; ++i) {\n        // Step the ray\n        rayPos += rayStep;\n\n        rayCoords = uProjection * vec4(rayPos, 1.0);\n        rayCoords.xyz = (rayCoords.xyz / rayCoords.w) * 0.5 + 0.5;\n        rayCoords.xy = boundsCoordsToFullCoords(rayCoords.xy);\n\n        if (outsideBounds(rayCoords.xy)) {\n            return lightColor;\n        }\n\n        // Compute the difference between the ray's and the camera's depth\n        float depth = getDepth(rayCoords.xy);\n        float viewZ = getViewZ(depth);\n        float zDelta = rayPos.z - viewZ;\n\n        if (zDelta < uTolerance) {\n            // Fade out as we approach the edges of the screen\n            return mix(vec3(0.0), lightColor, 1.0 - screenFade(rayCoords.xy));\n        }\n    }\n\n    return lightColor;\n}\n\nvoid main(void) {\n    vec2 invTexSize = 1.0 / uTexSize;\n    vec2 selfCoords = gl_FragCoord.xy * invTexSize;\n    float selfDepth = getDepth(selfCoords);\n\n    if (isBackground(selfDepth)) {\n        gl_FragColor = vec4(0.0);\n        return;\n    }\n\n    vec2 selfBoundsCoords = fullCoordsToBoundsCoords(selfCoords);\n    if (any(lessThan(selfBoundsCoords, vec2(0.0))) || any(greaterThan(selfBoundsCoords, vec2(1.0)))) {\n        gl_FragColor = vec4(0.0);\n        return;\n    }\n\n    vec3 selfViewPos = screenSpaceToViewSpace(vec3(selfBoundsCoords, selfDepth), uInvProjection);\n    float stepLength = uMaxDistance / float(dSteps);\n\n    float l = length(uAmbientColor);\n    float a = l;\n    #if dLightCount != 0\n        vec3 s;\n        #pragma unroll_loop_start\n        for (int i = 0; i < dLightCount; ++i) {\n            s = screenSpaceShadow(selfViewPos, uLightDirection[i], uLightColor[i], stepLength);\n            l += length(s);\n            a += length(uLightColor[i]);\n        }\n        #pragma unroll_loop_end\n    #endif\n\n    gl_FragColor = vec4(l / a);\n}\n"),f=(0,s.$h)(e,"triangles",h,p,u)
return(0,l._)(f,u)}(e,i)}getByteCount(){return this.target.getByteCount()}setSize(e,t){const[n,r]=this.renderable.values.uTexSize.ref.value
e===n&&t===r||(this.target.setSize(e,t),a.IQ.update(this.renderable.values.uTexSize,c.ZY.set(this.renderable.values.uTexSize.ref.value,e,t)))}update(e,t,n,r){let i=!1
const o="orthographic"===e.state.mode?1:0,[s,l]=this.renderable.values.uTexSize.ref.value,u=e.viewport
a.IQ.update(this.renderable.values.uProjection,e.projection),a.IQ.update(this.renderable.values.uInvProjection,c.$I.invert(this.invProjection,e.projection)),c.Zb.set(this.renderable.values.uBounds.ref.value,u.x/s,u.y/l,(u.x+u.width)/s,(u.y+u.height)/l),a.IQ.update(this.renderable.values.uBounds,this.renderable.values.uBounds.ref.value),a.IQ.updateIfChanged(this.renderable.values.uNear,e.near),a.IQ.updateIfChanged(this.renderable.values.uFar,e.far),this.renderable.values.dOrthographic.ref.value!==o&&(a.IQ.update(this.renderable.values.dOrthographic,o),i=!0),a.IQ.updateIfChanged(this.renderable.values.uMaxDistance,r.maxDistance*e.scale),a.IQ.updateIfChanged(this.renderable.values.uTolerance,r.tolerance*e.scale),this.renderable.values.dSteps.ref.value!==r.steps&&(a.IQ.update(this.renderable.values.dSteps,r.steps),i=!0),c.$I.isZero(e.headRotation)?a.IQ.update(this.renderable.values.uLightDirection,t.direction):a.IQ.update(this.renderable.values.uLightDirection,(0,ae.Fy)(t,c.$I.invert(this.invHeadRotation,e.headRotation))),a.IQ.update(this.renderable.values.uLightColor,t.color),this.renderable.values.dLightCount.ref.value!==t.count&&(a.IQ.update(this.renderable.values.dLightCount,t.count),i=!0),a.IQ.update(this.renderable.values.uAmbientColor,n),i&&this.renderable.update()}render(){h.g$&&this.webgl.timer.mark("ShadowPass.render"),this.target.bind(),this.renderable.render(),h.g$&&this.webgl.timer.markEnd("ShadowPass.render")}}const ce={...r.du,tDepth:(0,i.$G)("texture","rgba","ubyte","nearest"),uTexSize:(0,i.w5)("v2"),uProjection:(0,i.w5)("m4"),uInvProjection:(0,i.w5)("m4"),uBounds:(0,i.w5)("v4"),dOrthographic:(0,i.$F)("number"),uNear:(0,i.w5)("f"),uFar:(0,i.w5)("f"),dSteps:(0,i.$F)("number"),uMaxDistance:(0,i.w5)("f"),uTolerance:(0,i.w5)("f"),uLightDirection:(0,i.w5)("v3[]"),uLightColor:(0,i.w5)("v3[]"),dLightCount:(0,i.$F)("number"),uAmbientColor:(0,i.w5)("v3")},ue={samples:u.t.Numeric(32,{min:1,max:256,step:1}),multiScale:u.t.MappedStatic("off",{on:u.t.Group({levels:u.t.ObjectList({radius:u.t.Numeric(5,{min:0,max:20,step:.1},{description:"Final occlusion radius is 2^x"}),bias:u.t.Numeric(1,{min:0,max:3,step:.1})},e=>`${e.radius}, ${e.bias}`,{defaultValue:[{radius:2,bias:1},{radius:5,bias:1},{radius:8,bias:1},{radius:11,bias:1}]}),nearThreshold:u.t.Numeric(10,{min:0,max:50,step:1}),farThreshold:u.t.Numeric(1500,{min:0,max:1e4,step:100})}),off:u.t.Group({})},{cycle:!0}),radius:u.t.Numeric(5,{min:0,max:20,step:.1},{description:"Final occlusion radius is 2^x",hideIf:e=>"on"===(null==e?void 0:e.multiScale.name)}),bias:u.t.Numeric(.8,{min:0,max:3,step:.1}),blurKernelSize:u.t.Numeric(15,{min:1,max:25,step:2}),blurDepthBias:u.t.Numeric(.5,{min:0,max:1,step:.01}),resolutionScale:u.t.Numeric(1,{min:.1,max:1,step:.05},{description:"Adjust resolution of occlusion calculation"}),color:u.t.Color((0,p.Color)(0)),transparentThreshold:u.t.Numeric(.4,{min:0,max:1,step:.05})}
class de{static isEnabled(e){return e.enabled&&"off"!==e.occlusion.name}static isTransparentEnabled(e,t){return e.opacityAverage<1&&e.transparencyMin<t.transparentThreshold}calcSsaoScale(e){return Math.min(1,1/this.webgl.pixelRatio)*e}getDepthTexture(){return 1===this.ssaoScale?this.depthTextureOpaque:this.downsampledDepthTargetOpaque.texture}getTransparentDepthTexture(){return 1===this.ssaoScale?this.depthTextureTransparent:this.downsampledDepthTargetTransparent.texture}constructor(e,t,n,i,u,p){this.webgl=e,this.invProjection=c.$I.identity(),this.levelsCameraScale=-1
const{textureFloatLinear:h}=e.extensions
this.depthTextureOpaque=u,this.depthTextureTransparent=p,this.nSamples=1,this.blurKernelSize=1,this.ssaoScale=this.calcSsaoScale(1),this.texSize=[t,n],this.levels=[],this.framebuffer=e.resources.framebuffer(),this.blurFirstPassFramebuffer=e.resources.framebuffer(),this.blurSecondPassFramebuffer=e.resources.framebuffer()
const f=Math.floor(t*this.ssaoScale),m=Math.floor(n*this.ssaoScale),g=Math.max(1,Math.floor(.5*f)),y=Math.max(1,Math.floor(.5*m)),v=Math.max(1,Math.floor(.25*f)),b=Math.max(1,Math.floor(.25*m)),x=h?"linear":"nearest"
this.downsampledDepthTargetOpaque=i?e.createRenderTarget(f,m,!1,"uint8","linear","rgba"):e.createRenderTarget(f,m,!1,"float32",x,e.isWebGL2?"alpha":"rgba"),this.downsampleDepthRenderableOpaque=(0,r._0)(e,u)
const S=this.getDepthTexture()
this.depthHalfTargetOpaque=i?e.createRenderTarget(g,y,!1,"uint8","linear","rgba"):e.createRenderTarget(g,y,!1,"float32",x,e.isWebGL2?"alpha":"rgba"),this.depthHalfRenderableOpaque=(0,r._0)(e,S),this.depthQuarterTargetOpaque=i?e.createRenderTarget(v,b,!1,"uint8","linear","rgba"):e.createRenderTarget(v,b,!1,"float32",x,e.isWebGL2?"alpha":"rgba"),this.depthQuarterRenderableOpaque=(0,r._0)(e,this.depthHalfTargetOpaque.texture),this.downsampledDepthTargetTransparent=e.createRenderTarget(f,m,!1,"uint8","linear","rgba"),this.downsampleDepthRenderableTransparent=(0,r._0)(e,p)
const _=this.getTransparentDepthTexture()
this.depthHalfTargetTransparent=e.createRenderTarget(g,y,!1,"uint8","linear","rgba"),this.depthHalfRenderableTransparent=(0,r._0)(e,_),this.depthQuarterTargetTransparent=e.createRenderTarget(v,b,!1,"uint8","linear","rgba"),this.depthQuarterRenderableTransparent=(0,r._0)(e,this.depthHalfTargetTransparent.texture),this.ssaoDepthTexture=e.resources.texture("image-uint8","rgba","ubyte","linear"),this.ssaoDepthTexture.define(f,m),this.ssaoDepthTexture.attachFramebuffer(this.framebuffer,"color0"),this.ssaoDepthTransparentTexture=e.resources.texture("image-uint8","rgba","ubyte","linear"),this.ssaoDepthTransparentTexture.define(f,m),this.depthBlurProxyTexture=e.resources.texture("image-uint8","rgba","ubyte","linear"),this.depthBlurProxyTexture.define(f,m),this.depthBlurProxyTexture.attachFramebuffer(this.blurFirstPassFramebuffer,"color0"),this.renderable=function(e,t,n,i,u,p,h){const f={...r.OM,tDepth:a.IQ.create(t),tDepthHalf:a.IQ.create(n),tDepthQuarter:a.IQ.create(i),dIllumination:a.IQ.create(!1),dIncludeTransparent:a.IQ.create(!0),uTransparencyFlag:a.IQ.create(0),tDepthTransparent:a.IQ.create(u),tDepthHalfTransparent:a.IQ.create(p),tDepthQuarterTransparent:a.IQ.create(h),uSamples:a.IQ.create(ye(32)),dNSamples:a.IQ.create(32),uProjection:a.IQ.create(c.$I.identity()),uInvProjection:a.IQ.create(c.$I.identity()),uBounds:a.IQ.create((0,c.Zb)()),uTexSize:a.IQ.create(c.ZY.create(e.gl.drawingBufferWidth,e.gl.drawingBufferHeight)),uRadius:a.IQ.create(Math.pow(2,5)),uBias:a.IQ.create(.8),dMultiScale:a.IQ.create(!1),dLevels:a.IQ.create(3),uLevelRadius:a.IQ.create([Math.pow(2,2),Math.pow(2,5),Math.pow(2,8)]),uLevelBias:a.IQ.create([.8,.8,.8]),uNearThreshold:a.IQ.create(10),uFarThreshold:a.IQ.create(1500)},m={...pe},g=(0,o.NG)("ssao",d.e,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\n#include common\n\n\nuniform sampler2D tDepth;\nuniform sampler2D tDepthHalf;\nuniform sampler2D tDepthQuarter;\n\n#if defined(dIncludeTransparent)\n    uniform sampler2D tDepthTransparent;\n    uniform sampler2D tDepthHalfTransparent;\n    uniform sampler2D tDepthQuarterTransparent;\n#endif\n\nuniform int uTransparencyFlag;\n\nuniform vec2 uTexSize;\nuniform vec4 uBounds;\n\nuniform vec3 uSamples[dNSamples];\n\nuniform mat4 uProjection;\nuniform mat4 uInvProjection;\n\n#ifdef dMultiScale\n    uniform float uLevelRadius[dLevels];\n    uniform float uLevelBias[dLevels];\n    uniform float uNearThreshold;\n    uniform float uFarThreshold;\n#else\n    uniform float uRadius;\n#endif\nuniform float uBias;\n\nfloat smootherstep(float edge0, float edge1, float x) {\n    x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\n    return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);\n}\n\nfloat noise(const in vec2 coords) {\n    float a = 12.9898;\n    float b = 78.233;\n    float c = 43758.5453;\n    float dt = dot(coords, vec2(a,b));\n    float sn = mod(dt, PI);\n    return abs(fract(sin(sn) * c)); // is abs necessary?\n}\n\nvec2 getNoiseVec2(const in vec2 coords) {\n    return vec2(noise(coords), noise(coords + vec2(PI, 2.71828)));\n}\n\nbool isBackground(const in float depth) {\n    return depth == 1.0;\n}\n\nfloat getDepth(const in vec2 coords, const in int transparentFlag) {\n    vec2 c = vec2(clamp(coords.x, uBounds.x, uBounds.z), clamp(coords.y, uBounds.y, uBounds.w));\n    if (transparentFlag == 1){\n        #if defined(dIncludeTransparent)\n            return unpackRGBAToDepthWithAlpha(texture2D(tDepthTransparent, c)).x;\n        #else\n            return 1.0;\n        #endif\n    } else {\n        #ifdef depthTextureSupport\n            return texture2D(tDepth, c).r;\n        #else\n            return unpackRGBAToDepth(texture2D(tDepth, c));\n        #endif\n    }\n}\n\n#if defined(dIncludeTransparent)\n    vec2 getDepthTransparentWithAlpha(const in vec2 coords){\n        vec2 c = vec2(clamp(coords.x, uBounds.x, uBounds.z), clamp(coords.y, uBounds.y, uBounds.w));\n        return unpackRGBAToDepthWithAlpha(texture2D(tDepthTransparent, c));\n    }\n#endif\n\n#define dQuarterThreshold 0.1\n#define dHalfThreshold 0.05\n\nfloat getMappedDepth(const in vec2 coords, const in vec2 selfCoords) {\n    vec2 c = vec2(clamp(coords.x, uBounds.x, uBounds.z), clamp(coords.y, uBounds.y, uBounds.w));\n    float d = distance(coords, selfCoords);\n    #ifdef depthTextureSupport\n        if (d > dQuarterThreshold) {\n            return texture2D(tDepthQuarter, c).r;\n        } else if (d > dHalfThreshold) {\n            return texture2D(tDepthHalf, c).r;\n        } else {\n            return texture2D(tDepth, c).r;\n        }\n    #else\n        if (d > dQuarterThreshold) {\n            return unpackRGBAToDepth(texture2D(tDepthQuarter, c));\n        } else if (d > dHalfThreshold) {\n            return unpackRGBAToDepth(texture2D(tDepthHalf, c));\n        } else {\n            return unpackRGBAToDepth(texture2D(tDepth, c));\n        }\n    #endif\n}\n\n#if defined(dIncludeTransparent)\n    vec2 getMappedDepthTransparentWithAlpha(const in vec2 coords, const in vec2 selfCoords) {\n        vec2 c = vec2(clamp(coords.x, uBounds.x, uBounds.z), clamp(coords.y, uBounds.y, uBounds.w));\n        float d = distance(coords, selfCoords);\n        if (d > dQuarterThreshold) {\n            return unpackRGBAToDepthWithAlpha(texture2D(tDepthQuarterTransparent, c));\n        } else if (d > dHalfThreshold) {\n            return unpackRGBAToDepthWithAlpha(texture2D(tDepthHalfTransparent, c));\n        } else {\n            return unpackRGBAToDepthWithAlpha(texture2D(tDepthTransparent, c));\n        }\n    }\n#endif\n\n// adapted from https://gist.github.com/bgolus/a07ed65602c009d5e2f753826e8078a0\nvec3 viewNormalAtPixelPositionAccurate(const in vec2 vpos, const in int transparentFlag) {\n    // current pixel's depth\n    float c = getDepth(vpos, transparentFlag);\n\n    // get current pixel's view space position\n    vec3 viewSpacePos_c = screenSpaceToViewSpace(vec3(vpos, c), uInvProjection);\n\n    // get view space position at 1 pixel offsets in each major direction\n    vec3 viewSpacePos_l = screenSpaceToViewSpace(vec3(vpos + vec2(-1.0, 0.0) / uTexSize, getDepth(vpos + vec2(-1.0, 0.0) / uTexSize, transparentFlag)), uInvProjection);\n    vec3 viewSpacePos_r = screenSpaceToViewSpace(vec3(vpos + vec2( 1.0, 0.0) / uTexSize, getDepth(vpos + vec2( 1.0, 0.0) / uTexSize, transparentFlag)), uInvProjection);\n    vec3 viewSpacePos_d = screenSpaceToViewSpace(vec3(vpos + vec2( 0.0,-1.0) / uTexSize, getDepth(vpos + vec2( 0.0,-1.0) / uTexSize, transparentFlag)), uInvProjection);\n    vec3 viewSpacePos_u = screenSpaceToViewSpace(vec3(vpos + vec2( 0.0, 1.0) / uTexSize, getDepth(vpos + vec2( 0.0, 1.0) / uTexSize, transparentFlag)), uInvProjection);\n\n    // get the difference between the current and each offset position\n    vec3 l = viewSpacePos_c - viewSpacePos_l;\n    vec3 r = viewSpacePos_r - viewSpacePos_c;\n    vec3 d = viewSpacePos_c - viewSpacePos_d;\n    vec3 u = viewSpacePos_u - viewSpacePos_c;\n\n    // get depth values at 1 & 2 pixels offsets from current along the horizontal axis\n    vec4 H = vec4(\n        getDepth(vpos + vec2(-1.0, 0.0) / uTexSize, transparentFlag),\n        getDepth(vpos + vec2( 1.0, 0.0) / uTexSize, transparentFlag),\n        getDepth(vpos + vec2(-2.0, 0.0) / uTexSize, transparentFlag),\n        getDepth(vpos + vec2( 2.0, 0.0) / uTexSize, transparentFlag)\n    );\n\n    // get depth values at 1 & 2 pixels offsets from current along the vertical axis\n    vec4 V = vec4(\n        getDepth(vpos + vec2(0.0,-1.0) / uTexSize, transparentFlag),\n        getDepth(vpos + vec2(0.0, 1.0) / uTexSize, transparentFlag),\n        getDepth(vpos + vec2(0.0,-2.0) / uTexSize, transparentFlag),\n        getDepth(vpos + vec2(0.0, 2.0) / uTexSize, transparentFlag)\n    );\n\n    // current pixel's depth difference from slope of offset depth samples\n    // differs from original article because we're using non-linear depth values\n    // see article's comments\n    vec2 he = abs((2.0 * H.xy - H.zw) - c);\n    vec2 ve = abs((2.0 * V.xy - V.zw) - c);\n\n    // pick horizontal and vertical diff with the smallest depth difference from slopes\n    vec3 hDeriv = he.x < he.y ? l : r;\n    vec3 vDeriv = ve.x < ve.y ? d : u;\n\n    // get view space normal from the cross product of the best derivatives\n    vec3 viewNormal = normalize(cross(hDeriv, vDeriv));\n\n    return viewNormal;\n}\n\nfloat getPixelSize(const in vec2 coords, const in float depth) {\n    vec3 viewPos0 = screenSpaceToViewSpace(vec3(coords, depth), uInvProjection);\n    vec3 viewPos1 = screenSpaceToViewSpace(vec3(coords + vec2(1.0, 0.0) / uTexSize, depth), uInvProjection);\n    return distance(viewPos0, viewPos1);\n}\n\n// StarCraft II Ambient Occlusion by [Filion and McNaughton 2008]\nvoid main(void) {\n    vec2 invTexSize = 1.0 / uTexSize;\n    vec2 selfCoords = gl_FragCoord.xy * invTexSize;\n    float selfDepth = getDepth(selfCoords, uTransparencyFlag);\n    vec2 selfPackedDepth = packUnitIntervalToRG(selfDepth);\n\n    if (isBackground(selfDepth)) {\n        gl_FragColor = vec4(packUnitIntervalToRG(1.0), selfPackedDepth);\n        return;\n    }\n\n    vec3 selfViewNormal = viewNormalAtPixelPositionAccurate(selfCoords, uTransparencyFlag);\n    vec3 selfViewPos = screenSpaceToViewSpace(vec3(selfCoords, selfDepth), uInvProjection);\n\n    vec3 randomVec = normalize(vec3(getNoiseVec2(selfCoords) * 2.0 - 1.0, 0.0));\n    vec3 tangent = normalize(randomVec - selfViewNormal * dot(randomVec, selfViewNormal));\n    vec3 bitangent = cross(selfViewNormal, tangent);\n    mat3 TBN = mat3(tangent, bitangent, selfViewNormal);\n\n    float occlusion = 0.0;\n    #ifdef dMultiScale\n        float pixelSize = getPixelSize(selfCoords, selfDepth);\n\n        for(int l = 0; l < dLevels; l++) {\n            // TODO: smooth transition\n            if (pixelSize * uNearThreshold > uLevelRadius[l]) continue;\n            if (pixelSize * uFarThreshold < uLevelRadius[l]) continue;\n\n            float levelOcclusion = 0.0;\n            for(int i = 0; i < dNSamples; i++) {\n                // get sample position:\n                vec3 sampleViewPos = TBN * uSamples[i];\n                sampleViewPos = selfViewPos + sampleViewPos * uLevelRadius[l];\n\n                // project sample position:\n                vec4 offset = vec4(sampleViewPos, 1.0);\n                offset = uProjection * offset;\n                offset.xyz = (offset.xyz / offset.w) * 0.5 + 0.5;\n\n                // get sample depth:\n                float sampleOcc = 0.0;\n                #ifdef dIllumination\n                    if (uTransparencyFlag == 1) {\n                #endif\n                    float sampleDepth = getMappedDepth(offset.xy, selfCoords);\n                    float sampleViewZ = screenSpaceToViewSpace(vec3(offset.xy, sampleDepth), uInvProjection).z;\n\n                    sampleOcc = step(sampleViewPos.z + 0.025, sampleViewZ) * smootherstep(0.0, 1.0, uLevelRadius[l] / abs(selfViewPos.z - sampleViewZ)) * uLevelBias[l];\n                #ifdef dIllumination\n                    }\n                #endif\n                #if defined(dIncludeTransparent)\n                    vec2 sampleDepthWithAlpha = getMappedDepthTransparentWithAlpha(offset.xy, selfCoords);\n                    if (!isBackground(sampleDepthWithAlpha.x)) {\n                        float sampleViewZ = screenSpaceToViewSpace(vec3(offset.xy, sampleDepthWithAlpha.x), uInvProjection).z;\n                        sampleOcc = max(sampleOcc, step(sampleViewPos.z + 0.025, sampleViewZ) * smootherstep(0.0, 1.0, uLevelRadius[l] / abs(selfViewPos.z - sampleViewZ)) * uLevelBias[l] * sampleDepthWithAlpha.y);\n                    }\n                #endif\n\n                levelOcclusion += sampleOcc;\n            }\n            occlusion = max(occlusion, levelOcclusion);\n        }\n    #else\n        for(int i = 0; i < dNSamples; i++) {\n            vec3 sampleViewPos = TBN * uSamples[i];\n            sampleViewPos = selfViewPos + sampleViewPos * uRadius;\n\n            vec4 offset = vec4(sampleViewPos, 1.0);\n            offset = uProjection * offset;\n            offset.xyz = (offset.xyz / offset.w) * 0.5 + 0.5;\n\n            float sampleOcc = 0.0;\n            #ifdef dIllumination\n                if (uTransparencyFlag == 1) {\n            #endif\n                    // NOTE: using getMappedDepth here causes issues on some mobile devices\n                    float sampleDepth = getDepth(offset.xy, 0);\n                    float sampleViewZ = screenSpaceToViewSpace(vec3(offset.xy, sampleDepth), uInvProjection).z;\n\n                    sampleOcc = step(sampleViewPos.z + 0.025, sampleViewZ) * smootherstep(0.0, 1.0, uRadius / abs(selfViewPos.z - sampleViewZ));\n            #ifdef dIllumination\n                }\n            #endif\n            #if defined(dIncludeTransparent)\n                vec2 sampleDepthWithAlpha = getDepthTransparentWithAlpha(offset.xy);\n                if (!isBackground(sampleDepthWithAlpha.x)) {\n                    float sampleViewZ = screenSpaceToViewSpace(vec3(offset.xy, sampleDepthWithAlpha.x), uInvProjection).z;\n                    sampleOcc = max(sampleOcc, step(sampleViewPos.z + 0.025, sampleViewZ) * smootherstep(0.0, 1.0, uRadius / abs(selfViewPos.z - sampleViewZ)) * sampleDepthWithAlpha.y);\n                }\n            #endif\n\n            occlusion += sampleOcc;\n        }\n    #endif\n    occlusion = 1.0 - (uBias * occlusion / float(dNSamples));\n\n    vec2 packedOcclusion = packUnitIntervalToRG(clamp(occlusion, 0.01, 1.0));\n\n    gl_FragColor = vec4(packedOcclusion, selfPackedDepth);\n}\n"),y=(0,s.$h)(e,"triangles",g,m,f)
return(0,l._)(y,f)}(e,S,this.depthHalfTargetOpaque.texture,this.depthQuarterTargetOpaque.texture,_,this.depthHalfTargetTransparent.texture,this.depthQuarterTargetTransparent.texture),this.blurFirstPassRenderable=fe(e,this.ssaoDepthTransparentTexture,"horizontal"),this.blurSecondPassRenderable=fe(e,this.depthBlurProxyTexture,"vertical")}getByteCount(){return this.downsampledDepthTargetOpaque.getByteCount()+this.depthHalfTargetOpaque.getByteCount()+this.depthQuarterTargetOpaque.getByteCount()+this.downsampledDepthTargetTransparent.getByteCount()+this.depthHalfTargetTransparent.getByteCount()+this.depthQuarterTargetTransparent.getByteCount()+this.ssaoDepthTexture.getByteCount()+this.ssaoDepthTransparentTexture.getByteCount()+this.depthBlurProxyTexture.getByteCount()}setSize(e,t){const[n,r]=this.texSize,i=this.calcSsaoScale(1)
if(e!==n||t!==r||this.ssaoScale!==i){this.texSize.splice(0,2,e,t)
const n=Math.floor(e*this.ssaoScale),r=Math.floor(t*this.ssaoScale)
this.ssaoDepthTexture.define(n,r),this.ssaoDepthTransparentTexture.define(n,r),this.depthBlurProxyTexture.define(n,r)
const i=Math.max(1,Math.floor(.5*n)),o=Math.max(1,Math.floor(.5*r)),s=Math.max(1,Math.floor(.25*n)),l=Math.max(1,Math.floor(.25*r))
this.downsampledDepthTargetOpaque.setSize(n,r),this.depthHalfTargetOpaque.setSize(i,o),this.depthQuarterTargetOpaque.setSize(s,l),a.IQ.update(this.downsampleDepthRenderableOpaque.values.uTexSize,c.ZY.set(this.downsampleDepthRenderableOpaque.values.uTexSize.ref.value,n,r)),a.IQ.update(this.depthHalfRenderableOpaque.values.uTexSize,c.ZY.set(this.depthHalfRenderableOpaque.values.uTexSize.ref.value,i,o)),a.IQ.update(this.depthQuarterRenderableOpaque.values.uTexSize,c.ZY.set(this.depthQuarterRenderableOpaque.values.uTexSize.ref.value,s,l)),this.downsampledDepthTargetTransparent.setSize(n,r),this.depthHalfTargetTransparent.setSize(i,o),this.depthQuarterTargetTransparent.setSize(s,l),a.IQ.update(this.downsampleDepthRenderableTransparent.values.uTexSize,c.ZY.set(this.downsampleDepthRenderableTransparent.values.uTexSize.ref.value,n,r)),a.IQ.update(this.depthHalfRenderableTransparent.values.uTexSize,c.ZY.set(this.depthHalfRenderableTransparent.values.uTexSize.ref.value,i,o)),a.IQ.update(this.depthQuarterRenderableTransparent.values.uTexSize,c.ZY.set(this.depthQuarterRenderableTransparent.values.uTexSize.ref.value,s,l)),a.IQ.update(this.renderable.values.uTexSize,c.ZY.set(this.renderable.values.uTexSize.ref.value,n,r)),a.IQ.update(this.blurFirstPassRenderable.values.uTexSize,c.ZY.set(this.blurFirstPassRenderable.values.uTexSize.ref.value,n,r)),a.IQ.update(this.blurSecondPassRenderable.values.uTexSize,c.ZY.set(this.blurSecondPassRenderable.values.uTexSize.ref.value,n,r))
const u=this.getDepthTexture(),d=this.getTransparentDepthTexture()
a.IQ.update(this.depthHalfRenderableOpaque.values.tColor,u),a.IQ.update(this.depthHalfRenderableTransparent.values.tColor,d),a.IQ.update(this.renderable.values.tDepth,u),a.IQ.update(this.renderable.values.tDepthTransparent,d),this.depthHalfRenderableOpaque.update(),this.depthHalfRenderableTransparent.update(),this.renderable.update()}}reset(){this.ssaoDepthTexture.attachFramebuffer(this.framebuffer,"color0"),this.depthBlurProxyTexture.attachFramebuffer(this.blurFirstPassFramebuffer,"color0")}update(e,t,n,r=!1){let i=!1,o=!1,s=!1
const l="orthographic"===e.state.mode?1:0,u=c.$I.invert(this.invProjection,e.projection),[d,p]=this.texSize,h=e.viewport
a.IQ.update(this.renderable.values.uProjection,e.projection),a.IQ.update(this.renderable.values.uInvProjection,u)
const f=this.renderable.values.uBounds,m=this.ssaoScale
c.Zb.set(f.ref.value,Math.floor(h.x*m)/(d*m),Math.floor(h.y*m)/(p*m),Math.ceil((h.x+h.width)*m)/(d*m),Math.ceil((h.y+h.height)*m)/(p*m)),a.IQ.update(f,f.ref.value),a.IQ.update(this.blurFirstPassRenderable.values.uBounds,f.ref.value),a.IQ.update(this.blurSecondPassRenderable.values.uBounds,f.ref.value),a.IQ.updateIfChanged(this.blurFirstPassRenderable.values.uNear,e.near),a.IQ.updateIfChanged(this.blurSecondPassRenderable.values.uNear,e.near),a.IQ.updateIfChanged(this.blurFirstPassRenderable.values.uFar,e.far),a.IQ.updateIfChanged(this.blurSecondPassRenderable.values.uFar,e.far),a.IQ.update(this.blurFirstPassRenderable.values.uInvProjection,u),a.IQ.update(this.blurSecondPassRenderable.values.uInvProjection,u),a.IQ.update(this.blurFirstPassRenderable.values.uBlurDepthBias,n.blurDepthBias*e.scale),a.IQ.update(this.blurSecondPassRenderable.values.uBlurDepthBias,n.blurDepthBias*e.scale),this.blurFirstPassRenderable.values.dOrthographic.ref.value!==l&&(o=!0,a.IQ.update(this.blurFirstPassRenderable.values.dOrthographic,l),a.IQ.update(this.blurSecondPassRenderable.values.dOrthographic,l))
const g=de.isTransparentEnabled(t,n)
this.renderable.values.dIncludeTransparent.ref.value!==g&&(i=!0,a.IQ.update(this.renderable.values.dIncludeTransparent,g)),this.renderable.values.dIllumination.ref.value!==r&&(i=!0,a.IQ.update(this.renderable.values.dIllumination,r)),this.nSamples!==n.samples&&(i=!0,this.nSamples=n.samples,a.IQ.update(this.renderable.values.uSamples,ye(this.nSamples)),a.IQ.updateIfChanged(this.renderable.values.dNSamples,this.nSamples))
const y="on"===n.multiScale.name
if(this.renderable.values.dMultiScale.ref.value!==y&&(i=!0,a.IQ.update(this.renderable.values.dMultiScale,y)),"on"===n.multiScale.name){const t=n.multiScale.params
if(this.levelsCameraScale!==e.scale||!(0,a.bD)(this.levels,t.levels)){i=!0,this.levelsCameraScale=e.scale,this.levels=t.levels
const n=function(e,t){const n=e.length,{radius:r,bias:i}={radius:new Array(3*n).fill(0),bias:new Array(3*n).fill(0)}
e=e.slice().sort((e,t)=>e.radius-t.radius)
for(let o=0;o<n;++o){const n=e[o]
r[o]=Math.pow(2,n.radius)*t,i[o]=n.bias}return{count:n,radius:r,bias:i}}(t.levels,e.scale)
a.IQ.updateIfChanged(this.renderable.values.dLevels,n.count),a.IQ.update(this.renderable.values.uLevelRadius,n.radius),a.IQ.update(this.renderable.values.uLevelBias,n.bias)}a.IQ.updateIfChanged(this.renderable.values.uNearThreshold,t.nearThreshold),a.IQ.updateIfChanged(this.renderable.values.uFarThreshold,t.farThreshold)}else a.IQ.updateIfChanged(this.renderable.values.uRadius,Math.pow(2,n.radius)*e.scale)
if(a.IQ.updateIfChanged(this.renderable.values.uBias,n.bias),this.blurKernelSize!==n.blurKernelSize){o=!0,this.blurKernelSize=n.blurKernelSize
const e=me(this.blurKernelSize)
a.IQ.update(this.blurFirstPassRenderable.values.uKernel,e),a.IQ.update(this.blurSecondPassRenderable.values.uKernel,e),a.IQ.update(this.blurFirstPassRenderable.values.dOcclusionKernelSize,this.blurKernelSize),a.IQ.update(this.blurSecondPassRenderable.values.dOcclusionKernelSize,this.blurKernelSize)}const v=this.calcSsaoScale(n.resolutionScale)
if(this.ssaoScale!==v){i=!0,s=!0,this.ssaoScale=v
const e=Math.floor(d*this.ssaoScale),t=Math.floor(p*this.ssaoScale)
this.ssaoDepthTexture.define(e,t),this.ssaoDepthTransparentTexture.define(e,t),this.depthBlurProxyTexture.define(e,t)
const n=Math.floor(.5*e),r=Math.floor(.5*t),o=Math.floor(.25*e),l=Math.floor(.25*t)
this.downsampledDepthTargetOpaque.setSize(e,t),this.depthHalfTargetOpaque.setSize(n,r),this.depthQuarterTargetOpaque.setSize(o,l)
const u=this.getDepthTexture()
a.IQ.update(this.depthHalfRenderableOpaque.values.tColor,u),a.IQ.update(this.renderable.values.tDepth,u),a.IQ.update(this.renderable.values.tDepthHalf,this.depthHalfTargetOpaque.texture),a.IQ.update(this.renderable.values.tDepthQuarter,this.depthQuarterTargetOpaque.texture),a.IQ.update(this.downsampleDepthRenderableOpaque.values.uTexSize,c.ZY.set(this.downsampleDepthRenderableOpaque.values.uTexSize.ref.value,e,t)),a.IQ.update(this.depthHalfRenderableOpaque.values.uTexSize,c.ZY.set(this.depthHalfRenderableOpaque.values.uTexSize.ref.value,n,r)),a.IQ.update(this.depthQuarterRenderableOpaque.values.uTexSize,c.ZY.set(this.depthQuarterRenderableOpaque.values.uTexSize.ref.value,o,l)),this.downsampledDepthTargetTransparent.setSize(e,t),this.depthHalfTargetTransparent.setSize(n,r),this.depthQuarterTargetTransparent.setSize(o,l)
const h=this.getTransparentDepthTexture()
a.IQ.update(this.depthHalfRenderableTransparent.values.tColor,h),a.IQ.update(this.renderable.values.tDepthTransparent,h),a.IQ.update(this.renderable.values.tDepthHalfTransparent,this.depthHalfTargetTransparent.texture),a.IQ.update(this.renderable.values.tDepthQuarterTransparent,this.depthQuarterTargetTransparent.texture),a.IQ.update(this.downsampleDepthRenderableTransparent.values.uTexSize,c.ZY.set(this.downsampleDepthRenderableTransparent.values.uTexSize.ref.value,e,t)),a.IQ.update(this.depthHalfRenderableTransparent.values.uTexSize,c.ZY.set(this.depthHalfRenderableTransparent.values.uTexSize.ref.value,n,r)),a.IQ.update(this.depthQuarterRenderableTransparent.values.uTexSize,c.ZY.set(this.depthQuarterRenderableTransparent.values.uTexSize.ref.value,o,l)),a.IQ.update(this.renderable.values.uTexSize,c.ZY.set(this.renderable.values.uTexSize.ref.value,e,t)),a.IQ.update(this.blurFirstPassRenderable.values.uTexSize,c.ZY.set(this.blurFirstPassRenderable.values.uTexSize.ref.value,e,t)),a.IQ.update(this.blurSecondPassRenderable.values.uTexSize,c.ZY.set(this.blurSecondPassRenderable.values.uTexSize.ref.value,e,t))}i&&this.renderable.update(),o&&(this.blurFirstPassRenderable.update(),this.blurSecondPassRenderable.update()),s&&(this.depthHalfRenderableOpaque.update(),this.depthHalfRenderableTransparent.update())}render(e){h.g$&&this.webgl.timer.mark("SSAO.render")
const{state:t}=this.webgl,{x:n,y:r,width:i,height:o}=e.viewport,s=this.renderable.values.dIncludeTransparent.ref.value,l=this.renderable.values.dMultiScale.ref.value,c=Math.floor(n*this.ssaoScale),u=Math.floor(r*this.ssaoScale),d=Math.ceil(i*this.ssaoScale),p=Math.ceil(o*this.ssaoScale)
t.viewport(c,u,d,p),t.scissor(c,u,d,p),this.ssaoScale<1&&(h.g$&&this.webgl.timer.mark("SSAO.downsample"),this.downsampledDepthTargetOpaque.bind(),this.downsampleDepthRenderableOpaque.render(),s&&(this.downsampledDepthTargetTransparent.bind(),this.downsampleDepthRenderableTransparent.render()),h.g$&&this.webgl.timer.markEnd("SSAO.downsample")),h.g$&&this.webgl.timer.mark("SSAO.half"),l&&(this.depthHalfTargetOpaque.bind(),this.depthHalfRenderableOpaque.render()),l&&s&&(this.depthHalfTargetTransparent.bind(),this.depthHalfRenderableTransparent.render()),h.g$&&this.webgl.timer.markEnd("SSAO.half"),h.g$&&this.webgl.timer.mark("SSAO.quarter"),l&&(this.depthQuarterTargetOpaque.bind(),this.depthQuarterRenderableOpaque.render()),l&&s&&(this.depthQuarterTargetTransparent.bind(),this.depthQuarterRenderableTransparent.render()),h.g$&&this.webgl.timer.markEnd("SSAO.quarter"),h.g$&&this.webgl.timer.mark("SSAO.opaque"),this.ssaoDepthTexture.attachFramebuffer(this.framebuffer,"color0"),a.IQ.update(this.renderable.values.uTransparencyFlag,0),this.framebuffer.bind(),this.renderable.render(),h.g$&&this.webgl.timer.markEnd("SSAO.opaque"),h.g$&&this.webgl.timer.mark("SSAO.blurOpaque"),a.IQ.update(this.blurFirstPassRenderable.values.tSsaoDepth,this.ssaoDepthTexture),this.blurFirstPassRenderable.update(),this.blurFirstPassFramebuffer.bind(),this.blurFirstPassRenderable.render(),this.ssaoDepthTexture.attachFramebuffer(this.blurSecondPassFramebuffer,"color0"),this.blurSecondPassFramebuffer.bind(),this.blurSecondPassRenderable.render(),h.g$&&this.webgl.timer.markEnd("SSAO.blurOpaque"),s&&(h.g$&&this.webgl.timer.mark("SSAO.transparent "),this.ssaoDepthTransparentTexture.attachFramebuffer(this.framebuffer,"color0"),a.IQ.update(this.renderable.values.uTransparencyFlag,1),this.framebuffer.bind(),this.renderable.render(),h.g$&&this.webgl.timer.markEnd("SSAO.transparent "),h.g$&&this.webgl.timer.mark("SSAO.blurTransparent "),a.IQ.update(this.blurFirstPassRenderable.values.tSsaoDepth,this.ssaoDepthTransparentTexture),this.blurFirstPassRenderable.update(),this.blurFirstPassFramebuffer.bind(),this.blurFirstPassRenderable.render(),this.ssaoDepthTransparentTexture.attachFramebuffer(this.blurSecondPassFramebuffer,"color0"),this.blurSecondPassFramebuffer.bind(),this.blurSecondPassRenderable.render(),h.g$&&this.webgl.timer.markEnd("SSAO.blurTransparent ")),h.g$&&this.webgl.timer.markEnd("SSAO.render")}}const pe={...r.du,tDepth:(0,i.$G)("texture","rgba","ubyte","linear"),tDepthHalf:(0,i.$G)("texture","rgba","ubyte","linear"),tDepthQuarter:(0,i.$G)("texture","rgba","ubyte","linear"),dIllumination:(0,i.$F)("boolean"),uTransparencyFlag:(0,i.w5)("i"),dIncludeTransparent:(0,i.$F)("boolean"),tDepthTransparent:(0,i.$G)("texture","rgba","ubyte","linear"),tDepthHalfTransparent:(0,i.$G)("texture","rgba","ubyte","linear"),tDepthQuarterTransparent:(0,i.$G)("texture","rgba","ubyte","linear"),uSamples:(0,i.w5)("v3[]"),dNSamples:(0,i.$F)("number"),uProjection:(0,i.w5)("m4"),uInvProjection:(0,i.w5)("m4"),uBounds:(0,i.w5)("v4"),uTexSize:(0,i.w5)("v2"),uRadius:(0,i.w5)("f"),uBias:(0,i.w5)("f"),dMultiScale:(0,i.$F)("boolean"),dLevels:(0,i.$F)("number"),uLevelRadius:(0,i.w5)("f[]"),uLevelBias:(0,i.w5)("f[]"),uNearThreshold:(0,i.w5)("f"),uFarThreshold:(0,i.w5)("f")},he={...r.du,tSsaoDepth:(0,i.$G)("texture","rgba","ubyte","nearest"),uTexSize:(0,i.w5)("v2"),uKernel:(0,i.w5)("f[]"),dOcclusionKernelSize:(0,i.$F)("number"),uBlurDepthBias:(0,i.w5)("f"),uBlurDirectionX:(0,i.w5)("f"),uBlurDirectionY:(0,i.w5)("f"),uInvProjection:(0,i.w5)("m4"),uNear:(0,i.w5)("f"),uFar:(0,i.w5)("f"),uBounds:(0,i.w5)("v4"),dOrthographic:(0,i.$F)("number")}
function fe(e,t,n){const i={...r.OM,tSsaoDepth:a.IQ.create(t),uTexSize:a.IQ.create(c.ZY.create(t.getWidth(),t.getHeight())),uKernel:a.IQ.create(me(15)),dOcclusionKernelSize:a.IQ.create(15),uBlurDepthBias:a.IQ.create(.5),uBlurDirectionX:a.IQ.create("horizontal"===n?1:0),uBlurDirectionY:a.IQ.create("vertical"===n?1:0),uInvProjection:a.IQ.create(c.$I.identity()),uNear:a.IQ.create(0),uFar:a.IQ.create(1e4),uBounds:a.IQ.create((0,c.Zb)()),dOrthographic:a.IQ.create(0)},u={...he},p=(0,o.NG)("ssao_blur",d.e,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tSsaoDepth;\nuniform vec2 uTexSize;\nuniform vec4 uBounds;\n\nuniform float uKernel[dOcclusionKernelSize];\nuniform float uBlurDepthBias;\n\nuniform float uBlurDirectionX;\nuniform float uBlurDirectionY;\n\nuniform mat4 uInvProjection;\nuniform float uNear;\nuniform float uFar;\n\n#include common\n\nfloat getViewZ(const in float depth) {\n    #if dOrthographic == 1\n        return orthographicDepthToViewZ(depth, uNear, uFar);\n    #else\n        return perspectiveDepthToViewZ(depth, uNear, uFar);\n    #endif\n}\n\nbool isBackground(const in float depth) {\n    return depth == 1.0;\n}\n\nbool isNearClip(const in float depth) {\n    return depth == 0.0;\n}\n\nbool outsideBounds(const in vec2 p) {\n    return p.x < uBounds.x || p.y < uBounds.y || p.x > uBounds.z || p.y > uBounds.w;\n}\n\nfloat getPixelSize(const in vec2 coords, const in float depth) {\n    vec3 viewPos0 = screenSpaceToViewSpace(vec3(coords, depth), uInvProjection);\n    vec3 viewPos1 = screenSpaceToViewSpace(vec3(coords + vec2(1.0, 0.0) / uTexSize, depth), uInvProjection);\n    return distance(viewPos0, viewPos1);\n}\n\nvoid main(void) {\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n\n    vec2 packedDepth = texture2D(tSsaoDepth, coords).zw;\n\n    if (outsideBounds(coords)) {\n        gl_FragColor = vec4(packUnitIntervalToRG(1.0), packedDepth);\n        return;\n    }\n\n    float selfDepth = unpackRGToUnitInterval(packedDepth);\n    // (if background and if second pass) or if near clip\n    if ((isBackground(selfDepth) && uBlurDirectionY != 0.0) || isNearClip(selfDepth)) {\n        gl_FragColor = vec4(packUnitIntervalToRG(1.0), packedDepth);\n        return;\n    }\n\n    float selfViewZ = getViewZ(selfDepth);\n    float pixelSize = getPixelSize(coords, selfDepth);\n\n    vec2 offset = vec2(uBlurDirectionX, uBlurDirectionY) / uTexSize;\n\n    float sum = 0.0;\n    float kernelSum = 0.0;\n    const int halfKernelSize = dOcclusionKernelSize / 2;\n    // only if kernelSize is odd\n    for (int i = -halfKernelSize; i <= halfKernelSize; i++) {\n        if (abs(float(i)) > 1.0 && abs(float(i)) * pixelSize > 0.8) continue;\n\n        vec2 sampleCoords = coords + float(i) * offset;\n        if (outsideBounds(sampleCoords)) {\n            continue;\n        }\n\n        vec4 sampleSsaoDepth = texture2D(tSsaoDepth, sampleCoords);\n\n        float sampleDepth = unpackRGToUnitInterval(sampleSsaoDepth.zw);\n        if (isBackground(sampleDepth) || isNearClip(sampleDepth)) {\n            continue;\n        }\n\n        float sampleViewZ = getViewZ(sampleDepth);\n        if (abs(selfViewZ - sampleViewZ) >= uBlurDepthBias) {\n            continue;\n        }\n\n        float kernel = uKernel[int(abs(float(i)))]; // abs is not defined for int in webgl1\n        float sampleValue = unpackRGToUnitInterval(sampleSsaoDepth.xy);\n\n        sum += kernel * sampleValue;\n        kernelSum += kernel;\n    }\n    gl_FragColor = vec4(packUnitIntervalToRG(sum / kernelSum), packedDepth);\n}\n"),h=(0,s.$h)(e,"triangles",p,u,i)
return(0,l._)(h,i)}function me(e){const t=e/3,n=Math.floor((e+1)/2),r=[]
for(let i=0;i<n;i++)r.push(1/(Math.sqrt(2*Math.PI)*t)*Math.exp(-i*i/(2*t*t)))
return r}const ge=[]
for(let _e=0;_e<256;_e++){const e=(0,c.eB)()
e[0]=2*Math.random()-1,e[1]=2*Math.random()-1,e[2]=Math.random(),c.eB.normalize(e,e),c.eB.scale(e,e,Math.random()),ge.push(e)}function ye(e){const t=[]
for(let n=0;n<e;n++){let r=(n*n+2*n+1)/(e*e)
r=.1+.9*r,t.push(ge[n][0]*r),t.push(ge[n][1]*r),t.push(ge[n][2]*r)}return t}const ve={...r.du,tSsaoDepth:(0,i.$G)("texture","rgba","ubyte","nearest"),tSsaoDepthTransparent:(0,i.$G)("texture","rgba","ubyte","nearest"),tColor:(0,i.$G)("texture","rgba","ubyte","nearest"),tTransparentColor:(0,i.$G)("texture","rgba","ubyte","nearest"),dBlendTransparency:(0,i.$F)("boolean"),tDepthOpaque:(0,i.$G)("texture","rgba","ubyte","nearest"),tDepthTransparent:(0,i.$G)("texture","rgba","ubyte","nearest"),tShadows:(0,i.$G)("texture","rgba","ubyte","nearest"),tOutlines:(0,i.$G)("texture","rgba","ubyte","nearest"),uTexSize:(0,i.w5)("v2"),dOrthographic:(0,i.$F)("number"),uNear:(0,i.w5)("f"),uFar:(0,i.w5)("f"),uFogNear:(0,i.w5)("f"),uFogFar:(0,i.w5)("f"),uFogColor:(0,i.w5)("v3"),uOutlineColor:(0,i.w5)("v3"),uOcclusionColor:(0,i.w5)("v3"),uTransparentBackground:(0,i.w5)("b"),dOcclusionEnable:(0,i.$F)("boolean"),dOcclusionSingleDepth:(0,i.$F)("boolean"),dOcclusionIncludeOpacity:(0,i.$F)("boolean"),dOcclusionIncludeTransparency:(0,i.$F)("boolean"),uOcclusionOffset:(0,i.w5)("v2"),dShadowEnable:(0,i.$F)("boolean"),dOutlineEnable:(0,i.$F)("boolean"),dOutlineScale:(0,i.$F)("number"),dTransparentOutline:(0,i.$F)("boolean")},be={enabled:u.t.Boolean(!0),occlusion:u.t.MappedStatic("on",{on:u.t.Group(ue),off:u.t.Group({})},{cycle:!0,description:"Darken occluded crevices with the ambient occlusion effect",hideIf:e=>!1===e.enabled}),shadow:u.t.MappedStatic("off",{on:u.t.Group(se),off:u.t.Group({})},{cycle:!0,description:"Simplistic shadows",hideIf:e=>!1===e.enabled}),outline:u.t.MappedStatic("off",{on:u.t.Group(oe.PS),off:u.t.Group({})},{cycle:!0,description:"Draw outline around 3D objects",hideIf:e=>!1===e.enabled}),dof:u.t.MappedStatic("off",{on:u.t.Group(re.w),off:u.t.Group({})},{cycle:!0,description:"DOF",hideIf:e=>!1===e.enabled}),antialiasing:u.t.MappedStatic("smaa",{fxaa:u.t.Group(f),smaa:u.t.Group(x),off:u.t.Group({})},{options:[["fxaa","FXAA"],["smaa","SMAA"],["off","Off"]],description:"Smooth pixel edges",hideIf:e=>!1===e.enabled}),sharpening:u.t.MappedStatic("off",{on:u.t.Group(J),off:u.t.Group({})},{cycle:!0,description:"Contrast Adaptive Sharpening",hideIf:e=>!1===e.enabled}),background:u.t.Group(q,{isFlat:!0,hideIf:e=>!1===e.enabled}),bloom:u.t.MappedStatic("on",{on:u.t.Group(ie.c),off:u.t.Group({})},{cycle:!0,description:"Bloom",hideIf:e=>!1===e.enabled})}
class xe{static isEnabled(e){return e.enabled&&(de.isEnabled(e)||le.isEnabled(e)||oe.G.isEnabled(e)||"off"!==e.background.variant.name)}static isTransparentDepthRequired(e,t){return t.enabled&&(re.z.isEnabled(t)||oe.G.isEnabled(t)&&xe.isTransparentOutlineEnabled(t)||de.isEnabled(t)&&xe.isTransparentSsaoEnabled(e,t))&&e.opacityAverage<1}static isTransparentOutlineEnabled(e){var t
return e.enabled&&oe.G.isEnabled(e)&&(null===(t=e.outline.params.includeTransparent)||void 0===t||t)}static isTransparentSsaoEnabled(e,t){return t.enabled&&de.isEnabled(t)&&de.isTransparentEnabled(e,t.occlusion.params)}static isSsaoEnabled(e){return e.enabled&&de.isEnabled(e)}constructor(e,t,n){this.webgl=e,this.drawPass=n,this.occlusionOffset=[0,0],this.transparentBackground=!1
const{colorTarget:i,transparentColorTarget:u,depthTextureOpaque:p,depthTextureTransparent:h,packedDepth:f}=n,m=i.getWidth(),g=i.getHeight()
this.target=e.createRenderTarget(m,g,!1,"uint8","linear"),this.ssao=new de(e,m,g,f,p,h),this.shadow=new le(e,m,g,p),this.outline=new oe.G(e,m,g,h,p),this.renderable=function(e,t,n,i,u,p,h,f,m){const g={...r.OM,tSsaoDepth:a.IQ.create(f),tSsaoDepthTransparent:a.IQ.create(m),tColor:a.IQ.create(t),tTransparentColor:a.IQ.create(n),dBlendTransparency:a.IQ.create(!0),tDepthOpaque:a.IQ.create(i),tDepthTransparent:a.IQ.create(u),tShadows:a.IQ.create(p),tOutlines:a.IQ.create(h),uTexSize:a.IQ.create(c.ZY.create(t.getWidth(),t.getHeight())),dOrthographic:a.IQ.create(0),uNear:a.IQ.create(1),uFar:a.IQ.create(1e4),uFogNear:a.IQ.create(1e4),uFogFar:a.IQ.create(1e4),uFogColor:a.IQ.create(c.eB.create(1,1,1)),uOutlineColor:a.IQ.create(c.eB.create(0,0,0)),uOcclusionColor:a.IQ.create(c.eB.create(0,0,0)),uTransparentBackground:a.IQ.create(!1),dOcclusionEnable:a.IQ.create(!0),dOcclusionSingleDepth:a.IQ.create(!1),dOcclusionIncludeOpacity:a.IQ.create(!0),dOcclusionIncludeTransparency:a.IQ.create(!1),uOcclusionOffset:a.IQ.create(c.ZY.create(0,0)),dShadowEnable:a.IQ.create(!1),dOutlineEnable:a.IQ.create(!1),dOutlineScale:a.IQ.create(1),dTransparentOutline:a.IQ.create(!0)},y={...ve},v=(0,o.NG)("postprocessing",d.e,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tSsaoDepth;\nuniform sampler2D tSsaoDepthTransparent;\nuniform sampler2D tColor;\nuniform sampler2D tTransparentColor;\nuniform sampler2D tDepthOpaque;\nuniform sampler2D tDepthTransparent;\nuniform sampler2D tShadows;\nuniform sampler2D tOutlines;\nuniform vec2 uTexSize;\n\nuniform float uNear;\nuniform float uFar;\nuniform float uFogNear;\nuniform float uFogFar;\nuniform vec3 uFogColor;\nuniform vec3 uOutlineColor;\nuniform vec3 uOcclusionColor;\nuniform bool uTransparentBackground;\nuniform vec2 uOcclusionOffset;\n\n#include common\n\nfloat getViewZ(const in float depth) {\n    #if dOrthographic == 1\n        return orthographicDepthToViewZ(depth, uNear, uFar);\n    #else\n        return perspectiveDepthToViewZ(depth, uNear, uFar);\n    #endif\n}\n\nfloat getDepthOpaque(const in vec2 coords) {\n    #ifdef depthTextureSupport\n        return texture2D(tDepthOpaque, coords).r;\n    #else\n        return unpackRGBAToDepth(texture2D(tDepthOpaque, coords));\n    #endif\n}\n\nfloat getDepthTransparent(const in vec2 coords) {\n    return unpackRGBAToDepthWithAlpha(texture2D(tDepthTransparent, coords)).x;\n}\n\nbool isBackground(const in float depth) {\n    return depth == 1.0;\n}\n\nint squaredOutlineScale = dOutlineScale * dOutlineScale;\nvoid getOutline(const in vec2 coords, out bool hasOpaque, out bool hasTransparent, out float opaqueDepth, out float transparentDepth, out float alpha) {\n    vec2 invTexSize = 1.0 / uTexSize;\n\n    hasOpaque = false;\n    hasTransparent = false;\n    opaqueDepth = 1.0;\n    transparentDepth = 1.0;\n    alpha = 0.0;\n    for (int y = -dOutlineScale; y <= dOutlineScale; y++) {\n        for (int x = -dOutlineScale; x <= dOutlineScale; x++) {\n            if (x * x + y * y > squaredOutlineScale) {\n                continue;\n            }\n\n            vec2 sampleCoords = coords + vec2(float(x), float(y)) * invTexSize;\n\n            vec4 sampleOutlineCombined = texture2D(tOutlines, sampleCoords);\n            float sampleOpaqueDepth = unpackRGToUnitInterval(sampleOutlineCombined.gb);\n            float sampleTransparentDepth = sampleOutlineCombined.a;\n            vec2 sampleFlagWithAlpha = unpack2x4(sampleOutlineCombined.r);\n\n            float sampleFlag = sampleFlagWithAlpha.x;\n            float sampleAlpha = clamp(sampleFlagWithAlpha.y * 0.5, 0.01, 1.0);\n\n            if ((sampleFlag > 0.20 && sampleFlag < 0.30) || (sampleFlag > 0.70 && sampleFlag < 0.80)) { // transparent || both\n                if (sampleOpaqueDepth < opaqueDepth) {\n                    hasOpaque = true;\n                    opaqueDepth = sampleOpaqueDepth;\n                }\n            }\n\n            if ((((sampleFlag > 0.45 && sampleFlag < 0.55) || (sampleFlag > 0.70 && sampleFlag < 0.80))) && sampleTransparentDepth < transparentDepth) { // transparent || both\n                hasTransparent = true;\n                transparentDepth = sampleTransparentDepth;\n                alpha = sampleAlpha;\n            }\n        }\n    }\n}\n\nfloat getSsao(vec2 coords) {\n    float rawSsao = unpackRGToUnitInterval(texture2D(tSsaoDepth, coords).xy);\n    if (rawSsao > 0.999) {\n        return 1.0;\n    } else if (rawSsao > 0.001) {\n        return rawSsao;\n    }\n    // treat values close to 0.0 as errors and return no occlusion\n    return 1.0;\n}\n\nfloat getSsaoTransparent(vec2 coords) {\n    float rawSsao = unpackRGToUnitInterval(texture2D(tSsaoDepthTransparent, coords).xy);\n    if (rawSsao > 0.999) {\n        return 1.0;\n    } else if (rawSsao > 0.001) {\n        return rawSsao;\n    }\n    // treat values close to 0.0 as errors and return no occlusion\n    return 1.0;\n}\n\nvoid main(void) {\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n    vec4 color = texture2D(tColor, coords);\n\n    float opaqueDepth = getDepthOpaque(coords);\n    float transparentDepth = 1.0;\n    #ifdef dBlendTransparency\n        bool blendTransparency = true;\n        vec4 transparentColor = texture2D(tTransparentColor, coords);\n\n        #if defined(dOutlineEnable) || defined(dOcclusionEnable) && defined(dOcclusionIncludeTransparency)\n            transparentDepth = getDepthTransparent(coords);\n        #endif\n    #endif\n\n    #if defined(dOcclusionEnable) || defined(dShadowEnable)\n        bool isOpaqueBackground = isBackground(opaqueDepth);\n        float viewDist = abs(getViewZ(opaqueDepth));\n        float fogFactor = smoothstep(uFogNear, uFogFar, viewDist);\n    #endif\n\n    #if defined(dOcclusionEnable)\n        if (!isOpaqueBackground) {\n            float occlusionFactor = getSsao(coords + uOcclusionOffset);\n\n            if (!uTransparentBackground) {\n                color.rgb = mix(mix(uOcclusionColor, uFogColor, fogFactor), color.rgb, occlusionFactor);\n            } else {\n                color.rgb = mix(uOcclusionColor * (1.0 - fogFactor), color.rgb, occlusionFactor);\n            }\n        }\n        #if defined(dBlendTransparency) && defined(dOcclusionIncludeTransparency)\n            if (!isBackground(transparentDepth)) {\n                float viewDist = abs(getViewZ(transparentDepth));\n                float fogFactor = smoothstep(uFogNear, uFogFar, viewDist);\n                float occlusionFactor = getSsaoTransparent(coords + uOcclusionOffset);\n                transparentColor.rgb = mix(uOcclusionColor * (1.0 - fogFactor), transparentColor.rgb, occlusionFactor);\n            }\n        #endif\n    #endif\n\n    #ifdef dShadowEnable\n        if (!isOpaqueBackground) {\n            vec4 shadow = texture2D(tShadows, coords);\n            if (!uTransparentBackground) {\n                color.rgb = mix(mix(vec3(0), uFogColor, fogFactor), color.rgb, shadow.a);\n            } else {\n                color.rgb = mix(vec3(0) * (1.0 - fogFactor), color.rgb, shadow.a);\n            }\n        }\n    #endif\n\n    // outline needs to be handled after occlusion and shadow to keep them clean\n    #ifdef dOutlineEnable\n        bool hasOpaque;\n        bool hasTransparent;\n        float outlineOpaqueDepth;\n        float outlineTransparentDepth;\n        float outlineAlpha;\n        getOutline(coords, hasOpaque, hasTransparent, outlineOpaqueDepth, outlineTransparentDepth, outlineAlpha);\n\n        if (hasOpaque) {\n            float viewDist = abs(getViewZ(outlineOpaqueDepth));\n            float fogFactor = smoothstep(uFogNear, uFogFar, viewDist);\n            if (!uTransparentBackground) {\n                color.rgb = mix(uOutlineColor, uFogColor, fogFactor);\n            } else {\n                color.a = 1.0 - fogFactor;\n                color.rgb = mix(uOutlineColor, vec3(0.0), fogFactor);\n            }\n        }\n\n        #ifdef dBlendTransparency\n            if (hasTransparent) {\n                if (hasOpaque && outlineOpaqueDepth < outlineTransparentDepth) {\n                    blendTransparency = false;\n                } else {\n                    float finalOutlineAlpha = clamp(outlineAlpha * 2.0, 0.0, 1.0);\n                    float viewDist = abs(getViewZ(outlineTransparentDepth));\n                    float fogFactor = smoothstep(uFogNear, uFogFar, viewDist);\n                    float finalAlpha = max(transparentColor.a, finalOutlineAlpha * (1.0 - fogFactor));\n                    transparentColor.a = finalAlpha;\n                    transparentColor.rgb = uOutlineColor * finalAlpha;\n                }\n            }\n        #endif\n    #endif\n\n    #ifdef dBlendTransparency\n        if (blendTransparency) {\n            float alpha = transparentColor.a;\n            if (alpha != 0.0) {\n                // blending\n                color = transparentColor + color * (1.0 - alpha);\n            }\n        }\n    #endif\n\n    gl_FragColor = color;\n}\n"),b=(0,s.$h)(e,"triangles",v,y,g)
return(0,l._)(b,g)}(e,i.texture,u.texture,p,h,this.shadow.target.texture,this.outline.target.texture,this.ssao.ssaoDepthTexture,this.ssao.ssaoDepthTransparentTexture),this.background=new Q(e,t,m,g)}getByteCount(){return this.target.getByteCount()+this.ssao.getByteCount()+this.shadow.getByteCount()+this.outline.getByteCount()}setSize(e,t){const[n,r]=this.renderable.values.uTexSize.ref.value
e===n&&t===r||(this.target.setSize(e,t),a.IQ.update(this.renderable.values.uTexSize,c.ZY.set(this.renderable.values.uTexSize.ref.value,e,t))),this.ssao.setSize(e,t),this.shadow.setSize(e,t),this.outline.setSize(e,t),this.background.setSize(e,t)}reset(){this.ssao.reset()}updateState(e,t,n,r,i,o,s){let l=!1
const c="orthographic"===e.state.mode?1:0,u=oe.G.isEnabled(i),d=le.isEnabled(i),h=de.isEnabled(i)
if(h){const n=i.occlusion.params
this.ssao.update(e,t,n)
const r=de.isTransparentEnabled(t,n)
this.renderable.values.dOcclusionIncludeTransparency.ref.value!==r&&(l=!0,a.IQ.update(this.renderable.values.dOcclusionIncludeTransparency,r)),a.IQ.update(this.renderable.values.uOcclusionColor,p.Color.toVec3Normalized(this.renderable.values.uOcclusionColor.ref.value,n.color))}if(d&&this.shadow.update(e,o,s,i.shadow.params),u){const t=i.outline.params,{transparentOutline:n,outlineScale:r}=this.outline.update(e,t,this.drawPass.depthTextureTransparent,this.drawPass.depthTextureOpaque)
a.IQ.update(this.renderable.values.uOutlineColor,p.Color.toVec3Normalized(this.renderable.values.uOutlineColor.ref.value,t.color)),this.renderable.values.dOutlineScale.ref.value!==r&&(l=!0,a.IQ.update(this.renderable.values.dOutlineScale,r)),this.renderable.values.dTransparentOutline.ref.value!==n&&(l=!0,a.IQ.update(this.renderable.values.dTransparentOutline,n))}a.IQ.updateIfChanged(this.renderable.values.uFar,e.far),a.IQ.updateIfChanged(this.renderable.values.uNear,e.near),a.IQ.updateIfChanged(this.renderable.values.uFogFar,e.fogFar),a.IQ.updateIfChanged(this.renderable.values.uFogNear,e.fogNear),a.IQ.update(this.renderable.values.uFogColor,p.Color.toVec3Normalized(this.renderable.values.uFogColor.ref.value,r)),a.IQ.updateIfChanged(this.renderable.values.uTransparentBackground,n),this.renderable.values.dOrthographic.ref.value!==c&&(l=!0,a.IQ.update(this.renderable.values.dOrthographic,c)),this.renderable.values.dOutlineEnable.ref.value!==u&&(l=!0,a.IQ.update(this.renderable.values.dOutlineEnable,u)),this.renderable.values.dShadowEnable.ref.value!==d&&(l=!0,a.IQ.update(this.renderable.values.dShadowEnable,d)),this.renderable.values.dOcclusionEnable.ref.value!==h&&(l=!0,a.IQ.update(this.renderable.values.dOcclusionEnable,h))
const f=t.opacityAverage<1
this.renderable.values.dBlendTransparency.ref.value!==f&&(l=!0,a.IQ.update(this.renderable.values.dBlendTransparency,f)),l&&this.renderable.update()
const{gl:m,state:g}=this.webgl
g.enable(m.SCISSOR_TEST),g.disable(m.BLEND),g.disable(m.DEPTH_TEST),g.depthMask(!1)}setOcclusionOffset(e,t){this.occlusionOffset[0]=e,this.occlusionOffset[1]=t,a.IQ.update(this.renderable.values.uOcclusionOffset,c.ZY.set(this.renderable.values.uOcclusionOffset.ref.value,e,t))}setTransparentBackground(e){this.transparentBackground=e}render(e,t,n,r,i,o,a,s){h.g$&&this.webgl.timer.mark("PostprocessingPass.render"),this.updateState(e,t,r,i,o,a,s)
const{state:l}=this.webgl,{x:c,y:u,width:d,height:p}=e.viewport
"on"===o.occlusion.name&&0===this.occlusionOffset[0]&&0===this.occlusionOffset[1]&&this.ssao.render(e),l.viewport(c,u,d,p),l.scissor(c,u,d,p),"on"===o.outline.name&&this.outline.render(),"on"===o.shadow.name&&this.shadow.render(),n?this.webgl.bindDrawingBuffer():this.target.bind(),this.background.update(e,o.background),this.background.clear(o.background,this.transparentBackground,i),this.background.render(o.background),this.renderable.render(),h.g$&&this.webgl.timer.markEnd("PostprocessingPass.render")}}class Se{static isEnabled(e){return e.enabled&&("off"!==e.antialiasing.name||"off"!==e.sharpening.name)}constructor(e,t,n){this.target=e.createRenderTarget(t,n,!1),this.internalTarget=e.createRenderTarget(t,n,!1),this.fxaa=new m(e,this.target.texture),this.smaa=new S(e,this.target.texture),this.cas=new ee(e,this.target.texture)}getByteCount(){return this.target.getByteCount()+this.internalTarget.getByteCount()+this.smaa.getByteCount()}setSize(e,t){const n=this.target.texture.getWidth(),r=this.target.texture.getHeight()
e===n&&t===r||(this.target.setSize(e,t),this.internalTarget.setSize(e,t),this.fxaa.setSize(e,t),this.smaa.supported&&this.smaa.setSize(e,t),this.cas.setSize(e,t))}_renderFxaa(e,t,n,r){"fxaa"===r.antialiasing.name&&(this.fxaa.update(t,r.antialiasing.params),this.fxaa.render(e.viewport,n))}_renderSmaa(e,t,n,r){"smaa"===r.antialiasing.name&&(this.smaa.update(t,r.antialiasing.params),this.smaa.render(e.viewport,n))}_renderAntialiasing(e,t,n,r){"fxaa"===r.antialiasing.name?this._renderFxaa(e,t,n,r):"smaa"===r.antialiasing.name&&this._renderSmaa(e,t,n,r)}_renderCas(e,t,n,r){"on"===r.sharpening.name&&("off"!==r.antialiasing.name&&(t=this.internalTarget.texture),this.cas.update(t,r.sharpening.params),this.cas.render(e.viewport,n))}render(e,t,n,r){if("off"===r.antialiasing.name&&"off"===r.sharpening.name)return
if("smaa"===r.antialiasing.name&&!this.smaa.supported)return void console.error('SMAA not supported, missing "HTMLImageElement"')
const i=!0===n?void 0:!1===n?this.target:n
"off"===r.sharpening.name?this._renderAntialiasing(e,t,i,r):("off"===r.antialiasing.name||this._renderAntialiasing(e,t,this.internalTarget,r),this._renderCas(e,t,i,r))}}},9014(e,t,n){"use strict"
n.d(t,{X:()=>y,g:()=>C})
var r,i=n(67538),o=n(29067),a=n(87095),s=n(70012),l=n(63356)
function c(e){e.count=e.endVertex-e.startVertex
const{isRingAtom:t,pred:n,color:r,depth:i,marked:o}=e
for(let a=0;a<e.count;a++)t[a]=0,n[a]=-1,o[a]=-1,r[a]=0,i[a]=0
e.currentColor=0,e.currentAltLoc="",e.hasAltLoc=!1}function u(e){const{depth:t}=e
for(let n=0;n<e.count;n++)t[n]=e.count+1}function d(e,t){const n=e.bonds.offset,r=e.startVertex+t,i=n[r],o=n[r+1]-i
return!(o<=1||e.isRingAtom[t]&&2===o)}function p(e,t,n){if(e.startVertex=t,e.endVertex=n,e.endVertex-e.startVertex<3)return
e.currentRings=[]
const{elements:r}=e.unit,i=[]
for(let a=e.startVertex;a<e.endVertex;a++){const t=e.altLoc.value(r[a]);(0,l.Z2)(i,t)}(0,l.K3)(i,"")
let o=1
if(0===i.length){c(e)
for(let t=0;t<e.count;t++)d(e,t)&&(u(e),o=f(e,t,o))}else for(let a=0;a<i.length;a++){c(e),e.hasAltLoc=!0,e.currentAltLoc=i[a]
for(let t=0;t<e.count;t++){if(!d(e,t))continue
const n=e.altLoc.value(r[e.startVertex+t])
n&&n!==e.currentAltLoc||(u(e),o=f(e,t,o))}}for(let a=0,s=e.currentRings.length;a<s;a++)e.rings.push(e.currentRings[a])}function h(e,t,n,o){if(n<t)return!1
const{pred:a,color:l,left:c,right:u}=e,d=++e.currentColor
let p=t
for(let i=0;i<r.MaxDepth&&(l[p]=d,p=a[p],!(p<0));i++);let h=0,f=0,m=!1,g=0
p=n
for(let i=0;i<r.MaxDepth;i++){if(l[p]===d){g=p,m=!0
break}if(u[f++]=p,p=a[p],p<0)break}if(!m)return!1
p=t
for(let i=0;i<r.MaxDepth&&(c[h++]=p,g!==p)&&(p=a[p],!(p<0));i++);const y=h+f
if(y<3)return!1
const v=new Int32Array(y)
let b=0
for(let r=0;r<h;r++)v[b++]=e.startVertex+c[r],o[c[r]]=1
for(let r=f-1;r>=0;r--)v[b++]=e.startVertex+u[r],o[u[r]]=1;(0,s.eh)(v)
for(let r=0,s=e.currentRings.length;r<s;r++){const t=e.currentRings[r]
if(v.length===t.length){if(i.X9.areEqual(v,t))return!1}else if(v.length>t.length&&i.X9.isSubset(v,t))return!1}return e.currentRings.push(i.X9.ofSortedArray(v)),!0}function f(e,t,n){const{bonds:i,startVertex:o,endVertex:s,isRingAtom:l,marked:c,queue:u,pred:d,depth:p}=e,{elements:f}=e.unit,{b:m,edgeProps:{flags:g},offset:y}=i
c[t]=n,p[t]=0,u[0]=t
let v=0,b=1
for(;v<b;){const t=u[v++],i=p[t],x=o+t,S=y[x],_=y[x+1]
for(let y=S;y<_;y++){const v=m[y]
if(v<o||v>=s||!a.BondType.isCovalent(g[y]))continue
if(e.hasAltLoc){const t=e.altLoc.value(f[v])
if(t&&e.currentAltLoc!==t)continue}const x=v-o
if(c[x]===n){if(d[x]!==t&&d[t]!==x&&h(e,t,x,l))return n+1
continue}const S=Math.min(p[x],i+1)
S>r.MaxDepth||(p[x]=S,c[x]=n,u[b++]=x,d[x]=t)}}return n+1}function m(e){const t=e.length,n=new Int32Array(2*t)
for(let a=0;a<n.length;a++)n[a]=-1
let r="",i="",o=0
for(let a=1;a<n.length;a++){let s=n[a-o-1]
for(;-1!==s&&(r=e[a%t],i=e[(o+s+1)%t],r!==i);)r<i&&(o=a-s-1),s=n[s];-1===s?(r=e[a%t],i=e[(o+s+1)%t],r!==i?(r<i&&(o=a),n[a-o]=-1):n[a-o]=s+1):n[a-o]=s+1}return o}function g(e,t){const n=e.length,r=[]
let i
for(i=0;i<n-1;i++)r.push(e[(i+t)%n]),r.push("-")
return r.push(e[(i+t)%n]),r.join("")}!function(e){e[e.MaxDepth=5]="MaxDepth"}(r||(r={}))
var y,v=n(97960),b=n(95579),x=n(13686),S=n(76242),_=n(32775)
class C{get index(){return this._index||(this._index=function(e,t){const n=new Map,r=new Map
for(let o=0,c=e.length;o<c;o++){const t=e[o]
for(let e=0,r=t.length;e<r;e++){const r=t[e]
n.has(r)?n.get(r).push(o):n.set(r,[o])}}for(let o=0,c=t.length;o<c;o++){const n=t[o],i=e[n]
for(let e=0,t=i.length;e<t;e++){const t=i[e]
r.has(t)?r.get(t).push(n):r.set(t,[n])}}const i=new o.O.UniqueEdgeBuilder(e.length)
for(let o=0,c=e.length;o<c;o++){const t=e[o]
for(let e=0,r=t.length;e<r;e++){const r=t[e],a=n.get(r)
if(1!==a.length)for(let e=0,t=a.length;e<t;e++){const t=a[e]
o>=t||i.addEdge(o,t)}}}const a=o.O.connectedComponents(i.getGraph()),s=a.componentIndex,l=[]
for(let o=0;o<a.componentCount;o++)l[o]=[]
for(let o=0,c=e.length;o<c;o++)l[s[o]].push(o)
return{elementRingIndices:n,elementAromaticRingIndices:r,ringComponentIndex:s,ringComponents:l}}(this.all,this.aromaticRings)),this._index}get byFingerprint(){return this._byFingerprint||(this._byFingerprint=function(e,t){const n=new Map
let r=0
for(let i=0,o=t.length;i<o;i++){const o=t[i],a=y.fingerprint(e,o)
n.has(a)?n.get(a).push(r):n.set(a,[r]),r++}return n}(this.unit,this.all)),this._byFingerprint}get elementRingIndices(){return this.index.elementRingIndices}get elementAromaticRingIndices(){return this.index.elementAromaticRingIndices}get ringComponentIndex(){return this.index.ringComponentIndex}get ringComponents(){return this.index.ringComponents}get aromaticRings(){return this._aromaticRings||(this._aromaticRings=function(e,t){const n=[]
for(let r=0,i=t.length;r<i;++r)y.isAromatic(e,t[r])&&n.push(r)
return n}(this.unit,this.all)),this._aromaticRings}constructor(e,t){this.unit=t,this.all=e}}function w(e,t){const{elements:n}=e,r=e.model.atomicHierarchy.residueAtomSegments.index,i=r[n[t[0]]]
for(let o=1,a=t.length;o<a;o++)if(i!==r[n[t[o]]])return-1
return i}function T(e,t,n){const r=e.byFingerprint.get(t)
if(r)for(let i=0,o=r.length;i<o;i++){const t=r[i],o=w(e.unit,e.all[t])
o>=0&&(n.has(o)?n.get(o).push(t):n.set(o,[t]))}}!function(e){function t(e){return function(e){const t=e.length,n=new Array(t)
for(let a=0;a<t;a++)n[a]=e[t-a-1]
const r=m(e),i=m(n)
let o=!1
for(let a=0;a<t;a++){const s=e[(a+r)%t],l=n[(a+i)%t]
if(s!==l){o=s<l
break}}return o?g(e,r):g(n,i)}(e)}e.fingerprint=function(e,n){const{elements:r}=e,{type_symbol:i}=e.model.atomicHierarchy.atoms,o=[]
for(let t=0,a=n.length;t<a;t++)o[o.length]=i.value(r[n[t]])
return t(o)},e.elementFingerprint=t
const n=new Set([b.S8.B,b.S8.C,b.S8.N,b.S8.O,b.S8.SI,b.S8.P,b.S8.S,b.S8.GE,b.S8.AS,b.S8.SN,b.S8.SB,b.S8.BI])
e.isAromatic=function(e,t){const{elements:r,bonds:{b:o,offset:s,edgeProps:{flags:l}}}=e,{type_symbol:c,label_comp_id:u}=e.model.atomicHierarchy.atoms
if("PRO"===u.value(e.elements[t[0]]))return!1
let d=0,p=!1
for(let f=0,m=t.length;f<m;++f){const e=t[f]
!p&&n.has(c.value(r[e]))&&(p=!0)
for(let n=s[e],r=s[e+1];n<r;++n)a.BondType.is(a.BondType.Flag.Aromatic,l[n])&&i.X9.has(t,o[n])&&(d+=1)}if(d===2*t.length)return!0
if(!p)return!1
if(t.length<5)return!1
if(d>0)return!1
const h=S.c.calculateMomentsAxes((0,x.Dt)(e,t))
return _.eB.magnitude(h.dirC)<.05},e.getAltId=function(e,t){const{label_alt_id:n}=e.model.atomicHierarchy.atoms,{elements:r}=e
for(let i=0,o=t.length;i<o;++i){const e=r[t[i]],o=n.value(e)
if(o)return o}return""}}(y||(y={})),function(e){e.create=function(t){if(v.N.Traits.is(t.traits,v.N.Trait.Water)||v.N.Traits.is(t.traits,v.N.Trait.CoarseGrained))return new e([],t)
const n=function(e){const t=function(e){const t=i.hT.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements)
let n=0
for(;t.hasNext;){const e=t.move()
n=Math.max(n,e.end-e.start)}return n}(e),n=function(e,t){return{startVertex:0,endVertex:0,count:0,isRingAtom:new Int32Array(t),marked:new Int32Array(t),queue:new Int32Array(t),pred:new Int32Array(t),depth:new Int32Array(t),left:new Int32Array(r.MaxDepth),right:new Int32Array(r.MaxDepth),color:new Int32Array(t),currentColor:0,currentAltLoc:"",hasAltLoc:!1,rings:[],currentRings:[],unit:e,bonds:e.bonds,altLoc:e.model.atomicHierarchy.atoms.label_alt_id}}(e,t),o=i.hT.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements)
for(;o.hasNext;){const e=o.move()
p(n,e.start,e.end)}return n.rings}(t)
return new e(n,t)},e.byFingerprintAndResidue=function(e,t){const n=new Map
for(let r=0,i=t.length;r<i;r++)T(e,t[r],n)
return n}}(C||(C={}))},9043(e,t,n){"use strict"
n.d(t,{NJ:()=>i.N,kk:()=>o.k,xv:()=>s.xv,IQ:()=>s.IQ,af:()=>u,bD:()=>p,NT:()=>m,fU:()=>y,lQ:()=>l,LI:()=>c,bN:()=>h,f8:()=>f})
var r,i=n(36432),o=(n(23718),n(22750))
function a(e,t){return e-t}!function(e){class t{has(e){return!1}forEach(e,t){return t}constructor(){this.size=0}}class n{has(e){return e===this.idx}forEach(e,t){return e(this.idx,t),t}constructor(e){this.idx=e,this.size=1}}class r{has(e){return e<this.length&&!!this.mask[e]}_forEach(e,t){for(let n=0;n<this.length;n++)this.mask[n]&&e(n,t)}forEach(e,t){return this._forEach(e,t),t}constructor(e,t){this.mask=e,this.size=t,this.length=e.length}}class i{has(e){return!0}_forEach(e,t){for(let n=0;n<this.size;n++)e(n,t)}forEach(e,t){return this._forEach(e,t),t}constructor(e){this.size=e}}class o{has(e){return this.set.has(e)}_forEach(e,t){for(const n of this.flatten())e(n,t)}flatten(){if(this._flat)return this._flat
const e=new Int32Array(this.size)
let t=0
var n
return this.set.forEach(n=>e[t++]=n),n=e,Array.prototype.sort.call(n,a),this._flat=e,this._flat}forEach(e,t){return this._forEach(e,t),t}constructor(e){this.set=e,this._flat=void 0,this.size=e.size}}function s(e){return new o(e)}function l(e,t){return new r(e,t)}e.always=function(e){return new i(e)},e.never=new t,e.ofSet=s,e.singleton=function(e){return new n(e)},e.ofUniqueIndices=function(e){const a=e.length
if(0===a)return new t
if(1===a)return new n(e[0])
let s=0
for(const t of e)t>s&&(s=t)
if(a===s)return new i(a)
if(a/s<1/12){const t=new Set
for(const n of e)t.add(n)
return new o(t)}const l=new Int8Array(s+1)
for(const t of e)l[t]=1
return new r(l,e.length)},e.ofMask=l,e.hasAny=function(e,t){for(const n of t)if(e.has(n))return!0
return!1},e.complement=function(e,t){let n=0,r=0
if(t.forEach(t=>{e.has(t)||(n++,t>r&&(r=t))}),n/r<1/12){const n=new Set
return t.forEach(t=>{e.has(t)||n.add(t)}),s(n)}{const i=new Uint8Array(r+1)
return t.forEach(t=>{e.has(t)||(i[t]=1)}),l(i,n)}}}(r||(r={}))
var s=n(80813)
const l=function(){}
function c(e,t){const n=Math.pow(10,t)
return Math.round(n*e)/n}function u(e,t){const n=e.length
if(n!==t.length)return!1
for(let r=0;r<n;r++)if(e[r]!==t[r])return!1
return!0}const d=Object.prototype.hasOwnProperty
function p(e,t){if(e===t)return!0
const n=Array.isArray(e),r=Array.isArray(t)
if(n&&r){if(e.length!==t.length)return!1
for(let n=0;n<e.length;n++)if(!p(e[n],t[n]))return!1
return!0}if(n!==r)return!1
if(e&&t&&"object"==typeof e&&"object"==typeof t){const n=Object.keys(e)
if(n.length!==Object.keys(t).length)return!1
const r=e instanceof Date,i=t instanceof Date
if(r&&i)return e.getTime()===t.getTime()
if(r!==i)return!1
const o=e instanceof RegExp,a=t instanceof RegExp
if(o&&a)return e.toString()===t.toString()
if(o!==a)return!1
for(let e=0;e<n.length;e++)if(!d.call(t,n[e]))return!1
for(let s=0;s<n.length;s++)if(!p(e[n[s]],t[n[s]]))return!1
return!0}return!1}function h(e,t){if(e===t)return!0
const n=Array.isArray(e),r=Array.isArray(t)
return n&&r?function(e,t){if(e===t)return!0
if(!e||!t)return!1
if(e.length!==t.length)return!1
for(let n=0,r=e.length;n<r;++n)if(e[n]!==t[n])return!1
return!0}(e,t):n===r&&!(!e||!t||"object"!=typeof e||"object"!=typeof t)&&f(e,t)}function f(e,t){if(e===t)return!0
if(!e||!t)return!1
const n=Object.keys(e)
if(Object.keys(t).length!==n.length)return!1
for(const r of n)if(!d.call(e,r)||e[r]!==t[r])return!1
return!0}function m(e,t){return void 0!==e?e:t}function g(e){return(e<10?"0":"")+e}function y(e){const t=e.getHours(),n=e.getMinutes(),r=e.getSeconds()
return`${t}:${g(n)}:${g(r)}`}Object.assign},9052(e,t,n){"use strict"
n.d(t,{O:()=>o})
var r=n(99321),i=n(12288)
function o(e,t="",n=""){return o.create(e,t,n)}!function(e){function t(e){return e.triggers.map(n.format).join(" or ")}function n(e,t){return n.create(e,t)}e.create=function(e,t="",n=""){return{triggers:e,action:t,description:n}},e.isBinding=function(e){return!!e&&Array.isArray(e.triggers)&&"string"==typeof e.action},e.Empty={triggers:[],action:"",description:""},e.isEmpty=function(e){return 0===e.triggers.length||e.triggers.every(e=>void 0===e.buttons&&void 0===e.modifiers&&!e.code)},e.match=function(e,t,r){return e.triggers.some(e=>n.match(e,t,r))},e.matchKey=function(e,t,r,i){return e.triggers.some(e=>n.matchKey(e,t,r,i))},e.formatTriggers=t,e.format=function(e,n=""){const r=e.description||(0,i.Mk)(n)
return(0,i.GW)(r,{triggers:"<i>"+t(e)+"</i>"})},e.Trigger=n,e.TriggerKey=function(e,t){return n.create(void 0,t,e)},function(e){e.create=function(e,t,n){return{buttons:e,modifiers:t,code:n}},e.Empty={},e.match=function(e,t,n){const{buttons:i,modifiers:o}=e
return void 0!==i&&(i===t||r.qt.has(i,t))&&(!o||r.Fs.areEqual(o,n))},e.matchKey=function(e,t,n,i){const{modifiers:o,code:a}=e
return void 0!==a&&(a===t||1===a.length&&4===t.length&&t.startsWith("Key")&&!!i&&1===i.length&&i.toUpperCase()===a.toUpperCase())&&(!o||r.Fs.areEqual(o,n))},e.format=function(e){const t=[],n=function(e,t){const n=[]
return void 0!==e||t?0===e?n.push("mouse hover"):void 0!==e&&(a.has(e,a.Flag.Primary)&&n.push("left mouse button"),a.has(e,a.Flag.Secondary)&&n.push("right mouse button"),a.has(e,a.Flag.Auxilary)&&n.push("wheel/middle mouse button"),a.has(e,a.Flag.Forth)&&n.push("three fingers")):n.push("any mouse button"),n.join(" + ")}(e.buttons,e.code)
n&&t.push(n)
const r=((null==(o=e.code)?void 0:o.startsWith("Key"))&&(o=o.substring(3)),o&&(0,i.Hh)(o).toLowerCase())
var o
r&&t.push(r)
const s=function(e){const t=[]
return e&&(e.alt&&t.push("alt key"),e.control&&t.push("control key"),e.meta&&t.push("meta/command key"),e.shift&&t.push("shift key")),t.join(" + ")}(e.modifiers)
return s&&t.push(s),t.join(" + ")}}(n=e.Trigger||(e.Trigger={}))}(o||(o={}))
const a=r.qt},9054(e,t,n){"use strict"
n.d(t,{C:()=>r})
const r={plurals:[[/$/,"s"],[/s$/i,"s"],[/^(ax|test)is$/i,"$1es"],[/(octop|vir)us$/i,"$1i"],[/(octop|vir)i$/i,"$1i"],[/(alias|status|bonus)$/i,"$1es"],[/(bu)s$/i,"$1ses"],[/(buffal|tomat)o$/i,"$1oes"],[/([ti])um$/i,"$1a"],[/([ti])a$/i,"$1a"],[/sis$/i,"ses"],[/(?:([^f])fe|([lr])f)$/i,"$1$2ves"],[/(hive)$/i,"$1s"],[/([^aeiouy]|qu)y$/i,"$1ies"],[/(x|ch|ss|sh)$/i,"$1es"],[/(matr|vert|ind)(?:ix|ex)$/i,"$1ices"],[/^(m|l)ouse$/i,"$1ice"],[/^(m|l)ice$/i,"$1ice"],[/^(ox)$/i,"$1en"],[/^(oxen)$/i,"$1"],[/(quiz)$/i,"$1zes"]],singular:[[/s$/i,""],[/(ss)$/i,"$1"],[/(n)ews$/i,"$1ews"],[/([ti])a$/i,"$1um"],[/((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)(sis|ses)$/i,"$1sis"],[/(^analy)(sis|ses)$/i,"$1sis"],[/([^f])ves$/i,"$1fe"],[/(hive)s$/i,"$1"],[/(tive)s$/i,"$1"],[/([lr])ves$/i,"$1f"],[/([^aeiouy]|qu)ies$/i,"$1y"],[/(s)eries$/i,"$1eries"],[/(m)ovies$/i,"$1ovie"],[/(x|ch|ss|sh)es$/i,"$1"],[/^(m|l)ice$/i,"$1ouse"],[/(bus)(es)?$/i,"$1"],[/(o)es$/i,"$1"],[/(shoe)s$/i,"$1"],[/(cris|test)(is|es)$/i,"$1is"],[/^(a)x[ie]s$/i,"$1xis"],[/(octop|vir)(us|i)$/i,"$1us"],[/(alias|status|bonus)(es)?$/i,"$1"],[/^(ox)en/i,"$1"],[/(vert|ind)ices$/i,"$1ex"],[/(matr)ices$/i,"$1ix"],[/(quiz)zes$/i,"$1"],[/(database)s$/i,"$1"]],irregularPairs:[["person","people"],["man","men"],["child","children"],["sex","sexes"],["move","moves"],["cow","kine"],["zombie","zombies"]],uncountable:["equipment","information","rice","money","species","series","fish","sheep","jeans","police"]}},9336(e,t,n){"use strict"
n.d(t,{C:()=>o,U:()=>a})
var r=n(76513),i=n(18891)
function o(e){return(0,r.AQ)(this,arguments,function(){var t,n,i
return(0,r.YH)(this,function(o){switch(o.label){case 0:t=e.getReader(),o.label=1
case 1:o.trys.push([1,,9,10]),o.label=2
case 2:return[4,(0,r.N3)(t.read())]
case 3:return n=o.sent(),i=n.value,n.done?[4,(0,r.N3)(void 0)]:[3,5]
case 4:return[2,o.sent()]
case 5:return[4,(0,r.N3)(i)]
case 6:return[4,o.sent()]
case 7:return o.sent(),[3,2]
case 8:return[3,10]
case 9:return t.releaseLock(),[7]
case 10:return[2]}})})}function a(e){return(0,i.T)(null==e?void 0:e.getReader)}},9726(e,t,n){"use strict"
n.d(t,{Y0:()=>x,iy:()=>S,jH:()=>b,sF:()=>y,uE:()=>v})
var r=n(9043),i=n(81871),o=n(92384),a=n(42594),s=n(50709),l=n(16159),c=n(83854),u=n(96174),d=n(97564),p=n(13564),h=n(64299),f=n(37411),m=n(17370)
const g=Object.keys({custom:{},auto:{},highest:{},higher:{},high:{},medium:{},low:{},lower:{},lowest:{}}),y=o.t.arrayToOptions(g),v={smoothColors:o.t.MappedStatic("auto",{auto:o.t.Group({}),on:o.t.Group({resolutionFactor:o.t.Numeric(2,{min:.5,max:6,step:.1}),sampleStride:o.t.Numeric(3,{min:1,max:12,step:1})}),off:o.t.Group({})})}
function b(e){return!!e.smoothColors}function x(e,t,n){if(("on"===e.name||"auto"===e.name&&t)&&n&&n<3){let t=3
return"on"===e.name?(n*=e.params.resolutionFactor,t=e.params.sampleStride):(n*=2-(0,d.TF)(0,1.1,n),(n=Math.max(.5,n))>1.2&&(t=2)),{resolution:n,stride:t}}}var S
!function(e){e.MaterialCategory={category:"Material"},e.ShadingCategory={category:"Shading"},e.CullingLodCategory={category:"Culling & LOD"},e.CustomQualityParamInfo={category:"Custom Quality",hideIf:e=>void 0!==e.quality&&"custom"!==e.quality},e.Params={alpha:o.t.Numeric(1,{min:0,max:1,step:.01},{label:"Opacity",isEssential:!0,description:"How opaque/transparent the representation is rendered."}),quality:o.t.Select("auto",y,{isEssential:!0,description:"Visual/rendering quality of the representation."}),material:p.i.getParam(),clip:o.t.Group(h.B.Params),emissive:o.t.Numeric(0,{min:0,max:1,step:.01}),density:o.t.Numeric(.2,{min:0,max:1,step:.01},{description:"Density value to estimate object thickness."}),instanceGranularity:o.t.Boolean(!1,{description:"Use instance granularity for marker, transparency, clipping, overpaint, substance data to save memory."}),lod:o.t.Vec3((0,f.e)(),void 0,{...e.CullingLodCategory,description:"Level of detail.",fieldLabels:{x:"Min Distance",y:"Max Distance",z:"Overlap (Shader)"}}),cellSize:o.t.Numeric(200,{min:0,max:5e3,step:100},{...e.CullingLodCategory,description:"Instance grid cell size."}),batchSize:o.t.Numeric(2e3,{min:0,max:5e4,step:500},{...e.CullingLodCategory,description:"Instance grid batch size."})},e.createSimple=function(e=s.ColorNames.grey,t=1,n){return n||(n=(0,a.Zk)()),{transform:n,locationIterator:(0,i.iQ)(1,n.instanceCount.ref.value,1,()=>l.LU,!1,()=>!1),theme:{color:(0,c.TA)({},{value:e,lightness:0,saturation:0}),size:(0,u.ru)({},{value:t})}}},e.createValues=function(e,t){const n=h.B.getClip(e.clip)
return{alpha:r.IQ.create(e.alpha),uAlpha:r.IQ.create(e.alpha),uVertexCount:r.IQ.create(t.vertexCount),uGroupCount:r.IQ.create(t.groupCount),drawCount:r.IQ.create(t.drawCount),uMetalness:r.IQ.create(e.material.metalness),uRoughness:r.IQ.create(e.material.roughness),uBumpiness:r.IQ.create(e.material.bumpiness),uEmissive:r.IQ.create(e.emissive),uDensity:r.IQ.create(e.density),dClipObjectCount:r.IQ.create(n.objects.count),dClipVariant:r.IQ.create(n.variant),uClipObjectType:r.IQ.create(n.objects.type),uClipObjectInvert:r.IQ.create(n.objects.invert),uClipObjectPosition:r.IQ.create(n.objects.position),uClipObjectRotation:r.IQ.create(n.objects.rotation),uClipObjectScale:r.IQ.create(n.objects.scale),uClipObjectTransform:r.IQ.create(n.objects.transform),instanceGranularity:r.IQ.create(e.instanceGranularity),uLod:r.IQ.create(m.Z.create(e.lod[0],e.lod[1],e.lod[2],0))}},e.updateValues=function(e,t){r.IQ.updateIfChanged(e.alpha,t.alpha),r.IQ.updateIfChanged(e.uMetalness,t.material.metalness),r.IQ.updateIfChanged(e.uRoughness,t.material.roughness),r.IQ.updateIfChanged(e.uBumpiness,t.material.bumpiness),r.IQ.updateIfChanged(e.uEmissive,t.emissive),r.IQ.updateIfChanged(e.uDensity,t.density)
const n=h.B.getClip(t.clip)
r.IQ.updateIfChanged(e.dClipObjectCount,n.objects.count),r.IQ.updateIfChanged(e.dClipVariant,n.variant),r.IQ.update(e.uClipObjectType,n.objects.type),r.IQ.update(e.uClipObjectInvert,n.objects.invert),r.IQ.update(e.uClipObjectPosition,n.objects.position),r.IQ.update(e.uClipObjectRotation,n.objects.rotation),r.IQ.update(e.uClipObjectScale,n.objects.scale),r.IQ.update(e.uClipObjectTransform,n.objects.transform),r.IQ.updateIfChanged(e.instanceGranularity,t.instanceGranularity),r.IQ.update(e.uLod,m.Z.set(e.uLod.ref.value,t.lod[0],t.lod[1],t.lod[2],0))},e.createRenderableState=function(e={}){const t=void 0===e.alpha||1===e.alpha
return{disposed:!1,visible:!0,alphaFactor:1,pickable:!0,colorOnly:!1,opaque:t,writeDepth:t}},e.updateRenderableState=function(e,t){e.opaque=t.alpha*e.alphaFactor>=1,e.writeDepth=e.opaque}}(S||(S={}))},9959(e,t,n){"use strict"
function r(e=0,t=Number.MAX_SAFE_INTEGER){let n=e
return()=>{const e=n
return n=(n+1)%t,e}}n.d(t,{q:()=>r})},9971(e,t){"use strict"
Object.defineProperty(t,"__esModule",{value:!0}),t.camelCase=void 0
var n=/^--[a-zA-Z0-9_-]+$/,r=/-([a-z])/g,i=/^[^-]+$/,o=/^-(webkit|moz|ms|o|khtml)-/,a=/^-(ms)-/,s=function(e,t){return t.toUpperCase()},l=function(e,t){return"".concat(t,"-")}
t.camelCase=function(e,t){return void 0===t&&(t={}),function(e){return!e||i.test(e)||n.test(e)}(e)?e:(e=e.toLowerCase(),(e=t.reactCompat?e.replace(a,l):e.replace(o,l)).replace(r,s))}},10134(e,t,n){"use strict"
n.d(t,{_F:()=>o,qk:()=>a,tM:()=>r})
var r,i=n(21317)
function o(e){return{data:e,position:0,length:e.length,lineNumber:1,tokenStart:0,tokenEnd:0}}function a(e,t,n){let r=t,i=n-1,o=e.charCodeAt(r)
for(;(9===o||32===o)&&r<=i;)o=e.charCodeAt(++r)
for(o=e.charCodeAt(i);(9===o||32===o)&&i>=r;)o=e.charCodeAt(--i)
return e.substring(r,i+1)}!function(e){function t(e){return e.data.substring(e.tokenStart,e.tokenEnd)}function n(e){const{data:t}=e
for(;e.position<e.length;)switch(t.charCodeAt(e.position)){case 10:return e.tokenEnd=e.position,++e.position,++e.lineNumber,!0
case 13:return e.tokenEnd=e.position,++e.position,++e.lineNumber,10===t.charCodeAt(e.position)&&++e.position,!0
default:++e.position}return e.tokenEnd=e.position,e.tokenStart!==e.tokenEnd}function o(e){return e.tokenStart=e.position,n(e)}function a(e,t,n){let i=0
for(let a=0;a<t;a++){if(!o(e))return i
r.addUnchecked(n,e.tokenStart,e.tokenEnd),i++}return i}function s(e,t,n){const{data:r}=e
let i=t,o=n-1,a=r.charCodeAt(i)
for(;(9===a||32===a)&&i<=o;)a=r.charCodeAt(++i)
for(a=r.charCodeAt(o);(9===a||32===a)&&o>=i;)a=r.charCodeAt(--o)
return e.tokenStart=i,e.tokenEnd=o+1,e.position=n,e}e.getTokenString=t,e.reset=function(e){e.position=0,e.lineNumber=1,e.tokenStart=0,e.tokenEnd=0},e.eatLine=n,e.markStart=function(e){e.tokenStart=e.position},e.markLine=o,e.readLine=function(e){return o(e),t(e)},e.readLineTrim=function(e){o(e)
const n=e.position
return s(e,e.tokenStart,e.tokenEnd),e.position=n,t(e)},e.markLines=function(e,t){const n=r.create(e.data,2*t)
return a(e,t,n),n},e.readLines=function(t,n){const r=[]
for(let i=0;i<n;i++)r.push(e.readLine(t))
return r},e.readLinesAsync=async function(e,t,n,o=1e5){const s=r.create(e.data,2*t)
let l=0
return await(0,i.y)(n,o,e,(e,n)=>{const r=Math.min(t-l,e)
return a(n,r,s),l+=r,r},(e,t)=>e.update({message:"Parsing...",current:t.position,max:t.length})),s},e.readAllLines=function(t){const n=e(t),i=r.create(n.data,Math.max(t.length/80,2))
for(;o(n);)r.add(i,n.tokenStart,n.tokenEnd)
return i},e.readAllLinesAsync=async function(t,n,a=1e5){const s=e(t),l=r.create(s.data,Math.max(t.length/80,2))
return await(0,i.y)(n,a,s,(e,t)=>(function(e,t,n){let i=0
for(let a=0;a<t;a++){if(!o(e))return i
r.add(n,e.tokenStart,e.tokenEnd),i++}}(t,e,l),t.position<t.length?e:0),(e,t)=>e.update({message:"Parsing...",current:t.position,max:t.length})),l},e.eatValue=function(e){for(;e.position<e.length;)switch(e.data.charCodeAt(e.position)){case 9:case 10:case 13:case 32:return void(e.tokenEnd=e.position)
default:++e.position}e.tokenEnd=e.position},e.skipWhitespace=function(e){let t=-1
for(;e.position<e.length;){const n=e.data.charCodeAt(e.position)
switch(n){case 9:case 32:t=n,++e.position
break
case 10:13!==t&&++e.lineNumber,t=n,++e.position
break
case 13:t=n,++e.position,++e.lineNumber
break
default:return t}}return t},e.skipStrictWhitespace=function(e){let t=-1
for(;e.position<e.length;){const n=e.data.charCodeAt(e.position)
switch(n){case 9:case 32:t=n,++e.position
break
default:return t}}return t},e.trim=s}(o||(o={})),function(e){function t(e,t,n){const r=e
r.offset>r.indicesLenMinus2&&function(e){const t=new Uint32Array(1.61*e.indices.length|0)
t.set(e.indices),e.indices=t,e.indicesLenMinus2=t.length-2|0}(r),r.indices[r.offset++]=t,r.indices[r.offset++]=n,e.count++}e.add=t,e.addToken=function(e,n){t(e,n.tokenStart,n.tokenEnd)},e.addUnchecked=function(e,t,n){e.indices[e.offset++]=t,e.indices[e.offset++]=n,e.count++},e.create=function(e,t){return{data:e,indicesLenMinus2:(t=Math.max(10,t))-2|0,count:0,offset:0,indices:new Uint32Array(t)}}}(r||(r={}))},10196(e,t,n){"use strict"
var r
n.d(t,{H:()=>r}),function(e){e.error=function(e,n=-1){return new t(e,n)},e.success=function(e,t=[]){return new n(e,t)}
class t{toString(){return this.line>=0?`[Line ${this.line}] ${this.message}`:this.message}constructor(e,t){this.message=e,this.line=t,this.isError=!0}}e.Error=t
class n{constructor(e,t){this.result=e,this.warnings=t,this.isError=!1}}e.Success=n}(r||(r={}))},10212(e,t,n){"use strict"
n.d(t,{i:()=>f})
var r=n(29282),i=n(14294),o=n(32775),a=n(69045),s=n(60566),l=n(48393)
function c(e,t,n,r){const i=e.id.value(n),o=e.details.value(n),c=[],{assembly_id:d,oper_expression:f,asym_id_list:m}=t
for(let a=0,s=t._rowCount;a<s;a++)d.value(a)===i&&(c[c.length]={assemblyId:i,expression:f.value(a),asymIds:m.value(a)})
return s.N.create(i,o,function(e,t){return()=>{const n=[]
let r=0
for(let i=0;i<e.length;i++){const o=e[i],s=u(h(o.expression)),c=p(t,s,r,o.assemblyId),d=l.Queries.generators.atoms({chainTest:l.Queries.pred.and(l.Queries.pred.eq(e=>l.StructureProperties.unit.operator_name(e.element),a.J.DefaultName),l.Queries.pred.inSet(e=>l.StructureProperties.chain.label_asym_id(e.element),o.asymIds))})
n[n.length]={selector:d,operators:c,asymIds:o.asymIds},r+=c.length}return n}}(c,r))}function u(e){const t=[],n=[]
for(let r=0;r<e.length;r++)n[r]=""
return d(e,t,e.length-1,n),t}function d(e,t,n,r){if(n<0)return void(t[t.length]=r.slice(0))
const i=e[n],o=i.length
for(let a=0;a<o;a++)r[n]=i[a],d(e,t,n-1,r)}function p(e,t,n,r){const i=[]
let s=n
for(const l of t){const t=o.$I.identity()
for(let r=0;r<l.length;r++)o.$I.mul(t,t,e.get(l[r]))
s++
const n=`ASM_${s}`,c=a.J.getAssemblyOperatorName(l)
i[i.length]=a.J.create(n,t,{instanceId:c,assembly:{id:r,operId:s,operList:l}})}return i}function h(e){const t=/\(?([^\(\)]+)\)?]*/g,n=[],r=[]
let i
for(;i=t.exec(e);)n[n.length]=i[1]
return n.forEach(e=>{const t=[]
e.split(",").forEach(e=>{const n=e.indexOf("-")
if(n>0){const r=parseInt(e.substring(0,n)),i=parseInt(e.substr(n+1))
for(let e=r;e<=i;e++)t[t.length]=e.toString()}else t[t.length]=e.trim()}),r[r.length]=t}),r}var f,m=n(92726)
function g(e){if(0===e._rowCount)return
const{id:t,matrix:n,vector:a}=e,s=r.r.struct_ncs_oper.matrix.space,l=r.r.struct_ncs_oper.vector.space,c=[]
for(let r=0;r<e._rowCount;r++){const u=o.qY.toMat3((0,o.U)(),s,n.value(r)),d=o.qY.toVec3((0,o.eB)(),l,a.value(r))
if(!i.JX.checkIfRotationAndTranslation(u,d))continue
if("given"===e.code.value(r)&&!o.U.isIdentity(u)&&!o.eB.isZero(d))continue
const p=t.value(r)
c[c.length]=i.JX.ofRotationAndOffset(`ncs_${p}`,u,d,p)}return c}!function(e){e.Descriptor={name:"model_symmetry"},e.Provider=m.q.create(e.Descriptor),e.fromData=function(e){const t=function(e,t,n){if(!e._rowCount)return[]
const r=function(e){const{id:t,matrix:n,vector:r,_schema:i}=e,a=new Map,s=(0,o.eB)()
for(let l=0,c=e._rowCount;l<c;l++){const e=o.qY.toMat4((0,o.$I)(),i.matrix.space,n.value(l))
o.qY.toVec3(s,i.vector.space,r.value(l)),o.$I.setTranslation(e,s),o.$I.setValue(e,3,3,1),a.set(t.value(l),e)}return a}(n),i=[]
for(let o=0;o<e._rowCount;o++)i[i.length]=c(e,t,o,r)
return i}(e.pdbx_struct_assembly,e.pdbx_struct_assembly_gen,e.pdbx_struct_oper_list),n=function(e,t){if(0===e._rowCount||0===t._rowCount)return i.is.ZeroP1
const n=t.length_a.value(0),r=t.length_b.value(0),a=t.length_c.value(0)
if(0===n||0===r||0===a)return i.is.ZeroP1
const s=t.angle_alpha.value(0),l=t.angle_beta.value(0),c=t.angle_gamma.value(0)
if(0===s||0===l||0===c)return i.is.ZeroP1
const u=function(e){const t=e.Int_Tables_number.value(0),n=e["space_group_name_H-M"].value(0)
return e.Int_Tables_number.isDefined?e["space_group_name_H-M"].isDefined?n:t:n}(e),d=i.O8.create(u,o.eB.create(n,r,a),o.eB.scale((0,o.eB)(),o.eB.create(s,l,c),Math.PI/180))
return i.is.create(d)}(e.symmetry,e.cell)
return{assemblies:t,spacegroup:n,isNonStandardCrystalFrame:(e.atom_sites._rowCount,!1),ncsOperators:g(e.struct_ncs_oper)}},e.fromCell=function(e,t){const n=i.O8.create("P 1",e,t)
return{assemblies:[],spacegroup:i.is.create(n),isNonStandardCrystalFrame:!1}}}(f||(f={}))},10267(e,t,n){"use strict"
n.d(t,{Bj:()=>R,n9:()=>y})
var r=n(92384),i=n(9726),o=n(48393),a=n(43472),s=n(66187),l=n(19288),c=n(47954),u=n(58070),d=n(52429),p=n(70594),h=n(64367),f=n(65746),m=n(91229),g=n(37411)
function y(e){return e}!function(e){e.CommonParams={ignoreHydrogens:r.t.Optional(r.t.Boolean(!1)),ignoreHydrogensVariant:r.t.Optional(r.t.Select("all",r.t.arrayToOptions(["all","non-polar"]))),ignoreLight:r.t.Optional(r.t.Boolean(!1)),quality:r.t.Optional(r.t.Select("auto",i.sF)),theme:r.t.Optional(r.t.Group({globalName:r.t.Optional(r.t.Text("")),globalColorParams:r.t.Optional(r.t.Value({},{isHidden:!0})),carbonColor:r.t.Optional(r.t.Select("chain-id",r.t.arrayToOptions(["chain-id","operator-name","element-symbol"]))),symmetryColor:r.t.Optional(r.t.Text("")),symmetryColorParams:r.t.Optional(r.t.Value({},{isHidden:!0})),focus:r.t.Optional(r.t.Group({name:r.t.Optional(r.t.Text("")),params:r.t.Optional(r.t.Value({}))}))}))},e.reprBuilder=function(e,t,n){var r,i,o,a,s,l,c,u,h,f,m,g,y,v
const b=e.state.data.build(),x=e.builders.structure.representation,S=e.managers.structure.component.state.options.hydrogens,_={quality:e.managers.structure.component.state.options.visualQuality,ignoreHydrogens:"all"!==S,ignoreHydrogensVariant:"only-polar"===S?"non-polar":"all",ignoreLight:e.managers.structure.component.state.options.ignoreLight}
t.quality&&"auto"!==t.quality&&(_.quality=t.quality),void 0!==t.ignoreHydrogens&&(_.ignoreHydrogens=!!t.ignoreHydrogens),void 0!==t.ignoreHydrogensVariant&&(_.ignoreHydrogensVariant=t.ignoreHydrogensVariant),void 0!==t.ignoreLight&&(_.ignoreLight=!!t.ignoreLight)
const C=(null===(r=t.theme)||void 0===r?void 0:r.globalName)?null===(i=t.theme)||void 0===i?void 0:i.globalName:void 0,w=void 0!==(null===(o=t.theme)||void 0===o?void 0:o.carbonColor)?{carbonColor:(T=null===(a=t.theme)||void 0===a?void 0:a.carbonColor,"chain-id"===T?{name:T,params:d.oy.defaultValues}:"operator-name"===T?{name:T,params:p.PO.defaultValues}:{name:T,params:{}}),...null===(s=t.theme)||void 0===s?void 0:s.globalColorParams}:{...null===(l=t.theme)||void 0===l?void 0:l.globalColorParams}
var T
const A=n&&(null===(c=t.theme)||void 0===c?void 0:c.symmetryColor)&&function(e){return e.units.some(e=>!e.conformation.operator.assembly&&e.conformation.operator.spgrOp>=0)}(n)?null===(u=t.theme)||void 0===u?void 0:u.symmetryColor:C
return{update:b,builder:x,color:C,symmetryColor:A,symmetryColorParams:(null===(h=t.theme)||void 0===h?void 0:h.symmetryColorParams)?{...null===(f=t.theme)||void 0===f?void 0:f.globalColorParams,...null===(m=t.theme)||void 0===m?void 0:m.symmetryColorParams}:{...null===(g=t.theme)||void 0===g?void 0:g.globalColorParams},globalColorParams:(null===(y=t.theme)||void 0===y?void 0:y.globalColorParams)?{...null===(v=t.theme)||void 0===v?void 0:v.globalColorParams}:void 0,typeParams:_,ballAndStickColor:w}},e.updateFocusRepr=function(e,t,n,r){if(e.state.hasBehavior(c.StructureFocusRepresentation))return e.state.updateBehavior(c.StructureFocusRepresentation,i=>{const o=(0,u.IZ)(e,t,"ball-and-stick",n||"element-symbol",r)
i.surroundingsParams.colorTheme=o,i.targetParams.colorTheme=o})}}(y||(y={}))
const v=y.CommonParams,b=y.reprBuilder,x=y.updateFocusRepr,S=y({id:"preset-structure-representation-auto",display:{name:"Automatic",description:"Show representations based on the size of the structure. Smaller structures are shown with more detail than larger ones, ranging from atomistic display to coarse surfaces."},params:()=>v,apply(e,t,n){var r,i
const s=null===(i=null===(r=a.so.resolveAndCheck(n.state.data,e))||void 0===r?void 0:r.obj)||void 0===i?void 0:i.data
if(!s)return{}
const c=n.config.get(l.PluginConfig.Structure.SizeThresholds)||o.Structure.DefaultSizeThresholds,u=o.Structure.getSize(s,c),d=s.polymerResidueCount/s.polymerGapCount
switch(u){case o.Structure.Size.Gigantic:case o.Structure.Size.Huge:return A.apply(e,t,n)
case o.Structure.Size.Large:return I.apply(e,t,n)
case o.Structure.Size.Medium:if(d>3)return w.apply(e,t,n)
case o.Structure.Size.Small:return P.apply(e,{...t,showCarbohydrateSymbol:!0},n)
default:(0,m.dr)(u)}}}),_=y({id:"preset-structure-representation-empty",display:{name:"Empty",description:"Removes all existing representations."},apply:async(e,t,n)=>({})}),C="Basic",w=y({id:"preset-structure-representation-polymer-and-ligand",display:{name:"Polymer & Ligand",group:C,description:"Shows polymers as Cartoon, ligands as Ball & Stick, carbohydrates as 3D-SNFG and water molecules semi-transparent."},params:()=>v,async apply(e,t,n){var r,i,o,s,l,c,u,d,p,h
const f=a.so.resolveAndCheck(n.state.data,e)
if(!f)return{}
const m={polymer:await D(n,f,"polymer"),ligand:await D(n,f,"ligand"),nonStandard:await D(n,f,"non-standard"),branched:await D(n,f,"branched",{label:"Carbohydrate"}),water:await D(n,f,"water"),ion:await D(n,f,"ion"),lipid:await D(n,f,"lipid"),coarse:await D(n,f,"coarse")},g=f.obj.data,y=((null===(o=null===(i=null===(r=m.water)||void 0===r?void 0:r.obj)||void 0===i?void 0:i.data)||void 0===o?void 0:o.elementCount)||0)>5e4?"line":"ball-and-stick",v=((null===(c=null===(l=null===(s=m.lipid)||void 0===s?void 0:s.obj)||void 0===l?void 0:l.data)||void 0===c?void 0:c.elementCount)||0)>2e4?"line":"ball-and-stick",{update:S,builder:_,typeParams:C,color:w,symmetryColor:T,symmetryColorParams:A,globalColorParams:I,ballAndStickColor:P}=b(n,t,g),B={polymer:_.buildRepresentation(S,m.polymer,{type:"cartoon",typeParams:C,color:T,colorParams:A},{tag:"polymer"}),ligand:_.buildRepresentation(S,m.ligand,{type:"ball-and-stick",typeParams:C,color:w,colorParams:P},{tag:"ligand"}),nonStandard:_.buildRepresentation(S,m.nonStandard,{type:"ball-and-stick",typeParams:C,color:w,colorParams:P},{tag:"non-standard"}),branchedBallAndStick:_.buildRepresentation(S,m.branched,{type:"ball-and-stick",typeParams:{...C,alpha:.3},color:w,colorParams:P},{tag:"branched-ball-and-stick"}),branchedSnfg3d:_.buildRepresentation(S,m.branched,{type:"carbohydrate",typeParams:C,color:w,colorParams:I},{tag:"branched-snfg-3d"}),water:_.buildRepresentation(S,m.water,{type:y,typeParams:{...C,alpha:.6,visuals:"line"===y?["intra-bond","element-point"]:void 0},color:w,colorParams:{carbonColor:{name:"element-symbol",params:{}},...I}},{tag:"water"}),ion:_.buildRepresentation(S,m.ion,{type:"ball-and-stick",typeParams:C,color:w,colorParams:{carbonColor:{name:"element-symbol",params:{}},...I}},{tag:"ion"}),lipid:_.buildRepresentation(S,m.lipid,{type:v,typeParams:{...C,alpha:.6,visuals:"line"===v?["intra-bond"]:void 0},color:w,colorParams:{carbonColor:{name:"element-symbol",params:{}},...I}},{tag:"lipid"}),coarse:_.buildRepresentation(S,m.coarse,{type:"spacefill",typeParams:C,color:w||"chain-id",colorParams:I},{tag:"coarse"})}
return await S.commit({revertOnError:!1}),await x(n,g,null===(d=null===(u=t.theme)||void 0===u?void 0:u.focus)||void 0===d?void 0:d.name,null===(h=null===(p=t.theme)||void 0===p?void 0:p.focus)||void 0===h?void 0:h.params),{components:m,representations:B}}}),T=y({id:"preset-structure-representation-protein-and-nucleic",display:{name:"Protein & Nucleic",group:C,description:"Shows proteins as Cartoon and RNA/DNA as Gaussian Surface."},params:()=>v,async apply(e,t,n){var r,i,o,s
const l=a.so.resolveAndCheck(n.state.data,e)
if(!l)return{}
const c={protein:await M(n,l,"protein"),nucleic:await M(n,l,"nucleic")},u=l.obj.data,d={radiusOffset:u.isCoarseGrained?2:0,smoothness:u.isCoarseGrained?1:1.5},{update:p,builder:h,typeParams:f,symmetryColor:m,symmetryColorParams:g}=b(n,t,u),y={protein:h.buildRepresentation(p,c.protein,{type:"cartoon",typeParams:f,color:m,colorParams:g},{tag:"protein"}),nucleic:h.buildRepresentation(p,c.nucleic,{type:"gaussian-surface",typeParams:{...f,...d},color:m,colorParams:g},{tag:"nucleic"})}
return await p.commit({revertOnError:!0}),await x(n,u,null===(i=null===(r=t.theme)||void 0===r?void 0:r.focus)||void 0===i?void 0:i.name,null===(s=null===(o=t.theme)||void 0===o?void 0:o.focus)||void 0===s?void 0:s.params),{components:c,representations:y}}}),A=y({id:"preset-structure-representation-coarse-surface",display:{name:"Coarse Surface",group:C,description:"Shows polymers and lipids as coarse Gaussian Surface."},params:()=>v,async apply(e,t,n){var r,i,s,c
const u=a.so.resolveAndCheck(n.state.data,e)
if(!u)return{}
const d={polymer:await D(n,u,"polymer"),lipid:await D(n,u,"lipid")},p=u.obj.data,h=n.config.get(l.PluginConfig.Structure.SizeThresholds)||o.Structure.DefaultSizeThresholds,f=o.Structure.getSize(p,h),m=Object.create(null)
f===o.Structure.Size.Gigantic?Object.assign(m,{traceOnly:!p.isCoarseGrained,radiusOffset:2,smoothness:1,visuals:["structure-gaussian-surface-mesh"]}):f===o.Structure.Size.Huge?Object.assign(m,{radiusOffset:p.isCoarseGrained?2:0,smoothness:1}):p.isCoarseGrained&&Object.assign(m,{radiusOffset:2,smoothness:1})
const{update:g,builder:y,typeParams:v,symmetryColor:S,symmetryColorParams:_}=b(n,t,p),C={polymer:y.buildRepresentation(g,d.polymer,{type:"gaussian-surface",typeParams:{...v,...m},color:S,colorParams:_},{tag:"polymer"}),lipid:y.buildRepresentation(g,d.lipid,{type:"gaussian-surface",typeParams:{...v,...m},color:S,colorParams:_},{tag:"lipid"})}
return await g.commit({revertOnError:!0}),await x(n,p,null===(i=null===(r=t.theme)||void 0===r?void 0:r.focus)||void 0===i?void 0:i.name,null===(c=null===(s=t.theme)||void 0===s?void 0:s.focus)||void 0===c?void 0:c.params),{components:d,representations:C}}}),I=y({id:"preset-structure-representation-polymer-cartoon",display:{name:"Polymer Cartoon",group:C,description:"Shows polymers as Cartoon."},params:()=>v,async apply(e,t,n){var r,i,o,s
const l=a.so.resolveAndCheck(n.state.data,e)
if(!l)return{}
const c={polymer:await D(n,l,"polymer")},u=l.obj.data,{update:d,builder:p,typeParams:h,symmetryColor:f,symmetryColorParams:m}=b(n,t,u),g={polymer:p.buildRepresentation(d,c.polymer,{type:"cartoon",typeParams:h,color:f,colorParams:m},{tag:"polymer"})}
return await d.commit({revertOnError:!0}),await x(n,u,null===(i=null===(r=t.theme)||void 0===r?void 0:r.focus)||void 0===i?void 0:i.name,null===(s=null===(o=t.theme)||void 0===o?void 0:o.focus)||void 0===s?void 0:s.params),{components:c,representations:g}}}),P=y({id:"preset-structure-representation-atomic-detail",display:{name:"Atomic Detail",group:C,description:"Shows everything in atomic detail."},params:()=>({...v,showCarbohydrateSymbol:r.t.Boolean(!1)}),async apply(e,t,n){var r,i,o,s,l,c
const u=a.so.resolveAndCheck(n.state.data,e)
if(!u)return{}
const d={all:await D(n,u,"all"),branched:void 0},p=u.obj.data,m=p.elementCount>1e5,g=p.elementCount>1e6,y=p.units.length>5e3,v=p.atomicResidueCount&&p.elementCount>1e3&&p.atomicResidueCount/p.elementCount<3,S=p.models[0],_=!!h.z.Provider.get(S)||f.A.isExhaustive(S)
let C="ball-and-stick"
p.isCoarseGrained||y?C=g?"point":"spacefill":v&&!_?C="spacefill":m&&(C="line")
const w=t.showCarbohydrateSymbol&&!m&&!v
w&&Object.assign(d,{branched:await D(n,u,"branched",{label:"Carbohydrate"})})
const{update:T,builder:A,typeParams:I,color:P,ballAndStickColor:B,globalColorParams:E}=b(n,t,p),k=v&&!_?{carbonColor:{name:"element-symbol",params:{}},...E}:B,M={all:A.buildRepresentation(T,d.all,{type:C,typeParams:I,color:P,colorParams:k},{tag:"all"})}
return w&&Object.assign(M,{snfg3d:A.buildRepresentation(T,d.branched,{type:"carbohydrate",typeParams:{...I,alpha:.4,visuals:["carbohydrate-symbol"]},color:P,colorParams:E},{tag:"snfg-3d"})}),await T.commit({revertOnError:!0}),await x(n,p,null!==(o=null===(i=null===(r=t.theme)||void 0===r?void 0:r.focus)||void 0===i?void 0:i.name)&&void 0!==o?o:P,null!==(c=null===(l=null===(s=t.theme)||void 0===s?void 0:s.focus)||void 0===l?void 0:l.params)&&void 0!==c?c:k),{components:d,representations:M}}}),B=y({id:"preset-structure-representation-illustrative",display:{name:"Illustrative",group:"Miscellaneous",description:"Show everything in spacefill representation with illustrative colors and ignore light."},params:()=>v,async apply(e,t,n){var r,i,o,s,l
const c=a.so.resolveAndCheck(n.state.data,e)
if(!c)return{}
const u={all:await D(n,c,"all"),branched:void 0},d=c.obj.data,{update:p,builder:h,typeParams:f,color:m}=b(n,t,d),g={all:h.buildRepresentation(p,u.all,{type:"spacefill",typeParams:{...f,ignoreLight:!0},color:"illustrative",colorParams:{style:{name:"entity-id",params:{overrideWater:!0}}}},{tag:"all"})}
return await p.commit({revertOnError:!0}),await x(n,d,null!==(o=null===(i=null===(r=t.theme)||void 0===r?void 0:r.focus)||void 0===i?void 0:i.name)&&void 0!==o?o:m,null===(l=null===(s=t.theme)||void 0===s?void 0:s.focus)||void 0===l?void 0:l.params),{components:u,representations:g}}}),E=y({id:"preset-structure-representation-molecular-surface",display:{name:"Molecular Surface",group:"Miscellaneous",description:"Show everything in molecular surface representation with illustrative colors."},params:()=>v,async apply(e,t,n){var r,i,o,s,l
const c=a.so.resolveAndCheck(n.state.data,e)
if(!c)return{}
const u={all:await D(n,c,"all"),branched:void 0},d=c.obj.data,{update:p,builder:h,typeParams:f,color:m}=b(n,t,d),g={all:h.buildRepresentation(p,u.all,{type:"molecular-surface",typeParams:f,color:"entity-id",colorParams:{overrideWater:!0}},{tag:"all"})}
return await p.commit({revertOnError:!0}),await x(n,d,null!==(o=null===(i=null===(r=t.theme)||void 0===r?void 0:r.focus)||void 0===i?void 0:i.name)&&void 0!==o?o:m,null===(l=null===(s=t.theme)||void 0===s?void 0:s.focus)||void 0===l?void 0:l.params),{components:u,representations:g}}}),k=y({id:"preset-structure-representation-auto-lod",display:{name:"Automatic Detail",group:"Miscellaneous",description:"Shows more (or less) detailed representations automatically based on camera distance."},params:()=>v,async apply(e,t,n){var r,i,o,s
const l=a.so.resolveAndCheck(n.state.data,e)
if(!l)return{}
const c={all:await D(n,l,"all")},u=l.obj.data,{update:d,builder:p,typeParams:h,color:f,symmetryColor:m,symmetryColorParams:y,ballAndStickColor:v}=b(n,t,u),S={gaussianSurface:p.buildRepresentation(d,c.all,{type:"gaussian-surface",typeParams:{...h,lod:g.e.create(30,1e7,100)},color:m,colorParams:y},{tag:"gaussian-surface"}),cartoon:p.buildRepresentation(d,c.all,{type:"cartoon",typeParams:{...h,lod:g.e.create(-20,300,100)},color:m,colorParams:y},{tag:"cartoon"}),ballAndStick:p.buildRepresentation(d,c.all,{type:"ball-and-stick",typeParams:{...h,lod:g.e.create(-20,40,20)},color:f,colorParams:v},{tag:"ball-and-stick"})}
return await d.commit({revertOnError:!1}),await x(n,u,null===(i=null===(r=t.theme)||void 0===r?void 0:r.focus)||void 0===i?void 0:i.name,null===(s=null===(o=t.theme)||void 0===o?void 0:o.focus)||void 0===s?void 0:s.params),{components:c,representations:S}}})
function D(e,t,n,r){return e.builders.structure.tryCreateComponentStatic(t,n,r)}function M(e,t,n,r){return e.builders.structure.tryCreateComponentFromSelection(t,s.StructureSelectionQueries[n],`selection-${n}`,r)}const R={empty:_,auto:S,"atomic-detail":P,"polymer-cartoon":I,"polymer-and-ligand":w,"protein-and-nucleic":T,"coarse-surface":A,illustrative:B,"molecular-surface":E,"auto-lod":k}},10268(e,t,n){"use strict"
n.d(t,{X:()=>c,q:()=>l})
var r=n(32775),i=n(83794),o=n(27011)
const a=new Map,s=r.$I.identity()
function l(e){let t=a.get(e)
return void 0===t&&(t=(0,o.i)(e),a.set(e,t)),t}function c(e,t,n,o){i.P.addPrimitive(e,function(e,t,n){return r.$I.scaleUniformly(e,r.$I.fromTranslation(e,t),n)}(s,t,n),l(o))}},10314(e,t,n){"use strict"
n.d(t,{Z:()=>d})
var r=n(37411),i=n(25919),o=n(63317),a=n(52057)
const s=r.e.dot,l=r.e.copy,c=r.e.scaleAndSub,u=r.e.scaleAndAdd
class d{computeExtrema(e,t){const n=s(this.dir[e],t)
n<this.minDist[e]&&(this.minDist[e]=n,l(this.extrema[2*e],t)),n>this.maxDist[e]&&(this.maxDist[e]=n,l(this.extrema[2*e+1],t))}computeSphereExtrema(e,t,n){const r=this.dir[e],i=s(r,t)
i-n<this.minDist[e]&&(this.minDist[e]=i-n,c(this.extrema[2*e],t,r,n)),i+n>this.maxDist[e]&&(this.maxDist[e]=i+n,u(this.extrema[2*e+1],t,r,n))}includeSphere(e){if(o.f.hasExtrema(e)&&e.extrema.length>1)for(const t of e.extrema)this.includePosition(t)
else this.includePositionRadius(e.center,e.radius)}includePosition(e){for(let t=0;t<this.dirLength;++t)this.computeExtrema(t,e)}includePositionRadius(e,t){for(let n=0;n<this.dirLength;++n)this.computeSphereExtrema(n,e,t)}finishedIncludeStep(){for(let e=0;e<this.extrema.length;e++)this.centroidHelper.includeStep(this.extrema[e])
this.centroidHelper.finishedIncludeStep()}radiusSphere(e){if(o.f.hasExtrema(e)&&e.extrema.length>1)for(const t of e.extrema)this.radiusPosition(t)
else this.radiusPositionRadius(e.center,e.radius)}radiusPosition(e){this.centroidHelper.radiusStep(e)}radiusPositionRadius(e,t){this.centroidHelper.radiusSphereStep(e,t)}getSphere(e){return o.f.setExtrema(this.centroidHelper.getSphere(e),this.extrema.slice())}getBox(e){return a.D.fromVec3Array(e||(0,a.D)(),this.extrema)}reset(){for(let e=0;e<this.dirLength;++e)this.minDist[e]=1/0,this.maxDist[e]=-1/0,this.extrema[2*e]=(0,r.e)(),this.extrema[2*e+1]=(0,r.e)()
this.centroidHelper.reset()}constructor(e){this.minDist=[],this.maxDist=[],this.extrema=[],this.centroidHelper=new i.p,this.dir=function(e){let t
switch(e){case"6":t=[...p]
break
case"14":t=[...p,...h]
break
case"26":t=[...p,...h,...f]
break
case"98":t=[...p,...h,...f,...m,...g,...y]}return t.map(e=>{const t=r.e.create(e[0],e[1],e[2])
return r.e.normalize(t,t)})}(e),this.dirLength=this.dir.length,this.reset()}}const p=[[1,0,0],[0,1,0],[0,0,1]],h=[[1,1,1],[-1,1,1],[-1,-1,1],[1,-1,1]],f=[[1,1,0],[1,-1,0],[1,0,1],[1,0,-1],[0,1,1],[0,1,-1]],m=[[0,1,2],[0,2,1],[1,0,2],[2,0,1],[1,2,0],[2,1,0],[0,1,-2],[0,2,-1],[1,0,-2],[2,0,-1],[1,-2,0],[2,-1,0]],g=[[1,1,2],[2,1,1],[1,2,1],[1,-1,2],[1,1,-2],[1,-1,-2],[2,-1,1],[2,1,-1],[2,-1,-1],[1,-2,1],[1,2,-1],[1,-2,-1]],y=[[2,2,1],[1,2,2],[2,1,2],[2,-2,1],[2,2,-1],[2,-2,-1],[1,-2,2],[1,2,-2],[1,-2,-2],[2,-1,2],[2,1,-2],[2,-1,-2]]},10390(e,t,n){"use strict"
n.d(t,{Y:()=>o,l:()=>a})
var r=n(86814),i=null
function o(e){if(r.$.useDeprecatedSynchronousErrorHandling){var t=!i
if(t&&(i={errorThrown:!1,error:null}),e(),t){var n=i,o=n.errorThrown,a=n.error
if(i=null,o)throw a}}else e()}function a(e){r.$.useDeprecatedSynchronousErrorHandling&&i&&(i.errorThrown=!0,i.error=e)}},10596(e,t,n){"use strict"
n.d(t,{e:()=>r})
var r,i=n(9043),o=n(32775),a=n(14294),s=n(37392),l=n(17782),c=n(81871),u=n(65081),d=n(70012),p=n(92384),h=n(31727),f=n(9726),m=n(64170),g=n(69858),y=n(40426),v=n(63356),b=n(87423),x=n(22394),S=n(71905),_=n(19231)
!function(e){function t(e,t,n,o,l,c,u){return u?function(e,t,n,r,o,a,s){return s.vertexCount=o,s.triangleCount=a,i.IQ.update(s.vertexBuffer,e),i.IQ.update(s.indexBuffer,t),i.IQ.update(s.normalBuffer,n),i.IQ.update(s.groupBuffer,r),s}(e,t,n,o,l,c,u):function(e,t,n,o,l,c){const u=(0,a.f8)()
let d,p=-1,f=-1
const m={kind:"mesh",vertexCount:l,triangleCount:c,vertexBuffer:i.IQ.create(e),indexBuffer:i.IQ.create(t),normalBuffer:i.IQ.create(n),groupBuffer:i.IQ.create(o),varyingGroup:i.IQ.create(!1),get boundingSphere(){const e=r(m)
if(e!==p){const t=(0,h.sL)(m.vertexBuffer.ref.value,m.vertexCount,1)
a.f8.copy(u,t),p=e}return u},get groupMapping(){return m.groupBuffer.ref.version!==f&&(d=(0,s.AA)(m.groupBuffer.ref.value,m.vertexCount),f=m.groupBuffer.ref.version),d},setBoundingSphere(e){a.f8.copy(u,e),p=r(m)},meta:{}}
return m}(e,t,n,o,l,c)}function n(e){return t(e?e.vertexBuffer.ref.value:new Float32Array(0),e?e.indexBuffer.ref.value:new Uint32Array(0),e?e.normalBuffer.ref.value:new Float32Array(0),e?e.groupBuffer.ref.value:new Float32Array(0),0,0,e)}function r(e){return(0,d.TI)([e.vertexCount,e.triangleCount,e.vertexBuffer.ref.version,e.indexBuffer.ref.version,e.normalBuffer.ref.version,e.groupBuffer.ref.version])}e.create=t,e.createEmpty=n,e.computeNormals=function(e){const{vertexCount:t,triangleCount:n}=e,r=e.vertexBuffer.ref.value,o=e.indexBuffer.ref.value,a=e.normalBuffer.ref.value.length>=3*t?e.normalBuffer.ref.value:new Float32Array(3*t)
a===e.normalBuffer.ref.value&&a.fill(0,0,3*t),(0,s.xL)(r,o,a,t,n),i.IQ.update(e.normalBuffer,a)},e.checkForDuplicateVertices=function(e,t=3){const n=e.vertexBuffer.ref.value,r=new Map,i=(e,t)=>`${e[0].toFixed(t)}|${e[1].toFixed(t)}|${e[2].toFixed(t)}`
let a=0
const s=(0,o.eB)()
for(let l=0,c=e.vertexCount;l<c;++l){o.eB.fromArray(s,n,3*l)
const e=i(s,t),c=r.get(e)
void 0!==c?(a+=1,r.set(e,c+1)):r.set(e,1)}return a}
const C=(0,o.U)()
function w(e){const{vertexCount:t,triangleCount:n}=e,r=e.indexBuffer.ref.value,i=[]
for(let o=0;o<t;++o)i[o]=[]
for(let o=0;o<n;++o){const e=r[3*o],t=r[3*o+1],n=r[3*o+2];(0,v.Z2)(i[e],t),(0,v.Z2)(i[e],n),(0,v.Z2)(i[t],e),(0,v.Z2)(i[t],n),(0,v.Z2)(i[n],e),(0,v.Z2)(i[n],t)}return i}function T(e){const{triangleCount:t}=e,n=e.indexBuffer.ref.value,r=new Map,i=(e,t)=>{const n=(0,d.bd)(e,t),i=r.get(n)||0
r.set(n,i+1)}
for(let o=0;o<t;++o){const e=n[3*o],t=n[3*o+1],r=n[3*o+2]
i(e,t),i(e,r),i(t,r)}return r}function A(e){const t=new Set,n=[0,0]
return e.forEach((e,r)=>{1===e&&((0,d.Ao)(n,r),t.add(n[0]),t.add(n[1]))}),t}function I(e,t,n){const r=new Map,i=(e,t)=>{r.has(e)?(0,v.Z2)(r.get(e),t):r.set(e,[t])}
return t.forEach(r=>{const o=e[r]
for(const e of o)t.has(e)&&1===n.get((0,d.bd)(r,e))&&i(r,e)}),r}function P(e,t,n,r){var a
const{vertexBuffer:s,indexBuffer:l,normalBuffer:c,triangleCount:u}=e,p=s.ref.value,h=l.ref.value,f=c.ref.value,m=d.Gm.create(Uint32Array,3,1024,u)
let g=0
for(let i=0;i<u;++i)d.Gm.add3(m,h[3*i],h[3*i+1],h[3*i+2]),g+=1
const y=(0,o.eB)(),v=(0,o.eB)(),x=(0,o.eB)(),S=(0,o.eB)(),_=(0,o.eB)(),C=(0,o.eB)(),w=(0,o.eB)(),T=(0,o.eB)(),A=(0,o.eB)(),I=(0,o.eB)(),P=(0,b.pu)(120),B=new Set,E=Array.from(n.keys()).filter(e=>n.get(e).length<2).map(e=>{const t=n.get(e)
return o.eB.fromArray(y,p,3*e),o.eB.fromArray(v,p,3*t[0]),o.eB.fromArray(x,p,3*t[1]),o.eB.sub(_,v,y),o.eB.sub(C,x,y),[e,o.eB.angle(_,C)]})
E.sort(([,e],[,t])=>e-t)
for(const[i,b]of E){if(B.has(i)||b>P)continue
const e=n.get(i)
if(t[e[0]].includes(e[1])&&!(null===(a=n.get(e[0]))||void 0===a?void 0:a.includes(e[1])))continue
if(o.eB.fromArray(y,p,3*i),o.eB.fromArray(v,p,3*e[0]),o.eB.fromArray(x,p,3*e[1]),o.eB.sub(_,v,y),o.eB.sub(C,x,y),o.eB.add(T,_,C),o.eB.squaredDistance(y,v)>=r)continue
let s=!1
for(const n of t[i])if(!e.includes(n)&&(o.eB.fromArray(S,p,3*n),o.eB.sub(w,S,y),o.eB.dot(T,w)<0)){s=!0
break}s&&(o.eB.fromArray(A,f,3*i),o.eB.triangleNormal(I,y,v,x),o.eB.dot(I,A)>0?d.Gm.add3(m,i,e[0],e[1]):d.Gm.add3(m,e[1],e[0],i),B.add(i),B.add(e[0]),B.add(e[1]),g+=1)}const k=d.Gm.compact(m)
return e.triangleCount=g,i.IQ.update(l,k),e}function B(e,t){const n=e.vertexCount,r=t.instanceCount.ref.value,i=(0,c.tu)(),a=i.position,s=i.normal,l=e.vertexBuffer.ref.value,u=e.normalBuffer.ref.value,d=t.aTransform.ref.value
return(0,c.iQ)(n,r,1,(e,t)=>(t<0?(o.eB.fromArray(a,l,3*e),o.eB.fromArray(s,u,3*e)):(o.eB.transformMat4Offset(a,l,d,0,3*e,16*t),o.eB.transformDirectionOffset(s,u,d,0,3*e,16*t)),i))}function E(e,t,n,r,s){const{instanceCount:c,groupCount:d}=n,p=B(e,t),v=(0,u.D1)(n,p,r.color),b=s.instanceGranularity?(0,l.Km)(c,"instance"):(0,l.Km)(c*d,"groupInstance"),C=(0,m.WG)(),w=(0,g.MD)(),T=(0,S.JS)(),A=(0,x.IB)(),I=(0,y.EN)(),P={drawCount:3*e.triangleCount,vertexCount:e.vertexCount,groupCount:d,instanceCount:c},E=a.f8.clone(e.boundingSphere),k=(0,h.Ax)(E,t.aTransform.ref.value,c,0)
return{dGeometryType:i.IQ.create("mesh"),aPosition:e.vertexBuffer,aNormal:e.normalBuffer,aGroup:e.groupBuffer,elements:e.indexBuffer,dVaryingGroup:e.varyingGroup,boundingSphere:i.IQ.create(k),invariantBoundingSphere:i.IQ.create(E),uInvariantBoundingSphere:i.IQ.create(o.Zb.ofSphere(E)),...v,...b,...C,...w,...T,...A,...I,...t,...f.iy.createValues(s,P),uDoubleSided:i.IQ.create(s.doubleSided),dFlatShaded:i.IQ.create(s.flatShaded),dFlipSided:i.IQ.create(s.flipSided),dIgnoreLight:i.IQ.create(s.ignoreLight),dCelShaded:i.IQ.create(s.celShaded),dXrayShaded:i.IQ.create("inverted"===s.xrayShaded?"inverted":!0===s.xrayShaded?"on":"off"),dTransparentBackfaces:i.IQ.create(s.transparentBackfaces),uBumpFrequency:i.IQ.create(s.bumpFrequency),uBumpAmplitude:i.IQ.create(s.bumpAmplitude),uInteriorColor:i.IQ.create((0,_.mT)(s.interior,(0,o.Zb)())),uInteriorSubstance:i.IQ.create((0,_.Zl)(s.interior,(0,o.Zb)())),meta:i.IQ.create(e.meta)}}function k(e,t){f.iy.updateRenderableState(e,t),e.opaque=e.opaque&&!t.xrayShaded,e.writeDepth=e.opaque}e.transform=function(e,t){const n=e.vertexBuffer.ref.value
if((0,s.pi)(t,n,0,e.vertexCount),!o.$I.isTranslationAndUniformScaling(t)){const n=o.U.directionTransform(C,t);(0,s.TL)(n,e.normalBuffer.ref.value,0,e.vertexCount)}i.IQ.update(e.vertexBuffer,n)},e.getOriginalData=function(e){const{originalData:t}="kind"in e?e.meta:e.meta.ref.value
return t},e.uniformTriangleGroup=function(e,t=!0){const{indexBuffer:n,vertexBuffer:r,groupBuffer:a,normalBuffer:s,triangleCount:l,vertexCount:c}=e,u=n.ref.value,p=r.ref.value,h=a.ref.value,f=s.ref.value,m=d.Gm.create(Uint32Array,3,1024,l),g=d.Gm.create(Float32Array,3,1024,p)
g.currentIndex=3*c,g.elementCount=c
const y=d.Gm.create(Float32Array,3,1024,f)
y.currentIndex=3*c,y.elementCount=c
const v=d.Gm.create(Float32Array,1,1024,h)
v.currentIndex=c,v.elementCount=c
const b=(0,o.eB)(),x=(0,o.eB)(),S=(0,o.eB)(),_=(0,o.eB)(),C=(0,o.eB)(),w=(0,o.eB)()
function T(e){o.eB.fromArray(b,p,3*e),o.eB.fromArray(_,f,3*e),d.Gm.add3(g,b[0],b[1],b[2]),d.Gm.add3(y,_[0],_[1],_[2])}function A(e,t){o.eB.fromArray(b,p,3*e),o.eB.fromArray(x,p,3*t),o.eB.scale(b,o.eB.add(b,b,x),.5),o.eB.fromArray(_,f,3*e),o.eB.fromArray(C,f,3*t),o.eB.scale(_,o.eB.add(_,_,C),.5),d.Gm.add3(g,b[0],b[1],b[2]),d.Gm.add3(y,_[0],_[1],_[2])}function I(e,t,n){o.eB.fromArray(b,p,3*e),o.eB.fromArray(x,p,3*t),o.eB.fromArray(S,p,3*n),o.eB.scale(b,o.eB.add(b,o.eB.add(b,b,x),S),1/3),o.eB.fromArray(_,f,3*e),o.eB.fromArray(C,f,3*t),o.eB.fromArray(w,f,3*n),o.eB.scale(_,o.eB.add(_,o.eB.add(_,_,C),w),1/3),d.Gm.add3(g,b[0],b[1],b[2]),d.Gm.add3(y,_[0],_[1],_[2])}function P(e,t,n,r,i){++E,T(e),A(e,t),A(e,n),d.Gm.add3(m,B,B+1,B+2)
for(let o=0;o<3;++o)d.Gm.add(v,r)
B+=3,E+=2,T(t),T(n),A(e,t),A(e,n),d.Gm.add3(m,B,B+1,B+3),d.Gm.add3(m,B,B+3,B+2)
for(let o=0;o<4;++o)d.Gm.add(v,i)
B+=4}let B=c,E=0
if(t)for(let i=0,o=l;i<o;++i){const e=u[3*i],t=u[3*i+1],n=u[3*i+2],r=h[e],o=h[t],a=h[n]
if(r===o&&r===a)++E,d.Gm.add3(m,e,t,n)
else if(r===o)P(n,e,t,a,r)
else if(r===a)P(t,n,e,o,a)
else if(o===a)P(e,t,n,r,o)
else{E+=2,T(e),A(e,t),A(e,n),I(e,t,n),d.Gm.add3(m,B,B+1,B+3),d.Gm.add3(m,B,B+3,B+2)
for(let e=0;e<4;++e)d.Gm.add(v,r)
B+=4,E+=2,T(t),A(t,n),A(t,e),I(e,t,n),d.Gm.add3(m,B,B+1,B+3),d.Gm.add3(m,B,B+3,B+2)
for(let e=0;e<4;++e)d.Gm.add(v,o)
B+=4,E+=2,T(n),A(n,t),A(n,e),I(e,t,n),d.Gm.add3(m,B+3,B+1,B),d.Gm.add3(m,B+2,B+3,B)
for(let e=0;e<4;++e)d.Gm.add(v,a)
B+=4}}else for(let i=0,o=l;i<o;++i){const e=u[3*i],t=u[3*i+1],n=u[3*i+2],r=h[e],o=h[t],a=h[n]
if(r!==o||r!==a){++E,T(e),T(t),T(n),d.Gm.add3(m,B,B+1,B+2)
const i=o===a?o:r
for(let e=0;e<3;++e)d.Gm.add(v,i)
B+=3}else++E,d.Gm.add3(m,e,t,n)}const k=d.Gm.compact(m),D=d.Gm.compact(g),M=d.Gm.compact(y),R=d.Gm.compact(v)
return e.vertexCount=B,e.triangleCount=E,i.IQ.update(r,D),i.IQ.update(a,R),i.IQ.update(n,k),i.IQ.update(s,M),e.meta.originalData={indexBuffer:u,vertexCount:c,triangleCount:l},e},e.smoothEdges=function(e,t){!function(e,t){const{indexBuffer:n,triangleCount:r}=e,o=n.ref.value,a=d.Gm.create(Uint32Array,3,1024,r)
let s=0
for(let i=0;i<r;++i){const e=o[3*i],n=o[3*i+1],r=o[3*i+2]
2!==t[e].length&&2!==t[n].length&&2!==t[r].length&&(d.Gm.add3(a,e,n,r),s+=1)}const l=d.Gm.compact(a)
e.triangleCount=s,i.IQ.update(n,l)}(e,w(e))
for(let r=0;r<10;++r){const n=e.triangleCount,r=T(e),i=w(e)
if(P(e,i,I(i,A(r),r),t.maxNewEdgeLength*t.maxNewEdgeLength),e.triangleCount===n)break}const n=T(e)
return function(e,t,n){const{iterations:r,lambda:a}=n,s=(0,o.eB)(),l=(0,o.eB)(),c=(0,o.eB)(),u=(0,o.eB)(),d=-a
let p=new Float32Array(e.vertexBuffer.ref.value.length)
const h=n=>{const r=e.vertexBuffer.ref.value
p.set(r),t.forEach((e,t)=>{if(2!==e.length)return
o.eB.fromArray(s,r,3*t),o.eB.fromArray(l,r,3*e[0]),o.eB.fromArray(c,r,3*e[1])
const i=1/o.eB.distance(s,l),a=1/o.eB.distance(s,c)
o.eB.scale(l,l,i),o.eB.scale(c,c,a),o.eB.add(u,l,c),o.eB.scale(u,u,1/(i+a)),o.eB.sub(u,u,s),o.eB.scale(u,u,n),o.eB.add(u,s,u),o.eB.toArray(u,p,3*t)})
const a=e.vertexBuffer.ref.value
i.IQ.update(e.vertexBuffer,p),p=a}
for(let i=0;i<r;++i)h(a),h(d)}(e,I(w(e),A(n),n),{iterations:t.iterations,lambda:.5}),e},e.Params={...f.iy.Params,doubleSided:p.t.Boolean(!1,f.iy.CustomQualityParamInfo),flipSided:p.t.Boolean(!1,f.iy.ShadingCategory),flatShaded:p.t.Boolean(!1,f.iy.ShadingCategory),ignoreLight:p.t.Boolean(!1,f.iy.ShadingCategory),celShaded:p.t.Boolean(!1,f.iy.ShadingCategory),xrayShaded:p.t.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],f.iy.ShadingCategory),transparentBackfaces:p.t.Select("off",p.t.arrayToOptions(["off","on","opaque"]),f.iy.ShadingCategory),bumpFrequency:p.t.Numeric(0,{min:0,max:10,step:.1},f.iy.ShadingCategory),bumpAmplitude:p.t.Numeric(1,{min:0,max:5,step:.1},f.iy.ShadingCategory),interior:(0,_.ag)()},e.Utils={Params:e.Params,createEmpty:n,createValues:E,createValuesSimple:function(t,n,r,i,o){const a=f.iy.createSimple(r,i,o),s={...p.t.getDefaultValues(e.Params),...n}
return E(t,a.transform,a.locationIterator,a.theme,s)},updateValues:function(e,t){f.iy.updateValues(e,t),i.IQ.updateIfChanged(e.uDoubleSided,t.doubleSided),i.IQ.updateIfChanged(e.dFlatShaded,t.flatShaded),i.IQ.updateIfChanged(e.dFlipSided,t.flipSided),i.IQ.updateIfChanged(e.dIgnoreLight,t.ignoreLight),i.IQ.updateIfChanged(e.dCelShaded,t.celShaded),i.IQ.updateIfChanged(e.dXrayShaded,"inverted"===t.xrayShaded?"inverted":!0===t.xrayShaded?"on":"off"),i.IQ.updateIfChanged(e.dTransparentBackfaces,t.transparentBackfaces),i.IQ.updateIfChanged(e.uBumpFrequency,t.bumpFrequency),i.IQ.updateIfChanged(e.uBumpAmplitude,t.bumpAmplitude),i.IQ.update(e.uInteriorColor,(0,_.mT)(t.interior,e.uInteriorColor.ref.value)),i.IQ.update(e.uInteriorSubstance,(0,_.Zl)(t.interior,e.uInteriorSubstance.ref.value))},updateBoundingSphere:function(e,t){const n=a.f8.clone(t.boundingSphere),r=(0,h.Ax)(n,e.aTransform.ref.value,e.instanceCount.ref.value,0)
a.f8.equals(r,e.boundingSphere.ref.value)||i.IQ.update(e.boundingSphere,r),a.f8.equals(n,e.invariantBoundingSphere.ref.value)||(i.IQ.update(e.invariantBoundingSphere,n),i.IQ.update(e.uInvariantBoundingSphere,o.Zb.fromSphere(e.uInvariantBoundingSphere.ref.value,n)))},createRenderableState:function(e){const t=f.iy.createRenderableState(e)
return k(t,e),t},updateRenderableState:k,createPositionIterator:B}}(r||(r={}))},10766(e,t,n){"use strict"
n.r(t),n.d(t,{default:()=>g})
var r=n(63445),i=n(90473),o=n(77853),a=n(92867),s=n(62663)
function l(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function u(e,t,n){return r=function(e){if("object"!=c(e)||!e)return e
var t=e[Symbol.toPrimitive]
if(void 0!==t){var n=t.call(e,"string")
if("object"!=c(n))return n
throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(t),(t="symbol"==c(r)?r:r+"")in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e
var r}function d(e,t,n,r,i){var o={}
return Object.keys(r).forEach(function(e){o[e]=r[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}var p,h,f,m=(0,n(11465).createTemplateFactory)({id:"fvS6E9Ck",block:'[[[18,8,[[28,[37,1],null,[["hook","setHook","loop","data"],[[30,0,["velcroHook"]],[30,0,["setHook"]],[52,[30,0,["hook"]],[50,[28,[37,4],[[30,0,["velcroLoop"]]],[["type","loc","original"],["modifier","(\'/home/monkeypunch/work/ember/kell/node_modules/ember-velcro/dist/components/velcro/index.js\' @ L4:C21) ","this.velcroLoop"]]],2,[[30,0,["hook"]]],[["flipOptions","hideOptions","middleware","offsetOptions","placement","shiftOptions","strategy","setVelcroData"],[[30,1],[30,2],[30,3],[30,4],[30,5],[30,6],[30,7],[30,0,["setVelcroData"]]]]]],[30,0,["velcroData"]]]]]]],[1,"\\n\\n"]],["@flipOptions","@hideOptions","@middleware","@offsetOptions","@placement","@shiftOptions","@strategy","&default"],["yield","hash","if","modifier","-disallow-dynamic-resolution"]]',moduleName:"/home/monkeypunch/work/ember/kell/node_modules/ember-velcro/dist/components/velcro/index.js",isStrictMode:!1})
let g=(p=class extends r.default{constructor(...e){super(...e),l(this,"hook",h,this),l(this,"velcroData",f,this),u(this,"setVelcroData",e=>this.velcroData=e),u(this,"setHook",e=>{this.hook=e}),u(this,"velcroHook",(0,o.modifier)(e=>{this.setHook(e)},{eager:!1})),u(this,"velcroLoop",a.default)}},h=d(p.prototype,"hook",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),f=d(p.prototype,"velcroData",[i.tracked],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),p);(0,s.setComponentTemplate)(m,g)},10773(e,t,n){"use strict"
n.d(t,{m:()=>r})
var r,i=n(88434),o=n(20321),a=n(52349)
!function(e){function t(e){return e[e.length-1]}function n(e){return e.length/2}function r(e,t){return e[2*t]}function s(e,t){return e[2*t+1]+1}function l(e,t){return e[2*t]}function c(e,t){return e[2*t+1]}function u(e,t){return d(e,t,0)}function d(e,r,a){if(l(e,a)>o.C.max(r)||t(e)<o.C.min(r))return-1
for(let t=a,s=n(e);t<s;++t){const n=i.I.ofRange(l(e,t),c(e,t))
if(o.C.areIntersecting(n,r))return t}return-1}e.ofSortedRanges=function(e){return a.X.ofSortedArray(e)},e.start=function(e){return e[0]},e.end=function(e){return e[e.length-1]+1},e.min=function(e){return e[0]},e.max=t,e.size=function(e){let t=0
for(let n=0,r=e.length;n<r;n+=2)t+=e[n+1]-e[n]+1
return t},e.count=n,e.startAt=r,e.endAt=s,e.minAt=l,e.maxAt=c,e.areEqual=function(e,t){if(e.length!==t.length)return!1
for(let n=0,r=e.length;n<r;++n)if(e[n]!==t[n])return!1
return!0},e.forEach=function(e,t){let n=0
for(let r=0,i=e.length;r<i;r+=2)for(let o=e[r],a=e[r+1];o<=a;++o)t(o,n),++n},e.has=function(e,t){return-1!==u(e,t)},e.hasFrom=function(e,t,n){return-1!==d(e,t,n)},e.firstIntersectionIndex=u,e.firstIntersectionIndexFrom=d,e.transientSegments=function(e,t){return new p(e,t)}
class p{updateValue(){this.value.index=this.curIndex,this.value.start=o.C.findPredecessorIndex(this.set,r(this.ranges,this.curIndex)),this.value.end=o.C.findPredecessorIndex(this.set,s(this.ranges,this.curIndex))}move(){return this.hasNext&&(this.updateValue(),this.curIndex=d(this.ranges,this.set,this.curIndex+1),this.hasNext=-1!==this.curIndex),this.value}constructor(e,t){this.ranges=e,this.set=t,this.value={index:0,start:0,end:0},this.curIndex=0,this.hasNext=!1,this.curIndex=u(e,t),this.hasNext=-1!==this.curIndex}}e.Iterator=p}(r||(r={}))},10828(e,t,n){"use strict"
function r([e=0,t=0]){const n=Math.abs(e),i=Math.abs(t)
return 0===n?i:0===i?n:r([i,n%i])}n.r(t),n.d(t,{default:()=>i,gcd:()=>r})
var i=(0,n(10336).helper)(r)},11064(e,t,n){"use strict"
n.d(t,{e:()=>o,m:()=>s})
var r=n(87095)
const i=new Map([["HIS|CD2|CG",2],["HIS|CE1|ND1",2],["ARG|CZ|NH2",2],["PHE|CE1|CZ",2],["PHE|CD2|CE2",2],["PHE|CD1|CG",2],["TRP|CD1|CG",2],["TRP|CD2|CE2",2],["TRP|CE3|CZ3",2],["TRP|CH2|CZ2",2],["ASN|CG|OD1",2],["GLN|CD|OE1",2],["TYR|CD1|CG",2],["TYR|CD2|CE2",2],["TYR|CE1|CZ",2],["ASP|CG|OD1",2],["GLU|CD|OE1",2],["G|C8|N7",2],["G|C4|C5",2],["G|C2|N3",2],["G|C6|O6",2],["C|C4|N3",2],["C|C5|C6",2],["C|C2|O2",2],["A|C2|N3",2],["A|C6|N1",2],["A|C4|C5",2],["A|C8|N7",2],["U|C5|C6",2],["U|C2|O2",2],["U|C4|O4",2],["DG|C8|N7",2],["DG|C4|C5",2],["DG|C2|N3",2],["DG|C6|O6",2],["DC|C4|N3",2],["DC|C5|C6",2],["DC|C2|O2",2],["DA|C2|N3",2],["DA|C6|N1",2],["DA|C4|C5",2],["DA|C8|N7",2],["DT|C5|C6",2],["DT|C2|O2",2],["DT|C4|O4",2]])
function o(e,t,n){return[t,n]=t<n?[t,n]:[n,t],r.AminoAcidNames.has(e)&&"C"===t&&"O"===n||r.BaseNames.has(e)&&"OP1"===t&&"P"===n?2:i.get(`${e}|${t}|${n}`)||1}const a=new Map([["LYS|NZ|RET|C15",2]])
function s(e,t,n,r){return e>n&&([e,n]=[n,e],[t,r]=[r,t]),a.get(`${e}|${t}|${n}|${r}`)||1}},11350(e,t,n){"use strict"
n.d(t,{dV:()=>h,G7:()=>a,yt:()=>x,RP:()=>o,Dr:()=>p,xY:()=>u,N0:()=>c,GW:()=>b})
var r=n(54749)
const i=new Set(["145","147","149","289","291","293","445","475","491","510","604","045","05L","07E","07Y","08U","09X","0AT","0BD","0H0","0HX","0LP","0MK","0NZ","0TS","0UB","0V4","0WK","0XY","0YT","10M","12E","14T","15L","16F","16G","16O","17T","18D","18O","18T","1AR","1BW","1CF","1FT","1GL","1GN","1JB","1LL","1NA","1S3","1S4","1SD","1X4","20S","20X","22O","22S","23V","24S","25E","26M","26O","26Q","26R","26V","26W","26Y","27C","2DG","2DR","2F8","2FG","2FL","2FP","2GL","2GS","2H5","2HA","2M4","2M5","2M8","2OS","2SI","2WP","2WS","32O","34V","38J","3BU","3CM","3DO","3DY","3FM","3GR","3HD","3J3","3J4","3LJ","3LR","3MF","3MG","3MK","3R3","3S6","3SA","3YW","40J","42D","44S","46D","46M","46Z","48Z","49A","49S","49T","49V","4AM","4CQ","4GC","4GL","4GP","4JA","4N2","4NN","4QY","4R1","4RS","4SG","4U0","4U1","4U2","4UZ","4V5","50A","51N","56N","57S","5DI","5GF","5GO","5II","5KQ","5KS","5KT","5KV","5L2","5L3","5LS","5LT","5MM","5N6","5QP","5RP","5SA","5SP","5TH","5TJ","5TK","5TM","61J","62I","64K","66O","6BG","6C2","6DM","6GB","6GP","6GR","6K3","6KH","6KL","6KS","6KU","6KW","6LA","6LS","6LW","6MJ","6MN","6PG","6PY","6PZ","6S2","6SA","6UD","6Y6","6YR","6ZC","73E","79J","7CV","7D1","7GP","7JZ","7K2","7K3","7NU","7SA","83Y","89Y","8B7","8B9","8EX","8GA","8GG","8GP","8I4","8LM","8LR","8OQ","8PK","8S0","8YV","95Z","96O","98U","9AM","9C1","9CD","9GP","9KJ","9MR","9OK","9PG","9QG","9QZ","9RN","9S7","9SG","9SJ","9SM","9SP","9T1","9T7","9VP","9WJ","9WN","9WZ","9YW","A0K","A1AIO","A1APB","A1APC","A1APD","A1CCV","A1CCW","A1EAX","A1EFW","A1EGT","A1EGV","A1EGW","A1EGX","A1EGY","A1EJ0","A1EJ2","A1EKO","A1EN6","A1H03","A1H0P","A1H0Z","A1H10","A1H1B","A1H1F","A1H1V","A1I9U","A1ID6","A1IH4","A1IVP","A1IZL","A1JAQ","A1L1P","A1Q","A2G","A5C","A6P","AAL","AAO","ABC","ABD","ABE","ABF","ABL","AC1","ACG","ACR","ACX","ADA","ADG","ADR","AF1","AFD","AFL","AFO","AFP","AFR","AGC","AGH","AGL","AGR","AH2","AH8","AHG","AHM","AHR","AIG","ALL","ALX","AMG","AMN","AMU","AMV","ANA","AOG","AOS","AQA","ARA","ARB","ARE","ARI","ARW","ASC","ASG","ASO","AXP","AXR","AY9","AZC","B0D","B16","B1H","B1N","B2G","B4G","B6D","B7G","B8D","B9D","BBK","BBV","BCD","BCW","BDF","BDG","BDP","BDR","BDZ","BEM","BFN","BFP","BG6","BG8","BGC","BGL","BGN","BGP","BGS","BHG","BM3","BM7","BMA","BMX","BND","BNG","BNX","BO1","BOG","BQY","BRI","BS7","BTG","BTU","BW3","BWG","BXF","BXP","BXX","BXY","BZD","C3B","C3G","C3X","C4B","C4W","C4X","C5X","CAP","CBF","CBI","CBK","CDR","CE5","CE6","CE8","CEG","CEX","CEY","CEZ","CGF","CJB","CKB","CKP","CNP","CR1","CR6","CRA","CT3","CTO","CTR","CTT","D0N","D1M","D5E","D6G","DAF","DAG","DAN","DDA","DDB","DDL","DEG","DEL","DFR","DFX","DG0","DGC","DGD","DGM","DGO","DGS","DGU","DIG","DJB","DJE","DK4","DKX","DKZ","DL6","DLD","DLF","DLG","DMU","DNO","DO8","DOM","DP5","DPC","DQQ","DQR","DR2","DR3","DR4","DR5","DRI","DSR","DT6","DVC","DYM","E3M","E4P","E5G","EAG","EBG","EBQ","ED6","EEN","EEQ","EGA","EJT","EMP","EMZ","EPG","EQP","EQV","ERE","ERI","ETT","EUS","F1P","F1X","F55","F58","F6P","F8X","FBP","FCA","FCB","FCT","FDP","FDQ","FFC","FFX","FIF","FIX","FK9","FKD","FMF","FMO","FNG","FNY","FRU","FSA","FSI","FSM","FSR","FSW","FU4","FUB","FUC","FUD","FUF","FUL","FUY","FVQ","FX1","FYJ","G0S","G16","G1P","G20","G28","G2F","G3F","G3I","G4D","G4S","G6D","G6P","G6S","G7P","G8Z","GAA","GAC","GAD","GAF","GAL","GAT","GBH","GC1","GC4","GC9","GCB","GCD","GCN","GCO","GCS","GCT","GCU","GCV","GCW","GDA","GDL","GE1","GE3","GFP","GIV","GL0","GL1","GL2","GL4","GL5","GL6","GL7","GL9","GLA","GLB","GLC","GLD","GLF","GLG","GLO","GLP","GLS","GLT","GLW","GM0","GMB","GMH","GMT","GMZ","GN1","GN4","GNS","GNX","GP0","GP1","GP4","GPH","GPK","GPM","GPO","GPQ","GPU","GPV","GPW","GQ1","GRF","GRX","GS1","GS4","GS9","GSA","GSD","GTE","GTH","GTK","GTM","GTR","GU0","GU1","GU2","GU3","GU4","GU5","GU6","GU8","GU9","GUF","GUL","GUP","GUZ","GXL","GXV","GYE","GYG","GYP","GYU","GYV","GZL","H1M","H1S","H2P","H3S","H53","H6Q","H6Z","HBZ","HD4","HDL","HLA","HMS","HNV","HNW","HSG","HSH","HSJ","HSQ","HSR","HSU","HSX","HSY","HSZ","HTG","HTM","HVC","I57","IAB","IDC","IDF","IDG","IDR","IDS","IDT","IDU","IDX","IDY","IEM","IN1","IPT","ISD","ISL","ISX","IVG","IXD","J5B","JFZ","JHM","JLT","JRV","JS2","JSV","JV4","JVA","JVS","JZR","K5B","K99","KBA","KBG","KD5","KDA","KDB","KDD","KDE","KDF","KDM","KDN","KDO","KDR","KFN","KG1","KGM","KHP","KME","KO1","KO2","KOT","KQC","KTU","L1L","L6N","L6S","L6T","LAG","LAH","LAI","LAK","LAO","LAT","LB2","LBS","LBT","LCN","LDY","LEC","LER","LFC","LFR","LGC","LGU","LKA","LKS","LM2","LMO","LMT","LMU","LNV","LOG","LOX","LPK","LRH","LSM","LTG","LTM","LVO","LVZ","LXB","LXC","LXZ","LZ0","M1F","M1P","M2F","M3M","M3N","M55","M6D","M6P","M7B","M7P","M8C","MA1","MA2","MA3","MA8","MAB","MAF","MAG","MAL","MAN","MAT","MAV","MAW","MBE","MBF","MBG","MCU","MDA","MDP","MFA","MFB","MFU","MG5","MGA","MGC","MGL","MGS","MJJ","MLB","MLR","MMA","MMN","MN0","MNA","MQG","MQT","MRH","MRP","MSX","MTT","MUB","MUG","MUR","MVP","MXY","MXZ","MYG","N1L","N3U","N9S","NA1","NAA","NAG","NBG","NBX","NBY","NDG","NED","NFG","NG1","NG6","NGA","NGB","NGC","NGE","NGF","NGK","NGL","NGR","NGS","NGY","NGZ","NHF","NLC","NM6","NM9","NNG","NOJ","NPF","NSQ","NT1","NTF","NTO","NTP","NXD","NYT","O1G","OAK","OEL","OI7","OPM","ORP","OSU","OTG","OTN","OTU","OX2","P53","P6P","P8E","PA1","PA5","PAV","PDX","PH5","PKM","PNA","PNG","PNJ","PNW","PPC","PRP","PSG","PSJ","PSV","PTQ","PUF","PZU","QDK","QIF","QKH","QPS","QV4","R1P","R1X","R2B","R2G","R5P","RAA","RAE","RAF","RAM","RAO","RAT","RB5","RBL","RCD","RDP","REL","RER","RF5","RG1","RGG","RHA","RHC","RI2","RIB","RIP","RM4","RNS","RNT","ROB","ROR","RP3","RP5","RP6","RPA","RR7","RRJ","RRY","RST","RTG","RTV","RUB","RUG","RUU","RV7","RVG","RVM","RWI","RY7","RZM","S6P","S7P","S81","SA0","SCG","SCR","SDD","SDY","SEJ","SF6","SF9","SFJ","SFU","SG4","SG5","SG6","SG7","SGA","SGC","SGD","SGN","SGS","SHB","SHD","SHG","SI3","SIA","SID","SIO","SIZ","SLB","SLM","SLT","SMD","SN5","SNG","SOE","SOG","SOL","SOR","SR1","SSG","SSH","STW","STZ","SUC","SUP","SUS","SWE","SZZ","T68","T6D","T6P","T6T","TA6","TAG","TCB","TCG","TDG","TEU","TF0","TFU","TGA","TGK","TGR","TGY","TH1","TM5","TM6","TM9","TMR","TMX","TNX","TOA","TOC","TQY","TRE","TRV","TS8","TT7","TTV","TTZ","TU4","TUG","TUJ","TUP","TUR","TVD","TVG","TVM","TVS","TVV","TVY","TW7","TWA","TWD","TWG","TWJ","TWY","TXB","TY6","TYV","U1Y","U2A","U2D","U63","U8V","U97","U9A","U9D","U9G","U9J","U9M","UAP","UBH","UBO","UCD","UDC","UEA","V3M","V3P","V71","VDF","VG1","VJ1","VJ4","VKN","VTB","W9T","WIA","WKO","WKT","WOO","WT8","WUN","WZ1","WZ2","WZ4","X0X","X1P","X1X","X2F","X2Y","X34","X4S","X5S","X6N","X6X","X6Y","X6Z","XBP","XDP","XDX","XGP","XIL","XIQ","XKJ","XLF","XLS","XMM","XS2","XUL","XXM","XXR","XXX","XY6","XY9","XYB","XYF","XYL","XYP","XYS","XYT","XYZ","YDR","YIO","YJM","YKR","YO5","YX0","YX1","YYB","YYD","YYH","YYJ","YYK","YYM","YYQ","YYR","YZ0","YZT","Z0F","Z15","Z16","Z2D","Z2T","Z3K","Z3L","Z3Q","Z3U","Z4K","Z4R","Z4S","Z4U","Z4V","Z4W","Z4Y","Z57","Z5J","Z5L","Z61","Z6G","Z6H","Z6J","Z6W","Z8H","Z8T","Z9D","Z9E","Z9H","Z9K","Z9L","Z9M","Z9N","Z9W","ZB0","ZB1","ZB2","ZB3","ZCD","ZCZ","ZD0","ZDC","ZDM","ZDO","ZEE","ZEL","ZGE","ZMR","UMQ","SQD"])
var o
!function(e){e[e.FilledSphere=0]="FilledSphere",e[e.FilledCube=1]="FilledCube",e[e.CrossedCube=2]="CrossedCube",e[e.DividedDiamond=3]="DividedDiamond",e[e.FilledCone=4]="FilledCone",e[e.DevidedCone=5]="DevidedCone",e[e.FlatBox=6]="FlatBox",e[e.FilledStar=7]="FilledStar",e[e.FilledDiamond=8]="FilledDiamond",e[e.FlatDiamond=9]="FlatDiamond",e[e.FlatHexagon=10]="FlatHexagon",e[e.Pentagon=11]="Pentagon",e[e.DiamondPrism=12]="DiamondPrism",e[e.PentagonalPrism=13]="PentagonalPrism",e[e.HexagonalPrism=14]="HexagonalPrism",e[e.HeptagonalPrism=15]="HeptagonalPrism"}(o||(o={}))
const a=(0,r.ColorMap)({Blue:37052,Green:42577,Yellow:16765952,Orange:16021792,Pink:16162465,Purple:10830745,LightBlue:9424105,Brown:10582605,Red:15539236,Secondary:15854817})
var s
!function(e){e[e.Hexose=0]="Hexose",e[e.HexNAc=1]="HexNAc",e[e.Hexosamine=2]="Hexosamine",e[e.Hexuronate=3]="Hexuronate",e[e.Deoxyhexose=4]="Deoxyhexose",e[e.DeoxyhexNAc=5]="DeoxyhexNAc",e[e.DiDeoxyhexose=6]="DiDeoxyhexose",e[e.Pentose=7]="Pentose",e[e.Deoxynonulosonate=8]="Deoxynonulosonate",e[e.DiDeoxynonulosonate=9]="DiDeoxynonulosonate",e[e.Unknown=10]="Unknown",e[e.Assigned=11]="Assigned"}(s||(s={})),s.Hexose,s.HexNAc,s.Hexosamine,s.Hexuronate,s.Deoxyhexose,s.DeoxyhexNAc,s.DiDeoxyhexose,s.Pentose,s.Deoxynonulosonate,s.DiDeoxynonulosonate,s.Unknown,s.Assigned
const l={[s.Hexose]:o.FilledSphere,[s.HexNAc]:o.FilledCube,[s.Hexosamine]:o.CrossedCube,[s.Hexuronate]:o.DividedDiamond,[s.Deoxyhexose]:o.FilledCone,[s.DeoxyhexNAc]:o.DevidedCone,[s.DiDeoxyhexose]:o.FlatBox,[s.Pentose]:o.FilledStar,[s.Deoxynonulosonate]:o.FilledDiamond,[s.DiDeoxynonulosonate]:o.FlatDiamond,[s.Unknown]:o.FlatHexagon,[s.Assigned]:o.Pentagon}
function c(e,t){return e===s.Unknown?4===t?o.DiamondPrism:5===t?o.PentagonalPrism:6===t?o.HexagonalPrism:7===t?o.HeptagonalPrism:o.FlatHexagon:l[e]}const u={abbr:"Unk",name:"Unknown",color:a.Secondary,type:s.Unknown},d=[{abbr:"Glc",name:"Glucose",color:a.Blue,type:s.Hexose},{abbr:"Man",name:"Mannose",color:a.Green,type:s.Hexose},{abbr:"Gal",name:"Galactose",color:a.Yellow,type:s.Hexose},{abbr:"Gul",name:"Gulose",color:a.Orange,type:s.Hexose},{abbr:"Alt",name:"Altrose",color:a.Pink,type:s.Hexose},{abbr:"All",name:"Allose",color:a.Purple,type:s.Hexose},{abbr:"Tal",name:"Talose",color:a.LightBlue,type:s.Hexose},{abbr:"Ido",name:"Idose",color:a.Brown,type:s.Hexose},{abbr:"GlcNAc",name:"N-Acetyl Glucosamine",color:a.Blue,type:s.HexNAc},{abbr:"ManNAc",name:"N-Acetyl Mannosamine",color:a.Green,type:s.HexNAc},{abbr:"GalNAc",name:"N-Acetyl Galactosamine",color:a.Yellow,type:s.HexNAc},{abbr:"GulNAc",name:"N-Acetyl Gulosamine",color:a.Orange,type:s.HexNAc},{abbr:"AltNAc",name:"N-Acetyl Altrosamine",color:a.Pink,type:s.HexNAc},{abbr:"AllNAc",name:"N-Acetyl Allosamine",color:a.Purple,type:s.HexNAc},{abbr:"TalNAc",name:"N-Acetyl Talosamine",color:a.LightBlue,type:s.HexNAc},{abbr:"IdoNAc",name:"N-Acetyl Idosamine",color:a.Brown,type:s.HexNAc},{abbr:"GlcN",name:"Glucosamine",color:a.Blue,type:s.Hexosamine},{abbr:"ManN",name:"Mannosamine",color:a.Green,type:s.Hexosamine},{abbr:"GalN",name:"Galactosamine",color:a.Yellow,type:s.Hexosamine},{abbr:"GulN",name:"Gulosamine",color:a.Orange,type:s.Hexosamine},{abbr:"AltN",name:"Altrosamine",color:a.Pink,type:s.Hexosamine},{abbr:"AllN",name:"Allosamine",color:a.Purple,type:s.Hexosamine},{abbr:"TalN",name:"Talosamine",color:a.LightBlue,type:s.Hexosamine},{abbr:"IdoN",name:"Idosamine",color:a.Brown,type:s.Hexosamine},{abbr:"GlcNS",name:"N-sulfo Glucosamine",color:a.Blue,type:s.Hexosamine},{abbr:"GlcA",name:"Glucuronic Acid",color:a.Blue,type:s.Hexuronate},{abbr:"ManA",name:"Mannuronic Acid",color:a.Green,type:s.Hexuronate},{abbr:"GalA",name:"Galacturonic Acid",color:a.Yellow,type:s.Hexuronate},{abbr:"GulA",name:"Guluronic Acid",color:a.Orange,type:s.Hexuronate},{abbr:"AltA",name:"Altruronic Acid",color:a.Pink,type:s.Hexuronate},{abbr:"AllA",name:"Alluronic Acid",color:a.Purple,type:s.Hexuronate},{abbr:"TalA",name:"Taluronic Acid",color:a.LightBlue,type:s.Hexuronate},{abbr:"IdoA",name:"Iduronic Acid",color:a.Brown,type:s.Hexuronate},{abbr:"Qui",name:"Quinovose",color:a.Blue,type:s.Deoxyhexose},{abbr:"Rha",name:"Rhamnose",color:a.Green,type:s.Deoxyhexose},{abbr:"6dGul",name:"6-Deoxy Gulose",color:a.Orange,type:s.Deoxyhexose},{abbr:"6dAlt",name:"6-Deoxy Altrose",color:a.Pink,type:s.Deoxyhexose},{abbr:"6dTal",name:"6-Deoxy Talose",color:a.LightBlue,type:s.Deoxyhexose},{abbr:"Fuc",name:"Fucose",color:a.Red,type:s.Deoxyhexose},{abbr:"QuiNAc",name:"N-Acetyl Quinovosamine",color:a.Blue,type:s.DeoxyhexNAc},{abbr:"RhaNAc",name:"N-Acetyl Rhamnosamine",color:a.Green,type:s.DeoxyhexNAc},{abbr:"6dAltNAc",name:"N-Acetyl 6-Deoxy Altrosamine",color:a.Pink,type:s.DeoxyhexNAc},{abbr:"6dTalNAc",name:"N-Acetyl 6-Deoxy Talosamine",color:a.LightBlue,type:s.DeoxyhexNAc},{abbr:"FucNAc",name:"N-Acetyl Fucosamine",color:a.Red,type:s.DeoxyhexNAc},{abbr:"AAT",name:"AAT",color:a.Red,type:s.DeoxyhexNAc},{abbr:"Oli",name:"Olivose",color:a.Blue,type:s.DiDeoxyhexose},{abbr:"Tyv",name:"Tyvelose",color:a.Green,type:s.DiDeoxyhexose},{abbr:"Abe",name:"Abequose",color:a.Orange,type:s.DiDeoxyhexose},{abbr:"Par",name:"Paratose",color:a.Pink,type:s.DiDeoxyhexose},{abbr:"Dig",name:"Digitoxose",color:a.Purple,type:s.DiDeoxyhexose},{abbr:"Col",name:"Colitose",color:a.LightBlue,type:s.DiDeoxyhexose},{abbr:"Ara",name:"Arabinose",color:a.Green,type:s.Pentose},{abbr:"Lyx",name:"Lyxose",color:a.Yellow,type:s.Pentose},{abbr:"Xyl",name:"Xylose",color:a.Orange,type:s.Pentose},{abbr:"Rib",name:"Ribose",color:a.Pink,type:s.Pentose},{abbr:"Kdn",name:"Keto-Deoxy Nonulonic Acid",color:a.Green,type:s.Deoxynonulosonate},{abbr:"Neu5Ac",name:"N-Acetyl Neuraminic Acid",color:a.Purple,type:s.Deoxynonulosonate},{abbr:"Neu5Gc",name:"N-Glycolyl Neuraminic Acid",color:a.LightBlue,type:s.Deoxynonulosonate},{abbr:"Neu",name:"Neuraminic Acid",color:a.Brown,type:s.Deoxynonulosonate},{abbr:"Sia",name:"Sialic acid",color:a.Red,type:s.Deoxynonulosonate},{abbr:"Pse",name:"Pseudaminic Acid",color:a.Green,type:s.DiDeoxynonulosonate},{abbr:"Leg",name:"Legionaminic Acid",color:a.Yellow,type:s.DiDeoxynonulosonate},{abbr:"Aci",name:"Acinetaminic Acid",color:a.Pink,type:s.DiDeoxynonulosonate},{abbr:"4eLeg",name:"4-Epilegionaminic Acid",color:a.LightBlue,type:s.DiDeoxynonulosonate},{abbr:"Bac",name:"Bacillosamine",color:a.Blue,type:s.Unknown},{abbr:"LDmanHep",name:"L-Glycero-D-Manno Heptose",color:a.Green,type:s.Unknown},{abbr:"Kdo",name:"Keto-Deoxy Octulonic Acid",color:a.Yellow,type:s.Unknown},{abbr:"Dha",name:"3-Deoxy Lyxo-Heptulosaric Acid",color:a.Orange,type:s.Unknown},{abbr:"DDmanHep",name:"D-Glycero-D-Manno-Heptose",color:a.Pink,type:s.Unknown},{abbr:"MurNAc",name:"N-Acetyl Muramic Acid",color:a.Purple,type:s.Unknown},{abbr:"MurNGc",name:"N-Glycolyl Muramic Acid",color:a.LightBlue,type:s.Unknown},{abbr:"Mur",name:"Muramic Acid",color:a.Brown,type:s.Unknown},{abbr:"K3O",name:"D-glycero-a-D-talo-oct-2-Ulosonic Acid",color:a.Red,type:s.Unknown},{abbr:"dUA",name:"4-deoxy-4,5-didehydro iduronic acid",color:a.Secondary,type:s.Unknown},{abbr:"Api",name:"Apicose",color:a.Green,type:s.Assigned},{abbr:"Fru",name:"Fructose",color:a.Green,type:s.Assigned},{abbr:"Tag",name:"Tagatose",color:a.Yellow,type:s.Assigned},{abbr:"Sor",name:"Sorbose",color:a.Orange,type:s.Assigned},{abbr:"Psi",name:"Psicose",color:a.Pink,type:s.Assigned}],p=function(){const e=new Map
for(let t=0,n=d.length;t<n;++t){const n=d[t]
e.set(n.abbr,n)}return e}(),h=[["Glc-family",a.Blue],["Man-family",a.Green],["Gal-family",a.Yellow],["Gul-family",a.Orange],["Alt-family",a.Pink],["All-family",a.Purple],["Tal-family",a.LightBlue],["Ido-family",a.Brown],["Fuc-family",a.Red],["Generic/Unknown/Secondary",a.Secondary]],f={Glc:["GLC","BGC","Z8T","TRE","MLR"],Man:["MAN","BMA"],Gal:["GLA","GAL","GZL","GXL","GIV"],Gul:["4GL","GL0","GUP","Z8H"],Alt:["Z6H","3MK","SHD"],All:["AFD","ALL","WOO","Z2D"],Tal:["ZEE","A5C","SDY"],Ido:["ZCD","Z0F","4N2"],GlcNAc:["NDG","NAG","NGZ"],ManNAc:["BM3","BM7"],GalNAc:["A2G","NGA","YYQ"],GulNAc:["LXB"],AltNAc:[],AllNAc:["NAA"],TalNAc:[],IdoNAc:["LXZ","HSQ"],GlcN:["PA1","GCS"],ManN:["95Z"],GalN:["X6X","1GN"],GulN:[],AltN:[],AllN:[],TalN:[],IdoN:[],GlcA:["GCU","BDP"],ManA:["MAV","BEM"],GalA:["ADA","GTR","GTK"],GulA:["LGU"],AltA:[],AllA:[],TalA:["X1X","X0X"],IdoA:["IDR"],Qui:["G6D","YYK"],Rha:["RAM","RM4","XXR"],"6dGul":["66O"],"6dAlt":[],"6dTal":[],Fuc:["FUC","FUL","FCA","FCB","GYE"],QuiNAc:["Z9W"],RhaNAc:[],"6dAltNAc":[],"6dTalNAc":[],FucNAc:["49T"],Oli:["DDA","RAE","Z5J"],Tyv:["TYV"],Abe:["ABE"],Par:["PZU"],Dig:["Z3U"],Col:[],Ara:["64K","ARA","ARB","AHR","FUB","BXY","BXX","SEJ"],Lyx:["LDY","Z4W"],Xyl:["XYS","XYP","XYZ","HSY","LXC"],Rib:["YYM","RIP","RIB","BDR","0MK","Z6J","32O"],Kdn:["KDM","KDN"],Neu5Ac:["SIA","SLB"],Neu5Gc:["NGC","NGE"],Neu:[],Sia:[],Pse:[],Leg:[],Aci:[],"4eLeg":[],Bac:[],LDmanHep:["GMH"],Kdo:["KDO"],Dha:[],DDmanHep:["289"],MurNAc:["MUB","AMU"],MurNGc:[],Mur:["1S4","MUR"],Api:["XXM"],Fru:["BDF","Z9N","FRU","LFR"],Tag:["T6T"],Sor:["SOE","UEA"],Psi:["PSV","SF6","SF9","TTV"]},m={Glc:["AGLC","BGLC"],GlcNAc:["AGLCNA","BGLCNA","BGLCN0"],GlcA:["AGLCA","BGLCA","BGLCA0"],Man:["AMAN","BMAN"],Rha:["ARHM","BRHM"],Ara:["AARB","BARB"],Gal:["AGAL","BGAL"],GalNAc:["AGALNA","BGALNA"],Gul:["AGUL","BGUL"],Alt:["AALT","BALT"],All:["AALL","BALL"],Tal:["ATAL","BTAL"],Ido:["AIDO","BIDO"],IdoA:["AIDOA","BIDOA"],Fuc:["AFUC","BFUC"],Lyx:["ALYF","BLYF"],Xyl:["AXYL","BXYL","AXYF","BXYF"],Rib:["ARIB","BRIB"],Fru:["AFRU","BFRU"],Neu5Ac:["ANE5AC","BNE5AC"]},g={Glc:["0GA","0GB","1GA","1GB","2GA","2GB","3GA","3GB","4GA","4GB","6GA","6GB","ZGA","ZGB","YGA","YGB","XGA","XGB","WGA","WGB","VGA","VGB","UGA","UGB","TGA","TGB","SGA","SGB","RGA","RGB","QGA","QGB","PGA","PGB","0gA","0gB","1gA","1gB","2gA","2gB","3gA","3gB","4gA","4gB","6gA","6gB","ZgA","ZgB","YgA","YgB","XgA","XgB","WgA","WgB","VgA","VgB","UgA","UgB","TgA","TgB","SgA","SgB","RgA","RgB","QgA","QgB","PgA","PgB"],GlcNAc:["0YA","0YB","1YA","1YB","3YA","3YB","4YA","4YB","6YA","6YB","WYA","WYB","VYA","VYB","UYA","UYB","QYA","QYB","0yA","0yB","1yA","1yB","3yA","3yB","4yA","4yB","6yA","6yB","WyA","WyB","VyA","VyB","UyA","UyB","QyA","QyB","0YS","0Ys","3YS","3Ys","4YS","4Ys","6YS","6Ys","QYS","QYs","UYS","UYs","VYS","VYs","WYS","WYs","0yS","0ys","3yS","3ys","4yS","4ys"],GlcA:["0ZA","0ZB","1ZA","1ZB","2ZA","2ZB","3ZA","3ZB","4ZA","4ZB","ZZA","ZZB","YZA","YZB","WZA","WZB","TZA","TZB","0zA","0zB","1zA","1zB","2zA","2zB","3zA","3zB","4zA","4zB","ZzA","ZzB","YzA","YzB","WzA","WzB","TzA","TzB","TZBP","WZBP","YZBP","4ZBP","ZZBP","3ZBP","2ZBP","1ZBP","0ZBP","0ZF","1ZF","4ZF","0Zf","1Zf","4Zf"],GlcN:["0YN","3YN","4YN","6YN","WYN","VYN","UYN","QYN","3Yn","4Yn","WYn","0Yn","0YP","3YP","4YP","6YP","WYP","VYP","UYP","QYP","0Yp","3Yp","4Yp","WYp","QYN","WYN","VYN","3YN","UYN","4YN","6YN","1YN","0YN","QYn","VYn","WYn","3Yn","UYn","6Yn","4Yn","1Yn","0Yn","QYNP","WYNP","VYNP","3YNP","UYNP","4YNP","6YNP","1YNP","0YNP","QYnP","UYnP","VYnP","6YnP","WYnP","4YnP","3YnP","1YnP","0YnP"],Man:["0MA","0MB","1MA","1MB","2MA","2MB","3MA","3MB","4MA","4MB","6MA","6MB","ZMA","ZMB","YMA","YMB","XMA","XMB","WMA","WMB","VMA","VMB","UMA","UMB","TMA","TMB","SMA","SMB","RMA","RMB","QMA","QMB","PMA","PMB","0mA","0mB","1mA","1mB","2mA","2mB","3mA","3mB","4mA","4mB","6mA","6mB","ZmA","ZmB","YmA","YmB","XmA","XmB","WmA","WmB","VmA","VmB","UmA","UmB","TmA","TmB","SmA","SmB","RmA","RmB","QmA","QmB","PmA","PmB"],ManNAc:["0WA","0WB","1WA","1WB","3WA","3WB","4WA","4WB","6WA","6WB","WWA","WWB","VWA","VWB","UWA","UWB","QWA","QWB","0wA","0wB","1wA","1wB","3wA","3wB","4wA","4wB","6wA","6wB","WwA","WwB","VwA","VwB","UwA","UwB","QwA","QwB"],Ara:["0AA","0AB","1AA","1AB","2AA","2AB","3AA","3AB","4AA","4AB","ZAA","ZAB","YAA","YAB","WAA","WAB","TAA","TAB","0AD","0AU","1AD","1AU","2AD","2AU","3AD","3AU","5AD","5AU","ZAD","ZAU","0aA","0aB","1aA","1aB","2aA","2aB","3aA","3aB","4aA","4aB","ZaA","ZaB","YaA","YaB","WaA","WaB","TaA","TaB","0aD","0aU","1aD","1aU","2aD","2aU","3aD","3aU","5aD","5aU","ZaD","ZaU"],Gal:["0LA","0LB","1LA","1LB","2LA","2LB","3LA","3LB","4LA","4LB","6LA","6LB","ZLA","ZLB","YLA","YLB","XLA","XLB","WLA","WLB","VLA","VLB","ULA","ULB","TLA","TLB","SLA","SLB","RLA","RLB","QLA","QLB","PLA","PLB","0lA","0lB","1lA","1lB","2lA","2lB","3lA","3lB","4lA","4lB","6lA","6lB","ZlA","ZlB","YlA","YlB","XlA","XlB","WlA","WlB","VlA","VlB","UlA","UlB","TlA","TlB","SlA","SlB","RlA","RlB","QlA","QlB","PlA","PlB"],GalNAc:["0VA","0VB","1VA","1VB","3VA","3VB","4VA","4VB","6VA","6VB","WVA","WVB","VVA","VVB","UVA","UVB","QVA","QVB","0vA","0vB","1vA","1vB","3vA","3vB","4vA","4vB","6vA","6vB","WvA","WvB","VvA","VvB","UvA","UvB","QvA","QvB"],GalA:["0OA","0OB","1OA","1OB","2OA","2OB","3OA","3OB","4OA","4OB","ZOA","ZOB","YOA","YOB","WOA","WOB","TOA","TOB","0oA","0oB","1oA","1oB","2oA","2oB","3oA","3oB","4oA","4oB","ZoA","ZoB","YoA","YoB","WoA","WoB","ToA","ToB"],Gul:["0KA","0KB","1KA","1KB","2KA","2KB","3KA","3KB","4KA","4KB","6KA","6KB","ZKA","ZKB","YKA","YKB","XKA","XKB","WKA","WKB","VKA","VKB","UKA","UKB","TKA","TKB","SKA","SKB","RKA","RKB","QKA","QKB","PKA","PKB","0kA","0kB","1kA","1kB","2kA","2kB","3kA","3kB","4kA","4kB","6kA","6kB","ZkA","ZkB","YkA","YkB","XkA","XkB","WkA","WkB","VkA","VkB","UkA","UkB","TkA","TkB","SkA","SkB","RkA","RkB","QkA","QkB","PkA","PkB"],Alt:["0EA","0EB","1EA","1EB","2EA","2EB","3EA","3EB","4EA","4EB","6EA","6EB","ZEA","ZEB","YEA","YEB","XEA","XEB","WEA","WEB","VEA","VEB","UEA","UEB","TEA","TEB","SEA","SEB","REA","REB","QEA","QEB","PEA","PEB","0eA","0eB","1eA","1eB","2eA","2eB","3eA","3eB","4eA","4eB","6eA","6eB","ZeA","ZeB","YeA","YeB","XeA","XeB","WeA","WeB","VeA","VeB","UeA","UeB","TeA","TeB","SeA","SeB","ReA","ReB","QeA","QeB","PeA","PeB"],All:["0NA","0NB","1NA","1NB","2NA","2NB","3NA","3NB","4NA","4NB","6NA","6NB","ZNA","ZNB","YNA","YNB","XNA","XNB","WNA","WNB","VNA","VNB","UNA","UNB","TNA","TNB","SNA","SNB","RNA","RNB","QNA","QNB","PNA","PNB","0nA","0nB","1nA","1nB","2nA","2nB","3nA","3nB","4nA","4nB","6nA","6nB","ZnA","ZnB","YnA","YnB","XnA","XnB","WnA","WnB","VnA","VnB","UnA","UnB","TnA","TnB","SnA","SnB","RnA","RnB","QnA","QnB","PnA","PnB"],Tal:["0TA","0TB","1TA","1TB","2TA","2TB","3TA","3TB","4TA","4TB","6TA","6TB","ZTA","ZTB","YTA","YTB","XTA","XTB","WTA","WTB","VTA","VTB","UTA","UTB","TTA","TTB","STA","STB","RTA","RTB","QTA","QTB","PTA","PTB","0tA","0tB","1tA","1tB","2tA","2tB","3tA","3tB","4tA","4tB","6tA","6tB","ZtA","ZtB","YtA","YtB","XtA","XtB","WtA","WtB","VtA","VtB","UtA","UtB","TtA","TtB","StA","StB","RtA","RtB","QtA","QtB","PtA","PtB"],Ido:["0IA","0IB","1IA","1IB","2IA","2IB","3IA","3IB","4IA","4IB","6IA","6IB","ZIA","ZIB","YIA","YIB","XIA","XIB","WIA","WIB","VIA","VIB","UIA","UIB","TIA","TIB","SIA","SIB","RIA","RIB","QIA","QIB","PIA","PIB","0iA","0iB","1iA","1iB","2iA","2iB","3iA","3iB","4iA","4iB","6iA","6iB","ZiA","ZiB","YiA","YiB","XiA","XiB","WiA","WiB","ViA","ViB","UiA","UiB","TiA","TiB","SiA","SiB","RiA","RiB","QiA","QiB","PiA","PiB"],IdoA:["0UA","0UB","1UA","1UB","2UA","2UB","3UA","3UB","4UA","4UB","ZUA","ZUB","YUA","YUB","WUA","WUB","TUA","TUB","0uA","0uB","1uA","1uB","2uA","2uB","3uA","3uB","4uA","4uB","ZuA","ZuB","YuA","YuB","WuA","WuB","TuA","TuB","YuAP"],Fuc:["0FA","0FB","1FA","1FB","2FA","2FB","3FA","3FB","4FA","4FB","ZFA","ZFB","YFA","YFB","WFA","WFB","TFA","TFB","0fA","0fB","1fA","1fB","2fA","2fB","3fA","3fB","4fA","4fB","ZfA","ZfB","YfA","YfB","WfA","WfB","TfA","TfB"],Rha:["0HA","0HB","1HA","1HB","2HA","2HB","3HA","3HB","4HA","4HB","ZHA","ZHB","YHA","YHB","WHA","WHB","THA","THB","0hA","0hB","1hA","1hB","2hA","2hB","3hA","3hB","4hA","4hB","ZhA","ZhB","YhA","YhB","WhA","WhB","ThA","ThB"],Qui:["0QA","0QB","1QA","1QB","2QA","2QB","3QA","3QB","4QA","4QB","ZQA","ZQB","YQA","YQB","WQA","WQB","TQA","TQB","0qA","0qB","1qA","1qB","2qA","2qB","3qA","3qB","4qA","4qB","ZqA","ZqB","YqA","YqB","WqA","WqB","TqA","TqB"],Lyx:["0DA","0DB","1DA","1DB","2DA","2DB","3DA","3DB","4DA","4DB","ZDA","ZDB","YDA","YDB","WDA","WDB","TDA","TDB","0DD","0DU","1DD","1DU","2DD","2DU","3DD","3DU","5DD","5DU","ZDD","ZDU","0dA","0dB","1dA","1dB","2dA","2dB","3dA","3dB","4dA","4dB","ZdA","ZdB","YdA","YdB","WdA","WdB","TdA","TdB","0dD","0dU","1dD","1dU","2dD","2dU","3dD","3dU","5dD","5dU","ZdD","ZdU"],Xyl:["0XA","0XB","1XA","1XB","2XA","2XB","3XA","3XB","4XA","4XB","ZXA","ZXB","YXA","YXB","WXA","WXB","TXA","TXB","0XD","0XU","1XD","1XU","2XD","2XU","3XD","3XU","5XD","5XU","ZXD","ZXU","0xA","0xB","1xA","1xB","2xA","2xB","3xA","3xB","4xA","4xB","ZxA","ZxB","YxA","YxB","WxA","WxB","TxA","TxB","0xD","0xU","1xD","1xU","2xD","2xU","3xD","3xU","5xD","5xU","ZxD","ZxU"],Rib:["0RA","0RB","1RA","1RB","2RA","2RB","3RA","3RB","4RA","4RB","ZRA","ZRB","YRA","YRB","WRA","WRB","TRA","TRB","0RD","0RU","1RD","1RU","2RD","2RU","3RD","3RU","5RD","5RU","ZRD","ZRU","0rA","0rB","1rA","1rB","2rA","2rB","3rA","3rB","4rA","4rB","ZrA","ZrB","YrA","YrB","WrA","WrB","TrA","TrB","0rD","0rU","1rD","1rU","2rD","2rU","3rD","3rU","5rD","5rU","ZrD","ZrU"],Fru:["0CA","0CB","1CA","1CB","2CA","2CB","3CA","3CB","4CA","4CB","5CA","5CB","WCA","WCB","0CD","0CU","1CD","1CU","2CD","2CU","3CD","3CU","4CD","4CU","6CD","6CU","WCD","WCU","VCD","VCU","UCD","UCU","QCD","QCU","0cA","0cB","1cA","1cB","2cA","2cB","3cA","3cB","4cA","4cB","5cA","5cB","WcA","WcB","0cD","0cU","1cD","1cU","2cD","2cU","3cD","3cU","4cD","4cU","6cD","6cU","WcD","WcU","VcD","VcU","UcD","UcU","QcD","QcU"],Tag:["0JA","0JB","1JA","1JB","2JA","2JB","3JA","3JB","4JA","4JB","5JA","5JB","WJA","WJB","0JD","0JU","1JD","1JU","2JD","2JU","3JD","3JU","4JD","4JU","6JD","6JU","WJD","WJU","VJD","VJU","UJD","UJU","QJD","QJU","0jA","0jB","1jA","1jB","2jA","2jB","3jA","3jB","4jA","4jB","5jA","5jB","WjA","WjB","0jD","0jU","1jD","1jU","2jD","2jU","3jD","3jU","4jD","4jU","6jD","6jU","WjD","WjU","VjD","VjU","UjD","UjU","QjD","QjU"],Sor:["0BA","0BB","1BA","1BB","2BA","2BB","3BA","3BB","4BA","4BB","5BA","5BB","WBA","WBB","0BD","0BU","1BD","1BU","2BD","2BU","3BD","3BU","4BD","4BU","6BD","6BU","WBD","WBU","VBD","VBU","UBD","UBU","QBD","QBU","0bA","0bB","1bA","1bB","2bA","2bB","3bA","3bB","4bA","4bB","5bA","5bB","WbA","WbB","0bD","0bU","1bD","1bU","2bD","2bU","3bD","3bU","4bD","4bU","6bD","6bU","WbD","WbU","VbD","VbU","UbD","UbU","QbD","QbU"],Psi:["0PA","0PB","1PA","1PB","2PA","2PB","3PA","3PB","4PA","4PB","5PA","5PB","WPA","WPB","0PD","0PU","1PD","1PU","2PD","2PU","3PD","3PU","4PD","4PU","6PD","6PU","WPD","WPU","VPD","VPU","UPD","UPU","QPD","QPU","0pA","0pB","1pA","1pB","2pA","2pB","3pA","3pB","4pA","4pB","5pA","5pB","WpA","WpB","0pD","0pU","1pD","1pU","2pD","2pU","3pD","3pU","4pD","4pU","6pD","6pU","WpD","WpU","VpD","VpU","UpD","UpU","QpD","QpU"],Neu5Ac:["0SA","0SB","4SA","4SB","7SA","7SB","8SA","8SB","9SA","9SB","ASA","ASB","BSA","BSB","CSA","CSB","DSA","DSB","ESA","ESB","FSA","FSB","GSA","GSB","HSA","HSB","ISA","ISB","JSA","JSB","KSA","KSB","0sA","0sB","4sA","4sB","7sA","7sB","8sA","8sB","9sA","9sB","AsA","AsB","BsA","BsB","CsA","CsB","DsA","DsB","EsA","EsB","FsA","FsB","GsA","GsB","HsA","HsB","IsA","IsB","JsA","JsB","KsA","KsB"],Neu5Gc:["0GL","4GL","7GL","8GL","9GL","CGL","DGL","EGL","FGL","GGL","HGL","IGL","JGL","KGL","0gL","4gL","7gL","8gL","9gL","AgL","BgL","CgL","DgL","EgL","FgL","GgL","HgL","IgL","JgL","KgL"],Tyv:["YTV","4TV","2TV","1TV","0TV","YTv","4Tv","2Tv","1Tv","0Tv"],Abe:["YAE","2AE","4AE","1AE","0AE","YAe","4Ae","2Ae","1Ae","0Ae"],Bac:["0BC","1BC","3BC","0bC","1bC","3bC"],Kdn:["0KN","4KN","5KN","7KN","8KN","9KN","AKN","BKN","CKN","DKN","EKN","FKN","GKN","HKN","IKN","JKN","KKN","LKN","MKN","NKN","OKN","PKN","QKN","RKN","SKN","TKN","UKN","VKN","WKN","XKN","YKN","0Kn","4Kn","5Kn","7Kn","8Kn","9Kn","AKn","BKn","CKn","DKn","EKn","FKn","GKn","HKn","IKn","JKn","KKn","LKn","MKn","NKn","OKn","PKn","QKn","RKn","SKn","TKn","UKn","VKn","WKn","XKn","YKn"],Kdo:["0KO","4KO","5KO","7KO","8KO","AKO","BKO","CKO","DKO","EKO","FKO","GKO","HKO","IKO","JKO","KKO","0Ko","4Ko","5Ko","7Ko","8Ko","AKo","BKo","CKo","DKo","EKo","FKo","GKo","HKo","IKo","JKo","KKo"],QuiNAc:["0QF","1QF","3QF","0Qf","1Qf","3Qf"],AAT:["0FC","1FC","3FC","0Fc","1Fc","3Fc"],Ara4N:["ZaN","3aN","2aN","1aN","0aN","Zan","3an","2an","1an","0an"],Aci:["JeC","8eC","4eC","2eC","0eC","Jec","8ec","4ec","2ec","0ec"],Leg:["JLG","8LG","4LG","2LG","0LG","JLg","8Lg","4Lg","2Lg","0Lg"],Pse:["JmP","8mP","4mP","2mP","0mP","Jmp","8mp","4mp","2mp","0mp"],Fus:["EgF","HgF","JgF","8gF","KgF","7gF","4gF","2gF","0gF","Egf","Hgf","Jgf","8gf","Kgf","7gf","4gf","2gf","0gf"],DDmanpHep:["ODH","NDH","LDH","MDH","KDH","7DH","PDH","SDH","RDH","XDH","QDH","VDH","UDH","6DH","TDH","ZDH","YDH","2DH","WDH","3DH","4DH","1DH","ODh","NDh","LDh","MDh","KDh","7Dh","PDh","SDh","RDh","XDh","QDh","VDh","UDh","6Dh","TDh","ZDh","YDh","2Dh","WDh","3Dh","4Dh","1Dh"],LDmanpHep:["OLH","NLH","LLH","MLH","KLH","7LH","PLH","SLH","RLH","XLH","QLH","VLH","ULH","6LH","TLH","ZLH","YLH","2LH","WLH","3LH","4LH","1LH","OLh","NLh","LLh","MLh","KLh","7Lh","PLh","SLh","RLh","XLh","QLh","VLh","ULh","6Lh","TLh","ZLh","YLh","2Lh","WLh","3Lh","4Lh","1Lh"],K3O:["dKX","EKX","hKX","HKX","jKX","JKX","pKX","8KX","MKX","kKX","KKX","qKX","7KX","xKX","WKX","tKX","3KX","sKX","4KX","5KX","2KX","0KX","dKx","EKx","hKx","HKx","jKx","JKx","pKx","8Kx","MKx","kKx","KKx","qKx","7Kx","xKx","WKx","tKx","3Kx","sKx","4Kx","5Kx","2Kx","0Kx"],MurNAc:["UMR","4MR","6MR","1MR","0MR","UMr","4Mr","6Mr","1Mr","0Mr"],Oli:["WdR","4dR","3dR","1dR","0dR"],dUA:["Z45","345","245","145","045"],GlcNS:["QYS","UYS","VYS","6YS","WYS","4YS","3YS","1YS","0YS","QYs","UYs","VYs","6Ys","WYs","4Ys","3Ys","1Ys","0Ys","QyS","UyS","VyS","6yS","WyS","4yS","3yS","1yS","0yS","Qys","Uys","Vys","6ys","Wys","4ys","3ys","1ys","0ys"]},y=function(){const e=new Map
for(let t=0,n=d.length;t<n;++t){const n=d[t],r=f[n.abbr]
if(r)for(let t=0,o=r.length;t<o;++t)e.set(r[t],n)
const i=m[n.abbr]
if(i)for(let t=0,o=i.length;t<o;++t)e.set(i[t],n)}return i.forEach(t=>{e.has(t)||e.set(t,u)}),e}(),v=function(){const e=new Map
for(let t=0,n=d.length;t<n;++t){const n=d[t],r=f[n.abbr]
if(r)for(let t=0,a=r.length;t<a;++t)e.set(r[t],n)
const i=m[n.abbr]
if(i)for(let t=0,a=i.length;t<a;++t)e.set(i[t],n)
const o=g[n.abbr]
if(o)for(let t=0,a=o.length;t<a;++t)e.has(o[t])||e.set(o[t],n)}return i.forEach(t=>{e.has(t)||e.set(t,u)}),e}()
function b(e){x="default"===e?y:v}let x=y},11678(e,t,n){"use strict"
n.r(t),n(61603),n(9054),n(43227)},11825(e,t,n){"use strict"
n.d(t,{F:()=>_})
var r=n(92384),i=n(48393),o=n(95579),a=n(93362),s=n(50690),l=n(5638),c=n(67538),u=n(87095)
const d=new i.Bond.ElementBondIterator,p=new i.Bond.ElementBondIterator,h=new i.Bond.ElementBondIterator,f=new i.Bond.ElementBondIterator
function m(e,t,n,r,i){const c=(0,s.IS)(e,t,n,o.S8.H),m=(0,s.$X)(t,n)
let g=(0,s.M0)(t,n)
const y="always"===r.assignCharge||"auto"===r.assignCharge&&0===g,v="always"===r.assignH||"auto"===r.assignH&&!i&&0===c,b=(0,s.Hm)(e,t,n),x=function(e,t,n){let r=0
const{offset:i,edgeProps:{flags:o,order:a}}=t.bonds
for(let s=i[n],l=i[n+1];s<l;++s)u.BondType.isCovalent(o[s])&&(r+=a[s])
return e.interUnitBonds.getEdgeIndices(n,t.id).forEach(t=>{const n=e.interUnitBonds.edges[t]
u.BondType.isCovalent(n.props.flag)&&(r+=n.props.order)}),r}(e,t,n),S=function(e,t,n){const r=(0,s.$X)(t,n),i=r===o.S8.O||r===o.S8.N
if(i&&4===(0,s.Hm)(e,t,n))return!1
for(d.setElement(e,t,n);d.hasNext;){const t=d.move()
if(t.order>1)return!0
if(i){const n=(0,s.$X)(t.otherUnit,t.otherIndex)
for(p.setElement(e,t.otherUnit,t.otherIndex);p.hasNext;){const e=p.move()
if(e.order>1){if((n===o.S8.P||n===o.S8.S)&&(0,s.$X)(e.otherUnit,e.otherIndex)===o.S8.O)continue
return!0}}}}return!1}(e,t,n),_=x-b>0
let C=0,w=a.G0.Unknown
switch(m){case o.S8.H:y&&(0===b?(g=1,w=a.G0.Spherical):1===b&&(g=0,w=a.G0.Terminal))
break
case o.S8.C:y&&(g=0),v&&(C=Math.max(0,4-x-Math.abs(g))),w=(0,a.kx)(b+C+Math.max(0,-g))
break
case o.S8.N:if(y)if(v)if(S&&x<4)g=b-c===1&&x-c===2?1:0
else for(h.setElement(e,t,n);h.hasNext;){const e=h.move(),t=(0,s.$X)(e.otherUnit,e.otherIndex)
if(t===o.S8.S||(0,o.kV)(t)){g=0
break}g=1}else g=x-3
v&&(C=Math.max(0,3-x+g)),w=S&&!_?(0,a.kx)(b+C-g):(0,a.kx)(b+C+1-g)
break
case o.S8.O:if(y&&(v||(g=x-2),1===x)){h.setElement(e,t,n)
e:for(;h.hasNext;){const r=h.move()
for(f.setElement(e,r.otherUnit,r.otherIndex);f.hasNext;){const e=f.move()
if((e.otherUnit!==t||e.otherIndex!==n)&&(0,s.$X)(e.otherUnit,e.otherIndex)===o.S8.O&&2===e.order){g=-1
break e}}}}v&&(C=Math.max(0,2-x+g)),w=S&&!_?(0,a.kx)(b+C-g+1):(0,a.kx)(b+C-g+2)
break
case o.S8.S:y&&(v||(g=x<=3&&0===(0,s.IS)(e,t,n,o.S8.O)?x-2:0)),v&&x<2&&(C=Math.max(0,2-x+g)),x<=3&&(w=(0,a.kx)(b+C-g+2))
break
case o.S8.F:case o.S8.CL:case o.S8.BR:case o.S8.I:case o.S8.AT:y&&(g=x-1)
break
case o.S8.LI:case o.S8.NA:case o.S8.K:case o.S8.RB:case o.S8.CS:case o.S8.FR:y&&(g=1-x)
break
case o.S8.BE:case o.S8.MG:case o.S8.CA:case o.S8.SR:case o.S8.BA:case o.S8.RA:y&&(g=2-x)
break
default:l.Bb&&console.warn("Requested charge, protonation for an unhandled element",m)}return[g,C,C+c,w]}function g(e,t,n){const r=t.elements.length,i=new Int8Array(r),a=new Int8Array(r),l=new Int8Array(r),u=new Int8Array(r),d=!!e.parent
let p
if(d){const n=e.root.unitMap.get(t.id)
if(p=c.X9.indicesOf(n.elements,t.elements),p.length!==t.elements.length)throw new Error("expected to find an index for every element")
t=n,e=e.root}let h=!1
for(let c=0;c<r;++c){const e=d?p[c]:c
if((0,s.$X)(t,e)===o.S8.H){h=!0
break}}for(let o=0;o<r;++o){const r=d?p[o]:o,[s,c,f,g]=m(e,t,r,n,h)
i[o]=s,a[o]=c,l[o]=f,u[o]=g}return{charge:i,implicitH:a,totalH:l,idealGeometry:u}}const y={assignCharge:r.t.Select("auto",[["always","always"],["auto","auto"],["never","never"]]),assignH:r.t.Select("auto",[["always","always"],["auto","auto"],["never","never"]])}
async function v(e,t,n){const o={...r.t.getDefaultValues(y),...n},a=new Map,s=`valence-model-${JSON.stringify(o)}`
for(let r=0,l=t.units.length;r<l;++r){const e=t.units[r]
if(i.Unit.isAtomic(e)){let n
e.transientCache.has(s)?n=e.transientCache.get(s):(n=g(t,e,o),e.transientCache.set(s,n)),a.set(e.id,n)}}return a}var b=n(76840),x=n(33205)
const S={...y},_=b.S.createProvider({label:"Valence Model",descriptor:(0,x.e)({name:"molstar_computed_valence_model"}),type:"local",defaultParams:S,getParams:e=>S,isApplicable:e=>!0,obtain:async(e,t,n)=>{const i={...r.t.getDefaultValues(S),...n}
return{value:await v(e.runtime,t,i)}}})},12046(e,t,n){"use strict"
n.d(t,{ND:()=>i,ar:()=>r})
var r,i,o=n(70012),a=n(4485),s=n(99153)
class l{and(e){return new l(this.providers.concat([e]))}encode(e){const t=[]
for(const n of this.providers){const r=n(e)
if(!r.encodings.length)throw new Error("Encodings must be non-empty.")
e=r.data
for(const e of r.encodings)t.push(e)}if(!(e instanceof Uint8Array))throw new Error("The encoding must result in a Uint8Array. Fix your encoding chain.")
return{encoding:t,data:e}}constructor(e){this.providers=e}}!function(e){function t(e){return new l([e])}function n(e){switch(e.kind){case"ByteArray":return i.byteArray
case"FixedPoint":return i.fixedPoint(e.factor)
case"IntervalQuantization":return i.intervalQuantizaiton(e.min,e.max,e.numSteps)
case"RunLength":return i.runLength
case"Delta":return i.delta
case"IntegerPacking":return i.integerPacking
case"StringArray":return i.stringArray}}e.by=t,e.fromEncoding=function(e){let r=t(n(e[0]))
for(let t=1;t<e.length&&"IntegerPacking"!==e[t-1].kind;t++)r=r.and(n(e[t]))
return r}}(r||(r={})),function(e){e.by=function(e){return new l([e])}
const t={[a.W.IntDataType.Int16]:function(e,t,n){e.setInt16(2*t,n,!0)},[a.W.IntDataType.Uint16]:function(e,t,n){e.setUint16(2*t,n,!0)},[a.W.IntDataType.Int32]:function(e,t,n){e.setInt32(4*t,n,!0)},[a.W.IntDataType.Uint32]:function(e,t,n){e.setUint32(4*t,n,!0)},[a.W.FloatDataType.Float32]:function(e,t,n){e.setFloat32(4*t,n,!0)},[a.W.FloatDataType.Float64]:function(e,t,n){e.setFloat64(8*t,n,!0)}},n={[a.W.IntDataType.Int16]:2,[a.W.IntDataType.Uint16]:2,[a.W.IntDataType.Int32]:4,[a.W.IntDataType.Uint32]:4,[a.W.FloatDataType.Float32]:4,[a.W.FloatDataType.Float64]:8}
function r(e){const r=a.W.getDataType(e)
if(r===a.W.IntDataType.Int8)return function(e){return{encodings:[{kind:"ByteArray",type:a.W.IntDataType.Int8}],data:new Uint8Array(e.buffer,e.byteOffset)}}(e)
if(r===a.W.IntDataType.Uint8)return function(e){return{encodings:[{kind:"ByteArray",type:a.W.IntDataType.Uint8}],data:e}}(e)
const i=new Uint8Array(e.length*n[r]),o=t[r],s=new DataView(i.buffer)
for(let t=0,n=e.length;t<n;t++)o(s,t,e[t])
return{encodings:[{kind:"ByteArray",type:r}],data:i}}function i(e,t){let n=0
for(let r=0,i=e.length;r<i;r++)n+=e[r]/t|0
return n+=e.length,n}function c(e,t){const n=-t-1
let r=0
for(let i=0,o=e.length;i<o;i++){const o=e[i]
r+=o>=0?o/t|0:o/n|0}return r+=e.length,r}e.byteArray=r,e.fixedPoint=function(e){return t=>function(e,t){const n=a.W.getDataType(e),r=new Int32Array(e.length)
for(let i=0,o=e.length;i<o;i++)r[i]=Math.round(e[i]*t)
return{encodings:[{kind:"FixedPoint",factor:t,srcType:n}],data:r}}(t,e)},e.intervalQuantizaiton=function(e,t,n,r=Int32Array){return i=>function(e,t,n,r,i){const o=a.W.getDataType(e)
if(!e.length)return{encodings:[{kind:"IntervalQuantization",min:t,max:n,numSteps:r,srcType:o}],data:new Int32Array(0)}
if(n<t){const e=t
t=n,n=e}const s=(n-t)/(r-1),l=new i(e.length)
for(let a=0,c=e.length;a<c;a++){const i=e[a]
l[a]=i<=t?0:i>=n?r-1:0|Math.round((i-t)/s)}return{encodings:[{kind:"IntervalQuantization",min:t,max:n,numSteps:r,srcType:o}],data:l}}(i,e,t,n,r)},e.runLength=function(e){let t=a.W.getDataType(e)
if(void 0===t&&(e=new Int32Array(e),t=a.W.IntDataType.Int32),!e.length)return{encodings:[{kind:"RunLength",srcType:t,srcSize:0}],data:new Int32Array(0)}
let n=2
for(let a=1,s=e.length;a<s;a++)e[a-1]!==e[a]&&(n+=2)
const r=new Int32Array(n)
let i=0,o=1
for(let a=1,s=e.length;a<s;a++)e[a-1]!==e[a]?(r[i]=e[a-1],r[i+1]=o,o=1,i+=2):++o
return r[i]=e[e.length-1],r[i+1]=o,{encodings:[{kind:"RunLength",srcType:t,srcSize:e.length}],data:r}},e.delta=function(e){if(!a.W.isSignedIntegerDataType(e))throw new Error("Only signed integer types can be encoded using delta encoding.")
let t=a.W.getDataType(e)
if(void 0===t&&(e=new Int32Array(e),t=a.W.IntDataType.Int32),!e.length)return{encodings:[{kind:"Delta",origin:0,srcType:t}],data:new e.constructor(0)}
const n=new e.constructor(e.length),r=e[0]
n[0]=e[0]
for(let i=1,o=e.length;i<o;i++)n[i]=e[i]-e[i-1]
return n[0]=0,{encodings:[{kind:"Delta",origin:r,srcType:t}],data:n}},e.integerPacking=function(e){const t=function(e){const t=function(e){for(let t=0,n=e.length;t<n;t++)if(e[t]<0)return!0
return!1}(e),n=t?c(e,127):i(e,255),r=t?c(e,32767):i(e,65535)
return 4*e.length<2*r?{isSigned:t,size:e.length,bytesPerElement:4}:2*r<n?{isSigned:t,size:r,bytesPerElement:2}:{isSigned:t,size:n,bytesPerElement:1}}(e)
return 4===t.bytesPerElement?r(e):function(e,t){const n=t.isSigned?1===t.bytesPerElement?127:32767:1===t.bytesPerElement?255:65535,i=-n-1,o=e.length,a=t.isSigned?1===t.bytesPerElement?new Int8Array(t.size):new Int16Array(t.size):1===t.bytesPerElement?new Uint8Array(t.size):new Uint16Array(t.size)
let s=0
for(let r=0;r<o;r++){let t=e[r]
if(t>=0)for(;t>=n;)a[s]=n,++s,t-=n
else for(;t<=i;)a[s]=i,++s,t-=i
a[s]=t,++s}const l=r(a)
return{encodings:[{kind:"IntegerPacking",byteCount:t.bytesPerElement,isUnsigned:!t.isSigned,srcSize:o},l.encodings[0]],data:l.data}}(e,t)},e.stringArray=function(e){const t=Object.create(null),n=[],r=new Int32Array(e.length),i=o.Gm.create(Int32Array,1,Math.min(1024,e.length<32?e.length+1:Math.round(e.length/8)+1))
o.Gm.add(i,0)
let a=0,l=0
for(const s of e){if(null==s){r[l++]=-1
continue}let e=t[s]
void 0===e&&(a+=s.length,e=n.length,n[e]=s,t[s]=e,o.Gm.add(i,a)),r[l++]=e}const c=o.Gm.compact(i),u=(0,s.P)(c).encode(c),d=(0,s.P)(r).encode(r)
return{encodings:[{kind:"StringArray",dataEncoding:d.encoding,stringData:n.join(""),offsetEncoding:u.encoding,offsets:u.data}],data:d.data}}}(i||(i={}))},12288(e,t,n){"use strict"
function r(e,t=" "){return e.replace(/([a-z\xE0-\xFF])([A-Z\xC0\xDF])/g,`$1${t}$2`)}function i(e){return s(r(e))}n.d(t,{GW:()=>c,Hh:()=>i,Kq:()=>u,Mk:()=>l,Nt:()=>d,ZH:()=>s,r4:()=>a})
const o=e=>e.toUpperCase()
function a(e){return e?"string"==typeof e?e.toUpperCase():`${e}`.toUpperCase():""}function s(e){return e.toLowerCase().replace(/^\w|\s\w/g,o)}function l(e){return s(r(function(e){return e.replace(/_/g," ")}(function(e){return e.replace(/-/g," ")}(e))))}function c(e,t){const n=Object.keys(t),r=Object.values(t)
return new Function(...n,`return \`${e}\`;`)(...r)}function u(e){return e.replace(/<\/?[^>]+>/g,"")}function d(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}},12372(e,t,n){"use strict"
n.d(t,{V:()=>a})
var r=n(87095),i=n(24762),o=n(29472)
class a{constructor(){this.count=0,this.ids=[],this.types=[],this.descriptions=[],this.compoundsMap=new Map,this.namesMap=new Map,this.heteroMap=new Map,this.chainMap=new Map}set(e,t){this.count+=1,this.ids.push(`${this.count}`),this.types.push(e),this.descriptions.push([t])}getEntityId(e,t,n,i){return t===r.MoleculeType.Water?(void 0===this.waterId&&(this.set("water",(null==i?void 0:i.customName)||"Water"),this.waterId=`${this.count}`),this.waterId):(0,r.isPolymer)(t)?this.compoundsMap.has(n)?this.compoundsMap.get(n):(this.chainMap.has(n)||(this.set("polymer",(null==i?void 0:i.customName)||`Polymer ${this.chainMap.size+1}`),this.chainMap.set(n,`${this.count}`)),this.chainMap.get(n)):(this.heteroMap.has(e)||(this.set("non-polymer",(null==i?void 0:i.customName)||this.namesMap.get(e)||e),this.heteroMap.set(e,`${this.count}`)),this.heteroMap.get(e))}getEntityTable(){return i.XI.ofPartialColumns(o.e.entity,{id:i.VP.ofStringArray(this.ids),type:i.VP.ofStringAliasArray(this.types),pdbx_description:i.VP.ofStringListArray(this.descriptions)},this.count)}setCompounds(e){for(let t=0,n=e.length;t<n;++t){const{chains:n,description:r}=e[t]
this.set("polymer",r)
for(let e=0,t=n.length;e<t;++e)this.compoundsMap.set(n[e],`${this.count}`)}}setNames(e){e.forEach(e=>this.namesMap.set(e[0],e[1]))}}},13352(e,t,n){"use strict"
function r(e,t){if(e){var n=e.indexOf(t)
0<=n&&e.splice(n,1)}}n.d(t,{o:()=>r})},13564(e,t,n){"use strict"
n.d(t,{i:()=>i})
var r=n(92384)
function i(e){return{...i.Zero,...e}}!function(e){e.Zero={metalness:0,roughness:0,bumpiness:0},e.toArray=function(e,t,n){return t[n]=255*e.metalness,t[n+1]=255*e.roughness,t[n+2]=255*e.bumpiness,t},e.toArrayNormalized=function(e,t,n){return t[n]=e.metalness,t[n+1]=e.roughness,t[n+2]=e.bumpiness,t},e.areEqual=function(e,t){return e.metalness===t.metalness&&e.roughness===t.roughness&&e.bumpiness===t.bumpiness},e.toString=function({metalness:e,roughness:t,bumpiness:n}){return`M ${e.toFixed(2)} | R ${t.toFixed(2)} | B ${n.toFixed(2)}`},e.getParam=function(e){return r.t.Group({metalness:r.t.Numeric(0,{min:0,max:1,step:.01}),roughness:r.t.Numeric(1,{min:0,max:1,step:.01}),bumpiness:r.t.Numeric(0,{min:0,max:1,step:.01})},{...e,presets:[[{metalness:0,roughness:1,bumpiness:0},"Matte"],[{metalness:0,roughness:.2,bumpiness:0},"Plastic"],[{metalness:0,roughness:.6,bumpiness:0},"Glossy"],[{metalness:1,roughness:.6,bumpiness:0},"Metallic"]]})}}(i||(i={}))},13686(e,t,n){"use strict"
n.d(t,{Dt:()=>u,HQ:()=>l,Ju:()=>a})
var r=n(87095),i=n(32775),o=n(44688)
function a(e,t){switch(e.kind){case o.Nf.Kind.Atomic:return e.model.atomicHierarchy.derived.residue.moleculeType[e.residueIndex[t]]
case o.Nf.Kind.Spheres:case o.Nf.Kind.Gaussians:const n=function(e,t){const n=e.coarseElements.entityKey[t],r=e.model.sequence.byEntityKey[n].sequence,i=e.coarseElements.seq_id_begin.value(t)
return r.compId.value(i-1)}(e,t),i=e.model.properties.chemicalComponentMap.get(n)
if(i)return(0,r.getMoleculeType)(i.type,n)}return r.MoleculeType.Unknown}const s=new Set
function l(e,t){const n=r.PolymerTypeAtomRoleId[e]
if(void 0!==n){const e=n[t]
if(void 0!==e)return e}return s}const c=i.eB.zero()
function u(e,t){const n=e.conformation,r=new Float32Array(3*t.length),{elements:o}=e
for(let a=0,s=t.length;a<s;++a)n.position(o[t[a]],c),i.eB.toArray(c,r,3*a)
return r}},13821(e,t,n){"use strict"
n.r(t),n.d(t,{Alert:()=>Pt,Button:()=>Et,Carousel:()=>dn,Collapse:()=>Tn,Dropdown:()=>Yn,Modal:()=>kr,Offcanvas:()=>Wr,Popover:()=>Si,ScrollSpy:()=>Di,Tab:()=>to,Toast:()=>yo,Tooltip:()=>gi})
var r={}
n.r(r),n.d(r,{afterMain:()=>C,afterRead:()=>x,afterWrite:()=>A,applyStyles:()=>M,arrow:()=>J,auto:()=>l,basePlacements:()=>c,beforeMain:()=>S,beforeRead:()=>v,beforeWrite:()=>w,bottom:()=>o,clippingParents:()=>p,computeStyles:()=>re,createPopper:()=>De,createPopperBase:()=>ke,createPopperLite:()=>Me,detectOverflow:()=>ve,end:()=>d,eventListeners:()=>oe,flip:()=>be,hide:()=>_e,left:()=>s,main:()=>_,modifierPhases:()=>I,offset:()=>Ce,placements:()=>y,popper:()=>f,popperGenerator:()=>Ee,popperOffsets:()=>we,preventOverflow:()=>Te,read:()=>b,reference:()=>m,right:()=>a,start:()=>u,top:()=>i,variationPlacements:()=>g,viewport:()=>h,write:()=>T})
var i="top",o="bottom",a="right",s="left",l="auto",c=[i,o,a,s],u="start",d="end",p="clippingParents",h="viewport",f="popper",m="reference",g=c.reduce(function(e,t){return e.concat([t+"-"+u,t+"-"+d])},[]),y=[].concat(c,[l]).reduce(function(e,t){return e.concat([t,t+"-"+u,t+"-"+d])},[]),v="beforeRead",b="read",x="afterRead",S="beforeMain",_="main",C="afterMain",w="beforeWrite",T="write",A="afterWrite",I=[v,b,x,S,_,C,w,T,A]
function P(e){return e?(e.nodeName||"").toLowerCase():null}function B(e){if(null==e)return window
if("[object Window]"!==e.toString()){var t=e.ownerDocument
return t&&t.defaultView||window}return e}function E(e){return e instanceof B(e).Element||e instanceof Element}function k(e){return e instanceof B(e).HTMLElement||e instanceof HTMLElement}function D(e){return"undefined"!=typeof ShadowRoot&&(e instanceof B(e).ShadowRoot||e instanceof ShadowRoot)}const M={name:"applyStyles",enabled:!0,phase:"write",fn:function(e){var t=e.state
Object.keys(t.elements).forEach(function(e){var n=t.styles[e]||{},r=t.attributes[e]||{},i=t.elements[e]
k(i)&&P(i)&&(Object.assign(i.style,n),Object.keys(r).forEach(function(e){var t=r[e]
!1===t?i.removeAttribute(e):i.setAttribute(e,!0===t?"":t)}))})},effect:function(e){var t=e.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}}
return Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow),function(){Object.keys(t.elements).forEach(function(e){var r=t.elements[e],i=t.attributes[e]||{},o=Object.keys(t.styles.hasOwnProperty(e)?t.styles[e]:n[e]).reduce(function(e,t){return e[t]="",e},{})
k(r)&&P(r)&&(Object.assign(r.style,o),Object.keys(i).forEach(function(e){r.removeAttribute(e)}))})}},requires:["computeStyles"]}
function R(e){return e.split("-")[0]}var O=Math.max,L=Math.min,N=Math.round
function F(){var e=navigator.userAgentData
return null!=e&&e.brands&&Array.isArray(e.brands)?e.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function z(){return!/^((?!chrome|android).)*safari/i.test(F())}function j(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1)
var r=e.getBoundingClientRect(),i=1,o=1
t&&k(e)&&(i=e.offsetWidth>0&&N(r.width)/e.offsetWidth||1,o=e.offsetHeight>0&&N(r.height)/e.offsetHeight||1)
var a=(E(e)?B(e):window).visualViewport,s=!z()&&n,l=(r.left+(s&&a?a.offsetLeft:0))/i,c=(r.top+(s&&a?a.offsetTop:0))/o,u=r.width/i,d=r.height/o
return{width:u,height:d,top:c,right:l+u,bottom:c+d,left:l,x:l,y:c}}function V(e){var t=j(e),n=e.offsetWidth,r=e.offsetHeight
return Math.abs(t.width-n)<=1&&(n=t.width),Math.abs(t.height-r)<=1&&(r=t.height),{x:e.offsetLeft,y:e.offsetTop,width:n,height:r}}function U(e,t){var n=t.getRootNode&&t.getRootNode()
if(e.contains(t))return!0
if(n&&D(n)){var r=t
do{if(r&&e.isSameNode(r))return!0
r=r.parentNode||r.host}while(r)}return!1}function G(e){return B(e).getComputedStyle(e)}function H(e){return["table","td","th"].indexOf(P(e))>=0}function q(e){return((E(e)?e.ownerDocument:e.document)||window.document).documentElement}function Q(e){return"html"===P(e)?e:e.assignedSlot||e.parentNode||(D(e)?e.host:null)||q(e)}function $(e){return k(e)&&"fixed"!==G(e).position?e.offsetParent:null}function X(e){for(var t=B(e),n=$(e);n&&H(n)&&"static"===G(n).position;)n=$(n)
return n&&("html"===P(n)||"body"===P(n)&&"static"===G(n).position)?t:n||function(e){var t=/firefox/i.test(F())
if(/Trident/i.test(F())&&k(e)&&"fixed"===G(e).position)return null
var n=Q(e)
for(D(n)&&(n=n.host);k(n)&&["html","body"].indexOf(P(n))<0;){var r=G(n)
if("none"!==r.transform||"none"!==r.perspective||"paint"===r.contain||-1!==["transform","perspective"].indexOf(r.willChange)||t&&"filter"===r.willChange||t&&r.filter&&"none"!==r.filter)return n
n=n.parentNode}return null}(e)||t}function W(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function Y(e,t,n){return O(e,L(t,n))}function Z(e){return Object.assign({},{top:0,right:0,bottom:0,left:0},e)}function K(e,t){return t.reduce(function(t,n){return t[n]=e,t},{})}const J={name:"arrow",enabled:!0,phase:"main",fn:function(e){var t,n=e.state,r=e.name,l=e.options,u=n.elements.arrow,d=n.modifiersData.popperOffsets,p=R(n.placement),h=W(p),f=[s,a].indexOf(p)>=0?"height":"width"
if(u&&d){var m=function(e,t){return Z("number"!=typeof(e="function"==typeof e?e(Object.assign({},t.rects,{placement:t.placement})):e)?e:K(e,c))}(l.padding,n),g=V(u),y="y"===h?i:s,v="y"===h?o:a,b=n.rects.reference[f]+n.rects.reference[h]-d[h]-n.rects.popper[f],x=d[h]-n.rects.reference[h],S=X(u),_=S?"y"===h?S.clientHeight||0:S.clientWidth||0:0,C=b/2-x/2,w=m[y],T=_-g[f]-m[v],A=_/2-g[f]/2+C,I=Y(w,A,T),P=h
n.modifiersData[r]=((t={})[P]=I,t.centerOffset=I-A,t)}},effect:function(e){var t=e.state,n=e.options.element,r=void 0===n?"[data-popper-arrow]":n
null!=r&&("string"!=typeof r||(r=t.elements.popper.querySelector(r)))&&U(t.elements.popper,r)&&(t.elements.arrow=r)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]}
function ee(e){return e.split("-")[1]}var te={top:"auto",right:"auto",bottom:"auto",left:"auto"}
function ne(e){var t,n=e.popper,r=e.popperRect,l=e.placement,c=e.variation,u=e.offsets,p=e.position,h=e.gpuAcceleration,f=e.adaptive,m=e.roundOffsets,g=e.isFixed,y=u.x,v=void 0===y?0:y,b=u.y,x=void 0===b?0:b,S="function"==typeof m?m({x:v,y:x}):{x:v,y:x}
v=S.x,x=S.y
var _=u.hasOwnProperty("x"),C=u.hasOwnProperty("y"),w=s,T=i,A=window
if(f){var I=X(n),P="clientHeight",E="clientWidth"
I===B(n)&&"static"!==G(I=q(n)).position&&"absolute"===p&&(P="scrollHeight",E="scrollWidth"),(l===i||(l===s||l===a)&&c===d)&&(T=o,x-=(g&&I===A&&A.visualViewport?A.visualViewport.height:I[P])-r.height,x*=h?1:-1),l!==s&&(l!==i&&l!==o||c!==d)||(w=a,v-=(g&&I===A&&A.visualViewport?A.visualViewport.width:I[E])-r.width,v*=h?1:-1)}var k,D=Object.assign({position:p},f&&te),M=!0===m?function(e,t){var n=e.x,r=e.y,i=t.devicePixelRatio||1
return{x:N(n*i)/i||0,y:N(r*i)/i||0}}({x:v,y:x},B(n)):{x:v,y:x}
return v=M.x,x=M.y,h?Object.assign({},D,((k={})[T]=C?"0":"",k[w]=_?"0":"",k.transform=(A.devicePixelRatio||1)<=1?"translate("+v+"px, "+x+"px)":"translate3d("+v+"px, "+x+"px, 0)",k)):Object.assign({},D,((t={})[T]=C?x+"px":"",t[w]=_?v+"px":"",t.transform="",t))}const re={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(e){var t=e.state,n=e.options,r=n.gpuAcceleration,i=void 0===r||r,o=n.adaptive,a=void 0===o||o,s=n.roundOffsets,l=void 0===s||s,c={placement:R(t.placement),variation:ee(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:i,isFixed:"fixed"===t.options.strategy}
null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,ne(Object.assign({},c,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:a,roundOffsets:l})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,ne(Object.assign({},c,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})},data:{}}
var ie={passive:!0}
const oe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(e){var t=e.state,n=e.instance,r=e.options,i=r.scroll,o=void 0===i||i,a=r.resize,s=void 0===a||a,l=B(t.elements.popper),c=[].concat(t.scrollParents.reference,t.scrollParents.popper)
return o&&c.forEach(function(e){e.addEventListener("scroll",n.update,ie)}),s&&l.addEventListener("resize",n.update,ie),function(){o&&c.forEach(function(e){e.removeEventListener("scroll",n.update,ie)}),s&&l.removeEventListener("resize",n.update,ie)}},data:{}}
var ae={left:"right",right:"left",bottom:"top",top:"bottom"}
function se(e){return e.replace(/left|right|bottom|top/g,function(e){return ae[e]})}var le={start:"end",end:"start"}
function ce(e){return e.replace(/start|end/g,function(e){return le[e]})}function ue(e){var t=B(e)
return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function de(e){return j(q(e)).left+ue(e).scrollLeft}function pe(e){var t=G(e),n=t.overflow,r=t.overflowX,i=t.overflowY
return/auto|scroll|overlay|hidden/.test(n+i+r)}function he(e){return["html","body","#document"].indexOf(P(e))>=0?e.ownerDocument.body:k(e)&&pe(e)?e:he(Q(e))}function fe(e,t){var n
void 0===t&&(t=[])
var r=he(e),i=r===(null==(n=e.ownerDocument)?void 0:n.body),o=B(r),a=i?[o].concat(o.visualViewport||[],pe(r)?r:[]):r,s=t.concat(a)
return i?s:s.concat(fe(Q(a)))}function me(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function ge(e,t,n){return t===h?me(function(e,t){var n=B(e),r=q(e),i=n.visualViewport,o=r.clientWidth,a=r.clientHeight,s=0,l=0
if(i){o=i.width,a=i.height
var c=z();(c||!c&&"fixed"===t)&&(s=i.offsetLeft,l=i.offsetTop)}return{width:o,height:a,x:s+de(e),y:l}}(e,n)):E(t)?function(e,t){var n=j(e,!1,"fixed"===t)
return n.top=n.top+e.clientTop,n.left=n.left+e.clientLeft,n.bottom=n.top+e.clientHeight,n.right=n.left+e.clientWidth,n.width=e.clientWidth,n.height=e.clientHeight,n.x=n.left,n.y=n.top,n}(t,n):me(function(e){var t,n=q(e),r=ue(e),i=null==(t=e.ownerDocument)?void 0:t.body,o=O(n.scrollWidth,n.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),a=O(n.scrollHeight,n.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),s=-r.scrollLeft+de(e),l=-r.scrollTop
return"rtl"===G(i||n).direction&&(s+=O(n.clientWidth,i?i.clientWidth:0)-o),{width:o,height:a,x:s,y:l}}(q(e)))}function ye(e){var t,n=e.reference,r=e.element,l=e.placement,c=l?R(l):null,p=l?ee(l):null,h=n.x+n.width/2-r.width/2,f=n.y+n.height/2-r.height/2
switch(c){case i:t={x:h,y:n.y-r.height}
break
case o:t={x:h,y:n.y+n.height}
break
case a:t={x:n.x+n.width,y:f}
break
case s:t={x:n.x-r.width,y:f}
break
default:t={x:n.x,y:n.y}}var m=c?W(c):null
if(null!=m){var g="y"===m?"height":"width"
switch(p){case u:t[m]=t[m]-(n[g]/2-r[g]/2)
break
case d:t[m]=t[m]+(n[g]/2-r[g]/2)}}return t}function ve(e,t){void 0===t&&(t={})
var n=t,r=n.placement,s=void 0===r?e.placement:r,l=n.strategy,u=void 0===l?e.strategy:l,d=n.boundary,g=void 0===d?p:d,y=n.rootBoundary,v=void 0===y?h:y,b=n.elementContext,x=void 0===b?f:b,S=n.altBoundary,_=void 0!==S&&S,C=n.padding,w=void 0===C?0:C,T=Z("number"!=typeof w?w:K(w,c)),A=x===f?m:f,I=e.rects.popper,B=e.elements[_?A:x],D=function(e,t,n,r){var i="clippingParents"===t?function(e){var t=fe(Q(e)),n=["absolute","fixed"].indexOf(G(e).position)>=0&&k(e)?X(e):e
return E(n)?t.filter(function(e){return E(e)&&U(e,n)&&"body"!==P(e)}):[]}(e):[].concat(t),o=[].concat(i,[n]),a=o[0],s=o.reduce(function(t,n){var i=ge(e,n,r)
return t.top=O(i.top,t.top),t.right=L(i.right,t.right),t.bottom=L(i.bottom,t.bottom),t.left=O(i.left,t.left),t},ge(e,a,r))
return s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}(E(B)?B:B.contextElement||q(e.elements.popper),g,v,u),M=j(e.elements.reference),R=ye({reference:M,element:I,strategy:"absolute",placement:s}),N=me(Object.assign({},I,R)),F=x===f?N:M,z={top:D.top-F.top+T.top,bottom:F.bottom-D.bottom+T.bottom,left:D.left-F.left+T.left,right:F.right-D.right+T.right},V=e.modifiersData.offset
if(x===f&&V){var H=V[s]
Object.keys(z).forEach(function(e){var t=[a,o].indexOf(e)>=0?1:-1,n=[i,o].indexOf(e)>=0?"y":"x"
z[e]+=H[n]*t})}return z}const be={name:"flip",enabled:!0,phase:"main",fn:function(e){var t=e.state,n=e.options,r=e.name
if(!t.modifiersData[r]._skip){for(var d=n.mainAxis,p=void 0===d||d,h=n.altAxis,f=void 0===h||h,m=n.fallbackPlacements,v=n.padding,b=n.boundary,x=n.rootBoundary,S=n.altBoundary,_=n.flipVariations,C=void 0===_||_,w=n.allowedAutoPlacements,T=t.options.placement,A=R(T),I=m||(A!==T&&C?function(e){if(R(e)===l)return[]
var t=se(e)
return[ce(e),t,ce(t)]}(T):[se(T)]),P=[T].concat(I).reduce(function(e,n){return e.concat(R(n)===l?function(e,t){void 0===t&&(t={})
var n=t,r=n.placement,i=n.boundary,o=n.rootBoundary,a=n.padding,s=n.flipVariations,l=n.allowedAutoPlacements,u=void 0===l?y:l,d=ee(r),p=d?s?g:g.filter(function(e){return ee(e)===d}):c,h=p.filter(function(e){return u.indexOf(e)>=0})
0===h.length&&(h=p)
var f=h.reduce(function(t,n){return t[n]=ve(e,{placement:n,boundary:i,rootBoundary:o,padding:a})[R(n)],t},{})
return Object.keys(f).sort(function(e,t){return f[e]-f[t]})}(t,{placement:n,boundary:b,rootBoundary:x,padding:v,flipVariations:C,allowedAutoPlacements:w}):n)},[]),B=t.rects.reference,E=t.rects.popper,k=new Map,D=!0,M=P[0],O=0;O<P.length;O++){var L=P[O],N=R(L),F=ee(L)===u,z=[i,o].indexOf(N)>=0,j=z?"width":"height",V=ve(t,{placement:L,boundary:b,rootBoundary:x,altBoundary:S,padding:v}),U=z?F?a:s:F?o:i
B[j]>E[j]&&(U=se(U))
var G=se(U),H=[]
if(p&&H.push(V[N]<=0),f&&H.push(V[U]<=0,V[G]<=0),H.every(function(e){return e})){M=L,D=!1
break}k.set(L,H)}if(D)for(var q=function(e){var t=P.find(function(t){var n=k.get(t)
if(n)return n.slice(0,e).every(function(e){return e})})
if(t)return M=t,"break"},Q=C?3:1;Q>0&&"break"!==q(Q);Q--);t.placement!==M&&(t.modifiersData[r]._skip=!0,t.placement=M,t.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}}
function xe(e,t,n){return void 0===n&&(n={x:0,y:0}),{top:e.top-t.height-n.y,right:e.right-t.width+n.x,bottom:e.bottom-t.height+n.y,left:e.left-t.width-n.x}}function Se(e){return[i,a,o,s].some(function(t){return e[t]>=0})}const _e={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(e){var t=e.state,n=e.name,r=t.rects.reference,i=t.rects.popper,o=t.modifiersData.preventOverflow,a=ve(t,{elementContext:"reference"}),s=ve(t,{altBoundary:!0}),l=xe(a,r),c=xe(s,i,o),u=Se(l),d=Se(c)
t.modifiersData[n]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:u,hasPopperEscaped:d},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":u,"data-popper-escaped":d})}},Ce={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(e){var t=e.state,n=e.options,r=e.name,o=n.offset,l=void 0===o?[0,0]:o,c=y.reduce(function(e,n){return e[n]=function(e,t,n){var r=R(e),o=[s,i].indexOf(r)>=0?-1:1,l="function"==typeof n?n(Object.assign({},t,{placement:e})):n,c=l[0],u=l[1]
return c=c||0,u=(u||0)*o,[s,a].indexOf(r)>=0?{x:u,y:c}:{x:c,y:u}}(n,t.rects,l),e},{}),u=c[t.placement],d=u.x,p=u.y
null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=d,t.modifiersData.popperOffsets.y+=p),t.modifiersData[r]=c}},we={name:"popperOffsets",enabled:!0,phase:"read",fn:function(e){var t=e.state,n=e.name
t.modifiersData[n]=ye({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})},data:{}},Te={name:"preventOverflow",enabled:!0,phase:"main",fn:function(e){var t=e.state,n=e.options,r=e.name,l=n.mainAxis,c=void 0===l||l,d=n.altAxis,p=void 0!==d&&d,h=n.boundary,f=n.rootBoundary,m=n.altBoundary,g=n.padding,y=n.tether,v=void 0===y||y,b=n.tetherOffset,x=void 0===b?0:b,S=ve(t,{boundary:h,rootBoundary:f,padding:g,altBoundary:m}),_=R(t.placement),C=ee(t.placement),w=!C,T=W(_),A="x"===T?"y":"x",I=t.modifiersData.popperOffsets,P=t.rects.reference,B=t.rects.popper,E="function"==typeof x?x(Object.assign({},t.rects,{placement:t.placement})):x,k="number"==typeof E?{mainAxis:E,altAxis:E}:Object.assign({mainAxis:0,altAxis:0},E),D=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,M={x:0,y:0}
if(I){if(c){var N,F="y"===T?i:s,z="y"===T?o:a,j="y"===T?"height":"width",U=I[T],G=U+S[F],H=U-S[z],q=v?-B[j]/2:0,Q=C===u?P[j]:B[j],$=C===u?-B[j]:-P[j],Z=t.elements.arrow,K=v&&Z?V(Z):{width:0,height:0},J=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},te=J[F],ne=J[z],re=Y(0,P[j],K[j]),ie=w?P[j]/2-q-re-te-k.mainAxis:Q-re-te-k.mainAxis,oe=w?-P[j]/2+q+re+ne+k.mainAxis:$+re+ne+k.mainAxis,ae=t.elements.arrow&&X(t.elements.arrow),se=ae?"y"===T?ae.clientTop||0:ae.clientLeft||0:0,le=null!=(N=null==D?void 0:D[T])?N:0,ce=U+oe-le,ue=Y(v?L(G,U+ie-le-se):G,U,v?O(H,ce):H)
I[T]=ue,M[T]=ue-U}if(p){var de,pe="x"===T?i:s,he="x"===T?o:a,fe=I[A],me="y"===A?"height":"width",ge=fe+S[pe],ye=fe-S[he],be=-1!==[i,s].indexOf(_),xe=null!=(de=null==D?void 0:D[A])?de:0,Se=be?ge:fe-P[me]-B[me]-xe+k.altAxis,_e=be?fe+P[me]+B[me]-xe-k.altAxis:ye,Ce=v&&be?function(e,t,n){var r=Y(e,t,n)
return r>n?n:r}(Se,fe,_e):Y(v?Se:ge,fe,v?_e:ye)
I[A]=Ce,M[A]=Ce-fe}t.modifiersData[r]=M}},requiresIfExists:["offset"]}
function Ae(e,t,n){void 0===n&&(n=!1)
var r,i,o=k(t),a=k(t)&&function(e){var t=e.getBoundingClientRect(),n=N(t.width)/e.offsetWidth||1,r=N(t.height)/e.offsetHeight||1
return 1!==n||1!==r}(t),s=q(t),l=j(e,a,n),c={scrollLeft:0,scrollTop:0},u={x:0,y:0}
return(o||!o&&!n)&&(("body"!==P(t)||pe(s))&&(c=(r=t)!==B(r)&&k(r)?{scrollLeft:(i=r).scrollLeft,scrollTop:i.scrollTop}:ue(r)),k(t)?((u=j(t,!0)).x+=t.clientLeft,u.y+=t.clientTop):s&&(u.x=de(s))),{x:l.left+c.scrollLeft-u.x,y:l.top+c.scrollTop-u.y,width:l.width,height:l.height}}function Ie(e){var t=new Map,n=new Set,r=[]
function i(e){n.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach(function(e){if(!n.has(e)){var r=t.get(e)
r&&i(r)}}),r.push(e)}return e.forEach(function(e){t.set(e.name,e)}),e.forEach(function(e){n.has(e.name)||i(e)}),r}var Pe={placement:"bottom",modifiers:[],strategy:"absolute"}
function Be(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n]
return!t.some(function(e){return!(e&&"function"==typeof e.getBoundingClientRect)})}function Ee(e){void 0===e&&(e={})
var t=e,n=t.defaultModifiers,r=void 0===n?[]:n,i=t.defaultOptions,o=void 0===i?Pe:i
return function(e,t,n){void 0===n&&(n=o)
var i,a,s={placement:"bottom",orderedModifiers:[],options:Object.assign({},Pe,o),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},l=[],c=!1,u={state:s,setOptions:function(n){var i="function"==typeof n?n(s.options):n
d(),s.options=Object.assign({},o,s.options,i),s.scrollParents={reference:E(e)?fe(e):e.contextElement?fe(e.contextElement):[],popper:fe(t)}
var a,c,p=function(e){var t=Ie(e)
return I.reduce(function(e,n){return e.concat(t.filter(function(e){return e.phase===n}))},[])}((a=[].concat(r,s.options.modifiers),c=a.reduce(function(e,t){var n=e[t.name]
return e[t.name]=n?Object.assign({},n,t,{options:Object.assign({},n.options,t.options),data:Object.assign({},n.data,t.data)}):t,e},{}),Object.keys(c).map(function(e){return c[e]})))
return s.orderedModifiers=p.filter(function(e){return e.enabled}),s.orderedModifiers.forEach(function(e){var t=e.name,n=e.options,r=void 0===n?{}:n,i=e.effect
if("function"==typeof i){var o=i({state:s,name:t,instance:u,options:r})
l.push(o||function(){})}}),u.update()},forceUpdate:function(){if(!c){var e=s.elements,t=e.reference,n=e.popper
if(Be(t,n)){s.rects={reference:Ae(t,X(n),"fixed"===s.options.strategy),popper:V(n)},s.reset=!1,s.placement=s.options.placement,s.orderedModifiers.forEach(function(e){return s.modifiersData[e.name]=Object.assign({},e.data)})
for(var r=0;r<s.orderedModifiers.length;r++)if(!0!==s.reset){var i=s.orderedModifiers[r],o=i.fn,a=i.options,l=void 0===a?{}:a,d=i.name
"function"==typeof o&&(s=o({state:s,options:l,name:d,instance:u})||s)}else s.reset=!1,r=-1}}},update:(i=function(){return new Promise(function(e){u.forceUpdate(),e(s)})},function(){return a||(a=new Promise(function(e){Promise.resolve().then(function(){a=void 0,e(i())})})),a}),destroy:function(){d(),c=!0}}
if(!Be(e,t))return u
function d(){l.forEach(function(e){return e()}),l=[]}return u.setOptions(n).then(function(e){!c&&n.onFirstUpdate&&n.onFirstUpdate(e)}),u}}var ke=Ee(),De=Ee({defaultModifiers:[oe,we,re,M,Ce,be,Te,J,_e]}),Me=Ee({defaultModifiers:[oe,we,re,M]})
const Re=new Map,Oe={set(e,t,n){Re.has(e)||Re.set(e,new Map)
const r=Re.get(e)
r.has(t)||0===r.size?r.set(t,n):console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(r.keys())[0]}.`)},get:(e,t)=>Re.has(e)&&Re.get(e).get(t)||null,remove(e,t){if(!Re.has(e))return
const n=Re.get(e)
n.delete(t),0===n.size&&Re.delete(e)}},Le="transitionend",Ne=e=>(e&&window.CSS&&window.CSS.escape&&(e=e.replace(/#([^\s"#']+)/g,(e,t)=>`#${CSS.escape(t)}`)),e),Fe=e=>null==e?`${e}`:Object.prototype.toString.call(e).match(/\s([a-z]+)/i)[1].toLowerCase(),ze=e=>{e.dispatchEvent(new Event(Le))},je=e=>!(!e||"object"!=typeof e)&&(void 0!==e.jquery&&(e=e[0]),void 0!==e.nodeType),Ve=e=>je(e)?e.jquery?e[0]:e:"string"==typeof e&&e.length>0?document.querySelector(Ne(e)):null,Ue=e=>{if(!je(e)||0===e.getClientRects().length)return!1
const t="visible"===getComputedStyle(e).getPropertyValue("visibility"),n=e.closest("details:not([open])")
if(!n)return t
if(n!==e){const t=e.closest("summary")
if(t&&t.parentNode!==n)return!1
if(null===t)return!1}return t},Ge=e=>!e||e.nodeType!==Node.ELEMENT_NODE||!!e.classList.contains("disabled")||(void 0!==e.disabled?e.disabled:e.hasAttribute("disabled")&&"false"!==e.getAttribute("disabled")),He=e=>{if(!document.documentElement.attachShadow)return null
if("function"==typeof e.getRootNode){const t=e.getRootNode()
return t instanceof ShadowRoot?t:null}return e instanceof ShadowRoot?e:e.parentNode?He(e.parentNode):null},qe=()=>{},Qe=e=>{e.offsetHeight},$e=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,Xe=[],We=()=>"rtl"===document.documentElement.dir,Ye=e=>{var t
t=()=>{const t=$e()
if(t){const n=e.NAME,r=t.fn[n]
t.fn[n]=e.jQueryInterface,t.fn[n].Constructor=e,t.fn[n].noConflict=()=>(t.fn[n]=r,e.jQueryInterface)}},"loading"===document.readyState?(Xe.length||document.addEventListener("DOMContentLoaded",()=>{for(const e of Xe)e()}),Xe.push(t)):t()},Ze=(e,t=[],n=e)=>"function"==typeof e?e.call(...t):n,Ke=(e,t,n=!0)=>{if(!n)return void Ze(e)
const r=(e=>{if(!e)return 0
let{transitionDuration:t,transitionDelay:n}=window.getComputedStyle(e)
const r=Number.parseFloat(t),i=Number.parseFloat(n)
return r||i?(t=t.split(",")[0],n=n.split(",")[0],1e3*(Number.parseFloat(t)+Number.parseFloat(n))):0})(t)+5
let i=!1
const o=({target:n})=>{n===t&&(i=!0,t.removeEventListener(Le,o),Ze(e))}
t.addEventListener(Le,o),setTimeout(()=>{i||ze(t)},r)},Je=(e,t,n,r)=>{const i=e.length
let o=e.indexOf(t)
return-1===o?!n&&r?e[i-1]:e[0]:(o+=n?1:-1,r&&(o=(o+i)%i),e[Math.max(0,Math.min(o,i-1))])},et=/[^.]*(?=\..*)\.|.*/,tt=/\..*/,nt=/::\d+$/,rt={}
let it=1
const ot={mouseenter:"mouseover",mouseleave:"mouseout"},at=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"])
function st(e,t){return t&&`${t}::${it++}`||e.uidEvent||it++}function lt(e){const t=st(e)
return e.uidEvent=t,rt[t]=rt[t]||{},rt[t]}function ct(e,t,n=null){return Object.values(e).find(e=>e.callable===t&&e.delegationSelector===n)}function ut(e,t,n){const r="string"==typeof t,i=r?n:t||n
let o=ft(e)
return at.has(o)||(o=e),[r,i,o]}function dt(e,t,n,r,i){if("string"!=typeof t||!e)return
let[o,a,s]=ut(t,n,r)
if(t in ot){const e=e=>function(t){if(!t.relatedTarget||t.relatedTarget!==t.delegateTarget&&!t.delegateTarget.contains(t.relatedTarget))return e.call(this,t)}
a=e(a)}const l=lt(e),c=l[s]||(l[s]={}),u=ct(c,a,o?n:null)
if(u)return void(u.oneOff=u.oneOff&&i)
const d=st(a,t.replace(et,"")),p=o?function(e,t,n){return function r(i){const o=e.querySelectorAll(t)
for(let{target:a}=i;a&&a!==this;a=a.parentNode)for(const s of o)if(s===a)return gt(i,{delegateTarget:a}),r.oneOff&&mt.off(e,i.type,t,n),n.apply(a,[i])}}(e,n,a):function(e,t){return function n(r){return gt(r,{delegateTarget:e}),n.oneOff&&mt.off(e,r.type,t),t.apply(e,[r])}}(e,a)
p.delegationSelector=o?n:null,p.callable=a,p.oneOff=i,p.uidEvent=d,c[d]=p,e.addEventListener(s,p,o)}function pt(e,t,n,r,i){const o=ct(t[n],r,i)
o&&(e.removeEventListener(n,o,Boolean(i)),delete t[n][o.uidEvent])}function ht(e,t,n,r){const i=t[n]||{}
for(const[o,a]of Object.entries(i))o.includes(r)&&pt(e,t,n,a.callable,a.delegationSelector)}function ft(e){return e=e.replace(tt,""),ot[e]||e}const mt={on(e,t,n,r){dt(e,t,n,r,!1)},one(e,t,n,r){dt(e,t,n,r,!0)},off(e,t,n,r){if("string"!=typeof t||!e)return
const[i,o,a]=ut(t,n,r),s=a!==t,l=lt(e),c=l[a]||{},u=t.startsWith(".")
if(void 0===o){if(u)for(const n of Object.keys(l))ht(e,l,n,t.slice(1))
for(const[n,r]of Object.entries(c)){const i=n.replace(nt,"")
s&&!t.includes(i)||pt(e,l,a,r.callable,r.delegationSelector)}}else{if(!Object.keys(c).length)return
pt(e,l,a,o,i?n:null)}},trigger(e,t,n){if("string"!=typeof t||!e)return null
const r=$e()
let i=null,o=!0,a=!0,s=!1
t!==ft(t)&&r&&(i=r.Event(t,n),r(e).trigger(i),o=!i.isPropagationStopped(),a=!i.isImmediatePropagationStopped(),s=i.isDefaultPrevented())
const l=gt(new Event(t,{bubbles:o,cancelable:!0}),n)
return s&&l.preventDefault(),a&&e.dispatchEvent(l),l.defaultPrevented&&i&&i.preventDefault(),l}}
function gt(e,t={}){for(const[n,r]of Object.entries(t))try{e[n]=r}catch(t){Object.defineProperty(e,n,{configurable:!0,get:()=>r})}return e}function yt(e){if("true"===e)return!0
if("false"===e)return!1
if(e===Number(e).toString())return Number(e)
if(""===e||"null"===e)return null
if("string"!=typeof e)return e
try{return JSON.parse(decodeURIComponent(e))}catch(t){return e}}function vt(e){return e.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`)}const bt={setDataAttribute(e,t,n){e.setAttribute(`data-bs-${vt(t)}`,n)},removeDataAttribute(e,t){e.removeAttribute(`data-bs-${vt(t)}`)},getDataAttributes(e){if(!e)return{}
const t={},n=Object.keys(e.dataset).filter(e=>e.startsWith("bs")&&!e.startsWith("bsConfig"))
for(const r of n){let n=r.replace(/^bs/,"")
n=n.charAt(0).toLowerCase()+n.slice(1),t[n]=yt(e.dataset[r])}return t},getDataAttribute:(e,t)=>yt(e.getAttribute(`data-bs-${vt(t)}`))}
class xt{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(e){return e=this._mergeConfigObj(e),e=this._configAfterMerge(e),this._typeCheckConfig(e),e}_configAfterMerge(e){return e}_mergeConfigObj(e,t){const n=je(t)?bt.getDataAttribute(t,"config"):{}
return{...this.constructor.Default,..."object"==typeof n?n:{},...je(t)?bt.getDataAttributes(t):{},..."object"==typeof e?e:{}}}_typeCheckConfig(e,t=this.constructor.DefaultType){for(const[n,r]of Object.entries(t)){const t=e[n],i=je(t)?"element":Fe(t)
if(!new RegExp(r).test(i))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${n}" provided type "${i}" but expected type "${r}".`)}}}class St extends xt{constructor(e,t){super(),(e=Ve(e))&&(this._element=e,this._config=this._getConfig(t),Oe.set(this._element,this.constructor.DATA_KEY,this))}dispose(){Oe.remove(this._element,this.constructor.DATA_KEY),mt.off(this._element,this.constructor.EVENT_KEY)
for(const e of Object.getOwnPropertyNames(this))this[e]=null}_queueCallback(e,t,n=!0){Ke(e,t,n)}_getConfig(e){return e=this._mergeConfigObj(e,this._element),e=this._configAfterMerge(e),this._typeCheckConfig(e),e}static getInstance(e){return Oe.get(Ve(e),this.DATA_KEY)}static getOrCreateInstance(e,t={}){return this.getInstance(e)||new this(e,"object"==typeof t?t:null)}static get VERSION(){return"5.3.8"}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(e){return`${e}${this.EVENT_KEY}`}}const _t=e=>{let t=e.getAttribute("data-bs-target")
if(!t||"#"===t){let n=e.getAttribute("href")
if(!n||!n.includes("#")&&!n.startsWith("."))return null
n.includes("#")&&!n.startsWith("#")&&(n=`#${n.split("#")[1]}`),t=n&&"#"!==n?n.trim():null}return t?t.split(",").map(e=>Ne(e)).join(","):null},Ct={find:(e,t=document.documentElement)=>[].concat(...Element.prototype.querySelectorAll.call(t,e)),findOne:(e,t=document.documentElement)=>Element.prototype.querySelector.call(t,e),children:(e,t)=>[].concat(...e.children).filter(e=>e.matches(t)),parents(e,t){const n=[]
let r=e.parentNode.closest(t)
for(;r;)n.push(r),r=r.parentNode.closest(t)
return n},prev(e,t){let n=e.previousElementSibling
for(;n;){if(n.matches(t))return[n]
n=n.previousElementSibling}return[]},next(e,t){let n=e.nextElementSibling
for(;n;){if(n.matches(t))return[n]
n=n.nextElementSibling}return[]},focusableChildren(e){const t=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(e=>`${e}:not([tabindex^="-"])`).join(",")
return this.find(t,e).filter(e=>!Ge(e)&&Ue(e))},getSelectorFromElement(e){const t=_t(e)
return t&&Ct.findOne(t)?t:null},getElementFromSelector(e){const t=_t(e)
return t?Ct.findOne(t):null},getMultipleElementsFromSelector(e){const t=_t(e)
return t?Ct.find(t):[]}},wt=(e,t="hide")=>{const n=`click.dismiss${e.EVENT_KEY}`,r=e.NAME
mt.on(document,n,`[data-bs-dismiss="${r}"]`,function(n){if(["A","AREA"].includes(this.tagName)&&n.preventDefault(),Ge(this))return
const i=Ct.getElementFromSelector(this)||this.closest(`.${r}`)
e.getOrCreateInstance(i)[t]()})},Tt=".bs.alert",At=`close${Tt}`,It=`closed${Tt}`
class Pt extends St{static get NAME(){return"alert"}close(){if(mt.trigger(this._element,At).defaultPrevented)return
this._element.classList.remove("show")
const e=this._element.classList.contains("fade")
this._queueCallback(()=>this._destroyElement(),this._element,e)}_destroyElement(){this._element.remove(),mt.trigger(this._element,It),this.dispose()}static jQueryInterface(e){return this.each(function(){const t=Pt.getOrCreateInstance(this)
if("string"==typeof e){if(void 0===t[e]||e.startsWith("_")||"constructor"===e)throw new TypeError(`No method named "${e}"`)
t[e](this)}})}}wt(Pt,"close"),Ye(Pt)
const Bt='[data-bs-toggle="button"]'
class Et extends St{static get NAME(){return"button"}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle("active"))}static jQueryInterface(e){return this.each(function(){const t=Et.getOrCreateInstance(this)
"toggle"===e&&t[e]()})}}mt.on(document,"click.bs.button.data-api",Bt,e=>{e.preventDefault()
const t=e.target.closest(Bt)
Et.getOrCreateInstance(t).toggle()}),Ye(Et)
const kt=".bs.swipe",Dt=`touchstart${kt}`,Mt=`touchmove${kt}`,Rt=`touchend${kt}`,Ot=`pointerdown${kt}`,Lt=`pointerup${kt}`,Nt={endCallback:null,leftCallback:null,rightCallback:null},Ft={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"}
class zt extends xt{constructor(e,t){super(),this._element=e,e&&zt.isSupported()&&(this._config=this._getConfig(t),this._deltaX=0,this._supportPointerEvents=Boolean(window.PointerEvent),this._initEvents())}static get Default(){return Nt}static get DefaultType(){return Ft}static get NAME(){return"swipe"}dispose(){mt.off(this._element,kt)}_start(e){this._supportPointerEvents?this._eventIsPointerPenTouch(e)&&(this._deltaX=e.clientX):this._deltaX=e.touches[0].clientX}_end(e){this._eventIsPointerPenTouch(e)&&(this._deltaX=e.clientX-this._deltaX),this._handleSwipe(),Ze(this._config.endCallback)}_move(e){this._deltaX=e.touches&&e.touches.length>1?0:e.touches[0].clientX-this._deltaX}_handleSwipe(){const e=Math.abs(this._deltaX)
if(e<=40)return
const t=e/this._deltaX
this._deltaX=0,t&&Ze(t>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(mt.on(this._element,Ot,e=>this._start(e)),mt.on(this._element,Lt,e=>this._end(e)),this._element.classList.add("pointer-event")):(mt.on(this._element,Dt,e=>this._start(e)),mt.on(this._element,Mt,e=>this._move(e)),mt.on(this._element,Rt,e=>this._end(e)))}_eventIsPointerPenTouch(e){return this._supportPointerEvents&&("pen"===e.pointerType||"touch"===e.pointerType)}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const jt=".bs.carousel",Vt=".data-api",Ut="ArrowLeft",Gt="ArrowRight",Ht="next",qt="prev",Qt="left",$t="right",Xt=`slide${jt}`,Wt=`slid${jt}`,Yt=`keydown${jt}`,Zt=`mouseenter${jt}`,Kt=`mouseleave${jt}`,Jt=`dragstart${jt}`,en=`load${jt}${Vt}`,tn=`click${jt}${Vt}`,nn="carousel",rn="active",on=".active",an=".carousel-item",sn=on+an,ln={[Ut]:$t,[Gt]:Qt},cn={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},un={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"}
class dn extends St{constructor(e,t){super(e,t),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=Ct.findOne(".carousel-indicators",this._element),this._addEventListeners(),this._config.ride===nn&&this.cycle()}static get Default(){return cn}static get DefaultType(){return un}static get NAME(){return"carousel"}next(){this._slide(Ht)}nextWhenVisible(){!document.hidden&&Ue(this._element)&&this.next()}prev(){this._slide(qt)}pause(){this._isSliding&&ze(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){this._config.ride&&(this._isSliding?mt.one(this._element,Wt,()=>this.cycle()):this.cycle())}to(e){const t=this._getItems()
if(e>t.length-1||e<0)return
if(this._isSliding)return void mt.one(this._element,Wt,()=>this.to(e))
const n=this._getItemIndex(this._getActive())
if(n===e)return
const r=e>n?Ht:qt
this._slide(r,t[e])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(e){return e.defaultInterval=e.interval,e}_addEventListeners(){this._config.keyboard&&mt.on(this._element,Yt,e=>this._keydown(e)),"hover"===this._config.pause&&(mt.on(this._element,Zt,()=>this.pause()),mt.on(this._element,Kt,()=>this._maybeEnableCycle())),this._config.touch&&zt.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const t of Ct.find(".carousel-item img",this._element))mt.on(t,Jt,e=>e.preventDefault())
const e={leftCallback:()=>this._slide(this._directionToOrder(Qt)),rightCallback:()=>this._slide(this._directionToOrder($t)),endCallback:()=>{"hover"===this._config.pause&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),500+this._config.interval))}}
this._swipeHelper=new zt(this._element,e)}_keydown(e){if(/input|textarea/i.test(e.target.tagName))return
const t=ln[e.key]
t&&(e.preventDefault(),this._slide(this._directionToOrder(t)))}_getItemIndex(e){return this._getItems().indexOf(e)}_setActiveIndicatorElement(e){if(!this._indicatorsElement)return
const t=Ct.findOne(on,this._indicatorsElement)
t.classList.remove(rn),t.removeAttribute("aria-current")
const n=Ct.findOne(`[data-bs-slide-to="${e}"]`,this._indicatorsElement)
n&&(n.classList.add(rn),n.setAttribute("aria-current","true"))}_updateInterval(){const e=this._activeElement||this._getActive()
if(!e)return
const t=Number.parseInt(e.getAttribute("data-bs-interval"),10)
this._config.interval=t||this._config.defaultInterval}_slide(e,t=null){if(this._isSliding)return
const n=this._getActive(),r=e===Ht,i=t||Je(this._getItems(),n,r,this._config.wrap)
if(i===n)return
const o=this._getItemIndex(i),a=t=>mt.trigger(this._element,t,{relatedTarget:i,direction:this._orderToDirection(e),from:this._getItemIndex(n),to:o})
if(a(Xt).defaultPrevented)return
if(!n||!i)return
const s=Boolean(this._interval)
this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(o),this._activeElement=i
const l=r?"carousel-item-start":"carousel-item-end",c=r?"carousel-item-next":"carousel-item-prev"
i.classList.add(c),Qe(i),n.classList.add(l),i.classList.add(l),this._queueCallback(()=>{i.classList.remove(l,c),i.classList.add(rn),n.classList.remove(rn,c,l),this._isSliding=!1,a(Wt)},n,this._isAnimated()),s&&this.cycle()}_isAnimated(){return this._element.classList.contains("slide")}_getActive(){return Ct.findOne(sn,this._element)}_getItems(){return Ct.find(an,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(e){return We()?e===Qt?qt:Ht:e===Qt?Ht:qt}_orderToDirection(e){return We()?e===qt?Qt:$t:e===qt?$t:Qt}static jQueryInterface(e){return this.each(function(){const t=dn.getOrCreateInstance(this,e)
if("number"!=typeof e){if("string"==typeof e){if(void 0===t[e]||e.startsWith("_")||"constructor"===e)throw new TypeError(`No method named "${e}"`)
t[e]()}}else t.to(e)})}}mt.on(document,tn,"[data-bs-slide], [data-bs-slide-to]",function(e){const t=Ct.getElementFromSelector(this)
if(!t||!t.classList.contains(nn))return
e.preventDefault()
const n=dn.getOrCreateInstance(t),r=this.getAttribute("data-bs-slide-to")
return r?(n.to(r),void n._maybeEnableCycle()):"next"===bt.getDataAttribute(this,"slide")?(n.next(),void n._maybeEnableCycle()):(n.prev(),void n._maybeEnableCycle())}),mt.on(window,en,()=>{const e=Ct.find('[data-bs-ride="carousel"]')
for(const t of e)dn.getOrCreateInstance(t)}),Ye(dn)
const pn=".bs.collapse",hn=`show${pn}`,fn=`shown${pn}`,mn=`hide${pn}`,gn=`hidden${pn}`,yn=`click${pn}.data-api`,vn="show",bn="collapse",xn="collapsing",Sn=`:scope .${bn} .${bn}`,_n='[data-bs-toggle="collapse"]',Cn={parent:null,toggle:!0},wn={parent:"(null|element)",toggle:"boolean"}
class Tn extends St{constructor(e,t){super(e,t),this._isTransitioning=!1,this._triggerArray=[]
const n=Ct.find(_n)
for(const r of n){const e=Ct.getSelectorFromElement(r),t=Ct.find(e).filter(e=>e===this._element)
null!==e&&t.length&&this._triggerArray.push(r)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return Cn}static get DefaultType(){return wn}static get NAME(){return"collapse"}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return
let e=[]
if(this._config.parent&&(e=this._getFirstLevelChildren(".collapse.show, .collapse.collapsing").filter(e=>e!==this._element).map(e=>Tn.getOrCreateInstance(e,{toggle:!1}))),e.length&&e[0]._isTransitioning)return
if(mt.trigger(this._element,hn).defaultPrevented)return
for(const r of e)r.hide()
const t=this._getDimension()
this._element.classList.remove(bn),this._element.classList.add(xn),this._element.style[t]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0
const n=`scroll${t[0].toUpperCase()+t.slice(1)}`
this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(xn),this._element.classList.add(bn,vn),this._element.style[t]="",mt.trigger(this._element,fn)},this._element,!0),this._element.style[t]=`${this._element[n]}px`}hide(){if(this._isTransitioning||!this._isShown())return
if(mt.trigger(this._element,mn).defaultPrevented)return
const e=this._getDimension()
this._element.style[e]=`${this._element.getBoundingClientRect()[e]}px`,Qe(this._element),this._element.classList.add(xn),this._element.classList.remove(bn,vn)
for(const t of this._triggerArray){const e=Ct.getElementFromSelector(t)
e&&!this._isShown(e)&&this._addAriaAndCollapsedClass([t],!1)}this._isTransitioning=!0,this._element.style[e]="",this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(xn),this._element.classList.add(bn),mt.trigger(this._element,gn)},this._element,!0)}_isShown(e=this._element){return e.classList.contains(vn)}_configAfterMerge(e){return e.toggle=Boolean(e.toggle),e.parent=Ve(e.parent),e}_getDimension(){return this._element.classList.contains("collapse-horizontal")?"width":"height"}_initializeChildren(){if(!this._config.parent)return
const e=this._getFirstLevelChildren(_n)
for(const t of e){const e=Ct.getElementFromSelector(t)
e&&this._addAriaAndCollapsedClass([t],this._isShown(e))}}_getFirstLevelChildren(e){const t=Ct.find(Sn,this._config.parent)
return Ct.find(e,this._config.parent).filter(e=>!t.includes(e))}_addAriaAndCollapsedClass(e,t){if(e.length)for(const n of e)n.classList.toggle("collapsed",!t),n.setAttribute("aria-expanded",t)}static jQueryInterface(e){const t={}
return"string"==typeof e&&/show|hide/.test(e)&&(t.toggle=!1),this.each(function(){const n=Tn.getOrCreateInstance(this,t)
if("string"==typeof e){if(void 0===n[e])throw new TypeError(`No method named "${e}"`)
n[e]()}})}}mt.on(document,yn,_n,function(e){("A"===e.target.tagName||e.delegateTarget&&"A"===e.delegateTarget.tagName)&&e.preventDefault()
for(const t of Ct.getMultipleElementsFromSelector(this))Tn.getOrCreateInstance(t,{toggle:!1}).toggle()}),Ye(Tn)
const An="dropdown",In=".bs.dropdown",Pn=".data-api",Bn="ArrowUp",En="ArrowDown",kn=`hide${In}`,Dn=`hidden${In}`,Mn=`show${In}`,Rn=`shown${In}`,On=`click${In}${Pn}`,Ln=`keydown${In}${Pn}`,Nn=`keyup${In}${Pn}`,Fn="show",zn='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',jn=`${zn}.${Fn}`,Vn=".dropdown-menu",Un=We()?"top-end":"top-start",Gn=We()?"top-start":"top-end",Hn=We()?"bottom-end":"bottom-start",qn=We()?"bottom-start":"bottom-end",Qn=We()?"left-start":"right-start",$n=We()?"right-start":"left-start",Xn={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},Wn={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"}
class Yn extends St{constructor(e,t){super(e,t),this._popper=null,this._parent=this._element.parentNode,this._menu=Ct.next(this._element,Vn)[0]||Ct.prev(this._element,Vn)[0]||Ct.findOne(Vn,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return Xn}static get DefaultType(){return Wn}static get NAME(){return An}toggle(){return this._isShown()?this.hide():this.show()}show(){if(Ge(this._element)||this._isShown())return
const e={relatedTarget:this._element}
if(!mt.trigger(this._element,Mn,e).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(".navbar-nav"))for(const e of[].concat(...document.body.children))mt.on(e,"mouseover",qe)
this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(Fn),this._element.classList.add(Fn),mt.trigger(this._element,Rn,e)}}hide(){if(Ge(this._element)||!this._isShown())return
const e={relatedTarget:this._element}
this._completeHide(e)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(e){if(!mt.trigger(this._element,kn,e).defaultPrevented){if("ontouchstart"in document.documentElement)for(const e of[].concat(...document.body.children))mt.off(e,"mouseover",qe)
this._popper&&this._popper.destroy(),this._menu.classList.remove(Fn),this._element.classList.remove(Fn),this._element.setAttribute("aria-expanded","false"),bt.removeDataAttribute(this._menu,"popper"),mt.trigger(this._element,Dn,e)}}_getConfig(e){if("object"==typeof(e=super._getConfig(e)).reference&&!je(e.reference)&&"function"!=typeof e.reference.getBoundingClientRect)throw new TypeError(`${An.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`)
return e}_createPopper(){let e=this._element
"parent"===this._config.reference?e=this._parent:je(this._config.reference)?e=Ve(this._config.reference):"object"==typeof this._config.reference&&(e=this._config.reference)
const t=this._getPopperConfig()
this._popper=De(e,this._menu,t)}_isShown(){return this._menu.classList.contains(Fn)}_getPlacement(){const e=this._parent
if(e.classList.contains("dropend"))return Qn
if(e.classList.contains("dropstart"))return $n
if(e.classList.contains("dropup-center"))return"top"
if(e.classList.contains("dropdown-center"))return"bottom"
const t="end"===getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()
return e.classList.contains("dropup")?t?Gn:Un:t?qn:Hn}_detectNavbar(){return null!==this._element.closest(".navbar")}_getOffset(){const{offset:e}=this._config
return"string"==typeof e?e.split(",").map(e=>Number.parseInt(e,10)):"function"==typeof e?t=>e(t,this._element):e}_getPopperConfig(){const e={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]}
return(this._inNavbar||"static"===this._config.display)&&(bt.setDataAttribute(this._menu,"popper","static"),e.modifiers=[{name:"applyStyles",enabled:!1}]),{...e,...Ze(this._config.popperConfig,[void 0,e])}}_selectMenuItem({key:e,target:t}){const n=Ct.find(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",this._menu).filter(e=>Ue(e))
n.length&&Je(n,t,e===En,!n.includes(t)).focus()}static jQueryInterface(e){return this.each(function(){const t=Yn.getOrCreateInstance(this,e)
if("string"==typeof e){if(void 0===t[e])throw new TypeError(`No method named "${e}"`)
t[e]()}})}static clearMenus(e){if(2===e.button||"keyup"===e.type&&"Tab"!==e.key)return
const t=Ct.find(jn)
for(const n of t){const t=Yn.getInstance(n)
if(!t||!1===t._config.autoClose)continue
const r=e.composedPath(),i=r.includes(t._menu)
if(r.includes(t._element)||"inside"===t._config.autoClose&&!i||"outside"===t._config.autoClose&&i)continue
if(t._menu.contains(e.target)&&("keyup"===e.type&&"Tab"===e.key||/input|select|option|textarea|form/i.test(e.target.tagName)))continue
const o={relatedTarget:t._element}
"click"===e.type&&(o.clickEvent=e),t._completeHide(o)}}static dataApiKeydownHandler(e){const t=/input|textarea/i.test(e.target.tagName),n="Escape"===e.key,r=[Bn,En].includes(e.key)
if(!r&&!n)return
if(t&&!n)return
e.preventDefault()
const i=this.matches(zn)?this:Ct.prev(this,zn)[0]||Ct.next(this,zn)[0]||Ct.findOne(zn,e.delegateTarget.parentNode),o=Yn.getOrCreateInstance(i)
if(r)return e.stopPropagation(),o.show(),void o._selectMenuItem(e)
o._isShown()&&(e.stopPropagation(),o.hide(),i.focus())}}mt.on(document,Ln,zn,Yn.dataApiKeydownHandler),mt.on(document,Ln,Vn,Yn.dataApiKeydownHandler),mt.on(document,On,Yn.clearMenus),mt.on(document,Nn,Yn.clearMenus),mt.on(document,On,zn,function(e){e.preventDefault(),Yn.getOrCreateInstance(this).toggle()}),Ye(Yn)
const Zn="backdrop",Kn="show",Jn=`mousedown.bs.${Zn}`,er={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},tr={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"}
class nr extends xt{constructor(e){super(),this._config=this._getConfig(e),this._isAppended=!1,this._element=null}static get Default(){return er}static get DefaultType(){return tr}static get NAME(){return Zn}show(e){if(!this._config.isVisible)return void Ze(e)
this._append()
const t=this._getElement()
this._config.isAnimated&&Qe(t),t.classList.add(Kn),this._emulateAnimation(()=>{Ze(e)})}hide(e){this._config.isVisible?(this._getElement().classList.remove(Kn),this._emulateAnimation(()=>{this.dispose(),Ze(e)})):Ze(e)}dispose(){this._isAppended&&(mt.off(this._element,Jn),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const e=document.createElement("div")
e.className=this._config.className,this._config.isAnimated&&e.classList.add("fade"),this._element=e}return this._element}_configAfterMerge(e){return e.rootElement=Ve(e.rootElement),e}_append(){if(this._isAppended)return
const e=this._getElement()
this._config.rootElement.append(e),mt.on(e,Jn,()=>{Ze(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(e){Ke(e,this._getElement(),this._config.isAnimated)}}const rr=".bs.focustrap",ir=`focusin${rr}`,or=`keydown.tab${rr}`,ar="backward",sr={autofocus:!0,trapElement:null},lr={autofocus:"boolean",trapElement:"element"}
class cr extends xt{constructor(e){super(),this._config=this._getConfig(e),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return sr}static get DefaultType(){return lr}static get NAME(){return"focustrap"}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),mt.off(document,rr),mt.on(document,ir,e=>this._handleFocusin(e)),mt.on(document,or,e=>this._handleKeydown(e)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,mt.off(document,rr))}_handleFocusin(e){const{trapElement:t}=this._config
if(e.target===document||e.target===t||t.contains(e.target))return
const n=Ct.focusableChildren(t)
0===n.length?t.focus():this._lastTabNavDirection===ar?n[n.length-1].focus():n[0].focus()}_handleKeydown(e){"Tab"===e.key&&(this._lastTabNavDirection=e.shiftKey?ar:"forward")}}const ur=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",dr=".sticky-top",pr="padding-right",hr="margin-right"
class fr{constructor(){this._element=document.body}getWidth(){const e=document.documentElement.clientWidth
return Math.abs(window.innerWidth-e)}hide(){const e=this.getWidth()
this._disableOverFlow(),this._setElementAttributes(this._element,pr,t=>t+e),this._setElementAttributes(ur,pr,t=>t+e),this._setElementAttributes(dr,hr,t=>t-e)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,pr),this._resetElementAttributes(ur,pr),this._resetElementAttributes(dr,hr)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(e,t,n){const r=this.getWidth()
this._applyManipulationCallback(e,e=>{if(e!==this._element&&window.innerWidth>e.clientWidth+r)return
this._saveInitialAttribute(e,t)
const i=window.getComputedStyle(e).getPropertyValue(t)
e.style.setProperty(t,`${n(Number.parseFloat(i))}px`)})}_saveInitialAttribute(e,t){const n=e.style.getPropertyValue(t)
n&&bt.setDataAttribute(e,t,n)}_resetElementAttributes(e,t){this._applyManipulationCallback(e,e=>{const n=bt.getDataAttribute(e,t)
null!==n?(bt.removeDataAttribute(e,t),e.style.setProperty(t,n)):e.style.removeProperty(t)})}_applyManipulationCallback(e,t){if(je(e))t(e)
else for(const n of Ct.find(e,this._element))t(n)}}const mr=".bs.modal",gr=`hide${mr}`,yr=`hidePrevented${mr}`,vr=`hidden${mr}`,br=`show${mr}`,xr=`shown${mr}`,Sr=`resize${mr}`,_r=`click.dismiss${mr}`,Cr=`mousedown.dismiss${mr}`,wr=`keydown.dismiss${mr}`,Tr=`click${mr}.data-api`,Ar="modal-open",Ir="show",Pr="modal-static",Br={backdrop:!0,focus:!0,keyboard:!0},Er={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"}
class kr extends St{constructor(e,t){super(e,t),this._dialog=Ct.findOne(".modal-dialog",this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new fr,this._addEventListeners()}static get Default(){return Br}static get DefaultType(){return Er}static get NAME(){return"modal"}toggle(e){return this._isShown?this.hide():this.show(e)}show(e){this._isShown||this._isTransitioning||mt.trigger(this._element,br,{relatedTarget:e}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(Ar),this._adjustDialog(),this._backdrop.show(()=>this._showElement(e)))}hide(){this._isShown&&!this._isTransitioning&&(mt.trigger(this._element,gr).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(Ir),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated())))}dispose(){mt.off(window,mr),mt.off(this._dialog,mr),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new nr({isVisible:Boolean(this._config.backdrop),isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new cr({trapElement:this._element})}_showElement(e){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0
const t=Ct.findOne(".modal-body",this._dialog)
t&&(t.scrollTop=0),Qe(this._element),this._element.classList.add(Ir),this._queueCallback(()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,mt.trigger(this._element,xr,{relatedTarget:e})},this._dialog,this._isAnimated())}_addEventListeners(){mt.on(this._element,wr,e=>{"Escape"===e.key&&(this._config.keyboard?this.hide():this._triggerBackdropTransition())}),mt.on(window,Sr,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),mt.on(this._element,Cr,e=>{mt.one(this._element,_r,t=>{this._element===e.target&&this._element===t.target&&("static"!==this._config.backdrop?this._config.backdrop&&this.hide():this._triggerBackdropTransition())})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(Ar),this._resetAdjustments(),this._scrollBar.reset(),mt.trigger(this._element,vr)})}_isAnimated(){return this._element.classList.contains("fade")}_triggerBackdropTransition(){if(mt.trigger(this._element,yr).defaultPrevented)return
const e=this._element.scrollHeight>document.documentElement.clientHeight,t=this._element.style.overflowY
"hidden"===t||this._element.classList.contains(Pr)||(e||(this._element.style.overflowY="hidden"),this._element.classList.add(Pr),this._queueCallback(()=>{this._element.classList.remove(Pr),this._queueCallback(()=>{this._element.style.overflowY=t},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const e=this._element.scrollHeight>document.documentElement.clientHeight,t=this._scrollBar.getWidth(),n=t>0
if(n&&!e){const e=We()?"paddingLeft":"paddingRight"
this._element.style[e]=`${t}px`}if(!n&&e){const e=We()?"paddingRight":"paddingLeft"
this._element.style[e]=`${t}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(e,t){return this.each(function(){const n=kr.getOrCreateInstance(this,e)
if("string"==typeof e){if(void 0===n[e])throw new TypeError(`No method named "${e}"`)
n[e](t)}})}}mt.on(document,Tr,'[data-bs-toggle="modal"]',function(e){const t=Ct.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&e.preventDefault(),mt.one(t,br,e=>{e.defaultPrevented||mt.one(t,vr,()=>{Ue(this)&&this.focus()})})
const n=Ct.findOne(".modal.show")
n&&kr.getInstance(n).hide(),kr.getOrCreateInstance(t).toggle(this)}),wt(kr),Ye(kr)
const Dr=".bs.offcanvas",Mr=".data-api",Rr=`load${Dr}${Mr}`,Or="show",Lr="showing",Nr="hiding",Fr=".offcanvas.show",zr=`show${Dr}`,jr=`shown${Dr}`,Vr=`hide${Dr}`,Ur=`hidePrevented${Dr}`,Gr=`hidden${Dr}`,Hr=`resize${Dr}`,qr=`click${Dr}${Mr}`,Qr=`keydown.dismiss${Dr}`,$r={backdrop:!0,keyboard:!0,scroll:!1},Xr={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"}
class Wr extends St{constructor(e,t){super(e,t),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return $r}static get DefaultType(){return Xr}static get NAME(){return"offcanvas"}toggle(e){return this._isShown?this.hide():this.show(e)}show(e){this._isShown||mt.trigger(this._element,zr,{relatedTarget:e}).defaultPrevented||(this._isShown=!0,this._backdrop.show(),this._config.scroll||(new fr).hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(Lr),this._queueCallback(()=>{this._config.scroll&&!this._config.backdrop||this._focustrap.activate(),this._element.classList.add(Or),this._element.classList.remove(Lr),mt.trigger(this._element,jr,{relatedTarget:e})},this._element,!0))}hide(){this._isShown&&(mt.trigger(this._element,Vr).defaultPrevented||(this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(Nr),this._backdrop.hide(),this._queueCallback(()=>{this._element.classList.remove(Or,Nr),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||(new fr).reset(),mt.trigger(this._element,Gr)},this._element,!0)))}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const e=Boolean(this._config.backdrop)
return new nr({className:"offcanvas-backdrop",isVisible:e,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:e?()=>{"static"!==this._config.backdrop?this.hide():mt.trigger(this._element,Ur)}:null})}_initializeFocusTrap(){return new cr({trapElement:this._element})}_addEventListeners(){mt.on(this._element,Qr,e=>{"Escape"===e.key&&(this._config.keyboard?this.hide():mt.trigger(this._element,Ur))})}static jQueryInterface(e){return this.each(function(){const t=Wr.getOrCreateInstance(this,e)
if("string"==typeof e){if(void 0===t[e]||e.startsWith("_")||"constructor"===e)throw new TypeError(`No method named "${e}"`)
t[e](this)}})}}mt.on(document,qr,'[data-bs-toggle="offcanvas"]',function(e){const t=Ct.getElementFromSelector(this)
if(["A","AREA"].includes(this.tagName)&&e.preventDefault(),Ge(this))return
mt.one(t,Gr,()=>{Ue(this)&&this.focus()})
const n=Ct.findOne(Fr)
n&&n!==t&&Wr.getInstance(n).hide(),Wr.getOrCreateInstance(t).toggle(this)}),mt.on(window,Rr,()=>{for(const e of Ct.find(Fr))Wr.getOrCreateInstance(e).show()}),mt.on(window,Hr,()=>{for(const e of Ct.find("[aria-modal][class*=show][class*=offcanvas-]"))"fixed"!==getComputedStyle(e).position&&Wr.getOrCreateInstance(e).hide()}),wt(Wr),Ye(Wr)
const Yr={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},Zr=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),Kr=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,Jr=(e,t)=>{const n=e.nodeName.toLowerCase()
return t.includes(n)?!Zr.has(n)||Boolean(Kr.test(e.nodeValue)):t.filter(e=>e instanceof RegExp).some(e=>e.test(n))},ei={allowList:Yr,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},ti={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},ni={entry:"(string|element|function|null)",selector:"(string|element)"}
class ri extends xt{constructor(e){super(),this._config=this._getConfig(e)}static get Default(){return ei}static get DefaultType(){return ti}static get NAME(){return"TemplateFactory"}getContent(){return Object.values(this._config.content).map(e=>this._resolvePossibleFunction(e)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(e){return this._checkContent(e),this._config.content={...this._config.content,...e},this}toHtml(){const e=document.createElement("div")
e.innerHTML=this._maybeSanitize(this._config.template)
for(const[r,i]of Object.entries(this._config.content))this._setContent(e,i,r)
const t=e.children[0],n=this._resolvePossibleFunction(this._config.extraClass)
return n&&t.classList.add(...n.split(" ")),t}_typeCheckConfig(e){super._typeCheckConfig(e),this._checkContent(e.content)}_checkContent(e){for(const[t,n]of Object.entries(e))super._typeCheckConfig({selector:t,entry:n},ni)}_setContent(e,t,n){const r=Ct.findOne(n,e)
r&&((t=this._resolvePossibleFunction(t))?je(t)?this._putElementInTemplate(Ve(t),r):this._config.html?r.innerHTML=this._maybeSanitize(t):r.textContent=t:r.remove())}_maybeSanitize(e){return this._config.sanitize?function(e,t,n){if(!e.length)return e
if(n&&"function"==typeof n)return n(e)
const r=(new window.DOMParser).parseFromString(e,"text/html"),i=[].concat(...r.body.querySelectorAll("*"))
for(const o of i){const e=o.nodeName.toLowerCase()
if(!Object.keys(t).includes(e)){o.remove()
continue}const n=[].concat(...o.attributes),r=[].concat(t["*"]||[],t[e]||[])
for(const t of n)Jr(t,r)||o.removeAttribute(t.nodeName)}return r.body.innerHTML}(e,this._config.allowList,this._config.sanitizeFn):e}_resolvePossibleFunction(e){return Ze(e,[void 0,this])}_putElementInTemplate(e,t){if(this._config.html)return t.innerHTML="",void t.append(e)
t.textContent=e.textContent}}const ii=new Set(["sanitize","allowList","sanitizeFn"]),oi="fade",ai="show",si=".tooltip-inner",li=".modal",ci="hide.bs.modal",ui="hover",di="focus",pi="click",hi={AUTO:"auto",TOP:"top",RIGHT:We()?"left":"right",BOTTOM:"bottom",LEFT:We()?"right":"left"},fi={allowList:Yr,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},mi={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"}
class gi extends St{constructor(e,t){super(e,t),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return fi}static get DefaultType(){return mi}static get NAME(){return"tooltip"}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){this._isEnabled&&(this._isShown()?this._leave():this._enter())}dispose(){clearTimeout(this._timeout),mt.off(this._element.closest(li),ci,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if("none"===this._element.style.display)throw new Error("Please use show on visible elements")
if(!this._isWithContent()||!this._isEnabled)return
const e=mt.trigger(this._element,this.constructor.eventName("show")),t=(He(this._element)||this._element.ownerDocument.documentElement).contains(this._element)
if(e.defaultPrevented||!t)return
this._disposePopper()
const n=this._getTipElement()
this._element.setAttribute("aria-describedby",n.getAttribute("id"))
const{container:r}=this._config
if(this._element.ownerDocument.documentElement.contains(this.tip)||(r.append(n),mt.trigger(this._element,this.constructor.eventName("inserted"))),this._popper=this._createPopper(n),n.classList.add(ai),"ontouchstart"in document.documentElement)for(const i of[].concat(...document.body.children))mt.on(i,"mouseover",qe)
this._queueCallback(()=>{mt.trigger(this._element,this.constructor.eventName("shown")),!1===this._isHovered&&this._leave(),this._isHovered=!1},this.tip,this._isAnimated())}hide(){if(this._isShown()&&!mt.trigger(this._element,this.constructor.eventName("hide")).defaultPrevented){if(this._getTipElement().classList.remove(ai),"ontouchstart"in document.documentElement)for(const e of[].concat(...document.body.children))mt.off(e,"mouseover",qe)
this._activeTrigger[pi]=!1,this._activeTrigger[di]=!1,this._activeTrigger[ui]=!1,this._isHovered=null,this._queueCallback(()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),mt.trigger(this._element,this.constructor.eventName("hidden")))},this.tip,this._isAnimated())}}update(){this._popper&&this._popper.update()}_isWithContent(){return Boolean(this._getTitle())}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(e){const t=this._getTemplateFactory(e).toHtml()
if(!t)return null
t.classList.remove(oi,ai),t.classList.add(`bs-${this.constructor.NAME}-auto`)
const n=(e=>{do{e+=Math.floor(1e6*Math.random())}while(document.getElementById(e))
return e})(this.constructor.NAME).toString()
return t.setAttribute("id",n),this._isAnimated()&&t.classList.add(oi),t}setContent(e){this._newContent=e,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(e){return this._templateFactory?this._templateFactory.changeContent(e):this._templateFactory=new ri({...this._config,content:e,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{[si]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(e){return this.constructor.getOrCreateInstance(e.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(oi)}_isShown(){return this.tip&&this.tip.classList.contains(ai)}_createPopper(e){const t=Ze(this._config.placement,[this,e,this._element]),n=hi[t.toUpperCase()]
return De(this._element,e,this._getPopperConfig(n))}_getOffset(){const{offset:e}=this._config
return"string"==typeof e?e.split(",").map(e=>Number.parseInt(e,10)):"function"==typeof e?t=>e(t,this._element):e}_resolvePossibleFunction(e){return Ze(e,[this._element,this._element])}_getPopperConfig(e){const t={placement:e,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:e=>{this._getTipElement().setAttribute("data-popper-placement",e.state.placement)}}]}
return{...t,...Ze(this._config.popperConfig,[void 0,t])}}_setListeners(){const e=this._config.trigger.split(" ")
for(const t of e)if("click"===t)mt.on(this._element,this.constructor.eventName("click"),this._config.selector,e=>{const t=this._initializeOnDelegatedTarget(e)
t._activeTrigger[pi]=!(t._isShown()&&t._activeTrigger[pi]),t.toggle()})
else if("manual"!==t){const e=t===ui?this.constructor.eventName("mouseenter"):this.constructor.eventName("focusin"),n=t===ui?this.constructor.eventName("mouseleave"):this.constructor.eventName("focusout")
mt.on(this._element,e,this._config.selector,e=>{const t=this._initializeOnDelegatedTarget(e)
t._activeTrigger["focusin"===e.type?di:ui]=!0,t._enter()}),mt.on(this._element,n,this._config.selector,e=>{const t=this._initializeOnDelegatedTarget(e)
t._activeTrigger["focusout"===e.type?di:ui]=t._element.contains(e.relatedTarget),t._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},mt.on(this._element.closest(li),ci,this._hideModalHandler)}_fixTitle(){const e=this._element.getAttribute("title")
e&&(this._element.getAttribute("aria-label")||this._element.textContent.trim()||this._element.setAttribute("aria-label",e),this._element.setAttribute("data-bs-original-title",e),this._element.removeAttribute("title"))}_enter(){this._isShown()||this._isHovered?this._isHovered=!0:(this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show))}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(e,t){clearTimeout(this._timeout),this._timeout=setTimeout(e,t)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(e){const t=bt.getDataAttributes(this._element)
for(const n of Object.keys(t))ii.has(n)&&delete t[n]
return e={...t,..."object"==typeof e&&e?e:{}},e=this._mergeConfigObj(e),e=this._configAfterMerge(e),this._typeCheckConfig(e),e}_configAfterMerge(e){return e.container=!1===e.container?document.body:Ve(e.container),"number"==typeof e.delay&&(e.delay={show:e.delay,hide:e.delay}),"number"==typeof e.title&&(e.title=e.title.toString()),"number"==typeof e.content&&(e.content=e.content.toString()),e}_getDelegateConfig(){const e={}
for(const[t,n]of Object.entries(this._config))this.constructor.Default[t]!==n&&(e[t]=n)
return e.selector=!1,e.trigger="manual",e}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(e){return this.each(function(){const t=gi.getOrCreateInstance(this,e)
if("string"==typeof e){if(void 0===t[e])throw new TypeError(`No method named "${e}"`)
t[e]()}})}}Ye(gi)
const yi=".popover-header",vi=".popover-body",bi={...gi.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},xi={...gi.DefaultType,content:"(null|string|element|function)"}
class Si extends gi{static get Default(){return bi}static get DefaultType(){return xi}static get NAME(){return"popover"}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[yi]:this._getTitle(),[vi]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(e){return this.each(function(){const t=Si.getOrCreateInstance(this,e)
if("string"==typeof e){if(void 0===t[e])throw new TypeError(`No method named "${e}"`)
t[e]()}})}}Ye(Si)
const _i=".bs.scrollspy",Ci=`activate${_i}`,wi=`click${_i}`,Ti=`load${_i}.data-api`,Ai="active",Ii="[href]",Pi=".nav-link",Bi=`${Pi}, .nav-item > ${Pi}, .list-group-item`,Ei={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},ki={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"}
class Di extends St{constructor(e,t){super(e,t),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement="visible"===getComputedStyle(this._element).overflowY?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return Ei}static get DefaultType(){return ki}static get NAME(){return"scrollspy"}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver()
for(const e of this._observableSections.values())this._observer.observe(e)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(e){return e.target=Ve(e.target)||document.body,e.rootMargin=e.offset?`${e.offset}px 0px -30%`:e.rootMargin,"string"==typeof e.threshold&&(e.threshold=e.threshold.split(",").map(e=>Number.parseFloat(e))),e}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(mt.off(this._config.target,wi),mt.on(this._config.target,wi,Ii,e=>{const t=this._observableSections.get(e.target.hash)
if(t){e.preventDefault()
const n=this._rootElement||window,r=t.offsetTop-this._element.offsetTop
if(n.scrollTo)return void n.scrollTo({top:r,behavior:"smooth"})
n.scrollTop=r}}))}_getNewObserver(){const e={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin}
return new IntersectionObserver(e=>this._observerCallback(e),e)}_observerCallback(e){const t=e=>this._targetLinks.get(`#${e.target.id}`),n=e=>{this._previousScrollData.visibleEntryTop=e.target.offsetTop,this._process(t(e))},r=(this._rootElement||document.documentElement).scrollTop,i=r>=this._previousScrollData.parentScrollTop
this._previousScrollData.parentScrollTop=r
for(const o of e){if(!o.isIntersecting){this._activeTarget=null,this._clearActiveClass(t(o))
continue}const e=o.target.offsetTop>=this._previousScrollData.visibleEntryTop
if(i&&e){if(n(o),!r)return}else i||e||n(o)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map
const e=Ct.find(Ii,this._config.target)
for(const t of e){if(!t.hash||Ge(t))continue
const e=Ct.findOne(decodeURI(t.hash),this._element)
Ue(e)&&(this._targetLinks.set(decodeURI(t.hash),t),this._observableSections.set(t.hash,e))}}_process(e){this._activeTarget!==e&&(this._clearActiveClass(this._config.target),this._activeTarget=e,e.classList.add(Ai),this._activateParents(e),mt.trigger(this._element,Ci,{relatedTarget:e}))}_activateParents(e){if(e.classList.contains("dropdown-item"))Ct.findOne(".dropdown-toggle",e.closest(".dropdown")).classList.add(Ai)
else for(const t of Ct.parents(e,".nav, .list-group"))for(const e of Ct.prev(t,Bi))e.classList.add(Ai)}_clearActiveClass(e){e.classList.remove(Ai)
const t=Ct.find(`${Ii}.${Ai}`,e)
for(const n of t)n.classList.remove(Ai)}static jQueryInterface(e){return this.each(function(){const t=Di.getOrCreateInstance(this,e)
if("string"==typeof e){if(void 0===t[e]||e.startsWith("_")||"constructor"===e)throw new TypeError(`No method named "${e}"`)
t[e]()}})}}mt.on(window,Ti,()=>{for(const e of Ct.find('[data-bs-spy="scroll"]'))Di.getOrCreateInstance(e)}),Ye(Di)
const Mi=".bs.tab",Ri=`hide${Mi}`,Oi=`hidden${Mi}`,Li=`show${Mi}`,Ni=`shown${Mi}`,Fi=`click${Mi}`,zi=`keydown${Mi}`,ji=`load${Mi}`,Vi="ArrowLeft",Ui="ArrowRight",Gi="ArrowUp",Hi="ArrowDown",qi="Home",Qi="End",$i="active",Xi="fade",Wi="show",Yi=".dropdown-toggle",Zi=`:not(${Yi})`,Ki='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',Ji=`.nav-link${Zi}, .list-group-item${Zi}, [role="tab"]${Zi}, ${Ki}`,eo=`.${$i}[data-bs-toggle="tab"], .${$i}[data-bs-toggle="pill"], .${$i}[data-bs-toggle="list"]`
class to extends St{constructor(e){super(e),this._parent=this._element.closest('.list-group, .nav, [role="tablist"]'),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),mt.on(this._element,zi,e=>this._keydown(e)))}static get NAME(){return"tab"}show(){const e=this._element
if(this._elemIsActive(e))return
const t=this._getActiveElem(),n=t?mt.trigger(t,Ri,{relatedTarget:e}):null
mt.trigger(e,Li,{relatedTarget:t}).defaultPrevented||n&&n.defaultPrevented||(this._deactivate(t,e),this._activate(e,t))}_activate(e,t){e&&(e.classList.add($i),this._activate(Ct.getElementFromSelector(e)),this._queueCallback(()=>{"tab"===e.getAttribute("role")?(e.removeAttribute("tabindex"),e.setAttribute("aria-selected",!0),this._toggleDropDown(e,!0),mt.trigger(e,Ni,{relatedTarget:t})):e.classList.add(Wi)},e,e.classList.contains(Xi)))}_deactivate(e,t){e&&(e.classList.remove($i),e.blur(),this._deactivate(Ct.getElementFromSelector(e)),this._queueCallback(()=>{"tab"===e.getAttribute("role")?(e.setAttribute("aria-selected",!1),e.setAttribute("tabindex","-1"),this._toggleDropDown(e,!1),mt.trigger(e,Oi,{relatedTarget:t})):e.classList.remove(Wi)},e,e.classList.contains(Xi)))}_keydown(e){if(![Vi,Ui,Gi,Hi,qi,Qi].includes(e.key))return
e.stopPropagation(),e.preventDefault()
const t=this._getChildren().filter(e=>!Ge(e))
let n
if([qi,Qi].includes(e.key))n=t[e.key===qi?0:t.length-1]
else{const r=[Ui,Hi].includes(e.key)
n=Je(t,e.target,r,!0)}n&&(n.focus({preventScroll:!0}),to.getOrCreateInstance(n).show())}_getChildren(){return Ct.find(Ji,this._parent)}_getActiveElem(){return this._getChildren().find(e=>this._elemIsActive(e))||null}_setInitialAttributes(e,t){this._setAttributeIfNotExists(e,"role","tablist")
for(const n of t)this._setInitialAttributesOnChild(n)}_setInitialAttributesOnChild(e){e=this._getInnerElement(e)
const t=this._elemIsActive(e),n=this._getOuterElement(e)
e.setAttribute("aria-selected",t),n!==e&&this._setAttributeIfNotExists(n,"role","presentation"),t||e.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(e,"role","tab"),this._setInitialAttributesOnTargetPanel(e)}_setInitialAttributesOnTargetPanel(e){const t=Ct.getElementFromSelector(e)
t&&(this._setAttributeIfNotExists(t,"role","tabpanel"),e.id&&this._setAttributeIfNotExists(t,"aria-labelledby",`${e.id}`))}_toggleDropDown(e,t){const n=this._getOuterElement(e)
if(!n.classList.contains("dropdown"))return
const r=(e,r)=>{const i=Ct.findOne(e,n)
i&&i.classList.toggle(r,t)}
r(Yi,$i),r(".dropdown-menu",Wi),n.setAttribute("aria-expanded",t)}_setAttributeIfNotExists(e,t,n){e.hasAttribute(t)||e.setAttribute(t,n)}_elemIsActive(e){return e.classList.contains($i)}_getInnerElement(e){return e.matches(Ji)?e:Ct.findOne(Ji,e)}_getOuterElement(e){return e.closest(".nav-item, .list-group-item")||e}static jQueryInterface(e){return this.each(function(){const t=to.getOrCreateInstance(this)
if("string"==typeof e){if(void 0===t[e]||e.startsWith("_")||"constructor"===e)throw new TypeError(`No method named "${e}"`)
t[e]()}})}}mt.on(document,Fi,Ki,function(e){["A","AREA"].includes(this.tagName)&&e.preventDefault(),Ge(this)||to.getOrCreateInstance(this).show()}),mt.on(window,ji,()=>{for(const e of Ct.find(eo))to.getOrCreateInstance(e)}),Ye(to)
const no=".bs.toast",ro=`mouseover${no}`,io=`mouseout${no}`,oo=`focusin${no}`,ao=`focusout${no}`,so=`hide${no}`,lo=`hidden${no}`,co=`show${no}`,uo=`shown${no}`,po="hide",ho="show",fo="showing",mo={animation:"boolean",autohide:"boolean",delay:"number"},go={animation:!0,autohide:!0,delay:5e3}
class yo extends St{constructor(e,t){super(e,t),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return go}static get DefaultType(){return mo}static get NAME(){return"toast"}show(){mt.trigger(this._element,co).defaultPrevented||(this._clearTimeout(),this._config.animation&&this._element.classList.add("fade"),this._element.classList.remove(po),Qe(this._element),this._element.classList.add(ho,fo),this._queueCallback(()=>{this._element.classList.remove(fo),mt.trigger(this._element,uo),this._maybeScheduleHide()},this._element,this._config.animation))}hide(){this.isShown()&&(mt.trigger(this._element,so).defaultPrevented||(this._element.classList.add(fo),this._queueCallback(()=>{this._element.classList.add(po),this._element.classList.remove(fo,ho),mt.trigger(this._element,lo)},this._element,this._config.animation)))}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(ho),super.dispose()}isShown(){return this._element.classList.contains(ho)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(e,t){switch(e.type){case"mouseover":case"mouseout":this._hasMouseInteraction=t
break
case"focusin":case"focusout":this._hasKeyboardInteraction=t}if(t)return void this._clearTimeout()
const n=e.relatedTarget
this._element===n||this._element.contains(n)||this._maybeScheduleHide()}_setListeners(){mt.on(this._element,ro,e=>this._onInteraction(e,!0)),mt.on(this._element,io,e=>this._onInteraction(e,!1)),mt.on(this._element,oo,e=>this._onInteraction(e,!0)),mt.on(this._element,ao,e=>this._onInteraction(e,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(e){return this.each(function(){const t=yo.getOrCreateInstance(this,e)
if("string"==typeof e){if(void 0===t[e])throw new TypeError(`No method named "${e}"`)
t[e](this)}})}}wt(yo),Ye(yo)},14033(e,t,n){"use strict"
n.d(t,{U:()=>r})
var r,i=n(95472)
!function(e){e.Zero=0
const{_int32:t,_float64:n,_int32_1:r,_float64_1:o}=function(){const e=new ArrayBuffer(8),t=new ArrayBuffer(8)
return{_int32:new Int32Array(e),_float64:new Float64Array(e),_int32_1:new Int32Array(t),_float64_1:new Float64Array(t)}}()
e.is=function(e){return"number"==typeof e},e.create=function(e,r){return t[0]=e,t[1]=r,n[0]},e.diff=function(e){return n[0]=e,t[1]-t[0]},e.fst=function(e){return n[0]=e,t[0]},e.snd=function(e){return n[0]=e,t[1]},e.areEqual=function(e,i){return n[0]=e,o[0]=i,t[0]===r[0]&&t[1]===r[1]},e.compare=function(e,i){n[0]=e,o[0]=i
const a=t[0]-r[0]
return 0!==a?a:t[1]-r[1]},e.compareInArray=function(e,i,a){n[0]=e[i],o[0]=e[a]
const s=t[0]-r[0]
return 0!==s?s:t[1]-r[1]},e.hashCode=function(e){return n[0]=e,(0,i.vb)(t[0],t[1])},e.toString=function(e){return n[0]=e,`(${t[0]}, ${t[1]})`}}(r||(r={}))},14294(e,t,n){"use strict"
n.d(t,{n:()=>v.n,DJ:()=>g.D,Eh:()=>m.E,Q7:()=>f.Q,is:()=>h,O8:()=>p,f8:()=>y.f,JX:()=>r.J}),n(77675)
var r=n(69045),i=n(32775)
const o=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[-1,0,0,0],[0,-1,0,0],[0,0,-1,0],[0,1,0,.5],[1,0,0,.5],[-1,0,0,.5],[0,0,1,.5],[0,-1,0,.5],[0,0,-1,.5],[1,0,0,.25],[0,-1,0,.25],[0,0,1,.25],[-1,0,0,.25],[0,1,0,.25],[0,-1,0,.75],[0,0,1,.75],[0,1,0,.75],[1,0,0,.75],[-1,0,0,.75],[0,0,-1,.25],[0,0,-1,.75],[1,-1,0,0],[-1,1,0,0],[0,0,1,1/3],[0,0,1,2/3],[1,0,0,2/3],[0,1,0,1/3],[0,-1,0,2/3],[1,-1,0,1/3],[-1,1,0,2/3],[-1,0,0,1/3],[1,0,0,1/3],[0,1,0,2/3],[0,-1,0,1/3],[1,-1,0,2/3],[-1,1,0,1/3],[-1,0,0,2/3],[0,0,-1,1/3],[0,0,-1,2/3],[0,0,1,5/6],[0,0,1,1/6],[0,0,-1,5/6],[0,0,-1,1/6]],a=[[0,1,2],[3,4,5],[3,1,5],[3,6,5],[7,6,2],[8,6,5],[0,4,2],[0,4,9],[7,10,2],[7,10,9],[0,10,2],[8,10,5],[3,1,11],[3,6,11],[0,10,9],[8,6,11],[3,4,2],[0,4,5],[3,4,9],[7,10,5],[8,4,9],[8,10,9],[8,10,2],[0,6,9],[3,10,9],[0,10,11],[7,1,9],[8,1,11],[7,4,11],[7,6,9],[7,10,11],[3,10,2],[8,1,5],[0,4,11],[3,1,2],[3,1,9],[7,4,2],[8,1,2],[8,1,9],[3,6,9],[7,4,9],[8,6,2],[8,6,9],[3,6,2],[12,13,14],[15,16,14],[12,17,18],[15,19,18],[20,13,18],[21,16,18],[20,17,14],[21,19,14],[0,1,5],[8,10,11],[7,6,11],[7,6,5],[8,4,2],[7,4,5],[7,1,5],[7,1,11],[0,10,5],[0,1,11],[0,6,11],[0,6,5],[3,10,11],[8,4,11],[15,13,22],[12,16,22],[15,17,23],[12,19,23],[21,13,23],[20,16,23],[21,17,22],[20,19,22],[4,0,2],[1,3,2],[4,0,14],[1,3,18],[4,0,9],[1,3,9],[4,0,18],[1,3,14],[10,7,9],[6,8,9],[4,7,14],[6,3,18],[10,0,18],[1,8,14],[1,3,5],[4,0,5],[6,8,11],[10,7,11],[1,3,11],[4,0,11],[10,7,2],[6,8,2],[3,10,22],[7,1,23],[8,4,23],[0,6,22],[1,0,5],[4,3,5],[1,0,23],[4,3,22],[10,7,14],[6,8,18],[8,6,22],[7,10,23],[4,3,11],[1,0,11],[1,0,22],[4,3,23],[10,7,18],[6,8,14],[8,6,23],[7,10,22],[6,7,11],[10,8,11],[8,1,23],[0,10,22],[3,6,22],[7,4,23],[4,3,2],[1,0,2],[10,8,2],[6,7,2],[4,3,9],[1,0,9],[10,8,9],[6,7,9],[4,8,14],[6,0,18],[10,3,18],[1,7,14],[4,8,18],[6,0,14],[10,3,14],[1,7,18],[6,7,5],[10,8,5],[6,8,5],[10,7,5],[8,1,22],[0,10,23],[3,6,23],[7,4,22],[4,24,2],[25,3,2],[4,24,26],[25,3,27],[4,24,27],[25,3,26],[28,29,26],[30,31,26],[32,33,26],[34,35,27],[36,37,27],[38,39,27],[2,0,1],[1,2,0],[1,25,5],[24,0,5],[39,36,40],[35,38,40],[37,34,40],[33,30,41],[29,32,41],[31,28,41],[5,3,4],[4,5,3],[25,1,5],[0,24,5],[24,4,5],[3,25,5],[4,3,41],[25,1,40],[24,4,41],[3,25,40],[4,3,40],[25,1,41],[24,4,40],[3,25,41],[35,34,40],[37,36,40],[39,38,40],[29,28,41],[31,30,41],[33,32,41],[3,5,4],[5,4,3],[25,1,2],[0,24,2],[24,4,2],[3,25,2],[25,1,9],[0,24,9],[24,4,9],[3,25,9],[30,33,26],[32,29,26],[28,31,26],[36,39,27],[38,35,27],[34,37,27],[0,2,1],[2,1,0],[30,33,42],[32,29,42],[28,31,42],[36,39,43],[38,35,43],[34,37,43],[7,9,6],[9,6,7],[25,1,11],[0,24,11],[24,4,11],[3,25,11],[35,34,44],[37,36,44],[39,38,44],[29,28,45],[31,30,45],[33,32,45],[8,11,10],[11,10,8],[1,25,2],[24,0,2],[1,25,42],[24,0,43],[1,25,43],[24,0,42],[1,25,27],[24,0,26],[1,25,26],[24,0,27],[1,25,9],[24,0,9],[4,24,5],[25,3,5],[4,24,11],[25,3,11],[1,0,40],[4,3,44],[0,24,45],[1,0,41],[4,3,45],[0,24,44],[0,24,40],[0,24,41],[2,3,4],[5,3,1],[5,0,4],[4,2,3],[1,5,3],[4,5,0],[2,7,6],[2,8,10],[5,8,6],[5,7,10],[1,9,7],[4,9,8],[1,11,8],[4,11,7],[9,0,6],[9,3,10],[11,3,6],[11,0,10],[6,2,7],[10,2,8],[6,5,8],[10,5,7],[9,7,1],[9,8,4],[11,8,1],[11,7,4],[6,9,0],[10,9,3],[6,11,3],[10,11,0],[9,7,6],[9,8,10],[11,8,6],[11,7,10],[6,9,7],[10,9,8],[6,11,8],[10,11,7],[2,3,10],[5,8,1],[11,0,4],[10,2,3],[1,5,8],[4,11,0],[5,0,1],[2,0,4],[2,3,1],[1,5,0],[4,2,0],[1,2,3],[11,8,10],[11,7,6],[9,7,10],[9,8,6],[10,11,8],[6,11,7],[10,9,7],[6,9,8],[5,8,10],[5,7,6],[2,7,10],[2,8,6],[4,11,8],[1,11,7],[4,9,7],[1,9,8],[11,3,10],[11,0,6],[9,0,10],[9,3,6],[10,5,8],[6,5,7],[10,2,7],[6,2,8],[11,8,4],[11,7,1],[9,7,4],[9,8,1],[10,11,3],[6,11,0],[10,9,0],[6,9,3],[22,15,13],[22,12,16],[14,12,13],[14,15,16],[13,22,15],[16,22,12],[13,14,12],[16,14,15],[22,21,17],[22,20,19],[14,20,17],[14,21,19],[13,23,21],[16,23,20],[13,18,20],[16,18,21],[23,15,17],[23,12,19],[18,12,17],[18,15,19],[17,22,21],[19,22,20],[17,14,20],[19,14,21],[23,21,13],[23,20,16],[18,20,13],[18,21,16],[17,23,15],[19,23,12],[17,18,12],[19,18,15],[5,0,6],[2,7,4],[9,3,1],[6,5,0],[4,2,7],[1,9,3],[0,2,4],[3,2,1],[0,5,1],[2,1,3],[2,4,0],[5,1,0],[7,9,10],[8,9,6],[7,11,6],[9,6,8],[9,10,7],[11,6,7],[1,7,11],[4,8,11],[1,8,9],[4,7,9],[0,9,10],[3,9,6],[3,11,10],[0,11,6],[2,6,8],[2,10,7],[5,6,7],[5,10,8],[6,0,11],[10,3,11],[6,3,9],[10,0,9],[7,2,10],[8,2,6],[8,5,10],[7,5,6],[9,1,8],[9,4,7],[11,1,7],[11,4,8],[7,9,4],[8,9,1],[8,11,4],[7,11,1],[9,6,3],[9,10,0],[11,6,0],[11,10,3],[19,12,23],[13,15,22],[16,21,18],[17,20,14],[20,14,17],[21,18,16],[15,22,13],[12,23,19],[18,16,21],[14,17,20],[23,19,12],[22,13,15],[19,20,22],[13,21,23],[16,15,14],[17,12,18],[20,18,13],[21,14,19],[15,23,17],[12,22,16],[18,19,15],[14,13,12],[23,16,20],[22,17,21],[16,12,22],[17,15,23],[19,21,14],[13,20,18],[12,14,13],[15,18,19],[21,22,17],[20,23,16],[14,16,15],[18,17,12],[22,19,20],[23,13,21],[16,20,23],[17,21,22],[19,15,18],[13,12,14],[12,18,17],[15,14,16],[21,23,13],[20,22,19],[14,19,21],[18,13,20],[22,16,12],[23,17,15],[19,12,22],[17,21,23],[16,15,18],[13,20,14],[20,14,13],[15,18,16],[21,23,17],[12,22,19],[18,16,15],[14,13,20],[22,19,12],[23,17,21],[3,2,4],[3,5,1],[0,5,4],[2,4,3],[5,1,3],[5,4,0],[1,7,9],[4,8,9],[1,8,11],[4,7,11],[0,9,6],[3,9,10],[3,11,6],[0,11,10],[2,6,7],[2,10,8],[5,6,8],[5,10,7],[6,0,9],[10,3,9],[6,3,11],[10,0,11],[7,2,6],[8,2,10],[8,5,6],[7,5,10],[9,1,7],[9,4,8],[11,1,8],[11,4,7],[7,9,1],[8,9,4],[8,11,1],[7,11,4],[9,6,0],[9,10,3],[11,6,3],[11,10,0],[8,9,10],[8,11,6],[7,11,10],[9,10,8],[11,6,8],[11,10,7],[6,0,2],[10,3,2],[6,3,5],[10,0,5],[7,2,1],[8,2,4],[8,5,1],[7,5,4],[9,1,0],[9,4,3],[11,1,3],[11,4,0],[1,7,2],[4,8,2],[1,8,5],[4,7,5],[0,9,1],[3,9,4],[3,11,1],[0,11,4],[2,6,0],[2,10,3],[5,6,3],[5,10,0],[0,2,6],[3,2,10],[3,5,6],[0,5,10],[2,1,7],[2,4,8],[5,1,8],[5,4,7],[16,12,14],[13,21,18],[19,15,23],[17,20,22],[12,14,16],[21,18,13],[15,23,19],[20,22,17],[14,16,12],[18,13,21],[23,19,15],[22,17,20],[19,20,18],[17,15,14],[16,21,22],[13,12,23],[20,18,19],[15,14,17],[21,22,16],[12,23,13],[18,19,20],[14,17,15],[22,16,21],[23,13,12],[6,0,5],[10,3,5],[6,3,2],[10,0,2],[7,2,4],[8,2,1],[8,5,4],[7,5,1],[9,1,3],[9,4,0],[11,1,0],[11,4,3],[1,7,5],[4,8,5],[1,8,2],[4,7,2],[0,9,4],[3,9,1],[3,11,4],[0,11,1],[2,6,3],[2,10,0],[5,6,0],[5,10,3],[0,2,10],[3,2,6],[3,5,10],[0,5,6],[2,1,8],[2,4,7],[5,1,7],[5,4,8],[21,17,23],[20,16,22],[12,13,18],[15,19,14],[23,21,17],[22,20,16],[18,12,13],[14,15,19],[17,23,21],[16,22,20],[13,18,12],[19,14,15],[21,13,22],[20,19,23],[12,17,14],[15,16,18],[23,15,13],[22,12,19],[18,20,17],[14,21,16],[17,22,15],[16,23,12],[13,14,20],[19,18,21],[15,17,22],[12,16,23],[20,13,14],[21,19,18],[22,21,13],[23,20,19],[14,12,17],[18,15,16],[13,23,15],[19,22,12],[17,18,20],[16,14,21],[15,13,23],[12,19,22],[20,17,18],[21,16,14],[22,15,17],[23,12,16],[14,20,13],[18,21,19],[13,22,21],[19,23,20],[17,14,12],[16,18,15],[6,5,3],[4,9,3],[9,3,4],[5,7,4],[4,5,7],[5,3,6]],s=[[0],[0,1],[0,2],[0,3],[0,2,4,5],[0,6],[0,7],[0,6,4,8],[0,7,4,9],[0,6,2,1],[0,3,1,10],[0,6,2,1,4,8,5,11],[0,12,1,7],[0,1,13,14],[0,12,1,7,4,15,11,9],[0,16,2,17],[0,18,12,17],[0,16,5,19],[0,20,13,19],[0,18,12,17,4,21,15,19],[0,16,2,17,4,22,5,19],[0,16,2,17,23,24,13,25,26,20,27,28,4,22,5,19],[0,16,17,2,29,21,30,15],[0,20,13,19,29,31,32,33],[0,16,6,34],[0,18,7,34],[0,16,7,35],[0,16,36,37],[0,18,36,38],[0,16,14,39],[0,20,40,34],[0,16,8,41],[0,18,8,42],[0,16,9,42],[0,16,6,34,4,22,8,41],[0,18,7,34,4,21,9,41],[0,16,7,35,4,22,9,42],[0,16,6,34,23,24,14,39],[0,16,10,43,23,24,7,35],[0,16,36,37,23,24,9,42],[0,16,8,41,23,24,40,38],[0,16,6,34,23,24,14,39,26,20,40,38,4,22,8,41],[0,16,44,45,23,24,46,47,26,20,48,49,4,22,50,51],[0,16,6,34,29,21,9,42],[0,16,8,41,29,21,7,35],[0,16,36,37,29,21,14,39],[0,16,2,17,1,52,6,34],[0,16,2,17,53,54,9,42],[0,16,12,33,1,52,7,35],[0,16,2,17,11,55,8,41],[0,56,2,57,1,58,6,37],[0,56,15,25,1,58,9,39],[0,20,27,17,1,59,40,34],[0,56,12,28,1,58,7,38],[0,16,5,19,1,52,8,41],[0,22,13,28,1,55,14,38],[0,18,13,60,1,61,14,43],[0,16,15,30,1,52,9,42],[0,16,5,19,11,55,6,34],[0,21,12,19,1,54,7,41],[0,20,13,19,1,59,14,41],[0,20,3,30,1,59,10,42],[0,18,12,17,1,61,7,34,4,21,15,19,11,54,9,41],[0,24,13,17,1,62,14,34,4,20,27,19,11,59,40,41],[0,16,2,17,1,52,6,34,4,22,5,19,11,55,8,41],[0,16,12,33,1,52,7,35,4,22,15,30,11,55,9,42],[0,31,3,17,1,63,10,34,4,56,32,19,11,58,36,41],[0,22,2,19,64,59,14,38,4,16,5,17,65,62,40,39],[0,16,2,17,1,52,6,34,23,24,13,25,64,62,14,39,26,20,27,28,65,59,40,38,4,22,5,19,11,55,8,41],[0,16,2,17,66,67,44,45,23,24,13,25,68,69,46,47,26,20,27,28,70,71,48,49,4,22,5,19,72,73,50,51],[0,16,2,17,1,52,6,34,29,21,15,30,53,54,9,42],[0,16,5,19,1,52,8,41,29,21,12,33,53,54,7,35],[0,20,13,19,1,59,14,41,29,31,32,33,53,63,36,35],[0,31,3,17,1,63,10,34,29,20,27,30,53,59,40,42],[0,16,74,75],[0,18,76,77],[0,16,78,79],[0,18,80,81],[0,16,74,75,29,21,82,83],[0,21,84,85,29,16,86,87],[0,16,88,89],[0,16,88,89,29,21,90,91],[0,16,74,75,1,52,88,89],[0,16,78,79,1,52,92,93],[0,16,94,95,11,55,88,89],[0,16,82,83,53,54,88,89],[0,16,74,75,1,52,88,89,29,21,82,83,53,54,90,91],[0,21,84,85,96,97,88,91,29,16,86,87,98,99,90,89],[0,16,74,75,2,17,100,101],[0,16,94,95,5,19,100,101],[0,18,76,77,2,33,102,103],[0,18,104,105,106,107,100,108],[0,16,78,79,2,17,109,108],[0,16,82,83,15,30,100,101],[0,18,80,81,2,33,110,111],[0,18,112,113,114,115,100,108],[0,16,74,75,2,17,100,101,29,21,82,83,15,30,116,117],[0,21,84,85,118,119,116,101,29,16,86,87,120,121,100,117],[0,16,74,75,6,34,122,123],[0,16,74,75,8,41,124,125],[0,16,78,79,7,35,122,123],[0,16,82,83,9,42,122,123],[0,16,74,75,7,35,126,127],[0,16,74,75,9,42,128,129],[0,16,78,79,6,34,126,127],[0,16,78,79,8,41,128,129],[0,16,74,75,6,34,122,123,29,21,82,83,9,42,128,129],[0,16,74,75,7,35,126,127,29,21,82,83,8,41,124,125],[0,21,84,85,6,42,130,131,29,16,86,87,9,34,132,133],[0,21,84,85,7,41,134,135,29,16,86,87,8,35,136,137],[0,16,89,88,2,17,122,123],[0,16,89,88,12,33,126,127],[0,16,89,88,5,19,124,125],[0,16,89,88,15,30,128,129],[0,16,88,89,6,34,100,101],[0,16,89,88,7,35,109,108],[0,16,89,88,8,41,138,139],[0,16,89,88,9,42,116,117],[0,16,89,88,6,34,100,101,29,21,91,90,9,42,116,117],[0,16,89,88,7,35,109,108,29,21,91,90,8,41,138,139],[0,16,89,88,2,17,122,123,29,21,91,90,15,30,128,129],[0,16,89,88,118,121,132,131,29,21,91,90,120,119,130,133],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127],[0,16,74,75,2,17,100,101,11,55,140,141,8,41,124,125],[0,16,74,75,2,17,100,101,53,54,90,91,9,42,128,129],[0,16,74,75,5,19,138,139,1,52,88,89,8,41,124,125],[0,16,74,75,15,30,116,117,1,52,88,89,9,42,128,129],[0,16,94,95,5,19,100,101,11,55,88,89,6,34,124,125],[0,16,94,95,15,30,109,108,11,55,88,89,7,35,128,129],[0,16,78,79,2,17,109,108,1,52,92,93,6,34,126,127],[0,16,78,79,12,33,100,101,1,52,92,93,7,35,122,123],[0,16,82,83,12,33,138,139,53,54,88,89,8,41,126,127],[0,16,82,83,2,17,116,117,53,54,88,89,9,42,122,123],[0,16,78,79,5,19,116,117,1,52,92,93,8,41,128,129],[0,16,82,83,15,30,100,101,1,52,90,91,9,42,122,123],[0,16,82,83,15,30,100,101,53,54,88,89,6,34,128,129],[0,16,82,83,5,19,109,108,53,54,88,89,7,35,124,125],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123,29,21,82,83,15,30,116,117,53,54,90,91,9,42,128,129],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127,29,21,82,83,5,19,138,139,53,54,90,91,8,41,124,125],[0,21,84,85,118,119,116,101,96,97,88,91,9,34,132,133,29,16,86,87,120,121,100,117,98,99,90,89,6,42,130,131],[0,21,84,85,142,143,138,108,96,97,88,91,8,35,136,137,29,16,86,87,144,145,109,139,98,99,90,89,7,41,134,135],[0,146,147],[0,148,149],[0,150,151],[0,146,147,152,153,154,155,156,157],[0,158,159],[0,146,147,1,160,161],[0,146,147,1,160,161,152,153,154,162,163,164,155,156,157,165,166,167],[0,158,159,1,168,169],[0,146,147,101,170,171],[0,146,147,100,172,173],[0,148,149,174,175,171],[0,148,149,100,176,177],[0,150,151,178,179,171],[0,150,151,100,180,181],[0,146,147,100,172,173,152,153,154,182,183,184,155,156,157,185,186,187],[0,158,159,101,188,189],[0,146,147,122,190,191],[0,146,147,123,192,193],[0,146,147,126,194,195],[0,146,147,127,196,197],[0,146,147,122,190,191,152,153,154,198,199,200,155,156,157,201,202,203],[0,158,159,123,204,205],[0,146,147,126,194,195,152,153,154,206,207,208,155,156,157,209,210,211],[0,158,159,129,212,213],[0,146,147,101,170,171,1,160,161,123,192,193],[0,146,147,108,214,215,1,160,161,127,196,197],[0,146,147,100,172,173,1,160,161,122,190,191],[0,146,147,109,216,217,1,160,161,126,194,195],[0,146,147,100,172,173,1,160,161,122,190,191,152,153,154,182,183,184,162,163,164,198,199,200,155,156,157,185,186,187,165,166,167,201,202,203],[0,158,159,101,188,189,1,168,169,123,204,205],[0,146,147,109,216,217,1,160,161,126,194,195,152,153,154,218,219,220,162,163,164,206,207,208,155,156,157,221,222,223,165,166,167,209,210,211],[0,158,159,117,224,225,1,168,169,129,212,213],[0,146,147,16,226,227],[0,148,149,18,228,229],[0,150,151,18,230,231],[0,150,151,16,232,233],[0,148,149,16,234,235],[0,146,147,18,236,237],[0,146,147,52,238,239],[0,146,147,16,226,227,1,160,161,52,238,239],[0,146,147,18,236,237,1,160,161,61,240,241],[0,146,147,16,226,227,100,172,173,101,170,171],[0,148,149,18,228,229,242,172,181,243,214,244],[0,150,151,18,230,231,245,172,177,246,214,247],[0,150,151,16,232,233,245,172,177,174,170,248],[0,148,149,16,234,235,242,172,181,178,170,249],[0,146,147,18,236,237,100,172,173,108,214,215],[0,146,147,16,226,227,122,190,191,123,192,193],[0,146,147,16,226,227,126,194,195,127,196,197],[0,146,147,18,236,237,126,194,195,123,192,193],[0,146,147,18,236,237,122,190,191,127,196,197],[0,146,147,52,238,239,122,190,191,101,170,171],[0,146,147,61,240,241,126,194,195,101,170,171],[0,146,147,52,238,239,100,172,173,123,192,193],[0,146,147,61,240,241,100,172,173,127,196,197],[0,146,147,16,226,227,100,172,173,101,170,171,1,160,161,52,239,238,122,190,191,123,192,193],[0,146,147,16,226,227,109,216,217,108,214,215,1,160,161,52,239,238,126,194,195,127,196,197],[0,146,147,18,236,237,109,216,217,101,170,171,1,160,161,61,241,240,126,194,195,123,192,193],[0,146,147,18,236,237,100,172,173,108,214,215,1,160,161,61,241,240,122,190,191,127,196,197],[0,16,2,17,158,250,251,252,159,253,254,255],[0,16,2,17,158,250,251,252,159,253,254,255,23,24,13,25,256,257,258,259,260,261,262,263,26,20,27,28,264,265,266,267,268,269,270,271,4,22,5,19,272,273,274,275,276,277,278,279],[0,16,2,17,158,250,251,252,159,253,254,255,29,21,15,30,280,281,282,283,284,285,286,287],[0,20,13,19,158,273,266,259,159,261,278,271],[0,20,13,19,158,273,266,259,159,261,278,271,29,31,32,33,280,288,289,290,284,291,292,293],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299],[0,16,2,17,158,250,251,252,159,253,254,255,53,54,9,42,300,301,302,303,304,305,306,307],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,23,24,13,25,256,257,258,259,260,261,262,263,64,62,14,39,308,309,310,311,312,313,314,315,26,20,27,28,264,265,266,267,268,269,270,271,65,59,40,38,316,317,318,319,320,321,322,323,4,22,5,19,272,273,274,275,276,277,278,279,11,55,8,41,324,325,326,327,328,329,330,331],[0,16,2,17,158,250,251,252,159,253,254,255,66,67,44,45,332,333,334,335,336,337,338,339,23,24,13,25,256,257,258,259,260,261,262,263,68,69,46,47,340,341,342,343,344,345,346,347,26,20,27,28,264,265,266,267,268,269,270,271,70,71,48,49,348,349,350,351,352,353,354,355,4,22,5,19,272,273,274,275,276,277,278,279,72,73,50,51,356,357,358,359,360,361,362,363],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,29,21,15,30,280,281,282,283,284,285,286,287,53,54,9,42,300,301,302,303,304,305,306,307],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323,29,31,32,33,280,288,289,290,284,291,292,293,53,63,36,35,300,364,365,366,304,367,368,369],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225],[0,20,13,19,158,273,266,259,159,261,278,271,450,415,440,429,454,431,420,445,458,447,436,425],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,23,24,13,25,256,257,258,259,260,261,262,263,480,481,482,483,484,485,486,487,488,489,490,491,26,20,27,28,264,265,266,267,268,269,270,271,492,493,494,495,496,497,498,499,500,501,502,503,4,22,5,19,272,273,274,275,276,277,278,279,125,124,140,141,504,505,506,507,508,509,510,511],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,29,21,15,30,280,281,282,283,284,285,286,287,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517,23,24,13,25,256,257,258,259,260,261,262,263,518,519,520,521,522,523,524,525,526,527,528,529,26,20,27,28,264,265,266,267,268,269,270,271,530,531,532,533,534,535,536,537,538,539,540,541,4,22,5,19,272,273,274,275,276,277,278,279,127,126,92,93,542,543,544,545,546,547,548,549],[0,20,13,19,158,273,266,259,159,261,278,271,550,551,552,553,554,555,556,557,558,559,560,561,29,31,32,33,280,288,289,290,284,291,292,293,562,563,564,565,566,567,568,569,570,571,572,573],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,64,62,14,39,308,309,310,311,312,313,314,315,481,480,483,482,486,487,484,485,491,490,489,488,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,65,59,40,38,316,317,318,319,320,321,322,323,493,492,495,494,498,499,496,497,503,502,501,500,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413,11,55,8,41,324,325,326,327,328,329,330,331,124,125,141,140,506,507,504,505,511,510,509,508],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213,23,24,13,25,256,257,258,259,260,261,262,263,574,575,576,577,578,579,580,581,582,583,584,585,64,62,14,39,308,309,310,311,312,313,314,315,519,518,521,520,524,525,522,523,529,528,527,526,26,20,27,28,264,265,266,267,268,269,270,271,586,587,588,589,590,591,592,593,594,595,596,597,65,59,40,38,316,317,318,319,320,321,322,323,531,530,533,532,536,537,534,535,541,540,539,538,4,22,5,19,272,273,274,275,276,277,278,279,109,108,79,78,598,599,600,601,602,603,604,605,11,55,8,41,324,325,326,327,328,329,330,331,126,127,93,92,544,545,542,543,549,548,547,546],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,66,69,50,49,332,349,342,359,336,361,354,347,493,123,483,140,498,507,204,485,503,490,509,205,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,68,67,48,51,340,357,334,351,344,353,362,339,124,480,89,494,506,499,484,474,511,478,501,488,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,70,73,46,45,348,333,358,343,352,345,338,363,122,492,141,482,475,487,496,505,479,510,489,500,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,72,71,44,47,356,341,350,335,360,337,346,355,481,125,495,88,486,476,504,497,491,502,477,508],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,606,607,608,609,610,611,612,613,614,615,616,617,531,129,521,92,536,545,212,523,541,528,547,213,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,618,619,620,621,622,623,624,625,626,627,628,629,126,518,91,532,544,537,522,512,549,516,539,526,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,630,631,632,633,634,635,636,637,638,639,640,641,128,530,93,520,513,525,534,543,517,548,527,538,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,642,643,644,645,646,647,648,649,650,651,652,653,519,127,533,90,524,514,542,535,529,540,515,546],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,1,59,14,41,168,325,318,311,169,313,330,323,551,550,553,552,556,557,554,555,561,560,559,558,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425,53,63,36,35,300,364,365,366,304,367,368,369,563,562,565,564,568,569,566,567,573,572,571,570],[0,16],[0,18],[0,16,26,20],[0,2,23,13],[0,3,4,32],[0,2,29,15],[0,3,29,27],[0,52],[0,63],[0,52,26,59],[0,63,26,54],[0,52,16,1],[0,18,1,61],[0,52,16,1,26,59,20,65],[0,31,1,63],[0,1,24,62],[0,15,1,9],[0,5,1,8],[0,31,1,63,26,21,65,54],[0,2,57,56],[0,60,3,16],[0,22,57,3],[0,2,28,20],[0,17,13,24],[0,20,19,13,4,24,17,27],[0,22,57,3,4,16,60,32],[0,22,57,3,23,20,30,12,26,24,33,15,4,16,60,32],[0,22,57,3,29,18,27,25],[0,22,3,57,1,55,10,37],[0,22,385,396,3,57,109,117],[0,22,57,3,159,279,654,655,158,274,656,657,29,18,25,27,284,658,262,269,280,659,257,267]],l={"P 1":0,"P -1":1,"P 1 2 1":2,"P 1 21 1":3,"C 1 2 1":4,"P 1 m 1":5,"P 1 c 1":6,"C 1 m 1":7,"C 1 c 1":8,"P 1 2/m 1":9,"P 1 21/m 1":10,"C 1 2/m 1":11,"P 1 2/c 1":12,"P 1 21/c 1":13,"C 1 2/c 1":14,"P 2 2 2":15,"P 2 2 21":16,"P 21 21 2":17,"P 21 21 21":18,"C 2 2 21":19,"C 2 2 2":20,"F 2 2 2":21,"I 2 2 2":22,"I 21 21 21":23,"P m m 2":24,"P m c 21":25,"P c c 2":26,"P m a 2":27,"P c a 21":28,"P n c 2":29,"P m n 21":30,"P b a 2":31,"P n a 21":32,"P n n 2":33,"C m m 2":34,"C m c 21":35,"C c c 2":36,"A m m 2":37,"A b m 2":38,"A m a 2":39,"A b a 2":40,"F m m 2":41,"F d d 2":42,"I m m 2":43,"I b a 2":44,"I m a 2":45,"P 2/m 2/m 2/m":46,"P m m m":46,"P 2/n 2/n 2/n":47,"P n n n":47,"P 2/c 2/c 2/m":48,"P c c m":48,"P 2/b 2/a 2/n":49,"P b a n":49,"P 21/m 2/m 2/a":50,"P m m a":50,"P 2/n 21/n 2/a":51,"P n n a":51,"P 2/m 2/n 21/a":52,"P m n a":52,"P 21/c 2/c 2/a":53,"P c c a":53,"P 21/b 21/a 2/m":54,"P b a m":54,"P 21/c 21/c 2/n":55,"P c c n":55,"P 2/b 21/c 21/m":56,"P b c m":56,"P 21/n 21/n 2/m":57,"P n n m":57,"P 21/m 21/m 2/n":58,"P m m n":58,"P 21/b 2/c 21/n":59,"P b c n":59,"P 21/b 21/c 21/a":60,"P b c a":60,"P 21/n 21/m 21/a":61,"P n m a":61,"C 2/m 2/c 21/m":62,"C m c m":62,"C 2/m 2/c 21/a":63,"C m c a":63,"C 2/m 2/m 2/m":64,"C m m m":64,"C 2/c 2/c 2/m":65,"C c c m":65,"C 2/m 2/m 2/a":66,"C m m a":66,"C 2/c 2/c 2/a":67,"C c c a":67,"F 2/m 2/m 2/m":68,"F m m m":68,"F 2/d 2/d 2/d":69,"F d d d":69,"I 2/m 2/m 2/m":70,"I m m m":70,"I 2/b 2/a 2/m":71,"I b a m":71,"I 21/b 21/c 21/a":72,"I b c a":72,"I 21/m 21/m 21/a":73,"I m m a":73,"P 4":74,"P 41":75,"P 42":76,"P 43":77,"I 4":78,"I 41":79,"P -4":80,"I -4":81,"P 4/m":82,"P 42/m":83,"P 4/n":84,"P 42/n":85,"I 4/m":86,"I 41/a":87,"P 4 2 2":88,"P 4 21 2":89,"P 41 2 2":90,"P 41 21 2":91,"P 42 2 2":92,"P 42 21 2":93,"P 43 2 2":94,"P 43 21 2":95,"I 4 2 2":96,"I 41 2 2":97,"P 4 m m":98,"P 4 b m":99,"P 42 c m":100,"P 42 n m":101,"P 4 c c":102,"P 4 n c":103,"P 42 m c":104,"P 42 b c":105,"I 4 m m":106,"I 4 c m":107,"I 41 m d":108,"I 41 c d":109,"P -4 2 m":110,"P -4 2 c":111,"P -4 21 m":112,"P -4 21 c":113,"P -4 m 2":114,"P -4 c 2":115,"P -4 b 2":116,"P -4 n 2":117,"I -4 m 2":118,"I -4 c 2":119,"I -4 2 m":120,"I -4 2 d":121,"P 4/m 2/m 2/m":122,"P4/m m m":122,"P 4/m 2/c 2/c":123,"P4/m c c":123,"P 4/n 2/b 2/m":124,"P4/n b m":124,"P 4/n 2/n 2/c":125,"P4/n n c":125,"P 4/m 21/b 2/m":126,"P4/m b m":126,"P 4/m 21/n 2/c":127,"P4/m n c":127,"P 4/n 21/m 2/m":128,"P4/n m m":128,"P 4/n 2/c 2/c":129,"P4/n c c":129,"P 42/m 2/m 2/c":130,"P42/m m c":130,"P 42/m 2/c 2/m":131,"P42/m c m":131,"P 42/n 2/b 2/c":132,"P42/n b c":132,"P 42/n 2/n 2/m":133,"P42/n n m":133,"P 42/m 21/b 2/c":134,"P42/m b c":134,"P 42/m 21/n 2/m":135,"P42/m n m":135,"P 42/n 21/m 2/c":136,"P42/n m c":136,"P 42/n 21/c 2/m":137,"P42/n c m":137,"I 4/m 2/m 2/m":138,"I4/m m m":138,"I 4/m 2/c 2/m":139,"I4/m c m":139,"I 41/a 2/m 2/d":140,"I41/a m d":140,"I 41/a 2/c 2/d":141,"I41/a c d":141,"P 3":142,"P 31":143,"P 32":144,"H 3":145,"R 3":146,"P -3":147,"H -3":148,"R -3":149,"P 3 1 2":150,"P 3 2 1":151,"P 31 1 2":152,"P 31 2 1":153,"P 32 1 2":154,"P 32 2 1":155,"H 3 2":156,"R 3 2":157,"P 3 m 1":158,"P 3 1 m":159,"P 3 c 1":160,"P 3 1 c":161,"H 3 m":162,"R 3 m":163,"H 3 c":164,"R 3 c":165,"P -3 1 2/m":166,"P -3 1 m":166,"P -3 1 2/c":167,"P -3 1 c":167,"P -3 2/m 1":168,"P -3 m 1":168,"P -3 2/c 1":169,"P -3 c 1":169,"H -3 2/m":170,"H -3 m":170,"R -3 2/m":171,"R -3 m":171,"H -3 2/c":172,"H -3 c":172,"R -3 2/c":173,"R -3 c":173,"P 6":174,"P 61":175,"P 65":176,"P 62":177,"P 64":178,"P 63":179,"P -6":180,"P 6/m":181,"P 63/m":182,"P 6 2 2":183,"P 61 2 2":184,"P 65 2 2":185,"P 62 2 2":186,"P 64 2 2":187,"P 63 2 2":188,"P 6 m m":189,"P 6 c c":190,"P 63 c m":191,"P 63 m c":192,"P -6 m 2":193,"P -6 c 2":194,"P -6 2 m":195,"P -6 2 c":196,"P 6/m 2/m 2/m":197,"P 6/m m m":197,"P 6/m 2/c 2/c":198,"P 6/m c c":198,"P 63/m 2/c 2/m":199,"P 63/m c m":199,"P 63/m 2/m 2/c":200,"P 63/m m c":200,"P 2 3":201,"F 2 3":202,"I 2 3":203,"P 21 3":204,"I 21 3":205,"P 2/m -3":206,"P m -3":206,"P 2/n -3":207,"P n -3":207,"F 2/m -3":208,"F m -3":208,"F 2/d -3":209,"F d -3":209,"I 2/m -3":210,"I m -3":210,"P 21/a -3":211,"P a -3":211,"I 21/a -3":212,"I a -3":212,"P 4 3 2":213,"P 42 3 2":214,"F 4 3 2":215,"F 41 3 2":216,"I 4 3 2":217,"P 43 3 2":218,"P 41 3 2":219,"I 41 3 2":220,"P -4 3 m":221,"F -4 3 m":222,"I -4 3 m":223,"P -4 3 n":224,"F -4 3 c":225,"I -4 3 d":226,"P 4/m -3 2/m":227,"P m -3 m":227,"P 4/n -3 2/n":228,"P n -3 n":228,"P 42/m -3 2/n":229,"P m -3 n":229,"P 42/n -3 2/m":230,"P n -3 m":230,"F 4/m -3 2/m":231,"F m -3 m":231,"F 4/m -3 2/c":232,"F m -3 c":232,"F 41/d -3 2/m":233,"F d -3 m":233,"F 41/d -3 2/c":234,"F d -3 c":234,"I 4/m -3 2/m":235,"I m -3 m":235,"I 41/a -3 2/d":236,"I a -3 d":236,"P 1 1 2":237,"P 1 1 21":238,"B 1 1 2":239,"B 2":239,"A 1 2 1":240,"C 1 21 1":241,"I 1 2 1":242,"I 2":242,"I 1 21 1":243,"P 1 1 m":244,"P 1 1 b":245,"B 1 1 m":246,"B 1 1 b":247,"P 1 1 2/m":248,"P 1 1 21/m":249,"B 1 1 2/m":250,"P 1 1 2/b":251,"P 1 1 21/b":252,"P 1 21/n 1":253,"P 1 21/a 1":254,"B 1 1 2/b":255,"P 21 2 2":256,"P 2 21 2":257,"P 21 21 2 (a)":258,"P 21 2 21":259,"P 2 21 21":260,"C 2 2 21a)":261,"C 2 2 2a":262,"F 2 2 2a":263,"I 2 2 2a":264,"P 21/m 21/m 2/n a":265,"P 42 21 2a":266,"I 2 3a":267}
function c(e){if(e<146)return e+1
if(146===e)return 1146
if(e<149)return e+1-1
if(149===e)return 1148
if(e<157)return e+1-2
if(157===e)return 1155
if(e<163)return e+1-3
if(163===e)return 1160
if(e<165)return e+1-4
if(165===e)return 1161
if(e<171)return e+1-5
if(171===e)return 1166
if(e<173)return e+1-6
if(173===e)return 1167
if(e<237)return e+1-7
if(237===e)return 1003
if(238===e)return 1004
if(239===e)return 1005
if(240===e)return 2005
if(241===e)return 3005
if(242===e)return 4005
if(243===e)return 5005
if(244===e)return 1006
if(245===e)return 1007
if(246===e)return 1008
if(247===e)return 1009
if(248===e)return 1010
if(249===e)return 1011
if(250===e)return 1012
if(251===e)return 1013
if(252===e)return 1014
if(253===e)return 2014
if(254===e)return 3014
if(255===e)return 1015
if(256===e)return 1017
if(257===e)return 2017
if(258===e)return 1018
if(259===e)return 2018
if(260===e)return 3018
if(261===e)return 1020
if(262===e)return 1021
if(263===e)return 1022
if(264===e)return 1023
if(265===e)return 1059
if(266===e)return 1094
if(267===e)return 1197
throw new Error(`unknown spacegroup index '${e}'`)}const u=function(){const e=Object.create(null)
for(const t of Object.keys(l))e[l[t]]=t
return e}(),d=function(){const e=Object.create(null)
for(const t of Object.keys(l)){const n=l[t]
e[n]=c(n)}return e}()
var p,h
!function(e){function t(t,n,r){const o=function(e){const t="number"==typeof e?function(e){switch(e){case 1146:return 146
case 1148:return 149
case 1155:return 157
case 1160:return 163
case 1161:return 165
case 1166:return 171
case 1167:return 173
case 1003:return 237
case 1004:return 238
case 1005:return 239
case 2005:return 240
case 3005:return 241
case 4005:return 242
case 5005:return 243
case 1006:return 244
case 1007:return 245
case 1008:return 246
case 1009:return 247
case 1010:return 248
case 1011:return 249
case 1012:return 250
case 1013:return 251
case 1014:return 252
case 2014:return 253
case 3014:return 254
case 1015:return 255
case 1017:return 256
case 2017:return 257
case 1018:return 258
case 2018:return 259
case 3018:return 260
case 1020:return 261
case 1021:return 262
case 1022:return 263
case 1023:return 264
case 1059:return 265
case 1094:return 266
case 1197:return 267}let t=0
return e>146&&++t,e>148&&++t,e>155&&++t,e>160&&++t,e>161&&++t,e>166&&++t,e>167&&++t,e-1+t}(e):l[e]
return void 0===t||void 0===u[t]?-1:t}(t)
if(o<0)return console.warn(`Unknown spacegroup '${t}', returning a 'P 1' with cellsize [1, 1, 1]`),e.Zero
const a=n[0]*n[1]*n[2],s=r[0],c=r[1],d=r[2],p=n[0],h=n[1],f=n[2],m=Math.cos(c),g=(Math.cos(s)-Math.cos(c)*Math.cos(d))/Math.sin(d),y=Math.sqrt(1-m*m-g*g),v=[p,0,0],b=[Math.cos(d)*h,Math.sin(d)*h,0],x=[m*f,g*f,y*f],S=i.$I.ofRows([[v[0],b[0],x[0],0],[0,b[1],x[1],0],[0,0,x[2],0],[0,0,0,1]])
return{index:o,size:n,volume:a,anglesInRadians:r,toFractional:i.$I.invert(i.$I.zero(),S),fromFractional:S}}e.Zero=t("P 1",i.eB.create(1,1,1),i.eB.create(Math.PI/2,Math.PI/2,Math.PI/2)),e.isZero=function(e){return!e||0===e.index&&1===e.size[0]&&1===e.size[1]&&1===e.size[1]},e.create=t}(p||(p={})),function(e){function t(e){const t=s[e.index].map(e=>function(e){const t=o[e[0]],n=o[e[1]],r=o[e[2]]
return i.$I.ofRows([t,n,r,[0,0,0,1]])}(a[e]))
return{name:u[e.index],num:d[e.index],cell:e,operators:t}}e.ZeroP1=t(p.Zero),e.create=t
const n=(0,i.eB)(),l=(0,i.$I)()
function c(e,t,r,o,a,s){return i.eB.set(n,r,o,a),i.$I.fromTranslation(l,n),i.$I.mul(s,i.$I.mul(s,i.$I.mul(s,e.cell.fromFractional,l),e.operators[t]),e.cell.toFractional)}e.setOperatorMatrix=c,e.getSymmetryOperator=function(e,t,n,o,a){const s=c(e,t,n,o,a,i.$I.zero())
return r.J.create(r.J.getSymmetryOperatorName(t,n,o,a),s,{hkl:i.eB.create(n,o,a),spgrOp:t})}
const h=(0,i.eB)(),f=(0,i.eB)(),m=(0,i.eB)(),g=(0,i.eB)()
function y(e,t,n){const r=[]
if(e>0?r.push("+X"):e<0&&r.push("-X"),t>0?r.push("+Y"):t<0&&r.push("-Y"),n>0?r.push("+Z"):n<0&&r.push("-Z"),1===r.length)return"+"===r[0].charAt(0)?r[0].substr(1):r[0]
if(2===r.length){const e=r[0].charAt(0),t=r[1].charAt(0)
if("+"===e)return`${r[0].substr(1)}${r[1]}`
if("+"===t)return`${r[1].substr(1)}${r[0]}`}throw new Error(`unknown rotation '${r}', ${e} ${t} ${n}`)}function v(e){switch(e){case.5:return"1/2"
case 1/4:return"1/4"
case 3/4:return"3/4"
case 1/3:return"1/3"
case 2/3:return"2/3"
case 1/6:return"1/6"
case 5/6:return"5/6"}return""}function b(e,t){return""===t?e:e.length>2?`${e}+${t}`:"-"===e.charAt(0)?`${t}${e}`:`${t}+${e}`}e.getSymmetryOperatorRef=function(e,t,o,a,s,l){const c=i.$I.zero()
i.eB.set(n,o,a,s),i.eB.floor(h,l),i.$I.copy(c,e.operators[t]),i.eB.floor(f,i.eB.transformMat4(f,l,c)),i.$I.getTranslation(g,c),i.eB.sub(g,g,f),i.eB.add(g,g,h),i.eB.add(g,g,n),i.$I.setTranslation(c,g),i.$I.mul(c,e.cell.fromFractional,c),i.$I.mul(c,c,e.cell.toFractional),i.eB.sub(m,f,h)
const u=o-m[0],d=a-m[1],p=s-m[2]
return r.J.create(r.J.getSymmetryOperatorName(t,u,d,p),c,{hkl:i.eB.create(u,d,p),spgrOp:t})},e.getOperatorXyz=function(e){return[b(y(e[0],e[4],e[8]),v(e[12])),b(y(e[1],e[5],e[9]),v(e[13])),b(y(e[2],e[6],e[10]),v(e[14]))].join(",")}}(h||(h={}))
var f=n(67679),m=n(82094),g=n(52057),y=n(63317),v=n(76677)},14389(e,t,n){"use strict"
n.r(t),n.d(t,{default:()=>i})
var r=n(81389)
function i(...e){return e.every(r.isArray)}},14568(e,t){"use strict"
var n=Symbol.for("react.transitional.element"),r=Symbol.for("react.fragment")
function i(e,t,r){var i=null
if(void 0!==r&&(i=""+r),void 0!==t.key&&(i=""+t.key),"key"in t)for(var o in r={},t)"key"!==o&&(r[o]=t[o])
else r=t
return t=r.ref,{$$typeof:n,type:e,key:i,ref:void 0!==t?t:null,props:r}}t.Fragment=r,t.jsx=i,t.jsxs=i},15088(e,t,n){"use strict"
n.r(t),n.d(t,{default:()=>r.isEqual})
var r=n(59553)},15376(e,t,n){"use strict"
n.d(t,{t:()=>i})
var r=n(76513),i=function(e){function t(t){var n=e.call(this)||this
return n._value=t,n}return(0,r.C6)(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t)
return!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){var e=this,t=e.hasError,n=e.thrownError,r=e._value
if(t)throw n
return this._throwIfClosed(),r},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(n(30372).B)},15382(e,t,n){"use strict"
n.r(t),n.d(t,{PluginCommands:()=>i})
var r=n(16915)
const i={State:{SetCurrentObject:(0,r.j)(),ApplyAction:(0,r.j)(),Update:(0,r.j)(),RemoveObject:(0,r.j)(),ToggleExpanded:(0,r.j)(),ToggleVisibility:(0,r.j)(),Snapshots:{Add:(0,r.j)(),Replace:(0,r.j)(),Move:(0,r.j)(),Remove:(0,r.j)(),Apply:(0,r.j)(),Clear:(0,r.j)(),Upload:(0,r.j)(),Fetch:(0,r.j)(),DownloadToFile:(0,r.j)(),OpenFile:(0,r.j)(),OpenUrl:(0,r.j)()}},Interactivity:{Object:{Highlight:(0,r.j)()},Structure:{Highlight:(0,r.j)(),Select:(0,r.j)()},ClearHighlights:(0,r.j)()},Layout:{Update:(0,r.j)()},Toast:{Show:(0,r.j)(),Hide:(0,r.j)()},Camera:{Reset:(0,r.j)(),SetSnapshot:(0,r.j)(),Focus:(0,r.j)(),FocusObject:(0,r.j)(),OrientAxes:(0,r.j)(),ResetAxes:(0,r.j)()},Canvas3D:{SetSettings:(0,r.j)(),ResetSettings:(0,r.j)()}}},15546(e,t,n){"use strict"
n.d(t,{_k:()=>s,qK:()=>r})
class r{constructor(e,t){this.size=t||1e4,this.state=new Map,this.doWork=e}get(e){const t=this.state.get(e)
if(t)return this.state.delete(e),this.state.set(e,t),t
const n=this.doWork(e)
return this.set(e,n),n}set(e,t){if(this.state.size===this.size)for(const[n]of this.state){this.state.delete(n)
break}this.state.set(e,t)}clear(){this.state.clear()}}const i=/[ _]/g,o=/([a-z\d])([A-Z])/g,a=new r(e=>e.replace(o,"$1_$2").toLowerCase().replace(i,"-"))
function s(e){return a.get(e)}},15670(e,t,n){"use strict"
n.d(t,{A:()=>i})
var r=n(81389)
function i(e){return"object"==typeof e&&e&&"isTruthy"in e&&"boolean"==typeof e.isTruthy?e.isTruthy:(0,r.isArray)(e)?0!==e.length:!!e}},15769(e,t,n){"use strict"
n.d(t,{v:()=>r})
var r,i=n(87095),o=n(87933),a=n(88288),s=n(24762),l=n(92726)
function c(e,t,n,r,i,o){const{auth_seq_id:a,label_seq_id:s,pdbx_PDB_ins_code:l}=e.residues,{endSeqId:c,endInsCode:u,key:d,type:p}=n,h="label"===t?s:a
let f=r
for(;f<i;){const e=h.value(f)
if(o.type[f]=p,o.key[f]=d,e>c||e===c&&l.value(f)===u)break
f++}}!function(e){e.Descriptor={name:"model_secondary_structure"},e.Provider=l.q.create(e.Descriptor),e.fromStruct=function(e,t,n){const r=new Map,l=[{kind:"none"}],u=function(e,t){if(e._rowCount>0){if(e.beg_label_seq_id.valueKind(0)!==s.VP.ValueKinds.Present||e.end_label_seq_id.valueKind(0)!==s.VP.ValueKinds.Present)return"auth"}else if(t&&(t.beg_label_seq_id.valueKind(0)!==s.VP.ValueKinds.Present||t.end_label_seq_id.valueKind(0)!==s.VP.ValueKinds.Present))return"auth"
return"label"}(e,t)
!function(e,t,n,r){if(!e._rowCount)return
const{beg_label_asym_id:o,beg_label_seq_id:a,beg_auth_seq_id:l,pdbx_beg_PDB_ins_code:c}=e,{end_label_seq_id:u,end_auth_seq_id:d,pdbx_end_PDB_ins_code:p}=e,{pdbx_PDB_helix_class:h,conf_type_id:f,details:m}=e,g="label"===t?a:l,y="label"===t?u:d
for(let v=0,b=e._rowCount;v<b;v++){const e=i.SecondaryStructureType.create(h.valueKind(v)===s.VP.ValueKinds.Present?i.SecondaryStructureType.SecondaryStructurePdb[h.value(v)]:f.valueKind(v)===s.VP.ValueKinds.Present?i.SecondaryStructureType.SecondaryStructureMmcif[f.value(v)]:i.SecondaryStructureType.Flag.NA),t={kind:"helix",flags:e,type_id:f.valueKind(v)===s.VP.ValueKinds.Present?f.value(v):"helx_p",helix_class:h.value(v),details:m.valueKind(v)===s.VP.ValueKinds.Present?m.value(v):void 0},a={startSeqId:g.value(v),startInsCode:c.value(v),endSeqId:y.value(v),endInsCode:p.value(v),type:e,key:r.length}
r[r.length]=t
const l=o.value(v)
if(n.has(l)){const e=n.get(l)
e.has(a.startSeqId)?e.get(a.startSeqId).push(a):e.set(a.startSeqId,[a])}else n.set(l,new Map([[a.startSeqId,[a]]]))}}(e,u,r,l),function(e,t,n,r,o){if(!e._rowCount)return
const{beg_label_asym_id:a,beg_label_seq_id:s,beg_auth_seq_id:l,pdbx_beg_PDB_ins_code:c}=e,{end_label_seq_id:u,end_auth_seq_id:d,pdbx_end_PDB_ins_code:p}=e,{sheet_id:h}=e,f="label"===t?s:l,m="label"===t?u:d,g=new Map
let y=r+1
for(let v=0,b=e._rowCount;v<b;v++){const e=h.value(v)
let t
g.has(e)?t=g.get(e):(t=y++,g.set(e,t))
const r=i.SecondaryStructureType.create(i.SecondaryStructureType.Flag.Beta|i.SecondaryStructureType.Flag.BetaSheet),s={kind:"sheet",flags:r,sheet_id:e,symmetry:void 0},l={startSeqId:f.value(v),startInsCode:c.value(v),endSeqId:m.value(v),endInsCode:p.value(v),type:r,key:o.length}
o[o.length]=s
const u=a.value(v)
if(n.has(u)){const e=n.get(u)
e.has(l.startSeqId)?e.get(l.startSeqId).push(l):e.set(l.startSeqId,[l])}else n.set(u,new Map([[l.startSeqId,[l]]]))}}(t,u,r,e._rowCount,l)
const d=n.residues._rowCount,p={type:new Int32Array(d),key:new Int32Array(d),elements:l}
return r.size>0&&function(e,t,n,r){const{count:i}=e.chainAtomSegments,{label_asym_id:a}=e.chains,{auth_seq_id:s,label_seq_id:l,pdbx_PDB_ins_code:u}=e.residues,d="label"===t?l:s
for(let p=0;p<i;p++){const i=o.vE.chainStartResidueIndex(e,p),s=o.vE.chainEndResidueIndexExcl(e,p),l=a.value(p)
if(n.has(l)){const o=n.get(l)
for(let n=i;n<s;n++){const i=d.value(n)
if(o.has(i)){const a=o.get(i)
for(const i of a){const o=u.value(n)
i.startInsCode===o&&c(e,t,i,n,s,r)}}}}}}(n,u,r,p),(0,a.M)(p.type,p.key,p.elements,e=>e)}}(r||(r={}))},15881(e,t,n){"use strict"
function r([e]){return Math.exp(e)}n.r(t),n.d(t,{default:()=>i,exp:()=>r})
var i=(0,n(10336).helper)(r)},16124(e,t,n){"use strict"
function r(){return r.zero()}n.d(t,{Z:()=>r}),function(e){function t(){const e=[.1,0]
return e[0]=0,e}function n(e,n){const r=t()
return r[0]=e,r[1]=n,r}function r(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}function i(e,t){const n=t[0],r=t[1]
let i=n*n+r*r
return i>0&&(i=1/Math.sqrt(i),e[0]=t[0]*i,e[1]=t[1]*i),e}e.zero=t,e.clone=function(e){const n=t()
return n[0]=e[0],n[1]=e[1],n},e.fromObj=function(e){return n(e.x,e.y)},e.toObj=function(e){return{x:e[0],y:e[1]}},e.create=n,e.hasNaN=function(e){return Number.isNaN(e[0])||Number.isNaN(e[1])},e.toArray=function(e,t,n){return t[n+0]=e[0],t[n+1]=e[1],t},e.fromArray=function(e,t,n){return e[0]=t[n+0],e[1]=t[n+1],e},e.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},e.set=function(e,t,n){return e[0]=t,e[1]=n,e},e.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e},e.sub=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e},e.mul=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e},e.div=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e},e.scale=r,e.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},e.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},e.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},e.distance=function(e,t){const n=t[0]-e[0],r=t[1]-e[1]
return Math.sqrt(n*n+r*r)},e.squaredDistance=function(e,t){const n=t[0]-e[0],r=t[1]-e[1]
return n*n+r*r},e.magnitude=function(e){const t=e[0],n=e[1]
return Math.sqrt(t*t+n*n)},e.squaredMagnitude=function(e){const t=e[0],n=e[1]
return t*t+n*n},e.setMagnitude=function(e,t,n){return r(e,i(e,t),n)},e.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},e.normalize=i,e.areEqual=function(e,t){return e[0]===t[0]&&e[1]===t[1]},e.toString=function(e,t){return`[${e[0].toPrecision(t)} ${e[1].toPrecision(t)}}]`}}(r||(r={}))},16159(e,t,n){"use strict"
n.d(t,{LU:()=>r,cG:()=>i})
const r={kind:"null-location"}
function i(e,t,n){return{kind:"data-location",tag:e,data:t,element:n}}},16625(e,t,n){"use strict"
n.d(t,{YL:()=>w,lN:()=>C})
var r,i=n(92384),o=n(3111),a=n(30372),s=n(70292),l=n(40038),c=n(89),u=n(52408),d=n(83842),p=n(32775),h=n(41036),f=n(9726),m=n(17684),g=n(91030),y=n(42261),v=n(70012),b=n(45692),x=n(17515)
!function(e){e.getDefaultParams=function(e,t,n){return i.t.getDefaultValues(e.getParams(t,n))}}(r||(r={}))
const S={name:"",label:"",description:"",factory:()=>w.Empty,getParams:()=>({}),defaultValues:{},defaultColorTheme:{name:""},defaultSizeTheme:{name:""},isApplicable:()=>!0}
function _(e){return e.map(e=>[e.name,e.provider.label])}class C{get default(){return this._list[0]}get types(){return _(this._list)}constructor(){this._list=[],this._map=new Map,this._name=new Map}add(e){if(this._map.has(e.name))throw new Error(`${e.name} already registered.`)
this._list.push({name:e.name,provider:e}),this._map.set(e.name,e),this._name.set(e,e.name)}getName(e){if(!this._name.has(e))throw new Error(`'${e.label}' is not a registered represenatation provider.`)
return this._name.get(e)}remove(e){const t=e.name
this._list.splice(this._list.findIndex(e=>e.name===t),1)
const n=this._map.get(t)
n&&(this._map.delete(t),this._name.delete(n))}get(e){return this._map.get(e)||S}get list(){return this._list}getApplicableList(e){return this._list.filter(t=>t.provider.isApplicable(e))}getApplicableTypes(e){return _(this.getApplicableList(e))}clear(){this._list.length=0,this._map.clear(),this._name.clear()}}var w
let T
!function(e){let t
function n(){return{visible:!0,alphaFactor:1,pickable:!0,colorOnly:!1,syncManually:!1,transform:p.$I.identity(),overpaint:u.l.Empty,transparency:d.x.Empty,emissive:x.a.Empty,substance:b.l.Empty,clipping:g.l.Empty,themeStrength:{overpaint:1,transparency:1,emissive:1,substance:1},markerActions:l.sY.All}}function r(e,t){void 0!==t.visible&&(e.visible=t.visible),void 0!==t.alphaFactor&&(e.alphaFactor=t.alphaFactor),void 0!==t.pickable&&(e.pickable=t.pickable),void 0!==t.colorOnly&&(e.colorOnly=t.colorOnly),void 0!==t.overpaint&&(e.overpaint=t.overpaint),void 0!==t.transparency&&(e.transparency=t.transparency),void 0!==t.emissive&&(e.emissive=t.emissive),void 0!==t.substance&&(e.substance=t.substance),void 0!==t.clipping&&(e.clipping=t.clipping),void 0!==t.themeStrength&&(e.themeStrength=t.themeStrength),void 0!==t.syncManually&&(e.syncManually=t.syncManually),void 0!==t.transform&&p.$I.copy(e.transform,t.transform),void 0!==t.markerActions&&(e.markerActions=t.markerActions)}!function(e){e.areEqual=function(e,t){return e.repr===t.repr&&c.Loci.areEqual(e.loci,t.loci)},e.isEmpty=function(e){return c.Loci.isEmpty(e.loci)},e.Empty={loci:c.EmptyLoci}}(t=e.Loci||(e.Loci={})),e.createState=n,e.updateState=r,e.StateBuilder={create:n,update:r},e.createEmpty=function(){return{label:"",groupCount:0,renderObjects:[],geometryVersion:-1,props:{},params:{},updated:new a.B,state:n(),theme:o.S.createEmpty(),createOrUpdate:()=>s.Task.constant("",void 0),setState:()=>{},setTheme:()=>{},getLoci:()=>c.EmptyLoci,getAllLoci:()=>[],eachLocation:()=>{},mark:()=>!1,destroy:()=>{}}}
class S{constructor(){this.curr=new Set,this.next=new Set,this._version=-1}get version(){return this._version}add(e,t){this.next.add((0,v.m1)(e,t))}snapshot(){y.M.areEqual(this.curr,this.next)||(this._version+=1),[this.curr,this.next]=[this.next,this.curr],this.next.clear()}}e.GeometryState=S,e.createMulti=function(e,t,n,r,l){let u=0
const d=new a.B,p=new S,f=r.create()
let m,g,y,v=o.S.createEmpty()
const b={},x=Object.keys(l).map((e,r)=>{b[r]=e
const i=l[e](t,n)
return i.setState(f),i})
return{label:e,updated:d,get groupCount(){let e=0
if(g){const{visuals:t}=g
for(let n=0,r=x.length;n<r;++n)t&&!t.includes(b[n])||(e+=x[n].groupCount)}return e},get renderObjects(){const e=[]
if(g){const{visuals:t}=g
for(let n=0,r=x.length;n<r;++n)t&&!t.includes(b[n])||e.push(...x[n].renderObjects)}return e},get geometryVersion(){return p.version},get props(){return g},get params(){return m},createOrUpdate:(r={},o)=>{o&&o!==y&&(m=n(t,o),y=o,g||(g=i.t.getDefaultValues(m)))
const a=(0,h.m$)(Object.assign({},g,r),y)
Object.assign(g,r,a)
const{visuals:l}=g
return s.Task.create(`Creating or updating '${e}' representation`,async e=>{for(let t=0,n=x.length;t<n;++t)l&&!l.includes(b[t])||await x[t].createOrUpdate(g,y).runInContext(e),p.add(t,x[t].geometryVersion)
p.snapshot(),d.next(u++)})},get state(){return f},get theme(){return v},getLoci:e=>{const{visuals:t}=g
for(let n=0,r=x.length;n<r;++n)if(!t||t.includes(b[n])){const t=x[n].getLoci(e)
if(!(0,c.isEmptyLoci)(t))return t}return c.EmptyLoci},getAllLoci:()=>{const e=[],{visuals:t}=g
for(let n=0,r=x.length;n<r;++n)t&&!t.includes(b[n])||e.push(...x[n].getAllLoci())
return e},eachLocation:e=>{const{visuals:t}=g
for(let n=0,r=x.length;n<r;++n)t&&!t.includes(b[n])||x[n].eachLocation(e)},mark:(e,t)=>{let n=!1
for(let r=0,i=x.length;r<i;++r)n=x[r].mark(e,t)||n
return n},setState:e=>{r.update(f,e)
for(let t=0,n=x.length;t<n;++t)x[t].setState(e)},setTheme:e=>{v=e
for(let t=0,n=x.length;t<n;++t)x[t].setTheme(e)},destroy(){for(let e=0,t=x.length;e<t;++e)x[e].destroy()}}},e.fromRenderObject=function(t,n){let r=0
const l=new a.B,u=new S,d=e.createState(),p=o.S.createEmpty(),g=i.t.clone(f.iy.Params),y=i.t.getDefaultValues(f.iy.Params)
return{label:t,updated:l,get groupCount(){return n.values.uGroupCount.ref.value},get renderObjects(){return[n]},get geometryVersion(){return u.version},get props(){return y},get params(){return g},createOrUpdate:(e={})=>{const i=(0,h.m$)(Object.assign({},y,e))
return Object.assign(y,e,i),s.Task.create(`Updating '${t}' representation`,async e=>{u.add(0,n.id),u.snapshot(),l.next(r++)})},get state(){return d},get theme(){return p},getLoci:()=>c.EmptyLoci,getAllLoci:()=>[],eachLocation:()=>{},mark:(e,t)=>!1,setState:t=>{void 0!==t.visible&&m.b.setVisibility(n,t.visible),void 0!==t.alphaFactor&&m.b.setAlphaFactor(n,t.alphaFactor),void 0!==t.pickable&&m.b.setPickable(n,t.pickable),void 0!==t.colorOnly&&m.b.setColorOnly(n,t.colorOnly),t.overpaint,t.transparency,t.emissive,t.substance,t.clipping,void 0!==t.themeStrength&&m.b.setThemeStrength(n,t.themeStrength),void 0!==t.transform&&m.b.setTransform(n,t.transform),e.updateState(d,t)},setTheme:()=>{},destroy(){}}}}(w||(w={})),Object.defineProperty(w,"Empty",{get:()=>null!=T?T:T=w.createEmpty()})},16698(e,t,n){"use strict"
n.d(t,{Q:()=>o})
var r=n(37411),i=n(87958)
function o(){return o.create((0,i.i)(),(0,i.i)(),(0,i.i)(),(0,i.i)(),(0,i.i)(),(0,i.i)())}!function(e){let t
function n(e,t){for(let n=0;n<6;++n)i.i.copy(e[n],t[n])
return e}!function(e){e[e.Right=0]="Right",e[e.Left=1]="Left",e[e.Bottom=2]="Bottom",e[e.Top=3]="Top",e[e.Far=4]="Far",e[e.Near=5]="Near"}(t=e.PlaneIndex||(e.PlaneIndex={})),e.create=function(e,t,n,r,i,o){return[e,t,n,r,i,o]},e.copy=n,e.clone=function(t){return n(e(),t)},e.fromProjectionMatrix=function(e,t){const n=t[0],r=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],d=t[8],p=t[9],h=t[10],f=t[11],m=t[12],g=t[13],y=t[14],v=t[15]
return i.i.setUnnormalized(e[0],a-n,u-s,f-d,v-m),i.i.setUnnormalized(e[1],a+n,u+s,f+d,v+m),i.i.setUnnormalized(e[2],a+r,u+l,f+p,v+g),i.i.setUnnormalized(e[3],a-r,u-l,f-p,v-g),i.i.setUnnormalized(e[4],a-o,u-c,f-h,v-y),i.i.setUnnormalized(e[5],a+o,u+c,f+h,v+y),e},e.intersectsSphere3D=function(e,t){const n=t.center,r=-t.radius
for(let o=0;o<6;++o)if(i.i.distanceToPoint(e[o],n)<r)return!1
return!0}
const o=(0,r.e)()
e.intersectsBox3D=function(e,t){for(let n=0;n<6;++n){const r=e[n]
if(o[0]=r.normal[0]>0?t.max[0]:t.min[0],o[1]=r.normal[1]>0?t.max[1]:t.min[1],o[2]=r.normal[2]>0?t.max[2]:t.min[2],i.i.distanceToPoint(r,o)<0)return!1}return!0},e.containsPoint=function(e,t){for(let n=0;n<6;++n)if(i.i.distanceToPoint(e[n],t)<0)return!1
return!0}}(o||(o={}))},16913(e,t,n){"use strict"
n.d(t,{c:()=>r})
var r,i=n(71695),o=n(44688),a=n(41041),s=n(67538)
!function(e){function t(e,t){return{kind:"singletons",source:e,structure:t}}function n(e,t){return{kind:"sequence",source:e,structures:t}}function r(e){return t(e,o.oE.Empty)}function l(e){return"singletons"===e.kind}function c(e){return l(e)?0===e.structure.units.length:0===e.structures.length}function u(e){return c(e)?o.oE.Empty:l(e)?e.structure:(0,a.structureUnion)(e.source,e.structures)}function d(e,i,o){return 0===i.length?r(e):o?t(e,(0,a.structureUnion)(e,i)):n(e,i)}e.Singletons=t,e.Sequence=n,e.Empty=r,e.isSingleton=l,e.isEmpty=c,e.structureCount=function(e){return l(e)?e.structure.elementCount:e.structures.length},e.unionStructure=u,e.toLociWithCurrentUnits=function(e){const t=[],{unitMap:n}=e.source
for(const r of u(e).units)r===n.get(r.id)?t[t.length]={unit:r,indices:s.CD.ofBounds(0,r.elements.length)}:t[t.length]={unit:r,indices:s.CD.ofSortedArray(s.X9.indicesOf(n.get(r.id).elements,r.elements))}
return o.iZ.Loci(e.source,t)},e.toLociWithSourceUnits=function(e){const t=[],{unitMap:n}=e.source
for(const r of u(e).units){const e=n.get(r.id)
t[t.length]=e===r?{unit:e,indices:s.CD.ofBounds(0,e.elements.length)}:{unit:e,indices:s.CD.ofSortedArray(s.X9.indicesOf(e.elements,r.elements))}}return o.iZ.Loci(e.source,t)}
class p{add(e){const t=e.elementCount
0!==t&&(this.structures[this.structures.length]=e,1!==t&&(this.allSingletons=!1))}getSelection(){return d(this.source,this.structures,this.allSingletons)}constructor(e){this.source=e,this.structures=[],this.allSingletons=!0}}class h{add(e){const t=e.elementCount
0!==t&&this.uniqueSets.add(e)&&(this.structures[this.structures.length]=e,1!==t&&(this.allSingletons=!1))}getSelection(){return d(this.structure,this.structures,this.allSingletons)}constructor(e){this.structure=e,this.structures=[],this.allSingletons=!0,this.uniqueSets=(0,i.bw)(o.oE.hashCode,o.oE.areUnitIdsAndIndicesEqual)}}e.LinearBuilder=function(e){return new p(e)},e.UniqueBuilder=function(e){return new h(e)},e.forEach=function(t,n){let r=0
if(e.isSingleton(t))for(const e of t.structure.units){const{elements:i}=e
for(let a=0,l=i.length;a<l;a++)n(o.oE.create([e.getChild(s.X9.ofSingleton(i[a]))],{parent:t.source}),r++)}else for(const e of t.structures)n(e,r++)},e.withInputStructure=function(e,r){return l(e)?t(r,e.structure):n(r,e.structures)}}(r||(r={}))},16915(e,t,n){"use strict"
n.d(t,{K:()=>o,j:()=>i})
var r=n(9043)
function i(){const e=(t,n)=>t.commands.dispatch(e,n||{})
return e.subscribe=(t,n)=>t.commands.subscribe(e,n),e.id=r.kk.create22(),e}class o{constructor(){this.subs=new Map,this.disposing=!1}subscribe(e,t){let n=this.subs.get(e.id)
return n||(n=[],this.subs.set(e.id,n)),n.push(t),{unsubscribe:()=>{const n=this.subs.get(e.id)
if(!n)return
const r=n.indexOf(t)
if(!(r<0)){for(let e=r+1;e<n.length;e++)n[e-1]=n[e]
n.pop()}}}}dispatch(e,t){return new Promise((n,r)=>{this.disposing?r("disposed"):this.subs.get(e.id)?this.resolve({cmd:e,params:t,resolve:n,reject:r}):n()})}dispose(){this.subs.clear()}async resolve(e){const t=this.subs.get(e.cmd.id)
if(t)try{for(const n of t)await n(e.params)
e.resolve()}catch(t){e.reject(t)}else e.resolve()}}},16941(e,t,n){"use strict"
n.r(t),n.d(t,{default:()=>r.isEmpty})
var r=n(59553)},17370(e,t,n){"use strict"
n.d(t,{Z:()=>i})
var r=n(23325)
function i(){return i.zero()}!function(e){function t(){const e=[.1,0,0,0]
return e[0]=0,e}function n(e,t){return e[0]=t.center[0],e[1]=t.center[1],e[2]=t.center[2],e[3]=t.radius,e}e.zero=t,e.clone=function(e){const n=t()
return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n},e.create=function(e,n,r,i){const o=t()
return o[0]=e,o[1]=n,o[2]=r,o[3]=i,o},e.fromSphere=n,e.ofSphere=function(e){return n(t(),e)},e.hasNaN=function(e){return Number.isNaN(e[0])||Number.isNaN(e[1])||Number.isNaN(e[2])||Number.isNaN(e[3])},e.toArray=function(e,t,n){return t[n+0]=e[0],t[n+1]=e[1],t[n+2]=e[2],t[n+3]=e[3],t},e.fromArray=function(e,t,n){return e[0]=t[n+0],e[1]=t[n+1],e[2]=t[n+2],e[3]=t[n+3],e},e.toVec3Array=function(e,t,n){t[n+0]=e[0],t[n+1]=e[1],t[n+2]=e[2]},e.fromVec3Array=function(e,t,n){return e[0]=t[n+0],e[1]=t[n+1],e[2]=t[n+2],e[3]=0,e},e.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},e.set=function(e,t,n,r,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e},e.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},e.distance=function(e,t){const n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],o=t[3]-e[3]
return Math.sqrt(n*n+r*r+i*i+o*o)},e.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[4]=t[4]*n,e},e.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},e.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},e.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},e.squaredDistance=function(e,t){const n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],o=t[3]-e[3]
return n*n+r*r+i*i+o*o},e.norm=function(e){const t=e[0],n=e[1],r=e[2],i=e[3]
return Math.sqrt(t*t+n*n+r*r+i*i)},e.squaredNorm=function(e){const t=e[0],n=e[1],r=e[2],i=e[3]
return t*t+n*n+r*r+i*i},e.transformMat4=function(e,t,n){const r=t[0],i=t[1],o=t[2],a=t[3]
return e[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,e[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,e[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,e[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,e},e.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},e.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},e.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},e.equals=function(e,t){const n=e[0],i=e[1],o=e[2],a=e[3],s=t[0],l=t[1],c=t[2],u=t[3]
return Math.abs(n-s)<=r.p*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-l)<=r.p*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(o-c)<=r.p*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(a-u)<=r.p*Math.max(1,Math.abs(a),Math.abs(u))},e.toString=function(e,t){return`[${e[0].toPrecision(t)} ${e[1].toPrecision(t)} ${e[2].toPrecision(t)}  ${e[3].toPrecision(t)}]`}}(i||(i={}))},17487(e,t,n){"use strict"
n.d(t,{V:()=>r})
var r,i=n(30372),o=n(15376)
!function(e){e.create=function(){const e=new a,t=()=>e.create()
return t.dispose=()=>e.dispose(),t.behavior=t=>e.behavior(t),t}}(r||(r={}))
class a{constructor(){this._eventList=[],this._disposed=!1}create(){const e=new i.B
return this._eventList.push(e),e}behavior(e){const t=new o.t(e)
return this._eventList.push(t),t}dispose(){if(!this._disposed){for(const e of this._eventList)e.complete()
this._disposed=!0}}}},17515(e,t,n){"use strict"
n.d(t,{a:()=>a})
var r=n(89),i=n(48393),o=n(7928)
function a(e,t){return{kind:e,layers:t}}!function(e){function t(e){return 0===e.layers.length}e.Empty={kind:"empty-loci",layers:[]},e.areEqual=function(e,t){if(0===e.layers.length&&0===t.layers.length)return!0
if(e.layers.length!==t.layers.length)return!1
for(let n=0,i=e.layers.length;n<i;++n){if(e.layers[n].value!==t.layers[n].value)return!1
if(!r.Loci.areEqual(e.layers[n].loci,t.layers[n].loci))return!1}return!0},e.isEmpty=t,e.remap=function(e,t){if("element-loci"===e.kind){const n=[]
for(const r of e.layers){let{loci:e,value:o}=r
e=i.StructureElement.Loci.remap(e,t),i.StructureElement.Loci.isEmpty(e)||n.push({loci:e,value:o})}return{kind:"element-loci",layers:n}}return e},e.merge=function(e){if(t(e))return e
if("element-loci"===e.kind){const{structure:t}=e.layers[0].loci,n=new Map
let r=i.StructureElement.Loci.none(t)
for(let a=0,s=e.layers.length;a<s;++a){let{loci:t,value:o}=e.layers[s-a-1]
t=i.StructureElement.Loci.subtract(t,r),r=i.StructureElement.Loci.union(t,r),i.StructureElement.Loci.isEmpty(t)||(n.has(o)&&(t=i.StructureElement.Loci.union(t,n.get(o))),n.set(o,t))}const o=[]
return n.forEach((e,t)=>{o.push({loci:e,value:t})}),{kind:"element-loci",layers:o}}return e},e.filter=function(e,n){if(t(e))return e
if("element-loci"===e.kind){const{structure:t}=e.layers[0].loci,r=[]
for(const o of e.layers){let{loci:e,value:a}=o
const s=i.StructureElement.Loci.remap(e,n)
e=i.StructureElement.Loci.remap(s,t),i.StructureElement.Loci.isEmpty(e)||r.push({loci:e,value:a})}return{kind:"element-loci",layers:r}}return e},e.ofScript=function(e,t){const n=[]
for(let r=0,a=e.length;r<a;++r){const{script:a,value:s}=e[r],l=o.Script.toLoci(a,t)
i.StructureElement.Loci.isEmpty(l)||n.push({loci:l,value:s})}return{kind:"element-loci",layers:n}},e.ofBundle=function(e,t){const n=[]
for(let r=0,o=e.length;r<o;++r){const{bundle:o,value:a}=e[r],s=i.StructureElement.Bundle.toLoci(o,t.root)
n.push({loci:s,value:a})}return{kind:"element-loci",layers:n}},e.toBundle=function(e){const t=[]
for(let n=0,r=e.layers.length;n<r;++n){const{loci:r,value:o}=e.layers[n],a=i.StructureElement.Bundle.fromLoci(r)
t.push({bundle:a,value:o})}return{kind:"element-loci",layers:t}}}(a||(a={}))},17642(e,t,n){"use strict"
n.d(t,{m:()=>o})
var r=n(86814),i=n(52234)
function o(e){i.f.setTimeout(function(){var t=r.$.onUnhandledError
if(!t)throw e
t(e)})}},17684(e,t,n){"use strict"
n.d(t,{b:()=>r})
var r,i=n(89),o=n(40038),a=n(32775),s=n(42594),l=n(31727),c=n(9043),u=n(64170),d=n(88434),p=n(69858),h=n(40426),f=n(17782),m=n(9726),g=n(98529),y=n(386),v=n(22394),b=n(71905)
!function(e){e.setVisibility=function(e,t){e&&(e.state.visible=t)},e.setAlphaFactor=function(e,t){e&&(e.state.alphaFactor=t)},e.setPickable=function(e,t){e&&(e.state.pickable=t)},e.setColorOnly=function(e,t){e&&(e.state.colorOnly=t)},e.mark=function(e,t,n,r,a){if(!e||(0,i.isEmptyLoci)(t))return!1
const{tMarker:s,uMarker:l,markerAverage:u,markerStatus:p,uGroupCount:h,instanceCount:m,instanceGranularity:g}=e.values,y=g.ref.value?m.ref.value:h.ref.value*m.ref.value,{array:v}=s.ref.value,b=p.ref.value
if(!(0,i.isEveryLoci)(t)){let e=0
if(r(t,t=>(e+=d.I.size(t),!0),!0),0===e)return!1
e===y&&(t=i.EveryLoci)}let x=!1,S=-1,_=-1
if((0,i.isEveryLoci)(t)){const e=(0,o.Ro)(n,b);-1!==e.status?(x=b!==e.status,x&&(0,o.uP)(v,e.status,y)):x=(0,o.BH)(v,d.I.ofLength(y),n),S=e.average,_=e.status}else x=r(t,e=>(0,o.BH)(v,e,n),!0),x&&(S=(0,o.HX)(n,b),a&&-1!==a.status&&-1===S&&o.sY.isReverse(a.action,n)&&i.Loci.areEqual(t,a.loci)&&(_=a.status,S=0===_?0:.5))
return x&&(-1===S&&(S=(0,f.Xl)(v,y),0===S&&(_=0)),a&&(a.action=n,a.loci=t,a.status=b),c.IQ.updateIfChanged(l,_),-1===_&&c.IQ.update(s,s.ref.value),c.IQ.updateIfChanged(u,S),c.IQ.updateIfChanged(p,_)),x},e.setOverpaint=function(e,t,n,r,i){if(!e)return
const{tOverpaint:o,dOverpaintType:a,dOverpaint:s,uGroupCount:l,instanceCount:p,instanceGranularity:h}=e.values,f=h.ref.value?p.ref.value:l.ref.value*p.ref.value,v=h.ref.value?"instance":"groupInstance";(0,u.zj)(t.layers.length?f:0,v,e.values)
const{array:b}=o.ref.value
r&&(0,u.MD)(b,0,f)
for(let c=0,m=t.layers.length;c<m;++c){const{loci:e,color:r,clear:i}=t.layers[c]
n(e,e=>{const t=d.I.start(e),n=d.I.end(e)
return i?(0,u.MD)(b,t,n):(0,u.qp)(b,t,n,r)},!1)}if(c.IQ.update(o,o.ref.value),c.IQ.updateIfChanged(a,v),c.IQ.updateIfChanged(s,t.layers.length>0),0!==t.layers.length&&"instance"!==v&&i&&(0,m.jH)(i.props)){const{geometry:t,props:n,webgl:r}=i
if("mesh"===t.kind){const{resolution:i,overpaintTexture:o}=t.meta,a=(0,m.Y0)(n.smoothColors,!0,i)
a&&((0,g.WT)(e.values,a.resolution,a.stride,r,o),t.meta.overpaintTexture=e.values.tOverpaintGrid.ref.value)}else if(r&&"texture-mesh"===t.kind){const{resolution:i,overpaintTexture:o}=t.meta,a=(0,m.Y0)(n.smoothColors,!0,i)
a&&((0,y.FB)(e.values,a.resolution,a.stride,r,o),t.meta.overpaintTexture=e.values.tOverpaintGrid.ref.value)}}},e.setTransparency=function(e,t,n,r,i){if(!e)return
const{tTransparency:o,dTransparencyType:a,transparencyAverage:s,transparencyMin:l,dTransparency:u,uGroupCount:h,instanceCount:f,instanceGranularity:v}=e.values,b=v.ref.value?f.ref.value:h.ref.value*f.ref.value,x=v.ref.value?"instance":"groupInstance";(0,p.Ti)(t.layers.length?b:0,x,e.values)
const{array:S}=o.ref.value
r&&(0,p.m6)(S,0,b)
for(let c=0,m=t.layers.length;c<m;++c){const{loci:e,value:r}=t.layers[c]
n(e,e=>{const t=d.I.start(e),n=d.I.end(e)
return(0,p.UG)(S,t,n,r)},!1)}if(c.IQ.update(o,o.ref.value),c.IQ.updateIfChanged(s,(0,p.Gg)(S,b)),c.IQ.updateIfChanged(l,(0,p.dn)(S,b)),c.IQ.updateIfChanged(a,x),c.IQ.updateIfChanged(u,t.layers.length>0),0!==t.layers.length&&"instance"!==x&&i&&(0,m.jH)(i.props)){const{geometry:t,props:n,webgl:r}=i
if("mesh"===t.kind){const{resolution:i,transparencyTexture:o}=t.meta,a=(0,m.Y0)(n.smoothColors,!0,i)
a&&((0,g._j)(e.values,a.resolution,a.stride,r,o),t.meta.transparencyTexture=e.values.tTransparencyGrid.ref.value)}else if(r&&"texture-mesh"===t.kind){const{resolution:i,transparencyTexture:o}=t.meta,a=(0,m.Y0)(n.smoothColors,!0,i)
a&&((0,y.NQ)(e.values,a.resolution,a.stride,r,o),t.meta.transparencyTexture=e.values.tTransparencyGrid.ref.value)}}},e.setEmissive=function(e,t,n,r,i){if(!e)return
const{tEmissive:o,dEmissiveType:a,emissiveAverage:s,dEmissive:l,uGroupCount:u,instanceCount:p,instanceGranularity:h}=e.values,f=h.ref.value?p.ref.value:u.ref.value*p.ref.value,v=h.ref.value?"instance":"groupInstance";(0,b.Sj)(t.layers.length?f:0,v,e.values)
const{array:x}=o.ref.value
r&&(0,b.dQ)(x,0,f)
for(let c=0,m=t.layers.length;c<m;++c){const{loci:e,value:r}=t.layers[c]
n(e,e=>{const t=d.I.start(e),n=d.I.end(e)
return(0,b.Ns)(x,t,n,r)},!1)}if(c.IQ.update(o,o.ref.value),c.IQ.updateIfChanged(s,(0,b.bO)(x,f)),c.IQ.updateIfChanged(a,v),c.IQ.updateIfChanged(l,t.layers.length>0),0!==t.layers.length&&"instance"!==v&&i&&(0,m.jH)(i.props)){const{geometry:t,props:n,webgl:r}=i
if("mesh"===t.kind){const{resolution:i,emissiveTexture:o}=t.meta,a=(0,m.Y0)(n.smoothColors,!0,i)
a&&((0,g.bj)(e.values,a.resolution,a.stride,r,o),t.meta.emissiveTexture=e.values.tEmissiveGrid.ref.value)}else if(r&&"texture-mesh"===t.kind){const{resolution:i,emissiveTexture:o}=t.meta,a=(0,m.Y0)(n.smoothColors,!0,i)
a&&((0,y.ij)(e.values,a.resolution,a.stride,r,o),t.meta.emissiveTexture=e.values.tEmissiveGrid.ref.value)}}},e.setSubstance=function(e,t,n,r,i){if(!e)return
const{tSubstance:o,dSubstanceType:a,dSubstance:s,uGroupCount:l,instanceCount:u,instanceGranularity:p}=e.values,h=p.ref.value?u.ref.value:l.ref.value*u.ref.value,f=p.ref.value?"instance":"groupInstance";(0,v.fZ)(t.layers.length?h:0,f,e.values)
const{array:b}=o.ref.value
r&&(0,v.C2)(b,0,h)
for(let c=0,m=t.layers.length;c<m;++c){const{loci:e,material:r,clear:i}=t.layers[c]
n(e,e=>{const t=d.I.start(e),n=d.I.end(e)
return i?(0,v.C2)(b,t,n):(0,v.mx)(b,t,n,r)},!1)}if(c.IQ.update(o,o.ref.value),c.IQ.updateIfChanged(a,f),c.IQ.updateIfChanged(s,t.layers.length>0),0!==t.layers.length&&"instance"!==f&&i&&(0,m.jH)(i.props)){const{geometry:t,props:n,webgl:r}=i
if("mesh"===t.kind){const{resolution:i,substanceTexture:o}=t.meta,a=(0,m.Y0)(n.smoothColors,!0,i)
a&&((0,g.Cn)(e.values,a.resolution,a.stride,r,o),t.meta.substanceTexture=e.values.tSubstanceGrid.ref.value)}else if(r&&"texture-mesh"===t.kind){const{resolution:i,substanceTexture:o}=t.meta,a=(0,m.Y0)(n.smoothColors,!0,i)
a&&((0,y.DG)(e.values,a.resolution,a.stride,r,o),t.meta.substanceTexture=e.values.tSubstanceGrid.ref.value)}}},e.setClipping=function(e,t,n,r){if(!e)return
const{tClipping:i,dClippingType:o,dClipping:a,uGroupCount:s,instanceCount:l,instanceGranularity:u}=e.values,p=u.ref.value?l.ref.value:s.ref.value*l.ref.value,{layers:f}=t,m=u.ref.value?"instance":"groupInstance";(0,h.$G)(f.length?p:0,m,e.values)
const{array:g}=i.ref.value
r&&(0,h.eO)(g,0,p)
for(let c=0,y=t.layers.length;c<y;++c){const{loci:e,groups:r}=t.layers[c]
n(e,e=>{const t=d.I.start(e),n=d.I.end(e)
return(0,h.HB)(g,t,n,r)},!1)}c.IQ.update(i,i.ref.value),c.IQ.updateIfChanged(o,m),c.IQ.updateIfChanged(a,t.layers.length>0)},e.setThemeStrength=function(e,t){e&&(c.IQ.updateIfChanged(e.values.uOverpaintStrength,t.overpaint),c.IQ.updateIfChanged(e.values.uTransparencyStrength,t.transparency),c.IQ.updateIfChanged(e.values.uEmissiveStrength,t.emissive),c.IQ.updateIfChanged(e.values.uSubstanceStrength,t.substance))},e.setTransform=function(e,t,n){if(!e||!t&&!n)return
const{values:r}=e
t&&(a.$I.copy(r.matrix.ref.value,t),c.IQ.update(r.matrix,r.matrix.ref.value)),n?(r.extraTransform.ref.value.set(n),c.IQ.update(r.extraTransform,r.extraTransform.ref.value)):null===n&&((0,s.ES)(r.extraTransform.ref.value,r.instanceCount.ref.value),c.IQ.update(r.extraTransform,r.extraTransform.ref.value)),(0,s.CY)(r,r.invariantBoundingSphere.ref.value,r.instanceGrid.ref.value.cellSize,r.instanceGrid.ref.value.batchSize)
const i=(0,l.Ax)(r.invariantBoundingSphere.ref.value,r.transform.ref.value,r.instanceCount.ref.value,0)
c.IQ.update(r.boundingSphere,i)}}(r||(r={}))},17772(e,t,n){"use strict"
function r([e]){return Math.clz32(e)}n.r(t),n.d(t,{clz32:()=>r,default:()=>i})
var i=(0,n(10336).helper)(r)},17782(e,t,n){"use strict"
n.d(t,{Km:()=>l,Xl:()=>s})
var r=n(80813),i=n(32775),o=n(31727)
const a=new Uint8Array(772)
function s(e,t){if(0===t)return 0
const n=new Uint32Array(e.buffer,0,e.buffer.byteLength>>2),r=t-4>>2,i=4*r
let o=0
if(r<0)for(let a=0;a<t;++a)o+=e[a]&&1
else{for(let e=0;e<r;++e){const t=n[e]
o+=a[65535&t]+a[t>>16]}for(let n=i;n<t;++n)o+=e[n]&&1}return o/t}function l(e,t,n){const a=(0,o.xg)(Math.max(1,e),1,Uint8Array,n&&n.tMarker.ref.value.array),l=s(a.array,e),c=0===l?0:-1
return n?(r.IQ.updateIfChanged(n.uMarker,0),r.IQ.update(n.tMarker,a),r.IQ.update(n.uMarkerTexDim,i.ZY.create(a.width,a.height)),r.IQ.updateIfChanged(n.markerAverage,l),r.IQ.updateIfChanged(n.markerStatus,c),r.IQ.updateIfChanged(n.dMarkerType,t),n):{uMarker:r.IQ.create(0),tMarker:r.IQ.create(a),uMarkerTexDim:r.IQ.create(i.ZY.create(a.width,a.height)),markerAverage:r.IQ.create(l),markerStatus:r.IQ.create(c),dMarkerType:r.IQ.create(t)}}a[1]=1,a[2]=1,a[3]=1,a[256]=1,a[512]=1,a[768]=1,a[257]=2,a[513]=2,a[769]=2,a[258]=2,a[514]=2,a[770]=2,a[259]=2,a[515]=2,a[771]=2,new Uint8Array(1)},17810(e,t,n){"use strict"
n.d(t,{d:()=>d})
var r=n(70012),i=n(30084),o=n(32775)
const a=(0,o.eB)(),s=(0,o.eB)(),l=(0,o.eB)(),c=r.Gm.add,u=r.Gm.add3
var d
!function(e){e.create=function(e=2048,t=1024,n){const d=r.Gm.create(Float32Array,1,t,n?n.groupBuffer.ref.value:e),p=r.Gm.create(Float32Array,3,t,n?n.startBuffer.ref.value:e),h=r.Gm.create(Float32Array,3,t,n?n.endBuffer.ref.value:e),f=(e,t,n,r,i,o,a)=>{for(let s=0;s<4;++s)u(p,e,t,n),u(h,r,i,o),c(d,a)},m=(e,t,n,r)=>{const i=o.eB.distance(e,t),c=n%2!=0,u=Math.floor((n+1)/2),d=i/(n+.5)
o.eB.setMagnitude(l,o.eB.sub(l,t,e),d),o.eB.copy(a,e)
for(let p=0;p<u;++p)o.eB.add(a,a,l),c&&p===u-1?o.eB.copy(s,t):o.eB.add(s,a,l),f(a[0],a[1],a[2],s[0],s[1],s[2],r),o.eB.add(a,a,l)}
return{add:f,addVec:(e,t,n)=>{for(let r=0;r<4;++r)u(p,e[0],e[1],e[2]),u(h,t[0],t[1],t[2]),c(d,n)},addFixedCountDashes:m,addFixedLengthDashes:(e,t,n,r)=>{const i=o.eB.distance(e,t)
m(e,t,i/n,r)},addCage:(e,t,n)=>{const{vertices:r,edges:i}=t
for(let l=0,c=i.length;l<c;l+=2)o.eB.fromArray(a,r,3*i[l]),o.eB.fromArray(s,r,3*i[l+1]),o.eB.transformMat4(a,a,e),o.eB.transformMat4(s,s,e),f(a[0],a[1],a[2],s[0],s[1],s[2],n)},getLines:()=>{const e=d.elementCount/4,t=r.Gm.compact(d,!0),o=r.Gm.compact(p,!0),a=r.Gm.compact(h,!0),s=n&&e<=n.lineCount?n.mappingBuffer.ref.value:new Float32Array(8*e),l=n&&e<=n.lineCount?n.indexBuffer.ref.value:new Uint32Array(6*e)
return(!n||e>n.lineCount)&&function(e,t,n){for(let r=0;r<e;++r){const e=8*r
t[e]=-1,t[e+1]=-1,t[e+2]=1,t[e+3]=-1,t[e+4]=-1,t[e+5]=1,t[e+6]=1,t[e+7]=1}for(let r=0;r<e;++r){const e=4*r,t=6*r
n[t]=e,n[t+1]=e+1,n[t+2]=e+2,n[t+3]=e+1,n[t+4]=e+3,n[t+5]=e+2}}(e,s,l),i.q.create(s,l,t,o,a,e,n)}}}}(d||(d={}))},17811(e,t,n){"use strict"
function r([e,t]){return Math.imul(e,t)}n.r(t),n.d(t,{default:()=>i,imul:()=>r})
var i=(0,n(10336).helper)(r)},17963(e,t,n){"use strict"
n.d(t,{f:()=>l})
class r{move(){return++this.index,this.lastValue=this.xs[this.index],this.hasNext=this.index<this.length-1,this.lastValue}constructor(e){this.xs=[],this.index=-1,this.length=0,this.hasNext=!1,this.length=e.length,this.hasNext=e.length>0,this.xs=e,this.index=-1,this.lastValue=e.length>0?e[0]:void 0}}class i{move(){return++this.value,this.hasNext=this.value<this.max,this.value}constructor(e,t){this.max=t,this.value=0,this.hasNext=!1,this.value=e-1,this.hasNext=t>=e}}class o{move(){return this.hasNext=!1,this.value}constructor(e){this.value=e,this.hasNext=!0}}class a{move(){const e=this.f(this.base.move())
return this.hasNext=this.base.hasNext,e}constructor(e,t){this.base=e,this.f=t,this.hasNext=!1,this.hasNext=e.hasNext}}class s{move(){const e=this.next
return this.hasNext=this.findNext(),e}findNext(){for(;this.base.hasNext;)if(this.next=this.base.move(),this.p(this.next))return!0
return!1}constructor(e,t){this.base=e,this.p=t,this.hasNext=this.findNext()}}var l
!function(e){e.Empty=new i(0,-1),e.Array=function(e){return new r(e)},e.Value=function(e){return new o(e)},e.Range=function(e,t){return new i(e,t)},e.map=function(e,t){return new a(e,t)},e.filter=function(e,t){return new s(e,t)},e.forEach=function(e,t,n){for(;e.hasNext;)if(t(e.move(),n))return n
return n}}(l||(l={}))},18207(e,t,n){"use strict"
var r
n.r(t),n.d(t,{Expression:()=>r}),function(e){function t(e){return!!e&&!!e.head&&"object"==typeof e}function n(e){return!!e&&"string"==typeof e.name}e.Symbol=function(e){return{name:e}},e.Apply=function(e,t){return t?{head:e,args:t}:{head:e}},e.isArgumentsArray=function(e){return!!e&&Array.isArray(e)},e.isArgumentsMap=function(e){return!!e&&!Array.isArray(e)},e.isLiteral=function(e){return!t(e)&&!n(e)},e.isApply=t,e.isSymbol=n}(r||(r={}))},18271(e,t){"use strict"
const n="remove",r="replace",i="add",o=Symbol.for("__MUTATIVE_PROXY_DRAFT__"),a=Symbol("__MUTATIVE_RAW_RETURN_SYMBOL__"),s=Symbol.iterator,l={mutable:"mutable",immutable:"immutable"},c={}
function u(e,t){return e instanceof Map?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function d(e,t){if(t in e){let n=Reflect.getPrototypeOf(e)
for(;n;){const e=Reflect.getOwnPropertyDescriptor(n,t)
if(e)return e
n=Reflect.getPrototypeOf(n)}}}function p(e){return Object.getPrototypeOf(e)===Set.prototype}function h(e){return Object.getPrototypeOf(e)===Map.prototype}function f(e){var t
return null!==(t=e.copy)&&void 0!==t?t:e.original}function m(e){return!!g(e)}function g(e){return"object"!=typeof e?null:null==e?void 0:e[o]}function y(e){var t
const n=g(e)
return n?null!==(t=n.copy)&&void 0!==t?t:n.original:e}function v(e,t){if(!e||"object"!=typeof e)return!1
let n
return Object.getPrototypeOf(e)===Object.prototype||Array.isArray(e)||e instanceof Map||e instanceof Set||!!(null==t?void 0:t.mark)&&((n=t.mark(e,l))===l.immutable||"function"==typeof n)}function b(e,t=[]){if(Object.hasOwnProperty.call(e,"key")){const n=e.parent.copy,r=g(S(n,e.key))
if(null!==r&&(null==r?void 0:r.original)!==e.original)return null
const i=3===e.parent.type,o=i?Array.from(e.parent.setMap.keys()).indexOf(e.key):e.key
if(!(i&&n.size>o||u(n,o)))return null
t.push(o)}if(e.parent)return b(e.parent,t)
t.reverse()
try{!function(e,t){for(let n=0;n<t.length-1;n+=1){const r=t[n]
if("object"!=typeof(e=S(3===x(e)?Array.from(e):e,r)))throw new Error(`Cannot resolve patch at '${t.join("/")}'.`)}}(e.copy,t)}catch(e){return null}return t}function x(e){return Array.isArray(e)?1:e instanceof Map?2:e instanceof Set?3:0}function S(e,t){return 2===x(e)?e.get(t):e[t]}function _(e,t,n){2===x(e)?e.set(t,n):e[t]=n}function C(e,t){const n=g(e)
return(n?f(n):e)[t]}function w(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function T(e){if(e)for(;e.finalities.revoke.length>0;)e.finalities.revoke.pop()()}function A(e,t){return t?e:[""].concat(e).map(e=>{const t=`${e}`
return-1===t.indexOf("/")&&-1===t.indexOf("~")?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}).join("/")}const I=Object.prototype.propertyIsEnumerable
function P(e,t){let n
if(Array.isArray(e))return Array.prototype.concat.call(e)
if(e instanceof Set)return p(e)?Set.prototype.difference?Set.prototype.difference.call(e,new Set):new Set(e.values()):new(0,Object.getPrototypeOf(e).constructor)(e.values())
if(e instanceof Map)return h(e)?new Map(e):new(0,Object.getPrototypeOf(e).constructor)(e)
if((null==t?void 0:t.mark)&&(n=t.mark(e,l),void 0!==n)&&n!==l.mutable){if(n===l.immutable)return function(e){const t=Object.create(Object.getPrototypeOf(e))
return Reflect.ownKeys(e).forEach(n=>{let r=Reflect.getOwnPropertyDescriptor(e,n)
r.enumerable&&r.configurable&&r.writable?t[n]=e[n]:(r.writable||(r.writable=!0,r.configurable=!0),(r.get||r.set)&&(r={configurable:!0,writable:!0,enumerable:r.enumerable,value:e[n]}),Reflect.defineProperty(t,n,r))}),t}(e)
if("function"==typeof n)return n()
throw new Error(`Unsupported mark result: ${n}`)}if("object"==typeof e&&Object.getPrototypeOf(e)===Object.prototype){const t={}
return Object.keys(e).forEach(n=>{t[n]=e[n]}),Object.getOwnPropertySymbols(e).forEach(n=>{I.call(e,n)&&(t[n]=e[n])}),t}throw new Error("Please check mark() to ensure that it is a stable marker draftable function.")}function B(e){e.copy||(e.copy=P(e.original,e.options))}function E(e){if(!v(e))return y(e)
if(Array.isArray(e))return e.map(E)
if(e instanceof Map){const t=Array.from(e.entries()).map(([e,t])=>[e,E(t)])
return h(e)?new Map(t):new(0,Object.getPrototypeOf(e).constructor)(t)}if(e instanceof Set){const t=Array.from(e).map(E)
return p(e)?new Set(t):new(0,Object.getPrototypeOf(e).constructor)(t)}const t=Object.create(Object.getPrototypeOf(e))
for(const n in e)t[n]=E(e[n])
return t}function k(e){return m(e)?E(e):e}function D(e){var t
e.assignedMap=null!==(t=e.assignedMap)&&void 0!==t?t:new Map,e.operated||(e.operated=!0,e.parent&&D(e.parent))}function M(){throw new Error("Cannot modify frozen object")}function R(e){return e&&"object"==typeof e&&!Object.isFrozen(e)}function O(e,t,n,r,i){if(!Object.isFrozen(e)&&!m(e))switch(x(e)){case 2:for(const[t,n]of e)R(t)&&O(t),R(n)&&O(n)
e.set=e.clear=e.delete=M
break
case 3:for(const t of e)R(t)&&O(t)
e.add=e.clear=e.delete=M
break
case 1:Object.freeze(e)
for(const t of e)R(t)&&O(t)
break
default:Object.freeze(e),Object.keys(e).forEach(t=>{const n=e[t]
R(n)&&O(n)})}}function L(e,t){const n=x(e)
if(0===n)Reflect.ownKeys(e).forEach(n=>{t(n,e[n],e)})
else if(1===n){let n=0
for(const r of e)t(n,r,e),n+=1}else e.forEach((n,r)=>t(r,n,e))}function N(e,t,n){if(m(e)||!v(e,n)||t.has(e)||Object.isFrozen(e))return
const r=e instanceof Set,i=r?new Map:void 0
if(t.add(e),L(e,(o,a)=>{var s
if(m(a)){const t=g(a)
B(t)
const n=(null===(s=t.assignedMap)||void 0===s?void 0:s.size)||t.operated?t.copy:t.original
_(r?i:e,o,n)}else N(a,t,n)}),i){const t=e,n=Array.from(t)
t.clear(),n.forEach(e=>{t.add(i.has(e)?i.get(e):e)})}}function F(e,t){const n=3===e.type?e.setMap:e.copy
e.finalities.revoke.length>1&&e.assignedMap.get(t)&&n&&N(S(n,t),e.finalities.handledSet,e.options)}function z(e){3===e.type&&e.copy&&(e.copy.clear(),e.setMap.forEach(t=>{e.copy.add(y(t))}))}function j(e,t,n,r){if(e.operated&&e.assignedMap&&e.assignedMap.size>0&&!e.finalized){if(n&&r){const i=b(e)
i&&t(e,i,n,r)}e.finalized=!0}}function V(e,t,n,r){const i=g(n)
i&&(i.callbacks||(i.callbacks=[]),i.callbacks.push((o,a)=>{const s=3===e.type?e.setMap:e.copy
if(w(S(s,t),n)){let n=i.original
i.copy&&(n=i.copy),z(e),j(e,r,o,a),_(s,t,n)}}),e.options.enableAutoFreeze&&i.finalities!==e.finalities&&(e.options.enableAutoFreeze=!1)),v(n,e.options)&&e.finalities.draft.push(()=>{w(S(3===e.type?e.setMap:e.copy,t),n)&&F(e,t)})}function U(e,t,o,a){const{pathAsArray:s=!0}=e.options.enablePatches
switch(e.type){case 0:case 2:return function({original:e,copy:t,assignedMap:o},a,s,l,c){o.forEach((o,d)=>{const p=S(e,d),h=k(S(t,d)),f=o?u(e,d)?r:i:n
if(w(p,h)&&f===r)return
const m=A(a.concat(d),c)
s.push(f===n?{op:f,path:m}:{op:f,path:m,value:h}),l.push(f===i?{op:n,path:m}:f===n?{op:i,path:m,value:p}:{op:r,path:m,value:p})})}(e,t,o,a,s)
case 1:return function(e,t,o,a,s){let{original:l,assignedMap:c,options:u}=e,d=e.copy
d.length<l.length&&([l,d]=[d,l],[o,a]=[a,o])
for(let n=0;n<l.length;n+=1)if(c.get(n.toString())&&d[n]!==l[n]){const e=A(t.concat([n]),s)
o.push({op:r,path:e,value:k(d[n])}),a.push({op:r,path:e,value:k(l[n])})}for(let n=l.length;n<d.length;n+=1){const e=A(t.concat([n]),s)
o.push({op:i,path:e,value:k(d[n])})}if(l.length<d.length){const{arrayLengthAssignment:e=!0}=u.enablePatches
if(e){const e=A(t.concat(["length"]),s)
a.push({op:r,path:e,value:l.length})}else for(let r=d.length;l.length<r;r-=1){const e=A(t.concat([r-1]),s)
a.push({op:n,path:e})}}}(e,t,o,a,s)
case 3:return function({original:e,copy:t},r,o,a,s){let l=0
e.forEach(e=>{if(!t.has(e)){const t=A(r.concat([l]),s)
o.push({op:n,path:t,value:e}),a.unshift({op:i,path:t,value:e})}l+=1}),l=0,t.forEach(t=>{if(!e.has(t)){const e=A(r.concat([l]),s)
o.push({op:i,path:e,value:t}),a.unshift({op:n,path:e,value:t})}l+=1})}(e,t,o,a,s)}}const G=(e,t,n=!1)=>{if("object"==typeof e&&null!==e&&(!v(e,t)||n))throw new Error("Strict mode: Mutable data cannot be accessed directly, please use 'unsafe(callback)' wrap.")},H={get size(){return f(g(this)).size},has(e){return f(g(this)).has(e)},set(e,t){const n=g(this),r=f(n)
return r.has(e)&&w(r.get(e),t)||(B(n),D(n),n.assignedMap.set(e,!0),n.copy.set(e,t),V(n,e,t,U)),this},delete(e){if(!this.has(e))return!1
const t=g(this)
return B(t),D(t),t.original.has(e)?t.assignedMap.set(e,!1):t.assignedMap.delete(e),t.copy.delete(e),!0},clear(){const e=g(this)
if(this.size){B(e),D(e),e.assignedMap=new Map
for(const[t]of e.original)e.assignedMap.set(t,!1)
e.copy.clear()}},forEach(e,t){f(g(this)).forEach((n,r)=>{e.call(t,this.get(r),r,this)})},get(e){var t,n
const r=g(this),i=f(r).get(e),o=(null===(n=(t=r.options).mark)||void 0===n?void 0:n.call(t,i,l))===l.mutable
if(r.options.strict&&G(i,r.options,o),o)return i
if(r.finalized||!v(i,r.options))return i
if(i!==r.original.get(e))return i
const a=c.createDraft({original:i,parentDraft:r,key:e,finalities:r.finalities,options:r.options})
return B(r),r.copy.set(e,a),a},keys(){return f(g(this)).keys()},values(){const e=this.keys()
return{[s]:()=>this.values(),next:()=>{const t=e.next()
return t.done?t:{done:!1,value:this.get(t.value)}}}},entries(){const e=this.keys()
return{[s]:()=>this.entries(),next:()=>{const t=e.next()
if(t.done)return t
const n=this.get(t.value)
return{done:!1,value:[t.value,n]}}}},[s](){return this.entries()}},q=Reflect.ownKeys(H),Q=(e,t,{isValuesIterator:n})=>()=>{var r,i
const o=t.next()
if(o.done)return o
const a=o.value
let s=e.setMap.get(a)
const u=g(s),d=(null===(i=(r=e.options).mark)||void 0===i?void 0:i.call(r,s,l))===l.mutable
if(e.options.strict&&G(a,e.options,d),d||u||!v(a,e.options)||e.finalized||!e.original.has(a))u&&(s=u.proxy)
else{const t=c.createDraft({original:a,parentDraft:e,key:a,finalities:e.finalities,options:e.options})
e.setMap.set(a,t),s=t}return{done:!1,value:n?s:[s,s]}},$={get size(){return g(this).setMap.size},has(e){const t=g(this)
if(t.setMap.has(e))return!0
B(t)
const n=g(e)
return!(!n||!t.setMap.has(n.original))},add(e){const t=g(this)
return this.has(e)||(B(t),D(t),t.assignedMap.set(e,!0),t.setMap.set(e,e),V(t,e,e,U)),this},delete(e){if(!this.has(e))return!1
const t=g(this)
B(t),D(t)
const n=g(e)
return n&&t.setMap.has(n.original)?(t.assignedMap.set(n.original,!1),t.setMap.delete(n.original)):(!n&&t.setMap.has(e)?t.assignedMap.set(e,!1):t.assignedMap.delete(e),t.setMap.delete(e))},clear(){if(!this.size)return
const e=g(this)
B(e),D(e)
for(const t of e.original)e.assignedMap.set(t,!1)
e.setMap.clear()},values(){const e=g(this)
B(e)
const t=e.setMap.keys()
return{[Symbol.iterator]:()=>this.values(),next:Q(e,t,{isValuesIterator:!0})}},entries(){const e=g(this)
B(e)
const t=e.setMap.keys()
return{[Symbol.iterator]:()=>this.entries(),next:Q(e,t,{isValuesIterator:!1})}},keys(){return this.values()},[s](){return this.values()},forEach(e,t){const n=this.values()
let r=n.next()
for(;!r.done;)e.call(t,r.value,r.value,this),r=n.next()}}
Set.prototype.difference&&Object.assign($,{intersection(e){return Set.prototype.intersection.call(new Set(this.values()),e)},union(e){return Set.prototype.union.call(new Set(this.values()),e)},difference(e){return Set.prototype.difference.call(new Set(this.values()),e)},symmetricDifference(e){return Set.prototype.symmetricDifference.call(new Set(this.values()),e)},isSubsetOf(e){return Set.prototype.isSubsetOf.call(new Set(this.values()),e)},isSupersetOf(e){return Set.prototype.isSupersetOf.call(new Set(this.values()),e)},isDisjointFrom(e){return Set.prototype.isDisjointFrom.call(new Set(this.values()),e)}})
const X=Reflect.ownKeys($),W={get(e,t,n){var r,i
const a=null===(r=e.copy)||void 0===r?void 0:r[t]
if(a&&e.finalities.draftsCache.has(a))return a
if(t===o)return e
let s
if(e.options.mark){const r="size"===t&&(e.original instanceof Map||e.original instanceof Set)?Reflect.get(e.original,t):Reflect.get(e.original,t,n)
if(s=e.options.mark(r,l),s===l.mutable)return e.options.strict&&G(r,e.options,!0),r}const c=f(e)
if(c instanceof Map&&q.includes(t))return"size"===t?Object.getOwnPropertyDescriptor(H,"size").get.call(e.proxy):H[t].bind(e.proxy)
if(c instanceof Set&&X.includes(t))return"size"===t?Object.getOwnPropertyDescriptor($,"size").get.call(e.proxy):$[t].bind(e.proxy)
if(!u(c,t)){const n=d(c,t)
return n?"value"in n?n.value:null===(i=n.get)||void 0===i?void 0:i.call(e.proxy):void 0}const p=c[t]
if(e.options.strict&&G(p,e.options),e.finalized||!v(p,e.options))return p
if(p===C(e.original,t)){if(B(e),e.copy[t]=Y({original:e.original[t],parentDraft:e,key:1===e.type?Number(t):t,finalities:e.finalities,options:e.options}),"function"==typeof s){const n=g(e.copy[t])
return B(n),D(n),n.copy}return e.copy[t]}return m(p)&&e.finalities.draftsCache.add(p),p},set(e,t,n){var r
if(3===e.type||2===e.type)throw new Error("Map/Set draft does not support any property assignment.")
let i
if(1===e.type&&"length"!==t&&(!(Number.isInteger(i=Number(t))&&i>=0)||0!==t&&0!==i&&String(i)!==String(t)))throw new Error("Only supports setting array indices and the 'length' property.")
const o=d(f(e),t)
if(null==o?void 0:o.set)return o.set.call(e.proxy,n),!0
const a=C(f(e),t),s=g(a)
return s&&w(s.original,n)?(e.copy[t]=n,e.assignedMap=null!==(r=e.assignedMap)&&void 0!==r?r:new Map,e.assignedMap.set(t,!1),!0):(w(n,a)&&(void 0!==n||u(e.original,t))||(B(e),D(e),u(e.original,t)&&w(n,e.original[t])?e.assignedMap.delete(t):e.assignedMap.set(t,!0),e.copy[t]=n,V(e,t,n,U)),!0)},has:(e,t)=>t in f(e),ownKeys:e=>Reflect.ownKeys(f(e)),getOwnPropertyDescriptor(e,t){const n=f(e),r=Reflect.getOwnPropertyDescriptor(n,t)
return r?{writable:!0,configurable:1!==e.type||"length"!==t,enumerable:r.enumerable,value:n[t]}:r},getPrototypeOf:e=>Reflect.getPrototypeOf(e.original),setPrototypeOf(){throw new Error("Cannot call 'setPrototypeOf()' on drafts")},defineProperty(){throw new Error("Cannot call 'defineProperty()' on drafts")},deleteProperty(e,t){var n
return 1===e.type?W.set.call(this,e,t,void 0,e.proxy):(void 0!==C(e.original,t)||t in e.original?(B(e),D(e),e.assignedMap.set(t,!1)):(e.assignedMap=null!==(n=e.assignedMap)&&void 0!==n?n:new Map,e.assignedMap.delete(t)),e.copy&&delete e.copy[t],!0)}}
function Y(e){const{original:t,parentDraft:n,key:r,finalities:i,options:o}=e,a=x(t),s={type:a,finalized:!1,parent:n,original:t,copy:null,proxy:null,finalities:i,options:o,setMap:3===a?new Map(t.entries()):void 0};(r||"key"in e)&&(s.key=r)
const{proxy:l,revoke:c}=Proxy.revocable(1===a?Object.assign([],s):s,W)
if(i.revoke.push(c),s.proxy=l,n){const e=n
e.finalities.draft.push((t,n)=>{var i
const o=g(l)
let a=3===e.type?e.setMap:e.copy
const s=S(a,r),c=g(s)
if(c){let e=c.original
c.operated&&(e=y(s)),z(c),j(c,U,t,n),_(a,r,e)}null===(i=o.callbacks)||void 0===i||i.forEach(e=>{e(t,n)})})}else{const e=g(l)
e.finalities.draft.push((t,n)=>{z(e),j(e,U,t,n)})}return l}function Z(e,t,n,i,o){var a
const s=g(e),l=null!==(a=null==s?void 0:s.original)&&void 0!==a?a:e,c=!!t.length
if(null==s?void 0:s.operated)for(;s.finalities.draft.length>0;)s.finalities.draft.pop()(n,i)
const u=c?t[0]:s?s.operated?s.copy:s.original:e
return s&&T(s),o&&O(u,0,null==s||s.options.updatedValues),[u,n&&c?[{op:r,path:[],value:t[0]}]:n,i&&c?[{op:r,path:[],value:l}]:i]}function K(e){const{rootDraft:t,value:n,useRawReturn:r=!1,isRoot:i=!0}=e
L(n,(n,r,i)=>{const o=g(r)
if(o&&t&&o.finalities===t.finalities){e.isContainDraft=!0
const t=o.original
if(i instanceof Set){const e=Array.from(i)
i.clear(),e.forEach(e=>i.add(n===e?t:e))}else _(i,n,t)}else"object"==typeof r&&null!==r&&(e.value=r,e.isRoot=!1,K(e))})}function J(e){var t
const n=g(e)
if(!v(e,null==n?void 0:n.options))return e
const r=x(e)
if(n&&!n.operated)return n.original
let i
function o(){i=2===r?h(e)?new Map(e):new(Object.getPrototypeOf(e).constructor)(e):3===r?Array.from(n.setMap.values()):P(e,null==n?void 0:n.options)}if(n){n.finalized=!0
try{o()}finally{n.finalized=!1}}else i=e
if(L(i,(t,r)=>{if(n&&w(S(n.original,t),r))return
const a=J(r)
a!==r&&(i===e&&o(),_(i,t,a))}),3===r){const e=null!==(t=null==n?void 0:n.original)&&void 0!==t?t:i
return p(e)?new Set(i):new(Object.getPrototypeOf(e).constructor)(i)}return i}function ee(e){if(!m(e))throw new Error(`current() is only used for Draft, parameter: ${e}`)
return J(e)}c.createDraft=Y
Object.prototype.constructor.toString(),t.create=function e(t,n,r){var i,o,s
if("function"==typeof t&&"function"!=typeof n)return function(r,...i){return e(r,e=>t.call(this,e,...i),n)}
const c=t,u=n
let d=r
"function"!=typeof n&&(d=n),d=Object.assign(Object.assign({},undefined),d)
const p=m(c)?ee(c):c,h=Array.isArray(d.mark)?(e,t)=>{for(const n of d.mark){const r=n(e,t)
if(r)return r}}:d.mark,f=null!==(i=d.enablePatches)&&void 0!==i&&i,y=null!==(o=d.strict)&&void 0!==o&&o,b={enableAutoFreeze:null!==(s=d.enableAutoFreeze)&&void 0!==s&&s,mark:h,strict:y,enablePatches:f}
if(!v(p,b)&&"object"==typeof p&&null!==p)throw new Error("Invalid base state: create() only supports plain objects, arrays, Set, Map or using mark() to mark the state as immutable.")
const[x,S]=function(e,t){var n
const r={draft:[],revoke:[],handledSet:new WeakSet,draftsCache:new WeakSet}
let i,o
t.enablePatches&&(i=[],o=[])
const a=(null===(n=t.mark)||void 0===n?void 0:n.call(t,e,l))!==l.mutable&&v(e,t)?Y({original:e,parentDraft:null,finalities:r,options:t}):e
return[a,(e=[])=>{const[n,r,s]=Z(a,e,i,o,t.enableAutoFreeze)
return t.enablePatches?[n,r,s]:n}]}(p,b)
if("function"!=typeof n){if(!v(p,b))throw new Error("Invalid base state: create() only supports plain objects, arrays, Set, Map or using mark() to mark the state as immutable.")
return[x,S]}let _
try{_=u(x)}catch(e){throw T(g(x)),e}const C=e=>{const t=g(x)
if(!m(e)){if(void 0!==e&&!w(e,x)&&(null==t?void 0:t.operated))throw new Error("Either the value is returned as a new non-draft value, or only the draft is modified without returning any value.")
const n=null==e?void 0:e[a]
if(n){const r=n[0]
return b.strict&&"object"==typeof e&&null!==e&&K({rootDraft:t,value:e,useRawReturn:!0}),S([r])}if(void 0!==e)return"object"==typeof e&&null!==e&&K({rootDraft:t,value:e}),S([e])}if(e===x||void 0===e)return S([])
const n=g(e)
if(b===n.options){if(n.operated)throw new Error("Cannot return a modified child draft.")
return S([ee(e)])}return S([e])}
return _ instanceof Promise?_.then(C,e=>{throw T(g(x)),e}):C(_)}},18460(e,t,n){"use strict"
n.d(t,{w:()=>f,z:()=>m})
var r=n(46357),i=n(36568),o=n(19708),a=n(95916),s=n(83164),l=n(31683),c=n(32775),u=n(9043),d=n(92384),p=n(85362),h=n(5638)
const f={blurSize:d.t.Numeric(9,{min:1,max:32,step:1}),blurSpread:d.t.Numeric(1,{min:0,max:10,step:.1}),inFocus:d.t.Numeric(0,{min:-5e3,max:5e3,step:1},{description:"Distance from the scene center that will be in focus"}),PPM:d.t.Numeric(20,{min:0,max:5e3,step:.1},{description:"Size of the area that will be in focus"}),center:d.t.Select("camera-target",d.t.arrayToOptions(["scene-center","camera-target"])),mode:d.t.Select("plane",d.t.arrayToOptions(["plane","sphere"]))}
class m{static isEnabled(e){return e.enabled&&"off"!==e.dof.name}constructor(e,t,n){this.webgl=e,this.target=e.createRenderTarget(t,n,!1)
const o=(0,l.z6)()
this.renderable=function(e,t,n,o){const a=t.getWidth(),l=t.getHeight(),d={...r.OM,tDepthOpaque:u.IQ.create(n),tDepthTransparent:u.IQ.create(o),tColor:u.IQ.create(t),uTexSize:u.IQ.create(c.ZY.create(a,l)),uProjection:u.IQ.create(c.$I.identity()),uInvProjection:u.IQ.create(c.$I.identity()),uBounds:u.IQ.create((0,c.Zb)()),uCenter:u.IQ.create((0,c.eB)()),uMode:u.IQ.create(0),dOrthographic:u.IQ.create(0),uNear:u.IQ.create(1),uFar:u.IQ.create(1e4),dBlurSize:u.IQ.create(5),uBlurSpread:u.IQ.create(300),uInFocus:u.IQ.create(20),uPPM:u.IQ.create(20)},p={...g},h=(0,s.$h)(e,"triangles",y,p,d)
return(0,i._)(h,d)}(e,o,o,o)}getByteCount(){return this.target.getByteCount()}updateState(e){const{gl:t,state:n}=this.webgl
n.enable(t.SCISSOR_TEST),n.disable(t.BLEND),n.disable(t.DEPTH_TEST),n.depthMask(!1)
const{x:r,y:i,width:o,height:a}=e
n.viewport(r,i,o,a),n.scissor(r,i,o,a),n.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT)}setSize(e,t){const n=this.target.texture.getWidth(),r=this.target.texture.getHeight()
e===n&&t===r||(this.target.setSize(e,t),u.IQ.update(this.renderable.values.uTexSize,c.ZY.set(this.renderable.values.uTexSize.ref.value,e,t)))}update(e,t,n,r,i,o){let a=!1
this.renderable.values.tColor.ref.value!==t&&(u.IQ.update(this.renderable.values.tColor,t),a=!0),this.renderable.values.tDepthOpaque.ref.value!==n&&(u.IQ.update(this.renderable.values.tDepthOpaque,n),a=!0),this.renderable.values.tDepthTransparent.ref.value!==r&&(u.IQ.update(this.renderable.values.tDepthTransparent,r),a=!0)
const s="orthographic"===e.state.mode?1:0,l=this.renderable.values.uInvProjection.ref.value
c.$I.invert(l,e.projection)
const[d,p]=this.renderable.values.uTexSize.ref.value,h=e.viewport
u.IQ.update(this.renderable.values.uProjection,e.projection),u.IQ.update(this.renderable.values.uInvProjection,l),u.IQ.update(this.renderable.values.uMode,"sphere"===i.mode?1:0),c.Zb.set(this.renderable.values.uBounds.ref.value,h.x/d,h.y/p,(h.x+h.width)/d,(h.y+h.height)/p),u.IQ.update(this.renderable.values.uBounds,this.renderable.values.uBounds.ref.value),u.IQ.updateIfChanged(this.renderable.values.uNear,e.near),u.IQ.updateIfChanged(this.renderable.values.uFar,e.far),u.IQ.updateIfChanged(this.renderable.values.dOrthographic,s)
const f=Math.round(i.blurSize*this.webgl.pixelRatio)
this.renderable.values.dBlurSize.ref.value!==f&&(u.IQ.update(this.renderable.values.dBlurSize,f),a=!0)
const m="scene-center"===i.center?o.center:e.state.target,g=c.eB.distance(e.state.position,m)+i.inFocus
u.IQ.updateIfChanged(this.renderable.values.uInFocus,g*e.scale)
const y=this.renderable.values.uCenter.ref.value
c.eB.transformMat4(y,m,e.view),u.IQ.update(this.renderable.values.uCenter,y),u.IQ.updateIfChanged(this.renderable.values.uBlurSpread,i.blurSpread),u.IQ.updateIfChanged(this.renderable.values.uPPM,i.PPM*e.scale),a&&this.renderable.update()}render(e,t){h.g$&&this.webgl.timer.mark("DofPass.render"),t?t.bind():this.webgl.bindDrawingBuffer(),this.updateState(e),this.renderable.render(),h.g$&&this.webgl.timer.markEnd("DofPass.render")}}const g={...r.du,tDepthOpaque:(0,o.$G)("texture","rgba","ubyte","nearest"),tDepthTransparent:(0,o.$G)("texture","rgba","ubyte","nearest"),tColor:(0,o.$G)("texture","rgba","ubyte","nearest"),uTexSize:(0,o.w5)("v2"),uProjection:(0,o.w5)("m4"),uInvProjection:(0,o.w5)("m4"),uBounds:(0,o.w5)("v4"),uCenter:(0,o.w5)("v3"),uMode:(0,o.w5)("i"),dOrthographic:(0,o.$F)("number"),uNear:(0,o.w5)("f"),uFar:(0,o.w5)("f"),dBlurSize:(0,o.$F)("number"),uBlurSpread:(0,o.w5)("f"),uInFocus:(0,o.w5)("f"),uPPM:(0,o.w5)("f")},y=(0,a.NG)("dof",p.e,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\n#include common\n\nuniform sampler2D tColor;\nuniform sampler2D tDepthOpaque;\nuniform sampler2D tDepthTransparent;\n\nuniform vec2 uTexSize;\nuniform vec4 uBounds;\n\nuniform float uBlurSpread;\nuniform float uInFocus;\nuniform float uPPM;\n\nuniform float uNear; // Near plane\nuniform float uFar;  // Far plane\n\nuniform mat4 uInvProjection; // Inverse projection\nuniform mat4 uProjection; // projection\n\nuniform int uMode; // 0-planar, 1-spherical\nuniform vec3 uCenter; // Center of focus sphere in view space\n\n// Function to convert depth value from depth buffer to view space Z\nfloat getViewZ(const in float depth) {\n    #if dOrthographic == 1\n        return orthographicDepthToViewZ(depth, uNear, uFar);\n    #else\n        return perspectiveDepthToViewZ(depth, uNear, uFar);\n    #endif\n}\n\n// Retrieve depth from opaque depth texture\nfloat getDepthOpaque(const in vec2 coords) {\n    #ifdef depthTextureSupport\n        return texture2D(tDepthOpaque, coords).r;\n    #else\n        return unpackRGBAToDepth(texture2D(tDepthOpaque, coords));\n    #endif\n}\n\n// Retrieve depth from transparent depth texture\nfloat getDepthTransparent(const in vec2 coords) {\n    return unpackRGBAToDepthWithAlpha(texture2D(tDepthTransparent, coords)).x;\n}\n\nbool isBackground(const in float depth) {\n    return depth == 1.0;\n}\n\nfloat getDepth(const in vec2 coords) {\n    return min(getDepthOpaque(coords), getDepthTransparent(coords));\n}\n\nfloat getCOC(vec2 uv) {\n    float depth = getDepth(uv);\n    float viewDist = getViewZ(depth);\n    vec3 aposition = screenSpaceToViewSpace(vec3(uv.xy, depth), uInvProjection);\n    float focusDist = length(aposition - uCenter);\n    float coc = 0.0;  // Circle of Confusion\n    if (uMode == 0) { // planar Depth of field\n        coc = (abs(viewDist) - uInFocus) / uPPM;  //focus distance, focus range\n    } else if(uMode == 1) { // spherical Depth of field\n        coc = focusDist / uPPM ;\n    }\n    coc = clamp(coc, -1.0, 1.0);\n    return coc;\n}\n\n// Simple box blur for blurring the image\nvec3 getBlurredImage(vec2 coords) {\n    vec4 blurColor = vec4(0);\n    vec2 texelSize = vec2(1.0 / uTexSize.x, 1.0 / uTexSize.y);\n    float count = 0.0;\n    for (int x = 0; x < int(dBlurSize); x++) {\n        for (int y = 0; y < int(dBlurSize); y++) {\n            vec2 offset = vec2(float(x) - float(dBlurSize) / 2.0, float(y) - float(dBlurSize) / 2.0);\n            vec2 uvPixel = coords.xy + offset * texelSize * uBlurSpread;\n            float coc = getCOC(uvPixel);\n            coc = smoothstep(0.0, 1.0, abs(coc));\n            // mix blurColor with new color with weight coc\n            blurColor.rgb = blurColor.rgb + texture2D(tColor, uvPixel).xyz * coc;\n            count+=coc;\n        }\n    }\n    blurColor = blurColor / count;\n    return blurColor.rgb;\n}\n\n// simplification from https://catlikecoding.com/unity/tutorials/advanced-rendering/depth-of-field/\nvoid main() {\n    vec2 uv = gl_FragCoord.xy / uTexSize;\n    vec4 color = texture2D(tColor, uv);\n    float depth = getDepth(uv);\n\n    float viewDist = getViewZ(depth);\n\n    vec3 aposition = screenSpaceToViewSpace(vec3(uv.xy, depth), uInvProjection);\n    float focusDist = length(aposition - uCenter);\n    vec3 blurColor = getBlurredImage(uv);\n\n    float coc = getCOC(uv); // Circle of Confusion\n\n    // for debugging the coc\n    // color.rgb = (coc < 0.0) ? (1.0 - abs(coc)) * vec3(1.0,0.0,0.0) : vec3(0.0, 1.0 - coc, 0.0) ;//mix(color.rgb, blurColor.rgb, abs(coc));\n    color.rgb = mix(color.rgb, blurColor, smoothstep(0.0, 1.0, abs(coc))); // Smooth blending based on CoC\n    gl_FragColor = color;\n}\n")},18891(e,t,n){"use strict"
function r(e){return"function"==typeof e}n.d(t,{T:()=>r})},19231(e,t,n){"use strict"
n.d(t,{Zl:()=>c,ag:()=>a,mT:()=>l,u_:()=>s})
var r=n(45996),i=n(13564),o=n(92384)
function a(){return o.t.Group({color:o.t.Color(r.Q1.fromRgb(76,76,76)),colorStrength:o.t.Numeric(1,{min:0,max:1,step:.01}),substance:i.i.getParam(),substanceStrength:o.t.Numeric(1,{min:0,max:1,step:.01})})}function s(e,t){return e.color===t.color&&e.colorStrength===t.colorStrength&&i.i.areEqual(e.substance,t.substance)&&e.substanceStrength===t.substanceStrength}function l(e,t){return r.Q1.toArrayNormalized(e.color,t,0),t[3]=e.colorStrength,t}function c(e,t){return i.i.toArrayNormalized(e.substance,t,0),t[3]=e.substanceStrength,t}},19288(e,t,n){"use strict"
n.r(t),n.d(t,{PluginConfig:()=>l,PluginConfigItem:()=>a,PluginConfigManager:()=>c})
var r=n(48393),i=n(72169)
const o={get defaultTransparency(){return(0,i.HE)()?"blended":"wboit"},get preferWebGl1(){return"undefined"!=typeof navigator&&"undefined"!=typeof window&&(!!["Version/15.1 Safari","Version/15.2 Safari","Version/15.3 Safari"].some(e=>navigator.userAgent.indexOf(e)>0)||(0,i.HE)())}}
class a{toString(){return this.key}valueOf(){return this.key}constructor(e,t){this.key=e,this.defaultValue=t}}function s(e,t){return new a(e,t)}const l={item:s,General:{IsBusyTimeoutMs:s("plugin-config.is-busy-timeout",750),DisableAntialiasing:s("plugin-config.disable-antialiasing",!1),DisablePreserveDrawingBuffer:s("plugin-config.disable-preserve-drawing-buffer",!1),PixelScale:s("plugin-config.pixel-scale",1),PickScale:s("plugin-config.pick-scale",.25),Transparency:s("plugin-config.transparency",o.defaultTransparency),PreferWebGl1:s("plugin-config.prefer-webgl1",o.preferWebGl1),AllowMajorPerformanceCaveat:s("plugin-config.allow-major-performance-caveat",!1),PowerPreference:s("plugin-config.power-preference","high-performance"),ResolutionMode:s("plugin-config.resolution-mode","auto")},State:{DefaultServer:s("plugin-state.server","https://webchem.ncbr.muni.cz/molstar-state"),CurrentServer:s("plugin-state.server","https://webchem.ncbr.muni.cz/molstar-state"),HistoryCapacity:s("history-capacity.server",5)},VolumeStreaming:{Enabled:s("volume-streaming.enabled",!0),DefaultServer:s("volume-streaming.server","https://ds.litemol.org"),CanStream:s("volume-streaming.can-stream",(e,t)=>1===e.models.length&&r.Model.probablyHasDensityMap(e.models[0])),EmdbHeaderServer:s("volume-streaming.emdb-header-server","https://files.wwpdb.org/pub/emdb/structures")},Viewport:{ShowReset:s("viewer.show-reset-button",!0),ShowExpand:s("viewer.show-expand-button",!0),ShowToggleFullscreen:s("viewer.show-toggle-fullscreen-button",!0),ShowControls:s("viewer.show-controls-button",!0),ShowSettings:s("viewer.show-settings-button",!0),ShowSelectionMode:s("viewer.show-selection-model-button",!0),ShowAnimation:s("viewer.show-animation-button",!0),ShowTrajectoryControls:s("viewer.show-trajectory-controls",!0),ShowScreenshotControls:s("viewer.show-screenshot-controls",!0),ShowIllumination:s("viewer.show-illumination-button",!0),ShowXR:s("viewer.show-xr","always")},Download:{DefaultPdbProvider:s("download.default-pdb-provider","pdbe"),DefaultEmdbProvider:s("download.default-emdb-provider","pdbe")},Structure:{SizeThresholds:s("structure.size-thresholds",r.Structure.DefaultSizeThresholds),DefaultRepresentationPreset:s("structure.default-representation-preset","auto"),DefaultRepresentationPresetParams:s("structure.default-representation-preset-params",{}),SaccharideCompIdMapType:s("structure.saccharide-comp-id-map-type","default")},Background:{Styles:s("background.styles",[])}}
class c{get(e){return this._config.has(e)?this._config.get(e):e.defaultValue}set(e,t){this._config.set(e,t)}delete(e){this._config.delete(e)}constructor(e){this._config=new Map,e&&e.forEach(([e,t])=>this._config.set(e,t))}}},19379(e,t,n){"use strict"
function r(e,t,n){return n?.forceNumber&&("number"!=typeof e&&(e=Number(e)),"number"!=typeof t&&(t=Number(t))),e>=t}n.r(t),n.d(t,{default:()=>r})},19613(e,t,n){"use strict"
n.d(t,{$d:()=>a,Ev:()=>s})
var r=n(79111),i=n(92384)
const o={}
function a(e,t){return{factory:a,granularity:"groupInstance",size:e=>r.$.isLocation(e)?e.shape.getSize(e.group,e.instance):1,props:t,description:"Assigns sizes as defined by the shape object."}}const s={name:"shape-group",label:"Shape Group",category:"",factory:a,getParams:function(e){return o},defaultValues:i.t.getDefaultValues(o),isApplicable:e=>!!e.shape}},19708(e,t,n){"use strict"
function r(e,t){const n={},r={},i={},o={},a={},s={},l={}
return Object.keys(e).forEach(c=>{const u=e[c]
"attribute"===u.type&&(n[c]=t[c]),"define"===u.type&&(r[c]=t[c]),"texture"===u.type&&void 0!==t[c]&&("material"===u.variant?o[c]=t[c]:i[c]=t[c]),"uniform"===u.type&&void 0!==t[c]&&("material"===u.variant?s[c]=t[c]:"buffered"===u.variant?l[c]=t[c]:a[c]=t[c])}),{attributeValues:n,defineValues:r,textureValues:i,materialTextureValues:o,uniformValues:a,materialUniformValues:s,bufferedUniformValues:l}}function i(e){const t={}
return Object.keys(e).forEach(n=>{t[n]=e[n].ref.version}),t}function o(e,t,n){return{type:"attribute",kind:e,itemSize:t,divisor:n}}function a(e,t){return{type:"uniform",kind:e,variant:t}}function s(e,t,n,r,i){return{type:"texture",kind:e,format:t,dataType:n,filter:r,variant:i}}function l(e){return{type:"elements",kind:e}}function c(e,t){return{type:"define",kind:e,options:t}}function u(e){return{type:"value",kind:e}}n.d(t,{$F:()=>c,$G:()=>s,DQ:()=>C,Hw:()=>g,X9:()=>d,Xb:()=>u,Xs:()=>l,Y2:()=>h,YU:()=>p,Yz:()=>o,fb:()=>i,rG:()=>f,tC:()=>r,w5:()=>a})
const d={uDrawId:a("i"),uModel:a("m4"),uView:a("m4"),uInvView:a("m4"),uModelView:a("m4"),uInvModelView:a("m4"),uProjection:a("m4"),uInvProjection:a("m4"),uModelViewProjection:a("m4"),uInvModelViewProjection:a("m4"),uHasHeadRotation:a("b"),uInvHeadRotation:a("m4"),uIsAsymmetricProjection:a("b"),uHasEyeCamera:a("b"),uModelViewEye:a("m4"),uInvModelViewEye:a("m4"),uIsOrtho:a("f"),uPixelRatio:a("f"),uViewport:a("v4"),uViewOffset:a("v2"),uModelScale:a("f"),uDrawingBufferSize:a("v2"),uCameraPosition:a("v3"),uCameraDir:a("v3"),uCameraPlane:a("v4"),uNear:a("f"),uFar:a("f"),uFog:a("b"),uFogNear:a("f"),uFogFar:a("f"),uFogColor:a("v3"),uTransparentBackground:a("b"),uLightDirection:a("v3[]"),uLightColor:a("v3[]"),uAmbientColor:a("v3"),uPickingAlphaThreshold:a("f"),uHighlightColor:a("v3"),uSelectColor:a("v3"),uDimColor:a("v3"),uHighlightStrength:a("f"),uSelectStrength:a("f"),uDimStrength:a("f"),uMarkerPriority:a("i"),uMarkerAverage:a("f"),uXrayEdgeFalloff:a("f"),uCelSteps:a("f"),uExposure:a("f"),uRenderMask:a("i"),uMarkingDepthTest:a("b"),uMarkingType:a("i"),uPickType:a("i")},p={tDepth:s("texture","depth","ushort","nearest"),tDpoitDepth:s("texture","rg","float","nearest"),tDpoitFrontColor:s("texture","rgba","float","nearest"),tDpoitBackColor:s("texture","rgba","float","nearest")},h={dLightCount:c("number"),dColorMarker:c("boolean")},f={uObjectId:a("i")},m={uColor:a("v3","material"),uColorTexDim:a("v2"),uColorGridDim:a("v3"),uColorGridTransform:a("v4"),uPaletteDomain:a("v2"),uPaletteDefault:a("v3"),tColor:s("image-uint8","rgb","ubyte","nearest"),tPalette:s("image-uint8","rgb","ubyte","nearest"),tColorGrid:s("texture","rgb","ubyte","linear"),dColorType:c("string",["uniform","attribute","instance","group","groupInstance","vertex","vertexInstance","volume","volumeInstance","direct"]),dUsePalette:c("boolean")},g={uSize:a("f","material"),uSizeTexDim:a("v2"),tSize:s("image-uint8","rgb","ubyte","nearest"),dSizeType:c("string",["uniform","attribute","instance","group","groupInstance"]),uSizeFactor:a("f","material")},y={uMarker:a("f"),uMarkerTexDim:a("v2"),tMarker:s("image-uint8","alpha","ubyte","nearest"),markerAverage:u("number"),markerStatus:u("number"),dMarkerType:c("string",["instance","groupInstance"])},v={uOverpaintTexDim:a("v2"),tOverpaint:s("image-uint8","rgba","ubyte","nearest"),dOverpaint:c("boolean"),uOverpaintGridDim:a("v3"),uOverpaintGridTransform:a("v4"),tOverpaintGrid:s("texture","rgba","ubyte","linear"),dOverpaintType:c("string",["instance","groupInstance","volumeInstance"]),uOverpaintStrength:a("f","material")},b={uTransparencyTexDim:a("v2"),tTransparency:s("image-uint8","alpha","ubyte","nearest"),dTransparency:c("boolean"),transparencyAverage:u("number"),transparencyMin:u("number"),uTransparencyGridDim:a("v3"),uTransparencyGridTransform:a("v4"),tTransparencyGrid:s("texture","alpha","ubyte","linear"),dTransparencyType:c("string",["instance","groupInstance","volumeInstance"]),uTransparencyStrength:a("f","material")},x={uEmissiveTexDim:a("v2"),tEmissive:s("image-uint8","alpha","ubyte","nearest"),dEmissive:c("boolean"),emissiveAverage:u("number"),uEmissiveGridDim:a("v3"),uEmissiveGridTransform:a("v4"),tEmissiveGrid:s("texture","alpha","ubyte","linear"),dEmissiveType:c("string",["instance","groupInstance","volumeInstance"]),uEmissiveStrength:a("f","material")},S={uSubstanceTexDim:a("v2"),tSubstance:s("image-uint8","rgba","ubyte","nearest"),dSubstance:c("boolean"),uSubstanceGridDim:a("v3"),uSubstanceGridTransform:a("v4"),tSubstanceGrid:s("texture","rgba","ubyte","linear"),dSubstanceType:c("string",["instance","groupInstance","volumeInstance"]),uSubstanceStrength:a("f","material")},_={uClippingTexDim:a("v2"),tClipping:s("image-uint8","alpha","ubyte","nearest"),dClipping:c("boolean"),dClippingType:c("string",["instance","groupInstance"])},C={dGeometryType:c("string",["cylinders","directVolume","image","lines","mesh","points","spheres","text","textureMesh"]),...m,...y,...v,...b,...x,...S,..._,dClipObjectCount:c("number"),dClipVariant:c("string",["instance","pixel"]),uClipObjectType:a("i[]","material"),uClipObjectInvert:a("b[]","material"),uClipObjectPosition:a("v3[]","material"),uClipObjectRotation:a("v4[]","material"),uClipObjectScale:a("v3[]","material"),uClipObjectTransform:a("m4[]","material"),aInstance:o("float32",1,1),aTransform:o("float32",16,1),uAlpha:a("f","material"),uMetalness:a("f","material"),uRoughness:a("f","material"),uBumpiness:a("f","material"),uEmissive:a("f","material"),uDensity:a("f","material"),uVertexCount:a("i"),uInstanceCount:a("i"),uGroupCount:a("i"),uInvariantBoundingSphere:a("v4"),uLod:a("v4"),drawCount:u("number"),instanceCount:u("number"),alpha:u("number"),matrix:u("m4"),transform:u("float32"),extraTransform:u("float32"),hasReflection:u("boolean"),instanceGranularity:u("boolean"),boundingSphere:u("sphere"),invariantBoundingSphere:u("sphere"),instanceGrid:u("instanceGrid")}},19912(e,t,n){"use strict"
function r([e]){return Math.floor(e)}n.r(t),n.d(t,{default:()=>i,floor:()=>r})
var i=(0,n(10336).helper)(r)},20276(e,t,n){"use strict"
n.d(t,{_:()=>j})
var r=n(36568),i=n(83164),o=n(19708),a=n(95916),s=n(9043),l=n(32775),c=n(46357),u=n(53138),d=n(85362),p=n(24060),h=n(5638)
const f={...c.du,tTexture:(0,o.$G)("texture","rgba","float","nearest")},m="histopyramid-sum"
function g(e,t){if(e.namedComputeRenderables[m]){const n=e.namedComputeRenderables[m].values
s.IQ.update(n.tTexture,t),e.namedComputeRenderables[m].update()}else e.namedComputeRenderables[m]=function(e,t){const n={...c.OM,tTexture:s.IQ.create(t)},o={...f},l=(0,a.NG)("sum",d.e,"\nprecision highp float;\nprecision highp int;\n\n#if __VERSION__ == 100\n    precision highp sampler2D;\n    uniform sampler2D tTexture;\n#else\n    precision highp isampler2D;\n    uniform isampler2D tTexture;\n#endif\n\nvoid main(void) {\n    #if __VERSION__ == 100\n        gl_FragColor = texture2D(tTexture, vec2(0.5));\n    #else\n        gl_FragColor = ivec4(texture2D(tTexture, vec2(0.5)).r);\n    #endif\n}\n",{},{0:"ivec4"}),u=(0,i.$h)(e,"triangles",l,o,n)
return(0,r._)(u,n)}(e,t)
return e.namedComputeRenderables[m]}const y=new Uint8Array(4),v=new Int32Array(4)
var b=n(87423)
const x={...c.du,tInputLevel:(0,o.$G)("texture","rgba","float","nearest"),tPreviousLevel:(0,o.$G)("texture","rgba","float","nearest"),uSize:(0,o.w5)("f"),uTexSize:(0,o.w5)("f"),uFirst:(0,o.w5)("b")},S="histogram-pyramid"
function _(e,t,n){if(e.namedComputeRenderables[S]){const r=e.namedComputeRenderables[S].values
s.IQ.update(r.tInputLevel,t),s.IQ.update(r.tPreviousLevel,n),e.namedComputeRenderables[S].update()}else e.namedComputeRenderables[S]=function(e,t,n){const o={...c.OM,tInputLevel:s.IQ.create(t),tPreviousLevel:s.IQ.create(n),uSize:s.IQ.create(0),uTexSize:s.IQ.create(0),uFirst:s.IQ.create(!0)},l={...x},u=(0,a.NG)("reduction",d.e,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tInputLevel;\n\n// previous level used to evaluate the new level\n#if __VERSION__ == 100\n    uniform sampler2D tPreviousLevel;\n#else\n    precision highp isampler2D;\n    uniform isampler2D tPreviousLevel;\n#endif\n\n// inverted size of the previous level texture.\nuniform float uSize;\nuniform float uTexSize;\nuniform bool uFirst;\n\n#include common\n\nvoid main(void) {\n    float k = 0.5 * uSize;\n    vec2 position = floor((gl_FragCoord.xy / uTexSize) / uSize) * uSize;\n\n    #if __VERSION__ == 100\n        float a, b, c, d;\n\n        if (uFirst) {\n            a = texture2D(tInputLevel, position).r * 255.0;\n            b = texture2D(tInputLevel, position + vec2(k, 0.0)).r * 255.0;\n            c = texture2D(tInputLevel, position + vec2(0.0, k)).r * 255.0;\n            d = texture2D(tInputLevel, position + vec2(k, k)).r * 255.0;\n        } else {\n            a = unpackRGBToInt(texture2D(tPreviousLevel, position).rgb);\n            b = unpackRGBToInt(texture2D(tPreviousLevel, position + vec2(k, 0.0)).rgb);\n            c = unpackRGBToInt(texture2D(tPreviousLevel, position + vec2(0.0, k)).rgb);\n            d = unpackRGBToInt(texture2D(tPreviousLevel, position + vec2(k, k)).rgb);\n        }\n        gl_FragColor = vec4(packIntToRGB(a + b + c + d), 1.0);\n    #else\n        int a, b, c, d;\n\n        if (uFirst) {\n            a = int(texture2D(tInputLevel, position).r * 255.0);\n            b = int(texture2D(tInputLevel, position + vec2(k, 0.0)).r * 255.0);\n            c = int(texture2D(tInputLevel, position + vec2(0.0, k)).r * 255.0);\n            d = int(texture2D(tInputLevel, position + vec2(k, k)).r * 255.0);\n        } else {\n            a = texture2D(tPreviousLevel, position).r;\n            b = texture2D(tPreviousLevel, position + vec2(k, 0.0)).r;\n            c = texture2D(tPreviousLevel, position + vec2(0.0, k)).r;\n            d = texture2D(tPreviousLevel, position + vec2(k, k)).r;\n        }\n        gl_FragColor = ivec4(a + b + c + d);\n    #endif\n}\n",{},{0:"ivec4"}),p=(0,i.$h)(e,"triangles",u,l,o)
return(0,r._)(p,o)}(e,t,n)
return e.namedComputeRenderables[S]}function C(e,t){const n=Math.pow(2,t),r=`level${t}`,i=e.isWebGL2?T(r,e,"image-int32","alpha","int","nearest"):T(r,e,"image-uint8","rgba","ubyte","nearest")
i.define(n,n)
let o=function(e,t){const n=`${S}-${e}`
return t.namedFramebuffers[n]}(r,e)
return o||(o=w(r,e)),i.attachFramebuffer(o,0),{texture:i,framebuffer:o}}function w(e,t){const n=`${S}-${e}`
return t.namedFramebuffers[n]||(t.namedFramebuffers[n]=t.resources.framebuffer()),t.namedFramebuffers[n]}function T(e,t,n,r,i,o){const a=`${S}-${e}`
return t.namedTextures[a]||(t.namedTextures[a]=t.resources.texture(n,r,i,o)),t.namedTextures[a]}var A=n(42629),I=n(31727)
let P,B
function E(){if(void 0!==P)return P
P=(0,I.xg)(256,1,Uint8Array)
const{array:e}=P
for(let t=0,n=A.sE.length;t<n;++t)e[t]=A.sE[t].length/3
return P}function k(){if(void 0!==B)return B
B=(0,I.xg)(4096,1,Uint8Array)
const{array:e}=B
for(let t=0,n=A.sE.length;t<n;++t)for(let r=0;r<16;++r)r<A.sE[t].length?e[16*t+r]=A.sE[t][r]:e[16*t+r]=255
return B}const D={...c.du,tTriCount:(0,o.$G)("image-uint8","alpha","ubyte","nearest"),tVolumeData:(0,o.$G)("texture","rgba","ubyte","nearest"),dValueChannel:(0,o.$F)("string",["red","alpha"]),uIsoValue:(0,o.w5)("f"),uGridDim:(0,o.w5)("v3"),uGridTexDim:(0,o.w5)("v3"),uScale:(0,o.w5)("v2")},M="active-voxels"
function R(e,t){return(0,p.C6)(e.gl)&&t.format===e.gl.RED?"red":"alpha"}function O(e,t,n,o,l,u){if(e.namedComputeRenderables[M]){const r=e.namedComputeRenderables[M].values
s.IQ.update(r.uQuadScale,u),s.IQ.update(r.tVolumeData,t),s.IQ.update(r.dValueChannel,R(e,t)),s.IQ.updateIfChanged(r.uIsoValue,l),s.IQ.update(r.uGridDim,n),s.IQ.update(r.uGridTexDim,o),s.IQ.update(r.uScale,u),e.namedComputeRenderables[M].update()}else e.namedComputeRenderables[M]=function(e,t,n,o,l,u){const p={...c.OM,tTriCount:s.IQ.create(E()),uQuadScale:s.IQ.create(u),tVolumeData:s.IQ.create(t),dValueChannel:s.IQ.create(R(e,t)),uIsoValue:s.IQ.create(l),uGridDim:s.IQ.create(n),uGridTexDim:s.IQ.create(o),uScale:s.IQ.create(u)},h={...D},f=(0,a.NG)("active-voxels",d.e,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tTriCount;\nuniform sampler2D tVolumeData;\n\nuniform float uIsoValue;\nuniform vec3 uGridDim;\nuniform vec3 uGridTexDim;\nuniform vec2 uScale;\n\n#include common\n\n// cube corners (excluding origin)\nconst vec3 c1 = vec3(1., 0., 0.);\nconst vec3 c2 = vec3(1., 1., 0.);\nconst vec3 c3 = vec3(0., 1., 0.);\nconst vec3 c4 = vec3(0., 0., 1.);\nconst vec3 c5 = vec3(1., 0., 1.);\nconst vec3 c6 = vec3(1., 1., 1.);\nconst vec3 c7 = vec3(0., 1., 1.);\n\nvec3 index3dFrom2d(vec2 coord) {\n    vec2 gridTexPos = coord * uGridTexDim.xy;\n    vec2 columnRow = ivec2Div(gridTexPos, uGridDim.xy);\n    vec2 posXY = gridTexPos - columnRow * uGridDim.xy;\n    float posZ = columnRow.y * intDiv(uGridTexDim.x, uGridDim.x) + columnRow.x;\n    return vec3(posXY, posZ);\n}\n\nvec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {\n    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice\n    float column = intDiv(intMod(zSlice * gridDim.x, texDim.x), gridDim.x);\n    float row = intDiv(zSlice * gridDim.x, texDim.x);\n    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / (texDim / uScale);\n    return texture2D(tex, coord);\n}\n\nfloat voxelValue(vec3 pos) {\n    pos = min(max(vec3(0.0), pos), uGridDim - vec3(1.0));\n    vec4 v = texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);\n    #ifdef dValueChannel_red\n        return v.r;\n    #else\n        return v.a;\n    #endif\n}\n\nvoid main(void) {\n    vec2 uv = gl_FragCoord.xy / uGridTexDim.xy;\n    vec3 posXYZ = index3dFrom2d(uv);\n\n    // get MC case as the sum of corners that are below the given iso level\n    float c = step(voxelValue(posXYZ), uIsoValue)\n        + 2. * step(voxelValue(posXYZ + c1), uIsoValue)\n        + 4. * step(voxelValue(posXYZ + c2), uIsoValue)\n        + 8. * step(voxelValue(posXYZ + c3), uIsoValue)\n        + 16. * step(voxelValue(posXYZ + c4), uIsoValue)\n        + 32. * step(voxelValue(posXYZ + c5), uIsoValue)\n        + 64. * step(voxelValue(posXYZ + c6), uIsoValue)\n        + 128. * step(voxelValue(posXYZ + c7), uIsoValue);\n    c *= step(c, 254.);\n\n    // handle out of bounds positions\n    posXYZ += 1.0;\n    posXYZ.xy += 1.0; // pixel padding (usually ok even if the texture has no padding)\n    if (posXYZ.x >= uGridDim.x || posXYZ.y >= uGridDim.y || posXYZ.z >= uGridDim.z)\n        c = 0.0;\n\n    // get total triangles to generate for calculated MC case from triCount texture\n    float totalTrianglesToGenerate = texture2D(tTriCount, vec2(intMod(c, 16.), floor(c / 16.)) / 16.).a;\n    gl_FragColor = vec4(vec3(totalTrianglesToGenerate * 3.0), c / 255.0);\n}\n"),m=(0,i.$h)(e,"triangles",f,h,p)
return(0,r._)(m,p)}(e,t,n,o,l,u)
return e.namedComputeRenderables[M]}const L={...c.du,tTriIndices:(0,o.$G)("image-uint8","alpha","ubyte","nearest"),tActiveVoxelsPyramid:(0,o.$G)("texture","rgba","float","nearest"),tActiveVoxelsBase:(0,o.$G)("texture","rgba","float","nearest"),tVolumeData:(0,o.$G)("texture","rgba","ubyte","nearest"),dValueChannel:(0,o.$F)("string",["red","alpha"]),uIsoValue:(0,o.w5)("f"),uSize:(0,o.w5)("f"),uLevels:(0,o.w5)("f"),uCount:(0,o.w5)("f"),uInvert:(0,o.w5)("b"),uGridDim:(0,o.w5)("v3"),uGridTexDim:(0,o.w5)("v3"),uGridDataDim:(0,o.w5)("v3"),uGridTransform:(0,o.w5)("m4"),uGridTransformAdjoint:(0,o.w5)("m3"),uScale:(0,o.w5)("v2"),dPackedGroup:(0,o.$F)("boolean"),dAxisOrder:(0,o.$F)("string",["012","021","102","120","201","210"]),dConstantGroup:(0,o.$F)("boolean")},N="isosurface"
function F(e,t){return(0,p.C6)(e.gl)&&t.format===e.gl.RED?"red":"alpha"}function z(e,t,n,o,u,p,h,f,m,g,y,v,b,x,S,_){if(e.namedComputeRenderables[N]){const r=e.namedComputeRenderables[N].values
s.IQ.update(r.tActiveVoxelsPyramid,t),s.IQ.update(r.tActiveVoxelsBase,n),s.IQ.update(r.tVolumeData,o),s.IQ.update(r.dValueChannel,F(e,o)),s.IQ.updateIfChanged(r.uIsoValue,m),s.IQ.updateIfChanged(r.uSize,Math.pow(2,g)),s.IQ.updateIfChanged(r.uLevels,g),s.IQ.updateIfChanged(r.uCount,v),s.IQ.updateIfChanged(r.uInvert,b),s.IQ.update(r.uGridDim,u),s.IQ.update(r.uGridTexDim,p),s.IQ.update(r.uGridDataDim,h),s.IQ.update(r.uGridTransform,f),s.IQ.update(r.uGridTransformAdjoint,l.U.adjointFromMat4((0,l.U)(),f)),s.IQ.update(r.uScale,y),s.IQ.updateIfChanged(r.dPackedGroup,x),s.IQ.updateIfChanged(r.dAxisOrder,S.join("")),s.IQ.updateIfChanged(r.dConstantGroup,_),e.namedComputeRenderables[N].update()}else e.namedComputeRenderables[N]=function(e,t,n,o,u,p,h,f,m,g,y,v,b,x,S,_){const C={...c.OM,tTriIndices:s.IQ.create(k()),tActiveVoxelsPyramid:s.IQ.create(t),tActiveVoxelsBase:s.IQ.create(n),tVolumeData:s.IQ.create(o),dValueChannel:s.IQ.create(F(e,o)),uIsoValue:s.IQ.create(m),uSize:s.IQ.create(Math.pow(2,g)),uLevels:s.IQ.create(g),uCount:s.IQ.create(v),uInvert:s.IQ.create(b),uGridDim:s.IQ.create(u),uGridTexDim:s.IQ.create(p),uGridDataDim:s.IQ.create(h),uGridTransform:s.IQ.create(f),uGridTransformAdjoint:s.IQ.create(l.U.adjointFromMat4((0,l.U)(),f)),uScale:s.IQ.create(y),dPackedGroup:s.IQ.create(x),dAxisOrder:s.IQ.create(S.join("")),dConstantGroup:s.IQ.create(_)},w={...L},T=(0,a.NG)("isosurface",d.e,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\n#if __VERSION__ == 100\n    uniform sampler2D tActiveVoxelsPyramid;\n#else\n    precision highp isampler2D;\n    uniform isampler2D tActiveVoxelsPyramid;\n#endif\n\nuniform sampler2D tActiveVoxelsBase;\nuniform sampler2D tVolumeData;\nuniform sampler2D tTriIndices;\n\nuniform float uIsoValue;\nuniform float uLevels;\nuniform float uSize;\nuniform float uCount;\nuniform bool uInvert;\n\nuniform vec3 uGridDim;\nuniform vec3 uGridTexDim;\nuniform vec3 uGridDataDim;\nuniform mat4 uGridTransform;\nuniform mat3 uGridTransformAdjoint;\n\n// scale to volume data coord\nuniform vec2 uScale;\n\n#include common\n\n// cube corners (excluding origin)\nconst vec3 c1 = vec3(1., 0., 0.);\nconst vec3 c2 = vec3(1., 1., 0.);\nconst vec3 c3 = vec3(0., 1., 0.);\nconst vec3 c4 = vec3(0., 0., 1.);\nconst vec3 c5 = vec3(1., 0., 1.);\nconst vec3 c6 = vec3(1., 1., 1.);\nconst vec3 c7 = vec3(0., 1., 1.);\n\nvec3 index3dFrom2d(vec2 coord) {\n    vec2 gridTexPos = coord * uGridTexDim.xy;\n    vec2 columnRow = ivec2Div(gridTexPos, uGridDim.xy);\n    vec2 posXY = gridTexPos - columnRow * uGridDim.xy;\n    float posZ = columnRow.y * intDiv(uGridTexDim.x, uGridDim.x) + columnRow.x;\n    return vec3(posXY, posZ);\n}\n\nvec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {\n    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice\n    float column = intDiv(intMod(zSlice * gridDim.x, texDim.x), gridDim.x);\n    float row = intDiv(zSlice * gridDim.x, texDim.x);\n    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / (texDim / uScale);\n    return texture2D(tex, coord + 0.5 / (texDim / uScale));\n}\n\nvec4 voxel(vec3 pos) {\n    pos = min(max(vec3(0.0), pos), uGridDim - vec3(1.0));\n    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);\n}\n\nfloat voxelValuePadded(vec3 pos) {\n    pos = min(max(vec3(0.0), pos), uGridDim - vec3(vec2(2.0), 1.0)); // remove xy padding\n    vec4 v = texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);\n    #ifdef dValueChannel_red\n        return v.r;\n    #else\n        return v.a;\n    #endif\n}\n\nint idot2(const in ivec2 a, const in ivec2 b) {\n    return a.x * b.x + a.y * b.y;\n}\n\nint idot4(const in ivec4 a, const in ivec4 b) {\n    return a.x * b.x + a.y * b.y + a.z * b.z + a.w * b.w;\n}\n\n#if __VERSION__ == 100\n    int pyramidVoxel(vec2 pos) {\n        return int(unpackRGBToInt(texture2D(tActiveVoxelsPyramid, pos / (vec2(1.0, 0.5) * uSize)).rgb));\n    }\n#else\n    int pyramidVoxel(vec2 pos) {\n        return texture2D(tActiveVoxelsPyramid, pos / (vec2(1.0, 0.5) * uSize)).r;\n    }\n#endif\n\nvec4 baseVoxel(vec2 pos) {\n    return texture2D(tActiveVoxelsBase, pos / uSize);\n}\n\nvec4 getGroup(const in vec3 p) {\n    // note that we swap x and z because the texture is flipped around y\n    #if defined(dAxisOrder_012)\n        float group = p.z + p.y * uGridDataDim.z + p.x * uGridDataDim.z * uGridDataDim.y; // 210\n    #elif defined(dAxisOrder_021)\n        float group = p.y + p.z * uGridDataDim.y + p.x * uGridDataDim.y * uGridDataDim.z; // 120\n    #elif defined(dAxisOrder_102)\n        float group = p.z + p.x * uGridDataDim.z + p.y * uGridDataDim.z * uGridDataDim.x; // 201\n    #elif defined(dAxisOrder_120)\n        float group = p.x + p.z * uGridDataDim.x + p.y * uGridDataDim.x * uGridDataDim.z; // 021\n    #elif defined(dAxisOrder_201)\n        float group = p.y + p.x * uGridDataDim.y + p.z * uGridDataDim.y * uGridDataDim.x; // 102\n    #elif defined(dAxisOrder_210)\n        float group = p.x + p.y * uGridDataDim.x + p.z * uGridDataDim.x * uGridDataDim.y; // 012\n    #endif\n    return vec4(group > 16777215.5 ? vec3(1.0) : packIntToRGB(group), 1.0);\n}\n\nvoid main(void) {\n    // get 1D index\n    int vI = int(gl_FragCoord.x) + int(gl_FragCoord.y) * int(uSize);\n\n    // ignore 1D indices outside of the grid\n    if(vI >= int(uCount)) discard;\n\n    ivec2 offset = ivec2(int(uSize) - 2, 0);\n\n    int start = 0;\n    ivec4 starts = ivec4(0);\n    ivec4 ends = ivec4(0);\n    int diff = 2;\n    ivec4 m = ivec4(0);\n    ivec2 position = ivec2(0);\n    ivec4 vI4 = ivec4(vI);\n\n    ivec2 relativePosition = ivec2(0);\n    int end = 0;\n    ivec2 pos1 = ivec2(0);\n    ivec2 pos2 = ivec2(0);\n    ivec2 pos3 = ivec2(0);\n    ivec2 pos4 = ivec2(0);\n    ivec3 vI3 = ivec3(vI);\n    ivec3 mask = ivec3(0);\n\n    // traverse the different levels of the pyramid\n    for(int i = 1; i < 14; i++) {\n        if(float(i) >= uLevels) break;\n\n        offset.x -= diff;\n        diff *= 2;\n        relativePosition = position + offset;\n\n        end = start + pyramidVoxel(vec2(relativePosition));\n        pos1 = ivec2(relativePosition);\n        starts.x = start;\n        ends.x = end;\n        pos2 = ivec2(relativePosition + ivec2(1, 0));\n        starts.y = ends.x;\n        ends.y = ends.x + pyramidVoxel(vec2(pos2));\n        pos3 = relativePosition + ivec2(0, 1);\n        starts.z = ends.y;\n        ends.z = ends.y + pyramidVoxel(vec2(pos3));\n        pos4 = relativePosition + ivec2(1, 1);\n        starts.w = ends.z;\n        mask = ivec3(greaterThanEqual(vI3, starts.rgb)) * ivec3(lessThan(vI3, ends.rgb));\n        m = ivec4(mask, 1 - int(any(bvec3(mask))));\n\n        relativePosition = m.x * pos1 + m.y * pos2 + m.z * pos3 + m.w * pos4;\n        start = idot4(m, starts);\n        position = 2 * (relativePosition - offset);\n    }\n\n    end = start + int(baseVoxel(vec2(position)).r * 255.0);\n    pos1 = position;\n    starts.x = start;\n    ends.x = end;\n    pos2 = position + ivec2(1, 0);\n    starts.y = ends.x;\n    ends.y = ends.x + int(baseVoxel(vec2(pos2)).r * 255.0);\n    pos3 = position + ivec2(0, 1);\n    starts.z = ends.y;\n    ends.z = ends.y + int(baseVoxel(vec2(pos3)).r * 255.0);\n    pos4 = position + ivec2(1, 1);\n    starts.w = ends.z;\n    mask = ivec3(greaterThanEqual(vI3, starts.rgb)) * ivec3(lessThan(vI3, ends.rgb));\n    m = ivec4(mask, 1 - int(any(bvec3(mask))));\n    position = m.x * pos1 + m.y * pos2 + m.z * pos3 + m.w * pos4;\n\n    vec2 coord2d = (vec2(position) / uSize) / uScale;\n    vec3 coord3d = floor(index3dFrom2d(coord2d) + 0.5);\n\n    float edgeIndex = floor(baseVoxel(vec2(position)).a * 255.0 + 0.5);\n\n    // current vertex for the up to 15 MC cases\n    int currentVertex = vI - idot4(m, starts);\n\n    // ensure winding-order is the same for negative and positive iso-levels\n    if (uInvert) {\n        int v = imod(currentVertex + 1, 3);\n        if (v == 1) currentVertex += 2;\n        else if (v == 0) currentVertex -= 2;\n    }\n\n    // get index into triIndices table\n    int mcIndex = 16 * int(edgeIndex) + currentVertex;\n    vec4 mcData = texture2D(tTriIndices, vec2(imod(mcIndex, 64), mcIndex / 64) / 64.);\n\n    // bit mask to avoid conditionals (see comment below) for getting MC case corner\n    vec4 m0 = vec4(floor(mcData.a * 255.0 + 0.5));\n\n    // get edge value masks\n    vec4 m1 = vec4(equal(m0, vec4(0., 1., 2., 3.)));\n    vec4 m2 = vec4(equal(m0, vec4(4., 5., 6., 7.)));\n    vec4 m3 = vec4(equal(m0, vec4(8., 9., 10., 11.)));\n\n    // apply bit masks\n    vec3 b0 = coord3d +\n                m1.y * c1 +\n                m1.z * c2 +\n                m1.w * c3 +\n                m2.x * c4 +\n                m2.y * c5 +\n                m2.z * c6 +\n                m2.w * c7 +\n                m3.y * c1 +\n                m3.z * c2 +\n                m3.w * c3;\n    vec3 b1 = coord3d +\n                m1.x * c1 +\n                m1.y * c2 +\n                m1.z * c3 +\n                m2.x * c5 +\n                m2.y * c6 +\n                m2.z * c7 +\n                m2.w * c4 +\n                m3.x * c4 +\n                m3.y * c5 +\n                m3.z * c6 +\n                m3.w * c7;\n\n    // the conditionals that are avoided by above bitmasks\n    // vec3 b0 = coord3d;\n    // vec3 b1 = coord3d;\n    // if (mcIndex == 0.0) {\n    //     b1 += c1;\n    // } else if (mcIndex == 1.0) {\n    //     b0 += c1; b1 += c2;\n    // } else if (mcIndex == 2.0) {\n    //     b0 += c2; b1 += c3;\n    // } else if (mcIndex == 3.0) {\n    //     b0 += c3;\n    // } else if (mcIndex == 4.0) {\n    //     b0 += c4; b1 += c5;\n    // } else if (mcIndex == 5.0) {\n    //     b0 += c5; b1 += c6;\n    // } else if (mcIndex == 6.0) {\n    //     b0 += c6; b1 += c7;\n    // } else if (mcIndex == 7.0) {\n    //     b0 += c7; b1 += c4;\n    // } else if (mcIndex == 8.0) {\n    //     b1 += c4;\n    // } else if (mcIndex == 9.0) {\n    //     b0 += c1; b1 += c5;\n    // } else if (mcIndex == 10.0) {\n    //     b0 += c2; b1 += c6;\n    // } else if (mcIndex == 11.0) {\n    //     b0 += c3; b1 += c7;\n    // }\n    // b0 = floor(b0 + 0.5);\n    // b1 = floor(b1 + 0.5);\n\n    vec4 d0 = voxel(b0);\n    vec4 d1 = voxel(b1);\n\n    #ifdef dValueChannel_red\n        float v0 = d0.r;\n        float v1 = d1.r;\n    #else\n        float v0 = d0.a;\n        float v1 = d1.a;\n    #endif\n\n    float t = (uIsoValue - v0) / (v0 - v1);\n    gl_FragData[0].xyz = (uGridTransform * vec4(b0 + t * (b0 - b1), 1.0)).xyz;\n\n    // group id\n    #if __VERSION__ == 100 || defined(dConstantGroup)\n        // webgl1 does not support 'flat' interpolation (i.e. no interpolation)\n        // ensure a constant group id per triangle as needed\n        #ifdef dPackedGroup\n            gl_FragData[1] = vec4(voxel(coord3d).rgb, 1.0);\n        #else\n            gl_FragData[1] = getGroup(coord3d);\n        #endif\n    #else\n        #ifdef dPackedGroup\n            gl_FragData[1] = vec4(t < 0.5 ? d0.rgb : d1.rgb, 1.0);\n        #else\n            gl_FragData[1] = getGroup(t < 0.5 ? b0 : b1);\n        #endif\n    #endif\n\n    // normals from gradients\n    vec3 n0 = -normalize(vec3(\n        voxelValuePadded(b0 - c1) - voxelValuePadded(b0 + c1),\n        voxelValuePadded(b0 - c3) - voxelValuePadded(b0 + c3),\n        voxelValuePadded(b0 - c4) - voxelValuePadded(b0 + c4)\n    ));\n    vec3 n1 = -normalize(vec3(\n        voxelValuePadded(b1 - c1) - voxelValuePadded(b1 + c1),\n        voxelValuePadded(b1 - c3) - voxelValuePadded(b1 + c3),\n        voxelValuePadded(b1 - c4) - voxelValuePadded(b1 + c4)\n    ));\n    gl_FragData[2].xyz = -vec3(\n        n0.x + t * (n0.x - n1.x),\n        n0.y + t * (n0.y - n1.y),\n        n0.z + t * (n0.z - n1.z)\n    );\n\n    // ensure normal-direction is the same for negative and positive iso-levels\n    if (uInvert) {\n        gl_FragData[2].xyz *= -1.0;\n    }\n\n    // apply normal matrix\n    gl_FragData[2].xyz = uGridTransformAdjoint * gl_FragData[2].xyz;\n}\n",{drawBuffers:"required"}),A=(0,i.$h)(e,"triangles",T,w,C)
return(0,r._)(A,C)}(e,t,n,o,u,p,h,f,m,g,y,v,b,x,S,_)
return e.namedComputeRenderables[N]}function j(e,t,n,r,i,o,a,l,c,d,f,x,S,A,I){h.g$&&e.timer.mark("extractIsosurface")
const P=function(e,t,n,r,i,o){h.g$&&e.timer.mark("calcActiveVoxels")
const{gl:a,state:s,resources:l}=e,c=t.getWidth(),u=t.getHeight()
e.namedFramebuffers[M]||(e.namedFramebuffers[M]=l.framebuffer())
const d=e.namedFramebuffers[M]
d.bind(),e.namedTextures[M]||(e.namedTextures[M]=l.texture("image-uint8","rgba","ubyte","nearest"))
const p=e.namedTextures[M]
p.define(c,u)
const f=O(e,t,n,r,i,o)
return e.state.currentRenderItemId=-1,p.attachFramebuffer(d,0),function(e){const{gl:t,state:n}=e
n.disable(t.CULL_FACE),n.disable(t.BLEND),n.disable(t.DEPTH_TEST),n.enable(t.SCISSOR_TEST),n.depthMask(!1),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0)}(e),s.viewport(0,0,c,u),s.scissor(0,0,c,u),a.clear(a.COLOR_BUFFER_BIT),s.scissor(0,0,r[0],r[1]),f.render(),a.finish(),h.g$&&e.timer.markEnd("calcActiveVoxels"),p}(e,t,n,r,l,o),B=function(e,t,n,r,i,o,a,s,l,c,u,d,f,m,g,y){const{drawBuffers:v}=e.extensions
if(!v)throw new Error("need WebGL draw buffers")
h.g$&&e.timer.mark("createIsosurfaceBuffers")
const{gl:b,state:x,resources:S,extensions:_}=e,{pyramidTex:C,height:w,levels:T,scale:A,count:I}=r,P=C.getWidth()
e.namedFramebuffers[N]||(e.namedFramebuffers[N]=S.framebuffer())
const B=e.namedFramebuffers[N];(0,p.C6)(b)?(m||(m=S.texture("image-float32","rgba","float","nearest")),g||(g=S.texture("image-uint8","rgba","ubyte","nearest")),y||(y=_.colorBufferHalfFloat&&_.textureHalfFloat?S.texture("image-float16","rgba","fp16","nearest"):S.texture("image-float32","rgba","float","nearest"))):(m||(m=S.texture("image-float32","rgba","float","nearest")),g||(g=S.texture("image-float32","rgba","float","nearest")),y||(y=S.texture("image-float32","rgba","float","nearest"))),m.define(P,w),g.define(P,w),y.define(P,w),m.attachFramebuffer(B,0),g.attachFramebuffer(B,1),y.attachFramebuffer(B,2)
const E=z(e,C,t,n,i,o,a,s,l,T,A,I,c,u,d,f)
return e.state.currentRenderItemId=-1,B.bind(),v.drawBuffers([v.COLOR_ATTACHMENT0,v.COLOR_ATTACHMENT1,v.COLOR_ATTACHMENT2]),function(e){const{gl:t,state:n}=e
n.disable(t.CULL_FACE),n.disable(t.BLEND),n.disable(t.DEPTH_TEST),n.disable(t.SCISSOR_TEST),n.depthMask(!1),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0)}(e),x.viewport(0,0,P,w),b.clear(b.COLOR_BUFFER_BIT),E.render(),b.finish(),h.g$&&e.timer.markEnd("createIsosurfaceBuffers"),{vertexTexture:m,groupTexture:g,normalTexture:y,vertexCount:I}}(e,P,t,function(e,t,n,r){h.g$&&e.timer.mark("createHistogramPyramid")
const{gl:i,state:o}=e,a=t.getWidth()
if(a!==t.getHeight()||!(0,b.r6)(a))throw new Error("inputTexture must be of square power-of-two size")
const l=Math.ceil(Math.log(a)/Math.log(2)),c=Math.pow(2,l),d=Math.pow(2,l),f=Math.pow(2,l-1),x=e.isWebGL2?T("pyramid",e,"image-int32","alpha","int","nearest"):T("pyramid",e,"image-uint8","rgba","ubyte","nearest")
x.define(d,f)
const S=w("pyramid",e)
x.attachFramebuffer(S,0),o.viewport(0,0,d,f),(0,p.C6)(i)?i.clearBufferiv(i.COLOR,0,[0,0,0,0]):i.clear(i.COLOR_BUFFER_BIT)
const A=[]
for(let s=0;s<l;++s)A.push(C(e,s))
const I=_(e,t,A[0].texture)
o.currentRenderItemId=-1,function(e){const{gl:t,state:n}=e
n.disable(t.CULL_FACE),n.disable(t.BLEND),n.disable(t.DEPTH_TEST),n.enable(t.SCISSOR_TEST),n.depthMask(!1),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0)}(e)
let P=0
for(let u=0;u<l;u++){const e=l-1-u
A[e].framebuffer.bind()
const t=Math.pow(2,e)
s.IQ.update(I.values.uSize,Math.pow(2,u+1)/c),s.IQ.update(I.values.uTexSize,t),s.IQ.updateIfChanged(I.values.uFirst,0===u),u>0&&(s.IQ.update(I.values.tPreviousLevel,A[l-u].texture),I.update()),o.currentRenderItemId=-1,o.viewport(0,0,t,t),o.scissor(0,0,t,t),(0,p.C6)(i)?i.clearBufferiv(i.COLOR,0,[0,0,0,0]):i.clear(i.COLOR_BUFFER_BIT),o.scissor(0,0,r[0],r[1]),I.render(),x.bind(0),i.copyTexSubImage2D(i.TEXTURE_2D,0,P,0,0,0,t,t),x.unbind(0),P+=t}i.finish(),h.g$&&e.timer.markEnd("createHistogramPyramid")
const B=Math.max(1,function(e,t){h.g$&&e.timer.mark("getHistopyramidSum")
const{gl:n,state:r,resources:i}=e,o=g(e,t)
e.state.currentRenderItemId=-1,e.namedFramebuffers[m]||(e.namedFramebuffers[m]=i.framebuffer())
const a=e.namedFramebuffers[m]
return e.namedTextures[m]||(e.namedTextures[m]=(0,p.C6)(n)?i.texture("image-int32","rgba","int","nearest"):i.texture("image-uint8","rgba","ubyte","nearest"),e.namedTextures[m].define(1,1)),e.namedTextures[m].attachFramebuffer(a,0),function(e){const{gl:t,state:n}=e
n.disable(t.CULL_FACE),n.disable(t.BLEND),n.disable(t.DEPTH_TEST),n.disable(t.SCISSOR_TEST),n.depthMask(!1),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0)}(e),r.viewport(0,0,1,1),o.render(),n.finish(),e.readPixels(0,0,1,1,(0,p.C6)(n)?v:y),n.bindFramebuffer(n.FRAMEBUFFER,null),h.g$&&e.timer.markEnd("getHistopyramidSum"),(0,p.C6)(n)?v[0]:(0,u.OK)(y[0],y[1],y[2])}(e,A[0].texture))
return{pyramidTex:x,count:B,height:Math.ceil(B/Math.pow(2,l)),levels:l,scale:n}}(e,P,o,r),n,r,i,a,l,c,d,f,x,S,A,I)
return h.g$&&e.timer.markEnd("extractIsosurface"),B}},20321(e,t,n){"use strict"
n.d(t,{C:()=>N})
var r=n(52349),i=n(88434)
const o=i.I.Empty,a=i.I.ofSingleton,s=i.I.ofRange,l=i.I.ofBounds
function c(e){return e.length?r.X.isRange(e)?i.I.ofRange(e[0],e[e.length-1]):e:o}function u(e){return i.I.is(e)?i.I.size(e):r.X.size(e)}function d(e,t){return i.I.is(e)?i.I.has(e,t):r.X.has(e,t)}function p(e,t){return i.I.is(e)?i.I.indexOf(e,t):r.X.indexOf(e,t)}function h(e,t){return i.I.is(e)?i.I.getAt(e,t):e[t]}function f(e){return i.I.is(e)?i.I.min(e):r.X.min(e)}function m(e){return i.I.is(e)?i.I.max(e):r.X.max(e)}function g(e){return i.I.is(e)?i.I.start(e):r.X.start(e)}function y(e){return i.I.is(e)?i.I.end(e):r.X.end(e)}function v(e){return 0===u(e)}function b(e){return i.I.is(e)?i.I.hashCode(e):r.X.hashCode(e)}function x(e,t){return i.I.is(e)?i.I.is(t)?i.I.areEqual(e,t):E(e,t):i.I.is(t)?E(t,e):r.X.areEqual(e,t)}function S(e,t){return i.I.is(e)?i.I.is(t)?i.I.areIntersecting(e,t):k(t,e):i.I.is(t)?k(e,t):r.X.areIntersecting(e,t)}function _(e,t){return i.I.is(e)?i.I.is(t)?i.I.isSubInterval(e,t):function(e,t){const n=i.I.min(e),o=i.I.max(e)
if(o-n+1==0)return!1
const a=r.X.min(t),s=r.X.max(t)
return a>=n&&s<=o}(e,t):i.I.is(t)?function(e,t){const n=i.I.min(t),o=i.I.max(t)
if(o-n+1==0)return!0
const a=r.X.min(e),s=r.X.max(e)
if(n<a||o>s)return!1
const l=r.X.findRange(e,n,o)
return i.I.size(l)===i.I.size(t)}(e,t):r.X.isSubset(e,t)}function C(e,t){return i.I.is(e)?i.I.findPredecessorIndex(e,t):r.X.findPredecessorIndex(e,t)}function w(e,t,n){return i.I.is(e)?i.I.findPredecessorIndexInInterval(e,t,n):r.X.findPredecessorIndexInInterval(e,t,n)}function T(e,t,n){return i.I.is(e)?i.I.findRange(e,t,n):r.X.findRange(e,t,n)}function A(e,t){return i.I.is(e)?i.I.is(t)?i.I.intersectionSize(e,t):R(t,e):i.I.is(t)?R(e,t):r.X.intersectionSize(e,t)}function I(e,t){return i.I.is(e)?i.I.is(t)?function(e,t){if(i.I.areEqual(e,t))return e
const n=i.I.size(e),r=i.I.size(t)
if(!r)return e
if(!n)return t
const o=i.I.min(e),a=i.I.min(t)
if(function(e,t){const n=u(e),r=u(t)
return 0===n&&0===r||n>0&&r>0&&m(e)>=f(t)&&f(e)<=m(t)}(e,t))return i.I.ofRange(Math.min(o,a),Math.max(i.I.max(e),i.I.max(t)))
let s,l,d,p
o<a?(s=n,l=o,d=r,p=a):(s=r,l=a,d=n,p=o)
const h=new Int32Array(n+r)
for(let i=0;i<s;i++)h[i]=i+l
for(let i=0;i<d;i++)h[i+s]=i+p
return c(h)}(e,t):M(t,e):i.I.is(t)?M(e,t):c(r.X.union(e,t))}function P(e,t){return i.I.is(e)?i.I.is(t)?i.I.intersect(e,t):O(t,e):i.I.is(t)?O(e,t):c(r.X.intersect(e,t))}function B(e,t){return i.I.is(e)?i.I.is(t)?function(e,t){if(i.I.areEqual(e,t))return o
if(!i.I.areIntersecting(e,t))return e
const n=i.I.min(e),r=i.I.max(e),a=i.I.min(t),s=i.I.max(t)
if(r<n||s<a)return e
if(i.I.isSubInterval(t,e))return o
if(i.I.isSubInterval(e,t)){const e=a-n,t=r-s
if(e<=0)return i.I.ofRange(s+1,s+t)
if(t<=0)return i.I.ofRange(n,n+e-1)
const o=new Int32Array(e+t)
let l=0
for(let r=0;r<e;r++)o[l++]=n+r
for(let n=1;n<=t;n++)o[l++]=s+n
return c(o)}return n<a?i.I.ofRange(n,a-1):i.I.ofRange(s+1,r)}(e,t):function(e,t){const n=i.I.min(e),a=i.I.max(e)
if(a<n)return e
const s=a-n+1,l=r.X.findRange(t,n,a),u=i.I.start(l),d=i.I.end(l),p=d-u
if(0===p)return e
const h=s-p
if(h<=0)return o
const f=new Int32Array(h),m=t.length-1,g=t[Math.min(u,m)],y=t[Math.min(d,m)]
let v=0
for(let r=n;r<g;r++)f[v++]=r
for(let i=g;i<=y;i++)r.X.indexOfInInterval(t,i,l)<0&&(f[v++]=i)
for(let r=y+1;r<=a;r++)f[v++]=r
return c(f)}(e,t):i.I.is(t)?function(e,t){const n=i.I.min(t),a=i.I.max(t)
if(a<n)return e
const s=r.X.findRange(e,n,a),l=i.I.start(s),u=i.I.end(s),d=e.length-(u-l)
if(d<=0)return o
if(d===e.length)return e
const p=new Int32Array(d)
let h=0
for(let r=0;r<l;r++)p[h++]=e[r]
for(let r=u,i=e.length;r<i;r++)p[h++]=e[r]
return c(p)}(e,t):c(r.X.subtract(e,t))}function E(e,t){return i.I.size(e)===r.X.size(t)&&i.I.start(e)===r.X.start(t)&&i.I.end(e)===r.X.end(t)}function k(e,t){return 0!==e.length&&0!==i.I.size(r.X.findRange(e,i.I.min(t),i.I.max(t)))}function D(e,t){return u(e)?!u(t)||f(e)<=f(t)&&m(e)>=m(t):0===u(t)}function M(e,t){const n=i.I.size(t)
if(!n)return e
if(D(t,e))return t
const o=i.I.min(t),a=i.I.max(t),s=r.X.findRange(e,o,a),l=i.I.start(s),u=i.I.end(s),d=new Int32Array(l+(e.length-u)+n)
let p=0
for(let r=0;r<l;r++)d[p++]=e[r]
for(let r=o;r<=a;r++)d[p++]=r
for(let r=u,i=e.length;r<i;r++)d[p++]=e[r]
return c(d)}function R(e,t){if(!i.I.size(t))return 0
const n=r.X.findRange(e,i.I.min(t),i.I.max(t))
return i.I.end(n)-i.I.start(n)}function O(e,t){if(!i.I.size(t))return o
const n=r.X.findRange(e,i.I.min(t),i.I.max(t)),a=i.I.start(n),s=i.I.end(n),l=s-a
if(!l)return o
if(l===e.length)return e
const u=new Int32Array(l)
let d=0
for(let r=a;r<s;r++)u[d++]=e[r]
return c(u)}function L(e,t,n){if(t===n)return e
const i=u(e),a=t.length,s=n.length
if(0===i||0===a||0===s)return o
const l=r.X.findPredecessorIndex(n,t[f(e)]),d=r.X.findPredecessorIndex(n,t[m(e)]+1)
let p=0,g=0,y=0,v=l
for(;y<i&&v<d;){const r=t[h(e,y)],i=n[v]
r<i?y++:(r>i||(p++,y++),v++)}if(0===p)return o
if(p===a&&p===s)return e
const b=new Int32Array(p)
for(g=0,y=0,v=l;y<i&&v<d;){const r=t[h(e,y)],i=n[v]
r<i?y++:(r>i||(b[g++]=v,y++),v++)}return c(b)}var N
!function(e){e.Empty=o,e.ofSingleton=a,e.ofRange=s,e.ofBounds=l,e.ofSortedArray=c,e.has=d,e.indexOf=p,e.getAt=h,e.isEmpty=v,e.min=f,e.max=m,e.start=g,e.end=y,e.size=u,e.hashCode=b,e.areEqual=x,e.areIntersecting=S,e.isSubset=_,e.union=I,e.intersect=P,e.indexedIntersect=L,e.subtract=B,e.findPredecessorIndex=C,e.findPredecessorIndexInInterval=w,e.findRange=T,e.intersectionSize=A,e.forEach=function(e,t,n){return function(e,t,n){if(i.I.is(e)){const r=i.I.min(e)
for(let o=r,a=i.I.max(e);o<=a;o++)t(o,o-r,n)}else for(let r=0,i=e.length;r<i;r++)t(e[r],r,n)
return n}(e,t,n)},e.forEachSegment=function(e,t,n,r){return function(e,t,n,r){if(i.I.is(e)){let o=0
for(let a=i.I.min(e),s=i.I.max(e);a<=s;a++){const e=t(a)
let i=a+1
for(;i<s&&t(i)===e;)i++
a=i-1,n(e,o,r),o++}}else{let i=0
for(let o=0,a=e.length;o<a;o++){const s=t(e[o])
let l=o+1
for(;l<a&&t(e[l])===s;)l++
o=l-1,n(s,i,r),i++}}return r}(e,t,n,r)},e.isInterval=function(e){return i.I.is(e)},e.isSortedArray=function(e){return!i.I.is(e)},e.toArray=function(t){const n=[]
return e.forEach(t,e=>n.push(e)),n},e.toString=function(e){return function(e){return i.I.is(e)?i.I.toString(e):r.X.toString(e)}(e)}}(N||(N={}))},20356(e,t,n){"use strict"
n.d(t,{o:()=>$})
var r=n(67538),i=n(71695),o=n(69045),a=n(94050),s=n(70012),l=n(66588),c=n(97960),u=n(30846),d=n(8294)
class p{addToUnit(e,t){const n=this.unitMap.get(e)
n?n[n.length]=t:(this.unitMap.set(e,[t]),this.ids[this.ids.length]=e),this.elementCount++}beginUnit(e){this.parentId=e,this.currentUnit=this.currentUnit.length>0?[]:this.currentUnit}addElement(e){this.currentUnit[this.currentUnit.length]=e,this.elementCount++}addElementRange(e,t,n){for(let r=t;r<n;r++)this.currentUnit[this.currentUnit.length]=e[r],this.elementCount++}commitUnit(){0!==this.currentUnit.length&&(this.ids[this.ids.length]=this.parentId,this.unitMap.set(this.parentId,this.currentUnit),this.parentId=-1)}setUnit(e,t){this.ids[this.ids.length]=e,this.unitMap.set(e,t),this.elementCount+=t.length}_getStructure(e){if(this.isEmpty)return $.Empty
const t=[];(0,s.eh)(this.ids)
const n=d.u.UnitEquivalenceBuilder()
for(let i=0,o=this.ids.length;i<o;i++){const o=this.ids[i],a=this.parent.unitMap.get(o)
let l=this.unitMap.get(o),c=!1
e&&(this.isSorted||(0,s.eh)(l),l=r.X9.deduplicate(r.X9.ofSortedArray(this.currentUnit)),c=!0)
const u=l.length
if(l.length===a.elements.length){t[t.length]=a,n.add(a.id,a)
continue}!this.isSorted&&!c&&u>1&&(0,s.eh)(l)
let d=a.getChild(r.X9.ofSortedArray(l))
const p=n.add(d.id,d)
d!==p&&(d=p.applyOperator(d.id,d.conformation.operator,!0)),t[t.length]=d}return $.create(t,{parent:this.parent})}getStructure(){return this._getStructure(!1)}getStructureDeduplicate(){return this._getStructure(!0)}setSingletonLocation(e){const t=this.ids[0]
e.unit=this.parent.unitMap.get(t),e.element=this.unitMap.get(t)[0]}get isEmpty(){return 0===this.elementCount}constructor(e,t){this.parent=e,this.isSorted=t,this.ids=[],this.unitMap=r.Yz.Mutable(),this.parentId=-1,this.currentUnit=[],this.elementCount=0}}var h=n(28626),f=n(68329)
function m(e,t){let n=1
for(;t--;)n*=e--
return n}class g{move(){if(this.hasNext){let e=0,t=0,n=this.index
for(;n;n>>>=1,e++)1&n&&(this.value[t++]=this.array[e])
this.index=function(e){const t=e&-e,n=e+t
return n|((n&-n)/t>>1)-1}(this.index),this.hasNext=this.index<this.maxIndex}return this.value}constructor(e,t){var n,r
this.array=e,this.hasNext=!1,this.index=(1<<t)-1,this.size=(r=t)>(n=e.length)?0:m(n,r)/m(r,r),this.maxIndex=1<<e.length,this.value=new Array(t),this.hasNext=t>0&&t<=e.length}}function y(e,t){const n=[],r=new g(e,t)
for(;r.hasNext;)n.push(r.move().slice())
return n}var v=n(29067),b=n(32775),x=n(76242),S=n(63356),_=n(87095),C=n(13686)
const w=[],T={links:w,terminalLinks:w,elements:w,partialElements:w,getElementIndices:()=>w,getLinkIndices:()=>w,getTerminalLinkIndices:()=>w}
var A=n(9014)
const I=(0,_.ElementSymbol)("C"),P=(0,_.ElementSymbol)("O"),B=[A.X.elementFingerprint([I,I,I,P]),A.X.elementFingerprint([I,I,I,I,P]),A.X.elementFingerprint([I,I,I,I,I,P]),A.X.elementFingerprint([I,I,I,I,I,I,P])]
function E(e,t){let n=-1,r=-1,i=-1,o=-1
const{elements:a}=e,{type_symbol:s,label_atom_id:l}=e.model.atomicHierarchy.atoms,{b:c,offset:u}=e.bonds
for(let d=0,p=t.length;d<p;++d){const e=a[t[d]]
if(s.value(e)!==I)continue
let p=0,h=0
for(let n=u[t[d]],r=u[t[d]+1];n<r;++n){const e=a[c[n]],t=s.value(e)
t===P?++p:t===I&&++h}if(2===p){n=e
break}1===p&&1===h?r=e:l.value(e).startsWith("C1")?i=e:o=e}return-1!==n?n:-1!==r?r:-1!==i?i:-1!==o?o:a[t[0]]}function k(e,t,n,r){const i=t.conformation
return b.eB.normalize(e,b.eB.sub(e,r,i.position(n,e))),e}function D(e,t){const{elements:n}=e,{label_atom_id:r}=e.model.atomicHierarchy.atoms
return r.value(n[t])}function M(e,t){if(!t||!t.length)return
const{unit:n,all:i}=e,o=new Set,a=y((0,S.WE)(new Array(t.length)),2)
for(let s=0,l=a.length;s<l;++s){const e=a[s],l=i[t[e[0]]],c=i[t[e[1]]]
r.X9.areIntersecting(l,c)&&A.X.getAltId(n,l)===A.X.getAltId(n,c)&&(o.add(t[e[0]]),o.add(t[e[1]]))}if(o.size){const e=[]
for(let n=0,r=t.length;n<r;++n)o.has(t[n])||e.push(t[n])
return e}return t}function R(e,t){return t.properties.saccharideComponentMap.get(e)}function O(e,t,n){function r(e,t){return(0,s.m1)(e.id,t)}function i(e,t,n){const i=[],o=e.get(r(t,n))
if(void 0!==o)for(const r of o)(0,S.Z2)(i,r)
return i}const o=new Map
for(let s=0,c=e.length;s<c;++s){const{unit:t,ringIndex:n}=e[s],i=t.rings.all[n]
for(let e=0,a=i.length;e<a;++e){const n=r(t,t.elements[i[e]]),a=o.get(n)
void 0===a?o.set(n,[s]):a.push(s)}}const a=new Map
for(let s=0,c=t.length;s<c;++s){const n=t[s],{unit:i,ringIndex:o}=e[n.carbohydrateIndexA],l=i.rings.all[o]
for(let e=0,t=l.length;e<t;++e){const t=r(i,i.elements[l[e]]),n=a.get(t)
void 0===n?a.set(t,[s]):n.push(s)}}const l=new Map
for(let s=0,c=n.length;s<c;++s){const{fromCarbohydrate:t,carbohydrateIndex:i,elementUnit:o,elementIndex:a}=n[s]
if(t){const{unit:t,ringIndex:n}=e[i],o=t.rings.all[n]
for(let e=0,i=o.length;e<i;++e){const n=r(t,t.elements[o[e]]),i=l.get(n)
void 0===i?l.set(n,[s]):i.push(s)}}else{const e=r(o,o.elements[a]),t=l.get(e)
void 0===t?l.set(e,[s]):t.push(s)}}return{getElementIndices:function(e,t){return i(o,e,t)},getLinkIndices:function(e,t){return i(a,e,t)},getTerminalLinkIndices:function(e,t){return i(l,e,t)}}}var L=n(9959),N=n(33205),F=n(16913),z=n(76840),j=n(70292),V=n(14294),U=n(10314)
const G=(0,V.f8)(),H=new U.Z("14"),q=new U.Z("98")
var Q=n(20321)
class ${subsetBuilder(e){return new p(this,e)}get elementCount(){return this.state.elementCount}get bondCount(){return-1===this.state.bondCount&&(this.state.bondCount=this.interUnitBonds.edgeCount/2+h.gn.getIntraUnitBondCount(this)),this.state.bondCount}get hasCustomProperties(){return!!this.state.customProps&&this.state.customProps.all.length>0}get customPropertyDescriptors(){return this.state.customProps||(this.state.customProps=new N.v),this.state.customProps}get currentPropertyData(){return this.state.propertyData||(this.state.propertyData=Object.create(null)),this.state.propertyData}get inheritedPropertyData(){return this.parent?this.parent.currentPropertyData:this.currentPropertyData}get polymerResidueCount(){return-1===this.state.polymerResidueCount&&(this.state.polymerResidueCount=function(e){const{units:t}=e
let n=0
for(let r=0,i=t.length;r<i;r++)n+=t[r].polymerElements.length
return n}(this)),this.state.polymerResidueCount}get polymerGapCount(){return-1===this.state.polymerGapCount&&(this.state.polymerGapCount=function(e){const{units:t}=e
let n=0
for(let r=0,i=t.length;r<i;r++)n+=t[r].gapElements.length/2
return n}(this)),this.state.polymerGapCount}get polymerUnitCount(){return-1===this.state.polymerUnitCount&&(this.state.polymerUnitCount=function(e){const{units:t}=e
let n=0
for(let r=0,i=t.length;r<i;r++)t[r].polymerElements.length>0&&(n+=1)
return n}(this)),this.state.polymerUnitCount}get uniqueElementCount(){return-1===this.state.uniqueElementCount&&(this.state.uniqueElementCount=function(e){const{unitSymmetryGroups:t}=e
let n=0
for(let r=0,i=t.length;r<i;r++)n+=t[r].elements.length
return n}(this)),this.state.uniqueElementCount}get atomicResidueCount(){return-1===this.state.atomicResidueCount&&(this.state.atomicResidueCount=function(e){const{units:t}=e
let n=0
for(let r=0,i=t.length;r<i;r++){const e=t[r]
if(!c.N.isAtomic(e))continue
const{elements:i,residueIndex:o}=e
let a=-1,s=-1
for(let t=0,r=i.length;t<r;++t)a=o[i[t]],a!==s&&(n+=1,s=a)}return n}(this)),this.state.atomicResidueCount}get isCoarseGrained(){return this.models.some(e=>a.Kx.isCoarseGrained(e))}get isEmpty(){return 0===this.units.length}get hashCode(){return-1!==this.state.hashCode?this.state.hashCode:this.computeHash()}get transformHash(){return-1!==this.state.transformHash||(this.state.transformHash=(0,s.TI)(this.units.map(e=>e.id))),this.state.transformHash}computeHash(){let e=23
for(let t=0,n=this.units.length;t<n;t++){const n=this.units[t]
e=31*e+n.id|0,e=31*e+r.X9.hashCode(n.elements)|0}return e=31*e+this.elementCount|0,e=(0,s.C_)(e),-1===e&&(e=0),this.state.hashCode=e,e}elementLocations(){return new $.ElementLocationIterator(this)}get root(){var e
return null!==(e=this.state.parent)&&void 0!==e?e:this}get parent(){return this.state.parent}get coordinateSystem(){return this.state.coordinateSystem}get label(){return this.state.label}get boundary(){return this.state.boundary||(this.state.boundary=function(e){const{units:t}=e,n=t.length>500?H:q
n.reset()
for(let r=0,i=t.length;r<i;r++){const e=t[r],i=e.boundary,o=e.conformation.operator
o.isIdentity?n.includeSphere(i.sphere):(V.f8.transform(G,i.sphere,o.matrix),n.includeSphere(G))}n.finishedIncludeStep()
for(let r=0,i=t.length;r<i;r++){const e=t[r],i=e.boundary,o=e.conformation.operator
o.isIdentity?n.radiusSphere(i.sphere):(V.f8.transform(G,i.sphere,o.matrix),n.radiusSphere(G))}return{box:n.getBox(),sphere:n.getSphere()}}(this)),this.state.boundary}get lookup3d(){return this.state.lookup3d||(this.state.lookup3d=new u.jM(this)),this.state.lookup3d}get interUnitBonds(){return this.state.interUnitBonds||(this.parent&&this.state.dynamicBonds===this.parent.state.dynamicBonds&&this.parent.state.interUnitBonds&&0===this.parent.state.interUnitBonds.edgeCount?this.state.interUnitBonds=new h.dZ(new Map):this.state.interUnitBonds=(0,h.kD)(this,{ignoreWater:!this.dynamicBonds,ignoreIon:!this.dynamicBonds,validUnit:this.state.interBondsValidUnit,validUnitPair:this.state.interBondsValidUnitPair})),this.state.interUnitBonds}get dynamicBonds(){return this.state.dynamicBonds}get interBondsValidUnit(){return this.state.interBondsValidUnit}get interBondsValidUnitPair(){return this.state.interBondsValidUnitPair}get unitSymmetryGroups(){return this.state.unitSymmetryGroups||(this.state.unitSymmetryGroups=d.u.computeTransformGroups(this)),this.state.unitSymmetryGroups}get unitSymmetryGroupsIndexMap(){return this.state.unitSymmetryGroupsIndexMap||(this.state.unitSymmetryGroupsIndexMap=c.N.SymmetryGroup.getUnitSymmetryGroupsIndexMap(this.unitSymmetryGroups)),this.state.unitSymmetryGroupsIndexMap}get carbohydrates(){return this.state.carbohydrates||(this.state.carbohydrates=function(e){if(0===e.models.reduce((e,t)=>e+t.properties.saccharideComponentMap.size,0))return T
const t=[],n=[],i=[],o=[],a=new Map
function s(e,t,n){return`${e}|${t}|${n}`}function l(e,t){a.has(e)?a.get(e).push(t):a.set(e,[t])}function u(e,t){b.eB.sub(i[e].geometry.direction,i[t].geometry.center,i[e].geometry.center),b.eB.normalize(i[e].geometry.direction,i[e].geometry.direction)}const d=(0,b.eB)()
function p(e,t,n){const r=n.conformation,o=i[e].geometry
b.eB.sub(o.direction,r.position(n.elements[t],d),o.center),b.eB.normalize(o.direction,o.direction)}for(let f=0,m=e.units.length;f<m;++f){const n=e.units[f]
if(!c.N.isAtomic(n))continue
const{model:a,rings:d}=n,{chainAtomSegments:p,residueAtomSegments:h,atoms:m}=a.atomicHierarchy,{label_comp_id:g}=m,_=r.hT.transientSegments(p,n.elements),w=r.hT.transientSegments(h,n.elements)
let T
for(;_.hasNext;)for(w.setSegment(_.move());w.hasNext;){const{index:e}=w.move(),r=R(g.value(h.offsets[e]),a)
if(!r)continue
T||(T=A.g.byFingerprintAndResidue(d,B))
const c=M(d,T.get(e))
if(!c||!c.length){o.push({unit:n,residueIndex:e,component:r})
continue}const p=[]
for(let t=0,o=c.length;t<o;++t){const o=d.all[c[t]],a=E(n,o),u=x.c.calculateMomentsAxes((0,C.Dt)(n,o)),h=x.c.calculateNormalizedAxes(u),f=b.eB.copy((0,b.eB)(),h.origin),m=b.eB.copy((0,b.eB)(),h.dirC),g=k((0,b.eB)(),n,a,f)
b.eB.orthogonalize(g,m,g)
const y=A.X.getAltId(n,o),v=i.length
p.push(v),l(s(e,n.id,y),v),y&&l(s(e,n.id,""),v),i.push({geometry:{center:f,normal:m,direction:g},component:r,ringIndex:c[t],altId:y,unit:n,residueIndex:e})}const f=y((0,S.WE)(new Array(c.length)),2)
for(let o=0,a=f.length;o<a;++o){const e=f[o],r=d.all[c[e[0]]],a=d.all[c[e[1]]]
if(v.O.areVertexSetsConnected(n.bonds,r,a,3)){const n=p[e[0]],r=p[e[1]]
i[n].altId===i[r].altId&&(u(n,r),u(r,n),t.push({carbohydrateIndexA:n,carbohydrateIndexB:r}),t.push({carbohydrateIndexA:r,carbohydrateIndexB:n}))}}}}function h(e,t){return a.get(s(e.getResidueIndex(t),e.id,function(e,t){const{elements:n}=e,{label_alt_id:r}=e.model.atomicHierarchy.atoms
return r.value(n[t])}(e,t)))||[]}for(let r=0,c=i.length;r<c;++r){const e=i[r],{unit:n}=e
for(let o=r+1;o<c;++o){const a=i[o]
if(n!==a.unit||e.residueIndex===a.residueIndex)continue
const s=n.rings.all[e.ringIndex],l=n.rings.all[a.ringIndex]
v.O.areVertexSetsConnected(n.bonds,s,l,3)&&(u(r,o),u(o,r),t.push({carbohydrateIndexA:r,carbohydrateIndexB:o}),t.push({carbohydrateIndexA:o,carbohydrateIndexB:r}))}}for(let r=0,f=e.units.length;r<f;++r){const i=e.units[r]
c.N.isAtomic(i)&&e.interUnitBonds.getConnectedUnits(i.id).forEach(r=>{r.connectedIndices.forEach(i=>{r.getEdges(i).forEach(({props:o,indexB:a})=>{if(!_.BondType.isCovalent(o.flag))return
const s=e.unitMap.get(r.unitA),l=e.unitMap.get(r.unitB),c=h(s,i),d=h(l,a)
if(c.length>0&&d.length>0){const e=c.length,n=d.length
for(let r=0,o=Math.max(e,n);r<o;++r){const o=c[Math.min(r,e-1)],a=d[Math.min(r,n-1)],l=D(s,i);(l.startsWith("O1")||l.startsWith("C1"))&&u(o,a),t.push({carbohydrateIndexA:o,carbohydrateIndexB:a})}}else if(0===d.length)for(const e of c){const t=D(s,i);(t.startsWith("O1")||t.startsWith("C1"))&&p(e,a,l),n.push({carbohydrateIndex:e,elementIndex:a,elementUnit:l,fromCarbohydrate:!0})}else if(0===c.length)for(const e of d)n.push({carbohydrateIndex:e,elementIndex:i,elementUnit:s,fromCarbohydrate:!1})})})})}return{links:t,terminalLinks:n,elements:i,partialElements:o,...O(i,t,n)}}(this)),this.state.carbohydrates}get models(){return this.state.models||(this.state.models=function(e){const{units:t}=e,n=i.th.create()
for(const r of t)i.th.add(n,r.model.id,r.model)
return n.array}(this)),this.state.models}get uniqueResidueNames(){return this.state.uniqueResidueNames||(this.state.uniqueResidueNames=function(e){const{microheterogeneityCompIds:t}=f.Z.residue,n=new Set,i=l.i.Location.create(e)
for(const o of e.unitSymmetryGroups){const e=o.units[0]
if(!c.N.isAtomic(e))continue
const a=r.hT.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements)
for(i.unit=e;a.hasNext;){const r=a.move()
i.element=e.elements[r.start]
const o=t(i)
for(const e of o)n.add(e)}}return n}(this))}get uniqueElementSymbols(){return this.state.uniqueElementSymbols||(this.state.uniqueElementSymbols=function(e){const t=f.Z.atom.type_symbol,n=new Set,r=l.i.Location.create(e)
for(const i of e.unitSymmetryGroups){const e=i.units[0]
if(c.N.isAtomic(e)){r.unit=e
for(let i=0,o=e.elements.length;i<o;++i)r.element=e.elements[i],n.add(t(r))}}return n}(this))}get entityIndices(){return this.state.entityIndices||(this.state.entityIndices=function(e){const{units:t}=e,n=l.i.Location.create(e),o=i.th.create()
for(const a of t){const e=a.kind===c.N.Kind.Atomic?f.Z.entity.key:f.Z.coarse.entityKey
n.unit=a
const t=a.elements,s=r.hT.transientSegments(a.model.atomicHierarchy.chainAtomSegments,t)
for(;s.hasNext;){const r=s.move()
n.element=t[r.start]
const a=e(n)
i.th.add(o,a,a)}}return(0,s.eh)(o.array),o.array}(this))}get uniqueAtomicResidueIndices(){return this.state.uniqueAtomicResidueIndices||(this.state.uniqueAtomicResidueIndices=function(e){const t=new Map,n=[],o=e.unitSymmetryGroups
for(const s of o){const e=s.units[0]
if(!c.N.isAtomic(e))continue
let o
t.has(e.model.id)?o=t.get(e.model.id):(o=i.th.create(),n.push(e.model.id),t.set(e.model.id,o))
const a=r.hT.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements)
for(;a.hasNext;){const e=a.move()
i.th.add(o,e.index,e.index)}}const a=new Map
for(const r of n){const e=t.get(r).array;(0,s.eh)(e),a.set(r,e)}return a}(this))}get isAtomic(){for(const e of this.units)if(!c.N.isAtomic(e))return!1
return!0}get hasAtomic(){for(const e of this.units)if(c.N.isAtomic(e))return!0
return!1}get isCoarse(){for(const e of this.units)if(!c.N.isCoarse(e))return!1
return!0}get hasCoarse(){for(const e of this.units)if(c.N.isCoarse(e))return!0
return!1}get serialMapping(){return this.state.serialMapping||(this.state.serialMapping=function(e){const{units:t,elementCount:n,unitIndexMap:r}=e,i=new Uint32Array(t.length),o=new Uint32Array(n),a=new Uint32Array(n)
for(let s=0,l=0,c=t.length;s<c;++s){i[s]=l
const{elements:e}=t[s]
for(let t=0,n=e.length;t<n;++t){const n=l+t
o[n]=s,a[n]=e[t]}l+=e.length}return{cumulativeUnitElementCount:i,unitIndices:o,elementIndices:a,getSerialIndex:(e,t)=>i[r.get(e.id)]+Q.C.indexOf(e.elements,t)}}(this))}get intraUnitBondMapping(){return this.state.intraUnitBondMapping||(this.state.intraUnitBondMapping=function(e){let t=0
const n=[]
for(const l of e.unitSymmetryGroups){n.push(t)
const e=l.units[0]
c.N.isAtomic(e)&&(t+=2*e.bonds.edgeCount*l.units.length)}const r=new Uint32Array(t),i=new Uint32Array(t),o=new Uint32Array(t)
let a=0,s=0
for(const l of e.unitSymmetryGroups){const e=l.units[0]
if(c.N.isAtomic(e)){const t=2*e.bonds.edgeCount
for(let e=0,n=l.units.length;e<n;++e)for(let l=0,c=t;l<c;++l)r[a]=s,i[a]=l,o[a]=e,a+=1}s+=1}return{bondCount:t,unitIndex:r,unitEdgeIndex:i,unitGroupIndex:o,unitGroupOffset:n}}(this))}get model(){if(this.state.model)return this.state.model
if(this.state.representativeModel)return this.state.representativeModel
if(this.state.masterModel)return this.state.masterModel
const e=this.models
if(e.length>1)throw new Error("The structure is based on multiple models and has neither a master- nor a representative-model.")
return this.state.model=e[0],this.state.model}get masterModel(){return this.state.masterModel}get representativeModel(){return this.state.representativeModel}hasElement(e){return!!this.unitMap.has(e.unit.id)&&r.X9.has(this.unitMap.get(e.unit.id).elements,e.element)}getModelIndex(e){return this.models.indexOf(e)}remapModel(e){const{dynamicBonds:t,interUnitBonds:n,parent:r}=this.state,i=[]
for(const o of this.unitSymmetryGroups){const n=o.units[0].remapModel(e,t)
i.push(n)
for(let r=1,a=o.units.length;r<a;++r){const a=o.units[r]
i.push(a.remapModel(e,t,n.props))}}return $.create(i,{parent:null==r?void 0:r.remapModel(e),label:this.label,interUnitBonds:t?void 0:n,dynamicBonds:t,interBondsValidUnit:this.state.interBondsValidUnit,interBondsValidUnitPair:this.state.interBondsValidUnitPair,coordinateSystem:this.state.coordinateSystem,masterModel:this.state.masterModel,representativeModel:this.state.representativeModel})}asParent(){if(this._proxy)return this._proxy
if(this.parent){const e=this.parent.coordinateSystem.isIdentity?this.parent:$.transform(this.parent,this.parent.coordinateSystem.inverse),t=this.coordinateSystem.isIdentity?e:$.transform(e,this.coordinateSystem.matrix)
this._proxy=new $(t.units,t.unitMap,t.unitIndexMap,{...t.state,dynamicBonds:this.dynamicBonds},{child:this,target:this.parent})}else this._proxy=this
return this._proxy}get child(){return this._child}get target(){var e
return null!==(e=this._target)&&void 0!==e?e:this}constructor(e,t,n,r,i){this.units=e,this.unitMap=t,this.unitIndexMap=n,this.state=r,this._child=null==i?void 0:i.child,this._target=null==i?void 0:i.target,this._proxy=void 0}}function X(e,t,n){return e[t].id-e[n].id}!function(e){function t(e){return{kind:"structure-loci",structure:e}}function n(t,n={}){const i=r.Yz.Mutable(),a=r.Yz.Mutable()
let l=0,c=!0,u=t.length>0?t[0].id:0
for(let e=0,r=t.length;e<r;e++){const n=t[e]
i.set(n.id,n),l+=n.elements.length,n.id<u&&(c=!1),u=n.id}c||(0,s.di)(t,0,t.length,X,s.VE)
for(let e=0,r=t.length;e<r;e++)a.set(t[e].id,e)
const d={hashCode:-1,transformHash:-1,elementCount:l,bondCount:-1,uniqueElementCount:-1,atomicResidueCount:-1,polymerResidueCount:-1,polymerGapCount:-1,polymerUnitCount:-1,dynamicBonds:!1,coordinateSystem:o.J.Default,label:""}
return n.parent&&(d.parent=n.parent.parent||n.parent),n.interUnitBonds&&(d.interUnitBonds=n.interUnitBonds),n.interBondsValidUnit?d.interBondsValidUnit=n.interBondsValidUnit:n.parent&&(d.interBondsValidUnit=n.parent.interBondsValidUnit),n.interBondsValidUnitPair?d.interBondsValidUnitPair=n.interBondsValidUnitPair:n.parent&&(d.interBondsValidUnitPair=n.parent.interBondsValidUnitPair),n.dynamicBonds?d.dynamicBonds=n.dynamicBonds:n.parent&&(d.dynamicBonds=n.parent.dynamicBonds),n.coordinateSystem?d.coordinateSystem=n.coordinateSystem:n.parent&&(d.coordinateSystem=n.parent.coordinateSystem),n.label?d.label=n.label:n.parent&&(d.label=n.parent.label),n.masterModel?d.masterModel=n.masterModel:n.parent&&(d.masterModel=n.parent.masterModel),n.representativeModel?d.representativeModel=n.representativeModel:n.parent&&(d.representativeModel=n.parent.representativeModel),new e(t,i,a,d)}function i(e,t={}){const n=e.atomicHierarchy.chainAtomSegments,{index:i}=e.atomicHierarchy,{auth_asym_id:s}=e.atomicHierarchy.chains,{atomicChainOperatorMappinng:l}=e,d=new h({label:e.label,...t})
for(let p=0;p<n.count;p++){const t=l.get(p)||o.J.Default,h=n.offsets[p]
let f=!1,m=!1
if(u(e,p))for(m=!0;p+1<n.count&&u(e,p+1)&&l.get(p)===l.get(p+1);)f=!0,p++
else for(;p+1<n.count&&n.offsets[p+1]-n.offsets[p]===1&&n.offsets[p+2]-n.offsets[p+1]===1&&i.getEntityFromChain(p)===i.getEntityFromChain(p+1)&&s.value(p)===s.value(p+1)&&l.get(p)===l.get(p+1);)f=!0,p++
const g=r.X9.ofBounds(h,n.offsets[p+1])
let y=c.N.Trait.None
f&&(y|=c.N.Trait.MultiChain),m&&(y|=c.N.Trait.Water),a.Kx.isCoarseGrained(e)&&(y|=c.N.Trait.CoarseGrained),d.addUnit(c.N.Kind.Atomic,e,t,g,y)}const f=e.coarseHierarchy
return f.isDefined&&(f.spheres.count>0&&p(d,e,e.coarseHierarchy.spheres,c.N.Kind.Spheres),f.gaussians.count>0&&p(d,e,e.coarseHierarchy.gaussians,c.N.Kind.Gaussians)),d.getStructure()}function u(e,t){const n=e.atomicHierarchy.index.getEntityFromChain(t)
return"water"===e.entities.data.type.value(n)}function p(e,t,n,i){const{chainElementSegments:a}=n
for(let s=0;s<a.count;s++){const n=r.X9.ofBounds(a.offsets[s],a.offsets[s+1])
e.addUnit(i,t,o.J.Default,n,c.N.Trait.None)}}e.Empty=n([]),e.Loci=t,e.toStructureElementLoci=function(e){const t=[]
for(const n of e.units)t.push({unit:n,indices:r.IX.ofBounds(0,n.elements.length)})
return l.i.Loci(e,t)},e.toSubStructureElementLoci=function(e,t){return F.c.toLociWithSourceUnits(F.c.Singletons(e,t))},e.isLoci=function(e){return!!e&&"structure-loci"===e.kind},e.areLociEqual=function(e,t){return e.structure===t.structure},e.isLociEmpty=function(e){return e.structure.isEmpty},e.remapLoci=function(e,n){return n===e.structure?e:t(n)},e.create=n,e.ofTrajectory=async function(t,r){if(0===t.frameCount)return e.Empty
const o=[]
let a,s=0
for(let e=0,n=t.frameCount;e<n;++e){const n=await j.Task.resolveInContext(t.getFrameAtIndex(e),r)
a||(a=n)
const l=i(n)
for(let e=0,t=l.units.length;e<t;++e){const t=l.units[e],n=t.invariantId+s,r=t.chainGroupId+s,i=c.N.create(o.length,n,r,t.traits,t.kind,t.model,t.conformation.operator,t.elements)
o.push(i)}s=o.length}return n(o,{representativeModel:a,label:a.label})},e.ofModel=i,e.transform=function(e,t){if(b.$I.isIdentity(t))return e
if(!b.$I.isRotationAndTranslation(t,o.J.RotationTranslationEpsilon))throw new Error("Only rotation/translation combination can be applied.")
const r=[]
for(const n of e.units){const e=n.conformation.operator,i=o.J.create(e.name,t,e)
r.push(n.applyOperator(n.id,i))}const i=e.coordinateSystem
return n(r,{parent:e,coordinateSystem:o.J.compose(o.J.create(i.name,t,i),i)})},e.instances=function(e,t){for(const n of t)if(!b.$I.isRotationAndTranslation(n,o.J.RotationTranslationEpsilon))throw new Error("Only rotation/translation combination can be applied.")
const r=[]
let i=0
for(const n of e.units){const e=n.conformation.operator
for(const a of t){if(b.$I.isIdentity(a)){r.push(n)
continue}const t=o.J.create(e.name,a,e)
r.push(n.applyOperator(i++,t))}}return n(r,{parent:e})}
class h{beginChainGroup(){this.chainGroupId++,this.inChainGroup=!0}endChainGroup(){this.inChainGroup=!1}addUnit(e,t,n,r,i,o){void 0===o&&(o=this.invariantId())
const a=this.inChainGroup?this.chainGroupId:++this.chainGroupId,s=c.N.create(this.units.length,o,a,i,e,t,n,r)
return this.add(s)}copyUnit(e,t){let n=null==t?void 0:t.invariantId
void 0===n&&(n=this.invariantId())
const r=this.inChainGroup?this.chainGroupId:++this.chainGroupId,i=e.getCopy(this.units.length,n,r,t)
return this.add(i)}add(e){if(1===e.elements.length){e.conformation.position(e.elements[0],this.p)
const t=[e.invariantId,this.p[0],this.p[1],this.p[2]].join("|")
if(this.singleElementUnits.has(t))return this.singleElementUnits.get(t)
this.singleElementUnits.set(t,e)}return this.units.push(e),e}addWithOperator(e,t,n=!1){return this.add(e.applyOperator(this.units.length,t,n))}getStructure(){return n(this.units,this.props)}get isEmpty(){return 0===this.units.length}constructor(e={}){this.props=e,this.units=[],this.invariantId=(0,L.q)(),this.chainGroupId=-1,this.inChainGroup=!1,this.p=(0,b.eB)(),this.singleElementUnits=new Map}}function f(e,t){if(e===t)return!0
if(e.elementCount!==t.elementCount)return!1
const n=e.units.length
if(n!==t.units.length)return!1
for(let r=0;r<n;r++)if(e.units[r].id!==t.units[r].id)return!1
return!0}function m(e,t){return e===t||e.hashCode===t.hashCode&&d.u.areTransformGroupsEquivalent(e.unitSymmetryGroups,t.unitSymmetryGroups)}e.StructureBuilder=h,e.Builder=function(e={}){return new h(e)},e.hashCode=function(e){return e.hashCode},e.conformationHash=function(e){return(0,s.YZ)(e.units.map(e=>c.N.conformationId(e)).join("|"))},e.areUnitIdsEqual=f,e.areUnitIdsAndIndicesEqual=function(e,t){if(e===t)return!0
if(!f(e,t))return!1
for(let n=0,i=e.units.length;n<i;n++)if(!r.X9.areEqual(e.units[n].elements,t.units[n].elements))return!1
return!0},e.areHierarchiesEqual=function(e,t){if(e.hashCode!==t.hashCode)return!1
const n=e.models.length
if(n!==t.models.length)return!1
for(let r=0;r<n;r++)if(!a.Kx.areHierarchiesEqual(e.models[r],t.models[r]))return!1
return!0},e.areEquivalent=m,e.areRootsEquivalent=function(e,t){return m(e.root,t.root)},e.areRootsEqual=function(e,t){return e.root===t.root},e.ElementLocationIterator=class{move(){return this.advance(),this.current.element=this.elements[this.idx],this.current}advance(){if(this.idx<this.maxIdx)return this.idx++,void(this.idx===this.maxIdx&&(this.hasNext=this.unitIndex+1<this.structure.units.length))
this.idx=0,this.unitIndex++,this.unitIndex>=this.structure.units.length?this.hasNext=!1:(this.current.unit=this.structure.units[this.unitIndex],this.elements=this.current.unit.elements,this.maxIdx=this.elements.length-1,0===this.maxIdx&&(this.hasNext=this.unitIndex+1<this.structure.units.length))}constructor(e){this.structure=e,this.unitIndex=0,this.maxIdx=0,this.idx=-1,this.current=l.i.Location.create(e),this.hasNext=e.elementCount>0,this.hasNext&&(this.elements=e.units[0].elements,this.maxIdx=this.elements.length-1,this.current.unit=e.units[0])}}
const g=(0,b.eB)()
function y(e,t,n){const{elements:r,conformation:i}=e,o=g
let a=Number.MAX_VALUE
for(let s=0,l=r.length;s<l;s++){const e=r[s],l=b.eB.distance(t,i.position(e,o))-n-i.r(e)
l<a&&(a=l)}return a}function v(e,t,n){const{units:r}=e
let i=Number.MAX_VALUE
for(let o=0,a=r.length;o<a;o++){const e=y(r[o],t,n)
e<i&&(i=e)}return i}e.minDistanceToPoint=v
const x=(0,b.eB)()
function S(e){return e.unitSymmetryGroups.filter(e=>e.units[0].polymerElements.length>0)}let _
e.distance=function(e,t){if(0===e.elementCount||0===t.elementCount)return 0
const{units:n}=e
let r=Number.MAX_VALUE
for(let i=0,o=n.length;i<o;i++){const e=n[i],{elements:o,conformation:a}=e
for(let n=0,i=o.length;n<i;n++){const e=o[n],i=v(t,a.position(e,x),a.r(e))
i<r&&(r=i)}}return r},e.elementDescription=function(e){return 1===e.elementCount?"1 element":`${e.elementCount} elements`},e.validUnitPair=function(e,t,n){return e.masterModel?t.model===n.model||t.model===e.masterModel||n.model===e.masterModel:t.model===n.model},e.eachUnitPair=function(e,t,n){const{maxRadius:r,validUnit:i,validUnitPair:o}=n
if(!e.units.some(e=>i(e)))return
const a=e.lookup3d,s=(0,b.eB)()
for(const l of e.units){if(!i(l))continue
const n=l.boundary.sphere
b.eB.transformMat4(s,n.center,l.conformation.operator.matrix)
const c=a.findUnitIndices(s[0],s[1],s[2],n.radius+r)
for(let r=0;r<c.count;r++){const n=e.units[c.indices[r]]
l.id>=n.id||i(n)&&o(l,n)&&(n.elements.length>=l.elements.length?t(l,n):t(n,l))}}},e.eachAtomicHierarchyElement=function(e,{chain:t,residue:n,atom:i}){const o=l.i.Location.create(e)
for(const a of e.units){if(a.kind!==c.N.Kind.Atomic)continue
o.unit=a
const{elements:e}=a,s=r.hT.transientSegments(a.model.atomicHierarchy.chainAtomSegments,e),l=r.hT.transientSegments(a.model.atomicHierarchy.residueAtomSegments,e)
for(;s.hasNext;){const r=s.move()
if(t&&(o.element=e[r.start],t(o)),n||i)for(l.setSegment(r);l.hasNext;){const t=l.move()
if(n&&(o.element=e[t.start],n(o)),i)for(let n=t.start,r=t.end;n<r;n++)o.element=e[n],i(o)}}}},e.DefaultSizeThresholds={smallResidueCount:10,mediumResidueCount:5e3,largeResidueCount:3e4,highSymmetryUnitCount:10,fiberResidueCount:15},function(e){e[e.Small=0]="Small",e[e.Medium=1]="Medium",e[e.Large=2]="Large",e[e.Huge=3]="Huge",e[e.Gigantic=4]="Gigantic"}(_=e.Size||(e.Size={})),e.getSize=function(t,n={},r=1){const i={...e.DefaultSizeThresholds,...n}
return t.polymerResidueCount>=i.largeResidueCount*r?function(e,t){const n=S(e)
return n.length>=1&&n[0].units.length>t.highSymmetryUnitCount}(t,i)?_.Huge:_.Gigantic:function(e,t){const n=S(e)
return 1===n.length&&n[0].units.length>2&&n[0].units[0].polymerElements.length<t.fiberResidueCount}(t,i)||t.polymerResidueCount<i.smallResidueCount*r?_.Small:t.polymerResidueCount<i.mediumResidueCount*r?_.Medium:_.Large},e.Index=z.S.createSimple("index","root"),e.MaxIndex=z.S.createSimple("max_index","root")
const C="__PrincipalAxes__"
e.getPrincipalAxes=function(t){if(t.currentPropertyData[C])return t.currentPropertyData[C]
const n=l.i.Loci.getPrincipalAxes(e.toStructureElementLoci(t))
return t.currentPropertyData[C]=n,n}}($||($={}))},20371(e,t,n){"use strict"
var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}}
Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){let n=null
if(!e||"string"!=typeof e)return n
const r=(0,i.default)(e),o="function"==typeof t
return r.forEach(e=>{if("declaration"!==e.type)return
const{property:r,value:i}=e
o?t(r,i,e):i&&(n=n||{},n[r]=i)}),n}
const i=r(n(60755))},20456(e,t,n){"use strict"
n.r(t),n.d(t,{default:()=>i})
var r=n(15670)
function i(e,t){return(0,r.A)(e)!==(0,r.A)(t)}},20610(e,t,n){"use strict"
n.d(t,{N:()=>i})
var r=n(18891)
function i(e){return function(t){if(function(e){return(0,r.T)(null==e?void 0:e.lift)}(t))return t.lift(function(t){try{return e(t,this)}catch(e){this.error(e)}})
throw new TypeError("Unable to lift unknown Observable type")}}},20644(e,t,n){"use strict"
n.r(t),n.d(t,{DefaultPluginUISpec:()=>ne})
var r={}
n.r(r),n.d(r,{AssignColorVolume:()=>B,DownloadDensity:()=>P})
var i=n(6950),o=n(21946),a=n(39298),s=n(33241),l=n(43472),c=n(15382),u=n(92384)
const d=o.b.create({name:"built-in.animate-assembly-unwind",display:{name:"Unwind Assembly"},isExportable:!0,params:e=>{const t=[["all","All"]],n=e.state.data.select(l.QX.Generators.rootsOfType(a.O.Molecule.Structure))
for(const r of n)t.push([r.transform.ref,r.obj.data.models[0].label])
return{durationInMs:u.t.Numeric(3e3,{min:100,max:1e4,step:100}),playOnce:u.t.Boolean(!1),target:u.t.Select(t[0][0],t)}},canApply(e){const t=e.state.data,n=l.Cn.RootRef
return{canApply:t.select(l.QX.Generators.ofType(a.O.Molecule.Structure.Representation3D,n)).length>0}},getDuration:e=>({kind:"fixed",durationMs:e.durationInMs}),initialState:()=>({t:0}),setup(e,t,n){const r=n.state.data,i=e.target&&"all"!==e.target?e.target:l.Cn.RootRef,o=r.select(l.QX.Generators.ofType(a.O.Molecule.Structure.Representation3D,i)),c=r.build()
let u=!1
for(const a of o)r.select(l.QX.Generators.ofTransformer(s.f.Representation.UnwindStructureAssemblyRepresentation3D,a.transform.ref)).length>0||(u=!0,c.to(a).apply(s.f.Representation.UnwindStructureAssemblyRepresentation3D,{t:0},{tags:"animate-assembly-unwind"}))
if(u)return c.commit({doNotUpdateCurrent:!0})},teardown(e,t,n){const r=n.state.data,i=r.select(l.QX.Generators.ofType(a.O.Molecule.Structure.Representation3DState).withTag("animate-assembly-unwind"))
if(0===i.length)return
const o=r.build()
for(const a of i)o.delete(a.transform.ref)
return o.commit()},async apply(e,t,n){const r=n.plugin.state.data,i=n.params.target&&"all"!==n.params.target?n.params.target:l.Cn.RootRef,o=r.select(l.QX.Generators.ofTransformer(s.f.Representation.UnwindStructureAssemblyRepresentation3D,i))
if(0===o.length)return{kind:"finished"}
const a=r.build(),u=(t.current-t.lastApplied)/n.params.durationInMs
let d=e.t+u,p=!1
n.params.playOnce&&d>=1?(p=!0,d=1):d%=1
for(const s of o)a.to(s).update({t:d})
return await c.PluginCommands.State.Update(n.plugin,{state:r,tree:a,options:{doNotLogTiming:!0}}),p?{kind:"finished"}:{kind:"next",state:{t:d}}}})
var p=n(97564),h=n(6539),f=n(37411)
const m=(0,f.e)(),g=(0,f.e)(),y=(0,h.k)(),v=o.b.create({name:"built-in.animate-camera-spin",display:{name:"Camera Spin",description:"Spin the 3D scene around the x-axis in view space"},isExportable:!0,params:()=>({durationInMs:u.t.Numeric(4e3,{min:100,max:2e4,step:100}),speed:u.t.Numeric(1,{min:1,max:10,step:1},{description:"How many times to spin in the specified duration."}),direction:u.t.Select("cw",[["cw","Clockwise"],["ccw","Counter Clockwise"]],{cycle:!0})}),initialState:(e,t)=>{var n
return{snapshot:null===(n=t.canvas3d)||void 0===n?void 0:n.camera.getSnapshot()}},getDuration:e=>({kind:"fixed",durationMs:e.durationInMs}),teardown:(e,t,n)=>{var r
null===(r=n.canvas3d)||void 0===r||r.requestCameraReset({snapshot:t.snapshot,durationMs:0})},async apply(e,t,n){var r,i
if(0===t.current)return{kind:"next",state:e}
const o=e.snapshot
if(o.radiusMax<1e-4)return{kind:"finished"}
const a=t.animation?(null===(r=t.animation)||void 0===r?void 0:r.currentFrame)/(t.animation.frameCount+1):(0,p.qE)(t.current/n.params.durationInMs,0,1),s=2*Math.PI*a*n.params.speed*("ccw"===n.params.direction?-1:1)
f.e.sub(m,o.position,o.target),f.e.normalize(g,o.up),h.k.setAxisAngle(y,g,s),f.e.transformQuat(m,m,y)
const l=f.e.add((0,f.e)(),o.target,m)
return null===(i=n.plugin.canvas3d)||void 0===i||i.requestCameraReset({snapshot:{...o,position:l},durationMs:0}),a>=.99999?{kind:"finished"}:{kind:"next",state:e}}}),b=o.b.create({name:"built-in.animate-model-index",display:{name:"Animate Trajectory"},isExportable:!0,params:()=>({mode:u.t.MappedStatic("loop",{palindrome:u.t.Group({}),loop:u.t.Group({direction:u.t.Select("forward",[["forward","Forward"],["backward","Backward"]])}),once:u.t.Group({direction:u.t.Select("forward",[["forward","Forward"],["backward","Backward"]])},{isFlat:!0})},{options:[["palindrome","Palindrome"],["loop","Loop"],["once","Once"]]}),duration:u.t.MappedStatic("fixed",{fixed:u.t.Group({durationInS:u.t.Numeric(5,{min:1,max:120,step:.1},{description:"Duration in seconds"})},{isFlat:!0}),computed:u.t.Group({targetFps:u.t.Numeric(30,{min:5,max:250,step:1},{label:"Target FPS"})},{isFlat:!0}),sequential:u.t.Group({maxFps:u.t.Numeric(30,{min:5,max:60,step:1})},{isFlat:!0})})}),canApply(e){const t=e.state.data,n=t.select(l.QX.Generators.ofTransformer(s.f.Model.ModelFromTrajectory))
for(const r of n){const e=l.QX.findAncestorOfType(t.tree,t.cells,r.transform.ref,a.O.Molecule.Trajectory)
if(e&&e.obj&&e.obj.data.frameCount>1)return{canApply:!0}}return{canApply:!1,reason:"No trajectory to animate"}},getDuration:(e,t)=>{var n
if("fixed"===(null===(n=e.duration)||void 0===n?void 0:n.name))return{kind:"fixed",durationMs:1e3*e.duration.params.durationInS}
if("computed"===e.duration.name){const n=t.state.data,r=n.select(l.QX.Generators.ofTransformer(s.f.Model.ModelFromTrajectory))
let i=0
for(const t of r){const r=l.QX.findAncestorOfType(n.tree,n.cells,t.transform.ref,a.O.Molecule.Trajectory)
if(!r||!r.obj)continue
const o=r.obj
i=Math.max(Math.ceil(1e3*o.data.frameCount/e.duration.params.targetFps),i)}return{kind:"fixed",durationMs:i}}return{kind:"unknown"}},initialState:()=>({}),async apply(e,t,n){if("sequential"===n.params.duration.name&&t.current>0&&t.current-t.lastApplied<1e3/n.params.duration.params.maxFps)return{kind:"skip"}
const r=n.plugin.state.data,i=r.select(l.QX.Generators.ofTransformer(s.f.Model.ModelFromTrajectory))
if(0===i.length)return{kind:"finished"}
const o=r.build(),u=n.params,d=e.palindromeDirections||{}
let p=!1,h=!0
for(const s of i){const e=l.QX.findAncestorOfType(r.tree,r.cells,s.transform.ref,a.O.Molecule.Trajectory)
if(!e||!e.obj)continue
const n=e.obj
n.data.frameCount<=1||o.to(s).update(e=>{const r=n.data.frameCount
if(1===r)return e
if(h=!1,"sequential"===u.duration.name){let t=1
if("once"===u.mode.name){if(t="backward"===u.mode.params.direction?-1:1,-1===t&&0===e.modelIndex||1===t&&e.modelIndex===r-1)return p=!0,e}else"palindrome"===u.mode.name&&(t=0===e.modelIndex?1:e.modelIndex===r-1?-1:d[s.transform.ref]||1)
d[s.transform.ref]=t
let n=(e.modelIndex+t)%r
return n<0&&(n+=r),p=p||-1===t&&0===n||1===t&&n===r-1,{modelIndex:n}}{const e="fixed"===u.duration.name?1e3*u.duration.params.durationInS:Math.ceil(1e3*n.data.frameCount/u.duration.params.targetFps)
if("once"===u.mode.name&&t.current>=e)return p=!0,{modelIndex:n.data.frameCount-1}
let r=t.current%e/e
return"loop"===u.mode.name&&"backward"===u.mode.params.direction&&(r=1-r),"palindrome"===u.mode.name&&(r*=2,r>1&&(r=2-r)),{modelIndex:Math.min(Math.floor(n.data.frameCount*r),n.data.frameCount-1)}}})}return h||await c.PluginCommands.State.Update(n.plugin,{state:r,tree:o,options:{doNotLogTiming:!0}}),h||"once"===u.mode.name&&p?{kind:"finished"}:"palindrome"===u.mode.name?{kind:"next",state:{palindromeDirections:d}}:{kind:"next",state:{}}}})
var x=n(31993),S=n(41428),_=n(47954),C=n(21191),w=n(70292),T=n(33204),A=n(32372),I=n(91229)
const P=l.KW.build({from:a.O.Root,display:{name:"Download Density",description:"Load a density from the provided source and create its default visual."},params:(e,t)=>{const{options:n}=t.dataFormats
return{source:u.t.MappedStatic("pdb-xray",{"pdb-xray":u.t.Group({provider:u.t.Group({id:u.t.Text("1tqn",{label:"Id"}),server:u.t.Select("pdbe",[["pdbe","PDBe"]])},{pivot:"id"}),type:u.t.Select("2fofc",[["2fofc","2Fo-Fc"],["fofc","Fo-Fc"]])},{isFlat:!0}),"pdb-xray-ds":u.t.Group({provider:u.t.Group({id:u.t.Text("1tqn",{label:"Id"}),server:u.t.Select("pdbe",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),detail:u.t.Numeric(3,{min:0,max:6,step:1},{label:"Detail"})},{isFlat:!0}),"pdb-emd-ds":u.t.Group({provider:u.t.Group({id:u.t.Text("emd-8004",{label:"Id"}),server:u.t.Select("pdbe",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),detail:u.t.Numeric(3,{min:0,max:6,step:1},{label:"Detail"})},{isFlat:!0}),url:u.t.Group({url:u.t.Url(""),isBinary:u.t.Boolean(!1),format:u.t.Select("auto",n)},{isFlat:!0})},{options:[["pdb-xray","PDB X-ray maps"],["pdb-emd-ds","PDB EMD Density Server"],["pdb-xray-ds","PDB X-ray Density Server"],["url","URL"]]})}}})(({params:e},t)=>w.Task.create("Download Density",async n=>{var r,i
const o=e.source
let a,s
switch(o.name){case"url":a=o.params
break
case"pdb-xray":a={url:A.V.Url("2fofc"===o.params.type?`https://www.ebi.ac.uk/pdbe/coordinates/files/${o.params.provider.id.toLowerCase()}.ccp4`:`https://www.ebi.ac.uk/pdbe/coordinates/files/${o.params.provider.id.toLowerCase()}_diff.ccp4`),isBinary:!0,label:`PDBe X-ray map: ${o.params.provider.id}`}
break
case"pdb-emd-ds":a="pdbe"===o.params.provider.server?{url:A.V.Url(`https://www.ebi.ac.uk/pdbe/densities/emd/${o.params.provider.id.toLowerCase()}/cell?detail=${o.params.detail}`),isBinary:!0,label:`PDBe EMD Density Server: ${o.params.provider.id}`}:{url:A.V.Url(`https://maps.rcsb.org/em/${o.params.provider.id.toLowerCase()}/cell?detail=${o.params.detail}`),isBinary:!0,label:`RCSB PDB EMD Density Server: ${o.params.provider.id}`}
break
case"pdb-xray-ds":a="pdbe"===o.params.provider.server?{url:A.V.Url(`https://www.ebi.ac.uk/pdbe/densities/x-ray/${o.params.provider.id.toLowerCase()}/cell?detail=${o.params.detail}`),isBinary:!0,label:`PDBe X-ray Density Server: ${o.params.provider.id}`}:{url:A.V.Url(`https://maps.rcsb.org/x-ray/${o.params.provider.id.toLowerCase()}/cell?detail=${o.params.detail}`),isBinary:!0,label:`RCSB PDB X-ray Density Server: ${o.params.provider.id}`}
break
default:(0,I.dr)(o)}const l=await t.builders.data.download(a)
let c
switch(o.name){case"url":a=o.params,s="auto"===o.params.format?t.dataFormats.auto((0,T.o)(A.V.getUrl(a.url)),null===(r=l.cell)||void 0===r?void 0:r.obj):t.dataFormats.get(o.params.format)
break
case"pdb-xray":c=o.params.provider.id,s=t.dataFormats.get("ccp4")
break
case"pdb-emd-ds":case"pdb-xray-ds":c=o.params.provider.id,s=t.dataFormats.get("dscif")
break
default:(0,I.dr)(o)}if(!s)return void t.log.warn("DownloadDensity: Format provider not found.")
const u=await s.parse(t,l,{entryId:c})
await(null===(i=s.visuals)||void 0===i?void 0:i.call(s,t,u))})),B=l.KW.build({display:{name:"Assign Volume Colors",description:"Assigns another volume to be available for coloring."},from:a.O.Volume.Data,isApplicable:e=>!e.data.colorVolume,params(e,t){const n=t.state.data.select(l.QX.Generators.root.subtree().ofType(a.O.Volume.Data).filter(t=>{var n
return!!t.obj&&!(null===(n=t.obj)||void 0===n?void 0:n.data.colorVolume)&&t.obj!==e}))
return 0===n.length?{ref:u.t.Text("",{isHidden:!0,label:"Volume"})}:{ref:u.t.Select(n[0].transform.ref,n.map(e=>[e.transform.ref,e.obj.label]),{label:"Volume"})}}})(({ref:e,params:t,state:n},r)=>r.build().to(e).apply(s.f.Volume.AssignColorVolume,{ref:t.ref},{dependsOn:[t.ref]}).commit()),E={Structure:C,Volume:r,DataFormat:n(8054)}
var k=n(9043)
const D=o.b.create({name:"built-in.animate-state-interpolation",display:{name:"Animate State (experimental)"},params:()=>({transtionDurationInMs:u.t.Numeric(2e3,{min:100,max:3e4,step:10})}),canApply:e=>({canApply:e.managers.snapshot.state.entries.size>1}),initialState:()=>({}),async apply(e,t,n){const r=n.plugin.managers.snapshot.state.entries
if(r.size<2)return{kind:"finished"}
const i=t.current%n.params.transtionDurationInMs/n.params.transtionDurationInMs,o=Math.floor(t.current/n.params.transtionDurationInMs)%r.size
let a=Math.ceil(t.current/n.params.transtionDurationInMs)
a===o&&a++,a%=r.size
const s=r.get(o).snapshot,u=r.get(a).snapshot
if(!s.data||!u.data)return{kind:"skip"}
const d=s.data.tree.transforms,p=u.data.tree.transforms,h=n.plugin.state.data,f=h.build()
for(const c of d)for(const e of p){if(e.ref!==c.ref)continue
if(e.version===c.version)continue
const t=l.Cn.fromJSON(c),r=l.Cn.fromJSON(e),o=h.cells.get(c.ref)
if(!o)continue
let a
a=t.transformer.definition.interpolate?t.transformer.definition.interpolate(t.params,r.params,i,n.plugin):i<=.5?t.params:r.params,(0,k.bN)(o,a)||f.to(c.ref).update(a)}return await c.PluginCommands.State.Update(n.plugin,{state:h,tree:f,options:{doNotLogTiming:!0}}),{kind:"next",state:{}}}}),M=o.b.create({name:"built-in.animate-structure-spin",display:{name:"Spin Structure"},isExportable:!0,params:()=>({durationInMs:u.t.Numeric(3e3,{min:100,max:1e4,step:100})}),initialState:()=>({t:0}),getDuration:e=>({kind:"fixed",durationMs:e.durationInMs}),async setup(e,t,n){const r=n.state.data,i=r.select(l.QX.Generators.ofType(a.O.Molecule.Structure.Representation3D)),o=r.build()
let c=!1
for(const a of i)r.select(l.QX.Generators.ofTransformer(s.f.Representation.SpinStructureRepresentation3D,a.transform.ref)).length>0||(c=!0,o.to(a.transform.ref).apply(s.f.Representation.SpinStructureRepresentation3D,{t:0},{tags:"animate-structure-spin"}))
if(c)return o.commit({doNotUpdateCurrent:!0})},teardown(e,t,n){const r=n.state.data,i=r.select(l.QX.Generators.ofType(a.O.Molecule.Structure.Representation3DState).withTag("animate-structure-spin"))
if(0===i.length)return
const o=r.build()
for(const a of i)o.delete(a.transform.ref)
return o.commit()},async apply(e,t,n){var r
const i=n.plugin.state.data,o=i.select(l.QX.Generators.ofTransformer(s.f.Representation.SpinStructureRepresentation3D))
if(0===o.length)return{kind:"finished"}
const a=i.build(),u=(t.current-t.lastApplied)/n.params.durationInMs,d=(e.t+u)%1
for(const s of o)a.to(s).update({...null===(r=s.params)||void 0===r?void 0:r.values,t:d})
return await c.PluginCommands.State.Update(n.plugin,{state:i,tree:a,options:{doNotLogTiming:!0}}),{kind:"next",state:{t:d}}}})
var R=n(87423)
const O=(0,f.e)(),L=(0,f.e)(),N=(0,h.k)(),F=o.b.create({name:"built-in.animate-camera-rock",display:{name:"Camera Rock",description:"Rock the 3D scene around the x-axis in view space"},isExportable:!0,params:()=>({durationInMs:u.t.Numeric(4e3,{min:100,max:2e4,step:100}),speed:u.t.Numeric(1,{min:1,max:10,step:1},{description:"How many times to rock from side to side."}),angle:u.t.Numeric(10,{min:0,max:180,step:1},{description:"How many degrees to rotate in each direction."})}),initialState:(e,t)=>({snapshot:t.canvas3d.camera.getSnapshot()}),getDuration:e=>({kind:"fixed",durationMs:e.durationInMs}),teardown:(e,t,n)=>{var r
null===(r=n.canvas3d)||void 0===r||r.requestCameraReset({snapshot:t.snapshot,durationMs:0})},async apply(e,t,n){var r,i
if(0===t.current)return{kind:"next",state:e}
const o=e.snapshot
if(o.radiusMax<1e-4)return{kind:"finished"}
const a=t.animation?(null===(r=t.animation)||void 0===r?void 0:r.currentFrame)/(t.animation.frameCount+1):(0,p.qE)(t.current/n.params.durationInMs,0,1),s=Math.sin(a*n.params.speed*Math.PI*2)*(0,R.pu)(n.params.angle)
f.e.sub(O,o.position,o.target),f.e.normalize(L,o.up),h.k.setAxisAngle(N,L,s),f.e.transformQuat(O,O,N)
const l=f.e.add((0,f.e)(),o.target,O)
return null===(i=n.plugin.canvas3d)||void 0===i||i.requestCameraReset({snapshot:{...o,position:l},durationMs:0}),a>=.99999?{kind:"finished"}:{kind:"next",state:e}}})
var z
!function(e){e.Action=function(e,t){return{action:e,customControl:t&&t.customControl,autoUpdate:t&&t.autoUpdate}},e.Behavior=function(e,t={}){return{transformer:e,defaultParams:t}}}(z||(z={}))
var j=n(28074),V=n(46098),U=n(94528),G=n(38981),H=n(57331),q=n(87877),Q=n(90050),$=n(32775),X=n(50709),W=n(69396),Y=n(99507),Z=n(41288)
const K={color:u.t.Color(X.ColorNames.black,{description:"Display color of the volume."}),wireframe:u.t.Boolean(!1,{description:"Control display of the volume as a wireframe."}),opacity:u.t.Numeric(.3,{min:0,max:1,step:.01},{description:"Opacity of the volume."})},J=new Map([["em",[-5,5]],["2fo-fc",[0,3]],["fo-fc(+ve)",[1,5]],["fo-fc(-ve)",[-5,-1]]])
class ee extends V.dL{constructor(){super(...arguments),this.ref=l.QX.findTagInSubtree(this.plugin.state.data.tree,this.props.bCell.transform.ref,this.props.name),this.getVisible=()=>{const e=this.plugin.state.data,t=this.ref
return!!t&&!e.cells.get(t).state.isHidden},this.toggleVisible=()=>{const e=this.plugin.state.data,t=this.ref
t&&(0,Y.setSubtreeVisibility)(e,t,!e.cells.get(t).state.isHidden)}}componentDidUpdate(){this.ref=l.QX.findTagInSubtree(this.plugin.state.data.tree,this.props.bCell.transform.ref,this.props.name)}componentDidMount(){this.subscribe(this.plugin.state.data.events.cell.stateUpdated,e=>{this.ref===e.ref&&this.forceUpdate()})}render(){const e=this.props,{isRelative:t,stats:n}=e,r=e.channels[e.name],{min:i,max:o,mean:a,sigma:s}=n,l=Math.round(100*("relative"===r.isoValue.kind?r.isoValue.relativeValue:r.isoValue.absoluteValue))/100
let c=(i-a)/s,u=(o-a)/s
if(!this.props.isUnbounded){const e=J.get(this.props.name)
"em"===this.props.name?(c=Math.max(e[0],c),u=Math.min(e[1],u)):(c=e[0],u=e[1])}const d=a+s*c,p=a+s*u,h=(0,W.QX)(t?Math.round((p-d)/s)/100:s/100,2),f=t?c:d,m=t?u:p
return(0,j.jsx)(G.U2,{label:e.label+(e.isRelative?" ":""),colorStripe:r.color,pivot:(0,j.jsxs)("div",{className:"msp-volume-channel-inline-controls",children:[(0,j.jsx)(q.Ap,{value:l,min:f,max:m,step:h,onChange:n=>e.changeIso(e.name,n,t),onChangeImmediate:n=>e.changeIso(e.name,n,t),disabled:e.params.isDisabled,onEnter:e.params.events.onEnter}),(0,j.jsx)(G.K0,{svg:this.getVisible()?Z.zs:Z.qF,onClick:this.toggleVisible,toggleState:!1,disabled:e.params.isDisabled})]}),controls:(0,j.jsx)(H.y1,{onChange:({name:t,value:n})=>e.changeParams(e.name,t,n),params:K,values:r,onEnter:e.params.events.onEnter,isDisabled:e.params.isDisabled})})}}class te extends V.dL{constructor(){super(...arguments),this.changeIso=(e,t,n)=>{const r=this.props.params
this.newParams({...r,entry:{name:r.entry.name,params:{...r.entry.params,channels:{...r.entry.params.channels,[e]:{...r.entry.params.channels[e],isoValue:n?Q.f.IsoValue.relative(t):Q.f.IsoValue.absolute(t)}}}}})},this.changeParams=(e,t,n)=>{const r=this.props.params
this.newParams({...r,entry:{name:r.entry.name,params:{...r.entry.params,channels:{...r.entry.params.channels,[e]:{...r.entry.params.channels[e],[t]:n}}}}})},this.changeOption=({name:e,value:t})=>{const n=this.props.params
if("entry"===e)this.newParams({...n,entry:{name:t,params:n.entry.params}})
else{const e=this.props.b.data,r="em"===e.info.kind,i=t.params.isRelative,o=e.info.header.sampling[0],a=n.entry.params.channels,s={...n.entry.params.view.name===t.name?n.entry.params.view.params:this.props.info.params.entry.map(n.entry.name).params.view.map(t.name).defaultValue}
"selection-box"===t.name?s.radius=t.params.radius:"camera-target"===t.name?(s.radius=t.params.radius,s.dynamicDetailLevel=t.params.dynamicDetailLevel):"box"===t.name?(s.bottomLeft=t.params.bottomLeft,s.topRight=t.params.topRight):"auto"===t.name&&(s.radius=t.params.radius,s.selectionDetailLevel=t.params.selectionDetailLevel),s.isUnbounded=!!t.params.isUnbounded,this.newParams({...n,entry:{name:n.entry.name,params:{...n.entry.params,view:{name:t.name,params:s},detailLevel:t.params.detailLevel,channels:r?{em:this.convert(a.em,o.valuesInfo[0],i)}:{"2fo-fc":this.convert(a["2fo-fc"],o.valuesInfo[0],i),"fo-fc(+ve)":this.convert(a["fo-fc(+ve)"],o.valuesInfo[1],i),"fo-fc(-ve)":this.convert(a["fo-fc(-ve)"],o.valuesInfo[1],i)}}}})}}}areInitial(e){return u.t.areEqual(this.props.info.params,e,this.props.info.initialValues)}newParams(e){this.props.events.onChange(e,this.areInitial(e))}convert(e,t,n){return{...e,isoValue:n?Q.f.IsoValue.toRelative(e.isoValue,t):Q.f.IsoValue.toAbsolute(e.isoValue,t)}}render(){if(!this.props.b)return null
const e=this.props.b.data,t="em"===e.info.kind,n=t?"em":"2fo-fc",r=this.props.params,i=this.props.info.params.entry.map(r.entry.name),o=i.params.detailLevel,a={...o,label:"Dynamic Detail",defaultValue:i.params.view.map("camera-target").params.dynamicDetailLevel.defaultValue},s={...o,label:"Selection Detail",defaultValue:i.params.view.map("auto").params.selectionDetailLevel.defaultValue},l=e.info.header.sampling[0],c="relative"===r.entry.params.channels[n].isoValue.kind,d=u.t.Boolean(c,{description:"Use normalized or absolute isocontour scale.",label:"Normalized"}),p=!!r.entry.params.view.params.isUnbounded,h=u.t.Boolean(p,{description:"Show full/limited range of iso-values for more fine-grained control.",label:"Unbounded"}),f="off"===r.entry.params.view.name,m={entry:u.t.Select(r.entry.name,e.data.entries.map(e=>[e.dataId,e.dataId]),{isHidden:f,description:"Which entry with volume data to display."}),view:u.t.MappedStatic(r.entry.params.view.name,{off:u.t.Group({isRelative:u.t.Boolean(c,{isHidden:!0}),isUnbounded:u.t.Boolean(p,{isHidden:!0})},{description:"Display off."}),box:u.t.Group({bottomLeft:u.t.Vec3($.eB.zero()),topRight:u.t.Vec3($.eB.zero()),detailLevel:o,isRelative:d,isUnbounded:h},{description:"Static box defined by cartesian coords."}),"selection-box":u.t.Group({radius:u.t.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in  within which the volume is shown."}),detailLevel:o,isRelative:d,isUnbounded:h},{description:"Box around focused element."}),"camera-target":u.t.Group({radius:u.t.Numeric(.5,{min:0,max:1,step:.05},{description:"Radius within which the volume is shown (relative to the field of view)."}),detailLevel:{...o,isHidden:!0},dynamicDetailLevel:a,isRelative:d,isUnbounded:h},{description:"Box around camera target."}),cell:u.t.Group({detailLevel:o,isRelative:d,isUnbounded:h},{description:"Box around the structure's bounding box."}),auto:u.t.Group({radius:u.t.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in  within which the volume is shown."}),detailLevel:o,selectionDetailLevel:s,isRelative:d,isUnbounded:h},{description:"Box around focused element."})},{options:U.h.ViewTypeOptions,description:'Controls what of the volume is displayed. "Off" hides the volume alltogether. "Bounded box" shows the volume inside the given box. "Around Focus" shows the volume around the element/atom last interacted with. "Around Camera" shows the volume around the point the camera is targeting. "Whole Structure" shows the volume for the whole structure.'})},g={entry:r.entry.name,view:{name:r.entry.params.view.name,params:{detailLevel:r.entry.params.detailLevel,radius:r.entry.params.view.params.radius,bottomLeft:r.entry.params.view.params.bottomLeft,topRight:r.entry.params.view.params.topRight,selectionDetailLevel:r.entry.params.view.params.selectionDetailLevel,dynamicDetailLevel:r.entry.params.view.params.dynamicDetailLevel,isRelative:c,isUnbounded:p}}}
return f?(0,j.jsx)(H.y1,{onChange:this.changeOption,params:m,values:g,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled}):(0,j.jsxs)(j.Fragment,{children:[!t&&(0,j.jsx)(ee,{label:"2Fo-Fc",name:"2fo-fc",bCell:this.props.bCell,channels:r.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:c,params:this.props,stats:l.valuesInfo[0],isUnbounded:p}),!t&&(0,j.jsx)(ee,{label:"Fo-Fc(+ve)",name:"fo-fc(+ve)",bCell:this.props.bCell,channels:r.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:c,params:this.props,stats:l.valuesInfo[1],isUnbounded:p}),!t&&(0,j.jsx)(ee,{label:"Fo-Fc(-ve)",name:"fo-fc(-ve)",bCell:this.props.bCell,channels:r.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:c,params:this.props,stats:l.valuesInfo[1],isUnbounded:p}),t&&(0,j.jsx)(ee,{label:"EM",name:"em",bCell:this.props.bCell,channels:r.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:c,params:this.props,stats:l.valuesInfo[0],isUnbounded:p}),(0,j.jsx)(H.y1,{onChange:this.changeOption,params:m,values:g,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled})]})}}const ne=()=>({actions:[z.Action(E.Structure.DownloadStructure),z.Action(E.Volume.DownloadDensity),z.Action(E.DataFormat.DownloadFile),z.Action(E.DataFormat.OpenFiles),z.Action(E.Structure.LoadTrajectory),z.Action(E.Structure.EnableModelCustomProps),z.Action(E.Structure.EnableStructureCustomProps),z.Action(i.p3),z.Action(i.Cd),z.Action(i.N$),z.Action(s.f.Data.Download),z.Action(s.f.Data.ParseCif),z.Action(s.f.Data.ParseCcp4),z.Action(s.f.Data.ParseDsn6),z.Action(s.f.Model.TrajectoryFromMmCif),z.Action(s.f.Model.TrajectoryFromCifCore),z.Action(s.f.Model.TrajectoryFromPDB),z.Action(s.f.Model.TransformStructureConformation),z.Action(s.f.Model.StructureInstances),z.Action(s.f.Model.StructureFromModel),z.Action(s.f.Model.StructureFromTrajectory),z.Action(s.f.Model.ModelFromTrajectory),z.Action(s.f.Model.StructureSelectionFromScript),z.Action(s.f.Representation.StructureRepresentation3D),z.Action(s.f.Representation.StructureSelectionsDistance3D),z.Action(s.f.Representation.StructureSelectionsAngle3D),z.Action(s.f.Representation.StructureSelectionsDihedral3D),z.Action(s.f.Representation.StructureSelectionsLabel3D),z.Action(s.f.Representation.StructureSelectionsOrientation3D),z.Action(s.f.Representation.ModelUnitcell3D),z.Action(s.f.Representation.StructureBoundingBox3D),z.Action(s.f.Representation.ExplodeStructureRepresentation3D),z.Action(s.f.Representation.SpinStructureRepresentation3D),z.Action(s.f.Representation.UnwindStructureAssemblyRepresentation3D),z.Action(s.f.Representation.OverpaintStructureRepresentation3DFromScript),z.Action(s.f.Representation.TransparencyStructureRepresentation3DFromScript),z.Action(s.f.Representation.ClippingStructureRepresentation3DFromScript),z.Action(s.f.Representation.SubstanceStructureRepresentation3DFromScript),z.Action(s.f.Representation.ThemeStrengthRepresentation3D),z.Action(B),z.Action(s.f.Volume.VolumeFromCcp4),z.Action(s.f.Volume.VolumeFromDsn6),z.Action(s.f.Volume.VolumeFromCube),z.Action(s.f.Volume.VolumeFromDx),z.Action(s.f.Representation.VolumeRepresentation3D),z.Action(s.f.Volume.VolumeTransform),z.Action(s.f.Volume.VolumeInstances)],behaviors:[z.Behavior(S.Zw.Representation.HighlightLoci),z.Behavior(S.Zw.Representation.SelectLoci),z.Behavior(S.Zw.Representation.DefaultLociLabelProvider),z.Behavior(S.Zw.Representation.FocusLoci),z.Behavior(S.Zw.Camera.FocusLoci),z.Behavior(S.Zw.Camera.CameraAxisHelper),z.Behavior(S.Zw.Camera.CameraControls),z.Behavior(S.Zw.State.SnapshotControls),z.Behavior(_.StructureFocusRepresentation),z.Behavior(S.Zw.CustomProps.StructureInfo),z.Behavior(S.Zw.CustomProps.AccessibleSurfaceArea),z.Behavior(S.Zw.CustomProps.BestDatabaseSequenceMapping),z.Behavior(S.Zw.CustomProps.Interactions),z.Behavior(S.Zw.CustomProps.SecondaryStructure),z.Behavior(S.Zw.CustomProps.ValenceModel),z.Behavior(S.Zw.CustomProps.CrossLinkRestraint)],animations:[b,v,F,x.G,x.c,d,M,D],customParamEditors:[[i.N$,te]]})},20924(e,t,n){"use strict"
function r(e,t){return{start:t&&void 0!==t.start?Math.max(Math.min(t.start,e-1),0):0,end:t&&void 0!==t.end?Math.min(t.end,e):e}}function i(e,t){const n=t&&void 0!==t.array?t.array:Array,{start:i,end:o}=r(e,t)
return{array:new n(o-i),start:i,end:o}}function o(e,t,n){for(let r=0,i=t.length;r<i;r++)t[r]=e(n+r)
return t}function a(e,t,n){const{array:r,start:a}=i(e,n)
return o(t,r,a)}function s(e){return!!e.buffer&&"number"==typeof e.byteLength&&"number"==typeof e.BYTES_PER_ELEMENT}function l(e,t){const{constructor:n,buffer:i,length:o,byteOffset:a,BYTES_PER_ELEMENT:s}=e,{start:l,end:c}=r(o,t)
return 0===l&&c===o?e:new n(i,a+s*l,Math.min(o,c-l))}n.r(t),n.d(t,{createAndFillArray:()=>a,createArray:()=>i,fillArrayValues:()=>o,getArrayBounds:()=>r,isTypedArray:()=>s,typedArrayWindow:()=>l})},21191(e,t,n){"use strict"
n.r(t),n.d(t,{AddTrajectory:()=>w,DownloadStructure:()=>b,EnableModelCustomProps:()=>_,EnableStructureCustomProps:()=>C,LoadTrajectory:()=>T,PdbDownloadProvider:()=>v,UpdateTrajectory:()=>S})
var r=n(43472),i=n(70292),o=n(92384),a=n(10267),s=n(85672),l=n(80178),c=n(39298),u=n(33241),d=n(2375),p=n(32372),h=n(19288),f=n(33204),m=n(91229),g=n(51520),y=n(42402)
const v={rcsb:o.t.Group({encoding:o.t.Select("bcif",o.t.arrayToOptions(["cif","bcif"]))},{label:"RCSB PDB",isFlat:!0}),pdbe:o.t.Group({variant:o.t.Select("updated-bcif",[["updated-bcif","Updated (bcif)"],["updated","Updated"],["archival","Archival"]])},{label:"PDBe",isFlat:!0}),pdbj:o.t.EmptyGroup({label:"PDBj"})},b=r.KW.build({from:c.O.Root,display:{name:"Download Structure",description:"Load a structure from the provided source and create its representation."},params:(e,t)=>{const n=(e=>{const t=e.config.get(h.PluginConfig.Structure.DefaultRepresentationPreset)||a.Bj.auto.id
return o.t.Group({type:l.z.getParams(void 0,"auto").type,representation:o.t.Select(t,e.builders.structure.representation.getPresets().map(e=>[e.id,e.display.name,e.display.group]),{description:"Which representation preset to use."}),representationParams:o.t.Group(a.n9.CommonParams,{isHidden:!0}),asTrajectory:o.t.Optional(o.t.Boolean(!1,{description:"Load all entries into a single trajectory."}))},{isExpanded:!1})})(t),r=t.config.get(h.PluginConfig.Download.DefaultPdbProvider)||"pdbe"
return{source:o.t.MappedStatic("pdb",{pdb:o.t.Group({provider:o.t.Group({id:o.t.Text("1tqn",{label:"PDB Id(s)",description:"One or more comma/space separated PDB ids."}),server:o.t.MappedStatic(r,v)},{pivot:"id"}),options:n},{isFlat:!0,label:"PDB"}),"pdb-ihm":o.t.Group({provider:o.t.Group({id:o.t.Text("8zzc",{label:"PDB-IHM Id(s)",description:"One or more comma/space separated ids."}),encoding:o.t.Select("bcif",o.t.arrayToOptions(["cif","bcif"]))},{pivot:"id"}),options:n},{isFlat:!0,label:"PDB-IHM"}),swissmodel:o.t.Group({id:o.t.Text("Q9Y2I8",{label:"UniProtKB AC(s)",description:"One or more comma/space separated ACs."}),options:n},{isFlat:!0,label:"SWISS-MODEL",description:"Loads the best homology model or experimental structure"}),alphafolddb:o.t.Group({provider:o.t.Group({id:o.t.Text("Q8W3K0",{label:"UniProtKB AC(s)",description:"One or more comma/space separated ACs."}),encoding:o.t.Select("bcif",o.t.arrayToOptions(["cif","bcif"]))},{pivot:"id"}),options:n},{isFlat:!0,label:"AlphaFold DB",description:"Loads the predicted model if available"}),modelarchive:o.t.Group({id:o.t.Text("ma-bak-cepc-0003",{label:"Accession Code(s)",description:"One or more comma/space separated ACs."}),options:n},{isFlat:!0,label:"Model Archive"}),pubchem:o.t.Group({id:o.t.Text("2244,2245",{label:"PubChem ID",description:"One or more comma/space separated IDs."}),options:n},{isFlat:!0,label:"PubChem",description:"Loads 3D conformer from PubChem."}),url:o.t.Group({url:o.t.Url(""),format:o.t.Select("mmcif",o.t.arrayToOptions(s.HQ.map(e=>e[0]),e=>e)),isBinary:o.t.Boolean(!1),label:o.t.Optional(o.t.Text("")),options:n},{isFlat:!0,label:"URL"})})}}})(({params:e,state:t},n)=>i.Task.create("Download Structure",async r=>{n.behaviors.layout.leftPanelTabName.next("data")
const i=e.source
let o,s=!1,l="mmcif"
switch(i.name){case"url":o=[{url:i.params.url,isBinary:i.params.isBinary,label:i.params.label||void 0}],l=i.params.format
break
case"pdb":o=await("pdbe"===i.params.provider.server.name?async function(e){if("pdb"!==e.name||"pdbe"!==e.params.provider.server.name)throw new Error("expected pdbe")
return"updated"===e.params.provider.server.params.variant?x(e.params.provider.id,e=>`https://www.ebi.ac.uk/pdbe/static/entry/${e.toLowerCase()}_updated.cif`,e=>`PDBe: ${e} (updated cif)`,!1):"updated-bcif"===e.params.provider.server.params.variant?x(e.params.provider.id,e=>`https://www.ebi.ac.uk/pdbe/entry-files/download/${e.toLowerCase()}.bcif`,e=>`PDBe: ${e} (updated cif)`,!0):x(e.params.provider.id,e=>`https://www.ebi.ac.uk/pdbe/static/entry/${e.toLowerCase()}.cif`,e=>`PDBe: ${e} (cif)`,!1)}(i):"pdbj"===i.params.provider.server.name?async function(e){if("pdb"!==e.name||"pdbj"!==e.params.provider.server.name)throw new Error("expected pdbj")
return x(e.params.provider.id,e=>`https://data.pdbjlc1.pdbj.org/pub/pdb/data/structures/divided/mmCIF/${e.toLowerCase().substring(1,3)}/${e.toLowerCase()}.cif`,e=>`PDBj: ${e} (cif)`,!1)}(i):"rcsb"===i.params.provider.server.name?async function(e){if("pdb"!==e.name||"rcsb"!==e.params.provider.server.name)throw new Error("expected rcsb")
return"cif"===e.params.provider.server.params.encoding?x(e.params.provider.id,e=>`https://files.rcsb.org/download/${e.toUpperCase()}.cif`,e=>`RCSB PDB: ${e} (cif)`,!1):x(e.params.provider.id,e=>`https://models.rcsb.org/${e.toUpperCase()}.bcif`,e=>`RCSB PDB: ${e} (bcif)`,!0)}(i):(0,m.dr)(i)),s=!!i.params.options.asTrajectory
break
case"pdb-ihm":const e=e=>e.startsWith("PDBDEV_")?e:`PDBDEV_${e.padStart(8,"0")}`
o=await x(i.params.provider.id,t=>{if(null!==t.match(/^[1-9][A-Z0-9]{3}$/i))return"bcif"===i.params.provider.encoding?`https://pdb-ihm.org/bcif/${t.toLowerCase()}.bcif`:`https://pdb-ihm.org/cif/${t.toLowerCase()}.cif`
const n=e(t.toUpperCase())
return"bcif"===i.params.provider.encoding?`https://pdb-ihm.org/bcif/${n}.bcif`:`https://pdb-ihm.org/cif/${n}.cif`},t=>{const n=t.toUpperCase()
return n.match(/^[1-9][A-Z0-9]{3}$/)?`PDB-IHM: ${n}`:e(n)},"bcif"===i.params.provider.encoding),s=!!i.params.options.asTrajectory
break
case"swissmodel":o=await x(i.params.id,e=>`https://swissmodel.expasy.org/repository/uniprot/${e.toUpperCase()}.pdb`,e=>`SWISS-MODEL: ${e}`,!1),s=!!i.params.options.asTrajectory,l="pdb"
break
case"alphafolddb":o=await x(i.params.provider.id,async e=>{const t=`https://www.alphafold.ebi.ac.uk/api/prediction/${e.toUpperCase()}`,r=await n.runTask(n.fetch({url:t,type:"json"}))
if(Array.isArray(r)&&r.length>0){const e="bcif"===i.params.provider.encoding?"bcifUrl":"cifUrl"
return r[0][e]}throw new Error(`No AlphaFold DB entry for '${e}'`)},e=>`AlphaFold DB: ${e}`,"bcif"===i.params.provider.encoding),s=!!i.params.options.asTrajectory,l="mmcif"
break
case"modelarchive":o=await x(i.params.id,e=>`https://www.modelarchive.org/doi/10.5452/${e.toLowerCase()}.cif`,e=>`Model Archive: ${e}`,!1),s=!!i.params.options.asTrajectory,l="mmcif"
break
case"pubchem":o=await x(i.params.id,e=>`https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/CID/${e.trim()}/record/SDF/?record_type=3d`,e=>`PubChem: ${e}`,!1),s=!!i.params.options.asTrajectory,l="mol"
break
default:(0,m.dr)(i)}const c=e.source.params.options.representation||n.config.get(h.PluginConfig.Structure.DefaultRepresentationPreset)||a.Bj.auto.id,u=c!==a.Bj.empty.id,d="auto"===i.params.options.type.name?void 0:i.params.options.type
await t.transaction(async()=>{if(o.length>0&&s){const t=await n.builders.data.downloadBlob({sources:o.map((e,t)=>({id:""+t,url:e.url,isBinary:e.isBinary})),maxConcurrency:6},{state:{isGhost:!0}}),r=await n.builders.structure.parseTrajectory(t,{formats:o.map((e,t)=>({id:""+t,format:"cif"}))})
await n.builders.structure.hierarchy.applyPreset(r,"default",{structure:d,showUnitcell:u,representationPreset:c,representationPresetParams:e.source.params.options.representationParams})}else for(const t of o){const r=await n.builders.data.download(t,{state:{isGhost:!0}}),i=n.dataFormats.get(l)
if(!i)throw new Error("unknown file format")
const o=await n.builders.structure.parseTrajectory(r,i)
await n.builders.structure.hierarchy.applyPreset(o,"default",{structure:d,showUnitcell:u,representationPreset:c,representationPresetParams:e.source.params.options.representationParams})}}).runInContext(r)}))
async function x(e,t,n,r){const i=e.split(/[,\s]/).map(e=>e.trim()).filter(e=>!!e&&(e.length>=4||/^[1-9][0-9]*$/.test(e))),o=[]
for(const a of i)o.push({url:p.V.Url(await t(a)),isBinary:r,label:n(a)})
return o}const S=r.KW.build({display:{name:"Update Trajectory"},params:{action:o.t.Select("advance",o.t.arrayToOptions(["advance","reset"])),by:o.t.Optional(o.t.Numeric(1,{min:-1,max:1,step:1}))}})(({params:e,state:t})=>{const n=t.selectQ(e=>e.ofTransformer(u.f.Model.ModelFromTrajectory)),i=t.build()
if("reset"===e.action)for(const r of n)i.to(r).update({modelIndex:0})
else for(const o of n){const n=r.QX.findAncestorOfType(t.tree,t.cells,o.transform.ref,c.O.Molecule.Trajectory)
if(!n||!n.obj)continue
const a=n.obj
i.to(o).update(t=>{let n=(t.modelIndex+e.by)%a.data.frameCount
return n<0&&(n+=a.data.frameCount),{modelIndex:n}})}return t.updateTree(i)}),_=r.KW.build({display:{name:"Custom Model Properties",description:"Enable parameters for custom properties of the model."},from:c.O.Molecule.Model,params:(e,t)=>t.customModelProperties.getParams(null==e?void 0:e.data),isApplicable:(e,t,n)=>t.transformer!==d.CustomModelProperties})(({ref:e,params:t},n)=>n.builders.structure.insertModelProperties(e,t)),C=r.KW.build({display:{name:"Custom Structure Properties",description:"Enable parameters for custom properties of the structure."},from:c.O.Molecule.Structure,params:(e,t)=>t.customStructureProperties.getParams(null==e?void 0:e.data),isApplicable:(e,t,n)=>t.transformer!==d.CustomStructureProperties})(({ref:e,params:t},n)=>n.builders.structure.insertStructureProperties(e,t)),w=r.KW.build({display:{name:"Add Trajectory",description:"Add trajectory from existing model/topology and coordinates."},from:c.O.Root,params(e,t){const n=t.state.data,r=[...n.selectQ(e=>e.rootsOfType(c.O.Molecule.Model)),...n.selectQ(e=>e.rootsOfType(c.O.Molecule.Topology))].map(e=>[e.transform.ref,e.obj.label]),i=n.selectQ(e=>e.rootsOfType(c.O.Molecule.Coordinates)).map(e=>[e.transform.ref,e.obj.label])
return{model:o.t.Select(r.length?r[0][0]:"",r),coordinates:o.t.Select(i.length?i[0][0]:"",i)}}})(({params:e,state:t},n)=>i.Task.create("Add Trajectory",r=>t.transaction(async()=>{const i=[e.model,e.coordinates],o=t.build().toRoot().apply(d.TrajectoryFromModelAndCoordinates,{modelRef:e.model,coordinatesRef:e.coordinates},{dependsOn:i}).apply(u.f.Model.ModelFromTrajectory,{modelIndex:0})
await t.updateTree(o).runInContext(r)
const a=await n.builders.structure.createStructure(o.selector)
await n.builders.structure.representation.applyPreset(a,"auto")}).runInContext(r))),T=r.KW.build({display:{name:"Load Trajectory",description:"Load trajectory of model/topology and coordinates from URL or file."},from:c.O.Root,params(e,t){const{options:n}=t.dataFormats,r=n.filter(e=>e[2]===s.RB||e[2]===g.nE),i=n.filter(e=>e[2]===y.jM),a=[],l=[]
for(const{provider:o}of t.dataFormats.list)o.category===s.RB||o.category===g.nE?(o.binaryExtensions&&a.push(...o.binaryExtensions),o.stringExtensions&&a.push(...o.stringExtensions)):o.category===y.jM&&(o.binaryExtensions&&l.push(...o.binaryExtensions),o.stringExtensions&&l.push(...o.stringExtensions))
return{source:o.t.MappedStatic("file",{url:o.t.Group({model:o.t.Group({url:o.t.Url(""),format:o.t.Select(r[0][0],r),isBinary:o.t.Boolean(!1)},{isExpanded:!0}),coordinates:o.t.Group({url:o.t.Url(""),format:o.t.Select(i[0][0],i)},{isExpanded:!0})},{isFlat:!0}),file:o.t.Group({model:o.t.File({accept:a.map(e=>`.${e}`).join(","),label:"Model"}),coordinates:o.t.File({accept:l.map(e=>`.${e}`).join(","),label:"Coordinates"})},{isFlat:!0})},{options:[["url","URL"],["file","File"]]})}}})(({params:e,state:t},n)=>i.Task.create("Load Trajectory",r=>t.transaction(async()=>{const i=e.source
if("file"===i.name&&(null===i.params.model||null===i.params.coordinates))return void n.log.error("No file(s) selected")
if(!("url"!==i.name||i.params.model&&i.params.coordinates))return void n.log.error("No URL(s) given")
const o=async(e,t,r)=>{const i=await n.builders.data.download({url:e,isBinary:r}),o=n.dataFormats.get(t)
if(o)return o.parse(n,i)
n.log.warn(`LoadTrajectory: could not find data provider for '${t}'`)},a=async e=>{var t,r,i
if(!e)throw new Error("No file selected")
const o=(0,f.o)(null!==(r=null===(t=e.file)||void 0===t?void 0:t.name)&&void 0!==r?r:""),a=n.dataFormats.binaryExtensions.has(o.ext),{data:s}=await n.builders.data.readFile({file:e,isBinary:a}),l=n.dataFormats.auto(o,null===(i=s.cell)||void 0===i?void 0:i.obj)
return l?l.parse(n,s):(n.log.warn(`LoadTrajectory: could not find data provider for '${o.ext}'`),void await n.state.data.build().delete(s).commit())}
try{const e="url"===i.name?await o(i.params.model.url,i.params.model.format,i.params.model.isBinary):await a(i.params.model)
let s
s="trajectory"in e?await t.build().to(e.trajectory).apply(d.ModelFromTrajectory,{modelIndex:0}).commit():e.topology
const l="url"===i.name?await o(i.params.coordinates.url,i.params.coordinates.format,!0):await a(i.params.coordinates),c=[s.ref,l.ref],p=t.build().toRoot().apply(d.TrajectoryFromModelAndCoordinates,{modelRef:s.ref,coordinatesRef:l.ref},{dependsOn:c}).apply(u.f.Model.ModelFromTrajectory,{modelIndex:0})
await t.updateTree(p).runInContext(r)
const h=await n.builders.structure.createStructure(p.selector)
await n.builders.structure.representation.applyPreset(h,"auto")}catch(e){console.error(e),n.log.error("Error loading trajectory")}}).runInContext(r)))},21317(e,t,n){"use strict"
n.d(t,{y:()=>i})
var r=n(70429)
async function i(e,t,n,i,o){let a=Math.max(t,0),s=0,l=0
if(e.isSynchronous)return i(Number.MAX_SAFE_INTEGER,n),n
let c=(0,r.t)(),u=0,d=0
for(;(u=i(a,n))>0;){s+=u
const t=(0,r.t)()-c
d+=t,l+=t,e.shouldUpdate&&(await o(e,n,s),a=Math.round(d*s/l)+1,c=(0,r.t)(),d=0)}return e.shouldUpdate&&await o(e,n,s),n}},21357(e,t,n){"use strict"
n.r(t),n.d(t,{default:()=>g})
var r=n(81389),i=n(61806),o=n.n(i),a=n(50123),s=n(82735),l=n(43227),c=n(30466)
const u=new WeakMap,d=s.service??s.inject,p=new WeakMap
function h(){const e={},t=[],n=(0,c.o)(this),r=this.store.schema.fields(n),i={name:"Attributes",properties:["id"],expand:!0},o=i.properties,a=[i]
for(const s of r.values())switch(s.kind){case"attribute":o.push(s.name)
break
case"belongsTo":case"hasMany":{let n=e[s.kind]
void 0===n&&(n=e[s.kind]=[],a.push({name:s.kind,properties:n,expand:!0})),n.push(s.name),t.push(s.name)
break}}return a.push({name:"Flags",properties:["isLoaded","hasDirtyAttributes","isSaving","isDeleted","isError","isNew","isValid"],expand:!1}),{propertyInfo:{includeOtherProperties:!0,groups:a,expensiveProperties:t}}}var f=new WeakMap
class m extends(o()){constructor(...e){var t,n
super(...e),t=f,n=void function(e,t){let n=function(e,t){var n
let r=e.prototype
for(;r;){let e=null==(n=u.get(r))?void 0:n.get(t)
if(e)return e
r=r.prototype}}(e.constructor,t)
n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(e):void 0})}(this,"store"),function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(this,t),t.set(this,n)}getFilters(){return[{name:"isNew",desc:"New"},{name:"isModified",desc:"Modified"},{name:"isClean",desc:"Clean"}]}_nameToClass(e){return this.store.modelFor(e)}watchModelTypes(e,t){const{store:n}=this,r=function(e){let t=p.get(e)
return void 0===t&&(t=new Map,p.set(e,t)),t}(n),i=n.notifications.subscribe("resource",(i,a)=>{"added"===a&&this.watchTypeIfUnseen(n,r,i.type,e,t,o)}),o=[()=>{n.notifications.unsubscribe(i)}]
Object.keys(n.identifierCache._cache.resourcesByType).forEach(e=>{r.set(e,!1)}),r.forEach((i,a)=>{this.watchTypeIfUnseen(n,r,a,e,t,o)})
const a=()=>{o.forEach(e=>e()),r.forEach((e,t)=>{r.set(t,!1)}),this.releaseMethods.removeObject(a)}
return this.releaseMethods.pushObject(a),a}watchTypeIfUnseen(e,t,n,r,i,o){if(!0!==t.get(n)){const a=e.modelFor(n)
a.prototype._debugInfo=h
const s=this.wrapModelType(a,n)
o.push(this.observeModelType(n,i)),r([s]),t.set(n,!0)}}columnNameToDesc(e){return(0,l.ZH)((0,l.z9)(e).replace(/_/g," ").trim())}columnsForType(e){const t=[{name:"id",desc:"Id"}]
let n=0
return e.attributes.forEach((e,r)=>{if(n++>this.attributeLimit)return!1
const i=this.columnNameToDesc(r)
t.push({name:r,desc:i})}),t}getRecords(e,t){if(arguments.length<2){const n=e._debugContainerKey
if(n){const e=n.match(/model:(.*)/)
null!==e&&(t=e[1])}}return this.store.peekAll(t)}getRecordColumnValues(e){let t=0
const n={id:e.id}
return e.eachAttribute(r=>{if(t++>this.attributeLimit)return!1
n[r]=e[r]}),n}getRecordKeywords(e){const t=[e.id]
return e.eachAttribute(n=>{t.push(e[n])}),(0,r.A)(t)}getRecordFilterValues(e){return{isNew:e.isNew,isModified:e.hasDirtyAttributes&&!e.isNew,isClean:!e.hasDirtyAttributes}}getRecordColor(e){let t="black"
return e.isNew?t="green":e.hasDirtyAttributes&&(t="blue"),t}observeRecord(e,t){const n=[],r=["id","isNew","hasDirtyAttributes"]
return e.eachAttribute(e=>r.push(e)),r.forEach(r=>{const i=()=>{t(this.wrapRecord(e))};(0,a.addObserver)(e,r,i),n.push(function(){(0,a.removeObserver)(e,r,i)})}),function(){n.forEach(e=>e())}}}!function(e,t,n){let r={configurable:!0,enumerable:!0,writable:!0,initializer:null}
for(let i of n)r=i(e,t,r)||r
void 0===r.initializer?Object.defineProperty(e,t,r):function(e,t,n){let r=u.get(e)
r||(r=new Map,u.set(e,r)),r.set(t,n)}(e,t,r)}(m.prototype,"store",[d("store")])
const g=m},21700(e,t,n){"use strict"
n.d(t,{Q:()=>b})
var r=n(71695),i=n(67538),o=n(32775),a=n(99302),s=n(20356),l=n(97960),c=n(70012),u=n(72146),d=n(76242),p=n(68329),h=n(10314),f=n(14033),m=n(83689),g=n(44195),y=n(71534)
const v=f.U.diff
function b(e,t){return{kind:"element-loci",structure:e,elements:t}}!function(e){function t(e){for(const t of e.elements)if(i.CD.size(t.indices)>0)return!1
return!0}function n(e){let t=0
for(const{indices:n}of e.elements)t+="number"==typeof n?v(n):n.length
return t}function f(n){return t(n)?n:e(n.structure,[{unit:n.elements[0].unit,indices:i.CD.ofSingleton(i.CD.start(n.elements[0].indices))}])}function b(e){return e.length>3&&i.X9.isRange(e)?i.IX.ofRange(e[0],e[e.length-1]):i.X9.ofSortedArray(e)}function x(t,n){const r=[],o=new Set
for(const e of t.elements)if(_(e))r[r.length]=e
else if(e.unit.kind===l.N.Kind.Atomic){const t=e.unit.elements,a=e.unit.model.atomicHierarchy,{label_alt_id:s}=e.unit.model.atomicHierarchy.atoms,{index:l,offsets:c}=a.residueAtomSegments,u=[],d=e.indices,p=i.CD.size(d)
let h=0
for(;h<p;){o.clear()
const e=t[i.CD.getAt(d,h)],r=l[e]
for(o.add(s.value(e)),h++;h<p;){const e=t[i.CD.getAt(d,h)]
if(l[e]!==r)break
o.add(s.value(e)),h++}const a=o.has("")
for(let l=c[r],d=c[r+1];l<d;l++){const e=i.CD.indexOf(t,l)
if(e>=0){const t=s.value(l)
n&&!a&&t&&!o.has(t)||(u[u.length]=e)}}}r[r.length]={unit:e.unit,indices:b(u)}}else r[r.length]=e
return e(t.structure,r)}function S(e){switch(e.kind){case l.N.Kind.Atomic:return e.model.atomicHierarchy.chainAtomSegments
case l.N.Kind.Spheres:return e.model.coarseHierarchy.spheres.chainElementSegments
case l.N.Kind.Gaussians:return e.model.coarseHierarchy.gaussians.chainElementSegments}}function _(e){return e.unit.elements.length===i.CD.size(e.indices)}function C(e,t,n){const{index:r}=S(e),o=e.elements
let a=0
for(let i=0,l=o.length;i<l;i++){const e=r[o[i]]
t.has(e)&&a++}if(a===e.elements.length)return void(n[n.length]={unit:e,indices:i.IX.ofBounds(0,a)})
const s=new Int32Array(a)
a=0
for(let i=0,l=o.length;i<l;i++){const e=r[o[i]]
t.has(e)&&(s[a++]=i)}s.length>0&&(n[n.length]={unit:e,indices:b(s)})}function w(e,t,n,r,o){const{index:a}=S(e.elements[0].unit),s=new Set
for(let l=t;l<n;l++){const t=e.elements[l],n=t.indices,r=t.unit.elements
for(let e=0,o=i.CD.size(n);e<o;e++)s.add(a[r[i.CD.getAt(n,e)]])}if(r){const t=e.elements[0].unit
for(const n of e.structure.units)l.N.areSameChainOperatorGroup(n,t)&&C(n,s,o)}else for(let i=t;i<n;i++)C(e.elements[i].unit,s,o)}function T(t){const n=[]
for(let e=0,r=t.elements.length;e<r;e++){const i=t.elements[e]
if(l.N.Traits.is(i.unit.traits,l.N.Trait.Partitioned)){const o=e
for(;e<r&&l.N.areSameChainOperatorGroup(t.elements[e].unit,i.unit);)e++
const a=e
e--,w(t,o,a,!0,n)}else _(i)?n[n.length]=i:w(t,e,e+1,!1,n)}return e(t.structure,n)}function A(e){return`${e.unit.model.id}|${p.Z.entity.id(e)}`}function I(e,t){const n=[]
for(let r=0,o=i.CD.size(t);r<o;++r)n.push(e[i.CD.getAt(t,r)])
return i.X9.ofSortedArray(n)}function P(e,t){return i.X9.isRange(e)&&i.X9.areEqual(e,t)?i.IX.ofLength(e.length):b(i.X9.indicesOf(e,t))}e.is=function(e){return!!e&&"element-loci"===e.kind},e.areEqual=function(e,t){if(e.structure!==t.structure)return!1
if(e.elements.length!==t.elements.length)return!1
for(let n=0,r=e.elements.length;n<r;++n){const r=e.elements[n],o=t.elements[n]
if(r.unit.id!==o.unit.id)return!1
if(!i.CD.areEqual(r.indices,o.indices))return!1}return!0},e.isEmpty=t,e.isWholeStructure=function(e){return n(e)===e.structure.elementCount},e.size=n,e.all=function(t){return e(t,t.units.map(e=>({unit:e,indices:i.CD.ofBounds(0,e.elements.length)})))},e.none=function(t){return e(t,[])},e.fromExpression=function(e,t,n){let r
r="function"==typeof t?t(a.MolScriptBuilder):t
const i=(0,m.wE)(r)(null!=n?n:new g.cY(e))
return g.cv.toLociWithSourceUnits(i)},e.fromQuery=function(e,t,n){const r=t(null!=n?n:new g.cY(e))
return g.cv.toLociWithSourceUnits(r)},e.fromSchema=function(e,t,n){return y.Schema.toLoci(e,t,n)},e.getFirstLocation=function(e,n){if(t(e))return
const r=e.elements[0].unit,o=r.elements[i.CD.getAt(e.elements[0].indices,0)]
return n?(n.structure=e.structure,n.unit=e.elements[0].unit,n.element=o,n):u.a.create(e.structure,r,o)},e.firstElement=f,e.firstResidue=function(e){return t(e)?e:x(f(e))},e.firstChain=function(e){return t(e)?e:T(f(e))},e.toStructure=function(e){const t=[]
for(const n of e.elements){const{unit:e,indices:r}=n,o=new Int32Array(i.CD.size(r))
i.CD.forEach(r,(t,n)=>o[n]=e.elements[t]),t.push(e.getChild(i.X9.ofSortedArray(o)))}return s.o.create(t,{parent:e.structure.parent})},e.forEachLocation=function(t,n,r){if(e.isEmpty(t))return
const o=r||u.a.create(t.structure)
o.structure=t.structure
for(const e of t.elements){const{unit:t,indices:r}=e
o.unit=t
const{elements:a}=e.unit
for(let e=0,s=i.CD.size(r);e<s;e++)o.element=a[i.CD.getAt(r,e)],n(o)}},e.remap=function(t,n){if(n===t.structure)return t
const r=[]
return t.elements.forEach(e=>{if(!n.unitMap.has(e.unit.id))return
const t=n.unitMap.get(e.unit.id),o=i.CD.indexedIntersect(e.indices,e.unit.elements,t.elements)
i.CD.size(o)>0&&r.push({unit:t,indices:o})}),e(n,r)},e.union=function t(n,r){if(n.elements.length>r.elements.length)return t(r,n)
if(e.isEmpty(n))return r
const o=new Map
for(const e of n.elements)o.set(e.unit.id,e.indices)
const a=[]
for(const e of r.elements)o.has(e.unit.id)?(a[a.length]={unit:e.unit,indices:i.CD.union(o.get(e.unit.id),e.indices)},o.delete(e.unit.id)):a[a.length]=e
return o.forEach((e,t)=>{a[a.length]={unit:n.structure.unitMap.get(t),indices:e}}),e(n.structure,a)},e.subtract=function(t,n){const r=new Map
for(const e of n.elements)r.set(e.unit.id,e.indices)
const o=[]
for(const e of t.elements)if(r.has(e.unit.id)){const t=i.CD.subtract(e.indices,r.get(e.unit.id))
if(0===i.CD.size(t))continue
o[o.length]={unit:e.unit,indices:t}}else o[o.length]=e
return e(t.structure,o)},e.intersect=function(t,n){const r=new Map
for(const e of t.elements)r.set(e.unit.id,e.indices)
const o=[]
for(const e of n.elements){if(!r.has(e.unit.id))continue
const t=i.CD.intersect(r.get(e.unit.id),e.indices)
0!==i.CD.size(t)&&(o[o.length]={unit:e.unit,indices:t})}return e(t.structure,o)},e.areIntersecting=function t(n,r){if(n.elements.length>r.elements.length)return t(r,n)
if(e.isEmpty(n))return e.isEmpty(r)
const o=new Map
for(const e of n.elements)o.set(e.unit.id,e.indices)
for(const e of r.elements)if(o.has(e.unit.id)&&i.CD.areIntersecting(o.get(e.unit.id),e.indices))return!0
return!1},e.isSubset=function(t,n){if(e.isEmpty(t))return e.isEmpty(n)
const r=new Map
for(const e of t.elements)r.set(e.unit.id,e.indices)
let o=!1
for(const e of n.elements){if(!r.has(e.unit.id))return!1
if(!i.CD.isSubset(r.get(e.unit.id),e.indices))return!1
o=!0}return o},e.extendToWholeResidues=x,e.extendToWholeChains=T,e.extendToWholeEntities=function(t){const n=[],r=u.a.create(t.structure),o=new Set,{units:a}=t.structure
for(let e=0,i=t.elements.length;e<i;e++){const n=t.elements[e]
r.unit=n.unit,r.element=n.unit.elements[0],o.add(A(r))}for(let e=0,s=a.length;e<s;++e){const t=a[e]
if(r.unit=t,r.element=t.elements[0],o.has(A(r))){const e=i.CD.ofBounds(0,t.elements.length)
n[n.length]={unit:t,indices:e}}}return e(t.structure,n)},e.extendToWholeModels=function(t){const n=[],r=new Set,{units:o}=t.structure
for(let e=0,i=t.elements.length;e<i;e++){const n=t.elements[e]
r.add(n.unit.model.id)}for(let e=0,a=o.length;e<a;++e){const t=o[e]
if(r.has(t.model.id)){const e=i.CD.ofBounds(0,t.elements.length)
n[n.length]={unit:t,indices:e}}}return e(t.structure,n)},e.extendToAllInstances=function(t){const n=[],r=new Map
for(let e=0,o=t.elements.length;e<o;e++){const n=t.elements[e],{model:o}=n.unit,a=I(n.unit.elements,n.indices)
r.has(o)?r.set(o,i.X9.union(a,r.get(o))):r.set(o,a)}for(let e=0,o=t.structure.units.length;e<o;++e){const o=t.structure.units[e],a=r.get(o.model)
if(!a)continue
const s=P(o.elements,a)
i.CD.size(s)&&(n[n.length]={unit:o,indices:s})}return e(t.structure,n)},e.extendToWholeOperators=function(t){const n=[],r=new Set,{units:o}=t.structure
for(let e=0,i=t.elements.length;e<i;e++){const n=t.elements[e]
r.add(n.unit.conformation.operator.name)}for(let e=0,a=o.length;e<a;++e){const t=o[e]
if(r.has(t.conformation.operator.name)){const e=i.CD.ofBounds(0,t.elements.length)
n[n.length]={unit:t,indices:e}}}return e(t.structure,n)}
const B=new h.Z("98"),E=(0,o.eB)()
e.getBoundary=function(e,t,n){B.reset()
for(const r of e.elements){const{indices:e}=r,{elements:n,conformation:a}=r.unit
for(let r=0,s=i.CD.size(e);r<s;r++){const s=n[i.CD.getAt(e,r)]
a.position(s,E),t&&o.eB.transformMat4(E,E,t),B.includePositionRadius(E,a.r(s))}}B.finishedIncludeStep()
for(const r of e.elements){const{indices:e}=r,{elements:n,conformation:a}=r.unit
for(let r=0,s=i.CD.size(e);r<s;r++){const s=n[i.CD.getAt(e,r)]
a.position(s,E),t&&o.eB.transformMat4(E,E,t),B.radiusPositionRadius(E,a.r(s))}}return n?(n.box&&B.getBox(n.box),n.sphere&&B.getSphere(n.sphere),n):{box:B.getBox(),sphere:B.getSphere()}}
const k=(0,o.eB)()
function D(e,t,n=0){let r=n
for(const a of e.elements){const{indices:e}=a,{elements:n,conformation:s}=a.unit,l=i.CD.size(e)
for(let a=0;a<l;a++){const l=n[i.CD.getAt(e,a)]
s.position(l,k),o.eB.toArray(k,t,r+3*a)}r+=3*l}return t}function M(e,t){return l.N.isAtomic(e)?e.model.atomicHierarchy.atomSourceIndex.value(t):t}function R(e,t,n,r,i){(0,c.eh)(t)
const o=[],a=[]
let s=0
const l=t.length
for(;s<l;){const e=s
for(s++;s<l&&t[s-1]+1===t[s];)s++
const n=s
if(n-e>12)o[o.length]=t[e],o[o.length]=t[n-1]
else for(let r=e;r<n;r++)a[a.length]=t[r]}return n?{atom:{set:a,ranges:o},chain:{opName:[e]},entity:{modelLabel:r,modelIndex:i}}:{atom:{set:a,ranges:o},chain:{opName:[e]}}}e.toPositionsArray=D,e.getPrincipalAxes=function(e){const t=n(e),r=D(e,new Float32Array(3*t))
return d.c.ofPositions(r)},e.getPrincipalAxesMany=function(e){let t=0
e.forEach(e=>{t+=n(e)})
const r=new Float32Array(3*t)
let i=0
return e.forEach(e=>{D(e,r,i),i+=3*n(e)}),d.c.ofPositions(r)},e.toExpression=function(t){if(e.isEmpty(t))return a.MolScriptBuilder.struct.generator.empty()
const n=t.structure.models,o=new Map
for(const e of t.elements){const{indices:t}=e,{elements:n}=e.unit,a=e.unit.conformation.operator.name
let s
o.has(a)?s=o.get(a).xs:(s=r.th.create(),o.set(a,{modelLabel:e.unit.model.label,modelIndex:e.unit.model.modelNum,xs:s}))
for(let o=0,l=i.CD.size(t);o<l;o++){const a=M(e.unit,n[i.CD.getAt(t,o)])
r.th.add(s,a,a)}}const s=[],l=o.keys()
for(;;){const e=l.next()
if(e.done)break
const t=o.get(e.value)
s.push(R(e.value,t.xs.array,n.length>1,t.modelLabel,t.modelIndex))}const u=new Map
for(let e=0,r=s.length;e<r;++e){const t=s[e],n=`${(0,c.vb)((0,c.TI)(t.atom.ranges),(0,c.TI)(t.atom.set))}|${t.entity?t.entity.modelLabel+t.entity.modelIndex:""}`
u.has(n)?u.get(n).chain.opName.push(...t.chain.opName):u.set(n,t)}const d=[]
return u.forEach(e=>{const{ranges:t,set:n}=e.atom,{opName:r}=e.chain,i=a.MolScriptBuilder.struct.atomProperty.core.operatorName(),o=a.MolScriptBuilder.struct.atomProperty.core.sourceIndex(),s=[]
n.length>0&&(s[s.length]=a.MolScriptBuilder.core.set.has([a.MolScriptBuilder.core.type.set(n),o]))
for(let l=0,c=t.length/2;l<c;l++)s[s.length]=a.MolScriptBuilder.core.rel.inRange([o,t[2*l],t[2*l+1]])
if(e.entity){const{modelLabel:t,modelIndex:n}=e.entity
d.push(a.MolScriptBuilder.struct.generator.atomGroups({"atom-test":s.length>1?a.MolScriptBuilder.core.logic.or(s):s[0],"chain-test":r.length>1?a.MolScriptBuilder.core.set.has([a.MolScriptBuilder.core.type.set(r),i]):a.MolScriptBuilder.core.rel.eq([i,r[0]]),"entity-test":a.MolScriptBuilder.core.logic.and([a.MolScriptBuilder.core.rel.eq([a.MolScriptBuilder.struct.atomProperty.core.modelLabel(),t]),a.MolScriptBuilder.core.rel.eq([a.MolScriptBuilder.struct.atomProperty.core.modelIndex(),n])])}))}else d.push(a.MolScriptBuilder.struct.generator.atomGroups({"atom-test":s.length>1?a.MolScriptBuilder.core.logic.or(s):s[0],"chain-test":r.length>1?a.MolScriptBuilder.core.set.has([a.MolScriptBuilder.core.type.set(r),i]):a.MolScriptBuilder.core.rel.eq([i,r[0]])}))}),a.MolScriptBuilder.struct.modifier.union([1===d.length?d[0]:a.MolScriptBuilder.struct.combinator.merge(d.map(e=>a.MolScriptBuilder.struct.modifier.union([e])))])}}(b||(b={}))},21911(e,t,n){"use strict"
function r([e]){return Math.asinh(e)}n.r(t),n.d(t,{asinh:()=>r,default:()=>i})
var i=(0,n(10336).helper)(r)},21946(e,t,n){"use strict"
var r
n.d(t,{b:()=>r}),function(e){e.create=function(e){return e},e.getDuration=function(e,t){var n,r
if(t.customDurationMs)return t.customDurationMs
const i=null===(r=(n=t.definition).getDuration)||void 0===r?void 0:r.call(n,t.params,e)
return"fixed"===(null==i?void 0:i.kind)?i.durationMs:void 0}}(r||(r={}))},22063(e,t,n){"use strict"
n.d(t,{p:()=>y})
var r=n(34761),i=n(48861),o=n(61993),a=n(95921),s=n(39298),l=n(43472),c=n(9043),u=n(92384),d=n(41428),p=n(15382),h=n(19288),f=n(31993),m=n(70292),g=n(28269)
class y extends a.N{get animation(){return this.plugin.managers.animation}getSnapshot(e){var t,n,r
const i={...this.snapshotParams.value,...e}
return{id:c.kk.create22(),data:i.data?this.data.getSnapshot():void 0,behaviour:i.behavior?this.behaviors.getSnapshot():void 0,animation:i.animation?this.animation.getSnapshot():void 0,startAnimation:i.startAnimation?!!i.startAnimation:void 0,camera:i.camera?{current:this.plugin.canvas3d.camera.getSnapshot(),transitionStyle:i.cameraTransition.name,transitionDurationInMs:"animate"===(null===(t=null==i?void 0:i.cameraTransition)||void 0===t?void 0:t.name)?i.cameraTransition.params.durationInMs:void 0}:void 0,canvas3dContext:i.canvas3dContext?{props:null===(n=this.plugin.canvas3dContext)||void 0===n?void 0:n.props}:void 0,canvas3d:i.canvas3d?{props:null===(r=this.plugin.canvas3d)||void 0===r?void 0:r.props}:void 0,interactivity:i.interactivity?{props:this.plugin.managers.interactivity.props}:void 0,structureFocus:this.plugin.managers.structure.focus.getSnapshot(),structureSelection:i.structureSelection?this.plugin.managers.structure.selection.getSnapshot():void 0,structureComponentManager:i.componentManager?{options:this.plugin.managers.structure.component.state.options}:void 0,durationInMs:null==i?void 0:i.durationInMs}}async setSnapshot(e){var t,n,r,i,a,s,l,c,d,h
if(await this.animation.stop(),(null===(t=e.structureComponentManager)||void 0===t?void 0:t.options)&&this.plugin.managers.structure.component._setSnapshotState(null===(n=e.structureComponentManager)||void 0===n?void 0:n.options),e.behaviour&&await this.plugin.runTask(this.behaviors.setSnapshot(e.behaviour)),e.data&&await this.plugin.runTask(this.data.setSnapshot(e.data)),null===(r=e.canvas3d)||void 0===r?void 0:r.props){const t=u.t.normalizeParams(o._i,e.canvas3d.props,"children");((null===(i=e.camera)||void 0===i?void 0:i.current)||(null===(a=e.camera)||void 0===a?void 0:a.focus))&&(t.camera=void 0,t.cameraClipping=void 0,t.cameraFog=void 0),await p.PluginCommands.Canvas3D.SetSettings(this.plugin,{settings:t})}if(null===(s=e.canvas3dContext)||void 0===s?void 0:s.props){const t=u.t.normalizeParams(o.H7.Params,e.canvas3dContext.props,"children")
null===(l=this.plugin.canvas3dContext)||void 0===l||l.setProps(t)}e.interactivity&&e.interactivity.props&&this.plugin.managers.interactivity.setProps(e.interactivity.props),e.structureFocus&&this.plugin.managers.structure.focus.setSnapshot(e.structureFocus),e.structureSelection&&this.plugin.managers.structure.selection.setSnapshot(e.structureSelection),e.animation&&this.animation.setSnapshot(e.animation),(null===(c=e.camera)||void 0===c?void 0:c.current)?p.PluginCommands.Camera.Reset(this.plugin,{snapshot:e.camera.current,durationMs:"animate"===e.camera.transitionStyle?e.camera.transitionDurationInMs:void 0}):(null===(d=e.camera)||void 0===d?void 0:d.focus)&&p.PluginCommands.Camera.FocusObject(this.plugin,{...e.camera.focus,durationMs:"animate"===e.camera.transitionStyle?e.camera.transitionDurationInMs:void 0}),"object"==typeof(null==e?void 0:e.onLoadMarkdownCommands)&&Object.keys(e.onLoadMarkdownCommands).length>0&&this.plugin.managers.markdownExtensions.tryExecute("click",e.onLoadMarkdownCommands),e.startAnimation?this.animation.start():(null===(h=e.transition)||void 0===h?void 0:h.autoplay)&&(await m.Scheduler.immediatePromise(),this.animation.play(f.c,{}))}async setAnimationSnapshot(e,t){var n,r,i,a
await this.animation.stopStateTransitionAnimation()
const{transition:s}=e
if(!s)return
const l=Math.min(t,s.frames.length-1),c=null!==(n=s.frames[l])&&void 0!==n?n:e.data
if(c.data&&await this.plugin.runTask(this.data.setSnapshot(c.data)),null===(r=c.canvas3d)||void 0===r?void 0:r.props){const e=u.t.normalizeParams(o._i,c.canvas3d.props,"children")
null===(i=this.plugin.canvas3d)||void 0===i||i.setProps(e)}(null===(a=c.camera)||void 0===a?void 0:a.current)&&p.PluginCommands.Camera.Reset(this.plugin,{snapshot:c.camera.current,durationMs:"animate"===c.camera.transitionStyle?c.camera.transitionDurationInMs:void 0}),!t&&"object"==typeof(null==e?void 0:e.onLoadMarkdownCommands)&&Object.keys(e.onLoadMarkdownCommands).length>0&&this.plugin.managers.markdownExtensions.tryExecute("click",e.onLoadMarkdownCommands)}updateTransform(e,t,n,r){const i=e.build().to(t).update(n)
return p.PluginCommands.State.Update(this.plugin,{state:e,tree:i,options:{canUndo:r}})}hasBehavior(e){return this.behaviors.tree.transforms.has(e.id)}updateBehavior(e,t){const n=this.behaviors.build()
if(this.behaviors.tree.transforms.has(e.id))n.to(e.id).update(t)
else{const i=e.createDefaultParams(void 0,this.plugin)
n.to(d.AF.getCategoryId(e)).apply(e,(0,r.j)(i,t),{ref:e.id})}return this.plugin.runTask(this.behaviors.updateTree(n))}dispose(){this.behaviors.cells.forEach(e=>{var t,n,r,i
d.AF.Behavior.is(e.obj)&&(null===(n=(t=e.obj.data).unregister)||void 0===n||n.call(t),null===(i=(r=e.obj.data).dispose)||void 0===i||i.call(r))}),super.dispose(),this.data.dispose(),this.behaviors.dispose(),this.animation.dispose()}constructor(e){super(),this.plugin=e,this.data=l.Uw.create(new s.O.Root({}),{runTask:this.plugin.runTask,globalContext:this.plugin,historyCapacity:this.plugin.config.get(h.PluginConfig.State.HistoryCapacity)}),this.behaviors=l.Uw.create(new d.AF.Root({}),{runTask:this.plugin.runTask,globalContext:this.plugin,rootState:{isLocked:!0}}),this.events={cell:{stateUpdated:(0,i.h)(this.data.events.cell.stateUpdated,this.behaviors.events.cell.stateUpdated),created:(0,i.h)(this.data.events.cell.created,this.behaviors.events.cell.created),removed:(0,i.h)(this.data.events.cell.removed,this.behaviors.events.cell.removed)},object:{created:(0,i.h)(this.data.events.object.created,this.behaviors.events.object.created),removed:(0,i.h)(this.data.events.object.removed,this.behaviors.events.object.removed),updated:(0,i.h)(this.data.events.object.updated,this.behaviors.events.object.updated)}},this.snapshotParams=this.ev.behavior(y.DefaultSnapshotParams),this.setSnapshotParams=e=>{this.snapshotParams.next({...y.DefaultSnapshotParams,...e})}}}!function(e){e.SnapshotParams={durationInMs:u.t.Numeric(1500,{min:100,max:15e3,step:100},{label:"Duration in ms"}),data:u.t.Boolean(!0),behavior:u.t.Boolean(!1),structureSelection:u.t.Boolean(!1),componentManager:u.t.Boolean(!0),animation:u.t.Boolean(!0),startAnimation:u.t.Boolean(!1),canvas3d:u.t.Boolean(!0),canvas3dContext:u.t.Boolean(!0),interactivity:u.t.Boolean(!0),camera:u.t.Boolean(!0),cameraTransition:u.t.MappedStatic("animate",{animate:u.t.Group({durationInMs:u.t.Numeric(250,{min:100,max:5e3,step:500},{label:"Duration in ms"})}),instant:u.t.Group({})},{options:[["animate","Animate"],["instant","Instant"]]}),image:u.t.Boolean(!1)},e.DefaultSnapshotParams=u.t.getDefaultValues(e.SnapshotParams),e.getMinFrameDuration=(0,g._)(e=>{if(!e)return 1e3/60
const{transition:t}=e
if(!t)return 1e3/60
let n=1/0
for(const r of t.frames)r.durationInMs>0&&r.durationInMs<n&&(n=r.durationInMs)
return Number.isFinite(n)?n:1e3/60}),e.getStateTransitionDuration=(0,g._)(e=>{if(!e)return
const{transition:t}=e
if(!t)return
let n=0
for(let r=0;r<t.frames.length;r++)n+=t.frames[r].durationInMs
return n}),e.getStateTransitionFrameTime=(0,g._)((e,t)=>{if(!e||void 0===t)return 0
const{transition:n}=e
if(!n)return 0
let r=0
for(let i=0;i<t&&!(n.frames.length<=i);i++)r+=n.frames[i].durationInMs
return r}),e.getStateTransitionFrameIndex=function(t,n){var r
const{transition:i}=t
if(!(null==i?void 0:i.frames.length))return
let o=n
i.loop&&(o%=null!==(r=e.getStateTransitionDuration(t))&&void 0!==r?r:1)
let a=0
if(o<=i.frames[0].durationInMs)return 0
for(let e=0;e<i.frames.length;e++){if(a>=o)return e
a+=i.frames[e].durationInMs}return i.frames.length-1}}(y||(y={}))},22153(e,t,n){"use strict"
n.d(t,{x:()=>o})
var r=n(81357),i=n(18891)
function o(e){return(0,i.T)(null==e?void 0:e[r.l])}},22219(e,t,n){"use strict"
n.d(t,{RW:()=>r,SV:()=>o,tM:()=>s,ye:()=>l})
var r,i=n(87852)
function o(e){return e===r.Float32?4:e===r.Int16||e===r.Uint16?2:1}function a(e,t,n=0,i){return e===r.Float32?new Float32Array(t,n,i):e===r.Int16?new Int16Array(t,n,i):e===r.Uint16?new Uint16Array(t,n,i):new Int8Array(t,n,i)}function s(e,t){const n=o(t),r=new ArrayBuffer(n*e),s=i.N.fromArrayBuffer(r),l=i.N.IsNativeEndianLittle?r:new ArrayBuffer(n*e)
return{type:t,elementByteSize:n,readBuffer:s,valuesBuffer:new Uint8Array(l),values:a(t,l)}}async function l(e,t,n,r,o,a){return await t.readBuffer(n,e.readBuffer,r,o),e.elementByteSize>1&&(void 0!==a&&a!==i.N.IsNativeEndianLittle||!i.N.IsNativeEndianLittle)&&i.N.flipByteOrder(e.readBuffer,e.valuesBuffer,r,e.elementByteSize,o),e.values}!function(e){e.Float32="float32",e.Int8="int8",e.Int16="int16",e.Uint16="uint16"}(r||(r={}))},22394(e,t,n){"use strict"
n.d(t,{C2:()=>c,IB:()=>p,fZ:()=>u,mx:()=>l})
var r=n(80813),i=n(32775),o=n(31727),a=n(31683),s=n(13564)
function l(e,t,n,r){for(let i=t;i<n;++i)s.i.toArray(r,e,4*i),e[4*i+3]=255
return!0}function c(e,t,n){return e.fill(0,4*t,4*n),!0}function u(e,t,n){const s=(0,o.xg)(Math.max(1,e),4,Uint8Array,n&&n.tSubstance.ref.value.array)
return n?(r.IQ.update(n.tSubstance,s),r.IQ.update(n.uSubstanceTexDim,i.ZY.create(s.width,s.height)),r.IQ.updateIfChanged(n.dSubstance,e>0),r.IQ.updateIfChanged(n.dSubstanceType,t),n):{tSubstance:r.IQ.create(s),uSubstanceTexDim:r.IQ.create(i.ZY.create(s.width,s.height)),dSubstance:r.IQ.create(e>0),tSubstanceGrid:r.IQ.create((0,a.z6)()),uSubstanceGridDim:r.IQ.create(i.eB.create(1,1,1)),uSubstanceGridTransform:r.IQ.create(i.Zb.create(0,0,0,1)),dSubstanceType:r.IQ.create(t),uSubstanceStrength:r.IQ.create(1)}}const d={array:new Uint8Array(4),width:1,height:1}
function p(e){return e?(r.IQ.update(e.tSubstance,d),r.IQ.update(e.uSubstanceTexDim,i.ZY.create(1,1)),e):{tSubstance:r.IQ.create(d),uSubstanceTexDim:r.IQ.create(i.ZY.create(1,1)),dSubstance:r.IQ.create(!1),tSubstanceGrid:r.IQ.create((0,a.z6)()),uSubstanceGridDim:r.IQ.create(i.eB.create(1,1,1)),uSubstanceGridTransform:r.IQ.create(i.Zb.create(0,0,0,1)),dSubstanceType:r.IQ.create("groupInstance"),uSubstanceStrength:r.IQ.create(1)}}},22493(e,t,n){"use strict"
n.d(t,{GE:()=>p,VL:()=>o,XM:()=>u,bf:()=>a,lo:()=>s,vM:()=>c,z$:()=>l})
var r=n(95579),i=(n(87095),n(50690))
function o(e,t,n){return(0,i.$X)(t,n)===r.S8.S&&3===(0,i.IS)(e,t,n,r.S8.O)}function a(e,t,n){return(0,i.$X)(t,n)===r.S8.S&&4===(0,i.IS)(e,t,n,r.S8.O)}function s(e,t,n){return(0,i.$X)(t,n)===r.S8.P&&(0,i.IS)(e,t,n,r.S8.O)===(0,i.Hm)(e,t,n)}function l(e,t,n){let o=0
return(0,i.$X)(t,n)===r.S8.C&&2===(0,i.IS)(e,t,n,r.S8.O)&&1===(0,i.IS)(e,t,n,r.S8.C)&&(0,i.LH)(e,t,n,(t,n)=>{(0,i.$X)(t,n)===r.S8.O&&(0,i.Hm)(e,t,n)-(0,i.IS)(e,t,n,r.S8.H)===1&&(o+=1)}),2===o}function c(e,t,n){let o=0
return(0,i.$X)(t,n)===r.S8.C&&3===(0,i.Hm)(e,t,n)&&3===(0,i.IS)(e,t,n,r.S8.N)&&(0,i.LH)(e,t,n,(t,n)=>{(0,i.Hm)(e,t,n)-(0,i.IS)(e,t,n,r.S8.H)===1&&(o+=1)}),2===o}function u(e,t,n){let o=0
return(0,i.$X)(t,n)===r.S8.C&&3===(0,i.Hm)(e,t,n)&&2===(0,i.IS)(e,t,n,r.S8.N)&&1===(0,i.IS)(e,t,n,r.S8.C)&&(0,i.LH)(e,t,n,(t,n)=>{(0,i.Hm)(e,t,n)-(0,i.IS)(e,t,n,r.S8.H)===1&&(o+=1)}),2===o}const d=new Set(["N","O","S","F","CL","BR","I"])
function p(e,t,n){let r=!1
return(0,i.LH)(e,t,n,(e,t)=>{var n
n=(0,i.$X)(e,t),d.has(n)&&(r=!0)}),r}},22623(e,t,n){"use strict"
n.r(t),n.d(t,{createPluginUI:()=>Aw})
var r={}
n.r(r),n.d(r,{boolean:()=>_,booleanish:()=>C,commaOrSpaceSeparated:()=>P,commaSeparated:()=>I,number:()=>T,overloadedBoolean:()=>w,spaceSeparated:()=>A})
var i={}
n.r(i),n.d(i,{attentionMarkers:()=>rn,contentInitial:()=>Zt,disable:()=>on,document:()=>Yt,flow:()=>Jt,flowInitial:()=>Kt,insideSpan:()=>nn,string:()=>en,text:()=>tn})
var o=n(25602),a=n(28074),s=n(9043),l=n(46098)
function c(){}function u(){}const d=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,p=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,h={}
function f(e,t){return((t||h).jsx?p:d).test(e)}const m=/[ \t\n\f\r]/g
function g(e){return""===e.replace(m,"")}class y{constructor(e,t,n){this.normal=t,this.property=e,n&&(this.space=n)}}function v(e,t){const n={},r={}
for(const i of e)Object.assign(n,i.property),Object.assign(r,i.normal)
return new y(n,r,t)}function b(e){return e.toLowerCase()}y.prototype.normal={},y.prototype.property={},y.prototype.space=void 0
class x{constructor(e,t){this.attribute=t,this.property=e}}x.prototype.attribute="",x.prototype.booleanish=!1,x.prototype.boolean=!1,x.prototype.commaOrSpaceSeparated=!1,x.prototype.commaSeparated=!1,x.prototype.defined=!1,x.prototype.mustUseProperty=!1,x.prototype.number=!1,x.prototype.overloadedBoolean=!1,x.prototype.property="",x.prototype.spaceSeparated=!1,x.prototype.space=void 0
let S=0
const _=B(),C=B(),w=B(),T=B(),A=B(),I=B(),P=B()
function B(){return 2**++S}const E=Object.keys(r)
class k extends x{constructor(e,t,n,i){let o=-1
if(super(e,t),D(this,"space",i),"number"==typeof n)for(;++o<E.length;){const e=E[o]
D(this,E[o],(n&r[e])===r[e])}}}function D(e,t,n){n&&(e[t]=n)}function M(e){const t={},n={}
for(const[r,i]of Object.entries(e.properties)){const o=new k(r,e.transform(e.attributes||{},r),i,e.space)
e.mustUseProperty&&e.mustUseProperty.includes(r)&&(o.mustUseProperty=!0),t[r]=o,n[b(r)]=r,n[b(o.attribute)]=r}return new y(t,n,e.space)}k.prototype.defined=!0
const R=M({properties:{ariaActiveDescendant:null,ariaAtomic:C,ariaAutoComplete:null,ariaBusy:C,ariaChecked:C,ariaColCount:T,ariaColIndex:T,ariaColSpan:T,ariaControls:A,ariaCurrent:null,ariaDescribedBy:A,ariaDetails:null,ariaDisabled:C,ariaDropEffect:A,ariaErrorMessage:null,ariaExpanded:C,ariaFlowTo:A,ariaGrabbed:C,ariaHasPopup:null,ariaHidden:C,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:A,ariaLevel:T,ariaLive:null,ariaModal:C,ariaMultiLine:C,ariaMultiSelectable:C,ariaOrientation:null,ariaOwns:A,ariaPlaceholder:null,ariaPosInSet:T,ariaPressed:C,ariaReadOnly:C,ariaRelevant:null,ariaRequired:C,ariaRoleDescription:A,ariaRowCount:T,ariaRowIndex:T,ariaRowSpan:T,ariaSelected:C,ariaSetSize:T,ariaSort:null,ariaValueMax:T,ariaValueMin:T,ariaValueNow:T,ariaValueText:null,role:null},transform:(e,t)=>"role"===t?t:"aria-"+t.slice(4).toLowerCase()})
function O(e,t){return t in e?e[t]:t}function L(e,t){return O(e,t.toLowerCase())}const N=M({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:I,acceptCharset:A,accessKey:A,action:null,allow:null,allowFullScreen:_,allowPaymentRequest:_,allowUserMedia:_,alt:null,as:null,async:_,autoCapitalize:null,autoComplete:A,autoFocus:_,autoPlay:_,blocking:A,capture:null,charSet:null,checked:_,cite:null,className:A,cols:T,colSpan:null,content:null,contentEditable:C,controls:_,controlsList:A,coords:T|I,crossOrigin:null,data:null,dateTime:null,decoding:null,default:_,defer:_,dir:null,dirName:null,disabled:_,download:w,draggable:C,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:_,formTarget:null,headers:A,height:T,hidden:w,high:T,href:null,hrefLang:null,htmlFor:A,httpEquiv:A,id:null,imageSizes:null,imageSrcSet:null,inert:_,inputMode:null,integrity:null,is:null,isMap:_,itemId:null,itemProp:A,itemRef:A,itemScope:_,itemType:A,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:_,low:T,manifest:null,max:null,maxLength:T,media:null,method:null,min:null,minLength:T,multiple:_,muted:_,name:null,nonce:null,noModule:_,noValidate:_,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:_,optimum:T,pattern:null,ping:A,placeholder:null,playsInline:_,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:_,referrerPolicy:null,rel:A,required:_,reversed:_,rows:T,rowSpan:T,sandbox:A,scope:null,scoped:_,seamless:_,selected:_,shadowRootClonable:_,shadowRootDelegatesFocus:_,shadowRootMode:null,shape:null,size:T,sizes:null,slot:null,span:T,spellCheck:C,src:null,srcDoc:null,srcLang:null,srcSet:null,start:T,step:null,style:null,tabIndex:T,target:null,title:null,translate:null,type:null,typeMustMatch:_,useMap:null,value:C,width:T,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:A,axis:null,background:null,bgColor:null,border:T,borderColor:null,bottomMargin:T,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:_,declare:_,event:null,face:null,frame:null,frameBorder:null,hSpace:T,leftMargin:T,link:null,longDesc:null,lowSrc:null,marginHeight:T,marginWidth:T,noResize:_,noHref:_,noShade:_,noWrap:_,object:null,profile:null,prompt:null,rev:null,rightMargin:T,rules:null,scheme:null,scrolling:C,standby:null,summary:null,text:null,topMargin:T,valueType:null,version:null,vAlign:null,vLink:null,vSpace:T,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:_,disableRemotePlayback:_,prefix:null,property:null,results:T,security:null,unselectable:null},space:"html",transform:L}),F=M({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:P,accentHeight:T,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:T,amplitude:T,arabicForm:null,ascent:T,attributeName:null,attributeType:null,azimuth:T,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:T,by:null,calcMode:null,capHeight:T,className:A,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:T,diffuseConstant:T,direction:null,display:null,dur:null,divisor:T,dominantBaseline:null,download:_,dx:null,dy:null,edgeMode:null,editable:null,elevation:T,enableBackground:null,end:null,event:null,exponent:T,externalResourcesRequired:null,fill:null,fillOpacity:T,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:I,g2:I,glyphName:I,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:T,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:T,horizOriginX:T,horizOriginY:T,id:null,ideographic:T,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:T,k:T,k1:T,k2:T,k3:T,k4:T,kernelMatrix:P,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:T,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:T,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:T,overlineThickness:T,paintOrder:null,panose1:null,path:null,pathLength:T,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:A,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:T,pointsAtY:T,pointsAtZ:T,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:P,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:P,rev:P,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:P,requiredFeatures:P,requiredFonts:P,requiredFormats:P,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:T,specularExponent:T,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:T,strikethroughThickness:T,string:null,stroke:null,strokeDashArray:P,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:T,strokeOpacity:T,strokeWidth:null,style:null,surfaceScale:T,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:P,tabIndex:T,tableValues:null,target:null,targetX:T,targetY:T,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:P,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:T,underlineThickness:T,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:T,values:null,vAlphabetic:T,vMathematical:T,vectorEffect:null,vHanging:T,vIdeographic:T,version:null,vertAdvY:T,vertOriginX:T,vertOriginY:T,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:T,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:O}),z=M({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform:(e,t)=>"xlink:"+t.slice(5).toLowerCase()}),j=M({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:L}),V=M({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform:(e,t)=>"xml:"+t.slice(3).toLowerCase()}),U=v([R,N,z,j,V],"html"),G=v([R,F,z,j,V],"svg"),H=/[A-Z]/g,q=/-[a-z]/g,Q=/^data[-\w.:]+$/i
function $(e){return"-"+e.toLowerCase()}function X(e){return e.charAt(1).toUpperCase()}const W={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"}
var Y=n(68867)
const Z=J("end"),K=J("start")
function J(e){return function(t){const n=t&&t.position&&t.position[e]||{}
if("number"==typeof n.line&&n.line>0&&"number"==typeof n.column&&n.column>0)return{line:n.line,column:n.column,offset:"number"==typeof n.offset&&n.offset>-1?n.offset:void 0}}}function ee(e){return e&&"object"==typeof e?"position"in e||"type"in e?ne(e.position):"start"in e||"end"in e?ne(e):"line"in e||"column"in e?te(e):"":""}function te(e){return re(e&&e.line)+":"+re(e&&e.column)}function ne(e){return te(e&&e.start)+"-"+te(e&&e.end)}function re(e){return e&&"number"==typeof e?e:1}class ie extends Error{constructor(e,t,n){super(),"string"==typeof t&&(n=t,t=void 0)
let r="",i={},o=!1
if(t&&(i="line"in t&&"column"in t||"start"in t&&"end"in t?{place:t}:"type"in t?{ancestors:[t],place:t.position}:{...t}),"string"==typeof e?r=e:!i.cause&&e&&(o=!0,r=e.message,i.cause=e),!i.ruleId&&!i.source&&"string"==typeof n){const e=n.indexOf(":");-1===e?i.ruleId=n:(i.source=n.slice(0,e),i.ruleId=n.slice(e+1))}if(!i.place&&i.ancestors&&i.ancestors){const e=i.ancestors[i.ancestors.length-1]
e&&(i.place=e.position)}const a=i.place&&"start"in i.place?i.place.start:i.place
this.ancestors=i.ancestors||void 0,this.cause=i.cause||void 0,this.column=a?a.column:void 0,this.fatal=void 0,this.file="",this.message=r,this.line=a?a.line:void 0,this.name=ee(i.place)||"1:1",this.place=i.place||void 0,this.reason=this.message,this.ruleId=i.ruleId||void 0,this.source=i.source||void 0,this.stack=o&&i.cause&&"string"==typeof i.cause.stack?i.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}ie.prototype.file="",ie.prototype.name="",ie.prototype.reason="",ie.prototype.message="",ie.prototype.stack="",ie.prototype.column=void 0,ie.prototype.line=void 0,ie.prototype.ancestors=void 0,ie.prototype.cause=void 0,ie.prototype.fatal=void 0,ie.prototype.place=void 0,ie.prototype.ruleId=void 0,ie.prototype.source=void 0
const oe={}.hasOwnProperty,ae=new Map,se=/[A-Z]/g,le=new Set(["table","tbody","thead","tfoot","tr"]),ce=new Set(["td","th"]),ue="https://github.com/syntax-tree/hast-util-to-jsx-runtime"
function de(e,t,n){return"element"===t.type?function(e,t,n){const r=e.schema
let i=r
"svg"===t.tagName.toLowerCase()&&"html"===r.space&&(i=G,e.schema=i),e.ancestors.push(t)
const o=ge(e,t.tagName,!1),a=function(e,t){const n={}
let r,i
for(i in t.properties)if("children"!==i&&oe.call(t.properties,i)){const o=me(e,i,t.properties[i])
if(o){const[i,a]=o
e.tableCellAlignToStyle&&"align"===i&&"string"==typeof a&&ce.has(t.tagName)?r=a:n[i]=a}}return r&&((n.style||(n.style={}))["css"===e.stylePropertyNameCase?"text-align":"textAlign"]=r),n}(e,t)
let s=fe(e,t)
return le.has(t.tagName)&&(s=s.filter(function(e){return"string"!=typeof e||!("object"==typeof(t=e)?"text"===t.type&&g(t.value):g(t))
var t})),pe(e,a,o,t),he(a,s),e.ancestors.pop(),e.schema=r,e.create(t,o,a,n)}(e,t,n):"mdxFlowExpression"===t.type||"mdxTextExpression"===t.type?function(e,t){if(t.data&&t.data.estree&&e.evaluater){const n=t.data.estree.body[0]
return n.type,e.evaluater.evaluateExpression(n.expression)}ye(e,t.position)}(e,t):"mdxJsxFlowElement"===t.type||"mdxJsxTextElement"===t.type?function(e,t,n){const r=e.schema
let i=r
"svg"===t.name&&"html"===r.space&&(i=G,e.schema=i),e.ancestors.push(t)
const o=null===t.name?e.Fragment:ge(e,t.name,!0),a=function(e,t){const n={}
for(const r of t.attributes)if("mdxJsxExpressionAttribute"===r.type)if(r.data&&r.data.estree&&e.evaluater){const t=r.data.estree.body[0]
c(t.type)
const i=t.expression
c(i.type)
const o=i.properties[0]
c(o.type),Object.assign(n,e.evaluater.evaluateExpression(o.argument))}else ye(e,t.position)
else{const i=r.name
let o
if(r.value&&"object"==typeof r.value)if(r.value.data&&r.value.data.estree&&e.evaluater){const t=r.value.data.estree.body[0]
c(t.type),o=e.evaluater.evaluateExpression(t.expression)}else ye(e,t.position)
else o=null===r.value||r.value
n[i]=o}return n}(e,t),s=fe(e,t)
return pe(e,a,o,t),he(a,s),e.ancestors.pop(),e.schema=r,e.create(t,o,a,n)}(e,t,n):"mdxjsEsm"===t.type?function(e,t){if(t.data&&t.data.estree&&e.evaluater)return e.evaluater.evaluateProgram(t.data.estree)
ye(e,t.position)}(e,t):"root"===t.type?function(e,t,n){const r={}
return he(r,fe(e,t)),e.create(t,e.Fragment,r,n)}(e,t,n):"text"===t.type?function(e,t){return t.value}(0,t):void 0}function pe(e,t,n,r){"string"!=typeof n&&n!==e.Fragment&&e.passNode&&(t.node=r)}function he(e,t){if(t.length>0){const n=t.length>1?t:t[0]
n&&(e.children=n)}}function fe(e,t){const n=[]
let r=-1
const i=e.passKeys?new Map:ae
for(;++r<t.children.length;){const o=t.children[r]
let a
if(e.passKeys){const e="element"===o.type?o.tagName:"mdxJsxFlowElement"===o.type||"mdxJsxTextElement"===o.type?o.name:void 0
if(e){const t=i.get(e)||0
a=e+"-"+t,i.set(e,t+1)}}const s=de(e,o,a)
void 0!==s&&n.push(s)}return n}function me(e,t,n){const r=function(e,t){const n=b(t)
let r=t,i=x
if(n in e.normal)return e.property[e.normal[n]]
if(n.length>4&&"data"===n.slice(0,4)&&Q.test(t)){if("-"===t.charAt(4)){const e=t.slice(5).replace(q,X)
r="data"+e.charAt(0).toUpperCase()+e.slice(1)}else{const e=t.slice(4)
if(!q.test(e)){let n=e.replace(H,$)
"-"!==n.charAt(0)&&(n="-"+n),t="data"+n}}i=k}return new i(r,t)}(e.schema,t)
if(!(null==n||"number"==typeof n&&Number.isNaN(n))){if(Array.isArray(n)&&(n=r.commaSeparated?function(e){const t={}
return(""===e[e.length-1]?[...e,""]:e).join((t.padRight?" ":"")+","+(!1===t.padLeft?"":" ")).trim()}(n):n.join(" ").trim()),"style"===r.property){let t="object"==typeof n?n:function(e,t){try{return Y(t,{reactCompat:!0})}catch(t){if(e.ignoreInvalidStyle)return{}
const n=t,r=new ie("Cannot parse `style` attribute",{ancestors:e.ancestors,cause:n,ruleId:"style",source:"hast-util-to-jsx-runtime"})
throw r.file=e.filePath||void 0,r.url=ue+"#cannot-parse-style-attribute",r}}(e,String(n))
return"css"===e.stylePropertyNameCase&&(t=function(e){const t={}
let n
for(n in e)oe.call(e,n)&&(t[ve(n)]=e[n])
return t}(t)),["style",t]}return["react"===e.elementAttributeNameCase&&r.space?W[r.property]||r.property:r.attribute,n]}}function ge(e,t,n){let r
if(n)if(t.includes(".")){const e=t.split(".")
let n,i=-1
for(;++i<e.length;){const t=f(e[i])?{type:"Identifier",name:e[i]}:{type:"Literal",value:e[i]}
n=n?{type:"MemberExpression",object:n,property:t,computed:Boolean(i&&"Literal"===t.type),optional:!1}:t}r=n}else r=f(t)&&!/^[a-z]/.test(t)?{type:"Identifier",name:t}:{type:"Literal",value:t}
else r={type:"Literal",value:t}
if("Literal"===r.type){const t=r.value
return oe.call(e.components,t)?e.components[t]:t}if(e.evaluater)return e.evaluater.evaluateExpression(r)
ye(e)}function ye(e,t){const n=new ie("Cannot handle MDX estrees without `createEvaluater`",{ancestors:e.ancestors,place:t,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"})
throw n.file=e.filePath||void 0,n.url=ue+"#cannot-handle-mdx-estrees-without-createevaluater",n}function ve(e){let t=e.replace(se,be)
return"ms-"===t.slice(0,3)&&(t="-"+t),t}function be(e){return"-"+e.toLowerCase()}const xe={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},Se={}
function _e(e,t){const n=t||Se
return Ce(e,"boolean"!=typeof n.includeImageAlt||n.includeImageAlt,"boolean"!=typeof n.includeHtml||n.includeHtml)}function Ce(e,t,n){if(function(e){return Boolean(e&&"object"==typeof e)}(e)){if("value"in e)return"html"!==e.type||n?e.value:""
if(t&&"alt"in e&&e.alt)return e.alt
if("children"in e)return we(e.children,t,n)}return Array.isArray(e)?we(e,t,n):""}function we(e,t,n){const r=[]
let i=-1
for(;++i<e.length;)r[i]=Ce(e[i],t,n)
return r.join("")}function Te(e,t,n,r){const i=e.length
let o,a=0
if(t=t<0?-t>i?0:i+t:t>i?i:t,n=n>0?n:0,r.length<1e4)o=Array.from(r),o.unshift(t,n),e.splice(...o)
else for(n&&e.splice(t,n);a<r.length;)o=r.slice(a,a+1e4),o.unshift(t,0),e.splice(...o),a+=1e4,t+=1e4}function Ae(e,t){return e.length>0?(Te(e,e.length,0,t),e):t}class Ie{constructor(e){this.left=e?[...e]:[],this.right=[]}get(e){if(e<0||e>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+e+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`")
return e<this.left.length?this.left[e]:this.right[this.right.length-e+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(e,t){const n=null==t?Number.POSITIVE_INFINITY:t
return n<this.left.length?this.left.slice(e,n):e>this.left.length?this.right.slice(this.right.length-n+this.left.length,this.right.length-e+this.left.length).reverse():this.left.slice(e).concat(this.right.slice(this.right.length-n+this.left.length).reverse())}splice(e,t,n){const r=t||0
this.setCursor(Math.trunc(e))
const i=this.right.splice(this.right.length-r,Number.POSITIVE_INFINITY)
return n&&Pe(this.left,n),i.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(e){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(e)}pushMany(e){this.setCursor(Number.POSITIVE_INFINITY),Pe(this.left,e)}unshift(e){this.setCursor(0),this.right.push(e)}unshiftMany(e){this.setCursor(0),Pe(this.right,e.reverse())}setCursor(e){if(!(e===this.left.length||e>this.left.length&&0===this.right.length||e<0&&0===this.left.length))if(e<this.left.length){const t=this.left.splice(e,Number.POSITIVE_INFINITY)
Pe(this.right,t.reverse())}else{const t=this.right.splice(this.left.length+this.right.length-e,Number.POSITIVE_INFINITY)
Pe(this.left,t.reverse())}}}function Pe(e,t){let n=0
if(t.length<1e4)e.push(...t)
else for(;n<t.length;)e.push(...t.slice(n,n+1e4)),n+=1e4}function Be(e){const t={}
let n,r,i,o,a,s,l,c=-1
const u=new Ie(e)
for(;++c<u.length;){for(;c in t;)c=t[c]
if(n=u.get(c),c&&"chunkFlow"===n[1].type&&"listItemPrefix"===u.get(c-1)[1].type&&(s=n[1]._tokenizer.events,i=0,i<s.length&&"lineEndingBlank"===s[i][1].type&&(i+=2),i<s.length&&"content"===s[i][1].type))for(;++i<s.length&&"content"!==s[i][1].type;)"chunkText"===s[i][1].type&&(s[i][1]._isInFirstContentOfListItem=!0,i++)
if("enter"===n[0])n[1].contentType&&(Object.assign(t,Ee(u,c)),c=t[c],l=!0)
else if(n[1]._container){for(i=c,r=void 0;i--;)if(o=u.get(i),"lineEnding"===o[1].type||"lineEndingBlank"===o[1].type)"enter"===o[0]&&(r&&(u.get(r)[1].type="lineEndingBlank"),o[1].type="lineEnding",r=i)
else if("linePrefix"!==o[1].type&&"listItemIndent"!==o[1].type)break
r&&(n[1].end={...u.get(r)[1].start},a=u.slice(r,c),a.unshift(n),u.splice(r,c-r+1,a))}}return Te(e,0,Number.POSITIVE_INFINITY,u.slice(0)),!l}function Ee(e,t){const n=e.get(t)[1],r=e.get(t)[2]
let i=t-1
const o=[]
let a=n._tokenizer
a||(a=r.parser[n.contentType](n.start),n._contentTypeTextTrailing&&(a._contentTypeTextTrailing=!0))
const s=a.events,l=[],c={}
let u,d,p=-1,h=n,f=0,m=0
const g=[m]
for(;h;){for(;e.get(++i)[1]!==h;);o.push(i),h._tokenizer||(u=r.sliceStream(h),h.next||u.push(null),d&&a.defineSkip(h.start),h._isInFirstContentOfListItem&&(a._gfmTasklistFirstContentOfListItem=!0),a.write(u),h._isInFirstContentOfListItem&&(a._gfmTasklistFirstContentOfListItem=void 0)),d=h,h=h.next}for(h=n;++p<s.length;)"exit"===s[p][0]&&"enter"===s[p-1][0]&&s[p][1].type===s[p-1][1].type&&s[p][1].start.line!==s[p][1].end.line&&(m=p+1,g.push(m),h._tokenizer=void 0,h.previous=void 0,h=h.next)
for(a.events=[],h?(h._tokenizer=void 0,h.previous=void 0):g.pop(),p=g.length;p--;){const t=s.slice(g[p],g[p+1]),n=o.pop()
l.push([n,n+t.length-1]),e.splice(n,2,t)}for(l.reverse(),p=-1;++p<l.length;)c[f+l[p][0]]=f+l[p][1],f+=l[p][1]-l[p][0]-1
return c}const ke={}.hasOwnProperty
function De(e){const t={}
let n=-1
for(;++n<e.length;)Me(t,e[n])
return t}function Me(e,t){let n
for(n in t){const r=(ke.call(e,n)?e[n]:void 0)||(e[n]={}),i=t[n]
let o
if(i)for(o in i){ke.call(r,o)||(r[o]=[])
const e=i[o]
Re(r[o],Array.isArray(e)?e:e?[e]:[])}}}function Re(e,t){let n=-1
const r=[]
for(;++n<t.length;)("after"===t[n].add?e:r).push(t[n])
Te(e,0,0,r)}const Oe=$e(/[A-Za-z]/),Le=$e(/[\dA-Za-z]/),Ne=$e(/[#-'*+\--9=?A-Z^-~]/)
function Fe(e){return null!==e&&(e<32||127===e)}const ze=$e(/\d/),je=$e(/[\dA-Fa-f]/),Ve=$e(/[!-/:-@[-`{-~]/)
function Ue(e){return null!==e&&e<-2}function Ge(e){return null!==e&&(e<0||32===e)}function He(e){return-2===e||-1===e||32===e}const qe=$e(/\p{P}|\p{S}/u),Qe=$e(/\s/)
function $e(e){return function(t){return null!==t&&t>-1&&e.test(String.fromCharCode(t))}}function Xe(e,t,n,r){const i=r?r-1:Number.POSITIVE_INFINITY
let o=0
return function(r){return He(r)?(e.enter(n),a(r)):t(r)}
function a(r){return He(r)&&o++<i?(e.consume(r),a):(e.exit(n),t(r))}}const We={tokenize:function(e){const t=e.attempt(this.parser.constructs.contentInitial,function(n){if(null!==n)return e.enter("lineEnding"),e.consume(n),e.exit("lineEnding"),Xe(e,t,"linePrefix")
e.consume(n)},function(t){return e.enter("paragraph"),r(t)})
let n
return t
function r(t){const r=e.enter("chunkText",{contentType:"text",previous:n})
return n&&(n.next=r),n=r,i(t)}function i(t){return null===t?(e.exit("chunkText"),e.exit("paragraph"),void e.consume(t)):Ue(t)?(e.consume(t),e.exit("chunkText"),r):(e.consume(t),i)}}},Ye={tokenize:function(e){const t=this,n=[]
let r,i,o,a=0
return s
function s(r){if(a<n.length){const i=n[a]
return t.containerState=i[1],e.attempt(i[0].continuation,l,c)(r)}return c(r)}function l(e){if(a++,t.containerState._closeFlow){t.containerState._closeFlow=void 0,r&&v()
const n=t.events.length
let i,o=n
for(;o--;)if("exit"===t.events[o][0]&&"chunkFlow"===t.events[o][1].type){i=t.events[o][1].end
break}y(a)
let s=n
for(;s<t.events.length;)t.events[s][1].end={...i},s++
return Te(t.events,o+1,0,t.events.slice(n)),t.events.length=s,c(e)}return s(e)}function c(i){if(a===n.length){if(!r)return p(i)
if(r.currentConstruct&&r.currentConstruct.concrete)return f(i)
t.interrupt=Boolean(r.currentConstruct&&!r._gfmTableDynamicInterruptHack)}return t.containerState={},e.check(Ze,u,d)(i)}function u(e){return r&&v(),y(a),p(e)}function d(e){return t.parser.lazy[t.now().line]=a!==n.length,o=t.now().offset,f(e)}function p(n){return t.containerState={},e.attempt(Ze,h,f)(n)}function h(e){return a++,n.push([t.currentConstruct,t.containerState]),p(e)}function f(n){return null===n?(r&&v(),y(0),void e.consume(n)):(r=r||t.parser.flow(t.now()),e.enter("chunkFlow",{_tokenizer:r,contentType:"flow",previous:i}),m(n))}function m(n){return null===n?(g(e.exit("chunkFlow"),!0),y(0),void e.consume(n)):Ue(n)?(e.consume(n),g(e.exit("chunkFlow")),a=0,t.interrupt=void 0,s):(e.consume(n),m)}function g(e,n){const s=t.sliceStream(e)
if(n&&s.push(null),e.previous=i,i&&(i.next=e),i=e,r.defineSkip(e.start),r.write(s),t.parser.lazy[e.start.line]){let e=r.events.length
for(;e--;)if(r.events[e][1].start.offset<o&&(!r.events[e][1].end||r.events[e][1].end.offset>o))return
const n=t.events.length
let i,s,l=n
for(;l--;)if("exit"===t.events[l][0]&&"chunkFlow"===t.events[l][1].type){if(i){s=t.events[l][1].end
break}i=!0}for(y(a),e=n;e<t.events.length;)t.events[e][1].end={...s},e++
Te(t.events,l+1,0,t.events.slice(n)),t.events.length=e}}function y(r){let i=n.length
for(;i-- >r;){const r=n[i]
t.containerState=r[1],r[0].exit.call(t,e)}n.length=r}function v(){r.write([null]),i=void 0,r=void 0,t.containerState._closeFlow=void 0}}},Ze={tokenize:function(e,t,n){return Xe(e,e.attempt(this.parser.constructs.document,t,n),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}},Ke={partial:!0,tokenize:function(e,t,n){return function(t){return He(t)?Xe(e,r,"linePrefix")(t):r(t)}
function r(e){return null===e||Ue(e)?t(e):n(e)}}},Je={resolve:function(e){return Be(e),e},tokenize:function(e,t){let n
return function(t){return e.enter("content"),n=e.enter("chunkContent",{contentType:"content"}),r(t)}
function r(t){return null===t?i(t):Ue(t)?e.check(et,o,i)(t):(e.consume(t),r)}function i(n){return e.exit("chunkContent"),e.exit("content"),t(n)}function o(t){return e.consume(t),e.exit("chunkContent"),n.next=e.enter("chunkContent",{contentType:"content",previous:n}),n=n.next,r}}},et={partial:!0,tokenize:function(e,t,n){const r=this
return function(t){return e.exit("chunkContent"),e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),Xe(e,i,"linePrefix")}
function i(i){if(null===i||Ue(i))return n(i)
const o=r.events[r.events.length-1]
return!r.parser.constructs.disable.null.includes("codeIndented")&&o&&"linePrefix"===o[1].type&&o[2].sliceSerialize(o[1],!0).length>=4?t(i):e.interrupt(r.parser.constructs.flow,n,t)(i)}}},tt={tokenize:function(e){const t=this,n=e.attempt(Ke,function(r){if(null!==r)return e.enter("lineEndingBlank"),e.consume(r),e.exit("lineEndingBlank"),t.currentConstruct=void 0,n
e.consume(r)},e.attempt(this.parser.constructs.flowInitial,r,Xe(e,e.attempt(this.parser.constructs.flow,r,e.attempt(Je,r)),"linePrefix")))
return n
function r(r){if(null!==r)return e.enter("lineEnding"),e.consume(r),e.exit("lineEnding"),t.currentConstruct=void 0,n
e.consume(r)}}},nt={resolveAll:at()},rt=ot("string"),it=ot("text")
function ot(e){return{resolveAll:at("text"===e?st:void 0),tokenize:function(t){const n=this,r=this.parser.constructs[e],i=t.attempt(r,o,a)
return o
function o(e){return l(e)?i(e):a(e)}function a(e){if(null!==e)return t.enter("data"),t.consume(e),s
t.consume(e)}function s(e){return l(e)?(t.exit("data"),i(e)):(t.consume(e),s)}function l(e){if(null===e)return!0
const t=r[e]
let i=-1
if(t)for(;++i<t.length;){const e=t[i]
if(!e.previous||e.previous.call(n,n.previous))return!0}return!1}}}}function at(e){return function(t,n){let r,i=-1
for(;++i<=t.length;)void 0===r?t[i]&&"data"===t[i][1].type&&(r=i,i++):t[i]&&"data"===t[i][1].type||(i!==r+2&&(t[r][1].end=t[i-1][1].end,t.splice(r+2,i-r-2),i=r+2),r=void 0)
return e?e(t,n):t}}function st(e,t){let n=0
for(;++n<=e.length;)if((n===e.length||"lineEnding"===e[n][1].type)&&"data"===e[n-1][1].type){const r=e[n-1][1],i=t.sliceStream(r)
let o,a=i.length,s=-1,l=0
for(;a--;){const e=i[a]
if("string"==typeof e){for(s=e.length;32===e.charCodeAt(s-1);)l++,s--
if(s)break
s=-1}else if(-2===e)o=!0,l++
else if(-1!==e){a++
break}}if(t._contentTypeTextTrailing&&n===e.length&&(l=0),l){const i={type:n===e.length||o||l<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:a?s:r.start._bufferIndex+s,_index:r.start._index+a,line:r.end.line,column:r.end.column-l,offset:r.end.offset-l},end:{...r.end}}
r.end={...i.start},r.start.offset===r.end.offset?Object.assign(r,i):(e.splice(n,0,["enter",i,t],["exit",i,t]),n+=2)}n++}return e}const lt={name:"thematicBreak",tokenize:function(e,t,n){let r,i=0
return function(t){return e.enter("thematicBreak"),function(e){return r=e,o(e)}(t)}
function o(o){return o===r?(e.enter("thematicBreakSequence"),a(o)):i>=3&&(null===o||Ue(o))?(e.exit("thematicBreak"),t(o)):n(o)}function a(t){return t===r?(e.consume(t),i++,a):(e.exit("thematicBreakSequence"),He(t)?Xe(e,o,"whitespace")(t):o(t))}}},ct={continuation:{tokenize:function(e,t,n){const r=this
return r.containerState._closeFlow=void 0,e.check(Ke,function(n){return r.containerState.furtherBlankLines=r.containerState.furtherBlankLines||r.containerState.initialBlankLine,Xe(e,t,"listItemIndent",r.containerState.size+1)(n)},function(n){return r.containerState.furtherBlankLines||!He(n)?(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,i(n)):(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,e.attempt(dt,t,i)(n))})
function i(i){return r.containerState._closeFlow=!0,r.interrupt=void 0,Xe(e,e.attempt(ct,t,n),"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(i)}}},exit:function(e){e.exit(this.containerState.type)},name:"list",tokenize:function(e,t,n){const r=this,i=r.events[r.events.length-1]
let o=i&&"linePrefix"===i[1].type?i[2].sliceSerialize(i[1],!0).length:0,a=0
return function(t){const i=r.containerState.type||(42===t||43===t||45===t?"listUnordered":"listOrdered")
if("listUnordered"===i?!r.containerState.marker||t===r.containerState.marker:ze(t)){if(r.containerState.type||(r.containerState.type=i,e.enter(i,{_container:!0})),"listUnordered"===i)return e.enter("listItemPrefix"),42===t||45===t?e.check(lt,n,l)(t):l(t)
if(!r.interrupt||49===t)return e.enter("listItemPrefix"),e.enter("listItemValue"),s(t)}return n(t)}
function s(t){return ze(t)&&++a<10?(e.consume(t),s):(!r.interrupt||a<2)&&(r.containerState.marker?t===r.containerState.marker:41===t||46===t)?(e.exit("listItemValue"),l(t)):n(t)}function l(t){return e.enter("listItemMarker"),e.consume(t),e.exit("listItemMarker"),r.containerState.marker=r.containerState.marker||t,e.check(Ke,r.interrupt?n:c,e.attempt(ut,d,u))}function c(e){return r.containerState.initialBlankLine=!0,o++,d(e)}function u(t){return He(t)?(e.enter("listItemPrefixWhitespace"),e.consume(t),e.exit("listItemPrefixWhitespace"),d):n(t)}function d(n){return r.containerState.size=o+r.sliceSerialize(e.exit("listItemPrefix"),!0).length,t(n)}}},ut={partial:!0,tokenize:function(e,t,n){const r=this
return Xe(e,function(e){const i=r.events[r.events.length-1]
return!He(e)&&i&&"listItemPrefixWhitespace"===i[1].type?t(e):n(e)},"listItemPrefixWhitespace",r.parser.constructs.disable.null.includes("codeIndented")?void 0:5)}},dt={partial:!0,tokenize:function(e,t,n){const r=this
return Xe(e,function(e){const i=r.events[r.events.length-1]
return i&&"listItemIndent"===i[1].type&&i[2].sliceSerialize(i[1],!0).length===r.containerState.size?t(e):n(e)},"listItemIndent",r.containerState.size+1)}},pt={continuation:{tokenize:function(e,t,n){const r=this
return function(t){return He(t)?Xe(e,i,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(t):i(t)}
function i(r){return e.attempt(pt,t,n)(r)}}},exit:function(e){e.exit("blockQuote")},name:"blockQuote",tokenize:function(e,t,n){const r=this
return function(t){if(62===t){const n=r.containerState
return n.open||(e.enter("blockQuote",{_container:!0}),n.open=!0),e.enter("blockQuotePrefix"),e.enter("blockQuoteMarker"),e.consume(t),e.exit("blockQuoteMarker"),i}return n(t)}
function i(n){return He(n)?(e.enter("blockQuotePrefixWhitespace"),e.consume(n),e.exit("blockQuotePrefixWhitespace"),e.exit("blockQuotePrefix"),t):(e.exit("blockQuotePrefix"),t(n))}}}
function ht(e,t,n,r,i,o,a,s,l){const c=l||Number.POSITIVE_INFINITY
let u=0
return function(t){return 60===t?(e.enter(r),e.enter(i),e.enter(o),e.consume(t),e.exit(o),d):null===t||32===t||41===t||Fe(t)?n(t):(e.enter(r),e.enter(a),e.enter(s),e.enter("chunkString",{contentType:"string"}),f(t))}
function d(n){return 62===n?(e.enter(o),e.consume(n),e.exit(o),e.exit(i),e.exit(r),t):(e.enter(s),e.enter("chunkString",{contentType:"string"}),p(n))}function p(t){return 62===t?(e.exit("chunkString"),e.exit(s),d(t)):null===t||60===t||Ue(t)?n(t):(e.consume(t),92===t?h:p)}function h(t){return 60===t||62===t||92===t?(e.consume(t),p):p(t)}function f(i){return u||null!==i&&41!==i&&!Ge(i)?u<c&&40===i?(e.consume(i),u++,f):41===i?(e.consume(i),u--,f):null===i||32===i||40===i||Fe(i)?n(i):(e.consume(i),92===i?m:f):(e.exit("chunkString"),e.exit(s),e.exit(a),e.exit(r),t(i))}function m(t){return 40===t||41===t||92===t?(e.consume(t),f):f(t)}}function ft(e,t,n,r,i,o){const a=this
let s,l=0
return function(t){return e.enter(r),e.enter(i),e.consume(t),e.exit(i),e.enter(o),c}
function c(d){return l>999||null===d||91===d||93===d&&!s||94===d&&!l&&"_hiddenFootnoteSupport"in a.parser.constructs?n(d):93===d?(e.exit(o),e.enter(i),e.consume(d),e.exit(i),e.exit(r),t):Ue(d)?(e.enter("lineEnding"),e.consume(d),e.exit("lineEnding"),c):(e.enter("chunkString",{contentType:"string"}),u(d))}function u(t){return null===t||91===t||93===t||Ue(t)||l++>999?(e.exit("chunkString"),c(t)):(e.consume(t),s||(s=!He(t)),92===t?d:u)}function d(t){return 91===t||92===t||93===t?(e.consume(t),l++,u):u(t)}}function mt(e,t,n,r,i,o){let a
return function(t){return 34===t||39===t||40===t?(e.enter(r),e.enter(i),e.consume(t),e.exit(i),a=40===t?41:t,s):n(t)}
function s(n){return n===a?(e.enter(i),e.consume(n),e.exit(i),e.exit(r),t):(e.enter(o),l(n))}function l(t){return t===a?(e.exit(o),s(a)):null===t?n(t):Ue(t)?(e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),Xe(e,l,"linePrefix")):(e.enter("chunkString",{contentType:"string"}),c(t))}function c(t){return t===a||null===t||Ue(t)?(e.exit("chunkString"),l(t)):(e.consume(t),92===t?u:c)}function u(t){return t===a||92===t?(e.consume(t),c):c(t)}}function gt(e,t){let n
return function r(i){return Ue(i)?(e.enter("lineEnding"),e.consume(i),e.exit("lineEnding"),n=!0,r):He(i)?Xe(e,r,n?"linePrefix":"lineSuffix")(i):t(i)}}function yt(e){return e.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const vt={name:"definition",tokenize:function(e,t,n){const r=this
let i
return function(t){return e.enter("definition"),function(t){return ft.call(r,e,o,n,"definitionLabel","definitionLabelMarker","definitionLabelString")(t)}(t)}
function o(t){return i=yt(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)),58===t?(e.enter("definitionMarker"),e.consume(t),e.exit("definitionMarker"),a):n(t)}function a(t){return Ge(t)?gt(e,s)(t):s(t)}function s(t){return ht(e,l,n,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(t)}function l(t){return e.attempt(bt,c,c)(t)}function c(t){return He(t)?Xe(e,u,"whitespace")(t):u(t)}function u(o){return null===o||Ue(o)?(e.exit("definition"),r.parser.defined.push(i),t(o)):n(o)}}},bt={partial:!0,tokenize:function(e,t,n){return function(t){return Ge(t)?gt(e,r)(t):n(t)}
function r(t){return mt(e,i,n,"definitionTitle","definitionTitleMarker","definitionTitleString")(t)}function i(t){return He(t)?Xe(e,o,"whitespace")(t):o(t)}function o(e){return null===e||Ue(e)?t(e):n(e)}}},xt={name:"codeIndented",tokenize:function(e,t,n){const r=this
return function(t){return e.enter("codeIndented"),Xe(e,i,"linePrefix",5)(t)}
function i(e){const t=r.events[r.events.length-1]
return t&&"linePrefix"===t[1].type&&t[2].sliceSerialize(t[1],!0).length>=4?o(e):n(e)}function o(t){return null===t?s(t):Ue(t)?e.attempt(St,o,s)(t):(e.enter("codeFlowValue"),a(t))}function a(t){return null===t||Ue(t)?(e.exit("codeFlowValue"),o(t)):(e.consume(t),a)}function s(n){return e.exit("codeIndented"),t(n)}}},St={partial:!0,tokenize:function(e,t,n){const r=this
return i
function i(t){return r.parser.lazy[r.now().line]?n(t):Ue(t)?(e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),i):Xe(e,o,"linePrefix",5)(t)}function o(e){const o=r.events[r.events.length-1]
return o&&"linePrefix"===o[1].type&&o[2].sliceSerialize(o[1],!0).length>=4?t(e):Ue(e)?i(e):n(e)}}},_t={name:"headingAtx",resolve:function(e,t){let n,r,i=e.length-2,o=3
return"whitespace"===e[o][1].type&&(o+=2),i-2>o&&"whitespace"===e[i][1].type&&(i-=2),"atxHeadingSequence"===e[i][1].type&&(o===i-1||i-4>o&&"whitespace"===e[i-2][1].type)&&(i-=o+1===i?2:4),i>o&&(n={type:"atxHeadingText",start:e[o][1].start,end:e[i][1].end},r={type:"chunkText",start:e[o][1].start,end:e[i][1].end,contentType:"text"},Te(e,o,i-o+1,[["enter",n,t],["enter",r,t],["exit",r,t],["exit",n,t]])),e},tokenize:function(e,t,n){let r=0
return function(t){return e.enter("atxHeading"),function(t){return e.enter("atxHeadingSequence"),i(t)}(t)}
function i(t){return 35===t&&r++<6?(e.consume(t),i):null===t||Ge(t)?(e.exit("atxHeadingSequence"),o(t)):n(t)}function o(n){return 35===n?(e.enter("atxHeadingSequence"),a(n)):null===n||Ue(n)?(e.exit("atxHeading"),t(n)):He(n)?Xe(e,o,"whitespace")(n):(e.enter("atxHeadingText"),s(n))}function a(t){return 35===t?(e.consume(t),a):(e.exit("atxHeadingSequence"),o(t))}function s(t){return null===t||35===t||Ge(t)?(e.exit("atxHeadingText"),o(t)):(e.consume(t),s)}}},Ct={name:"setextUnderline",resolveTo:function(e,t){let n,r,i,o=e.length
for(;o--;)if("enter"===e[o][0]){if("content"===e[o][1].type){n=o
break}"paragraph"===e[o][1].type&&(r=o)}else"content"===e[o][1].type&&e.splice(o,1),i||"definition"!==e[o][1].type||(i=o)
const a={type:"setextHeading",start:{...e[n][1].start},end:{...e[e.length-1][1].end}}
return e[r][1].type="setextHeadingText",i?(e.splice(r,0,["enter",a,t]),e.splice(i+1,0,["exit",e[n][1],t]),e[n][1].end={...e[i][1].end}):e[n][1]=a,e.push(["exit",a,t]),e},tokenize:function(e,t,n){const r=this
let i
return function(t){let a,s=r.events.length
for(;s--;)if("lineEnding"!==r.events[s][1].type&&"linePrefix"!==r.events[s][1].type&&"content"!==r.events[s][1].type){a="paragraph"===r.events[s][1].type
break}return r.parser.lazy[r.now().line]||!r.interrupt&&!a?n(t):(e.enter("setextHeadingLine"),i=t,function(t){return e.enter("setextHeadingLineSequence"),o(t)}(t))}
function o(t){return t===i?(e.consume(t),o):(e.exit("setextHeadingLineSequence"),He(t)?Xe(e,a,"lineSuffix")(t):a(t))}function a(r){return null===r||Ue(r)?(e.exit("setextHeadingLine"),t(r)):n(r)}}},wt=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],Tt=["pre","script","style","textarea"],At={concrete:!0,name:"htmlFlow",resolveTo:function(e){let t=e.length
for(;t--&&("enter"!==e[t][0]||"htmlFlow"!==e[t][1].type););return t>1&&"linePrefix"===e[t-2][1].type&&(e[t][1].start=e[t-2][1].start,e[t+1][1].start=e[t-2][1].start,e.splice(t-2,2)),e},tokenize:function(e,t,n){const r=this
let i,o,a,s,l
return function(t){return function(t){return e.enter("htmlFlow"),e.enter("htmlFlowData"),e.consume(t),c}(t)}
function c(s){return 33===s?(e.consume(s),u):47===s?(e.consume(s),o=!0,h):63===s?(e.consume(s),i=3,r.interrupt?t:R):Oe(s)?(e.consume(s),a=String.fromCharCode(s),f):n(s)}function u(o){return 45===o?(e.consume(o),i=2,d):91===o?(e.consume(o),i=5,s=0,p):Oe(o)?(e.consume(o),i=4,r.interrupt?t:R):n(o)}function d(i){return 45===i?(e.consume(i),r.interrupt?t:R):n(i)}function p(i){return i==="CDATA[".charCodeAt(s++)?(e.consume(i),6===s?r.interrupt?t:A:p):n(i)}function h(t){return Oe(t)?(e.consume(t),a=String.fromCharCode(t),f):n(t)}function f(s){if(null===s||47===s||62===s||Ge(s)){const l=47===s,c=a.toLowerCase()
return l||o||!Tt.includes(c)?wt.includes(a.toLowerCase())?(i=6,l?(e.consume(s),m):r.interrupt?t(s):A(s)):(i=7,r.interrupt&&!r.parser.lazy[r.now().line]?n(s):o?g(s):y(s)):(i=1,r.interrupt?t(s):A(s))}return 45===s||Le(s)?(e.consume(s),a+=String.fromCharCode(s),f):n(s)}function m(i){return 62===i?(e.consume(i),r.interrupt?t:A):n(i)}function g(t){return He(t)?(e.consume(t),g):w(t)}function y(t){return 47===t?(e.consume(t),w):58===t||95===t||Oe(t)?(e.consume(t),v):He(t)?(e.consume(t),y):w(t)}function v(t){return 45===t||46===t||58===t||95===t||Le(t)?(e.consume(t),v):b(t)}function b(t){return 61===t?(e.consume(t),x):He(t)?(e.consume(t),b):y(t)}function x(t){return null===t||60===t||61===t||62===t||96===t?n(t):34===t||39===t?(e.consume(t),l=t,S):He(t)?(e.consume(t),x):_(t)}function S(t){return t===l?(e.consume(t),l=null,C):null===t||Ue(t)?n(t):(e.consume(t),S)}function _(t){return null===t||34===t||39===t||47===t||60===t||61===t||62===t||96===t||Ge(t)?b(t):(e.consume(t),_)}function C(e){return 47===e||62===e||He(e)?y(e):n(e)}function w(t){return 62===t?(e.consume(t),T):n(t)}function T(t){return null===t||Ue(t)?A(t):He(t)?(e.consume(t),T):n(t)}function A(t){return 45===t&&2===i?(e.consume(t),E):60===t&&1===i?(e.consume(t),k):62===t&&4===i?(e.consume(t),O):63===t&&3===i?(e.consume(t),R):93===t&&5===i?(e.consume(t),M):!Ue(t)||6!==i&&7!==i?null===t||Ue(t)?(e.exit("htmlFlowData"),I(t)):(e.consume(t),A):(e.exit("htmlFlowData"),e.check(It,L,I)(t))}function I(t){return e.check(Pt,P,L)(t)}function P(t){return e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),B}function B(t){return null===t||Ue(t)?I(t):(e.enter("htmlFlowData"),A(t))}function E(t){return 45===t?(e.consume(t),R):A(t)}function k(t){return 47===t?(e.consume(t),a="",D):A(t)}function D(t){if(62===t){const n=a.toLowerCase()
return Tt.includes(n)?(e.consume(t),O):A(t)}return Oe(t)&&a.length<8?(e.consume(t),a+=String.fromCharCode(t),D):A(t)}function M(t){return 93===t?(e.consume(t),R):A(t)}function R(t){return 62===t?(e.consume(t),O):45===t&&2===i?(e.consume(t),R):A(t)}function O(t){return null===t||Ue(t)?(e.exit("htmlFlowData"),L(t)):(e.consume(t),O)}function L(n){return e.exit("htmlFlow"),t(n)}}},It={partial:!0,tokenize:function(e,t,n){return function(r){return e.enter("lineEnding"),e.consume(r),e.exit("lineEnding"),e.attempt(Ke,t,n)}}},Pt={partial:!0,tokenize:function(e,t,n){const r=this
return function(t){return Ue(t)?(e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),i):n(t)}
function i(e){return r.parser.lazy[r.now().line]?n(e):t(e)}}},Bt={partial:!0,tokenize:function(e,t,n){const r=this
return function(t){return null===t?n(t):(e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),i)}
function i(e){return r.parser.lazy[r.now().line]?n(e):t(e)}}},Et={concrete:!0,name:"codeFenced",tokenize:function(e,t,n){const r=this,i={partial:!0,tokenize:function(e,t,n){let i=0
return function(t){return e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),a}
function a(t){return e.enter("codeFencedFence"),He(t)?Xe(e,l,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(t):l(t)}function l(t){return t===o?(e.enter("codeFencedFenceSequence"),c(t)):n(t)}function c(t){return t===o?(i++,e.consume(t),c):i>=s?(e.exit("codeFencedFenceSequence"),He(t)?Xe(e,u,"whitespace")(t):u(t)):n(t)}function u(r){return null===r||Ue(r)?(e.exit("codeFencedFence"),t(r)):n(r)}}}
let o,a=0,s=0
return function(t){return function(t){const n=r.events[r.events.length-1]
return a=n&&"linePrefix"===n[1].type?n[2].sliceSerialize(n[1],!0).length:0,o=t,e.enter("codeFenced"),e.enter("codeFencedFence"),e.enter("codeFencedFenceSequence"),l(t)}(t)}
function l(t){return t===o?(s++,e.consume(t),l):s<3?n(t):(e.exit("codeFencedFenceSequence"),He(t)?Xe(e,c,"whitespace")(t):c(t))}function c(n){return null===n||Ue(n)?(e.exit("codeFencedFence"),r.interrupt?t(n):e.check(Bt,h,v)(n)):(e.enter("codeFencedFenceInfo"),e.enter("chunkString",{contentType:"string"}),u(n))}function u(t){return null===t||Ue(t)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),c(t)):He(t)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),Xe(e,d,"whitespace")(t)):96===t&&t===o?n(t):(e.consume(t),u)}function d(t){return null===t||Ue(t)?c(t):(e.enter("codeFencedFenceMeta"),e.enter("chunkString",{contentType:"string"}),p(t))}function p(t){return null===t||Ue(t)?(e.exit("chunkString"),e.exit("codeFencedFenceMeta"),c(t)):96===t&&t===o?n(t):(e.consume(t),p)}function h(t){return e.attempt(i,v,f)(t)}function f(t){return e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),m}function m(t){return a>0&&He(t)?Xe(e,g,"linePrefix",a+1)(t):g(t)}function g(t){return null===t||Ue(t)?e.check(Bt,h,v)(t):(e.enter("codeFlowValue"),y(t))}function y(t){return null===t||Ue(t)?(e.exit("codeFlowValue"),g(t)):(e.consume(t),y)}function v(n){return e.exit("codeFenced"),t(n)}}},kt=document.createElement("i")
function Dt(e){const t="&"+e+";"
kt.innerHTML=t
const n=kt.textContent
return(59!==n.charCodeAt(n.length-1)||"semi"===e)&&n!==t&&n}const Mt={name:"characterReference",tokenize:function(e,t,n){const r=this
let i,o,a=0
return function(t){return e.enter("characterReference"),e.enter("characterReferenceMarker"),e.consume(t),e.exit("characterReferenceMarker"),s}
function s(t){return 35===t?(e.enter("characterReferenceMarkerNumeric"),e.consume(t),e.exit("characterReferenceMarkerNumeric"),l):(e.enter("characterReferenceValue"),i=31,o=Le,c(t))}function l(t){return 88===t||120===t?(e.enter("characterReferenceMarkerHexadecimal"),e.consume(t),e.exit("characterReferenceMarkerHexadecimal"),e.enter("characterReferenceValue"),i=6,o=je,c):(e.enter("characterReferenceValue"),i=7,o=ze,c(t))}function c(s){if(59===s&&a){const i=e.exit("characterReferenceValue")
return o!==Le||Dt(r.sliceSerialize(i))?(e.enter("characterReferenceMarker"),e.consume(s),e.exit("characterReferenceMarker"),e.exit("characterReference"),t):n(s)}return o(s)&&a++<i?(e.consume(s),c):n(s)}}},Rt={name:"characterEscape",tokenize:function(e,t,n){return function(t){return e.enter("characterEscape"),e.enter("escapeMarker"),e.consume(t),e.exit("escapeMarker"),r}
function r(r){return Ve(r)?(e.enter("characterEscapeValue"),e.consume(r),e.exit("characterEscapeValue"),e.exit("characterEscape"),t):n(r)}}},Ot={name:"lineEnding",tokenize:function(e,t){return function(n){return e.enter("lineEnding"),e.consume(n),e.exit("lineEnding"),Xe(e,t,"linePrefix")}}}
function Lt(e,t,n){const r=[]
let i=-1
for(;++i<e.length;){const o=e[i].resolveAll
o&&!r.includes(o)&&(t=o(t,n),r.push(o))}return t}const Nt={name:"labelEnd",resolveAll:function(e){let t=-1
const n=[]
for(;++t<e.length;){const r=e[t][1]
if(n.push(e[t]),"labelImage"===r.type||"labelLink"===r.type||"labelEnd"===r.type){const e="labelImage"===r.type?4:2
r.type="data",t+=e}}return e.length!==n.length&&Te(e,0,e.length,n),e},resolveTo:function(e,t){let n,r,i,o,a=e.length,s=0
for(;a--;)if(n=e[a][1],r){if("link"===n.type||"labelLink"===n.type&&n._inactive)break
"enter"===e[a][0]&&"labelLink"===n.type&&(n._inactive=!0)}else if(i){if("enter"===e[a][0]&&("labelImage"===n.type||"labelLink"===n.type)&&!n._balanced&&(r=a,"labelLink"!==n.type)){s=2
break}}else"labelEnd"===n.type&&(i=a)
const l={type:"labelLink"===e[r][1].type?"link":"image",start:{...e[r][1].start},end:{...e[e.length-1][1].end}},c={type:"label",start:{...e[r][1].start},end:{...e[i][1].end}},u={type:"labelText",start:{...e[r+s+2][1].end},end:{...e[i-2][1].start}}
return o=[["enter",l,t],["enter",c,t]],o=Ae(o,e.slice(r+1,r+s+3)),o=Ae(o,[["enter",u,t]]),o=Ae(o,Lt(t.parser.constructs.insideSpan.null,e.slice(r+s+4,i-3),t)),o=Ae(o,[["exit",u,t],e[i-2],e[i-1],["exit",c,t]]),o=Ae(o,e.slice(i+1)),o=Ae(o,[["exit",l,t]]),Te(e,r,e.length,o),e},tokenize:function(e,t,n){const r=this
let i,o,a=r.events.length
for(;a--;)if(("labelImage"===r.events[a][1].type||"labelLink"===r.events[a][1].type)&&!r.events[a][1]._balanced){i=r.events[a][1]
break}return function(t){return i?i._inactive?u(t):(o=r.parser.defined.includes(yt(r.sliceSerialize({start:i.end,end:r.now()}))),e.enter("labelEnd"),e.enter("labelMarker"),e.consume(t),e.exit("labelMarker"),e.exit("labelEnd"),s):n(t)}
function s(t){return 40===t?e.attempt(Ft,c,o?c:u)(t):91===t?e.attempt(zt,c,o?l:u)(t):o?c(t):u(t)}function l(t){return e.attempt(jt,c,u)(t)}function c(e){return t(e)}function u(e){return i._balanced=!0,n(e)}}},Ft={tokenize:function(e,t,n){return function(t){return e.enter("resource"),e.enter("resourceMarker"),e.consume(t),e.exit("resourceMarker"),r}
function r(t){return Ge(t)?gt(e,i)(t):i(t)}function i(t){return 41===t?c(t):ht(e,o,a,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(t)}function o(t){return Ge(t)?gt(e,s)(t):c(t)}function a(e){return n(e)}function s(t){return 34===t||39===t||40===t?mt(e,l,n,"resourceTitle","resourceTitleMarker","resourceTitleString")(t):c(t)}function l(t){return Ge(t)?gt(e,c)(t):c(t)}function c(r){return 41===r?(e.enter("resourceMarker"),e.consume(r),e.exit("resourceMarker"),e.exit("resource"),t):n(r)}}},zt={tokenize:function(e,t,n){const r=this
return function(t){return ft.call(r,e,i,o,"reference","referenceMarker","referenceString")(t)}
function i(e){return r.parser.defined.includes(yt(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)))?t(e):n(e)}function o(e){return n(e)}}},jt={tokenize:function(e,t,n){return function(t){return e.enter("reference"),e.enter("referenceMarker"),e.consume(t),e.exit("referenceMarker"),r}
function r(r){return 93===r?(e.enter("referenceMarker"),e.consume(r),e.exit("referenceMarker"),e.exit("reference"),t):n(r)}}},Vt={name:"labelStartImage",resolveAll:Nt.resolveAll,tokenize:function(e,t,n){const r=this
return function(t){return e.enter("labelImage"),e.enter("labelImageMarker"),e.consume(t),e.exit("labelImageMarker"),i}
function i(t){return 91===t?(e.enter("labelMarker"),e.consume(t),e.exit("labelMarker"),e.exit("labelImage"),o):n(t)}function o(e){return 94===e&&"_hiddenFootnoteSupport"in r.parser.constructs?n(e):t(e)}}}
function Ut(e){return null===e||Ge(e)||Qe(e)?1:qe(e)?2:void 0}const Gt={name:"attention",resolveAll:function(e,t){let n,r,i,o,a,s,l,c,u=-1
for(;++u<e.length;)if("enter"===e[u][0]&&"attentionSequence"===e[u][1].type&&e[u][1]._close)for(n=u;n--;)if("exit"===e[n][0]&&"attentionSequence"===e[n][1].type&&e[n][1]._open&&t.sliceSerialize(e[n][1]).charCodeAt(0)===t.sliceSerialize(e[u][1]).charCodeAt(0)){if((e[n][1]._close||e[u][1]._open)&&(e[u][1].end.offset-e[u][1].start.offset)%3&&!((e[n][1].end.offset-e[n][1].start.offset+e[u][1].end.offset-e[u][1].start.offset)%3))continue
s=e[n][1].end.offset-e[n][1].start.offset>1&&e[u][1].end.offset-e[u][1].start.offset>1?2:1
const d={...e[n][1].end},p={...e[u][1].start}
Ht(d,-s),Ht(p,s),o={type:s>1?"strongSequence":"emphasisSequence",start:d,end:{...e[n][1].end}},a={type:s>1?"strongSequence":"emphasisSequence",start:{...e[u][1].start},end:p},i={type:s>1?"strongText":"emphasisText",start:{...e[n][1].end},end:{...e[u][1].start}},r={type:s>1?"strong":"emphasis",start:{...o.start},end:{...a.end}},e[n][1].end={...o.start},e[u][1].start={...a.end},l=[],e[n][1].end.offset-e[n][1].start.offset&&(l=Ae(l,[["enter",e[n][1],t],["exit",e[n][1],t]])),l=Ae(l,[["enter",r,t],["enter",o,t],["exit",o,t],["enter",i,t]]),l=Ae(l,Lt(t.parser.constructs.insideSpan.null,e.slice(n+1,u),t)),l=Ae(l,[["exit",i,t],["enter",a,t],["exit",a,t],["exit",r,t]]),e[u][1].end.offset-e[u][1].start.offset?(c=2,l=Ae(l,[["enter",e[u][1],t],["exit",e[u][1],t]])):c=0,Te(e,n-1,u-n+3,l),u=n+l.length-c-2
break}for(u=-1;++u<e.length;)"attentionSequence"===e[u][1].type&&(e[u][1].type="data")
return e},tokenize:function(e,t){const n=this.parser.constructs.attentionMarkers.null,r=this.previous,i=Ut(r)
let o
return function(t){return o=t,e.enter("attentionSequence"),a(t)}
function a(s){if(s===o)return e.consume(s),a
const l=e.exit("attentionSequence"),c=Ut(s),u=!c||2===c&&i||n.includes(s),d=!i||2===i&&c||n.includes(r)
return l._open=Boolean(42===o?u:u&&(i||!d)),l._close=Boolean(42===o?d:d&&(c||!u)),t(s)}}}
function Ht(e,t){e.column+=t,e.offset+=t,e._bufferIndex+=t}const qt={name:"autolink",tokenize:function(e,t,n){let r=0
return function(t){return e.enter("autolink"),e.enter("autolinkMarker"),e.consume(t),e.exit("autolinkMarker"),e.enter("autolinkProtocol"),i}
function i(t){return Oe(t)?(e.consume(t),o):64===t?n(t):l(t)}function o(e){return 43===e||45===e||46===e||Le(e)?(r=1,a(e)):l(e)}function a(t){return 58===t?(e.consume(t),r=0,s):(43===t||45===t||46===t||Le(t))&&r++<32?(e.consume(t),a):(r=0,l(t))}function s(r){return 62===r?(e.exit("autolinkProtocol"),e.enter("autolinkMarker"),e.consume(r),e.exit("autolinkMarker"),e.exit("autolink"),t):null===r||32===r||60===r||Fe(r)?n(r):(e.consume(r),s)}function l(t){return 64===t?(e.consume(t),c):Ne(t)?(e.consume(t),l):n(t)}function c(e){return Le(e)?u(e):n(e)}function u(n){return 46===n?(e.consume(n),r=0,c):62===n?(e.exit("autolinkProtocol").type="autolinkEmail",e.enter("autolinkMarker"),e.consume(n),e.exit("autolinkMarker"),e.exit("autolink"),t):d(n)}function d(t){if((45===t||Le(t))&&r++<63){const n=45===t?d:u
return e.consume(t),n}return n(t)}}},Qt={name:"htmlText",tokenize:function(e,t,n){const r=this
let i,o,a
return function(t){return e.enter("htmlText"),e.enter("htmlTextData"),e.consume(t),s}
function s(t){return 33===t?(e.consume(t),l):47===t?(e.consume(t),x):63===t?(e.consume(t),v):Oe(t)?(e.consume(t),C):n(t)}function l(t){return 45===t?(e.consume(t),c):91===t?(e.consume(t),o=0,h):Oe(t)?(e.consume(t),y):n(t)}function c(t){return 45===t?(e.consume(t),p):n(t)}function u(t){return null===t?n(t):45===t?(e.consume(t),d):Ue(t)?(a=u,D(t)):(e.consume(t),u)}function d(t){return 45===t?(e.consume(t),p):u(t)}function p(e){return 62===e?k(e):45===e?d(e):u(e)}function h(t){return t==="CDATA[".charCodeAt(o++)?(e.consume(t),6===o?f:h):n(t)}function f(t){return null===t?n(t):93===t?(e.consume(t),m):Ue(t)?(a=f,D(t)):(e.consume(t),f)}function m(t){return 93===t?(e.consume(t),g):f(t)}function g(t){return 62===t?k(t):93===t?(e.consume(t),g):f(t)}function y(t){return null===t||62===t?k(t):Ue(t)?(a=y,D(t)):(e.consume(t),y)}function v(t){return null===t?n(t):63===t?(e.consume(t),b):Ue(t)?(a=v,D(t)):(e.consume(t),v)}function b(e){return 62===e?k(e):v(e)}function x(t){return Oe(t)?(e.consume(t),S):n(t)}function S(t){return 45===t||Le(t)?(e.consume(t),S):_(t)}function _(t){return Ue(t)?(a=_,D(t)):He(t)?(e.consume(t),_):k(t)}function C(t){return 45===t||Le(t)?(e.consume(t),C):47===t||62===t||Ge(t)?w(t):n(t)}function w(t){return 47===t?(e.consume(t),k):58===t||95===t||Oe(t)?(e.consume(t),T):Ue(t)?(a=w,D(t)):He(t)?(e.consume(t),w):k(t)}function T(t){return 45===t||46===t||58===t||95===t||Le(t)?(e.consume(t),T):A(t)}function A(t){return 61===t?(e.consume(t),I):Ue(t)?(a=A,D(t)):He(t)?(e.consume(t),A):w(t)}function I(t){return null===t||60===t||61===t||62===t||96===t?n(t):34===t||39===t?(e.consume(t),i=t,P):Ue(t)?(a=I,D(t)):He(t)?(e.consume(t),I):(e.consume(t),B)}function P(t){return t===i?(e.consume(t),i=void 0,E):null===t?n(t):Ue(t)?(a=P,D(t)):(e.consume(t),P)}function B(t){return null===t||34===t||39===t||60===t||61===t||96===t?n(t):47===t||62===t||Ge(t)?w(t):(e.consume(t),B)}function E(e){return 47===e||62===e||Ge(e)?w(e):n(e)}function k(r){return 62===r?(e.consume(r),e.exit("htmlTextData"),e.exit("htmlText"),t):n(r)}function D(t){return e.exit("htmlTextData"),e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),M}function M(t){return He(t)?Xe(e,R,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(t):R(t)}function R(t){return e.enter("htmlTextData"),a(t)}}},$t={name:"labelStartLink",resolveAll:Nt.resolveAll,tokenize:function(e,t,n){const r=this
return function(t){return e.enter("labelLink"),e.enter("labelMarker"),e.consume(t),e.exit("labelMarker"),e.exit("labelLink"),i}
function i(e){return 94===e&&"_hiddenFootnoteSupport"in r.parser.constructs?n(e):t(e)}}},Xt={name:"hardBreakEscape",tokenize:function(e,t,n){return function(t){return e.enter("hardBreakEscape"),e.consume(t),r}
function r(r){return Ue(r)?(e.exit("hardBreakEscape"),t(r)):n(r)}}},Wt={name:"codeText",previous:function(e){return 96!==e||"characterEscape"===this.events[this.events.length-1][1].type},resolve:function(e){let t,n,r=e.length-4,i=3
if(!("lineEnding"!==e[i][1].type&&"space"!==e[i][1].type||"lineEnding"!==e[r][1].type&&"space"!==e[r][1].type))for(t=i;++t<r;)if("codeTextData"===e[t][1].type){e[i][1].type="codeTextPadding",e[r][1].type="codeTextPadding",i+=2,r-=2
break}for(t=i-1,r++;++t<=r;)void 0===n?t!==r&&"lineEnding"!==e[t][1].type&&(n=t):t!==r&&"lineEnding"!==e[t][1].type||(e[n][1].type="codeTextData",t!==n+2&&(e[n][1].end=e[t-1][1].end,e.splice(n+2,t-n-2),r-=t-n-2,t=n+2),n=void 0)
return e},tokenize:function(e,t,n){let r,i,o=0
return function(t){return e.enter("codeText"),e.enter("codeTextSequence"),a(t)}
function a(t){return 96===t?(e.consume(t),o++,a):(e.exit("codeTextSequence"),s(t))}function s(t){return null===t?n(t):32===t?(e.enter("space"),e.consume(t),e.exit("space"),s):96===t?(i=e.enter("codeTextSequence"),r=0,c(t)):Ue(t)?(e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),s):(e.enter("codeTextData"),l(t))}function l(t){return null===t||32===t||96===t||Ue(t)?(e.exit("codeTextData"),s(t)):(e.consume(t),l)}function c(n){return 96===n?(e.consume(n),r++,c):r===o?(e.exit("codeTextSequence"),e.exit("codeText"),t(n)):(i.type="codeTextData",l(n))}}},Yt={42:ct,43:ct,45:ct,48:ct,49:ct,50:ct,51:ct,52:ct,53:ct,54:ct,55:ct,56:ct,57:ct,62:pt},Zt={91:vt},Kt={[-2]:xt,[-1]:xt,32:xt},Jt={35:_t,42:lt,45:[Ct,lt],60:At,61:Ct,95:lt,96:Et,126:Et},en={38:Mt,92:Rt},tn={[-5]:Ot,[-4]:Ot,[-3]:Ot,33:Vt,38:Mt,42:Gt,60:[qt,Qt],91:$t,92:[Xt,Rt],93:Nt,95:Gt,96:Wt},nn={null:[Gt,nt]},rn={null:[42,95]},on={null:[]}
const an=/[\0\t\n\r]/g
function sn(e,t){const n=Number.parseInt(e,t)
return n<9||11===n||n>13&&n<32||n>126&&n<160||n>55295&&n<57344||n>64975&&n<65008||!(65535&~n)||65534==(65535&n)||n>1114111?"":String.fromCodePoint(n)}const ln=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi
function cn(e,t,n){if(t)return t
if(35===n.charCodeAt(0)){const e=n.charCodeAt(1),t=120===e||88===e
return sn(n.slice(t?2:1),t?16:10)}return Dt(n)||e}const un={}.hasOwnProperty
function dn(e,t,n){return"string"!=typeof t&&(n=t,t=void 0),function(e){const t={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:i(v),autolinkProtocol:u,autolinkEmail:u,atxHeading:i(m),blockQuote:i(function(){return{type:"blockquote",children:[]}}),characterEscape:u,characterReference:u,codeFenced:i(f),codeFencedFenceInfo:o,codeFencedFenceMeta:o,codeIndented:i(f,o),codeText:i(function(){return{type:"inlineCode",value:""}},o),codeTextData:u,data:u,codeFlowValue:u,definition:i(function(){return{type:"definition",identifier:"",label:null,title:null,url:""}}),definitionDestinationString:o,definitionLabelString:o,definitionTitleString:o,emphasis:i(function(){return{type:"emphasis",children:[]}}),hardBreakEscape:i(g),hardBreakTrailing:i(g),htmlFlow:i(y,o),htmlFlowData:u,htmlText:i(y,o),htmlTextData:u,image:i(function(){return{type:"image",title:null,url:"",alt:null}}),label:o,link:i(v),listItem:i(function(e){return{type:"listItem",spread:e._spread,checked:null,children:[]}}),listItemValue:function(e){this.data.expectingFirstListItemValue&&(this.stack[this.stack.length-2].start=Number.parseInt(this.sliceSerialize(e),10),this.data.expectingFirstListItemValue=void 0)},listOrdered:i(b,function(){this.data.expectingFirstListItemValue=!0}),listUnordered:i(b),paragraph:i(function(){return{type:"paragraph",children:[]}}),reference:function(){this.data.referenceType="collapsed"},referenceString:o,resourceDestinationString:o,resourceTitleString:o,setextHeading:i(m),strong:i(function(){return{type:"strong",children:[]}}),thematicBreak:i(function(){return{type:"thematicBreak"}})},exit:{atxHeading:s(),atxHeadingSequence:function(e){const t=this.stack[this.stack.length-1]
if(!t.depth){const n=this.sliceSerialize(e).length
t.depth=n}},autolink:s(),autolinkEmail:function(e){d.call(this,e),this.stack[this.stack.length-1].url="mailto:"+this.sliceSerialize(e)},autolinkProtocol:function(e){d.call(this,e),this.stack[this.stack.length-1].url=this.sliceSerialize(e)},blockQuote:s(),characterEscapeValue:d,characterReferenceMarkerHexadecimal:h,characterReferenceMarkerNumeric:h,characterReferenceValue:function(e){const t=this.sliceSerialize(e),n=this.data.characterReferenceType
let r
n?(r=sn(t,"characterReferenceMarkerNumeric"===n?10:16),this.data.characterReferenceType=void 0):r=Dt(t),this.stack[this.stack.length-1].value+=r},characterReference:function(e){this.stack.pop().position.end=pn(e.end)},codeFenced:s(function(){const e=this.resume()
this.stack[this.stack.length-1].value=e.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}),codeFencedFence:function(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)},codeFencedFenceInfo:function(){const e=this.resume()
this.stack[this.stack.length-1].lang=e},codeFencedFenceMeta:function(){const e=this.resume()
this.stack[this.stack.length-1].meta=e},codeFlowValue:d,codeIndented:s(function(){const e=this.resume()
this.stack[this.stack.length-1].value=e.replace(/(\r?\n|\r)$/g,"")}),codeText:s(function(){const e=this.resume()
this.stack[this.stack.length-1].value=e}),codeTextData:d,data:d,definition:s(),definitionDestinationString:function(){const e=this.resume()
this.stack[this.stack.length-1].url=e},definitionLabelString:function(e){const t=this.resume(),n=this.stack[this.stack.length-1]
n.label=t,n.identifier=yt(this.sliceSerialize(e)).toLowerCase()},definitionTitleString:function(){const e=this.resume()
this.stack[this.stack.length-1].title=e},emphasis:s(),hardBreakEscape:s(p),hardBreakTrailing:s(p),htmlFlow:s(function(){const e=this.resume()
this.stack[this.stack.length-1].value=e}),htmlFlowData:d,htmlText:s(function(){const e=this.resume()
this.stack[this.stack.length-1].value=e}),htmlTextData:d,image:s(function(){const e=this.stack[this.stack.length-1]
if(this.data.inReference){const t=this.data.referenceType||"shortcut"
e.type+="Reference",e.referenceType=t,delete e.url,delete e.title}else delete e.identifier,delete e.label
this.data.referenceType=void 0}),label:function(){const e=this.stack[this.stack.length-1],t=this.resume(),n=this.stack[this.stack.length-1]
if(this.data.inReference=!0,"link"===n.type){const t=e.children
n.children=t}else n.alt=t},labelText:function(e){const t=this.sliceSerialize(e),n=this.stack[this.stack.length-2]
n.label=function(e){return e.replace(ln,cn)}(t),n.identifier=yt(t).toLowerCase()},lineEnding:function(e){const n=this.stack[this.stack.length-1]
if(this.data.atHardBreak)return n.children[n.children.length-1].position.end=pn(e.end),void(this.data.atHardBreak=void 0)
!this.data.setextHeadingSlurpLineEnding&&t.canContainEols.includes(n.type)&&(u.call(this,e),d.call(this,e))},link:s(function(){const e=this.stack[this.stack.length-1]
if(this.data.inReference){const t=this.data.referenceType||"shortcut"
e.type+="Reference",e.referenceType=t,delete e.url,delete e.title}else delete e.identifier,delete e.label
this.data.referenceType=void 0}),listItem:s(),listOrdered:s(),listUnordered:s(),paragraph:s(),referenceString:function(e){const t=this.resume(),n=this.stack[this.stack.length-1]
n.label=t,n.identifier=yt(this.sliceSerialize(e)).toLowerCase(),this.data.referenceType="full"},resourceDestinationString:function(){const e=this.resume()
this.stack[this.stack.length-1].url=e},resourceTitleString:function(){const e=this.resume()
this.stack[this.stack.length-1].title=e},resource:function(){this.data.inReference=void 0},setextHeading:s(function(){this.data.setextHeadingSlurpLineEnding=void 0}),setextHeadingLineSequence:function(e){this.stack[this.stack.length-1].depth=61===this.sliceSerialize(e).codePointAt(0)?1:2},setextHeadingText:function(){this.data.setextHeadingSlurpLineEnding=!0},strong:s(),thematicBreak:s()}}
hn(t,(e||{}).mdastExtensions||[])
const n={}
return function(e){let i={type:"root",children:[]}
const s={stack:[i],tokenStack:[],config:t,enter:a,exit:l,buffer:o,resume:c,data:n},u=[]
let d=-1
for(;++d<e.length;)"listOrdered"!==e[d][1].type&&"listUnordered"!==e[d][1].type||("enter"===e[d][0]?u.push(d):d=r(e,u.pop(),d))
for(d=-1;++d<e.length;){const n=t[e[d][0]]
un.call(n,e[d][1].type)&&n[e[d][1].type].call(Object.assign({sliceSerialize:e[d][2].sliceSerialize},s),e[d][1])}if(s.tokenStack.length>0){const e=s.tokenStack[s.tokenStack.length-1];(e[1]||mn).call(s,void 0,e[0])}for(i.position={start:pn(e.length>0?e[0][1].start:{line:1,column:1,offset:0}),end:pn(e.length>0?e[e.length-2][1].end:{line:1,column:1,offset:0})},d=-1;++d<t.transforms.length;)i=t.transforms[d](i)||i
return i}
function r(e,t,n){let r,i,o,a,s=t-1,l=-1,c=!1
for(;++s<=n;){const t=e[s]
switch(t[1].type){case"listUnordered":case"listOrdered":case"blockQuote":"enter"===t[0]?l++:l--,a=void 0
break
case"lineEndingBlank":"enter"===t[0]&&(!r||a||l||o||(o=s),a=void 0)
break
case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break
default:a=void 0}if(!l&&"enter"===t[0]&&"listItemPrefix"===t[1].type||-1===l&&"exit"===t[0]&&("listUnordered"===t[1].type||"listOrdered"===t[1].type)){if(r){let a=s
for(i=void 0;a--;){const t=e[a]
if("lineEnding"===t[1].type||"lineEndingBlank"===t[1].type){if("exit"===t[0])continue
i&&(e[i][1].type="lineEndingBlank",c=!0),t[1].type="lineEnding",i=a}else if("linePrefix"!==t[1].type&&"blockQuotePrefix"!==t[1].type&&"blockQuotePrefixWhitespace"!==t[1].type&&"blockQuoteMarker"!==t[1].type&&"listItemIndent"!==t[1].type)break}o&&(!i||o<i)&&(r._spread=!0),r.end=Object.assign({},i?e[i][1].start:t[1].end),e.splice(i||s,0,["exit",r,t[2]]),s++,n++}if("listItemPrefix"===t[1].type){const i={type:"listItem",_spread:!1,start:Object.assign({},t[1].start),end:void 0}
r=i,e.splice(s,0,["enter",i,t[2]]),s++,n++,o=void 0,a=!0}}}return e[t][1]._spread=c,n}function i(e,t){return function(n){a.call(this,e(n),n),t&&t.call(this,n)}}function o(){this.stack.push({type:"fragment",children:[]})}function a(e,t,n){this.stack[this.stack.length-1].children.push(e),this.stack.push(e),this.tokenStack.push([t,n||void 0]),e.position={start:pn(t.start),end:void 0}}function s(e){return function(t){e&&e.call(this,t),l.call(this,t)}}function l(e,t){const n=this.stack.pop(),r=this.tokenStack.pop()
if(!r)throw new Error("Cannot close `"+e.type+"` ("+ee({start:e.start,end:e.end})+"): its not open")
r[0].type!==e.type&&(t?t.call(this,e,r[0]):(r[1]||mn).call(this,e,r[0])),n.position.end=pn(e.end)}function c(){return _e(this.stack.pop())}function u(e){const t=this.stack[this.stack.length-1].children
let n=t[t.length-1]
n&&"text"===n.type||(n={type:"text",value:""},n.position={start:pn(e.start),end:void 0},t.push(n)),this.stack.push(n)}function d(e){const t=this.stack.pop()
t.value+=this.sliceSerialize(e),t.position.end=pn(e.end)}function p(){this.data.atHardBreak=!0}function h(e){this.data.characterReferenceType=e.type}function f(){return{type:"code",lang:null,meta:null,value:""}}function m(){return{type:"heading",depth:0,children:[]}}function g(){return{type:"break"}}function y(){return{type:"html",value:""}}function v(){return{type:"link",title:null,url:"",children:[]}}function b(e){return{type:"list",ordered:"listOrdered"===e.type,start:null,spread:e._spread,children:[]}}}(n)(function(e){for(;!Be(e););return e}(function(e){const t={constructs:De([i,...(e||{}).extensions||[]]),content:n(We),defined:[],document:n(Ye),flow:n(tt),lazy:{},string:n(rt),text:n(it)}
return t
function n(e){return function(n){return function(e,t,n){let r={_bufferIndex:-1,_index:0,line:n&&n.line||1,column:n&&n.column||1,offset:n&&n.offset||0}
const i={},o=[]
let a=[],s=[],l=!0
const c={attempt:y(function(e,t){v(e,t.from)}),check:y(g),consume:function(e){Ue(e)?(r.line++,r.column=1,r.offset+=-3===e?2:1,b()):-1!==e&&(r.column++,r.offset++),r._bufferIndex<0?r._index++:(r._bufferIndex++,r._bufferIndex===a[r._index].length&&(r._bufferIndex=-1,r._index++)),u.previous=e,l=!0},enter:function(e,t){const n=t||{}
return n.type=e,n.start=f(),u.events.push(["enter",n,u]),s.push(n),n},exit:function(e){const t=s.pop()
return t.end=f(),u.events.push(["exit",t,u]),t},interrupt:y(g,{interrupt:!0})},u={code:null,containerState:{},defineSkip:function(e){i[e.line]=e.column,b()},events:[],now:f,parser:e,previous:null,sliceSerialize:function(e,t){return function(e,t){let n=-1
const r=[]
let i
for(;++n<e.length;){const o=e[n]
let a
if("string"==typeof o)a=o
else switch(o){case-5:a="\r"
break
case-4:a="\n"
break
case-3:a="\r\n"
break
case-2:a=t?" ":"\t"
break
case-1:if(!t&&i)continue
a=" "
break
default:a=String.fromCharCode(o)}i=-2===o,r.push(a)}return r.join("")}(h(e),t)},sliceStream:h,write:function(e){return a=Ae(a,e),function(){let e
for(;r._index<a.length;){const t=a[r._index]
if("string"==typeof t)for(e=r._index,r._bufferIndex<0&&(r._bufferIndex=0);r._index===e&&r._bufferIndex<t.length;)m(t.charCodeAt(r._bufferIndex))
else m(t)}}(),null!==a[a.length-1]?[]:(v(t,0),u.events=Lt(o,u.events,u),u.events)}}
let d,p=t.tokenize.call(u,c)
return t.resolveAll&&o.push(t),u
function h(e){return function(e,t){const n=t.start._index,r=t.start._bufferIndex,i=t.end._index,o=t.end._bufferIndex
let a
if(n===i)a=[e[n].slice(r,o)]
else{if(a=e.slice(n,i),r>-1){const e=a[0]
"string"==typeof e?a[0]=e.slice(r):a.shift()}o>0&&a.push(e[i].slice(0,o))}return a}(a,e)}function f(){const{_bufferIndex:e,_index:t,line:n,column:i,offset:o}=r
return{_bufferIndex:e,_index:t,line:n,column:i,offset:o}}function m(e){l=void 0,d=e,p=p(e)}function g(e,t){t.restore()}function y(e,t){return function(n,i,o){let a,d,p,h
return Array.isArray(n)?m(n):"tokenize"in n?m([n]):function(e){return function(t){const n=null!==t&&e[t],r=null!==t&&e.null
return m([...Array.isArray(n)?n:n?[n]:[],...Array.isArray(r)?r:r?[r]:[]])(t)}}(n)
function m(e){return a=e,d=0,0===e.length?o:g(e[d])}function g(e){return function(n){return h=function(){const e=f(),t=u.previous,n=u.currentConstruct,i=u.events.length,o=Array.from(s)
return{from:i,restore:function(){r=e,u.previous=t,u.currentConstruct=n,u.events.length=i,s=o,b()}}}(),p=e,e.partial||(u.currentConstruct=e),e.name&&u.parser.constructs.disable.null.includes(e.name)?v():e.tokenize.call(t?Object.assign(Object.create(u),t):u,c,y,v)(n)}}function y(t){return l=!0,e(p,h),i}function v(e){return l=!0,h.restore(),++d<a.length?g(a[d]):o}}}function v(e,t){e.resolveAll&&!o.includes(e)&&o.push(e),e.resolve&&Te(u.events,t,u.events.length-t,e.resolve(u.events.slice(t),u)),e.resolveTo&&(u.events=e.resolveTo(u.events,u))}function b(){r.line in i&&r.column<2&&(r.column=i[r.line],r.offset+=i[r.line]-1)}}(t,e,n)}}}(n).document().write(function(){let e,t=1,n="",r=!0
return function(i,o,a){const s=[]
let l,c,u,d,p
for(i=n+("string"==typeof i?i.toString():new TextDecoder(o||void 0).decode(i)),u=0,n="",r&&(65279===i.charCodeAt(0)&&u++,r=void 0);u<i.length;){if(an.lastIndex=u,l=an.exec(i),d=l&&void 0!==l.index?l.index:i.length,p=i.charCodeAt(d),!l){n=i.slice(u)
break}if(10===p&&u===d&&e)s.push(-3),e=void 0
else switch(e&&(s.push(-5),e=void 0),u<d&&(s.push(i.slice(u,d)),t+=d-u),p){case 0:s.push(65533),t++
break
case 9:for(c=4*Math.ceil(t/4),s.push(-2);t++<c;)s.push(-1)
break
case 10:s.push(-4),t=1
break
default:e=!0,t=1}u=d+1}return a&&(e&&s.push(-5),n&&s.push(n),s.push(null)),s}}()(e,t,!0))))}function pn(e){return{line:e.line,column:e.column,offset:e.offset}}function hn(e,t){let n=-1
for(;++n<t.length;){const r=t[n]
Array.isArray(r)?hn(e,r):fn(e,r)}}function fn(e,t){let n
for(n in t)if(un.call(t,n))switch(n){case"canContainEols":{const r=t[n]
r&&e[n].push(...r)
break}case"transforms":{const r=t[n]
r&&e[n].push(...r)
break}case"enter":case"exit":{const r=t[n]
r&&Object.assign(e[n],r)
break}}}function mn(e,t){throw e?new Error("Cannot close `"+e.type+"` ("+ee({start:e.start,end:e.end})+"): a different token (`"+t.type+"`, "+ee({start:t.start,end:t.end})+") is open"):new Error("Cannot close document, a token (`"+t.type+"`, "+ee({start:t.start,end:t.end})+") is still open")}function gn(e){const t=this
t.parser=function(n){return dn(n,{...t.data("settings"),...e,extensions:t.data("micromarkExtensions")||[],mdastExtensions:t.data("fromMarkdownExtensions")||[]})}}const yn="object"==typeof self?self:globalThis,vn=e=>((e,t)=>{const n=(t,n)=>(e.set(n,t),t),r=i=>{if(e.has(i))return e.get(i)
const[o,a]=t[i]
switch(o){case 0:case-1:return n(a,i)
case 1:{const e=n([],i)
for(const t of a)e.push(r(t))
return e}case 2:{const e=n({},i)
for(const[t,n]of a)e[r(t)]=r(n)
return e}case 3:return n(new Date(a),i)
case 4:{const{source:e,flags:t}=a
return n(new RegExp(e,t),i)}case 5:{const e=n(new Map,i)
for(const[t,n]of a)e.set(r(t),r(n))
return e}case 6:{const e=n(new Set,i)
for(const t of a)e.add(r(t))
return e}case 7:{const{name:e,message:t}=a
return n(new yn[e](t),i)}case 8:return n(BigInt(a),i)
case"BigInt":return n(Object(BigInt(a)),i)
case"ArrayBuffer":return n(new Uint8Array(a).buffer,a)
case"DataView":{const{buffer:e}=new Uint8Array(a)
return n(new DataView(e),a)}}return n(new yn[o](a),i)}
return r})(new Map,e)(0),bn="",{toString:xn}={},{keys:Sn}=Object,_n=e=>{const t=typeof e
if("object"!==t||!e)return[0,t]
const n=xn.call(e).slice(8,-1)
switch(n){case"Array":return[1,bn]
case"Object":return[2,bn]
case"Date":return[3,bn]
case"RegExp":return[4,bn]
case"Map":return[5,bn]
case"Set":return[6,bn]
case"DataView":return[1,n]}return n.includes("Array")?[1,n]:n.includes("Error")?[7,n]:[2,n]},Cn=([e,t])=>0===e&&("function"===t||"symbol"===t),wn=(e,{json:t,lossy:n}={})=>{const r=[]
return((e,t,n,r)=>{const i=(e,t)=>{const i=r.push(e)-1
return n.set(t,i),i},o=r=>{if(n.has(r))return n.get(r)
let[a,s]=_n(r)
switch(a){case 0:{let t=r
switch(s){case"bigint":a=8,t=r.toString()
break
case"function":case"symbol":if(e)throw new TypeError("unable to serialize "+s)
t=null
break
case"undefined":return i([-1],r)}return i([a,t],r)}case 1:{if(s){let e=r
return"DataView"===s?e=new Uint8Array(r.buffer):"ArrayBuffer"===s&&(e=new Uint8Array(r)),i([s,[...e]],r)}const e=[],t=i([a,e],r)
for(const n of r)e.push(o(n))
return t}case 2:{if(s)switch(s){case"BigInt":return i([s,r.toString()],r)
case"Boolean":case"Number":case"String":return i([s,r.valueOf()],r)}if(t&&"toJSON"in r)return o(r.toJSON())
const n=[],l=i([a,n],r)
for(const t of Sn(r))!e&&Cn(_n(r[t]))||n.push([o(t),o(r[t])])
return l}case 3:return i([a,r.toISOString()],r)
case 4:{const{source:e,flags:t}=r
return i([a,{source:e,flags:t}],r)}case 5:{const t=[],n=i([a,t],r)
for(const[i,a]of r)(e||!Cn(_n(i))&&!Cn(_n(a)))&&t.push([o(i),o(a)])
return n}case 6:{const t=[],n=i([a,t],r)
for(const i of r)!e&&Cn(_n(i))||t.push(o(i))
return n}}const{message:l}=r
return i([a,{name:s,message:l}],r)}
return o})(!(t||n),!!t,new Map,r)(e),r},Tn="function"==typeof structuredClone?(e,t)=>t&&("json"in t||"lossy"in t)?vn(wn(e,t)):structuredClone(e):(e,t)=>vn(wn(e,t))
function An(e){const t=[]
let n=-1,r=0,i=0
for(;++n<e.length;){const o=e.charCodeAt(n)
let a=""
if(37===o&&Le(e.charCodeAt(n+1))&&Le(e.charCodeAt(n+2)))i=2
else if(o<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(o))||(a=String.fromCharCode(o))
else if(o>55295&&o<57344){const t=e.charCodeAt(n+1)
o<56320&&t>56319&&t<57344?(a=String.fromCharCode(o,t),i=1):a=""}else a=String.fromCharCode(o)
a&&(t.push(e.slice(r,n),encodeURIComponent(a)),r=n+i+1,a=""),i&&(n+=i,i=0)}return t.join("")+e.slice(r)}function In(e,t){const n=[{type:"text",value:""}]
return t>1&&n.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(t)}]}),n}function Pn(e,t){return"Back to reference "+(e+1)+(t>1?"-"+t:"")}const Bn=function(e){if(null==e)return kn
if("function"==typeof e)return En(e)
if("object"==typeof e)return Array.isArray(e)?function(e){const t=[]
let n=-1
for(;++n<e.length;)t[n]=Bn(e[n])
return En(function(...e){let n=-1
for(;++n<t.length;)if(t[n].apply(this,e))return!0
return!1})}(e):function(e){const t=e
return En(function(n){const r=n
let i
for(i in e)if(r[i]!==t[i])return!1
return!0})}(e)
if("string"==typeof e)return t=e,En(function(e){return e&&e.type===t})
var t
throw new Error("Expected function, string, or object as test")}
function En(e){return function(t,n,r){return Boolean(function(e){return null!==e&&"object"==typeof e&&"type"in e}(t)&&e.call(this,t,"number"==typeof n?n:void 0,r||void 0))}}function kn(){return!0}const Dn=[],Mn=!1
function Rn(e,t,n,r){let i
"function"==typeof t&&"function"!=typeof n?(r=n,n=t):i=t
const o=Bn(i),a=r?-1:1
!function e(i,s,l){const c=i&&"object"==typeof i?i:{}
if("string"==typeof c.type){const e="string"==typeof c.tagName?c.tagName:"string"==typeof c.name?c.name:void 0
Object.defineProperty(u,"name",{value:"node ("+i.type+(e?"<"+e+">":"")+")"})}return u
function u(){let c,u,d,p=Dn
if((!t||o(i,s,l[l.length-1]||void 0))&&(p=function(e){return Array.isArray(e)?e:"number"==typeof e?[!0,e]:null==e?Dn:[e]}(n(i,l)),p[0]===Mn))return p
if("children"in i&&i.children){const t=i
if(t.children&&"skip"!==p[0])for(u=(r?t.children.length:-1)+a,d=l.concat(t);u>-1&&u<t.children.length;){const n=t.children[u]
if(c=e(n,u,d)(),c[0]===Mn)return c
u="number"==typeof c[1]?c[1]:u+a}}return p}}(e,void 0,[])()}function On(e,t,n,r){let i,o,a
"function"==typeof t&&"function"!=typeof n?(o=void 0,a=t,i=n):(o=t,a=n,i=r),Rn(e,o,function(e,t){const n=t[t.length-1],r=n?n.children.indexOf(e):void 0
return a(e,r,n)},i)}function Ln(e,t){const n=t.referenceType
let r="]"
if("collapsed"===n?r+="[]":"full"===n&&(r+="["+(t.label||t.identifier)+"]"),"imageReference"===t.type)return[{type:"text",value:"!["+t.alt+r}]
const i=e.all(t),o=i[0]
o&&"text"===o.type?o.value="["+o.value:i.unshift({type:"text",value:"["})
const a=i[i.length-1]
return a&&"text"===a.type?a.value+=r:i.push({type:"text",value:r}),i}function Nn(e){const t=e.spread
return null==t?e.children.length>1:t}function Fn(e){const t=String(e),n=/\r?\n|\r/g
let r=n.exec(t),i=0
const o=[]
for(;r;)o.push(zn(t.slice(i,r.index),i>0,!0),r[0]),i=r.index+r[0].length,r=n.exec(t)
return o.push(zn(t.slice(i),i>0,!1)),o.join("")}function zn(e,t,n){let r=0,i=e.length
if(t){let t=e.codePointAt(r)
for(;9===t||32===t;)r++,t=e.codePointAt(r)}if(n){let t=e.codePointAt(i-1)
for(;9===t||32===t;)i--,t=e.codePointAt(i-1)}return i>r?e.slice(r,i):""}const jn={blockquote:function(e,t){const n={type:"element",tagName:"blockquote",properties:{},children:e.wrap(e.all(t),!0)}
return e.patch(t,n),e.applyData(t,n)},break:function(e,t){const n={type:"element",tagName:"br",properties:{},children:[]}
return e.patch(t,n),[e.applyData(t,n),{type:"text",value:"\n"}]},code:function(e,t){const n=t.value?t.value+"\n":"",r={},i=t.lang?t.lang.split(/\s+/):[]
i.length>0&&(r.className=["language-"+i[0]])
let o={type:"element",tagName:"code",properties:r,children:[{type:"text",value:n}]}
return t.meta&&(o.data={meta:t.meta}),e.patch(t,o),o=e.applyData(t,o),o={type:"element",tagName:"pre",properties:{},children:[o]},e.patch(t,o),o},delete:function(e,t){const n={type:"element",tagName:"del",properties:{},children:e.all(t)}
return e.patch(t,n),e.applyData(t,n)},emphasis:function(e,t){const n={type:"element",tagName:"em",properties:{},children:e.all(t)}
return e.patch(t,n),e.applyData(t,n)},footnoteReference:function(e,t){const n="string"==typeof e.options.clobberPrefix?e.options.clobberPrefix:"user-content-",r=String(t.identifier).toUpperCase(),i=An(r.toLowerCase()),o=e.footnoteOrder.indexOf(r)
let a,s=e.footnoteCounts.get(r)
void 0===s?(s=0,e.footnoteOrder.push(r),a=e.footnoteOrder.length):a=o+1,s+=1,e.footnoteCounts.set(r,s)
const l={type:"element",tagName:"a",properties:{href:"#"+n+"fn-"+i,id:n+"fnref-"+i+(s>1?"-"+s:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(a)}]}
e.patch(t,l)
const c={type:"element",tagName:"sup",properties:{},children:[l]}
return e.patch(t,c),e.applyData(t,c)},heading:function(e,t){const n={type:"element",tagName:"h"+t.depth,properties:{},children:e.all(t)}
return e.patch(t,n),e.applyData(t,n)},html:function(e,t){if(e.options.allowDangerousHtml){const n={type:"raw",value:t.value}
return e.patch(t,n),e.applyData(t,n)}},imageReference:function(e,t){const n=String(t.identifier).toUpperCase(),r=e.definitionById.get(n)
if(!r)return Ln(e,t)
const i={src:An(r.url||""),alt:t.alt}
null!==r.title&&void 0!==r.title&&(i.title=r.title)
const o={type:"element",tagName:"img",properties:i,children:[]}
return e.patch(t,o),e.applyData(t,o)},image:function(e,t){const n={src:An(t.url)}
null!==t.alt&&void 0!==t.alt&&(n.alt=t.alt),null!==t.title&&void 0!==t.title&&(n.title=t.title)
const r={type:"element",tagName:"img",properties:n,children:[]}
return e.patch(t,r),e.applyData(t,r)},inlineCode:function(e,t){const n={type:"text",value:t.value.replace(/\r?\n|\r/g," ")}
e.patch(t,n)
const r={type:"element",tagName:"code",properties:{},children:[n]}
return e.patch(t,r),e.applyData(t,r)},linkReference:function(e,t){const n=String(t.identifier).toUpperCase(),r=e.definitionById.get(n)
if(!r)return Ln(e,t)
const i={href:An(r.url||"")}
null!==r.title&&void 0!==r.title&&(i.title=r.title)
const o={type:"element",tagName:"a",properties:i,children:e.all(t)}
return e.patch(t,o),e.applyData(t,o)},link:function(e,t){const n={href:An(t.url)}
null!==t.title&&void 0!==t.title&&(n.title=t.title)
const r={type:"element",tagName:"a",properties:n,children:e.all(t)}
return e.patch(t,r),e.applyData(t,r)},listItem:function(e,t,n){const r=e.all(t),i=n?function(e){let t=!1
if("list"===e.type){t=e.spread||!1
const n=e.children
let r=-1
for(;!t&&++r<n.length;)t=Nn(n[r])}return t}(n):Nn(t),o={},a=[]
if("boolean"==typeof t.checked){const e=r[0]
let n
e&&"element"===e.type&&"p"===e.tagName?n=e:(n={type:"element",tagName:"p",properties:{},children:[]},r.unshift(n)),n.children.length>0&&n.children.unshift({type:"text",value:" "}),n.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:t.checked,disabled:!0},children:[]}),o.className=["task-list-item"]}let s=-1
for(;++s<r.length;){const e=r[s];(i||0!==s||"element"!==e.type||"p"!==e.tagName)&&a.push({type:"text",value:"\n"}),"element"!==e.type||"p"!==e.tagName||i?a.push(e):a.push(...e.children)}const l=r[r.length-1]
l&&(i||"element"!==l.type||"p"!==l.tagName)&&a.push({type:"text",value:"\n"})
const c={type:"element",tagName:"li",properties:o,children:a}
return e.patch(t,c),e.applyData(t,c)},list:function(e,t){const n={},r=e.all(t)
let i=-1
for("number"==typeof t.start&&1!==t.start&&(n.start=t.start);++i<r.length;){const e=r[i]
if("element"===e.type&&"li"===e.tagName&&e.properties&&Array.isArray(e.properties.className)&&e.properties.className.includes("task-list-item")){n.className=["contains-task-list"]
break}}const o={type:"element",tagName:t.ordered?"ol":"ul",properties:n,children:e.wrap(r,!0)}
return e.patch(t,o),e.applyData(t,o)},paragraph:function(e,t){const n={type:"element",tagName:"p",properties:{},children:e.all(t)}
return e.patch(t,n),e.applyData(t,n)},root:function(e,t){const n={type:"root",children:e.wrap(e.all(t))}
return e.patch(t,n),e.applyData(t,n)},strong:function(e,t){const n={type:"element",tagName:"strong",properties:{},children:e.all(t)}
return e.patch(t,n),e.applyData(t,n)},table:function(e,t){const n=e.all(t),r=n.shift(),i=[]
if(r){const n={type:"element",tagName:"thead",properties:{},children:e.wrap([r],!0)}
e.patch(t.children[0],n),i.push(n)}if(n.length>0){const r={type:"element",tagName:"tbody",properties:{},children:e.wrap(n,!0)},o=K(t.children[1]),a=Z(t.children[t.children.length-1])
o&&a&&(r.position={start:o,end:a}),i.push(r)}const o={type:"element",tagName:"table",properties:{},children:e.wrap(i,!0)}
return e.patch(t,o),e.applyData(t,o)},tableCell:function(e,t){const n={type:"element",tagName:"td",properties:{},children:e.all(t)}
return e.patch(t,n),e.applyData(t,n)},tableRow:function(e,t,n){const r=n?n.children:void 0,i=0===(r?r.indexOf(t):1)?"th":"td",o=n&&"table"===n.type?n.align:void 0,a=o?o.length:t.children.length
let s=-1
const l=[]
for(;++s<a;){const n=t.children[s],r={},a=o?o[s]:void 0
a&&(r.align=a)
let c={type:"element",tagName:i,properties:r,children:[]}
n&&(c.children=e.all(n),e.patch(n,c),c=e.applyData(n,c)),l.push(c)}const c={type:"element",tagName:"tr",properties:{},children:e.wrap(l,!0)}
return e.patch(t,c),e.applyData(t,c)},text:function(e,t){const n={type:"text",value:Fn(String(t.value))}
return e.patch(t,n),e.applyData(t,n)},thematicBreak:function(e,t){const n={type:"element",tagName:"hr",properties:{},children:[]}
return e.patch(t,n),e.applyData(t,n)},toml:Vn,yaml:Vn,definition:Vn,footnoteDefinition:Vn}
function Vn(){}const Un={}.hasOwnProperty,Gn={}
function Hn(e,t){e.position&&(t.position=function(e){const t=K(e),n=Z(e)
if(t&&n)return{start:t,end:n}}(e))}function qn(e,t){let n=t
if(e&&e.data){const t=e.data.hName,r=e.data.hChildren,i=e.data.hProperties
"string"==typeof t&&("element"===n.type?n.tagName=t:n={type:"element",tagName:t,properties:{},children:"children"in n?n.children:[n]}),"element"===n.type&&i&&Object.assign(n.properties,Tn(i)),"children"in n&&n.children&&null!=r&&(n.children=r)}return n}function Qn(e,t){const n=t.data||{},r=!("value"in t)||Un.call(n,"hProperties")||Un.call(n,"hChildren")?{type:"element",tagName:"div",properties:{},children:e.all(t)}:{type:"text",value:t.value}
return e.patch(t,r),e.applyData(t,r)}function $n(e,t){const n=[]
let r=-1
for(t&&n.push({type:"text",value:"\n"});++r<e.length;)r&&n.push({type:"text",value:"\n"}),n.push(e[r])
return t&&e.length>0&&n.push({type:"text",value:"\n"}),n}function Xn(e){let t=0,n=e.charCodeAt(t)
for(;9===n||32===n;)t++,n=e.charCodeAt(t)
return e.slice(t)}function Wn(e,t){const n=function(e,t){const n=t||Gn,r=new Map,i=new Map,o=new Map,a={...jn,...n.handlers},s={all:function(e){const t=[]
if("children"in e){const n=e.children
let r=-1
for(;++r<n.length;){const i=s.one(n[r],e)
if(i){if(r&&"break"===n[r-1].type&&(Array.isArray(i)||"text"!==i.type||(i.value=Xn(i.value)),!Array.isArray(i)&&"element"===i.type)){const e=i.children[0]
e&&"text"===e.type&&(e.value=Xn(e.value))}Array.isArray(i)?t.push(...i):t.push(i)}}}return t},applyData:qn,definitionById:r,footnoteById:i,footnoteCounts:o,footnoteOrder:[],handlers:a,one:function(e,t){const n=e.type,r=s.handlers[n]
if(Un.call(s.handlers,n)&&r)return r(s,e,t)
if(s.options.passThrough&&s.options.passThrough.includes(n)){if("children"in e){const{children:t,...n}=e,r=Tn(n)
return r.children=s.all(e),r}return Tn(e)}return(s.options.unknownHandler||Qn)(s,e,t)},options:n,patch:Hn,wrap:$n}
return On(e,function(e){if("definition"===e.type||"footnoteDefinition"===e.type){const t="definition"===e.type?r:i,n=String(e.identifier).toUpperCase()
t.has(n)||t.set(n,e)}}),s}(e,t),r=n.one(e,void 0),i=function(e){const t="string"==typeof e.options.clobberPrefix?e.options.clobberPrefix:"user-content-",n=e.options.footnoteBackContent||In,r=e.options.footnoteBackLabel||Pn,i=e.options.footnoteLabel||"Footnotes",o=e.options.footnoteLabelTagName||"h2",a=e.options.footnoteLabelProperties||{className:["sr-only"]},s=[]
let l=-1
for(;++l<e.footnoteOrder.length;){const i=e.footnoteById.get(e.footnoteOrder[l])
if(!i)continue
const o=e.all(i),a=String(i.identifier).toUpperCase(),c=An(a.toLowerCase())
let u=0
const d=[],p=e.footnoteCounts.get(a)
for(;void 0!==p&&++u<=p;){d.length>0&&d.push({type:"text",value:" "})
let e="string"==typeof n?n:n(l,u)
"string"==typeof e&&(e={type:"text",value:e}),d.push({type:"element",tagName:"a",properties:{href:"#"+t+"fnref-"+c+(u>1?"-"+u:""),dataFootnoteBackref:"",ariaLabel:"string"==typeof r?r:r(l,u),className:["data-footnote-backref"]},children:Array.isArray(e)?e:[e]})}const h=o[o.length-1]
if(h&&"element"===h.type&&"p"===h.tagName){const e=h.children[h.children.length-1]
e&&"text"===e.type?e.value+=" ":h.children.push({type:"text",value:" "}),h.children.push(...d)}else o.push(...d)
const f={type:"element",tagName:"li",properties:{id:t+"fn-"+c},children:e.wrap(o,!0)}
e.patch(i,f),s.push(f)}if(0!==s.length)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:o,properties:{...Tn(a),id:"footnote-label"},children:[{type:"text",value:i}]},{type:"text",value:"\n"},{type:"element",tagName:"ol",properties:{},children:e.wrap(s,!0)},{type:"text",value:"\n"}]}}(n),o=Array.isArray(r)?{type:"root",children:r}:r||{type:"root",children:[]}
return i&&o.children.push({type:"text",value:"\n"},i),o}function Yn(e,t){return e&&"run"in e?async function(n,r){const i=Wn(n,{file:r,...t})
await e.run(i,r)}:function(n,r){return Wn(n,{file:r,...e||t})}}function Zn(e){if(e)throw e}var Kn=n(58295)
function Jn(e){if("object"!=typeof e||null===e)return!1
const t=Object.getPrototypeOf(e)
return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)}const er=function(e,t){if(void 0!==t&&"string"!=typeof t)throw new TypeError('"ext" argument must be a string')
nr(e)
let n,r=0,i=-1,o=e.length
if(void 0===t||0===t.length||t.length>e.length){for(;o--;)if(47===e.codePointAt(o)){if(n){r=o+1
break}}else i<0&&(n=!0,i=o+1)
return i<0?"":e.slice(r,i)}if(t===e)return""
let a=-1,s=t.length-1
for(;o--;)if(47===e.codePointAt(o)){if(n){r=o+1
break}}else a<0&&(n=!0,a=o+1),s>-1&&(e.codePointAt(o)===t.codePointAt(s--)?s<0&&(i=o):(s=-1,i=a))
return r===i?i=a:i<0&&(i=e.length),e.slice(r,i)},tr=function(...e){let t,n=-1
for(;++n<e.length;)nr(e[n]),e[n]&&(t=void 0===t?e[n]:t+"/"+e[n])
return void 0===t?".":function(e){nr(e)
const t=47===e.codePointAt(0)
let n=function(e,t){let n,r,i="",o=0,a=-1,s=0,l=-1
for(;++l<=e.length;){if(l<e.length)n=e.codePointAt(l)
else{if(47===n)break
n=47}if(47===n){if(a===l-1||1===s);else if(a!==l-1&&2===s){if(i.length<2||2!==o||46!==i.codePointAt(i.length-1)||46!==i.codePointAt(i.length-2))if(i.length>2){if(r=i.lastIndexOf("/"),r!==i.length-1){r<0?(i="",o=0):(i=i.slice(0,r),o=i.length-1-i.lastIndexOf("/")),a=l,s=0
continue}}else if(i.length>0){i="",o=0,a=l,s=0
continue}t&&(i=i.length>0?i+"/..":"..",o=2)}else i.length>0?i+="/"+e.slice(a+1,l):i=e.slice(a+1,l),o=l-a-1
a=l,s=0}else 46===n&&s>-1?s++:s=-1}return i}(e,!t)
return 0!==n.length||t||(n="."),n.length>0&&47===e.codePointAt(e.length-1)&&(n+="/"),t?"/"+n:n}(t)}
function nr(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function rr(e){return Boolean(null!==e&&"object"==typeof e&&"href"in e&&e.href&&"protocol"in e&&e.protocol&&void 0===e.auth)}const ir=["history","path","basename","stem","extname","dirname"]
class or{constructor(e){let t
t=e?rr(e)?{path:e}:"string"==typeof e||function(e){return Boolean(e&&"object"==typeof e&&"byteLength"in e&&"byteOffset"in e)}(e)?{value:e}:e:{},this.cwd="cwd"in t?"":"/",this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored
let n,r=-1
for(;++r<ir.length;){const e=ir[r]
e in t&&void 0!==t[e]&&null!==t[e]&&(this[e]="history"===e?[...t[e]]:t[e])}for(n in t)ir.includes(n)||(this[n]=t[n])}get basename(){return"string"==typeof this.path?er(this.path):void 0}set basename(e){sr(e,"basename"),ar(e,"basename"),this.path=tr(this.dirname||"",e)}get dirname(){return"string"==typeof this.path?function(e){if(nr(e),0===e.length)return"."
let t,n=-1,r=e.length
for(;--r;)if(47===e.codePointAt(r)){if(t){n=r
break}}else t||(t=!0)
return n<0?47===e.codePointAt(0)?"/":".":1===n&&47===e.codePointAt(0)?"//":e.slice(0,n)}(this.path):void 0}set dirname(e){lr(this.basename,"dirname"),this.path=tr(e||"",this.basename)}get extname(){return"string"==typeof this.path?function(e){nr(e)
let t,n=e.length,r=-1,i=0,o=-1,a=0
for(;n--;){const s=e.codePointAt(n)
if(47!==s)r<0&&(t=!0,r=n+1),46===s?o<0?o=n:1!==a&&(a=1):o>-1&&(a=-1)
else if(t){i=n+1
break}}return o<0||r<0||0===a||1===a&&o===r-1&&o===i+1?"":e.slice(o,r)}(this.path):void 0}set extname(e){if(ar(e,"extname"),lr(this.dirname,"extname"),e){if(46!==e.codePointAt(0))throw new Error("`extname` must start with `.`")
if(e.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=tr(this.dirname,this.stem+(e||""))}get path(){return this.history[this.history.length-1]}set path(e){rr(e)&&(e=function(e){if("string"==typeof e)e=new URL(e)
else if(!rr(e)){const t=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+e+"`")
throw t.code="ERR_INVALID_ARG_TYPE",t}if("file:"!==e.protocol){const e=new TypeError("The URL must be of scheme file")
throw e.code="ERR_INVALID_URL_SCHEME",e}return function(e){if(""!==e.hostname){const e=new TypeError('File URL host must be "localhost" or empty on darwin')
throw e.code="ERR_INVALID_FILE_URL_HOST",e}const t=e.pathname
let n=-1
for(;++n<t.length;)if(37===t.codePointAt(n)&&50===t.codePointAt(n+1)){const e=t.codePointAt(n+2)
if(70===e||102===e){const e=new TypeError("File URL path must not include encoded / characters")
throw e.code="ERR_INVALID_FILE_URL_PATH",e}}return decodeURIComponent(t)}(e)}(e)),sr(e,"path"),this.path!==e&&this.history.push(e)}get stem(){return"string"==typeof this.path?er(this.path,this.extname):void 0}set stem(e){sr(e,"stem"),ar(e,"stem"),this.path=tr(this.dirname||"",e+(this.extname||""))}fail(e,t,n){const r=this.message(e,t,n)
throw r.fatal=!0,r}info(e,t,n){const r=this.message(e,t,n)
return r.fatal=void 0,r}message(e,t,n){const r=new ie(e,t,n)
return this.path&&(r.name=this.path+":"+r.name,r.file=this.path),r.fatal=!1,this.messages.push(r),r}toString(e){return void 0===this.value?"":"string"==typeof this.value?this.value:new TextDecoder(e||void 0).decode(this.value)}}function ar(e,t){if(e&&e.includes("/"))throw new Error("`"+t+"` cannot be a path: did not expect `/`")}function sr(e,t){if(!e)throw new Error("`"+t+"` cannot be empty")}function lr(e,t){if(!e)throw new Error("Setting `"+t+"` requires `path` to be set too")}const cr=function(e){const t=this.constructor.prototype,n=t[e],r=function(){return n.apply(r,arguments)}
return Object.setPrototypeOf(r,t),r},ur={}.hasOwnProperty
class dr extends cr{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=function(){const e=[],t={run:function(...t){let n=-1
const r=t.pop()
if("function"!=typeof r)throw new TypeError("Expected function as last argument, not "+r)
!function i(o,...a){const s=e[++n]
let l=-1
if(o)r(o)
else{for(;++l<t.length;)null!==a[l]&&void 0!==a[l]||(a[l]=t[l])
t=a,s?function(e,t){let n
return function(...t){const o=e.length>t.length
let a
o&&t.push(r)
try{a=e.apply(this,t)}catch(e){if(o&&n)throw e
return r(e)}o||(a&&a.then&&"function"==typeof a.then?a.then(i,r):a instanceof Error?r(a):i(a))}
function r(e,...r){n||(n=!0,t(e,...r))}function i(e){r(null,e)}}(s,i)(...a):r(null,...a)}}(null,...t)},use:function(n){if("function"!=typeof n)throw new TypeError("Expected `middelware` to be a function, not "+n)
return e.push(n),t}}
return t}()}copy(){const e=new dr
let t=-1
for(;++t<this.attachers.length;){const n=this.attachers[t]
e.use(...n)}return e.data(Kn(!0,{},this.namespace)),e}data(e,t){return"string"==typeof e?2===arguments.length?(mr("data",this.frozen),this.namespace[e]=t,this):ur.call(this.namespace,e)&&this.namespace[e]||void 0:e?(mr("data",this.frozen),this.namespace=e,this):this.namespace}freeze(){if(this.frozen)return this
const e=this
for(;++this.freezeIndex<this.attachers.length;){const[t,...n]=this.attachers[this.freezeIndex]
if(!1===n[0])continue
!0===n[0]&&(n[0]=void 0)
const r=t.call(e,...n)
"function"==typeof r&&this.transformers.use(r)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(e){this.freeze()
const t=vr(e),n=this.parser||this.Parser
return hr("parse",n),n(String(t),t)}process(e,t){const n=this
return this.freeze(),hr("process",this.parser||this.Parser),fr("process",this.compiler||this.Compiler),t?r(void 0,t):new Promise(r)
function r(r,i){const o=vr(e),a=n.parse(o)
function s(e,n){e||!n?i(e):r?r(n):t(void 0,n)}n.run(a,o,function(e,t,r){if(e||!t||!r)return s(e)
const i=t,o=n.stringify(i,r)
var a
"string"==typeof(a=o)||function(e){return Boolean(e&&"object"==typeof e&&"byteLength"in e&&"byteOffset"in e)}(a)?r.value=o:r.result=o,s(e,r)})}}processSync(e){let t,n=!1
return this.freeze(),hr("processSync",this.parser||this.Parser),fr("processSync",this.compiler||this.Compiler),this.process(e,function(e,r){n=!0,Zn(e),t=r}),yr("processSync","process",n),t}run(e,t,n){gr(e),this.freeze()
const r=this.transformers
return n||"function"!=typeof t||(n=t,t=void 0),n?i(void 0,n):new Promise(i)
function i(i,o){const a=vr(t)
r.run(e,a,function(t,r,a){const s=r||e
t?o(t):i?i(s):n(void 0,s,a)})}}runSync(e,t){let n,r=!1
return this.run(e,t,function(e,t){Zn(e),n=t,r=!0}),yr("runSync","run",r),n}stringify(e,t){this.freeze()
const n=vr(t),r=this.compiler||this.Compiler
return fr("stringify",r),gr(e),r(e,n)}use(e,...t){const n=this.attachers,r=this.namespace
if(mr("use",this.frozen),null==e);else if("function"==typeof e)s(e,t)
else{if("object"!=typeof e)throw new TypeError("Expected usable value, not `"+e+"`")
Array.isArray(e)?a(e):o(e)}return this
function i(e){if("function"==typeof e)s(e,[])
else{if("object"!=typeof e)throw new TypeError("Expected usable value, not `"+e+"`")
if(Array.isArray(e)){const[t,...n]=e
s(t,n)}else o(e)}}function o(e){if(!("plugins"in e)&&!("settings"in e))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither")
a(e.plugins),e.settings&&(r.settings=Kn(!0,r.settings,e.settings))}function a(e){let t=-1
if(null==e);else{if(!Array.isArray(e))throw new TypeError("Expected a list of plugins, not `"+e+"`")
for(;++t<e.length;)i(e[t])}}function s(e,t){let r=-1,i=-1
for(;++r<n.length;)if(n[r][0]===e){i=r
break}if(-1===i)n.push([e,...t])
else if(t.length>0){let[r,...o]=t
const a=n[i][1]
Jn(a)&&Jn(r)&&(r=Kn(!0,a,r)),n[i]=[e,r,...o]}}}}const pr=(new dr).freeze()
function hr(e,t){if("function"!=typeof t)throw new TypeError("Cannot `"+e+"` without `parser`")}function fr(e,t){if("function"!=typeof t)throw new TypeError("Cannot `"+e+"` without `compiler`")}function mr(e,t){if(t)throw new Error("Cannot call `"+e+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function gr(e){if(!Jn(e)||"string"!=typeof e.type)throw new TypeError("Expected node, got `"+e+"`")}function yr(e,t,n){if(!n)throw new Error("`"+e+"` finished async. Use `"+t+"` instead")}function vr(e){return function(e){return Boolean(e&&"object"==typeof e&&"message"in e&&"messages"in e)}(e)?e:new or(e)}const br=[],xr={allowDangerousHtml:!0},Sr=/^(https?|ircs?|mailto|xmpp)$/i,_r=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"className",id:"remove-classname"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}]
function Cr(e){const t=function(e){const t=e.rehypePlugins||br,n=e.remarkPlugins||br,r=e.remarkRehypeOptions?{...e.remarkRehypeOptions,...xr}:xr
return pr().use(gn).use(n).use(Yn,r).use(t)}(e),n=function(e){const t=e.children||"",n=new or
return"string"==typeof t&&(n.value=t),n}(e)
return function(e,t){const n=t.allowedElements,r=t.allowElement,i=t.components,o=t.disallowedElements,s=t.skipHtml,l=t.unwrapDisallowed,c=t.urlTransform||wr
for(const a of _r)Object.hasOwn(t,a.from)&&u((a.from,a.to&&a.to,a.id))
return On(e,function(e,t,i){if("raw"===e.type&&i&&"number"==typeof t)return s?i.children.splice(t,1):i.children[t]={type:"text",value:e.value},t
if("element"===e.type){let t
for(t in xe)if(Object.hasOwn(xe,t)&&Object.hasOwn(e.properties,t)){const n=e.properties[t],r=xe[t];(null===r||r.includes(e.tagName))&&(e.properties[t]=c(String(n||""),t,e))}}if("element"===e.type){let a=n?!n.includes(e.tagName):!!o&&o.includes(e.tagName)
if(!a&&r&&"number"==typeof t&&(a=!r(e,t,i)),a&&i&&"number"==typeof t)return l&&e.children?i.children.splice(t,1,...e.children):i.children.splice(t,1),t}}),function(e,t){if(!t||void 0===t.Fragment)throw new TypeError("Expected `Fragment` in options")
const n=t.filePath||void 0
let r
if(t.development){if("function"!=typeof t.jsxDEV)throw new TypeError("Expected `jsxDEV` in options when `development: true`")
r=function(e,t){return function(n,r,i,o){const a=Array.isArray(i.children),s=K(n)
return t(r,i,o,a,{columnNumber:s?s.column-1:void 0,fileName:e,lineNumber:s?s.line:void 0},void 0)}}(n,t.jsxDEV)}else{if("function"!=typeof t.jsx)throw new TypeError("Expected `jsx` in production options")
if("function"!=typeof t.jsxs)throw new TypeError("Expected `jsxs` in production options")
i=t.jsx,o=t.jsxs,r=function(e,t,n,r){const a=Array.isArray(n.children)?o:i
return r?a(t,n,r):a(t,n)}}var i,o
const a={Fragment:t.Fragment,ancestors:[],components:t.components||{},create:r,elementAttributeNameCase:t.elementAttributeNameCase||"react",evaluater:t.createEvaluater?t.createEvaluater():void 0,filePath:n,ignoreInvalidStyle:t.ignoreInvalidStyle||!1,passKeys:!1!==t.passKeys,passNode:t.passNode||!1,schema:"svg"===t.space?G:U,stylePropertyNameCase:t.stylePropertyNameCase||"dom",tableCellAlignToStyle:!1!==t.tableCellAlignToStyle},s=de(a,e,void 0)
return s&&"string"!=typeof s?s:a.create(e,a.Fragment,{children:s||void 0},void 0)}(e,{Fragment:a.Fragment,components:i,ignoreInvalidStyle:!0,jsx:a.jsx,jsxs:a.jsxs,passKeys:!0,passNode:!0})}(t.runSync(t.parse(n),n),e)}function wr(e){const t=e.indexOf(":"),n=e.indexOf("?"),r=e.indexOf("#"),i=e.indexOf("/")
return-1===t||-1!==i&&t>i||-1!==n&&t>n||-1!==r&&t>r||Sr.test(e.slice(0,t))?e:""}var Tr=n(21191),Ar=n(33241),Ir=n(15382),Pr=n(38981),Br=n(41288),Er=n(57331)
class kr extends l.dL{constructor(){super(...arguments),this.updateParams=e=>{this.plugin.managers.animation.updateParams({[e.name]:e.value})},this.updateCurrentParams=e=>{this.plugin.managers.animation.updateCurrentParams({[e.name]:e.value})},this.startOrStop=()=>{const e=this.plugin.managers.animation
"playing"===e.state.animationState?e.stop():(this.props.onStart&&this.props.onStart(),e.start())}}componentDidMount(){this.subscribe(this.plugin.managers.animation.events.updated,()=>this.forceUpdate())}render(){var e,t
const n=this.plugin.managers.animation
if(n.isEmpty)return null
const r="playing"===n.state.animationState,i=null===(t=(e=n.current.anim).canApply)||void 0===t?void 0:t.call(e,this.plugin)
return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Er.y1,{params:n.getParams(),values:n.state.params,onChange:this.updateParams,isDisabled:r}),(0,a.jsx)(Er.y1,{params:n.current.params,values:n.current.paramValues,onChange:this.updateCurrentParams,isDisabled:r}),(0,a.jsx)("div",{className:"msp-flex-row",children:(0,a.jsx)(Pr.$n,{icon:"playing"!==n.state.animationState?void 0:Br.M6,onClick:this.startOrStop,disabled:void 0!==i&&!1===i.canApply,children:"playing"===n.state.animationState?"Stop":void 0===i||i.canApply?"Start":i.reason||"Start"})})]})}}var Dr=n(58070),Mr=n(9726),Rr=n(88720),Or=n(48393),Lr=n(41041),Nr=n(99507),Fr=n(70292),zr=n(50709),jr=n(95538),Vr=n(92384),Ur=n(95921),Gr=n(72582),Hr=n(66187),qr=n(32117),Qr=n(91030),$r=n(43472),Xr=n(89)
const Wr="clipping-controls"
async function Yr(e,t,n,r,i){await async function(e,t,n){const r=e.state.data,i=r.build()
for(const o of t)for(const e of o.representations){const t=r.select($r.QX.Generators.ofTransformer(Ar.f.Representation.ClippingStructureRepresentation3DFromBundle,e.cell.transform.ref).withTag(Wr))
await n(i,e.cell,t[0])}return i.commit({doNotUpdateCurrent:!0})}(e,t,async(e,t,o)=>{if(i&&i.length>0&&!i.includes(t.params.values.type.name))return
const a=t.obj.data.sourceData,s=await r(a.root)
if(Xr.Loci.isEmpty(s)||(0,Xr.isEmptyLoci)(s))return
const l={bundle:Or.StructureElement.Bundle.fromLoci(s),groups:n}
if(o){const t=Zr([...o.params.values.layers,l],a)
e.to(o).update(Qr.l.toBundle(t))}else{const n=Zr([l],a)
e.to(t.transform.ref).apply(Ar.f.Representation.ClippingStructureRepresentation3DFromBundle,Qr.l.toBundle(n),{tags:Wr})}})}function Zr(e,t){const n=Qr.l.ofBundle(e,t.root),r=Qr.l.merge(n)
return Qr.l.filter(r,t)}var Kr=n(83842)
const Jr="transparency-controls"
async function ei(e,t,n,r,i){await async function(e,t,n){const r=e.state.data,i=r.build()
for(const o of t)for(const e of o.representations){const t=r.select($r.QX.Generators.ofTransformer(Ar.f.Representation.TransparencyStructureRepresentation3DFromBundle,e.cell.transform.ref).withTag(Jr))
await n(i,e.cell,t[0])}return i.commit({doNotUpdateCurrent:!0})}(e,t,async(e,t,o)=>{if(i&&i.length>0&&!i.includes(t.params.values.type.name))return
const a=t.obj.data.sourceData,s=await r(a.root)
if(Xr.Loci.isEmpty(s)||(0,Xr.isEmptyLoci)(s))return
const l={bundle:Or.StructureElement.Bundle.fromLoci(s),value:n}
if(o){const t=ti([...o.params.values.layers,l],a)
e.to(o).update(Kr.x.toBundle(t))}else{const n=ti([l],a)
e.to(t.transform.ref).apply(Ar.f.Representation.TransparencyStructureRepresentation3DFromBundle,Kr.x.toBundle(n),{tags:Jr})}})}function ti(e,t){const n=Kr.x.ofBundle(e,t.root),r=Kr.x.merge(n)
return Kr.x.filter(r,t)}var ni=n(47954),ri=n(45692),ii=n(13564)
const oi="substance-controls"
async function ai(e,t,n,r,i){await async function(e,t,n){const r=e.state.data,i=r.build()
for(const o of t)for(const e of o.representations){const t=r.select($r.QX.Generators.ofTransformer(Ar.f.Representation.SubstanceStructureRepresentation3DFromBundle,e.cell.transform.ref).withTag(oi))
await n(i,e.cell,t[0])}return i.commit({doNotUpdateCurrent:!0})}(e,t,async(e,t,o)=>{if(i&&i.length>0&&!i.includes(t.params.values.type.name))return
const a=t.obj.data.sourceData,s=await r(a.root)
if(Xr.Loci.isEmpty(s)||(0,Xr.isEmptyLoci)(s))return
const l={bundle:Or.StructureElement.Bundle.fromLoci(s),material:null!=n?n:(0,ii.i)(),clear:!n}
if(o){const t=si([...o.params.values.layers,l],a)
e.to(o).update(ri.l.toBundle(t))}else{const n=si([l],a)
e.to(t.transform.ref).apply(Ar.f.Representation.SubstanceStructureRepresentation3DFromBundle,ri.l.toBundle(n),{tags:oi})}})}function si(e,t){const n=ri.l.ofBundle(e,t.root),r=ri.l.merge(n)
return ri.l.filter(r,t)}var li=n(64299),ci=n(17515)
const ui="emissive-controls"
async function di(e,t,n,r,i){await async function(e,t,n){const r=e.state.data,i=r.build()
for(const o of t)for(const e of o.representations){const t=r.select($r.QX.Generators.ofTransformer(Ar.f.Representation.EmissiveStructureRepresentation3DFromBundle,e.cell.transform.ref).withTag(ui))
await n(i,e.cell,t[0])}return i.commit({doNotUpdateCurrent:!0})}(e,t,async(e,t,o)=>{if(i&&i.length>0&&!i.includes(t.params.values.type.name))return
const a=t.obj.data.sourceData,s=await r(a.root)
if(Xr.Loci.isEmpty(s)||(0,Xr.isEmptyLoci)(s))return
const l={bundle:Or.StructureElement.Bundle.fromLoci(s),value:n}
if(o){const t=pi([...o.params.values.layers,l],a)
e.to(o).update(ci.a.toBundle(t))}else{const n=pi([l],a)
e.to(t.transform.ref).apply(Ar.f.Representation.EmissiveStructureRepresentation3DFromBundle,ci.a.toBundle(n),{tags:ui})}})}function pi(e,t){const n=ci.a.ofBundle(e,t.root),r=ci.a.merge(n)
return ci.a.filter(r,t)}var hi=n(19231)
class fi extends Ur.e{get currentStructures(){return this.plugin.managers.structure.hierarchy.selection.structures}get pivotStructure(){return this.currentStructures[0]}_setSnapshotState(e){this.updateState({options:e}),this.events.optionsUpdated.next(void 0)}async setOptions(e){const t=e.interactions!==this.state.options.interactions
this.updateState({options:e}),this.events.optionsUpdated.next(void 0)
const n=this.dataState.build()
for(const r of this.currentStructures)for(const e of r.components)this.updateReprParams(n,e)
return this.plugin.dataTransaction(async()=>{await n.commit(),await this.plugin.state.updateBehavior(ni.StructureFocusRepresentation,t=>{t.ignoreHydrogens="all"!==e.hydrogens,t.ignoreHydrogensVariant="only-polar"===e.hydrogens?"non-polar":"all",t.ignoreLight=e.ignoreLight,t.material=e.materialStyle,t.clip=e.clipObjects,t.interior=e.interior}),t&&await this.updateInterationProps()})}updateReprParams(e,t){const{hydrogens:n,visualQuality:r,ignoreLight:i,materialStyle:o,clipObjects:a,interior:s}=this.state.options,l="all"!==n,c="only-polar"===n?"non-polar":"all"
for(const u of t.representations){if(u.cell.transform.transformer!==qr.StructureRepresentation3D)continue
const t=u.cell.transform.params
!!t.type.params.ignoreHydrogens===l&&t.type.params.ignoreHydrogensVariant===c&&t.type.params.quality===r&&t.type.params.ignoreLight===i&&ii.i.areEqual(t.type.params.material,o)&&Vr.t.areEqual(li.B.Params,t.type.params.clip,a)&&(0,hi.u_)(t.type.params.interior,s)||e.to(u.cell).update(e=>{e.type.params.ignoreHydrogens=l,e.type.params.ignoreHydrogensVariant=c,e.type.params.quality=r,e.type.params.ignoreLight=i,e.type.params.material=o,e.type.params.clip=a,e.type.params.interior=s})}}async updateInterationProps(){var e,t,n
for(const r of this.currentStructures){const i=Rr.r.getParams(null===(e=r.cell.obj)||void 0===e?void 0:e.data)
if(r.properties){const e=null===(t=r.properties.cell.transform.params)||void 0===t?void 0:t.properties[Rr.r.descriptor.name]
if(Vr.t.areEqual(i,e,this.state.options.interactions))continue
await this.dataState.build().to(r.properties.cell).update(e=>{e.properties[Rr.r.descriptor.name]=this.state.options.interactions}).commit()}else{const e=this.plugin.customStructureProperties.getParams(null===(n=r.cell.obj)||void 0===n?void 0:n.data),t=Vr.t.getDefaultValues(e)
if(Vr.t.areEqual(i,t.properties[Rr.r.descriptor.name],this.state.options.interactions))continue
t.properties[Rr.r.descriptor.name]=this.state.options.interactions,await this.plugin.builders.structure.insertStructureProperties(r.cell,t)}}}applyPreset(e,t,n){return this.plugin.dataTransaction(async()=>{for(const r of e){const e=await this.plugin.builders.structure.representation.applyPreset(r.cell,t,n)
await this.syncPreset(r,e)}},{canUndo:"Preset"})}syncPreset(e,t){if(!t||!t.components)return this.clearComponents([e])
const n=new Set
if((0,jr.IF)(t.components,e=>{e&&n.add(e.ref)}),t.representations&&(0,jr.IF)(t.representations,e=>{e&&n.add(e.ref)}),0===n.size)return this.clearComponents([e])
let r=!1
const i=this.dataState.build(),o=e=>{n.has(e.cell.transform.ref)||(r=!0,i.delete(e.cell))}
for(const a of e.components){o(a)
for(const e of a.representations)o(e)
if(a.genericRepresentations)for(const e of a.genericRepresentations)o(e)}if(e.genericRepresentations)for(const a of e.genericRepresentations)o(a)
return r?i.commit():void 0}clear(e){return this.clearComponents(e)}selectThis(e){var t
const n=this.plugin.managers.structure.selection
n.clear()
for(const r of e){const e=Or.Structure.toSubStructureElementLoci(r.structure.cell.obj.data,null===(t=r.cell.obj)||void 0===t?void 0:t.data)
n.fromLoci("set",e)}}canBeModified(e){return this.plugin.builders.structure.isComponentTransform(e.cell)}modifyByCurrentSelection(e,t){return this.plugin.runTask(Fr.Task.create("Modify Component",async n=>{const r=this.dataState.build()
for(const i of e){if(!this.canBeModified(i))continue
const e=this.plugin.managers.structure.selection.getStructure(i.structure.cell.obj.data)
e&&0!==e.elementCount&&this.modifyComponent(r,i,e,t)}await this.dataState.updateTree(r,{canUndo:"Modify Selection"}).runInContext(n)}))}toggleVisibility(e,t){if(0!==e.length)if(t){const n=e[0].representations.indexOf(t),r=!t.cell.state.isHidden
for(const t of e){const e=t.representations[n]
e&&(0,Nr.setSubtreeVisibility)(this.dataState,e.cell.transform.ref,r)}}else{const t=!e[0].cell.state.isHidden
for(const n of e)(0,Nr.setSubtreeVisibility)(this.dataState,n.cell.transform.ref,t)}}removeRepresentations(e,t){if(0===e.length)return
const n=[]
if(t){const r=e[0].representations.indexOf(t)
if(r<0)return
for(const t of e)t.representations[r]&&n.push(t.representations[r])}else for(const r of e)for(const e of r.representations)n.push(e)
return this.plugin.managers.structure.hierarchy.remove(n,!0)}updateRepresentations(e,t,n){if(0===e.length)return Promise.resolve()
const r=e[0].representations.indexOf(t)
if(r<0)return Promise.resolve()
const i=this.dataState.build()
for(const o of e){const e=o.representations[r]
e&&e.cell.transform.transformer===t.cell.transform.transformer&&i.to(e.cell).update(n)}return i.commit({canUndo:"Update Representation"})}updateRepresentationsTheme(e,t){var n,r,i,o
if(0===e.length)return
const a=this.dataState.build()
for(const s of e)for(const e of s.representations){const l=e.cell.transform.params,c="function"==typeof t?t(s,e):t,u="default"===c.color?(0,Dr.IZ)(this.plugin,null===(n=s.structure.cell.obj)||void 0===n?void 0:n.data,null==l?void 0:l.type.name):c.color?(0,Dr.IZ)(this.plugin,null===(r=s.structure.cell.obj)||void 0===r?void 0:r.data,null==l?void 0:l.type.name,c.color,c.colorParams):void 0,d="default"===c.size?(0,Dr.eD)(this.plugin,null===(i=s.structure.cell.obj)||void 0===i?void 0:i.data,null==l?void 0:l.type.name):c.color?(0,Dr.eD)(this.plugin,null===(o=s.structure.cell.obj)||void 0===o?void 0:o.data,null==l?void 0:l.type.name,c.size,c.sizeParams):void 0;(u||d)&&a.to(e.cell).update(e=>{u&&(e.colorTheme=u),d&&(e.sizeTheme=d)})}return a.commit({canUndo:"Update Theme"})}addRepresentation(e,t){if(0===e.length)return
const{hydrogens:n,visualQuality:r,ignoreLight:i,materialStyle:o,clipObjects:a,interior:s}=this.state.options,l={ignoreHydrogens:"all"!==n,ignoreHydrogensVariant:"only-polar"===n?"non-polar":"all",quality:r,ignoreLight:i,material:o,clip:a,interior:s}
return this.plugin.dataTransaction(async()=>{for(const n of e)await this.plugin.builders.structure.representation.addRepresentation(n.cell,{type:this.plugin.representation.structure.registry.get(t),typeParams:l})},{canUndo:"Add Representation"})}tryFindComponent(e,t){if(0!==e.components.length)return this.plugin.runTask(Fr.Task.create("Find Component",async n=>{var r,i
const o=null===(r=e.cell.obj)||void 0===r?void 0:r.data
if(!o)return
const a=Or.StructureSelection.unionStructure(await t.getSelection(this.plugin,n,o))
for(const t of e.components){const e=null===(i=t.cell.obj)||void 0===i?void 0:i.data
if(e&&t.cell.parent&&(0,Lr.structureAreEqual)(a,e))return t.cell}}))}async add(e,t){return this.plugin.dataTransaction(async()=>{const n=t||this.currentStructures
if(0===n.length)return
const{hydrogens:r,visualQuality:i,ignoreLight:o,materialStyle:a,clipObjects:l,interior:c}=this.state.options,u={ignoreHydrogens:"all"!==r,ignoreHydrogensVariant:"only-polar"===r?"non-polar":"all",quality:i,ignoreLight:o,material:a,clip:l,interior:c},d=s.kk.create22()
for(const t of n){let n
e.options.checkExisting&&(n=await this.tryFindComponent(t,e.selection)),n||(n=await this.plugin.builders.structure.tryCreateComponentFromSelection(t.cell,e.selection,d,{label:e.options.label||(e.selection===Hr.StructureSelectionQueries.current?"Custom Selection":"")})),"none"!==e.representation&&n&&await this.plugin.builders.structure.representation.addRepresentation(n,{type:this.plugin.representation.structure.registry.get(e.representation),typeParams:u})}},{canUndo:"Add Selection"})}async applyTheme(e,t){return this.plugin.dataTransaction(async n=>{const r=t||this.currentStructures
if(0===r.length)return
const i=async t=>Or.StructureSelection.toLociWithSourceUnits(await e.selection.getSelection(this.plugin,n,t))
for(const t of r)if("color"===e.action.name){const n=e.action.params
await(0,Gr.setStructureOverpaint)(this.plugin,t.components,n.color,i,e.representations)}else if("resetColor"===e.action.name)await(0,Gr.setStructureOverpaint)(this.plugin,t.components,-1,i,e.representations)
else if("transparency"===e.action.name){const n=e.action.params
await ei(this.plugin,t.components,n.value,i,e.representations)}else if("emissive"===e.action.name){const n=e.action.params
await di(this.plugin,t.components,n.value,i,e.representations)}else if("material"===e.action.name){const n=e.action.params
await ai(this.plugin,t.components,n.material,i,e.representations)}else if("resetMaterial"===e.action.name)await ai(this.plugin,t.components,void 0,i,e.representations)
else if("clipping"===e.action.name){const n=e.action.params
await Yr(this.plugin,t.components,Qr.l.Groups.fromNames(n.excludeGroups),i,e.representations)}},{canUndo:"Apply Theme"})}modifyComponent(e,t,n,r){var i,o,a
const s=null===(i=t.cell.obj)||void 0===i?void 0:i.data
if(!s)return
if(("subtract"===r||"intersect"===r)&&!(0,Lr.structureAreIntersecting)(s,n))return
const l=null===(o=t.structure.cell.obj)||void 0===o?void 0:o.data,c="union"===r?(0,Lr.structureUnion)(l,[s,n]):"intersect"===r?(0,Lr.structureIntersect)(s,n):(0,Lr.structureSubtract)(s,n)
if(0===c.elementCount)e.delete(t.cell.transform.ref)
else{const n={type:{name:"bundle",params:Or.StructureElement.Bundle.fromSubStructure(l,c)},nullIfEmpty:!0,label:null===(a=t.cell.obj)||void 0===a?void 0:a.label}
e.to(t.cell).update(n)}}updateLabel(e,t){var n,r
const i={type:null===(n=e.cell.params)||void 0===n?void 0:n.values.type,nullIfEmpty:null===(r=e.cell.params)||void 0===r?void 0:r.values.nullIfEmpty,label:t}
this.dataState.build().to(e.cell).update(i).commit()}get dataState(){return this.plugin.state.data}clearComponents(e){const t=this.dataState.build()
for(const n of e)for(const e of n.components)t.delete(e.cell.transform.ref)
return t.commit({canUndo:"Clear Selections"})}constructor(e){super({options:Vr.t.getDefaultValues(fi.OptionsParams)}),this.plugin=e,this.events={optionsUpdated:this.ev()}}}!function(e){function t(e,t){var n,r
return(null===(n=null==t?void 0:t.cell.obj)||void 0===n?void 0:n.data)?e.representation.structure.registry.getApplicableTypes(null===(r=t.cell.obj)||void 0===r?void 0:r.data):e.representation.structure.registry.types}function n(e,n,r,i){const o=[...r,...t(e,n)]
return Vr.t.Select(o[0][0],o,{label:i})}e.OptionsParams={hydrogens:Vr.t.Select("all",[["all","Show All"],["hide-all","Hide All"],["only-polar","Only Polar"]],{description:"Determine display of hydrogen atoms in representations"}),visualQuality:Vr.t.Select("auto",Mr.sF,{description:"Control the visual/rendering quality of representations"}),ignoreLight:Vr.t.Boolean(!1,{description:"Ignore light for stylized rendering of representations"}),materialStyle:ii.i.getParam(),clipObjects:Vr.t.Group(li.B.Params),interactions:Vr.t.Group(Rr.r.defaultParams,{label:"Non-covalent Interactions"}),interior:(0,hi.ag)()},e.getAddParams=function(e,t){const{options:r}=e.query.structure.registry
return t={pivot:e.managers.structure.component.pivotStructure,allowNone:!0,hideSelection:!1,checkExisting:!1,...t},{selection:Vr.t.Select(r[1][0],r,{isHidden:null==t?void 0:t.hideSelection}),representation:n(e,null==t?void 0:t.pivot,(null==t?void 0:t.allowNone)?[["none","< Create Later >"]]:[]),options:Vr.t.Group({label:Vr.t.Text(""),checkExisting:Vr.t.Boolean(!!(null==t?void 0:t.checkExisting),{help:()=>({description:"Checks if a selection with the specifield elements already exists to avoid creating duplicate components."})})})}},e.getThemeParams=function(e,n){const{options:r}=e.query.structure.registry
return{selection:Vr.t.Select(r[1][0],r,{isHidden:!1}),action:Vr.t.MappedStatic("color",{color:Vr.t.Group({color:Vr.t.Color(zr.ColorNames.blue,{isExpanded:!0})},{isFlat:!0}),resetColor:Vr.t.EmptyGroup({label:"Reset Color"}),transparency:Vr.t.Group({value:Vr.t.Numeric(.5,{min:0,max:1,step:.01})},{isFlat:!0}),emissive:Vr.t.Group({value:Vr.t.Numeric(.5,{min:0,max:1,step:.01})},{isFlat:!0}),material:Vr.t.Group({material:ii.i.getParam({isFlat:!0})},{isFlat:!0}),resetMaterial:Vr.t.EmptyGroup({label:"Reset Material"}),clipping:Vr.t.Group({excludeGroups:Vr.t.MultiSelect([],Vr.t.objectToOptions(Qr.l.Groups.Names))},{isFlat:!0})}),representations:Vr.t.MultiSelect([],t(e,n),{emptyValue:"All"})}},e.getRepresentationTypes=t}(fi||(fi={}))
var mi=n(42261),gi=n(39298),yi=n(94528)
function vi(){return{trajectories:[],models:[],structures:[],refs:new Map}}function bi(e){return{kind:"trajectory",cell:e,version:e.transform.version,models:[]}}function xi(e,t){return{kind:"model",cell:e,version:e.transform.version,trajectory:t,structures:[]}}function Si(e,t){return{kind:"model-properties",cell:e,version:e.transform.version,model:t}}function _i(e,t){return{kind:"model-unitcell",cell:e,version:e.transform.version,model:t}}function Ci(e,t){return{kind:"structure",cell:e,version:e.transform.version,model:t,components:[]}}function wi(e,t){return{kind:"structure-properties",cell:e,version:e.transform.version,structure:t}}function Ti(e,t){return{kind:"structure-transform",cell:e,version:e.transform.version,structure:t}}function Ai(e,t){return{kind:"structure-volume-streaming",cell:e,version:e.transform.version,structure:t}}function Ii(e){return e.transform.tags?[...e.transform.tags].sort().join():e.transform.ref}function Pi(e,t){return{kind:"structure-component",cell:e,version:e.transform.version,structure:t,key:Ii(e),representations:[]}}function Bi(e,t){return{kind:"structure-representation",cell:e,version:e.transform.version,component:t}}function Ei(e,t){return{kind:"generic-representation",cell:e,version:e.transform.version,parent:t}}function ki(e,t,n,r,...i){const o=r(...i)
n.push(o),e.hierarchy.refs.set(t.transform.ref,o)
const a=e.oldHierarchy.refs.get(t.transform.ref)
return a?a.version!==t.transform.version&&(e.changed=!0):(e.added.add(o.cell.transform.ref),e.changed=!0),o}function Di(e,t,n,...r){const i=n(...r)
e.hierarchy.refs.set(t.transform.ref,i)
const o=e.oldHierarchy.refs.get(t.transform.ref)
return o?o.version!==t.transform.version&&(e.changed=!0):(e.added.add(i.cell.transform.ref),e.changed=!0),i}function Mi(e){return t=>e.is(t.obj)}function Ri(e,t){return(n,r)=>!t(r)&&e.is(n.obj)}function Oi(e){return t=>t.transform.transformer===e}function Li(){}const Ni=[[Mi(gi.O.Molecule.Trajectory),(e,t)=>{e.currentTrajectory=ki(e,t,e.hierarchy.trajectories,bi,t)},e=>e.currentTrajectory=void 0],[Ri(gi.O.Molecule.Model,e=>e.currentModel),(e,t)=>{e.currentTrajectory?e.currentModel=ki(e,t,e.currentTrajectory.models,xi,t,e.currentTrajectory):e.currentModel=Di(e,t,xi,t),e.hierarchy.models.push(e.currentModel)},e=>e.currentModel=void 0],[Oi(Ar.f.Model.CustomModelProperties),(e,t)=>{if(!e.currentModel)return!1
e.currentModel.properties=Di(e,t,Si,t,e.currentModel)},Li],[Oi(Ar.f.Representation.ModelUnitcell3D),(e,t)=>{if(!e.currentModel)return!1
e.currentModel.unitcell=Di(e,t,_i,t,e.currentModel)},Li],[Ri(gi.O.Molecule.Structure,e=>e.currentStructure),(e,t)=>{e.currentModel?e.currentStructure=ki(e,t,e.currentModel.structures,Ci,t,e.currentModel):e.currentStructure=Di(e,t,Ci,t),e.hierarchy.structures.push(e.currentStructure)},e=>e.currentStructure=void 0],[Oi(Ar.f.Model.CustomStructureProperties),(e,t)=>{if(!e.currentStructure)return!1
e.currentStructure.properties=Di(e,t,wi,t,e.currentStructure)},Li],[Oi(Ar.f.Model.TransformStructureConformation),(e,t)=>{if(!e.currentStructure)return!1
e.currentStructure.transform=Di(e,t,Ti,t,e.currentStructure)},Li],[Mi(yi.h),(e,t)=>!!e.currentStructure&&(e.currentStructure.volumeStreaming=Di(e,t,Ai,t,e.currentStructure),!1),Li],[(e,t)=>!(!t.currentStructure||e.transform.transformer.definition.isDecorator)&&gi.O.Molecule.Structure.is(e.obj),(e,t)=>{e.currentStructure&&(e.currentComponent&&(e.parentComponents||(e.parentComponents=[]),e.parentComponents.push(e.currentComponent)),e.currentComponent=ki(e,t,e.currentStructure.components,Pi,t,e.currentStructure))},e=>{e.parentComponents&&e.parentComponents.length>0?e.currentComponent=e.parentComponents.pop():e.currentComponent=void 0}],[(e,t)=>!e.state.isGhost&&!!t.currentComponent&&gi.O.Molecule.Structure.Representation3D.is(e.obj),(e,t)=>(e.currentComponent&&ki(e,t,e.currentComponent.representations,Bi,t,e.currentComponent),!1),Li],[e=>!e.state.isGhost&&gi.O.isRepresentation3D(e.obj),(e,t)=>{const n=e.currentComponent||e.currentStructure||e.currentModel
n&&(n.genericRepresentations||(n.genericRepresentations=[]),ki(e,t,n.genericRepresentations,Ei,t,n))},Li]]
function Fi(e){if(!e||!(null==e?void 0:e.parent)||!e.parent.cells.has(e.transform.ref))return!1
const{obj:t}=e
return!(!t||t===$r.BM.Null||"ok"!==e.status&&"error"!==e.status)}function zi(e){const{cell:t}=e
Fi(t)||(this.changed=!0)}function ji(e){Vi(this,this.tree.transforms.get(e))}function Vi(e,t){const{state:n}=e,r=n.state.cells.get(t.ref)
if(!Fi(r))return
let i,o=!1
for(const[s,l,c]of Ni)if(s(r,n)){if(!1===l(n,r)){o=!0
break}i=c
break}if(o)return
const a=e.tree.children.get(t.ref)
a&&a.size&&a.forEach(ji,e),i&&i(n)}class Ui extends Ur.N{get dataState(){return this.plugin.state.data}get currentComponentGroups(){return this._currentComponentGroups||(this._currentComponentGroups=Ui.getComponentGroups(this.selection.structures)),this._currentComponentGroups}get seletionSet(){if(this._currentSelectionSet)return this._currentSelectionSet
this._currentSelectionSet=new Set
for(const e of this.selection.trajectories)this._currentSelectionSet.add(e.cell.transform.ref)
for(const e of this.selection.models)this._currentSelectionSet.add(e.cell.transform.ref)
for(const e of this.selection.structures)this._currentSelectionSet.add(e.cell.transform.ref)
return this._currentSelectionSet}get current(){return this.sync(!1),this.state.hierarchy}get selection(){return this.sync(!1),this.state.selection}getStructuresWithSelection(){const e=this.plugin.managers.structure.hierarchy.current.structures,t=[]
for(const n of e)this.plugin.managers.structure.selection.structureHasSelection(n)&&t.push(n)
return t}findStructure(e){if(!e)return
const t=this.plugin.helpers.substructureParent.get(e)
if(!t)return
const n=this.plugin.state.data.selectQ(e=>e.byValue(t).rootOfType(gi.O.Molecule.Structure))[0]
return n?this.behaviors.selection.value.structures.find(e=>e.cell===n):void 0}syncCurrent(e,t){const n=this.seletionSet,r=[]
for(const i of e){const e=i.cell.transform.ref;(n.has(e)||t.has(e))&&r.push(i)}return 0===r.length?e.length>0?[e[0]]:[]:r}sync(e){if(!e&&this.dataState.inUpdate)return
if(this.state.syncedTree===this.dataState.tree)return void(e&&!this.state.notified&&(this.state.notified=!0,this.behaviors.selection.next({hierarchy:this.state.hierarchy,...this.state.selection})))
this.state.syncedTree=this.dataState.tree
const t=function(e,t){const n=function(e,t){return{state:e,oldHierarchy:t,hierarchy:vi(),changed:!1,added:new Set}}(e,t||vi())
return function(e,t){Vi({tree:e,state:t},e.root)}(e.tree,n),t&&t.refs.forEach(zi,n),{hierarchy:n.hierarchy,added:n.added,changed:n.changed}}(this.plugin.state.data,this.current)
if(!t.changed)return
const{hierarchy:n}=t,r=this.syncCurrent(n.trajectories,t.added),i=this.syncCurrent(n.models,t.added),o=this.syncCurrent(n.structures,t.added)
this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.state.hierarchy=n,this.state.selection.trajectories=r,this.state.selection.models=i,this.state.selection.structures=o,e?(this.state.notified=!0,this.behaviors.selection.next({hierarchy:n,trajectories:r,models:i,structures:o})):this.state.notified=!1}updateCurrent(e,t){const n=this.current,r="add"===t?mi.M.union(this.seletionSet,new Set(e.map(e=>e.cell.transform.ref))):mi.M.difference(this.seletionSet,new Set(e.map(e=>e.cell.transform.ref))),i=[],o=[],a=[]
for(const s of n.trajectories)r.has(s.cell.transform.ref)&&i.push(s)
for(const s of n.models)r.has(s.cell.transform.ref)&&o.push(s)
for(const s of n.structures)r.has(s.cell.transform.ref)&&a.push(s)
this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.state.selection.trajectories=i,this.state.selection.models=o,this.state.selection.structures=a,this.behaviors.selection.next({hierarchy:n,trajectories:i,models:o,structures:a})}remove(e,t){if(0===e.length)return
const n=this.plugin.state.data.build()
for(const r of e)n.delete("string"==typeof r?r:r.cell.transform.ref)
return n.commit({canUndo:!!t&&"Remove"})}toggleVisibility(e,t){if(0===e.length)return
const n=void 0!==t?"show"!==t:!e[0].cell.state.isHidden
for(const r of e)(0,Nr.setSubtreeVisibility)(this.dataState,r.cell.transform.ref,n)}applyPreset(e,t,n){return this.plugin.dataTransaction(async()=>{for(const r of e)r.models.length>0&&await this.clearTrajectory(r),await this.plugin.builders.structure.hierarchy.applyPreset(r.cell,t,n)})}async updateStructure(e,t){await this.plugin.dataTransaction(async()=>{const n=$r.uF.getDecoratorRoot(this.dataState.tree,e.cell.transform.ref),r=this.dataState.tree.children.get(n).toArray()
await this.remove(r,!1),await this.plugin.state.updateTransform(this.plugin.state.data,e.cell.transform.ref,t,"Structure Type"),await this.plugin.builders.structure.representation.applyPreset(e.cell.transform.ref,"auto")},{canUndo:"Structure Type"}),Ir.PluginCommands.Camera.Reset(this.plugin)}clearTrajectory(e){const t=this.dataState.build()
for(const n of e.models)t.delete(n.cell)
return t.commit()}constructor(e){super(),this.plugin=e,this.state={syncedTree:this.dataState.tree,notified:!1,hierarchy:vi(),selection:{trajectories:[],models:[],structures:[]}},this.behaviors={selection:this.ev.behavior({hierarchy:this.current,trajectories:this.selection.trajectories,models:this.selection.models,structures:this.selection.structures})},this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.subscribe(e.state.data.events.changed,t=>{t.inTransaction||e.behaviors.state.isAnimating.value||this.sync(!0)}),this.subscribe(e.behaviors.state.isAnimating,t=>{t||e.behaviors.state.isUpdating.value||this.sync(!0)})}}!function(e){e.getComponentGroups=function(e){if(!e.length)return[]
if(1===e.length)return e[0].components.map(e=>[e])
const t=[],n=new Map
for(const r of e)for(const e of r.components){const r=e.key
if(!r)continue
let i=n.get(r)
i||(i=[],n.set(r,i),t.push(i)),i.push(e)}return t},e.getSelectedStructuresDescription=function(e){var t,n,r,i,o,a,s,l,c
const{structures:u}=e.managers.structure.hierarchy.selection
if(0===u.length)return""
if(1===u.length){const e=u[0],s=null===(t=e.cell.obj)||void 0===t?void 0:t.data
if(!s)return(null===(n=e.cell.obj)||void 0===n?void 0:n.label)||"Structure"
const l=s.models[0]||s.representativeModel||s.masterModel
if(!l)return(null===(r=e.cell.obj)||void 0===r?void 0:r.label)||"Structure"
const c=l.entryId
return(null===(o=null===(i=e.model)||void 0===i?void 0:i.trajectory)||void 0===o?void 0:o.models)&&1===e.model.trajectory.models.length?c:e.model?`${null===(a=e.model.cell.obj)||void 0===a?void 0:a.label} | ${c}`:c}const d=u[0],p=null===(s=null==d?void 0:d.model)||void 0===s?void 0:s.trajectory
let h=!0
for(const f of u)if((null===(l=null==f?void 0:f.model)||void 0===l?void 0:l.trajectory)!==p){h=!1
break}return h&&p?`${null===(c=p.cell.obj)||void 0===c?void 0:c.label} | ${u.length} structures`:`${u.length} structures`}}(Ui||(Ui={}))
var Gi=n(95408),Hi=n(28269),qi=n(15376),Qi=n(71872)
function $i(e){return(0,Qi.p)(function(t,n){return e<=n})}class Xi extends l.jB{constructor(){super(...arguments),this.onChange=({name:e,value:t})=>{const n={...this.props.params,[e]:t}
this.props.events.onChange(n,this.areInitial(n),this.validate(n))}}validate(e){}areInitial(e){return Vr.t.areEqual(this.props.info.params,e,this.props.info.initialValues)}render(){return(0,a.jsx)(Er.y1,{params:this.props.info.params,values:this.props.params,onChange:this.onChange,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled})}}!function(e){function t(e){const t=Object.keys(e)
for(const n of t)if(!e[n].isHidden)return!1
return!0}e.infoFromAction=function(e,n,r,i){const o=n.cells.get(i).obj,a=r.definition.params?r.definition.params(o,e):{}
return{initialValues:Vr.t.getDefaultValues(a),params:a,isEmpty:t(a)}},e.infoFromTransform=function(e,n,r){const i=n.cells.get(r.ref),o=i.params&&i.params.definition||{}
return{initialValues:i.params&&i.params.values||{},params:o,isEmpty:t(o)}}}(Xi||(Xi={}))
class Wi extends l.jB{constructor(){super(...arguments),this.busy=new qi.t(!1),this.onEnter=()=>{this.state.error||this.apply()},this.autoApplyHandle=void 0,this.events={onEnter:this.onEnter,onChange:(e,t,n)=>{this.clearAutoApply(),this.setState({params:e,isInitial:t,error:n&&n[0]},()=>{t||this.state.error||!this.canAutoApply(e)||(this.clearAutoApply(),this.autoApplyHandle=setTimeout(this.apply,50))})}},this.apply=async()=>{var e,t
this.clearAutoApply(),this.setState({busy:!0})
try{await this.applyAction()}catch(e){console.error(e)}finally{null===(t=(e=this.props).onApply)||void 0===t||t.call(e),this.busy.next(!1)}},this.refresh=()=>{this.setState({params:this.getInfo().initialValues,isInitial:!0,error:void 0})},this.setDefault=()=>{const e=this.getInfo(),t=Vr.t.getDefaultValues(e.params)
this.setState({params:t,isInitial:Vr.t.areEqual(e.params,t,e.initialValues),error:void 0})},this.toggleExpanded=()=>{this.setState({isCollapsed:!this.state.isCollapsed})}}clearAutoApply(){void 0!==this.autoApplyHandle&&(clearTimeout(this.autoApplyHandle),this.autoApplyHandle=void 0)}componentDidMount(){this.subscribe(this.plugin.behaviors.state.isBusy,e=>{this.busy.value!==e&&this.busy.next(e)}),this.subscribe(this.busy.pipe($i(1)),e=>{this.setState({busy:e})})}renderApply(){const e=this.canApply()
return!this.props.autoHideApply||e&&!this.canAutoApply(this.state.params)?(0,a.jsxs)("div",{className:"msp-transform-apply-wrap",children:[(0,a.jsx)(Pr.K0,{svg:Br.ij,className:"msp-transform-default-params",onClick:this.setDefault,disabled:this.state.busy,title:"Set default params"}),(0,a.jsx)("div",{className:"msp-transform-apply-wider",children:(0,a.jsx)(Pr.$n,{icon:e?Br.Xq:void 0,className:"msp-btn-commit msp-btn-commit-"+(e?"on":"off"),onClick:this.apply,disabled:!e,children:this.props.applyLabel||this.applyText()})})]}):null}renderDefault(){const e=this.getInfo(),t=e.isEmpty&&this.isUpdate(),n=this.getHeader(),r=this.getTransformerId(),i=this.plugin.customParamEditors.has(r)?this.plugin.customParamEditors.get(r):Xi,o=this.state.isCollapsed?"msp-transform-wrapper msp-transform-wrapper-collapsed":"msp-transform-wrapper"
let s=null
if(!t&&!this.state.isCollapsed){const{a:t,b:n,bCell:r}=this.getSourceAndTarget(),o=this.renderApply()
s=(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i,{info:e,a:t,b:n,bCell:r,events:this.events,params:this.state.params,isDisabled:this.state.busy}),o]})}const l=(0,a.jsxs)("div",{className:o,style:{marginBottom:this.props.noMargin?0:void 0},children:["none"!==n&&!this.props.wrapInExpander&&(0,a.jsx)("div",{className:"msp-transform-header",children:(0,a.jsxs)(Pr.$n,{onClick:this.toggleExpanded,title:n.description,children:[!t&&(0,a.jsx)(Br.In,{svg:this.state.isCollapsed?Br.Cp:Br.DM}),n.name]})}),s]})
return t||!this.props.wrapInExpander?l:(0,a.jsx)(Pr.Yj,{header:this.isUpdate()?`Update ${"none"===n?"":n.name}`:`Apply ${"none"===n?"":n.name}`,headerLeftMargin:this.props.expanderHeaderLeftMargin,children:l})}renderSimple(){var e,t,n
const r=this.getInfo(),i=this.canApply(),o=(0,a.jsxs)("div",{className:"msp-flex-row",children:[(0,a.jsx)(Pr.$n,{icon:null===(e=this.props.simpleApply)||void 0===e?void 0:e.icon,title:null===(t=this.props.simpleApply)||void 0===t?void 0:t.title,disabled:this.state.busy||!i,onClick:this.apply,className:"msp-btn-apply-simple",children:null===(n=this.props.simpleApply)||void 0===n?void 0:n.header}),!r.isEmpty&&(0,a.jsx)(Pr.ff,{icon:Br.Hk,label:"",title:"Options",toggle:this.toggleExpanded,isSelected:!this.state.isCollapsed,disabled:this.state.busy,style:{flex:"0 0 40px",padding:0}})]})
if(this.state.isCollapsed)return o
const s=this.getTransformerId(),l=this.plugin.customParamEditors.has(s)?this.plugin.customParamEditors.get(s):Xi,{a:c,b:u,bCell:d}=this.getSourceAndTarget()
return(0,a.jsxs)(a.Fragment,{children:[o,(0,a.jsx)(l,{info:r,a:c,b:u,bCell:d,events:this.events,params:this.state.params,isDisabled:this.state.busy})]})}render(){return this.props.simpleApply?this.renderSimple():this.renderDefault()}}class Yi extends Wi{constructor(){super(...arguments),this._getInfo=(0,Hi._)(e=>Xi.infoFromTransform(this.plugin,this.props.state,e)),this.state={error:void 0,isInitial:!0,params:this.getInfo().initialValues,busy:!1,isCollapsed:this.props.initiallyCollapsed}}applyAction(){return this.props.customUpdate?this.props.customUpdate(this.state.params):this.plugin.state.updateTransform(this.props.state,this.props.transform.ref,this.state.params)}getInfo(){return this._getInfo(this.props.transform)}getTransformerId(){return this.props.transform.transformer.id}getHeader(){return this.props.customHeader||this.props.transform.transformer.definition.display}canApply(){const{state:e}=this.props,t=e.cells.get(this.props.transform.ref)
if(!t)return!1
if("error"===t.status){const t=e.cells.get(this.props.transform.parent)
return!!t&&"ok"===t.status}return!this.state.error&&!this.state.busy&&!this.state.isInitial}applyText(){return this.canApply()?"Update":"Nothing to Update"}isUpdate(){return!0}getSourceAndTarget(){const e=this.props.state.cells.get(this.props.transform.ref)
return{a:this.props.state.cells.get(this.props.transform.parent).obj,b:null==e?void 0:e.obj,bCell:e}}canAutoApply(e){const t=this.props.transform.transformer.definition.canAutoUpdate
if(!t)return!1
const{state:n}=this.props,r=n.cells.get(this.props.transform.ref)
return!(!r||!r.sourceRef||"ok"!==r.status)&&t({a:n.cells.get(r.sourceRef).obj,b:r.obj,oldParams:this.getInfo().initialValues,newParams:e},this.plugin)}componentDidMount(){super.componentDidMount(),this.props.toggleCollapsed&&this.subscribe(this.props.toggleCollapsed,()=>this.setState({isCollapsed:!this.state.isCollapsed})),this.subscribe(this.plugin.state.events.object.updated,({ref:e,state:t})=>{this.props.transform.ref===e&&this.props.state===t&&this.state.params!==this.props.transform.params&&(this._getInfo=(0,Hi._)(e=>Xi.infoFromTransform(this.plugin,this.props.state,e)),this.setState({params:this.props.transform.params,isInitial:!0}))})}componentDidUpdate(e){var t
if(this.props.transform!==e.transform){const e=this.props.state.cells.get(this.props.transform.ref)
this.setState({params:(null===(t=e.params)||void 0===t?void 0:t.values)||{},isInitial:!0,error:void 0,simpleOnly:this.state.simpleOnly})}}}class Zi extends l.jB{get current(){return this.plugin.managers.structure.hierarchy.behaviors.selection}componentDidMount(){this.subscribe(this.current,()=>this.forceUpdate())}get unitcell(){var e
const{selection:t}=this.plugin.managers.structure.hierarchy
if(0===t.structures.length)return null
const n=[]
for(const r of t.structures){const t=r.model;(null==t?void 0:t.unitcell)&&(null===(e=t.unitcell)||void 0===e?void 0:e.cell.obj)&&n.push(t.unitcell)}return 0===n.length?null:(0,a.jsx)(Ki,{refs:n,labelMultiple:"Unit Cells"})}get customControls(){const e=[]
return this.plugin.genericRepresentationControls.forEach((t,n)=>{const[r,i]=t(this.plugin.managers.structure.hierarchy.selection)
r.length>0&&e.push((0,a.jsx)("div",{children:(0,a.jsx)(Ki,{refs:r,labelMultiple:i})},n))}),e.length>0?e:null}render(){return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{style:{marginTop:"6px"},children:[this.unitcell,this.customControls]})})}}class Ki extends l.jB{constructor(){super(...arguments),this.state={showOptions:!1},this.toggleVisibility=e=>{e.preventDefault(),this.plugin.managers.structure.hierarchy.toggleVisibility(this.props.refs),e.currentTarget.blur()},this.highlight=e=>{e.preventDefault(),this.pivot.cell.parent&&Ir.PluginCommands.Interactivity.Object.Highlight(this.plugin,{state:this.pivot.cell.parent,ref:this.props.refs.map(e=>e.cell.transform.ref)})},this.clearHighlight=e=>{e.preventDefault(),Ir.PluginCommands.Interactivity.ClearHighlights(this.plugin)},this.focus=e=>{var t
e.preventDefault()
let n=!0
for(const i of this.props.refs)if(!i.cell.state.isHidden){n=!1
break}n&&this.plugin.managers.structure.hierarchy.toggleVisibility(this.props.refs,"show")
const r=[]
for(const i of this.props.refs){if(i.cell.state.isHidden)continue
const e=null===(t=i.cell.obj)||void 0===t?void 0:t.data.repr.getLoci()
e&&r.push(e)}this.plugin.managers.camera.focusLoci(r)},this.toggleOptions=()=>this.setState({showOptions:!this.state.showOptions})}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated,e=>{var t
$r.Uw.ObjectEvent.isCell(e,null===(t=this.pivot)||void 0===t?void 0:t.cell)&&this.forceUpdate()})}get pivot(){return this.props.refs[0]}render(){const{refs:e,labelMultiple:t}=this.props
if(0===e.length)return null
const n=e[0]
let r,i
if(1===e.length){const{obj:e}=n.cell
if(!e)return null
r=null==e?void 0:e.label,i=null==e?void 0:e.description}else r=`${e.length} ${t||"Objects"}`
return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"msp-flex-row",children:[(0,a.jsxs)("button",{className:"msp-form-control msp-control-button-label",title:`${r}. Click to focus.`,onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:"left"},children:[r," ",(0,a.jsx)("small",{children:i})]}),(0,a.jsx)(Pr.K0,{svg:n.cell.state.isHidden?Br.qF:Br.zs,toggleState:!1,className:"msp-form-control",onClick:this.toggleVisibility,title:n.cell.state.isHidden?"Show":"Hide",small:!0,flex:!0}),1===e.length&&(0,a.jsx)(Pr.K0,{svg:Br.cv,className:"msp-form-control",onClick:this.toggleOptions,title:"Options",toggleState:this.state.showOptions,flex:!0})]}),1===e.length&&this.state.showOptions&&n.cell.parent&&(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("div",{className:"msp-control-offset",children:(0,a.jsx)(Yi,{state:n.cell.parent,transform:n.cell.transform,customHeader:"none",autoHideApply:!0})})})]})}}class Ji extends l.VK{defaultState(){return{header:"Components",isCollapsed:!1,isDisabled:!1,brand:{accent:"blue",svg:Br.c3}}}componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,e=>this.setState({description:Ui.getSelectedStructuresDescription(this.plugin)}))}renderControls(){return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eo,{}),(0,a.jsx)(ro,{}),(0,a.jsx)(Zi,{})]})}}class eo extends l.jB{constructor(){super(...arguments),this.state={isEmpty:!0,isBusy:!1,canUndo:!1},this.togglePreset=this.toggleAction("preset"),this.toggleAdd=this.toggleAction("add"),this.toggleOptions=this.toggleAction("options"),this.hideAction=()=>this.setState({action:void 0}),this.applyPreset=e=>{if(this.hideAction(),!e)return
const t=this.plugin.managers.structure,{structures:n}=t.hierarchy.selection
null===e.value?t.component.clear(n):t.component.applyPreset(n,e.value)},this.undo=()=>{const e=this.plugin.state.data.undo()
e&&this.plugin.runTask(e)}}get isDisabled(){return this.state.isBusy||this.state.isEmpty}componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,e=>this.setState({action:"options"!==this.state.action||0===e.structures.length?void 0:"options",isEmpty:0===e.structures.length})),this.subscribe(this.plugin.behaviors.state.isBusy,e=>{this.setState({isBusy:e,action:"options"!==this.state.action?void 0:"options"})}),this.subscribe(this.plugin.state.data.events.historyUpdated,({state:e})=>{this.setState({canUndo:e.canUndo})})}toggleAction(e){return()=>this.setState({action:this.state.action===e?void 0:e})}get presetControls(){return(0,a.jsx)(Gi.W,{items:this.presetActions,onSelect:this.applyPreset})}get presetActions(){const e=this.plugin.managers.structure.component.pivotStructure,t=this.plugin.builders.structure.representation.getPresets(null==e?void 0:e.cell.obj)
return Gi.W.createItems(t,{label:e=>e.display.name,category:e=>e.display.group,description:e=>e.display.description})}render(){const e=this.state.canUndo?`Undo ${this.plugin.state.data.latestUndoLabel}`:"Some mistakes of the past can be undone."
return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"msp-flex-row",children:[(0,a.jsx)(Pr.ff,{icon:Br.sM,label:"Preset",title:"Apply a representation preset for the current structure(s).",toggle:this.togglePreset,isSelected:"preset"===this.state.action,disabled:this.isDisabled}),(0,a.jsx)(Pr.ff,{icon:Br.CR,label:"Add",title:"Add a new representation component for a selection.",toggle:this.toggleAdd,isSelected:"add"===this.state.action,disabled:this.isDisabled}),(0,a.jsx)(Pr.ff,{icon:Br.Hk,label:"",title:"Options that are applied to all applicable representations.",style:{flex:"0 0 40px",padding:0},toggle:this.toggleOptions,isSelected:"options"===this.state.action,disabled:this.isDisabled}),(0,a.jsx)(Pr.K0,{svg:Br.L3,className:"msp-flex-item",flex:"40px",onClick:this.undo,disabled:!this.state.canUndo||this.isDisabled,title:e})]}),"preset"===this.state.action&&this.presetControls,"add"===this.state.action&&(0,a.jsx)("div",{className:"msp-control-offset",children:(0,a.jsx)(to,{onApply:this.hideAction})}),"options"===this.state.action&&(0,a.jsx)("div",{className:"msp-control-offset",children:(0,a.jsx)(no,{isDisabled:this.isDisabled})})]})}}class to extends l.jB{constructor(){super(...arguments),this.state=this.createState(),this.apply=()=>{const e=this.props.forSelection?this.currentStructures:this.selectedStructures
this.props.onApply(),this.plugin.managers.structure.component.add(this.state.values,e)},this.paramsChanged=e=>this.setState({values:e})}createState(){const e=fi.getAddParams(this.plugin)
return{params:e,values:Vr.t.getDefaultValues(e)}}get selectedStructures(){return this.plugin.managers.structure.component.currentStructures}get currentStructures(){return this.plugin.managers.structure.hierarchy.current.structures}render(){return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Er.y1,{params:this.state.params,values:this.state.values,onChangeValues:this.paramsChanged}),(0,a.jsx)(Pr.$n,{icon:Br.CR,title:"Use Selection and optional Representation to create a new Component.",className:"msp-btn-commit msp-btn-commit-on",onClick:this.apply,style:{marginTop:"1px"},children:"Create Component"})]})}}class no extends l.jB{constructor(){super(...arguments),this.update=e=>this.plugin.managers.structure.component.setOptions(e)}componentDidMount(){this.subscribe(this.plugin.managers.structure.component.events.optionsUpdated,()=>this.forceUpdate())}render(){return(0,a.jsx)(Er.y1,{params:fi.OptionsParams,values:this.plugin.managers.structure.component.state.options,onChangeValues:this.update,isDisabled:this.props.isDisabled})}}class ro extends l.jB{componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,()=>{this.forceUpdate()})}render(){const e=this.plugin.managers.structure.hierarchy.currentComponentGroups
return 0===e.length?null:(0,a.jsx)("div",{style:{marginTop:"6px"},children:e.map(e=>(0,a.jsx)(io,{group:e},e[0].cell.transform.ref))})}}class io extends l.jB{constructor(){super(...arguments),this.state={action:void 0},this.toggleVisible=e=>{e.preventDefault(),e.currentTarget.blur(),this.plugin.managers.structure.component.toggleVisibility(this.props.group)},this.selectAction=e=>{e&&(null==e?void 0:e.value)()},this.remove=()=>this.plugin.managers.structure.hierarchy.remove(this.props.group,!0),this.toggleAction=()=>this.setState({action:"action"===this.state.action?void 0:"action"}),this.toggleLabel=()=>this.setState({action:"label"===this.state.action?void 0:"label"}),this.highlight=e=>{e.preventDefault(),this.props.group[0].cell.parent&&Ir.PluginCommands.Interactivity.Object.Highlight(this.plugin,{state:this.props.group[0].cell.parent,ref:this.props.group.map(e=>e.cell.transform.ref)})},this.clearHighlight=e=>{e.preventDefault(),Ir.PluginCommands.Interactivity.ClearHighlights(this.plugin)},this.focus=()=>{let e=!0
for(const t of this.props.group)if(!t.cell.state.isHidden){e=!1
break}e&&this.plugin.managers.structure.hierarchy.toggleVisibility(this.props.group,"show"),this.plugin.managers.camera.focusSpheres(this.props.group,e=>{var t
if(!e.cell.state.isHidden)return null===(t=e.cell.obj)||void 0===t?void 0:t.data.boundary.sphere})},this.updateLabel=e=>{this.plugin.managers.structure.component.updateLabel(this.pivot,e)}}get pivot(){return this.props.group[0]}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated,e=>{$r.Uw.ObjectEvent.isCell(e,this.pivot.cell)&&this.forceUpdate()})}get colorByActions(){var e,t
const n=this.plugin.managers.structure.component,r=null===(e=this.pivot.representations[0].cell.transform.params)||void 0===e?void 0:e.colorTheme.name,i=(0,Dr.A8)(this.plugin,null===(t=this.pivot.cell.obj)||void 0===t?void 0:t.data)
return Gi.W.createItemsFromSelectOptions(i,{value:e=>()=>n.updateRepresentationsTheme(this.props.group,{color:e[0]}),selected:e=>e[0]===r})}get actions(){const e=this.plugin.managers.structure.component,t=[[Gi.W.Header("Add Representation"),...fi.getRepresentationTypes(this.plugin,this.props.group[0]).map(t=>Gi.W.Item(t[1],()=>e.addRepresentation(this.props.group,t[0])))]]
return this.pivot.representations.length>0&&t.push([Gi.W.Header("Set Coloring",{isIndependent:!0}),...this.colorByActions]),e.canBeModified(this.props.group[0])&&t.push([Gi.W.Header("Modify by Selection"),Gi.W.Item("Include",()=>e.modifyByCurrentSelection(this.props.group,"union"),{icon:Br.QM}),Gi.W.Item("Subtract",()=>e.modifyByCurrentSelection(this.props.group,"subtract"),{icon:Br.tk}),Gi.W.Item("Intersect",()=>e.modifyByCurrentSelection(this.props.group,"intersect"),{icon:Br.sx})]),t.push(Gi.W.Item("Select This",()=>e.selectThis(this.props.group),{icon:Br.B7})),e.canBeModified(this.props.group[0])&&t.push(Gi.W.Item("Edit Label",this.toggleLabel)),t}get reprLabel(){var e
const t=this.pivot
return 0===t.representations.length?"No repr.":1===t.representations.length?null===(e=t.representations[0].cell.obj)||void 0===e?void 0:e.label:`${t.representations.length} reprs`}render(){var e
const t=this.pivot,n=t.cell,r=null===(e=n.obj)||void 0===e?void 0:e.label,i=this.reprLabel
return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"msp-flex-row",children:[(0,a.jsxs)(Pr.$n,{noOverflow:!0,className:"msp-control-button-label",title:`${r}. Click to focus.`,onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:"left"},children:[r,(0,a.jsx)("small",{className:"msp-25-lower-contrast-text",style:{float:"right"},children:i})]}),(0,a.jsx)(Pr.K0,{svg:n.state.isHidden?Br.qF:Br.zs,toggleState:!1,onClick:this.toggleVisible,title:(n.state.isHidden?"Show":"Hide")+" component",small:!0,className:"msp-form-control",flex:!0}),(0,a.jsx)(Pr.K0,{svg:Br.mf,toggleState:!1,onClick:this.remove,title:"Remove",small:!0,className:"msp-form-control",flex:!0}),(0,a.jsx)(Pr.K0,{svg:Br.cv,onClick:this.toggleAction,title:"Actions",toggleState:"action"===this.state.action,className:"msp-form-control",flex:!0})]}),"label"===this.state.action&&(0,a.jsx)("div",{className:"msp-control-offset",style:{marginBottom:"6px"},children:(0,a.jsx)(Pr.eJ,{label:"Label",control:(0,a.jsxs)("div",{style:{display:"flex",textAlignLast:"center"},children:[(0,a.jsx)(Pr.ks,{onChange:this.updateLabel,value:r,style:{flex:"1 1 auto",minWidth:0},className:"msp-form-control",blurOnEnter:!0,blurOnEscape:!0}),(0,a.jsx)(Pr.K0,{svg:Br.Xq,onClick:this.toggleLabel,className:"msp-form-control msp-control-button-label",flex:!0})]})})}),"action"===this.state.action&&(0,a.jsxs)("div",{className:"msp-accent-offset",children:[(0,a.jsx)("div",{style:{marginBottom:"6px"},children:(0,a.jsx)(Gi.W,{items:this.actions,onSelect:this.selectAction,noOffset:!0})}),(0,a.jsx)("div",{style:{marginBottom:"6px"},children:t.representations.map(e=>(0,a.jsx)(oo,{group:this.props.group,representation:e},e.cell.transform.ref))})]})]})}}class oo extends l.jB{constructor(){super(...arguments),this.remove=()=>this.plugin.managers.structure.component.removeRepresentations(this.props.group,this.props.representation),this.toggleVisible=e=>{e.preventDefault(),e.currentTarget.blur(),this.plugin.managers.structure.component.toggleVisibility(this.props.group,this.props.representation)},this.update=e=>this.plugin.managers.structure.component.updateRepresentations(this.props.group,this.props.representation,e)}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated,e=>{$r.Uw.ObjectEvent.isCell(e,this.props.representation.cell)&&this.forceUpdate()})}render(){var e
const t=this.props.representation.cell
return(0,a.jsxs)("div",{className:"msp-representation-entry",children:[t.parent&&(0,a.jsx)(Pr.Yj,{header:`${(null===(e=t.obj)||void 0===e?void 0:e.label)||""} Representation`,noOffset:!0,children:(0,a.jsx)(Yi,{state:t.parent,transform:t.transform,customHeader:"none",customUpdate:this.update,noMargin:!0})}),(0,a.jsx)(Pr.K0,{svg:Br.mf,onClick:this.remove,title:"Remove",small:!0,className:"msp-default-bg",toggleState:!1,style:{position:"absolute",top:0,right:"32px",lineHeight:"24px",height:"24px",textAlign:"right",width:"44px",paddingRight:"6px",background:"none"}}),(0,a.jsx)(Pr.K0,{svg:this.props.representation.cell.state.isHidden?Br.qF:Br.zs,toggleState:!1,onClick:this.toggleVisible,title:"Toggle Visibility",small:!0,className:"msp-default-bg",style:{position:"absolute",top:0,right:0,lineHeight:"24px",height:"24px",textAlign:"right",width:"32px",paddingRight:"6px",background:"none"}})]})}}var ao=n(63356),so=n(48475),lo=n(54749)
const co="measurement-group",uo="measurement-order-label",po={distanceUnitLabel:Vr.t.Text("",{isEssential:!0}),textColor:so.w.textColor},ho=Vr.t.getDefaultValues(po)
function fo(e){return{bundle:Or.StructureElement.Bundle.fromLoci(e)}}class mo extends Ur.e{stateUpdated(){this.behaviors.state.next(this.state)}getGroup(){const e=this.plugin.state.data,t=$r.QX.findTagInSubtree(e.tree,$r.Cn.RootRef,co),n=this.plugin.state.data.build()
return t?n.to(t):n.toRoot().group(Ar.f.Misc.CreateGroup,{label:"Measurements"},{tags:co})}async setOptions(e){this.updateState({options:e})&&this.stateUpdated()
const t=this.plugin.state.data.build()
for(const n of this.state.distances)t.to(n).update(t=>{t.unitLabel=e.distanceUnitLabel,t.textColor=e.textColor})
for(const n of this.state.labels)t.to(n).update(t=>{t.textColor=e.textColor})
for(const n of this.state.angles)t.to(n).update(t=>{t.textColor=e.textColor})
for(const n of this.state.dihedrals)t.to(n).update(t=>{t.textColor=e.textColor})
0!==t.editInfo.count&&await Ir.PluginCommands.State.Update(this.plugin,{state:this.plugin.state.data,tree:t,options:{doNotLogTiming:!0}})}async addDistance(e,t,n){const r=this.plugin.helpers.substructureParent.get(e.structure),i=this.plugin.helpers.substructureParent.get(t.structure)
if(!r||!i)return
const o=[r.transform.ref];(0,ao.Z2)(o,i.transform.ref)
const a=this.getGroup().apply(Ar.f.Model.MultiStructureSelectionFromBundle,{selections:[{key:"a",groupId:"a",ref:r.transform.ref,...fo(e)},{key:"b",groupId:"b",ref:i.transform.ref,...fo(t)}],isTransitive:!0,label:"Distance"},{dependsOn:o,tags:null==n?void 0:n.selectionTags}),s=a.apply(Ar.f.Representation.StructureSelectionsDistance3D,{customText:(null==n?void 0:n.customText)||"",unitLabel:this.state.options.distanceUnitLabel,textColor:this.state.options.textColor,...null==n?void 0:n.lineParams,...null==n?void 0:n.labelParams,...null==n?void 0:n.visualParams},{tags:null==n?void 0:n.reprTags}),l=this.plugin.state.data
return await Ir.PluginCommands.State.Update(this.plugin,{state:l,tree:s,options:{doNotLogTiming:!0}}),{selection:a.selector,representation:s.selector}}async addAngle(e,t,n,r){const i=this.plugin.helpers.substructureParent.get(e.structure),o=this.plugin.helpers.substructureParent.get(t.structure),a=this.plugin.helpers.substructureParent.get(n.structure)
if(!i||!o||!a)return
const s=[i.transform.ref];(0,ao.Z2)(s,o.transform.ref),(0,ao.Z2)(s,a.transform.ref)
const l=this.getGroup().apply(Ar.f.Model.MultiStructureSelectionFromBundle,{selections:[{key:"a",ref:i.transform.ref,...fo(e)},{key:"b",ref:o.transform.ref,...fo(t)},{key:"c",ref:a.transform.ref,...fo(n)}],isTransitive:!0,label:"Angle"},{dependsOn:s,tags:null==r?void 0:r.selectionTags}),c=l.apply(Ar.f.Representation.StructureSelectionsAngle3D,{customText:(null==r?void 0:r.customText)||"",textColor:this.state.options.textColor,...null==r?void 0:r.lineParams,...null==r?void 0:r.labelParams,...null==r?void 0:r.visualParams},{tags:null==r?void 0:r.reprTags}),u=this.plugin.state.data
return await Ir.PluginCommands.State.Update(this.plugin,{state:u,tree:c,options:{doNotLogTiming:!0}}),{selection:l.selector,representation:c.selector}}async addDihedral(e,t,n,r,i){const o=this.plugin.helpers.substructureParent.get(e.structure),a=this.plugin.helpers.substructureParent.get(t.structure),s=this.plugin.helpers.substructureParent.get(n.structure),l=this.plugin.helpers.substructureParent.get(r.structure)
if(!(o&&a&&s&&l))return
const c=[o.transform.ref];(0,ao.Z2)(c,a.transform.ref),(0,ao.Z2)(c,s.transform.ref),(0,ao.Z2)(c,l.transform.ref)
const u=this.getGroup().apply(Ar.f.Model.MultiStructureSelectionFromBundle,{selections:[{key:"a",ref:o.transform.ref,...fo(e)},{key:"b",ref:a.transform.ref,...fo(t)},{key:"c",ref:s.transform.ref,...fo(n)},{key:"d",ref:l.transform.ref,...fo(r)}],isTransitive:!0,label:"Dihedral"},{dependsOn:c,tags:null==i?void 0:i.selectionTags}),d=u.apply(Ar.f.Representation.StructureSelectionsDihedral3D,{customText:(null==i?void 0:i.customText)||"",textColor:this.state.options.textColor,...null==i?void 0:i.lineParams,...null==i?void 0:i.labelParams,...null==i?void 0:i.visualParams},{tags:null==i?void 0:i.reprTags}),p=this.plugin.state.data
return await Ir.PluginCommands.State.Update(this.plugin,{state:p,tree:d,options:{doNotLogTiming:!0}}),{selection:u.selector,representation:d.selector}}async addLabel(e,t){const n=this.plugin.helpers.substructureParent.get(e.structure)
if(!n)return
const r=[n.transform.ref],i=this.getGroup().apply(Ar.f.Model.MultiStructureSelectionFromBundle,{selections:[{key:"a",ref:n.transform.ref,...fo(e)}],isTransitive:!0,label:"Label"},{dependsOn:r,tags:null==t?void 0:t.selectionTags}),o=i.apply(Ar.f.Representation.StructureSelectionsLabel3D,{textColor:this.state.options.textColor,...null==t?void 0:t.labelParams,...null==t?void 0:t.visualParams},{tags:null==t?void 0:t.reprTags}),a=this.plugin.state.data
return await Ir.PluginCommands.State.Update(this.plugin,{state:a,tree:o,options:{doNotLogTiming:!0}}),{selection:i.selector,representation:o.selector}}async addOrientation(e){const t=[],n=[]
for(let a=0,s=e.length;a<s;++a){const r=e[a],i=this.plugin.helpers.substructureParent.get(r.structure)
i&&((0,ao.Z2)(n,i.transform.ref),t.push({key:`l${a}`,ref:i.transform.ref,...fo(r)}))}if(0===t.length)return
const r=this.getGroup().apply(Ar.f.Model.MultiStructureSelectionFromBundle,{selections:t,isTransitive:!0,label:"Orientation"},{dependsOn:n}),i=r.apply(Ar.f.Representation.StructureSelectionsOrientation3D),o=this.plugin.state.data
return await Ir.PluginCommands.State.Update(this.plugin,{state:o,tree:i,options:{doNotLogTiming:!0}}),{selection:r.selector,representation:i.selector}}async addPlane(e){const t=[],n=[]
for(let s=0,l=e.length;s<l;++s){const r=e[s],i=this.plugin.helpers.substructureParent.get(r.structure)
i&&((0,ao.Z2)(n,i.transform.ref),t.push({key:`l${s}`,ref:i.transform.ref,...fo(r)}))}if(0===t.length)return
const r=this.getGroup(),i=r.apply(Ar.f.Model.MultiStructureSelectionFromBundle,{selections:t,isTransitive:!0,label:"Plane"},{dependsOn:n}),o=i.apply(Ar.f.Representation.StructureSelectionsPlane3D),a=this.plugin.state.data
return await Ir.PluginCommands.State.Update(this.plugin,{state:a,tree:r,options:{doNotLogTiming:!0}}),{selection:i.selector,representation:o.selector}}async addOrderLabels(e){const t=this.getGroup(),n=this.plugin.state.data.select($r.QX.Generators.ofType(gi.O.Molecule.Structure.Selections).withTag(uo))
for(const o of n)t.delete(o)
let r=1
for(const o of e){const e=this.plugin.helpers.substructureParent.get(o.structure)
if(!e)continue
const n=[e.transform.ref]
t.apply(Ar.f.Model.MultiStructureSelectionFromBundle,{selections:[{key:"a",ref:e.transform.ref,...fo(o)}],isTransitive:!0,label:"Order"},{dependsOn:n,tags:uo}).apply(Ar.f.Representation.StructureSelectionsLabel3D,{textColor:lo.Color.fromRgb(255,255,255),borderColor:lo.Color.fromRgb(0,0,0),textSize:.33,borderWidth:.3,offsetZ:.75,customText:""+r++},{tags:uo})}const i=this.plugin.state.data
return await Ir.PluginCommands.State.Update(this.plugin,{state:i,tree:t,options:{doNotLogTiming:!0}}),{representation:t.selector}}getTransforms(e){const t=this.plugin.state.data,n=$r.QX.findTagInSubtree(t.tree,$r.Cn.RootRef,co),r=n?t.select($r.QX.Generators.ofTransformer(e,n)):this._empty
return 0===r.length?this._empty:r}sync(){const e=[]
for(const t of this.getTransforms(Ar.f.Representation.StructureSelectionsLabel3D)){const n=t.obj.tags
n&&n.includes(uo)||e.push(t)}this.updateState({labels:e,distances:this.getTransforms(Ar.f.Representation.StructureSelectionsDistance3D),angles:this.getTransforms(Ar.f.Representation.StructureSelectionsAngle3D),dihedrals:this.getTransforms(Ar.f.Representation.StructureSelectionsDihedral3D),orientations:this.getTransforms(Ar.f.Representation.StructureSelectionsOrientation3D),planes:this.getTransforms(Ar.f.Representation.StructureSelectionsPlane3D)})&&this.stateUpdated()}constructor(e){super({labels:[],distances:[],angles:[],dihedrals:[],orientations:[],planes:[],options:ho}),this.plugin=e,this.behaviors={state:this.ev.behavior(this.state)},this._empty=[],e.state.data.events.changed.subscribe(t=>{t.inTransaction||e.behaviors.state.isAnimating.value||this.sync()}),e.behaviors.state.isAnimating.subscribe(t=>{t||e.behaviors.state.isUpdating.value||this.sync()})}}var go=n(19288),yo=n(83748),vo=n(16625),bo=n(40038)
class xo extends Ur.e{get props(){return{...this.state.props}}setProps(e){const t=this.props,n={...this.state.props,...e};(0,jr.bN)(t,n)||(this.updateState({props:n}),this.lociSelects.setProps(n),this.lociHighlights.setProps(n),this.events.propsUpdated.next(void 0))}dispose(){super.dispose(),this.lociSelects.dispose(),this.lociHighlights.dispose()}constructor(e,t={}){super({props:{...Vr.t.getDefaultValues(xo.Params),...t}}),this.plugin=e,this._props=Vr.t.getDefaultValues(xo.Params),this.events={propsUpdated:this.ev()},this.lociSelects=new xo.LociSelectManager(e,this._props),this.lociHighlights=new xo.LociHighlightManager(e,this._props)}}!function(e){e.Params={granularity:Vr.t.Select("residue",Xr.Loci.GranularityOptions,{label:"Picking Level",description:"Controls if selections are expanded upon picking to whole residues, chains, structures, instances, or left as atoms and coarse elements"})}
class t{setProps(e){Object.assign(this.props,e)}addProvider(e){this.providers.push(e)}removeProvider(e){this.providers=this.providers.filter(t=>t!==e)}normalizedLoci(e,t,n=!1){const{loci:r,repr:i}=e,o=t?this.props.granularity:void 0
return{loci:Xr.Loci.normalize(r,o,n),repr:i}}mark(e,t,n=!1){if(!Xr.Loci.isEmpty(e.loci))for(const r of this.providers)r(e,t,n)}dispose(){this.providers.length=0,this.sel.dispose()}constructor(t,n={}){this.ctx=t,this.providers=[],this.props=Vr.t.getDefaultValues(e.Params),this.sel=t.managers.structure.selection,this.setProps(n)}}e.LociMarkManager=t,e.LociHighlightManager=class extends t{constructor(){super(...arguments),this.prev=[],this.clearHighlights=(e=!1)=>{for(const t of this.prev)this.mark(t,bo.xi.RemoveHighlight,e)
this.prev.length=0}}isHighlighted(e){for(const t of this.prev)if(vo.YL.Loci.areEqual(t,e))return!0
return!1}addHighlight(e){this.mark(e,bo.xi.Highlight),this.prev.push(e)}highlight(e,t=!0){const n=this.normalizedLoci(e,t)
this.isHighlighted(n)||this.addHighlight(n)}highlightOnly(e,t=!0){const n=this.normalizedLoci(e,t)
this.isHighlighted(n)||(Xr.Loci.isEmpty(n.loci)?this.clearHighlights():(this.clearHighlights(!0),this.addHighlight(n)))}highlightOnlyExtend(e,t=!0){const n=this.normalizedLoci(e,t)
if(Or.StructureElement.Loci.is(n.loci)){const e=this.ctx.selectionMode?this.sel.tryGetRange(n.loci):this.ctx.managers.structure.focus.tryGetRange(n.loci),t={loci:null!=e?e:n.loci,repr:n.repr}
this.isHighlighted(t)||(Xr.Loci.isEmpty(t.loci)?this.clearHighlights():(this.clearHighlights(!0),this.addHighlight(t)))}}dispose(){super.dispose(),this.prev.length=0}},e.LociSelectManager=class extends t{toggle(e,t=!0){if(Xr.Loci.isEmpty(e.loci))return
const n=this.normalizedLoci(e,t,!0)
Or.StructureElement.Loci.is(n.loci)?this.toggleSel(n):super.mark(n,bo.xi.Toggle)}toggleExtend(e,t=!0){if(Xr.Loci.isEmpty(e.loci))return
const n=this.normalizedLoci(e,t,!0)
if(Or.StructureElement.Loci.is(n.loci)){const e=this.sel.tryGetRange(n.loci)||n.loci
this.toggleSel({loci:e,repr:n.repr})}}select(e,t=!0){const n=this.normalizedLoci(e,t,!0)
Or.StructureElement.Loci.is(n.loci)&&this.sel.modify("add",n.loci),this.mark(n,bo.xi.Select)}selectJoin(e,t=!0){const n=this.normalizedLoci(e,t,!0)
Or.StructureElement.Loci.is(n.loci)&&this.sel.modify("intersect",n.loci),this.mark(n,bo.xi.Select)}selectOnly(e,t=!0){const n=this.normalizedLoci(e,t,!0)
Or.StructureElement.Loci.is(n.loci)&&(this.mark({loci:Or.Structure.Loci(n.loci.structure),repr:n.repr},bo.xi.Deselect),this.sel.modify("set",n.loci)),this.mark(n,bo.xi.Select)}deselect(e,t=!0){const n=this.normalizedLoci(e,t,!0)
Or.StructureElement.Loci.is(n.loci)&&this.sel.modify("remove",n.loci),this.mark(n,bo.xi.Deselect)}deselectAll(){this.sel.clear(),this.mark({loci:Xr.EveryLoci},bo.xi.Deselect)}deselectAllOnEmpty(e){(0,Xr.isEmptyLoci)(e.loci)&&this.deselectAll()}mark(e,t){const{loci:n}=e
if(!Xr.Loci.isEmpty(n))if(Or.StructureElement.Loci.is(n)){const e=this.sel.getLoci(n.structure)
super.mark({loci:Or.Structure.Loci(n.structure)},bo.xi.Deselect,!Xr.Loci.isEmpty(e)),super.mark({loci:e},bo.xi.Select)}else super.mark(e,t)}toggleSel(e){this.sel.has(e.loci)?(this.sel.modify("remove",e.loci),this.mark(e,bo.xi.Deselect)):(this.sel.modify("add",e.loci),this.mark(e,bo.xi.Select))}}}(xo||(xo={}))
var So=n(99302),_o=n(83689),Co=n(71695)
function wo(e){return e.split(",").map(e=>e.trim().split(/\s+|[-]/g).filter(e=>!!e)).filter(e=>1===e.length||2===e.length).map(e=>1===e.length?[+e[0],+e[0]]:[+e[0],+e[1]])}var To=n(12288),Ao=n(9052),Io=n(5422)
class Po extends o.PureComponent{getBindingComponents(){const e=(t=this.props.bindings,Object.keys(t).map(e=>[e,t[e]]).filter(e=>Ao.O.isBinding(e[1])))
var t
return(0,a.jsx)(a.Fragment,{children:e.map(e=>{const[t,n]=e
return Ao.O.isEmpty(n)?null:(0,a.jsxs)("div",{style:{marginBottom:"6px"},children:[(0,a.jsx)("b",{children:n.action}),(0,a.jsx)("br",{}),(0,a.jsx)("span",{dangerouslySetInnerHTML:{__html:Ao.O.format(n,t)}})]},t)})})}render(){return(0,a.jsx)(Bo,{children:this.getBindingComponents()})}}class Bo extends o.PureComponent{render(){return(0,a.jsx)("div",{className:"msp-help-text",children:(0,a.jsx)("div",{children:this.props.children})})}}class Eo extends o.PureComponent{constructor(){super(...arguments),this.state={header:this.props.header,isExpanded:!!this.props.initiallyExpanded},this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded})}render(){return(0,a.jsxs)("div",{className:"msp-control-group-wrapper",children:[(0,a.jsx)("div",{className:"msp-control-group-header",children:(0,a.jsxs)(Pr.$n,{onClick:this.toggleExpanded,children:[(0,a.jsx)(Br.In,{svg:this.state.isExpanded?Br.DM:Br.Cp}),this.props.header]})}),this.state.isExpanded&&(0,a.jsx)("div",{className:"msp-control-offset",style:{display:this.state.isExpanded?"block":"none"},children:this.props.children})]})}}function ko(e){return(0,a.jsx)("div",{className:"msp-simple-help-section",children:e.header})}class Do extends l.dL{constructor(){super(...arguments),this.getInteractionBindings=(0,Hi._)(e=>{let t
return e.forEach(e=>{var n
const r=null===(n=e.params)||void 0===n?void 0:n.values;(null==r?void 0:r.bindings)&&Object.keys(r.bindings).length>0&&(t||(t={}),Object.assign(t,r.bindings))}),t})}componentDidMount(){this.subscribe(this.plugin.events.canvas3d.settingsUpdated,()=>this.forceUpdate())}render(){const e=this.getInteractionBindings(this.plugin.state.behaviors.cells)
return(0,a.jsxs)(a.Fragment,{children:[!this.props.selectOnly&&this.plugin.canvas3d&&(0,a.jsx)(Eo,{header:"Moving in 3D",children:(0,a.jsx)(Po,{bindings:this.plugin.canvas3d.attribs.trackball.bindings})},"trackball"),!!e&&(0,a.jsx)(Eo,{header:"Mouse & Key Controls",children:(0,a.jsx)(Po,{bindings:e})},"interactions")]})}}class Mo extends l.dL{componentDidMount(){this.subscribe(this.plugin.events.canvas3d.settingsUpdated,()=>this.forceUpdate())}formatTriggers(e){return e.triggers.map(e=>Ao.O.Trigger.format(e)).join(" or ")}getTriggerFor(e,t){const n=this.plugin.state.behaviors.select($r.QX.Generators.ofTransformer(e)),r=1===n.length?n[0].params:void 0,i=r?r.values.bindings:{},o=t in i?i[t]:Ao.O.Empty
return this.formatTriggers(o)}render(){const e=this.getTriggerFor(Io.SelectLoci,"clickSelectToggle"),t=this.getTriggerFor(Io.FocusLoci,"clickFocus")
return(0,a.jsxs)("div",{children:[(0,a.jsx)(ko,{header:"Interface Controls"}),(0,a.jsxs)(Eo,{header:"Inline Help",children:[(0,a.jsx)(Bo,{children:"Many user interface elements show a little questionmark icon when hovered over. Clicking the icon toggles the display of an inline help text."}),(0,a.jsx)(Bo,{children:"Tooltips may provide additional information on a user interface element and are shown when hovering over it with the mouse."})]}),(0,a.jsx)(Eo,{header:"Selections",children:(0,a.jsxs)(Bo,{children:["The viewer allows changing colors and representations for selections of atoms, residues or chains. Selections can be created by",(0,a.jsxs)("ul",{style:{paddingLeft:"20px"},children:[(0,a.jsxs)("li",{children:["picking elements on the 3D canvas or the sequence view using the mouse, e.g. toggle selection using ",e," (for more see help section on ",(0,a.jsx)("i",{children:"Mouse Controls"}),")"]}),(0,a.jsxs)("li",{children:["using the ",(0,a.jsx)("i",{children:"Add"}),", ",(0,a.jsx)("i",{children:"Remove"})," and ",(0,a.jsx)("i",{children:"Only"})," dropdown buttons in the ",(0,a.jsx)("i",{children:"Manage Selection"})," panel which allow modifing the current selection by predefined sets"]})]})]})}),(0,a.jsx)(Eo,{header:"Coloring",children:(0,a.jsxs)(Bo,{children:["There are two ways to color structures. Every representation (e.g. cartoon or spacefill) has a color theme which can be changed using the dropdown for each representation in the ",(0,a.jsx)("i",{children:"Structure Settings"})," panel. Additionally any selection atoms, residues or chains can by given a custom color. For that, first select the parts of the structure to be colored (see help section on ",(0,a.jsx)("i",{children:"Selections"}),") and, second, choose a color from the color dropdown botton in the ",(0,a.jsx)("i",{children:"Selection"})," row of the ",(0,a.jsx)("i",{children:"Change Representation"})," panel. The theme color can be seen as a base color that is overpainted by the custom color. Custom colors can be removed for a selection with the 'Clear' option in the color dropdown."]})}),(0,a.jsx)(Eo,{header:"Representations",children:(0,a.jsxs)(Bo,{children:["Structures can be shown with many different representations (e.g. cartoon or spacefill). The ",(0,a.jsx)("i",{children:"Change Representation"})," panel offers a collection of predefined styles which can be applied using the ",(0,a.jsx)("i",{children:"Preset"})," dropdown button. Additionally any selection atoms, residues or chains can by shown with a custom representation. For that, first select the parts of the structure to be mofified (see help section on ",(0,a.jsx)("i",{children:"Selections"}),") and, second, choose a representation to hide or show from the ",(0,a.jsx)("i",{children:"Show"})," and ",(0,a.jsx)("i",{children:"Hide"})," dropdown bottons in the ",(0,a.jsx)("i",{children:"Selection"})," row of the ",(0,a.jsx)("i",{children:"Change Representation"})," panel. The ",(0,a.jsx)("i",{children:"Everything"})," row applies the action to the whole structure instead of the current selection."]})}),(0,a.jsx)(Eo,{header:"Surroundings",children:(0,a.jsxs)(Bo,{children:["To show the surroundings of a residue or ligand, click it in the 3D scene or in the sequence widget using ",t,"."]})}),(0,a.jsx)(ko,{header:"How-to Guides"}),(0,a.jsx)(Eo,{header:"Create an Image",children:(0,a.jsxs)(Bo,{children:[(0,a.jsxs)("p",{children:["Use the ",(0,a.jsx)(Br.In,{svg:Br.OY})," icon in the viewport to bring up the screenshot controls."]}),(0,a.jsxs)("p",{children:["To adjust the size of the image, use the ",(0,a.jsx)("i",{children:"Resolution"})," dropdown."]})]})}),(0,a.jsx)(ko,{header:"Mouse Controls"}),(0,a.jsx)(Do,{})]})}}class Ro extends l.jB{constructor(){super(...arguments),this._toggleSelMode=()=>{this.plugin.selectionMode=!this.plugin.selectionMode}}componentDidMount(){this.subscribe(this.plugin.events.canvas3d.settingsUpdated,()=>this.forceUpdate()),this.subscribe(this.plugin.layout.events.updated,()=>this.forceUpdate()),this.subscribe(this.plugin.behaviors.interaction.selectionMode,()=>this.forceUpdate())}render(){const e=this.props.inline?{background:"transparent",width:"auto",height:"auto",lineHeight:"unset"}:{background:"transparent"}
return(0,a.jsx)(Pr.K0,{svg:Br.yG,onClick:this._toggleSelMode,title:"Toggle Selection Mode",style:e,toggleState:this.plugin.selectionMode})}}const Oo={granularity:xo.Params.granularity},Lo=new Map([["add","Add/Union Selection"],["remove","Remove/Subtract Selection"],["intersect","Intersect Selection"],["set","Set Selection"]])
class No extends l.dL{constructor(){super(...arguments),this.state={action:void 0,helper:void 0,isEmpty:!0,isBusy:!1,canUndo:!1,structureSelectionParams:Oo},this.set=(e,t)=>{this.plugin.managers.structure.selection.fromSelectionQuery(e,t,!1)},this.selectQuery=(e,t)=>{if(!e||!this.state.action)return void this.setState({action:void 0})
const n=this.state.action;(null==t?void 0:t.shiftKey)?this.set(n,e.value):this.setState({action:void 0},()=>{this.set(n,e.value)})},this.selectHelper=(e,t)=>{console.log(e),e&&this.state.action?this.setState({helper:e.value.kind}):this.setState({action:void 0,helper:void 0})},this.queriesItems=[],this.queriesVersion=-1,this.helpersItems=void 0,this.toggleAdd=this.showAction("add"),this.toggleRemove=this.showAction("remove"),this.toggleIntersect=this.showAction("intersect"),this.toggleSet=this.showAction("set"),this.toggleTheme=this.showAction("theme"),this.toggleAddComponent=this.showAction("add-component"),this.toggleHelp=this.showAction("help"),this.setGranuality=({value:e})=>{this.plugin.managers.interactivity.setProps({granularity:e})},this.turnOff=()=>this.plugin.selectionMode=!1,this.undo=()=>{const e=this.plugin.state.data.undo()
e&&this.plugin.runTask(e)},this.subtract=()=>{const e=this.plugin.managers.structure.hierarchy.getStructuresWithSelection(),t=[]
for(const n of e)t.push(...n.components)
0!==t.length&&this.plugin.managers.structure.component.modifyByCurrentSelection(t,"subtract")}}componentDidMount(){var e,t
this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,e=>{const t=0===e.hierarchy.structures.length
this.state.isEmpty!==t&&this.setState({isEmpty:t}),this.queriesVersion=-1,this.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,e=>{this.setState({isBusy:e,action:void 0})}),this.subscribe(this.plugin.managers.interactivity.events.propsUpdated,()=>{this.forceUpdate()}),this.subscribe(this.plugin.state.data.events.historyUpdated,({state:e})=>{this.setState({canUndo:e.canUndo})})
const n=null===(t=null===(e=this.plugin.spec.components)||void 0===e?void 0:e.selectionTools)||void 0===t?void 0:t.granularityOptions
if(n){const e=new Set(n),t={...Oo,granularity:{...Oo.granularity,options:Oo.granularity.options.filter(([t])=>e.has(t))}}
this.setState({structureSelectionParams:t})}}get isDisabled(){return this.state.isBusy||this.state.isEmpty}get structures(){var e
const t=[]
for(const n of this.plugin.managers.structure.hierarchy.selection.structures){const r=null===(e=n.cell.obj)||void 0===e?void 0:e.data
r&&t.push(r)}return t}get queries(){const{registry:e}=this.plugin.query.structure
if(e.version!==this.queriesVersion){const t=this.structures,n=[...e.list,...(0,Hr.getPolymerAndBranchedEntityQueries)(t),...(0,Hr.getNonStandardResidueQueries)(t),...(0,Hr.getElementQueries)(t)].sort((e,t)=>t.priority-e.priority)
this.queriesItems=Gi.W.createItems(n,{filter:e=>e!==Hr.StructureSelectionQueries.current&&!e.isHidden,label:e=>e.label,category:e=>e.category,description:e=>e.description}),this.queriesVersion=e.version}return this.queriesItems}get helpers(){return this.helpersItems||(this.helpersItems=Gi.W.createItems([{kind:"residue-list",category:"Helpers",label:"Atom/Residue Identifier List",description:"Create a selection from a list of atom/residue ranges."}],{label:e=>e.label,category:e=>e.category,description:e=>e.description})),this.helpersItems}showAction(e){return()=>this.setState({action:this.state.action===e?void 0:e,helper:void 0})}render(){var e,t
const n=this.plugin.managers.interactivity.props.granularity,r=null===(t=null===(e=this.plugin.spec.components)||void 0===e?void 0:e.selectionTools)||void 0===t?void 0:t.hide,i=this.state.canUndo?`Undo ${this.plugin.state.data.latestUndoLabel}`:"Some mistakes of the past can be undone."
let o
if(this.state.action&&!this.state.helper)o=(0,a.jsxs)(a.Fragment,{children:[this.state.action&&"theme"!==this.state.action&&"add-component"!==this.state.action&&"help"!==this.state.action&&(0,a.jsxs)("div",{className:"msp-selection-viewport-controls-actions",children:[(0,a.jsx)(Gi.W,{header:Lo.get(this.state.action),title:"Click to close.",items:this.queries,onSelect:this.selectQuery,noOffset:!0}),(0,a.jsx)(Gi.W,{items:this.helpers,onSelect:this.selectHelper,noOffset:!0})]}),"theme"===this.state.action&&(0,a.jsx)("div",{className:"msp-selection-viewport-controls-actions",children:(0,a.jsx)(Pr.tW,{header:"Theme",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleTheme,topRightIcon:Br.X6,children:(0,a.jsx)(zo,{onApply:this.toggleTheme})})}),"add-component"===this.state.action&&(0,a.jsx)("div",{className:"msp-selection-viewport-controls-actions",children:(0,a.jsx)(Pr.tW,{header:"Add Component",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleAddComponent,topRightIcon:Br.X6,children:(0,a.jsx)(to,{onApply:this.toggleAddComponent,forSelection:!0})})}),"help"===this.state.action&&(0,a.jsx)("div",{className:"msp-selection-viewport-controls-actions",children:(0,a.jsxs)(Pr.tW,{header:"Help",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleHelp,topRightIcon:Br.X6,maxHeight:"300px",children:[(0,a.jsx)(Eo,{header:"Selection Operations",children:(0,a.jsxs)(Bo,{children:["Use ",(0,a.jsx)(Br.In,{svg:Br.QM,inline:!0})," ",(0,a.jsx)(Br.In,{svg:Br.tk,inline:!0})," ",(0,a.jsx)(Br.In,{svg:Br.sx,inline:!0})," ",(0,a.jsx)(Br.In,{svg:Br.B7,inline:!0})," to modify the selection."]})}),(0,a.jsx)(Eo,{header:"Representation Operations",children:(0,a.jsxs)(Bo,{children:["Use ",(0,a.jsx)(Br.In,{svg:Br.fe,inline:!0})," ",(0,a.jsx)(Br.In,{svg:Br.c3,inline:!0})," ",(0,a.jsx)(Br.In,{svg:Br.$j,inline:!0})," ",(0,a.jsx)(Br.In,{svg:Br.L3,inline:!0})," to color, create components, remove from components, or undo actions."]})}),(0,a.jsx)(Do,{selectOnly:!0})]})})]})
else if(Lo.has(this.state.action)&&"residue-list"===this.state.helper){const e=()=>this.setState({action:void 0,helper:void 0})
o=(0,a.jsx)("div",{className:"msp-selection-viewport-controls-actions",children:(0,a.jsx)(Pr.tW,{header:"Atom/Residue Identifier List",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:e,topRightIcon:Br.X6,children:(0,a.jsx)(Uo,{modifier:this.state.action,plugin:this.plugin,close:e})})})}return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"msp-flex-row",style:{background:"none"},children:[!(null==r?void 0:r.granularity)&&(0,a.jsx)(Er.UT,{title:"Picking Level for selecting and highlighting",param:this.state.structureSelectionParams.granularity,name:"granularity",value:n,onChange:this.setGranuality,isDisabled:this.isDisabled}),!(null==r?void 0:r.union)&&(0,a.jsx)(Pr.ff,{icon:Br.QM,title:`${Lo.get("add")}. Hold shift key to keep menu open.`,toggle:this.toggleAdd,isSelected:"add"===this.state.action,disabled:this.isDisabled}),!(null==r?void 0:r.subtract)&&(0,a.jsx)(Pr.ff,{icon:Br.tk,title:`${Lo.get("remove")}. Hold shift key to keep menu open.`,toggle:this.toggleRemove,isSelected:"remove"===this.state.action,disabled:this.isDisabled}),!(null==r?void 0:r.intersect)&&(0,a.jsx)(Pr.ff,{icon:Br.sx,title:`${Lo.get("intersect")}. Hold shift key to keep menu open.`,toggle:this.toggleIntersect,isSelected:"intersect"===this.state.action,disabled:this.isDisabled}),!(null==r?void 0:r.set)&&(0,a.jsx)(Pr.ff,{icon:Br.B7,title:`${Lo.get("set")}. Hold shift key to keep menu open.`,toggle:this.toggleSet,isSelected:"set"===this.state.action,disabled:this.isDisabled}),!(null==r?void 0:r.theme)&&(0,a.jsx)(Pr.ff,{icon:Br.fe,title:"Apply Theme to Selection",toggle:this.toggleTheme,isSelected:"theme"===this.state.action,disabled:this.isDisabled,style:{marginLeft:"10px"}}),!(null==r?void 0:r.componentAdd)&&(0,a.jsx)(Pr.ff,{icon:Br.c3,title:"Create Component of Selection with Representation",toggle:this.toggleAddComponent,isSelected:"add-component"===this.state.action,disabled:this.isDisabled}),!(null==r?void 0:r.componentRemove)&&(0,a.jsx)(Pr.K0,{svg:Br.$j,title:"Remove/subtract Selection from all Components",onClick:this.subtract,disabled:this.isDisabled}),!(null==r?void 0:r.undo)&&(0,a.jsx)(Pr.K0,{svg:Br.L3,onClick:this.undo,disabled:!this.state.canUndo||this.isDisabled,title:i}),!(null==r?void 0:r.help)&&(0,a.jsx)(Pr.ff,{icon:Br.ml,title:"Show/hide help",toggle:this.toggleHelp,style:{marginLeft:"10px"},isSelected:"help"===this.state.action}),!(null==r?void 0:r.cancel)&&this.plugin.config.get(go.PluginConfig.Viewport.ShowSelectionMode)&&(0,a.jsx)(Pr.K0,{svg:Br.XD,title:"Turn selection mode off",onClick:this.turnOff})]}),o]})}}class Fo extends l.dL{constructor(){super(...arguments),this.state={isEmpty:!0,isBusy:!1},this.clear=()=>this.plugin.managers.interactivity.lociSelects.deselectAll(),this.focus=()=>{if(0===this.plugin.managers.structure.selection.stats.elementCount)return
const{sphere:e}=this.plugin.managers.structure.selection.getBoundary()
this.plugin.managers.camera.focusSphere(e)},this.highlight=e=>{this.plugin.managers.interactivity.lociHighlights.clearHighlights(),this.plugin.managers.structure.selection.entries.forEach(e=>{this.plugin.managers.interactivity.lociHighlights.highlight({loci:e.selection},!1)})},this.clearHighlight=()=>{this.plugin.managers.interactivity.lociHighlights.clearHighlights()}}componentDidMount(){this.subscribe(this.plugin.managers.structure.selection.events.changed,()=>{this.forceUpdate()}),this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,e=>{const t=0===e.structures.length
this.state.isEmpty!==t&&this.setState({isEmpty:t})}),this.subscribe(this.plugin.behaviors.state.isBusy,e=>{this.setState({isBusy:e})})}get isDisabled(){return this.state.isBusy||this.state.isEmpty}get stats(){const e=this.plugin.managers.structure.selection.stats
return 0===e.structureCount||0===e.elementCount?"Nothing Selected":`${(0,To.Kq)(e.label)} Selected`}render(){const e=this.plugin.managers.structure.selection.stats,t=0===e.structureCount||0===e.elementCount
return t&&this.props.hideOnEmpty?null:(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"msp-flex-row",children:[(0,a.jsx)(Pr.$n,{noOverflow:!0,onClick:this.focus,title:"Click to Focus Selection",disabled:t,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlignLast:t?void 0:"left"},children:this.stats}),!t&&(0,a.jsx)(Pr.K0,{svg:Br.XD,onClick:this.clear,title:"Clear",className:"msp-form-control",flex:!0})]})})}}class zo extends l.jB{constructor(){super(...arguments),this._params=(0,Hi._)(e=>fi.getThemeParams(this.plugin,e)),this.state={values:Vr.t.getDefaultValues(this.params)},this.apply=()=>{var e,t
this.plugin.managers.structure.component.applyTheme(this.state.values,this.plugin.managers.structure.hierarchy.current.structures),null===(t=(e=this.props).onApply)||void 0===t||t.call(e)},this.paramsChanged=e=>this.setState({values:e})}get params(){return this._params(this.plugin.managers.structure.component.pivotStructure)}render(){return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Er.y1,{params:this.params,values:this.state.values,onChangeValues:this.paramsChanged}),(0,a.jsx)(Pr.$n,{icon:Br.fe,className:"msp-btn-commit msp-btn-commit-on",onClick:this.apply,style:{marginTop:"1px"},children:"Apply Theme"})]})}}const jo={idType:Vr.t.Select("auth",Vr.t.arrayToOptions(["auth","label","atom-id","element-symbol"])),identifiers:Vr.t.Text("",{description:"A comma separated list of atom identifiers (e.g. 10, 15-25), element symbols (e.g. N, C or 20-200) or residue ranges in given chain (e.g. A 10-15, B 25, C 30:i)"})},Vo=Vr.t.getDefaultValues(jo)
function Uo({modifier:e,plugin:t,close:n}){const[r,i]=o.useState(Vo),s=()=>{if(0!==r.identifiers.trim().length)try{n()
const i=function(e,t){return"atom-id"===t?function(e){const t=Co.th.create()
for(const[r,i]of e)for(let e=r;e<=i;e++)Co.th.add(t,e,e)
const n=So.MolScriptBuilder.struct.generator.atomGroups({"atom-test":So.MolScriptBuilder.core.set.has([So.MolScriptBuilder.set(...t.array),So.MolScriptBuilder.ammp("id")])})
return(0,_o.wE)(n)}(wo(e)):"element-symbol"===t?/[a-zA-Z]/.test(e)?function(e){const t=So.MolScriptBuilder.struct.generator.atomGroups({"atom-test":So.MolScriptBuilder.core.set.has([So.MolScriptBuilder.set(...e),So.MolScriptBuilder.acp("elementSymbol")])})
return(0,_o.wE)(t)}(e.split(",").map(e=>e.trim())):function(e){const t=Co.th.create()
for(const[r,i]of e)for(let e=r;e<=i;e++)Co.th.add(t,e.toString(),e.toString())
const n=So.MolScriptBuilder.struct.generator.atomGroups({"atom-test":So.MolScriptBuilder.core.set.has([So.MolScriptBuilder.set(...t.array),So.MolScriptBuilder.acp("elementSymbol")])})
return(0,_o.wE)(n)}(wo(e)):function(e,t){var n
const r=[],i="auth"===t?"auth_asym_id":"label_asym_id",o="auth"===t?"auth_seq_id":"label_seq_id"
for(const s of e)if("range"===s.kind)r.push(So.MolScriptBuilder.struct.generator.atomGroups({"chain-test":So.MolScriptBuilder.core.rel.eq([So.MolScriptBuilder.ammp(i),s.asym_id]),"residue-test":So.MolScriptBuilder.core.rel.inRange([So.MolScriptBuilder.ammp(o),s.seq_id_beg,s.seq_id_end])}))
else{const e=(null!==(n=s.ins_code)&&void 0!==n?n:"").trim()
r.push(So.MolScriptBuilder.struct.generator.atomGroups({"chain-test":So.MolScriptBuilder.core.rel.eq([So.MolScriptBuilder.ammp(i),s.asym_id]),"residue-test":So.MolScriptBuilder.core.logic.and([So.MolScriptBuilder.core.rel.eq([So.MolScriptBuilder.ammp(o),s.seq_id]),So.MolScriptBuilder.core.rel.eq([So.MolScriptBuilder.ammp("pdbx_PDB_ins_code"),e])])}))}const a=So.MolScriptBuilder.struct.combinator.merge(r)
return(0,_o.wE)(a)}(function(e){return e.split(",").map(e=>e.trim().split(/\s+|[-]/g).filter(e=>!!e)).map(e=>function(e,t,n){if(e&&0!==t.length&&!Number.isNaN(+t[0]))return Number.isNaN(n)?{kind:"single",asym_id:e,seq_id:+t[0],ins_code:t[1]}:{kind:"range",asym_id:e,seq_id_beg:+t[0],seq_id_end:n}}(e[0],function(e){return e?e.split(":"):[]}(e[1]),+e[2])).filter(e=>!!e)}(e),t)}(r.identifiers,r.idType)
t.managers.structure.selection.fromCompiledQuery(e,i,!1)}catch(e){console.error(e),t.log.error("Failed to create selection")}}
return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Er.y1,{params:jo,values:r,onChangeValues:i,onEnter:s}),(0,a.jsxs)(Pr.$n,{className:"msp-btn-commit msp-btn-commit-on",disabled:0===r.identifiers.trim().length,onClick:s,style:{marginTop:"1px"},children:[(0,To.ZH)(e)," Selection"]})]})}class Go extends l.VK{defaultState(){return{isCollapsed:!1,header:"Measurements",brand:{accent:"gray",svg:Br.yF}}}renderControls(){return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(qo,{}),(0,a.jsx)(Ho,{})]})}}class Ho extends l.jB{componentDidMount(){this.subscribe(this.plugin.managers.structure.measurement.behaviors.state,()=>{this.forceUpdate()})}renderGroup(e,t){const n=[]
for(const r of e)r.obj&&n.push((0,a.jsx)($o,{cell:r},r.obj.id))
return n.length?(0,a.jsx)(Pr.Yj,{header:t,initiallyExpanded:!0,children:n}):null}render(){const e=this.plugin.managers.structure.measurement.state
return(0,a.jsxs)("div",{style:{marginTop:"6px"},children:[this.renderGroup(e.labels,"Labels"),this.renderGroup(e.distances,"Distances"),this.renderGroup(e.angles,"Angles"),this.renderGroup(e.dihedrals,"Dihedrals"),this.renderGroup(e.orientations,"Orientations"),this.renderGroup(e.planes,"Planes")]})}}class qo extends l.jB{constructor(){super(...arguments),this.state={isBusy:!1,action:void 0},this.measureDistance=()=>{const e=this.plugin.managers.structure.selection.additionsHistory
this.plugin.managers.structure.measurement.addDistance(e[0].loci,e[1].loci)},this.measureAngle=()=>{const e=this.plugin.managers.structure.selection.additionsHistory
this.plugin.managers.structure.measurement.addAngle(e[0].loci,e[1].loci,e[2].loci)},this.measureDihedral=()=>{const e=this.plugin.managers.structure.selection.additionsHistory
this.plugin.managers.structure.measurement.addDihedral(e[0].loci,e[1].loci,e[2].loci,e[3].loci)},this.addLabel=()=>{const e=this.plugin.managers.structure.selection.additionsHistory
this.plugin.managers.structure.measurement.addLabel(e[0].loci)},this.addOrientation=()=>{const e=[]
this.plugin.managers.structure.selection.entries.forEach(t=>{e.push(t.selection)}),this.plugin.managers.structure.measurement.addOrientation(e)},this.addPlane=()=>{const e=[]
this.plugin.managers.structure.selection.entries.forEach(t=>{e.push(t.selection)}),this.plugin.managers.structure.measurement.addPlane(e)},this.selectAction=e=>{this.toggleAdd(),e&&(null==e?void 0:e.value)()},this.toggleAdd=()=>this.setState({action:"add"===this.state.action?void 0:"add"}),this.toggleOptions=()=>this.setState({action:"options"===this.state.action?void 0:"options"})}componentDidMount(){this.subscribe(this.selection.events.additionsHistoryUpdated,()=>{this.forceUpdate(),this.updateOrderLabels()}),this.subscribe(this.plugin.behaviors.state.isBusy,e=>{this.setState({isBusy:e})})}componentWillUnmount(){this.clearOrderLabels(),super.componentWillUnmount()}componentDidUpdate(e,t){this.state.action!==t.action&&this.updateOrderLabels()}clearOrderLabels(){this.plugin.managers.structure.measurement.addOrderLabels([])}updateOrderLabels(){if("add"!==this.state.action)return void this.clearOrderLabels()
const e=[],t=this.selection.additionsHistory
for(let n=0;n<t.length&&n<4;n++)e.push(t[n].loci)
this.plugin.managers.structure.measurement.addOrderLabels(e)}get selection(){return this.plugin.managers.structure.selection}get actions(){const e=this.selection.additionsHistory
return[{kind:"item",label:"Label "+(0===e.length?" (1 selection item required)":" (1st selection item)"),value:this.addLabel,disabled:0===e.length},{kind:"item",label:"Distance "+(e.length<2?" (2 selection items required)":" (top 2 selection items)"),value:this.measureDistance,disabled:e.length<2},{kind:"item",label:"Angle "+(e.length<3?" (3 selection items required)":" (top 3 items)"),value:this.measureAngle,disabled:e.length<3},{kind:"item",label:"Dihedral "+(e.length<4?" (4 selection items required)":" (top 4 selection items)"),value:this.measureDihedral,disabled:e.length<4},{kind:"item",label:"Orientation "+(0===e.length?" (selection required)":" (current selection)"),value:this.addOrientation,disabled:0===e.length},{kind:"item",label:"Plane "+(0===e.length?" (selection required)":" (current selection)"),value:this.addPlane,disabled:0===e.length}]}highlight(e){this.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:e},!1)}moveHistory(e,t){this.plugin.managers.structure.selection.modifyHistory(e,t,4)}focusLoci(e){this.plugin.managers.camera.focusLoci(e)}historyEntry(e,t){const n=this.plugin.managers.structure.selection.additionsHistory
return(0,a.jsxs)("div",{className:"msp-flex-row",onMouseEnter:()=>this.highlight(e.loci),onMouseLeave:()=>this.plugin.managers.interactivity.lociHighlights.clearHighlights(),children:[(0,a.jsxs)(Pr.$n,{noOverflow:!0,title:"Click to focus. Hover to highlight.",onClick:()=>this.focusLoci(e.loci),style:{width:"auto",textAlign:"left"},children:[t,". ",(0,a.jsx)("span",{dangerouslySetInnerHTML:{__html:e.label}})]}),n.length>1&&(0,a.jsx)(Pr.K0,{svg:Br.p8,small:!0,className:"msp-form-control",onClick:()=>this.moveHistory(e,"up"),flex:"20px",title:"Move up"}),n.length>1&&(0,a.jsx)(Pr.K0,{svg:Br.qp,small:!0,className:"msp-form-control",onClick:()=>this.moveHistory(e,"down"),flex:"20px",title:"Move down"}),(0,a.jsx)(Pr.K0,{svg:Br.mf,small:!0,className:"msp-form-control",onClick:()=>this.plugin.managers.structure.selection.modifyHistory(e,"remove"),flex:!0,title:"Remove"})]},e.id)}add(){const e=this.plugin.managers.structure.selection.additionsHistory,t=[]
for(let r=0,i=Math.min(e.length,4);r<i;r++)t.push(this.historyEntry(e[r],r+1))
const n=this.plugin.config.get(go.PluginConfig.Viewport.ShowSelectionMode)?(0,a.jsxs)(a.Fragment,{children:[" ","(toggle ",(0,a.jsx)(Ro,{inline:!0})," mode)"]}):null
return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Gi.W,{items:this.actions,onSelect:this.selectAction}),t.length>0&&(0,a.jsx)("div",{className:"msp-control-offset",children:t}),0===t.length&&(0,a.jsx)("div",{className:"msp-control-offset msp-help-text",children:(0,a.jsxs)("div",{className:"msp-help-description",children:[(0,a.jsx)(Br.In,{svg:Br.ml,inline:!0}),"Add one or more selections",n]})})]})}render(){return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"msp-flex-row",children:[(0,a.jsx)(Pr.ff,{icon:Br.CR,label:"Add",toggle:this.toggleAdd,isSelected:"add"===this.state.action,disabled:this.state.isBusy,className:"msp-btn-apply-simple"}),(0,a.jsx)(Pr.ff,{icon:Br.Hk,label:"",title:"Options",toggle:this.toggleOptions,isSelected:"options"===this.state.action,disabled:this.state.isBusy,style:{flex:"0 0 40px",padding:0}})]}),"add"===this.state.action&&this.add(),"options"===this.state.action&&(0,a.jsx)(Qo,{})]})}}class Qo extends l.jB{constructor(){super(...arguments),this.state={isDisabled:!1},this.changed=e=>{this.plugin.managers.structure.measurement.setOptions(e)}}componentDidMount(){this.subscribe(this.plugin.managers.structure.measurement.behaviors.state,()=>{this.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,e=>{this.setState({isDisabled:e})})}render(){const e=this.plugin.managers.structure.measurement.state
return(0,a.jsx)("div",{className:"msp-control-offset",children:(0,a.jsx)(Er.y1,{params:po,values:e.options,onChangeValues:this.changed,isDisabled:this.state.isDisabled})})}}class $o extends l.jB{constructor(){super(...arguments),this.state={showUpdate:!1},this.delete=()=>{Ir.PluginCommands.State.RemoveObject(this.plugin,{state:this.props.cell.parent,ref:this.props.cell.transform.parent,removeParentGhosts:!0})},this.toggleVisibility=e=>{e.preventDefault(),Ir.PluginCommands.State.ToggleVisibility(this.plugin,{state:this.props.cell.parent,ref:this.props.cell.transform.parent}),e.currentTarget.blur()},this.highlight=()=>{var e
if(!this.selections)return
this.plugin.managers.interactivity.lociHighlights.clearHighlights()
for(const n of this.lociArray)this.plugin.managers.interactivity.lociHighlights.highlight({loci:n},!1)
const t=null===(e=this.props.cell.obj)||void 0===e?void 0:e.data.repr.getAllLoci()
if(t)for(const n of t)this.plugin.managers.interactivity.lociHighlights.highlight({loci:n},!1)},this.clearHighlight=()=>{this.plugin.managers.interactivity.lociHighlights.clearHighlights()},this.toggleUpdate=()=>this.setState({showUpdate:!this.state.showUpdate}),this.focus=()=>{if(!this.selections)return
const e=Xr.Loci.getBundleBoundingSphere({loci:this.lociArray})
e&&this.plugin.managers.camera.focusSphere(e)},this.selectAction=e=>{e&&(this.setState({showUpdate:!1}),(null==e?void 0:e.value)())}}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated,e=>{this.forceUpdate()})}get selections(){var e
return null===(e=this.props.cell.obj)||void 0===e?void 0:e.data.sourceData}get lociArray(){const e=this.selections
return e?e.infos?[e.infos[0].loci]:e.pairs?e.pairs[0].loci:e.triples?e.triples[0].loci:e.quads?e.quads[0].loci:e.locis?e.locis:[]:[]}get label(){const e=this.selections
return e?e.infos?(0,yo.YQ)(e.infos[0].loci,{condensed:!0}):e.pairs?(0,yo.W8)(e.pairs[0],{condensed:!0,unitLabel:this.plugin.managers.structure.measurement.state.options.distanceUnitLabel}):e.triples?(0,yo.k0)(e.triples[0],{condensed:!0}):e.quads?(0,yo.kd)(e.quads[0],{condensed:!0}):e.locis?(0,yo.k7)(e.locis,{countsOnly:!0}):"<empty>":"<empty>"}get actions(){return this.props.cell.sourceRef,[Gi.W.Item("Select This",()=>this.plugin.managers.structure.selection.fromSelections(this.props.cell.sourceRef),{icon:Br.B7})]}render(){const{cell:e}=this.props,{obj:t}=e
return t?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"msp-flex-row",onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,children:[(0,a.jsx)("button",{className:"msp-form-control msp-control-button-label msp-no-overflow",title:"Click to focus. Hover to highlight.",onClick:this.focus,style:{width:"auto",textAlign:"left"},children:(0,a.jsx)("span",{dangerouslySetInnerHTML:{__html:this.label}})}),(0,a.jsx)(Pr.K0,{svg:e.state.isHidden?Br.qF:Br.zs,toggleState:!1,small:!0,className:"msp-form-control",onClick:this.toggleVisibility,flex:!0,title:e.state.isHidden?"Show":"Hide"}),(0,a.jsx)(Pr.K0,{svg:Br.mf,small:!0,className:"msp-form-control",onClick:this.delete,flex:!0,title:"Delete",toggleState:!1}),(0,a.jsx)(Pr.K0,{svg:Br.cv,className:"msp-form-control",onClick:this.toggleUpdate,flex:!0,title:"Actions",toggleState:this.state.showUpdate})]},t.id),this.state.showUpdate&&e.parent&&(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"msp-accent-offset",children:[(0,a.jsx)(Gi.W,{items:this.actions,onSelect:this.selectAction,noOffset:!0}),(0,a.jsx)(Pr.Yj,{header:"Options",noOffset:!0,children:(0,a.jsx)(Yi,{state:e.parent,transform:e.transform,customHeader:"none",autoHideApply:!0})})]})})]}):null}}var Xo=n(67538)
function Wo(e,t,n,r){const i=Xo.X9.indexOf(t.unit.elements,t.element),o=Or.StructureElement.Loci(t.structure,[{unit:t.unit,indices:Xo.CD.ofSingleton(i)}]),a="residue"===r?Or.StructureElement.Loci.extendToWholeResidues(o):Or.StructureElement.Loci.extendToWholeChains(o),s=Or.StructureProperties.entity.pdbx_description(t).join(", ")
for(const l of n.units){const t=Or.StructureElement.Loci(a.structure,[{unit:l,indices:a.elements[0].indices}])
let i=(0,yo.YQ)(t,{reverse:!0,hidePrefix:!0,htmlStyling:!1,granularity:r})
i||(i=(0,yo.YQ)(t,{hidePrefix:!1,htmlStyling:!1})),n.units.length>1&&(i+=` | ${t.elements[0].unit.conformation.operator.name}`)
const o={label:i,category:s,loci:t}
e.has(s)?e.get(s).push(o):e.set(s,[o])}}function Yo(e){const t=new Map,n=Or.StructureElement.Location.create(e)
for(const i of e.unitSymmetryGroups){if(!Or.Unit.isAtomic(i.units[0]))continue
n.unit=i.units[0],n.element=i.elements[0]
const e=Or.Unit.Traits.is(n.unit.traits,Or.Unit.Trait.MultiChain),r=Or.StructureProperties.entity.type(n),o="non-polymer"===r,a="branched"===r
if(Or.StructureProperties.entity.prd_id(n))Wo(t,n,i,"chain")
else if(o&&!e)Wo(t,n,i,"residue")
else if(a||o&&e){const e=n.unit,{index:r}=e.model.atomicHierarchy.residueAtomSegments
let o=-1
for(let a=0,s=e.elements.length;a<s;++a){const s=e.elements[a],l=r[s]
l!==o&&(n.element=s,Wo(t,n,i,"residue"),o=l)}}}const r=[]
return t.forEach((e,t)=>{1===e.length?r.push({label:`${t}: ${e[0].label}`,loci:e[0].loci}):e.length<2e3&&r.push(...e)}),r}class Zo extends l.dL{constructor(){super(...arguments),this.state={isBusy:!1,showAction:!1},this.getSelectionItems=(0,Hi._)(e=>{var t
const n=[]
for(const r of e){const e=null===(t=r.cell.obj)||void 0===t?void 0:t.data
if(e){const t=Yo(e)
t.length>0&&n.push([Gi.W.Header(e.label,{description:e.label}),...Gi.W.createItems(t,{label:e=>e.label,category:e=>e.category,description:e=>e.label})])}}return n}),this.selectAction=(e,t)=>{if(!e||!this.state.showAction)return void this.setState({showAction:!1})
const n=e.value;(null==t?void 0:t.shiftKey)?this.plugin.managers.structure.focus.addFromLoci(n.loci):this.plugin.managers.structure.focus.set(n),this.focusCamera()},this.toggleAction=()=>this.setState({showAction:!this.state.showAction}),this.focusCamera=()=>{const{current:e}=this.plugin.managers.structure.focus
e&&this.plugin.managers.camera.focusLoci(e.loci)},this.clear=()=>{this.plugin.managers.structure.focus.clear(),this.plugin.managers.camera.reset()},this.highlightCurrent=()=>{const{current:e}=this.plugin.managers.structure.focus
e&&this.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:e.loci},!1)},this.clearHighlights=()=>{this.plugin.managers.interactivity.lociHighlights.clearHighlights()}}componentDidMount(){this.subscribe(this.plugin.managers.structure.focus.behaviors.current,e=>{this.getSelectionItems([]),this.forceUpdate()}),this.subscribe(this.plugin.managers.structure.focus.events.historyUpdated,e=>{this.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,e=>{this.setState({isBusy:e,showAction:!1})})}get isDisabled(){return this.state.isBusy||0===this.plugin.managers.structure.hierarchy.selection.structures.length}get actionItems(){const e=[],{history:t}=this.plugin.managers.structure.focus
t.length>0&&e.push([Gi.W.Header("History",{description:"Previously focused on items."}),...Gi.W.createItems(t,{label:e=>e.label,description:e=>e.category&&e.label!==e.category?`${e.category} | ${e.label}`:e.label})])
const n=this.getSelectionItems(this.plugin.managers.structure.hierarchy.selection.structures)
1===n.length&&(n[0][0].initiallyExpanded=!0)
const r=[]
return n.length>0&&r.push(...n),e.length>0&&r.push(...e),r}getToggleBindingLabel(){var e
const t=this.plugin.state.behaviors.transforms.get(Io.FocusLoci.id)
if(!t)return""
const n=null===(e=t.params)||void 0===e?void 0:e.bindings.clickFocus
return!n||Ao.O.isEmpty(n)?"":Ao.O.formatTriggers(n)}render(){const{current:e}=this.plugin.managers.structure.focus,t=(null==e?void 0:e.label)||"Nothing Focused"
let n="Click to Center Camera"
if(!e){n="Select focus using the menu"
const e=this.getToggleBindingLabel()
e&&(n+=`\nor use '${e}' on element`)}return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"msp-flex-row",children:[(0,a.jsx)(Pr.$n,{noOverflow:!0,onClick:this.focusCamera,title:n,onMouseEnter:this.highlightCurrent,onMouseLeave:this.clearHighlights,disabled:this.isDisabled||!e,style:{textAlignLast:e?"left":void 0},children:t}),e&&(0,a.jsx)(Pr.K0,{svg:Br.XD,onClick:this.clear,title:"Clear",className:"msp-form-control",flex:!0,disabled:this.isDisabled}),(0,a.jsx)(Pr.ff,{icon:Br.vC,title:"Select a focus target to center on an show its surroundings. Hold shift to focus on multiple targets.",toggle:this.toggleAction,isSelected:this.state.showAction,disabled:this.isDisabled,style:{flex:"0 0 40px",padding:0}})]}),this.state.showAction&&(0,a.jsx)(Gi.W,{items:this.actionItems,onSelect:this.selectAction})]})}}class Ko extends l.VK{constructor(){super(...arguments),this.item=e=>{var t,n,r,i,o,a,s,l,c
const u=this.plugin.managers.structure.hierarchy.seletionSet
let d
switch(e.kind){case"model":{const o=null===(t=e.cell.obj)||void 0===t?void 0:t.data
o&&Or.Model.TrajectoryInfo.get(o).size>1&&(d=`${null===(n=e.cell.obj)||void 0===n?void 0:n.data.entryId} | Model ${Or.Model.TrajectoryInfo.get(o).index+1} of ${Or.Model.TrajectoryInfo.get(o).size}`),d=`${null===(r=e.cell.obj)||void 0===r?void 0:r.data.entryId} | ${null===(i=e.cell.obj)||void 0===i?void 0:i.label}`
break}case"structure":{const t=null===(o=e.cell.obj)||void 0===o?void 0:o.data.models[0]
if(t&&Or.Model.TrajectoryInfo.get(t).size>1){d=`${t.entryId} | ${null===(a=e.cell.obj)||void 0===a?void 0:a.label} (Model ${Or.Model.TrajectoryInfo.get(t).index+1} of ${Or.Model.TrajectoryInfo.get(t).size})`
break}if(t){d=`${t.entryId} | ${null===(s=e.cell.obj)||void 0===s?void 0:s.label}`
break}d=`${null===(l=e.cell.obj)||void 0===l?void 0:l.label}`
break}default:d=null===(c=e.cell.obj)||void 0===c?void 0:c.label}return{kind:"item",label:d||e.kind,selected:u.has(e.cell.transform.ref),value:[e]}},this.getTrajectoryItems=e=>{var t
return 0===e.models.length?this.item(e):[Gi.W.Header(null===(t=e.cell.obj)||void 0===t?void 0:t.label),...e.models.map(this.getModelItems)]},this.getModelItems=e=>{var t,n,r
if(0===e.structures.length)return this.item(e)
if(1===e.structures.length){const r=this.plugin.managers.structure.hierarchy.seletionSet,i=e.structures[0]
return{label:`${null===(t=e.cell.obj)||void 0===t?void 0:t.label} | ${null===(n=i.cell.obj)||void 0===n?void 0:n.label}`,selected:r.has(i.cell.transform.ref),value:[e,i]}}return[Gi.W.Header(null===(r=e.cell.obj)||void 0===r?void 0:r.label),...e.structures.map(this.item)]},this.selectHierarchy=e=>{if(!e||0===e.length)return
const t=[]
for(const n of e)for(const e of n.value)t.push(e)
this.plugin.managers.structure.hierarchy.updateCurrent(t,e[0].selected?"remove":"add")},this.toggleHierarchy=()=>this.setState({show:"hierarchy"!==this.state.show?"hierarchy":void 0}),this.togglePreset=()=>this.setState({show:"presets"!==this.state.show?"presets":void 0}),this.applyPreset=e=>{if(this.setState({show:void 0}),!e)return
const t=this.plugin.managers.structure,{trajectories:n}=t.hierarchy.selection
t.hierarchy.applyPreset(n,e.value)},this.updateModelQueueParams=void 0,this.isUpdatingModel=!1,this.updateStructureModel=e=>{this.updateModelQueueParams=e,this._updateStructureModel()},this.updateStructure=e=>{const{selection:t}=this.plugin.managers.structure.hierarchy,n=t.structures[0]
return this.plugin.managers.structure.hierarchy.updateStructure(n,e)}}defaultState(){return{header:"Structure",isCollapsed:!1,isBusy:!1,brand:{accent:"purple",svg:Br.Rm}}}componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,()=>this.forceUpdate()),this.subscribe(this.plugin.behaviors.state.isBusy,e=>{this.setState({isBusy:e})})}get hierarchyItems(){const e=this.plugin.managers.structure.hierarchy,{current:t}=e,n=[]
return t.trajectories.length>1&&n.push([Gi.W.Header("Trajectories"),...t.trajectories.map(this.item)]),(t.models.length>1||t.trajectories.length>1)&&n.push([Gi.W.Header("Models"),...t.models.map(this.item)]),1===t.trajectories.length&&1===t.models.length?n.push(...t.structures.map(this.item)):t.structures.length>0&&n.push([Gi.W.Header("Structures"),...t.structures.map(this.item)]),n}get isEmpty(){const{structures:e,models:t,trajectories:n}=this.plugin.managers.structure.hierarchy.current
return 0===n.length&&0===t.length&&0===e.length}get label(){var e,t,n,r,i,o,a,s,l,c,u,d,p,h
const{structures:f,models:m,trajectories:g}=this.plugin.managers.structure.hierarchy.selection
if(1===f.length){const a=f[0]
return(null===(t=null===(e=a.model)||void 0===e?void 0:e.trajectory)||void 0===t?void 0:t.models)&&1===a.model.trajectory.models.length?null===(n=a.cell.obj)||void 0===n?void 0:n.data.label:a.model?`${null===(r=a.model.cell.obj)||void 0===r?void 0:r.label} | ${null===(i=a.cell.obj)||void 0===i?void 0:i.data.label}`:null===(o=a.cell.obj)||void 0===o?void 0:o.data.label}if(f.length>1){const e=f[0],t=null===(a=null==e?void 0:e.model)||void 0===a?void 0:a.trajectory
let n=!0
for(const r of f)if((null===(s=null==r?void 0:r.model)||void 0===s?void 0:s.trajectory)!==t){n=!1
break}return n&&t?`${null===(l=t.cell.obj)||void 0===l?void 0:l.label} | ${f.length} structures`:`${f.length} structures`}if(m.length>0){const e=m[0].trajectory
if(1===m.length){const t=null===(c=m[0].cell.obj)||void 0===c?void 0:c.data
return t&&Or.Model.TrajectoryInfo.get(t).size>1?`${null===(u=null==e?void 0:e.cell.obj)||void 0===u?void 0:u.label} | Model ${Or.Model.TrajectoryInfo.get(t).index+1} of ${Or.Model.TrajectoryInfo.get(t).size}`:`${null===(d=null==e?void 0:e.cell.obj)||void 0===d?void 0:d.label} | Model`}let t=!0
for(const n of m)if(n.trajectory!==e){t=!1
break}return t?`${null===(p=null==e?void 0:e.cell.obj)||void 0===p?void 0:p.label} | ${m.length} models`:`${m.length} models`}return g.length>0?1===g.length?`${null===(h=g[0].cell.obj)||void 0===h?void 0:h.label} trajectory`:`${g.length} trajectories`:0===g.length&&0===m.length&&0===f.length?"Nothing Loaded":"Nothing Selected"}get presetActions(){const e=[],{trajectories:t}=this.plugin.managers.structure.hierarchy.selection
if(0===t.length)return e
let n=this.plugin.builders.structure.hierarchy.getPresets(t[0].cell.obj)
if(t.length>1){const e=new Set(n)
for(let n=1;n<t.length;n++){const r=this.plugin.builders.structure.hierarchy.getPresets(t[n].cell.obj),i=new Set(r)
for(const t of r)i.has(t)||e.delete(t)}n=n.filter(t=>e.has(t))}for(const r of n)e.push(Gi.W.Item(r.display.name,r,{description:r.display.description}))
return e}async _updateStructureModel(){if(!this.updateModelQueueParams||this.isUpdatingModel)return
const e=this.updateModelQueueParams
this.updateModelQueueParams=void 0
try{this.isUpdatingModel=!0
const{selection:t}=this.plugin.managers.structure.hierarchy,n=t.structures[0].model
await this.plugin.state.updateTransform(this.plugin.state.data,n.cell.transform.ref,e,"Model Index")}finally{this.isUpdatingModel=!1,this._updateStructureModel()}}get modelIndex(){var e,t
const{selection:n}=this.plugin.managers.structure.hierarchy
if(1!==n.structures.length)return null
const r=n.structures[0].model
if(!r||r.cell.transform.transformer!==Ar.f.Model.ModelFromTrajectory)return null
if(!r.cell.obj||Or.Model.TrajectoryInfo.get(r.cell.obj.data).size<=1)return null
const i=null===(e=r.cell.params)||void 0===e?void 0:e.definition
return i?(0,a.jsx)(Er.y1,{params:i,values:null===(t=r.cell.params)||void 0===t?void 0:t.values,onChangeValues:this.updateStructureModel,isDisabled:this.state.isBusy}):null}get structureType(){var e
const{selection:t}=this.plugin.managers.structure.hierarchy
if(1!==t.structures.length)return null
const n=t.structures[0]
return(null===(e=n.cell.params)||void 0===e?void 0:e.definition)&&n.cell.parent?(0,a.jsx)(Yi,{state:n.cell.parent,transform:n.cell.transform,customHeader:"none",customUpdate:this.updateStructure,noMargin:!0,autoHideApply:!0}):null}get transform(){const{selection:e}=this.plugin.managers.structure.hierarchy
if(1!==e.structures.length)return null
const t=e.structures[0]
if(!t.cell.parent)return null
const n=$r.QX.tryFindDecorator(this.plugin.state.data,t.cell.transform.ref,Ar.f.Model.TransformStructureConformation)
return n?(0,a.jsx)(Pr.Yj,{header:"Conformation Transform",children:(0,a.jsx)(Yi,{state:n.parent,transform:n.transform,customHeader:"none",noMargin:!0,autoHideApply:!0})}):void 0}renderControls(){const e=this.state.isBusy||this.isEmpty,t=this.presetActions,n=this.label
return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"msp-flex-row",style:{marginTop:"1px"},children:[(0,a.jsx)(Pr.$n,{noOverflow:!0,flex:!0,onClick:this.toggleHierarchy,disabled:e,title:n,children:n}),t.length>0&&(0,a.jsx)(Pr.K0,{svg:Br.sM,className:"msp-form-control",flex:"40px",onClick:this.togglePreset,title:"Apply a structure presets to the current hierarchy.",toggleState:"presets"===this.state.show,disabled:e})]}),"hierarchy"===this.state.show&&(0,a.jsx)(Gi.W,{items:this.hierarchyItems,onSelect:this.selectHierarchy,multiselect:!0}),"presets"===this.state.show&&(0,a.jsx)(Gi.W,{items:t,onSelect:this.applyPreset}),this.modelIndex,this.structureType,this.transform,(0,a.jsxs)("div",{style:{marginTop:"6px"},children:[(0,a.jsx)(Zo,{}),(0,a.jsx)(Fo,{hideOnEmpty:!0})]})]})}}var Jo=n(90050)
function ea(e,t,n={}){const r=n
return"string"==typeof r.type||"string"==typeof r.color||"string"==typeof r.size?function(e,t,n){const r=n.type&&e.representation.volume.registry.get(n.type)||e.representation.volume.registry.default.provider,i=n.color&&e.representation.volume.themes.colorThemeRegistry.get(n.color)||e.representation.volume.themes.colorThemeRegistry.get(r.defaultColorTheme.name),o=n.size&&e.representation.volume.themes.sizeThemeRegistry.get(n.size)||e.representation.volume.themes.sizeThemeRegistry.get(r.defaultSizeTheme.name)
return ta(e,t,{type:r,typeParams:n.typeParams,color:i,colorParams:n.colorParams,size:o,sizeParams:n.sizeParams})}(e,t||Jo.f.One,n):ta(e,t||Jo.f.One,n)}function ta(e,t,n={}){const{themes:r}=e.representation.volume,i={volume:t},o=n.type||e.representation.volume.registry.default.provider,a=Vr.t.getDefaultValues(o.getParams(r,t)),s=Object.assign(a,n.typeParams),l=n.color||r.colorThemeRegistry.get(o.defaultColorTheme.name),c=Vr.t.getDefaultValues(l.getParams(i))
l.name===o.defaultColorTheme.name&&Object.assign(c,o.defaultColorTheme.props)
const u=Object.assign(c,n.colorParams),d=n.size||r.sizeThemeRegistry.get(o.defaultSizeTheme.name),p=Vr.t.getDefaultValues(d.getParams(i))
d.name===o.defaultSizeTheme.name&&Object.assign(p,o.defaultSizeTheme.props)
const h=Object.assign(p,n.sizeParams)
return{type:{name:o.name,params:s},colorTheme:{name:l.name,params:u},sizeTheme:{name:d.name,params:h}}}function na(){return{volumes:[],lazyVolumes:[],refs:new Map}}function ra(e){return{kind:"volume",cell:e,version:e.transform.version,representations:[]}}function ia(e){return{kind:"lazy-volume",cell:e,version:e.transform.version}}function oa(e,t){return{kind:"volume-representation",cell:e,version:e.transform.version,volume:t}}function aa(e,t,n,r,...i){const o=r(...i)
n.push(o),e.hierarchy.refs.set(t.transform.ref,o)
const a=e.oldHierarchy.refs.get(t.transform.ref)
return a?a.version!==t.transform.version&&(e.changed=!0):(e.added.add(o.cell.transform.ref),e.changed=!0),o}function sa(){}const la=[[function(e){return(t,n)=>!(e=>e.currentVolume)(n)&&e.is(t.obj)}(gi.O.Volume.Data),(e,t)=>{e.currentVolume=aa(e,t,e.hierarchy.volumes,ra,t)},e=>e.currentVolume=void 0],[e=>gi.O.Volume.Lazy.is(e.obj),(e,t)=>{aa(e,t,e.hierarchy.lazyVolumes,ia,t)},sa],[(e,t)=>!e.state.isGhost&&!!t.currentVolume&&gi.O.Volume.Representation3D.is(e.obj),(e,t)=>(e.currentVolume&&aa(e,t,e.currentVolume.representations,oa,t,e.currentVolume),!1),sa]]
function ca(e){if(!e||!(null==e?void 0:e.parent)||!e.parent.cells.has(e.transform.ref))return!1
const{obj:t}=e
return!(!t||t===$r.BM.Null||"ok"!==e.status&&"error"!==e.status)}function ua(e){const{cell:t}=e
ca(t)||(this.changed=!0)}function da(e){pa(this,this.tree.transforms.get(e))}function pa(e,t){const{state:n}=e,r=n.state.cells.get(t.ref)
if(!ca(r))return
let i,o=!1
for(const[s,l,c]of la)if(s(r,n)){if(!1===l(n,r)){o=!0
break}i=c
break}if(o)return
const a=e.tree.children.get(t.ref)
a&&a.size&&a.forEach(da,e),i&&i(n)}class ha extends Ur.N{get dataState(){return this.plugin.state.data}get current(){return this.sync(!1),this.state.hierarchy}get selection(){return this.sync(!1),this.state.selection}sync(e){if(!e&&this.dataState.inUpdate)return
if(this.state.syncedTree===this.dataState.tree)return void(e&&!this.state.notified&&(this.state.notified=!0,this.behaviors.selection.next({hierarchy:this.state.hierarchy,volume:this.state.selection})))
this.state.syncedTree=this.dataState.tree
const t=function(e,t){const n=function(e,t){return{state:e,oldHierarchy:t,hierarchy:na(),changed:!1,added:new Set}}(e,t||na())
return function(e,t){pa({tree:e,state:t},e.root)}(e.tree,n),t&&t.refs.forEach(ua,n),{hierarchy:n.hierarchy,added:n.added,changed:n.changed}}(this.plugin.state.data,this.current)
if(!t.changed)return
const{hierarchy:n}=t
this.state.hierarchy=n,this.state.selection?this.state.selection=n.refs.has(this.state.selection.cell.transform.ref)?n.refs.get(this.state.selection.cell.transform.ref):n.volumes[0]:this.state.selection=n.volumes[0],e?(this.state.notified=!0,this.behaviors.selection.next({hierarchy:n,volume:this.state.selection})):this.state.notified=!1}setCurrent(e){this.state.selection=e||this.state.hierarchy.volumes[0],this.behaviors.selection.next({hierarchy:this.state.hierarchy,volume:e||this.state.hierarchy.volumes[0]})}remove(e,t){if(0===e.length)return
const n=this.plugin.state.data.build()
for(const r of e)n.delete("string"==typeof r?r:r.cell.transform.ref)
return n.commit({canUndo:!!t&&"Remove"})}toggleVisibility(e,t){if(0===e.length)return
const n=void 0!==t?"show"!==t:!e[0].cell.state.isHidden
for(const r of e)(0,Nr.setSubtreeVisibility)(this.dataState,r.cell.transform.ref,n)}addRepresentation(e,t){var n
return this.dataState.build().to(e.cell).apply(Ar.f.Representation.VolumeRepresentation3D,ea(this.plugin,null===(n=e.cell.obj)||void 0===n?void 0:n.data,{type:t})).commit({canUndo:"Add Representation"})}constructor(e){super(),this.plugin=e,this.state={syncedTree:this.dataState.tree,notified:!1,hierarchy:na(),selection:void 0},this.behaviors={selection:this.ev.behavior({hierarchy:this.current,volume:this.selection})},this.subscribe(e.state.data.events.changed,t=>{t.inTransaction||e.behaviors.state.isAnimating.value||this.sync(!0)}),this.subscribe(e.behaviors.state.isAnimating,t=>{t||e.behaviors.state.isUpdating.value||this.sync(!0)})}}!function(e){e.getRepresentationTypes=function(e,t){var n,r
return(null===(n=null==t?void 0:t.cell.obj)||void 0===n?void 0:n.data)?e.representation.volume.registry.getApplicableTypes(null===(r=t.cell.obj)||void 0===r?void 0:r.data):e.representation.volume.registry.types}}(ha||(ha={}))
var fa=n(6950),ma=n(52095)
class ga extends Wi{constructor(){super(...arguments),this._getInfo=(0,Hi._)((e,t,n)=>Xi.infoFromAction(this.plugin,this.props.state,this.props.action,this.props.nodeRef)),this.state={plugin:this.plugin,ref:this.props.nodeRef,version:this.props.state.transforms.get(this.props.nodeRef).version,error:void 0,isInitial:!0,params:this.getInfo().initialValues,busy:!1,isCollapsed:this.props.initiallyCollapsed}}applyAction(){return Ir.PluginCommands.State.ApplyAction(this.plugin,{state:this.props.state,action:this.props.action.create(this.state.params),ref:this.props.nodeRef})}getInfo(){var e
return this._getInfo(this.props.nodeRef,this.props.state.transforms.get(this.props.nodeRef).version,null===(e=this.state)||void 0===e?void 0:e.isCollapsed)}getTransformerId(){return this.props.state.transforms.get(this.props.nodeRef).transformer.id}getHeader(){return this.props.hideHeader?"none":this.props.action.definition.display}canApply(){return!this.state.error&&!this.state.busy}canAutoApply(){return!1}applyText(){return"Apply"}isUpdate(){return!1}getSourceAndTarget(){return{a:this.props.state.cells.get(this.props.nodeRef).obj}}static getDerivedStateFromProps(e,t){const n=e.state.transforms.get(e.nodeRef).version
if(e.nodeRef===t.ref&&n===t.version)return null
const r=e.state.cells.get(e.nodeRef).obj,i=e.action.definition.params?Vr.t.getDefaultValues(e.action.definition.params(r,t.plugin)):{}
return{plugin:t.plugin,ref:e.nodeRef,version:n,params:i,isInitial:!0,error:void 0}}}var ya=n(30372),va=n(68569)
class ba extends l.VK{defaultState(){return{header:"Volume Streaming",isCollapsed:!1,isBusy:!1,isHidden:!0,brand:{accent:"cyan",svg:Br.Fi}}}componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,()=>{this.setState({isHidden:!this.canEnable(),description:Ui.getSelectedStructuresDescription(this.plugin)})}),this.subscribe(this.plugin.state.events.cell.stateUpdated,e=>{$r.Cn.hasTag(e.cell.transform,yi.h.RootTag)&&this.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,e=>{this.setState({isBusy:e})})}get pivot(){return this.plugin.managers.structure.hierarchy.selection.structures[0]}canEnable(){var e,t
const{selection:n}=this.plugin.managers.structure.hierarchy
if(1!==n.structures.length)return!1
const r=this.pivot.cell
return!!r.obj&&!!(null===(t=(e=fa.p3.definition).isApplicable)||void 0===t?void 0:t.call(e,r.obj,r.transform,this.plugin))}renderEnable(){var e,t
const n=this.pivot
if(!n.cell.parent)return null
const r=$r.QX.findTagInSubtree(n.cell.parent.tree,this.pivot.cell.transform.ref,yi.h.RootTag),i=r&&n.cell.parent.cells.get(r),o=i&&"error"===i.status?{header:i.errorText&&(null===(e=i.errorText)||void 0===e?void 0:e.includes("404"))?"No Density Data Available":"Error Enabling",icon:Br.Bw,title:i.errorText}:i&&0===(null===(t=i.obj)||void 0===t?void 0:t.data.entries.length)?{header:"Error Enabling",icon:Br.Bw,title:"No Entry for Streaming Found"}:{header:"Enable",icon:Br.Xq,title:"Enable"}
return(0,a.jsx)(ga,{state:n.cell.parent,action:fa.p3,initiallyCollapsed:!0,nodeRef:n.cell.transform.ref,simpleApply:o})}renderParams(){var e,t,n,r,i
const o=this.pivot
if(!o.cell.parent)return null
const s="selection-box"===(null===(t=null===(e=o.volumeStreaming)||void 0===e?void 0:e.cell.transform.params)||void 0===t?void 0:t.entry.params.view.name)&&(null===(i=null===(r=null===(n=this.plugin.state.behaviors.cells.get(Io.FocusLoci.id))||void 0===n?void 0:n.params)||void 0===r?void 0:r.values)||void 0===i?void 0:i.bindings)
return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Yi,{state:o.cell.parent,transform:o.volumeStreaming.cell.transform,customHeader:"none",noMargin:!0}),s&&(0,a.jsx)(Pr.Yj,{header:"Controls Help",children:(0,a.jsx)(Po,{bindings:s})})]})}renderControls(){const e=this.pivot
return e?e.volumeStreaming?this.renderParams():this.renderEnable():null}}class xa extends l.VK{constructor(){super(...arguments),this.item=e=>{var t
const n=this.plugin.managers.volume.hierarchy.selection,r=(null===(t=e.cell.obj)||void 0===t?void 0:t.label)||"Volume"
return{kind:"item",label:("lazy-volume"===e.kind?"Load ":"")+(r||e.kind),selected:n===e,value:e}},this.selectCurrent=e=>{if(this.toggleHierarchy(),!e)return
const t=e.value
"volume"===t.kind?this.plugin.managers.volume.hierarchy.setCurrent(t):this.lazyLoad(t.cell)},this.selectAdd=e=>{e&&(this.setState({show:void 0}),e.value())},this.toggleHierarchy=()=>this.setState({show:"hierarchy"!==this.state.show?"hierarchy":void 0}),this.toggleAddRepr=()=>this.setState({show:"add-repr"!==this.state.show?"add-repr":void 0}),this.toggleVisibility=()=>{var e,t
const n=this.plugin.managers.volume.hierarchy,{current:r}=n,i=!(null===(t=null===(e=r.volumes[0])||void 0===e?void 0:e.representations[0])||void 0===t?void 0:t.cell.state.isHidden)
this.plugin.managers.volume.hierarchy.toggleVisibility(r.volumes.flatMap(e=>e.representations),i?"hide":"show")}}defaultState(){return{header:"Volume",isCollapsed:!1,isBusy:!1,isHidden:!0,brand:{accent:"purple",svg:Br.Fi}}}componentDidMount(){this.subscribe(this.plugin.managers.volume.hierarchy.behaviors.selection,e=>{this.setState({isHidden:0===e.hierarchy.volumes.length&&0===e.hierarchy.lazyVolumes.length})}),this.subscribe(this.plugin.behaviors.state.isBusy,e=>{this.setState({isBusy:e})})}get hierarchyItems(){const e=this.plugin.managers.volume.hierarchy,{current:t}=e,n=[]
for(const r of t.volumes)n.push(this.item(r))
for(const r of t.lazyVolumes)n.push(this.item(r))
return n}get addActions(){const e=this.plugin.managers.volume.hierarchy,t=e.selection
return[...ha.getRepresentationTypes(this.plugin,t).map(n=>Gi.W.Item(n[1],()=>e.addRepresentation(t,n[0])))]}get isEmpty(){const{volumes:e,lazyVolumes:t}=this.plugin.managers.volume.hierarchy.current
return 0===e.length&&0===t.length}get label(){var e
if(this.state.loadingLabel)return`Loading ${this.state.loadingLabel}...`
const t=this.plugin.managers.volume.hierarchy.selection
return t?(null===(e=null==t?void 0:t.cell.obj)||void 0===e?void 0:e.label)||"Volume":"Nothing Selected"}async lazyLoad(e){const{url:t,isBinary:n,format:r,entryId:i,isovalues:o}=e.obj.data
this.setState({isBusy:!0,loadingLabel:e.obj.label})
try{const a=this.plugin
await a.dataTransaction(async()=>{var s,l,c,u
const d=await a.builders.data.download({url:t,isBinary:n},{state:{isGhost:!0}}),p=await a.dataFormats.get(r).parse(a,d,{entryId:i}),h=p.volume||p.volumes[0]
if(!(null==h?void 0:h.isOk))throw new Error("Failed to parse any volume.")
const f=a.build()
for(const e of o)f.to(null!==(c=null===(s=p.volumes)||void 0===s?void 0:s[null!==(l=e.volumeIndex)&&void 0!==l?l:0])&&void 0!==c?c:p.volume).apply(Ar.f.Representation.VolumeRepresentation3D,ea(this.plugin,h.data,{type:"isosurface",typeParams:{alpha:null!==(u=e.alpha)&&void 0!==u?u:1,isoValue:"absolute"===e.type?{kind:"absolute",absoluteValue:e.value}:{kind:"relative",relativeValue:e.value}},color:"uniform",colorParams:{value:e.color}}))
await f.commit(),await a.build().delete(e).commit()})}finally{this.setState({isBusy:!1,loadingLabel:void 0})}}renderControls(){const e=this.state.isBusy||this.isEmpty,t=this.label,n=this.plugin.managers.volume.hierarchy.selection,r=this.plugin.managers.volume.hierarchy,{current:i}=r
return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"msp-flex-row",style:{marginTop:"1px"},children:[(0,a.jsx)(Pr.$n,{noOverflow:!0,flex:!0,onClick:this.toggleHierarchy,disabled:e,title:t,children:t}),!this.isEmpty&&n&&(0,a.jsx)(Pr.K0,{svg:Br.CR,onClick:this.toggleAddRepr,title:"Apply a structure presets to the current hierarchy.",toggleState:"add-repr"===this.state.show,disabled:e}),!this.isEmpty&&(0,a.jsx)(Pr.K0,{svg:Br.zs,onClick:this.toggleVisibility,toggleState:!1,title:"Toggle visibility of all volumes.",disabled:e})]}),"hierarchy"===this.state.show&&(0,a.jsx)(Gi.W,{items:this.hierarchyItems,onSelect:this.selectCurrent}),"add-repr"===this.state.show&&(0,a.jsx)(Gi.W,{items:this.addActions,onSelect:this.selectAdd}),i.volumes.length>0&&(0,a.jsx)("div",{style:{marginTop:"6px"},children:i.volumes.map(e=>(0,a.jsx)(Sa,{volume:e},e.cell.transform.ref))})]})}}function Sa({volume:e}){var t,n
return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"msp-control-group-header",style:{marginTop:"1px"},children:(0,a.jsx)("div",{children:(0,a.jsx)("b",{children:null!==(n=null===(t=e.cell.obj)||void 0===t?void 0:t.label)&&void 0!==n?n:"n/a"})})}),e.representations.map(t=>(0,a.jsx)(_a,{volume:e,representation:t},t.cell.transform.ref))]})}class _a extends l.jB{constructor(){super(...arguments),this.state={action:void 0},this.updateIsoValueEvent=new ya.B,this.remove=()=>this.plugin.managers.volume.hierarchy.remove([this.props.representation],!0),this.toggleVisible=e=>{e.preventDefault(),e.currentTarget.blur(),this.plugin.managers.volume.hierarchy.toggleVisibility([this.props.representation])},this.toggleColor=()=>{this.setState({action:"select-color"===this.state.action?void 0:"select-color"})},this.toggleUpdate=()=>this.setState({action:"update"===this.state.action?void 0:"update"}),this.highlight=e=>{e.preventDefault(),this.props.representation.cell.parent&&Ir.PluginCommands.Interactivity.Object.Highlight(this.plugin,{state:this.props.representation.cell.parent,ref:this.props.representation.cell.transform.ref})},this.clearHighlight=e=>{e.preventDefault(),Ir.PluginCommands.Interactivity.ClearHighlights(this.plugin)},this.focus=()=>{var e
const t=this.props.representation,n=null===(e=t.cell.obj)||void 0===e?void 0:e.data.repr.getAllLoci()
t.cell.state.isHidden&&this.plugin.managers.volume.hierarchy.toggleVisibility([this.props.representation],"show"),n&&this.plugin.managers.camera.focusLoci(n,{extraRadius:1})},this.updateColor=({value:e})=>{const t=this.props.representation.cell.transform
return this.plugin.build().to(t.ref).update({...t.params,colorTheme:{name:"uniform",params:{value:e}}}).commit()},this.requestIsoValueUpdate=e=>{this.updateIsoValueEvent.next(e)},this.updateIsoValue=e=>{var t,n
const r=this.props.representation.cell.transform
return this.plugin.build().to(r.ref).update({...r.params,type:{...null===(t=r.params)||void 0===t?void 0:t.type,params:{...null===(n=r.params)||void 0===n?void 0:n.type.params,isoValue:e.isoValue}}}).commit()},this.isoValueParams=(0,Hi._)((e,t)=>{var n,r
const i=this.props.representation.cell.transform.params
if("isosurface"===(null==i?void 0:i.type.name))return{isoValue:Jo.f.createIsoValueParam(i.type.params.isoValue,null===(r=null===(n=this.props.volume.cell.obj)||void 0===n?void 0:n.data.grid)||void 0===r?void 0:r.stats)}})}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated,e=>{$r.Uw.ObjectEvent.isCell(e,this.props.representation.cell)&&this.forceUpdate()}),this.subscribe(this.updateIsoValueEvent.pipe((0,va.c)(100,void 0,{leading:!1,trailing:!0})),this.updateIsoValue)}get color(){var e,t
const n=this.props.representation.cell
if("uniform"===(null===(e=n.transform.params)||void 0===e?void 0:e.colorTheme.name))return null===(t=n.transform.params)||void 0===t?void 0:t.colorTheme.params.value}get isIsoSurface(){var e
return"isosurface"===(null===(e=this.props.representation.cell.transform.params)||void 0===e?void 0:e.type.name)}render(){var e,t,n
const r=this.props.representation.cell,i=r.transform.params,o=this.color,s=this.isoValueParams(r.transform.ref,null==i?void 0:i.type.name)
return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"msp-flex-row",children:[void 0!==o&&(0,a.jsx)(Pr.$n,{style:{backgroundColor:lo.Color.toStyle(o),minWidth:32,width:32},onClick:this.toggleColor}),(0,a.jsxs)(Pr.$n,{noOverflow:!0,className:"msp-control-button-label",title:`${null===(e=r.obj)||void 0===e?void 0:e.label}. Click to focus.`,onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:"left"},children:[null===(t=r.obj)||void 0===t?void 0:t.label,(0,a.jsx)("small",{className:"msp-25-lower-contrast-text",style:{float:"right"},children:null===(n=r.obj)||void 0===n?void 0:n.description})]}),(0,a.jsx)(Pr.K0,{svg:r.state.isHidden?Br.qF:Br.zs,toggleState:!1,onClick:this.toggleVisible,title:(r.state.isHidden?"Show":"Hide")+" component",small:!0,className:"msp-form-control",flex:!0}),(0,a.jsx)(Pr.K0,{svg:Br.mf,onClick:this.remove,title:"Remove",small:!0}),(0,a.jsx)(Pr.K0,{svg:Br.cv,onClick:this.toggleUpdate,title:"Actions",toggleState:"update"===this.state.action})]}),"update"===this.state.action&&!!r.parent&&(0,a.jsx)("div",{style:{marginBottom:"6px"},className:"msp-accent-offset",children:(0,a.jsxs)("div",{children:[!!s&&(0,a.jsx)("div",{style:{marginBottom:"1px"},children:(0,a.jsx)(Er.y1,{params:s,values:{isoValue:null==i?void 0:i.type.params.isoValue},onChangeValues:this.requestIsoValueUpdate})}),(0,a.jsx)(Yi,{state:r.parent,transform:r.transform,customHeader:"none",noMargin:!0})]})}),"select-color"===this.state.action&&void 0!==o&&(0,a.jsx)("div",{style:{marginBottom:"6px",marginTop:1},className:"msp-accent-offset",children:(0,a.jsx)(Pr.tW,{header:"Select Color",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleColor,topRightIcon:Br.X6,noTopMargin:!0,childrenClassName:"msp-viewport-controls-panel-controls",children:(0,a.jsx)(ma.cq,{param:Ca,value:this.color,onChange:this.updateColor,name:"color",hideNameRow:!0})})})]})}}const Ca=Vr.t.Color((0,lo.Color)(1184274))
var wa,Ta=n(32775),Aa=n(40615),Ia=n(39250),Pa=n(57523)
function Ba(e,t){if(Math.abs(e)>Math.abs(t)){const n=t/e
return Math.abs(e)*Math.sqrt(1+n*n)}if(0!==t){const n=e/t
return Math.abs(t)*Math.sqrt(1+n*n)}return 0}!function(e){e.createCache=function(e){return{size:e,matrix:Pa.u.create(e,e),eigenValues:new Float64Array(e),D:new Float64Array(e),E:new Float64Array(e)}},e.compute=function(e){!function(e,t,n,r,i){for(let a=0;a<e;a++)i[a]=0
const o=e-1
for(let a=0;a<e;a++)r[a]=t[a*e+o];(function(e,t,n,r){for(let i=r-1;i>0;i--){let o=0,a=0
for(let e=0;e<i;e++)o+=Math.abs(t[e])
if(0===o){n[i]=t[i-1]
for(let n=0;n<i;n++)t[n]=e[n*r+i-1],e[n*r+i]=0,e[i*r+n]=0}else{for(let e=0;e<i;e++)t[e]/=o,a+=t[e]*t[e]
let s=t[i-1],l=Math.sqrt(a)
s>0&&(l=-l),n[i]=o*l,a-=s*l,t[i-1]=s-l
for(let e=0;e<i;e++)n[e]=0
for(let o=0;o<i;o++){s=t[o],e[i*r+o]=s,l=n[o]+e[o*r+o]*s
for(let a=o+1;a<=i-1;a++)l+=e[o*r+a]*t[a],n[a]+=e[o*r+a]*s
n[o]=l}s=0
for(let e=0;e<i;e++)n[e]/=a,s+=n[e]*t[e]
const c=s/(a+a)
for(let e=0;e<i;e++)n[e]-=c*t[e]
for(let o=0;o<i;o++){s=t[o],l=n[o]
for(let a=o;a<=i-1;a++)e[o*r+a]-=s*n[a]+l*t[a]
t[o]=e[o*r+i-1],e[o*r+i]=0}}t[i]=a}for(let i=0;i<r-1;i++){e[i*r+r-1]=e[i*r+i],e[i*r+i]=1
const n=t[i+1]
if(0!==n){for(let o=0;o<=i;o++)t[o]=e[(i+1)*r+o]/n
for(let n=0;n<=i;n++){let o=0
for(let t=0;t<=i;t++)o+=e[(i+1)*r+t]*e[n*r+t]
for(let a=0;a<=i;a++)e[n*r+a]-=o*t[a]}}for(let t=0;t<=i;t++)e[(i+1)*r+t]=0}for(let i=0;i<r;i++)t[i]=e[i*r+r-1],e[i*r+r-1]=0
e[r*r-1]=1,n[0]=0})(t,r,i,e),function(e,t,n,r){for(let s=1;s<r;s++)n[s-1]=n[s]
n[r-1]=0
let i=0,o=0
const a=Math.pow(2,-53)
for(let s=0;s<r;s++){o=Math.max(o,Math.abs(t[s])+Math.abs(n[s]))
let l=s
for(;l<r&&!(Math.abs(n[l])<=a*o);)l++
if(l>s){let c=0
do{c+=1
let o=t[s],a=(t[s+1]-o)/(2*n[s]),u=Ba(a,1)
a<0&&(u=-u),t[s]=n[s]/(a+u),t[s+1]=n[s]*(a+u)
const d=t[s+1]
let p=o-t[s]
for(let e=s+2;e<r;e++)t[e]-=p
i+=p,a=t[l]
let h=1,f=h,m=h
const g=n[s+1]
let y=0,v=0
for(let i=l-1;i>=s;i--){m=f,f=h,v=y,o=h*n[i],p=h*a,u=Ba(a,n[i]),n[i+1]=y*u,y=n[i]/u,h=a/u,a=h*t[i]-y*o,t[i+1]=p+y*(h*o+y*t[i])
for(let t=0;t<r;t++)p=e[(i+1)*r+t],e[(i+1)*r+t]=y*e[i*r+t]+h*p,e[i*r+t]=h*e[i*r+t]-y*p}if(a=-y*v*m*g*n[s]/d,n[s]=y*a,t[s]=h*a,c>=1e3)throw new Error("SVD: Not converging.")}while(Math.abs(n[s])>a*o)}t[s]=t[s]+i,n[s]=0}for(let s=0;s<r-1;s++){let n=s,i=t[s]
for(let e=s+1;e<r;e++)t[e]<i&&(n=e,i=t[e])
if(n!==s){t[n]=t[s],t[s]=i
for(let t=0;t<r;t++)i=e[s*r+t],e[s*r+t]=e[n*r+t],e[n*r+t]=i}}}(t,r,i,e)
for(let a=0;a<e;a++)n[a]=r[a]}(e.size,e.matrix.data,e.eigenValues,e.D,e.E)}}(wa||(wa={}))
var Ea,ka=n(63317),Da=n(25919)
!function(e){let t
!function(e){e.empty=function(e){return{x:new Float64Array(e),y:new Float64Array(e),z:new Float64Array(e)}}}(t=e.Positions||(e.Positions={})),e.compute=function(e,t){return null!=t||(t={bTransform:Ia.$.zero(),rmsd:0,nAlignedElements:0}),function(e){const t=function(e){const t=e.evdCache.matrix
Pa.u.makeZero(t)
const n=e.a.x,r=e.a.y,i=e.a.z,o=e.b.x,a=e.b.y,s=e.b.z,l=e.centerA,c=e.centerB
let u=0
const d=Math.min(e.a.x.length,e.b.x.length)
for(let p=0;p<d;p++){const e=n[p]-l[0],d=r[p]-l[1],h=i[p]-l[2],f=o[p]-c[0],m=a[p]-c[1],g=s[p]-c[2]
u+=e*e+d*d+h*h+f*f+m*m+g*g,Pa.u.add(t,0,0,e*f+d*m+h*g),Pa.u.add(t,0,1,-h*m+d*g),Pa.u.add(t,0,2,h*f-e*g),Pa.u.add(t,0,3,-d*f+e*m),Pa.u.add(t,1,0,-h*m+d*g),Pa.u.add(t,1,1,e*f-d*m-h*g),Pa.u.add(t,1,2,d*f+e*m),Pa.u.add(t,1,3,h*f+e*g),Pa.u.add(t,2,0,h*f-e*g),Pa.u.add(t,2,1,d*f+e*m),Pa.u.add(t,2,2,-e*f+d*m-h*g),Pa.u.add(t,2,3,h*m+d*g),Pa.u.add(t,3,0,-d*f+e*m),Pa.u.add(t,3,1,h*f+e*g),Pa.u.add(t,3,2,h*m+d*g),Pa.u.add(t,3,3,-e*f-d*m+h*g)}return u}(e)
wa.compute(e.evdCache)
let n=t-2*e.evdCache.eigenValues[3]
n=n<0?0:Math.sqrt(n/e.a.x.length),function(e){const t=e.evdCache.matrix,n=Pa.u.get(t,1,3),r=Pa.u.get(t,2,3),i=Pa.u.get(t,3,3),o=Pa.u.get(t,0,3),a=2*r*r,s=2*i*i,l=2*n*n,c=2*n*r,u=2*o*i,d=2*n*i,p=2*o*r,h=2*r*i,f=2*o*n
let m=e.translateB
Ia.$.setValue(m,0,3,-e.centerB[0]),Ia.$.setValue(m,1,3,-e.centerB[1]),Ia.$.setValue(m,2,3,-e.centerB[2]),m=e.rotateB,Ia.$.setValue(m,0,0,1-a-s),Ia.$.setValue(m,0,1,c+u),Ia.$.setValue(m,0,2,d-p),Ia.$.setValue(m,1,0,c-u),Ia.$.setValue(m,1,1,1-l-s),Ia.$.setValue(m,1,2,h+f),Ia.$.setValue(m,2,0,d+p),Ia.$.setValue(m,2,1,h-f),Ia.$.setValue(m,2,2,1-l-a),Ia.$.setValue(m,3,3,1),Ia.$.mul(e.tempMatrix,e.rotateB,e.translateB),m=e.translateB,Ia.$.setValue(m,0,3,e.centerA[0]),Ia.$.setValue(m,1,3,e.centerA[1]),Ia.$.setValue(m,2,3,e.centerA[2]),Ia.$.mul(e.result.bTransform,e.translateB,e.tempMatrix)}(e),e.result.rmsd=n,e.result.nAlignedElements=e.a.x.length}(new Ma(e,t)),t}}(Ea||(Ea={}))
class Ma{constructor(e,t){this.evdCache=wa.createCache(4),this.translateB=Ia.$.identity(),this.rotateB=Ia.$.identity(),this.tempMatrix=Ia.$.identity(),this.a=e.a,this.b=e.b,e.centerA?this.centerA=e.centerA:this.centerA=e.centerA=Da.p.fromArrays(e.a,(0,ka.f)()).center,e.centerB?this.centerB=e.centerB:this.centerB=e.centerB=Da.p.fromArrays(e.b,(0,ka.f)()).center,this.result=t}}var Ra=n(66588),Oa=n(44688)
function La(e,t){let n,r=0
const i={}
return t.forEach(t=>{n=0
const o={}
t.forEach(t=>o[e[n++]]=t),i[e[r++]]=o}),i}const Na={blosum62:La("ARNDCQEGHILKMFPSTWYVBZX",[[4,-1,-2,-2,0,-1,-1,0,-2,-1,-1,-1,-1,-2,-1,1,0,-3,-2,0,-2,-1,0],[-1,5,0,-2,-3,1,0,-2,0,-3,-2,2,-1,-3,-2,-1,-1,-3,-2,-3,-1,0,-1],[-2,0,6,1,-3,0,0,0,1,-3,-3,0,-2,-3,-2,1,0,-4,-2,-3,3,0,-1],[-2,-2,1,6,-3,0,2,-1,-1,-3,-4,-1,-3,-3,-1,0,-1,-4,-3,-3,4,1,-1],[0,-3,-3,-3,9,-3,-4,-3,-3,-1,-1,-3,-1,-2,-3,-1,-1,-2,-2,-1,-3,-3,-2],[-1,1,0,0,-3,5,2,-2,0,-3,-2,1,0,-3,-1,0,-1,-2,-1,-2,0,3,-1],[-1,0,0,2,-4,2,5,-2,0,-3,-3,1,-2,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-2,0,-1,-3,-2,-2,6,-2,-4,-4,-2,-3,-3,-2,0,-2,-2,-3,-3,-1,-2,-1],[-2,0,1,-1,-3,0,0,-2,8,-3,-3,-1,-2,-1,-2,-1,-2,-2,2,-3,0,0,-1],[-1,-3,-3,-3,-1,-3,-3,-4,-3,4,2,-3,1,0,-3,-2,-1,-3,-1,3,-3,-3,-1],[-1,-2,-3,-4,-1,-2,-3,-4,-3,2,4,-2,2,0,-3,-2,-1,-2,-1,1,-4,-3,-1],[-1,2,0,-1,-3,1,1,-2,-1,-3,-2,5,-1,-3,-1,0,-1,-3,-2,-2,0,1,-1],[-1,-1,-2,-3,-1,0,-2,-3,-2,1,2,-1,5,0,-2,-1,-1,-1,-1,1,-3,-1,-1],[-2,-3,-3,-3,-2,-3,-3,-3,-1,0,0,-3,0,6,-4,-2,-2,1,3,-1,-3,-3,-1],[-1,-2,-2,-1,-3,-1,-1,-2,-2,-3,-3,-1,-2,-4,7,-1,-1,-4,-3,-2,-2,-1,-2],[1,-1,1,0,-1,0,0,0,-1,-2,-2,0,-1,-2,-1,4,1,-3,-2,-2,0,0,0],[0,-1,0,-1,-1,-1,-1,-2,-2,-1,-1,-1,-1,-2,-1,1,5,-2,-2,0,-1,-1,0],[-3,-3,-4,-4,-2,-2,-3,-2,-2,-3,-2,-3,-1,1,-4,-3,-2,11,2,-3,-4,-3,-2],[-2,-2,-2,-3,-2,-1,-2,-3,2,-1,-1,-2,-1,3,-3,-2,-2,2,7,-1,-3,-2,-1],[0,-3,-3,-3,-1,-2,-2,-3,-3,3,1,-2,1,-1,-2,-2,0,-3,-1,4,-3,-2,-1],[-2,-1,3,4,-3,0,1,-1,0,-3,-4,0,-3,-3,-2,0,-1,-4,-3,-3,4,1,-1],[-1,0,0,1,-3,3,4,-2,0,-3,-3,1,-1,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-1,-1,-1,-2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-2,0,0,-2,-1,-1,-1,-1,-1]]),blosum62x:La("ACDEFGHIKLMNPQRSTVWY",[[4,0,-2,-1,-2,0,-2,-1,-1,-1,-1,-2,-1,-1,-1,1,0,0,-3,-2],[0,9,-3,-4,-2,-3,-3,-1,-3,-1,-1,-3,-3,-3,-3,-1,-1,-1,-2,-2],[-2,-3,6,2,-3,-1,-1,-3,-1,-4,-3,1,-1,0,-2,0,-1,-3,-4,-3],[-1,-4,2,5,-3,-2,0,-3,1,-3,-2,0,-1,2,0,0,-1,-2,-3,-2],[-2,-2,-3,-3,6,-3,-1,0,-3,0,0,-3,-4,-3,-3,-2,-2,-1,1,3],[0,-3,-1,-2,-3,6,-2,-4,-2,-4,-3,0,-2,-2,-2,0,-2,-3,-2,-3],[-2,-3,-1,0,-1,-2,8,-3,-1,-3,-2,1,-2,0,0,-1,-2,-3,-2,2],[-1,-1,-3,-3,0,-4,-3,4,-3,2,1,-3,-3,-3,-3,-2,-1,3,-3,-1],[-1,-3,-1,1,-3,-2,-1,-3,5,-2,-1,0,-1,1,2,0,-1,-2,-3,-2],[-1,-1,-4,-3,0,-4,-3,2,-2,4,2,-3,-3,-2,-2,-2,-1,1,-2,-1],[-1,-1,-3,-2,0,-3,-2,1,-1,2,5,-2,-2,0,-1,-1,-1,1,-1,-1],[-2,-3,1,0,-3,0,1,-3,0,-3,-2,6,-2,0,0,1,0,-3,-4,-2],[-1,-3,-1,-1,-4,-2,-2,-3,-1,-3,-2,-2,7,-1,-2,-1,-1,-2,-4,-3],[-1,-3,0,2,-3,-2,0,-3,1,-2,0,0,-1,5,1,0,-1,-2,-2,-1],[-1,-3,-2,0,-3,-2,0,-3,2,-2,-1,0,-2,1,5,-1,-1,-3,-3,-2],[1,-1,0,0,-2,0,-1,-2,0,-2,-1,1,-1,0,-1,4,1,-2,-3,-2],[0,-1,-1,-1,-2,-2,-2,-1,-1,-1,-1,0,-1,-1,-1,1,5,0,-2,-2],[0,-1,-3,-2,-1,-3,-3,3,-2,1,1,-3,-2,-2,-3,-2,0,4,-3,-1],[-3,-2,-4,-3,1,-2,-2,-3,-3,-2,-1,-4,-4,-2,-3,-3,-2,-3,11,2],[-2,-2,-3,-2,3,-3,2,-1,-2,-1,-1,-2,-3,-1,-2,-2,-2,-1,2,7]])},Fa={gapPenalty:-11,gapExtensionPenalty:-1,substMatrix:"default"}
class za{constructor(e,t,n){this.seqA=e,this.seqB=t,this.S=[],this.V=[],this.H=[],this.gapPenalty=n.gapPenalty,this.gapExtensionPenalty=n.gapExtensionPenalty,this.substMatrix="default"===n.substMatrix?void 0:Na[n.substMatrix],this.n=this.seqA.length,this.m=this.seqB.length}initMatrices(){const{n:e,m:t,gapPenalty:n,S:r,V:i,H:o}=this
for(let a=0;a<=e;++a){r[a]=[],i[a]=[],o[a]=[]
for(let e=0;e<=t;++e)r[a][e]=0,i[a][e]=0,o[a][e]=0}for(let a=0;a<=e;++a)r[a][0]=n,o[a][0]=-1/0
for(let a=0;a<=t;++a)r[0][a]=n,i[0][a]=-1/0
r[0][0]=0}makeScoreFn(){const{seqA:e,seqB:t,substMatrix:n}=this
return n?function(r,i){var o,a
const s=e[r],l=t[i]
return null!==(a=null===(o=n[s])||void 0===o?void 0:o[l])&&void 0!==a?a:-4}:function(n,r){return e[n]===t[r]?5:-3}}calculate(){this.initMatrices()
const e=this.makeScoreFn(),{V:t,H:n,S:r,n:i,m:o,gapExtensionPenalty:a,gapPenalty:s}=this
let l,c,u,d,p
for(let h=1;h<=i;++h){c=r[h-1],l=t[h-1],u=t[h],d=n[h],p=r[h]
for(let t=1;t<=o;++t)u[t]=Math.max(c[t]+s,l[t]+a),d[t]=Math.max(p[t-1]+s,d[t-1]+a),p[t]=Math.max(c[t-1]+e(h-1,t-1),u[t],d[t])}}trace(){const e=this.makeScoreFn(),{V:t,H:n,S:r,seqA:i,seqB:o,gapExtensionPenalty:a,gapPenalty:s}=this
let l,c,u=this.n,d=this.m,p="",h=""
for(r[u][d]>=t[u][d]?(l="S",c=r[u][d]):t[u][d]>=n[u][d]?(l="V",c=t[u][d]):(l="H",c=n[u][d]);u>0&&d>0;)"S"===l?r[u][d]===r[u-1][d-1]+e(u-1,d-1)?(p=i[u-1]+p,h=o[d-1]+h,--u,--d,l="S"):r[u][d]===t[u][d]?l="V":r[u][d]===n[u][d]?l="H":(--u,--d):"V"===l?t[u][d]===t[u-1][d]+a?(p=i[u-1]+p,h="-"+h,--u,l="V"):t[u][d]===r[u-1][d]+s?(p=i[u-1]+p,h="-"+h,--u,l="S"):--u:"H"===l&&(n[u][d]===n[u][d-1]+a?(p="-"+p,h=o[d-1]+h,--d,l="H"):n[u][d]===r[u][d-1]+s?(p="-"+p,h=o[d-1]+h,--d,l="S"):--d)
for(;u>0;)p=i[u-1]+p,h="-"+h,--u
for(;d>0;)p="-"+p,h=o[d-1]+h,--d
return{aliA:p,aliB:h,score:c}}}var ja
function Va(e){return e.model.sequence.byEntityKey[function(e){switch(e.kind){case Oa.Nf.Kind.Atomic:return e.model.atomicHierarchy.index.getEntityFromChain(e.chainIndex[e.elements[0]])
case Oa.Nf.Kind.Spheres:return e.model.coarseHierarchy.spheres.entityKey[e.elements[0]]
case Oa.Nf.Kind.Gaussians:return e.model.coarseHierarchy.gaussians.entityKey[e.elements[0]]}}(e)].sequence}!function(e){function t(e){const t=new Map
if(Oa.Nf.isAtomic(e.unit)){const{label_seq_id:n}=e.unit.model.atomicHierarchy.residues,{residueIndex:r}=e.unit
for(let i=0,o=Xo.CD.size(e.indices);i<o;++i){const o=Xo.CD.getAt(e.indices,i),a=e.unit.elements[o],s=n.value(r[a])
t.has(s)?t.get(s).push(o):t.set(s,[o])}}else if(Oa.Nf.isCoarse(e.unit)){const{seq_id_begin:n}=Oa.Nf.isSpheres(e.unit)?e.unit.model.coarseHierarchy.spheres:e.unit.model.coarseHierarchy.gaussians
for(let r=0,i=Xo.CD.size(e.indices);r<i;++r){const i=Xo.CD.getAt(e.indices,r),o=e.unit.elements[i],a=n.value(o)
t.set(a,[i])}}return t}e.createSeqIdIndicesMap=t,e.compute=function(e,n={}){const r=Va(e.a.unit),i=Va(e.b.unit),o=t(e.a),a=t(e.b),s=[],l=[],{aliA:c,aliB:u,score:d}=function(e,t,n={}){const r={...Fa,...n},i=new za(e,t,r)
return i.calculate(),i.trace()}(r.code.toArray(),i.code.toArray(),n)
let p=0,h=0
for(let t=0,g=c.length;t<g;++t){if("-"===c[t]||"-"===u[t]){"-"!==c[t]&&(p+=1),"-"!==u[t]&&(h+=1)
continue}const e=r.seqId.value(p),n=i.seqId.value(h)
if(o.has(e)&&a.has(n)){const t=o.get(e),r=a.get(n)
for(let e=0,n=Math.min(t.length,r.length);e<n;++e)s.push(t[e]),l.push(r[e])}p+=1,h+=1}const f=Xo.CD.intersect(Xo.CD.ofSortedArray(s),e.a.indices),m=Xo.CD.intersect(Xo.CD.ofSortedArray(l),e.b.indices)
return{a:{unit:e.a.unit,indices:f},b:{unit:e.b.unit,indices:m},score:d}}}(ja||(ja={}))
var Ua=n(68329)
function Ga(e){const t=[]
if(e.length<=0)return t
const n=function(e){if(0===e.length)return 0
let t=Ra.i.Loci.size(e[0])
for(let n=1;n<e.length;n++){const r=Ra.i.Loci.size(e[n])
r<t&&(t=r)}return t}(e),r={a:qa(e[0],n),b:qa(e[1],n)}
t[0]=Ea.compute(r)
for(let i=2;i<e.length;i++)r.b=qa(e[i],n),r.centerB=void 0,t.push(Ea.compute(r))
return t}const Ha=/(polypeptide|cyclic-pseudo-peptide)/i
function qa(e,t){const n=Ea.Positions.empty(t)
let r=0
for(const i of e.elements){const{unit:e,indices:o}=i,{elements:a,conformation:s}=e
for(let i=0,l=Xo.CD.size(o);i<l;i++){const e=a[Xo.CD.getAt(o,i)]
if(n.x[r]=s.x(e),n.y[r]=s.y(e),n.z[r]=s.z(e),r++,r>=t)break}if(r>=t)break}return n}var Qa=n(97960)
function $a(e,t,n,r){const i=Ea.Positions.empty(r),o=Ea.Positions.empty(r)
let a=0
for(const{pivots:s}of e){const e=s[t],r=s[n]
if(!e||!r)continue
const l=Math.min(e[2]-e[1],r[2]-r[1])
for(let t=0;t<l;t++){let n=e[1]+t
i.x[a]=e[0].conformation.x(n),i.y[a]=e[0].conformation.y(n),i.z[a]=e[0].conformation.z(n),n=r[1]+t,o.x[a]=r[0].conformation.x(n),o.y[a]=r[0].conformation.y(n),o.z[a]=r[0].conformation.z(n),a++}}return[i,o]}function Xa(){return!0}function Wa(e,t,n,r,i){const o=Ra.i.Location.create(e)
for(const a of e.units){if(a.kind!==Qa.N.Kind.Atomic)continue
const{elements:e,model:s}=a
o.unit=a
const l=Aa.W.Provider.get(s).value
if(!l)return
const{dbName:c,accession:u,num:d}=l,p=Xo.hT.transientSegments(a.model.atomicHierarchy.chainAtomSegments,e),h=Xo.hT.transientSegments(a.model.atomicHierarchy.residueAtomSegments,e),f=a.model.atomicHierarchy.derived.residue.traceElementIndex
for(;p.hasNext;){const s=p.move()
for(h.setSegment(s);h.hasNext;){const s=h.move(),l=s.index
if(!c[l])continue
const p=f[l]
let m,g
if(r){if(m=p,-1===m)continue
g=m+1}else m=e[s.start],g=e[s.end-1]+1
if(o.element=p>=0?p:m,!i(o,l,m,g))continue
const y=`${c[l]}-${u[l]}-${d[l]}`
if(t.has(y)){const e=t.get(y)
e.pivots[n]||(e.pivots[n]=[a,m,g])}else t.set(y,{key:y,pivots:{[n]:[a,m,g]}})}}}}var Ya,Za=n(37411)
!function(e){function t(e){if(e<=21)return.5
const t=1.24*Math.pow(e-15,1/3)-1.8
return Math.max(t,.5)}function n(e,t,n,r,i,o,a){if(0===n.length)return 0
const s=o*o
let l=0
const c=(0,Za.e)(),u=(0,Za.e)()
for(let d=0;d<n.length;d++){const o=n[d],a=r[d]
Za.e.set(c,e[o][0],e[o][1],e[o][2]),Za.e.set(u,t[a][0],t[a][1],t[a][2]),Za.e.transformMat4(u,u,i),l+=1/(1+Za.e.squaredDistance(c,u)/s)}return l/a}function r(e){const t=e.x.length,n=new Array(t)
for(let r=0;r<t;r++)n[r]=[e.x[r],e.y[r],e.z[r]]
return n}e.Positions=Ea.Positions,e.compute=function(e){const{a:i,b:o}=e,a=i.x.length,s=o.x.length
if(0===a||0===s)return{bTransform:Ia.$.identity(),tmScoreA:0,tmScoreB:0,rmsd:0,alignedLength:0,sequenceIdentity:0,alignmentA:[],alignmentB:[]}
const l=r(i),c=r(o),u=t(a),d=t(s),p=Math.min(a,s),h=Math.min(Math.max(Math.min(u,d),4.5),8),f=1.5*Math.pow(p,.3)+3.5,m=new Ka(l,c,a,s,u,h,f)
m.align()
const{alignmentA:g,alignmentB:y,transform:v}=m.getBestAlignment(),b=n(l,c,g,y,v,u,a),x=n(l,c,g,y,v,d,s),S=function(e,t,n,r,i){if(0===n.length)return 0
let o=0
const a=(0,Za.e)(),s=(0,Za.e)()
for(let l=0;l<n.length;l++)Za.e.set(a,e[n[l]][0],e[n[l]][1],e[n[l]][2]),Za.e.set(s,t[r[l]][0],t[r[l]][1],t[r[l]][2]),Za.e.transformMat4(s,s,i),o+=Za.e.squaredDistance(a,s)
return Math.sqrt(o/n.length)}(l,c,g,y,v)
let _=0
if(e.seqA&&e.seqB){let t=0
for(let n=0;n<g.length;n++)e.seqA[g[n]]===e.seqB[y[n]]&&t++
_=g.length>0?t/g.length:0}return{bTransform:v,tmScoreA:b,tmScoreB:x,rmsd:S,alignedLength:g.length,sequenceIdentity:_,alignmentA:g,alignmentB:y}},e.calculateD0=t}(Ya||(Ya={}))
class Ka{constructor(e,t,n,r,i,o,a){this.bestScore=-1,this.bestAlignmentA=[],this.bestAlignmentB=[],this.bestTransform=Ia.$.identity(),this.xa=e,this.ya=t,this.lenA=n,this.lenB=r,this.d0A=i,this.d0Search=o,this.scoreD8=a,this.dpPath=new Array(n+1),this.dpVal=new Array(n+1)
for(let s=0;s<=n;s++)this.dpPath[s]=new Array(r+1).fill(!1),this.dpVal[s]=new Array(r+1).fill(0)
this.j2i=new Array(r).fill(-1)}align(){const{lenA:e,lenB:t}=this,n=Math.min(e,t)
this.getInitialAlignment(),this.refineAlignment(),this.tryGaplessThreading()
for(let i=5;i<=Math.min(12,n);i++)this.tryFragmentInitializationMedium(i)
for(let i=16;i<=Math.min(30,n);i+=2)this.tryFragmentInitializationMedium(i)
const r=[Math.floor(.15*n),Math.floor(.25*n),Math.floor(.4*n),Math.floor(.6*n)].filter(e=>e>30)
for(const i of r)this.tryFragmentInitializationFast(i)
this.refineAlignment()
for(let i=Math.max(1,this.d0A-3);i<=this.d0A+3;i++)this.refineWithCutoff(i)
this.refineWithCutoff(.8*this.d0A),this.optimizeFinalAlignment()}optimizeFinalAlignment(){const{xa:e,ya:t,d0A:n,lenA:r}=this,i=[8,7,6,5.5,5,4.5,4]
for(const o of i){const i=o*o,a=[],s=[]
for(let n=0;n<this.bestAlignmentA.length;n++){const r=this.bestAlignmentA[n],o=this.bestAlignmentB[n],l=Za.e.create(t[o][0],t[o][1],t[o][2])
Za.e.transformMat4(l,l,this.bestTransform)
const c=l[0]-e[r][0],u=l[1]-e[r][1],d=l[2]-e[r][2]
c*c+u*u+d*d<=i&&(a.push(r),s.push(o))}if(a.length<3)continue
const l=a.map(t=>e[t]),c=s.map(e=>t[e]),u=this.kabsch(l,c),d=this.scoreTM(this.bestAlignmentA,this.bestAlignmentB,u,n,r)
d>this.bestScore&&(this.bestScore=d,this.bestTransform=Ia.$.clone(u))}this.bestScore=this.scoreTM(this.bestAlignmentA,this.bestAlignmentB,this.bestTransform,n,r)}scoreTM(e,t,n,r,i){const{xa:o,ya:a}=this,s=r*r
let l=0
for(let c=0;c<e.length;c++){const r=e[c],i=t[c],u=Za.e.create(a[i][0],a[i][1],a[i][2])
Za.e.transformMat4(u,u,n)
const d=u[0]-o[r][0],p=u[1]-o[r][1],h=u[2]-o[r][2]
l+=1/(1+(d*d+p*p+h*h)/s)}return l/i}refineWithCutoff(e){if(e<1)return
const{xa:t,ya:n,lenA:r,d0A:i,d0Search:o,scoreD8:a}=this,s=e*e
for(let l=0;l<10&&!(this.bestAlignmentA.length<3);l++){const e=[],l=[]
for(let r=0;r<this.bestAlignmentA.length;r++){const i=this.bestAlignmentA[r],o=this.bestAlignmentB[r],a=Za.e.create(n[o][0],n[o][1],n[o][2])
Za.e.transformMat4(a,a,this.bestTransform)
const c=a[0]-t[i][0],u=a[1]-t[i][1],d=a[2]-t[i][2]
c*c+u*u+d*d<=s&&(e.push(t[i]),l.push(n[o]))}if(e.length<3)break
const c=this.kabsch(e,l),u=new Array(this.lenB)
for(let t=0;t<this.lenB;t++){const e=Za.e.create(n[t][0],n[t][1],n[t][2])
Za.e.transformMat4(e,e,c),u[t]=[e[0],e[1],e[2]]}const d=o+1
this.nwdpStructure(t,u,d*d,-.6)
const p=[],h=[]
for(let t=0;t<this.lenB;t++)this.j2i[t]>=0&&(p.push(this.j2i[t]),h.push(t))
if(p.length<3)break
const f=this.trimmedKabsch(p,h,c,a),m=this.scoreTMWithCutoff(p,h,f,i,r,a)
if(!(m>this.bestScore))break
this.bestScore=m,this.bestAlignmentA=p,this.bestAlignmentB=h,this.bestTransform=f}}tryGaplessThreading(){const{xa:e,ya:t,lenA:n,lenB:r,d0A:i,scoreD8:o}=this
for(let a=4-r;a<=n-4;a++){const s=[],l=[]
for(let e=0;e<n;e++){const t=e-a
t>=0&&t<r&&(s.push(e),l.push(t))}if(s.length<4)continue
const c=s.map(t=>e[t]),u=l.map(e=>t[e]),d=this.kabsch(c,u)
this.scoreTMWithCutoff(s,l,d,i,n,o)>.8*this.bestScore&&this.extendFromSeed(d)}}tryFragmentInitializationMedium(e){const{xa:t,ya:n,lenA:r,lenB:i,d0A:o,scoreD8:a}=this,s=r-e,l=i-e,c=Math.max(2,Math.floor(e/2))
for(let u=0;u<=s;u+=c)for(let i=0;i<=l;i+=c){const s=[],l=[]
for(let r=0;r<e;r++)s.push(t[u+r]),l.push(n[i+r])
const c=this.kabsch(s,l),d=[],p=[]
for(let t=0;t<e;t++)d.push(u+t),p.push(i+t)
this.scoreTMWithCutoff(d,p,c,o,r,a)>.3*this.bestScore&&this.extendFromSeed(c)}}tryFragmentInitializationFast(e){const{xa:t,ya:n,lenA:r,lenB:i,d0A:o,scoreD8:a}=this,s=r-e,l=i-e,c=Math.max(e,10)
for(let u=0;u<=s;u+=c)for(let i=0;i<=l;i+=c){const s=[],l=[]
for(let r=0;r<e;r++)s.push(t[u+r]),l.push(n[i+r])
const c=this.kabsch(s,l),d=[],p=[]
for(let t=0;t<e;t++)d.push(u+t),p.push(i+t)
this.scoreTMWithCutoff(d,p,c,o,r,a)>.5*this.bestScore&&this.extendFromSeed(c)}}getInitialAlignment(){const{xa:e,ya:t,lenA:n,lenB:r,d0Search:i}=this,o=i*i,a=new Array(n+1)
for(let s=0;s<=n;s++)a[s]=new Array(r+1).fill(0)
for(let s=1;s<=n;s++)for(let n=1;n<=r;n++){const r=e[s-1][0]-t[n-1][0],i=e[s-1][1]-t[n-1][1],l=e[s-1][2]-t[n-1][2],c=r*r+i*i+l*l
a[s][n]=1/(1+c/o)}this.nwdpScore(a,-.6)}extendFromSeed(e){const{xa:t,ya:n,lenA:r,lenB:i,d0A:o,d0Search:a,scoreD8:s}=this
let l=e,c=[],u=[],d=-1
for(let p=0;p<20;p++){const e=new Array(i)
for(let t=0;t<i;t++){const r=Za.e.create(n[t][0],n[t][1],n[t][2])
Za.e.transformMat4(r,r,l),e[t]=[r[0],r[1],r[2]]}const p=a+1
this.nwdpStructure(t,e,p*p,-.6)
const h=[],f=[]
for(let t=0;t<i;t++)this.j2i[t]>=0&&(h.push(this.j2i[t]),f.push(t))
if(h.length<3)break
if(this.alignmentsEqual(h,f,c,u))break
const m=this.trimmedKabsch(h,f,l,s),g=this.scoreTMWithCutoff(h,f,m,o,r,s)
if(c=h,u=f,l=m,g<=d)break
d=g,g>this.bestScore&&(this.bestScore=g,this.bestAlignmentA=h.slice(),this.bestAlignmentB=f.slice(),this.bestTransform=Ia.$.clone(m))}}trimmedKabsch(e,t,n,r){const{xa:i,ya:o}=this,a=r*r,s=[],l=[]
for(let c=0;c<e.length;c++){const r=e[c],u=t[c],d=Za.e.create(o[u][0],o[u][1],o[u][2])
Za.e.transformMat4(d,d,n)
const p=d[0]-i[r][0],h=d[1]-i[r][1],f=d[2]-i[r][2]
p*p+h*h+f*f<=a&&(s.push(i[r]),l.push(o[u]))}if(s.length<3){const n=e.map(e=>i[e]),r=t.map(e=>o[e])
return this.kabsch(n,r)}return this.kabsch(s,l)}refineAlignment(){const{xa:e,ya:t,lenA:n,d0A:r,d0Search:i,scoreD8:o}=this
for(let a=0;a<20&&!(this.bestAlignmentA.length<3);a++){const a=this.trimmedKabsch(this.bestAlignmentA,this.bestAlignmentB,this.bestTransform,o),s=new Array(this.lenB)
for(let e=0;e<this.lenB;e++){const n=Za.e.create(t[e][0],t[e][1],t[e][2])
Za.e.transformMat4(n,n,a),s[e]=[n[0],n[1],n[2]]}const l=i+1
this.nwdpStructure(e,s,l*l,-.6)
const c=[],u=[]
for(let e=0;e<this.lenB;e++)this.j2i[e]>=0&&(c.push(this.j2i[e]),u.push(e))
if(c.length<3)break
if(this.alignmentsEqual(c,u,this.bestAlignmentA,this.bestAlignmentB))break
const d=c.map(t=>e[t]),p=u.map(e=>t[e]),h=this.kabsch(d,p),f=this.scoreTMWithCutoff(c,u,h,r,n,o)
f>this.bestScore&&(this.bestScore=f,this.bestAlignmentA=c,this.bestAlignmentB=u,this.bestTransform=h)}}alignmentsEqual(e,t,n,r){if(e.length!==n.length)return!1
for(let i=0;i<e.length;i++)if(e[i]!==n[i]||t[i]!==r[i])return!1
return!0}scoreTMWithCutoff(e,t,n,r,i,o){const{xa:a,ya:s}=this,l=r*r,c=o*o
let u=0
for(let d=0;d<e.length;d++){const r=e[d],i=t[d],o=Za.e.create(s[i][0],s[i][1],s[i][2])
Za.e.transformMat4(o,o,n)
const p=o[0]-a[r][0],h=o[1]-a[r][1],f=o[2]-a[r][2],m=p*p+h*h+f*f
m<=c&&(u+=1/(1+m/l))}return u/i}nwdpScore(e,t){const{lenA:n,lenB:r,dpPath:i,dpVal:o,j2i:a}=this
for(let c=0;c<=n;c++)o[c][0]=0,i[c][0]=!1
for(let c=0;c<=r;c++)o[0][c]=0,i[0][c]=!1,a[c]=-1
for(let c=1;c<=n;c++)for(let n=1;n<=r;n++){const r=o[c-1][n-1]+e[c][n]
let a=o[c-1][n]
i[c-1][n]&&(a+=t)
let s=o[c][n-1]
i[c][n-1]&&(s+=t),r>=a&&r>=s?(i[c][n]=!0,o[c][n]=r):(i[c][n]=!1,o[c][n]=s>=a?s:a)}let s=n,l=r
for(;s>0&&l>0;)if(i[s][l])a[l-1]=s-1,s--,l--
else{let e=o[s-1][l]
i[s-1][l]&&(e+=t)
let n=o[s][l-1]
i[s][l-1]&&(n+=t),n>=e?l--:s--}this.bestAlignmentA=[],this.bestAlignmentB=[]
for(let c=0;c<r;c++)a[c]>=0&&(this.bestAlignmentA.push(a[c]),this.bestAlignmentB.push(c))
if(this.bestAlignmentA.length>=3){const e=this.bestAlignmentA.map(e=>this.xa[e]),t=this.bestAlignmentB.map(e=>this.ya[e])
this.bestTransform=this.kabsch(e,t),this.bestScore=this.scoreTMWithCutoff(this.bestAlignmentA,this.bestAlignmentB,this.bestTransform,this.d0A,this.lenA,this.scoreD8)}}nwdpStructure(e,t,n,r){const{lenA:i,lenB:o,dpPath:a,dpVal:s,j2i:l}=this
for(let d=0;d<=i;d++)s[d][0]=0,a[d][0]=!1
for(let d=0;d<=o;d++)s[0][d]=0,a[0][d]=!1,l[d]=-1
for(let d=1;d<=i;d++)for(let i=1;i<=o;i++){const o=e[d-1][0]-t[i-1][0],l=e[d-1][1]-t[i-1][1],c=e[d-1][2]-t[i-1][2],u=o*o+l*l+c*c,p=s[d-1][i-1]+1/(1+u/n)
let h=s[d-1][i]
a[d-1][i]&&(h+=r)
let f=s[d][i-1]
a[d][i-1]&&(f+=r),p>=h&&p>=f?(a[d][i]=!0,s[d][i]=p):(a[d][i]=!1,s[d][i]=f>=h?f:h)}let c=i,u=o
for(;c>0&&u>0;)if(a[c][u])l[u-1]=c-1,c--,u--
else{let e=s[c-1][u]
a[c-1][u]&&(e+=r)
let t=s[c][u-1]
a[c][u-1]&&(t+=r),t>=e?u--:c--}}kabsch(e,t){const n=e.length
if(n<3)return Ia.$.identity()
const r=Ea.Positions.empty(n),i=Ea.Positions.empty(n)
for(let o=0;o<n;o++)r.x[o]=e[o][0],r.y[o]=e[o][1],r.z[o]=e[o][2],i.x[o]=t[o][0],i.y[o]=t[o][1],i.z[o]=t[o][2]
return Ea.compute({a:r,b:i}).bTransform}getBestAlignment(){return{alignmentA:this.bestAlignmentA,alignmentB:this.bestAlignmentB,transform:this.bestTransform}}}function Ja(e,t){const n=Ra.i.Loci.size(e),r=Ra.i.Loci.size(t)
if(0===n||0===r)return{bTransform:Ia.$.identity(),tmScoreA:0,tmScoreB:0,rmsd:0,alignedLength:0,sequenceIdentity:0,alignmentA:[],alignmentB:[]}
const i=qa(e,n),o=qa(t,r)
return Ya.compute({a:i,b:o})}class es extends l.VK{defaultState(){return{isCollapsed:!1,header:"Superposition",brand:{accent:"gray",svg:Br.lj},isHidden:!0}}componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,e=>{this.setState({isHidden:e.structures.length<2})})}renderControls(){return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(rs,{})})}}const ts={alignSequences:Vr.t.Boolean(!0,{isEssential:!0,description:"For Chain-based 3D superposition, perform a sequence alignment and use the aligned residue pairs to guide the 3D superposition."}),traceOnly:Vr.t.Boolean(!0,{description:"For Chain- and Uniprot-based 3D superposition, base superposition only on CA (and equivalent) atoms."})},ns=Vr.t.getDefaultValues(ts)
class rs extends l.jB{constructor(){super(...arguments),this.state={isBusy:!1,canUseDb:!1,action:void 0,options:ns},this.superposeChains=async()=>{var e,t,n
const{query:r}=this.state.options.traceOnly?Hr.StructureSelectionQueries.trace:Hr.StructureSelectionQueries.polymer,i=this.chainEntries,o=i.map(e=>{const t=Or.StructureElement.Loci.toStructure(e.loci),n=Or.StructureSelection.toLociWithSourceUnits(r(new Or.QueryContext(t)))
return Or.StructureElement.Loci.remap(n,this.getRootStructure(e.loci.structure))}),a=this.plugin.managers.structure.hierarchy.findStructure(null===(e=o[0])||void 0===e?void 0:e.structure),s=null===(n=null===(t=null==a?void 0:a.transform)||void 0===t?void 0:t.cell.obj)||void 0===n?void 0:n.data.coordinateSystem,l=this.state.options.alignSequences?function(e){const t=[]
if(e.length<=0)return t
const n=Ra.i.Loci.getFirstLocation(e[0]),r=Ua.Z.entity.subtype(n).match(Ha)?"blosum62":"default"
for(let i=1;i<e.length;i++){const{a:n,b:o,score:a}=ja.compute({a:e[0].elements[0],b:e[i].elements[0]},{substMatrix:r}),s=Ra.i.Loci(e[0].structure,[n]),l=Ra.i.Loci(e[i].structure,[o]),c=Xo.CD.size(n.indices)
t.push({...Ea.compute({a:qa(s,c),b:qa(l,c)}),alignmentScore:a})}return t}(o):Ga(o),c=i[0]
for(let u=1,d=o.length;u<d;++u){const e=i[u],{bTransform:t,rmsd:n}=l[u-1]
await this.transform(e.cell,t,s)
const r=(0,To.Kq)(c.label),o=(0,To.Kq)(e.label)
this.plugin.log.info(`Superposed [${r}] and [${o}] with RMSD ${n.toFixed(2)}.`)}await this.cameraReset()},this.superposeAtoms=async()=>{var e,t,n
const r=this.atomEntries,i=r.map(e=>Or.StructureElement.Loci.remap(e.loci,this.getRootStructure(e.loci.structure))),o=Ga(i),a=this.plugin.managers.structure.hierarchy.findStructure(null===(e=i[0])||void 0===e?void 0:e.structure),s=null===(n=null===(t=null==a?void 0:a.transform)||void 0===t?void 0:t.cell.obj)||void 0===n?void 0:n.data.coordinateSystem,l=r[0]
for(let c=1,u=i.length;c<u;++c){const e=r[c],{bTransform:t,rmsd:n}=o[c-1]
await this.transform(e.cell,t,s)
const i=(0,To.Kq)(l.label),a=(0,To.Kq)(e.label),u=r[c].atoms.length
this.plugin.log.info(`Superposed ${u} ${1===u?"atom":"atoms"} of [${i}] and [${a}] with RMSD ${n.toFixed(2)}.`)}await this.cameraReset()},this.superposeDb=async()=>{var e,t,n
const r=this.plugin.managers.structure.hierarchy.behaviors.selection.value.structures,i=this.state.options.traceOnly,o=r.map(e=>{var t
return null===(t=e.cell.obj)||void 0===t?void 0:t.data}),{entries:a,failedPairs:s,zeroOverlapPairs:l}=function(e,t){var n,r
const i=new Map
for(let u=0;u<e.length;u++)Wa(e[u],i,u,null===(n=null==t?void 0:t.traceOnly)||void 0===n||n,null!==(r=null==t?void 0:t.includeResidueTest)&&void 0!==r?r:Xa)
const o=Array.from(i.values()),a=function(e,t){const n=[]
for(let i=0;i<e;i++){n[i]=[]
for(let t=0;t<e;t++)n[i][t]=0}for(const{pivots:i}of t)for(let t=0;t<e;t++){if(!i[t])continue
const r=i[t][2]-i[t][1]
for(let o=t+1;o<e;o++){if(!i[o])continue
const e=i[o][2]-i[o][1]
n[t][o]=n[t][o]+Math.min(r,e)}}const r=[]
for(let i=1;i<e;i++)r[i-1]={i:0,j:i,count:n[0][i]}
return r}(e.length,o),s=[],l=[],c=[]
for(const u of a)if(0===u.count)s.push([u.i,u.j])
else{const[e,t]=$a(o,u.i,u.j,u.count),n=Ea.compute({a:e,b:t})
Number.isNaN(n.rmsd)?l.push([u.i,u.j]):c.push({transform:n,pivot:u.i,other:u.j})}return{entries:c,zeroOverlapPairs:s,failedPairs:l}}(o,{traceOnly:i}),c=null===(n=null===(t=null===(e=r[0])||void 0===e?void 0:e.transform)||void 0===t?void 0:t.cell.obj)||void 0===n?void 0:n.data.coordinateSystem
let u=0
for(const p of a)await this.transform(r[p.other].cell,p.transform.bTransform,c),u+=p.transform.rmsd
u/=Math.max(a.length-1,1)
const d=e=>`[${e.map(([e,t])=>`(${o[e].models[0].entryId}, ${o[t].models[0].entryId})`).join(", ")}]`
l.length&&this.plugin.log.warn(`Superposition: No UNIPROT mapping overlap between structures ${d(l)}.`),s.length&&this.plugin.log.error(`Superposition: Failed to superpose structures ${d(s)}.`),a.length&&(this.plugin.log.info(`Superposed ${a.length+1} structures with avg. RMSD ${u.toFixed(2)} .`),await this.cameraReset())},this.superposeTMAlign=async()=>{var e,t,n
const{query:r}=this.state.options.traceOnly?Hr.StructureSelectionQueries.trace:Hr.StructureSelectionQueries.polymer,i=this.chainEntries,o=i.map(e=>{const t=Or.StructureElement.Loci.toStructure(e.loci),n=Or.StructureSelection.toLociWithSourceUnits(r(new Or.QueryContext(t)))
return Or.StructureElement.Loci.remap(n,this.getRootStructure(e.loci.structure))}),a=this.plugin.managers.structure.hierarchy.findStructure(null===(e=o[0])||void 0===e?void 0:e.structure),s=null===(n=null===(t=null==a?void 0:a.transform)||void 0===t?void 0:t.cell.obj)||void 0===n?void 0:n.data.coordinateSystem,l=i[0]
for(let c=1,u=o.length;c<u;++c){const e=i[c],t=Ja(o[0],o[c]),{bTransform:n,tmScoreA:r,tmScoreB:a,rmsd:u,alignedLength:d}=t
await this.transform(e.cell,n,s)
const p=(0,To.Kq)(l.label),h=(0,To.Kq)(e.label)
this.plugin.log.info(`TM-align [${p}] and [${h}]: TM-score=${r.toFixed(4)}/${a.toFixed(4)}, RMSD=${u.toFixed(2)} , aligned ${d} residues.`)}await this.cameraReset()},this.toggleByChains=()=>this.setState({action:"byChains"===this.state.action?void 0:"byChains"}),this.toggleByAtoms=()=>this.setState({action:"byAtoms"===this.state.action?void 0:"byAtoms"}),this.toggleByTMAlign=()=>this.setState({action:"byTMAlign"===this.state.action?void 0:"byTMAlign"}),this.toggleOptions=()=>this.setState({action:"options"===this.state.action?void 0:"options"}),this.setOptions=e=>{this.setState({options:e})}}componentDidMount(){this.subscribe(this.selection.events.changed,()=>{this.forceUpdate()}),this.subscribe(this.selection.events.additionsHistoryUpdated,()=>{this.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,e=>{this.setState({isBusy:e})}),this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,e=>{this.setState({canUseDb:e.structures.every(e=>{var t
return!!(null===(t=e.cell.obj)||void 0===t?void 0:t.data)&&e.cell.obj.data.models.some(e=>Aa.W.Provider.isApplicable(e))})})})}get selection(){return this.plugin.managers.structure.selection}async transform(e,t,n){const r=$r.so.resolveAndCheck(this.plugin.state.data,e)
if(!r)return
const i=this.plugin.state.data.selectQ(e=>e.byRef(r.transform.ref).subtree().withTransformer(Ar.f.Model.TransformStructureConformation))[0],o={transform:{name:"matrix",params:{data:n&&!Ta.$I.isIdentity(n.matrix)?Ta.$I.mul((0,Ta.$I)(),n.matrix,t):t,transpose:!1}}},a=i?this.plugin.state.data.build().to(i).update(o):this.plugin.state.data.build().to(e).insert(Ar.f.Model.TransformStructureConformation,o,{tags:"SuperpositionTransform"})
await this.plugin.runTask(this.plugin.state.data.updateTree(a))}getRootStructure(e){var t
const n=this.plugin.helpers.substructureParent.get(e)
return null===(t=this.plugin.state.data.selectQ(e=>e.byValue(n).rootOfType(gi.O.Molecule.Structure))[0].obj)||void 0===t?void 0:t.data}async cameraReset(){await new Promise(e=>requestAnimationFrame(e)),Ir.PluginCommands.Camera.Reset(this.plugin)}highlight(e){this.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:e},!1)}moveHistory(e,t){this.plugin.managers.structure.selection.modifyHistory(e,t,void 0,!0)}focusLoci(e){this.plugin.managers.camera.focusLoci(e)}lociEntry(e,t){return(0,a.jsx)("div",{className:"msp-flex-row",children:(0,a.jsx)(Pr.$n,{noOverflow:!0,title:"Click to focus. Hover to highlight.",onClick:()=>this.focusLoci(e.loci),style:{width:"auto",textAlign:"left"},onMouseEnter:()=>this.highlight(e.loci),onMouseLeave:()=>this.plugin.managers.interactivity.lociHighlights.clearHighlights(),children:(0,a.jsx)("span",{dangerouslySetInnerHTML:{__html:e.label}})})},t)}historyEntry(e,t){const n=this.plugin.managers.structure.selection.additionsHistory
return(0,a.jsxs)("div",{className:"msp-flex-row",children:[(0,a.jsxs)(Pr.$n,{noOverflow:!0,title:"Click to focus. Hover to highlight.",onClick:()=>this.focusLoci(e.loci),style:{width:"auto",textAlign:"left"},onMouseEnter:()=>this.highlight(e.loci),onMouseLeave:()=>this.plugin.managers.interactivity.lociHighlights.clearHighlights(),children:[t,". ",(0,a.jsx)("span",{dangerouslySetInnerHTML:{__html:e.label}})]}),n.length>1&&(0,a.jsx)(Pr.K0,{svg:Br.p8,small:!0,className:"msp-form-control",onClick:()=>this.moveHistory(e,"up"),flex:"20px",title:"Move up"}),n.length>1&&(0,a.jsx)(Pr.K0,{svg:Br.qp,small:!0,className:"msp-form-control",onClick:()=>this.moveHistory(e,"down"),flex:"20px",title:"Move down"}),(0,a.jsx)(Pr.K0,{svg:Br.mf,small:!0,className:"msp-form-control",onClick:()=>this.plugin.managers.structure.selection.modifyHistory(e,"remove"),flex:!0,title:"Remove"})]},e.id)}atomsLociEntry(e,t){return(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"msp-control-group-header",children:(0,a.jsx)("div",{className:"msp-no-overflow",title:e.label,children:e.label})}),(0,a.jsx)("div",{className:"msp-control-offset",children:e.atoms.map((e,t)=>this.historyEntry(e,t))})]},t)}get chainEntries(){const e=Or.StructureElement.Location.create(),t=[]
return this.plugin.managers.structure.selection.entries.forEach(({selection:n},r)=>{const i=$r.so.resolveAndCheck(this.plugin.state.data,r)
if(!i||Or.StructureElement.Loci.isEmpty(n))return
const o=Or.StructureElement.Loci.getFirstLocation(n,e)
if(n.elements.length>1||"polymer"!==Or.StructureProperties.entity.type(o))return
const a=Or.StructureElement.Stats.ofLoci(n),s=(0,yo.d_)(a,{countsOnly:!0}),l=(0,yo.BB)(o,{reverse:!0,granularity:"chain"}).split("|"),c=`${s} | ${l[0]} | ${l[l.length-1]}`
t.push({loci:n,label:c,cell:i})}),t}get atomEntries(){const e=new Map,t=this.plugin.managers.structure.selection.additionsHistory
for(let r=0,i=t.length;r<i;++r){const n=t[r]
if(1!==Or.StructureElement.Loci.size(n.loci))continue
const i=n.loci.structure
e.has(i)?e.get(i).push(n):e.set(i,[n])}const n=[]
return e.forEach((e,t)=>{const r=this.plugin.helpers.substructureParent.get(t),i=[]
for(let n=0,s=e.length;n<s;++n)i.push(e[n].loci.elements[0])
const o=Or.StructureElement.Loci(e[0].loci.structure,i),a=o.structure.label.split(" | ")[0]
n.push({loci:o,label:a,cell:r,atoms:e})}),n}toggleHint(){return this.plugin.config.get(go.PluginConfig.Viewport.ShowSelectionMode)?(0,a.jsxs)(a.Fragment,{children:[" ","(toggle ",(0,a.jsx)(Ro,{inline:!0})," mode)"]}):null}addByChains(){const e=this.chainEntries
return(0,a.jsxs)(a.Fragment,{children:[e.length>0&&(0,a.jsx)("div",{className:"msp-control-offset",children:e.map((e,t)=>this.lociEntry(e,t))}),e.length<2&&(0,a.jsx)("div",{className:"msp-control-offset msp-help-text",children:(0,a.jsxs)("div",{className:"msp-help-description",children:[(0,a.jsx)(Br.In,{svg:Br.ml,inline:!0}),"Add 2 or more selections",this.toggleHint()," from separate structures. Selections must be limited to single polymer chains or residues therein."]})}),e.length>1&&(0,a.jsx)(Pr.$n,{title:"Superpose structures by selected chains.",className:"msp-btn-commit msp-btn-commit-on",onClick:this.superposeChains,style:{marginTop:"1px"},children:"Superpose"})]})}addByAtoms(){const e=this.atomEntries
return(0,a.jsxs)(a.Fragment,{children:[e.length>0&&(0,a.jsx)("div",{className:"msp-control-offset",children:e.map((e,t)=>this.atomsLociEntry(e,t))}),e.length<2&&(0,a.jsx)("div",{className:"msp-control-offset msp-help-text",children:(0,a.jsxs)("div",{className:"msp-help-description",children:[(0,a.jsx)(Br.In,{svg:Br.ml,inline:!0}),"Add 1 or more selections",this.toggleHint()," from separate structures. Selections must be limited to single atoms."]})}),e.length>1&&(0,a.jsx)(Pr.$n,{title:"Superpose structures by selected atoms.",className:"msp-btn-commit msp-btn-commit-on",onClick:this.superposeAtoms,style:{marginTop:"1px"},children:"Superpose"})]})}addByTMAlign(){const e=this.chainEntries
return(0,a.jsxs)(a.Fragment,{children:[e.length>0&&(0,a.jsx)("div",{className:"msp-control-offset",children:e.map((e,t)=>this.lociEntry(e,t))}),e.length<2&&(0,a.jsx)("div",{className:"msp-control-offset msp-help-text",children:(0,a.jsxs)("div",{className:"msp-help-description",children:[(0,a.jsx)(Br.In,{svg:Br.ml,inline:!0}),"Add 2 or more selections",this.toggleHint()," from separate structures. Selections must be limited to single polymer chains. TM-align performs structure-based alignment independent of sequence."]})}),e.length>1&&(0,a.jsx)(Pr.$n,{title:"Superpose structures using TM-align (structure-based alignment).",className:"msp-btn-commit msp-btn-commit-on",onClick:this.superposeTMAlign,style:{marginTop:"1px"},children:"TM-align Superpose"})]})}superposeByDbMapping(){return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(Pr.$n,{icon:Br.$8,title:"Superpose structures using intersection of residues from SIFTS UNIPROT mapping.",className:"msp-btn msp-btn-block",onClick:this.superposeDb,style:{marginTop:"1px"},disabled:this.state.isBusy,children:"Uniprot"})})}render(){return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"msp-flex-row",children:[(0,a.jsx)(Pr.ff,{icon:Br.$8,label:"Chains",toggle:this.toggleByChains,isSelected:"byChains"===this.state.action,disabled:this.state.isBusy}),(0,a.jsx)(Pr.ff,{icon:Br.z7,label:"Atoms",toggle:this.toggleByAtoms,isSelected:"byAtoms"===this.state.action,disabled:this.state.isBusy}),(0,a.jsx)(Pr.ff,{icon:Br.$8,label:"TM-align",toggle:this.toggleByTMAlign,isSelected:"byTMAlign"===this.state.action,disabled:this.state.isBusy}),this.state.canUseDb&&this.superposeByDbMapping(),(0,a.jsx)(Pr.ff,{icon:Br.Hk,label:"",title:"Options",toggle:this.toggleOptions,isSelected:"options"===this.state.action,disabled:this.state.isBusy,style:{flex:"0 0 40px",padding:0}})]}),"byChains"===this.state.action&&this.addByChains(),"byAtoms"===this.state.action&&this.addByAtoms(),"byTMAlign"===this.state.action&&this.addByTMAlign(),"options"===this.state.action&&(0,a.jsx)("div",{className:"msp-control-offset",children:(0,a.jsx)(Er.y1,{params:ts,values:this.state.options,onChangeValues:this.setOptions,isDisabled:this.state.isBusy})})]})}}var is=n(8881),os=n(10267)
class as extends l.VK{defaultState(){return{isCollapsed:!1,header:"Quick Styles",brand:{accent:"gray",svg:Br._c}}}renderControls(){return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(ss,{})})}}class ss extends l.jB{constructor(){super(...arguments),this.state={busy:!1,style:"default"}}async applyRepresentation(e){this.setState({busy:!0}),await async function(e,t){const{structures:n}=e.managers.structure.hierarchy.selection
switch(t){case"default":const t=e.config.get(go.PluginConfig.Structure.DefaultRepresentationPreset)||os.Bj.auto.id,r=e.builders.structure.representation.resolveProvider(t)
await e.managers.structure.component.applyPreset(n,r)
break
case"spacefill":await e.managers.structure.component.applyPreset(n,os.Bj.illustrative)
break
case"cartoon":await e.managers.structure.component.applyPreset(n,os.Bj["polymer-and-ligand"])
break
case"surface":await e.managers.structure.component.applyPreset(n,os.Bj["molecular-surface"])}}(this.plugin,e),await cs(this.plugin,this.state.style),this.setState({busy:!1})}async applyStyle(e){this.setState({busy:!0}),await cs(this.plugin,e),this.setState({busy:!1,style:e})}render(){return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ls,{title:"Apply Representation",children:(0,a.jsxs)("div",{className:"msp-flex-row",children:[(0,a.jsx)(Pr.$n,{title:"Applies default representation preset (depends on structure size)",onClick:()=>this.applyRepresentation("default"),disabled:this.state.busy,children:"Default"}),(0,a.jsx)(Pr.$n,{title:"Applies cartoon polymer and ball-and-stick ligand representation preset",onClick:()=>this.applyRepresentation("cartoon"),disabled:this.state.busy,children:"Cartoon"}),(0,a.jsx)(Pr.$n,{title:"Applies spacefill representation preset",onClick:()=>this.applyRepresentation("spacefill"),disabled:this.state.busy,children:"Spacefill"}),(0,a.jsx)(Pr.$n,{title:"Applies molecular surface representation preset",onClick:()=>this.applyRepresentation("surface"),disabled:this.state.busy,children:"Surface"})]})}),(0,a.jsx)(ls,{title:"Apply Style",children:(0,a.jsxs)("div",{className:"msp-flex-row",children:[(0,a.jsx)(Pr.$n,{title:"Applies default appearance (no outline, no ignore-light)",onClick:()=>this.applyStyle("default"),disabled:this.state.busy,children:"Default"}),(0,a.jsx)(Pr.$n,{title:"Applies illustrative appearance (outline, ignore-light)",onClick:()=>this.applyStyle("illustrative"),disabled:this.state.busy,children:"Illustrative"})]})})]})}}function ls(e){return(0,a.jsxs)("div",{className:"msp-control-group-wrapper",children:[(0,a.jsx)("div",{className:"msp-control-group-header",children:(0,a.jsx)("div",{children:(0,a.jsx)("b",{children:e.title})})}),e.children]})}async function cs(e,t){if("default"===t&&(await e.managers.structure.component.setOptions({...e.managers.structure.component.state.options,ignoreLight:!1}),e.canvas3d)){const t=Vr.t.getDefaultValues(is.co)
e.canvas3d.setProps({postprocessing:{outline:t.outline,occlusion:t.occlusion,shadow:t.shadow}})}if("illustrative"===t&&(await e.managers.structure.component.setOptions({...e.managers.structure.component.state.options,ignoreLight:!0}),e.canvas3d)){const t=e.canvas3d.props.postprocessing
e.canvas3d.setProps({postprocessing:{outline:{name:"on",params:"on"===t.outline.name?t.outline.params:{scale:1,color:(0,lo.Color)(0),threshold:.33,includeTransparent:!0}},occlusion:{name:"on",params:"on"===t.occlusion.name?t.occlusion.params:{multiScale:{name:"off",params:{}},radius:5,bias:.8,blurKernelSize:15,blurDepthBias:.5,samples:32,resolutionScale:1,color:(0,lo.Color)(0),transparentThreshold:.4}},shadow:{name:"off",params:{}}}})}}function us(e,t){const n=String(e)
if("string"!=typeof t)throw new TypeError("Expected character")
let r=0,i=n.indexOf(t)
for(;-1!==i;)r++,i=n.indexOf(t,i+t.length)
return r}function ds(e){return"string"==typeof e?new RegExp(function(e){if("string"!=typeof e)throw new TypeError("Expected a string")
return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}(e),"g"):e}function ps(e){return"function"==typeof e?e:function(){return e}}const hs="phrasing",fs=["autolink","link","image","label"]
function ms(e){this.enter({type:"link",title:null,url:"",children:[]},e)}function gs(e){this.config.enter.autolinkProtocol.call(this,e)}function ys(e){this.config.exit.autolinkProtocol.call(this,e)}function vs(e){this.config.exit.data.call(this,e)
const t=this.stack[this.stack.length-1]
t.type,t.url="http://"+this.sliceSerialize(e)}function bs(e){this.config.exit.autolinkEmail.call(this,e)}function xs(e){this.exit(e)}function Ss(e){!function(e,t){const n=Bn(({ignore:["link","linkReference"]}||{}).ignore||[]),r=function(e){const t=[]
if(!Array.isArray(e))throw new TypeError("Expected find and replace tuple or list of tuples")
const n=!e[0]||Array.isArray(e[0])?e:[e]
let r=-1
for(;++r<n.length;){const e=n[r]
t.push([ds(e[0]),ps(e[1])])}return t}(t)
let i=-1
for(;++i<r.length;)Rn(e,"text",o)
function o(e,t){let o,a=-1
for(;++a<t.length;){const e=t[a],r=o?o.children:void 0
if(n(e,r?r.indexOf(e):void 0,o))return
o=e}if(o)return function(e,t){const n=t[t.length-1],o=r[i][0],a=r[i][1]
let s=0
const l=n.children.indexOf(e)
let c=!1,u=[]
o.lastIndex=0
let d=o.exec(e.value)
for(;d;){const n=d.index,r={index:d.index,input:d.input,stack:[...t,e]}
let i=a(...d,r)
if("string"==typeof i&&(i=i.length>0?{type:"text",value:i}:void 0),!1===i?o.lastIndex=n+1:(s!==n&&u.push({type:"text",value:e.value.slice(s,n)}),Array.isArray(i)?u.push(...i):i&&u.push(i),s=n+d[0].length,c=!0),!o.global)break
d=o.exec(e.value)}return c?(s<e.value.length&&u.push({type:"text",value:e.value.slice(s)}),n.children.splice(l,1,...u)):u=[e],l+u.length}(e,t)}}(e,[[/(https?:\/\/|www(?=\.))([-.\w]+)([^ \t\r\n]*)/gi,_s],[/(?<=^|\s|\p{P}|\p{S})([-.\w+]+)@([-\w]+(?:\.[-\w]+)+)/gu,Cs]])}function _s(e,t,n,r,i){let o=""
if(!ws(i))return!1
if(/^w/i.test(t)&&(n=t+n,t="",o="http://"),!function(e){const t=e.split(".")
return!(t.length<2||t[t.length-1]&&(/_/.test(t[t.length-1])||!/[a-zA-Z\d]/.test(t[t.length-1]))||t[t.length-2]&&(/_/.test(t[t.length-2])||!/[a-zA-Z\d]/.test(t[t.length-2])))}(n))return!1
const a=function(e){const t=/[!"&'),.:;<>?\]}]+$/.exec(e)
if(!t)return[e,void 0]
e=e.slice(0,t.index)
let n=t[0],r=n.indexOf(")")
const i=us(e,"(")
let o=us(e,")")
for(;-1!==r&&i>o;)e+=n.slice(0,r+1),n=n.slice(r+1),r=n.indexOf(")"),o++
return[e,n]}(n+r)
if(!a[0])return!1
const s={type:"link",title:null,url:o+t+a[0],children:[{type:"text",value:t+a[0]}]}
return a[1]?[s,{type:"text",value:a[1]}]:s}function Cs(e,t,n,r){return!(!ws(r,!0)||/[-\d_]$/.test(n))&&{type:"link",title:null,url:"mailto:"+t+"@"+n,children:[{type:"text",value:t+"@"+n}]}}function ws(e,t){const n=e.input.charCodeAt(e.index-1)
return(0===e.index||Qe(n)||qe(n))&&(!t||47!==n)}function Ts(){this.buffer()}function As(e){this.enter({type:"footnoteReference",identifier:"",label:""},e)}function Is(){this.buffer()}function Ps(e){this.enter({type:"footnoteDefinition",identifier:"",label:"",children:[]},e)}function Bs(e){const t=this.resume(),n=this.stack[this.stack.length-1]
n.type,n.identifier=yt(this.sliceSerialize(e)).toLowerCase(),n.label=t}function Es(e){this.exit(e)}function ks(e){const t=this.resume(),n=this.stack[this.stack.length-1]
n.type,n.identifier=yt(this.sliceSerialize(e)).toLowerCase(),n.label=t}function Ds(e){this.exit(e)}function Ms(e,t,n,r){const i=n.createTracker(r)
let o=i.move("[^")
const a=n.enter("footnoteReference"),s=n.enter("reference")
return o+=i.move(n.safe(n.associationId(e),{after:"]",before:o})),s(),a(),o+=i.move("]"),o}function Rs(e){let t=!1
return e&&e.firstLineBlank&&(t=!0),{handlers:{footnoteDefinition:function(e,n,r,i){const o=r.createTracker(i)
let a=o.move("[^")
const s=r.enter("footnoteDefinition"),l=r.enter("label")
return a+=o.move(r.safe(r.associationId(e),{before:a,after:"]"})),l(),a+=o.move("]:"),e.children&&e.children.length>0&&(o.shift(4),a+=o.move((t?"\n":" ")+r.indentLines(r.containerFlow(e,o.current()),t?Ls:Os))),s(),a},footnoteReference:Ms},unsafe:[{character:"[",inConstruct:["label","phrasing","reference"]}]}}function Os(e,t,n){return 0===t?e:Ls(e,0,n)}function Ls(e,t,n){return(n?"":"    ")+e}Ms.peek=function(){return"["}
const Ns=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"]
function Fs(e){this.enter({type:"delete",children:[]},e)}function zs(e){this.exit(e)}function js(e,t,n,r){const i=n.createTracker(r),o=n.enter("strikethrough")
let a=i.move("~~")
return a+=n.containerPhrasing(e,{...i.current(),before:a,after:"~"}),a+=i.move("~~"),o(),a}function Vs(e){return e.length}function Us(e){return null==e?"":String(e)}function Gs(e){const t="string"==typeof e?e.codePointAt(0):0
return 67===t||99===t?99:76===t||108===t?108:82===t||114===t?114:0}function Hs(e,t,n){return">"+(n?"":" ")+e}function qs(e,t){return Qs(e,t.inConstruct,!0)&&!Qs(e,t.notInConstruct,!1)}function Qs(e,t,n){if("string"==typeof t&&(t=[t]),!t||0===t.length)return n
let r=-1
for(;++r<t.length;)if(e.includes(t[r]))return!0
return!1}function $s(e,t,n,r){let i=-1
for(;++i<n.unsafe.length;)if("\n"===n.unsafe[i].character&&qs(n.stack,n.unsafe[i]))return/[ \t]/.test(r.before)?"":" "
return"\\\n"}function Xs(e,t,n){return(n?"":"    ")+e}function Ws(e){const t=e.options.quote||'"'
if('"'!==t&&"'"!==t)throw new Error("Cannot serialize title with `"+t+"` for `options.quote`, expected `\"`, or `'`")
return t}function Ys(e){return"&#x"+e.toString(16).toUpperCase()+";"}function Zs(e,t,n){const r=Ut(e),i=Ut(t)
return void 0===r?void 0===i?"_"===n?{inside:!0,outside:!0}:{inside:!1,outside:!1}:1===i?{inside:!0,outside:!0}:{inside:!1,outside:!0}:1===r?void 0===i?{inside:!1,outside:!1}:1===i?{inside:!0,outside:!0}:{inside:!1,outside:!1}:void 0===i?{inside:!1,outside:!1}:1===i?{inside:!0,outside:!1}:{inside:!1,outside:!1}}function Ks(e,t,n,r){const i=function(e){const t=e.options.emphasis||"*"
if("*"!==t&&"_"!==t)throw new Error("Cannot serialize emphasis with `"+t+"` for `options.emphasis`, expected `*`, or `_`")
return t}(n),o=n.enter("emphasis"),a=n.createTracker(r),s=a.move(i)
let l=a.move(n.containerPhrasing(e,{after:i,before:s,...a.current()}))
const c=l.charCodeAt(0),u=Zs(r.before.charCodeAt(r.before.length-1),c,i)
u.inside&&(l=Ys(c)+l.slice(1))
const d=l.charCodeAt(l.length-1),p=Zs(r.after.charCodeAt(0),d,i)
p.inside&&(l=l.slice(0,-1)+Ys(d))
const h=a.move(i)
return o(),n.attentionEncodeSurroundingInfo={after:p.outside,before:u.outside},s+l+h}function Js(e){return e.value||""}function el(e,t,n,r){const i=Ws(n),o='"'===i?"Quote":"Apostrophe",a=n.enter("image")
let s=n.enter("label")
const l=n.createTracker(r)
let c=l.move("![")
return c+=l.move(n.safe(e.alt,{before:c,after:"]",...l.current()})),c+=l.move("]("),s(),!e.url&&e.title||/[\0- \u007F]/.test(e.url)?(s=n.enter("destinationLiteral"),c+=l.move("<"),c+=l.move(n.safe(e.url,{before:c,after:">",...l.current()})),c+=l.move(">")):(s=n.enter("destinationRaw"),c+=l.move(n.safe(e.url,{before:c,after:e.title?" ":")",...l.current()}))),s(),e.title&&(s=n.enter(`title${o}`),c+=l.move(" "+i),c+=l.move(n.safe(e.title,{before:c,after:i,...l.current()})),c+=l.move(i),s()),c+=l.move(")"),a(),c}function tl(e,t,n,r){const i=e.referenceType,o=n.enter("imageReference")
let a=n.enter("label")
const s=n.createTracker(r)
let l=s.move("![")
const c=n.safe(e.alt,{before:l,after:"]",...s.current()})
l+=s.move(c+"]["),a()
const u=n.stack
n.stack=[],a=n.enter("reference")
const d=n.safe(n.associationId(e),{before:l,after:"]",...s.current()})
return a(),n.stack=u,o(),"full"!==i&&c&&c===d?"shortcut"===i?l=l.slice(0,-1):l+=s.move("]"):l+=s.move(d+"]"),l}function nl(e,t,n){let r=e.value||"",i="`",o=-1
for(;new RegExp("(^|[^`])"+i+"([^`]|$)").test(r);)i+="`"
for(/[^ \r\n]/.test(r)&&(/^[ \r\n]/.test(r)&&/[ \r\n]$/.test(r)||/^`|`$/.test(r))&&(r=" "+r+" ");++o<n.unsafe.length;){const e=n.unsafe[o],t=n.compilePattern(e)
let i
if(e.atBreak)for(;i=t.exec(r);){let e=i.index
10===r.charCodeAt(e)&&13===r.charCodeAt(e-1)&&e--,r=r.slice(0,e)+" "+r.slice(i.index+1)}}return i+r+i}function rl(e,t){const n=_e(e)
return Boolean(!t.options.resourceLink&&e.url&&!e.title&&e.children&&1===e.children.length&&"text"===e.children[0].type&&(n===e.url||"mailto:"+n===e.url)&&/^[a-z][a-z+.-]+:/i.test(e.url)&&!/[\0- <>\u007F]/.test(e.url))}function il(e,t,n,r){const i=Ws(n),o='"'===i?"Quote":"Apostrophe",a=n.createTracker(r)
let s,l
if(rl(e,n)){const t=n.stack
n.stack=[],s=n.enter("autolink")
let r=a.move("<")
return r+=a.move(n.containerPhrasing(e,{before:r,after:">",...a.current()})),r+=a.move(">"),s(),n.stack=t,r}s=n.enter("link"),l=n.enter("label")
let c=a.move("[")
return c+=a.move(n.containerPhrasing(e,{before:c,after:"](",...a.current()})),c+=a.move("]("),l(),!e.url&&e.title||/[\0- \u007F]/.test(e.url)?(l=n.enter("destinationLiteral"),c+=a.move("<"),c+=a.move(n.safe(e.url,{before:c,after:">",...a.current()})),c+=a.move(">")):(l=n.enter("destinationRaw"),c+=a.move(n.safe(e.url,{before:c,after:e.title?" ":")",...a.current()}))),l(),e.title&&(l=n.enter(`title${o}`),c+=a.move(" "+i),c+=a.move(n.safe(e.title,{before:c,after:i,...a.current()})),c+=a.move(i),l()),c+=a.move(")"),s(),c}function ol(e,t,n,r){const i=e.referenceType,o=n.enter("linkReference")
let a=n.enter("label")
const s=n.createTracker(r)
let l=s.move("[")
const c=n.containerPhrasing(e,{before:l,after:"]",...s.current()})
l+=s.move(c+"]["),a()
const u=n.stack
n.stack=[],a=n.enter("reference")
const d=n.safe(n.associationId(e),{before:l,after:"]",...s.current()})
return a(),n.stack=u,o(),"full"!==i&&c&&c===d?"shortcut"===i?l=l.slice(0,-1):l+=s.move("]"):l+=s.move(d+"]"),l}function al(e){const t=e.options.bullet||"*"
if("*"!==t&&"+"!==t&&"-"!==t)throw new Error("Cannot serialize items with `"+t+"` for `options.bullet`, expected `*`, `+`, or `-`")
return t}function sl(e){const t=e.options.rule||"*"
if("*"!==t&&"-"!==t&&"_"!==t)throw new Error("Cannot serialize rules with `"+t+"` for `options.rule`, expected `*`, `-`, or `_`")
return t}js.peek=function(){return"~"},Ks.peek=function(e,t,n){return n.options.emphasis||"*"},Js.peek=function(){return"<"},el.peek=function(){return"!"},tl.peek=function(){return"!"},nl.peek=function(){return"`"},il.peek=function(e,t,n){return rl(e,n)?"<":"["},ol.peek=function(){return"["}
const ll=Bn(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","inlineMath","link","linkReference","mdxJsxTextElement","mdxTextExpression","strong","text","textDirective"])
function cl(e,t,n,r){const i=function(e){const t=e.options.strong||"*"
if("*"!==t&&"_"!==t)throw new Error("Cannot serialize strong with `"+t+"` for `options.strong`, expected `*`, or `_`")
return t}(n),o=n.enter("strong"),a=n.createTracker(r),s=a.move(i+i)
let l=a.move(n.containerPhrasing(e,{after:i,before:s,...a.current()}))
const c=l.charCodeAt(0),u=Zs(r.before.charCodeAt(r.before.length-1),c,i)
u.inside&&(l=Ys(c)+l.slice(1))
const d=l.charCodeAt(l.length-1),p=Zs(r.after.charCodeAt(0),d,i)
p.inside&&(l=l.slice(0,-1)+Ys(d))
const h=a.move(i+i)
return o(),n.attentionEncodeSurroundingInfo={after:p.outside,before:u.outside},s+l+h}cl.peek=function(e,t,n){return n.options.strong||"*"}
const ul={blockquote:function(e,t,n,r){const i=n.enter("blockquote"),o=n.createTracker(r)
o.move("> "),o.shift(2)
const a=n.indentLines(n.containerFlow(e,o.current()),Hs)
return i(),a},break:$s,code:function(e,t,n,r){const i=function(e){const t=e.options.fence||"`"
if("`"!==t&&"~"!==t)throw new Error("Cannot serialize code with `"+t+"` for `options.fence`, expected `` ` `` or `~`")
return t}(n),o=e.value||"",a="`"===i?"GraveAccent":"Tilde"
if(function(e,t){return Boolean(!1===t.options.fences&&e.value&&!e.lang&&/[^ \r\n]/.test(e.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(e.value))}(e,n)){const e=n.enter("codeIndented"),t=n.indentLines(o,Xs)
return e(),t}const s=n.createTracker(r),l=i.repeat(Math.max(function(e,t){const n=String(e)
let r=n.indexOf(t),i=r,o=0,a=0
if("string"!=typeof t)throw new TypeError("Expected substring")
for(;-1!==r;)r===i?++o>a&&(a=o):o=1,i=r+t.length,r=n.indexOf(t,i)
return a}(o,i)+1,3)),c=n.enter("codeFenced")
let u=s.move(l)
if(e.lang){const t=n.enter(`codeFencedLang${a}`)
u+=s.move(n.safe(e.lang,{before:u,after:" ",encode:["`"],...s.current()})),t()}if(e.lang&&e.meta){const t=n.enter(`codeFencedMeta${a}`)
u+=s.move(" "),u+=s.move(n.safe(e.meta,{before:u,after:"\n",encode:["`"],...s.current()})),t()}return u+=s.move("\n"),o&&(u+=s.move(o+"\n")),u+=s.move(l),c(),u},definition:function(e,t,n,r){const i=Ws(n),o='"'===i?"Quote":"Apostrophe",a=n.enter("definition")
let s=n.enter("label")
const l=n.createTracker(r)
let c=l.move("[")
return c+=l.move(n.safe(n.associationId(e),{before:c,after:"]",...l.current()})),c+=l.move("]: "),s(),!e.url||/[\0- \u007F]/.test(e.url)?(s=n.enter("destinationLiteral"),c+=l.move("<"),c+=l.move(n.safe(e.url,{before:c,after:">",...l.current()})),c+=l.move(">")):(s=n.enter("destinationRaw"),c+=l.move(n.safe(e.url,{before:c,after:e.title?" ":"\n",...l.current()}))),s(),e.title&&(s=n.enter(`title${o}`),c+=l.move(" "+i),c+=l.move(n.safe(e.title,{before:c,after:i,...l.current()})),c+=l.move(i),s()),a(),c},emphasis:Ks,hardBreak:$s,heading:function(e,t,n,r){const i=Math.max(Math.min(6,e.depth||1),1),o=n.createTracker(r)
if(function(e,t){let n=!1
return On(e,function(e){if("value"in e&&/\r?\n|\r/.test(e.value)||"break"===e.type)return n=!0,Mn}),Boolean((!e.depth||e.depth<3)&&_e(e)&&(t.options.setext||n))}(e,n)){const t=n.enter("headingSetext"),r=n.enter("phrasing"),a=n.containerPhrasing(e,{...o.current(),before:"\n",after:"\n"})
return r(),t(),a+"\n"+(1===i?"=":"-").repeat(a.length-(Math.max(a.lastIndexOf("\r"),a.lastIndexOf("\n"))+1))}const a="#".repeat(i),s=n.enter("headingAtx"),l=n.enter("phrasing")
o.move(a+" ")
let c=n.containerPhrasing(e,{before:"# ",after:"\n",...o.current()})
return/^[\t ]/.test(c)&&(c=Ys(c.charCodeAt(0))+c.slice(1)),c=c?a+" "+c:a,n.options.closeAtx&&(c+=" "+a),l(),s(),c},html:Js,image:el,imageReference:tl,inlineCode:nl,link:il,linkReference:ol,list:function(e,t,n,r){const i=n.enter("list"),o=n.bulletCurrent
let a=e.ordered?function(e){const t=e.options.bulletOrdered||"."
if("."!==t&&")"!==t)throw new Error("Cannot serialize items with `"+t+"` for `options.bulletOrdered`, expected `.` or `)`")
return t}(n):al(n)
const s=e.ordered?"."===a?")":".":function(e){const t=al(e),n=e.options.bulletOther
if(!n)return"*"===t?"-":"*"
if("*"!==n&&"+"!==n&&"-"!==n)throw new Error("Cannot serialize items with `"+n+"` for `options.bulletOther`, expected `*`, `+`, or `-`")
if(n===t)throw new Error("Expected `bullet` (`"+t+"`) and `bulletOther` (`"+n+"`) to be different")
return n}(n)
let l=!(!t||!n.bulletLastUsed)&&a===n.bulletLastUsed
if(!e.ordered){const t=e.children?e.children[0]:void 0
if("*"!==a&&"-"!==a||!t||t.children&&t.children[0]||"list"!==n.stack[n.stack.length-1]||"listItem"!==n.stack[n.stack.length-2]||"list"!==n.stack[n.stack.length-3]||"listItem"!==n.stack[n.stack.length-4]||0!==n.indexStack[n.indexStack.length-1]||0!==n.indexStack[n.indexStack.length-2]||0!==n.indexStack[n.indexStack.length-3]||(l=!0),sl(n)===a&&t){let t=-1
for(;++t<e.children.length;){const n=e.children[t]
if(n&&"listItem"===n.type&&n.children&&n.children[0]&&"thematicBreak"===n.children[0].type){l=!0
break}}}}l&&(a=s),n.bulletCurrent=a
const c=n.containerFlow(e,r)
return n.bulletLastUsed=a,n.bulletCurrent=o,i(),c},listItem:function(e,t,n,r){const i=function(e){const t=e.options.listItemIndent||"one"
if("tab"!==t&&"one"!==t&&"mixed"!==t)throw new Error("Cannot serialize items with `"+t+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`")
return t}(n)
let o=n.bulletCurrent||al(n)
t&&"list"===t.type&&t.ordered&&(o=("number"==typeof t.start&&t.start>-1?t.start:1)+(!1===n.options.incrementListMarker?0:t.children.indexOf(e))+o)
let a=o.length+1;("tab"===i||"mixed"===i&&(t&&"list"===t.type&&t.spread||e.spread))&&(a=4*Math.ceil(a/4))
const s=n.createTracker(r)
s.move(o+" ".repeat(a-o.length)),s.shift(a)
const l=n.enter("listItem"),c=n.indentLines(n.containerFlow(e,s.current()),function(e,t,n){return t?(n?"":" ".repeat(a))+e:(n?o:o+" ".repeat(a-o.length))+e})
return l(),c},paragraph:function(e,t,n,r){const i=n.enter("paragraph"),o=n.enter("phrasing"),a=n.containerPhrasing(e,r)
return o(),i(),a},root:function(e,t,n,r){return(e.children.some(function(e){return ll(e)})?n.containerPhrasing:n.containerFlow).call(n,e,r)},strong:cl,text:function(e,t,n,r){return n.safe(e.value,r)},thematicBreak:function(e,t,n){const r=(sl(n)+(n.options.ruleSpaces?" ":"")).repeat(function(e){const t=e.options.ruleRepetition||3
if(t<3)throw new Error("Cannot serialize rules with repetition `"+t+"` for `options.ruleRepetition`, expected `3` or more")
return t}(n))
return n.options.ruleSpaces?r.slice(0,-1):r}}
function dl(e){const t=e._align
this.enter({type:"table",align:t.map(function(e){return"none"===e?null:e}),children:[]},e),this.data.inTable=!0}function pl(e){this.exit(e),this.data.inTable=void 0}function hl(e){this.enter({type:"tableRow",children:[]},e)}function fl(e){this.exit(e)}function ml(e){this.enter({type:"tableCell",children:[]},e)}function gl(e){let t=this.resume()
this.data.inTable&&(t=t.replace(/\\([\\|])/g,yl))
const n=this.stack[this.stack.length-1]
n.type,n.value=t,this.exit(e)}function yl(e,t){return"|"===t?t:e}function vl(e){const t=e||{},n=t.tableCellPadding,r=t.tablePipeAlign,i=t.stringLength,o=n?" ":"|"
return{unsafe:[{character:"\r",inConstruct:"tableCell"},{character:"\n",inConstruct:"tableCell"},{atBreak:!0,character:"|",after:"[\t :-]"},{character:"|",inConstruct:"tableCell"},{atBreak:!0,character:":",after:"-"},{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{inlineCode:function(e,t,n){let r=ul.inlineCode(e,t,n)
return n.stack.includes("tableCell")&&(r=r.replace(/\|/g,"\\$&")),r},table:function(e,t,n,r){return s(function(e,t,n){const r=e.children
let i=-1
const o=[],a=t.enter("table")
for(;++i<r.length;)o[i]=l(r[i],t,n)
return a(),o}(e,n,r),e.align)},tableCell:a,tableRow:function(e,t,n,r){const i=s([l(e,n,r)])
return i.slice(0,i.indexOf("\n"))}}}
function a(e,t,n,r){const i=n.enter("tableCell"),a=n.enter("phrasing"),s=n.containerPhrasing(e,{...r,before:o,after:o})
return a(),i(),s}function s(e,t){return function(e,t){const n=t||{},r=(n.align||[]).concat(),i=n.stringLength||Vs,o=[],a=[],s=[],l=[]
let c=0,u=-1
for(;++u<e.length;){const t=[],r=[]
let o=-1
for(e[u].length>c&&(c=e[u].length);++o<e[u].length;){const a=Us(e[u][o])
if(!1!==n.alignDelimiters){const e=i(a)
r[o]=e,(void 0===l[o]||e>l[o])&&(l[o]=e)}t.push(a)}a[u]=t,s[u]=r}let d=-1
if("object"==typeof r&&"length"in r)for(;++d<c;)o[d]=Gs(r[d])
else{const e=Gs(r)
for(;++d<c;)o[d]=e}d=-1
const p=[],h=[]
for(;++d<c;){const e=o[d]
let t="",r=""
99===e?(t=":",r=":"):108===e?t=":":114===e&&(r=":")
let i=!1===n.alignDelimiters?1:Math.max(1,l[d]-t.length-r.length)
const a=t+"-".repeat(i)+r
!1!==n.alignDelimiters&&(i=t.length+i+r.length,i>l[d]&&(l[d]=i),h[d]=i),p[d]=a}a.splice(1,0,p),s.splice(1,0,h),u=-1
const f=[]
for(;++u<a.length;){const e=a[u],t=s[u]
d=-1
const r=[]
for(;++d<c;){const i=e[d]||""
let a="",s=""
if(!1!==n.alignDelimiters){const e=l[d]-(t[d]||0),n=o[d]
114===n?a=" ".repeat(e):99===n?e%2?(a=" ".repeat(e/2+.5),s=" ".repeat(e/2-.5)):(a=" ".repeat(e/2),s=a):s=" ".repeat(e)}!1===n.delimiterStart||d||r.push("|"),!1===n.padding||!1===n.alignDelimiters&&""===i||!1===n.delimiterStart&&!d||r.push(" "),!1!==n.alignDelimiters&&r.push(a),r.push(i),!1!==n.alignDelimiters&&r.push(s),!1!==n.padding&&r.push(" "),!1===n.delimiterEnd&&d===c-1||r.push("|")}f.push(!1===n.delimiterEnd?r.join("").replace(/ +$/,""):r.join(""))}return f.join("\n")}(e,{align:t,alignDelimiters:r,padding:n,stringLength:i})}function l(e,t,n){const r=e.children
let i=-1
const o=[],s=t.enter("tableRow")
for(;++i<r.length;)o[i]=a(r[i],0,t,n)
return s(),o}}function bl(e){const t=this.stack[this.stack.length-2]
t.type,t.checked="taskListCheckValueChecked"===e.type}function xl(e){const t=this.stack[this.stack.length-2]
if(t&&"listItem"===t.type&&"boolean"==typeof t.checked){const e=this.stack[this.stack.length-1]
e.type
const n=e.children[0]
if(n&&"text"===n.type){const r=t.children
let i,o=-1
for(;++o<r.length;){const e=r[o]
if("paragraph"===e.type){i=e
break}}i===e&&(n.value=n.value.slice(1),0===n.value.length?e.children.shift():e.position&&n.position&&"number"==typeof n.position.start.offset&&(n.position.start.column++,n.position.start.offset++,e.position.start=Object.assign({},n.position.start)))}}this.exit(e)}function Sl(e,t,n,r){const i=e.children[0],o="boolean"==typeof e.checked&&i&&"paragraph"===i.type,a="["+(e.checked?"x":" ")+"] ",s=n.createTracker(r)
o&&s.move(a)
let l=ul.listItem(e,t,n,{...r,...s.current()})
return o&&(l=l.replace(/^(?:[*+-]|\d+\.)([\r\n]| {1,3})/,function(e){return e+a})),l}const _l={tokenize:function(e,t,n){let r=0
return function t(o){return(87===o||119===o)&&r<3?(r++,e.consume(o),t):46===o&&3===r?(e.consume(o),i):n(o)}
function i(e){return null===e?n(e):t(e)}},partial:!0},Cl={tokenize:function(e,t,n){let r,i,o
return a
function a(t){return 46===t||95===t?e.check(Tl,l,s)(t):null===t||Ge(t)||Qe(t)||45!==t&&qe(t)?l(t):(o=!0,e.consume(t),a)}function s(t){return 95===t?r=!0:(i=r,r=void 0),e.consume(t),a}function l(e){return i||r||!o?n(e):t(e)}},partial:!0},wl={tokenize:function(e,t){let n=0,r=0
return i
function i(a){return 40===a?(n++,e.consume(a),i):41===a&&r<n?o(a):33===a||34===a||38===a||39===a||41===a||42===a||44===a||46===a||58===a||59===a||60===a||63===a||93===a||95===a||126===a?e.check(Tl,t,o)(a):null===a||Ge(a)||Qe(a)?t(a):(e.consume(a),i)}function o(t){return 41===t&&r++,e.consume(t),i}},partial:!0},Tl={tokenize:function(e,t,n){return r
function r(a){return 33===a||34===a||39===a||41===a||42===a||44===a||46===a||58===a||59===a||63===a||95===a||126===a?(e.consume(a),r):38===a?(e.consume(a),o):93===a?(e.consume(a),i):60===a||null===a||Ge(a)||Qe(a)?t(a):n(a)}function i(e){return null===e||40===e||91===e||Ge(e)||Qe(e)?t(e):r(e)}function o(e){return Oe(e)?a(e):n(e)}function a(t){return 59===t?(e.consume(t),r):Oe(t)?(e.consume(t),a):n(t)}},partial:!0},Al={tokenize:function(e,t,n){return function(t){return e.consume(t),r}
function r(e){return Le(e)?n(e):t(e)}},partial:!0},Il={name:"wwwAutolink",tokenize:function(e,t,n){const r=this
return function(t){return 87!==t&&119!==t||!Dl.call(r,r.previous)||Ll(r.events)?n(t):(e.enter("literalAutolink"),e.enter("literalAutolinkWww"),e.check(_l,e.attempt(Cl,e.attempt(wl,i),n),n)(t))}
function i(n){return e.exit("literalAutolinkWww"),e.exit("literalAutolink"),t(n)}},previous:Dl},Pl={name:"protocolAutolink",tokenize:function(e,t,n){const r=this
let i="",o=!1
return function(t){return 72!==t&&104!==t||!Ml.call(r,r.previous)||Ll(r.events)?n(t):(e.enter("literalAutolink"),e.enter("literalAutolinkHttp"),i+=String.fromCodePoint(t),e.consume(t),a)}
function a(t){if(Oe(t)&&i.length<5)return i+=String.fromCodePoint(t),e.consume(t),a
if(58===t){const n=i.toLowerCase()
if("http"===n||"https"===n)return e.consume(t),s}return n(t)}function s(t){return 47===t?(e.consume(t),o?l:(o=!0,s)):n(t)}function l(t){return null===t||Fe(t)||Ge(t)||Qe(t)||qe(t)?n(t):e.attempt(Cl,e.attempt(wl,c),n)(t)}function c(n){return e.exit("literalAutolinkHttp"),e.exit("literalAutolink"),t(n)}},previous:Ml},Bl={name:"emailAutolink",tokenize:function(e,t,n){const r=this
let i,o
return function(t){return Ol(t)&&Rl.call(r,r.previous)&&!Ll(r.events)?(e.enter("literalAutolink"),e.enter("literalAutolinkEmail"),a(t)):n(t)}
function a(t){return Ol(t)?(e.consume(t),a):64===t?(e.consume(t),s):n(t)}function s(t){return 46===t?e.check(Al,c,l)(t):45===t||95===t||Le(t)?(o=!0,e.consume(t),s):c(t)}function l(t){return e.consume(t),i=!0,s}function c(a){return o&&i&&Oe(r.previous)?(e.exit("literalAutolinkEmail"),e.exit("literalAutolink"),t(a)):n(a)}},previous:Rl},El={}
let kl=48
for(;kl<123;)El[kl]=Bl,kl++,58===kl?kl=65:91===kl&&(kl=97)
function Dl(e){return null===e||40===e||42===e||95===e||91===e||93===e||126===e||Ge(e)}function Ml(e){return!Oe(e)}function Rl(e){return!(47===e||Ol(e))}function Ol(e){return 43===e||45===e||46===e||95===e||Le(e)}function Ll(e){let t=e.length,n=!1
for(;t--;){const r=e[t][1]
if(("labelLink"===r.type||"labelImage"===r.type)&&!r._balanced){n=!0
break}if(r._gfmAutolinkLiteralWalkedInto){n=!1
break}}return e.length>0&&!n&&(e[e.length-1][1]._gfmAutolinkLiteralWalkedInto=!0),n}El[43]=Bl,El[45]=Bl,El[46]=Bl,El[95]=Bl,El[72]=[Bl,Pl],El[104]=[Bl,Pl],El[87]=[Bl,Il],El[119]=[Bl,Il]
const Nl={tokenize:function(e,t,n){const r=this
return Xe(e,function(e){const i=r.events[r.events.length-1]
return i&&"gfmFootnoteDefinitionIndent"===i[1].type&&4===i[2].sliceSerialize(i[1],!0).length?t(e):n(e)},"gfmFootnoteDefinitionIndent",5)},partial:!0}
function Fl(e,t,n){const r=this
let i=r.events.length
const o=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[])
let a
for(;i--;){const e=r.events[i][1]
if("labelImage"===e.type){a=e
break}if("gfmFootnoteCall"===e.type||"labelLink"===e.type||"label"===e.type||"image"===e.type||"link"===e.type)break}return function(i){if(!a||!a._balanced)return n(i)
const s=yt(r.sliceSerialize({start:a.end,end:r.now()}))
return 94===s.codePointAt(0)&&o.includes(s.slice(1))?(e.enter("gfmFootnoteCallLabelMarker"),e.consume(i),e.exit("gfmFootnoteCallLabelMarker"),t(i)):n(i)}}function zl(e,t){let n,r=e.length
for(;r--;)if("labelImage"===e[r][1].type&&"enter"===e[r][0]){n=e[r][1]
break}e[r+1][1].type="data",e[r+3][1].type="gfmFootnoteCallLabelMarker"
const i={type:"gfmFootnoteCall",start:Object.assign({},e[r+3][1].start),end:Object.assign({},e[e.length-1][1].end)},o={type:"gfmFootnoteCallMarker",start:Object.assign({},e[r+3][1].end),end:Object.assign({},e[r+3][1].end)}
o.end.column++,o.end.offset++,o.end._bufferIndex++
const a={type:"gfmFootnoteCallString",start:Object.assign({},o.end),end:Object.assign({},e[e.length-1][1].start)},s={type:"chunkString",contentType:"string",start:Object.assign({},a.start),end:Object.assign({},a.end)},l=[e[r+1],e[r+2],["enter",i,t],e[r+3],e[r+4],["enter",o,t],["exit",o,t],["enter",a,t],["enter",s,t],["exit",s,t],["exit",a,t],e[e.length-2],e[e.length-1],["exit",i,t]]
return e.splice(r,e.length-r+1,...l),e}function jl(e,t,n){const r=this,i=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[])
let o,a=0
return function(t){return e.enter("gfmFootnoteCall"),e.enter("gfmFootnoteCallLabelMarker"),e.consume(t),e.exit("gfmFootnoteCallLabelMarker"),s}
function s(t){return 94!==t?n(t):(e.enter("gfmFootnoteCallMarker"),e.consume(t),e.exit("gfmFootnoteCallMarker"),e.enter("gfmFootnoteCallString"),e.enter("chunkString").contentType="string",l)}function l(s){if(a>999||93===s&&!o||null===s||91===s||Ge(s))return n(s)
if(93===s){e.exit("chunkString")
const o=e.exit("gfmFootnoteCallString")
return i.includes(yt(r.sliceSerialize(o)))?(e.enter("gfmFootnoteCallLabelMarker"),e.consume(s),e.exit("gfmFootnoteCallLabelMarker"),e.exit("gfmFootnoteCall"),t):n(s)}return Ge(s)||(o=!0),a++,e.consume(s),92===s?c:l}function c(t){return 91===t||92===t||93===t?(e.consume(t),a++,l):l(t)}}function Vl(e,t,n){const r=this,i=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[])
let o,a,s=0
return function(t){return e.enter("gfmFootnoteDefinition")._container=!0,e.enter("gfmFootnoteDefinitionLabel"),e.enter("gfmFootnoteDefinitionLabelMarker"),e.consume(t),e.exit("gfmFootnoteDefinitionLabelMarker"),l}
function l(t){return 94===t?(e.enter("gfmFootnoteDefinitionMarker"),e.consume(t),e.exit("gfmFootnoteDefinitionMarker"),e.enter("gfmFootnoteDefinitionLabelString"),e.enter("chunkString").contentType="string",c):n(t)}function c(t){if(s>999||93===t&&!a||null===t||91===t||Ge(t))return n(t)
if(93===t){e.exit("chunkString")
const n=e.exit("gfmFootnoteDefinitionLabelString")
return o=yt(r.sliceSerialize(n)),e.enter("gfmFootnoteDefinitionLabelMarker"),e.consume(t),e.exit("gfmFootnoteDefinitionLabelMarker"),e.exit("gfmFootnoteDefinitionLabel"),d}return Ge(t)||(a=!0),s++,e.consume(t),92===t?u:c}function u(t){return 91===t||92===t||93===t?(e.consume(t),s++,c):c(t)}function d(t){return 58===t?(e.enter("definitionMarker"),e.consume(t),e.exit("definitionMarker"),i.includes(o)||i.push(o),Xe(e,p,"gfmFootnoteDefinitionWhitespace")):n(t)}function p(e){return t(e)}}function Ul(e,t,n){return e.check(Ke,t,e.attempt(Nl,t,n))}function Gl(e){e.exit("gfmFootnoteDefinition")}function Hl(e){let t=(e||{}).singleTilde
const n={name:"strikethrough",tokenize:function(e,n,r){const i=this.previous,o=this.events
let a=0
return function(t){return 126===i&&"characterEscape"!==o[o.length-1][1].type?r(t):(e.enter("strikethroughSequenceTemporary"),s(t))}
function s(o){const l=Ut(i)
if(126===o)return a>1?r(o):(e.consume(o),a++,s)
if(a<2&&!t)return r(o)
const c=e.exit("strikethroughSequenceTemporary"),u=Ut(o)
return c._open=!u||2===u&&Boolean(l),c._close=!l||2===l&&Boolean(u),n(o)}},resolveAll:function(e,t){let n=-1
for(;++n<e.length;)if("enter"===e[n][0]&&"strikethroughSequenceTemporary"===e[n][1].type&&e[n][1]._close){let r=n
for(;r--;)if("exit"===e[r][0]&&"strikethroughSequenceTemporary"===e[r][1].type&&e[r][1]._open&&e[n][1].end.offset-e[n][1].start.offset===e[r][1].end.offset-e[r][1].start.offset){e[n][1].type="strikethroughSequence",e[r][1].type="strikethroughSequence"
const i={type:"strikethrough",start:Object.assign({},e[r][1].start),end:Object.assign({},e[n][1].end)},o={type:"strikethroughText",start:Object.assign({},e[r][1].end),end:Object.assign({},e[n][1].start)},a=[["enter",i,t],["enter",e[r][1],t],["exit",e[r][1],t],["enter",o,t]],s=t.parser.constructs.insideSpan.null
s&&Te(a,a.length,0,Lt(s,e.slice(r+1,n),t)),Te(a,a.length,0,[["exit",o,t],["enter",e[n][1],t],["exit",e[n][1],t],["exit",i,t]]),Te(e,r-1,n-r+3,a),n=r+a.length-2
break}}for(n=-1;++n<e.length;)"strikethroughSequenceTemporary"===e[n][1].type&&(e[n][1].type="data")
return e}}
return null==t&&(t=!0),{text:{126:n},insideSpan:{null:[n]},attentionMarkers:{null:[126]}}}class ql{constructor(){this.map=[]}add(e,t,n){!function(e,t,n,r){let i=0
if(0!==n||0!==r.length){for(;i<e.map.length;){if(e.map[i][0]===t)return e.map[i][1]+=n,void e.map[i][2].push(...r)
i+=1}e.map.push([t,n,r])}}(this,e,t,n)}consume(e){if(this.map.sort(function(e,t){return e[0]-t[0]}),0===this.map.length)return
let t=this.map.length
const n=[]
for(;t>0;)t-=1,n.push(e.slice(this.map[t][0]+this.map[t][1]),this.map[t][2]),e.length=this.map[t][0]
n.push(e.slice()),e.length=0
let r=n.pop()
for(;r;){for(const t of r)e.push(t)
r=n.pop()}this.map.length=0}}function Ql(e,t){let n=!1
const r=[]
for(;t<e.length;){const i=e[t]
if(n){if("enter"===i[0])"tableContent"===i[1].type&&r.push("tableDelimiterMarker"===e[t+1][1].type?"left":"none")
else if("tableContent"===i[1].type){if("tableDelimiterMarker"===e[t-1][1].type){const e=r.length-1
r[e]="left"===r[e]?"center":"right"}}else if("tableDelimiterRow"===i[1].type)break}else"enter"===i[0]&&"tableDelimiterRow"===i[1].type&&(n=!0)
t+=1}return r}function $l(e,t,n){const r=this
let i,o=0,a=0
return function(e){let t=r.events.length-1
for(;t>-1;){const e=r.events[t][1].type
if("lineEnding"!==e&&"linePrefix"!==e)break
t--}const i=t>-1?r.events[t][1].type:null,o="tableHead"===i||"tableRow"===i?x:s
return o===x&&r.parser.lazy[r.now().line]?n(e):o(e)}
function s(t){return e.enter("tableHead"),e.enter("tableRow"),function(e){return 124===e||(i=!0,a+=1),l(e)}(t)}function l(t){return null===t?n(t):Ue(t)?a>1?(a=0,r.interrupt=!0,e.exit("tableRow"),e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),d):n(t):He(t)?Xe(e,l,"whitespace")(t):(a+=1,i&&(i=!1,o+=1),124===t?(e.enter("tableCellDivider"),e.consume(t),e.exit("tableCellDivider"),i=!0,l):(e.enter("data"),c(t)))}function c(t){return null===t||124===t||Ge(t)?(e.exit("data"),l(t)):(e.consume(t),92===t?u:c)}function u(t){return 92===t||124===t?(e.consume(t),c):c(t)}function d(t){return r.interrupt=!1,r.parser.lazy[r.now().line]?n(t):(e.enter("tableDelimiterRow"),i=!1,He(t)?Xe(e,p,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(t):p(t))}function p(t){return 45===t||58===t?f(t):124===t?(i=!0,e.enter("tableCellDivider"),e.consume(t),e.exit("tableCellDivider"),h):b(t)}function h(t){return He(t)?Xe(e,f,"whitespace")(t):f(t)}function f(t){return 58===t?(a+=1,i=!0,e.enter("tableDelimiterMarker"),e.consume(t),e.exit("tableDelimiterMarker"),m):45===t?(a+=1,m(t)):null===t||Ue(t)?v(t):b(t)}function m(t){return 45===t?(e.enter("tableDelimiterFiller"),g(t)):b(t)}function g(t){return 45===t?(e.consume(t),g):58===t?(i=!0,e.exit("tableDelimiterFiller"),e.enter("tableDelimiterMarker"),e.consume(t),e.exit("tableDelimiterMarker"),y):(e.exit("tableDelimiterFiller"),y(t))}function y(t){return He(t)?Xe(e,v,"whitespace")(t):v(t)}function v(n){return 124===n?p(n):(null===n||Ue(n))&&i&&o===a?(e.exit("tableDelimiterRow"),e.exit("tableHead"),t(n)):b(n)}function b(e){return n(e)}function x(t){return e.enter("tableRow"),S(t)}function S(n){return 124===n?(e.enter("tableCellDivider"),e.consume(n),e.exit("tableCellDivider"),S):null===n||Ue(n)?(e.exit("tableRow"),t(n)):He(n)?Xe(e,S,"whitespace")(n):(e.enter("data"),_(n))}function _(t){return null===t||124===t||Ge(t)?(e.exit("data"),S(t)):(e.consume(t),92===t?C:_)}function C(t){return 92===t||124===t?(e.consume(t),_):_(t)}}function Xl(e,t){let n,r,i,o=-1,a=!0,s=0,l=[0,0,0,0],c=[0,0,0,0],u=!1,d=0
const p=new ql
for(;++o<e.length;){const h=e[o],f=h[1]
"enter"===h[0]?"tableHead"===f.type?(u=!1,0!==d&&(Yl(p,t,d,n,r),r=void 0,d=0),n={type:"table",start:Object.assign({},f.start),end:Object.assign({},f.end)},p.add(o,0,[["enter",n,t]])):"tableRow"===f.type||"tableDelimiterRow"===f.type?(a=!0,i=void 0,l=[0,0,0,0],c=[0,o+1,0,0],u&&(u=!1,r={type:"tableBody",start:Object.assign({},f.start),end:Object.assign({},f.end)},p.add(o,0,[["enter",r,t]])),s="tableDelimiterRow"===f.type?2:r?3:1):!s||"data"!==f.type&&"tableDelimiterMarker"!==f.type&&"tableDelimiterFiller"!==f.type?"tableCellDivider"===f.type&&(a?a=!1:(0!==l[1]&&(c[0]=c[1],i=Wl(p,t,l,s,void 0,i)),l=c,c=[l[1],o,0,0])):(a=!1,0===c[2]&&(0!==l[1]&&(c[0]=c[1],i=Wl(p,t,l,s,void 0,i),l=[0,0,0,0]),c[2]=o)):"tableHead"===f.type?(u=!0,d=o):"tableRow"===f.type||"tableDelimiterRow"===f.type?(d=o,0!==l[1]?(c[0]=c[1],i=Wl(p,t,l,s,o,i)):0!==c[1]&&(i=Wl(p,t,c,s,o,i)),s=0):!s||"data"!==f.type&&"tableDelimiterMarker"!==f.type&&"tableDelimiterFiller"!==f.type||(c[3]=o)}for(0!==d&&Yl(p,t,d,n,r),p.consume(t.events),o=-1;++o<t.events.length;){const e=t.events[o]
"enter"===e[0]&&"table"===e[1].type&&(e[1]._align=Ql(t.events,o))}return e}function Wl(e,t,n,r,i,o){const a=1===r?"tableHeader":2===r?"tableDelimiter":"tableData"
0!==n[0]&&(o.end=Object.assign({},Zl(t.events,n[0])),e.add(n[0],0,[["exit",o,t]]))
const s=Zl(t.events,n[1])
if(o={type:a,start:Object.assign({},s),end:Object.assign({},s)},e.add(n[1],0,[["enter",o,t]]),0!==n[2]){const i=Zl(t.events,n[2]),o=Zl(t.events,n[3]),a={type:"tableContent",start:Object.assign({},i),end:Object.assign({},o)}
if(e.add(n[2],0,[["enter",a,t]]),2!==r){const r=t.events[n[2]],i=t.events[n[3]]
if(r[1].end=Object.assign({},i[1].end),r[1].type="chunkText",r[1].contentType="text",n[3]>n[2]+1){const t=n[2]+1,r=n[3]-n[2]-1
e.add(t,r,[])}}e.add(n[3]+1,0,[["exit",a,t]])}return void 0!==i&&(o.end=Object.assign({},Zl(t.events,i)),e.add(i,0,[["exit",o,t]]),o=void 0),o}function Yl(e,t,n,r,i){const o=[],a=Zl(t.events,n)
i&&(i.end=Object.assign({},a),o.push(["exit",i,t])),r.end=Object.assign({},a),o.push(["exit",r,t]),e.add(n+1,0,o)}function Zl(e,t){const n=e[t],r="enter"===n[0]?"start":"end"
return n[1][r]}const Kl={name:"tasklistCheck",tokenize:function(e,t,n){const r=this
return function(t){return null===r.previous&&r._gfmTasklistFirstContentOfListItem?(e.enter("taskListCheck"),e.enter("taskListCheckMarker"),e.consume(t),e.exit("taskListCheckMarker"),i):n(t)}
function i(t){return Ge(t)?(e.enter("taskListCheckValueUnchecked"),e.consume(t),e.exit("taskListCheckValueUnchecked"),o):88===t||120===t?(e.enter("taskListCheckValueChecked"),e.consume(t),e.exit("taskListCheckValueChecked"),o):n(t)}function o(t){return 93===t?(e.enter("taskListCheckMarker"),e.consume(t),e.exit("taskListCheckMarker"),e.exit("taskListCheck"),a):n(t)}function a(r){return Ue(r)?t(r):He(r)?e.check({tokenize:Jl},t,n)(r):n(r)}}}
function Jl(e,t,n){return Xe(e,function(e){return null===e?n(e):t(e)},"whitespace")}const ec={}
function tc(e){const t=e||ec,n=this.data(),r=n.micromarkExtensions||(n.micromarkExtensions=[]),i=n.fromMarkdownExtensions||(n.fromMarkdownExtensions=[]),o=n.toMarkdownExtensions||(n.toMarkdownExtensions=[])
r.push(function(e){return De([{text:El},{document:{91:{name:"gfmFootnoteDefinition",tokenize:Vl,continuation:{tokenize:Ul},exit:Gl}},text:{91:{name:"gfmFootnoteCall",tokenize:jl},93:{name:"gfmPotentialFootnoteCall",add:"after",tokenize:Fl,resolveTo:zl}}},Hl(e),{flow:{null:{name:"table",tokenize:$l,resolveAll:Xl}}},{text:{91:Kl}}])}(t)),i.push([{transforms:[Ss],enter:{literalAutolink:ms,literalAutolinkEmail:gs,literalAutolinkHttp:gs,literalAutolinkWww:gs},exit:{literalAutolink:xs,literalAutolinkEmail:bs,literalAutolinkHttp:ys,literalAutolinkWww:vs}},{enter:{gfmFootnoteCallString:Ts,gfmFootnoteCall:As,gfmFootnoteDefinitionLabelString:Is,gfmFootnoteDefinition:Ps},exit:{gfmFootnoteCallString:Bs,gfmFootnoteCall:Es,gfmFootnoteDefinitionLabelString:ks,gfmFootnoteDefinition:Ds}},{canContainEols:["delete"],enter:{strikethrough:Fs},exit:{strikethrough:zs}},{enter:{table:dl,tableData:ml,tableHeader:ml,tableRow:hl},exit:{codeText:gl,table:pl,tableData:fl,tableHeader:fl,tableRow:fl}},{exit:{taskListCheckValueChecked:bl,taskListCheckValueUnchecked:bl,paragraph:xl}}]),o.push(function(e){return{extensions:[{unsafe:[{character:"@",before:"[+\\-.\\w]",after:"[\\-.\\w]",inConstruct:hs,notInConstruct:fs},{character:".",before:"[Ww]",after:"[\\-.\\w]",inConstruct:hs,notInConstruct:fs},{character:":",before:"[ps]",after:"\\/",inConstruct:hs,notInConstruct:fs}]},Rs(e),{unsafe:[{character:"~",inConstruct:"phrasing",notInConstruct:Ns}],handlers:{delete:js}},vl(e),{unsafe:[{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{listItem:Sl}}]}}(t))}var nc=n(1712),rc=n(59048)
const ic=o.useSyncExternalStore?function(e){return o.useSyncExternalStore(o.useCallback(t=>{const n=null==e?void 0:e.pipe($i(1)).subscribe(t)
return()=>null==n?void 0:n.unsubscribe()},[e]),o.useCallback(()=>null==e?void 0:e.value,[e]))}:function(e){const[,t]=o.useState({}),n=o.useRef()
return n.current=null==e?void 0:e.value,o.useEffect(()=>{if(!e)return
const r=e.subscribe(e=>{n.current!==e&&t({})})
return()=>r.unsubscribe()},[e]),null==e?void 0:e.value}
function oc(e){return ic(e)}function ac({children:e,components:t}){return(0,a.jsxs)("div",{className:"msp-markdown",children:[(0,a.jsx)(sc,{}),(0,a.jsx)(Cr,{skipHtml:!0,components:{a:dc,img:lc,...t},remarkPlugins:[tc],children:e})]})}function sc(){const e=(0,o.useRef)(null),t=(0,o.useContext)(l.aU),n=oc(null==t?void 0:t.managers.markdownExtensions.state.audioPlayer)
return(0,o.useEffect)(()=>{if(e.current)return e.current.appendChild(n),()=>{null==n||n.remove()}},[n]),n?(0,a.jsx)("div",{className:"msp-markdown-audio-player",ref:e}):null}function lc({src:e,element:t,alt:n}){const r=(0,o.useContext)(l.aU)
if(!e)return t
pc(r)
const i=null==r?void 0:r.managers.markdownExtensions.parseArgs(e)
if(i){const e=null==r?void 0:r.managers.markdownExtensions.tryRender(i,uc)
return null!=e?e:t}{const t=null==r?void 0:r.managers.markdownExtensions.tryResolveUri(e)
if("function"==typeof(null==t?void 0:t.then))return(0,a.jsx)(cc,{alt:n,data:t})
if("string"==typeof t&&t)return(0,a.jsx)("img",{src:t,alt:n})}return(0,a.jsx)("img",{src:e,alt:n})}function cc({alt:e,data:t}){const[n,r]=(0,o.useState)(void 0)
return(0,o.useEffect)(()=>{let e=!0
return t.then(t=>{e&&r(t)}).catch(t=>{console.error("Failed to load static image",t),e&&r(void 0)}),()=>{e=!1}},[t]),n?(0,a.jsx)("img",{src:n,alt:e}):null}const uc=[{name:"color-swatch",reactRenderFn:({args:e})=>{const t=e["color-swatch"]
return t?(0,a.jsx)("span",{style:{display:"inline-block",width:"0.75em",height:"0.75em",backgroundColor:t,borderRadius:"25%"}}):null}},{name:"color-palette",reactRenderFn:({args:e})=>{var t,n,r
const i=e["color-palette-name"],o=e["color-palette-colors"],s=null!==(t=e["color-palette-width"])&&void 0!==t?t:"150px",l=null!==(n=e["color-palette-height"])&&void 0!==n?n:"0.5em",c="color-palette-discrete"in e
if(!i&&!o)return null
const u=o?(0,rc.fs)(o):null===(r=nc.VI[i.toLowerCase()])||void 0===r?void 0:r.list
return(null==u?void 0:u.length)?(0,a.jsx)("span",{style:{display:"inline-block",minWidth:s,height:l,background:(c?rc.y8:rc.Ch)(u),borderRadius:"2px"}}):(console.warn("Color palette could not be resolved.",e),null)}}]
function dc({href:e,children:t,element:n}){const r=(0,o.useContext)(l.aU)
if(!e)return n
pc(r)
const i=null==r?void 0:r.managers.markdownExtensions.parseArgs(e)
return i?(0,a.jsx)("a",{href:"#",onClick:e=>{e.preventDefault(),null==r||r.managers.markdownExtensions.tryExecute("click",i)},onMouseEnter:()=>null==r?void 0:r.managers.markdownExtensions.tryExecute("mouse-enter",i),onMouseLeave:()=>null==r?void 0:r.managers.markdownExtensions.tryExecute("mouse-leave",i),children:t}):"#"===e[0]?(pc(r),(0,a.jsx)("a",{href:"#",onClick:t=>{t.preventDefault(),null==r||r.managers.snapshot.applyKey(e.substring(1))},children:t})):e?(0,a.jsxs)("a",{href:e,target:"_blank",rel:"noopener noreferrer",children:[t,""]}):t}function pc(e){e||console.warn("Markdown component requires a PluginReactContext to be set.")}var hc=n(87877),fc=n(31993),mc=n(22063)
class gc extends l.dL{constructor(){super(...arguments),this.state={show:!1,label:""},this.update=()=>{const e=this.plugin.state.data,t=e.selectQ(e=>e.ofTransformer(Ar.f.Model.ModelFromTrajectory))
if(0===t.length)return void this.setState({show:!1})
let n="",r=0
const i=new Set
for(const o of t){if(!o.sourceRef)continue
const t=e.cells.get(o.sourceRef).obj
if(t&&t.data.frameCount>1){if(i.has(o.sourceRef))return void this.setState({show:!1})
if(i.add(o.sourceRef),r++,!n){const e=o.transform.params.modelIndex
n=`Model ${Math.round(e+1)} / ${t.data.frameCount}`}}}r>1&&(n=""),this.setState({show:r>0,label:n})},this.reset=()=>Ir.PluginCommands.State.ApplyAction(this.plugin,{state:this.plugin.state.data,action:Tr.UpdateTrajectory.create({action:"reset"})}),this.prev=()=>Ir.PluginCommands.State.ApplyAction(this.plugin,{state:this.plugin.state.data,action:Tr.UpdateTrajectory.create({action:"advance",by:-1})}),this.next=()=>Ir.PluginCommands.State.ApplyAction(this.plugin,{state:this.plugin.state.data,action:Tr.UpdateTrajectory.create({action:"advance",by:1})})}componentDidMount(){this.subscribe(this.plugin.state.data.events.changed,this.update),this.subscribe(this.plugin.behaviors.state.isAnimating,this.update)}render(){const e=this.plugin.behaviors.state.isAnimating.value
return!this.state.show||e&&!this.state.label||!this.plugin.config.get(go.PluginConfig.Viewport.ShowTrajectoryControls)?null:(0,a.jsxs)("div",{className:"msp-traj-controls",children:[!e&&(0,a.jsx)(Pr.K0,{svg:Br.je,title:"First Model",onClick:this.reset,disabled:e}),!e&&(0,a.jsx)(Pr.K0,{svg:Br.d6,title:"Previous Model",onClick:this.prev,disabled:e}),!e&&(0,a.jsx)(Pr.K0,{svg:Br.xf,title:"Next Model",onClick:this.next,disabled:e}),!!this.state.label&&(0,a.jsx)("span",{children:this.state.label})]})}}class yc extends l.dL{constructor(){super(...arguments),this.state={isBusy:!1,show:!0,showAnimation:!1},this.change=e=>{"none"!==e.target.value&&this.update(e.target.value)},this.prev=()=>{const e=this.plugin.managers.snapshot,t=e.getNextId(e.state.current,-1)
t&&this.update(t)},this.next=()=>{const e=this.plugin.managers.snapshot,t=e.getNextId(e.state.current,1)
t&&this.update(t)},this.togglePlay=()=>{this.plugin.managers.snapshot.togglePlay()},this.toggleShowAnimation=()=>{this.setState({showAnimation:!this.state.showAnimation})},this.toggleStateAnimation=()=>{this.state.isBusy?(this.plugin.managers.animation.stop(),this.plugin.managers.markdownExtensions.audio.pause()):this.plugin.managers.animation.play(fc.c,{})}}componentDidMount(){this.subscribe(this.plugin.managers.snapshot.events.changed,()=>this.forceUpdate()),this.subscribe(this.plugin.behaviors.state.isBusy,e=>this.setState({isBusy:e})),this.subscribe(this.plugin.behaviors.state.isAnimating,e=>this.setState({isBusy:e}))}componentWillUnmount(){super.componentWillUnmount()}async update(e){this.setState({isBusy:!0}),await Ir.PluginCommands.State.Snapshots.Apply(this.plugin,{id:e}),this.setState({isBusy:!1})}get isStateTransitionPlaying(){return this.plugin.managers.animation.isAnimatingStateTransition}render(){var e,t
const n=this.plugin.managers.snapshot,r=n.state.entries.size
if(!r||!this.state.show)return null
const i=n.state.current,o=n.state.isPlaying,s=n.getEntry(i),l=!!(null==s?void 0:s.snapshot.transition),c=o||this.state.isBusy&&!this.isStateTransitionPlaying
return(0,a.jsxs)("div",{className:"msp-state-snapshot-viewport-controls",children:[(0,a.jsxs)("select",{className:"msp-form-control",value:i||"none",onChange:this.change,disabled:c,children:[!i&&(0,a.jsx)("option",{value:"none"},"none"),n.state.entries.valueSeq().map((e,t)=>(0,a.jsxs)("option",{value:e.snapshot.id,children:[`[${t+1}/${r}]`," ",e.name||new Date(e.timestamp).toLocaleString()]},e.snapshot.id))]}),(0,a.jsx)(Pr.K0,{svg:o?Br.xY:Br.M6,title:o?"Pause":"Cycle States",onClick:this.togglePlay,disabled:!o&&this.state.isBusy&&!this.isStateTransitionPlaying}),!o&&(0,a.jsxs)(a.Fragment,{children:[r>1&&(0,a.jsx)(Pr.K0,{svg:Br.d6,title:"Previous State",onClick:this.prev,disabled:c}),r>1&&(0,a.jsx)(Pr.K0,{svg:Br.xf,title:"Next State",onClick:this.next,disabled:c}),l&&(0,a.jsx)(Pr.K0,{svg:Br.hU,className:"msp-state-snapshot-animation-button",title:"Snapshot Transition",onClick:this.toggleShowAnimation,disabled:!l,toggleState:this.state.showAnimation})]}),l&&this.state.showAnimation&&!o&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"msp-state-snapshot-animation-slider msp-form-control",children:[(0,a.jsx)(hc.Ap,{value:Math.round(100*(null!==(e=n.state.currentAnimationTimeMs)&&void 0!==e?e:0))/100,min:0,step:mc.p.getMinFrameDuration(null==s?void 0:s.snapshot),max:null!==(t=mc.p.getStateTransitionDuration(null==s?void 0:s.snapshot))&&void 0!==t?t:1e3,onChange:()=>{},onChangeImmediate:e=>n.setSnapshotAnimationFrame(e,!0),hideInput:!0,disabled:this.state.isBusy}),""]}),(0,a.jsx)(Pr.K0,{svg:this.state.isBusy?Br.xY:Br.ij,title:this.state.isBusy?"Stop":"Replay",onClick:this.toggleStateAnimation,toggleState:!1})]})]})}}function vc(){var e
const t=o.useContext(l.aU),[n,r]=o.useState(0)
o.useEffect(()=>{const e=t.managers.snapshot.events.changed.subscribe(()=>r(e=>e+1))
return()=>e.unsubscribe()},[t])
const i=t.managers.snapshot.state.current
if(!i)return null
const s=t.managers.snapshot.getEntry(i)
return(null===(e=null==s?void 0:s.description)||void 0===e?void 0:e.trim())?(0,a.jsx)("div",{id:"snapinfo",className:"msp-snapshot-description-wrapper",children:"plaintext"===s.descriptionFormat&&s.description||(0,a.jsx)(ac,{children:s.description})}):null}class bc extends l.dL{constructor(){super(...arguments),this.state={isEmpty:!0,isExpanded:!1,isBusy:!1,isAnimating:!1,isPlaying:!1},this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded}),this.stop=()=>{this.plugin.managers.animation.stop(),this.plugin.managers.snapshot.stop()}}componentDidMount(){this.subscribe(this.plugin.managers.snapshot.events.changed,()=>{this.plugin.managers.snapshot.state.isPlaying?this.setState({isPlaying:!0,isExpanded:!1}):this.setState({isPlaying:!1})}),this.subscribe(this.plugin.behaviors.state.isBusy,e=>{e?this.setState({isBusy:!0,isExpanded:!1,isEmpty:this.plugin.state.data.tree.transforms.size<2}):this.setState({isBusy:!1,isEmpty:this.plugin.state.data.tree.transforms.size<2})}),this.subscribe(this.plugin.behaviors.state.isAnimating,e=>{e?this.setState({isAnimating:!0,isExpanded:!1}):this.setState({isAnimating:!1})})}render(){const e=this.plugin.managers.snapshot.state.isPlaying
if(e||this.state.isEmpty||this.plugin.managers.animation.isEmpty||!this.plugin.config.get(go.PluginConfig.Viewport.ShowAnimation))return null
const t=this.state.isAnimating
return(0,a.jsxs)("div",{className:"msp-animation-viewport-controls",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"msp-semi-transparent-background"}),(0,a.jsx)(Pr.K0,{svg:t||e?Br.xY:Br.NT,transparent:!0,title:t?"Stop":"Select Animation",onClick:t||e?this.stop:this.toggleExpanded,toggleState:this.state.isExpanded,disabled:!t&&!e&&(this.state.isBusy||this.state.isPlaying||this.state.isEmpty)})]}),this.state.isExpanded&&!this.state.isBusy&&(0,a.jsx)("div",{className:"msp-animation-viewport-controls-select",children:(0,a.jsx)(kr,{onStart:this.toggleExpanded})})]})}}class xc extends l.dL{componentDidMount(){this.subscribe(this.plugin.behaviors.interaction.selectionMode,()=>this.forceUpdate())}render(){return this.plugin.selectionMode?(0,a.jsx)("div",{className:"msp-selection-viewport-controls",children:(0,a.jsx)(No,{})}):null}}class Sc extends l.dL{constructor(){super(...arguments),this.state={labels:[]}}componentDidMount(){this.subscribe(this.plugin.behaviors.labels.highlight,e=>this.setState({labels:e.labels}))}render(){return 0===this.state.labels.length?null:(0,a.jsx)("div",{className:"msp-highlight-info",children:this.state.labels.map((e,t)=>e.indexOf("\n")>=0?(0,a.jsx)("div",{className:"msp-highlight-markdown-row",children:(0,a.jsx)(Cr,{skipHtml:!0,children:e})},""+t):(0,a.jsx)("div",{className:"msp-highlight-simple-row",dangerouslySetInnerHTML:{__html:e}},""+t))})}}class _c extends l.dL{componentDidMount(){this.subscribe(this.plugin.state.behaviors.events.changed,()=>this.forceUpdate())}render(){const e=[]
return this.plugin.customStructureControls.forEach((t,n)=>{e.push((0,a.jsx)(t,{initiallyCollapsed:this.props.initiallyCollapsed},n))}),e.length>0?(0,a.jsx)(a.Fragment,{children:e}):null}}class Cc extends l.dL{render(){return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"msp-section-header",children:[(0,a.jsx)(Br.In,{svg:Br.RZ}),"Structure Tools"]}),(0,a.jsx)(Ko,{}),(0,a.jsx)(Go,{}),(0,a.jsx)(es,{}),(0,a.jsx)(as,{}),(0,a.jsx)(Ji,{}),this.plugin.config.get(go.PluginConfig.VolumeStreaming.Enabled)&&(0,a.jsx)(ba,{}),(0,a.jsx)(xa,{}),(0,a.jsx)(_c,{})]})}}var wc=n(61993)
class Tc extends l.dL{get current(){return this.props.state.behaviors.currentObject.value}componentDidMount(){this.subscribe(this.plugin.state.events.object.updated,({ref:e,state:t})=>{const n=this.current
n.ref===e&&n.state===t&&this.forceUpdate()}),this.subscribe(this.plugin.state.data.actions.events.added,()=>this.forceUpdate()),this.subscribe(this.plugin.state.data.actions.events.removed,()=>this.forceUpdate())}render(){const{state:e,nodeRef:t}=this.props,n=e.cells.get(t),r=e.actions.fromCell(n,this.plugin)
if(0===r.length)return null
const i=n.transform.transformer.definition,o=n.obj?n.obj.label:i.display&&i.display.name||i.name
return(0,a.jsxs)("div",{className:"msp-state-actions",children:[!this.props.hideHeader&&(0,a.jsxs)("div",{className:"msp-section-header",children:[(0,a.jsx)(Br.In,{svg:Br.Mm})," ",`Actions (${o})`]}),r.map((n,r)=>(0,a.jsx)(ga,{state:e,action:n,nodeRef:t,initiallyCollapsed:0===r?!this.props.alwaysExpandFirst&&this.props.initiallyCollapsed:this.props.initiallyCollapsed},`${n.id}`))]})}}var Ac=n(92426),Ic=n(70429),Pc=n(32896)
class Bc extends l.dL{render(){var e
return(0,a.jsxs)("div",{children:[(0,a.jsx)(Pr.X3,{icon:Br.e,title:"Plugin State"}),(0,a.jsx)("div",{style:{marginBottom:"10px"},children:(0,a.jsx)(Pr.Yj,{header:"Save Options",initiallyExpanded:!1,children:(0,a.jsx)(kc,{})})}),(0,a.jsx)(Dc,{}),(0,a.jsx)(Oc,{}),(0,a.jsx)(Pr.X3,{title:"Save as File",accent:"blue"}),(0,a.jsx)(Ec,{}),"none"!==(null===(e=this.plugin.spec.components)||void 0===e?void 0:e.remoteState)&&(0,a.jsx)(Fc,{})]})}}class Ec extends l.dL{constructor(){super(...arguments),this.downloadToFileJson=()=>{var e,t
null===(t=(e=this.props).onAction)||void 0===t||t.call(e),Ir.PluginCommands.State.Snapshots.DownloadToFile(this.plugin,{type:"json"})},this.downloadToFileZip=()=>{var e,t
null===(t=(e=this.props).onAction)||void 0===t||t.call(e),Ir.PluginCommands.State.Snapshots.DownloadToFile(this.plugin,{type:"zip"})},this.open=e=>{var t,n
e.target.files&&e.target.files[0]?(null===(n=(t=this.props).onAction)||void 0===n||n.call(t),Ir.PluginCommands.State.Snapshots.OpenFile(this.plugin,{file:e.target.files[0]})):this.plugin.log.error("No state file selected")}}render(){return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"msp-flex-row",children:[(0,a.jsx)(Pr.$n,{icon:Br.U3,onClick:this.downloadToFileJson,title:"Save the state description. Input data are loaded using the provided sources. Does not work if local files are used as input.",children:"State"}),(0,a.jsx)(Pr.$n,{icon:Br.U3,onClick:this.downloadToFileZip,title:"Save the state including the input data.",children:"Session"}),(0,a.jsxs)("div",{className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file",children:[(0,a.jsx)(Br.In,{svg:Br.sd,inline:!0})," Open ",(0,a.jsx)("input",{onChange:this.open,type:"file",multiple:!1,accept:".molx,.molj"})]})]}),(0,a.jsxs)("div",{className:"msp-help-text",style:{padding:"10px"},children:[(0,a.jsx)(Br.In,{svg:Br.Rf})," This is an experimental feature and stored states/sessions might not be openable in a future version."]})]})}}class kc extends l.dL{componentDidMount(){this.subscribe(this.plugin.state.snapshotParams,()=>this.forceUpdate())}render(){return(0,a.jsx)(Er.y1,{params:mc.p.SnapshotParams,values:this.plugin.state.snapshotParams.value,onChangeValues:this.plugin.state.setSnapshotParams})}}class Dc extends l.dL{constructor(){super(...arguments),this.state={params:Vr.t.getDefaultValues(Dc.Params)},this.add=()=>{Ir.PluginCommands.State.Snapshots.Add(this.plugin,{name:this.state.params.name,description:this.state.params.description})},this.updateParams=e=>this.setState({params:e}),this.clear=()=>{Ir.PluginCommands.State.Snapshots.Clear(this.plugin,{})}}shouldComponentUpdate(e,t){return!(0,s.f8)(this.props,e)||!(0,s.f8)(this.state,t)}render(){return(0,a.jsx)("div",{children:(0,a.jsx)(Rc,{parent:this})})}}function Mc(e,t,n){return!!t&&e.managers.snapshot.state.entries.some(e=>(!n||e.snapshot.id!==n)&&e.key===t)}function Rc({parent:e}){const[t,n]=o.useState({key:"",name:"",description:""}),r=()=>{Ir.PluginCommands.State.Snapshots.Add(e.plugin,{key:t.key,name:t.name,description:t.description}),n({key:"",name:"",description:""})},i=Mc(e.plugin,t.key)
return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Lc,{state:t,setState:n,apply:r}),(0,a.jsxs)("div",{className:"msp-flex-row",children:[(0,a.jsx)(Pr.K0,{onClick:e.clear,svg:Br.mf,title:"Remove All"}),(0,a.jsx)(Pr.$n,{onClick:r,icon:i?void 0:Br.CR,style:{textAlign:"right"},commit:i?"off":"on",disabled:i,children:i?"Key must be unique":"Add"})]})]})}Dc.Params={name:Vr.t.Text(),description:Vr.t.Text()}
class Oc extends l.dL{constructor(){super(...arguments),this.state={editingId:void 0},this.edit=e=>{const t=e.currentTarget.getAttribute("data-id")
if(!t)return
const n=this.state.editingId
this.setState({editingId:t===n?void 0:t})},this.doneEdit=()=>this.setState({editingId:void 0}),this.apply=e=>{const t=e.currentTarget.getAttribute("data-id")
t&&Ir.PluginCommands.State.Snapshots.Apply(this.plugin,{id:t})},this.remove=e=>{const t=e.currentTarget.getAttribute("data-id")
t&&Ir.PluginCommands.State.Snapshots.Remove(this.plugin,{id:t})},this.moveUp=e=>{const t=e.currentTarget.getAttribute("data-id")
t&&Ir.PluginCommands.State.Snapshots.Move(this.plugin,{id:t,dir:-1})},this.moveDown=e=>{const t=e.currentTarget.getAttribute("data-id")
t&&Ir.PluginCommands.State.Snapshots.Move(this.plugin,{id:t,dir:1})},this.replace=e=>{const t=e.currentTarget.getAttribute("data-id")
t&&Ir.PluginCommands.State.Snapshots.Replace(this.plugin,{id:t})}}componentDidMount(){this.subscribe(this.plugin.managers.snapshot.events.changed,()=>this.forceUpdate())}render(){const e=this.plugin.managers.snapshot.state.current,t=[]
return this.plugin.managers.snapshot.state.entries.forEach(n=>{var r
t.push((0,a.jsxs)("li",{className:"msp-flex-row",children:[(0,a.jsxs)(Pr.$n,{"data-id":n.snapshot.id,onClick:this.apply,className:"msp-no-overflow",children:[(0,a.jsxs)("span",{style:{fontWeight:n.snapshot.id===e?"bold":void 0},children:[!!n.key&&`[${n.key}] `,n.name||new Date(n.timestamp).toLocaleString()]})," ",(0,a.jsx)("small",{children:`${n.snapshot.durationInMs?(0,Ic.H)(n.snapshot.durationInMs,!1):""}`})]}),(0,a.jsx)(Pr.K0,{svg:Br.Hk,"data-id":n.snapshot.id,title:"Edit",onClick:this.edit,flex:"28px"}),(0,a.jsx)(Pr.K0,{svg:Br.p8,"data-id":n.snapshot.id,title:"Move Up",onClick:this.moveUp,flex:"20px"}),(0,a.jsx)(Pr.K0,{svg:Br.qp,"data-id":n.snapshot.id,title:"Move Down",onClick:this.moveDown,flex:"20px"}),(0,a.jsx)(Pr.K0,{svg:Br.sy,"data-id":n.snapshot.id,title:"Replace",onClick:this.replace,flex:"20px"}),(0,a.jsx)(Pr.K0,{svg:Br.mf,"data-id":n.snapshot.id,title:"Remove",onClick:this.remove,flex:"20px"})]},n.snapshot.id)),this.state.editingId===n.snapshot.id&&t.push((0,a.jsx)(Nc,{entry:n,plugin:this.plugin,done:this.doneEdit},`${n.snapshot.id}-edit`))
const i=n.image&&(null===(r=this.plugin.managers.asset.get(n.image))||void 0===r?void 0:r.file)
i&&t.push((0,a.jsx)("li",{className:"msp-state-image-row",children:(0,a.jsx)(Pr.$n,{"data-id":n.snapshot.id,onClick:this.apply,children:(0,a.jsx)("img",{draggable:!1,src:URL.createObjectURL(i)})})},`${n.snapshot.id}-image`))}),(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("ul",{style:{listStyle:"none",marginTop:"10px"},className:"msp-state-list",children:t})})}}function Lc({state:e,setState:t,apply:n}){const r=o.useRef(),i=o.useRef(),[s,l]=o.useState(!1)
return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Pr.eJ,{label:"Name",control:(0,a.jsx)("input",{type:"text",value:e.name,placeholder:"Name",onChange:n=>t({...e,name:n.target.value}),onKeyUp:e=>{var t
"Enter"===e.key&&(null===(t=r.current)||void 0===t||t.focus())}})}),(0,a.jsx)(Pr.eJ,{label:(0,a.jsxs)(a.Fragment,{children:["Key",(0,a.jsx)(Er.Z4,{show:s,toggle:()=>l(e=>!e)})]}),control:(0,a.jsx)("input",{type:"text",ref:r,value:e.key,placeholder:"Key (optional)",onChange:n=>t({...e,key:n.target.value}),onKeyUp:e=>{var t
"Enter"===e.key&&(null===(t=i.current)||void 0===t||t.focus())}})}),s&&(0,a.jsx)("div",{className:"msp-control-offset",children:(0,a.jsx)(Er.jH,{description:"Optional snapshot key used to activate snapshots from descriptions, labels, etc."})}),(0,a.jsx)("div",{className:"msp-flex-row msp-text-area-wrapper",style:{marginBottom:1},children:(0,a.jsx)("textarea",{ref:i,placeholder:"Markdown Description\n\n- Use [title](#key) to link to a snapshot",className:"msp-form-control",value:e.description,onChange:n=>t({...e,description:n.target.value}),onKeyUp:t=>{"Enter"===t.key&&t.ctrlKey&&n(e)}})})]})}function Nc({entry:e,plugin:t,done:n}){var r,i,s
const[l,c]=o.useState({key:null!==(r=e.key)&&void 0!==r?r:"",name:null!==(i=e.name)&&void 0!==i?i:"",description:null!==(s=e.description)&&void 0!==s?s:"",descriptionFormat:e.descriptionFormat}),u=()=>{t.managers.snapshot.update(e,l),n()},d=Mc(t,l.key,e.snapshot.id)
return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Lc,{state:l,setState:c,apply:u}),(0,a.jsx)("div",{className:"msp-flex-row",style:{marginBottom:1},children:(0,a.jsx)(Pr.$n,{onClick:u,icon:d?void 0:Br.Xq,style:{textAlign:"right"},commit:d?"off":"on",disabled:d,children:d?"Key must be unique":"Apply"})})]})}class Fc extends l.dL{constructor(){super(...arguments),this.Params={name:Vr.t.Text(),options:Vr.t.Group({description:Vr.t.Text(),playOnLoad:Vr.t.Boolean(!1),serverUrl:Vr.t.Text(this.plugin.config.get(go.PluginConfig.State.CurrentServer))})},this.state={params:Vr.t.getDefaultValues(this.Params),entries:(0,Ac.uY)(),isBusy:!1},this.ListOnlyParams={options:Vr.t.Group({serverUrl:Vr.t.Text(this.plugin.config.get(go.PluginConfig.State.CurrentServer))},{isFlat:!0})},this._mounted=!1,this.refresh=async()=>{try{this.setState({isBusy:!0}),this.plugin.config.set(go.PluginConfig.State.CurrentServer,this.state.params.options.serverUrl)
const e=await this.plugin.runTask(this.plugin.fetch({url:this.serverUrl("list"),type:"json"}))||[]
e.sort((e,t)=>e.isSticky===t.isSticky?e.timestamp-t.timestamp:e.isSticky?-1:1)
const t=(0,Ac.uY)().asMutable()
for(const n of e)t.set(n.id,{...n,url:this.serverUrl(`get/${n.id}`),removeUrl:this.serverUrl(`remove/${n.id}`)})
this._mounted&&this.setState({entries:t.asImmutable(),isBusy:!1})}catch(e){console.error(e),this.plugin.log.error("Error fetching remote snapshots"),this._mounted&&this.setState({entries:(0,Ac.uY)(),isBusy:!1})}},this.upload=async()=>{this.setState({isBusy:!0}),this.plugin.config.set(go.PluginConfig.State.CurrentServer,this.state.params.options.serverUrl),await Ir.PluginCommands.State.Snapshots.Upload(this.plugin,{name:this.state.params.name,description:this.state.params.options.description,playOnLoad:this.state.params.options.playOnLoad,serverUrl:this.state.params.options.serverUrl}),this.plugin.log.message("Snapshot uploaded."),this._mounted&&(this.setState({isBusy:!1}),this.refresh())},this.fetch=async e=>{const t=e.currentTarget.getAttribute("data-id")
if(!t)return
const n=this.state.entries.get(t)
if(n){this.setState({isBusy:!0})
try{await Ir.PluginCommands.State.Snapshots.Fetch(this.plugin,{url:n.url})}finally{this._mounted&&this.setState({isBusy:!1})}}},this.remove=async e=>{const t=e.currentTarget.getAttribute("data-id")
if(!t)return
const n=this.state.entries.get(t)
if(n){this.setState({entries:this.state.entries.remove(t)})
try{await fetch(n.removeUrl)}catch(e){console.error(e)}}}}componentDidMount(){this.refresh(),this._mounted=!0}componentWillUnmount(){super.componentWillUnmount(),this._mounted=!1}serverUrl(e){return e?(0,Pc.r)(this.state.params.options.serverUrl,e):this.state.params.options.serverUrl}render(){return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Pr.X3,{title:"Remote States",accent:"blue"}),!this.props.listOnly&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Er.y1,{params:this.Params,values:this.state.params,onEnter:this.upload,onChange:e=>{this.setState({params:{...this.state.params,[e.name]:e.value}})},isDisabled:this.state.isBusy}),(0,a.jsxs)("div",{className:"msp-flex-row",children:[(0,a.jsx)(Pr.K0,{onClick:this.refresh,disabled:this.state.isBusy,svg:Br.ij}),(0,a.jsx)(Pr.$n,{icon:Br.XI,onClick:this.upload,disabled:this.state.isBusy,commit:!0,children:"Upload"})]})]}),(0,a.jsx)(zc,{entries:this.state.entries,isBusy:this.state.isBusy,serverUrl:this.state.params.options.serverUrl,fetch:this.fetch,remove:this.props.listOnly?void 0:this.remove}),this.props.listOnly&&(0,a.jsxs)("div",{style:{marginTop:"10px"},children:[(0,a.jsx)(Er.y1,{params:this.ListOnlyParams,values:this.state.params,onEnter:this.upload,onChange:e=>{this.setState({params:{...this.state.params,[e.name]:e.value}})},isDisabled:this.state.isBusy}),(0,a.jsx)("div",{className:"msp-flex-row",children:(0,a.jsx)(Pr.$n,{onClick:this.refresh,disabled:this.state.isBusy,icon:Br.ij,children:"Refresh"})})]})]})}}class zc extends l.jB{constructor(){super(...arguments),this.open=async e=>{const t=e.currentTarget.getAttribute("data-id")
if(!t)return
const n=this.props.entries.get(t)
if(!n)return
e.preventDefault()
let r=`${window.location}`
const i=r.indexOf("?")
i>0&&(r=r.substr(0,i)),window.open(`${r}?snapshot-url=${encodeURIComponent(n.url)}`,"_blank")}}render(){return(0,a.jsx)("ul",{style:{listStyle:"none",marginTop:"10px"},className:"msp-state-list",children:this.props.entries.valueSeq().map(e=>(0,a.jsxs)("li",{className:"msp-flex-row",children:[(0,a.jsxs)(Pr.$n,{"data-id":e.id,onClick:this.props.fetch,disabled:this.props.isBusy,onContextMenu:this.open,title:"Click to download, right-click to open in a new tab.",children:[e.name||new Date(e.timestamp).toLocaleString()," ",(0,a.jsx)("small",{children:e.description})]}),!e.isSticky&&this.props.remove&&(0,a.jsx)(Pr.K0,{svg:Br.mf,"data-id":e.id,title:"Remove",onClick:this.props.remove,disabled:this.props.isBusy,small:!0})]},e.id))})}}var jc=n(90756),Vc=n(48604)
class Uc extends l.dL{constructor(){super(...arguments),this.state={showActions:!0}}componentDidMount(){this.subscribe(this.plugin.state.events.cell.created,e=>{e.cell.transform.parent===$r.Cn.RootRef&&this.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,e=>{e.parent===$r.Cn.RootRef&&this.forceUpdate()})}static getDerivedStateFromProps(e,t){const n=e.state.tree.root.ref,r=0===e.state.tree.children.get(n).size
return t.showActions===r?null:{showActions:r}}render(){const e=this.props.state.tree.root.ref
return this.state.showActions?(0,a.jsxs)("div",{style:{margin:"10px",cursor:"default"},children:[(0,a.jsx)("p",{children:"Nothing to see here yet."}),(0,a.jsxs)("p",{children:["Structures and Volumes can be loaded from the ",(0,a.jsx)(Br.In,{svg:Br.yf})," tab."]})]}):(0,a.jsx)(Gc,{cell:this.props.state.cells.get(e),depth:0})}}class Gc extends l.dL{constructor(){super(...arguments),this.state={isCollapsed:!!this.props.cell.state.isCollapsed,isNull:Gc.isNull(this.props.cell),showLabel:Gc.showLabel(this.props.cell)}}is(e){return e.ref===this.ref&&e.state===this.props.cell.parent}get ref(){return this.props.cell.transform.ref}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated,e=>{this.props.cell===e.cell&&this.is(e)&&e.state.cells.has(this.ref)&&(this.state.isCollapsed===!!e.cell.state.isCollapsed&&this.state.isNull===Gc.isNull(e.cell)&&this.state.showLabel===Gc.showLabel(e.cell)||this.forceUpdate())}),this.subscribe(this.plugin.state.events.cell.created,e=>{this.props.cell.parent===e.state&&this.ref===e.cell.transform.parent&&this.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,e=>{this.props.cell.parent===e.state&&this.ref===e.parent&&this.forceUpdate()})}static getDerivedStateFromProps(e,t){const n=Gc.isNull(e.cell),r=Gc.showLabel(e.cell)
return!!e.cell.state.isCollapsed===t.isCollapsed&&t.isNull===n&&t.showLabel===r?null:{isCollapsed:!!e.cell.state.isCollapsed,isNull:n,showLabel:r}}static hasDecorator(e){var t
const n=e.parent.tree.children.get(e.transform.ref)
if(1!==n.size)return!1
const r=n.first()
return!!r&&!!(null===(t=e.parent)||void 0===t?void 0:t.tree.transforms.get(r).transformer.definition.isDecorator)}static isNull(e){return!e||!e.parent||e.obj===$r.BM.Null||!e.parent.tree.transforms.has(e.transform.ref)}static showLabel(e){return e.transform.ref!==$r.Cn.RootRef&&("ok"!==e.status||!e.state.isGhost&&!Gc.hasDecorator(e))}render(){if(this.state.isNull)return null
const e=this.props.cell,t=e.parent.tree.children.get(this.ref)
if(!this.state.showLabel)return 0===t.size?null:(0,a.jsx)(a.Fragment,{children:t.map(t=>(0,a.jsx)(Gc,{cell:e.parent.cells.get(t),depth:this.props.depth},t))})
const n=this.props.depth+1
return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Hc,{cell:e,depth:this.props.depth}),0===t.size?void 0:(0,a.jsx)("div",{style:{display:this.state.isCollapsed?"none":"block"},children:t.map(t=>(0,a.jsx)(Gc,{cell:e.parent.cells.get(t),depth:n},t))})]})}}class Hc extends l.dL{constructor(){super(...arguments),this.state={isCurrent:this.props.cell.parent.current===this.ref,isCollapsed:!!this.props.cell.state.isCollapsed,action:void 0,currentAction:void 0},this.setCurrent=e=>{null==e||e.preventDefault(),null==e||e.currentTarget.blur(),Ir.PluginCommands.State.SetCurrentObject(this.plugin,{state:this.props.cell.parent,ref:this.ref})},this.setCurrentRoot=e=>{null==e||e.preventDefault(),null==e||e.currentTarget.blur(),this.props.cell.parent&&Ir.PluginCommands.State.SetCurrentObject(this.plugin,{state:this.props.cell.parent,ref:$r.Cn.RootRef})},this.remove=e=>{null==e||e.preventDefault(),Ir.PluginCommands.State.RemoveObject(this.plugin,{state:this.props.cell.parent,ref:this.ref,removeParentGhosts:!0})},this.toggleVisible=e=>{e.preventDefault(),Ir.PluginCommands.State.ToggleVisibility(this.plugin,{state:this.props.cell.parent,ref:this.ref}),e.currentTarget.blur()},this.toggleExpanded=e=>{e.preventDefault(),Ir.PluginCommands.State.ToggleExpanded(this.plugin,{state:this.props.cell.parent,ref:this.ref}),e.currentTarget.blur()},this.highlight=e=>{e.preventDefault(),Ir.PluginCommands.Interactivity.Object.Highlight(this.plugin,{state:this.props.cell.parent,ref:this.ref}),e.currentTarget.blur()},this.clearHighlight=e=>{e.preventDefault(),Ir.PluginCommands.Interactivity.ClearHighlights(this.plugin),e.currentTarget.blur()},this.hideApply=()=>{this.setCurrentRoot()},this.selectAction=e=>{e&&(null==e?void 0:e.value)()}}is(e){return e.ref===this.ref&&e.state===this.props.cell.parent}get ref(){return this.props.cell.transform.ref}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated.pipe((0,Qi.p)(e=>this.is(e)),(0,jc.B)(33)),e=>{this.forceUpdate()}),this.subscribe(this.props.cell.parent.behaviors.currentObject,e=>{this.is(e)?e.state.transforms.has(this.ref)&&this._setCurrent(this.props.cell.parent.current===this.ref,!!this.props.cell.state.isCollapsed):this.state.isCurrent&&e.state.transforms.has(this.ref)&&this._setCurrent(this.props.cell.parent.current===this.ref,this.state.isCollapsed)})}_setCurrent(e,t){e?this.setState({isCurrent:e,action:"options",currentAction:void 0,isCollapsed:t}):this.setState({isCurrent:e,action:void 0,currentAction:void 0,isCollapsed:t})}static getDerivedStateFromProps(e,t){const n=e.cell.parent.current===e.cell.transform.ref,r=!!e.cell.state.isCollapsed
return t.isCollapsed===r&&t.isCurrent===n?null:{isCurrent:n,isCollapsed:r,action:void 0,currentAction:void 0}}get actions(){const e=this.props.cell,t=[...e.parent.actions.fromCell(e,this.plugin)]
if(0!==t.length)return t.sort((e,t)=>e.definition.display.name<t.definition.display.name?-1:e.definition.display.name===t.definition.display.name?0:1),[Gi.W.Header("Apply Action"),...t.map(e=>Gi.W.Item(e.definition.display.name,()=>this.setState({action:"apply",currentAction:e})))]}updates(e){const t=this.props.cell,n=Vc.P.getDecoratorChain(t.parent,t.transform.ref),r=[]
for(let i=n.length-1;i>=0;i--){const o=n[i]
r.push((0,a.jsx)(Yi,{state:t.parent,transform:o.transform,noMargin:!0,wrapInExpander:!0,expanderHeaderLeftMargin:e},`${o.transform.transformer.id}-${i}`))}return(0,a.jsx)("div",{className:"msp-tree-updates-wrapper",children:r})}render(){const e=this.props.cell,t=e.transform
if(!e)return null
const n=this.is(e.parent.behaviors.currentObject.value),r="error"!==e.status&&"ok"!==e.status
let i
if("error"!==e.status&&e.obj){const t=e.obj,n=`${t.label} ${t.description?t.description:""}`
i=(0,a.jsxs)(Pr.$n,{className:`msp-btn-tree-label msp-type-class-${t.type.typeClass}`,noOverflow:!0,disabled:r,title:n,onClick:this.state.isCurrent?this.setCurrentRoot:this.setCurrent,children:[(0,a.jsx)("span",{children:t.label})," ",t.description?(0,a.jsx)("small",{children:t.description}):void 0]})}else{const n="error"===e.status?e.errorText:t.transformer.definition.display.name
i=(0,a.jsxs)(Pr.$n,{className:"msp-btn-tree-label msp-no-hover-outline",noOverflow:!0,title:n,onClick:this.state.isCurrent?this.setCurrentRoot:this.setCurrent,disabled:r,children:["error"===e.status&&(0,a.jsxs)("b",{children:["[",e.status,"]"]})," ",(0,a.jsx)("span",{children:n})]})}const o=e.parent.tree.children.get(this.ref),s=e.state,l=(0,a.jsx)(Pr.K0,{svg:s.isCollapsed?Br.Cp:Br.DM,flex:"20px",disabled:r,onClick:this.toggleExpanded,transparent:!0,className:"msp-no-hover-outline",style:{visibility:o.size>0?"visible":"hidden"}}),c=e.state.isLocked?void 0:(0,a.jsx)(Pr.K0,{svg:Br.mf,onClick:this.remove,disabled:r,small:!0,toggleState:!1}),u=(0,a.jsx)(Pr.K0,{svg:s.isHidden?Br.qF:Br.zs,toggleState:!1,disabled:r,small:!0,onClick:this.toggleVisible}),d={marginLeft:8*this.props.depth+"px"},p=(0,a.jsxs)("div",{className:"msp-flex-row msp-tree-row"+(n?" msp-tree-row-current":""),onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:d,children:[l,i,c,u]})
if(!n)return p
if("apply"===this.state.action&&this.state.currentAction)return(0,a.jsxs)("div",{style:{marginBottom:"1px"},children:[p,(0,a.jsx)(Pr.tW,{header:`Apply ${this.state.currentAction.definition.display.name}`,initialExpanded:!0,hideExpander:!0,hideOffset:!1,onHeaderClick:this.hideApply,topRightIcon:Br.X6,headerLeftMargin:8*this.props.depth+21+"px",children:(0,a.jsx)(ga,{onApply:this.hideApply,state:this.props.cell.parent,action:this.state.currentAction,nodeRef:this.props.cell.transform.ref,hideHeader:!0,noMargin:!0})})]})
if("options"===this.state.action){const e=this.actions,t=this.updates(8*this.props.depth+21+"px")
return(0,a.jsxs)("div",{style:{marginBottom:"1px"},children:[p,t,e&&(0,a.jsx)("div",{style:{marginLeft:8*this.props.depth+21+"px",marginTop:"-1px"},children:(0,a.jsx)(Gi.W,{items:e,onSelect:this.selectAction})})]})}return p}}class qc extends l.dL{componentDidMount(){this.subscribe(this.plugin.state.behaviors.events.changed,()=>this.forceUpdate())}render(){const e=[]
return this.plugin.customImportControls.forEach((t,n)=>{e.push((0,a.jsx)(t,{initiallyCollapsed:this.props.initiallyCollapsed},n))}),e.length>0?(0,a.jsx)(a.Fragment,{children:e}):null}}class Qc extends l.dL{constructor(){var e
super(...arguments),this.state={tab:this.plugin.behaviors.layout.leftPanelTabName.value},this.set=e=>{if(this.state.tab===e)return this.setState({tab:"none"},()=>this.plugin.behaviors.layout.leftPanelTabName.next("none")),void Ir.PluginCommands.Layout.Update(this.plugin,{state:{regionState:{...this.plugin.layout.state.regionState,left:"collapsed"}}})
this.setState({tab:e},()=>this.plugin.behaviors.layout.leftPanelTabName.next(e)),"full"!==this.plugin.layout.state.regionState.left&&Ir.PluginCommands.Layout.Update(this.plugin,{state:{regionState:{...this.plugin.layout.state.regionState,left:"full"}}})},this.tabs={none:(0,a.jsx)(a.Fragment,{}),root:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Pr.X3,{icon:Br.yf,title:"Home"}),(0,a.jsx)(Tc,{state:this.plugin.state.data,nodeRef:$r.Cn.RootRef,hideHeader:!0,initiallyCollapsed:!0,alwaysExpandFirst:!0}),(0,a.jsx)(qc,{}),"none"!==(null===(e=this.plugin.spec.components)||void 0===e?void 0:e.remoteState)&&(0,a.jsx)(Fc,{listOnly:!0})]}),data:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Pr.X3,{icon:Br.ID,title:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Wc,{})," State Tree"]})}),(0,a.jsx)(Uc,{state:this.plugin.state.data})]}),states:(0,a.jsx)(Bc,{}),settings:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Pr.X3,{icon:Br.Hk,title:"Plugin Settings"}),(0,a.jsx)(Xc,{})]}),help:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Pr.X3,{icon:Br.ml,title:"Help"}),(0,a.jsx)(Mo,{})]})}}componentDidMount(){this.subscribe(this.plugin.behaviors.layout.leftPanelTabName,e=>{this.state.tab!==e&&this.setState({tab:e}),"none"===e&&"collapsed"!==this.plugin.layout.state.regionState.left&&Ir.PluginCommands.Layout.Update(this.plugin,{state:{regionState:{...this.plugin.layout.state.regionState,left:"collapsed"}}})}),this.subscribe(this.plugin.state.data.events.changed,({state:e})=>{"data"===this.state.tab&&1===e.cells.size&&this.set("root")})}render(){const e=this.state.tab
return(0,a.jsxs)("div",{className:"msp-left-panel-controls",children:[(0,a.jsxs)("div",{className:"msp-left-panel-controls-buttons",children:[(0,a.jsx)(Pr.K0,{svg:Br.yf,toggleState:"root"===e,transparent:!0,onClick:()=>this.set("root"),title:"Home"}),(0,a.jsx)($c,{set:this.set}),(0,a.jsx)(Pr.K0,{svg:Br.e,toggleState:"states"===e,transparent:!0,onClick:()=>this.set("states"),title:"Plugin State"}),(0,a.jsx)(Pr.K0,{svg:Br.ml,toggleState:"help"===e,transparent:!0,onClick:()=>this.set("help"),title:"Help"}),(0,a.jsx)("div",{className:"msp-left-panel-controls-buttons-bottom",children:(0,a.jsx)(Pr.K0,{svg:Br.Hk,toggleState:"settings"===e,transparent:!0,onClick:()=>this.set("settings"),title:"Settings"})})]}),(0,a.jsx)("div",{className:"msp-scrollable-container",children:this.tabs[e]})]})}}class $c extends l.dL{constructor(){super(...arguments),this.state={changed:!1}}get tab(){return this.plugin.behaviors.layout.leftPanelTabName.value}componentDidMount(){this.subscribe(this.plugin.behaviors.layout.leftPanelTabName,e=>{"data"===this.tab?this.setState({changed:!1}):this.forceUpdate()}),this.subscribe(this.plugin.state.data.events.changed,e=>{"data"!==this.tab&&this.setState({changed:!0})})}render(){return(0,a.jsx)(Pr.K0,{svg:Br.ID,toggleState:"data"===this.tab,transparent:!0,onClick:()=>this.props.set("data"),title:"State Tree",style:{position:"relative"},extraContent:this.state.changed?(0,a.jsx)("div",{className:"msp-left-panel-controls-button-data-dirty"}):void 0})}}class Xc extends l.dL{constructor(){super(...arguments),this.setSettings=e=>{Ir.PluginCommands.Canvas3D.SetSettings(this.plugin,{settings:{[e.name]:e.value}})},this.setCanvas3DContextProps=e=>{var t
null===(t=this.plugin.canvas3dContext)||void 0===t||t.setProps({[e.name]:e.value}),this.plugin.events.canvas3d.settingsUpdated.next(void 0)}}componentDidMount(){this.subscribe(this.plugin.events.canvas3d.settingsUpdated,()=>this.forceUpdate()),this.subscribe(this.plugin.layout.events.updated,()=>this.forceUpdate()),this.plugin.canvas3d&&this.subscribe(this.plugin.canvas3d.camera.stateChanged.pipe((0,va.c)(500,void 0,{leading:!0,trailing:!0})),e=>{void 0===e.radiusMax&&void 0===e.radius||this.forceUpdate()})}render(){return(0,a.jsxs)(a.Fragment,{children:[this.plugin.canvas3d&&this.plugin.canvas3dContext&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Pr.X3,{title:"Viewport"}),(0,a.jsx)(Er.y1,{params:wc._i,values:this.plugin.canvas3d.props,onChange:this.setSettings}),(0,a.jsx)(Er.y1,{params:wc.H7.Params,values:this.plugin.canvas3dContext.props,onChange:this.setCanvas3DContextProps})]}),(0,a.jsx)(Pr.X3,{title:"Behavior"}),(0,a.jsx)(Uc,{state:this.plugin.state.behaviors})]})}}class Wc extends l.dL{constructor(){super(...arguments),this.remove=e=>{e.preventDefault(),Ir.PluginCommands.State.RemoveObject(this.plugin,{state:this.plugin.state.data,ref:$r.Cn.RootRef})}}componentDidMount(){this.subscribe(this.plugin.state.events.cell.created,e=>{e.cell.transform.parent===$r.Cn.RootRef&&this.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,e=>{e.parent===$r.Cn.RootRef&&this.forceUpdate()})}render(){return 0===this.plugin.state.data.tree.children.get($r.Cn.RootRef).size?null:(0,a.jsx)(Pr.K0,{svg:Br.mf,onClick:this.remove,title:"Remove All",style:{display:"inline-block"},small:!0,className:"msp-no-hover-outline",transparent:!0})}}var Yc=n(99321)
const Zc={selected:"rgb(51, 255, 25)",highlighted:"rgb(255, 102, 153)",focused:""}
class Kc extends l.dL{constructor(){super(...arguments),this.parentDiv=o.createRef(),this.lastMouseOverSeqIdx=-1,this.highlightQueue=new ya.B,this.markerColors={...Zc},this.customColorThemeWrapper=void 0,this.customColorFunction=void 0,this.lociHighlightProvider=(e,t)=>{this.props.sequenceWrapper.markResidue(e.loci,t)&&this.updateMarker()},this.lociSelectionProvider=(e,t)=>{this.props.sequenceWrapper.markResidue(e.loci,t)&&this.updateMarker()},this.contextMenu=e=>{e.preventDefault()},this.mouseDownLoci=void 0,this.mouseDown=e=>{e.stopPropagation()
const t=this.getSeqIdx(e),n=this.getLoci(t)
this.mouseDownLoci=n},this.mouseUp=e=>{if(e.stopPropagation(),void 0===this.mouseDownLoci)return
const t=this.getSeqIdx(e),n=this.getLoci(t)
if(n){const t=(0,Yc.Y7)(e.nativeEvent),r=(0,Yc.vq)(e.nativeEvent),i=(0,Yc.RN)(e.nativeEvent)
let o=n
if(!Or.StructureElement.Loci.areEqual(this.mouseDownLoci,n)){const e=this.mouseDownLoci.elements[0],t=n.elements[0],r=Math.min(Xo.CD.min(e.indices),Xo.CD.min(t.indices)),i=Math.max(Xo.CD.max(e.indices),Xo.CD.max(t.indices))
o=Or.StructureElement.Loci(n.structure,[{unit:e.unit,indices:Xo.CD.ofRange(r,i)}])}this.click(o,t,r,i)}this.mouseDownLoci=void 0},this.location=Or.StructureElement.Location.create(void 0),this.mouseMove=e=>{e.stopPropagation()
const t=(0,Yc.Y7)(e.nativeEvent),n=(0,Yc.vq)(e.nativeEvent),r=(0,Yc.RN)(e.nativeEvent),i=e.target
if(!i||!i.getAttribute){if(-1===this.lastMouseOverSeqIdx)return
return this.lastMouseOverSeqIdx=-1,void this.highlightQueue.next({seqIdx:-1,buttons:t,button:n,modifiers:r})}const o=i.hasAttribute("data-seqid")?+i.getAttribute("data-seqid"):-1
if(this.lastMouseOverSeqIdx!==o)if(this.lastMouseOverSeqIdx=o,void 0!==this.mouseDownLoci){const e=this.getLoci(o)
this.hover(e,Yc.qt.Flag.None,Yc.qt.Flag.None,r)}else this.highlightQueue.next({seqIdx:o,buttons:t,button:n,modifiers:r})},this.mouseLeave=e=>{if(e.stopPropagation(),this.mouseDownLoci=void 0,-1===this.lastMouseOverSeqIdx)return
this.lastMouseOverSeqIdx=-1
const t=(0,Yc.Y7)(e.nativeEvent),n=(0,Yc.vq)(e.nativeEvent),r=(0,Yc.RN)(e.nativeEvent)
this.highlightQueue.next({seqIdx:-1,buttons:t,button:n,modifiers:r})}}get sequenceNumberPeriod(){return void 0!==this.props.sequenceNumberPeriod?this.props.sequenceNumberPeriod:this.props.sequenceWrapper.length>10?10:this.getSequenceNumber(this.props.sequenceWrapper.length-1).length>1?5:1}componentDidMount(){this.plugin.managers.interactivity.lociHighlights.addProvider(this.lociHighlightProvider),this.plugin.managers.interactivity.lociSelects.addProvider(this.lociSelectionProvider),this.subscribe(this.highlightQueue.pipe((0,va.c)(3*16.666,void 0,{leading:!0,trailing:!0})),e=>{const t=this.getLoci(e.seqIdx<0?void 0:e.seqIdx)
this.hover(t,e.buttons,e.button,e.modifiers)}),this.subscribe(this.plugin.managers.structure.focus.behaviors.current,e=>{this.updateFocus(null==e?void 0:e.loci),this.updateMarker()}),this.updateColors(),Ir.PluginCommands.Canvas3D.SetSettings.subscribe(this.plugin,()=>{this.updateColors(),this.updateMarker()})
const e=this.plugin.customUIState.experimentalSequenceColorTheme
e&&this.subscribe(e,e=>{(e||this.customColorThemeWrapper)&&(this.customColorThemeWrapper=function(e,t,n){const r=Or.StructureElement.Location.create(),i=(0,Hi._)(i=>{var o,a,s
if(!t)return
const l=null===(o=i.getLoci(0))||void 0===o?void 0:o.structure
if(!l)return
let c
const u=null!==(s=null===(a=t.getProps)||void 0===a?void 0:a.call(t,{structure:l}))&&void 0!==s?s:t.provider.defaultValues
t.provider.ensureCustomProperties?e.runTask(Fr.Task.create("Attach custom properties for coloring theme",async r=>{var i
try{await(null===(i=t.provider.ensureCustomProperties)||void 0===i?void 0:i.attach({assetManager:e.managers.asset,runtime:r},{structure:l}))}catch(e){console.warn(`Failed to attach custom properties needed for coloring theme ${t.provider.name}:`,e)}finally{c=t.provider.factory({structure:l},u).color,n()}})):c=t.provider.factory({structure:l},u).color
const d={}
return e=>{var t
return c?null!==(t=d[e])&&void 0!==t?t:d[e]=function(e,t,n){const i=e.getLoci(t)
if(!i||Or.StructureElement.Loci.isEmpty(i))return""
Or.StructureElement.Loci.getFirstLocation(i,r)
const o=n(r,!1)
return o<0?"":lo.Color.toHexStyle(o)}(i,e,c):""}})
return{themeName:null==t?void 0:t.provider.name,getColorFunction:i}}(this.plugin,e,()=>this.forceUpdate()),this.forceUpdate())})}updateColors(){this.plugin.canvas3d?(this.markerColors.highlighted=lo.Color.toHexStyle(this.plugin.canvas3d.props.renderer.highlightColor),this.markerColors.selected=lo.Color.toHexStyle(this.plugin.canvas3d.props.renderer.selectColor)):(this.markerColors.highlighted=Zc.highlighted,this.markerColors.selected=Zc.selected)}updateFocus(e){this.props.sequenceWrapper.markResidue(Xr.EveryLoci,"unfocus"),e&&this.props.sequenceWrapper.markResidue(e,"focus")}componentWillUnmount(){super.componentWillUnmount(),this.plugin.managers.interactivity.lociHighlights.removeProvider(this.lociHighlightProvider),this.plugin.managers.interactivity.lociSelects.removeProvider(this.lociSelectionProvider)}getLoci(e){if(void 0!==e){const t=this.props.sequenceWrapper.getLoci(e)
if(!Or.StructureElement.Loci.isEmpty(t))return t}}getSeqIdx(e){let t
const n=e.target
return n&&n.getAttribute&&(t=n.hasAttribute("data-seqid")?+n.getAttribute("data-seqid"):void 0),t}hover(e,t,n,r){const i={current:vo.YL.Loci.Empty,buttons:t,button:n,modifiers:r}
if(void 0!==e&&!Or.StructureElement.Loci.isEmpty(e)&&(i.current={loci:e},this.mouseDownLoci)){const t=this.mouseDownLoci.elements[0],n=e.elements[0],r=Math.min(Xo.CD.min(t.indices),Xo.CD.min(n.indices)),o=Math.max(Xo.CD.max(t.indices),Xo.CD.max(n.indices)),a=Or.StructureElement.Loci(e.structure,[{unit:t.unit,indices:Xo.CD.ofRange(r,o)}])
i.current={loci:a}}this.plugin.behaviors.interaction.hover.next(i)}click(e,t,n,r){const i={current:vo.YL.Loci.Empty,buttons:t,button:n,modifiers:r}
void 0===e||Or.StructureElement.Loci.isEmpty(e)||(i.current={loci:e}),this.plugin.behaviors.interaction.click.next(i)}getBackgroundColor(e){const t=this.props.sequenceWrapper
return t.isHighlighted(e)&&this.markerColors.highlighted?this.markerColors.highlighted:t.isSelected(e)&&this.markerColors.selected?this.markerColors.selected:t.isFocused(e)&&this.markerColors.focused?this.markerColors.focused:this.customColorFunction?this.customColorFunction(e):""}getResidueClass(e,t){const n=this.props.sequenceWrapper,r=[n.residueClass(e)]
return t.length>1&&r.push(0===e?"msp-sequence-residue-long-begin":"msp-sequence-residue-long"),n.isHighlighted(e)&&r.push("msp-sequence-residue-highlighted"),n.isSelected(e)&&r.push("msp-sequence-residue-selected"),n.isFocused(e)&&r.push("msp-sequence-residue-focused"),r.join(" ")}residue(e,t){return(0,a.jsx)("span",{"data-seqid":e,style:{backgroundColor:this.getBackgroundColor(e)},className:this.getResidueClass(e,t),children:`${t}`},e)}getSequenceNumberClass(e,t,n){const r=["msp-sequence-number"]
return t.startsWith("-")?n.length>1&&e>0?r.push("msp-sequence-number-long-negative"):r.push("msp-sequence-number-negative"):n.length>1&&e>0&&r.push("msp-sequence-number-long"),r.join(" ")}getSequenceNumber(e){let t=""
const n=this.props.sequenceWrapper.getLoci(e),r=Or.StructureElement.Loci.getFirstLocation(n,this.location)
return r&&(Or.Unit.isAtomic(r.unit)?t=`${Or.StructureProperties.residue.auth_seq_id(r)}${Or.StructureProperties.residue.pdbx_PDB_ins_code(r)||""}`:Or.Unit.isCoarse(r.unit)&&(t=`${e+1}`)),t}padSeqNum(e){return e.length<5?e+new Array(5-e.length+1).join(""):e}getSequenceNumberSpan(e,t){const n=this.getSequenceNumber(e)
return(0,a.jsx)("span",{className:this.getSequenceNumberClass(e,n,t),children:this.padSeqNum(n)},`marker-${e}`)}updateMarker(){if(!this.parentDiv.current)return
const e=this.parentDiv.current.children,t=!this.props.hideSequenceNumbers,n=this.sequenceNumberPeriod,r=this.props.sequenceWrapper,i=r.length
let o=0
for(let a=0;a<i;a++){t&&a%n===0&&a<i&&o++
const s=e[o]
if(!s)return
o++
const l=this.getResidueClass(a,r.residueLabel(a))
s.className!==l&&(s.className=l)
const c=this.getBackgroundColor(a)
s.style.backgroundColor!==c&&(s.style.backgroundColor=c)}}render(){var e
const t=this.props.sequenceWrapper,n=[]
this.customColorThemeWrapper&&(this.customColorFunction=this.customColorThemeWrapper.getColorFunction(t))
const r=!this.props.hideSequenceNumbers,i=this.sequenceNumberPeriod
for(let o=0,a=t.length;o<a;++o){const e=t.residueLabel(o)
r&&o%i===0&&o<a&&(n[n.length]=this.getSequenceNumberSpan(o,e)),n[n.length]=this.residue(o,e)}return this.updateFocus(null===(e=this.plugin.managers.structure.focus.behaviors.current.value)||void 0===e?void 0:e.loci),this.updateMarker(),(0,a.jsx)("div",{className:"msp-sequence-wrapper",onContextMenu:this.contextMenu,onMouseDown:this.mouseDown,onMouseUp:this.mouseUp,onMouseMove:this.mouseMove,onMouseLeave:this.mouseLeave,ref:this.parentDiv,children:n})}}class Jc{mark(e,t){const n=this.getSeqIndices(e)
return 0!==Xo.CD.size(n)&&(0,bo.BH)(this.markerArray,n,t)}markResidue(e,t){return"focus"===t?this.markResidueFocus(e,!0):"unfocus"===t?this.markResidueFocus(e,!1):(0,Xr.isEveryLoci)(e)?(0,bo.BH)(this.markerArray,Xo.IX.ofLength(this.length),t):this.mark(e,t)}markResidueFocus(e,t){const n=t?1:0
if((0,Xr.isEveryLoci)(e))return this.focusMarkerArray.fill(n,0,this.length),!0
{const t=this.getSeqIndices(e)
return Xo.CD.forEach(t,e=>this.focusMarkerArray[e]=n),Xo.CD.size(t)>0}}isHighlighted(e){return!!(1&this.markerArray[e])}isSelected(e){return!!(2&this.markerArray[e])}isFocused(e){return!!this.focusMarkerArray[e]}constructor(e,t){this.data=e,this.length=t,this.markerArray=new Uint8Array(t),this.focusMarkerArray=new Uint8Array(t)}}class eu extends Jc{seqId(e){return this.sequence.seqId.value(e)}residueLabel(e){return this.sequence.label.value(e)||this.sequence.code.value(e)}residueColor(e){return this.missing.has(this.modelNum,this.asymId,this.seqId(e))?zr.ColorNames.grey:zr.ColorNames.black}residueClass(e){return this.missing.has(this.modelNum,this.asymId,this.seqId(e))?"msp-sequence-missing":"msp-sequence-present"}getSeqIndices(e){const{structure:t}=this.data,n=e=>this.sequence.index(e)
if(Or.StructureElement.Loci.is(e)){if(!Or.Structure.areRootsEquivalent(e.structure,t))return Xo.IX.Empty
e=Or.StructureElement.Loci.remap(e,t)
const r=[]
for(const t of e.elements)this.unitMap.has(t.unit.id)&&(Or.Unit.isAtomic(t.unit)?tu(r,t,n):nu(r,t,n))
return Xo.X9.deduplicate(Xo.X9.ofSortedArray(r))}return Or.Structure.isLoci(e)&&Or.Structure.areRootsEquivalent(e.structure,t)?this.observed:Xo.IX.Empty}getLoci(e){const t=(n=this.data.units[0].chainGroupId,r=this.data.units[0].conformation.operator.name,i=this.seqId(e),Or.Queries.generators.atoms({unitTest:e=>Or.StructureProperties.unit.chainGroupId(e.element)===n&&Or.StructureProperties.unit.operator_name(e.element)===r,residueTest:e=>e.element.unit.kind===Or.Unit.Kind.Atomic?Or.StructureProperties.residue.label_seq_id(e.element)===i:Or.StructureProperties.coarse.seq_id_begin(e.element)<=i&&Or.StructureProperties.coarse.seq_id_end(e.element)>=i}))
var n,r,i
return Or.StructureSelection.toLociWithSourceUnits(Or.StructureQuery.run(t,this.data.structure))}constructor(e){const t=Or.StructureElement.Location.create(e.structure,e.units[0],e.units[0].elements[0]),n=e.units[0].model.sequence.byEntityKey[Or.StructureProperties.entity.key(t)],r=n.sequence.length
super(e,r),this.unitMap=new Map
for(const o of e.units)this.unitMap.set(o.id,o)
this.sequence=n.sequence,this.missing=e.units[0].model.properties.missingResidues,this.modelNum=e.units[0].model.modelNum,this.asymId=Or.Unit.isAtomic(e.units[0])?Or.StructureProperties.chain.label_asym_id(t):Or.StructureProperties.coarse.asym_id(t)
const i=[]
for(let o=0;o<r;++o)this.missing.has(this.modelNum,this.asymId,this.seqId(o))&&i.push(o)
this.observed=Xo.CD.subtract(Xo.IX.ofBounds(0,r),Xo.X9.ofSortedArray(i))}}function tu(e,t,n){const{model:r,elements:i}=t.unit,{index:o}=r.atomicHierarchy.residueAtomSegments,{label_seq_id:a}=r.atomicHierarchy.residues
return Xo.CD.forEachSegment(t.indices,e=>o[i[e]],t=>{const r=a.value(t),i=n(r)
e.push(i)}),!0}function nu(e,t,n){const{model:r,elements:i}=t.unit,o=Or.Unit.isSpheres(t.unit)?r.coarseHierarchy.spheres.seq_id_begin:r.coarseHierarchy.gaussians.seq_id_begin,a=Or.Unit.isSpheres(t.unit)?r.coarseHierarchy.spheres.seq_id_end:r.coarseHierarchy.gaussians.seq_id_end
return Xo.CD.forEach(t.indices,t=>{const r=i[t]
for(let i=n(o.value(r)),s=n(a.value(r));i<=s;i++)e.push(i)}),!0}class ru extends Jc{residueLabel(e){return this.sequence[e]}residueColor(e){return zr.ColorNames.black}residueClass(e){return"msp-sequence-present"}getSeqIndices(e){const{structure:t}=this.data
if(Or.StructureElement.Loci.is(e)){if(!Or.Structure.areRootsEquivalent(e.structure,t))return Xo.IX.Empty
e=Or.StructureElement.Loci.remap(e,t)
const n=[]
for(const t of e.elements){const e=this.unitMap.get(t.unit.id)
if(e){const{index:r}=t.unit.model.atomicHierarchy.residueAtomSegments
Xo.CD.forEach(t.indices,t=>{const i=this.sequenceIndices.get(r[e.elements[t]])
void 0!==i&&n.push(i)})}}return Xo.X9.deduplicate(Xo.X9.ofSortedArray(n))}return Or.Structure.isLoci(e)&&Or.Structure.areRootsEquivalent(e.structure,t)?Xo.IX.ofBounds(0,this.length):Xo.IX.Empty}getLoci(e){const t=[],n=this.residueIndices.get(e)
if(void 0!==n){const r=this.seqToUnit.get(e),{offsets:i}=r.model.atomicHierarchy.residueAtomSegments,o=Xo.X9.findPredecessorIndex(r.elements,i[n]),a=Xo.X9.findPredecessorIndex(r.elements,i[n+1])
t.push({unit:r,indices:Xo.IX.ofBounds(o,a)})}return Or.StructureElement.Loci(this.data.structure,t)}constructor(e){const t=[],n=new Map,r=new Map,i=new Map
for(let o=0,a=e.units.length;o<a;++o){const a=e.units[o],{residueAtomSegments:s,atoms:l}=a.model.atomicHierarchy,c=Xo.hT.transientSegments(s,a.elements)
for(;c.hasNext;){const{index:e}=c.move()
n.set(e,t.length),r.set(t.length,e),i.set(t.length,a),t.push(l.label_comp_id.value(s.offsets[e]))}}super(e,t.length),this.unitMap=new Map
for(const o of e.units)this.unitMap.set(o.id,o)
this.sequence=t,this.sequenceIndices=n,this.residueIndices=r,this.seqToUnit=i}}class iu extends Jc{residueLabel(e){return this.label}residueColor(e){return zr.ColorNames.black}residueClass(e){return"msp-sequence-present"}getSeqIndices(e){const{structure:t}=this.data
if(Or.StructureElement.Loci.is(e)){if(!Or.Structure.areRootsEquivalent(e.structure,t))return Xo.IX.Empty
e=Or.StructureElement.Loci.remap(e,t)
for(const t of e.elements){const e=this.unitIndices.get(t.unit.id)
if(e&&Xo.CD.isSubset(e,t.indices))return Xo.IX.ofSingleton(0)}}else if(Or.Structure.isLoci(e))return Or.Structure.areRootsEquivalent(e.structure,t)?Xo.IX.ofSingleton(0):Xo.IX.Empty
return Xo.IX.Empty}getLoci(e){return this.loci}constructor(e){let t=0,n=0
const r=[],i=Or.StructureElement.Location.create(e.structure),o=new Map,a=[]
for(let s=0,l=e.units.length;s<l;++s){const r=e.units[s]
Or.StructureElement.Location.set(i,e.structure,r,r.elements[0])
const l=r.model.sequence.byEntityKey[Or.StructureProperties.entity.key(i)]
l&&(t+=l.sequence.length),n+=r.elements.length
const c=Xo.IX.ofBounds(0,r.elements.length)
o.set(r.id,c),a.push({unit:r,indices:c})}t>0&&r.push(`${t} residues`),r.push(`${n} elements`),super(e,1),this.label=`Whole Chain (${r.join(", ")})`,this.unitIndices=o,this.loci=Or.StructureElement.Loci(this.data.structure,a)}}class ou extends Jc{residueLabel(e){return"X"}residueColor(e){return zr.ColorNames.black}residueClass(e){return"msp-sequence-present"}getSeqIndices(e){const{structure:t,units:n}=this.data
if(Or.StructureElement.Loci.is(e)){if(!Or.Structure.areRootsEquivalent(e.structure,t))return Xo.IX.Empty
e=Or.StructureElement.Loci.remap(e,t)
for(const t of e.elements){const e=this.unitIndices.get(t.unit.id)
if(e&&Xo.CD.isSubset(e,t.indices))return t.indices}}else if(Or.Structure.isLoci(e)){if(!Or.Structure.areRootsEquivalent(e.structure,t))return Xo.IX.Empty
for(let e=0,t=n.length;e<t;++e)return this.unitIndices.get(n[e].id)}return Xo.IX.Empty}getLoci(e){const{units:t}=this.data,n=[]
let r=0
for(let i=0,o=t.length;i<o;++i){const o=t[i]
if(e<r+o.elements.length){n.push({unit:o,indices:Xo.IX.ofSingleton(e-r)})
break}r+=o.elements.length}return Or.StructureElement.Loci(this.data.structure,n)}constructor(e){let t=0
const n=new Map,r=[]
for(let i=0,o=e.units.length;i<o;++i){const o=e.units[i]
t+=o.elements.length
const a=Xo.IX.ofBounds(0,o.elements.length)
n.set(o.id,a),r.push({unit:o,indices:a})}super(e,t),this.unitIndices=n}}const au=5e3,su=1e3
function lu(e){const t=Or.StructureProperties.unit.pdbx_struct_oper_list_ids(e),n=Or.StructureProperties.unit.struct_ncs_oper_id(e),r=Or.StructureProperties.unit.hkl(e),i=Or.StructureProperties.unit.spgrOp(e)
return`${t.sort().join(",")}|${n}|${r}|${i}`}function cu(e){const[t,n]=e.split("|")
return[parseInt(t),n]}function uu(e,t){const{structure:n,modelEntityId:r,chainGroupId:i,operatorKey:o}=e,a=Or.StructureElement.Location.create(n),[s,l]=cu(r),c=[]
for(const u of n.units)Or.StructureElement.Location.set(a,n,u,u.elements[0]),n.getModelIndex(u.model)===s&&Or.StructureProperties.entity.id(a)===l&&u.chainGroupId===i&&lu(a)===o&&c.push(u)
if(c.length>0){const e={structure:n,units:c},r=c[0]
let i
if(r.polymerElements.length){const t=Or.StructureElement.Location.create(n,r,r.elements[0]),o=r.model.sequence.byEntityKey[Or.StructureProperties.entity.key(t)]
if(o&&o.sequence.length<=au)i=new eu(e)
else{const t=c.reduce((e,t)=>e+t.polymerElements.length,0)
i=Or.Unit.isAtomic(r)||t>au?new iu(e):new ou(e)}}else if(Or.Unit.isAtomic(r)){const t=c.reduce((e,t)=>e+t.residueCount,0)
i=t>au?new iu(e):new ru(e)}else console.warn("should not happen, expecting coarse units to be polymeric"),i=new iu(e)
return i.markResidue(t.getLoci(n),bo.xi.Select),i}return"No sequence available"}function du(e,t=!1){const n=[],r=Or.StructureElement.Location.create(e),i=new Set
for(const o of e.units){Or.StructureElement.Location.set(r,e,o,o.elements[0])
const a=Or.StructureProperties.entity.id(r),s=e.getModelIndex(o.model),l=`${s}|${a}`
if(i.has(l))continue
if(t&&"polymer"!==Or.StructureProperties.entity.type(r))continue
let c=Or.StructureProperties.entity.pdbx_description(r).join(", ")
e.models.length&&(e.representativeModel?c+=` (Model ${e.models[s].modelNum})`:c.startsWith("Polymer ")&&(c+=` (${e.models[s].entry})`))
const u=`${a}: ${c}`
if(n.push([l,u]),i.add(l),n.length>su)return[["","Too many entities"]]}return 0===n.length&&n.push(["","No entities"]),n}function pu(e,t){const n=[],r=Or.StructureElement.Location.create(e),i=new Set,[o,a]=cu(t)
for(const s of e.units){if(Or.StructureElement.Location.set(r,e,s,s.elements[0]),e.getModelIndex(s.model)!==o)continue
if(Or.StructureProperties.entity.id(r)!==a)continue
const t=s.chainGroupId
if(i.has(t))continue
const l=(0,yo.BB)(r,{granularity:"chain",hidePrefix:!0,htmlStyling:!1})
if(n.push([t,l]),i.add(t),n.length>su)return[[-1,"Too many chains"]]}return 0===n.length&&n.push([-1,"No chains"]),n}function hu(e,t,n){const r=[],i=Or.StructureElement.Location.create(e),o=new Set,[a,s]=cu(t)
for(const l of e.units){if(Or.StructureElement.Location.set(i,e,l,l.elements[0]),e.getModelIndex(l.model)!==a)continue
if(Or.StructureProperties.entity.id(i)!==s)continue
if(l.chainGroupId!==n)continue
const t=lu(i)
if(o.has(t))continue
const c=l.conformation.operator.name
if(r.push([t,c]),o.add(t),r.length>su)return[["","Too many operators"]]}return 0===r.length&&r.push(["","No operators"]),r}function fu(e){var t
const n=[],r=[],i=e.select($r.QX.Generators.rootsOfType(gi.O.Molecule.Structure))
for(const o of i)(null===(t=o.obj)||void 0===t?void 0:t.data)&&(r.push(o.obj.data),n.push([o.transform.ref,o.obj.data.label]))
return 0===n.length&&n.push(["","No structure"]),{options:n,all:r}}const mu=Vr.t.Select("single",[["single","Chain"],["polymers","Polymers"],["all","Everything"]])
class gu extends l.dL{constructor(){super(...arguments),this.state={structureOptions:{options:[],all:[]},structure:Or.Structure.Empty,structureRef:"",modelEntityId:"",chainGroupId:-1,operatorKey:"",mode:"single",sequenceViewModeParam:mu},this.setParamProps=e=>{const t={...this.state}
switch(e.name){case"mode":if(t.mode=e.value,this.state.mode===t.mode)return
if("all"===t.mode||"polymers"===t.mode)break
case"structure":"structure"===e.name&&(t.structureRef=e.value),t.structure=this.getStructure(t.structureRef),t.modelEntityId=du(t.structure)[0][0],t.chainGroupId=pu(t.structure,t.modelEntityId)[0][0],t.operatorKey=hu(t.structure,t.modelEntityId,t.chainGroupId)[0][0]
break
case"entity":t.modelEntityId=e.value,t.chainGroupId=pu(t.structure,t.modelEntityId)[0][0],t.operatorKey=hu(t.structure,t.modelEntityId,t.chainGroupId)[0][0]
break
case"chain":t.chainGroupId=e.value,t.operatorKey=hu(t.structure,t.modelEntityId,t.chainGroupId)[0][0]
break
case"operator":t.operatorKey=e.value}this.setState(t)}}componentDidMount(){var e,t
this.plugin.state.data.select($r.QX.Generators.rootsOfType(gi.O.Molecule.Structure)).length>0&&this.setState(this.getInitialState()),this.subscribe(this.plugin.state.events.object.updated,({ref:e,obj:t})=>{e===this.state.structureRef&&t&&t.type===gi.O.Molecule.Structure.type&&t.data!==this.state.structure&&this.sync()}),this.subscribe(this.plugin.state.events.object.created,({obj:e})=>{e&&e.type===gi.O.Molecule.Structure.type&&this.sync()}),this.subscribe(this.plugin.state.events.object.removed,({obj:e})=>{e&&e.type===gi.O.Molecule.Structure.type&&this.sync()})
const n=null===(t=null===(e=this.plugin.spec.components)||void 0===e?void 0:e.sequenceViewer)||void 0===t?void 0:t.modeOptions
if(n){const e=new Set(n),t={...mu,options:mu.options.filter(([t])=>e.has(t))}
this.setState({sequenceViewModeParam:t})}}sync(){const e=fu(this.plugin.state.data);(0,ao.af)(e.all,this.state.structureOptions.all)||this.setState(this.getInitialState())}getStructure(e){const t=this.plugin.state.data.select(e)[0]
return e&&t&&t.obj?t.obj.data:Or.Structure.Empty}getSequenceWrapper(e){return{wrapper:uu(this.state,this.plugin.managers.structure.selection),label:`${Vr.t.optionLabel(e.chain,this.state.chainGroupId)} | ${Vr.t.optionLabel(e.entity,this.state.modelEntityId)}`}}getSequenceWrappers(e){if("single"===this.state.mode)return[this.getSequenceWrapper(e)]
const t=this.getStructure(this.state.structureRef),n=[]
for(const[r,i]of du(t,"polymers"===this.state.mode))for(const[e,o]of pu(t,r))for(const[a]of hu(t,r,e))if(n.push({wrapper:uu({structure:t,modelEntityId:r,chainGroupId:e,operatorKey:a},this.plugin.managers.structure.selection),label:`${o} | ${i}`}),n.length>30)return[]
return n}getInitialState(){var e,t,n,r
const i=fu(this.plugin.state.data),o=i.options[0][0],a=this.getStructure(o)
let s=du(a)[0][0],l=pu(a,s)[0][0],c=hu(a,s,l)[0][0]
this.state.structure&&this.state.structure===a&&(s=this.state.modelEntityId,l=this.state.chainGroupId,c=this.state.operatorKey)
const u=null===(t=null===(e=this.plugin.spec.components)||void 0===e?void 0:e.sequenceViewer)||void 0===t?void 0:t.defaultMode
return{structureOptions:i,structure:a,structureRef:o,modelEntityId:s,chainGroupId:l,operatorKey:c,mode:null!==(r=null!==(n=this.props.defaultMode)&&void 0!==n?n:u)&&void 0!==r?r:"single",sequenceViewModeParam:this.state.sequenceViewModeParam}}get params(){const{structureOptions:e,structure:t,modelEntityId:n,chainGroupId:r}=this.state,i=du(t),o=pu(t,n),a=hu(t,n,r)
return{structure:Vr.t.Select(e.options[0][0],e.options,{shortLabel:!0}),entity:Vr.t.Select(i[0][0],i,{shortLabel:!0}),chain:Vr.t.Select(o[0][0],o,{shortLabel:!0,twoColumns:!0,label:"Chain"}),operator:Vr.t.Select(a[0][0],a,{shortLabel:!0,twoColumns:!0}),mode:this.state.sequenceViewModeParam}}get values(){return{structure:this.state.structureRef,entity:this.state.modelEntityId,chain:this.state.chainGroupId,operator:this.state.operatorKey,mode:this.state.mode}}render(){if(this.getStructure(this.state.structureRef)===Or.Structure.Empty)return(0,a.jsx)("div",{className:"msp-sequence",children:(0,a.jsxs)("div",{className:"msp-sequence-select",children:[(0,a.jsx)(Br.In,{svg:Br.ml,style:{cursor:"help",position:"absolute",right:0,top:0},title:"Shows a sequence of one or more chains. Use the controls to alter selection."}),(0,a.jsx)("span",{children:"Sequence"}),(0,a.jsx)("span",{style:{fontWeight:"normal"},children:"No structure available"})]})})
const e=this.params,t=this.values,n=this.getSequenceWrappers(e)
return(0,a.jsxs)("div",{className:"msp-sequence",children:[(0,a.jsxs)("div",{className:"msp-sequence-select",children:[(0,a.jsx)(Br.In,{svg:Br.ml,style:{cursor:"help",position:"absolute",right:0,top:0},title:"This shows a single sequence. Use the controls to show a different sequence. \nUse Ctrl or Cmd key to add a sequence range to focus; use Shift key to extend last focused/selected range."}),(0,a.jsx)("span",{children:"Sequence of"}),(0,a.jsx)(Er.UT,{title:`[Structure] ${Vr.t.optionLabel(e.structure,t.structure)}`,param:e.structure,name:"structure",value:t.structure,onChange:this.setParamProps}),(0,a.jsx)(Er.UT,{title:"[Mode]",param:this.state.sequenceViewModeParam,name:"mode",value:t.mode,onChange:this.setParamProps}),"single"===t.mode&&(0,a.jsx)(Er.UT,{title:`[Entity] ${Vr.t.optionLabel(e.entity,t.entity)}`,param:e.entity,name:"entity",value:t.entity,onChange:this.setParamProps}),"single"===t.mode&&(0,a.jsx)(Er.UT,{title:`[Chain] ${Vr.t.optionLabel(e.chain,t.chain)}`,param:e.chain,name:"chain",value:t.chain,onChange:this.setParamProps}),e.operator.options.length>1&&(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(Er.UT,{title:`[Instance] ${Vr.t.optionLabel(e.operator,t.operator)}`,param:e.operator,name:"operator",value:t.operator,onChange:this.setParamProps})})]}),(0,a.jsx)(yu,{children:n.map((e,n)=>{const r="string"==typeof e.wrapper?(0,a.jsx)("div",{className:"msp-sequence-wrapper",children:e.wrapper},n):(0,a.jsx)(Kc,{sequenceWrapper:e.wrapper},n)
return"single"===t.mode?r:(0,a.jsxs)(o.Fragment,{children:[(0,a.jsx)("div",{className:"msp-sequence-chain-label",children:e.label}),r]},n)})})]})}}function yu({children:e}){return(0,a.jsx)("div",{className:"msp-sequence-wrapper-non-empty",children:e})}function vu(){const e=(0,o.useContext)(l.aU),[t,n]=(0,o.useState)((0,Ac.uY)())
return(0,o.useEffect)(()=>{const t=e.events.task.progress.subscribe(t=>{var r
const i=!!(null===(r=e.spec.components)||void 0===r?void 0:r.hideTaskOverlay)
"background"!==t.level||!i&&t.useOverlay||n(e=>e.set(t.id,t))}),r=e.events.task.finished.subscribe(({id:e})=>{n(t=>t.delete(e))})
return()=>{t.unsubscribe(),r.unsubscribe()}},[e]),(0,a.jsxs)("div",{className:"msp-background-tasks",children:[t.valueSeq().map(e=>(0,a.jsx)(xu,{event:e},e.id)),(0,a.jsx)(bu,{})]})}function bu(){var e
const t=oc(null===(e=(0,o.useContext)(l.aU).canvas3d)||void 0===e?void 0:e.commitQueueSize)
return t?(0,a.jsx)("div",{className:"msp-task-state",children:(0,a.jsx)("div",{children:(0,a.jsxs)("div",{children:["Commiting renderables... ",t," remaining"]})})}):null}class xu extends l.dL{constructor(){super(...arguments),this.abort=()=>{this.plugin.managers.task.requestAbort(this.props.event.progress.root.progress.taskId,"User Request")}}render(){const e=this.props.event.progress.root,t=Su(this.props.event.progress.root)-1,n=e.progress.isIndeterminate?void 0:(0,a.jsxs)(a.Fragment,{children:["[",e.progress.current,"/",e.progress.max,"]"]}),r=t>0?(0,a.jsxs)(a.Fragment,{children:["[",t," subtask(s)]"]}):void 0
return(0,a.jsx)("div",{className:"msp-task-state",children:(0,a.jsxs)("div",{children:[e.progress.canAbort&&(0,a.jsx)(Pr.K0,{svg:Br.VH,onClick:this.abort,title:"Abort"}),(0,a.jsxs)("div",{children:[e.progress.message," ",n," ",r]})]})})}}function Su(e){if(0===e.children.length)return 1
let t=0
for(const n of e.children)t+=Su(n)
return t}function _u(){const e=(0,o.useContext)(l.aU),[t,n]=(0,o.useState)((0,Ac.uY)())
return(0,o.useEffect)(()=>{const t=e.events.task.progress.subscribe(e=>{e.useOverlay&&n(t=>t.set(e.id,e))}),r=e.events.task.finished.subscribe(({id:e})=>{n(t=>t.delete(e))})
return()=>{t.unsubscribe(),r.unsubscribe()}},[e]),0===t.size?null:(0,a.jsx)("div",{className:"msp-overlay-tasks",children:t.valueSeq().map(e=>(0,a.jsx)(xu,{event:e},e.id))})}class Cu extends l.dL{constructor(){super(...arguments),this.hide=()=>{(this.props.entry.hide||function(){}).call(null)}}render(){const e=this.props.entry,t="string"==typeof e.message?(0,a.jsx)("div",{dangerouslySetInnerHTML:{__html:e.message}}):(0,a.jsx)("div",{children:(0,a.jsx)(e.message,{})})
return(0,a.jsxs)("div",{className:"msp-toast-entry",children:[(0,a.jsx)("div",{className:"msp-toast-title",onClick:()=>this.hide(),children:e.title}),(0,a.jsx)("div",{className:"msp-toast-message",children:t}),(0,a.jsx)("div",{className:"msp-toast-clear"}),(0,a.jsx)("div",{className:"msp-toast-hide",children:(0,a.jsx)(Pr.K0,{svg:Br.VH,onClick:this.hide,title:"Hide",className:"msp-no-hover-outline"})})]})}}class wu extends l.dL{componentDidMount(){this.subscribe(this.plugin.managers.toast.events.changed,()=>this.forceUpdate())}render(){const e=this.plugin.managers.toast.state
if(!e.entries.count())return null
const t=[]
return e.entries.forEach((e,n)=>t.push(e)),t.sort(function(e,t){return e.serialNumber-t.serialNumber}),(0,a.jsx)("div",{className:"msp-toast-container",children:t.map(e=>(0,a.jsx)(Cu,{entry:e},e.serialNumber))})}}class Tu extends l.dL{constructor(){super(...arguments),this.container=o.createRef(),this.mounted=!1,this.state={noWebGl:!1,showLogo:!0},this.handleLogo=()=>{var e
this.setState({showLogo:!(null===(e=this.plugin.canvas3d)||void 0===e?void 0:e.reprCount.value)})}}async applyMount(){try{const e=await this.plugin.mountAsync(this.container.current,{checkeredCanvasBackground:!0})
if(!this.mounted)return
e||this.setState({noWebGl:!0}),this.handleLogo(),this.subscribe(this.plugin.canvas3d.reprCount,this.handleLogo)}catch(e){console.error(e),this.setState({noWebGl:!0})}}componentDidMount(){this.mounted=!0,this.container.current?this.applyMount():this.setState({noWebGl:!0})}componentWillUnmount(){this.mounted=!1,super.componentWillUnmount(),this.plugin.unmount()}renderMissing(){if(this.props.noWebGl){const e=this.props.noWebGl
return(0,a.jsx)(e,{})}return(0,a.jsx)("div",{className:"msp-no-webgl",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{children:(0,a.jsx)("b",{children:"WebGL does not seem to be available."})}),(0,a.jsx)("p",{children:"This can be caused by an outdated browser, graphics card driver issue, or bad weather. Sometimes, just restarting the browser helps. Also, make sure hardware acceleration is enabled in your browser."}),(0,a.jsxs)("p",{children:["For a list of supported browsers, refer to ",(0,a.jsx)("a",{href:"http://caniuse.com/#feat=webgl",target:"_blank",children:"http://caniuse.com/#feat=webgl"}),"."]})]})})}render(){if(this.state.noWebGl)return this.renderMissing()
const e=this.props.logo
return(0,a.jsx)("div",{className:this.props.parentClassName||"msp-viewport",style:this.props.parentStyle,ref:this.container,children:this.state.showLogo&&e&&(0,a.jsx)(e,{})})}}const Au=o.memo(e=>{const{plugin:t,cropFrameColor:n}=e,r=t.helpers.viewportScreenshot,[i,s]=(0,o.useState)(null),l=(0,o.useRef)(null),c=(0,o.useRef)(e)
return(0,o.useEffect)(()=>{c.current=e},Object.values(e)),(0,o.useEffect)(()=>{i!==l.current&&s(l.current)}),(0,o.useEffect)(()=>{var e
let n=!1
const i=[]
function o(e,t){e&&i.push(e.subscribe(t))}function a(){const e=c.current
!e.suspend&&l.current&&Iu(t,r,l.current,e.customBackground,e.borderColor,e.borderWidth),l.current||(n=!0)}const s=setInterval(()=>{n&&(n=!1,a())},125)
let u
o(t.events.canvas3d.settingsUpdated,()=>n=!0),o(null===(e=t.canvas3d)||void 0===e?void 0:e.didDraw,()=>n=!0),o(t.state.data.behaviors.isUpdating,e=>{e||(n=!0)}),o(null==r?void 0:r.behaviors.values,()=>n=!0),o(null==r?void 0:r.behaviors.cropParams,()=>n=!0),"undefined"!=typeof ResizeObserver&&(u=new ResizeObserver(()=>n=!0))
const d=l.current
return null==u||u.observe(d),a(),()=>{clearInterval(s),i.forEach(e=>e.unsubscribe()),null==u||u.unobserve(d)}},[r]),(0,o.useLayoutEffect)(()=>{l.current&&Iu(t,r,l.current,e.customBackground,e.borderColor,e.borderWidth)},[...Object.values(e)]),(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{style:{position:"relative",width:"100%",height:"100%"},children:[(0,a.jsx)("canvas",{ref:l,onContextMenu:e=>{e.preventDefault(),e.stopPropagation()},style:{display:"block",width:"100%",height:"100%"}}),(0,a.jsx)(Pu,{plugin:t,canvas:i,color:n})]})})},(e,t)=>(0,jr.bN)(e,t))
async function Iu(e,t,n,r,i,o){const a=Fr.Task.create("Render Screenshot",async e=>{if(!t)return
const a=await t.getPreview(e)
if(!a)return
const s=n.getContext("2d")
if(!s)return
const{canvas:l,width:c,height:u}=a,d=n.clientWidth,p=n.clientHeight
n.width=d,n.height=p,s.clearRect(0,0,d,p)
const h=Eu(c,u,d,p)
if(r)s.fillStyle=r,s.fillRect(h.x,h.y,h.width,h.height)
else if(t.values.transparent){const e=13
for(let t=0;t<h.width;t+=e)for(let n=0;n<h.height;n+=e){s.fillStyle=(t+n)%2?"#ffffff":"#bfbfbf"
const r=h.x+t,i=h.y+n,o=t+e>h.width?h.width-t:e,a=n+e>h.height?h.height-n:e
s.fillRect(r,i,o,a)}}if(s.drawImage(l,h.x,h.y,h.width,h.height),i&&o){const e=o
s.rect(h.x,h.y,h.width,h.height),s.rect(h.x+e,h.y+e,h.width-2*e,h.height-2*e),s.fillStyle=i,s.fill("evenodd")}})
return e.runTask(a,{useOverlay:!0})}function Pu({plugin:e,canvas:t,color:n="rgba(255, 87, 45, 0.75)"}){var r
const i=e.helpers.viewportScreenshot,s=oc(null==i?void 0:i.behaviors.values),l=oc(null==i?void 0:i.behaviors.cropParams),c=oc(null==i?void 0:i.behaviors.relativeCrop),u=(0,o.useRef)({x:0,y:0,width:0,height:0})
oc("viewport"===(null==s?void 0:s.resolution.name)?null===(r=e.canvas3d)||void 0===r?void 0:r.resized:void 0)
const[d,p]=o.useState(""),[h,f]=(0,o.useState)([0,0]),[m,g]=(0,o.useState)([0,0])
if(!i||!t||!c)return null
const{width:y,height:v}=i.getSizeAndViewport(),b=Eu(y,v,t.clientWidth,t.clientHeight),x={x:b.x+Math.floor(b.width*c.x),y:b.y+Math.floor(b.height*c.y),width:Math.ceil(b.width*c.width),height:Math.ceil(b.height*c.height)},S=Bu(x),_=Bu(b)
if("move"===d?(S.l+=m[0]-h[0],S.r+=m[0]-h[0],S.t+=m[1]-h[1],S.b+=m[1]-h[1]):d&&(d.indexOf("left")>=0?S.l+=m[0]-h[0]:d.indexOf("right")>=0&&(S.r+=m[0]-h[0]),d.indexOf("top")>=0?S.t+=m[1]-h[1]:d.indexOf("bottom")>=0&&(S.b+=m[1]-h[1])),S.l>S.r){const e=S.l
S.l=S.r,S.r=e}if(S.t>S.b){const e=S.t
S.t=S.b,S.b=e}S.l=Math.min(_.r-40,Math.max(_.l,S.l)),S.r=Math.max(_.l+40,Math.min(_.r,S.r)),S.t=Math.min(_.b-40,Math.max(_.t,S.t)),S.b=Math.max(_.t+40,Math.min(_.b,S.b)),x.x=S.l,x.y=S.t,x.width=S.r-S.l+1,x.height=S.b-S.t+1,u.current=x
const C=e=>{e.preventDefault(),g([e.pageX,e.pageY])},w=e=>{e.preventDefault()
const t=e.touches[0]
g([t.pageX,t.pageY])},T=e=>{e.preventDefault(),p(e.currentTarget.getAttribute("data-drag"))
const t=e.touches[0],n=[t.pageX,t.pageY]
f(n),g(n),window.addEventListener("touchend",P),window.addEventListener("touchmove",w)},A=e=>{e.preventDefault(),p(e.currentTarget.getAttribute("data-drag"))
const t=[e.pageX,e.pageY]
f(t),g(t),window.addEventListener("mouseup",I),window.addEventListener("mousemove",C)},I=()=>{window.removeEventListener("mouseup",I),window.removeEventListener("mousemove",C),B()},P=()=>{window.removeEventListener("touchend",P),window.removeEventListener("touchmove",w),B()}
function B(){const e=u.current;(null==l?void 0:l.auto)&&(null==i||i.behaviors.cropParams.next({...l,auto:!1})),null==i||i.behaviors.relativeCrop.next({x:(e.x-b.x)/b.width,y:(e.y-b.y)/b.height,width:e.width/b.width,height:e.height/b.height}),p("")
const t=[0,0]
f(t),g(t)}const E=e=>{e.preventDefault(),e.stopPropagation()},k=`3px solid ${n}`,D="transparent"
return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{"data-drag":"move",style:{position:"absolute",left:x.x,top:x.y,width:x.width,height:x.height,border:k,cursor:"move"},onMouseDown:A,onTouchStart:T,draggable:!1,onContextMenu:E}),(0,a.jsx)("div",{"data-drag":"left",style:{position:"absolute",left:x.x-4,top:x.y+4,width:16,height:x.height-4,background:D,cursor:"w-resize"},onMouseDown:A,onTouchStart:T,draggable:!1,onContextMenu:E}),(0,a.jsx)("div",{"data-drag":"right",style:{position:"absolute",left:S.r-8,top:x.y,width:16,height:x.height-4,background:D,cursor:"w-resize"},onMouseDown:A,onTouchStart:T,draggable:!1,onContextMenu:E}),(0,a.jsx)("div",{"data-drag":"top",style:{position:"absolute",left:x.x-4,top:x.y-4,width:x.width+8,height:16,background:D,cursor:"n-resize"},onMouseDown:A,onTouchStart:T,draggable:!1,onContextMenu:E}),(0,a.jsx)("div",{"data-drag":"bottom",style:{position:"absolute",left:x.x-4,top:S.b-8,width:x.width+8,height:16,background:D,cursor:"n-resize"},onMouseDown:A,onTouchStart:T,draggable:!1,onContextMenu:E}),(0,a.jsx)("div",{"data-drag":"top, left",style:{position:"absolute",left:S.l-4,top:S.t-4,width:16,height:16,background:D,cursor:"nw-resize"},onMouseDown:A,onTouchStart:T,draggable:!1,onContextMenu:E}),(0,a.jsx)("div",{"data-drag":"bottom, right",style:{position:"absolute",left:S.r-8,top:S.b-8,width:16,height:16,background:D,cursor:"nw-resize"},onMouseDown:A,onTouchStart:T,draggable:!1,onContextMenu:E}),(0,a.jsx)("div",{"data-drag":"top, right",style:{position:"absolute",left:S.r-8,top:S.t-4,width:16,height:16,background:D,cursor:"ne-resize"},onMouseDown:A,onTouchStart:T,draggable:!1,onContextMenu:E}),(0,a.jsx)("div",{"data-drag":"bottom, left",style:{position:"absolute",left:S.l-4,top:S.b-8,width:16,height:16,background:D,cursor:"ne-resize"},onMouseDown:A,onTouchStart:T,draggable:!1,onContextMenu:E})]})}function Bu(e){return{l:e.x,t:e.y,r:e.x+e.width-1,b:e.y+e.height-1}}function Eu(e,t,n,r){const i=e/t
if(i<=n/r){const e=r*i
return{x:Math.round((n-e)/2),y:0,width:Math.round(e),height:r}}{const e=n/i
return{x:0,y:Math.round((r-e)/2),width:n,height:Math.round(e)}}}class ku extends l.dL{constructor(){super(...arguments),this.state={showPreview:!0,isDisabled:!1},this.download=()=>{var e
null===(e=this.plugin.helpers.viewportScreenshot)||void 0===e||e.download(),this.props.close()},this.copy=async()=>{var e
try{await(null===(e=this.plugin.helpers.viewportScreenshot)||void 0===e?void 0:e.copyToClipboard()),Ir.PluginCommands.Toast.Show(this.plugin,{message:"Copied to clipboard.",title:"Screenshot",timeoutMs:1500})}catch(e){return this.copyImg()}},this.copyImg=async()=>{var e
const t=await(null===(e=this.plugin.helpers.viewportScreenshot)||void 0===e?void 0:e.getImageDataUri())
this.setState({imageData:t})},this.open=e=>{e.target.files&&e.target.files[0]&&Ir.PluginCommands.State.Snapshots.OpenFile(this.plugin,{file:e.target.files[0]})}}componentDidMount(){this.subscribe(this.plugin.state.data.behaviors.isUpdating,e=>{this.setState({isDisabled:e})})}componentWillUnmount(){super.componentWillUnmount(),this.setState({imageData:void 0})}render(){var e
const t=!!(null===(e=navigator.clipboard)||void 0===e?void 0:e.write)
return(0,a.jsxs)("div",{children:[this.state.showPreview&&(0,a.jsxs)("div",{className:"msp-image-preview",children:[(0,a.jsx)(Au,{plugin:this.plugin}),(0,a.jsx)(Lu,{plugin:this.plugin})]}),(0,a.jsxs)("div",{className:"msp-flex-row",children:[!this.state.imageData&&(0,a.jsx)(Pr.$n,{icon:Br.y5,onClick:t?this.copy:this.copyImg,disabled:this.state.isDisabled,children:"Copy"}),this.state.imageData&&(0,a.jsx)(Pr.$n,{onClick:()=>this.setState({imageData:void 0}),disabled:this.state.isDisabled,children:"Clear"}),(0,a.jsx)(Pr.$n,{icon:Br.U3,onClick:this.download,disabled:this.state.isDisabled,children:"Download"})]}),this.state.imageData&&(0,a.jsxs)("div",{className:"msp-row msp-copy-image-wrapper",children:[(0,a.jsx)("div",{children:"Right click below + Copy Image"}),(0,a.jsx)("img",{src:this.state.imageData,style:{width:"100%",height:32,display:"block"}})]}),(0,a.jsx)(Ou,{plugin:this.plugin,isDisabled:this.state.isDisabled}),(0,a.jsxs)(Pr.Yj,{header:"State",children:[(0,a.jsx)(Ec,{onAction:this.props.close}),(0,a.jsx)(Pr.Yj,{header:"Save Options",initiallyExpanded:!1,noOffset:!0,children:(0,a.jsx)(kc,{})})]}),(0,a.jsx)(Pr.Yj,{header:"Camera",children:(0,a.jsx)(Ru,{plugin:this.plugin})})]})}}function Du(e){return`${null==e?void 0:e.map(e=>(0,s.LI)(e,2)).join(", ")}`}function Mu({title:e,children:t}){return(0,a.jsxs)("div",{className:"msp-control-row",children:[(0,a.jsx)("span",{className:"msp-control-row-label",children:e}),(0,a.jsx)("div",{className:"msp-control-row-text",style:{fontSize:"0.85rem",overflow:"hidden",whiteSpace:"nowrap"},children:t})]})}function Ru({plugin:e}){var t,n,r,i,l,c
const[,u]=(0,o.useState)({});(0,o.useEffect)(()=>{var t
const n=null===(t=e.canvas3d)||void 0===t?void 0:t.didDraw.subscribe(()=>u({}))
return()=>null==n?void 0:n.unsubscribe()},[e])
const d=null===(t=e.canvas3d)||void 0===t?void 0:t.camera.state,p=function(e){if(e)return function(e,t,n,r){const i=Za.e.sub((0,Za.e)(),t,e),o=function(e,t){return"orthographic"===e?1/(2*Math.tan(t/2)):1/(2*Math.sin(t/2))}(n,r)||1
return Za.e.scaleAndAdd(i,e,i,1/o)}(e.target,e.position,e.mode,e.fov)}(d),h=Ta.eB.sub((0,Ta.eB)(),null!==(n=null==d?void 0:d.target)&&void 0!==n?n:Ta.eB.origin,null!==(r=null==d?void 0:d.position)&&void 0!==r?r:Ta.eB.origin)
return Ta.eB.normalize(h,h),(0,a.jsxs)("div",{children:[(0,a.jsx)(Mu,{title:"Position",children:Du(null==d?void 0:d.position)}),(0,a.jsx)(Mu,{title:"FoV Norm. Pos.",children:Du(p)}),(0,a.jsx)(Mu,{title:"Target",children:Du(null==d?void 0:d.target)}),(0,a.jsx)(Mu,{title:"Direction",children:Du(h)}),(0,a.jsx)(Mu,{title:"Up",children:Du(null==d?void 0:d.up)}),(0,a.jsx)(Mu,{title:"Distance",children:(0,s.LI)(Ta.eB.distance(null!==(i=null==d?void 0:d.position)&&void 0!==i?i:Ta.eB.origin,null!==(l=null==d?void 0:d.target)&&void 0!==l?l:Ta.eB.origin),2)}),(0,a.jsx)(Mu,{title:"Radius",children:(0,s.LI)(null!==(c=null==d?void 0:d.radius)&&void 0!==c?c:0,2)}),(0,a.jsx)(Pr.$n,{onClick:()=>{if(!navigator.clipboard)return
const e=`{\n    position: [${null==p?void 0:p.map(e=>(0,s.LI)(e,2)).join(", ")}],\n    target: [${null==d?void 0:d.target.map(e=>(0,s.LI)(e,2)).join(", ")}],\n    up: [${null==d?void 0:d.up.map(e=>(0,s.LI)(e,2)).join(", ")}],\n}`
navigator.clipboard.writeText(e)},style:{marginTop:1},title:"Copy JSON usable in MolViewSpec, uses FoV Normalized Position",children:"Copy MVS JSON"})]})}function Ou({plugin:e,isDisabled:t}){const n=e.helpers.viewportScreenshot,r=oc(null==n?void 0:n.behaviors.values)
return n?(0,a.jsx)(Er.y1,{params:n.params,values:r,onChangeValues:e=>n.behaviors.values.next(e),isDisabled:t}):null}function Lu({plugin:e}){const t=e.helpers.viewportScreenshot,n=oc(null==t?void 0:t.behaviors.cropParams)
return oc(null==t?void 0:t.behaviors.relativeCrop),t&&n?(0,a.jsxs)("div",{style:{width:"100%",height:"24px",marginTop:"8px"},children:[(0,a.jsx)(Pr.ff,{icon:Br.l8,title:"Auto-crop",inline:!0,isSelected:n.auto,style:{background:"transparent",float:"left",width:"auto",height:"24px",lineHeight:"24px"},toggle:()=>t.toggleAutocrop(),label:"Auto-crop "+(n.auto?"On":"Off")}),!n.auto&&(0,a.jsx)(Pr.$n,{icon:Br.FJ,title:"Crop",style:{background:"transparent",float:"right",height:"24px",lineHeight:"24px",width:"24px",padding:"0"},onClick:()=>t.autocrop()}),!n.auto&&!t.isFullFrame&&(0,a.jsx)(Pr.$n,{icon:Br.fL,title:"Reset Crop",style:{background:"transparent",float:"right",height:"24px",lineHeight:"24px",width:"24px",padding:"0"},onClick:()=>t.resetCrop()})]}):null}var Nu=n(34761)
class Fu extends l.dL{componentDidMount(){this.plugin.canvas3d&&(this.subscribe(this.plugin.events.canvas3d.settingsUpdated,()=>this.forceUpdate()),this.subscribe(this.plugin.canvas3d.camera.stateChanged.pipe((0,va.c)(500,void 0,{leading:!0,trailing:!0})),e=>{void 0===e.radiusMax&&void 0===e.radius||this.forceUpdate()}))}render(){return this.plugin.canvas3d?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Er.dr,{mapping:Vu}),(0,a.jsx)(Do,{})]}):null}}const zu={sequence:"Sequence",log:"Log",left:"Left Panel",right:"Right Panel"},ju={animate:wc._i.trackball.params.animate,camera:wc._i.camera,background:Vr.t.Group({color:Vr.t.Color((0,lo.Color)(16579577),{label:"Background",description:"Custom background color"}),transparent:Vr.t.Boolean(!1),style:wc._i.postprocessing.params.background},{pivot:"color"}),lighting:Vr.t.Group({occlusion:wc._i.postprocessing.params.occlusion,shadow:wc._i.postprocessing.params.shadow,outline:wc._i.postprocessing.params.outline,dof:wc._i.postprocessing.params.dof,fog:wc._i.cameraFog},{isFlat:!0}),clipping:Vr.t.Group({...wc._i.cameraClipping.params},{pivot:"radius"}),layout:Vr.t.MultiSelect([],Vr.t.objectToOptions(zu)),advanced:Vr.t.Group({illumination:wc._i.illumination,multiSample:wc._i.multiSample,hiZ:wc._i.hiZ,sharpening:wc._i.postprocessing.params.sharpening,bloom:wc._i.postprocessing.params.bloom,resolutionMode:wc.H7.Params.resolutionMode,pixelScale:wc.H7.Params.pixelScale,transparency:wc.H7.Params.transparency})},Vu=(Uu={params:e=>{var t
const n=Vr.t.clone(ju),r=null===(t=e.spec.components)||void 0===t?void 0:t.controls
if(r){const e=[]
"none"!==r.top&&e.push(["sequence",zu.sequence]),"none"!==r.bottom&&e.push(["log",zu.log]),"none"!==r.left&&e.push(["left",zu.left]),"none"!==r.right&&e.push(["right",zu.right]),n.layout.options=e}const i=e.config.get(go.PluginConfig.Background.Styles)||[]
return i.length>0&&Object.assign(n.background.params.style,{presets:(0,jr.Go)(i),isFlat:!1}),n},target(e){var t,n,r
const i=null===(t=e.spec.components)||void 0===t?void 0:t.controls,o=e.layout.state.regionState,a=[]
"hidden"===o.top||i&&"none"===i.top||a.push("sequence"),"hidden"===o.bottom||i&&"none"===i.bottom||a.push("log"),"hidden"===o.left||i&&"none"===i.left||a.push("left"),"hidden"===o.right||i&&"none"===i.right||a.push("right")
const{pixelScale:s,transparency:l,resolutionMode:c}=null===(n=e.canvas3dContext)||void 0===n?void 0:n.props
return{canvas:null===(r=e.canvas3d)||void 0===r?void 0:r.props,layout:a,resolutionMode:c,pixelScale:s,transparency:l}}},({values:e,update:t,apply:n})=>({params:"function"==typeof Uu.params?Uu.params:e=>Uu.params,getTarget:Uu.target,getValues:e,update(e,n){const r=Uu.target(n)
return(0,Nu.j)(r,r=>t(e,r,n))},apply:n||(()=>{})}))({values(e,t){const{canvas:n}=e,r=n.renderer
return{layout:e.layout,animate:n.trackball.animate,camera:n.camera,background:{color:r.backgroundColor,transparent:n.transparentBackground,style:n.postprocessing.background},lighting:{occlusion:n.postprocessing.occlusion,shadow:n.postprocessing.shadow,outline:n.postprocessing.outline,dof:n.postprocessing.dof,fog:n.cameraFog},clipping:{...n.cameraClipping},advanced:{illumination:n.illumination,multiSample:n.multiSample,hiZ:n.hiZ,sharpening:n.postprocessing.sharpening,bloom:n.postprocessing.bloom,resolutionMode:e.resolutionMode,pixelScale:e.pixelScale,transparency:e.transparency}}},update(e,t){const n=t.canvas
n.trackball.animate=e.animate,n.camera=e.camera,n.transparentBackground=e.background.transparent,n.renderer.backgroundColor=e.background.color,n.postprocessing.occlusion=e.lighting.occlusion,n.postprocessing.shadow=e.lighting.shadow,n.postprocessing.outline=e.lighting.outline,n.postprocessing.background=e.background.style,n.cameraFog=e.lighting.fog,n.cameraClipping={radius:e.clipping.radius,far:e.clipping.far,minNear:e.clipping.minNear},n.illumination=e.advanced.illumination,n.multiSample=e.advanced.multiSample,n.hiZ=e.advanced.hiZ,n.postprocessing.sharpening=e.advanced.sharpening,n.postprocessing.bloom=e.advanced.bloom,n.postprocessing.dof=e.lighting.dof,t.layout=e.layout,t.resolutionMode=e.advanced.resolutionMode,t.pixelScale=e.advanced.pixelScale,t.transparency=e.advanced.transparency},async apply(e,t){var n
await Ir.PluginCommands.Canvas3D.SetSettings(t,{settings:e.canvas})
const r=e.layout.indexOf("left")<0,i=(0,Nu.j)(t.layout.state,n=>{n.regionState.top=e.layout.indexOf("sequence")>=0?"full":"hidden",n.regionState.bottom=e.layout.indexOf("log")>=0?"full":"hidden",n.regionState.left=r?"hidden":"none"===t.behaviors.layout.leftPanelTabName.value?"collapsed":"full",n.regionState.right=e.layout.indexOf("right")>=0?"full":"hidden"})
await Ir.PluginCommands.Layout.Update(t,{state:i}),r&&Ir.PluginCommands.State.SetCurrentObject(t,{state:t.state.data,ref:$r.Cn.RootRef}),null===(n=t.canvas3dContext)||void 0===n||n.setProps({resolutionMode:e.resolutionMode,pixelScale:e.pixelScale,transparency:e.transparency})}})
var Uu
class Gu extends l.dL{constructor(){super(...arguments),this.allCollapsedState={isSettingsExpanded:!1,isScreenshotExpanded:!1},this.state={...this.allCollapsedState,isCameraResetEnabled:!0},this.resetCamera=()=>{Ir.PluginCommands.Camera.Reset(this.plugin,{})},this.toggleSettingsExpanded=this.toggle("isSettingsExpanded"),this.toggleScreenshotExpanded=this.toggle("isScreenshotExpanded"),this.toggleControls=()=>{Ir.PluginCommands.Layout.Update(this.plugin,{state:{showControls:!this.plugin.layout.state.showControls}})},this.toggleExpanded=()=>{Ir.PluginCommands.Layout.Update(this.plugin,{state:{isExpanded:!this.plugin.layout.state.isExpanded,expandToFullscreen:!1}})},this.toggleFullscreen=()=>{Ir.PluginCommands.Layout.Update(this.plugin,{state:{expandToFullscreen:!this.plugin.layout.state.expandToFullscreen}})},this.toggleXR=()=>{this.plugin.canvas3d&&(this.plugin.canvas3d.xr.isPresenting.value?this.plugin.canvas3d.xr.end():this.plugin.canvas3d.xr.request())},this.toggleIllumination=()=>{this.plugin.canvas3d&&Ir.PluginCommands.Canvas3D.SetSettings(this.plugin,{settings:{illumination:{...this.plugin.canvas3d.props.illumination,enabled:!this.plugin.canvas3d.props.illumination.enabled}}})},this.setSettings=e=>{Ir.PluginCommands.Canvas3D.SetSettings(this.plugin,{settings:{[e.name]:e.value}})},this.setLayout=e=>{Ir.PluginCommands.Layout.Update(this.plugin,{state:{[e.name]:e.value}})},this.screenshot=()=>{var e
null===(e=this.plugin.helpers.viewportScreenshot)||void 0===e||e.download()},this.enableCameraReset=e=>{this.setState(t=>({...t,isCameraResetEnabled:e}))}}toggle(e){return t=>{this.setState(t=>({...t,...this.allCollapsedState,[e]:!this.state[e]})),null==t||t.currentTarget.blur()}}componentDidMount(){this.subscribe(this.plugin.events.canvas3d.settingsUpdated,()=>this.forceUpdate()),this.subscribe(this.plugin.layout.events.updated,()=>this.forceUpdate()),this.plugin.canvas3d&&(this.subscribe(this.plugin.canvas3d.camera.stateChanged.pipe((0,va.c)(500,void 0,{leading:!0,trailing:!0})),e=>this.enableCameraReset(0!==e.radius&&0!==e.radiusMax)),this.subscribe(this.plugin.canvas3d.xr.isSupported,()=>this.forceUpdate()),this.subscribe(this.plugin.canvas3d.xr.isPresenting,()=>this.forceUpdate()))}icon(e,t,n,r=!0,i=!1){return(0,a.jsx)(Pr.K0,{svg:e,toggleState:r,onClick:t,title:n,style:{background:"transparent"},disabled:i})}render(){var e,t,n
const r=this.plugin.config.get(go.PluginConfig.Viewport.ShowXR),i=!!(null===(e=this.plugin.canvas3d)||void 0===e?void 0:e.xr.isSupported.value),o=!!(null===(t=this.plugin.canvas3d)||void 0===t?void 0:t.xr.isPresenting.value),s="always"===r||"auto"===r&&i,l=i?o?"Exit XR":"Enter XR":"Augmented/Virtual Reality unavailable",c=this.plugin.layout.state
return(0,a.jsxs)("div",{className:"msp-viewport-controls",children:[(0,a.jsxs)("div",{className:"msp-viewport-controls-buttons",children:[this.plugin.config.get(go.PluginConfig.Viewport.ShowReset)&&(0,a.jsxs)("div",{className:"msp-hover-box-wrapper",children:[(0,a.jsx)("div",{className:"msp-semi-transparent-background"}),this.icon(Br.FP,this.resetCamera,"Reset Zoom"),(0,a.jsx)("div",{className:"msp-hover-box-body",children:(0,a.jsxs)("div",{className:"msp-flex-column",children:[(0,a.jsx)("div",{className:"msp-flex-row",children:(0,a.jsx)(Pr.$n,{onClick:()=>this.resetCamera(),disabled:!this.state.isCameraResetEnabled,title:"Set camera zoom to fit the visible scene into view",children:"Reset Zoom"})}),(0,a.jsx)("div",{className:"msp-flex-row",children:(0,a.jsx)(Pr.$n,{onClick:()=>Ir.PluginCommands.Camera.OrientAxes(this.plugin),disabled:!this.state.isCameraResetEnabled,title:"Align principal component axes of the loaded structures to the screen axes (lay flat)",children:"Orient Axes"})}),(0,a.jsx)("div",{className:"msp-flex-row",children:(0,a.jsx)(Pr.$n,{onClick:()=>Ir.PluginCommands.Camera.ResetAxes(this.plugin),disabled:!this.state.isCameraResetEnabled,title:"Align Cartesian axes to the screen axes",children:"Reset Axes"})})]})}),(0,a.jsx)("div",{className:"msp-hover-box-spacer"})]}),this.plugin.config.get(go.PluginConfig.Viewport.ShowScreenshotControls)&&(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"msp-semi-transparent-background"}),this.icon(Br.C$,this.toggleScreenshotExpanded,"Screenshot / State Snapshot",this.state.isScreenshotExpanded)]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"msp-semi-transparent-background"}),this.plugin.config.get(go.PluginConfig.Viewport.ShowControls)&&this.icon(Br.fl,this.toggleControls,"Toggle Controls Panel",this.plugin.layout.state.showControls),this.plugin.config.get(go.PluginConfig.Viewport.ShowExpand)&&(0,a.jsxs)("div",{className:"msp-hover-box-wrapper",children:[this.icon(Br.E2,this.toggleExpanded,"Toggle Expanded Viewport",this.plugin.layout.state.isExpanded),(0,a.jsx)("div",{className:"msp-hover-box-body",children:(0,a.jsx)("div",{className:"msp-flex-column",children:(0,a.jsx)("div",{className:"msp-flex-row",children:(0,a.jsx)(Pr.$n,{onClick:this.toggleFullscreen,children:c.expandToFullscreen?"Exit Fullscreen":"Fullscreen"})})})}),(0,a.jsx)("div",{className:"msp-hover-box-spacer"})]}),!this.plugin.config.get(go.PluginConfig.Viewport.ShowExpand)&&this.plugin.config.get(go.PluginConfig.Viewport.ShowToggleFullscreen)&&this.icon(Br.Cj,this.toggleFullscreen,"Toggle Full Screen",this.plugin.layout.state.expandToFullscreen),this.plugin.config.get(go.PluginConfig.Viewport.ShowSettings)&&this.icon(Br.Hk,this.toggleSettingsExpanded,"Settings / Controls Info",this.state.isSettingsExpanded),this.plugin.config.get(go.PluginConfig.Viewport.ShowIllumination)&&this.icon(Br.MI,this.toggleIllumination,"Illumination",(null===(n=this.plugin.canvas3d)||void 0===n?void 0:n.props.illumination.enabled)||!1),s&&this.icon(Br.le,this.toggleXR,l,o,!i)]}),this.plugin.config.get(go.PluginConfig.Viewport.ShowSelectionMode)&&(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"msp-semi-transparent-background"}),(0,a.jsx)(Ro,{})]})]}),this.state.isScreenshotExpanded&&(0,a.jsx)("div",{className:"msp-viewport-controls-panel",children:(0,a.jsx)(Pr.tW,{header:"Screenshot / State",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleScreenshotExpanded,topRightIcon:Br.X6,noTopMargin:!0,childrenClassName:"msp-viewport-controls-panel-controls",children:(0,a.jsx)(ku,{close:this.toggleScreenshotExpanded})})}),this.state.isSettingsExpanded&&(0,a.jsx)("div",{className:"msp-viewport-controls-panel",children:(0,a.jsx)(Pr.tW,{header:"Settings / Controls Info",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleSettingsExpanded,topRightIcon:Br.X6,noTopMargin:!0,childrenClassName:"msp-viewport-controls-panel-controls",children:(0,a.jsx)(Fu,{})})})]})}}const Hu=()=>(0,a.jsx)("a",{className:"msp-logo",href:"https://molstar.org",target:"_blank"}),qu=()=>(0,a.jsx)(Tu,{logo:Hu})
var Qu=n(8054),$u=n(32372)
function Xu({plugin:e}){return e.isInitialized?(0,a.jsx)(l.aU.Provider,{value:e,children:(0,a.jsx)(Yu,{})}):(0,a.jsx)(Wu,{plugin:e})}function Wu({plugin:e}){const[t,n]=o.useState({kind:"pending"})
return o.useEffect(()=>{n({kind:"pending"})
let t=!0
return e.initialized.then(()=>{t&&n({kind:"initialized"})}).catch(e=>{t&&n({kind:"error",message:`${e}`})}),()=>{t=!1}},[e]),"pending"===t.kind?null:"error"===t.kind?(0,a.jsx)("div",{className:"msp-plugin",children:(0,a.jsxs)("div",{className:"msp-plugin-init-error",children:["Initialization error: ",t.message]})}):(0,a.jsx)(l.aU.Provider,{value:e,children:(0,a.jsx)(Yu,{})})}o.Component
class Yu extends l.dL{constructor(){super(...arguments),this.onDrop=e=>{e.preventDefault()
const t=[]
if(e.dataTransfer.items)for(let r=0;r<e.dataTransfer.items.length;r++){if("file"!==e.dataTransfer.items[r].kind)continue
const n=e.dataTransfer.items[r].getAsFile()
n&&t.push(n)}else for(let r=0;r<e.dataTransfer.files.length;r++){const n=e.dataTransfer.files[r]
n&&t.push(n)}const n=t.filter(e=>{const t=e.name.toLowerCase()
return t.endsWith(".molx")||t.endsWith(".molj")})
n.length>0?Ir.PluginCommands.State.Snapshots.OpenFile(this.plugin,{file:n[0]}):this.plugin.runTask(this.plugin.state.data.applyAction(Qu.OpenFiles,{files:t.map(e=>$u.V.File(e)),format:{name:"auto",params:{}},visuals:!0}))},this.onDragOver=e=>{e.preventDefault()},this.showDragOverlay=new qi.t(!1),this.onDragEnter=e=>{let t=!1
if(e.dataTransfer.items&&e.dataTransfer.items.length>0){for(let n=0;n<e.dataTransfer.items.length;n++)if("file"===e.dataTransfer.items[n].kind){t=!0
break}}else for(let n=0;n<e.dataTransfer.types.length;n++)if("Files"===e.dataTransfer.types[n]){t=!0
break}t&&this.showDragOverlay.next(!0)}}componentDidMount(){this.subscribe(this.plugin.layout.events.updated,()=>this.forceUpdate())}region(e,t){return(0,a.jsx)("div",{className:`msp-layout-region msp-layout-${e}`,children:(0,a.jsx)("div",{className:"msp-layout-static",children:t?(0,a.jsx)(t,{}):null})})}get layoutVisibilityClassName(){var e,t
const n=this.plugin.layout.state,r=null!==(t=null===(e=this.plugin.spec.components)||void 0===e?void 0:e.controls)&&void 0!==t?t:{},i=[]
return"none"!==r.top&&n.showControls&&"hidden"!==n.regionState.top||i.push("msp-layout-hide-top"),"none"!==r.left&&n.showControls&&"hidden"!==n.regionState.left?"collapsed"===n.regionState.left&&i.push("msp-layout-collapse-left"):i.push("msp-layout-hide-left"),"none"!==r.right&&n.showControls&&"hidden"!==n.regionState.right||i.push("msp-layout-hide-right"),"none"!==r.bottom&&n.showControls&&"hidden"!==n.regionState.bottom||i.push("msp-layout-hide-bottom"),i.join(" ")}get layoutClassName(){const e=this.plugin.layout.state,t=["msp-plugin-content"]
return e.isExpanded?t.push("msp-layout-expanded"):t.push("msp-layout-standard",`msp-layout-standard-${e.controlsDisplay}`),t.join(" ")}render(){var e,t,n,r,i,o,s
const l=this.plugin.layout.state,c=(null===(e=this.plugin.spec.components)||void 0===e?void 0:e.controls)||{},u=(null===(n=null===(t=this.plugin.spec.components)||void 0===t?void 0:t.viewport)||void 0===n?void 0:n.view)||Ju,d=(null===(i=null===(r=this.plugin.spec.components)||void 0===r?void 0:r.sequenceViewer)||void 0===i?void 0:i.view)||gu
return(0,a.jsx)("div",{className:"msp-plugin",children:(0,a.jsxs)("div",{className:this.layoutClassName,onDragEnter:this.onDragEnter,children:[(0,a.jsxs)("div",{className:this.layoutVisibilityClassName,children:[this.region("main",u),l.showControls&&"none"!==c.top&&this.region("top",c.top||d),l.showControls&&"none"!==c.left&&this.region("left",c.left||Qc),l.showControls&&"none"!==c.right&&this.region("right",c.right||Ku),l.showControls&&"none"!==c.bottom&&this.region("bottom",c.bottom||ed)]}),!(null===(o=this.plugin.spec.components)||void 0===o?void 0:o.hideTaskOverlay)&&(0,a.jsx)(_u,{}),!(null===(s=this.plugin.spec.components)||void 0===s?void 0:s.disableDragOverlay)&&(0,a.jsx)(Zu,{plugin:this.plugin,showDragOverlay:this.showDragOverlay})]})})}}function Zu({plugin:e,showDragOverlay:t}){const n=oc(t),r=e=>{e.dataTransfer.dropEffect="copy",e.preventDefault(),e.stopPropagation()}
return(0,a.jsx)("div",{className:"msp-drag-drop-overlay",style:{display:n?"flex":"none"},onDragEnter:r,onDragOver:r,onDragLeave:()=>t.next(!1),onDrop:n=>function(e,t,n){e.preventDefault(),e.stopPropagation(),n.next(!1)
const r=[]
if(e.dataTransfer.items)for(let i=0;i<e.dataTransfer.items.length;i++){if("file"!==e.dataTransfer.items[i].kind)continue
const t=e.dataTransfer.items[i].getAsFile()
t&&r.push(t)}else for(let i=0;i<e.dataTransfer.files.length;i++){const t=e.dataTransfer.files[i]
t&&r.push(t)}t.managers.dragAndDrop.handle(r)}(n,e,t),children:"Load File(s)"})}class Ku extends l.dL{render(){var e
const t=(null===(e=this.plugin.spec.components)||void 0===e?void 0:e.structureTools)||Cc
return(0,a.jsx)("div",{className:"msp-scrollable-container",children:(0,a.jsx)(t,{})})}}class Ju extends l.dL{render(){var e,t,n,r,i,o
const s=(null===(t=null===(e=this.plugin.spec.components)||void 0===e?void 0:e.viewport)||void 0===t?void 0:t.controls)||Gu,l=(null===(r=null===(n=this.plugin.spec.components)||void 0===n?void 0:n.selectionTools)||void 0===r?void 0:r.controls)||xc,c=(null===(o=null===(i=this.plugin.spec.components)||void 0===i?void 0:i.viewport)||void 0===o?void 0:o.snapshotDescription)||vc
return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(qu,{}),(0,a.jsxs)("div",{className:"msp-viewport-top-left-controls",children:[(0,a.jsx)(bc,{}),(0,a.jsx)(gc,{}),(0,a.jsx)(yc,{}),(0,a.jsx)(c,{})]}),(0,a.jsx)(l,{}),(0,a.jsx)(s,{}),(0,a.jsx)(vu,{}),(0,a.jsxs)("div",{className:"msp-highlight-toast-wrapper",children:[(0,a.jsx)(Sc,{}),(0,a.jsx)(wu,{})]})]})}}class ed extends l.dL{constructor(){super(...arguments),this.wrapper=o.createRef(),this.state={entries:this.plugin.log.entries}}componentDidMount(){this.subscribe(this.plugin.events.log,()=>this.setState({entries:this.plugin.log.entries}))}componentDidUpdate(){this.scrollToBottom()}scrollToBottom(){const e=this.wrapper.current
e&&(e.scrollTop=e.scrollHeight-e.clientHeight-1)}render(){const e=this.state.entries,t=e.size,n=[]
for(let r=Math.max(0,t-10),i=0;r<t;r++){const t=e.get(r)
n.push((0,a.jsxs)("li",{children:[(0,a.jsx)("div",{className:"msp-log-entry-badge msp-log-entry-"+t.type}),(0,a.jsx)("div",{className:"msp-log-timestamp",children:(0,s.fU)(t.timestamp)}),(0,a.jsx)("div",{className:"msp-log-entry",children:t.message})]},i++))}return(0,a.jsx)("div",{ref:this.wrapper,className:"msp-log",style:{position:"absolute",top:"0",right:"0",bottom:"0",left:"0",overflowY:"auto"},children:(0,a.jsx)("ul",{className:"msp-list-unstyled",children:n})})}}var td,nd=n(48861),rd=(n(39419),n(20610)),id=n(91660),od=n(28252)
!function(e){e.Registry=class{constructor(){this.providers=(0,Ac.uY)().asMutable(),this.defaultAutoAttachValues=new Map}getParams(e){const t={},n=[],r=[]
if(e){const i=this.providers.values()
for(;;){const o=i.next()
if(o.done)break
const a=o.value
a.isApplicable(e)&&(a.isHidden||(n.push([a.descriptor.name,a.label]),this.defaultAutoAttachValues.get(a.descriptor.name)&&r.push(a.descriptor.name)),t[a.descriptor.name]=Vr.t.Group({...a.getParams(e)},{label:a.label,isHidden:a.isHidden}))}}return{autoAttach:Vr.t.MultiSelect(r,n),properties:Vr.t.Group(t,{isFlat:!0})}}setDefaultAutoAttach(e,t){this.defaultAutoAttachValues.set(e,t)}get(e){if(!this.providers.get(e))throw new Error(`Custom property '${e}' is not registered.`)
return this.providers.get(e)}register(e,t){this.providers.set(e.descriptor.name,e),this.defaultAutoAttachValues.set(e.descriptor.name,t)}unregister(e){this.providers.delete(e),this.defaultAutoAttachValues.delete(e)}}}(td||(td={}))
var ad=n(56382),sd=n(33204)
class ld{get dataState(){return this.plugin.state.data}rawData(e,t){return this.dataState.build().toRoot().apply(ad.RawData,e,t).commit({revertOnError:!0})}download(e,t){return this.dataState.build().toRoot().apply(ad.Download,e,t).commit({revertOnError:!0})}downloadBlob(e,t){return this.dataState.build().toRoot().apply(ad.DownloadBlob,e,t).commit({revertOnError:!0})}async readFile(e,t){var n,r,i
return{data:await this.dataState.build().toRoot().apply(ad.ReadFile,e,t).commit({revertOnError:!0}),fileInfo:(0,sd.o)(null!==(i=null===(r=null===(n=e.file)||void 0===n?void 0:n.file)||void 0===r?void 0:r.name)&&void 0!==i?i:"")}}constructor(e){this.plugin=e}}var cd=n(70012),ud=n(5638)
class dd{get dataState(){return this.plugin.state.data}resolveProvider(e){var t
return"string"==typeof e?null!==(t=os.Bj[e])&&void 0!==t?t:(0,cd.L9)(this._providers,t=>t.id===e):e}hasPreset(e){for(const t of this._providers)if(!t.isApplicable||t.isApplicable(e,this.plugin))return!0
return!1}get providers(){return this._providers}getPresets(e){if(!e)return this.providers
const t=[]
for(const n of this._providers)n.isApplicable&&!n.isApplicable(e,this.plugin)||t.push(n)
return t}getPresetSelect(e){const t=[]
for(const n of this._providers)e&&n.isApplicable&&!n.isApplicable(e,this.plugin)||t.push([n.id,n.display.name,n.display.group])
return Vr.t.Select("auto",t)}getPresetsWithOptions(e){const t=[],n=Object.create(null)
for(const r of this._providers)r.isApplicable&&!r.isApplicable(e,this.plugin)||(t.push([r.id,r.display.name]),n[r.id]=r.params?Vr.t.Group(r.params(e,this.plugin)):Vr.t.EmptyGroup())
return 0===t.length?Vr.t.MappedStatic("",{"":Vr.t.EmptyGroup()}):Vr.t.MappedStatic(t[0][0],n,{options:t})}registerPreset(e){if(this.providerMap.has(e.id))throw new Error(`Representation provider with id '${e.id}' already registered.`)
this._providers.push(e),this.providerMap.set(e.id,e)}unregisterPreset(e){this.providerMap.delete(e.id),(0,ao.mO)(this._providers,e)}applyPreset(e,t,n){var r
const i=this.resolveProvider(t)
if(!i)return
const o=this.plugin.state.data,a=$r.so.resolveAndCheck(o,e)
if(!a)return void(ud.Zq||console.warn("Applying structure repr. provider to bad cell."))
const s=(null===(r=i.params)||void 0===r?void 0:r.call(i,a.obj,this.plugin))||{}
let l=n||(i.params?Vr.t.getDefaultValues(s):{})
const c=this.plugin.config.get(go.PluginConfig.Structure.DefaultRepresentationPresetParams)
l=Vr.t.merge(s,c,l)
const u=Fr.Task.create(`${i.display.name}`,()=>i.apply(a,l,this.plugin))
return this.plugin.runTask(u)}async addRepresentation(e,t,n){const r=this.dataState.build(),i=this.buildRepresentation(r,e,t,n)
if(i)return await r.commit(),i}buildRepresentation(e,t,n,r){var i,o
if(!t)return
const a=null===(o=null===(i=$r.so.resolveAndCheck(this.dataState,t))||void 0===i?void 0:i.obj)||void 0===o?void 0:o.data
if(!a)return
const s=(0,Dr.pQ)(this.plugin,a,n)
return(null==r?void 0:r.tag)?e.to(t).applyOrUpdateTagged(r.tag,qr.StructureRepresentation3D,s,{state:null==r?void 0:r.initialState}).selector:e.to(t).apply(qr.StructureRepresentation3D,s,{state:null==r?void 0:r.initialState}).selector}constructor(e){this.plugin=e,this._providers=[],this.providerMap=new Map,this.defaultProvider=os.Bj.auto,(0,jr.IF)(os.Bj,e=>this.registerPreset(e))}}var pd=n(10212),hd=n(14294),fd=n(80178),md=n(41036),gd=n(70594)
function yd(e){return e}!function(e){e.CommonParams=(e,t)=>({modelProperties:Vr.t.Optional(Vr.t.Group($r.xE.getParamDefinition(Ar.f.Model.CustomModelProperties,void 0,t))),structureProperties:Vr.t.Optional(Vr.t.Group($r.xE.getParamDefinition(Ar.f.Model.CustomStructureProperties,void 0,t))),representationPreset:Vr.t.Optional(Vr.t.Text("auto"))})}(yd||(yd={}))
const vd=yd.CommonParams,bd=yd({id:"preset-trajectory-default",display:{name:"Default (Assembly)",group:"Preset",description:"Shows the first assembly or, if that is unavailable, the first model."},isApplicable:e=>!0,params:(e,t)=>({model:Vr.t.Optional(Vr.t.Group($r.xE.getParamDefinition(Ar.f.Model.ModelFromTrajectory,e,t))),showUnitcell:Vr.t.Optional(Vr.t.Boolean(!1)),structure:Vr.t.Optional(fd.z.getParams(void 0,"assembly").type),representationPresetParams:Vr.t.Optional(Vr.t.Group(os.n9.CommonParams)),...vd(e,t)}),async apply(e,t,n){const r=n.builders.structure,i=await r.createModel(e,t.model),o=await r.insertModelProperties(i,t.modelProperties),a=await r.createStructure(o||i,t.structure),s=await r.insertStructureProperties(a,t.structureProperties),l=void 0===t.showUnitcell||t.showUnitcell?await r.tryCreateUnitcell(o,void 0,{isHidden:!0}):void 0,c=t.representationPreset||n.config.get(go.PluginConfig.Structure.DefaultRepresentationPreset)||os.Bj.auto.id
return{model:i,modelProperties:o,unitcell:l,structure:a,structureProperties:s,representation:await n.builders.structure.representation.applyPreset(s,c,t.representationPresetParams)}}}),xd=yd({id:"preset-trajectory-all-models",display:{name:"All Models",group:"Preset",description:"Shows all models; colored by trajectory-index."},isApplicable:e=>e.data.frameCount>1,params:(e,t)=>({useDefaultIfSingleModel:Vr.t.Optional(Vr.t.Boolean(!1)),representationPresetParams:Vr.t.Optional(Vr.t.Group(os.n9.CommonParams)),...vd(e,t)}),async apply(e,t,n){var r,i
const o=null===(i=null===(r=$r.so.resolveAndCheck(n.state.data,e))||void 0===r?void 0:r.obj)||void 0===i?void 0:i.data
if(!o)return{}
if(1===o.frameCount&&t.useDefaultIfSingleModel)return bd.apply(e,t,n)
const a=n.builders.structure,s=[],l=[]
for(let c=0;c<o.frameCount;c++){const r=await a.createModel(e,{modelIndex:c}),i=await a.insertModelProperties(r,t.modelProperties,{isCollapsed:!0}),u=await a.createStructure(i||r,{name:"model",params:{}}),d=await a.insertStructureProperties(u,t.structureProperties)
s.push(r),l.push(u)
const p=u.obj?(0,md.V8)(u.obj.data,{elementCountFactor:o.frameCount}):"medium",h=t.representationPreset||n.config.get(go.PluginConfig.Structure.DefaultRepresentationPreset)||os.Bj.auto.id
await a.representation.applyPreset(d,h,{theme:{globalName:"trajectory-index"},quality:p})}return{models:s,structures:l}}}),Sd=(e,t)=>({model:Vr.t.Optional(Vr.t.Group($r.xE.getParamDefinition(Ar.f.Model.ModelFromTrajectory,e,t))),...vd(e,t)})
async function _d(e,t,n,r){const i=r.builders.structure,o=await i.createModel(t,n.model),a=await i.insertModelProperties(o,n.modelProperties),s=await i.createStructure(a||o,{name:"symmetry",params:e}),l=await i.insertStructureProperties(s,n.structureProperties),c=await i.tryCreateUnitcell(a,void 0,{isHidden:!1}),u=n.representationPreset||r.config.get(go.PluginConfig.Structure.DefaultRepresentationPreset)||os.Bj.auto.id
return{model:o,modelProperties:a,unitcell:c,structure:s,structureProperties:l,representation:await r.builders.structure.representation.applyPreset(l,u,{theme:{globalName:e.theme}})}}const Cd=yd({id:"preset-trajectory-unitcell",display:{name:"Unit Cell",group:"Preset",description:"Shows the fully populated unit cell."},isApplicable:e=>Or.Model.hasCrystalSymmetry(e.data.representative),params:Sd,apply:async(e,t,n)=>await _d({ijkMin:Ta.eB.create(0,0,0),ijkMax:Ta.eB.create(0,0,0)},e,t,n)}),wd=yd({id:"preset-trajectory-supercell",display:{name:"Super Cell",group:"Preset",description:"Shows the super cell, i.e. the central unit cell and all adjacent unit cells."},isApplicable:e=>Or.Model.hasCrystalSymmetry(e.data.representative),params:Sd,apply:async(e,t,n)=>await _d({ijkMin:Ta.eB.create(-1,-1,-1),ijkMax:Ta.eB.create(1,1,1),theme:"operator-hkl"},e,t,n)}),Td=yd({id:"preset-trajectory-crystal-contacts",display:{name:"Crystal Contacts",group:"Preset",description:"Showsasymetric unit and chains from neighbours within 5 , i.e., symmetry mates."},isApplicable:e=>Or.Model.hasCrystalSymmetry(e.data.representative),params:(e,t)=>({model:Vr.t.Optional(Vr.t.Group($r.xE.getParamDefinition(Ar.f.Model.ModelFromTrajectory,e,t))),...vd(e,t)}),async apply(e,t,n){const r=n.builders.structure,i=await r.createModel(e,t.model),o=await r.insertModelProperties(i,t.modelProperties),a=await r.createStructure(o||i,{name:"symmetry-mates",params:{radius:5}}),s=await r.insertStructureProperties(a,t.structureProperties),l=await r.tryCreateUnitcell(o,void 0,{isHidden:!0}),c=t.representationPreset||n.config.get(go.PluginConfig.Structure.DefaultRepresentationPreset)||os.Bj.auto.id
return{model:i,modelProperties:o,unitcell:l,structure:a,structureProperties:s,representation:await n.builders.structure.representation.applyPreset(s,c,{theme:{globalName:"operator-name",carbonColor:"operator-name",focus:{name:"element-symbol",params:{carbonColor:{name:"operator-name",params:gd.PO.defaultValues}}}}})}}}),Ad={default:bd,"all-models":xd,unitcell:Cd,supercell:wd,crystalContacts:Td}
class Id{resolveProvider(e){var t
return"string"==typeof e?null!==(t=Ad[e])&&void 0!==t?t:(0,cd.L9)(this._providers,t=>t.id===e):e}hasPreset(e){for(const t of this._providers)if(!t.isApplicable||t.isApplicable(e,this.plugin))return!0
return!1}get providers(){return this._providers}getPresets(e){if(!e)return this.providers
const t=[]
for(const n of this._providers)n.isApplicable&&!n.isApplicable(e,this.plugin)||t.push(n)
return t}getPresetSelect(e){const t=[]
for(const n of this._providers)e&&n.isApplicable&&!n.isApplicable(e,this.plugin)||t.push([n.id,n.display.name])
return Vr.t.Select("auto",t)}getPresetsWithOptions(e){const t=[],n=Object.create(null)
for(const r of this._providers)r.isApplicable&&!r.isApplicable(e,this.plugin)||(t.push([r.id,r.display.name]),n[r.id]=r.params?Vr.t.Group(r.params(e,this.plugin)):Vr.t.EmptyGroup())
return 0===t.length?Vr.t.MappedStatic("",{"":Vr.t.EmptyGroup()}):Vr.t.MappedStatic(t[0][0],n,{options:t})}registerPreset(e){if(this.providerMap.has(e.id))throw new Error(`Hierarchy provider with id '${e.id}' already registered.`)
this._providers.push(e),this.providerMap.set(e.id,e)}unregisterPreset(e){this.providerMap.delete(e.id),(0,ao.mO)(this._providers,e)}applyPreset(e,t,n){const r=this.resolveProvider(t)
if(!r)return
const i=this.plugin.state.data,o=$r.so.resolveAndCheck(i,e)
if(!o)return void(ud.Zq||console.warn("Applying hierarchy preset provider to bad cell."))
const a=n||(r.params?Vr.t.getDefaultValues(r.params(o.obj,this.plugin)):{}),s=Fr.Task.create(`${r.display.name}`,()=>r.apply(o,a,this.plugin))
return this.plugin.runTask(s)}constructor(e){this.plugin=e,this._providers=[],this.providerMap=new Map,this.defaultProvider=Ad.default,(0,jr.IF)(Ad,e=>this.registerPreset(e))}}class Pd{get dataState(){return this.plugin.state.data}async parseTrajectoryData(e,t){const n="string"==typeof t?this.plugin.dataFormats.get(t):t
if(!n)throw new Error(`'${t}' is not a supported data format.`)
const{trajectory:r}=await n.parse(this.plugin,e)
return r}parseTrajectoryBlob(e,t){return this.dataState.build().to(e).apply(Ar.f.Data.ParseBlob,t,{state:{isGhost:!0}}).apply(Ar.f.Model.TrajectoryFromBlob,void 0).commit({revertOnError:!0})}parseTrajectory(e,t){const n=$r.so.resolveAndCheck(this.dataState,e)
if(!n)throw new Error("Invalid data cell.")
return gi.O.Data.Blob.is(n.obj)?this.parseTrajectoryBlob(e,t):this.parseTrajectoryData(e,t)}createModel(e,t,n){return this.dataState.build().to(e).apply(Ar.f.Model.ModelFromTrajectory,t||{modelIndex:0},{state:n}).commit({revertOnError:!0})}insertModelProperties(e,t,n){return this.dataState.build().to(e).apply(Ar.f.Model.CustomModelProperties,t,{state:n}).commit({revertOnError:!0})}tryCreateUnitcell(e,t,n){var r,i,o
const a=this.dataState,s=null===(i=null===(r=$r.so.resolveAndCheck(a,e))||void 0===r?void 0:r.obj)||void 0===i?void 0:i.data
if(!s)return
const l=null===(o=pd.i.Provider.get(s))||void 0===o?void 0:o.spacegroup.cell
return hd.O8.isZero(l)?void 0:a.build().to(e).apply(Ar.f.Representation.ModelUnitcell3D,t,{state:n}).commit({revertOnError:!0})}createStructure(e,t,n,r){var i
const o=this.dataState
if(!t){const n=$r.so.resolveAndCheck(o,e)
if(n){const e=pd.i.Provider.get(null===(i=n.obj)||void 0===i?void 0:i.data)
e&&0!==(null==e?void 0:e.assemblies.length)||(t={name:"model",params:{}})}}return o.build().to(e).apply(Ar.f.Model.StructureFromModel,{type:t||{name:"assembly",params:{}}},{state:n,tags:r}).commit({revertOnError:!0})}insertStructureProperties(e,t){return this.dataState.build().to(e).apply(Ar.f.Model.CustomStructureProperties,t).commit({revertOnError:!0})}isComponentTransform(e){return e.transform.transformer===Ar.f.Model.StructureComponent}async tryCreateComponent(e,t,n,r){var i,o
const a=this.dataState,s=`structure-component-${n}`,l=a.build().to(e).applyOrUpdateTagged(s,Ar.f.Model.StructureComponent,t,{tags:r?[...r,s]:[s]})
await l.commit()
const c=l.selector
if(c.isOk&&0!==(null===(o=null===(i=c.cell)||void 0===i?void 0:i.obj)||void 0===o?void 0:o.data.elementCount))return c
await a.build().delete(c.ref).commit()}tryCreateComponentFromExpression(e,t,n,r){return this.tryCreateComponent(e,{type:{name:"expression",params:t},nullIfEmpty:!0,label:((null==r?void 0:r.label)||"").trim()},n,null==r?void 0:r.tags)}tryCreateComponentStatic(e,t,n){return this.tryCreateComponent(e,{type:{name:"static",params:t},nullIfEmpty:!0,label:((null==n?void 0:n.label)||"").trim()},`static-${t}`,null==n?void 0:n.tags)}tryCreateComponentFromSelection(e,t,n,r){return this.plugin.runTask(Fr.Task.create("Query Component",async i=>{var o,a
let{label:s,tags:l}=r||{}
s=(s||"").trim()
const c=null===(a=null===(o=$r.so.resolveAndCheck(this.dataState,e))||void 0===o?void 0:o.obj)||void 0===a?void 0:a.data
if(!c)return
const u=t.referencesCurrent?{type:{name:"bundle",params:Or.StructureElement.Bundle.fromSelection(await t.getSelection(this.plugin,i,c))},nullIfEmpty:!0,label:s||t.label}:{type:{name:"expression",params:t.expression},nullIfEmpty:!0,label:s||t.label}
return t.ensureCustomProperties&&await t.ensureCustomProperties({runtime:i,assetManager:this.plugin.managers.asset,errorContext:this.plugin.errorContext},c),this.tryCreateComponent(e,u,n,l)}))}constructor(e){this.plugin=e,this.hierarchy=new Id(this.plugin),this.representation=new dd(this.plugin)}}var Bd,Ed,kd=n(85672),Dd=n(41736)
!function(e){e.create=function(e){const{name:t}=e
return{descriptor:e,get:e=>e._propertyData[t],set(n,r){n.customProperties.add(e),n._propertyData[t]=r}}}}(Bd||(Bd={})),function(e){e.Descriptor={name:"recommended_iso_value"},e.Provider=Bd.create(e.Descriptor)}(Ed||(Ed={}))
var Md=n(42231)
const Rd="Volume"
async function Od(e,t){if(!t)return
const{entryId:n}=t
return n&&n.toLowerCase().startsWith("emd")?e.runTask(Fr.Task.create("Try Set Recommended IsoValue",async r=>{try{const i=await(0,Md.$A)(e,r,n)
Ed.Provider.set(t,Jo.f.IsoValue.absolute(i))}catch(e){console.warn(e)}})):void 0}function Ld(e){const t=Ed.Provider.get(e)
if(t)return"relative"===t.kind?t:Jo.f.adjustedIsoValue(e,t.absoluteValue,"absolute")}async function Nd(e,t){const n={},r=t.volume.data&&Ld(t.volume.data)
r&&(n.isoValue=r)
const i=e.build().to(t.volume).apply(Ar.f.Representation.VolumeRepresentation3D,ea(e,t.volume.data,{type:"isosurface",typeParams:n}))
return[await i.commit()]}const Fd=(0,Dd.N)({label:"CCP4/MRC/MAP",description:"CCP4/MRC/MAP",category:Rd,binaryExtensions:["ccp4","mrc","map"],parse:async(e,t,n)=>{const r=e.build().to(t).apply(Ar.f.Data.ParseCcp4,{},{state:{isGhost:!0}}),i=r.apply(Ar.f.Volume.VolumeFromCcp4,{entryId:null==n?void 0:n.entryId})
return await r.commit({revertOnError:!0}),await Od(e,i.selector.data),{format:r.selector,volume:i.selector}},visuals:Nd}),zd=(0,Dd.N)({label:"DSN6/BRIX",description:"DSN6/BRIX",category:Rd,binaryExtensions:["dsn6","brix"],parse:async(e,t,n)=>{const r=e.build().to(t).apply(Ar.f.Data.ParseDsn6,{},{state:{isGhost:!0}}),i=r.apply(Ar.f.Volume.VolumeFromDsn6,{entryId:null==n?void 0:n.entryId})
return await r.commit({revertOnError:!0}),await Od(e,i.selector.data),{format:r.selector,volume:i.selector}},visuals:Nd}),jd=(0,Dd.N)({label:"DX",description:"DX",category:Rd,stringExtensions:["dx"],binaryExtensions:["dxbin"],parse:async(e,t,n)=>{const r=e.build().to(t).apply(Ar.f.Data.ParseDx,{},{state:{isGhost:!0}}).apply(Ar.f.Volume.VolumeFromDx,{entryId:null==n?void 0:n.entryId})
return await r.commit({revertOnError:!0}),await Od(e,r.selector.data),{volume:r.selector}},visuals:Nd}),Vd=(0,Dd.N)({label:"Cube",description:"Cube",category:Rd,stringExtensions:["cub","cube"],parse:async(e,t,n)=>{const r=e.build().to(t).apply(Ar.f.Data.ParseCube,{},{state:{isGhost:!0}}),i=r.apply(Ar.f.Volume.VolumeFromCube,{entryId:null==n?void 0:n.entryId}),o=r.apply(Ar.f.Model.TrajectoryFromCube,void 0,{state:{isGhost:!0}}).apply(Ar.f.Model.ModelFromTrajectory).apply(Ar.f.Model.StructureFromModel)
return await r.commit({revertOnError:!0}),await Od(e,i.selector.data),{format:r.selector,volume:i.selector,structure:o.selector}},visuals:async(e,t)=>{var n,r
const i=e.build(),o=[],a=null===(r=null===(n=t.volume.cell)||void 0===n?void 0:n.obj)||void 0===r?void 0:r.data
if(a&&Jo.f.isOrbitals(a)){const n=i.to(t.volume).apply(Ar.f.Representation.VolumeRepresentation3D,ea(e,a,{type:"isosurface",typeParams:{isoValue:Jo.f.IsoValue.relative(1),alpha:.4},color:"uniform",colorParams:{value:zr.ColorNames.blue}})),r=i.to(t.volume).apply(Ar.f.Representation.VolumeRepresentation3D,ea(e,a,{type:"isosurface",typeParams:{isoValue:Jo.f.IsoValue.relative(-1),alpha:.4},color:"uniform",colorParams:{value:zr.ColorNames.red}}))
o.push(n.selector,r.selector)}else{const n=i.to(t.volume).apply(Ar.f.Representation.VolumeRepresentation3D,ea(e,a,{type:"isosurface",typeParams:{isoValue:Jo.f.IsoValue.relative(2),alpha:.4},color:"uniform",colorParams:{value:zr.ColorNames.grey}}))
o.push(n.selector)}const s=await e.builders.structure.representation.applyPreset(t.structure,"auto")
await i.commit()
const l=[]
return(0,jr.IF)(null==s?void 0:s.representations,e=>{e&&l.push(e)}),[...o,...l]}}),Ud=(0,Dd.N)({label:"DensityServer CIF",description:"DensityServer CIF",category:Rd,stringExtensions:["cif"],binaryExtensions:["bcif"],isApplicable:(e,t)=>"dscif"===(0,Dd.v)(e,t),parse:async(e,t,n)=>{var r
const i=await e.build().to(t).apply(Ar.f.Data.ParseCif).commit(),o=e.build().to(i),a=i.obj.data.blocks
if(0===a.length)throw new Error("no data blocks")
const s=[]
let l=0
for(const c of a){if("SERVER"===c.header.toUpperCase())continue
const e=Array.isArray(null==n?void 0:n.entryId)?null==n?void 0:n.entryId[l]:null==n?void 0:n.entryId;(null===(r=c.categories.volume_data_3d_info)||void 0===r?void 0:r.rowCount)>0&&(s.push(o.apply(Ar.f.Volume.VolumeFromDensityServerCif,{blockHeader:c.header,entryId:e}).selector),l++)}await o.commit()
for(const c of s)await Od(e,c.data)
return{volumes:s}},visuals:async(e,t)=>{const{volumes:n}=t,r=e.build(),i=[]
if(n.length>0){const t=n[0].data&&Ld(n[0].data)||Jo.f.IsoValue.relative(1.5)
i[0]=r.to(n[0]).apply(Ar.f.Representation.VolumeRepresentation3D,qr.VolumeRepresentation3DHelpers.getDefaultParamsStatic(e,"isosurface",{isoValue:t,alpha:1},"uniform",{value:zr.ColorNames.teal})).selector}if(n.length>1){const t=qr.VolumeRepresentation3DHelpers.getDefaultParamsStatic(e,"isosurface",{isoValue:Jo.f.IsoValue.relative(3),alpha:.3},"uniform",{value:zr.ColorNames.green}),o=qr.VolumeRepresentation3DHelpers.getDefaultParamsStatic(e,"isosurface",{isoValue:Jo.f.IsoValue.relative(-3),alpha:.3},"uniform",{value:zr.ColorNames.red})
i[i.length]=r.to(n[1]).apply(Ar.f.Representation.VolumeRepresentation3D,t).selector,i[i.length]=r.to(n[1]).apply(Ar.f.Representation.VolumeRepresentation3D,o).selector}return await r.commit(),i}}),Gd=(0,Dd.N)({label:"Segmentation CIF",description:"Segmentation CIF",category:Rd,stringExtensions:["cif"],binaryExtensions:["bcif"],isApplicable:(e,t)=>"segcif"===(0,Dd.v)(e,t),parse:async(e,t)=>{var n
const r=await e.build().to(t).apply(Ar.f.Data.ParseCif).commit(),i=e.build().to(r),o=r.obj.data.blocks
if(0===o.length)throw new Error("no data blocks")
const a=[]
for(const s of o)"SERVER"!==s.header.toUpperCase()&&(null===(n=s.categories.volume_data_3d_info)||void 0===n?void 0:n.rowCount)>0&&a.push(i.apply(Ar.f.Volume.VolumeFromSegmentationCif,{blockHeader:s.header}).selector)
return await i.commit(),{volumes:a}},visuals:async(e,t)=>{const{volumes:n}=t,r=e.build(),i=[]
return n.length>0&&Jo.f.Segmentation.get(n[0].data)&&(i[i.length]=r.to(n[0]).apply(Ar.f.Representation.VolumeRepresentation3D,qr.VolumeRepresentation3DHelpers.getDefaultParams(e,"segment",n[0].data,{alpha:1,instanceGranularity:!0},"volume-segment",{})).selector),await r.commit(),i}}),Hd=[["ccp4",Fd],["dsn6",zd],["cube",Vd],["dx",jd],["dscif",Ud],["segcif",Gd]],qd=[["ply",(0,Dd.N)({label:"PLY",description:"PLY",category:"Shape",stringExtensions:["ply"],parse:async(e,t)=>{const n=e.state.data.build().to(t).apply(Ar.f.Data.ParsePly,{},{state:{isGhost:!0}}),r=n.apply(Ar.f.Model.ShapeFromPly)
return await n.commit(),{format:n.selector,shape:r.selector}},visuals:(e,t)=>e.state.data.build().to(t.shape).apply(Ar.f.Representation.ShapeRepresentation3D).commit()})]]
var Qd=n(51520),$d=n(42402)
class Xd{get types(){return this._list.map(e=>[e.name,e.provider.label])}get extensions(){if(this._extensions)return this._extensions
const e=new Set
return this._list.forEach(({provider:t})=>{var n,r
null===(n=t.stringExtensions)||void 0===n||n.forEach(t=>e.add(t)),null===(r=t.binaryExtensions)||void 0===r||r.forEach(t=>e.add(t))}),this._extensions=e,e}get binaryExtensions(){if(this._binaryExtensions)return this._binaryExtensions
const e=new Set
return this._list.forEach(({provider:t})=>{var n
return null===(n=t.binaryExtensions)||void 0===n?void 0:n.forEach(t=>e.add(t))}),this._binaryExtensions=e,e}get options(){if(this._options)return this._options
const e=[]
return this._list.forEach(({name:t,provider:n})=>e.push([t,n.label,n.category||""])),this._options=e,e}constructor(){this._list=[],this._map=new Map,this._extensions=void 0,this._binaryExtensions=void 0,this._options=void 0
for(const[e,t]of Hd)this.add(e,t)
for(const[e,t]of Qd.PO)this.add(e,t)
for(const[e,t]of $d.VE)this.add(e,t)
for(const[e,t]of qd)this.add(e,t)
for(const[e,t]of kd.HQ)this.add(e,t)}_clear(){this._extensions=void 0,this._binaryExtensions=void 0,this._options=void 0}add(e,t){this._clear(),this._list.push({name:e,provider:t}),this._map.set(e,t)}remove(e){this._clear(),this._list.splice(this._list.findIndex(t=>t.name===e),1),this._map.delete(e)}auto(e,t){var n,r
for(let i=0,o=this.list.length;i<o;++i){const o=this._list[i].provider
let a=!1
if(((null===(n=o.binaryExtensions)||void 0===n?void 0:n.includes(e.ext))||(null===(r=o.stringExtensions)||void 0===r?void 0:r.includes(e.ext)))&&(a=!0),a&&(!o.isApplicable||o.isApplicable(e,t.data)))return o}}get(e){if(this._map.has(e))return this._map.get(e)
throw new Error(`unknown data format name '${e}'`)}get list(){return this._list}}class Wd extends Ur.e{get isEmpty(){return 0===this._animations.length}get current(){return this._current}get animations(){return this._animations}get isAnimatingStateTransition(){return"built-in.animate-state-snapshot-transition"===this._current.anim.name}triggerUpdate(){this.events.updated.next(void 0)}triggerApply(){this.events.applied.next(void 0)}getParams(){return this._params||(this._params={current:Vr.t.Select(this._animations[0]&&this._animations[0].name,this._animations.map(e=>[e.name,e.display.name]),{label:"Animation"})}),this._params}updateParams(e){if(this.isEmpty)return
this.updateState({params:{...this.state.params,...e}})
const t=this.map.get(this.state.params.current),n=t.params(this.context)
this._current={anim:t,params:n,paramValues:Vr.t.getDefaultValues(n),state:{},startedTime:-1,lastTime:0},this.triggerUpdate()}updateCurrentParams(e){this.isEmpty||(this._current.paramValues={...this._current.paramValues,...e},this.triggerUpdate())}register(e){this.map.has(e.name)?this.context.log.error(`Animation '${e.name}' is already registered.`):(this._params=void 0,this.map.set(e.name,e),this._animations.push(e),1===this._animations.length?this.updateParams({current:e.name}):this.triggerUpdate())}async play(e,t){await this.stop(),this.map.has(e.name)||this.register(e),this.updateParams({current:e.name}),this.updateCurrentParams(t),await this.start()}async tick(e,t,n){this.currentTime=e,this.isStopped||(t||n?await this.applyFrame(n):this.applyAsync())}async start(){this.updateState({animationState:"playing"}),this.context.behaviors.state.isAnimating.value||this.context.behaviors.state.isAnimating.next(!0),this.triggerUpdate()
const e=this._current.anim
let t=this._current.anim.initialState(this._current.paramValues,this.context)
if(e.setup){const n=await e.setup(this._current.paramValues,t,this.context)
n&&(t=n)}this._current.lastTime=0,this._current.startedTime=-1,this._current.state=t,this.isStopped=!1}async stop(){if(this.isStopped=!0,"stopped"!==this.state.animationState){const e=this._current.anim
e.teardown&&await e.teardown(this._current.paramValues,this._current.state,this.context),this.updateState({animationState:"stopped"}),this.triggerUpdate()}this.context.behaviors.state.isAnimating.value&&this.context.behaviors.state.isAnimating.next(!1)}stopStateTransitionAnimation(){if(this.isAnimatingStateTransition)return this.stop()}get isAnimating(){return"playing"===this.state.animationState}async applyAsync(){if(!this.isApplying){this.isApplying=!0
try{await this.applyFrame()}finally{this.isApplying=!1}}}async applyFrame(e){const t=this.currentTime
this._current.startedTime<0&&(this._current.startedTime=t)
const n=await this._current.anim.apply(this._current.state,{lastApplied:this._current.lastTime,current:t-this._current.startedTime,animation:e},{params:this._current.paramValues,plugin:this.context})
"finished"===n.kind?this.stop():"next"===n.kind&&(this._current.state=n.state,this._current.lastTime=t-this._current.startedTime),this.triggerApply()}getSnapshot(){return this.current?{state:this.state,current:{paramValues:this._current.paramValues,state:this._current.anim.stateSerialization?this._current.anim.stateSerialization.toJSON(this._current.state):this._current.state}}:{state:this.state}}setSnapshot(e){this.isEmpty||(this.updateState({animationState:e.state.animationState}),this.updateParams(e.state.params),e.current&&(this.current.paramValues=e.current.paramValues,this.current.state=this._current.anim.stateSerialization?this._current.anim.stateSerialization.fromJSON(e.current.state):e.current.state,this.triggerUpdate(),"playing"===this.state.animationState&&this.resume()))}async resume(){this._current.lastTime=0,this._current.startedTime=-1
const e=this._current.anim
this.context.behaviors.state.isAnimating.value||this.context.behaviors.state.isAnimating.next(!0),e.setup&&await e.setup(this._current.paramValues,this._current.state,this.context),this.isStopped=!1}constructor(e){super({params:{current:""},animationState:"stopped"}),this.context=e,this.map=new Map,this._animations=[],this.currentTime=0,this._params=void 0,this.events={updated:this.ev(),applied:this.ev()},this.isStopped=!0,this.isApplying=!1}}var Yd=n(10314),Zd=n(76242),Kd=n(91763)
function Jd(e,t,n){const r=n[0],i=n[1],o=n[2],a=-r*t[0]-i*t[1]-o*t[2]
return(r*e[0]+i*e[1]+o*e[2]+a)/Math.sqrt(r*r+i*i+o*o)}const ep=(0,Ta.eB)()
function tp(e,t){const n=np([],e,t)
if(0!==n.length)return 1===n.length?n[0]:op(n)}function np(e,t,n){const r=t.state.data.cells.get(n),i=function(e,t){var n,r
const i=null==t?void 0:t.obj
if(i)if(i.data){if(i.data instanceof Or.Structure){const o=$r.QX.getDecorated(e.state.data,t.transform.ref),a=null!==(r=null===(n=null==o?void 0:o.obj)||void 0===n?void 0:n.data)&&void 0!==r?r:null==i?void 0:i.data,s=Xr.Loci.getBoundingSphere(Or.Structure.Loci(a))
return s?[s]:[]}if(gi.O.isRepresentation3D(i)){const e=[]
for(const t of i.data.repr.renderObjects){const n=t.values.boundingSphere.ref.value
n.radius>0&&e.push(n)}return e}}else console.warn("Focus: no data")}(t,r)
return i?e.push(...i):t.state.data.tree.children.get(n).forEach(n=>np(e,t,n)),e}function rp(e){const t=function(e){let t=Array.from(e.state.data.cells.values()).filter(e=>e.obj&&gi.O.isRepresentation3D(e.obj))
return t=t.filter(e=>!e.state.isHidden),t.flatMap(e=>e.obj.data.repr.renderObjects)}(e)
return op(t.map(e=>e.values.boundingSphere.ref.value).filter(e=>e.radius>0))}let ip
function op(e){null!=ip||(ip=new Yd.Z("98")),ip.reset()
for(const t of e)ip.includeSphere(t)
ip.finishedIncludeStep()
for(const t of e)ip.radiusSphere(t)
return ip.getSphere()}const ap={identity:Ta.U.create(1,0,0,0,1,0,0,0,1),rotX90:Ta.U.create(1,0,0,0,0,1,0,-1,0),rotY90:Ta.U.create(0,0,-1,0,1,0,1,0,0),rotZ90:Ta.U.create(0,1,0,-1,0,0,0,0,1),rotX270:Ta.U.create(1,0,0,0,0,-1,0,1,0),rotY270:Ta.U.create(0,0,1,0,1,0,-1,0,0),rotZ270:Ta.U.create(0,-1,0,1,0,0,0,0,1),rotX180:Ta.U.create(1,0,0,0,-1,0,0,0,-1),rotY180:Ta.U.create(-1,0,0,0,1,0,0,0,-1),rotZ180:Ta.U.create(-1,0,0,0,-1,0,0,0,1)}
function sp(e,t){const{onlyTrace:n,skipHydrogens:r,skipWater:i}=t,{x:o,y:a,z:s,type_symbol:l,label_comp_id:c}=Or.StructureProperties.atom,u=[]
for(const d of e){const e=Or.StructureElement.Location.create(d)
for(const t of d.units){e.unit=t
const d=n?t.polymerElements:t.elements
for(let t=0;t<d.length;t++)e.element=d[t],r&&"H"===l(e)||i&&"HOH"===c(e)||u.push(o(e),a(e),s(e))}}return u}function lp(e,t){const n=Math.floor(t/2)
return e<n?t%2?n-e:n-e-1:e-n}function cp(e,t){const n=Ta.U.invert((0,Ta.U)(),t),r=Ta.eB.distance(e.position,e.target),i=Ta.eB.transformMat3((0,Ta.eB)(),Ta.eB.create(0,0,r),n),o=Ta.eB.transformMat3((0,Ta.eB)(),Ta.eB.create(0,1,0),n),a=Ta.eB.add((0,Ta.eB)(),e.target,i)
return{...e,position:a,up:o}}const up={minRadius:1,extraRadius:4,durationMs:250}
class dp{transformedLoci(e){var t,n
if(Or.StructureElement.Loci.is(e)){const r=null===(n=null===(t=this.plugin.helpers.substructureParent.get(e.structure))||void 0===t?void 0:t.obj)||void 0===n?void 0:n.data
r&&(e=Or.StructureElement.Loci.remap(e,r))}return e}focusRenderObjects(e,t){if(!e)return
const n=[]
for(const r of e){const e=r.values.boundingSphere.ref.value
0!==e.radius&&n.push(e)}this.focusSpheres(n,e=>e,t)}focusLoci(e,t){let n
if(Array.isArray(e)&&e.length>1){const t=[]
for(const n of e){const e=Xr.Loci.getBoundingSphere(this.transformedLoci(n))
e&&t.push(e)}if(0===t.length)return
this.boundaryHelper.reset()
for(const e of t)this.boundaryHelper.includeSphere(e)
this.boundaryHelper.finishedIncludeStep()
for(const e of t)this.boundaryHelper.radiusSphere(e)
n=this.boundaryHelper.getSphere()}else if(Array.isArray(e)){if(0===e.length)return
n=Xr.Loci.getBoundingSphere(this.transformedLoci(e[0]))}else n=Xr.Loci.getBoundingSphere(this.transformedLoci(e))
n&&this.focusSphere(n,t)}focusSpheres(e,t,n){const r=[]
for(const i of e){const e=t(i)
e&&r.push(e)}if(0!==r.length){if(1===r.length)return this.focusSphere(r[0],n)
this.boundaryHelper.reset()
for(const e of r)this.boundaryHelper.includeSphere(e)
this.boundaryHelper.finishedIncludeStep()
for(const e of r)this.boundaryHelper.radiusSphere(e)
this.focusSphere(this.boundaryHelper.getSphere(),n)}}focusSphere(e,t){var n
const{canvas3d:r}=this.plugin
if(!r)return
const{extraRadius:i,minRadius:o,durationMs:a}={...up,...t},s=Math.max(e.radius+i,o)
if(null==t?void 0:t.principalAxes){const e=function(e,t,n){if(!e.canvas3d)return
const{origin:r,dirA:i,dirB:o,dirC:a}=n.principalAxes.boxAxes,s=Za.e.clone(i),l=Za.e.clone(a)
if(n.positionToFlip){const{aroundX:e,aroundY:t}=function(e,t,n,r){const i=Jd(e,t,r)
return{aroundX:Jd(e,t,n)<0,aroundY:i<0}}(n.positionToFlip,r,s,o)
e&&(Za.e.negate(l,l),Za.e.negate(s,s)),t&&Za.e.negate(l,l)}const c=Za.e.scale((0,Za.e)(),r,-100)
return Za.e.dot(c,s)<=0&&Za.e.negate(l,l),Za.e.dot(Za.e.unitY,l)<=0&&Za.e.negate(s,s),e.canvas3d.camera.getFocus(r,t,s,l,Kd.i.createDefaultSnapshot())}(this.plugin,s,t)
null===(n=this.plugin.canvas3d)||void 0===n||n.requestCameraReset({durationMs:a,snapshot:e})}else{const t=r.camera.getFocus(e.center,s)
r.requestCameraReset({durationMs:a,snapshot:t})}}focusObject(e){var t,n,r
if(!this.plugin.canvas3d)return
const i=function(e,t){var n,r
if(!e.canvas3d)return
const i=null===(n=t.targets)||void 0===n?void 0:n.map(t=>{var n,r,i
const o=void 0!==t.targetRef?tp(e,t.targetRef):rp(e)
if(!o)return
const a=null!==(n=t.radius)&&void 0!==n?n:o.radius*(null!==(r=t.radiusFactor)&&void 0!==r?r:1)+(null!==(i=t.extraRadius)&&void 0!==i?i:0)
return hd.f8.create(o.center,a)}).filter(e=>void 0!==e),o=i&&i.length>0?op(i):rp(e)
return function(e,t){var n,r
const i=t.center,o=Math.max(t.radius,.01),a=null!==(n=t.direction)&&void 0!==n?n:Ta.eB.sub((0,Ta.eB)(),e.target,e.position),s=Ta.eB.orthogonalize((0,Ta.eB)(),a,null!==(r=t.up)&&void 0!==r?r:e.up),l=e.getTargetDistance(o),c=Ta.eB.setMagnitude(ep,a,l)
return{target:i,position:Ta.eB.sub((0,Ta.eB)(),i,c),up:s,radius:o}}(e.canvas3d.camera,{center:o.center,radius:Math.max(o.radius,null!==(r=t.minRadius)&&void 0!==r?r:0),up:t.up,direction:t.direction})}(this.plugin,{...e,targets:null===(t=e.targets)||void 0===t?void 0:t.map(e=>{var t
return{...e,extraRadius:null!==(t=e.extraRadius)&&void 0!==t?t:up.extraRadius}}),minRadius:null!==(n=e.minRadius)&&void 0!==n?n:up.minRadius})
this.plugin.canvas3d.requestCameraReset({snapshot:i,durationMs:null!==(r=e.durationMs)&&void 0!==r?r:up.durationMs})}orientAxes(e,t){if(!this.plugin.canvas3d)return
e||(e=this.plugin.state.data.selectQ(e=>e.ofType(gi.O.Molecule.Structure)).filter(e=>e.obj&&!e.transform.transformer.definition.isDecorator&&!e.obj.data.parent).map(e=>{var t
return null===(t=e.obj)||void 0===t?void 0:t.data}).filter(e=>!!e))
const{rotation:n}=function(e){const t=function(e){let t
return t=sp(e,{onlyTrace:!0}),t.length>=9||(t=sp(e,{skipHydrogens:!0,skipWater:!0}),t.length>=9||(t=sp(e,{}))),t}(e)
return function(e){if(0===e.length)return console.warn("Skipping PCA, no atoms"),{rotation:ap.identity,origin:Ta.eB.zero()}
const t=Zd.c.calculateMomentsAxes(e),n=Zd.c.calculateNormalizedAxes(t),r=function(e,t,n){const r=(0,Ta.U)()
return Ta.U.setValue(r,0,0,e[0]),Ta.U.setValue(r,0,1,e[1]),Ta.U.setValue(r,0,2,e[2]),Ta.U.setValue(r,1,0,t[0]),Ta.U.setValue(r,1,1,t[1]),Ta.U.setValue(r,1,2,t[2]),Ta.U.setValue(r,2,0,n[0]),Ta.U.setValue(r,2,1,n[1]),Ta.U.setValue(r,2,2,n[2]),r}(n.dirA,n.dirB,n.dirC)
var i
i=r,Ta.U.determinant(i)<0&&(Ta.U.setValue(i,2,0,-Ta.U.getValue(i,2,0)),Ta.U.setValue(i,2,1,-Ta.U.getValue(i,2,1)),Ta.U.setValue(i,2,2,-Ta.U.getValue(i,2,2)))
const o=function(e,t,n){const r=Ta.eB.create(Ta.U.getValue(t,0,0),Ta.U.getValue(t,0,1),Ta.U.getValue(t,0,2)),i=Ta.eB.create(Ta.U.getValue(t,1,0),Ta.U.getValue(t,1,1),Ta.U.getValue(t,1,2)),o=Ta.eB.create(Ta.U.getValue(t,2,0),Ta.U.getValue(t,2,1),Ta.U.getValue(t,2,2)),a=Math.floor(e.length/3),s=(0,Ta.eB)()
let l=0,c=0,u=0
for(let h=0;h<a;h++)Ta.eB.fromArray(s,e,3*h),Ta.eB.sub(s,s,n),l+=h*Ta.eB.dot(s,r),c+=h*Ta.eB.dot(s,i),u+=lp(h,a)*Ta.eB.dot(s,o)
const d=u<0,p=d?l+c<0:l-c<0
return p&&d?ap.rotY180:d?ap.rotX180:p?ap.rotZ180:ap.identity}(e,r,t.origin)
return Ta.U.mul(r,o,r),{rotation:r,origin:n.origin}}(t)}(e),r=cp(this.plugin.canvas3d.camera.getSnapshot(),n)
this.setSnapshot(r,t)}resetAxes(e){if(!this.plugin.canvas3d)return
const t=cp(this.plugin.canvas3d.camera.getSnapshot(),Ta.U.Identity)
this.setSnapshot(t,e)}setSnapshot(e,t){var n
null===(n=this.plugin.canvas3d)||void 0===n||n.requestCameraReset({snapshot:e,durationMs:t})}reset(e,t){var n
null===(n=this.plugin.canvas3d)||void 0===n||n.requestCameraReset({snapshot:e,durationMs:t})}constructor(e){this.plugin=e,this.boundaryHelper=new Yd.Z("98")}}class pp{clearProviders(){this.providers=[],this.isDirty=!0,this.showLabels()}addProvider(e){this.providers.push(e),this.providers.sort((e,t)=>(t.priority||0)-(e.priority||0)),this.isDirty=!0,this.showLabels()}removeProvider(e){this.providers=this.providers.filter(t=>t!==e),this.isDirty=!0,this.showLabels()}mark(e,t){const n=this.locis.findIndex(t=>vo.YL.Loci.areEqual(e,t));-1===n&&t===bo.xi.Highlight?(this.locis.push(e),this.isDirty=!0):-1!==n&&t===bo.xi.RemoveHighlight&&((0,ao.P6)(this.locis,n),this.isDirty=!0)}showLabels(){this.ctx.behaviors.labels.highlight.next({labels:this.getLabels()})}getLabels(){if(this.isDirty){this.groupedLabels.clear(),this.labels.length=0
for(const e of this.providers)for(const t of this.locis){if(Xr.Loci.isEmpty(t.loci))continue
const n=e.label(t.loci,t.repr)
if(n){const t=e.group?e.group(n):n.toString(),r=this.groupedLabels.get(t)
r?r.push(n):this.groupedLabels.set(t,[n])}}this.labels.length=0,this.groupedLabels.forEach((e,t)=>{const n=e.length,r=n>1&&e[0]!==e[1]?t:e[0]
this.labels.push(1===n?r:`${r} <small>||  ${n}</small>`)}),this.isDirty=!1}return this.labels}constructor(e){this.ctx=e,this.providers=[],this.locis=[],this.isDirty=!1,this.labels=[],this.groupedLabels=new Map,e.managers.interactivity.lociHighlights.addProvider((e,t,n)=>{0!==this.providers.length&&(this.mark(e,t),n||this.showLabels())})}}var hp=n(95207)
const fp=new Yd.Z("98")
class mp extends Ur.e{get entries(){return this.state.entries}get additionsHistory(){return this.state.additionsHistory}get stats(){return this.state.stats||(this.state.stats=this.calcStats()),this.state.stats}getEntry(e){const t=this.plugin.helpers.substructureParent.get(e,!0)
if(!t)return
const n=t.transform.ref
if(!this.entries.has(n)){const t=new gp(Or.StructureElement.Loci(e,[]))
return this.entries.set(n,t),t}return this.entries.get(n)}calcStats(){let e=0,t=0
const n=Or.StructureElement.Stats.create()
this.entries.forEach(r=>{const{elements:i}=r.selection
if(i.length){e+=1
for(let e=0,n=i.length;e<n;++e)t+=Xo.CD.size(i[e].indices)
Or.StructureElement.Stats.add(n,n,Or.StructureElement.Stats.ofLoci(r.selection))}})
const r=(0,yo.d_)(n,{countsOnly:!0})
return{structureCount:e,elementCount:t,label:r}}add(e){if(!Or.StructureElement.Loci.is(e))return!1
const t=this.getEntry(e.structure)
if(!t)return!1
const n=t.selection
return t.selection=Or.StructureElement.Loci.union(t.selection,e),this.tryAddHistory(e),this.referenceLoci=e,this.events.loci.add.next(e),!Or.StructureElement.Loci.areEqual(n,t.selection)}remove(e){if(!Or.StructureElement.Loci.is(e))return!1
const t=this.getEntry(e.structure)
if(!t)return!1
const n=t.selection
return t.selection=Or.StructureElement.Loci.subtract(t.selection,e),this.referenceLoci=e,this.events.loci.remove.next(e),!Or.StructureElement.Loci.areEqual(n,t.selection)}intersect(e){if(!Or.StructureElement.Loci.is(e))return!1
const t=this.getEntry(e.structure)
if(!t)return!1
const n=t.selection
return t.selection=Or.StructureElement.Loci.intersect(t.selection,e),this.referenceLoci=e,!Or.StructureElement.Loci.areEqual(n,t.selection)}set(e){if(!Or.StructureElement.Loci.is(e))return!1
const t=this.getEntry(e.structure)
if(!t)return!1
const n=t.selection
return t.selection=e,this.tryAddHistory(e),this.referenceLoci=void 0,!Or.StructureElement.Loci.areEqual(n,t.selection)}modifyHistory(e,t,n,r=!1){const i=this.additionsHistory,o=i.indexOf(e)
if(o<0)return
let a
switch(t){case"remove":(0,ao.P6)(i,o)
break
case"up":a=o-1
break
case"down":a=o+1}if(void 0!==a){const e=n?Math.min(i.length,n):i.length
for(;;){if(a%=e,a<0&&(a+=e),!r||i[o].loci.structure===i[a].loci.structure){const e=i[o]
i[o]=i[a],i[a]=e
break}a+="up"===t?-1:1}}this.events.additionsHistoryUpdated.next(void 0)}tryAddHistory(e){if(Xr.Loci.isEmpty(e))return
let t,n=0
for(const o of this.additionsHistory){if(Xr.Loci.areEqual(o.loci,e)){t=o
break}n++}if(t)return(0,ao.P6)(this.additionsHistory,n),this.additionsHistory.unshift(t),void this.events.additionsHistoryUpdated.next(void 0)
const r=Or.StructureElement.Stats.ofLoci(e),i=(0,yo.d_)(r,{reverse:!0})
this.additionsHistory.unshift({id:s.kk.create22(),loci:e,label:i}),this.additionsHistory.length>24&&this.additionsHistory.pop(),this.events.additionsHistoryUpdated.next(void 0)}clearHistory(){0!==this.state.additionsHistory.length&&(this.state.additionsHistory=[],this.events.additionsHistoryUpdated.next(void 0))}clearHistoryForStructure(e){const t=[]
for(const n of this.state.additionsHistory)n.loci.structure.root===e.root&&t.push(n)
for(const n of t)this.modifyHistory(n,"remove")
0!==t.length&&this.events.additionsHistoryUpdated.next(void 0)}onRemove(e,t){var n
this.entries.has(e)&&(this.entries.delete(e),(null==t?void 0:t.data)&&this.clearHistoryForStructure(t.data),(null===(n=this.referenceLoci)||void 0===n?void 0:n.structure)===(null==t?void 0:t.data)&&(this.referenceLoci=void 0),this.state.stats=void 0,this.events.changed.next(void 0))}onUpdate(e,t,n){var r,i,o,a
if(t===n||(null==t?void 0:t.data)===n.data)return
const s=this.plugin.helpers.substructureParent.get(n.data,!0)
if(!s)return
if(e!==s.transform.ref)return
if(!this.entries.has(e))return
const l=null===(i=null===(r=this.plugin.helpers.substructureParent.get(n.data))||void 0===r?void 0:r.obj)||void 0===i?void 0:i.data
var c,u
if(l)if(!(null==t?void 0:t.data)||Or.Structure.areUnitIdsAndIndicesEqual(t.data,n.data)){this.entries.set(e,(c=this.entries.get(e),u=l,new gp(Or.StructureElement.Loci.remap(c.selection,u)))),(null===(o=this.referenceLoci)||void 0===o?void 0:o.structure.root)===l.root&&(this.referenceLoci=Or.StructureElement.Loci.remap(this.referenceLoci,l))
let t=!1
for(const e of this.state.additionsHistory)e.loci.structure.root===l.root&&(e.loci=Or.StructureElement.Loci.remap(e.loci,l),t=!0)
t&&this.events.additionsHistoryUpdated.next(void 0)}else this.entries.set(e,new gp(Or.StructureElement.Loci(l,[]))),(null===(a=this.referenceLoci)||void 0===a?void 0:a.structure.root)===l.root&&(this.referenceLoci=void 0),this.clearHistoryForStructure(l),this.state.stats=void 0,this.events.changed.next(void 0)}clear(){const e=this.entries.keys(),t=[]
for(;;){const n=e.next()
if(n.done)break
const r=this.entries.get(n.value)
Or.StructureElement.Loci.isEmpty(r.selection)||t.push(r.selection),r.selection=Or.StructureElement.Loci(r.selection.structure,[])}return this.referenceLoci=void 0,this.state.stats=void 0,this.events.changed.next(void 0),this.events.loci.clear.next(void 0),this.clearHistory(),t}getLoci(e){const t=this.getEntry(e)
return t?t.selection:Xr.EmptyLoci}getStructure(e){const t=this.getEntry(e)
if(t)return t.structure}structureHasSelection(e){var t,n
const r=null===(n=null===(t=e.cell)||void 0===t?void 0:t.obj)||void 0===n?void 0:n.data
if(!r)return!1
const i=this.getEntry(r)
return!!i&&!Or.StructureElement.Loci.isEmpty(i.selection)}has(e){if(Or.StructureElement.Loci.is(e)){const t=this.getEntry(e.structure)
if(t)return Or.StructureElement.Loci.isSubset(t.selection,e)}return!1}tryGetRange(e){if(Or.StructureElement.Loci.is(e)&&this.getEntry(e.structure))return yp(this.referenceLoci,e)}elementCount(){let e=0
return this.entries.forEach(t=>{e+=Or.StructureElement.Loci.size(t.selection)}),e}getBoundary(){const e=Ta.eB.create(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t=Ta.eB.create(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)
fp.reset()
const n=[]
this.entries.forEach(e=>{const t=e.selection
Or.StructureElement.Loci.isEmpty(t)||n.push(Or.StructureElement.Loci.getBoundary(t))})
for(let r=0,i=n.length;r<i;++r){const{box:i,sphere:o}=n[r]
Ta.eB.min(e,e,i.min),Ta.eB.max(t,t,i.max),fp.includePositionRadius(o.center,o.radius)}fp.finishedIncludeStep()
for(let r=0,i=n.length;r<i;++r){const{sphere:e}=n[r]
fp.radiusPositionRadius(e.center,e.radius)}return{box:{min:e,max:t},sphere:fp.getSphere()}}getPrincipalAxes(){const e=(0,cd.ZR)(this.entries.values())
return Or.StructureElement.Loci.getPrincipalAxesMany(e.map(e=>e.selection))}modify(e,t){let n=!1
switch(e){case"add":n=this.add(t)
break
case"remove":n=this.remove(t)
break
case"intersect":n=this.intersect(t)
break
case"set":n=this.set(t)}n&&(this.state.stats=void 0,this.events.changed.next(void 0))}get applicableStructures(){return this.plugin.managers.structure.hierarchy.selection.structures.filter(e=>!!e.cell.obj).map(e=>e.cell.obj.data)}triggerInteraction(e,t,n=!0){switch(e){case"add":this.plugin.managers.interactivity.lociSelects.select({loci:t},n)
break
case"remove":this.plugin.managers.interactivity.lociSelects.deselect({loci:t},n)
break
case"intersect":this.plugin.managers.interactivity.lociSelects.selectJoin({loci:t},n)
break
case"set":this.plugin.managers.interactivity.lociSelects.selectOnly({loci:t},n)}}fromLoci(e,t,n=!0){this.triggerInteraction(e,t,n)}fromCompiledQuery(e,t,n=!0){for(const r of this.applicableStructures){const i=t(new Or.QueryContext(r))
this.triggerInteraction(e,Or.StructureSelection.toLociWithSourceUnits(i),n)}}fromSelectionQuery(e,t,n=!0){this.plugin.runTask(Fr.Task.create("Structure Selection",async r=>{for(const i of this.applicableStructures){const o=await t.getSelection(this.plugin,r,i)
this.triggerInteraction(e,Or.StructureSelection.toLociWithSourceUnits(o),n)}}))}fromSelections(e){var t
const n=$r.so.resolveAndCheck(this.plugin.state.data,e)
if(n&&n.obj)if(gi.O.Molecule.Structure.Selections.is(n.obj)){this.clear()
for(const e of null===(t=n.obj)||void 0===t?void 0:t.data)this.fromLoci("set",e.loci)}else console.warn("fromSelections applied to wrong object type.",n.obj)}getSnapshot(){const e=[]
return this.entries.forEach((t,n)=>{e.push({ref:n,bundle:Or.StructureElement.Bundle.fromLoci(t.selection)})}),{entries:e}}setSnapshot(e){var t,n
this.entries.clear()
for(const{ref:r,bundle:i}of e.entries){const e=null===(n=null===(t=this.plugin.state.data.select($r.QX.Generators.byRef(r))[0])||void 0===t?void 0:t.obj)||void 0===n?void 0:n.data
if(!e)continue
const o=Or.StructureElement.Bundle.toLoci(i,e)
this.fromLoci("set",o,!1)}}constructor(e){super({entries:new Map,additionsHistory:[],stats:{structureCount:0,elementCount:0,label:"Nothing Selected"}}),this.plugin=e,this.events={changed:this.ev(),additionsHistoryUpdated:this.ev(),loci:{add:this.ev(),remove:this.ev(),clear:this.ev()}},e.helpers.substructureParent.events.removed.subscribe(e=>this.onRemove(e.ref,e.obj)),e.helpers.substructureParent.events.updated.subscribe(e=>this.onUpdate(e.ref,e.oldObj,e.obj))}}class gp{get selection(){return this._selection}set selection(e){this._selection=e,this._structure=void 0}get structure(){return this._structure||(Xr.Loci.isEmpty(this._selection)?this._structure=void 0:this._structure=Or.StructureElement.Loci.toStructure(this._selection)),this._structure}constructor(e){this._structure=void 0,this._selection=e}}function yp(e,t){if(!Or.StructureElement.Loci.is(e))return
if(!Or.StructureElement.Loci.is(t))return
if(e.structure!==t.structure)return
if(1!==t.elements.length)return
const n=t.elements[0]
if(!n)return
let r
for(const i of e.elements)if(n.unit===i.unit){r=i
break}return r&&n.unit===r.unit?function(e,t,n){const r=Math.min(Xo.CD.min(t.indices),Xo.CD.min(n.indices)),i=Math.max(Xo.CD.max(t.indices),Xo.CD.max(n.indices))
return Or.StructureElement.Loci(e,[{unit:t.unit,indices:Xo.CD.ofRange(r,i)}])}(t.structure,r,n):void 0}class vp extends Ur.e{get current(){return this.state.current}get history(){return this.state.history}tryAddHistory(e){if(Or.StructureElement.Loci.isEmpty(e.loci))return
let t,n=0
for(const r of this.state.history){if(Or.StructureElement.Loci.areEqual(r.loci,e.loci)){t=r
break}n++}if(t)return(0,ao.P6)(this.state.history,n),this.state.history.unshift(e),void this.events.historyUpdated.next(void 0)
this.state.history.unshift(e),this.state.history.length>8&&this.state.history.pop(),this.events.historyUpdated.next(void 0)}set(e){this.tryAddHistory(e),this.state.current&&Or.StructureElement.Loci.areEqual(this.state.current.loci,e.loci)||(this.state.current=e,this.behaviors.current.next(e))}tryGetRange(e){return yp(this.referenceLoci,e)}setFromLoci(e){const t=Xr.Loci.normalize(e)
Or.StructureElement.Loci.is(t)&&!Or.StructureElement.Loci.isEmpty(t)?(this.set({loci:t,label:(0,yo.YQ)(t,{reverse:!0,hidePrefix:!0,htmlStyling:!1})}),this.referenceLoci=t):this.clear()}addFromLoci(e){const t=this.state.current&&Or.StructureElement.Loci.is(e)&&e.structure===this.state.current.loci.structure?Or.StructureElement.Loci.union(e,this.state.current.loci):e
this.setFromLoci(t)
const n=Xr.Loci.normalize(e)
this.referenceLoci=Or.StructureElement.Loci.is(n)?n:void 0}toggleFromLoci(e){var t
const{kind:n,loci:r}=(o=e,(i=null===(t=this.state.current)||void 0===t?void 0:t.loci)&&Or.StructureElement.Loci.is(o)&&o.structure===i.structure?Or.StructureElement.Loci.isSubset(i,o)?{kind:"subtract",loci:Or.StructureElement.Loci.subtract(i,o)}:{kind:"add",loci:Or.StructureElement.Loci.union(o,i)}:{kind:"new",loci:o})
var i,o
this.setFromLoci(r)
const a=Xr.Loci.normalize(e)
this.referenceLoci=Or.StructureElement.Loci.is(a)&&"subtract"!==n?a:void 0}extendFromLoci(e){var t
const n=null!==(t=this.tryGetRange(e))&&void 0!==t?t:e
this.toggleFromLoci(n)}clear(){this.state.current&&(this.state.current=void 0,this.behaviors.current.next(void 0)),this.referenceLoci=void 0}getSnapshot(){if(!this.current)return{}
const e=this.plugin.helpers.substructureParent.get(this.current.loci.structure),t=null==e?void 0:e.transform.ref
return t?{current:{label:this.current.label,ref:t,bundle:Or.StructureElement.Bundle.fromLoci(this.current.loci),category:this.current.category}}:{}}setSnapshot(e){var t,n
if(!e.current)return void this.clear()
const{label:r,ref:i,bundle:o,category:a}=e.current,s=null===(n=null===(t=this.plugin.state.data.select($r.QX.Generators.byRef(i))[0])||void 0===t?void 0:t.obj)||void 0===n?void 0:n.data
if(!s)return
const l=Or.StructureElement.Bundle.toLoci(o,s)
this.set({label:r,loci:l,category:a})}constructor(e){super({history:[]}),this.plugin=e,this.events={historyUpdated:this.ev()},this.behaviors={current:this.ev.behavior(void 0)},e.state.data.events.object.removed.subscribe(({obj:e})=>{var t
if(!gi.O.Molecule.Structure.is(e))return;(null===(t=this.current)||void 0===t?void 0:t.loci.structure)===e.data&&this.clear()
const n=[]
for(const r of this.history)r.loci.structure===e.data&&n.push(r)
n.length!==this.history.length&&(this.history.length=0,this.history.push(...n),this.events.historyUpdated.next(void 0))})
const t=(0,hd.f8)()
e.state.data.events.object.updated.subscribe(({oldData:e,obj:n,action:r})=>{var i
if(gi.O.Molecule.Structure.is(n)&&e!==n.data&&"in-place"===r){const r=this.state.current,o=n.data
if(r&&r.loci.structure===e){const e=Or.StructureElement.Loci.remap(r.loci,o)
this.state.current={...r,loci:e},this.behaviors.current.next(this.state.current),Xr.Loci.getBoundingSphere(e,t)
const n=null===(i=this.plugin.canvas3d)||void 0===i?void 0:i.camera,a=n.getTargetDistance(t.radius+4);(Ta.eB.distance(n.target,t.center)>t.radius||a>n.viewport.height/n.zoom)&&this.plugin.managers.camera.focusSphere(t,{durationMs:0})}}})}}var bp=n(7928)
const xp=[{name:"center-camera",execute:({event:e,args:t,manager:n})=>{"click"===e&&"center-camera"in t&&n.plugin.managers.camera.reset()}},{name:"apply-snapshot",execute:({event:e,args:t,manager:n})=>{if("click"!==e)return
const r=t["apply-snapshot"]
r&&n.plugin.managers.snapshot.applyKey(r)}},{name:"next-snapshot",execute:({event:e,args:t,manager:n})=>{if("click"!==e||!("next-snapshot"in t))return
let r=+t["next-snapshot"]||1
r&&(r=r<0?-1:1,n.plugin.managers.snapshot.applyNext(r))}},{name:"focus-refs",execute:({event:e,args:t,manager:n})=>{if("click"!==e)return
const r=_p(t["focus-refs"])
if(!(null==r?void 0:r.length))return
const i=n.findCells(r)
if(!i.length)return
const o=Cp(n.plugin,i)
if(!o.length)return
const a=o.map(e=>tp(n.plugin,e.transform.ref)).filter(e=>!!e)
a.length&&n.plugin.managers.camera.focusSpheres(a,e=>e,{extraRadius:3})}},{name:"highlight-refs",execute:({event:e,args:t,manager:n})=>{var r
const i=_p(t["highlight-refs"])
if(null==i?void 0:i.length)if("mouse-leave"===e&&i.length)n.plugin.managers.interactivity.lociHighlights.clearHighlights()
else if("mouse-enter"===e){const e=n.findCells(i)
for(const t of Cp(n.plugin,e)){if(!(null===(r=t.obj)||void 0===r?void 0:r.data))continue
const{repr:e}=t.obj.data
for(const t of e.getAllLoci())n.plugin.managers.interactivity.lociHighlights.highlight({loci:t,repr:e},!1)}}}},{name:"query",execute:({event:e,args:t,manager:n})=>{var r
const i=t.query
if(!(null==i?void 0:i.length))return
const o=t.lang||"mol-script",a=_p(t.action||"highlight"),s=parseFloat(t["focus-radius"]||"3")
if("mouse-leave"===e)return void(a.includes("highlight")&&n.plugin.managers.interactivity.lociHighlights.clearHighlights())
let l
try{l=bp.Script.toQuery({language:o,expression:i})}catch(e){return void console.warn(`Failed to parse query '${i}' (${o})`,e)}const c=n.plugin.state.data.selectQ(e=>e.rootsOfType(gi.O.Molecule.Structure))
if("mouse-enter"===e){if(!a.includes("focus"))return
n.plugin.managers.interactivity.lociHighlights.clearHighlights()
for(const e of c){if(!(null===(r=e.obj)||void 0===r?void 0:r.data))continue
const t=l(new Or.QueryContext(e.obj.data)),i=Or.StructureSelection.toLociWithSourceUnits(t)
n.plugin.managers.interactivity.lociHighlights.highlight({loci:i},!1)}}if("click"===e){if(!a.includes("focus"))return
const e=c.map(e=>$r.QX.getDecorated(n.plugin.state.data,e.transform.ref)).map(e=>{var t
if(!(null===(t=e.obj)||void 0===t?void 0:t.data))return
const n=l(new Or.QueryContext(e.obj.data))
if(Or.StructureSelection.isEmpty(n))return
const r=Or.StructureSelection.toLociWithSourceUnits(n)
return Or.StructureElement.Loci.getBoundary(r).sphere}).filter(e=>!!e)
e.length&&n.plugin.managers.camera.focusSpheres(e,e=>e,{extraRadius:s})}}},{name:"play-audio",execute:({event:e,args:t,manager:n})=>{if("click"!==e)return
const r=t["play-audio"];(null==r?void 0:r.length)&&n.audio.play(r)}},{name:"toggle-audio",execute:({event:e,args:t,manager:n})=>{if("click"!==e||!("toggle-audio"in t))return
const r=t["toggle-audio"]
n.audio.play(r,{toggle:!0})}},{name:"pause-audio",execute:({event:e,args:t,manager:n})=>{"click"===e&&"pause-audio"in t&&n.audio.pause()}},{name:"stop-audio",execute:({event:e,args:t,manager:n})=>{"click"===e&&"stop-audio"in t&&n.audio.stop()}},{name:"dispose-audio",execute:({event:e,args:t,manager:n})=>{"click"===e&&"dispose-audio"in t&&n.audio.dispose()}},{name:"play-transition",execute:({event:e,args:t,manager:n})=>{"click"===e&&"play-transition"in t&&n.plugin.managers.animation.play(fc.c,{})}},{name:"play-snapshots",execute:({event:e,args:t,manager:n})=>{"click"===e&&"play-snapshots"in t&&n.plugin.managers.snapshot.play({restart:!0})}},{name:"stop-animation",execute:({event:e,args:t,manager:n})=>{"click"===e&&"stop-animation"in t&&n.plugin.managers.snapshot.stop()}}]
class Sp{registerArgsParser(e,t,n){this.removeArgsParser(e),this.argsParsers.push([e,t,n]),this.argsParsers.sort((e,t)=>t[1]-e[1])}removeArgsParser(e){const t=this.argsParsers.findIndex(t=>t[0]===e)
t>=0&&this.argsParsers.splice(t,1)}parseArgs(e){for(const[,,t]of this.argsParsers){const n=t(e)
if(n)return n}}registerRefResolver(e,t){this.refResolvers[e]=t}removeRefResolver(e){delete this.refResolvers[e]}registerUriResolver(e,t){this.uriResolvers[e]=t}removeUriResolver(e){delete this.uriResolvers[e]}registerExtension(e){const t=this.extension.findIndex(t=>t.name===e.name)
t>=0?this.extension[t]=e:this.extension.push(e)}removeExtension(e){const t=this.extension.findIndex(t=>t.name===e)
t>=0&&this.extension.splice(t,1)}_tryRender(e,t){var n
try{return null===(n=e.reactRenderFn)||void 0===n?void 0:n.call(e,t)}catch(t){return console.error(`Failed to render markdown extension '${e.name}'`,t),null}}tryRender(e,t){const n={args:e,manager:this}
for(const r of this.extension){const e=this._tryRender(r,n)
if(e)return e}for(const r of t){const e=this._tryRender(r,n)
if(e)return e}return null}tryExecute(e,t){var n
const r={event:e,args:t,manager:this}
for(const i of this.extension)try{null===(n=i.execute)||void 0===n||n.call(i,r)}catch(t){console.error(`Failed to execute markdown extension '${i.name}'`,t)}}tryResolveUri(e){for(const t of Object.values(this.uriResolvers)){const n=t(this.plugin,e)
if(n)return n}}findCells(e){const t=new Set,n=[]
for(const r of Object.values(this.refResolvers))for(const i of r(this.plugin,e))i&&!t.has(i.transform.ref)&&(t.add(i.transform.ref),n.push(i))
return n}resolveAudioPlayer(){if(this.state.audioPlayer.value)return this.state.audioPlayer.value
const e=document.createElement("audio")
return e.controls=!0,e.preload="auto",e.style.width="100%",e.style.height="32px",this.state.audioPlayer.next(e),e}get audioPlayer(){return this.state.audioPlayer.value}constructor(e){this.plugin=e,this.state={audioPlayer:new qi.t(null)},this.extension=[],this.refResolvers={default:(e,t)=>t.map(t=>e.state.data.cells.get(t)).filter(e=>!!e)},this.uriResolvers={},this.argsParsers=[["default",100,wp]],this.audio={play:async(e,t)=>{try{const n=this.resolveAudioPlayer()
let r=!1
if(null==e?void 0:e.trim()){const t=this.tryResolveUri(e)
let i=e
"function"==typeof(null==t?void 0:t.then)?i=await t:t&&(i=t),r=n.src!==i,r&&(n.src=i,n.load())}!r&&(null==t?void 0:t.toggle)?n.paused?await n.play():n.pause():(n.currentTime=0,await n.play())}catch(e){console.error("Failed to play audio",e)}},pause:()=>{var e
null===(e=this.audioPlayer)||void 0===e||e.pause()},stop:()=>{this.audioPlayer&&(this.audioPlayer.pause(),this.audioPlayer.currentTime=0)},dispose:()=>{this.audioPlayer&&(this.audioPlayer.pause(),this.audioPlayer.currentTime=0,this.state.audioPlayer.next(null))}}
for(const t of xp)this.registerExtension(t)}}function _p(e){var t
return null!==(t=null==e?void 0:e.split(",").map(e=>e.trim()).filter(e=>e.length>0))&&void 0!==t?t:[]}function Cp(e,t){return t.length?e.state.data.selectQ(e=>e.byValue(...t).subtree().filter(e=>gi.O.isRepresentation3D(e.obj))):[]}function wp(e){if(!(null==e?void 0:e.startsWith("!")))return
const t=decodeURIComponent(e.substring(1)).split("&").map(e=>e.trim()).filter(e=>e.length>0).map(e=>e.split("=",2).map(e=>e.trim()))
return 0!==t.length?Object.fromEntries(t):void 0}const Tp=[["full","Full"],["hidden","Hidden"]],Ap={isExpanded:Vr.t.Boolean(!1),showControls:Vr.t.Boolean(!0),regionState:Vr.t.Group({left:Vr.t.Select("full",[["full","Full"],["collapsed","Collapsed"],["hidden","Hidden"]]),top:Vr.t.Select("full",Tp),right:Vr.t.Select("full",Tp),bottom:Vr.t.Select("full",Tp)}),controlsDisplay:Vr.t.Value("outside",{isHidden:!0}),expandToFullscreen:Vr.t.Boolean(!1)}
class Ip extends Ur.e{updateProps(e){const t=!!this.state.isExpanded
if(this.updateState(e),this.root&&"boolean"==typeof e.isExpanded&&e.isExpanded!==t&&this.handleExpand(),this.state.expandToFullscreen){const e=document.getElementsByTagName("body")[0]
e&&this.tryRequestFullscreen(e)}else document.fullscreenElement&&this.tryExitFullscreen()
this.events.updated.next(void 0)}setProps(e){this.updateState(e)}setRoot(e){this.root=e,this.state.isExpanded&&this.handleExpand()}getScrollElement(){return document.scrollingElement?document.scrollingElement:document.documentElement?document.documentElement:document.body}async tryRequestFullscreen(e){if(!document.fullscreenElement)try{await e.requestFullscreen()}catch(e){console.error(e)}}async tryExitFullscreen(){if(document.fullscreenElement)try{await document.exitFullscreen()}catch(e){console.error(e)}}handleExpand(){try{const e=document.getElementsByTagName("body")[0],t=document.getElementsByTagName("head")[0]
if(!e||!t||!this.root)return
if(this.state.isExpanded){const n=t.children,r=[]
let i=!1
for(let e=0;e<n.length;e++)n[e]===this.expandedViewport?i=!0:"viewport"===(n[e].name||"").toLowerCase()&&r.push(n[e])
for(const e of r)t.removeChild(e)
i||t.appendChild(this.expandedViewport)
const o=e.style,a=this.getScrollElement(),s=a.scrollLeft,l=a.scrollTop
this.rootState={top:o.top,bottom:o.bottom,right:o.right,left:o.left,scrollTop:l,scrollLeft:s,position:o.position,overflow:o.overflow,viewports:r,zIndex:this.root.style.zIndex,width:o.width,height:o.height,maxWidth:o.maxWidth,maxHeight:o.maxHeight,margin:o.margin,marginLeft:o.marginLeft,marginRight:o.marginRight,marginTop:o.marginTop,marginBottom:o.marginBottom},o.overflow="hidden",o.position="fixed",o.top="0",o.bottom="0",o.right="0",o.left="0",o.width="100%",o.height="100%",o.maxWidth="100%",o.maxHeight="100%",o.margin="0",o.marginLeft="0",o.marginRight="0",o.marginTop="0",o.marginBottom="0"}else{const n=t.children
for(let e=0;e<n.length;e++)if(n[e]===this.expandedViewport){t.removeChild(this.expandedViewport)
break}if(this.state.expandToFullscreen&&document.fullscreenElement&&document.exitFullscreen(),this.rootState){const n=this.rootState
for(const e of n.viewports)t.appendChild(e)
const r=e.style
r.top=n.top,r.bottom=n.bottom,r.left=n.left,r.right=n.right,r.width=n.width,r.height=n.height,r.maxWidth=n.maxWidth,r.maxHeight=n.maxHeight,r.margin=n.margin,r.marginLeft=n.marginLeft,r.marginRight=n.marginRight,r.marginTop=n.marginTop,r.marginBottom=n.marginBottom,r.position=n.position,r.overflow=n.overflow||""
const i=this.getScrollElement()
i.scrollTop=n.scrollTop,i.scrollLeft=n.scrollLeft,this.rootState=void 0,this.root.style.zIndex=n.zIndex}}}catch(e){const n="Layout change error, you might have to reload the page."
this.context.log.error(n),console.error(n,e)}}dispose(){super.dispose(),document.removeEventListener("fullscreenchange",this.fullscreenChangeHandler),document.removeEventListener("webkitfullscreenchange",this.fullscreenChangeHandler)}constructor(e){super({...Vr.t.getDefaultValues(Ap),...e.spec.layout&&e.spec.layout.initial}),this.context=e,this.events={updated:this.ev()},this.rootState=void 0,this.fullscreenChangeHandler=()=>{document.fullscreenElement||this.updateProps({expandToFullscreen:!1})},document.addEventListener("fullscreenchange",this.fullscreenChangeHandler),document.addEventListener("webkitfullscreenchange",this.fullscreenChangeHandler),Ir.PluginCommands.Layout.Update.subscribe(e,e=>this.updateProps(e.state)),"undefined"!=typeof document&&(this.expandedViewport=document.createElement("meta"),this.expandedViewport.name="viewport",this.expandedViewport.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0")}}var Pp=n(10596),Bp=n(66044),Ep=n(81444),kp=n(87095),Dp=n(81871),Mp=n(91229),Rp=n(71196),Op=n(7221)
const Lp={includeTypes:Vr.t.MultiSelect((0,Mp.mX)(kp.BondType.Names),Vr.t.objectToOptions(kp.BondType.Names)),excludeTypes:Vr.t.MultiSelect([],Vr.t.objectToOptions(kp.BondType.Names)),ignoreHydrogens:Vr.t.Boolean(!1),ignoreHydrogensVariant:Vr.t.Select("all",Vr.t.arrayToOptions(["all","non-polar"])),aromaticBonds:Vr.t.Boolean(!0,{description:"Display aromatic bonds with dashes"}),multipleBonds:Vr.t.Select("symmetric",Vr.t.arrayToOptions(["off","symmetric","offset"]))},Np=(Vr.t.getDefaultValues(Lp),{...Bp.Lr,...Lp,adjustCylinderLength:Vr.t.Boolean(!1,{description:"Shorten cylinders to reduce overlap with spheres. Useful for for transparent bonds. Not working well with aromatic bonds."})}),Fp=(Vr.t.getDefaultValues(Np),{...Bp.T9,...Lp})
function zp(e,t,n){return!kp.BondType.is(e,n)||kp.BondType.is(t,n)}function jp(e,t,n){const r=t.elements,i=t.bonds,{a:o,b:a,edgeProps:s}=i,{flags:l}=s,{ignoreHydrogens:c,ignoreHydrogensVariant:u,includeTypes:d,excludeTypes:p}=n,h=kp.BondType.fromNames(d),f=kp.BondType.fromNames(p),m=kp.BondType.isAll(h)&&kp.BondType.Flag.None===f,{child:g}=e,y=null==g?void 0:g.unitMap.get(t.id)
if(g&&!y)throw new Error("expected childUnit to exist if child exists")
if(!m||c||g)return n=>{const i=o[n],s=a[n]
return!((!y||Xo.X9.has(y.elements,r[i]))&&(m||!zp(h,f,l[n]))&&(!c||!(0,Op.v3)(e,t,r[i],u)&&!(0,Op.v3)(e,t,r[s],u)))}}function Vp(e,t){const n=e.interUnitBonds,{edges:r}=n,{ignoreHydrogens:i,ignoreHydrogensVariant:o,includeTypes:a,excludeTypes:s}=t,l=kp.BondType.fromNames(a),c=kp.BondType.fromNames(s),u=kp.BondType.isAll(l)&&kp.BondType.Flag.None===c,{child:d}=e
if(!u||i||d)return t=>{if(d){const n=r[t],i=d.unitMap.get(n.unitA)
if(!i)return!0
const o=e.unitMap.get(n.unitA).elements[n.indexA]
if(!Xo.X9.has(i.elements,o))return!0}if(i){const n=r[t],i=e.unitMap.get(n.unitA),a=e.unitMap.get(n.unitB)
if((0,Op.v3)(e,i,i.elements[n.indexA],o)||(0,Op.v3)(e,a,a.elements[n.indexB],o))return!0}return!(u||!zp(l,c,r[t].props.flag))}}function Up(e,t){return!Or.Unit.Traits.is(e.traits,Or.Unit.Trait.Water)||!t.ignoreHydrogens||"non-polar"===t.ignoreHydrogensVariant}function Gp(e,t){for(const{units:n}of e.unitSymmetryGroups)if(Or.Unit.isAtomic(n[0])&&Up(n[0],t))return!0
return!1}var Hp
function qp(e,t,n){const{objectId:r,instanceId:i,groupId:o}=e
if(n===r){const{structure:e,group:n}=t,r=n.units[i]
if(o===Rp.$.Null){const t=Xo.CD.ofRange(0,r.elements.length)
return Or.StructureElement.Loci(e.target,[{unit:r,indices:t}])}if(Or.Unit.isAtomic(r)){const{target:t}=e,n=r.bonds.a[o],i=r.bonds.b[o]
return Or.Bond.Loci(t,[Or.Bond.Location(t,r,n,t,r,i),Or.Bond.Location(t,r,i,t,r,n)])}}return Xr.EmptyLoci}function Qp(e,t,n,r){let i=!1
if(Or.Bond.isLoci(e)){const{structure:r,group:o}=t
if(!Or.Structure.areEquivalent(e.structure,r))return!1
const a=o.units[0]
if(!Or.Unit.isAtomic(a))return!1
const s=2*a.bonds.edgeCount
for(const t of e.bonds){if(t.aUnit!==t.bUnit)continue
const e=o.unitIndexMap.get(t.aUnit.id)
if(void 0!==e){const r=a.bonds.getDirectedEdgeIndex(t.aIndex,t.bIndex);-1!==r&&n(Xo.IX.ofSingleton(e*s+r))&&(i=!0)}}}else if(Or.StructureElement.Loci.is(e)){const{structure:o,group:a}=t
if(!Or.Structure.areEquivalent(e.structure,o))return!1
const s=a.units[0]
if(!Or.Unit.isAtomic(s))return!1
const l=2*s.bonds.edgeCount
for(const t of e.elements){const e=a.unitIndexMap.get(t.unit.id)
if(void 0!==e){const{offset:o,b:a}=s.bonds
Xo.CD.forEach(t.indices,s=>{for(let c=o[s],u=o[s+1];c<u;c++)r&&!Xo.CD.has(t.indices,a[c])||n(Xo.IX.ofSingleton(e*l+c))&&(i=!0)})}}}return i}function $p(e,t,n){const{objectId:r,groupId:i}=e
if(n===r){const{target:e}=t
if(i===Rp.$.Null)return Or.Structure.Loci(e)
{const n=t.interUnitBonds.edges[i],r=t.unitMap.get(n.unitA),o=t.unitMap.get(n.unitB)
return Or.Bond.Loci(e,[Or.Bond.Location(e,r,n.indexA,e,o,n.indexB),Or.Bond.Location(e,o,n.indexB,e,r,n.indexA)])}}return Xr.EmptyLoci}Vr.t.getDefaultValues(Fp),function(e){e.fromGroup=function(e,t){const{group:n,structure:r}=e,i=n.units[0],o=Or.Unit.isAtomic(i)?2*i.bonds.edgeCount:0,a=n.units.length,s=Or.Bond.Location(r,void 0,void 0,r,void 0,void 0),l=(e,t)=>{const r=n.units[t]
return s.aUnit=r,s.bUnit=r,s.aIndex=r.bonds.a[e],s.bIndex=r.bonds.b[e],s}
if(null==t?void 0:t.includeLocation2){const e=Or.Bond.Location(r,void 0,void 0,r,void 0,void 0),t=(t,r)=>{const i=n.units[r]
return e.aUnit=i,e.bUnit=i,e.aIndex=i.bonds.b[t],e.bIndex=i.bonds.a[t],e}
return(0,Dp.iQ)(o,a,1,l,!1,()=>!1,t)}return(0,Dp.iQ)(o,a,1,l)},e.fromStructure=function(e,t){const n=e.interUnitBonds.edgeCount,r=Or.Bond.Location(e,void 0,void 0,e,void 0,void 0),i=t=>{const n=e.interUnitBonds.edges[t]
return r.aUnit=e.unitMap.get(n.unitA),r.aIndex=n.indexA,r.bUnit=e.unitMap.get(n.unitB),r.bIndex=n.indexB,r}
if(null==t?void 0:t.includeLocation2){const t=Or.Bond.Location(e,void 0,void 0,e,void 0,void 0),r=n=>{const r=e.interUnitBonds.edges[n]
return t.aUnit=e.unitMap.get(r.unitB),t.aIndex=r.indexB,t.bUnit=e.unitMap.get(r.unitA),t.bIndex=r.indexA,t}
return(0,Dp.iQ)(n,1,1,i,!0,()=>!1,r)}return(0,Dp.iQ)(n,1,1,i,!0)},e.fromStructureGroups=function(e,t){const{bondCount:n,unitIndex:r,unitGroupIndex:i,unitEdgeIndex:o}=e.intraUnitBondMapping,a=n,s=Or.Bond.Location(e,void 0,void 0,e,void 0,void 0),l=t=>{const n=e.unitSymmetryGroups[r[t]].units[i[t]],a=o[t]
return s.aUnit=n,s.bUnit=n,s.aIndex=n.bonds.a[a],s.bIndex=n.bonds.b[a],s}
if(null==t?void 0:t.includeLocation2){const t=Or.Bond.Location(e,void 0,void 0,e,void 0,void 0),n=n=>{const a=e.unitSymmetryGroups[r[n]].units[i[n]],s=o[n]
return t.aUnit=a,t.bUnit=a,t.aIndex=a.bonds.b[s],t.bIndex=a.bonds.a[s],t}
return(0,Dp.iQ)(a,1,1,l,!0,()=>!1,n)}return(0,Dp.iQ)(a,1,1,l,!0)}}(Hp||(Hp={}))
const Xp=new Map
function Wp(e,t,n,r){let i=!1
if(Or.Bond.isLoci(e)){if(!Or.Structure.areEquivalent(e.structure,t))return!1
for(const r of e.bonds){const e=t.interUnitBonds.getBondIndexFromLocation(r);-1!==e&&n(Xo.IX.ofSingleton(e))&&(i=!0)}}else if(Or.StructureElement.Loci.is(e)){if(!Or.Structure.areEquivalent(e.structure,t))return!1
if(r&&1===e.elements.length)return!1
for(const t of e.elements)Xp.set(t.unit.id,t.indices)
for(const o of e.elements){const{unit:e}=o
if(Or.Unit.isAtomic(e))for(const a of t.interUnitBonds.getConnectedUnits(e.id)){const s=Xp.get(a.unitB)
r&&!s||Xo.CD.forEach(o.indices,o=>{if(a.connectedIndices.includes(o))for(const l of a.getEdges(o))if(!r||s&&Xo.CD.has(s,l.indexB)){const r=t.interUnitBonds.getEdgeIndex(o,e.id,l.indexB,a.unitB)
n(Xo.IX.ofSingleton(r))&&(i=!0)}})}}Xp.clear()}return i}function Yp(e,t,n){const{objectId:r,groupId:i}=e
if(n===r){const e=t.intraUnitBondMapping
return qp({objectId:r,instanceId:e.unitGroupIndex[i],groupId:e.unitEdgeIndex[i]},{structure:t,group:t.unitSymmetryGroups[e.unitIndex[i]]},n)}return Xr.EmptyLoci}function Zp(e,t,n,r){const{unitGroupOffset:i}=t.intraUnitBondMapping
let o=!1
if(Or.Bond.isLoci(e)){if(!Or.Structure.areEquivalent(e.structure,t))return!1
for(const r of e.bonds){if(r.aUnit!==r.bUnit)continue
const e=t.unitSymmetryGroupsIndexMap.get(r.aUnit.id),a=t.unitSymmetryGroups[e],s=a.units[0]
if(!Or.Unit.isAtomic(s))continue
const l=i[e],c=2*s.bonds.edgeCount,u=a.unitIndexMap.get(r.aUnit.id)
if(void 0!==u){const e=s.bonds.getDirectedEdgeIndex(r.aIndex,r.bIndex);-1!==e&&n(Xo.IX.ofSingleton(u*c+e+l))&&(o=!0)}}}else if(Or.StructureElement.Loci.is(e)){if(!Or.Structure.areEquivalent(e.structure,t))return!1
for(const a of e.elements){const e=t.unitSymmetryGroupsIndexMap.get(a.unit.id),s=t.unitSymmetryGroups[e],l=s.units[0]
if(!Or.Unit.isAtomic(l))continue
const c=i[e],u=2*l.bonds.edgeCount,d=s.unitIndexMap.get(a.unit.id)
if(void 0!==d){const{offset:e,b:t}=l.bonds
Xo.CD.forEach(a.indices,i=>{for(let s=e[i],l=e[i+1];s<l;s++)r&&!Xo.CD.has(a.indices,t[s])||n(Xo.IX.ofSingleton(d*u+s+c))&&(o=!0)})}}}return o}var Kp=n(29067),Jp=n(47404),eh=n(55165),th=n(62837)
const nh=kp.BondType.is
function rh(e,t,n,r){const i=e.elements,o=e.bonds,{edgeCount:a,a:s,b:l,edgeProps:c,offset:u}=o,{order:d,flags:p}=c,{sizeFactor:h,sizeAspectRatio:f,adjustCylinderLength:m,aromaticBonds:g,includeTypes:y,excludeTypes:v,multipleBonds:b}=r,x="off"===b,S="symmetric"===b,_=zp(kp.BondType.fromNames(y),kp.BondType.fromNames(v),kp.BondType.Flag.Computed),C=(0,Ta.eB)(),w=(0,Ta.eB)(),T=e.conformation
let A
const I=Or.StructureElement.Location.create(t,e),P=Or.Bond.Location(t,e,void 0,t,e,void 0),{child:B}=t
if(r.includeParent&&B){const t=B.unitMap.get(e.id)
if(!t)throw new Error("expected childUnit to exist")
A=e=>{const n=i[s[e]],r=i[l[e]]
return Xo.X9.has(t.elements,n)&&!Xo.X9.has(t.elements,r)}}const{elementRingIndices:E,elementAromaticRingIndices:k}=e.rings,D=g?e.resonance.delocalizedTriplets:void 0
return{linkCount:2*a,referencePosition:e=>{let t=s[e],n=l[e]
const r=null==D?void 0:D.getThirdElement(t,n)
if(void 0!==r)return T.invariantPosition(i[r],C)
t>n&&([t,n]=[n,t]),u[t+1]-u[t]===1&&([t,n]=[n,t])
const o=k.get(t)||E.get(t)
let a=0
for(let s=u[t],c=u[t+1];s<c;++s){const e=l[s]
if(e!==n&&e!==t){if(!o)return T.invariantPosition(i[e],C)
{const t=k.get(e)||E.get(e)
if(!t)continue
const n=(0,ao.u$)(o,t)
n>a&&(a=n,T.invariantPosition(i[e],C))}}}return a>0?C:null},position:(e,t,r,o)=>{if(T.invariantPosition(i[s[r]],e),T.invariantPosition(i[l[r]],t),o&&m){const o=(e=>(I.element=i[s[e]],n.size.size(I)*h))(r),a=(e=>(I.element=i[l[e]],n.size.size(I)*h))(r),c=Math.min(o,a)*f,u=Math.sqrt(Math.max(0,o*o-c*c))-.05,d=Math.sqrt(Math.max(0,a*a-c*c))-.05
if(u<=.01&&d<=.01)return
Ta.eB.normalize(w,Ta.eB.sub(w,t,e)),Ta.eB.scaleAndAdd(e,e,w,u),Ta.eB.scaleAndAdd(t,t,w,-d)}},style:e=>{const t=d[e],n=p[e]
if(nh(n,kp.BondType.Flag.MetallicCoordination)||nh(n,kp.BondType.Flag.HydrogenBond))return Bp.gK.Dashed
if(3===t)return x?Bp.gK.Solid:S?Bp.gK.Triple:Bp.gK.OffsetTriple
if(g){const t=s[e],r=l[e],i=k.get(t),o=k.get(r),a=i&&o?(0,ao.u$)(i,o):0
if(nh(n,kp.BondType.Flag.Aromatic)||a&&!_)return 2===a?Bp.gK.MirroredAromatic:Bp.gK.Aromatic}return 2!==t||x?Bp.gK.Solid:S?Bp.gK.Double:Bp.gK.OffsetDouble},radius:e=>(e=>(P.aIndex=s[e],P.bIndex=l[e],n.size.size(P)*h))(e)*f,ignore:jp(t,e,r),stub:A}}function ih(e,t,n,r,i,o){if(!Or.Unit.isAtomic(t))return Jp.S.createEmpty(o)
if(!Up(t,i))return Jp.S.createEmpty(o)
if(!t.bonds.edgeCount)return Jp.S.createEmpty(o)
const{child:a}=n,s=null==a?void 0:a.unitMap.get(t.id)
if(a&&!s)return Jp.S.createEmpty(o)
const l=rh(t,n,r,i),{cylinders:c,boundingSphere:u}=(0,Bp.rm)(e,l,i,o)
if(u)c.setBoundingSphere(u)
else if(c.cylinderCount>0){const e=hd.f8.expand((0,hd.f8)(),(null!=s?s:t).boundary.sphere,1*i.sizeFactor)
c.setBoundingSphere(e)}return c}function oh(e,t,n,r,i,o){if(!Or.Unit.isAtomic(t))return Pp.e.createEmpty(o)
if(!Up(t,i))return Pp.e.createEmpty(o)
if(!t.bonds.edgeCount)return Pp.e.createEmpty(o)
const{child:a}=n,s=null==a?void 0:a.unitMap.get(t.id)
if(a&&!s)return Pp.e.createEmpty(o)
const l=rh(t,n,r,i),{mesh:c,boundingSphere:u}=(0,Bp.C1)(e,l,i,o)
if(u)c.setBoundingSphere(u)
else if(c.triangleCount>0){const e=hd.f8.expand((0,hd.f8)(),(null!=s?s:t).boundary.sphere,1*i.sizeFactor)
c.setBoundingSphere(e)}return c}const ah={...Ep.Te,...Ep.lm,...Np,sizeFactor:Vr.t.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:Vr.t.Numeric(2/3,{min:0,max:3,step:.01}),tryUseImpostor:Vr.t.Boolean(!0),includeParent:Vr.t.Boolean(!1)}
function sh(e,t,n,r){return n.tryUseImpostor&&(0,Op.VZ)(r)?function(e){return(0,Ep.Vb)({defaultProps:Vr.t.getDefaultValues(ah),createGeometry:ih,createLocationIterator:(e,t)=>Hp.fromGroup(e,{includeLocation2:"interpolate"===t.colorMode}),getLoci:qp,eachLocation:Qp,setUpdateState:(e,t,n,r,i,o,a)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.sizeAspectRatio!==n.sizeAspectRatio||t.linkScale!==n.linkScale||t.linkSpacing!==n.linkSpacing||t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||t.linkCap!==n.linkCap||t.aromaticScale!==n.aromaticScale||t.aromaticSpacing!==n.aromaticSpacing||t.aromaticDashCount!==n.aromaticDashCount||t.dashCount!==n.dashCount||t.dashScale!==n.dashScale||t.dashCap!==n.dashCap||t.stubCap!==n.stubCap||!(0,s.af)(t.includeTypes,n.includeTypes)||!(0,s.af)(t.excludeTypes,n.excludeTypes)||t.adjustCylinderLength!==n.adjustCylinderLength||t.aromaticBonds!==n.aromaticBonds||t.multipleBonds!==n.multipleBonds||t.adjustCylinderLength&&!eh.F.areEqual(r.size,i.size),t.colorMode!==n.colorMode&&(e.createGeometry=!0,e.updateTransform=!0,e.updateColor=!0)
const l=o.group.units[0],c=a.group.units[0]
Or.Unit.isAtomic(l)&&Or.Unit.isAtomic(c)&&(Kp.O.areEqual(l.bonds,c.bonds)||(e.createGeometry=!0,e.updateTransform=!0,e.updateColor=!0,e.updateSize=!0))},mustRecreate:(e,t,n)=>!t.tryUseImpostor||!n},e)}(e):function(e){return(0,Ep.Pv)({defaultProps:Vr.t.getDefaultValues(ah),createGeometry:oh,createLocationIterator:e=>Hp.fromGroup(e),getLoci:qp,eachLocation:Qp,setUpdateState:(e,t,n,r,i,o,a)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.sizeAspectRatio!==n.sizeAspectRatio||t.radialSegments!==n.radialSegments||t.linkScale!==n.linkScale||t.linkSpacing!==n.linkSpacing||t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||t.linkCap!==n.linkCap||t.aromaticScale!==n.aromaticScale||t.aromaticSpacing!==n.aromaticSpacing||t.aromaticDashCount!==n.aromaticDashCount||t.dashCount!==n.dashCount||t.dashScale!==n.dashScale||t.dashCap!==n.dashCap||t.stubCap!==n.stubCap||!(0,s.af)(t.includeTypes,n.includeTypes)||!(0,s.af)(t.excludeTypes,n.excludeTypes)||t.adjustCylinderLength!==n.adjustCylinderLength||t.aromaticBonds!==n.aromaticBonds||t.multipleBonds!==n.multipleBonds
const l=o.group.units[0],c=a.group.units[0]
Or.Unit.isAtomic(l)&&Or.Unit.isAtomic(c)&&(Kp.O.areEqual(l.bonds,c.bonds)||(e.createGeometry=!0,e.updateTransform=!0,e.updateColor=!0,e.updateSize=!0))},mustRecreate:(e,t,n)=>t.tryUseImpostor&&!!n},e)}(e)}function lh(e,t,n){const r=[],{bondCount:i,unitIndex:o,unitEdgeIndex:a,unitGroupIndex:s}=e.intraUnitBondMapping,{child:l}=e
for(const c of e.unitSymmetryGroups){const i=c.units[0],o=null==l?void 0:l.unitMap.get(i.id),a=!Or.Unit.isAtomic(i)||l&&!o?Bp.Js:rh(i,e,t,n)
r.push({group:c,props:a})}return{linkCount:i,referencePosition:e=>{const{group:t,props:n}=r[o[e]]
if(!n.referencePosition)return null
const i=n.referencePosition(a[e])
if(!i)return null
const l=t.units[s[e]]
return Ta.eB.transformMat4(i,i,l.conformation.operator.matrix),i},position:(e,t,n,i)=>{const{group:l,props:c}=r[o[n]]
c.position(e,t,a[n],i)
const u=l.units[s[n]]
Ta.eB.transformMat4(e,e,u.conformation.operator.matrix),Ta.eB.transformMat4(t,t,u.conformation.operator.matrix)},style:e=>{const{props:t}=r[o[e]]
return t.style?t.style(a[e]):Bp.gK.Solid},radius:e=>{const{props:t}=r[o[e]]
return t.radius(a[e])},ignore:e=>{const{props:t}=r[o[e]]
return!!t.ignore&&t.ignore(a[e])},stub:e=>{const{props:t}=r[o[e]]
return!!t.stub&&t.stub(a[e])}}}function ch(e,t,n,r,i){if(!Gp(t,r))return Jp.S.createEmpty(i)
if(!t.intraUnitBondMapping.bondCount)return Jp.S.createEmpty(i)
const o=lh(t,n,r),{cylinders:a,boundingSphere:s}=(0,Bp.rm)(e,o,r,i)
if(s)a.setBoundingSphere(s)
else if(a.cylinderCount>0){const{child:e}=t,n=hd.f8.expand((0,hd.f8)(),(null!=e?e:t).boundary.sphere,1*r.sizeFactor)
a.setBoundingSphere(n)}return a}function uh(e,t,n,r,i){if(!Gp(t,r))return Pp.e.createEmpty(i)
if(!t.intraUnitBondMapping.bondCount)return Pp.e.createEmpty(i)
const o=lh(t,n,r),{mesh:a,boundingSphere:s}=(0,Bp.C1)(e,o,r,i)
if(s)a.setBoundingSphere(s)
else if(a.triangleCount>0){const{child:e}=t,n=hd.f8.expand((0,hd.f8)(),(null!=e?e:t).boundary.sphere,1*r.sizeFactor)
a.setBoundingSphere(n)}return a}const dh={...th.EN,...th.KE,...Np,sizeFactor:Vr.t.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:Vr.t.Numeric(2/3,{min:0,max:3,step:.01}),tryUseImpostor:Vr.t.Boolean(!0),includeParent:Vr.t.Boolean(!1)}
function ph(e,t,n,r){return n.tryUseImpostor&&r&&r.extensions.fragDepth?function(e){return(0,th.UM)({defaultProps:Vr.t.getDefaultValues(dh),createGeometry:ch,createLocationIterator:(e,t)=>Gp(e,t)?Hp.fromStructureGroups(e,{includeLocation2:"interpolate"===t.colorMode}):Dp.FL,getLoci:Yp,eachLocation:Zp,setUpdateState:(e,t,n,r,i,o,a)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.sizeAspectRatio!==n.sizeAspectRatio||t.linkScale!==n.linkScale||t.linkSpacing!==n.linkSpacing||t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||t.linkCap!==n.linkCap||t.aromaticScale!==n.aromaticScale||t.aromaticSpacing!==n.aromaticSpacing||t.aromaticDashCount!==n.aromaticDashCount||t.dashCount!==n.dashCount||t.dashScale!==n.dashScale||t.dashCap!==n.dashCap||t.stubCap!==n.stubCap||!(0,s.af)(t.includeTypes,n.includeTypes)||!(0,s.af)(t.excludeTypes,n.excludeTypes)||t.adjustCylinderLength!==n.adjustCylinderLength||t.multipleBonds!==n.multipleBonds,t.colorMode!==n.colorMode&&(e.createGeometry=!0,e.updateTransform=!0,e.updateColor=!0),Gp(o,t)&&o.interUnitBonds!==a.interUnitBonds&&(e.createGeometry=!0,e.updateTransform=!0,e.updateColor=!0,e.updateSize=!0)},mustRecreate:(e,t,n)=>!t.tryUseImpostor||!n},e)}(e):function(e){return(0,th.wA)({defaultProps:Vr.t.getDefaultValues(dh),createGeometry:uh,createLocationIterator:(e,t)=>Gp(e,t)?Hp.fromStructureGroups(e):Dp.FL,getLoci:Yp,eachLocation:Zp,setUpdateState:(e,t,n,r,i,o,a)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.sizeAspectRatio!==n.sizeAspectRatio||t.radialSegments!==n.radialSegments||t.linkScale!==n.linkScale||t.linkSpacing!==n.linkSpacing||t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||t.linkCap!==n.linkCap||t.aromaticScale!==n.aromaticScale||t.aromaticSpacing!==n.aromaticSpacing||t.aromaticDashCount!==n.aromaticDashCount||t.dashCount!==n.dashCount||t.dashScale!==n.dashScale||t.dashCap!==n.dashCap||t.stubCap!==n.stubCap||!(0,s.af)(t.includeTypes,n.includeTypes)||!(0,s.af)(t.excludeTypes,n.excludeTypes)||t.adjustCylinderLength!==n.adjustCylinderLength||t.multipleBonds!==n.multipleBonds||t.adjustCylinderLength&&!eh.F.areEqual(r.size,i.size),Gp(o,t)&&o.interUnitBonds!==a.interUnitBonds&&(e.createGeometry=!0,e.updateTransform=!0,e.updateColor=!0,e.updateSize=!0)},mustRecreate:(e,t,n)=>t.tryUseImpostor&&!!n},e)}(e)}var hh=n(52349)
const fh=new Or.Bond.ElementBondIterator
function mh(e,t,n,r){for(fh.setElement(t,n,r);fh.hasNext;){const t=fh.move()
return t.otherUnit.conformation.position(t.otherUnit.elements[t.otherIndex],e),e}return null}const gh=(0,Ta.eB)()
function yh(e,t,n){const r=Or.StructureElement.Location.create(e),i=Or.Bond.Location(e,void 0,void 0,e,void 0,void 0),o=e.interUnitBonds,{edgeCount:a,edges:l}=o,{sizeFactor:c,sizeAspectRatio:u,adjustCylinderLength:d,aromaticBonds:p,multipleBonds:h}=n,f="off"===h,m="symmetric"===h,g=(0,Ta.eB)()
let y
const{child:v}=e
return n.includeParent&&v&&(y=t=>{const n=l[t],r=v.unitMap.get(n.unitA),i=v.unitMap.get(n.unitB),o=e.unitMap.get(n.unitA).elements[n.indexA],a=e.unitMap.get(n.unitB).elements[n.indexB]
return r&&hh.X.has(r.elements,o)&&(!i||!hh.X.has(i.elements,a))}),{linkCount:a,referencePosition:t=>{const n=l[t]
let r,i,o,a
if(n.unitA<n.unitB)r=e.unitMap.get(n.unitA),i=e.unitMap.get(n.unitB),o=n.indexA,a=n.indexB
else{if(!(n.unitA>n.unitB))throw new Error("same units in createInterUnitBondCylinderMesh")
r=e.unitMap.get(n.unitB),i=e.unitMap.get(n.unitA),o=n.indexB,a=n.indexA}return mh(gh,e,r,o)||mh(gh,e,i,a)},position:(n,i,o,a)=>{const s=l[o],p=e.unitMap.get(s.unitA),h=e.unitMap.get(s.unitB)
if(p.conformation.position(p.elements[s.indexA],n),h.conformation.position(h.elements[s.indexB],i),a&&d){const a=(n=>{const i=l[n]
return r.unit=e.unitMap.get(i.unitA),r.element=r.unit.elements[i.indexA],t.size.size(r)*c})(o),s=(n=>{const i=l[n]
return r.unit=e.unitMap.get(i.unitB),r.element=r.unit.elements[i.indexB],t.size.size(r)*c})(o),d=Math.min(a,s)*u,p=Math.sqrt(Math.max(0,a*a-d*d))-.05,h=Math.sqrt(Math.max(0,s*s-d*d))-.05
if(p<=.01&&h<=.01)return
Ta.eB.normalize(g,Ta.eB.sub(g,i,n)),Ta.eB.scaleAndAdd(n,n,g,p),Ta.eB.scaleAndAdd(i,i,g,-h)}},style:e=>{const t=l[e].props.order,n=s.NJ.create(l[e].props.flag)
return kp.BondType.is(n,kp.BondType.Flag.MetallicCoordination)||kp.BondType.is(n,kp.BondType.Flag.HydrogenBond)?Bp.gK.Dashed:3===t?f?Bp.gK.Solid:m?Bp.gK.Triple:Bp.gK.OffsetTriple:p&&kp.BondType.is(n,kp.BondType.Flag.Aromatic)?Bp.gK.Aromatic:2!==t||f?Bp.gK.Solid:m?Bp.gK.Double:Bp.gK.OffsetDouble},radius:n=>(n=>{const r=l[n]
return i.aUnit=e.unitMap.get(r.unitA),i.aIndex=r.indexA,i.bUnit=e.unitMap.get(r.unitB),i.bIndex=r.indexB,t.size.size(i)*c})(n)*u,ignore:Vp(e,n),stub:y}}function vh(e,t,n,r,i){if(!Gp(t,r))return Jp.S.createEmpty(i)
if(!t.interUnitBonds.edgeCount)return Jp.S.createEmpty(i)
const o=yh(t,n,r),{cylinders:a,boundingSphere:s}=(0,Bp.rm)(e,o,r,i)
if(s)a.setBoundingSphere(s)
else if(a.cylinderCount>0){const{child:e}=t,n=hd.f8.expand((0,hd.f8)(),(null!=e?e:t).boundary.sphere,1*r.sizeFactor)
a.setBoundingSphere(n)}return a}function bh(e,t,n,r,i){if(!Gp(t,r))return Pp.e.createEmpty(i)
if(!t.interUnitBonds.edgeCount)return Pp.e.createEmpty(i)
const o=yh(t,n,r),{mesh:a,boundingSphere:s}=(0,Bp.C1)(e,o,r,i)
if(s)a.setBoundingSphere(s)
else if(a.triangleCount>0){const{child:e}=t,n=hd.f8.expand((0,hd.f8)(),(null!=e?e:t).boundary.sphere,1*r.sizeFactor)
a.setBoundingSphere(n)}return a}const xh={...th.EN,...th.KE,...Np,sizeFactor:Vr.t.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:Vr.t.Numeric(2/3,{min:0,max:3,step:.01}),tryUseImpostor:Vr.t.Boolean(!0),includeParent:Vr.t.Boolean(!1)}
function Sh(e,t,n,r){return n.tryUseImpostor&&(0,Op.VZ)(r)?function(e){return(0,th.UM)({defaultProps:Vr.t.getDefaultValues(xh),createGeometry:vh,createLocationIterator:(e,t)=>Gp(e,t)?Hp.fromStructure(e,{includeLocation2:"interpolate"===t.colorMode}):Dp.FL,getLoci:$p,eachLocation:Wp,setUpdateState:(e,t,n,r,i,o,a)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.sizeAspectRatio!==n.sizeAspectRatio||t.linkScale!==n.linkScale||t.linkSpacing!==n.linkSpacing||t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||t.linkCap!==n.linkCap||t.aromaticScale!==n.aromaticScale||t.aromaticSpacing!==n.aromaticSpacing||t.aromaticDashCount!==n.aromaticDashCount||t.dashCount!==n.dashCount||t.dashScale!==n.dashScale||t.dashCap!==n.dashCap||t.stubCap!==n.stubCap||!(0,s.af)(t.includeTypes,n.includeTypes)||!(0,s.af)(t.excludeTypes,n.excludeTypes)||t.adjustCylinderLength!==n.adjustCylinderLength||t.multipleBonds!==n.multipleBonds,t.colorMode!==n.colorMode&&(e.createGeometry=!0,e.updateTransform=!0,e.updateColor=!0),Gp(o,t)&&o.interUnitBonds!==a.interUnitBonds&&(e.createGeometry=!0,e.updateTransform=!0,e.updateColor=!0,e.updateSize=!0)},mustRecreate:(e,t,n)=>!t.tryUseImpostor||!n},e)}(e):function(e){return(0,th.wA)({defaultProps:Vr.t.getDefaultValues(xh),createGeometry:bh,createLocationIterator:(e,t)=>Gp(e,t)?Hp.fromStructure(e):Dp.FL,getLoci:$p,eachLocation:Wp,setUpdateState:(e,t,n,r,i,o,a)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.sizeAspectRatio!==n.sizeAspectRatio||t.radialSegments!==n.radialSegments||t.linkScale!==n.linkScale||t.linkSpacing!==n.linkSpacing||t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||t.linkCap!==n.linkCap||t.aromaticScale!==n.aromaticScale||t.aromaticSpacing!==n.aromaticSpacing||t.aromaticDashCount!==n.aromaticDashCount||t.dashCount!==n.dashCount||t.dashScale!==n.dashScale||t.dashCap!==n.dashCap||t.stubCap!==n.stubCap||!(0,s.af)(t.includeTypes,n.includeTypes)||!(0,s.af)(t.excludeTypes,n.excludeTypes)||t.adjustCylinderLength!==n.adjustCylinderLength||t.multipleBonds!==n.multipleBonds||t.adjustCylinderLength&&!eh.F.areEqual(r.size,i.size),Gp(o,t)&&o.interUnitBonds!==a.interUnitBonds&&(e.createGeometry=!0,e.updateTransform=!0,e.updateColor=!0,e.updateSize=!0)},mustRecreate:(e,t,n)=>t.tryUseImpostor&&!!n},e)}(e)}var _h=n(27011),Ch=n(83794),wh=n(10268),Th=n(32520),Ah=n(47134)
const Ih=Ta.eB.add
function Ph(e,t,n){const{ignoreHydrogens:r,ignoreHydrogensVariant:i,traceOnly:o}=n,a=Or.Unit.isCoarse(t),{child:s}=e,l=null==s?void 0:s.unitMap.get(t.id)
if(s&&!l)throw new Error("expected childUnit to exist if child exists")
if(s||r||o)return n=>!!l&&!Xo.X9.has(l.elements,n)||!a&&r&&(0,Op.v3)(e,t,n,i)||o&&!(0,Op.UQ)(t,n)}function Bh(e,t,n,r,i,o){const{child:a}=n,s=null==a?void 0:a.unitMap.get(t.id)
if(a&&!s)return Pp.e.createEmpty(o)
const{detail:l,sizeFactor:c,stride:u}=i,{elements:d,conformation:p}=t,h=d.length,f=h*(0,_h.J)(l),m=Ch.P.createState(f,f/2,o),g=(0,Ta.eB)(),y=Ph(n,t,i),v=Or.StructureElement.Location.create(n,t),b=r.size.size,x=(0,Ta.eB)()
let S=0,_=0
for(let A=0;A<h;A++){if(u&&A%u!==0)continue
if(y&&y(d[A]))continue
p.invariantPosition(d[A],g),Ih(x,x,g),_+=1,v.element=d[A]
const e=b(v)
e>S&&(S=e),m.currentGroup=A,(0,wh.X)(m,g,e*c,l)}const C=Ch.P.getMesh(m)
if(0===_)return C
let w
Ta.eB.scale(x,x,1/_)
const T=o?hd.f8.clone(o.boundingSphere):void 0
return w=T&&Ta.eB.distance(x,T.center)/T.radius<.1?T:hd.f8.expand((0,hd.f8)(),(null!=s?s:t).boundary.sphere,S*c+.05),C.setBoundingSphere(w),C}function Eh(e,t,n,r,i,o){const{child:a}=n,s=null==a?void 0:a.unitMap.get(t.id)
if(a&&!s)return Th.v.createEmpty(o)
const{sizeFactor:l,stride:c}=i,{elements:u,conformation:d}=t,p=u.length,h=Ah.Q.create(p,p/2,o),f=(0,Ta.eB)(),m=Ph(n,t,i),g=Or.StructureElement.Location.create(n,t),y=r.size.size,v=(0,Ta.eB)()
let b=0,x=0
if(c&&c>1||m||"uniform"!==r.size.granularity)for(let w=0;w<p;w++){if(c&&w%c!==0)continue
if(m&&m(u[w]))continue
d.invariantPosition(u[w],f),h.add(f[0],f[1],f[2],w),Ih(v,v,f),x+=1,g.element=u[w]
const e=y(g)
e>b&&(b=e)}else{for(let e=0;e<p;e++)d.invariantPosition(u[e],f),h.add(f[0],f[1],f[2],e),Ih(v,v,f)
x=p,b=y(g)}const S=h.getSpheres()
if(0===x)return S
let _
Ta.eB.scale(v,v,1/x)
const C=o?hd.f8.clone(o.boundingSphere):void 0
return _=C&&Ta.eB.distance(v,C.center)/C.radius<.1?C:hd.f8.expand((0,hd.f8)(),(null!=s?s:t).boundary.sphere,b*l+.05),S.setBoundingSphere(_),S}function kh(e,t,n){let r=!1
if(!Or.StructureElement.Loci.is(e))return!1
const{structure:i,group:o}=t
if(!Or.Structure.areEquivalent(e.structure,i))return!1
const a=o.elements.length,{unitIndexMap:s}=o
for(const l of e.elements){const e=s.get(l.unit.id)
if(void 0!==e){const t=e*a
if(Xo.IX.is(l.indices)){const e=t+Xo.IX.start(l.indices),i=t+Xo.IX.end(l.indices)
n(Xo.IX.ofBounds(e,i))&&(r=!0)}else for(let e=0,i=l.indices.length;e<i;e++){const o=l.indices[e]
let a=e+1
for(;a<i&&l.indices[a]===o;)a++
e=a-1
const s=l.indices[e]
r=n(Xo.IX.ofRange(t+o,t+s))||r}}}return r}function Dh(e,t,n){const{objectId:r,instanceId:i,groupId:o}=e
if(n===r){const{structure:e,group:n}=t,r=n.units[i],a=o===Rp.$.Null?Xo.CD.ofRange(0,r.elements.length):Xo.CD.ofSingleton(o)
return Or.StructureElement.Loci(e.target,[{unit:r,indices:a}])}return Xr.EmptyLoci}function Mh(e,t,n,r,i){const{child:o}=t,{detail:a,sizeFactor:s,stride:l}=r,{getSerialIndex:c}=t.serialMapping,u=t.elementCount*(0,_h.J)(a),d=Ch.P.createState(u,u/2,i),p=n.size.size,h=(0,Ta.eB)()
let f=0,m=0
for(const b of t.units){const e=null==o?void 0:o.unitMap.get(b.id)
if(o&&!e)continue
const{elements:n,conformation:i}=b,u=n.length,g=(0,Ta.eB)(),y=Ph(t,b,r),v=Or.StructureElement.Location.create(t,b)
for(let t=0;t<u;t++){const e=n[t]
if(l&&t%l!==0)continue
if(y&&y(e))continue
i.position(e,g),Ih(h,h,g),m+=1,v.element=e
const r=p(v)
r>f&&(f=r),d.currentGroup=c(b,e),(0,wh.X)(d,g,r*s,a)}}const g=Ch.P.getMesh(d)
if(0===m)return g
let y
Ta.eB.scale(h,h,1/m)
const v=i?hd.f8.clone(i.boundingSphere):void 0
return y=v&&Ta.eB.distance(h,v.center)/v.radius<1?v:hd.f8.expand((0,hd.f8)(),(null!=o?o:t).boundary.sphere,f*s+.05),g.setBoundingSphere(y),g}function Rh(e,t,n,r,i){const{child:o}=t,{sizeFactor:a,stride:s}=r,{getSerialIndex:l}=t.serialMapping,c=t.elementCount,u=Ah.Q.create(c,c/2,i),d=n.size.size,p=(0,Ta.eB)()
let h=0,f=0
for(const v of t.units){const e=null==o?void 0:o.unitMap.get(v.id)
if(o&&!e)continue
const{elements:i,conformation:a}=v,c=i.length,m=(0,Ta.eB)(),g=Ph(t,v,r),y=Or.StructureElement.Location.create(t,v)
if(s&&s>1||g||"uniform"!==n.size.granularity)for(let t=0;t<c;t++){const e=i[t]
if(s&&t%s!==0)continue
if(g&&g(e))continue
a.position(e,m),u.add(m[0],m[1],m[2],l(v,e)),Ih(p,p,m),f+=1,y.element=e
const n=d(y)
n>h&&(h=n)}else{for(let e=0;e<c;e++){const t=i[e]
a.position(t,m),u.add(m[0],m[1],m[2],l(v,t)),Ih(p,p,m)}f+=c,h=d(y)}}const m=u.getSpheres()
if(0===f)return m
let g
Ta.eB.scale(p,p,1/f)
const y=i?hd.f8.clone(i.boundingSphere):void 0
return g=y&&Ta.eB.distance(p,y.center)/y.radius<1?y:hd.f8.expand((0,hd.f8)(),(null!=o?o:t).boundary.sphere,h*a+.05),m.setBoundingSphere(g),m}function Oh(e,t,n){let r=!1
if(!Or.StructureElement.Loci.is(e))return!1
if(!Or.Structure.areEquivalent(e.structure,t))return!1
const{cumulativeUnitElementCount:i}=t.serialMapping
for(const o of e.elements){const e=t.unitIndexMap.get(o.unit.id)
if(void 0!==e)if(Xo.IX.is(o.indices)){const t=i[e]+Xo.IX.start(o.indices),a=i[e]+Xo.IX.end(o.indices)
n(Xo.IX.ofBounds(t,a))&&(r=!0)}else for(let t=0,a=o.indices.length;t<a;t++){const a=i[e]+o.indices[t]
n(Xo.IX.ofSingleton(a))&&(r=!0)}}return r}function Lh(e,t,n){const{objectId:r,groupId:i}=e
if(n===r){if(i===Rp.$.Null)return Or.Structure.Loci(t)
{const{unitIndices:e,cumulativeUnitElementCount:n}=t.serialMapping,r=e[i],o=t.units[r],a=i-n[r],s=Xo.CD.ofSingleton(a)
return Or.StructureElement.Loci(t,[{unit:o,indices:s}])}}return Xr.EmptyLoci}var Nh
!function(e){e.fromGroup=function(e){const{group:t,structure:n}=e,r=t.elements.length,i=t.units.length,o=Or.StructureElement.Location.create(n)
return(0,Dp.iQ)(r,i,1,(e,n)=>{const r=t.units[n]
return o.unit=r,o.element=r.elements[e],o})},e.fromStructure=function(e){const{units:t,elementCount:n}=e,r=n,{unitIndices:i,elementIndices:o}=e.serialMapping,a=Or.StructureElement.Location.create(e)
return(0,Dp.iQ)(r,1,1,e=>(a.unit=t[i[e]],a.element=o[e],a),!0)}}(Nh||(Nh={}))
const Fh={sizeFactor:Vr.t.Numeric(1,{min:0,max:10,step:.1}),detail:Vr.t.Numeric(0,{min:0,max:3,step:1},Mr.iy.CustomQualityParamInfo),ignoreHydrogens:Vr.t.Boolean(!1),ignoreHydrogensVariant:Vr.t.Select("all",Vr.t.arrayToOptions(["all","non-polar"])),traceOnly:Vr.t.Boolean(!1),tryUseImpostor:Vr.t.Boolean(!0),stride:Vr.t.Numeric(1,{min:1,max:100,step:1})},zh={...Ep.Te,...Ep.qg,...Fh}
function jh(e,t,n,r){return n.tryUseImpostor&&(0,Op.gU)(r)?function(e){return(0,Ep.uF)({defaultProps:Vr.t.getDefaultValues(zh),createGeometry:Eh,createLocationIterator:Nh.fromGroup,getLoci:Dh,eachLocation:kh,setUpdateState:(e,t,n)=>{e.createGeometry=t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||t.traceOnly!==n.traceOnly||t.stride!==n.stride},mustRecreate:(e,t,n)=>!t.tryUseImpostor||!n},e)}(e):function(e){return(0,Ep.Pv)({defaultProps:Vr.t.getDefaultValues(zh),createGeometry:Bh,createLocationIterator:Nh.fromGroup,getLoci:Dh,eachLocation:kh,setUpdateState:(e,t,n)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.detail!==n.detail||t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||t.traceOnly!==n.traceOnly||t.stride!==n.stride},mustRecreate:(e,t,n)=>t.tryUseImpostor&&!!n},e)}(e)}const Vh={...th.EN,...th.T9,...Fh}
function Uh(e,t,n,r){return n.tryUseImpostor&&r&&r.extensions.fragDepth&&r.extensions.textureFloat?function(e){return(0,th.zo)({defaultProps:Vr.t.getDefaultValues(Vh),createGeometry:Rh,createLocationIterator:Nh.fromStructure,getLoci:Lh,eachLocation:Oh,setUpdateState:(e,t,n)=>{e.createGeometry=t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||t.traceOnly!==n.traceOnly||t.stride!==n.stride},mustRecreate:(e,t,n)=>!t.tryUseImpostor||!n},e)}(e):function(e){return(0,th.wA)({defaultProps:Vr.t.getDefaultValues(Vh),createGeometry:Mh,createLocationIterator:Nh.fromStructure,getLoci:Lh,eachLocation:Oh,setUpdateState:(e,t,n)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.detail!==n.detail||t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||t.traceOnly!==n.traceOnly||t.stride!==n.stride},mustRecreate:(e,t,n)=>t.tryUseImpostor&&!!n},e)}(e)}var Gh=n(25382),Hh=n(59792),qh=n(32751),Qh=n(31312)
const $h={"element-sphere":(e,t)=>(0,Gh.T)("Element sphere",e,t,jh),"intra-bond":(e,t)=>(0,Gh.T)("Intra-unit bond cylinder",e,t,sh),"inter-bond":(e,t)=>(0,Hh.K)("Inter-unit bond cylinder",e,t,Sh),"structure-element-sphere":(e,t)=>(0,Hh.K)("Structure element sphere",e,t,Uh),"structure-intra-bond":(e,t)=>(0,Hh.K)("Structure intra-unit bond cylinder",e,t,ph)},Xh={...zh,traceOnly:Vr.t.Boolean(!1,{isHidden:!0}),...ah,...xh,includeParent:Vr.t.Boolean(!1),unitKinds:(0,Qh.R8)(["atomic"]),sizeFactor:Vr.t.Numeric(.15,{min:.01,max:10,step:.01}),sizeAspectRatio:Vr.t.Numeric(2/3,{min:.01,max:3,step:.01}),visuals:Vr.t.MultiSelect(["element-sphere","intra-bond","inter-bond"],Vr.t.objectToOptions($h)),bumpFrequency:Vr.t.Numeric(0,{min:0,max:10,step:.1},Mr.iy.ShadingCategory),density:Vr.t.Numeric(.1,{min:0,max:1,step:.01},Mr.iy.ShadingCategory)},Wh=(0,qh.GT)({name:"ball-and-stick",label:"Ball & Stick",description:"Displays atoms as spheres and bonds as cylinders.",factory:function(e,t){return vo.YL.createMulti("Ball & Stick",e,t,qh.J1,$h)},getParams:function(e,t){let n=Xh
return Or.Structure.getSize(t)>=Or.Structure.Size.Huge?(n=Vr.t.clone(n),n.visuals.defaultValue=["element-sphere","intra-bond"]):t.unitSymmetryGroups.length>5e3&&(n=Vr.t.clone(n),n.visuals.defaultValue=["structure-element-sphere","structure-intra-bond"]),n},defaultValues:Vr.t.getDefaultValues(Xh),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:e=>e.elementCount>0,getData:(e,t)=>t.includeParent?e.asParent():e,mustRecreate:(e,t)=>e.includeParent!==t.includeParent})
function Yh(e,t,n,r,i){const{links:o,elements:a}=t.carbohydrates,{linkSizeFactor:s}=r,l=Or.StructureElement.Location.create(t),c={linkCount:o.length,position:(e,t,n)=>{const r=o[n]
Ta.eB.copy(e,a[r.carbohydrateIndexA].geometry.center),Ta.eB.copy(t,a[r.carbohydrateIndexB].geometry.center)},radius:e=>{const t=o[e],r=a[t.carbohydrateIndexA],i=r.unit.rings.all[r.ringIndex]
return l.unit=r.unit,l.element=r.unit.elements[i[0]],n.size.size(l)*s}},{mesh:u,boundingSphere:d}=(0,Bp.C1)(e,c,r,i)
if(d)u.setBoundingSphere(d)
else if(u.triangleCount>0){const e=hd.f8.expand((0,hd.f8)(),t.boundary.sphere,1*s)
u.setBoundingSphere(e)}return u}const Zh={...Ep.Te,...Bp.Lr,linkSizeFactor:Vr.t.Numeric(.3,{min:0,max:3,step:.01})}
function Kh(e){return(0,th.wA)({defaultProps:Vr.t.getDefaultValues(Zh),createGeometry:Yh,createLocationIterator:Jh,getLoci:ef,eachLocation:nf,setUpdateState:(e,t,n)=>{e.createGeometry=t.linkSizeFactor!==n.linkSizeFactor||t.radialSegments!==n.radialSegments||t.linkCap!==n.linkCap}},e)}function Jh(e){const{elements:t,links:n}=e.carbohydrates,r=n.length,i=Or.StructureElement.Location.create(e)
return(0,Dp.iQ)(r,1,1,e=>{const r=n[e],o=t[r.carbohydrateIndexA],a=o.unit.rings.all[o.ringIndex]
return i.unit=o.unit,i.element=o.unit.elements[a[0]],i},!0)}function ef(e,t,n){const{objectId:r,groupId:i}=e
if(n===r){if(i===Rp.$.Null)return Or.Structure.Loci(t)
{const{links:e,elements:n}=t.carbohydrates,r=e[i],o=n[r.carbohydrateIndexA],a=n[r.carbohydrateIndexB]
return Or.StructureElement.Loci.union((0,Op.rS)(t,o.unit,o.residueIndex,o.altId),(0,Op.rS)(t,a.unit,a.residueIndex,a.altId))}}return Xr.EmptyLoci}const tf=new Set
function nf(e,t,n){let r=!1
if(!Or.StructureElement.Loci.is(e))return!1
if(!Or.Structure.areEquivalent(e.structure,t))return!1
const{getLinkIndices:i}=t.carbohydrates
for(const{unit:o,indices:a}of e.elements)Or.Unit.isAtomic(o)&&(tf.clear(),Xo.CD.forEach(a,e=>{const t=i(o,o.elements[e])
for(let i=0,o=t.length;i<o;++i)tf.has(t[i])||(tf.add(t[i]),n(Xo.IX.ofSingleton(t[i]))&&(r=!0))}))
return r}var rf=n(71545),of=n(40165),af=n(1654)
const sf=Ta.eB.create(0,0,-.5),lf=Ta.eB.create(0,0,.5),cf=(0,Ta.eB)(),uf=(0,Ta.eB)(),df=(0,Ta.eB)(),pf=(0,Ta.eB)()
let hf,ff
const mf={pointCount:5,outerRadius:1,innerRadius:.5,thickness:.3},gf=Ta.eB.zero(),yf=Ta.eB.zero(),vf=Ta.eB.zero(),bf=Ta.eB.zero(),xf=Ta.eB.zero(),Sf=[.5,0,0,-.5,0,0,0,.5,0,0,-.5,0,0,0,.5,0,0,-.5]
let _f,Cf;(0,n(34322).L3)(Sf,[0,2,1,3,2,1,3,0,0,4,1,4,2,4,3,4,0,5,1,5,2,5,3,5])
var wf=n(64361),Tf=n(11350)
const Af=Ta.$I.identity(),If=(0,Ta.eB)(),Pf=(0,Ta.eB)(),Bf=(0,rf.az)(),Ef=(0,rf.wV)(),kf=(hf||(hf=function(e){const t=e.length/3,n=(3===t?1:4===t?2:t)+t,r=4===t?3*t+4:3*n,i=(0,of.nT)(n,r)
for(let o=0;o<t;++o){const n=(o+1)%t
Ta.eB.set(cf,e[3*o],e[3*o+1],-.5),Ta.eB.set(uf,e[3*n],e[3*n+1],-.5),i.add(cf,uf,lf)}if(3===t)Ta.eB.set(cf,e[0],e[1],-.5),Ta.eB.set(uf,e[3],e[4],-.5),Ta.eB.set(df,e[6],e[7],-.5),i.add(df,uf,cf)
else if(4===t)Ta.eB.set(cf,e[0],e[1],-.5),Ta.eB.set(uf,e[3],e[4],-.5),Ta.eB.set(df,e[6],e[7],-.5),Ta.eB.set(pf,e[9],e[10],-.5),i.addQuad(pf,df,uf,cf)
else for(let o=0;o<t;++o){const n=(o+1)%t
Ta.eB.set(cf,e[3*o],e[3*o+1],-.5),Ta.eB.set(uf,e[3*n],e[3*n+1],-.5),i.add(sf,uf,cf)}return i.getPrimitive()}((0,af.n)(8,!0))),hf),Df=function(){if(!ff){const e=(0,af.n)(8,!0),t=new Float32Array(30)
for(let r=0;r<8;++r)t[3*r]=e[3*r],t[3*r+1]=e[3*r+1],t[3*r+2]=-.5
t[24]=0,t[25]=0,t[26]=-.5,t[27]=0,t[28]=0,t[29]=.5
const n=[0,1,8,1,2,8,4,5,8,5,6,8,2,3,9,3,4,9,6,7,9,7,0,9]
ff=(0,of.m9)(t,n)}return ff}(),Mf=function(){const{outerRadius:e,innerRadius:t,thickness:n,pointCount:r}={...mf,outerRadius:1,innerRadius:.5,thickness:.5,pointCount:5},i=2*r*2,o=(0,of.nT)(i),a=new Float32Array(2*r),s=new Float32Array(2*r)
for(let l=0;l<r;++l){const n=2*l,i=2*l+1,o=(n+1)/r*Math.PI,c=(i+1)/r*Math.PI
s[n]=Math.cos(o)*e,s[i]=Math.sin(o)*e,a[n]=Math.cos(c)*t,a[i]=Math.sin(c)*t}Ta.eB.set(gf,0,0,n/2),Ta.eB.set(yf,0,0,-n/2)
for(let l=0;l<r;++l){const e=(l+1)%r
Ta.eB.set(vf,s[2*l],s[2*l+1],0),Ta.eB.set(bf,a[2*l],a[2*l+1],0),Ta.eB.set(xf,s[2*e],s[2*e+1],0),o.add(gf,vf,bf),o.add(bf,vf,yf),o.add(gf,bf,xf),o.add(xf,bf,yf)}return o.getPrimitive()}(),Rf=(_f||(_f=(0,of.m9)(Sf,[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2])),_f),Of=(Cf||(Cf=(0,of.m9)(Sf,[0,2,4,0,4,3,1,2,5,1,5,3])),Cf),Lf=(0,wf.uo)(),Nf=(0,wf.r7)(),Ff=(0,wf.jg)(),zf=(0,wf.SM)(),jf=(0,wf.VH)()
function Vf(e,t,n,r,i){const o=Ch.P.createState(256,128,i),{detail:a,sizeFactor:s}=r,l=t.carbohydrates,c=l.elements.length,u=Or.StructureElement.Location.create(t)
for(let d=0;d<c;++d){const e=l.elements[d],t=e.unit.rings.all[e.ringIndex],r=(0,Tf.N0)(e.component.type,t.length)
u.unit=e.unit,u.element=e.unit.elements[t[0]]
const i=n.size.size(u),c=i*s,p=i*s*1.612,{center:h,normal:f,direction:m}=e.geometry
switch(Ta.eB.add(Pf,h,m),Ta.$I.targetTo(Af,h,Pf,f),Ta.$I.setTranslation(Af,h),o.currentGroup=2*d,r){case Tf.RP.FilledSphere:(0,wh.X)(o,h,c,a)
break
case Tf.RP.FilledCube:Ta.$I.scaleUniformly(Af,Af,p),Ch.P.addPrimitive(o,Af,Bf)
break
case Tf.RP.CrossedCube:Ta.$I.scaleUniformly(Af,Af,p),Ch.P.addPrimitive(o,Af,Ef),Ta.$I.mul(Af,Af,Ta.$I.rotZ90X180),o.currentGroup+=1,Ch.P.addPrimitive(o,Af,Ef)
break
case Tf.RP.FilledCone:Ta.$I.scaleUniformly(Af,Af,1.2*p),Ch.P.addPrimitive(o,Af,kf)
break
case Tf.RP.DevidedCone:Ta.$I.scaleUniformly(Af,Af,1.2*p),Ch.P.addPrimitive(o,Af,Df),Ta.$I.mul(Af,Af,Ta.$I.rotZ90),o.currentGroup+=1,Ch.P.addPrimitive(o,Af,Df)
break
case Tf.RP.FlatBox:Ta.$I.mul(Af,Af,Ta.$I.rotZY90),Ta.$I.scale(Af,Af,Ta.eB.set(If,p,p,p/2)),Ch.P.addPrimitive(o,Af,Bf)
break
case Tf.RP.FilledStar:Ta.$I.scaleUniformly(Af,Af,p),Ta.$I.mul(Af,Af,Ta.$I.rotZY90),Ch.P.addPrimitive(o,Af,Mf)
break
case Tf.RP.FilledDiamond:Ta.$I.mul(Af,Af,Ta.$I.rotZY90),Ta.$I.scale(Af,Af,Ta.eB.set(If,1.4*p,1.4*p,1.4*p)),Ch.P.addPrimitive(o,Af,Rf)
break
case Tf.RP.DividedDiamond:Ta.$I.mul(Af,Af,Ta.$I.rotZY90),Ta.$I.scale(Af,Af,Ta.eB.set(If,1.4*p,1.4*p,1.4*p)),Ch.P.addPrimitive(o,Af,Of),Ta.$I.mul(Af,Af,Ta.$I.rotY90),o.currentGroup+=1,Ch.P.addPrimitive(o,Af,Of)
break
case Tf.RP.FlatDiamond:Ta.$I.mul(Af,Af,Ta.$I.rotZY90),Ta.$I.scale(Af,Af,Ta.eB.set(If,p,p/2,p/2)),Ch.P.addPrimitive(o,Af,Lf)
break
case Tf.RP.DiamondPrism:Ta.$I.mul(Af,Af,Ta.$I.rotZY90),Ta.$I.scale(Af,Af,Ta.eB.set(If,p,p,p/2)),Ch.P.addPrimitive(o,Af,Lf)
break
case Tf.RP.PentagonalPrism:case Tf.RP.Pentagon:Ta.$I.mul(Af,Af,Ta.$I.rotZY90),Ta.$I.scale(Af,Af,Ta.eB.set(If,p,p,p/2)),Ch.P.addPrimitive(o,Af,Nf)
break
case Tf.RP.HexagonalPrism:Ta.$I.mul(Af,Af,Ta.$I.rotZY90),Ta.$I.scale(Af,Af,Ta.eB.set(If,p,p,p/2)),Ch.P.addPrimitive(o,Af,Ff)
break
case Tf.RP.HeptagonalPrism:Ta.$I.mul(Af,Af,Ta.$I.rotZY90),Ta.$I.scale(Af,Af,Ta.eB.set(If,p,p,p/2)),Ch.P.addPrimitive(o,Af,jf)
break
case Tf.RP.FlatHexagon:default:Ta.$I.mul(Af,Af,Ta.$I.rotZYZ90),Ta.$I.scale(Af,Af,Ta.eB.set(If,p/1.5,p,p/2)),Ch.P.addPrimitive(o,Af,zf)}}return Ch.P.getMesh(o)}const Uf={...th.EN,detail:Vr.t.Numeric(0,{min:0,max:3,step:1},Mr.iy.CustomQualityParamInfo),sizeFactor:Vr.t.Numeric(1.75,{min:0,max:10,step:.01})}
function Gf(e){return(0,th.wA)({defaultProps:Vr.t.getDefaultValues(Uf),createGeometry:Vf,createLocationIterator:Hf,getLoci:qf,eachLocation:$f,setUpdateState:(e,t,n)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.detail!==n.detail}},e)}function Hf(e){const t=e.carbohydrates.elements,n=2*t.length,r=Or.StructureElement.Location.create(e)
return(0,Dp.iQ)(n,1,1,function(e,n){const i=t[Math.floor(e/2)],o=i.unit.rings.all[i.ringIndex]
return r.unit=i.unit,r.element=i.unit.elements[o[0]],r},!0,function(e,t){return e%2==1})}function qf(e,t,n){const{objectId:r,groupId:i}=e
if(n===r){if(i===Rp.$.Null)return Or.Structure.Loci(t)
{const e=t.carbohydrates.elements[Math.floor(i/2)]
return(0,Op.rS)(t,e.unit,e.residueIndex,e.altId)}}return Xr.EmptyLoci}const Qf=new Set
function $f(e,t,n){const{getElementIndices:r}=t.carbohydrates
let i=!1
if(!Or.StructureElement.Loci.is(e))return!1
if(!Or.Structure.areEquivalent(e.structure,t))return!1
for(const{unit:o,indices:a}of e.elements)Or.Unit.isAtomic(o)&&(Qf.clear(),Xo.CD.forEach(a,e=>{const t=r(o,o.elements[e])
for(let r=0,o=t.length;r<o;++r)Qf.has(t[r])||(Qf.add(t[r]),n(Xo.IX.ofSingleton(2*t[r]))&&(i=!0))}))
return i}var Xf=n(8507)
function Wf(e,t,n,r,i){const{terminalLinks:o,elements:a}=t.carbohydrates,{terminalLinkSizeFactor:s}=r,l=Or.StructureElement.Location.create(t),c={linkCount:o.length,position:(e,t,n)=>{const r=o[n]
r.fromCarbohydrate?(Ta.eB.copy(e,a[r.carbohydrateIndex].geometry.center),r.elementUnit.conformation.position(r.elementUnit.elements[r.elementIndex],t)):(r.elementUnit.conformation.position(r.elementUnit.elements[r.elementIndex],e),Ta.eB.copy(t,a[r.carbohydrateIndex].geometry.center))},radius:e=>{const t=o[e]
if(t.fromCarbohydrate){const e=a[t.carbohydrateIndex],n=e.unit.rings.all[e.ringIndex]
l.unit=e.unit,l.element=e.unit.elements[n[0]]}else l.unit=t.elementUnit,l.element=t.elementUnit.elements[t.elementIndex]
return n.size.size(l)*s},style:e=>{const t=o[e],n=t.elementUnit.elements[t.elementIndex],r=(0,Xf.Yd)(t.elementUnit.model.atomicHierarchy.atoms.type_symbol.value(n))
return Xf.ZL.has(r)?Bp.gK.Dashed:Bp.gK.Solid}},{mesh:u,boundingSphere:d}=(0,Bp.C1)(e,c,r,i)
if(d)u.setBoundingSphere(d)
else if(u.triangleCount>0){const e=hd.f8.expand((0,hd.f8)(),t.boundary.sphere,1*s)
u.setBoundingSphere(e)}return u}const Yf={...Ep.Te,...Bp.Lr,terminalLinkSizeFactor:Vr.t.Numeric(.2,{min:0,max:3,step:.01})}
function Zf(e){return(0,th.wA)({defaultProps:Vr.t.getDefaultValues(Yf),createGeometry:Wf,createLocationIterator:Kf,getLoci:Jf,eachLocation:tm,setUpdateState:(e,t,n)=>{e.createGeometry=t.terminalLinkSizeFactor!==n.terminalLinkSizeFactor||t.radialSegments!==n.radialSegments||t.linkCap!==n.linkCap}},e)}function Kf(e){const{elements:t,terminalLinks:n}=e.carbohydrates,r=n.length,i=Or.StructureElement.Location.create(e)
return(0,Dp.iQ)(r,1,1,e=>{const r=n[e]
if(r.fromCarbohydrate){const e=t[r.carbohydrateIndex],n=e.unit.rings.all[e.ringIndex]
i.unit=e.unit,i.element=e.unit.elements[n[0]]}else i.unit=r.elementUnit,i.element=r.elementUnit.elements[r.elementIndex]
return i},!0)}function Jf(e,t,n){const{objectId:r,groupId:i}=e
if(n===r){if(i===Rp.$.Null)return Or.Structure.Loci(t)
{const{terminalLinks:e,elements:n}=t.carbohydrates,r=e[i],o=n[r.carbohydrateIndex]
return Or.StructureElement.Loci.union((0,Op.rS)(t,o.unit,o.residueIndex,o.altId),(0,Op.uh)(t,r.elementUnit,r.elementUnit.elements[r.elementIndex]))}}return Xr.EmptyLoci}const em=new Set
function tm(e,t,n){let r=!1
if(!Or.StructureElement.Loci.is(e))return!1
if(!Or.Structure.areEquivalent(e.structure,t))return!1
const{getTerminalLinkIndices:i}=t.carbohydrates
for(const{unit:o,indices:a}of e.elements)Or.Unit.isAtomic(o)&&(em.clear(),Xo.CD.forEach(a,e=>{const t=i(o,o.elements[e])
for(let i=0,o=t.length;i<o;++i)em.has(t[i])||(em.add(t[i]),n(Xo.IX.ofSingleton(t[i]))&&(r=!0))}))
return r}const nm={"carbohydrate-symbol":(e,t)=>(0,Hh.K)("Carbohydrate symbol mesh",e,t,Gf),"carbohydrate-link":(e,t)=>(0,Hh.K)("Carbohydrate link cylinder",e,t,Kh),"carbohydrate-terminal-link":(e,t)=>(0,Hh.K)("Carbohydrate terminal link cylinder",e,t,Zf)},rm={...Uf,...Zh,...Yf,visuals:Vr.t.MultiSelect(["carbohydrate-symbol","carbohydrate-link","carbohydrate-terminal-link"],Vr.t.objectToOptions(nm)),bumpFrequency:Vr.t.Numeric(0,{min:0,max:10,step:.1},Mr.iy.ShadingCategory),density:Vr.t.Numeric(.2,{min:0,max:1,step:.01},Mr.iy.ShadingCategory)},im=(0,qh.GT)({name:"carbohydrate",label:"Carbohydrate",description:"Displays carbohydrate symbols (3D SNFG).",factory:function(e,t){return vo.YL.createMulti("Carbohydrate",e,t,qh.J1,nm)},getParams:function(e,t){return rm},defaultValues:Vr.t.getDefaultValues(rm),defaultColorTheme:{name:"carbohydrate-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.models.some(e=>Or.Model.hasCarbohydrate(e))})
var om=n(96005),am=n(65939),sm=n(10773)
function lm(e,t){switch(e.kind){case Or.Unit.Kind.Atomic:return function(e,t){const n=e.model.atomicRanges.cyclicPolymerMap,r=sm.m.transientSegments(og(e),e.elements),i=am.h.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),o=e.model.atomicHierarchy.derived.residue.traceElementIndex,{moleculeType:a}=e.model.atomicHierarchy.derived.residue
let s=-1,l=-1,c=!0,u=-1,d=0
for(;r.hasNext;){for(c=!0,u=d,i.setSegment(r.move());i.hasNext;){if(c){const e=i.move().index
if(++d,!i.hasNext)continue
c=!1,l=e}s=l,l=i.move().index,t(o[s],o[l],d-1,d,a[s]),++d}n.has(l)&&(s=l,l=n.get(s),t(o[s],o[l],d-1,u,a[s]))}}(e,t)
case Or.Unit.Kind.Spheres:case Or.Unit.Kind.Gaussians:return function(e,t){const n=sm.m.transientSegments(og(e),e.elements),{elements:r}=e
let i=!0,o=0
for(;n.hasNext;){i=!0
const e=n.move()
for(let n=e.start,a=e.end;n<a;++n){if(i){if(++n,++o,n>a)continue
i=!1}t(r[n-1],r[n],o-1,o,0),++o}}}(e,t)}}function cm(e,t){switch(e.kind){case Or.Unit.Kind.Atomic:return function(e,t){const n=sm.m.transientSegments(og(e),e.elements),r=am.h.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),i=e.model.atomicHierarchy.derived.residue.traceElementIndex
let o=0
for(;n.hasNext;)for(r.setSegment(n.move());r.hasNext;)t(i[r.move().index],o),++o}(e,t)
case Or.Unit.Kind.Spheres:case Or.Unit.Kind.Gaussians:return function(e,t){const n=sm.m.transientSegments(og(e),e.elements),{elements:r}=e
let i=0
for(;n.hasNext;){const e=n.move()
for(let n=e.start,o=e.end;n<o;++n)t(r[n],i),++i}}(e,t)}}function um(e,t){return{centerA:Or.StructureElement.Location.create(e,t),centerB:Or.StructureElement.Location.create(e,t)}}class dm{move(){const{elements:e,residueIndex:t}=this.unit,n=this.gapIt.move()
return this.value.centerA.element=this.traceElementIndex[t[e[n.start]]],this.value.centerB.element=this.traceElementIndex[t[e[n.end-1]]],this.hasNext=this.gapIt.hasNext,this.value}constructor(e,t){this.unit=t,this.hasNext=!1,this.traceElementIndex=t.model.atomicHierarchy.derived.residue.traceElementIndex,this.gapIt=sm.m.transientSegments(ag(t),t.elements),this.value=um(e,t),this.hasNext=this.gapIt.hasNext}}class pm{move(){const e=this.gapIt.move()
return this.value.centerA.element=this.unit.elements[e.start],this.value.centerB.element=this.unit.elements[e.end-1],this.hasNext=this.gapIt.hasNext,this.value}constructor(e,t){this.unit=t,this.hasNext=!1,this.gapIt=sm.m.transientSegments(ag(t),t.elements),this.value=um(e,t),this.hasNext=this.gapIt.hasNext}}var hm=n(30897),fm=n(33205)
function mm(e){const{x:t,y:n,z:r}=e.atomicConformation,{polymerType:i,traceElementIndex:o}=e.atomicHierarchy.derived.residue,a=i.length,s=Xo.CD.ofBounds(0,e.atomicConformation.atomId.rowCount),l=sm.m.transientSegments(e.atomicRanges.polymerRanges,s),c=am.h.transientSegments(e.atomicHierarchy.residueAtomSegments,s),u=new Float32Array(3*a),d=new Float32Array(3*a)
let p=0,h=-1,f=-1
const m=(0,Ta.eB)(),g=(0,Ta.eB)(),y=(0,Ta.eB)(),v=(0,Ta.eB)(),b=(0,Ta.eB)(),x=(0,Ta.eB)(),S=(0,Ta.eB)(),_=(0,Ta.eB)(),C=(0,Ta.eB)(),w=(0,Ta.eB)(),T=(0,Ta.eB)(),A=(0,Ta.eB)(),I=(0,Ta.eB)(),P=(0,Ta.eB)()
for(;l.hasNext;){const e=l.move()
for(c.setSegment(e),p=-1,f=-1;c.hasNext;){p+=1
const{index:e}=c.move()
0===p&&(f=e),h=e-2
const i=3*h
Ta.eB.copy(m,g),Ta.eB.copy(g,y),Ta.eB.copy(y,v)
const a=o[e]
if(Ta.eB.set(v,t[a],n[a],r[a]),p<3)continue
Ta.eB.sub(b,g,m),Ta.eB.sub(x,y,g),Ta.eB.sub(S,v,y),Ta.eB.sub(T,b,x),Ta.eB.sub(A,x,S),Ta.eB.cross(I,T,A),Ta.eB.normalize(I,I),Ta.eB.toArray(I,d,i)
const s=Math.cos(Ta.eB.angle(T,A)),l=Ta.eB.magnitude(T),w=Ta.eB.magnitude(A),B=Math.sqrt(w*l)/Math.max(2,2*(1-s))
Ta.eB.scale(_,T,B/l),Ta.eB.sub(_,g,_),Ta.eB.toArray(_,u,i),Ta.eB.scale(C,A,B/w),Ta.eB.sub(C,y,C),Ta.eB.toArray(C,u,i+3),Ta.eB.copy(P,I)}const i=3*f
Ta.eB.fromArray(_,u,i+3),Ta.eB.fromArray(C,u,i+6),Ta.eB.normalize(I,Ta.eB.sub(I,_,C))
const a=o[f]
Ta.eB.set(m,t[a],n[a],r[a]),Ta.eB.copy(w,m),Ta.eB.projectPointOnVector(w,w,I,_),Ta.eB.toArray(w,u,i)
const s=h+2,B=3*s
Ta.eB.fromArray(_,u,B-3),Ta.eB.fromArray(C,u,B-6),Ta.eB.normalize(I,Ta.eB.sub(I,_,C))
const E=o[s]
Ta.eB.set(m,t[E],n[E],r[E]),Ta.eB.copy(w,m),Ta.eB.projectPointOnVector(w,w,I,_),Ta.eB.toArray(w,u,B)}return{centers:u}}const gm=n(99852)._.createProvider({label:"Helix Orientation",descriptor:(0,fm.e)({name:"molstar_helix_orientation"}),type:"dynamic",defaultParams:{},getParams:()=>({}),isApplicable:e=>!0,obtain:async(e,t)=>({value:mm(t)})})
function ym(e){return kp.SecondaryStructureType.is(e,kp.SecondaryStructureType.Flag.Helix)}function vm(e,t,n={}){switch(e.kind){case Or.Unit.Kind.Atomic:return new Tm(e,t,n)
case Or.Unit.Kind.Spheres:case Or.Unit.Kind.Gaussians:return new Im(e,t)}}const bm=kp.SecondaryStructureType.create(kp.SecondaryStructureType.Flag.NA)
function xm(e,t){return{center:Or.StructureElement.Location.create(e,t),centerPrev:Or.StructureElement.Location.create(e,t),centerNext:Or.StructureElement.Location.create(e,t),first:!1,last:!1,initial:!1,final:!1,secStrucFirst:!1,secStrucLast:!1,secStrucType:bm,moleculeType:kp.MoleculeType.Unknown,coarseBackboneFirst:!1,coarseBackboneLast:!1,p0:(0,Ta.eB)(),p1:(0,Ta.eB)(),p2:(0,Ta.eB)(),p3:(0,Ta.eB)(),p4:(0,Ta.eB)(),d12:(0,Ta.eB)(),d23:(0,Ta.eB)()}}var Sm
!function(e){e[e.nextPolymer=0]="nextPolymer",e[e.nextResidue=1]="nextResidue"}(Sm||(Sm={}))
const _m=(0,Ta.eB)(),Cm=(0,Ta.eB)(),wm=(0,Ta.eB)()
class Tm{atomicPos(e,t){-1!==t&&(e[0]=this.atomicConformation.x[t],e[1]=this.atomicConformation.y[t],e[2]=this.atomicConformation.z[t])}pos(e,t,n){const r=this.traceElementIndex[t]
this.helixOrientationCenters&&ym(n)?Ta.eB.fromArray(e,this.helixOrientationCenters,3*t):this.atomicPos(e,r)}updateResidueSegmentRange(e){const{index:t}=this.residueAtomSegments
this.residueSegmentMin=t[this.polymerRanges[2*e.index]],this.residueSegmentMax=t[this.polymerRanges[2*e.index+1]]}getResidueIndex(e){if(e<this.residueSegmentMin){const t=this.cyclicPolymerMap.get(this.residueSegmentMin)
e=void 0!==t?t-(this.residueSegmentMin-e-1):this.residueSegmentMin}else if(e>this.residueSegmentMax){const t=this.cyclicPolymerMap.get(this.residueSegmentMax)
e=void 0!==t?t+(e-this.residueSegmentMax-1):this.residueSegmentMax}return e}getSecStruc(e){if(this.secondaryStructure){const{type:t,getIndex:n}=this.secondaryStructure,r=t[n(e)]
return ym(r)?kp.SecondaryStructureType.Flag.Helix:r}return bm}setControlPoint(e,t,n,r,i){(function(e){return kp.SecondaryStructureType.is(e,kp.SecondaryStructureType.Flag.Beta)})(i)||this.helixOrientationCenters&&ym(i)?Ta.eB.scale(e,Ta.eB.add(e,t,Ta.eB.add(e,r,Ta.eB.add(e,n,n))),1/4):Ta.eB.copy(e,n)}setFromToVector(e,t,n){this.helixOrientationCenters&&ym(n)?Ta.eB.set(e,1,0,0):(this.atomicPos(Cm,this.directionFromElementIndex[t]),this.atomicPos(wm,this.directionToElementIndex[t]),Ta.eB.sub(e,wm,Cm))}setDirection(e,t,n,r){Ta.eB.matchDirection(Cm,t,n),Ta.eB.matchDirection(wm,r,n),Ta.eB.scale(e,Ta.eB.add(e,Cm,Ta.eB.add(e,wm,Ta.eB.add(e,n,n))),1/4)}move(){const{residueIt:e,polymerIt:t,value:n}=this
if(this.state===Sm.nextPolymer)for(;t.hasNext;)if(this.polymerSegment=t.move(),e.setSegment(this.polymerSegment),this.updateResidueSegmentRange(this.polymerSegment),e.hasNext){this.state=Sm.nextResidue
const e=this.residueAtomSegments.index[this.unit.elements[this.polymerSegment.start]],t=this.getResidueIndex(e-1)
this.currSecStrucType=e===t?bm:this.getSecStruc(t),this.nextSecStrucType=this.getSecStruc(e),this.currCoarseBackbone=-1===this.directionFromElementIndex[t]||-1===this.directionToElementIndex[t],this.nextCoarseBackbone=-1===this.directionFromElementIndex[e]||-1===this.directionToElementIndex[e]
break}if(this.state===Sm.nextResidue){const{index:t}=e.move(),r=this.getResidueIndex(t-3),i=this.getResidueIndex(t-2),o=this.getResidueIndex(t-1),a=this.getResidueIndex(t+1),s=this.getResidueIndex(t+2),l=this.getResidueIndex(t+3)
this.prevSecStrucType=this.getSecStruc(o),this.currSecStrucType=this.getSecStruc(t),this.nextSecStrucType=t===a?bm:this.getSecStruc(a),this.prevCoarseBackbone=this.currCoarseBackbone,this.currCoarseBackbone=this.nextCoarseBackbone,this.nextCoarseBackbone=-1===this.directionFromElementIndex[a]||-1===this.directionToElementIndex[a],n.secStrucType=this.currSecStrucType,n.secStrucFirst=this.prevSecStrucType!==this.currSecStrucType,n.secStrucLast=this.currSecStrucType!==this.nextSecStrucType,n.coarseBackboneFirst=this.prevCoarseBackbone!==this.currCoarseBackbone,n.coarseBackboneLast=this.currCoarseBackbone!==this.nextCoarseBackbone,n.first=t===this.residueSegmentMin,n.last=t===this.residueSegmentMax,n.moleculeType=this.moleculeType[t],n.initial=t===o,n.final=t===a,n.centerPrev.element=this.traceElementIndex[o],n.center.element=this.traceElementIndex[t],n.centerNext.element=this.traceElementIndex[a]
const c=this.getSecStruc(r),u=this.getSecStruc(i),d=this.getSecStruc(o),p=this.getSecStruc(t),h=this.getSecStruc(a),f=this.getSecStruc(s),m=this.getSecStruc(l)
this.pos(this.p0,r,c),this.pos(this.p1,i,u),this.pos(this.p2,o,d),this.pos(this.p3,t,p),this.pos(this.p4,a,h),this.pos(this.p5,s,f),this.pos(this.p6,l,m)
const g=ym(c),y=ym(u),v=ym(d),b=ym(p),x=ym(h),S=ym(f),_=ym(m)
!this.helixOrientationCenters||b&&n.secStrucFirst&&n.secStrucLast||(b!==v?b?(Ta.eB.copy(this.p0,this.p3),Ta.eB.copy(this.p1,this.p3),Ta.eB.copy(this.p2,this.p3)):v&&(Ta.eB.scale(_m,Ta.eB.sub(_m,this.p2,this.p3),2),Ta.eB.add(this.p2,this.p3,_m),Ta.eB.add(this.p1,this.p2,_m),Ta.eB.add(this.p0,this.p1,_m)):b!==y?b?(Ta.eB.copy(this.p0,this.p2),Ta.eB.copy(this.p1,this.p2)):y&&(Ta.eB.scale(_m,Ta.eB.sub(_m,this.p1,this.p2),2),Ta.eB.add(this.p1,this.p2,_m),Ta.eB.add(this.p0,this.p1,_m)):b!==g&&(b?Ta.eB.copy(this.p0,this.p1):g&&(Ta.eB.scale(_m,Ta.eB.sub(_m,this.p0,this.p1),2),Ta.eB.add(this.p0,this.p1,_m))),b!==x?b?(Ta.eB.copy(this.p4,this.p3),Ta.eB.copy(this.p5,this.p3),Ta.eB.copy(this.p6,this.p3)):x&&(Ta.eB.scale(_m,Ta.eB.sub(_m,this.p4,this.p3),2),Ta.eB.add(this.p4,this.p3,_m),Ta.eB.add(this.p5,this.p4,_m),Ta.eB.add(this.p6,this.p5,_m)):b!==S?b?(Ta.eB.copy(this.p5,this.p4),Ta.eB.copy(this.p6,this.p4)):S&&(Ta.eB.scale(_m,Ta.eB.sub(_m,this.p5,this.p4),2),Ta.eB.add(this.p5,this.p4,_m),Ta.eB.add(this.p6,this.p5,_m)):b!==_&&(b?Ta.eB.copy(this.p6,this.p5):_&&(Ta.eB.scale(_m,Ta.eB.sub(_m,this.p6,this.p5),2),Ta.eB.add(this.p6,this.p5,_m)))),this.currCoarseBackbone?(Ta.eB.triangleNormal(this.d01,this.p1,this.p2,this.p3),Ta.eB.triangleNormal(this.d12,this.p2,this.p3,this.p4),Ta.eB.triangleNormal(this.d23,this.p3,this.p4,this.p5),Ta.eB.triangleNormal(this.d34,this.p4,this.p5,this.p6)):(this.setFromToVector(this.d01,o,d),this.setFromToVector(this.d12,t,p),this.setFromToVector(this.d23,a,h),this.setFromToVector(this.d34,s,f))
const C=b&&this.helixOrientationCenters,w=1.5
t===o||p!==d&&C?(Ta.eB.setMagnitude(_m,Ta.eB.sub(_m,this.p3,this.p4),w),Ta.eB.add(this.p2,this.p3,_m),Ta.eB.add(this.p1,this.p2,_m),Ta.eB.add(this.p0,this.p1,_m)):o===i||p!==u&&C?(Ta.eB.setMagnitude(_m,Ta.eB.sub(_m,this.p2,this.p3),w),Ta.eB.add(this.p1,this.p2,_m),Ta.eB.add(this.p0,this.p1,_m)):(i===r||p!==c&&C)&&(Ta.eB.setMagnitude(_m,Ta.eB.sub(_m,this.p1,this.p2),w),Ta.eB.add(this.p0,this.p1,_m)),t===a||p!==h&&C?(Ta.eB.setMagnitude(_m,Ta.eB.sub(_m,this.p3,this.p2),w),Ta.eB.add(this.p4,this.p3,_m),Ta.eB.add(this.p5,this.p4,_m),Ta.eB.add(this.p6,this.p5,_m)):a===s||p!==f&&C?(Ta.eB.setMagnitude(_m,Ta.eB.sub(_m,this.p4,this.p3),w),Ta.eB.add(this.p5,this.p4,_m),Ta.eB.add(this.p6,this.p5,_m)):(s===l||p!==m&&C)&&(Ta.eB.setMagnitude(_m,Ta.eB.sub(_m,this.p5,this.p4),w),Ta.eB.add(this.p6,this.p5,_m)),this.setControlPoint(n.p0,this.p0,this.p1,this.p2,u),this.setControlPoint(n.p1,this.p1,this.p2,this.p3,d),this.setControlPoint(n.p2,this.p2,this.p3,this.p4,p),this.setControlPoint(n.p3,this.p3,this.p4,this.p5,h),this.setControlPoint(n.p4,this.p4,this.p5,this.p6,f),this.setDirection(n.d12,this.d01,this.d12,this.d23),this.setDirection(n.d23,this.d12,this.d23,this.d34),e.hasNext||(this.state=Sm.nextPolymer)}return this.hasNext=e.hasNext||t.hasNext,this.value}constructor(e,t,n={}){var r
if(this.unit=e,this.state=Sm.nextPolymer,this.p0=(0,Ta.eB)(),this.p1=(0,Ta.eB)(),this.p2=(0,Ta.eB)(),this.p3=(0,Ta.eB)(),this.p4=(0,Ta.eB)(),this.p5=(0,Ta.eB)(),this.p6=(0,Ta.eB)(),this.d01=(0,Ta.eB)(),this.d12=(0,Ta.eB)(),this.d23=(0,Ta.eB)(),this.d34=(0,Ta.eB)(),this.hasNext=!1,this.atomicConformation=e.model.atomicConformation,this.residueAtomSegments=e.model.atomicHierarchy.residueAtomSegments,this.polymerRanges=e.model.atomicRanges.polymerRanges,this.traceElementIndex=e.model.atomicHierarchy.derived.residue.traceElementIndex,this.directionFromElementIndex=e.model.atomicHierarchy.derived.residue.directionFromElementIndex,this.directionToElementIndex=e.model.atomicHierarchy.derived.residue.directionToElementIndex,this.moleculeType=e.model.atomicHierarchy.derived.residue.moleculeType,this.cyclicPolymerMap=e.model.atomicRanges.cyclicPolymerMap,this.polymerIt=sm.m.transientSegments(this.polymerRanges,e.elements),this.residueIt=am.h.transientSegments(this.residueAtomSegments,e.elements),this.value=xm(t,e),this.hasNext=this.residueIt.hasNext&&this.polymerIt.hasNext,n.ignoreSecondaryStructure||(this.secondaryStructure=null===(r=hm.v.get(t).value)||void 0===r?void 0:r.get(e.invariantId)),n.useHelixOrientation){const t=gm.get(e.model).value
if(!t)throw new Error("missing helix-orientation")
this.helixOrientationCenters=t.centers}}}var Am
!function(e){e[e.nextPolymer=0]="nextPolymer",e[e.nextElement=1]="nextElement"}(Am||(Am={}))
class Im{getElementIndex(e){return Math.min(Math.max(this.polymerSegment.start,e),this.polymerSegment.end-1)}pos(e,t){const n=this.unit.elements[t]
e[0]=this.conformation.x[n],e[1]=this.conformation.y[n],e[2]=this.conformation.z[n]}move(){if(this.state===Am.nextPolymer)for(;this.polymerIt.hasNext;)if(this.polymerSegment=this.polymerIt.move(),this.elementIndex=this.polymerSegment.start,this.elementIndex<this.polymerSegment.end){this.state=Am.nextElement
break}if(this.state===Am.nextElement){const e=this.getElementIndex(this.elementIndex-2),t=this.getElementIndex(this.elementIndex-1),n=this.getElementIndex(this.elementIndex+1),r=this.getElementIndex(this.elementIndex+2)
this.value.centerPrev.element=this.value.center.unit.elements[t],this.value.center.element=this.value.center.unit.elements[this.elementIndex],this.value.centerNext.element=this.value.center.unit.elements[n],this.pos(this.value.p0,e),this.pos(this.value.p1,t),this.pos(this.value.p2,this.elementIndex),this.pos(this.value.p3,n),this.pos(this.value.p4,r)
const i=.5
this.elementIndex===t?(Ta.eB.scale(_m,Ta.eB.sub(_m,this.value.p2,this.value.p3),i),Ta.eB.add(this.value.p1,this.value.p2,_m),Ta.eB.add(this.value.p0,this.value.p1,_m)):t===e&&(Ta.eB.scale(_m,Ta.eB.sub(_m,this.value.p1,this.value.p2),i),Ta.eB.add(this.value.p0,this.value.p1,_m)),this.elementIndex===n?(Ta.eB.scale(_m,Ta.eB.sub(_m,this.value.p2,this.value.p1),i),Ta.eB.add(this.value.p3,this.value.p2,_m),Ta.eB.add(this.value.p4,this.value.p3,_m)):n===r&&(Ta.eB.scale(_m,Ta.eB.sub(_m,this.value.p3,this.value.p2),i),Ta.eB.add(this.value.p4,this.value.p3,_m)),this.value.first=this.elementIndex===this.polymerSegment.start,this.value.last=this.elementIndex===this.polymerSegment.end-1,this.elementIndex+1>=this.polymerSegment.end&&(this.state=Am.nextPolymer)}return this.hasNext=this.elementIndex+1<this.polymerSegment.end||this.polymerIt.hasNext,this.elementIndex+=1,this.value}constructor(e,t){switch(this.unit=e,this.state=Am.nextPolymer,this.hasNext=!1,this.polymerIt=sm.m.transientSegments(og(e),e.elements),this.value=xm(t,e),Ta.eB.set(this.value.d12,1,0,0),Ta.eB.set(this.value.d23,1,0,0),e.kind){case Or.Unit.Kind.Spheres:this.conformation=e.model.coarseConformation.spheres
break
case Or.Unit.Kind.Gaussians:this.conformation=e.model.coarseConformation.gaussians}this.hasNext=this.polymerIt.hasNext}}var Pm=n(97564)
const Bm=Ta.eB.fromArray,Em=Ta.eB.toArray,km=Ta.eB.normalize,Dm=Ta.eB.sub,Mm=Ta.eB.spline,Rm=Ta.eB.slerp,Om=Ta.eB.copy,Lm=Ta.eB.cross,Nm=Ta.eB.orthogonalize,Fm=Ta.eB.matchDirection,zm=Ta.eB.scale,jm=Ta.eB.add
function Vm(e){const t=e+1,n=3*t
return{curvePoints:new Float32Array(n),tangentVectors:new Float32Array(n),normalVectors:new Float32Array(n),binormalVectors:new Float32Array(n),widthValues:new Float32Array(t),heightValues:new Float32Array(t),linearSegments:e}}function Um(e,t,n,r){!function(e,t,n,r){const{curvePoints:i,tangentVectors:o,linearSegments:a}=e,{p0:s,p1:l,p2:c,p3:u,p4:d,secStrucFirst:p,secStrucLast:h}=t,f=1-r,m=p?.5:n,g=h?.5:n
for(let y=0;y<=a;++y){const e=1*y/a
if(e<f){const t=(0,Pm.Cc)(m,n,e)
Mm(qm,s,l,c,u,e+r,t),Mm(Gm,s,l,c,u,e+r+.01,m),Mm(Hm,s,l,c,u,e+r-.01,m)}else{const t=(0,Pm.Cc)(n,g,e)
Mm(qm,l,c,u,d,e-f,t),Mm(Gm,l,c,u,d,e-f+.01,t),Mm(Hm,l,c,u,d,e-f-.01,t)}Em(qm,i,3*y),km($m,Dm($m,Gm,Hm)),Em($m,o,3*y)}}(e,t,n,r),function(e,t){const{curvePoints:n,tangentVectors:r,normalVectors:i,binormalVectors:o}=e,{d12:a,d23:s}=t,l=n.length/3
Bm(Km,r,0),Bm(Jm,r,3*(l-1)),Nm(eg,Km,a),Nm(tg,Jm,s),Fm(tg,tg,eg),Om(Ym,eg)
const c=l-1
for(let u=0;u<l;++u){const e=(0,Pm.TF)(0,c,u)*c,t=0===u?0:1/(l-e)
Bm($m,r,3*u),Nm(Xm,$m,Rm(Qm,Ym,tg,t)),Em(Xm,i,3*u),Om(Ym,Xm),km(Wm,Lm(Wm,$m,Xm)),Em(Wm,o,3*u)}for(let u=1;u<c;++u)Bm(Ym,i,3*(u-1)),Bm(Xm,i,3*u),Bm(Zm,i,3*(u+1)),zm(Xm,jm(Xm,Ym,jm(Xm,Zm,Xm)),1/3),Em(Xm,i,3*u),Bm($m,r,3*u),km(Wm,Lm(Wm,$m,Xm)),Em(Wm,o,3*u)}(e,t)}const Gm=(0,Ta.eB)(),Hm=(0,Ta.eB)(),qm=(0,Ta.eB)(),Qm=(0,Ta.eB)(),$m=(0,Ta.eB)(),Xm=(0,Ta.eB)(),Wm=(0,Ta.eB)(),Ym=(0,Ta.eB)(),Zm=(0,Ta.eB)(),Km=(0,Ta.eB)(),Jm=(0,Ta.eB)(),eg=(0,Ta.eB)(),tg=(0,Ta.eB)()
function ng(e,t,n,r,i,o,a,s){const{widthValues:l,heightValues:c,linearSegments:u}=e,d=1-s
for(let p=0;p<=u;++p){const e=1*p/u
e<d?(l[p]=(0,Pm.Cc)(t,n,e+s),c[p]=(0,Pm.Cc)(i,o,e+s)):(l[p]=(0,Pm.Cc)(n,r,e-d),c[p]=(0,Pm.Cc)(o,a,e-d))}}const rg=.5,ig=.3
function og(e){switch(e.kind){case Or.Unit.Kind.Atomic:return e.model.atomicRanges.polymerRanges
case Or.Unit.Kind.Spheres:return e.model.coarseHierarchy.spheres.polymerRanges
case Or.Unit.Kind.Gaussians:return e.model.coarseHierarchy.gaussians.polymerRanges}}function ag(e){switch(e.kind){case Or.Unit.Kind.Atomic:return e.model.atomicRanges.gapRanges
case Or.Unit.Kind.Spheres:return e.model.coarseHierarchy.spheres.gapRanges
case Or.Unit.Kind.Gaussians:return e.model.coarseHierarchy.gaussians.gapRanges}}var sg,lg,cg
function ug(e,t,n){const{objectId:r,instanceId:i,groupId:o}=e
if(n===r){const{structure:e,group:n}=t,r=n.units[i]
if(o===Rp.$.Null){const t=Xo.CD.ofRange(0,r.elements.length)
return Or.StructureElement.Loci(e.target,[{unit:r,indices:t}])}if(Or.Unit.isAtomic(r))return(0,Op.nR)(e,r,r.polymerElements[o])
{const{elements:t}=r,n=r.polymerElements[o],i=Xo.CD.indexOf(t,n)
if(-1!==i){const t=Xo.CD.ofSingleton(i)
return Or.StructureElement.Loci(e,[{unit:r,indices:t}])}}}return Xr.EmptyLoci}function dg(e,t,n,r,i,o){let a=-1,s=-1
for(let c=i;c<=o;c++){const e=n[c]
if(!(e<0)&&(a=Xo.CD.indexOf(t,e),a>=0)){s=c
break}}if(a<0)return!1
let l=a
for(let c=o;c>s;c--){const e=n[c]
if(e<0)continue
const r=Xo.CD.indexOf(t,e)
if(r>=0){l=r
break}}return r(Xo.IX.ofRange(e+a,e+l))}function pg(e,t,n,r,i){let o=!1
const{elements:a}=i.unit,{traceElementIndex:s}=i.unit.model.atomicHierarchy.derived.residue,{index:l}=i.unit.model.atomicHierarchy.residueAtomSegments,c=n(i.unit)
if(Xo.IX.is(i.indices))o=0===Xo.IX.start(i.indices)&&Xo.IX.end(i.indices)===i.unit.elements.length?r(Xo.IX.ofBounds(e,e+t))||o:dg(e,c,s,r,l[a[Xo.IX.min(i.indices)]],l[a[Xo.IX.max(i.indices)]])||o
else{const{indices:t}=i
for(let n=0,i=t.length;n<i;n++){const u=l[a[t[n]]]
let d=u,p=n+1
for(;p<i;){const e=l[a[t[p]]]
if(e-d>1)break
d=e,p++}n=p-1,o=dg(e,c,s,r,u,d)||o}}return o}function hg(e){return e.polymerElements}function fg(e,t,n){let r=!1
if(!Or.StructureElement.Loci.is(e))return!1
const{structure:i,group:o}=t
if(!Or.Structure.areEquivalent(e.structure,i))return!1
const a=o.units[0].polymerElements.length
for(const s of e.elements){if(!o.unitIndexMap.has(s.unit.id))continue
const e=o.unitIndexMap.get(s.unit.id)*a
if(Or.Unit.isAtomic(s.unit))r=pg(e,a,hg,n,s)||r
else if(Xo.IX.is(s.indices)){const t=e+Xo.IX.start(s.indices),i=e+Xo.IX.end(s.indices)
r=n(Xo.IX.ofBounds(t,i))||r}else for(let t=0,i=s.indices.length;t<i;t++){const o=s.indices[t]
let a=t+1
for(;a<i&&s.indices[a]===o;)a++
t=a-1
const l=s.indices[t]
r=n(Xo.IX.ofRange(e+o,e+l))||r}}return r}function mg(e,t,n){const{objectId:r,instanceId:i,groupId:o}=e
if(n===r){const{structure:e,group:n}=t,r=n.units[i],a=Xo.CD.indexOf(r.elements,r.gapElements[o]),s=Xo.CD.indexOf(r.elements,r.gapElements[o%2?o-1:o+1])
if(-1!==a&&-1!==s)return Or.Bond.Loci(e,[Or.Bond.Location(e,r,a,e,r,s),Or.Bond.Location(e,r,s,e,r,a)])}return Xr.EmptyLoci}function gg(e,t,n){let r=!1
if(Or.Bond.isLoci(e)){const{structure:i,group:o}=t
if(!Or.Structure.areRootsEquivalent(e.structure,i))return!1
e=Or.Bond.remapLoci(e,i)
const a=o.units[0].gapElements.length
for(const t of e.bonds){const e=o.unitIndexMap.get(t.aUnit.id)
if(void 0!==e){const i=Xo.CD.indexOf(t.aUnit.gapElements,t.aUnit.elements[t.aIndex]),o=Xo.CD.indexOf(t.bUnit.gapElements,t.bUnit.elements[t.bIndex]);-1!==i&&-1!==o&&n(Xo.IX.ofSingleton(e*a+i))&&(r=!0)}}}else if(Or.StructureElement.Loci.is(e)){const{structure:i,group:o}=t
if(!Or.Structure.areRootsEquivalent(e.structure,i))return!1
e=Or.StructureElement.Loci.remap(e,i)
const a=o.units[0].gapElements.length
for(const t of e.elements){const e=o.unitIndexMap.get(t.unit.id)
void 0!==e&&Xo.CD.forEach(t.indices,i=>{const o=Xo.CD.indexOf(t.unit.gapElements,t.unit.elements[i]);-1!==o&&(n(Xo.IX.ofSingleton(e*a+o))&&(r=!0),Xo.CD.getAt(t.unit.gapElements,o+1)===t.unit.elements[i]&&n(Xo.IX.ofSingleton(e*a+o+1))&&(r=!0))})}}return r}function yg(e,t,n){const{objectId:r,instanceId:i,groupId:o}=e
if(n===r){const{structure:e,group:n}=t,r=n.units[i]
if(Or.Unit.isAtomic(r)){if(o===Rp.$.Null){const t=Xo.IX.ofRange(0,r.elements.length)
return Or.StructureElement.Loci(e.target,[{unit:r,indices:t}])}return(0,Op.nR)(e,r,r.nucleotideElements[o])}}return Xr.EmptyLoci}function vg(e){return e.nucleotideElements}function bg(e,t,n){let r=!1
if(!Or.StructureElement.Loci.is(e))return!1
const{structure:i,group:o}=t
if(!Or.Structure.areEquivalent(e.structure,i))return!1
const a=o.units[0]
if(!Or.Unit.isAtomic(a))return!1
const{nucleotideElements:s}=a,l=s.length
for(const c of e.elements){if(!Or.Unit.isAtomic(c.unit))continue
if(!o.unitIndexMap.has(c.unit.id))continue
const e=o.unitIndexMap.get(c.unit.id)*l
Or.Unit.isAtomic(c.unit)&&(r=pg(e,l,vg,n,c)||r)}return r}!function(e){e.fromGroup=function(e,t){const{group:n,structure:r}=e,i=n.units[0].polymerElements,o=i.length,a=n.units.length,s=Or.StructureElement.Location.create(r),l=!!(null==t?void 0:t.asSecondary)
return(0,Dp.iQ)(o,a,1,(e,t)=>{const r=n.units[t]
return s.unit=r,s.element=i[e],s},!1,function(e,t){return l})}}(sg||(sg={})),function(e){e.fromGroup=function(e,t){const{group:n,structure:r}=e,i=n.units[0].gapElements,o=i.length,a=n.units.length,s=Or.StructureElement.Location.create(r),l=!!(null==t?void 0:t.asSecondary)
return(0,Dp.iQ)(o,a,1,(e,t)=>{const r=n.units[t]
return s.unit=r,s.element=i[e],s},!1,function(e,t){return l})}}(lg||(lg={})),function(e){e.fromGroup=function(e){const{group:t,structure:n}=e,r=t.units[0],i=Or.Unit.isAtomic(r)?r.nucleotideElements:[],o=i.length,a=t.units.length,s=Or.StructureElement.Location.create(n)
return(0,Dp.iQ)(o,a,1,(e,n)=>{const r=t.units[n]
return s.unit=r,s.element=i[e],s})}}(cg||(cg={}))
const xg=(0,Za.e)(),Sg=(0,Za.e)()
function _g(e,t){const{model:n,conformation:r}=e,{residueAtomSegments:i,atoms:o,index:a}=n.atomicHierarchy,{label_comp_id:s}=o,l=s.value(i.offsets[t])
let c=(0,kp.isPurineBase)(l),u=(0,kp.isPyrimidineBase)(l)
if(!c&&!u){const e=a.findAtomOnResidue(t,"C4"),n=a.findAtomOnResidue(t,"N9");-1!==e&&-1!==n&&Za.e.distance(r.invariantPosition(e,xg),r.invariantPosition(n,Sg))<1.6?c=!0:u=!0}return{isPurine:c,isPyrimidine:u}}function Cg(){return{trace:-1,N1:-1,C2:-1,N3:-1,C4:-1,C5:-1,C6:-1,N7:-1,C8:-1,N9:-1,C1_1:-1,C2_1:-1,C3_1:-1,C4_1:-1,O4_1:-1}}function wg(e,t,n){const r=t.model.atomicHierarchy.index,{traceElementIndex:i}=t.model.atomicHierarchy.derived.residue
return e.trace=i[n],e.N1=r.findAtomOnResidue(n,"N1"),e.C2=r.findAtomOnResidue(n,"C2"),e.N3=r.findAtomOnResidue(n,"N3"),e.C4=r.findAtomOnResidue(n,"C4"),e.C5=r.findAtomOnResidue(n,"C5"),-1===e.C5&&(e.C5=r.findAtomOnResidue(n,"N5")),e.C6=r.findAtomOnResidue(n,"C6"),e.N7=r.findAtomOnResidue(n,"N7"),-1===e.N7&&(e.N7=r.findAtomOnResidue(n,"C7")),e.C8=r.findAtomOnResidue(n,"C8"),e.N9=r.findAtomOnResidue(n,"N9"),e}function Tg(e){return-1!==e.trace&&-1!==e.N1&&-1!==e.C2&&-1!==e.N3&&-1!==e.C4&&-1!==e.C5&&-1!==e.C6&&-1!==e.N7&&-1!==e.C8&&-1!==e.N9}function Ag(e,t,n){const r=t.model.atomicHierarchy.index,{traceElementIndex:i}=t.model.atomicHierarchy.derived.residue
return e.trace=i[n],e.N1=r.findAtomOnResidue(n,"N1"),-1===e.N1&&(e.N1=r.findAtomOnResidue(n,"C1")),e.C2=r.findAtomOnResidue(n,"C2"),e.N3=r.findAtomOnResidue(n,"N3"),e.C4=r.findAtomOnResidue(n,"C4"),e.C5=r.findAtomOnResidue(n,"C5"),e.C6=r.findAtomOnResidue(n,"C6"),e}function Ig(e){return-1!==e.trace&&-1!==e.N1&&-1!==e.C2&&-1!==e.N3&&-1!==e.C4&&-1!==e.C5&&-1!==e.C6}function Pg(e,t,n){const r=t.model.atomicHierarchy.index,{traceElementIndex:i}=t.model.atomicHierarchy.derived.residue
return e.trace=i[n],e.C1_1=r.findAtomOnResidue(n,"C1'"),e.C2_1=r.findAtomOnResidue(n,"C2'"),e.C3_1=r.findAtomOnResidue(n,"C3'"),e.C4_1=r.findAtomOnResidue(n,"C4'"),e.O4_1=r.findAtomOnResidue(n,"O4'"),e}function Bg(e){return-1!==e.trace&&-1!==e.C1_1&&-1!==e.C2_1&&-1!==e.C3_1&&-1!==e.C4_1&&-1!==e.O4_1}const Eg=(0,Ta.eB)(),kg=(0,Ta.eB)(),Dg=(0,Ta.eB)(),Mg=(0,Ta.eB)(),Rg=(0,Ta.eB)(),Og=(0,Ta.eB)(),Lg=(0,Ta.eB)(),Ng=(0,Ta.eB)(),Fg=(0,Ta.eB)(),zg=(0,Ta.eB)(),jg=Ta.$I.identity(),Vg=(0,Ta.eB)(),Ug=(0,rf.az)(),Gg={sizeFactor:Vr.t.Numeric(.2,{min:0,max:10,step:.01}),thicknessFactor:Vr.t.Numeric(1,{min:0,max:2,step:.01}),radialSegments:Vr.t.Numeric(16,{min:2,max:56,step:2},Mr.iy.CustomQualityParamInfo)}
function Hg(e,t,n,r,i,o){if(!Or.Unit.isAtomic(t))return Pp.e.createEmpty(o)
const a=t.nucleotideElements.length
if(!a)return Pp.e.createEmpty(o)
const{sizeFactor:s,thicknessFactor:l,radialSegments:c}=i,u=a*(Ug.vertices.length/3+2*c),d=Ch.P.createState(u,u/4,o),{elements:p,model:h,conformation:f}=t,{chainAtomSegments:m,residueAtomSegments:g}=h.atomicHierarchy,{moleculeType:y}=h.atomicHierarchy.derived.residue,v=Xo.hT.transientSegments(m,p),b=Xo.hT.transientSegments(g,p),x=1*s,S=l*s*2,_={radiusTop:x,radiusBottom:x,radialSegments:c,bottomCap:!0}
let C=0
for(;v.hasNext;)for(b.setSegment(v.move());b.hasNext;){const{index:e}=b.move()
if((0,kp.isNucleic)(y[e])){const n=Cg()
let r=-1,i=-1,o=-1,a=-1,s=-1,l=4.5
const{isPurine:c,isPyrimidine:u}=_g(t,e)
c?(l=4.5,wg(n,t,e),r=n.N1,i=n.C4,o=n.C6,a=n.C2,s=n.N9):u&&(l=3,Ag(n,t,e),r=n.N3,i=n.C6,o=n.C4,a=n.C2,s=n.N1),-1!==s&&-1!==n.trace&&(f.invariantPosition(s,Rg),f.invariantPosition(n.trace,Og),d.currentGroup=C,(0,om.y9)(d,Rg,Og,1,_),-1!==r&&-1!==i&&-1!==o&&-1!==a&&(f.invariantPosition(r,Eg),f.invariantPosition(i,kg),f.invariantPosition(o,Dg),f.invariantPosition(a,Mg),Ta.eB.normalize(Lg,Ta.eB.sub(Lg,kg,Eg)),Ta.eB.normalize(Ng,Ta.eB.sub(Ng,Mg,Dg)),Ta.eB.normalize(Fg,Ta.eB.cross(Fg,Lg,Ng)),Ta.$I.targetTo(jg,Eg,kg,Fg),Ta.eB.scaleAndAdd(zg,Eg,Lg,l/2-.2),Ta.$I.scale(jg,jg,Ta.eB.set(Vg,4.5,S,l)),Ta.$I.setTranslation(jg,zg),Ch.P.addPrimitive(d,jg,Ug))),++C}}const w=Ch.P.getMesh(d),T=hd.f8.expand((0,hd.f8)(),t.boundary.sphere,x)
return w.setBoundingSphere(T),w}Vr.t.getDefaultValues(Gg)
const qg={...Ep.Te,...Gg}
function Qg(e){return(0,Ep.Pv)({defaultProps:Vr.t.getDefaultValues(qg),createGeometry:Hg,createLocationIterator:cg.fromGroup,getLoci:yg,eachLocation:bg,setUpdateState:(e,t,n)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.thicknessFactor!==n.thicknessFactor||t.radialSegments!==n.radialSegments}},e)}const $g=(0,Ta.eB)(),Xg=(0,Ta.eB)(),Wg=(0,Ta.eB)(),Yg=(0,Ta.eB)(),Zg=(0,Ta.eB)(),Kg=(0,Ta.eB)(),Jg=(0,Ta.eB)(),ey=(0,Ta.eB)(),ty=(0,Ta.eB)(),ny=(0,Ta.eB)(),ry=(0,Ta.eB)(),iy={sizeFactor:Vr.t.Numeric(.2,{min:0,max:10,step:.01}),thicknessFactor:Vr.t.Numeric(1,{min:0,max:2,step:.01}),radialSegments:Vr.t.Numeric(16,{min:2,max:56,step:2},Mr.iy.CustomQualityParamInfo),detail:Vr.t.Numeric(0,{min:0,max:3,step:1},Mr.iy.CustomQualityParamInfo)},oy=(Vr.t.getDefaultValues(iy),new Float32Array(54)),ay=new Uint32Array([0,1,2,3,4,5,6,7,16,17,14,15,12,13,8,9,10,11,0,1]),sy=new Uint32Array([8,12,14,16,6,4,2,0,10]),ly=new Uint32Array([9,11,1,3,5,7,17,15,13]),cy=new Float32Array(36),uy=new Uint32Array([0,1,2,3,4,5,6,7,8,9,10,11,0,1]),dy=new Uint32Array([0,10,8,6,4,2]),py=new Uint32Array([1,3,5,7,9,11]),hy=(0,Ta.eB)()
function fy(e,t,...n){for(let r=0,i=n.length;r<i;++r){const i=n[r]
Ta.eB.toArray(Ta.eB.add(hy,i,t),e,2*r*3),Ta.eB.toArray(Ta.eB.sub(hy,i,t),e,3*(2*r+1))}}function my(e,t,n,r,i,o){if(!Or.Unit.isAtomic(t))return Pp.e.createEmpty(o)
const a=t.nucleotideElements.length
if(!a)return Pp.e.createEmpty(o)
const{sizeFactor:s,thicknessFactor:l,radialSegments:c,detail:u}=i,d=a*(26+2*c),p=Ch.P.createState(d,d/4,o),{elements:h,model:f,conformation:m}=t,{chainAtomSegments:g,residueAtomSegments:y}=f.atomicHierarchy,{moleculeType:v}=f.atomicHierarchy.derived.residue,b=Xo.hT.transientSegments(g,h),x=Xo.hT.transientSegments(y,h),S=1*s,_=l*s,C={radiusTop:S,radiusBottom:S,radialSegments:c}
let w=0
for(;b.hasNext;)for(x.setSegment(b.move());x.hasNext;){const{index:e}=x.move()
if((0,kp.isNucleic)(v[e])){const n=Cg()
p.currentGroup=w
const{isPurine:r,isPyrimidine:i}=_g(t,e)
r?(wg(n,t,e),-1!==n.N9&&-1!==n.trace&&(m.invariantPosition(n.N9,ny),m.invariantPosition(n.trace,$g),p.currentGroup=w,(0,om.y9)(p,ny,$g,1,C),(0,wh.X)(p,ny,S,u)),Tg(n)&&(m.invariantPosition(n.N1,Xg),m.invariantPosition(n.C2,Wg),m.invariantPosition(n.N3,Yg),m.invariantPosition(n.C4,Zg),m.invariantPosition(n.C5,Kg),m.invariantPosition(n.C6,Jg),m.invariantPosition(n.N7,ey),m.invariantPosition(n.C8,ty),Ta.eB.triangleNormal(ry,Xg,Zg,Kg),Ta.eB.scale(ry,ry,_),fy(oy,ry,Xg,Wg,Yg,Zg,Kg,Jg,ey,ty,ny),Ch.P.addTriangleStrip(p,oy,ay),Ch.P.addTriangleFan(p,oy,sy),Ch.P.addTriangleFan(p,oy,ly))):i&&(Ag(n,t,e),-1!==n.N1&&-1!==n.trace&&(m.invariantPosition(n.N1,Xg),m.invariantPosition(n.trace,$g),p.currentGroup=w,(0,om.y9)(p,Xg,$g,1,C),(0,wh.X)(p,Xg,S,u)),Ig(n)&&(m.invariantPosition(n.C2,Wg),m.invariantPosition(n.N3,Yg),m.invariantPosition(n.C4,Zg),m.invariantPosition(n.C5,Kg),m.invariantPosition(n.C6,Jg),Ta.eB.triangleNormal(ry,Xg,Zg,Kg),Ta.eB.scale(ry,ry,_),fy(cy,ry,Xg,Wg,Yg,Zg,Kg,Jg),Ch.P.addTriangleStrip(p,cy,uy),Ch.P.addTriangleFan(p,cy,dy),Ch.P.addTriangleFan(p,cy,py))),++w}}const T=Ch.P.getMesh(p),A=hd.f8.expand((0,hd.f8)(),t.boundary.sphere,S)
return T.setBoundingSphere(A),T}const gy={...Ep.Te,...iy}
function yy(e){return(0,Ep.Pv)({defaultProps:Vr.t.getDefaultValues(gy),createGeometry:my,createLocationIterator:cg.fromGroup,getLoci:yg,eachLocation:bg,setUpdateState:(e,t,n)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.thicknessFactor!==n.thicknessFactor||t.radialSegments!==n.radialSegments}},e)}const vy=(0,Ta.eB)(),by=(0,Ta.eB)(),xy=(0,Ta.eB)(),Sy=(0,Ta.eB)(),_y=(0,Ta.eB)(),Cy=(0,Ta.eB)(),wy=(0,Ta.eB)(),Ty=(0,Ta.eB)(),Ay=(0,Ta.eB)(),Iy=(0,Ta.eB)(),Py=(0,Ta.eB)(),By=(0,Ta.eB)(),Ey=(0,Ta.eB)(),ky=(0,Ta.eB)(),Dy=(0,Ta.eB)(),My=(0,Ta.eB)(),Ry=(0,Ta.eB)(),Oy={sizeFactor:Vr.t.Numeric(.2,{min:0,max:10,step:.01}),thicknessFactor:Vr.t.Numeric(1,{min:0,max:2,step:.01})},Ly=(Vr.t.getDefaultValues(Oy),new Float32Array(54)),Ny=new Uint32Array([0,1,2,3,4,5,6,7,16,17,14,15,12,13,8,9,10,11,0,1]),Fy=new Uint32Array([8,12,14,16,6,4,2,0,10]),zy=new Uint32Array([9,11,1,3,5,7,17,15,13]),jy=new Float32Array(36),Vy=new Uint32Array([2,3,4,5,6,7,8,9,10,11,2,3]),Uy=new Uint32Array([0,10,8,6,4,2,10]),Gy=new Uint32Array([1,3,5,7,9,11,3]),Hy=new Float32Array(36),qy=new Uint32Array([0,1,2,3,4,5,6,7,8,9,10,11,0,1]),Qy=new Uint32Array([0,10,8,6,4,2]),$y=new Uint32Array([1,3,5,7,9,11]),Xy=(0,Ta.eB)()
function Wy(e,t,...n){for(let r=0,i=n.length;r<i;++r){const i=n[r]
Ta.eB.toArray(Ta.eB.add(Xy,i,t),e,2*r*3),Ta.eB.toArray(Ta.eB.sub(Xy,i,t),e,3*(2*r+1))}}function Yy(e,t,n,r,i,o){if(!Or.Unit.isAtomic(t))return Pp.e.createEmpty(o)
const a=t.nucleotideElements.length
if(!a)return Pp.e.createEmpty(o)
const{sizeFactor:s,thicknessFactor:l}=i,c=25*a,u=Ch.P.createState(c,c/4,o),{elements:d,model:p,conformation:h}=t,{chainAtomSegments:f,residueAtomSegments:m}=p.atomicHierarchy,{moleculeType:g}=p.atomicHierarchy.derived.residue,y=Xo.hT.transientSegments(f,d),v=Xo.hT.transientSegments(m,d),b=s*l
let x=0
for(;y.hasNext;)for(v.setSegment(y.move());v.hasNext;){const{index:e}=v.move()
if((0,kp.isNucleic)(g[e])){const n=Cg()
u.currentGroup=x,Pg(n,t,e),Bg(n)&&(h.invariantPosition(n.C1_1,Iy),h.invariantPosition(n.C2_1,Py),h.invariantPosition(n.C3_1,By),h.invariantPosition(n.C4_1,Ey),h.invariantPosition(n.O4_1,ky),Ta.eB.triangleNormal(My,By,Ey,Iy),Ta.eB.scale(Dy,Ta.eB.add(Dy,ky,Ta.eB.add(Dy,Ey,Ta.eB.add(Dy,By,Ta.eB.add(Dy,Iy,Py)))),.2),Ta.eB.scale(Ry,My,b),Wy(jy,Ry,Dy,By,Ey,ky,Iy,Py),Ch.P.addTriangleStrip(u,jy,Vy),Ch.P.addTriangleFanWithNormal(u,jy,Uy,My),Ta.eB.negate(My,My),Ch.P.addTriangleFanWithNormal(u,jy,Gy,My))
const{isPurine:r,isPyrimidine:i}=_g(t,e)
r?(wg(n,t,e),Tg(n)&&(h.invariantPosition(n.N1,vy),h.invariantPosition(n.C2,by),h.invariantPosition(n.N3,xy),h.invariantPosition(n.C4,Sy),h.invariantPosition(n.C5,_y),h.invariantPosition(n.C6,Cy),h.invariantPosition(n.N7,wy),h.invariantPosition(n.C8,Ty),h.invariantPosition(n.N9,Ay),Ta.eB.triangleNormal(My,vy,Sy,_y),Ta.eB.scale(Ry,My,b),Wy(Ly,Ry,vy,by,xy,Sy,_y,Cy,wy,Ty,Ay),Ch.P.addTriangleStrip(u,Ly,Ny),Ch.P.addTriangleFanWithNormal(u,Ly,Fy,My),Ta.eB.negate(My,My),Ch.P.addTriangleFanWithNormal(u,Ly,zy,My))):i&&(Ag(n,t,e),Ig(n)&&(h.invariantPosition(n.N1,vy),h.invariantPosition(n.C2,by),h.invariantPosition(n.N3,xy),h.invariantPosition(n.C4,Sy),h.invariantPosition(n.C5,_y),h.invariantPosition(n.C6,Cy),Ta.eB.triangleNormal(My,vy,Sy,_y),Ta.eB.scale(Ry,My,b),Wy(Hy,Ry,vy,by,xy,Sy,_y,Cy),Ch.P.addTriangleStrip(u,Hy,qy),Ch.P.addTriangleFanWithNormal(u,Hy,Qy,My),Ta.eB.negate(My,My),Ch.P.addTriangleFanWithNormal(u,Hy,$y,My))),++x}}const S=Ch.P.getMesh(u),_=hd.f8.expand((0,hd.f8)(),t.boundary.sphere,b)
return S.setBoundingSphere(_),S}const Zy={...Ep.Te,...Oy}
function Ky(e){return(0,Ep.Pv)({defaultProps:Vr.t.getDefaultValues(Zy),createGeometry:Yy,createLocationIterator:cg.fromGroup,getLoci:yg,eachLocation:bg,setUpdateState:(e,t,n)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.thicknessFactor!==n.thicknessFactor}},e)}var Jy=n(96458)
const ev=(0,Ta.eB)(),tv=(0,Ta.eB)(),nv=(0,Ta.eB)(),rv=(0,Ta.eB)(),iv=(0,Ta.eB)(),ov=(0,Ta.eB)(),av=(0,Ta.eB)(),sv=(0,Ta.eB)(),lv=(0,Ta.eB)(),cv=(0,Ta.eB)(),uv=(0,Ta.eB)(),dv=(0,Ta.eB)(),pv=(0,Ta.eB)(),hv=(0,Ta.eB)(),fv=(0,Ta.eB)(),mv={...Ep.Te,...Ep.lm,sizeFactor:Vr.t.Numeric(.3,{min:0,max:10,step:.01}),radialSegments:Vr.t.Numeric(16,{min:2,max:56,step:2},Mr.iy.CustomQualityParamInfo),tryUseImpostor:Vr.t.Boolean(!0)}
function gv(e,t,n,r){return n.tryUseImpostor&&(0,Op.VZ)(r)?function(e){return(0,Ep.Vb)({defaultProps:Vr.t.getDefaultValues(mv),createGeometry:yv,createLocationIterator:cg.fromGroup,getLoci:yg,eachLocation:bg,setUpdateState:(e,t,n)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor},mustRecreate:(e,t,n)=>!t.tryUseImpostor||!n},e)}(e):function(e){return(0,Ep.Pv)({defaultProps:Vr.t.getDefaultValues(mv),createGeometry:vv,createLocationIterator:cg.fromGroup,getLoci:yg,eachLocation:bg,setUpdateState:(e,t,n)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.radialSegments!==n.radialSegments},mustRecreate:(e,t,n)=>t.tryUseImpostor&&!!n},e)}(e)}function yv(e,t,n,r,i,o){if(!Or.Unit.isAtomic(t))return Jp.S.createEmpty(o)
const a=t.nucleotideElements.length
if(!a)return Jp.S.createEmpty(o)
const s=15*a,l=Jy.h.create(s,s/4,o),{elements:c,model:u,conformation:d}=t,{chainAtomSegments:p,residueAtomSegments:h}=u.atomicHierarchy,{moleculeType:f}=u.atomicHierarchy.derived.residue,m=Xo.hT.transientSegments(p,c),g=Xo.hT.transientSegments(h,c)
let y=0
for(;m.hasNext;)for(g.setSegment(m.move());g.hasNext;){const{index:e}=g.move()
if((0,kp.isNucleic)(f[e])){const n=Cg()
Pg(n,t,e),Bg(n)&&(d.invariantPosition(n.C1_1,uv),d.invariantPosition(n.C2_1,dv),d.invariantPosition(n.C3_1,pv),d.invariantPosition(n.C4_1,hv),d.invariantPosition(n.O4_1,fv),d.invariantPosition(n.trace,ev),l.add(pv[0],pv[1],pv[2],ev[0],ev[1],ev[2],1,!0,!0,2,y),l.add(pv[0],pv[1],pv[2],hv[0],hv[1],hv[2],1,!0,!0,2,y),l.add(hv[0],hv[1],hv[2],fv[0],fv[1],fv[2],1,!0,!0,2,y),l.add(fv[0],fv[1],fv[2],uv[0],uv[1],uv[2],1,!0,!0,2,y),l.add(uv[0],uv[1],uv[2],dv[0],dv[1],dv[2],1,!0,!0,2,y),l.add(dv[0],dv[1],dv[2],pv[0],pv[1],pv[2],1,!0,!0,2,y))
const{isPurine:r,isPyrimidine:i}=_g(t,e)
r?(wg(n,t,e),-1!==n.C1_1&&-1!==n.N9?(d.invariantPosition(n.C1_1,uv),d.invariantPosition(n.N9,cv),l.add(cv[0],cv[1],cv[2],uv[0],uv[1],uv[2],1,!0,!0,2,y)):-1!==n.N9&&-1!==n.trace&&(d.invariantPosition(n.N9,cv),d.invariantPosition(n.trace,ev),l.add(cv[0],cv[1],cv[2],ev[0],ev[1],ev[2],1,!0,!0,2,y)),Tg(n)&&(d.invariantPosition(n.N1,tv),d.invariantPosition(n.C2,nv),d.invariantPosition(n.N3,rv),d.invariantPosition(n.C4,iv),d.invariantPosition(n.C5,ov),d.invariantPosition(n.C6,av),d.invariantPosition(n.N7,sv),d.invariantPosition(n.C8,lv),d.invariantPosition(n.N9,cv),l.add(cv[0],cv[1],cv[2],lv[0],lv[1],lv[2],1,!0,!0,2,y),l.add(lv[0],lv[1],lv[2],sv[0],sv[1],sv[2],1,!0,!0,2,y),l.add(sv[0],sv[1],sv[2],ov[0],ov[1],ov[2],1,!0,!0,2,y),l.add(ov[0],ov[1],ov[2],av[0],av[1],av[2],1,!0,!0,2,y),l.add(av[0],av[1],av[2],tv[0],tv[1],tv[2],1,!0,!0,2,y),l.add(tv[0],tv[1],tv[2],nv[0],nv[1],nv[2],1,!0,!0,2,y),l.add(nv[0],nv[1],nv[2],rv[0],rv[1],rv[2],1,!0,!0,2,y),l.add(rv[0],rv[1],rv[2],iv[0],iv[1],iv[2],1,!0,!0,2,y),l.add(iv[0],iv[1],iv[2],ov[0],ov[1],ov[2],1,!0,!0,2,y),l.add(iv[0],iv[1],iv[2],cv[0],cv[1],cv[2],1,!0,!0,2,y))):i&&(Ag(n,t,e),-1!==n.C1_1&&-1!==n.N1?(d.invariantPosition(n.N1,tv),d.invariantPosition(n.C1_1,uv),l.add(tv[0],tv[1],tv[2],uv[0],uv[1],uv[2],1,!0,!0,2,y)):-1!==n.N1&&-1!==n.trace&&(d.invariantPosition(n.N1,tv),d.invariantPosition(n.trace,ev),l.add(tv[0],tv[1],tv[2],ev[0],ev[1],ev[2],1,!0,!0,2,y)),Ig(n)&&(d.invariantPosition(n.N1,tv),d.invariantPosition(n.C2,nv),d.invariantPosition(n.N3,rv),d.invariantPosition(n.C4,iv),d.invariantPosition(n.C5,ov),d.invariantPosition(n.C6,av),l.add(tv[0],tv[1],tv[2],av[0],av[1],av[2],1,!0,!0,2,y),l.add(av[0],av[1],av[2],ov[0],ov[1],ov[2],1,!0,!0,2,y),l.add(ov[0],ov[1],ov[2],iv[0],iv[1],iv[2],1,!0,!0,2,y),l.add(iv[0],iv[1],iv[2],rv[0],rv[1],rv[2],1,!0,!0,2,y),l.add(rv[0],rv[1],rv[2],nv[0],nv[1],nv[2],1,!0,!0,2,y),l.add(nv[0],nv[1],nv[2],tv[0],tv[1],tv[2],1,!0,!0,2,y))),++y}}const v=l.getCylinders(),b=hd.f8.expand((0,hd.f8)(),t.boundary.sphere,1*i.sizeFactor)
return v.setBoundingSphere(b),v}function vv(e,t,n,r,i,o){if(!Or.Unit.isAtomic(t))return Pp.e.createEmpty(o)
const a=t.nucleotideElements.length
if(!a)return Pp.e.createEmpty(o)
const{sizeFactor:s,radialSegments:l}=i,c=a*(15*l),u=Ch.P.createState(c,c/4,o),{elements:d,model:p,conformation:h}=t,{chainAtomSegments:f,residueAtomSegments:m}=p.atomicHierarchy,{moleculeType:g}=p.atomicHierarchy.derived.residue,y=Xo.hT.transientSegments(f,d),v=Xo.hT.transientSegments(m,d),b={radiusTop:1*s,radiusBottom:1*s,radialSegments:l}
let x=0
for(;y.hasNext;)for(v.setSegment(y.move());v.hasNext;){const{index:e}=v.move()
if((0,kp.isNucleic)(g[e])){const n=Cg()
u.currentGroup=x,Pg(n,t,e),Bg(n)&&(h.invariantPosition(n.C1_1,uv),h.invariantPosition(n.C2_1,dv),h.invariantPosition(n.C3_1,pv),h.invariantPosition(n.C4_1,hv),h.invariantPosition(n.O4_1,fv),h.invariantPosition(n.trace,ev),(0,om.y9)(u,pv,ev,1,b),(0,om.y9)(u,pv,hv,1,b),(0,om.y9)(u,hv,fv,1,b),(0,om.y9)(u,fv,uv,1,b),(0,om.y9)(u,uv,dv,1,b),(0,om.y9)(u,dv,pv,1,b))
const{isPurine:r,isPyrimidine:i}=_g(t,e)
r?(wg(n,t,e),-1!==n.C1_1&&-1!==n.N9?(h.invariantPosition(n.C1_1,uv),h.invariantPosition(n.N9,cv),(0,om.y9)(u,cv,uv,1,b)):-1!==n.N9&&-1!==n.trace&&(h.invariantPosition(n.N9,cv),h.invariantPosition(n.trace,ev),(0,om.y9)(u,cv,ev,1,b)),Tg(n)&&(h.invariantPosition(n.N1,tv),h.invariantPosition(n.C2,nv),h.invariantPosition(n.N3,rv),h.invariantPosition(n.C4,iv),h.invariantPosition(n.C5,ov),h.invariantPosition(n.C6,av),h.invariantPosition(n.N7,sv),h.invariantPosition(n.C8,lv),h.invariantPosition(n.N9,cv),(0,om.y9)(u,cv,lv,1,b),(0,om.y9)(u,lv,sv,1,b),(0,om.y9)(u,sv,ov,1,b),(0,om.y9)(u,ov,av,1,b),(0,om.y9)(u,av,tv,1,b),(0,om.y9)(u,tv,nv,1,b),(0,om.y9)(u,nv,rv,1,b),(0,om.y9)(u,rv,iv,1,b),(0,om.y9)(u,iv,ov,1,b),(0,om.y9)(u,iv,cv,1,b))):i&&(Ag(n,t,e),-1!==n.C1_1&&-1!==n.N1?(h.invariantPosition(n.N1,tv),h.invariantPosition(n.C1_1,uv),(0,om.y9)(u,tv,uv,1,b)):-1!==n.N1&&-1!==n.trace&&(h.invariantPosition(n.N1,tv),h.invariantPosition(n.trace,ev),(0,om.y9)(u,tv,ev,1,b)),Ig(n)&&(h.invariantPosition(n.N1,tv),h.invariantPosition(n.C2,nv),h.invariantPosition(n.N3,rv),h.invariantPosition(n.C4,iv),h.invariantPosition(n.C5,ov),h.invariantPosition(n.C6,av),(0,om.y9)(u,tv,av,1,b),(0,om.y9)(u,av,ov,1,b),(0,om.y9)(u,ov,iv,1,b),(0,om.y9)(u,iv,rv,1,b),(0,om.y9)(u,rv,nv,1,b),(0,om.y9)(u,nv,tv,1,b))),++x}}const S=Ch.P.getMesh(u),_=hd.f8.expand((0,hd.f8)(),t.boundary.sphere,1*i.sizeFactor)
return S.setBoundingSphere(_),S}const bv=(0,Ta.eB)(),xv=(0,Ta.eB)(),Sv=(0,Ta.eB)(),_v=(0,Ta.eB)(),Cv=(0,Ta.eB)(),wv=(0,Ta.eB)(),Tv=(0,Ta.eB)(),Av=(0,Ta.eB)(),Iv=(0,Ta.eB)(),Pv=(0,Ta.eB)(),Bv=(0,Ta.eB)(),Ev=(0,Ta.eB)(),kv=(0,Ta.eB)(),Dv=(0,Ta.eB)(),Mv=(0,Ta.eB)(),Rv={...Ep.Te,...Ep.qg,sizeFactor:Vr.t.Numeric(.3,{min:0,max:10,step:.01}),detail:Vr.t.Numeric(0,{min:0,max:3,step:1},Mr.iy.CustomQualityParamInfo),tryUseImpostor:Vr.t.Boolean(!0)}
function Ov(e,t,n,r){return n.tryUseImpostor&&(0,Op.gU)(r)?function(e){return(0,Ep.uF)({defaultProps:Vr.t.getDefaultValues(Rv),createGeometry:Lv,createLocationIterator:cg.fromGroup,getLoci:yg,eachLocation:bg,setUpdateState:(e,t,n)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor},mustRecreate:(e,t,n)=>!t.tryUseImpostor||!n},e)}(e):function(e){return(0,Ep.Pv)({defaultProps:Vr.t.getDefaultValues(Rv),createGeometry:Nv,createLocationIterator:cg.fromGroup,getLoci:yg,eachLocation:bg,setUpdateState:(e,t,n)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.detail!==n.detail},mustRecreate:(e,t,n)=>t.tryUseImpostor&&!!n},e)}(e)}function Lv(e,t,n,r,i,o){if(!Or.Unit.isAtomic(t))return Th.v.createEmpty(o)
const a=t.nucleotideElements.length
if(!a)return Th.v.createEmpty(o)
const s=15*a,l=Ah.Q.create(s,s/4,o),{elements:c,model:u,conformation:d}=t,{chainAtomSegments:p,residueAtomSegments:h}=u.atomicHierarchy,{moleculeType:f}=u.atomicHierarchy.derived.residue,m=Xo.hT.transientSegments(p,c),g=Xo.hT.transientSegments(h,c)
let y=0
for(;m.hasNext;)for(g.setSegment(m.move());g.hasNext;){const{index:e}=g.move()
if((0,kp.isNucleic)(f[e])){const n=Cg()
Pg(n,t,e),Bg(n)&&(d.invariantPosition(n.C1_1,Bv),d.invariantPosition(n.C2_1,Ev),d.invariantPosition(n.C3_1,kv),d.invariantPosition(n.C4_1,Dv),d.invariantPosition(n.O4_1,Mv),d.invariantPosition(n.trace,bv),l.add(bv[0],bv[1],bv[2],y),l.add(kv[0],kv[1],kv[2],y),l.add(Dv[0],Dv[1],Dv[2],y),l.add(Mv[0],Mv[1],Mv[2],y),l.add(Bv[0],Bv[1],Bv[2],y),l.add(Ev[0],Ev[1],Ev[2],y))
const{isPurine:r,isPyrimidine:i}=_g(t,e)
r?(wg(n,t,e),Tg(n)&&(d.invariantPosition(n.N1,xv),d.invariantPosition(n.C2,Sv),d.invariantPosition(n.N3,_v),d.invariantPosition(n.C4,Cv),d.invariantPosition(n.C5,wv),d.invariantPosition(n.C6,Tv),d.invariantPosition(n.N7,Av),d.invariantPosition(n.C8,Iv),d.invariantPosition(n.N9,Pv),l.add(Pv[0],Pv[1],Pv[2],y),l.add(Iv[0],Iv[1],Iv[2],y),l.add(Av[0],Av[1],Av[2],y),l.add(wv[0],wv[1],wv[2],y),l.add(Tv[0],Tv[1],Tv[2],y),l.add(xv[0],xv[1],xv[2],y),l.add(Sv[0],Sv[1],Sv[2],y),l.add(_v[0],_v[1],_v[2],y),l.add(Cv[0],Cv[1],Cv[2],y))):i&&(Ag(n,t,e),Ig(n)&&(d.invariantPosition(n.N1,xv),d.invariantPosition(n.C2,Sv),d.invariantPosition(n.N3,_v),d.invariantPosition(n.C4,Cv),d.invariantPosition(n.C5,wv),d.invariantPosition(n.C6,Tv),l.add(xv[0],xv[1],xv[2],y),l.add(Tv[0],Tv[1],Tv[2],y),l.add(wv[0],wv[1],wv[2],y),l.add(Cv[0],Cv[1],Cv[2],y),l.add(_v[0],_v[1],_v[2],y),l.add(Sv[0],Sv[1],Sv[2],y))),++y}}const v=l.getSpheres(),b=hd.f8.expand((0,hd.f8)(),t.boundary.sphere,1*i.sizeFactor)
return v.setBoundingSphere(b),v}function Nv(e,t,n,r,i,o){if(!Or.Unit.isAtomic(t))return Pp.e.createEmpty(o)
const a=t.nucleotideElements.length
if(!a)return Pp.e.createEmpty(o)
const{sizeFactor:s,detail:l}=i,c=a*(0,_h.J)(l),u=Ch.P.createState(c,c/2,o),{elements:d,model:p,conformation:h}=t,{chainAtomSegments:f,residueAtomSegments:m}=p.atomicHierarchy,{moleculeType:g}=p.atomicHierarchy.derived.residue,y=Xo.hT.transientSegments(f,d),v=Xo.hT.transientSegments(m,d),b=1*s
let x=0
for(;y.hasNext;)for(v.setSegment(y.move());v.hasNext;){const{index:e}=v.move()
if((0,kp.isNucleic)(g[e])){const n=Cg()
u.currentGroup=x,Pg(n,t,e),Bg(n)&&(h.invariantPosition(n.C1_1,Bv),h.invariantPosition(n.C2_1,Ev),h.invariantPosition(n.C3_1,kv),h.invariantPosition(n.C4_1,Dv),h.invariantPosition(n.O4_1,Mv),h.invariantPosition(n.trace,bv),(0,wh.X)(u,bv,b,l),(0,wh.X)(u,Dv,b,l),(0,wh.X)(u,Mv,b,l),(0,wh.X)(u,Bv,b,l),(0,wh.X)(u,Ev,b,l),(0,wh.X)(u,kv,b,l))
const{isPurine:r,isPyrimidine:i}=_g(t,e)
r?(wg(n,t,e),Tg(n)&&(h.invariantPosition(n.N1,xv),h.invariantPosition(n.C2,Sv),h.invariantPosition(n.N3,_v),h.invariantPosition(n.C4,Cv),h.invariantPosition(n.C5,wv),h.invariantPosition(n.C6,Tv),h.invariantPosition(n.N7,Av),h.invariantPosition(n.C8,Iv),h.invariantPosition(n.N9,Pv),(0,wh.X)(u,Iv,b,l),(0,wh.X)(u,Av,b,l),(0,wh.X)(u,wv,b,l),(0,wh.X)(u,Tv,b,l),(0,wh.X)(u,xv,b,l),(0,wh.X)(u,Sv,b,l),(0,wh.X)(u,_v,b,l),(0,wh.X)(u,Cv,b,l),(0,wh.X)(u,wv,b,l),(0,wh.X)(u,Pv,b,l))):i&&(Ag(n,t,e),Ig(n)&&(h.invariantPosition(n.N1,xv),h.invariantPosition(n.C2,Sv),h.invariantPosition(n.N3,_v),h.invariantPosition(n.C4,Cv),h.invariantPosition(n.C5,wv),h.invariantPosition(n.C6,Tv),(0,wh.X)(u,Tv,b,l),(0,wh.X)(u,wv,b,l),(0,wh.X)(u,Cv,b,l),(0,wh.X)(u,_v,b,l),(0,wh.X)(u,Sv,b,l),(0,wh.X)(u,xv,b,l))),++x}}const S=Ch.P.getMesh(u),_=hd.f8.expand((0,hd.f8)(),t.boundary.sphere,1*i.sizeFactor)
return S.setBoundingSphere(_),S}const Fv=Ta.eB.zero(),zv=Ta.eB.zero(),jv=Ta.eB.zero(),Vv=Ta.eB.zero(),Uv=(0,af.n)(3,!1)
let Gv
const Hv=Ta.$I.identity(),qv=Ta.eB.zero(),Qv=Ta.eB.zero(),$v=Ta.eB.zero(),Xv=Ta.eB.zero(),Wv=(Gv||(Gv=function(){const e=(0,of.nT)(8)
for(let t=0;t<3;++t){const n=(t+1)%3
Ta.eB.set(Fv,Uv[3*t],Uv[3*t+1],-.5),Ta.eB.set(zv,Uv[3*n],Uv[3*n+1],-.5),Ta.eB.set(jv,Uv[3*n],Uv[3*n+1],.5),Ta.eB.set(Vv,Uv[3*t],Uv[3*t+1],.5),e.add(Fv,zv,jv),e.add(jv,Vv,Fv)}return Ta.eB.set(Fv,Uv[0],Uv[1],-.5),Ta.eB.set(zv,Uv[3],Uv[4],-.5),Ta.eB.set(jv,Uv[6],Uv[7],-.5),e.add(jv,zv,Fv),Ta.eB.set(Fv,Uv[0],Uv[1],.5),Ta.eB.set(zv,Uv[3],Uv[4],.5),Ta.eB.set(jv,Uv[6],Uv[7],.5),e.add(Fv,zv,jv),e.getPrimitive()}()),Gv),Yv={sizeFactor:Vr.t.Numeric(.2,{min:0,max:10,step:.01})}
function Zv(e,t,n,r,i,o){const a=t.polymerElements.length
if(!a)return Pp.e.createEmpty(o)
const{sizeFactor:s}=i,l=24*a,c=Ch.P.createState(l,l/10,o),u=Vm(1),{normalVectors:d,binormalVectors:p}=u
let h=0
const f=vm(t,n)
for(;f.hasNext;){const e=f.move()
c.currentGroup=h
const t=(0,kp.isNucleic)(e.moleculeType),n=kp.SecondaryStructureType.is(e.secStrucType,kp.SecondaryStructureType.Flag.Beta)
if(Um(u,e,t||n?.5:.9,t?.3:.5),n&&!e.secStrucLast||!n){const n=r.size.size(e.center)*s,i=4*n,o=4*n,a=6*n,l=t?p:d
Ta.eB.fromArray(Qv,l,0),Ta.eB.fromArray($v,l,3),Ta.eB.normalize(Xv,Ta.eB.add(Xv,Qv,$v)),Ta.$I.targetTo(Hv,e.p3,e.p1,Xv),Ta.$I.mul(Hv,Hv,Ta.$I.rotY90Z180),Ta.$I.scale(Hv,Hv,Ta.eB.set(qv,a,o,i)),Ta.$I.setTranslation(Hv,e.p2),Ch.P.addPrimitive(c,Hv,Wv)}++h}const m=Ch.P.getMesh(c),g=hd.f8.expand((0,hd.f8)(),t.boundary.sphere,1*i.sizeFactor)
return m.setBoundingSphere(g),m}Vr.t.getDefaultValues(Yv)
const Kv={...Ep.Te,...Yv}
function Jv(e){return(0,Ep.Pv)({defaultProps:Vr.t.getDefaultValues(Kv),createGeometry:Zv,createLocationIterator:e=>sg.fromGroup(e),getLoci:ug,eachLocation:fg,setUpdateState:(e,t,n)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor}},e)}const eb={sizeFactor:Vr.t.Numeric(.2,{min:0,max:10,step:.01}),radialSegments:Vr.t.Numeric(16,{min:2,max:56,step:2},Mr.iy.CustomQualityParamInfo)}
function tb(e,t,n,r,i,o){const a=t.gapElements.length
if(!a)return Pp.e.createEmpty(o)
const{sizeFactor:s,radialSegments:l}=i,c=10*l*2*a*2,u=Ch.P.createState(c,c/10,o),d=(0,Ta.eB)(),p=(0,Ta.eB)(),h={radiusTop:1,radiusBottom:1,topCap:!0,bottomCap:!0,radialSegments:l}
let f=0
const m=function(e,t){switch(t.kind){case Or.Unit.Kind.Atomic:return new dm(e,t)
case Or.Unit.Kind.Spheres:case Or.Unit.Kind.Gaussians:return new pm(e,t)}}(n,t)
for(;m.hasNext;){const{centerA:e,centerB:n}=m.move()
e.element===n.element||(t.conformation.invariantPosition(e.element,d),t.conformation.invariantPosition(n.element,p),h.radiusTop=h.radiusBottom=r.size.size(e)*s,u.currentGroup=f,(0,om.GH)(u,d,p,.5,10,!1,h),h.radiusTop=h.radiusBottom=r.size.size(n)*s,u.currentGroup=f+1,(0,om.GH)(u,p,d,.5,10,!1,h)),f+=2}const g=Ch.P.getMesh(u),y=hd.f8.expand((0,hd.f8)(),t.boundary.sphere,1*i.sizeFactor)
return g.setBoundingSphere(y),g}Vr.t.getDefaultValues(eb)
const nb={...Ep.Te,...eb}
function rb(e){return(0,Ep.Pv)({defaultProps:Vr.t.getDefaultValues(nb),createGeometry:tb,createLocationIterator:e=>lg.fromGroup(e,{asSecondary:!0}),getLoci:mg,eachLocation:gg,setUpdateState:(e,t,n)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.radialSegments!==n.radialSegments}},e)}const ib=(0,Ta.eB)(),ob=(0,Ta.eB)(),ab=(0,Ta.eB)(),sb=(0,Ta.eB)(),lb=(0,Ta.eB)(),cb=(0,Ta.eB)(),ub=(0,Ta.eB)(),db=(0,Ta.eB)(),pb=(0,Ta.eB)(),hb=(0,Ta.eB)(),fb=(0,Ta.eB)(),mb=(0,Ta.eB)(),gb=(0,Ta.eB)(),yb=(0,Ta.eB)(),vb=(0,Ta.eB)(),bb=Ta.eB.fromArray,xb=Ta.eB.scale,Sb=Ta.eB.add,_b=Ta.eB.sub,Cb=Ta.eB.magnitude,wb=Ta.eB.negate,Tb=Ta.eB.copy,Ab=Ta.eB.cross,Ib=Ta.eB.set,Pb=cd.Gm.add3,Bb=cd.Gm.add
function Eb(e,t,n,r,i,o,a,s,l){const{vertices:c,normals:u,indices:d}=t,p=c.elementCount
if(bb(ib,r,e),xb(ub,ib,a),xb(cb,ib,s),bb(ob,i,e),xb(sb,ob,o),Ab(hb,ob,ib),bb(pb,n,e),Sb(mb,Sb(mb,pb,sb),cb),_b(gb,Sb(gb,pb,sb),ub),_b(yb,_b(yb,pb,sb),ub),Sb(vb,_b(vb,pb,sb),cb),a<s?(Pb(c,vb[0],vb[1],vb[2]),Pb(c,yb[0],yb[1],yb[2]),Pb(c,gb[0],gb[1],gb[2]),Pb(c,mb[0],mb[1],mb[2]),Tb(lb,cb)):(Pb(c,mb[0],mb[1],mb[2]),Pb(c,gb[0],gb[1],gb[2]),Pb(c,yb[0],yb[1],yb[2]),Pb(c,vb[0],vb[1],vb[2]),Tb(lb,ub)),l){for(let e=0;e<4;++e)Pb(u,-hb[0],-hb[1],-hb[2])
Pb(d,p,p+1,p+2),Pb(d,p+2,p+3,p)}else{for(let e=0;e<4;++e)Pb(u,hb[0],hb[1],hb[2])
Pb(d,p+2,p+1,p),Pb(d,p,p+3,p+2)}}function kb(e,t,n,r,i,o,a,s,l,c){const{currentGroup:u,vertices:d,normals:p,indices:h,groups:f}=e,m=d.elementCount
let g=0
s>0?(bb(ib,t,0),bb(ob,t,3*i),g=s/Cb(_b(ab,ob,ib))):Ib(db,0,0,0)
for(let y=0;y<=i;++y){const e=o[y],l=a[y],c=0===s?l:s*(1-y/i),u=3*y
bb(lb,n,u),xb(lb,lb,c),bb(sb,r,u),xb(sb,sb,e),s>0&&(bb(ib,n,u),bb(ob,r,u),xb(db,Ab(db,ib,ob),g)),bb(pb,t,u),bb(hb,n,u),bb(fb,r,u),Sb(ib,Sb(ib,pb,sb),lb),Sb(ob,hb,db),Pb(d,ib[0],ib[1],ib[2]),Pb(p,ob[0],ob[1],ob[2]),Sb(ib,_b(ib,pb,sb),lb),Pb(d,ib[0],ib[1],ib[2]),Pb(p,ob[0],ob[1],ob[2]),wb(ob,fb),Pb(d,ib[0],ib[1],ib[2]),Pb(p,ob[0],ob[1],ob[2]),_b(ib,_b(ib,pb,sb),lb),Pb(d,ib[0],ib[1],ib[2]),Pb(p,ob[0],ob[1],ob[2]),Sb(ob,wb(ob,hb),db),Pb(d,ib[0],ib[1],ib[2]),Pb(p,ob[0],ob[1],ob[2]),_b(ib,Sb(ib,pb,sb),lb),Pb(d,ib[0],ib[1],ib[2]),Pb(p,ob[0],ob[1],ob[2]),Tb(ob,fb),Pb(d,ib[0],ib[1],ib[2]),Pb(p,ob[0],ob[1],ob[2]),Sb(ib,Sb(ib,pb,sb),lb),Pb(d,ib[0],ib[1],ib[2]),Pb(p,ob[0],ob[1],ob[2])}for(let y=0;y<i;++y){for(let e=0;e<2;e++)Pb(h,m+8*y+2*e,m+8*(y+1)+2*e+1,m+8*y+2*e+1),Pb(h,m+8*y+2*e,m+8*(y+1)+2*e,m+8*(y+1)+2*e+1)
for(let e=2;e<4;e++)Pb(h,m+8*y+2*e,m+8*(y+1)+2*e,m+8*y+2*e+1),Pb(h,m+8*(y+1)+2*e,m+8*(y+1)+2*e+1,m+8*y+2*e+1)}if(l){const i=o[0],l=a[0],c=0===s?l:s
Eb(0,e,t,n,r,i,c,c,!1)}else if(s>0){const i=o[0],l=a[0]
Eb(0,e,t,n,r,i,s,-l,!1),Eb(0,e,t,n,r,i,-s,l,!1)}if(c&&0===s){const s=o[i],l=a[i]
Eb(3*i,e,t,n,r,s,l,l,!0)}for(let y=0,v=8*(i+1)+(l?4:s>0?8:0)+(c&&0===s?4:0);y<v;++y)Bb(f,u)}const Db=(0,Ta.eB)(),Mb=(0,Ta.eB)(),Rb=(0,Ta.eB)(),Ob=(0,Ta.eB)(),Lb=(0,Ta.eB)(),Nb=(0,Ta.eB)()
function Fb(e,t,n,r,i){e[0]=t[0]*r+n[0]*i,e[1]=t[1]*r+n[1]*i,e[2]=t[2]*r+n[2]*i}function zb(e,t,n,r,i,o){e[0]=t[0]*i+n[0]*o+r[0],e[1]=t[1]*i+n[1]*o+r[1],e[2]=t[2]*i+n[2]*o+r[2]}const jb=Ta.eB.fromArray,Vb=Ta.eB.normalize,Ub=Ta.eB.scaleAndAdd,Gb=Ta.eB.cross,Hb=Ta.eB.slerp,qb=Ta.eB.dot,Qb=Ta.eB.unitX,$b=cd.Gm.add3,Xb=new Map
function Wb(e,t,n,r,i,o,a,s,l,c,u,d=!1){const{currentGroup:p,vertices:h,normals:f,indices:m,groups:g}=e
let y=h.elementCount
const{cos:v,sin:b}=function(e,t){const n=t?1:0,r=(0,cd.m1)(e,n)
if(!Xb.has(r)){const t=[],i=[]
for(let r=0;r<e;++r){const o=(2*r+n)/e*Math.PI
t[r]=Math.cos(o),i[r]=Math.sin(o)}Xb.set(r,{cos:t,sin:i})}return Xb.get(r)}(o,"rounded"===u),x=Math.round(o/4),S=3*x,_=d&&i&&(l||c)
let C
const w=_&&l&&c
w&&(C=i/2)
for(let I=0;I<=i;++I){const e=3*I
jb(Lb,n,e),jb(Nb,r,e),jb(Ob,t,e)
let c,d=a[I],p=s[I]
if(_){const e=w?I<=C:l
c=w?Math.max(Number.EPSILON,Math.sqrt(1-Math.pow((e?C-I:I-C)/C,2))):Math.max(Number.EPSILON,Math.sqrt(1-Math.pow((e?i-I:I)/i,2))),d*=c,p*=c,Gb(Mb,e?Nb:Lb,e?Lb:Nb),Vb(Mb,Mb)}const m="rounded"===u&&p>d
for(let t=0;t<o;++t){if(m){zb(Rb,Lb,Nb,Ob,d*v[t],d*b[t])
const e=qb(Nb,Qb)<0?t<x||t>=S?p-d:-p+d:t>=x&&t<S?-p+d:p-d
Ub(Rb,Rb,Lb,e),t===x||t===x-1?Fb(Db,Lb,Nb,0,1):t===S||t===S-1?Fb(Db,Lb,Nb,0,-1):Fb(Db,Lb,Nb,v[t],b[t])}else zb(Rb,Lb,Nb,Ob,p*v[t],d*b[t]),Fb(Db,Lb,Nb,d*v[t],p*b[t])
Vb(Db,Db),$b(h,Rb[0],Rb[1],Rb[2]),_&&Hb(Db,Mb,Db,c),$b(f,Db[0],Db[1],Db[2])}}const T=Math.round(o/2)
for(let I=0;I<i;++I){for(let e=0;e<T;++e)$b(m,y+I*o+(e+1)%o,y+(I+1)*o+(e+1)%o,y+I*o+e),$b(m,y+(I+1)*o+(e+1)%o,y+(I+1)*o+e,y+I*o+e)
for(let e=T;e<o;++e)$b(m,y+I*o+(e+1)%o,y+(I+1)*o+e,y+I*o+e),$b(m,y+(I+1)*o+(e+1)%o,y+(I+1)*o+e,y+I*o+(e+1)%o)}if(l){const e=0,i=h.elementCount
jb(Lb,n,e),jb(Nb,r,e),jb(Ob,t,e),Gb(Db,Nb,Lb),$b(h,Ob[0],Ob[1],Ob[2]),$b(f,Db[0],Db[1],Db[2])
const l=_?0:a[0]
let c=_?0:s[0]
const d="rounded"===u&&c>l
d&&(c-=l),y=h.elementCount
for(let t=0;t<o;++t)d?(zb(Rb,Lb,Nb,Ob,l*v[t],l*b[t]),Ub(Rb,Rb,Lb,t<x||t>=S?c:-c)):zb(Rb,Lb,Nb,Ob,c*v[t],l*b[t]),$b(h,Rb[0],Rb[1],Rb[2]),$b(f,Db[0],Db[1],Db[2]),$b(m,y+(t+1)%o,y+t,i)}if(c){const e=3*i,l=h.elementCount
jb(Lb,n,e),jb(Nb,r,e),jb(Ob,t,e),Gb(Db,Lb,Nb),$b(h,Ob[0],Ob[1],Ob[2]),$b(f,Db[0],Db[1],Db[2])
const c=_?0:a[i]
let d=_?0:s[i]
const p="rounded"===u&&d>c
p&&(d-=c),y=h.elementCount
for(let t=0;t<o;++t)p?(zb(Rb,Lb,Nb,Ob,c*v[t],c*b[t]),Ub(Rb,Rb,Lb,t<x||t>=S?d:-d)):zb(Rb,Lb,Nb,Ob,d*v[t],c*b[t]),$b(h,Rb[0],Rb[1],Rb[2]),$b(f,Db[0],Db[1],Db[2]),$b(m,y+t,y+(t+1)%o,l)}const A=(i+1)*o+(l?o+1:0)+(c?o+1:0)
cd.Gm.addRepeat(g,A,p)}const Yb=Ta.eB.fromArray,Zb=Ta.eB.magnitude,Kb=Ta.eB.sub,Jb=Ta.eB.add,ex=Ta.eB.scale,tx=Ta.eB.negate,nx=Ta.eB.copy,rx=Ta.eB.cross,ix=cd.Gm.add3,ox=cd.Gm.add,ax=(0,Ta.eB)(),sx=(0,Ta.eB)(),lx=(0,Ta.eB)(),cx=(0,Ta.eB)(),ux=(0,Ta.eB)(),dx=(0,Ta.eB)(),px=(0,Ta.eB)(),hx=(0,Ta.eB)(),fx=(0,Ta.eB)()
function mx(e,t,n,r,i,o,a,s){const{currentGroup:l,vertices:c,normals:u,indices:d,groups:p}=e,h=c.elementCount
let f=0
s>0&&(Yb(ax,t,0),Yb(sx,t,3*i),f=s/Zb(Kb(lx,sx,ax)))
for(let m=0;m<=i;++m){const e=o[m],l=a[m],d=0===s?l:s*(1-m/i),p=3*m
Yb(ux,n,p),ex(ux,ux,d),Yb(cx,r,p),ex(cx,cx,e),s>0&&(Yb(ax,n,p),Yb(sx,r,p),ex(dx,rx(dx,ax,sx),f)),Yb(px,t,p),Yb(hx,n,p),Yb(fx,r,p),Jb(ax,px,ux),tx(sx,fx),ix(c,ax[0],ax[1],ax[2]),ix(u,sx[0],sx[1],sx[2]),Kb(ax,px,ux),ix(c,ax[0],ax[1],ax[2]),ix(u,sx[0],sx[1],sx[2]),Jb(ax,px,ux),nx(sx,fx),ix(c,ax[0],ax[1],ax[2]),ix(u,sx[0],sx[1],sx[2]),Kb(ax,px,ux),ix(c,ax[0],ax[1],ax[2]),ix(u,sx[0],sx[1],sx[2])}for(let m=0;m<i;++m)ix(d,h+4*m,h+4*(m+1)+1,h+4*m+1),ix(d,h+4*m,h+4*(m+1),h+4*(m+1)+1),ix(d,h+4*m+2+1,h+4*(m+1)+2+1,h+4*m+2),ix(d,h+4*m+2,h+4*(m+1)+2+1,h+4*(m+1)+2)
for(let m=0,g=4*(i+1);m<g;++m)ox(p,l)}const gx={sizeFactor:Vr.t.Numeric(.2,{min:0,max:10,step:.01}),aspectRatio:Vr.t.Numeric(5,{min:.1,max:10,step:.1}),arrowFactor:Vr.t.Numeric(1.5,{min:0,max:3,step:.1},{description:"Size factor for sheet arrows"}),tubularHelices:Vr.t.Boolean(!1,{description:"Draw alpha helices as tubes"}),roundCap:Vr.t.Boolean(!1,{description:"Draw round caps on tubular alpha helices"}),helixProfile:Vr.t.Select("elliptical",Vr.t.arrayToOptions(["elliptical","rounded","square"]),{description:"Protein helix trace profile"}),nucleicProfile:Vr.t.Select("square",Vr.t.arrayToOptions(["elliptical","rounded","square"]),{description:"Nucleic strand trace profile"}),detail:Vr.t.Numeric(0,{min:0,max:3,step:1},Mr.iy.CustomQualityParamInfo),linearSegments:Vr.t.Numeric(8,{min:1,max:48,step:1},Mr.iy.CustomQualityParamInfo),radialSegments:Vr.t.Numeric(16,{min:2,max:56,step:2},Mr.iy.CustomQualityParamInfo)},yx=(Vr.t.getDefaultValues(gx),(0,Ta.eB)())
function vx(e,t,n,r,i,o){const a=t.polymerElements.length
if(!a)return Pp.e.createEmpty(o)
const{sizeFactor:s,detail:l,linearSegments:c,radialSegments:u,aspectRatio:d,arrowFactor:p,tubularHelices:h,roundCap:f,helixProfile:m,nucleicProfile:g}=i,y=c*u*a+(u+1)*a*2,v=Ch.P.createState(y,y/10,o),b=Or.Unit.isCoarse(t),x=Vm(c),{curvePoints:S,normalVectors:_,binormalVectors:C,widthValues:w,heightValues:T}=x
let A=0
const I=vm(t,n,{ignoreSecondaryStructure:!1,useHelixOrientation:h})
for(;I.hasNext;){const e=I.move()
v.currentGroup=A
const t=(0,kp.isNucleic)(e.moleculeType),n=kp.SecondaryStructureType.is(e.secStrucType,kp.SecondaryStructureType.Flag.Beta),i=kp.SecondaryStructureType.is(e.secStrucType,kp.SecondaryStructureType.Flag.Helix),o=t?ig:rg
Um(x,e,i&&!h?.9:.5,o)
let a=r.size.size(e.centerPrev)*s,y=r.size.size(e.center)*s,P=r.size.size(e.centerNext)*s
b&&(a*=d/2,y*=d/2,P*=d/2)
const B=e.secStrucFirst||e.coarseBackboneFirst||e.first,E=e.secStrucLast||e.coarseBackboneLast||e.last,k=i&&h&&f
let D=c
if(e.initial){D=Math.max(Math.round(c*o),1)
const t=c-D
S.copyWithin(0,3*t),C.copyWithin(0,3*t),_.copyWithin(0,3*t),Ta.eB.fromArray(yx,S,3),Ta.eB.normalize(yx,Ta.eB.sub(yx,e.p2,yx)),Ta.eB.scaleAndAdd(yx,e.p2,yx,2*y),Ta.eB.toArray(yx,S,0)}else e.final&&(D=Math.max(Math.round(c*(1-o)),1),Ta.eB.fromArray(yx,S,3*D-3),Ta.eB.normalize(yx,Ta.eB.sub(yx,e.p2,yx)),Ta.eB.scaleAndAdd(yx,e.p2,yx,2*y),Ta.eB.toArray(yx,S,3*D))
if(!0===e.initial&&!0===e.final)(0,wh.X)(v,e.p2,2*y,l)
else if(n){const t=a*d,n=y*d,r=P*d,i=e.secStrucLast?n*p:0
ng(x,a,y,P,t,n,r,o),2===u?mx(v,S,_,C,D,w,T,i):kb(v,S,_,C,D,w,T,i,B,E)}else{let e,n,r
i?h?(a*=1.5*d,y*=1.5*d,P*=1.5*d,e=a,n=y,r=P):(e=a*d,n=y*d,r=P*d):t?(e=a*d,n=y*d,r=P*d):(e=a,n=y,r=P),ng(x,a,y,P,e,n,r,o)
const[s,l]=t?[C,_]:[_,C]
if(t)for(let t=0,i=s.length;t<i;t++)s[t]*=-1
const c=t?g:m
2===u?t?mx(v,S,s,l,D,T,w,0):mx(v,S,s,l,D,w,T,0):4===u?kb(v,S,s,l,D,w,T,0,B,E):n===y?Wb(v,S,s,l,D,u,w,T,B,E,"elliptical",k):"square"===c?kb(v,S,s,l,D,w,T,0,B,E):Wb(v,S,s,l,D,u,w,T,B,E,c)}++A}const P=Ch.P.getMesh(v),B=hd.f8.expand((0,hd.f8)(),t.boundary.sphere,1*i.sizeFactor)
return P.setBoundingSphere(B),P}const bx={...Ep.Te,...gx}
function xx(e){return(0,Ep.Pv)({defaultProps:Vr.t.getDefaultValues(bx),createGeometry:vx,createLocationIterator:e=>sg.fromGroup(e,{asSecondary:!0}),getLoci:ug,eachLocation:fg,setUpdateState:(e,t,n,r,i,o,a)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.tubularHelices!==n.tubularHelices||t.roundCap!==n.roundCap||t.detail!==n.detail||t.linearSegments!==n.linearSegments||t.radialSegments!==n.radialSegments||t.aspectRatio!==n.aspectRatio||t.arrowFactor!==n.arrowFactor||t.helixProfile!==n.helixProfile||t.nucleicProfile!==n.nucleicProfile
const s=hm.v.get(o.structure).version
e.info.secondaryStructureHash!==s&&(void 0!==e.info.secondaryStructureHash&&(e.createGeometry=!0),e.info.secondaryStructureHash=s)},initUpdateState:(e,t,n,r)=>{const i=hm.v.get(r.structure).version
e.info.secondaryStructureHash=i}},e)}const Sx={"polymer-trace":(e,t)=>(0,Gh.T)("Polymer trace mesh",e,t,xx),"polymer-gap":(e,t)=>(0,Gh.T)("Polymer gap cylinder",e,t,rb),"nucleotide-block":(e,t)=>(0,Gh.T)("Nucleotide block mesh",e,t,Qg),"nucleotide-ring":(e,t)=>(0,Gh.T)("Nucleotide ring mesh",e,t,yy),"nucleotide-atomic-ring-fill":(e,t)=>(0,Gh.T)("Nucleotide atomic ring fill",e,t,Ky),"nucleotide-atomic-bond":(e,t)=>(0,Gh.T)("Nucleotide atomic bond",e,t,gv),"nucleotide-atomic-element":(e,t)=>(0,Gh.T)("Nucleotide atomic element",e,t,Ov),"direction-wedge":(e,t)=>(0,Gh.T)("Polymer direction wedge",e,t,Jv)},_x={...bx,...nb,...qg,...gy,...mv,...Rv,...Zy,...Kv,sizeFactor:Vr.t.Numeric(.2,{min:0,max:10,step:.01}),visuals:Vr.t.MultiSelect(["polymer-trace","polymer-gap","nucleotide-ring","nucleotide-atomic-ring-fill","nucleotide-atomic-bond","nucleotide-atomic-element"],Vr.t.objectToOptions(Sx)),bumpFrequency:Vr.t.Numeric(2,{min:0,max:10,step:.1},Mr.iy.ShadingCategory),density:Vr.t.Numeric(.1,{min:0,max:1,step:.01},Mr.iy.ShadingCategory),colorMode:Vr.t.Select("default",Vr.t.arrayToOptions(["default","interpolate"]),{...Mr.iy.ShadingCategory,isHidden:!0})},Cx=(0,qh.GT)({name:"cartoon",label:"Cartoon",description:"Displays ribbons, planks, tubes smoothly following the trace atoms of polymers.",factory:function(e,t){return vo.YL.createMulti("Cartoon",e,t,qh.J1,Sx)},getParams:function(e,t){const n=Vr.t.clone(_x)
let r=!1,i=!1
return t.units.forEach(e=>{!r&&Or.Unit.isAtomic(e)&&e.nucleotideElements.length&&(r=!0),!i&&e.gapElements.length&&(i=!0)}),n.visuals.defaultValue=["polymer-trace"],r&&n.visuals.defaultValue.push("nucleotide-ring"),i&&n.visuals.defaultValue.push("polymer-gap"),n},defaultValues:Vr.t.getDefaultValues(_x),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.polymerResidueCount>0,ensureCustomProperties:{attach:async(e,t)=>{await hm.v.attach(e,t,void 0,!0)
for(const n of t.models)await gm.attach(e,n,void 0,!0)},detach:e=>{hm.v.ref(e,!1)
for(const t of e.models)gm.ref(t,!1)}}})
var wx=n(39376),Tx=n(60658),Ax=n(23325)
const Ix=Ta.eB.add
function Px(e,t,n,r,i,o){const{child:a}=n,s=null==a?void 0:a.unitMap.get(t.id)
if(a&&!s)return Pp.e.createEmpty(o)
const{detail:l,sizeFactor:c}=i,{elements:u,model:d}=t,p=u.length,h=p*(0,_h.J)(l),f=Ch.P.createState(h,h/2,o),m=Tx._.Provider.get(d)
if(!m)return Pp.e.createEmpty(o)
const g=(0,Ta.eB)(),y=(0,Ta.U)(),v=(0,Ta.eB)(),b=(0,Ta.eB)(),x=(0,Ta.eB)(),{elementToAnsiotrop:S,data:_}=m,{U:C}=_,w=_._schema.U.space,T=t.conformation,A=Or.StructureElement.Location.create(n)
A.unit=t
const I=Ph(n,t,i),P=(0,Ta.eB)()
let B=0
for(let M=0;M<p;M++){const e=u[M],t=S[e]
if(!(-1===t||I&&I(u[M]))){A.element=e,T.invariantPosition(e,g),Ix(P,P,g),B+=1,f.currentGroup=M,Ta.qY.toMat3(y,w,C.value(t)),Ta.U.symmtricFromLower(y,y),Ta.U.symmetricEigenvalues(v,y),Ta.U.eigenvector(b,y,v[1]),Ta.U.eigenvector(x,y,v[2])
for(let e=0;e<3;++e)v[e]=1.5958*c*Math.sqrt(Math.abs(v[e]));(0,Ax.T)(v[0],v[1],Ta.p8)&&(0,Ax.T)(v[1],v[2],Ta.p8)?(0,wh.X)(f,g,v[0],l):(0,wx.P)(f,g,x,b,v,l)}}const E=Ch.P.getMesh(f)
if(0===B)return E
let k
Ta.eB.scale(P,P,1/B)
const D=o?hd.f8.clone(o.boundingSphere):void 0
return k=D&&Ta.eB.distance(P,D.center)/D.radius<.1?D:hd.f8.expand((0,hd.f8)(),(null!=s?s:t).boundary.sphere,1*c*2),E.setBoundingSphere(k),E}const Bx={...Ep.Te,sizeFactor:Vr.t.Numeric(1,{min:0,max:10,step:.1}),detail:Vr.t.Numeric(0,{min:0,max:3,step:1},Mr.iy.CustomQualityParamInfo),ignoreHydrogens:Vr.t.Boolean(!1),ignoreHydrogensVariant:Vr.t.Select("all",Vr.t.arrayToOptions(["all","non-polar"])),traceOnly:Vr.t.Boolean(!1)}
function Ex(e){return(0,Ep.Pv)({defaultProps:Vr.t.getDefaultValues(Bx),createGeometry:Px,createLocationIterator:Nh.fromGroup,getLoci:Dh,eachLocation:kh,setUpdateState:(e,t,n)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.detail!==n.detail||t.ignoreHydrogens!==n.ignoreHydrogens}},e)}function kx(e,t,n,r,i){const{child:o}=t,{detail:a,sizeFactor:s}=r,{getSerialIndex:l}=t.serialMapping,c=t.elementCount*(0,_h.J)(a),u=Ch.P.createState(c,c/2,i),d=(0,Ta.eB)(),p=(0,Ta.U)(),h=(0,Ta.eB)(),f=(0,Ta.eB)(),m=(0,Ta.eB)(),g=(0,Ta.eB)()
let y=0
for(const S of t.units){const e=null==o?void 0:o.unitMap.get(S.id)
if(o&&!e)return Pp.e.createEmpty(i)
const{elements:n,model:c}=S,v=n.length,b=Tx._.Provider.get(c)
if(!b)return Pp.e.createEmpty(i)
const x=Ph(t,S,r),{elementToAnsiotrop:_,data:C}=b,{U:w}=C,T=C._schema.U.space,A=S.conformation,I=Or.StructureElement.Location.create(t)
I.unit=S
for(let t=0;t<v;t++){const e=n[t],r=_[e]
if(!(-1===r||x&&x(n[t]))){I.element=e,A.position(e,d),Ix(g,g,d),y+=1,u.currentGroup=l(S,n[t]),Ta.qY.toMat3(p,T,w.value(r)),Ta.U.symmtricFromLower(p,p),Ta.U.symmetricEigenvalues(h,p),Ta.U.eigenvector(f,p,h[1]),Ta.U.eigenvector(m,p,h[2])
for(let e=0;e<3;++e)h[e]=1.5958*s*Math.sqrt(Math.abs(h[e]));(0,Ax.T)(h[0],h[1],Ta.p8)&&(0,Ax.T)(h[1],h[2],Ta.p8)?(0,wh.X)(u,d,h[0],a):(0,wx.P)(u,d,m,f,h,a)}}}const v=Ch.P.getMesh(u)
if(0===y)return v
let b
Ta.eB.scale(g,g,1/y)
const x=i?hd.f8.clone(i.boundingSphere):void 0
return b=x&&Ta.eB.distance(g,x.center)/x.radius<1?x:hd.f8.expand((0,hd.f8)(),(null!=o?o:t).boundary.sphere,1*s*2),v.setBoundingSphere(b),v}const Dx={...th.EN,sizeFactor:Vr.t.Numeric(1,{min:0,max:10,step:.1}),detail:Vr.t.Numeric(0,{min:0,max:3,step:1},Mr.iy.CustomQualityParamInfo),ignoreHydrogens:Vr.t.Boolean(!1),ignoreHydrogensVariant:Vr.t.Select("all",Vr.t.arrayToOptions(["all","non-polar"])),traceOnly:Vr.t.Boolean(!1)}
function Mx(e){return(0,th.wA)({defaultProps:Vr.t.getDefaultValues(Dx),createGeometry:kx,createLocationIterator:Nh.fromStructure,getLoci:Lh,eachLocation:Oh,setUpdateState:(e,t,n)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.detail!==n.detail||t.ignoreHydrogens!==n.ignoreHydrogens}},e)}const Rx={"ellipsoid-mesh":(e,t)=>(0,qh.TP)("Ellipsoid Mesh",e,t,Ex),"intra-bond":(e,t)=>(0,qh.TP)("Intra-unit bond cylinder",e,t,sh),"inter-bond":(e,t)=>(0,qh.Kp)("Inter-unit bond cylinder",e,t,Sh),"structure-ellipsoid-mesh":(e,t)=>(0,qh.Kp)("Structure Ellipsoid Mesh",e,t,Mx),"structure-intra-bond":(e,t)=>(0,qh.Kp)("Structure intra-unit bond cylinder",e,t,ph)},Ox={...Bx,...ah,...xh,includeParent:Vr.t.Boolean(!1),adjustCylinderLength:Vr.t.Boolean(!1,{isHidden:!0}),unitKinds:(0,Qh.R8)(["atomic"]),sizeFactor:Vr.t.Numeric(1,{min:.01,max:10,step:.01}),sizeAspectRatio:Vr.t.Numeric(.1,{min:.01,max:3,step:.01}),linkCap:Vr.t.Boolean(!0),visuals:Vr.t.MultiSelect(["ellipsoid-mesh","intra-bond","inter-bond"],Vr.t.objectToOptions(Rx)),bumpFrequency:Vr.t.Numeric(0,{min:0,max:10,step:.1},Mr.iy.ShadingCategory)},Lx=(0,qh.GT)({name:"ellipsoid",label:"Ellipsoid",description:"Displays anisotropic displacement ellipsoids of atomic elements plus bonds as cylinders.",factory:function(e,t){return vo.YL.createMulti("Ellipsoid",e,t,qh.J1,Rx)},getParams:function(e,t){let n=Ox
return Or.Structure.getSize(t)>=Or.Structure.Size.Huge?(n=Vr.t.clone(n),n.visuals.defaultValue=["ellipsoid-mesh","intra-bond"]):t.unitSymmetryGroups.length>5e3&&(n=Vr.t.clone(n),n.visuals.defaultValue=["structure-ellipsoid-mesh","structure-intra-bond"]),n},defaultValues:Vr.t.getDefaultValues(Ox),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.elementCount>0&&e.models.some(e=>Tx._.Provider.isApplicable(e)),getData:(e,t)=>t.includeParent?e.asParent():e,mustRecreate:(e,t)=>e.includeParent!==t.includeParent})
var Nx=n(36568),Fx=n(53138),zx=n(95916),jx=n(83164),Vx=n(19708)
const Ux={drawCount:(0,Vx.Xb)("number"),instanceCount:(0,Vx.Xb)("number"),aRadius:(0,Vx.Yz)("float32",1,0),aPosition:(0,Vx.Yz)("float32",3,0),aGroup:(0,Vx.Yz)("float32",1,0),uCurrentSlice:(0,Vx.w5)("f"),uCurrentX:(0,Vx.w5)("f"),uCurrentY:(0,Vx.w5)("f"),uBboxMin:(0,Vx.w5)("v3","material"),uBboxSize:(0,Vx.w5)("v3","material"),uGridDim:(0,Vx.w5)("v3","material"),uGridTexDim:(0,Vx.w5)("v3","material"),uGridTexScale:(0,Vx.w5)("v2","material"),uAlpha:(0,Vx.w5)("f","material"),uResolution:(0,Vx.w5)("f","material"),uRadiusFactorInv:(0,Vx.w5)("f","material"),tMinDistanceTex:(0,Vx.$G)("texture","rgba","float","nearest","material"),dGridTexType:(0,Vx.$F)("string",["2d","3d"]),dCalcType:(0,Vx.$F)("string",["density","minDistance","groupId"])},Gx="gaussian-density"
function Hx(e){return e.namedFramebuffers[Gx]||(e.namedFramebuffers[Gx]=e.resources.framebuffer()),e.namedFramebuffers[Gx]}function qx(e,t,n,r,i,o){const a=`${Gx}-${e}`
return t.namedTextures[a]||(t.namedTextures[a]=t.resources.texture(n,r,i,o)),t.namedTextures[a]}function Qx(e,t,n,r,i,o){return e.isWebGL2?function(e,t,n,r,i,o){ud.g$&&e.timer.mark("GaussianDensityTexture3d")
const a=function(e,t,n,r,i,o){const{gl:a,resources:l,state:c,extensions:{colorBufferFloat:u,textureFloat:d,colorBufferHalfFloat:p,textureHalfFloat:h}}=e,{smoothness:f,resolution:m}=i,{drawCount:g,positions:y,radii:v,groups:b,scale:x,expandedBox:S,dim:_,maxRadius:C}=Yx(t,n,r,i),[w,T,A]=_,I=qx("min-dist-3d",e,"volume-uint8","rgba","ubyte","nearest")
I.define(w,T,A)
const P=Ta.ZY.create(1,1),B=2*C,E=Zx(e,g,y,v,b,I,S,_,_,P,f,m,B),{uCurrentSlice:k}=E.values,D=Hx(e)
function M(e,t){c.currentRenderItemId=-1
for(let n=0;n<A;++n)s.IQ.update(k,n),e.attachFramebuffer(D,0,n),t&&a.clear(a.COLOR_BUFFER_BIT),E.render()
a.flush()}return D.bind(),Kx(e),c.viewport(0,0,w,T),c.scissor(0,0,w,T),o||(o=p&&h?l.texture("volume-float16","rgba","fp16","linear"):u&&d?l.texture("volume-float32","rgba","float","linear"):l.texture("volume-uint8","rgba","ubyte","linear")),o.define(w,T,A),eS(e,E),M(o,!0),Jx(e,E),M(I,!0),tS(e,E),M(o,!1),{texture:o,scale:x,bbox:S,gridDim:_,gridTexDim:_,gridDataDim:_,gridTexScale:P,radiusFactor:B,resolution:m,maxRadius:C}}(e,t,n,r,i,o)
return ud.g$&&e.timer.markEnd("GaussianDensityTexture3d"),Xx(a)}(e,t,n,r,i,o):$x(e,t,n,r,!1,i,o)}function $x(e,t,n,r,i,o,a){ud.g$&&e.timer.mark("GaussianDensityTexture2d")
const l=function(e,t,n,r,i,o,a){const{gl:l,resources:c,state:u,extensions:{colorBufferFloat:d,textureFloat:p,colorBufferHalfFloat:h,textureHalfFloat:f,blendMinMax:m}}=e,{smoothness:g,resolution:y}=o,{drawCount:v,positions:b,radii:x,groups:S,scale:_,expandedBox:C,dim:w,maxRadius:T}=Yx(t,n,r,o),[A,I,P]=w,{texDimX:B,texDimY:E,texCols:k,powerOfTwoSize:D}=function(e){const t=e[0]*e[1]*e[2],n=Math.sqrt(t),r=Math.pow(2,Math.ceil(Math.log(n)/Math.log(2)))
let i=0,o=e[1],a=1,s=e[2]
return r<e[0]*e[2]?(s=Math.floor(r/e[0]),a=Math.ceil(e[2]/s),i=s*e[0],o*=a):i=e[0]*e[2],{texDimX:i,texDimY:o,texRows:a,texCols:s,powerOfTwoSize:o<r?r:2*r}}(w),M=Ta.eB.create(B,E,0),R=Ta.ZY.create(B/D,E/D),O=2*T,L=i?D:B,N=i?D:E,F=qx("min-dist-2d",e,"image-uint8","rgba","ubyte","nearest")
F.define(L,N)
const z=Zx(e,v,b,x,S,F,C,w,M,R,g,y,O),{uCurrentSlice:j,uCurrentX:V,uCurrentY:U}=z.values,G=Hx(e)
function H(e,t){u.currentRenderItemId=-1,e.attachFramebuffer(G,0),t&&(u.viewport(0,0,L,N),u.scissor(0,0,L,N),l.clear(l.COLOR_BUFFER_BIT)),s.IQ.update(U,0)
let n=0,r=0,i=0
for(let o=0;o<P;++o)n>=k&&(n-=k,r+=I,i=0,s.IQ.update(U,r)),s.IQ.update(V,i),s.IQ.update(j,o),u.viewport(i,r,A,I),u.scissor(i,r,A,I),z.render(),++n,i+=A
l.flush()}return G.bind(),Kx(e),a||(a=h&&f?c.texture("image-float16","rgba","fp16","linear"):d&&p?c.texture("image-float32","rgba","float","linear"):c.texture("image-uint8","rgba","ubyte","linear")),a.define(L,N),eS(e,z),H(a,!0),m&&(Jx(e,z),H(F,!0),tS(e,z),H(a,!1)),{texture:a,scale:_,bbox:C,gridDim:w,gridTexDim:M,gridDataDim:w,gridTexScale:R,radiusFactor:O,resolution:y,maxRadius:T}}(e,t,n,r,i,o,a)
return ud.g$&&e.timer.markEnd("GaussianDensityTexture2d"),Xx(l)}function Xx({texture:e,scale:t,bbox:n,gridDim:r,gridTexDim:i,gridDataDim:o,gridTexScale:a,radiusFactor:s,resolution:l,maxRadius:c}){return{transform:Wx(t,n),texture:e,bbox:n,gridDim:r,gridTexDim:i,gridDataDim:o,gridTexScale:a,radiusFactor:s,resolution:l,maxRadius:c}}function Wx(e,t){const n=Ta.$I.identity()
return Ta.$I.fromScaling(n,e),Ta.$I.setTranslation(n,t.min),n}function Yx(e,t,n,r){const{resolution:i,radiusOffset:o}=r,a=1/i,{indices:s,x:l,y:c,z:u,id:d}=e,p=Xo.CD.size(s),h=new Float32Array(3*p),f=new Float32Array(p),m=new Float32Array(p)
let g=0
for(let S=0;S<p;++S){const e=Xo.CD.getAt(s,S)
h[3*S]=l[e],h[3*S+1]=c[e],h[3*S+2]=u[e]
const t=n(e)+o
g<t&&(g=t),f[S]=t,m[S]=d?d[S]:S}const y=2*g+4*i,v=hd.DJ.expand((0,hd.DJ)(),t,Ta.eB.create(y,y,y)),b=hd.DJ.scale((0,hd.DJ)(),v,a),x=hd.DJ.size((0,Ta.eB)(),b)
return Ta.eB.ceil(x,x),{drawCount:p,positions:h,radii:f,groups:m,scale:Ta.eB.create(i,i,i),expandedBox:v,dim:x,maxRadius:g}}function Zx(e,t,n,r,i,o,a,l,c,u,d,p,h){if(e.namedComputeRenderables[Gx]){const f=Ta.eB.sub((0,Ta.eB)(),a.max,a.min),m=e.namedComputeRenderables[Gx].values
s.IQ.updateIfChanged(m.drawCount,t),s.IQ.updateIfChanged(m.instanceCount,1),s.IQ.update(m.aRadius,r),s.IQ.update(m.aPosition,n),s.IQ.update(m.aGroup,i),s.IQ.updateIfChanged(m.uCurrentSlice,0),s.IQ.updateIfChanged(m.uCurrentX,0),s.IQ.updateIfChanged(m.uCurrentY,0),s.IQ.update(m.uBboxMin,a.min),s.IQ.update(m.uBboxSize,f),s.IQ.update(m.uGridDim,l),s.IQ.update(m.uGridTexDim,c),s.IQ.update(m.uGridTexScale,u),s.IQ.updateIfChanged(m.uAlpha,d),s.IQ.updateIfChanged(m.uResolution,p),s.IQ.updateIfChanged(m.uRadiusFactorInv,1/h),s.IQ.update(m.tMinDistanceTex,o),s.IQ.updateIfChanged(m.dGridTexType,o.getDepth()>0?"3d":"2d"),s.IQ.updateIfChanged(m.dCalcType,"density"),e.namedComputeRenderables[Gx].update()}else e.namedComputeRenderables[Gx]=function(e,t,n,r,i,o,a,l,c,u,d,p,h){const f=Ta.eB.sub((0,Ta.eB)(),a.max,a.min),m={drawCount:s.IQ.create(t),instanceCount:s.IQ.create(1),aRadius:s.IQ.create(r),aPosition:s.IQ.create(n),aGroup:s.IQ.create(i),uCurrentSlice:s.IQ.create(0),uCurrentX:s.IQ.create(0),uCurrentY:s.IQ.create(0),uBboxMin:s.IQ.create(a.min),uBboxSize:s.IQ.create(f),uGridDim:s.IQ.create(l),uGridTexDim:s.IQ.create(c),uGridTexScale:s.IQ.create(u),uAlpha:s.IQ.create(d),uResolution:s.IQ.create(p),uRadiusFactorInv:s.IQ.create(1/h),tMinDistanceTex:s.IQ.create(o),dGridTexType:s.IQ.create(o.getDepth()>0?"3d":"2d"),dCalcType:s.IQ.create("density")},g={...Ux},y=(0,zx.NG)(Gx,"\nprecision highp float;\n\nattribute vec3 aPosition;\nattribute float aRadius;\n\nvarying vec3 vPosition;\nvarying float vRadiusSqInv;\n\n#if defined(dCalcType_groupId)\n    attribute float aGroup;\n    varying float vGroup;\n#endif\n\nuniform vec3 uBboxSize;\nuniform vec3 uBboxMin;\nuniform float uResolution;\n\nvoid main() {\n    vRadiusSqInv = 1.0 / (aRadius * aRadius);\n    #if defined(dCalcType_groupId)\n        vGroup = aGroup;\n    #endif\n    gl_PointSize = ceil(((aRadius * 3.0) / uResolution) + uResolution);\n    vPosition = (aPosition - uBboxMin) / uResolution;\n    gl_Position = vec4(((aPosition - uBboxMin) / uBboxSize) * 2.0 - 1.0, 1.0);\n}\n","\nprecision highp float;\n\nvarying vec3 vPosition;\nvarying float vRadiusSqInv;\n#if defined(dCalcType_groupId)\n    #if defined(dGridTexType_2d)\n        precision highp sampler2D;\n        uniform sampler2D tMinDistanceTex;\n        uniform vec3 uGridTexDim;\n    #elif defined(dGridTexType_3d)\n        precision highp sampler3D;\n        uniform sampler3D tMinDistanceTex;\n    #endif\n    varying float vGroup;\n#endif\n\n#include common\n\nuniform vec3 uGridDim;\nuniform vec2 uGridTexScale;\nuniform float uCurrentSlice;\nuniform float uCurrentX;\nuniform float uCurrentY;\nuniform float uAlpha;\nuniform float uResolution;\nuniform float uRadiusFactorInv;\n\nvoid main() {\n    vec2 v = gl_FragCoord.xy - vec2(uCurrentX, uCurrentY) - 0.5;\n    vec3 fragPos = vec3(v.x, v.y, uCurrentSlice);\n    float dist = distance(fragPos, vPosition) * uResolution;\n\n    #if defined(dCalcType_density)\n        float density = exp(-uAlpha * ((dist * dist) * vRadiusSqInv));\n        gl_FragColor.a = density * uRadiusFactorInv;\n    #elif defined(dCalcType_minDistance)\n        gl_FragColor.a = 1.0 - dist * uRadiusFactorInv;\n    #elif defined(dCalcType_groupId)\n        #if defined(dGridTexType_2d)\n            float minDistance = 1.0 - texture2D(tMinDistanceTex, (gl_FragCoord.xy) / (uGridTexDim.xy / uGridTexScale)).a;\n        #elif defined(dGridTexType_3d)\n            float minDistance = 1.0 - texelFetch(tMinDistanceTex, ivec3(gl_FragCoord.xy, uCurrentSlice), 0).a;\n        #endif\n        if (dist * uRadiusFactorInv > minDistance + uResolution * 0.05)\n            discard;\n        gl_FragColor.rgb = packIntToRGB(vGroup);\n    #endif\n}\n"),v=(0,jx.$h)(e,"points",y,g,m)
return(0,Nx._)(v,m)}(e,t,n,r,i,o,a,l,c,u,d,p,h)
return e.namedComputeRenderables[Gx]}function Kx(e){const{gl:t,state:n}=e
n.disable(t.CULL_FACE),n.enable(t.BLEND),n.disable(t.DEPTH_TEST),n.enable(t.SCISSOR_TEST),n.depthMask(!1),n.clearColor(0,0,0,0)}function Jx(e,t){const{gl:n,state:r}=e
if(s.IQ.update(t.values.dCalcType,"minDistance"),t.update(),r.colorMask(!1,!1,!1,!0),r.blendFunc(n.ONE,n.ONE),!e.extensions.blendMinMax)throw new Error("GPU gaussian surface calculation requires EXT_blend_minmax")
r.blendEquation(e.extensions.blendMinMax.MAX)}function eS(e,t){const{gl:n,state:r}=e
s.IQ.update(t.values.dCalcType,"density"),t.update(),r.colorMask(!1,!1,!1,!0),r.blendFunc(n.ONE,n.ONE),r.blendEquation(n.FUNC_ADD)}function tS(e,t){const{gl:n,state:r}=e
s.IQ.update(t.values.dCalcType,"groupId"),t.update(),r.colorMask(!0,!0,!0,!1),r.blendFunc(n.ONE,n.ZERO),r.blendEquation(n.FUNC_ADD)}var nS=n(77675),rS=n(20321),iS=n(92219),oS=n(52057),aS=n(42095)
async function sS(e,t,n,r,i){const{resolution:o,radiusOffset:a,smoothness:s}=i,l=1/o,{indices:c,x:u,y:d,z:p,id:h}=t,f=rS.C.size(c),m=new Float32Array(f)
let g=0
for(let j=0;j<f;++j){const e=r(rS.C.getAt(c,j))+a
g<e&&(g=e),m[j]=e}const y=2*g+o,v=oS.D.expand((0,oS.D)(),n,Za.e.create(y,y,y)),b=v.min,x=oS.D.scale((0,oS.D)(),v,l),S=oS.D.size((0,Za.e)(),x)
Za.e.ceil(S,S)
const _=aS.q.Space(S,[0,1,2],Float32Array),C=_.create(),w=aS.q.create(_,C),T=_.create()
T.fill(-1)
const A=aS.q.create(_,T),[I,P,B]=S,E=B,k=E*P,D=(0,nS.o)(S[0],b[0],o),M=(0,nS.o)(S[1],b[1],o),R=(0,nS.o)(S[2],b[2],o),O=_.create(),L=s,N=Math.ceil(1e5/(Math.pow(Math.pow(g,3),3)*l))
function F(e,t){for(let n=e;n<t;++n){const e=rS.C.getAt(c,n),t=u[e],r=d[e],i=p[e],o=m[n],a=1/(o*o),s=2*o,f=s*s,g=Math.ceil(s*l),y=Math.floor(l*(t-b[0])),v=Math.floor(l*(r-b[1])),x=Math.floor(l*(i-b[2])),S=Math.max(0,y-g),_=Math.max(0,v-g),w=Math.max(0,x-g),A=Math.min(I,y+g+2),N=Math.min(P,v+g+2),F=Math.min(B,x+g+2)
for(let l=S;l<A;++l){const e=D[l]-t,o=l*k
for(let t=_;t<N;++t){const s=M[t]-r,l=e*e+s*s,c=t*E+o
for(let e=w;e<F;++e){const t=R[e]-i,r=l+t*t
if(r<=f){const t=(0,iS.RL)(r*a*-L),i=e+c
C[i]+=t,t>O[i]&&(O[i]=t,T[i]=h?h[n]:n)}}}}}}await async function(){for(let t=0;t<f;t+=N)F(t,Math.min(t+N,f)),e.shouldUpdate&&await e.update({message:"filling density grid",current:t,max:f})}()
const z=Ia.$.identity()
return Ia.$.fromScaling(z,Za.e.create(o,o,o)),Ia.$.setTranslation(z,v.min),{field:w,idField:A,transform:z,radiusFactor:1,resolution:o,maxRadius:g}}const lS={resolution:Vr.t.Numeric(1,{min:.1,max:20,step:.1},{description:"Grid resolution/cell spacing.",...Mr.iy.CustomQualityParamInfo}),radiusOffset:Vr.t.Numeric(0,{min:0,max:10,step:.1},{description:"Extra/offset radius added to the atoms/coarse elements for gaussian calculation. Useful to create coarse, low resolution surfaces."}),smoothness:Vr.t.Numeric(1.5,{min:.5,max:2.5,step:.1},{description:"Smoothness of the gausian surface, lower is smoother."}),...Op.$J}
function cS(e,t){const n=e.maxTextureSize/3
return n*n/Math.max(1,t?t.units.length/16:1)}function uS(e,t,n,r){const{position:i,boundary:o,radius:a}=(0,Op.LT)(e,t,n,r),s=(0,Op.FC)(o.box,r)
return Fr.Task.create("Gaussian Density",async e=>await sS(e,i,o.box,a,s))}Vr.t.getDefaultValues(lS)
var dS=n(56642),pS=n(70948),hS=n(20276),fS=n(98529),mS=n(386),gS=n(80813)
const yS={...lS,...Mr.uE,ignoreHydrogens:Vr.t.Boolean(!1),ignoreHydrogensVariant:Vr.t.Select("all",Vr.t.arrayToOptions(["all","non-polar"])),tryUseGpu:Vr.t.Boolean(!0),includeParent:Vr.t.Boolean(!1,{isHidden:!0})},vS={...Ep.Te,...Ep.ii,...yS},bS={...th.EN,...th.Hj,...yS}
function xS(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.textureFloatLinear&&e.extensions.blendMinMax&&e.extensions.drawBuffers}function SS(e,t,n){if(t.resolution>1)return!1
const r=n.maxTextureSize/3,{areaCells:i,maxAreaCells:o}=(0,Op.Dt)(e.boundary.box,t.resolution,r*r)
return i<o}function _S(e,t,n,r){return n.tryUseGpu&&r&&xS(r)&&SS(t,n,r)?function(e){return(0,Ep.O$)({defaultProps:Vr.t.getDefaultValues(vS),createGeometry:IS,createLocationIterator:Nh.fromGroup,getLoci:Dh,eachLocation:kh,setUpdateState:(e,t,n)=>{t.resolution!==n.resolution&&(e.createGeometry=!0),t.radiusOffset!==n.radiusOffset&&(e.createGeometry=!0),t.smoothness!==n.smoothness&&(e.createGeometry=!0),t.ignoreHydrogens!==n.ignoreHydrogens&&(e.createGeometry=!0),t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(e.createGeometry=!0),t.traceOnly!==n.traceOnly&&(e.createGeometry=!0),t.includeParent!==n.includeParent&&(e.createGeometry=!0),t.smoothColors.name!==n.smoothColors.name?e.updateColor=!0:"on"===t.smoothColors.name&&"on"===n.smoothColors.name&&(t.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(e.updateColor=!0),t.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(e.updateColor=!0))},mustRecreate:(e,t,n)=>!t.tryUseGpu||!n||!SS(e.structure,t,n),processValues:(e,t,n,r,i)=>{const{resolution:o,colorTexture:a}=t.meta,s=(0,Mr.Y0)(n.smoothColors,r.color.preferSmoothing,o)
s&&i&&((0,mS._i)(e,s.resolution,s.stride,i,a),t.meta.colorTexture=e.tColorGrid.ref.value)},dispose:e=>{var t
e.vertexTexture.ref.value.destroy(),e.groupTexture.ref.value.destroy(),e.normalTexture.ref.value.destroy(),e.doubleBuffer.destroy(),null===(t=e.meta.colorTexture)||void 0===t||t.destroy()}},e)}(e):function(e){return(0,Ep.Pv)({defaultProps:Vr.t.getDefaultValues(vS),createGeometry:wS,createLocationIterator:Nh.fromGroup,getLoci:Dh,eachLocation:kh,setUpdateState:(e,t,n)=>{t.resolution!==n.resolution&&(e.createGeometry=!0),t.radiusOffset!==n.radiusOffset&&(e.createGeometry=!0),t.smoothness!==n.smoothness&&(e.createGeometry=!0),t.ignoreHydrogens!==n.ignoreHydrogens&&(e.createGeometry=!0),t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(e.createGeometry=!0),t.traceOnly!==n.traceOnly&&(e.createGeometry=!0),t.includeParent!==n.includeParent&&(e.createGeometry=!0),t.smoothColors.name!==n.smoothColors.name?e.updateColor=!0:"on"===t.smoothColors.name&&"on"===n.smoothColors.name&&(t.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(e.updateColor=!0),t.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(e.updateColor=!0))},mustRecreate:(e,t,n)=>t.tryUseGpu&&!!n&&SS(e.structure,t,n),processValues:(e,t,n,r,i)=>{const{resolution:o,colorTexture:a}=t.meta,s=(0,Mr.Y0)(n.smoothColors,r.color.preferSmoothing,o)
s&&((0,fS.XP)(e,s.resolution,s.stride,i,a),t.meta.colorTexture=e.tColorGrid.ref.value)},dispose:e=>{var t
null===(t=e.meta.colorTexture)||void 0===t||t.destroy()}},e)}(e)}function CS(e,t,n,r){return n.tryUseGpu&&r&&xS(r)&&SS(t,n,r)?function(e){return(0,th.hJ)({defaultProps:Vr.t.getDefaultValues(bS),createGeometry:PS,createLocationIterator:Nh.fromStructure,getLoci:Lh,eachLocation:Oh,setUpdateState:(e,t,n)=>{t.resolution!==n.resolution&&(e.createGeometry=!0),t.radiusOffset!==n.radiusOffset&&(e.createGeometry=!0),t.smoothness!==n.smoothness&&(e.createGeometry=!0),t.ignoreHydrogens!==n.ignoreHydrogens&&(e.createGeometry=!0),t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(e.createGeometry=!0),t.traceOnly!==n.traceOnly&&(e.createGeometry=!0),t.includeParent!==n.includeParent&&(e.createGeometry=!0),t.smoothColors.name!==n.smoothColors.name?e.updateColor=!0:"on"===t.smoothColors.name&&"on"===n.smoothColors.name&&(t.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(e.updateColor=!0),t.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(e.updateColor=!0))},mustRecreate:(e,t,n)=>!t.tryUseGpu||!n||!SS(e,t,n),processValues:(e,t,n,r,i)=>{const{resolution:o,colorTexture:a}=t.meta,s=(0,Mr.Y0)(n.smoothColors,r.color.preferSmoothing,o)
s&&i&&((0,mS._i)(e,s.resolution,s.stride,i,a),t.meta.colorTexture=e.tColorGrid.ref.value)},dispose:e=>{var t
e.vertexTexture.ref.value.destroy(),e.groupTexture.ref.value.destroy(),e.normalTexture.ref.value.destroy(),e.doubleBuffer.destroy(),null===(t=e.meta.colorTexture)||void 0===t||t.destroy()}},e)}(e):function(e){return(0,th.wA)({defaultProps:Vr.t.getDefaultValues(bS),createGeometry:TS,createLocationIterator:Nh.fromStructure,getLoci:Lh,eachLocation:Oh,setUpdateState:(e,t,n)=>{t.resolution!==n.resolution&&(e.createGeometry=!0),t.radiusOffset!==n.radiusOffset&&(e.createGeometry=!0),t.smoothness!==n.smoothness&&(e.createGeometry=!0),t.ignoreHydrogens!==n.ignoreHydrogens&&(e.createGeometry=!0),t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(e.createGeometry=!0),t.traceOnly!==n.traceOnly&&(e.createGeometry=!0),t.smoothColors.name!==n.smoothColors.name?e.updateColor=!0:"on"===t.smoothColors.name&&"on"===n.smoothColors.name&&(t.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(e.updateColor=!0),t.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(e.updateColor=!0))},mustRecreate:(e,t,n)=>t.tryUseGpu&&!!n&&SS(e,t,n),processValues:(e,t,n,r,i)=>{const{resolution:o,colorTexture:a}=t.meta,s=(0,Mr.Y0)(n.smoothColors,r.color.preferSmoothing,o)
s&&((0,fS.XP)(e,s.resolution,s.stride,i,a),t.meta.colorTexture=e.tColorGrid.ref.value)},dispose:e=>{var t
null===(t=e.meta.colorTexture)||void 0===t||t.destroy()}},e)}(e)}async function wS(e,t,n,r,i,o){const{smoothness:a}=i,{transform:s,field:l,idField:c,radiusFactor:u,resolution:d,maxRadius:p}=await uS(n,t,r.size,i).runInContext(e.runtime),h={isoLevel:Math.exp(-a)/u,scalarField:l,idField:c},f=await(0,dS.O)(h,o).runAsChild(e.runtime)
f.meta.resolution=d,Pp.e.transform(f,s),e.webgl&&!e.webgl.isWebGL2?(Pp.e.uniformTriangleGroup(f),gS.IQ.updateIfChanged(f.varyingGroup,!1)):gS.IQ.updateIfChanged(f.varyingGroup,!0)
const m=hd.f8.expand((0,hd.f8)(),t.boundary.sphere,p)
return f.setBoundingSphere(m),f}async function TS(e,t,n,r,i){const{smoothness:o}=r,{transform:a,field:s,idField:l,radiusFactor:c,resolution:u,maxRadius:d}=await function(e,t,n){const{position:r,boundary:i,radius:o}=(0,Op.oc)(e,t,n),a=(0,Op.FC)(i.box,n)
return Fr.Task.create("Gaussian Density",async e=>await sS(e,r,i.box,o,a))}(t,n.size,r).runInContext(e.runtime),p={isoLevel:Math.exp(-o)/c,scalarField:s,idField:l},h=await(0,dS.O)(p,i).runAsChild(e.runtime)
h.meta.resolution=u,Pp.e.transform(h,a),e.webgl&&!e.webgl.isWebGL2?(Pp.e.uniformTriangleGroup(h),gS.IQ.updateIfChanged(h.varyingGroup,!1)):gS.IQ.updateIfChanged(h.varyingGroup,!0)
const f=hd.f8.expand((0,hd.f8)(),t.boundary.sphere,d)
return h.setBoundingSphere(f),h}const AS="gaussian-surface"
function IS(e,t,n,r,i,o){const{webgl:a}=e
if(!a)throw new Error("webgl context required to create gaussian surface texture-mesh")
const{namedTextures:s,resources:l,extensions:{colorBufferFloat:c,textureFloat:u,colorBufferHalfFloat:d,textureHalfFloat:p}}=a
s[AS]||(s[AS]=d&&p?l.texture("image-float16","rgba","fp16","linear"):c&&u?l.texture("image-float32","rgba","float","linear"):l.texture("image-uint8","rgba","ubyte","linear"))
const h=Ta.eB.create(0,1,2),f=t.elements.length,m=e=>{ud.g$&&a.timer.mark("createGaussianSurfaceTextureMesh")
const o=function(e,t,n,r,i,o,a){const{position:s,boundary:l,radius:c}=(0,Op.LT)(e,t,n,i),u=(0,Op.FC)(l.box,i,cS(o,e))
return $x(o,s,l.box,c,!0,u,a)}(n,t,r.size,0,i,a,s[AS]),l=Math.exp(-i.smoothness)/o.radiusFactor,c=null==e?void 0:e.doubleBuffer.get(),u=(0,hS._)(a,o.texture,o.gridDim,o.gridTexDim,o.gridDataDim,o.gridTexScale,o.transform,l,!1,!0,h,!0,null==c?void 0:c.vertex,null==c?void 0:c.group,null==c?void 0:c.normal)
ud.g$&&a.timer.markEnd("createGaussianSurfaceTextureMesh")
const d=hd.f8.expand((0,hd.f8)(),t.boundary.sphere,o.maxRadius),p=pS.X.create(u.vertexCount,f,u.vertexTexture,u.groupTexture,u.normalTexture,d,e)
return p.meta.resolution=o.resolution,p},g=m(o)
return g.meta.webgl=a,g.meta.reset=()=>{m(g)},g}function PS(e,t,n,r,i){const{webgl:o}=e
if(!o)throw new Error("webgl context required to create structure gaussian surface texture-mesh")
const{namedTextures:a,resources:s,extensions:{colorBufferFloat:l,textureFloat:c,colorBufferHalfFloat:u,textureHalfFloat:d}}=o
a[AS]||(a[AS]=u&&d?s.texture("image-float16","rgba","fp16","linear"):l&&c?s.texture("image-float32","rgba","float","linear"):s.texture("image-uint8","rgba","ubyte","linear"))
const p=Ta.eB.create(0,1,2),h=t.elementCount,f=e=>{ud.g$&&o.timer.mark("createStructureGaussianSurfaceTextureMesh")
const i=function(e,t,n,r,i,o){const{box:a}=e.lookup3d.boundary,{position:s,boundary:l,radius:c}=(0,Op.oc)(e,t,r)
return $x(i,s,a,c,!0,(0,Op.FC)(l.box,r),o)}(t,n.size,0,r,o,a[AS]),s=Math.exp(-r.smoothness)/i.radiusFactor,l=null==e?void 0:e.doubleBuffer.get(),c=(0,hS._)(o,i.texture,i.gridDim,i.gridTexDim,i.gridDataDim,i.gridTexScale,i.transform,s,!1,!0,p,!0,null==l?void 0:l.vertex,null==l?void 0:l.group,null==l?void 0:l.normal)
ud.g$&&o.timer.markEnd("createStructureGaussianSurfaceTextureMesh")
const u=hd.f8.expand((0,hd.f8)(),t.boundary.sphere,i.maxRadius),d=pS.X.create(c.vertexCount,h,c.vertexTexture,c.groupTexture,c.normalTexture,u,e)
return d.meta.resolution=i.resolution,d},m=f(i)
return m.meta.webgl=o,m.meta.reset=()=>{f(m)},m}var BS=n(30084)
async function ES(e,t,n,r,i,o){const{smoothness:a}=i,{transform:s,field:l,idField:c,maxRadius:u}=await uS(n,t,r.size,i).runInContext(e.runtime),d={isoLevel:Math.exp(-a),scalarField:l,idField:c},p=await(0,dS.e)(d,o).runAsChild(e.runtime)
BS.q.transform(p,s)
const h=hd.f8.expand((0,hd.f8)(),t.boundary.sphere,u)
return p.setBoundingSphere(h),p}const kS={...Ep.zj,...lS,sizeFactor:Vr.t.Numeric(3,{min:0,max:10,step:.1}),lineSizeAttenuation:Vr.t.Boolean(!1),ignoreHydrogens:Vr.t.Boolean(!1),ignoreHydrogensVariant:Vr.t.Select("all",Vr.t.arrayToOptions(["all","non-polar"])),includeParent:Vr.t.Boolean(!1,{isHidden:!0})}
function DS(e){return(0,Ep.zK)({defaultProps:Vr.t.getDefaultValues(kS),createGeometry:ES,createLocationIterator:Nh.fromGroup,getLoci:Dh,eachLocation:kh,setUpdateState:(e,t,n)=>{t.resolution!==n.resolution&&(e.createGeometry=!0),t.radiusOffset!==n.radiusOffset&&(e.createGeometry=!0),t.smoothness!==n.smoothness&&(e.createGeometry=!0),t.ignoreHydrogens!==n.ignoreHydrogens&&(e.createGeometry=!0),t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(e.createGeometry=!0),t.traceOnly!==n.traceOnly&&(e.createGeometry=!0),t.includeParent!==n.includeParent&&(e.createGeometry=!0)}},e)}const MS={"gaussian-surface-mesh":(e,t)=>(0,Gh.T)("Gaussian surface mesh",e,t,_S),"structure-gaussian-surface-mesh":(e,t)=>(0,qh.Kp)("Structure-Gaussian surface mesh",e,t,CS),"gaussian-surface-wireframe":(e,t)=>(0,Gh.T)("Gaussian surface wireframe",e,t,DS)},RS={...vS,...kS,visuals:Vr.t.MultiSelect(["gaussian-surface-mesh"],Vr.t.objectToOptions(MS)),bumpFrequency:Vr.t.Numeric(1,{min:0,max:10,step:.1},Mr.iy.ShadingCategory),density:Vr.t.Numeric(.5,{min:0,max:1,step:.01},Mr.iy.ShadingCategory)},OS=(0,qh.GT)({name:"gaussian-surface",label:"Gaussian Surface",description:"Displays a gaussian molecular surface.",factory:function(e,t){return vo.YL.createMulti("Gaussian Surface",e,t,qh.J1,MS)},getParams:function(e,t){return RS},defaultValues:Vr.t.getDefaultValues(RS),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"physical"},isApplicable:e=>e.elementCount>0})
var LS=n(7818)
const NS={...th.ip,background:Vr.t.Boolean(!1),backgroundMargin:Vr.t.Numeric(0,{min:0,max:1,step:.01}),backgroundColor:Vr.t.Color(zr.ColorNames.black),backgroundOpacity:Vr.t.Numeric(.5,{min:0,max:1,step:.01}),borderWidth:Vr.t.Numeric(.25,{min:0,max:.5,step:.01}),level:Vr.t.Select("residue",[["chain","Chain"],["residue","Residue"],["element","Element"]],{isEssential:!0}),ignoreHydrogens:Vr.t.Boolean(!1),ignoreHydrogensVariant:Vr.t.Select("all",Vr.t.arrayToOptions(["all","non-polar"])),chainScale:Vr.t.Numeric(10,{min:0,max:20,step:.1}),residueScale:Vr.t.Numeric(1,{min:0,max:20,step:.1}),elementScale:Vr.t.Numeric(.5,{min:0,max:20,step:.1})}
function FS(e){return(0,th.Go)({defaultProps:Vr.t.getDefaultValues(NS),createGeometry:zS,createLocationIterator:Nh.fromStructure,getLoci:Lh,eachLocation:Oh,setUpdateState:(e,t,n)=>{e.createGeometry=t.level!==n.level||"chain"===t.level&&t.chainScale!==n.chainScale||"residue"===t.level&&t.residueScale!==n.residueScale||"element"===t.level&&t.elementScale!==n.elementScale||t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant}},e)}function zS(e,t,n,r,i){switch(r.level){case"chain":return function(e,t,n,r,i){const o=Or.StructureElement.Location.create(t),{units:a,serialMapping:s}=t,{auth_asym_id:l,label_asym_id:c}=Or.StructureProperties.chain,{cumulativeUnitElementCount:u}=s,d=a.length,{chainScale:p}=r,h=LS.t.create(r,d,d/2,i)
for(let f=0,m=a.length;f<m;++f){const e=a[f]
o.unit=e,o.element=e.elements[0]
const{center:t,radius:n}=e.lookup3d.boundary.sphere
Ta.eB.transformMat4(jS,t,e.conformation.operator.matrix)
const r=l(o),i=c(o),s=r===i?i:`${i} [${r}]`
h.add(s,jS[0],jS[1],jS[2],n,p,u[f])}return h.getText()}(0,t,0,r,i)
case"residue":return function(e,t,n,r,i){const o=Or.StructureElement.Location.create(t),{units:a,serialMapping:s}=t,{label_comp_id:l}=Or.StructureProperties.atom,{auth_seq_id:c}=Or.StructureProperties.residue,{cumulativeUnitElementCount:u}=s,d=2*t.polymerResidueCount,{residueScale:p}=r,h=LS.t.create(r,d,d/2,i)
for(let f=0,m=a.length;f<m;++f){const e=a[f],t=e.conformation,{elements:n}=e
o.unit=e,o.element=e.elements[0]
const r=e.model.atomicHierarchy.residueAtomSegments.index,i=u[f]
let s=0
const d=n.length
for(;s<d;){const e=s,a=r[n[s]]
for(s++;s<d&&r[n[s]]===a;)s++
VS.reset()
for(let r=e;r<s;r++)t.position(n[r],jS),VS.includePosition(jS)
VS.finishedIncludeStep()
for(let r=e;r<s;r++)t.position(n[r],jS),VS.radiusPosition(jS)
o.element=n[e]
const{center:u,radius:f}=VS.getSphere(),m=c(o),g=`${l(o)} ${m}`
h.add(g,u[0],u[1],u[2],f,p,i+e)}}return h.getText()}(0,t,0,r,i)
case"element":return function(e,t,n,r,i){const o=Or.StructureElement.Location.create(t),{units:a,serialMapping:s}=t,{label_atom_id:l,label_alt_id:c}=Or.StructureProperties.atom,{cumulativeUnitElementCount:u}=s,d=n.size,p=t.elementCount,{elementScale:h}=r,f=LS.t.create(r,p,p/2,i)
for(let m=0,g=a.length;m<g;++m){const e=a[m],n=e.conformation,{elements:i}=e
o.unit=e
const s=u[m],p=Ph(t,e,{...r,traceOnly:!1})
for(let t=0,r=i.length;t<r;t++){if(p&&p(i[t]))continue
o.element=i[t],n.position(o.element,jS)
const e=l(o),r=c(o),a=r?`${e}%${r}`:e
f.add(a,jS[0],jS[1],jS[2],d.size(o),h,s+t)}}return f.getText()}(0,t,n,r,i)}}const jS=(0,Ta.eB)(),VS=new Yd.Z("98"),US={"label-text":(e,t)=>(0,qh.Kp)("Label text",e,t,FS)},GS={...NS,visuals:Vr.t.MultiSelect(["label-text"],Vr.t.objectToOptions(US))},HS=(0,qh.GT)({name:"label",label:"Label",description:"Displays labels.",factory:function(e,t){const n=vo.YL.createMulti("Label",e,t,qh.J1,US)
return n.setState({pickable:!1,markerActions:bo.xi.None}),n},getParams:function(e,t){return GS},defaultValues:Vr.t.getDefaultValues(GS),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"physical"},isApplicable:e=>e.elementCount>0})
var qS=n(82094)
const QS={probeRadius:Vr.t.Numeric(1.4,{min:0,max:10,step:.1},{description:"Radius of the probe tracing the molecular surface."}),resolution:Vr.t.Numeric(.5,{min:.01,max:20,step:.01},{description:"Grid resolution/cell spacing."}),probePositions:Vr.t.Numeric(36,{min:12,max:90,step:1},{description:"Number of positions tested for probe target intersection."})}
Vr.t.getDefaultValues(QS)
const $S={...QS,resolution:{...QS.resolution,...Mr.iy.CustomQualityParamInfo},probePositions:{...QS.probePositions,...Mr.iy.CustomQualityParamInfo}}
function XS(e,t,n,r){const{position:i,boundary:o,maxRadius:a}=function(e,t,n,r){const{probeRadius:i}=r,{position:o,boundary:a,radius:s}=(0,Op.LT)(e,t,n,r),{indices:l}=o,c=Xo.CD.size(l),u=new Float32Array(Xo.CD.end(l))
let d=0
for(let p=0;p<c;++p){const e=Xo.CD.getAt(l,p),t=s(e)
d<t&&(d=t),u[e]=t+i}return{position:{...o,radius:u},boundary:a,maxRadius:d}}(e,t,n,r),s=(0,Op.FC)(o.box,r)
return Fr.Task.create("Molecular Surface",async e=>await WS(e,i,o,a,o.box,s))}async function WS(e,t,n,r,i,o){return async function(e,t,n,r,i,o){let a=-1
function s(e,t,n,r,i){if(-1!==a){const o=a
if(o!==r&&o!==i&&l(o,e,t,n))return o
a=-1}for(let o=0,s=w.count;o<s;++o){const s=rS.C.getAt(T,w.indices[o])
if(s!==r&&s!==i&&l(s,e,t,n))return a=s,s}return-1}function l(e,t,n,r){const i=E[e],o=A[e]-t,a=I[e]-n,s=P[e]-r
return o*o+a*a+s*s<i*i}function c(e,t){for(let n=e;n<t;++n){const e=rS.C.getAt(T,n),t=A[e],r=I[e],i=P[e],o=E[e],a=o*o,l=S>0
C.find(t,r,i,o)
const c=Math.ceil(o*b)+S,u=Math.floor(b*(t-R)),d=Math.floor(b*(r-O)),p=Math.floor(b*(i-L)),h=Math.max(0,u-c),f=Math.max(0,d-c),m=Math.max(0,p-c),g=Math.min(z,u+c+2),y=Math.min(j,d+c+2),v=Math.min(V,p+c+2)
for(let b=h;b<g;++b){const c=W[b]-t,u=b*G
for(let d=f;d<y;++d){const p=Y[d]-r,h=c*c+p*p,f=d*U+u
for(let u=m;u<v;++u){const d=Z[u]-i,m=h+d*d
if(l||m<a){const h=u+f,g=Math.sqrt(m),y=o/g,v=s(c*y+t,p*y+r,d*y+i,e,-1)
if(m<a){if($[h]<0&&($[h]*=-1),-1===v){const e=o-g
e<$[h]&&($[h]=e,X[h]=B[n])}}else if(l&&-1===v){const e=o-g
e>$[h]&&($[h]=e)}}}}}}}const u=(0,Za.e)(),d=(0,Za.e)(),p=(0,Za.e)(),h=(0,Za.e)()
function f(e,t){const n=E[e],r=E[t],i=u[0]=A[t]-A[e],o=u[1]=I[t]-I[e],l=u[2]=P[t]-P[e],c=i*i+o*o+l*l,f=Math.sqrt(c),m=n*((n*n+f*f-r*r)/(2*n*f))
var g,y
Za.e.normalize(u,u),y=u,(g=p)[0]=g[1]=g[2]=1,0!==y[0]?g[0]=(y[1]+y[2])/-y[0]:0!==y[1]?g[1]=(y[0]+y[2])/-y[1]:0!==y[2]&&(g[2]=(y[0]+y[1])/-y[2]),Za.e.normalize(p,p),Za.e.cross(h,u,p),Za.e.normalize(h,h)
const S=Math.sqrt(n*n-m*m)
Za.e.scale(p,p,S),Za.e.scale(h,h,S),Za.e.scale(u,u,m),d[0]=u[0]+A[e],d[1]=u[1]+I[e],d[2]=u[2]+P[e],a=-1
for(let a=0;a<v;++a){const n=H[a],r=q[a],i=d[0]+n*p[0]+r*h[0],o=d[1]+n*p[1]+r*h[1],l=d[2]+n*p[2]+r*h[2]
if(-1===s(i,o,l,e,t)){const n=Math.floor(b*(i-R)),r=Math.floor(b*(o-O)),a=Math.floor(b*(l-L)),s=Math.max(0,n-x),c=Math.max(0,r-x),d=Math.max(0,a-x),p=Math.min(z,n+x+2),h=Math.min(j,r+x+2),f=Math.min(V,a+x+2)
for(let m=s;m<p;++m){const n=i-W[m],r=m*G
for(let i=c;i<h;++i){const a=o-Y[i],s=n*n+a*a,c=i*U+r
for(let r=d;r<f;++r){const i=l-Z[r],o=s+i*i,d=r+c,p=$[d]
if(p>0&&o<p*p){$[d]=Math.sqrt(o)
const r=n*u[0]+a*u[1]+i*u[2]
X[d]=B[rS.C.indexOf(T,r<0?t:e)]}}}}}}}function m(e,t){for(let n=e;n<t;++n){const e=rS.C.getAt(T,n)
C.find(A[e],I[e],P[e],E[e])
for(let t=0,n=w.count;t<n;++t){const n=rS.C.getAt(T,w.indices[t])
e<n&&f(e,n)}}}const{resolution:g,probeRadius:y,probePositions:v}=o,b=1/g,x=2+Math.floor(y*b),S=y<2*g?1:0,_=Za.e.create(r,r,r)
Za.e.scale(_,_,2)
const C=(0,qS.E)(t,n,_),w=C.result
null===i&&(i=C.boundary.box)
const{indices:T,x:A,y:I,z:P,id:B,radius:E}=t,k=rS.C.size(T),D=r+g,M=oS.D.expand((0,oS.D)(),i,Za.e.create(D,D,D)),[R,O,L]=M.min,N=oS.D.scale((0,oS.D)(),M,b),F=oS.D.size((0,Za.e)(),N)
Za.e.ceil(F,F)
const[z,j,V]=F,U=V,G=U*j,{cosTable:H,sinTable:q}=function(e){let t=0
const n=2*Math.PI/e,r=new Float32Array(e),i=new Float32Array(e)
for(let o=0;o<e;o++)r[o]=Math.cos(t),i[o]=Math.sin(t),t+=n
return{cosTable:r,sinTable:i}}(v),Q=aS.q.Space(F,[0,1,2],Float32Array),$=Q.create(),X=Q.create()
$.fill(-1001),X.fill(-1)
const W=(0,nS.o)(z,R,g),Y=(0,nS.o)(j,O,g),Z=(0,nS.o)(V,L,g),K=Math.ceil(1e5/(Math.pow(Math.pow(r,3),3)*b))
await async function(){for(let t=0;t<k;t+=K)c(t,Math.min(t+K,k)),e.shouldUpdate&&await e.update({message:"projecting points",current:t,max:k})}(),await async function(){for(let t=0;t<k;t+=K)m(t,Math.min(t+K,k)),e.shouldUpdate&&await e.update({message:"projecting torii",current:t,max:k})}()
const J=aS.q.create(Q,$),ee=aS.q.create(Q,X),te=Ia.$.identity()
return Ia.$.fromScaling(te,Za.e.create(g,g,g)),Ia.$.setTranslation(te,M.min),{field:J,idField:ee,transform:te,resolution:g,maxRadius:r}}(e,t,n,r,i,o)}const YS={...Ep.Te,...$S,...Op.$J,...Mr.uE}
async function ZS(e,t,n,r,i,o){const{transform:a,field:l,idField:c,resolution:u,maxRadius:d}=await XS(n,t,r.size,i).runInContext(e.runtime),p={isoLevel:i.probeRadius,scalarField:l,idField:c},h=await(0,dS.O)(p,o).runAsChild(e.runtime)
if(i.includeParent){const e=Math.ceil(2/i.resolution)
Pp.e.smoothEdges(h,{iterations:e,maxNewEdgeLength:Math.sqrt(2)})}Pp.e.transform(h,a),e.webgl&&!e.webgl.isWebGL2?(Pp.e.uniformTriangleGroup(h),s.IQ.updateIfChanged(h.varyingGroup,!1)):s.IQ.updateIfChanged(h.varyingGroup,!0)
const f=hd.f8.expand((0,hd.f8)(),t.boundary.sphere,d)
return h.setBoundingSphere(f),h.meta.resolution=u,h}function KS(e){return(0,Ep.Pv)({defaultProps:Vr.t.getDefaultValues(YS),createGeometry:ZS,createLocationIterator:Nh.fromGroup,getLoci:Dh,eachLocation:kh,setUpdateState:(e,t,n)=>{t.resolution!==n.resolution&&(e.createGeometry=!0),t.probeRadius!==n.probeRadius&&(e.createGeometry=!0),t.probePositions!==n.probePositions&&(e.createGeometry=!0),t.ignoreHydrogens!==n.ignoreHydrogens&&(e.createGeometry=!0),t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(e.createGeometry=!0),t.traceOnly!==n.traceOnly&&(e.createGeometry=!0),t.includeParent!==n.includeParent&&(e.createGeometry=!0),t.smoothColors.name!==n.smoothColors.name?e.updateColor=!0:"on"===t.smoothColors.name&&"on"===n.smoothColors.name&&(t.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(e.updateColor=!0),t.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(e.updateColor=!0))},processValues:(e,t,n,r,i)=>{const{resolution:o,colorTexture:a}=t.meta,s=(0,Mr.Y0)(n.smoothColors,r.color.preferSmoothing,o)
s&&((0,fS.XP)(e,s.resolution,s.stride,i,a),t.meta.colorTexture=e.tColorGrid.ref.value)},dispose:e=>{var t
null===(t=e.meta.colorTexture)||void 0===t||t.destroy()}},e)}async function JS(e,t,n,r,i){const{transform:o,field:a,idField:l,resolution:c,maxRadius:u}=await function(e,t,n){const{position:r,boundary:i,maxRadius:o}=function(e,t,n){const{probeRadius:r}=n,{position:i,boundary:o,radius:a}=(0,Op.oc)(e,t,n),{indices:s}=i,l=Xo.CD.size(s),c=new Float32Array(Xo.CD.end(s))
let u=0
for(let d=0;d<l;++d){const e=Xo.CD.getAt(s,d),t=a(e)
u<t&&(u=t),c[e]=t+r}return{position:{...i,radius:c},boundary:o,maxRadius:u}}(e,t,n),a=(0,Op.FC)(i.box,n)
return Fr.Task.create("Molecular Surface",async e=>await WS(e,r,i,o,i.box,a))}(t,n.size,r).runInContext(e.runtime),d={isoLevel:r.probeRadius,scalarField:a,idField:l},p=await(0,dS.O)(d,i).runAsChild(e.runtime)
if(r.includeParent){const e=Math.ceil(2/r.resolution)
Pp.e.smoothEdges(p,{iterations:e,maxNewEdgeLength:Math.sqrt(2)})}Pp.e.transform(p,o),e.webgl&&!e.webgl.isWebGL2?(Pp.e.uniformTriangleGroup(p),s.IQ.updateIfChanged(p.varyingGroup,!1)):s.IQ.updateIfChanged(p.varyingGroup,!0)
const h=hd.f8.expand((0,hd.f8)(),t.boundary.sphere,u)
return p.setBoundingSphere(h),p.meta.resolution=c,p}function e_(e){return(0,th.wA)({defaultProps:Vr.t.getDefaultValues(YS),createGeometry:JS,createLocationIterator:Nh.fromStructure,getLoci:Lh,eachLocation:Oh,setUpdateState:(e,t,n)=>{t.resolution!==n.resolution&&(e.createGeometry=!0),t.probeRadius!==n.probeRadius&&(e.createGeometry=!0),t.probePositions!==n.probePositions&&(e.createGeometry=!0),t.ignoreHydrogens!==n.ignoreHydrogens&&(e.createGeometry=!0),t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(e.createGeometry=!0),t.traceOnly!==n.traceOnly&&(e.createGeometry=!0),t.includeParent!==n.includeParent&&(e.createGeometry=!0),t.smoothColors.name!==n.smoothColors.name?e.updateColor=!0:"on"===t.smoothColors.name&&"on"===n.smoothColors.name&&(t.smoothColors.params.resolutionFactor!==n.smoothColors.params.resolutionFactor&&(e.updateColor=!0),t.smoothColors.params.sampleStride!==n.smoothColors.params.sampleStride&&(e.updateColor=!0))},processValues:(e,t,n,r,i)=>{const{resolution:o,colorTexture:a}=t.meta,s=(0,Mr.Y0)(n.smoothColors,r.color.preferSmoothing,o)
s&&((0,fS.XP)(e,s.resolution,s.stride,i,a),t.meta.colorTexture=e.tColorGrid.ref.value)},dispose:e=>{var t
null===(t=e.meta.colorTexture)||void 0===t||t.destroy()}},e)}const t_={...Ep.zj,...$S,...Op.$J,sizeFactor:Vr.t.Numeric(1.5,{min:0,max:10,step:.1})}
async function n_(e,t,n,r,i,o){const{transform:a,field:s,idField:l,maxRadius:c}=await XS(n,t,r.size,i).runInContext(e.runtime),u={isoLevel:i.probeRadius,scalarField:s,idField:l},d=await(0,dS.e)(u,o).runAsChild(e.runtime)
BS.q.transform(d,a)
const p=hd.f8.expand((0,hd.f8)(),t.boundary.sphere,c)
return d.setBoundingSphere(p),d}function r_(e){return(0,Ep.zK)({defaultProps:Vr.t.getDefaultValues(t_),createGeometry:n_,createLocationIterator:Nh.fromGroup,getLoci:Dh,eachLocation:kh,setUpdateState:(e,t,n)=>{t.resolution!==n.resolution&&(e.createGeometry=!0),t.probeRadius!==n.probeRadius&&(e.createGeometry=!0),t.probePositions!==n.probePositions&&(e.createGeometry=!0),t.ignoreHydrogens!==n.ignoreHydrogens&&(e.createGeometry=!0),t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(e.createGeometry=!0),t.includeParent!==n.includeParent&&(e.createGeometry=!0)}},e)}const i_={"molecular-surface-mesh":(e,t)=>(0,Gh.T)("Molecular surface mesh",e,t,KS),"structure-molecular-surface-mesh":(e,t)=>(0,qh.Kp)("Structure Molecular surface mesh",e,t,e_),"molecular-surface-wireframe":(e,t)=>(0,Gh.T)("Molecular surface wireframe",e,t,r_)},o_={...YS,...t_,visuals:Vr.t.MultiSelect(["molecular-surface-mesh"],Vr.t.objectToOptions(i_)),bumpFrequency:Vr.t.Numeric(1,{min:0,max:10,step:.1},Mr.iy.ShadingCategory),density:Vr.t.Numeric(.5,{min:0,max:1,step:.01},Mr.iy.ShadingCategory)},a_=(0,qh.GT)({name:"molecular-surface",label:"Molecular Surface",description:"Displays a molecular surface.",factory:function(e,t){return vo.YL.createMulti("Molecular Surface",e,t,qh.J1,i_)},getParams:function(e,t){return o_},defaultValues:Vr.t.getDefaultValues(o_),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"physical"},isApplicable:e=>e.elementCount>0}),s_={...Ep.Te,sizeFactor:Vr.t.Numeric(1,{min:0,max:2,step:.1}),detail:Vr.t.Numeric(0,{min:0,max:3,step:1},Mr.iy.CustomQualityParamInfo)}
function l_(e){return(0,Ep.Pv)({defaultProps:Vr.t.getDefaultValues(s_),createGeometry:c_,createLocationIterator:u_,getLoci:d_,eachLocation:p_,setUpdateState:(e,t,n)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.detail!==n.detail}},e)}function c_(e,t,n,r,i,o){if(!function(e){if(Or.Unit.Traits.is(e.traits,Or.Unit.Trait.MultiChain))return!1
if(Or.Unit.Traits.is(e.traits,Or.Unit.Trait.Partitioned))return!1
if(Or.Unit.isCoarse(e))return!0
if(0===e.elements.length)return!1
e.model.atomicHierarchy.derived.residue.moleculeType
const t=e.residueIndex[e.elements[0]],n=e.model.atomicHierarchy.derived.residue.moleculeType[t]
return n!==kp.MoleculeType.Ion&&n!==kp.MoleculeType.Water}(t))return Pp.e.createEmpty(o)
const{detail:a,sizeFactor:s}=i,l=Ch.P.createState(256,128,o),c=t.principalAxes.boxAxes,{origin:u,dirA:d,dirB:p}=c,h=hd.n.size((0,Ta.eB)(),c)
Ta.eB.scale(h,h,s/2)
const f=Ta.eB.create(h[2],h[1],h[0])
l.currentGroup=0,(0,wx.P)(l,u,d,p,f,a+1)
const m=Ch.P.getMesh(l),g=hd.f8.expand((0,hd.f8)(),t.boundary.sphere,1*i.sizeFactor)
return m.setBoundingSphere(g),m}function u_(e){const{group:t,structure:n}=e,r=t.units.length,i=Or.StructureElement.Location.create(n)
return(0,Dp.iQ)(1,r,1,(e,n)=>{const r=t.units[n]
return i.unit=r,i.element=r.elements[e],i})}function d_(e,t,n){const{objectId:r,instanceId:i}=e
if(n===r){const{structure:e,group:n}=t,r=n.units[i],o=Xo.CD.ofBounds(0,r.elements.length)
return Or.StructureElement.Loci(e,[{unit:r,indices:o}])}return Xr.EmptyLoci}function p_(e,t,n){let r=!1
if(!Or.StructureElement.Loci.is(e))return!1
const{structure:i,group:o}=t
if(!Or.Structure.areEquivalent(e.structure,i))return!1
const a=o.elements.length
for(const s of e.elements){const e=o.unitIndexMap.get(s.unit.id)
void 0!==e&&Xo.CD.size(s.indices)===a&&n(Xo.IX.ofSingleton(e))&&(r=!0)}return r}const h_={"orientation-ellipsoid-mesh":(e,t)=>(0,Gh.T)("Orientation ellipsoid mesh",e,t,l_)},f_={...s_,visuals:Vr.t.MultiSelect(["orientation-ellipsoid-mesh"],Vr.t.objectToOptions(h_)),bumpFrequency:Vr.t.Numeric(1,{min:0,max:10,step:.1},Mr.iy.ShadingCategory)},m_=(0,qh.GT)({name:"orientation",label:"Orientation",description:"Displays orientation ellipsoids for polymer chains.",factory:function(e,t){return vo.YL.createMulti("Orientation",e,t,qh.J1,h_)},getParams:function(e,t){return f_},defaultValues:Vr.t.getDefaultValues(f_),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.elementCount>0})
var g_=n(65580),y_=n(38442)
const v_=Ta.eB.add,b_={...Ep.PJ,pointSizeAttenuation:Vr.t.Boolean(!1),ignoreHydrogens:Vr.t.Boolean(!1),ignoreHydrogensVariant:Vr.t.Select("all",Vr.t.arrayToOptions(["all","non-polar"])),traceOnly:Vr.t.Boolean(!1),stride:Vr.t.Numeric(1,{min:1,max:100,step:1})}
function x_(e,t,n,r,i,o){const{child:a}=n,s=null==a?void 0:a.unitMap.get(t.id)
if(a&&!s)return g_.O.createEmpty(o)
const{stride:l}=i,c=t.elements,u=c.length,d=y_.N.create(u,u/10,o),p=(0,Ta.eB)(),h=t.conformation,f=Ph(n,t,i),m=(0,Ta.eB)()
let g=0
if(l&&l>1||f)for(let x=0;x<u;++x)l&&x%l!==0||f&&f(c[x])||(h.invariantPosition(c[x],p),v_(m,m,p),g+=1,d.add(p[0],p[1],p[2],x))
else for(let x=0;x<u;++x)h.invariantPosition(c[x],p),v_(m,m,p),g+=1,d.add(p[0],p[1],p[2],x)
const y=d.getPoints()
if(0===g)return y
let v
Ta.eB.scale(m,m,1/g)
const b=o?hd.f8.clone(o.boundingSphere):void 0
return v=b&&Ta.eB.distance(m,b.center)/b.radius<.1?b:hd.f8.expand((0,hd.f8)(),(null!=s?s:t).boundary.sphere,1*i.sizeFactor),y.setBoundingSphere(v),y}function S_(e){return(0,Ep.fm)({defaultProps:Vr.t.getDefaultValues(b_),createGeometry:x_,createLocationIterator:Nh.fromGroup,getLoci:Dh,eachLocation:kh,setUpdateState:(e,t,n)=>{e.createGeometry=t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||t.traceOnly!==n.traceOnly||t.stride!==n.stride}},e)}function __(e,t,n,r,i){const{child:o}=t,{stride:a}=r,{getSerialIndex:s}=t.serialMapping,l=t.elementCount,c=y_.N.create(l,l/2,i),u=(0,Ta.eB)()
let d=0
for(const m of t.units){const e=null==o?void 0:o.unitMap.get(m.id)
if(o&&!e)return g_.O.createEmpty(i)
const{elements:n,conformation:l}=m,p=n.length,h=(0,Ta.eB)(),f=Ph(t,m,r)
if(a&&a>1||f)for(let t=0;t<p;t++){const e=n[t]
a&&t%a!==0||f&&f(e)||(l.position(e,h),c.add(h[0],h[1],h[2],s(m,e)),v_(u,u,h),d+=1)}else{for(let e=0;e<p;e++){const t=n[e]
l.position(t,h),c.add(h[0],h[1],h[2],s(m,t)),v_(u,u,h)}d+=p}}const p=c.getPoints()
if(0===d)return p
let h
Ta.eB.scale(u,u,1/d)
const f=i?hd.f8.clone(i.boundingSphere):void 0
return h=f&&Ta.eB.distance(u,f.center)/f.radius<1?f:hd.f8.expand((0,hd.f8)(),(null!=o?o:t).boundary.sphere,1*r.sizeFactor),p.setBoundingSphere(h),p}const C_={...th.yv,pointSizeAttenuation:Vr.t.Boolean(!1),ignoreHydrogens:Vr.t.Boolean(!1),ignoreHydrogensVariant:Vr.t.Select("all",Vr.t.arrayToOptions(["all","non-polar"])),traceOnly:Vr.t.Boolean(!1),stride:Vr.t.Numeric(1,{min:1,max:100,step:1})}
function w_(e){return(0,th.yW)({defaultProps:Vr.t.getDefaultValues(C_),createGeometry:__,createLocationIterator:Nh.fromStructure,getLoci:Lh,eachLocation:Oh,setUpdateState:(e,t,n)=>{e.createGeometry=t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||t.traceOnly!==n.traceOnly||t.stride!==n.stride}},e)}const T_={"element-point":(e,t)=>(0,Gh.T)("Element points",e,t,S_),"structure-element-point":(e,t)=>(0,qh.Kp)("Structure element points",e,t,w_)},A_={...b_,density:Vr.t.Numeric(.1,{min:0,max:1,step:.01},Mr.iy.ShadingCategory),visuals:Vr.t.MultiSelect(["element-point"],Vr.t.objectToOptions(T_))},I_=(0,qh.GT)({name:"point",label:"Point",description:"Displays elements (atoms, coarse spheres) as points.",factory:function(e,t){return vo.YL.createMulti("Point",e,t,qh.J1,T_)},getParams:function(e,t){let n=A_
return t.unitSymmetryGroups.length>5e3&&(n=Vr.t.clone(n),n.visuals.defaultValue=["structure-element-point"]),n},defaultValues:Vr.t.getDefaultValues(A_),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.elementCount>0}),P_={sizeFactor:Vr.t.Numeric(.2,{min:0,max:10,step:.01}),detail:Vr.t.Numeric(0,{min:0,max:3,step:1},Mr.iy.CustomQualityParamInfo),linearSegments:Vr.t.Numeric(8,{min:1,max:48,step:1},Mr.iy.CustomQualityParamInfo),radialSegments:Vr.t.Numeric(16,{min:2,max:56,step:2},Mr.iy.CustomQualityParamInfo)},B_=(Vr.t.getDefaultValues(P_),(0,Ta.eB)())
function E_(e,t,n,r,i,o){const a=t.polymerElements.length
if(!a)return Pp.e.createEmpty(o)
const{sizeFactor:s,detail:l,linearSegments:c,radialSegments:u}=i,d=c*u*a+(u+1)*a*2,p=Ch.P.createState(d,d/10,o),h=Vm(c),{curvePoints:f,normalVectors:m,binormalVectors:g,widthValues:y,heightValues:v}=h
let b=0
const x=vm(t,n,{ignoreSecondaryStructure:!0})
for(;x.hasNext;){const e=x.move()
p.currentGroup=b
const t=(0,kp.isNucleic)(e.moleculeType)?ig:rg
Um(h,e,.5,t)
const n=e.coarseBackboneFirst||e.first,i=e.coarseBackboneLast||e.last,o=r.size.size(e.centerPrev)*s,a=r.size.size(e.center)*s,d=r.size.size(e.centerNext)*s
ng(h,o,a,d,o,a,d,t)
let S=c
if(e.initial){S=Math.max(Math.round(c*t),1)
const n=c-S
f.copyWithin(0,3*n),g.copyWithin(0,3*n),m.copyWithin(0,3*n),y.copyWithin(0,3*n),v.copyWithin(0,3*n),Ta.eB.fromArray(B_,f,3),Ta.eB.normalize(B_,Ta.eB.sub(B_,e.p2,B_)),Ta.eB.scaleAndAdd(B_,e.p2,B_,2*a),Ta.eB.toArray(B_,f,0)}else e.final&&(S=Math.max(Math.round(c*(1-t)),1),Ta.eB.fromArray(B_,f,3*S-3),Ta.eB.normalize(B_,Ta.eB.sub(B_,e.p2,B_)),Ta.eB.scaleAndAdd(B_,e.p2,B_,2*a),Ta.eB.toArray(B_,f,3*S))
!0===e.initial&&!0===e.final?(0,wh.X)(p,e.p2,2*a,l):2===u?mx(p,f,m,g,S,y,v,0):4===u?kb(p,f,m,g,S,y,v,0,n,i):Wb(p,f,m,g,S,u,y,v,n,i,"elliptical"),++b}const S=Ch.P.getMesh(p),_=hd.f8.expand((0,hd.f8)(),t.boundary.sphere,1*i.sizeFactor)
return S.setBoundingSphere(_),S}const k_={...Ep.Te,...P_}
function D_(e){return(0,Ep.Pv)({defaultProps:Vr.t.getDefaultValues(k_),createGeometry:E_,createLocationIterator:e=>sg.fromGroup(e,{asSecondary:!0}),getLoci:ug,eachLocation:fg,setUpdateState:(e,t,n)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.detail!==n.detail||t.linearSegments!==n.linearSegments||t.radialSegments!==n.radialSegments}},e)}const M_={"polymer-tube":(e,t)=>(0,Gh.T)("Polymer tube mesh",e,t,D_),"polymer-gap":(e,t)=>(0,Gh.T)("Polymer gap cylinder",e,t,rb)},R_={...k_,...nb,sizeFactor:Vr.t.Numeric(.2,{min:0,max:10,step:.01}),visuals:Vr.t.MultiSelect(["polymer-tube","polymer-gap"],Vr.t.objectToOptions(M_)),bumpFrequency:Vr.t.Numeric(2,{min:0,max:10,step:.1},Mr.iy.ShadingCategory),density:Vr.t.Numeric(.1,{min:0,max:1,step:.01},Mr.iy.ShadingCategory)},O_=(0,qh.GT)({name:"putty",label:"Putty",description:"Displays a tube smoothly following the trace atoms of polymers.",factory:function(e,t){return vo.YL.createMulti("Putty",e,t,qh.J1,M_)},getParams:function(e,t){const n=Vr.t.clone(R_)
let r=!1,i=!1
return t.units.forEach(e=>{!r&&Or.Unit.isAtomic(e)&&e.nucleotideElements.length&&(r=!0),!i&&e.gapElements.length&&(i=!0)}),n.visuals.defaultValue=["polymer-tube"],i&&n.visuals.defaultValue.push("polymer-gap"),n},defaultValues:Vr.t.getDefaultValues(R_),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uncertainty"},isApplicable:e=>e.polymerResidueCount>0}),L_={"element-sphere":(e,t)=>(0,Gh.T)("Sphere mesh/impostor",e,t,jh),"structure-element-sphere":(e,t)=>(0,qh.Kp)("Structure sphere mesh/impostor",e,t,Uh)},N_={...zh,bumpFrequency:Vr.t.Numeric(1,{min:0,max:10,step:.1},Mr.iy.ShadingCategory),density:Vr.t.Numeric(.5,{min:0,max:1,step:.01},Mr.iy.ShadingCategory),visuals:Vr.t.MultiSelect(["element-sphere"],Vr.t.objectToOptions(L_))}
let F_
const z_=(0,qh.GT)({name:"spacefill",label:"Spacefill",description:"Displays atomic/coarse elements as spheres.",factory:function(e,t){return vo.YL.createMulti("Spacefill",e,t,qh.J1,L_)},getParams:function(e,t){let n=N_
return t.isCoarseGrained&&(F_||(F_=Vr.t.clone(N_),F_.sizeFactor.defaultValue=2),n=F_),t.unitSymmetryGroups.length>5e3&&(n=Vr.t.clone(n),n.visuals.defaultValue=["structure-element-sphere"]),n},defaultValues:Vr.t.getDefaultValues(N_),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:e=>e.elementCount>0}),j_=kp.BondType.is
function V_(e,t,n,r){const i=Or.StructureElement.Location.create(t,e),o=e.elements,a=e.bonds,{edgeCount:s,a:l,b:c,edgeProps:u,offset:d}=a,{order:p,flags:h}=u,{sizeFactor:f,aromaticBonds:m,includeTypes:g,excludeTypes:y,multipleBonds:v}=r,b="off"===v,x="symmetric"===v,S=zp(kp.BondType.fromNames(g),kp.BondType.fromNames(y),kp.BondType.Flag.Computed),_=(0,Ta.eB)(),C=e.conformation,{elementRingIndices:w,elementAromaticRingIndices:T}=e.rings,A=m?e.resonance.delocalizedTriplets:void 0
return{linkCount:2*s,referencePosition:e=>{let t=l[e],n=c[e]
const r=null==A?void 0:A.getThirdElement(t,n)
if(void 0!==r)return C.invariantPosition(o[r],_)
t>n&&([t,n]=[n,t]),d[t+1]-d[t]===1&&([t,n]=[n,t])
const i=T.get(t)||w.get(t)
let a=0
for(let s=d[t],l=d[t+1];s<l;++s){const e=c[s]
if(e!==n&&e!==t){if(!i)return C.invariantPosition(o[e],_)
{const t=T.get(e)||w.get(e)
if(!t)continue
const n=(0,ao.u$)(i,t)
n>a&&(a=n,C.invariantPosition(o[e],_))}}}return a>0?_:null},position:(e,t,n,r)=>{C.invariantPosition(o[l[n]],e),C.invariantPosition(o[c[n]],t)},style:e=>{const t=p[e],n=h[e]
if(j_(n,kp.BondType.Flag.MetallicCoordination)||j_(n,kp.BondType.Flag.HydrogenBond))return Bp.gK.Dashed
if(3===t)return b?Bp.gK.Solid:x?Bp.gK.Triple:Bp.gK.OffsetTriple
if(m){const t=l[e],r=c[e],i=T.get(t),o=T.get(r),a=i&&o?(0,ao.u$)(i,o):0
if(j_(n,kp.BondType.Flag.Aromatic)||a&&!S)return 2===a?Bp.gK.MirroredAromatic:Bp.gK.Aromatic}return 2!==t||b?Bp.gK.Solid:x?Bp.gK.Double:Bp.gK.OffsetDouble},radius:e=>{i.element=o[l[e]]
const t=n.size.size(i)
i.element=o[c[e]]
const r=n.size.size(i)
return Math.min(t,r)*f},ignore:jp(t,e,r)}}function U_(e,t,n,r,i,o){if(!Or.Unit.isAtomic(t))return BS.q.createEmpty(o)
if(!Up(t,i))return BS.q.createEmpty(o)
if(!t.bonds.edgeCount)return BS.q.createEmpty(o)
const{child:a}=n,s=null==a?void 0:a.unitMap.get(t.id)
if(a&&!s)return BS.q.createEmpty(o)
const l=V_(t,n,r,i),{lines:c,boundingSphere:u}=(0,Bp.Yz)(e,l,i,o)
if(u)c.setBoundingSphere(u)
else if(c.lineCount>0){const e=hd.f8.expand((0,hd.f8)(),(null!=s?s:t).boundary.sphere,1*i.sizeFactor)
c.setBoundingSphere(e)}return c}const G_={...Ep.zj,...Fp,includeParent:Vr.t.Boolean(!1)}
function H_(e){return(0,Ep.zK)({defaultProps:Vr.t.getDefaultValues(G_),createGeometry:U_,createLocationIterator:e=>Hp.fromGroup(e),getLoci:qp,eachLocation:Qp,setUpdateState:(e,t,n,r,i,o,a)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.linkScale!==n.linkScale||t.linkSpacing!==n.linkSpacing||t.aromaticDashCount!==n.aromaticDashCount||t.dashCount!==n.dashCount||t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||!(0,s.af)(t.includeTypes,n.includeTypes)||!(0,s.af)(t.excludeTypes,n.excludeTypes)||t.aromaticBonds!==n.aromaticBonds||t.multipleBonds!==n.multipleBonds
const l=o.group.units[0],c=a.group.units[0]
Or.Unit.isAtomic(l)&&Or.Unit.isAtomic(c)&&(Kp.O.areEqual(l.bonds,c.bonds)||(e.createGeometry=!0,e.updateTransform=!0,e.updateColor=!0,e.updateSize=!0))}},e)}function q_(e,t,n,r,i){if(!Gp(t,r))return BS.q.createEmpty(i)
if(!t.intraUnitBondMapping.bondCount)return BS.q.createEmpty(i)
const o=function(e,t,n){const r=[],{bondCount:i,unitIndex:o,unitEdgeIndex:a,unitGroupIndex:s}=e.intraUnitBondMapping,{child:l}=e
for(const c of e.unitSymmetryGroups){const i=c.units[0],o=null==l?void 0:l.unitMap.get(i.id),a=!Or.Unit.isAtomic(i)||l&&!o?Bp.Js:V_(i,e,t,n)
r.push({group:c,props:a})}return{linkCount:i,referencePosition:e=>{const{group:t,props:n}=r[o[e]]
if(!n.referencePosition)return null
const i=n.referencePosition(a[e])
if(!i)return null
const l=t.units[s[e]]
return Ta.eB.transformMat4(i,i,l.conformation.operator.matrix),i},position:(e,t,n,i)=>{const{group:l,props:c}=r[o[n]]
c.position(e,t,a[n],i)
const u=l.units[s[n]]
Ta.eB.transformMat4(e,e,u.conformation.operator.matrix),Ta.eB.transformMat4(t,t,u.conformation.operator.matrix)},style:e=>{const{props:t}=r[o[e]]
return t.style?t.style(a[e]):Bp.gK.Solid},radius:e=>{const{props:t}=r[o[e]]
return t.radius(a[e])},ignore:e=>{const{props:t}=r[o[e]]
return!!t.ignore&&t.ignore(a[e])},stub:e=>{const{props:t}=r[o[e]]
return!!t.stub&&t.stub(a[e])}}}(t,n,r),{lines:a,boundingSphere:s}=(0,Bp.Yz)(e,o,r,i)
if(s)a.setBoundingSphere(s)
else if(a.lineCount>0){const{child:e}=t,n=hd.f8.expand((0,hd.f8)(),(null!=e?e:t).boundary.sphere,1*r.sizeFactor)
a.setBoundingSphere(n)}return a}const Q_={...th.YD,...Fp,includeParent:Vr.t.Boolean(!1)}
function $_(e){return(0,th.yd)({defaultProps:Vr.t.getDefaultValues(Q_),createGeometry:q_,createLocationIterator:(e,t)=>Gp(e,t)?Hp.fromStructureGroups(e):Dp.FL,getLoci:Yp,eachLocation:Zp,setUpdateState:(e,t,n,r,i,o,a)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.linkScale!==n.linkScale||t.linkSpacing!==n.linkSpacing||t.aromaticDashCount!==n.aromaticDashCount||t.dashCount!==n.dashCount||t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||!(0,s.af)(t.includeTypes,n.includeTypes)||!(0,s.af)(t.excludeTypes,n.excludeTypes)||t.multipleBonds!==n.multipleBonds,Gp(o,t)&&o.interUnitBonds!==a.interUnitBonds&&(e.createGeometry=!0,e.updateTransform=!0,e.updateColor=!0,e.updateSize=!0)}},e)}const X_=new Or.Bond.ElementBondIterator
function W_(e,t,n,r){for(X_.setElement(t,n,r);X_.hasNext;){const t=X_.move()
return t.otherUnit.conformation.position(t.otherUnit.elements[t.otherIndex],e),e}return null}function Y_(e,t,n,r,i){if(!Gp(t,r))return BS.q.createEmpty(i)
if(!t.interUnitBonds.edgeCount)return BS.q.createEmpty(i)
const o=function(e,t,n){const r=e.interUnitBonds,{edgeCount:i,edges:o}=r,{sizeFactor:a,aromaticBonds:l,multipleBonds:c}=n,u="off"===c,d="symmetric"===c,p=(0,Ta.eB)(),h=Or.StructureElement.Location.create()
return{linkCount:i,referencePosition:t=>{const n=o[t]
let r,i,a,s
if(n.unitA<n.unitB)r=e.unitMap.get(n.unitA),i=e.unitMap.get(n.unitB),a=n.indexA,s=n.indexB
else{if(!(n.unitA>n.unitB))throw new Error("same units in createInterUnitBondLines")
r=e.unitMap.get(n.unitB),i=e.unitMap.get(n.unitA),a=n.indexB,s=n.indexA}return W_(p,e,r,a)||W_(p,e,i,s)},position:(t,n,r,i)=>{const a=o[r],s=e.unitMap.get(a.unitA),l=e.unitMap.get(a.unitB)
s.conformation.position(s.elements[a.indexA],t),l.conformation.position(l.elements[a.indexB],n)},style:e=>{const t=o[e].props.order,n=s.NJ.create(o[e].props.flag)
return kp.BondType.is(n,kp.BondType.Flag.MetallicCoordination)||kp.BondType.is(n,kp.BondType.Flag.HydrogenBond)?Bp.gK.Dashed:3===t?u?Bp.gK.Solid:d?Bp.gK.Triple:Bp.gK.OffsetTriple:l&&kp.BondType.is(n,kp.BondType.Flag.Aromatic)?Bp.gK.Aromatic:2!==t||u?Bp.gK.Solid:d?Bp.gK.Double:Bp.gK.OffsetDouble},radius:n=>{const r=o[n]
h.structure=e,h.unit=e.unitMap.get(r.unitA),h.element=h.unit.elements[r.indexA]
const i=t.size.size(h)
h.unit=e.unitMap.get(r.unitB),h.element=h.unit.elements[r.indexB]
const s=t.size.size(h)
return Math.min(i,s)*a},ignore:Vp(e,n)}}(t,n,r),{lines:a,boundingSphere:l}=(0,Bp.Yz)(e,o,r,i)
if(l)a.setBoundingSphere(l)
else if(a.lineCount>0){const{child:e}=t,n=hd.f8.expand((0,hd.f8)(),(null!=e?e:t).boundary.sphere,1*r.sizeFactor)
a.setBoundingSphere(n)}return a}const Z_={...th.YD,...Fp,includeParent:Vr.t.Boolean(!1)}
function K_(e){return(0,th.yd)({defaultProps:Vr.t.getDefaultValues(Z_),createGeometry:Y_,createLocationIterator:(e,t)=>Gp(e,t)?Hp.fromStructure(e):Dp.FL,getLoci:$p,eachLocation:Wp,setUpdateState:(e,t,n,r,i,o,a)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.linkScale!==n.linkScale||t.linkSpacing!==n.linkSpacing||t.aromaticDashCount!==n.aromaticDashCount||t.dashCount!==n.dashCount||t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||!(0,s.af)(t.includeTypes,n.includeTypes)||!(0,s.af)(t.excludeTypes,n.excludeTypes)||t.multipleBonds!==n.multipleBonds,Gp(o,t)&&o.interUnitBonds!==a.interUnitBonds&&(e.createGeometry=!0,e.updateTransform=!0,e.updateColor=!0,e.updateSize=!0)}},e)}var J_=n(17810),eC=n(50690)
const tC=Ta.eB.add,nC=Ta.eB.scaleAndAdd,rC=Ta.eB.unitX,iC=Ta.eB.unitY,oC=Ta.eB.unitZ,aC={...Ep.zj,lineSizeAttenuation:Vr.t.Boolean(!1),ignoreHydrogens:Vr.t.Boolean(!1),ignoreHydrogensVariant:Vr.t.Select("all",Vr.t.arrayToOptions(["all","non-polar"])),traceOnly:Vr.t.Boolean(!1),crosses:Vr.t.Select("lone",Vr.t.arrayToOptions(["lone","all"])),crossSize:Vr.t.Numeric(.35,{min:0,max:2,step:.01})}
function sC(e,t,n,r,i,o){const{child:a}=n
if(a&&!a.unitMap.get(t.id))return BS.q.createEmpty(o)
const s=t.elements,l=s.length,c=J_.d.create(l,l/10,o),u=(0,Ta.eB)(),d=(0,Ta.eB)(),p=(0,Ta.eB)(),h=t.conformation,f=Ph(n,t,i),m=i.crossSize/2,g="lone"===i.crosses,y=(0,Ta.eB)()
let v=0
for(let _=0;_<l;++_)f&&f(s[_])||g&&Or.Unit.isAtomic(t)&&Up(t,i)&&0!==(0,eC.Hm)(n,t,_)||(h.invariantPosition(s[_],u),tC(y,y,u),v+=1,nC(d,u,rC,m),nC(p,u,rC,-m),c.add(d[0],d[1],d[2],p[0],p[1],p[2],_),nC(d,u,iC,m),nC(p,u,iC,-m),c.add(d[0],d[1],d[2],p[0],p[1],p[2],_),nC(d,u,oC,m),nC(p,u,oC,-m),c.add(d[0],d[1],d[2],p[0],p[1],p[2],_))
const b=c.getLines()
if(0===v)return b
let x
Ta.eB.scale(y,y,1/v)
const S=o?hd.f8.clone(o.boundingSphere):void 0
return x=S&&Ta.eB.distance(y,S.center)/S.radius<.1?S:hd.f8.expand((0,hd.f8)(),t.boundary.sphere,1*i.sizeFactor),b.setBoundingSphere(x),b}function lC(e){return(0,Ep.zK)({defaultProps:Vr.t.getDefaultValues(aC),createGeometry:sC,createLocationIterator:Nh.fromGroup,getLoci:Dh,eachLocation:kh,setUpdateState:(e,t,n)=>{e.createGeometry=t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||t.traceOnly!==n.traceOnly||t.crosses!==n.crosses||t.crossSize!==n.crossSize}},e)}function cC(e,t,n,r,i){const{child:o}=t,{getSerialIndex:a}=t.serialMapping,s=t.elementCount,l=J_.d.create(s,s/2,i),c=(0,Ta.eB)(),u=(0,Ta.eB)(),d=(0,Ta.eB)(),p=r.crossSize/2,h="lone"===r.crosses,f=(0,Ta.eB)()
let m=0
for(const b of t.units){const e=null==o?void 0:o.unitMap.get(b.id)
if(o&&!e)return BS.q.createEmpty(i)
const{elements:n,conformation:s}=b,g=n.length,y=Ph(t,b,r)
for(let i=0;i<g;i++){if(y&&y(n[i]))continue
if(h&&Or.Unit.isAtomic(b)&&Up(b,r)&&0!==(0,eC.Hm)(t,b,i))continue
s.position(n[i],c),tC(f,f,c),m+=1
const e=a(b,n[i])
nC(u,c,rC,p),nC(d,c,rC,-p),l.add(u[0],u[1],u[2],d[0],d[1],d[2],e),nC(u,c,iC,p),nC(d,c,iC,-p),l.add(u[0],u[1],u[2],d[0],d[1],d[2],e),nC(u,c,oC,p),nC(d,c,oC,-p),l.add(u[0],u[1],u[2],d[0],d[1],d[2],e)}}const g=l.getLines()
if(0===m)return g
let y
Ta.eB.scale(f,f,1/m)
const v=i?hd.f8.clone(i.boundingSphere):void 0
return y=v&&Ta.eB.distance(f,v.center)/v.radius<1?v:hd.f8.expand((0,hd.f8)(),(null!=o?o:t).boundary.sphere,1*r.sizeFactor),g.setBoundingSphere(y),g}const uC={...th.YD,lineSizeAttenuation:Vr.t.Boolean(!1),ignoreHydrogens:Vr.t.Boolean(!1),ignoreHydrogensVariant:Vr.t.Select("all",Vr.t.arrayToOptions(["all","non-polar"])),traceOnly:Vr.t.Boolean(!1),crosses:Vr.t.Select("lone",Vr.t.arrayToOptions(["lone","all"])),crossSize:Vr.t.Numeric(.35,{min:0,max:2,step:.01})}
function dC(e){return(0,th.yd)({defaultProps:Vr.t.getDefaultValues(uC),createGeometry:cC,createLocationIterator:Nh.fromStructure,getLoci:Lh,eachLocation:Oh,setUpdateState:(e,t,n)=>{e.createGeometry=t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||t.traceOnly!==n.traceOnly||t.crosses!==n.crosses||t.crossSize!==n.crossSize}},e)}const pC={"intra-bond":(e,t)=>(0,Gh.T)("Intra-unit bond line",e,t,H_),"inter-bond":(e,t)=>(0,Hh.K)("Inter-unit bond line",e,t,K_),"element-point":(e,t)=>(0,Gh.T)("Points",e,t,S_),"element-cross":(e,t)=>(0,Gh.T)("Crosses",e,t,lC),"structure-intra-bond":(e,t)=>(0,Hh.K)("Structure intra-unit bond line",e,t,$_),"structure-element-point":(e,t)=>(0,Hh.K)("Structure element points",e,t,w_),"structure-element-cross":(e,t)=>(0,Hh.K)("Structure element crosses",e,t,dC)},hC={...G_,...Z_,...b_,...aC,pointStyle:Vr.t.Select("circle",Vr.t.objectToOptions(g_.O.StyleTypes)),multipleBonds:Vr.t.Select("offset",Vr.t.arrayToOptions(["off","symmetric","offset"])),includeParent:Vr.t.Boolean(!1),sizeFactor:Vr.t.Numeric(2,{min:.01,max:10,step:.01}),unitKinds:(0,Qh.R8)(["atomic"]),visuals:Vr.t.MultiSelect(["intra-bond","inter-bond","element-point","element-cross"],Vr.t.objectToOptions(pC)),density:Vr.t.Numeric(.1,{min:0,max:1,step:.01},Mr.iy.ShadingCategory)},fC=(0,qh.GT)({name:"line",label:"Line",description:"Displays bonds as lines and atoms as points or croses.",factory:function(e,t){return vo.YL.createMulti("Line",e,t,qh.J1,pC)},getParams:function(e,t){let n=hC
return Or.Structure.getSize(t)>=Or.Structure.Size.Huge?(n=Vr.t.clone(n),n.visuals.defaultValue=["intra-bond","element-point","element-cross"]):t.unitSymmetryGroups.length>5e3&&(n=Vr.t.clone(n),n.visuals.defaultValue=["structure-intra-bond","structure-element-point","structure-element-cross"]),n},defaultValues:Vr.t.getDefaultValues(hC),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.elementCount>0,getData:(e,t)=>t.includeParent?e.asParent():e,mustRecreate:(e,t)=>e.includeParent!==t.includeParent})
var mC=n(40362)
function gC(e,t,n,r,i){const{webgl:o}=e
if(!o)throw new Error("GaussianDensityVolume requires `webgl`")
const a=Ta.eB.create(0,1,2),s={min:0,max:1,mean:.04,sigma:.01},l=e=>{const i=e?e.gridTexture.ref.value:void 0,l=function(e,t,n,r,i){const{position:o,boundary:a,radius:s}=(0,Op.oc)(e,t,n),l=(0,Op.FC)(a.box,n)
return Qx(r,o,a.box,s,l,i)}(t,n.size,r,o,i),{transform:c,texture:u,bbox:d,gridDim:p}=l,h=Ta.$I.mul((0,Ta.$I)(),c,Ta.$I.fromScaling((0,Ta.$I)(),p)),f=Ta.$I.getScaling((0,Ta.eB)(),c),m=mC.E.create(d,p,c,h,f,u,s,!0,a,"byte",e),g=hd.f8.expand((0,hd.f8)(),t.boundary.sphere,l.maxRadius)
return m.setBoundingSphere(g),m},c=l(i)
return c.meta.reset=()=>{l(c)},c}const yC={...th.I,...lS,ignoreHydrogens:Vr.t.Boolean(!1),ignoreHydrogensVariant:Vr.t.Select("all",Vr.t.arrayToOptions(["all","non-polar"])),includeParent:Vr.t.Boolean(!1,{isHidden:!0})}
function vC(e){return(0,th.Yl)({defaultProps:Vr.t.getDefaultValues(yC),createGeometry:gC,createLocationIterator:Nh.fromStructure,getLoci:Lh,eachLocation:Oh,setUpdateState:(e,t,n)=>{t.resolution!==n.resolution&&(e.createGeometry=!0),t.radiusOffset!==n.radiusOffset&&(e.createGeometry=!0),t.smoothness!==n.smoothness&&(e.createGeometry=!0),t.ignoreHydrogens!==n.ignoreHydrogens&&(e.createGeometry=!0),t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(e.createGeometry=!0),t.traceOnly!==n.traceOnly&&(e.createGeometry=!0),t.includeParent!==n.includeParent&&(e.createGeometry=!0)},dispose:e=>{e.gridTexture.ref.value.destroy()}},e)}function bC(e,t,n,r,i,o){const{webgl:a}=e
if(!a)throw new Error("GaussianDensityVolume requires `webgl`")
const s=Ta.eB.create(0,1,2),l={min:0,max:1,mean:.04,sigma:.01},c=e=>{const o=e?e.gridTexture.ref.value:void 0,c=function(e,t,n,r,i,o){const{position:a,boundary:s,radius:l}=(0,Op.LT)(e,t,n,r),c=(0,Op.FC)(s.box,r,cS(i,e))
return Qx(i,a,s.box,l,c,o)}(n,t,r.size,i,a,o),{transform:u,texture:d,bbox:p,gridDim:h}=c,f=Ta.$I.mul((0,Ta.$I)(),u,Ta.$I.fromScaling((0,Ta.$I)(),h)),m=Ta.$I.getScaling((0,Ta.eB)(),u),g=mC.E.create(p,h,u,f,m,d,l,!0,s,"byte",e),y=hd.f8.expand((0,hd.f8)(),t.boundary.sphere,c.maxRadius)
return g.setBoundingSphere(y),g},u=c(o)
return u.meta.reset=()=>{c(u)},u}const xC={...Ep.Ny,...lS,ignoreHydrogens:Vr.t.Boolean(!1),ignoreHydrogensVariant:Vr.t.Select("all",Vr.t.arrayToOptions(["all","non-polar"])),includeParent:Vr.t.Boolean(!1,{isHidden:!0})}
function SC(e){return(0,Ep.Pi)({defaultProps:Vr.t.getDefaultValues(xC),createGeometry:bC,createLocationIterator:Nh.fromGroup,getLoci:Dh,eachLocation:kh,setUpdateState:(e,t,n)=>{t.resolution!==n.resolution&&(e.createGeometry=!0),t.radiusOffset!==n.radiusOffset&&(e.createGeometry=!0),t.smoothness!==n.smoothness&&(e.createGeometry=!0),t.ignoreHydrogens!==n.ignoreHydrogens&&(e.createGeometry=!0),t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant&&(e.createGeometry=!0),t.traceOnly!==n.traceOnly&&(e.createGeometry=!0),t.includeParent!==n.includeParent&&(e.createGeometry=!0)},dispose:e=>{e.gridTexture.ref.value.destroy()}},e)}const _C={"gaussian-volume":(e,t)=>(0,qh.Kp)("Gaussian volume",e,t,vC),"units-gaussian-volume":(e,t)=>(0,qh.TP)("Units-Gaussian volume",e,t,SC)},CC={...yC,jumpLength:Vr.t.Numeric(4,{min:0,max:20,step:.1}),visuals:Vr.t.MultiSelect(["gaussian-volume"],Vr.t.objectToOptions(_C))},wC=(0,qh.GT)({name:"gaussian-volume",label:"Gaussian Volume",description:"Displays a gaussian molecular density using direct volume rendering.",factory:function(e,t){return vo.YL.createMulti("Gaussian Volume",e,t,qh.J1,_C)},getParams:function(e,t){return CC},defaultValues:Vr.t.getDefaultValues(CC),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"physical"},isApplicable:e=>e.elementCount>0}),TC=Ta.eB.scale,AC=Ta.eB.add,IC=Ta.eB.sub,PC={...Ep.Te,...Ep.lm,sizeFactor:Vr.t.Numeric(.3,{min:0,max:10,step:.01}),radialSegments:Vr.t.Numeric(16,{min:2,max:56,step:2},Mr.iy.CustomQualityParamInfo),tryUseImpostor:Vr.t.Boolean(!0)}
function BC(e,t,n,r){return n.tryUseImpostor&&(0,Op.VZ)(r)?function(e){return(0,Ep.Vb)({defaultProps:Vr.t.getDefaultValues(PC),createGeometry:EC,createLocationIterator:e=>sg.fromGroup(e),getLoci:ug,eachLocation:fg,setUpdateState:(e,t,n)=>{},mustRecreate:(e,t,n)=>!t.tryUseImpostor||!n},e)}(e):function(e){return(0,Ep.Pv)({defaultProps:Vr.t.getDefaultValues(PC),createGeometry:kC,createLocationIterator:e=>sg.fromGroup(e),getLoci:ug,eachLocation:fg,setUpdateState:(e,t,n)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.radialSegments!==n.radialSegments},mustRecreate:(e,t,n)=>t.tryUseImpostor&&!!n},e)}(e)}function EC(e,t,n,r,i,o){const a=t.polymerElements.length
if(!a)return Jp.S.createEmpty(o)
const s=2*a,l=Jy.h.create(s,s/4,o),c=t.conformation,u=(0,Ta.eB)(),d=(0,Ta.eB)(),p=(0,Ta.eB)()
lm(t,function(e,t,n,r,i){c.invariantPosition(e,u),c.invariantPosition(t,d)
const o=(0,kp.isNucleic)(i)?ig:rg
AC(p,u,TC(p,IC(p,d,u),o)),l.add(u[0],u[1],u[2],p[0],p[1],p[2],1,!1,!1,2,n),l.add(p[0],p[1],p[2],d[0],d[1],d[2],1,!1,!1,2,r)})
const h=l.getCylinders(),f=hd.f8.expand((0,hd.f8)(),t.boundary.sphere,1*i.sizeFactor)
return h.setBoundingSphere(f),h}function kC(e,t,n,r,i,o){const a=t.polymerElements.length
if(!a)return Pp.e.createEmpty(o)
const{radialSegments:s,sizeFactor:l}=i,c=2*s*a*2,u=Ch.P.createState(c,c/10,o),d=t.conformation,p=(0,Ta.eB)(),h=(0,Ta.eB)(),f={radiusTop:1,radiusBottom:1,radialSegments:s},m=Or.StructureElement.Location.create(n,t),g=Or.StructureElement.Location.create(n,t)
lm(t,function(e,t,n,i,o){m.element=e,g.element=t,d.invariantPosition(m.element,p),d.invariantPosition(g.element,h)
const a=(0,kp.isNucleic)(o)?ig:rg
f.radiusTop=f.radiusBottom=r.size.size(m)*l,u.currentGroup=n,(0,om.y9)(u,p,h,a,f),f.radiusTop=f.radiusBottom=r.size.size(g)*l,u.currentGroup=i,(0,om.y9)(u,h,p,1-a,f)})
const y=Ch.P.getMesh(u),v=hd.f8.expand((0,hd.f8)(),t.boundary.sphere,1*i.sizeFactor)
return y.setBoundingSphere(v),y}const DC={...Ep.Te,...Ep.qg,sizeFactor:Vr.t.Numeric(.3,{min:0,max:10,step:.01}),detail:Vr.t.Numeric(0,{min:0,max:3,step:1},Mr.iy.CustomQualityParamInfo),tryUseImpostor:Vr.t.Boolean(!0)}
function MC(e,t,n,r){return n.tryUseImpostor&&(0,Op.gU)(r)?function(e){return(0,Ep.uF)({defaultProps:Vr.t.getDefaultValues(DC),createGeometry:RC,createLocationIterator:e=>sg.fromGroup(e),getLoci:ug,eachLocation:fg,setUpdateState:(e,t,n)=>{},mustRecreate:(e,t,n)=>!t.tryUseImpostor||!n},e)}(e):function(e){return(0,Ep.Pv)({defaultProps:Vr.t.getDefaultValues(DC),createGeometry:OC,createLocationIterator:e=>sg.fromGroup(e),getLoci:ug,eachLocation:fg,setUpdateState:(e,t,n)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.detail!==n.detail},mustRecreate:(e,t,n)=>t.tryUseImpostor&&!!n},e)}(e)}function RC(e,t,n,r,i,o){const a=t.polymerElements.length
if(!a)return Th.v.createEmpty(o)
const s=Ah.Q.create(a,a/2,o),l=t.conformation,c=(0,Ta.eB)()
cm(t,(e,t)=>{l.invariantPosition(e,c),s.add(c[0],c[1],c[2],t)})
const u=s.getSpheres(),d=hd.f8.expand((0,hd.f8)(),t.boundary.sphere,1*i.sizeFactor)
return u.setBoundingSphere(d),u}function OC(e,t,n,r,i,o){const a=t.polymerElements.length
if(!a)return Pp.e.createEmpty(o)
const{detail:s,sizeFactor:l}=i,c=a*(0,_h.J)(s),u=Ch.P.createState(c,c/2,o),d=t.conformation,p=(0,Ta.eB)(),h=Or.StructureElement.Location.create(n,t)
cm(t,(e,t)=>{h.element=e,d.invariantPosition(h.element,p),u.currentGroup=t,(0,wh.X)(u,p,r.size.size(h)*l,s)})
const f=Ch.P.getMesh(u),m=hd.f8.expand((0,hd.f8)(),t.boundary.sphere,1*i.sizeFactor)
return f.setBoundingSphere(m),f}const LC={"polymer-backbone-cylinder":(e,t)=>(0,Gh.T)("Polymer backbone cylinder",e,t,BC),"polymer-backbone-sphere":(e,t)=>(0,Gh.T)("Polymer backbone sphere",e,t,MC),"polymer-gap":(e,t)=>(0,Gh.T)("Polymer gap cylinder",e,t,rb)},NC={...DC,...PC,...nb,sizeAspectRatio:Vr.t.Numeric(1,{min:.1,max:3,step:.1}),visuals:Vr.t.MultiSelect(["polymer-backbone-cylinder","polymer-backbone-sphere","polymer-gap"],Vr.t.objectToOptions(LC)),bumpFrequency:Vr.t.Numeric(0,{min:0,max:10,step:.1},Mr.iy.ShadingCategory),density:Vr.t.Numeric(.1,{min:0,max:1,step:.01},Mr.iy.ShadingCategory),colorMode:Vr.t.Select("default",Vr.t.arrayToOptions(["default","interpolate"]),{...Mr.iy.ShadingCategory,isHidden:!0})},FC=(0,qh.GT)({name:"backbone",label:"Backbone",description:"Displays polymer backbone with cylinders and spheres.",factory:function(e,t){return vo.YL.createMulti("Backbone",e,t,qh.J1,LC)},getParams:function(e,t){const n=Vr.t.clone(NC)
let r=!1
return t.units.forEach(e=>{!r&&e.gapElements.length&&(r=!0)}),n.visuals.defaultValue=["polymer-backbone-cylinder","polymer-backbone-sphere"],r&&n.visuals.defaultValue.push("polymer-gap"),n},defaultValues:Vr.t.getDefaultValues(NC),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.polymerResidueCount>0})
var zC=n(71712),jC=n(37392),VC=n(45996),UC=n(42529),GC=n(87958),HC=n(87423)
const qC=Ta.eB.set,QC=Ta.eB.transformMat4,$C=Ta.eB.squaredDistance,XC={...th.m7,interpolation:Vr.t.Select("nearest",Vr.t.objectToOptions(zC.On)),imageResolution:Vr.t.Numeric(.5,{min:.01,max:20,step:.01},{description:"Grid resolution/cell spacing.",...Mr.iy.CustomQualityParamInfo}),mode:Vr.t.Select("frame",Vr.t.arrayToOptions(["frame","plane"]),{description:"Frame: slice through the structure along arbitrary axes in any step size. Plane: an arbitrary plane defined by point and normal."}),offset:Vr.t.Numeric(0,{min:-1,max:1,step:.01},{isEssential:!0,immediateUpdate:!0,hideIf:e=>"frame"!==e.mode,description:"Relative offset from center."}),axis:Vr.t.Select("c",Vr.t.arrayToOptions(["a","b","c"]),{isEssential:!0,hideIf:e=>"frame"!==e.mode}),rotation:Vr.t.Group({axis:Vr.t.Vec3(Ta.eB.create(1,0,0),{},{description:"Axis of rotation"}),angle:Vr.t.Numeric(0,{min:-180,max:180,step:1},{immediateUpdate:!0,description:"Axis rotation angle in Degrees"})},{isExpanded:!0,hideIf:e=>"frame"!==e.mode}),plane:Vr.t.Group({point:Vr.t.Vec3(Ta.eB.create(0,0,0),{},{description:"Plane point"}),normal:Vr.t.Vec3(Ta.eB.create(1,0,0),{},{description:"Plane normal"})},{isExpanded:!0,hideIf:e=>"plane"!==e.mode}),extent:Vr.t.Select("frame",Vr.t.arrayToOptions(["frame","sphere"]),{description:"Extent of the plane, either box (frame) or sphere."}),margin:Vr.t.Numeric(4,{min:0,max:50,step:1},{immediateUpdate:!0,description:"Margin around the structure in Angstrom"}),frame:Vr.t.Select("principalAxes",Vr.t.arrayToOptions(["principalAxes","boundingBox"])),antialias:Vr.t.Boolean(!0,{description:"Antialiasing of structure edges."}),cutout:Vr.t.Boolean(!1,{description:"Cutout the structure from the image."}),defaultColor:Vr.t.Color((0,VC.Q1)(13421772),{description:"Default color for parts of the image that are not covered by the color theme."}),includeParent:Vr.t.Boolean(!1,{description:"Show parent structure (but within extent of this structure)."})}
function WC(e){return(0,th.cT)({defaultProps:Vr.t.getDefaultValues(XC),createGeometry:YC,createLocationIterator:Nh.fromStructure,getLoci:Lh,eachLocation:Oh,setUpdateState:(e,t,n,r,i)=>{e.createGeometry=!(t.imageResolution===n.imageResolution&&t.mode===n.mode&&t.margin===n.margin&&t.frame===n.frame&&t.extent===n.extent&&Ta.eB.equals(t.rotation.axis,n.rotation.axis)&&t.rotation.angle===n.rotation.angle&&t.offset===n.offset&&t.axis===n.axis&&Ta.eB.equals(t.plane.point,n.plane.point)&&Ta.eB.equals(t.plane.normal,n.plane.normal)&&t.antialias===n.antialias&&t.cutout===n.cutout&&t.defaultColor===n.defaultColor&&UC.J.areEqual(r.color,i.color)&&eh.F.areEqual(r.size,i.size))}},e)}function YC(e,t,n,r,i){const{imageResolution:o,offset:a,antialias:s,cutout:l,defaultColor:c}=r,u=1/o,d="color"in n.color&&n.color.color?n.color.color:()=>(0,VC.Q1)(16777215),{size:p,major:h,minor:f,normal:m,center:g,trim:y}=function(e,t){const{mode:n,axis:r,frame:i,extent:o,margin:a,rotation:s,plane:l,includeParent:c}=t
c&&e.child&&(e=e.child)
const u=(0,Ta.eB)(),d=(0,Ta.eB)(),p=(0,Ta.eB)(),h=(0,Ta.eB)(),f=(0,Ta.eB)(),m=(0,Ta.eB)()
let g,y,v,b=0,x=0,S=0
if("principalAxes"===i){const t=Or.Structure.getPrincipalAxes(e).boxAxes;[b,x,S]=hd.n.size((0,Ta.eB)(),t),g=t.dirA,y=t.dirB,v=t.dirC,Ta.eB.copy(m,t.origin)}else[b,x,S]=hd.DJ.size((0,Ta.eB)(),e.boundary.box),g=Ta.eB.create(1,0,0),y=Ta.eB.create(0,1,0),v=Ta.eB.create(0,0,1),Ta.eB.copy(m,e.boundary.sphere.center)
if(Ta.eB.set(d,b,x,S),"c"===r?(Ta.eB.set(u,b,x,S),Ta.eB.copy(p,g),Ta.eB.copy(h,y),Ta.eB.copy(f,v)):"b"===r?(Ta.eB.set(u,b,S,x),Ta.eB.copy(p,g),Ta.eB.copy(f,y),Ta.eB.copy(h,v)):(Ta.eB.set(u,x,S,b),Ta.eB.copy(f,g),Ta.eB.copy(p,y),Ta.eB.copy(h,v)),0!==s.angle){const e=(0,Ta.eB)()
Ta.eB.scaleAndAdd(e,e,g,s.axis[0]),Ta.eB.scaleAndAdd(e,e,y,s.axis[1]),Ta.eB.scaleAndAdd(e,e,v,s.axis[2]),Ta.eB.normalize(e,e)
const t=Ta.$I.fromRotation((0,Ta.$I)(),(0,HC.pu)(s.angle),e)
Ta.eB.transformDirection(p,p,t),Ta.eB.transformDirection(h,h,t),Ta.eB.transformDirection(f,f,t)}if("sphere"===o||0!==s.angle){const t=2*e.boundary.sphere.radius,n=Ta.eB.magnitude(hd.DJ.size((0,Ta.eB)(),hd.DJ.fromSphere3D((0,hd.DJ)(),e.boundary.sphere)))
Ta.eB.set(u,n,n,t),"sphere"===o&&Ta.eB.set(d,t,t,t)}Ta.eB.addScalar(u,u,2*a),Ta.eB.addScalar(d,d,2*a)
const _=Ta.k.identity()
return"principalAxes"===i&&Ta.k.fromBasis(_,Ta.eB.normalize((0,Ta.eB)(),g),Ta.eB.normalize((0,Ta.eB)(),y),Ta.eB.normalize((0,Ta.eB)(),v)),"plane"===n&&(Ta.eB.copy(m,l.point),Ta.eB.copy(f,l.normal),Ta.eB.cross(p,f,Ta.eB.unitX),Ta.eB.dot(p,p)<Ta.p8&&Ta.eB.cross(p,f,Ta.eB.unitY),Ta.eB.normalize(p,p),Ta.eB.cross(h,f,p),Ta.eB.normalize(h,h)),{size:u,major:p,minor:h,normal:f,center:m,trim:{type:"sphere"===o?2:3,center:m,scale:d,rotation:_,transform:Ta.$I.identity()}}}(t,r),v=Ta.eB.create(p[0],p[1],1),b=Ta.eB.setMagnitude((0,Ta.eB)(),m,p[2]/2),x=Math.floor(p[1]*u),S=Math.floor(p[0]*u),_=Ta.$I.identity(),C=(0,Ta.eB)(),w=(0,Ta.eB)()
Ta.eB.add(C,g,h),Ta.$I.targetTo(_,g,C,f),Ta.eB.scaleAndAdd(w,g,b,a),Ta.$I.setTranslation(_,w),Ta.$I.mul(_,_,Ta.$I.rotY90),Ta.$I.scale(_,_,v)
const{getSerialIndex:T}=t.serialMapping,A=n.color.granularity.startsWith("vertex"),I=GC.i.fromNormalAndCoplanarPoint((0,GC.i)(),Ta.eB.normalize((0,Ta.eB)(),m),w),P=Ta.$I.invert((0,Ta.$I)(),_),B=(0,Dp.tu)((0,Ta.eB)(),(0,Ta.eB)()),E=Or.StructureElement.Location.create(t),{units:k}=t
let D=0
for(let G=0,H=k.length;G<H;++G){const{elements:e}=k[G]
E.unit=k[G]
for(let t=0,r=e.length;t<r;++t){E.element=e[t]
const r=n.size.size(E)
r>D&&(D=r)}}const M=new Uint8Array(x*S*4),R=new Uint8Array(x*S*4),O=new Float32Array(x*S)
O.fill(Number.MAX_VALUE)
const L=(0,Ta.eB)(),N=(0,Ta.eB)(),F=(0,Ta.eB)()
if(A){let e=0
for(let t=0;t<S;++t)for(let n=0;n<x;++n){const r=(0,Pm.qE)(n+.5,0,x-1)/x-.5,i=(0,Pm.qE)(t+.5,0,S-1)/S-.5
Ta.eB.set(C,i,-r,0),Ta.eB.transformMat4(C,C,_),Ta.eB.copy(B.position,C)
const o=d(B,!1)
VC.Q1.toArray(o,M,e),M[e+3]=l?0:255,e+=4}}else for(let G=0,H=x*S*4;G<H;G+=4)VC.Q1.toArray(c,M,G),M[G+3]=l?0:255
for(let G=0,H=k.length;G<H;++G){const e=k[G],{elements:t,conformation:r}=e
E.unit=k[G]
for(let i=0,a=t.length;i<a;++i){const e=t[i]
E.element=e,r.position(e,L)
const a=GC.i.distanceToPoint(I,L)
if(Math.abs(a)>D)continue
const p=n.size.size(E)
if(Math.abs(a)>p)continue
const h=Math.cos(Math.abs(a)/p),f=s?o*h:0,m=p+f/2,g=m*m
Ta.eB.scaleAndAdd(N,L,I.normal,-a),Ta.eB.transformMat4(F,N,P),Ta.eB.addScalar(F,F,.5)
const y=Math.floor(F[0]*S),v=x-Math.ceil(F[1]*x),b=Math.ceil(p*u),w=Math.max(0,y-b),k=Math.max(0,v-b),z=Math.min(S,y+b+2),j=Math.min(x,v+b+2)
Ta.eB.copy(B.position,N)
const V=A?c:d(E,!1),U=T(E.unit,E.element)
for(let t=w;t<z;++t)for(let e=k;e<j;++e){const n=(0,Pm.qE)(t+.5,0,S-1)/S-.5,r=(0,Pm.qE)(e+.5,0,x-1)/x-.5
qC(C,n,-r,0),QC(C,C,_)
const i=$C(C,L)
if(i>g)continue
const o=t*x+e
if(i<O[o]){const e=4*o,t=Math.sqrt(i)-p+f/2
let n=t>0?1-t/f:1
A?1===n?O[o]=i:l&&(0===R[e]&&0===R[e+1]&&0===R[e+2]||(n=1)):1===n?(O[o]=i,VC.Q1.toArray(V,M,e)):l?(VC.Q1.toArray(V,M,e),0===R[e]&&0===R[e+1]&&0===R[e+2]||(n=1)):VC.Q1.toArray(VC.Q1.interpolate(VC.Q1.fromArray(M,e),V,n),M,e),(0,Fx.Gu)(U,R,e),R[e+3]=s?Math.round(255*n):255,l&&(M[4*o+3]=s?Math.round(255*n):255)}}}}const z={width:x,height:S,array:M,flipY:!0},j={width:x,height:S,array:R,flipY:!0},V={width:1,height:1,array:new Float32Array(1),flipY:!0},U=new Float32Array([-.5,.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0])
return(0,jC.pi)(_,U,0,4),zC._V.create(z,U,j,V,y,-1,i)}const ZC={"plane-image":(e,t)=>(0,qh.Kp)("Plane image",e,t,WC)},KC={...XC,visuals:Vr.t.MultiSelect(["plane-image"],Vr.t.objectToOptions(ZC))},JC=(0,qh.GT)({name:"plane",label:"Plane",description:"Displays planes.",factory:function(e,t){return vo.YL.createMulti("Plane",e,t,qh.J1,ZC)},getParams:function(e,t){return KC},defaultValues:Vr.t.getDefaultValues(KC),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:e=>e.elementCount>0,getData:(e,t)=>t.includeParent?e.asParent():e,mustRecreate:(e,t)=>e.includeParent!==t.includeParent})
class ew extends vo.lN{constructor(){super(),(0,jr.IF)(ew.BuiltIn,(e,t)=>{if(e.name!==t)throw new Error(`Fix BuiltInStructureRepresentations to have matching names. ${e.name} ${t}`)
this.add(e)})}}!function(e){e.BuiltIn={cartoon:Cx,backbone:FC,"ball-and-stick":Wh,carbohydrate:im,ellipsoid:Lx,"gaussian-surface":OS,"gaussian-volume":wC,label:HS,line:fC,"molecular-surface":a_,orientation:m_,plane:JC,point:I_,putty:O_,spacefill:z_}}(ew||(ew={}))
var tw=n(4360),nw=n(59455),rw=n(69082),iw=n(17487),ow=n(43901)
const aw=1e3/30
class sw{get isAnimating(){return this._isAnimating}async tick(e,t){var n,r
if(await this.plugin.managers.animation.tick(e,null==t?void 0:t.isSynchronous,null==t?void 0:t.animation),null===(n=this.plugin.canvas3d)||void 0===n||n.tick(e,t),ud.g$){const e=null===(r=this.plugin.canvas3d)||void 0===r?void 0:r.webgl.timer.resolve()
if(e)for(const t of e)(0,ow.d)([t])}}resetTime(e){var t
null===(t=this.plugin.canvas3d)||void 0===t||t.resetTime(e)}start(e){var t,n
null===(t=this.plugin.canvas3d)||void 0===t||t.resume(),this._isAnimating=!0,this.resetTime(0),this.properTimeT=0,this.lastTickT=(0,Ic.t)(),(null==e?void 0:e.immediate)?this.frame():this.currentFrame=null===(n=this.plugin.canvas3d)||void 0===n?void 0:n.requestAnimationFrame(this.frame)}stop(e){var t,n
this._isAnimating=!1,void 0!==this.currentFrame&&(null===(t=this.plugin.canvas3d)||void 0===t||t.cancelAnimationFrame(this.currentFrame),this.currentFrame=void 0),(null==e?void 0:e.noDraw)&&(null===(n=this.plugin.canvas3d)||void 0===n||n.pause(null==e?void 0:e.noDraw))}constructor(e){this.plugin=e,this.lastTickT=0,this.properTimeT=0,this.currentFrame=void 0,this._isAnimating=!1,this.frame=(e,t)=>{var n
const r=(0,Ic.t)(),i=r-this.lastTickT
this.lastTickT=r,this.properTimeT+=Math.min(i,aw),this.tick(this.properTimeT,{xrFrame:t}),this._isAnimating&&(this.currentFrame=null===(n=this.plugin.canvas3d)||void 0===n?void 0:n.requestAnimationFrame(this.frame))}}}var lw=n(41428),cw=n(48187),uw=n(16915)
class dw{getDecorator(e){const t=this.plugin.state.data.tree,n=t.children.get(e)
if(1!==n.size)return e
const r=n.first()
return r&&t.transforms.get(r).transformer.definition.isDecorator?this.getDecorator(r):e}get(e,t=!1){const n=this.root.get(e)
if(n)return t?this.plugin.state.data.cells.get(n.ref):this.plugin.state.data.cells.get(this.getDecorator(n.ref))}addMapping(e,t,n){if(!gi.O.Molecule.Structure.is(n))return!1
if(this.tracked.set(t,n.data),this.root.has(n.data))this.root.get(n.data).count++
else{const r=e.select($r.QX.Generators.byRef(t).rootOfType([gi.O.Molecule.Structure]))[0]
r?this.root.set(n.data,{ref:r.transform.ref,count:1}):this.root.set(n.data,{ref:t,count:1})}return!0}removeMapping(e){if(!this.tracked.has(e))return!1
const t=this.tracked.get(e)
this.tracked.delete(e)
const n=this.root.get(t)
return n.count>1?n.count--:this.root.delete(t),!0}updateMapping(e,t,n,r){return!!gi.O.Molecule.Structure.is(r)&&(this.removeMapping(t),this.addMapping(e,t,r),!0)}dispose(){this.ev.dispose()}constructor(e){this.plugin=e,this.ev=iw.V.create(),this.events={updated:this.ev(),removed:this.ev()},this.root=new Map,this.tracked=new Map,e.state.data.events.object.created.subscribe(e=>{this.addMapping(e.state,e.ref,e.obj)}),e.state.data.events.object.removed.subscribe(e=>{this.removeMapping(e.ref)&&this.events.removed.next({ref:e.ref,obj:e.obj})}),e.state.data.events.object.updated.subscribe(e=>{this.updateMapping(e.state,e.ref,e.oldObj,e.obj)&&this.events.updated.next({ref:e.ref,oldObj:e.oldObj,obj:e.obj})})}}var pw=n(5378)
class hw{constructor(){this.ev=iw.V.create(),this.id=0,this.runningTasks=new Set,this.abortRequests=new Map,this.options=new Map,this.currentContext=[],this.events={progress:this.ev(),finished:this.ev()}}tryGetAbortTaskId(e){if(this.abortRequests.has(e.progress.taskId))return e.progress.taskId
for(const t of e.children){const e=this.tryGetAbortTaskId(t)
if(void 0!==e)return e}}track(e,t){return n=>{var r
if(n.canAbort&&n.requestAbort){const e=this.tryGetAbortTaskId(n.root)
void 0!==e&&n.requestAbort(this.abortRequests.get(e))}const i=(0,Ic.t)()-n.root.progress.startedTime
this.events.progress.next({id:e,useOverlay:null===(r=this.options.get(t))||void 0===r?void 0:r.useOverlay,level:i<250?"none":"background",progress:n})}}async run(e,t){const n=this.id++
let r;(null==t?void 0:t.createNewContext)||0===this.currentContext.length?r={ctx:(0,pw.pm)(e,this.track(n,e.id),100),refCount:1}:(r=this.currentContext[this.currentContext.length-1],r.refCount++)
try{return this.options.set(e.id,{useOverlay:!!(null==t?void 0:t.useOverlay)}),this.runningTasks.add(e.id),await(0,pw.yR)(r.ctx,e)}finally{this.options.delete(e.id),this.runningTasks.delete(e.id),this.events.finished.next({id:n}),this.abortRequests.delete(e.id),r.refCount--,0===r.refCount&&(0,ao.mO)(this.currentContext,r)}}requestAbortAll(e){this.runningTasks.forEach(t=>this.abortRequests.set(t,e))}requestAbort(e,t){const n="number"==typeof e?e:e.root.progress.taskId
this.abortRequests.set(n,t)}dispose(){this.ev.dispose()}}!function(e){function t(e){return new Promise(t=>setTimeout(t,e))}e.testTask=function(e){return Fr.Task.create("Test",async n=>{let r=0
for(;r<e;)await t(100+200*Math.random()),n.shouldUpdate&&await n.update({message:"Step "+r,current:r,max:e,isIndeterminate:!1}),r++})}}(hw||(hw={}))
class fw extends Ur.e{findByKey(e){return this.state.entries.find(t=>!!t&&t.key===e)}show(e){let t,n=this.state.entries
const r=++this.serialId
let i
e.key&&(t=this.findByKey(e.key))?(void 0!==t.timeout&&clearTimeout(t.timeout),i=t.serialNumber,n=n.remove(t.id)):i=++this.serialNumber,t={id:r,serialNumber:i,key:e.key,title:e.title,message:e.message,timeout:this.timeout(r,e.timeoutMs),hide:()=>this.hideId(r)},this.updateState({entries:n.set(r,t)})&&this.events.changed.next(void 0)}timeout(e,t){if(void 0!==t)return t<0&&(t=500),setTimeout(()=>{const t=this.state.entries.get(e)
t.timeout=void 0,this.hide(t)},t)}hideId(e){this.hide(this.state.entries.get(e))}hide(e){e&&(void 0!==e.timeout&&clearTimeout(e.timeout),e.hide=void 0,this.updateState({entries:this.state.entries.delete(e.id)})&&this.events.changed.next(void 0))}constructor(e){super({entries:(0,Ac.uY)()}),this.events={changed:this.ev()},this.serialNumber=0,this.serialId=0,Ir.PluginCommands.Toast.Show.subscribe(e,e=>this.show(e)),Ir.PluginCommands.Toast.Hide.subscribe(e,e=>this.hide(this.findByKey(e.key)))}}var mw=n(26429),gw=n(97573)
function yw(){const e=document.createElement("canvas")
return!(!e.getContext||!e.getContext("2d"))&&0===e.toDataURL("image/webp").indexOf("data:image/webp")}class vw extends Ur.N{createParams(){let e=8192
if(this.plugin.canvas3d){const{webgl:t}=this.plugin.canvas3d
e=Math.floor(Math.min(t.maxRenderbufferSize,t.maxTextureSize)/2)}return{resolution:Vr.t.MappedStatic("viewport",{viewport:Vr.t.Group({}),hd:Vr.t.Group({}),"full-hd":Vr.t.Group({}),"ultra-hd":Vr.t.Group({}),custom:Vr.t.Group({width:Vr.t.Numeric(1920,{min:128,max:e,step:1}),height:Vr.t.Numeric(1080,{min:128,max:e,step:1})},{isFlat:!0})},{options:[["viewport","Viewport"],["hd","HD (1280 x 720)"],["full-hd","Full HD (1920 x 1080)"],["ultra-hd","Ultra HD (3840 x 2160)"],["custom","Custom"]]}),format:Vr.t.MappedStatic("png",{png:Vr.t.Group({}),webp:Vr.t.Group({quality:Vr.t.Numeric(.9,{min:0,max:1,step:.01})}),jpeg:Vr.t.Group({quality:Vr.t.Numeric(.9,{min:0,max:1,step:.01})})},{options:[["png","PNG"],["jpeg","JPEG"],...yw()?[["webp","WebP"]]:[]]}),transparent:Vr.t.Boolean(!1),axes:mw.kf.axes,illumination:Vr.t.Group({extraIterations:Vr.t.Numeric(1,{min:0,max:5,step:1}),targetIterationTimeMs:Vr.t.Numeric(300,{min:100,max:3e3,step:10})})}}get params(){return this._params?this._params:this._params=this.createParams()}get values(){return this.behaviors.values.value}get cropParams(){return this.behaviors.cropParams.value}get relativeCrop(){return this.behaviors.relativeCrop.value}getCanvasSize(){var e,t
return{width:(null===(e=this.plugin.canvas3d)||void 0===e?void 0:e.webgl.gl.drawingBufferWidth)||0,height:(null===(t=this.plugin.canvas3d)||void 0===t?void 0:t.webgl.gl.drawingBufferHeight)||0}}getSize(){const e=this.values
switch(e.resolution.name){case"viewport":return this.getCanvasSize()
case"hd":return{width:1280,height:720}
case"full-hd":return{width:1920,height:1080}
case"ultra-hd":return{width:3840,height:2160}
default:return{width:e.resolution.params.width,height:e.resolution.params.height}}}getPostprocessingProps(){const e=this.plugin.canvas3d,t=e.props.postprocessing.occlusion
return{...e.props.postprocessing,occlusion:"on"===t.name?{name:"on",params:{...t.params,samples:128,resolutionScale:e.webgl.pixelRatio,transparentThreshold:1}}:t}}getIlluminationProps(e){const t=this.plugin.canvas3d.props.illumination,{extraIterations:n,targetIterationTimeMs:r}=this.values.illumination
return{...t,enabled:!e&&t.enabled,maxIterations:Math.ceil(Math.log2(Math.pow(2,t.maxIterations+n)*t.rendersPerFrame[1])),targetFps:1e3/r,denoiseThreshold:[t.denoiseThreshold[0],t.denoiseThreshold[0]],rendersPerFrame:[1,1]}}createPass(e){const t=this.plugin.canvas3d,{colorBufferFloat:n,textureFloat:r}=t.webgl.extensions
return t.getImagePass({transparentBackground:this.values.transparent,cameraHelper:{axes:this.values.axes},multiSample:{...t.props.multiSample,mode:e?"off":"on",sampleLevel:n&&r?4:2,reuseOcclusion:!1},postprocessing:this.getPostprocessingProps(),marking:{...t.props.marking},illumination:this.getIlluminationProps(e)})}get previewPass(){return this._previewPass||(this._previewPass=this.createPass(!0))}get imagePass(){if(this._imagePass){const e=this.plugin.canvas3d
return this._imagePass.setProps({cameraHelper:{axes:this.values.axes},transparentBackground:this.values.transparent,postprocessing:this.getPostprocessingProps(),marking:{...e.props.marking},illumination:this.getIlluminationProps(!1)}),this._imagePass}return this._imagePass=this.createPass(!1)}getFilename(e){"string"!=typeof e&&(e=this.extension)
const t=this.plugin.state.data.select($r.QX.Generators.rootsOfType(gi.O.Molecule.Model)).map(e=>e.obj.data),n=new Set
return t.forEach(e=>n.add(e.entryId.toUpperCase())),`${mi.M.toArray(n).join("-")||"molstar-image"}${e}`}resetCrop(){this.behaviors.relativeCrop.next({x:0,y:0,width:1,height:1})}toggleAutocrop(){this.cropParams.auto?(this.behaviors.cropParams.next({...this.cropParams,auto:!1}),this.resetCrop()):this.behaviors.cropParams.next({...this.cropParams,auto:!0})}get isFullFrame(){const e=this.relativeCrop
return(0,Ax.T)(e.x,0,1e-5)&&(0,Ax.T)(e.y,0,1e-5)&&(0,Ax.T)(e.width,1,1e-5)&&(0,Ax.T)(e.height,1,1e-5)}autocrop(e=this.cropParams.relativePadding){const{data:t,width:n,height:r}=this.previewData.image,i=this.previewData.transparent,o=i?this.previewData.background:4278190080|this.previewData.background
let a=n,s=0,l=r,c=0
for(let h=0;h<r;h++){const e=h*n
for(let r=0;r<n;r++){const n=4*(e+r)
if(i){if(0===t[n+3])continue}else if((t[n]<<16|t[n+1]<<8|t[n+2]|t[n+3]<<24)===o)continue
r<a&&(a=r),r>s&&(s=r),h<l&&(l=h),h>c&&(c=h)}}if(a>s){const e=a
a=s,s=e}if(l>c){const e=l
l=c,c=e}const u=s-a+1,d=c-l+1
a-=e*u,s+=e*u,l-=e*d,c+=e*d
const p={x:Math.max(0,a/n),y:Math.max(0,l/r),width:Math.min(1,(s-a+1)/n),height:Math.min(1,(c-l+1)/r)}
this.behaviors.relativeCrop.next(p)}async getPreview(e,t=320){const{width:n,height:r}=this.getSize()
if(n<=0||r<=0)return
const i=n/r
let o=0,a=0
i>1?(o=t,a=Math.round(t/i)):(a=t,o=Math.round(t*i))
const s=this.plugin.canvas3d.props
this.previewPass.setProps({cameraHelper:{axes:this.values.axes},transparentBackground:this.values.transparent,postprocessing:s.postprocessing,marking:s.marking})
const l=await this.previewPass.getImageData(e,o,a),c=this.previewCanvas
c.width=l.width,c.height=l.height,this.previewData.image=l,this.previewData.background=s.renderer.backgroundColor,this.previewData.transparent=this.values.transparent
const u=c.getContext("2d")
if(!u)throw new Error("Could not create canvas 2d context")
return u.putImageData(l,0,0),this.cropParams.auto&&this.autocrop(),this.events.previewed.next(void 0),{canvas:c,width:o,height:a}}getSizeAndViewport(){const{width:e,height:t}=this.getSize(),n=this.relativeCrop,r={x:Math.floor(n.x*e),y:Math.floor(n.y*t),width:Math.ceil(n.width*e),height:Math.ceil(n.height*t)}
return r.width+r.x>e&&(r.width=e-r.x),r.height+r.y>t&&(r.height=t-r.y),{width:e,height:t,viewport:r}}async draw(e){const{width:t,height:n,viewport:r}=this.getSizeAndViewport()
if(!(t<=0||n<=0)){this.plugin.animationLoop.stop({noDraw:!0})
try{await e.update("Rendering image...")
const i=this.imagePass
await i.updateBackground()
const o=await i.getImageData(e,t,n,r)
await e.update("Encoding image...")
const a=this.canvas
a.width=o.width,a.height=o.height
const s=a.getContext("2d")
if(!s)throw new Error("Could not create canvas 2d context")
s.putImageData(o,0,0)}finally{this.plugin.animationLoop.start({immediate:!0})}}}copyToClipboardTask(){const e=navigator.clipboard
if(null==e?void 0:e.write)return Fr.Task.create("Copy Image",async t=>{await this.draw(t),await t.update("Converting image...")
const n=this.mimeType,r=await(0,od.PG)(this.canvas,n,this.quality),i=new ClipboardItem({[n]:r})
await e.write([i]),this.plugin.log.message("Image copied to clipboard.")})
this.plugin.log.error("clipboard.write not supported!")}get mimeType(){var e,t
return`image/${null!==(t=null===(e=this.values.format)||void 0===e?void 0:e.name)&&void 0!==t?t:"png"}`}get extension(){var e,t,n
return"jpeg"===(null===(e=this.values.format)||void 0===e?void 0:e.name)?".jpg":`.${null!==(n=null===(t=this.values.format)||void 0===t?void 0:t.name)&&void 0!==n?n:"png"}`}get quality(){var e,t,n,r
switch(null===(e=this.values.format)||void 0===e?void 0:e.name){case"webp":case"jpeg":return null!==(r=null===(n=null===(t=this.values.format)||void 0===t?void 0:t.params)||void 0===n?void 0:n.quality)&&void 0!==r?r:.9
default:return}}getImageDataUri(){return this.plugin.runTask(Fr.Task.create("Generate Image",async e=>(await this.draw(e),await e.update("Converting image..."),this.canvas.toDataURL(this.mimeType))))}copyToClipboard(){const e=this.copyToClipboardTask()
if(e)return this.plugin.runTask(e)}downloadTask(e){return Fr.Task.create("Download Image",async t=>{await this.draw(t),await t.update("Downloading image...")
const n=await(0,od.PG)(this.canvas,this.mimeType,this.quality);(0,gw.R)(n,null!=e?e:this.getFilename(this.extension))})}download(e){return this.plugin.runTask(this.downloadTask(e),{useOverlay:!0})}constructor(e){super(),this.plugin=e,this._params=void 0,this.behaviors={values:this.ev.behavior({transparent:this.params.transparent.defaultValue,format:{name:"png",params:{}},axes:{name:"off",params:{}},resolution:this.params.resolution.defaultValue,illumination:this.params.illumination.defaultValue}),cropParams:this.ev.behavior({auto:!0,relativePadding:.1}),relativeCrop:this.ev.behavior({x:0,y:0,width:1,height:1})},this.events={previewed:this.ev()},this.canvas=document.createElement("canvas"),this.previewCanvas=document.createElement("canvas"),this.previewData={image:{data:new Uint8ClampedArray(1),width:1,height:0},background:(0,lo.Color)(0),transparent:!1}}}var bw=n(72866)
class xw{addHandler(e,t){const n=this.handlers.findIndex(t=>t[0]===e)
n<0?this.handlers.push([e,t]):this.handlers[n][1]=t}removeHandler(e){const t=this.handlers.findIndex(t=>t[0]===e)
t>=0&&this.handlers.splice(t,1)}async handle(e){for(let t=this.handlers.length-1;t>=0;t--){const n=this.handlers[t][1]
if(await n(e,this.plugin))return}!function(e,t){const n=t.filter(e=>{const t=e.name.toLowerCase()
return t.endsWith(".molx")||t.endsWith(".molj")})
n.length>0?Ir.PluginCommands.State.Snapshots.OpenFile(e,{file:n[0]}):e.runTask(e.state.data.applyAction(Qu.OpenFiles,{files:t.map(e=>$u.V.File(e)),format:{name:"auto",params:{}},visuals:!0}))}(this.plugin,e)}dispose(){this.handlers.length=0}constructor(e){this.plugin=e,this.handlers=[]}}class Sw{constructor(){this.errors=Object.create(null)}get(e){var t
return null!==(t=this.errors[e])&&void 0!==t?t:[]}add(e,t){e in this.errors&&Array.isArray(this.errors[e])?this.errors[e].push(t):this.errors[e]=[t]}clear(e){delete this.errors[e]}}class _w{mount(e){var t
this.parent.parentElement!==e&&(null===(t=this.parent.parentElement)||void 0===t||t.removeChild(this.parent)),e.appendChild(this.parent)}unmount(){var e
null===(e=this.parent.parentElement)||void 0===e||e.removeChild(this.parent)}constructor(e){this.options=e
const t=document.createElement("div")
Object.assign(t.style,{position:"absolute",left:0,top:0,right:0,bottom:0,"-webkit-user-select":"none","user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)","-webkit-touch-callout":"none","touch-action":"manipulation"})
let n=null==e?void 0:e.canvas
n||(n=document.createElement("canvas"),t.appendChild(n)),this.canvas=n,this.parent=t}}class Cw{get isInitialized(){return this._isInitialized}build(){return this.state.data.build()}async initViewerAsync(e,t,n){return this._initViewer(e,t,n)}async initContainerAsync(e){return this._initContainer(e)}async mountAsync(e,t){return this._mount(e,t)}_initContainer(e){var t,n
if(this.container)return!0
const r=new _w({checkeredCanvasBackground:null==e?void 0:e.checkeredCanvasBackground,canvas:null===(t=null==e?void 0:e.canvas3dContext)||void 0===t?void 0:t.canvas})
return!!this._initViewer(r.canvas,r.parent,null==e?void 0:e.canvas3dContext)&&((null==e?void 0:e.checkeredCanvasBackground)&&(null===(n=this.canvas3d)||void 0===n||n.setProps({checkeredTransparentBackground:!0})),this.container=r,!0)}_mount(e,t){var n
if(this.disposed)throw new Error("Cannot mount a disposed context")
return!!this._initContainer(t)&&(null===(n=this.container)||void 0===n||n.mount(e),this.handleResize(),!0)}unmount(){var e
null===(e=this.container)||void 0===e||e.unmount()}_initViewer(e,t,n){var r,i,o,a,s,l
try{this.layout.setRoot(t),this.spec.layout&&this.spec.layout.initial&&this.layout.setProps(this.spec.layout.initial),n||(n=wc.H7.fromCanvas(e,this.managers.asset,{antialias:!(null!==(r=this.config.get(go.PluginConfig.General.DisableAntialiasing))&&void 0!==r&&r),preserveDrawingBuffer:!(null!==(i=this.config.get(go.PluginConfig.General.DisablePreserveDrawingBuffer))&&void 0!==i&&i),preferWebGl1:this.config.get(go.PluginConfig.General.PreferWebGl1)||!1,failIfMajorPerformanceCaveat:!(null!==(o=this.config.get(go.PluginConfig.General.AllowMajorPerformanceCaveat))&&void 0!==o&&o),powerPreference:this.config.get(go.PluginConfig.General.PowerPreference)||"high-performance",handleResize:this.handleResize},{pixelScale:this.config.get(go.PluginConfig.General.PixelScale)||1,pickScale:this.config.get(go.PluginConfig.General.PickScale)||.25,transparency:this.config.get(go.PluginConfig.General.Transparency)||"wboit",resolutionMode:this.config.get(go.PluginConfig.General.ResolutionMode)||"auto"})),this.canvas3dContext=n,this.canvas3d=wc.mX.create(this.canvas3dContext),this.canvas3dInit.next(!0)
let c=this.spec.canvas3d
const u=(0,lo.Color)(16579577)
return c?(void 0===(null===(s=c.renderer)||void 0===s?void 0:s.backgroundColor)&&(c=(0,Nu.j)(c,e=>{e.renderer?e.renderer.backgroundColor=u:e.renderer={backgroundColor:u}})),null===(l=this.canvas3d)||void 0===l||l.setProps(c)):null===(a=this.canvas3d)||void 0===a||a.setProps({renderer:{backgroundColor:u}}),this.animationLoop.start(),this.helpers.viewportScreenshot=new vw(this),this.subs.push(this.canvas3d.interaction.click.subscribe(e=>this.behaviors.interaction.click.next(e))),this.subs.push(this.canvas3d.interaction.drag.subscribe(e=>this.behaviors.interaction.drag.next(e))),this.subs.push(this.canvas3d.interaction.hover.subscribe(e=>this.behaviors.interaction.hover.next(e))),this.subs.push(this.canvas3d.input.resize.pipe((0,jc.B)(50),(0,va.c)(100,void 0,{leading:!1,trailing:!0})).subscribe(()=>this.handleResize())),this.subs.push(this.canvas3d.input.keyDown.subscribe(e=>this.behaviors.interaction.key.next(e))),this.subs.push(this.canvas3d.input.keyUp.subscribe(e=>this.behaviors.interaction.keyReleased.next(e))),this.subs.push(this.canvas3d.xr.isPresenting.subscribe(e=>this.log.info("WebXR "+(e?"enabled":"disabled")))),this.subs.push(this.canvas3d.xr.requestFailed.subscribe(e=>this.log.error(`WebXR request failed: ${e}`))),this.subs.push(this.layout.events.updated.subscribe(()=>requestAnimationFrame(()=>this.handleResize()))),this.handleResize(),Fr.Scheduler.setImmediate(()=>this.initCanvas3dPromiseCallbacks[0]()),!0}catch(e){return this.log.error(""+e),console.error(e),Fr.Scheduler.setImmediate(()=>this.initCanvas3dPromiseCallbacks[1](e)),!1}}get isBusy(){return this.behaviors.state.isAnimating.value||this.behaviors.state.isUpdating.value}get selectionMode(){return this.behaviors.interaction.selectionMode.value}set selectionMode(e){this.behaviors.interaction.selectionMode.next(e)}dataTransaction(e,t){return this.runTask(this.state.data.transaction(e,t))}clear(e=!1){var t
return e&&(null===(t=this.canvas3d)||void 0===t||t.setProps(wc.FN)),Ir.PluginCommands.State.RemoveObject(this,{state:this.state.data,ref:$r.Cn.RootRef})}dispose(e){var t,n
if(!this.disposed){for(const e of this.subs)e.unsubscribe()
this.subs=[],this.layout.dispose(),this.managers.markdownExtensions.audio.dispose(),this.animationLoop.stop(),this.commands.dispose(),null===(t=this.canvas3d)||void 0===t||t.dispose(),(null==e?void 0:e.doNotDisposeCanvas3DContext)||null===(n=this.canvas3dContext)||void 0===n||n.dispose(e),this.ev.dispose(),this.state.dispose(),this.helpers.substructureParent.dispose(),(0,jr.IF)(this.managers,e=>{var t
return null===(t=null==e?void 0:e.dispose)||void 0===t?void 0:t.call(e)}),(0,jr.IF)(this.managers.structure,e=>{var t
return null===(t=null==e?void 0:e.dispose)||void 0===t?void 0:t.call(e)}),(0,jr.IF)(this.managers.volume,e=>{var t
return null===(t=null==e?void 0:e.dispose)||void 0===t?void 0:t.call(e)}),this.unmount(),this.container=void 0,this.customState={},this.disposed=!0}}initBehaviorEvents(){this.subs.push((0,nd.h)(this.state.data.behaviors.isUpdating,this.state.behaviors.behaviors.isUpdating).subscribe(e=>{this.behaviors.state.isUpdating.value!==e&&this.behaviors.state.isUpdating.next(e)}))
const e=this.config.get(go.PluginConfig.General.IsBusyTimeoutMs)||750,t=this.behaviors.state.isBusy
let n
const r=()=>{t.value||t.next(!0)},i=()=>{void 0!==n&&clearTimeout(n),n=void 0}
this.subs.push((0,nd.h)(this.behaviors.state.isUpdating,this.behaviors.state.isAnimating).subscribe(o=>{const a=this.behaviors.state.isUpdating.value,s=this.behaviors.state.isAnimating.value
a||s?t.value||(i(),n=setTimeout(r,e)):(i(),t.next(!1))})),this.subs.push(this.behaviors.interaction.selectionMode.subscribe(e=>{var t
e||null===(t=this.managers.interactivity)||void 0===t||t.lociSelects.deselectAll()}))}initBuiltInBehavior(){lw.U0.State.registerDefault(this),lw.U0.Representation.registerDefault(this),lw.U0.Camera.registerDefault(this),lw.U0.Misc.registerDefault(this),this.subs.push((0,nd.h)(this.state.data.events.log,this.state.behaviors.events.log).subscribe(e=>this.events.log.next(e)))}async initBehaviors(){let e=this.state.behaviors.build()
for(const t of Object.keys(cw.A.Categories))e.toRoot().apply(cw.A.CreateCategory,{label:cw.A.Categories[t]},{ref:t,state:{isLocked:!0}})
for(const t of this.spec.behaviors)"custom-props"===cw.A.getCategoryId(t.transformer)&&e.to(cw.A.getCategoryId(t.transformer)).apply(t.transformer,t.defaultParams,{ref:t.transformer.id})
await this.runTask(this.state.behaviors.updateTree(e,{doNotUpdateCurrent:!0,doNotLogTiming:!0})),e=this.state.behaviors.build()
for(const t of this.spec.behaviors)"custom-props"!==cw.A.getCategoryId(t.transformer)&&e.to(cw.A.getCategoryId(t.transformer)).apply(t.transformer,t.defaultParams,{ref:t.transformer.id})
await this.runTask(this.state.behaviors.updateTree(e,{doNotUpdateCurrent:!0,doNotLogTiming:!0}))}initCustomFormats(){if(this.spec.customFormats)for(const e of this.spec.customFormats)this.dataFormats.add(e[0],e[1])}initAnimations(){if(this.spec.animations)for(const e of this.spec.animations)this.managers.animation.register(e)}initDataActions(){if(this.spec.actions)for(const e of this.spec.actions)this.state.data.actions.add(e.action)}async init(){try{this.subs.push(this.events.log.subscribe(e=>this.log.entries=this.log.entries.push(e))),this.initCustomFormats(),this.initBehaviorEvents(),this.initBuiltInBehavior(),this.managers.interactivity=new xo(this),this.managers.lociLabels=new pp(this),this.builders.structure=new Pd(this),this.initAnimations(),this.initDataActions(),await this.initBehaviors(),this.log.message(`Mol* Plugin ${bw.j} [${bw.s.toLocaleString()}]`),ud.Zq||this.log.message("Development mode enabled"),ud.Bb&&this.log.message("Debug mode enabled"),this._isInitialized=!0,this.initializedPromiseCallbacks[0]()}catch(e){throw this.initializedPromiseCallbacks[1](e),e}}constructor(e){var t
this.spec=e,this.runTask=(e,t)=>this.managers.task.run(e,t),this.resolveTask=e=>{if(e)return Fr.Task.is(e)?this.runTask(e):e},this.subs=[],this.initCanvas3dPromiseCallbacks=[()=>{},()=>{}],this._isInitialized=!1,this.initializedPromiseCallbacks=[()=>{},()=>{}],this.disposed=!1,this.container=void 0,this.ev=iw.V.create(),this.config=new go.PluginConfigManager(this.spec.config),this.state=new mc.p(this),this.commands=new uw.K,this.canvas3dInit=this.ev.behavior(!1),this.behaviors={state:{isAnimating:this.ev.behavior(!1),isUpdating:this.ev.behavior(!1),isBusy:this.ev.behavior(!1)},interaction:{hover:this.ev.behavior({current:vo.YL.Loci.Empty,modifiers:Yc.Fs.None,buttons:0,button:0}),click:this.ev.behavior({current:vo.YL.Loci.Empty,modifiers:Yc.Fs.None,buttons:0,button:0}),drag:this.ev.behavior({current:vo.YL.Loci.Empty,modifiers:Yc.Fs.None,buttons:0,button:0,pageStart:(0,Ta.ZY)(),pageEnd:(0,Ta.ZY)()}),key:this.ev.behavior(Yc.Vl),keyReleased:this.ev.behavior(Yc.Vl),selectionMode:this.ev.behavior(!1)},labels:{highlight:this.ev.behavior({labels:[]})},layout:{leftPanelTabName:this.ev.behavior("root")},canvas3d:{initialized:this.canvas3dInit.pipe((0,Qi.p)(e=>!!e),(0,rd.N)(function(e,t){var n=0
e.subscribe((0,id._)(t,function(e){++n<=1&&(t.next(e),1<=n&&t.complete())}))}))}},this.canvas3dInitialized=new Promise((e,t)=>{this.initCanvas3dPromiseCallbacks=[e,t]}),this.initialized=new Promise((e,t)=>{this.initializedPromiseCallbacks=[e,t]}),this.layout=new Ip(this),this.animationLoop=new sw(this),this.representation={structure:{registry:new ew,themes:{colorThemeRegistry:UC.J.createRegistry(),sizeThemeRegistry:eh.F.createRegistry()}},volume:{registry:new tw.H,themes:{colorThemeRegistry:UC.J.createRegistry(),sizeThemeRegistry:eh.F.createRegistry()}}},this.query={structure:{registry:new Hr.StructureSelectionQueryRegistry}},this.dataFormats=new Xd,this.builders={data:new ld(this),structure:void 0},this.helpers={substructureParent:new dw(this),viewportScreenshot:void 0},this.managers={structure:{hierarchy:new Ui(this),component:new fi(this),measurement:new mo(this),selection:new mp(this),focus:new vp(this)},volume:{hierarchy:new ha(this)},interactivity:void 0,camera:new dp(this),animation:new Wd(this),snapshot:new hp.g(this),lociLabels:void 0,toast:new fw(this),asset:new $u.E,task:new hw,markdownExtensions:new Sp(this),dragAndDrop:new xw(this)},this.events={log:this.ev(),task:this.managers.task.events,canvas3d:{settingsUpdated:this.ev()}},this.customModelProperties=new td.Registry,this.customStructureProperties=new td.Registry,this.customStructureControls=new Map,this.customImportControls=new Map,this.genericRepresentationControls=new Map,this.errorContext=new Sw,this.customState=Object.create(null),this.handleResize=()=>{var e,t
const n=null===(e=this.canvas3dContext)||void 0===e?void 0:e.canvas,r=this.layout.root
r&&n&&((0,od.H5)(n,r,this.canvas3dContext.pixelScale),this.canvas3dContext.syncPixelScale(),null===(t=this.canvas3d)||void 0===t||t.requestResize())},this.log={entries:(0,Ac.B8)(),entry:e=>this.events.log.next(e),error:e=>this.events.log.next(rw.x.error(e)),message:e=>this.events.log.next(rw.x.message(e)),info:e=>this.events.log.next(rw.x.info(e)),warn:e=>this.events.log.next(rw.x.warning(e))},this.fetch=nw.hW,(0,Tf.GW)(null!==(t=this.config.get(go.PluginConfig.Structure.SaccharideCompIdMapType))&&void 0!==t?t:"default")}}class ww extends Cw{initCustomParamEditors(){if(this.spec.customParamEditors)for(const[e,t]of this.spec.customParamEditors)this.customParamEditors.set(e.id,t)}dispose(e){super.dispose(e),this.layout.dispose()}constructor(e){super(e),this.spec=e,this.customParamEditors=new Map,this.customUIState={},this.initCustomParamEditors()}}var Tw=n(20644)
async function Aw(e){const{spec:t,target:n,onBeforeUIRender:r,render:i}=e,a=new ww(t||(0,Tw.DefaultPluginUISpec)())
await a.init(),r&&await r(a),i((0,o.createElement)(Xu,{plugin:a}),n)
try{await a.canvas3dInitialized}catch(e){}return a}},22703(e,t,n){"use strict"
n.d(t,{V:()=>r})
var r,i=n(10596),o=n(65580),a=n(88524),s=n(30084),l=n(40362),c=n(32520),u=n(63356),d=n(70948),p=n(71712),h=n(47404),f=n(53138)
!function(e){function t(e){switch(e.kind){case"mesh":return 3*e.triangleCount
case"points":return e.pointCount
case"spheres":return 2*e.sphereCount*3
case"cylinders":return 4*e.cylinderCount*3
case"text":return 2*e.charCount*3
case"lines":return 2*e.lineCount*3
case"direct-volume":return 36
case"image":return 6
case"texture-mesh":return e.vertexCount}}e.getDrawCount=t,e.getVertexCount=function(e){switch(e.kind){case"mesh":case"texture-mesh":return e.vertexCount
case"points":return e.pointCount
case"spheres":return 6*e.sphereCount
case"cylinders":return 6*e.cylinderCount
case"text":return 4*e.charCount
case"lines":return 4*e.lineCount
case"direct-volume":const[t,n,r]=e.gridDimension.ref.value
return t*n*r
case"image":return 4}},e.getGroupCount=function(e){switch(e.kind){case"mesh":case"points":case"spheres":case"cylinders":case"text":case"lines":return 0===t(e)?0:(0,u._M)(e.groupBuffer.ref.value)+1
case"direct-volume":return 1
case"image":return(0,f.fE)(e.groupTexture.ref.value.array,4)+1
case"texture-mesh":return e.groupCount}},e.getUtils=function(e){switch(e.kind){case"mesh":return i.e.Utils
case"points":return o.O.Utils
case"spheres":return c.v.Utils
case"cylinders":return h.S.Utils
case"text":return a.E.Utils
case"lines":return s.q.Utils
case"direct-volume":return l.E.Utils
case"image":return p._V.Utils
case"texture-mesh":return d.X.Utils}},e.getGranularity=function(e,t){return"instance"===t&&e.nonInstanceable?"group":t}}(r||(r={}))},22750(e,t,n){"use strict"
n.d(t,{k:()=>r})
var r,i=n(70429)
!function(e){const t="undefined"!=typeof btoa?btoa:e=>Buffer.from(e).toString("base64"),n=[]
e.create22=function(){let e=+new Date+(0,i.t)()
for(let t=0;t<16;t++)n[t]=String.fromCharCode((e+255*Math.random())%255|0),e=Math.floor(e/255)
return t(n.join("")).replace(/\+/g,"-").replace(/\//g,"_").substr(0,22)},e.createv4=function(){let e=+new Date+(0,i.t)()
return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const n=(e+16*Math.random())%16|0
return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)})},e.is=function(e){return"string"==typeof e}}(r||(r={}))},23121(e,t,n){"use strict"
n.d(t,{C:()=>l,f:()=>r})
var r,i=n(32775),o=n(70292),a=n(63356),s=n(33205)
function l(e,t){return o.Task.create("Create Volume",async()=>{const{header:n,values:o}=e,l=i.qY.Space(n.dim,[0,1,2],Float64Array)
let c
if(0===n.dataSetIds.length)c=o
else{const[e,r,i]=n.dim,a=((null==t?void 0:t.dataIndex)||0)+1
let s=0,l=0
c=new Float64Array(e*r*i)
for(let t=0;t<e;t++)for(let e=0;e<r;e++)for(let t=0;t<i;t++)c[s++]=o[l],l+=a}const u=i.qY.create(l,i.qY.Data1(c)),d=i.$I.fromTranslation((0,i.$I)(),n.origin),p=i.$I.fromBasis((0,i.$I)(),n.basisX,n.basisY,n.basisZ)
return i.$I.mul(d,d,p),{label:null==t?void 0:t.label,entryId:null==t?void 0:t.entryId,grid:{transform:{kind:"matrix",matrix:d},cells:u,stats:{min:(0,a.GP)(c),max:(0,a._M)(c),mean:(0,a.VR)(c),sigma:(0,a.C2)(c)}},instances:[{transform:i.$I.identity()}],sourceData:r.create(e),customProperties:new s.v,_propertyData:Object.create(null)}})}!function(e){e.is=function(e){return"cube"===(null==e?void 0:e.kind)},e.create=function(e){return{kind:"cube",name:e.name,data:e}}}(r||(r={}))},23299(e,t,n){"use strict"
n.r(t),n.d(t,{default:()=>y})
var r,i,o,a,s,l=n(50081),c=n(71223),u=n(82735),d=n.n(u),p=n(59553),h=n(61603)
const f="undefined"!=typeof FastBoot,m="routeDidChange",g=["separator","prepend","replace"]
let y=(r=(0,u.service)("router"),i=(0,u.service)("-document"),o=class extends(d()){constructor(e){if(super(e),(0,l.a)(this,"router",a,this),(0,l.a)(this,"document",s,this),(0,l.b)(this,"tokens",[]),(0,l.b)(this,"_defaultConfig",{separator:" | ",prepend:!0,replace:null}),(0,l.b)(this,"scheduleTitleUpdate",()=>{(0,c.scheduleOnce)("afterRender",this,this._updateTitle)}),this._validateExistingTitleElement(),function(e){return"resolveRegistration"in e}(e)){const n=e.resolveRegistration("config:environment")
"object"==typeof(t=n)&&null!==t&&"pageTitle"in t&&g.forEach(e=>{if(!(0,p.isEmpty)(n.pageTitle[e])){const t=n.pageTitle[e]
this._defaultConfig[e]=t}})}var t
this.router.on(m,this.scheduleTitleUpdate)}applyTokenDefaults(e){const t=this._defaultConfig.separator,n=this._defaultConfig.prepend,r=this._defaultConfig.replace
e.previous??=null,e.next??=null,null==e.separator&&(e.separator=t),null==e.prepend&&null!=n&&(e.prepend=n),null==e.replace&&null!=r&&(e.replace=r)}inheritFromPrevious(e){const t=e.previous
t&&(null==e.separator&&(e.separator=t.separator),null==e.prepend&&(e.prepend=t.prepend))}push(e){const t=this._findTokenById(e.id)
if(t){const n=this.tokens.indexOf(t),r=[...this.tokens],i=t.previous
return e.previous=i,e.next=t.next,this.inheritFromPrevious(e),this.applyTokenDefaults(e),r.splice(n,1,e),void(this.tokens=r)}const n=this.tokens.slice(-1)[0]
n&&(e.previous=n??null,n.next=e,this.inheritFromPrevious(e)),this.applyTokenDefaults(e),this.tokens=[...this.tokens,e]}remove(e){const t=this._findTokenById(e)
if(!t)return
const{next:n,previous:r}=t
n&&(n.previous=r),r&&(r.next=n),t.previous=t.next=null
const i=[...this.tokens]
i.splice(i.indexOf(t),1),this.tokens=i}get visibleTokens(){const e=this.tokens
let t=e?e.length:0
const n=[]
for(;t--;){const r=e[t]
if(r){if(r.replace){n.unshift(r)
break}n.unshift(r)}}return n}get sortedTokens(){const e=this.visibleTokens
if(!e)return[]
let t=!0,n=[]
const r=[n],i=[]
return e.forEach(e=>{e.front?i.unshift(e):e.prepend?(t&&(t=!1,n=[],r.push(n)),n.unshift(e)):(t||(t=!0,n=[],r.push(n)),n.push(e))}),i.concat(r.reduce((e,t)=>e.concat(t),[]))}toString(){const e=this.sortedTokens,t=[]
for(let n=0,r=e.length;n<r;n++){const i=e[n]
i&&i.title&&(t.push(i.title),n+1<r&&t.push(i.separator))}return t.join("")}willDestroy(){super.willDestroy(),this.router.off(m,this.scheduleTitleUpdate)}_updateTitle(){const e=this.toString()
f?this.updateFastbootTitle(e):this.document.title=e,this.titleDidUpdate(e)}_validateExistingTitleElement(){f||(0,h.assert)("[ember-page-title]: Multiple title elements found. Check for other addons like ember-cli-head updating <title> as well.",document.head.querySelectorAll("title").length<=1)}_findTokenById(e){return this.tokens.find(t=>t.id===e)}updateFastbootTitle(e){if(!f)return
const t=this.document.head,n=t.childNodes
for(let o=0;o<n.length;o++){const e=n[o]
e&&"title"===e.nodeName.toLowerCase()&&t.removeChild(e)}const r=this.document.createElement("title"),i=this.document.createTextNode(e)
r.appendChild(i),t.appendChild(r)}titleDidUpdate(e){}},a=(0,l._)(o.prototype,"router",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),s=(0,l._)(o.prototype,"document",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),o)},23325(e,t,n){"use strict"
n.d(t,{T:()=>i,p:()=>r})
const r=1e-6
function i(e,t,n){return Math.abs(e-t)<=n}},23692(e,t,n){"use strict"
n.r(t),n.d(t,{default:()=>i})
var r=n(15670)
function i(...e){return e.every(e=>!(0,r.A)(e))}},23718(e,t,n){"use strict"
var r
n.d(t,{f:()=>r}),function(e){let t
e.create=function(e=512){return{current:[],offset:0,capacity:e,chunks:[]}},e.getString=function(e){return e.chunks.length?(e.offset>0&&(e.chunks[e.chunks.length]=e.current.length===e.offset?e.current.join(""):e.current.slice(0,e.offset).join("")),e.chunks.join("")):e.current.length===e.offset?e.current.join(""):e.current.splice(0,e.offset).join("")},e.getSize=function(e){let t=0
for(const n of e.chunks)t+=n.length
for(let n=0;n<e.offset;n++)t+=e.current[n].length
return t},e.getChunks=function(e){return e.offset>0&&(e.current.length===e.offset?e.chunks[e.chunks.length]=e.current.join(""):e.chunks[e.chunks.length]=e.current.slice(0,e.offset).join(""),e.offset=0),e.chunks},function(e){e[e.Count=512]="Count"}(t||(t={}))
const n=[]
function r(e,t){t>0&&i(e,n[t])}function i(e,t){e.offset===e.capacity&&(e.chunks[e.chunks.length]=e.current.join(""),e.offset=0),e.current[e.offset++]=t}!function(){let e=""
for(let r=0;r<t.Count;r++)n[r]=e,e+=" "}(),e.newline=function(e){i(e,"\n")},e.whitespace=r,e.whitespace1=function(e){i(e," ")},e.write=function(e,t){t&&(e.offset===e.capacity&&(e.chunks[e.chunks.length]=e.current.join(""),e.offset=0),e.current[e.offset++]=t)},e.writeSafe=i,e.writePadLeft=function(e,t,n){t?(r(e,n-t.length),i(e,t)):r(e,n)},e.writePadRight=function(e,t,n){if(!t)return void r(e,n)
const o=n-t.length
i(e,t),r(e,o)},e.writeInteger=function(e,t){i(e,""+t)},e.writeIntegerAndSpace=function(e,t){i(e,t+" ")},e.writeIntegerPadLeft=function(e,t,n){const o=""+t
r(e,n-o.length),i(e,o)},e.writeIntegerPadRight=function(e,t,n){const o=""+t,a=n-o.length
i(e,o),r(e,a)},e.writeFloat=function(e,t,n){i(e,""+Math.round(n*t)/n)},e.writeFloatPadLeft=function(e,t,n,o){const a=""+Math.round(n*t)/n
r(e,o-a.length),i(e,a)},e.writeFloatPadRight=function(e,t,n,o){const a=""+Math.round(n*t)/n,s=o-a.length
i(e,a),r(e,s)}}(r||(r={}))},23729(e,t,n){"use strict"
n.d(t,{o:()=>_,R2:()=>C,Q0:()=>S})
var r=n(9959),i=n(36568),o=n(83164),a=n(19708),s=n(95916),l=n(9043)
const c={...a.DQ,aPosition:(0,a.Yz)("float32",3,0),elements:(0,a.Xs)("uint32"),uBboxMin:(0,a.w5)("v3"),uBboxMax:(0,a.w5)("v3"),uBboxSize:(0,a.w5)("v3"),uMaxSteps:(0,a.w5)("i"),uStepScale:(0,a.w5)("f"),uJumpLength:(0,a.w5)("f"),uTransform:(0,a.w5)("m4"),uGridDim:(0,a.w5)("v3"),tTransferTex:(0,a.$G)("image-uint8","alpha","ubyte","linear"),uTransferScale:(0,a.w5)("f","material"),dGridTexType:(0,a.$F)("string",["2d","3d"]),uGridTexDim:(0,a.w5)("v3"),tGridTex:(0,a.$G)("texture","rgba","ubyte","linear"),uGridStats:(0,a.w5)("v4"),uCellDim:(0,a.w5)("v3"),uCartnToUnit:(0,a.w5)("m4"),uUnitToCartn:(0,a.w5)("m4"),dPackedGroup:(0,a.$F)("boolean"),dAxisOrder:(0,a.$F)("string",["012","021","102","120","201","210"]),dIgnoreLight:(0,a.$F)("boolean"),dCelShaded:(0,a.$F)("boolean"),dXrayShaded:(0,a.$F)("string",["off","on","inverted"]),meta:(0,a.Xb)("unknown")},u={...a.DQ,aGroup:(0,a.Yz)("float32",1,0),aPosition:(0,a.Yz)("float32",3,0),aNormal:(0,a.Yz)("float32",3,0),elements:(0,a.Xs)("uint32"),dVaryingGroup:(0,a.$F)("boolean"),dFlatShaded:(0,a.$F)("boolean"),uDoubleSided:(0,a.w5)("b","material"),dFlipSided:(0,a.$F)("boolean"),dIgnoreLight:(0,a.$F)("boolean"),dCelShaded:(0,a.$F)("boolean"),dXrayShaded:(0,a.$F)("string",["off","on","inverted"]),dTransparentBackfaces:(0,a.$F)("string",["off","on","opaque"]),uBumpFrequency:(0,a.w5)("f","material"),uBumpAmplitude:(0,a.w5)("f","material"),uInteriorColor:(0,a.w5)("v4"),uInteriorSubstance:(0,a.w5)("v4"),meta:(0,a.Xb)("unknown")},d={...a.DQ,...a.Hw,aGroup:(0,a.Yz)("float32",1,0),aPosition:(0,a.Yz)("float32",3,0),dPointSizeAttenuation:(0,a.$F)("boolean"),dPointStyle:(0,a.$F)("string",["square","circle","fuzzy"])},p={...a.DQ,...a.Hw,aGroup:(0,a.Yz)("float32",1,0),aMapping:(0,a.Yz)("float32",2,0),aStart:(0,a.Yz)("float32",3,0),aEnd:(0,a.Yz)("float32",3,0),elements:(0,a.Xs)("uint32"),dLineSizeAttenuation:(0,a.$F)("boolean"),uDoubleSided:(0,a.w5)("b","material"),dFlipSided:(0,a.$F)("boolean")},h={...a.DQ,...a.Hw,uTexDim:(0,a.w5)("v2"),tPositionGroup:(0,a.$G)("image-float32","rgba","float","nearest"),padding:(0,a.Xb)("number"),uDoubleSided:(0,a.w5)("b","material"),dIgnoreLight:(0,a.$F)("boolean"),dCelShaded:(0,a.$F)("boolean"),dXrayShaded:(0,a.$F)("string",["off","on","inverted"]),dTransparentBackfaces:(0,a.$F)("string",["off","on","opaque"]),dSolidInterior:(0,a.$F)("boolean"),dClipPrimitive:(0,a.$F)("boolean"),dApproximate:(0,a.$F)("boolean"),uAlphaThickness:(0,a.w5)("f"),uBumpFrequency:(0,a.w5)("f","material"),uBumpAmplitude:(0,a.w5)("f","material"),uInteriorColor:(0,a.w5)("v4"),uInteriorSubstance:(0,a.w5)("v4"),lodLevels:(0,a.Xb)("unknown"),centerBuffer:(0,a.Xb)("float32"),groupBuffer:(0,a.Xb)("float32")},f={...a.DQ,...a.Hw,aGroup:(0,a.Yz)("float32",1,0),aPosition:(0,a.Yz)("float32",3,0),aMapping:(0,a.Yz)("float32",2,0),aDepth:(0,a.Yz)("float32",1,0),elements:(0,a.Xs)("uint32"),aTexCoord:(0,a.Yz)("float32",2,0),tFont:(0,a.$G)("image-uint8","alpha","ubyte","linear"),padding:(0,a.Xb)("number"),uBorderWidth:(0,a.w5)("f","material"),uBorderColor:(0,a.w5)("v3","material"),uOffsetX:(0,a.w5)("f","material"),uOffsetY:(0,a.w5)("f","material"),uOffsetZ:(0,a.w5)("f","material"),uBackgroundColor:(0,a.w5)("v3","material"),uBackgroundOpacity:(0,a.w5)("f","material")},m={...a.DQ,uGeoTexDim:(0,a.w5)("v2","buffered"),tPosition:(0,a.$G)("texture","rgb","float","nearest"),tGroup:(0,a.$G)("texture","alpha","float","nearest"),tNormal:(0,a.$G)("texture","rgb","float","nearest"),dVaryingGroup:(0,a.$F)("boolean"),dFlatShaded:(0,a.$F)("boolean"),uDoubleSided:(0,a.w5)("b","material"),dFlipSided:(0,a.$F)("boolean"),dIgnoreLight:(0,a.$F)("boolean"),dCelShaded:(0,a.$F)("boolean"),dXrayShaded:(0,a.$F)("string",["off","on","inverted"]),dTransparentBackfaces:(0,a.$F)("string",["off","on","opaque"]),uBumpFrequency:(0,a.w5)("f","material"),uBumpAmplitude:(0,a.w5)("f","material"),uInteriorColor:(0,a.w5)("v4"),uInteriorSubstance:(0,a.w5)("v4"),meta:(0,a.Xb)("unknown")}
var g=n(80813)
const y={...a.DQ,aGroup:(0,a.Yz)("float32",1,0),aPosition:(0,a.Yz)("float32",3,0),aUv:(0,a.Yz)("float32",2,0),elements:(0,a.Xs)("uint32"),uImageTexDim:(0,a.w5)("v2"),tImageTex:(0,a.$G)("image-uint8","rgba","ubyte","nearest"),tGroupTex:(0,a.$G)("image-uint8","rgba","ubyte","nearest"),tValueTex:(0,a.$G)("image-float32","alpha","float","linear"),uTrimType:(0,a.w5)("i"),uTrimCenter:(0,a.w5)("v3"),uTrimRotation:(0,a.w5)("q"),uTrimScale:(0,a.w5)("v3"),uTrimTransform:(0,a.w5)("m4"),uIsoLevel:(0,a.w5)("f"),dInterpolation:(0,a.$F)("string",["nearest","catmulrom","mitchell","bspline"])},v={...a.DQ,...a.Hw,aGroup:(0,a.Yz)("float32",1,0),aStart:(0,a.Yz)("float32",3,0),aEnd:(0,a.Yz)("float32",3,0),aMapping:(0,a.Yz)("float32",3,0),aScale:(0,a.Yz)("float32",1,0),aCap:(0,a.Yz)("float32",1,0),aColorMode:(0,a.Yz)("float32",1,0),elements:(0,a.Xs)("uint32"),padding:(0,a.Xb)("number"),uDoubleSided:(0,a.w5)("b","material"),dIgnoreLight:(0,a.$F)("boolean"),dCelShaded:(0,a.$F)("boolean"),dXrayShaded:(0,a.$F)("string",["off","on","inverted"]),dTransparentBackfaces:(0,a.$F)("string",["off","on","opaque"]),dSolidInterior:(0,a.$F)("boolean"),uBumpFrequency:(0,a.w5)("f","material"),uBumpAmplitude:(0,a.w5)("f","material"),uInteriorColor:(0,a.w5)("v4"),uInteriorSubstance:(0,a.w5)("v4"),dDualColor:(0,a.$F)("boolean")}
var b=n(91229)
const x=(0,r.q)(0,2147483647),S=(0,r.q)(0,2147483647)
function _(e,t,n,r){return{id:x(),type:e,values:t,state:n,materialId:r}}function C(e,t,n,r){switch(t.type){case"mesh":return function(e,t,n,r,c,d,p){const h={...a.X9,...a.YU,...a.Y2,...a.rG,...u},f={...n,uObjectId:l.IQ.create(t),dLightCount:l.IQ.create(p.dLightCount),dColorMarker:l.IQ.create(p.dColorMarker)},m=s.uO,g=(0,o.vC)(e,"triangles",m,h,f,c,d)
return(0,i.R)(g,f,r)}(e,t.id,t.values,t.state,t.materialId,n,r)
case"points":return function(e,t,n,r,c,u,p){const h={...a.X9,...a.YU,...a.Y2,...a.rG,...d},f={...n,uObjectId:l.IQ.create(t),dLightCount:l.IQ.create(p.dLightCount),dColorMarker:l.IQ.create(p.dColorMarker)},m=s.g2,g=(0,o.vC)(e,"points",m,h,f,c,u)
return(0,i.R)(g,f,r)}(e,t.id,t.values,t.state,t.materialId,n,r)
case"spheres":return function(e,t,n,r,c,u,d){const p={...a.X9,...a.YU,...a.Y2,...a.rG,...h},f={...n,uObjectId:l.IQ.create(t),dLightCount:l.IQ.create(d.dLightCount),dColorMarker:l.IQ.create(d.dColorMarker)},m=s.n5,g=(0,o.vC)(e,"triangles",m,p,f,c,u)
return(0,i.R)(g,f,r)}(e,t.id,t.values,t.state,t.materialId,n,r)
case"cylinders":return function(e,t,n,r,c,u,d){const p={...a.X9,...a.YU,...a.Y2,...a.rG,...v},h={...n,uObjectId:l.IQ.create(t),dLightCount:l.IQ.create(d.dLightCount),dColorMarker:l.IQ.create(d.dColorMarker)},f=s.UT,m=(0,o.vC)(e,"triangles",f,p,h,c,u)
return(0,i.R)(m,h,r)}(e,t.id,t.values,t.state,t.materialId,n,r)
case"text":return function(e,t,n,r,c,u,d){const p={...a.X9,...a.YU,...a.Y2,...a.rG,...f},h={...n,uObjectId:l.IQ.create(t),dLightCount:l.IQ.create(d.dLightCount),dColorMarker:l.IQ.create(d.dColorMarker)},m=s.G7,g=(0,o.vC)(e,"triangles",m,p,h,c,u)
return(0,i.R)(g,h,r)}(e,t.id,t.values,t.state,t.materialId,n,r)
case"lines":return function(e,t,n,r,c,u,d){const h={...a.X9,...a.YU,...a.Y2,...a.rG,...p},f={...n,uObjectId:l.IQ.create(t),dLightCount:l.IQ.create(d.dLightCount),dColorMarker:l.IQ.create(d.dColorMarker)},m=s.wv,g=(0,o.vC)(e,"triangles",m,h,f,c,u)
return(0,i.R)(g,f,r)}(e,t.id,t.values,t.state,t.materialId,n,r)
case"direct-volume":return function(e,t,n,r,u,d,p){const h={...a.X9,...a.YU,...a.Y2,...a.rG,...c}
e.isWebGL2||(h.uMaxSteps=(0,a.$F)("number"))
const f={...n,uObjectId:l.IQ.create(t),dLightCount:l.IQ.create(p.dLightCount),dColorMarker:l.IQ.create(p.dColorMarker)},m=s.m5,g=(0,o.vC)(e,"triangles",m,h,f,u,d)
return(0,i.R)(g,f,r)}(e,t.id,t.values,t.state,t.materialId,n,r)
case"image":return function(e,t,n,r,l,c,u){const d={...a.X9,...a.YU,...a.Y2,...a.rG,...y},p={...n,uObjectId:g.IQ.create(t),dLightCount:g.IQ.create(u.dLightCount),dColorMarker:g.IQ.create(u.dColorMarker)},h=s.u3,f=(0,o.vC)(e,"triangles",h,d,p,l,c)
return(0,i.R)(f,p,r)}(e,t.id,t.values,t.state,t.materialId,n,r)
case"texture-mesh":return function(e,t,n,r,c,u,d){const p={...a.X9,...a.YU,...a.Y2,...a.rG,...m},h={...n,uObjectId:l.IQ.create(t),dLightCount:l.IQ.create(d.dLightCount),dColorMarker:l.IQ.create(d.dColorMarker)},f=s.uO,g=(0,o.vC)(e,"triangles",f,p,h,c,u)
return(0,i.R)(g,h,r)}(e,t.id,t.values,t.state,t.materialId,n,r)}(0,b.dr)(t.type)}},23782(e,t,n){"use strict"
n.d(t,{T:()=>r})
var r,i=n(92726),o=n(33205),a=n(24762),s=n(28721),l=n(717),c=n(28901)
!function(e){const t="molstar_global_model_transform_info"
function n(t){return e.Provider.get(t)}e.Schema={[t]:{matrix:a.VP.Schema.Matrix(4,4,a.VP.Schema.float)}},e.Descriptor=(0,o.e)({name:t,cifExport:{categories:[{name:t,instance(t){const r=n(t.firstModel)
if(!r)return s.c.Category.Empty
const i=a.XI.ofRows(e.Schema.molstar_global_model_transform_info,[{matrix:r}])
return s.c.Category.ofTable(i)}}],prefix:"molstar"}}),e.Provider=i.q.create(e.Descriptor),e.attach=function(t,n){t.customProperties.has(e.Descriptor)||t.customProperties.add(e.Descriptor),e.Provider.set(t,n)},e.get=n,e.fromMmCif=function(n){if(!l.K4.is(n.sourceData))return
const r=n.sourceData.data.frame.categories[t]
if(!r)return
const i=(0,c.MR)(e.Schema[t],r)
return 0!==i._rowCount?i.matrix.value(0):void 0},e.hasData=function(e){if(!l.K4.is(e.sourceData))return!1
const n=e.sourceData.data.frame.categories[t]
return!!n&&n.rowCount>0},e.writeMmCif=function(n,r){n.writeCategory({name:t,instance(){const t=a.XI.ofRows(e.Schema.molstar_global_model_transform_info,[{matrix:r}])
return s.c.Category.ofTable(t)}})}}(r||(r={}))},23968(e,t,n){"use strict"
n.d(t,{X:()=>ce})
var r=n(24762),i=n(22750),o=n(93104),a=n(33205),s=n(67538),l=n(28901),c=n(14294),u=n(32775),d=n(48905),p=n(87933),h=n(87095),f=n(13686),m=n(5638),g=n(45477),y=n(70012)
function v(e,t){return t?1===t.length?(0,y.m1)(t.charCodeAt(0),e):2===t.length?(0,y.m1)(t.charCodeAt(0),(0,y.m1)(t.charCodeAt(1),e)):`${e} ${t}`:e}function b(e,t,n,r){if(e.has(t)){const i=e.get(t)
i.has(n)||i.set(n,r)}else{const i=new Map
e.set(t,i),i.set(n,r)}}function x(e){throw new Error(`Missing entity entry for entity id '${e}'.`)}const S=g.or.EmptyResidueKey()
class _{getEntityFromChain(e){return this.map.chain_index_entity_index[e]}findEntity(e){const t=this.map.label_asym_id.get(e)
return void 0!==t?t:-1}findChainLabel(e){const t=this.entityIndex(e.label_entity_id)
if(t<0||!this.map.entity_index_label_asym_id.has(t))return-1
const n=this.map.entity_index_label_asym_id.get(t)
return n&&n.has(e.label_asym_id)?n.get(e.label_asym_id):-1}findChainAuth(e){if(!this.map.auth_asym_id_auth_seq_id.has(e.auth_asym_id))return-1
const t=this.map.auth_asym_id_auth_seq_id.get(e.auth_asym_id)
return t.has(e.auth_seq_id)?t.get(e.auth_seq_id):-1}findResidue(e,t,n,r){let i
1===arguments.length?i=e:(S.label_entity_id=e,S.label_asym_id=t,S.auth_seq_id=n,S.pdbx_PDB_ins_code=r,i=S)
const o=this.findChainLabel(i)
if(o<0)return-1
const a=this.map.chain_index_auth_seq_id.get(o),s=v(i.auth_seq_id,i.pdbx_PDB_ins_code||"")
return a.has(s)?a.get(s):-1}findResidueLabel(e){const t=this.findChainLabel(e)
if(t<0)return-1
const n=this.map.chain_index_label_seq_id.get(t),r=v(e.label_seq_id,e.pdbx_PDB_ins_code||"")
return n.has(r)?n.get(r):-1}findResidueAuth(e){const t=this.findChainAuth(e)
if(t<0)return-1
const n=this.map.chain_index_auth_seq_id.get(t),r=v(e.auth_seq_id,e.pdbx_PDB_ins_code||"")
return n.has(r)?n.get(r):-1}findResidueInsertion(e){const t=this.findChainLabel(e)
if(t<0)return-1
const n=this.map.chain_index_label_seq_id.get(t),r=v(e.label_seq_id,e.pdbx_PDB_ins_code||"")
if(n.has(r))return n.get(r)
const i=s.X9.findPredecessorIndex(this.map.label_seq_id,e.label_seq_id),o=g.vE.chainStartResidueIndex(this.map.segments,t)
if(i<o)return o
const a=g.vE.chainEndResidueIndexExcl(this.map.segments,t)-1
return i>=a?a:i}findAtom(e){const t=this.findResidue(e)
return t<0?-1:void 0===e.label_alt_id?C(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,e.label_atom_id):w(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,this.map.label_alt_id,e.label_atom_id,e.label_alt_id)}findAtomAuth(e){const t=this.findResidueAuth(e)
return t<0?-1:void 0===e.label_alt_id?C(this.residueOffsets[t],this.residueOffsets[t+1],this.map.auth_atom_id,e.auth_atom_id):w(this.residueOffsets[t],this.residueOffsets[t+1],this.map.auth_atom_id,this.map.label_alt_id,e.auth_atom_id,e.label_alt_id)}findAtomOnResidue(e,t,n){return void 0===n?C(this.residueOffsets[e],this.residueOffsets[e+1],this.map.label_atom_id,t):w(this.residueOffsets[e],this.residueOffsets[e+1],this.map.label_atom_id,this.map.label_alt_id,t,n)}findAtomsOnResidue(e,t){return function(e,t,n,r){for(let i=e;i<t;i++)if(r.has(n.value(i)))return i
return-1}(this.residueOffsets[e],this.residueOffsets[e+1],this.map.label_atom_id,t)}findElementOnResidue(e,t){return function(e,t,n,r){for(let i=e;i<t;i++)if(n.value(i)===r)return i
return-1}(this.residueOffsets[e],this.residueOffsets[e+1],this.map.type_symbol,t)}constructor(e){this.map=e,this.entityIndex=e.entities.getEntityIndex,this.residueOffsets=this.map.segments.residueAtomSegments.offsets}}function C(e,t,n,r){for(let i=e;i<t;i++)if(n.value(i)===r)return i
return-1}function w(e,t,n,r,i,o){for(let a=e;a<t;a++)if(n.value(a)===i&&r.value(a)===o)return a
return-1}var T=n(63356),A=n(717)
function I(e,t,n,i,o,a){const g=function(e){if(0===e._rowCount)return{residues:[],chains:[]}
const t=e._rowCount,n=[0],r=[0],{label_entity_id:i,label_asym_id:o,label_seq_id:a,auth_seq_id:s,pdbx_PDB_ins_code:l}=e
for(let c=1;c<t;c++){const e=!i.areValuesEqual(c-1,c)||!o.areValuesEqual(c-1,c);(e||!a.areValuesEqual(c-1,c)||!s.areValuesEqual(c-1,c)||!l.areValuesEqual(c-1,c))&&(n[n.length]=c),e&&(r[r.length]=c)}return{residues:n,chains:r}}(e),y=function(e,t,n){const i=r.XI.ofColumns(p.wi,{type_symbol:r.VP.ofArray({array:r.VP.mapToArray(e.type_symbol,h.ElementSymbol),schema:r.VP.Schema.Aliased(r.VP.Schema.str)}),label_atom_id:e.label_atom_id,auth_atom_id:e.auth_atom_id,label_alt_id:e.label_alt_id,label_comp_id:e.label_comp_id,auth_comp_id:e.auth_comp_id,pdbx_formal_charge:e.pdbx_formal_charge}),o=r.XI.view(e,p.yA,n.residues),a=r.XI.view(e,p.c1,n.chains)
if(!o.label_seq_id.isDefined){const e=new Int32Array(o.label_seq_id.rowCount),{residues:t,chains:i}=n
let a=0,s=0
for(let n=0,r=e.length;n<r;++n)t[n]>=i[a+1]&&(a+=1,s=0),e[n]=++s
o.label_seq_id=r.VP.ofIntArray(e)}return r.XI.columnToArray(o,"label_seq_id",Int32Array),r.XI.columnToArray(o,"auth_seq_id",Int32Array),{atoms:i,residues:o,chains:a,atomSourceIndex:t,residueSourceIndex:function(e,t,n){const i=new Uint32Array(t)
for(let r=0;r<t;r++){const o=n[r],a=r+1<t?n[r+1]:e.rowCount
let s=e.value(o)
for(let t=o+1;t<a;t++){const n=e.value(t)
n<s&&(s=n)}i[r]=s}const o=(0,T.y1)(t).sort((e,t)=>i[e]-i[t])
for(let r=0;r<t;r++)i[o[r]]=r
return r.VP.ofIntArray(i)}(t,n.residues.length,n.residues)}}(e,t,g),S=function(e,t){const n=new Map
if(!A.K4.is(t))return n
const{molstar_atom_site_operator_mapping:i}=(0,l.Pd)(d.mQ,t.data.frame)
if(0===i._rowCount)return n
const o=new Map,a=new Map
for(let l=0;l<i._rowCount;l++){const e=i.assembly_operator_id.valueKind(l)===r.VP.ValueKinds.Present?{id:i.assembly_id.value(l),operList:[],operId:i.assembly_operator_id.value(l)}:void 0,t=c.JX.create(i.operator_name.value(l),u.$I.identity(),{assembly:e,spgrOp:i.symmetry_operator_index.valueKind(l)===r.VP.ValueKinds.Present?i.symmetry_operator_index.value(l):void 0,hkl:u.eB.ofArray(i.symmetry_hkl.value(l)),ncsId:i.ncs_id.value(l)}),n=i.suffix.value(l),s=i.label_asym_id.value(l)
o.set(`${s}${n}`,{name:s,operator:t})
const d=i.auth_asym_id.value(l)
a.set(`${d}${n}`,d)}const{label_asym_id:s,auth_asym_id:p}=e.chains,h=new Array(s.rowCount),f=new Array(s.rowCount)
for(let r=0;r<s.rowCount;r++){const e=s.value(r),t=p.value(r)
if(!o.has(e)){h[r]=e,f[r]=t
continue}const{name:i,operator:l}=o.get(e)
n.set(r,l),h[r]=i,f[r]=a.get(t)||t}return e.chains.label_asym_id=r.VP.ofArray({array:h,valueKind:e.chains.label_asym_id.valueKind,schema:e.chains.label_asym_id.schema}),e.chains.auth_asym_id=r.VP.ofArray({array:f,valueKind:e.chains.auth_asym_id.valueKind,schema:e.chains.auth_asym_id.schema}),n}(y,o)
if(a&&(C=a.atomicHierarchy,w=y,r.XI.areEqual(C.chains,w.chains)&&r.XI.areEqual(C.residues,w.residues)&&r.XI.areEqual(C.atoms,w.atoms)))return{sameAsPrevious:!0,hierarchy:a.atomicHierarchy,chainOperatorMapping:S}
var C,w
const I={residueAtomSegments:s.hT.ofOffsets(g.residues,s.IX.ofBounds(0,e._rowCount)),chainAtomSegments:s.hT.ofOffsets(g.chains,s.IX.ofBounds(0,e._rowCount))},P=function(e,t,n){const r=function(e,t,n){return{entities:e,segments:n,label_seq_id:s.X9.ofSortedArray(t.residues.label_seq_id.toArray({array:Int32Array})),label_atom_id:t.atoms.label_atom_id,auth_atom_id:t.atoms.auth_atom_id,label_alt_id:t.atoms.label_alt_id,type_symbol:t.atoms.type_symbol,chain_index_entity_index:new Int32Array(t.chains._rowCount),entity_index_label_asym_id:new Map,chain_index_label_seq_id:new Map,auth_asym_id_auth_seq_id:new Map,chain_index_auth_seq_id:new Map,label_asym_id:new Map}}(t,e,n),{label_seq_id:i,auth_seq_id:o,pdbx_PDB_ins_code:a}=e.residues,{label_entity_id:l,label_asym_id:c,auth_asym_id:u}=e.chains,d=s.IX.ofBounds(0,e.atoms._rowCount),p=s.hT.transientSegments(n.chainAtomSegments,d)
for(;p.hasNext;){const e=p.move(),h=e.index,f=t.getEntityIndex(l.value(h))
f<0&&x(l.value(h)),r.chain_index_entity_index[h]=f
const m=u.value(h)
let g=r.auth_asym_id_auth_seq_id.get(m)
g||(g=new Map,r.auth_asym_id_auth_seq_id.set(m,g))
const y=c.value(h)
r.label_asym_id.has(y)||r.label_asym_id.set(y,f),b(r.entity_index_label_asym_id,f,y,h)
const S=new Map,_=new Map
r.chain_index_label_seq_id.set(h,S),r.chain_index_auth_seq_id.set(h,_)
const C=s.hT.transientSegments(n.residueAtomSegments,d,e)
for(;C.hasNext;){const e=C.move().index,t=o.value(e),n=a.value(e)
S.set(v(i.value(e),n),e),_.set(v(t,n),e),g.set(t,h)}}return new _(r)}(y,n,I),B=function(e,t,n,r){const{label_comp_id:i,type_symbol:o,_rowCount:a}=e.atoms,{_rowCount:s}=e.residues,{offsets:l}=t.residueAtomSegments,c=new Uint8Array(a)
for(let h=0;h<a;++h)c[h]=(0,p.PR)(o.value(h))
const u=new Int32Array(s),d=new Int32Array(s),g=new Int32Array(s),y=new Uint8Array(s),v=new Uint8Array(s),b=new Map,x=new Map
for(let p=0;p<s;++p){const e=i.value(l[p]),t=r
let o,a
if(b.has(e))o=b.get(e),a=x.get(e)
else{let n
t.has(e)?n=t.get(e).type:(m.Zq||console.info("chemComp not found",e),n=(0,h.getComponentType)(e)),o=(0,h.getMoleculeType)(n,e),a=(0,h.getPolymerType)(n,o),b.set(e,o),x.set(e,a)}y[p]=o,v[p]=a
const s=(0,f.HQ)(a,"trace")
let c=n.findAtomsOnResidue(p,s)
if(-1===c){const e=(0,f.HQ)(a,"coarseBackbone")
c=n.findAtomsOnResidue(p,e),-1===c&&(0,h.isPolymer)(o)&&(c=n.findElementOnResidue(p,(0,h.ElementSymbol)("C")))}u[p]=c
const S=(0,f.HQ)(a,"directionFrom")
d[p]=n.findAtomsOnResidue(p,S)
const _=(0,f.HQ)(a,"directionTo")
g[p]=n.findAtomsOnResidue(p,_)}return{atom:{atomicNumber:c},residue:{traceElementIndex:u,directionFromElementIndex:d,directionToElementIndex:g,moleculeType:y,polymerType:v}}}(y,I,P,i)
return{sameAsPrevious:!1,hierarchy:{...y,...I,index:P,derived:B},chainOperatorMapping:S}}function P(e,t,n,o,a,s){const{sameAsPrevious:l,hierarchy:c,chainOperatorMapping:u}=I(e,t,n,o,a,s),d=function(e){return{id:i.k.create22(),atomId:e.id,occupancy:e.occupancy.isDefined?e.occupancy:r.VP.ofConst(1,e._rowCount,r.VP.Schema.float),B_iso_or_equiv:e.B_iso_or_equiv,xyzDefined:e.Cartn_x.isDefined&&e.Cartn_y.isDefined&&e.Cartn_z.isDefined,x:e.Cartn_x.toArray({array:Float32Array}),y:e.Cartn_y.toArray({array:Float32Array}),z:e.Cartn_z.toArray({array:Float32Array})}}(e)
return{sameAsPrevious:l,hierarchy:c,conformation:d,chainOperatorMapping:u}}var B=n(10773)
function E(e){return new D(e)}const k=new class{findElement(e,t){return t.kind=void 0,t.index=-1,!1}findSphereElement(e){return-1}findGaussianElement(e){return-1}}
class D{get sphereMapping(){return this._sphereMapping||(this._sphereMapping=M(this.data.spheres)),this._sphereMapping}get gaussianMapping(){return this._gaussianMapping||(this._gaussianMapping=M(this.data.gaussians)),this._gaussianMapping}findSphereElement(e){var t
let n=this.sphereMapping[e.label_entity_id]
return n?(n=n[e.label_asym_id],n&&null!==(t=n[e.label_seq_id])&&void 0!==t?t:-1):-1}findGaussianElement(e){var t
let n=this.gaussianMapping[e.label_entity_id]
return n?(n=n[e.label_asym_id],n&&null!==(t=n[e.label_seq_id])&&void 0!==t?t:-1):-1}findElement(e,t){const n=this.findSphereElement(e)
if(n>=0)return t.kind="spheres",t.index=n,!0
const r=this.findGaussianElement(e)
return r>=0&&(t.kind="gaussians",t.index=r,!0)}constructor(e){this.data=e,this._sphereMapping=void 0,this._gaussianMapping=void 0}}function M({count:e,entity_id:t,asym_id:n,seq_id_begin:r,seq_id_end:i}){const o={}
for(let a=0;a<e;a++){const e=t.value(a),s=n.value(a)
o[e]||(o[e]={}),o[e][s]||(o[e][s]={})
const l=o[e][s],c=r.value(a),u=i.value(a)
for(let t=c;t<=u;t++)l[t]=a}return o}const R={chainKey:[],entityKey:[],findSequenceKey:()=>-1,findChainKey:()=>-1,getEntityFromChain:()=>-1,count:0,entity_id:r.VP.Undefined(0,r.VP.Schema.str),asym_id:r.VP.Undefined(0,r.VP.Schema.str),seq_id_begin:r.VP.Undefined(0,r.VP.Schema.int),seq_id_end:r.VP.Undefined(0,r.VP.Schema.int),chainElementSegments:s.hT.create([]),polymerRanges:B.m.ofSortedRanges([]),gapRanges:B.m.ofSortedRanges([])}
var O
function L(e,t,n){if(e.has(t))return e.get(t)
const r=n.index++
return e.set(t,r),r}function N(e,t){if(e.has(t))return e.get(t)
const n=new Map
return e.set(t,n),n}function F(e){throw new Error(`Missing entity entry for entity id '${e}'.`)}function z(e,t){const{entity_id:n,asym_id:r,seq_id_begin:i,seq_id_end:o,count:a,chainElementSegments:l}=e,c=new Map,u=new Map,d={index:0},p=new Int32Array(a),h=new Int32Array(a),f=new Int32Array(l.count)
for(let s=0;s<a;s++)h[s]=t.getEntityIndex(n.value(s)),h[s]<0&&F(n.value(s))
for(let s=0;s<l.count;s++){const e=l.offsets[s],t=l.offsets[s+1],n=h[e]
f[s]=n
const a=L(N(u,n),r.value(e),d)
for(let r=e;r<t;r++)p[r]=a
const m=[],g=[]
for(let r=e;r<t;r++){const e=i.value(r),t=o.value(r)
m.push(r),g.push(e,t)}const y={elementIndices:m,seqRanges:B.m.ofSortedRanges(g)}
c.set(a,y)}const{findChainKey:m,findSequenceKey:g}=function(e,t,n){const r=e.getEntityIndex
return{findChainKey:(e,n)=>{const i=r(e)
if(i<0)return-1
const o=t.get(i)
return o.has(n)?o.get(n):-1},findSequenceKey:(e,i,o)=>{const a=r(e)
if(a<0)return-1
const l=t.get(a)
if(void 0===l)return-1
const c=l.get(i)
if(void 0===c)return-1
const u=n.get(c),{elementIndices:d,seqRanges:p}=u,h=B.m.firstIntersectionIndex(p,s.CD.ofSingleton(o))
return-1!==h?d[h]:-1}}}(t,u,c)
return{chainKey:p,entityKey:h,findSequenceKey:g,findChainKey:m,getEntityFromChain:e=>f[e]}}!function(e){e.Empty={isDefined:!1,spheres:R,gaussians:R,index:k}}(O||(O={}))
var j=n(9043)
function V(e,t){const n=[],r=[],i=s.hT.transientSegments(e.chainElementSegments,s.IX.ofBounds(0,e.count)),{seq_id_begin:o,seq_id_end:a}=e
for(;i.hasNext;){const{start:e,end:t}=i.move()
let s=-1,l=-1
for(let i=e;i<t;++i){const c=a.value(i)
i===e?(s=i,l=a.value(i)):o.value(i)-l>1&&(n.push(s,i-1),r.push(i-1,i),s=i),i===t-1&&n.push(s,i),l=c}}return{polymerRanges:B.m.ofSortedRanges(n),gapRanges:B.m.ofSortedRanges(r)}}var U=n(29472)
const G={hierarchy:O.Empty,conformation:void 0}
function H(e,t,n){const r=[0]
for(let i=1,o=e.rowCount;i<o;i++)!e.areValuesEqual(i-1,i)&&(r[r.length]=i)
return{chainElementSegments:s.hT.ofOffsets(r,s.IX.ofBounds(0,e.rowCount))}}function q(e){const{entity_id:t,seq_id_begin:n,seq_id_end:r,asym_id:i}=e
return{count:t.rowCount,entity_id:t,asym_id:i,seq_id_begin:n,seq_id_end:r,...H(i)}}var Q=n(51473),$=n(75386)
function X(e,t,n,i){if(!e.entity_poly_seq||!e.entity_poly_seq._rowCount)return Q.V.fromHierarchy(t,n,i)
const{entity_id:o,num:a,mon_id:s}=e.entity_poly_seq,l={},c=[],u=o.rowCount
let d=0
for(;d<u;){const e=d
for(;d<u-1&&o.areValuesEqual(d,d+1);)d++
d++
const n=o.value(e),i=r.VP.window(s,e,d),p=r.VP.window(a,e,d),h=t.getEntityIndex(n)
l[h]={entityId:n,sequence:$.g.ofResidueNames(i,p)},c.push(l[h])}return{byEntityKey:l,sequences:c}}async function W(e,t,n,i){const o=(0,y.vc)(n,i-1),{label_entity_id:a,label_asym_id:s,label_seq_id:l}=t,c=(0,y.h3)(o,a.value)
e.shouldUpdate&&await e.update()
for(let u=0,d=c.length-1;u<d;u++){const t=(0,y.h3)(o,s.value,{start:c[u],end:c[u+1]})
for(let n=0,i=t.length-1;n<i;n++){const i=t[n]
l.valueKind(i)===r.VP.ValueKinds.Present&&((0,y.h3)(o,l.value,{sort:!0,start:i,end:t[n+1]}),e.shouldUpdate&&await e.update())}e.shouldUpdate&&await e.update()}return(0,T.qW)(o)&&o.length===t._rowCount?{atom_site:t,sourceIndex:r.VP.ofIntArray(o)}:{atom_site:r.XI.view(t,t._schema,o),sourceIndex:r.VP.ofIntArray(o)}}function Y(e,t,n,r,i){const{polymerType:o,traceElementIndex:a,directionFromElementIndex:s,directionToElementIndex:l}=i.residue,c=o[e],d=o[t]
if(c===h.PolymerType.NA||d===h.PolymerType.NA)return!1
if(-1===a[e]||-1===a[t])return!1
let p=r.findAtomsOnResidue(e,(0,f.HQ)(c,"backboneStart")),m=r.findAtomsOnResidue(t,(0,f.HQ)(d,"backboneEnd"));-1!==p&&-1!==m||(p=r.findAtomsOnResidue(e,(0,f.HQ)(c,"coarseBackbone")),m=r.findAtomsOnResidue(t,(0,f.HQ)(d,"coarseBackbone")))
const{x:g,y:y,z:v}=n,b=u.eB.create(g[p],y[p],v[p]),x=u.eB.create(g[m],y[m],v[m]),S=-1===s[e]||-1===l[e]||-1===s[t]||-1===l[t]
return u.eB.distance(b,x)<(S?10:3)}function Z(e,t,n,r){const i=[],o=[],a=new Map,l=s.hT.transientSegments(e.chainAtomSegments,s.IX.ofBounds(0,e.atoms._rowCount)),c=s.hT.transientSegments(e.residueAtomSegments,s.IX.ofBounds(0,e.atoms._rowCount)),{index:u,derived:d}=e,{label_seq_id:p}=e.residues,{label_entity_id:f}=e.chains,{moleculeType:m,traceElementIndex:g}=d.residue
let y,v,b,x
for(;l.hasNext;){const s=l.move()
c.setSegment(s),y=-1,v=-1,b=-1,x=-1
const S=t.getEntityIndex(f.value(s.index)),_=r.byEntityKey[S],C=_?_.sequence.seqId.value(_.sequence.seqId.rowCount-1):-1,w=e.residueAtomSegments.index[s.start],T=e.residueAtomSegments.index[s.end-1],A=p.value(w),I=p.value(T)
for(1===A&&I===C&&n.xyzDefined&&Y(w,T,n,u,d)&&(a.set(w,T),a.set(T,w));c.hasNext;){const t=c.move(),r=t.index,a=p.value(r)
if((0,h.isPolymer)(m[r])&&-1!==g[r])if(-1!==x)if(a!==y+1)i.push(x,b-1),o.push(v,t.end-1),x=t.start
else if(c.hasNext){const r=e.residueAtomSegments.index[t.start],a=e.residueAtomSegments.index[b-1]
n.xyzDefined&&!Y(r,a,n,e.index,d)&&(i.push(x,b-1),o.push(v,t.end-1),x=t.start)}else i.push(x,t.end-1)
else x=t.start
else-1!==x&&(i.push(x,b-1),x=-1)
v=t.start,b=t.end,y=a}}return{polymerRanges:B.m.ofSortedRanges(i),gapRanges:B.m.ofSortedRanges(o),cyclicPolymerMap:a}}var K=n(11350)
function J(e){const t=new Map,n=(e,t,n)=>`${e}|${t}|${n}`,r=e.pdbx_unobs_or_zero_occ_residues
for(let i=0,o=r._rowCount;i<o;++i){const e=n(r.PDB_model_num.value(i),r.label_asym_id.value(i),r.label_seq_id.value(i))
t.set(e,{polymer_flag:r.polymer_flag.value(i),occupancy_flag:r.occupancy_flag.value(i)})}return{has:(e,r,i)=>t.has(n(e,r,i)),get:(e,r,i)=>t.get(n(e,r,i)),size:t.size}}function ee(e){const t=new Map
if(e.chem_comp._rowCount>0){const{id:n}=e.chem_comp
for(let i=0,o=n.rowCount;i<o;++i)t.set(n.value(i),r.XI.getRow(e.chem_comp,i))}else ne(e).forEach(e=>{t.set(e,(0,h.getDefaultChemicalComponent)(e))})
return t}function te(e){const t=new Map
if(e.pdbx_chem_comp_identifier._rowCount>0){const{comp_id:n,type:r,identifier:i}=e.pdbx_chem_comp_identifier
for(let e=0,o=n.rowCount;e<o;++e)if("SNFG CARBOHYDRATE SYMBOL"===r.value(e)||"SNFG CARB SYMBOL"===r.value(e)){const r=i.value(e),o=K.Dr.get(r)
o?t.set(n.value(e),o):console.warn(`Unknown SNFG name '${r}'`)}}if(e.chem_comp._rowCount>0){const{id:n,type:r}=e.chem_comp
for(let e=0,i=n.rowCount;e<i;++e){const i=n.value(e)
if(t.has(i))continue
const o=r.value(e)
K.yt.has(i)?t.set(i,K.yt.get(i)):(0,h.getMoleculeType)(o,i)===h.MoleculeType.Saccharide&&t.set(i,K.xY)}}else{const n=ne(e)
K.yt.forEach((e,r)=>{!t.has(r)&&n.has(r)&&t.set(r,e)})}return t}const ne=(0,n(28269).E)(e=>{const t=new Set,{label_comp_id:n,auth_comp_id:r}=e.atom_site,i=n.isDefined?n:r
for(let o=0,a=i.rowCount;o<a;++o)t.add(i.value(o))
return t})
function re(e,t){const n=new Map,{auth_asym_id:r,label_asym_id:i,label_entity_id:o}=e.chains
for(let a=0,s=e.chains._rowCount;a<s;a++){const e=i.value(a)
n.set(e,{id:e,auth_id:r.value(a),entity_id:o.value(a)})}if(null==t?void 0:t.struct_asym._rowCount){const{id:e,entity_id:r}=t.struct_asym
for(let t=0,i=e.rowCount;t<i;++t){const i=e.value(t)
n.has(i)||n.set(i,{id:i,auth_id:"",entity_id:r.value(t)})}}return n}const ie=r.VP.Schema.Aliased(r.VP.Schema.Str())
function oe(e){let t
if(e.entity.id.isDefined)t=e.entity
else{const n=new Set,i=[],o=[],{label_entity_id:a,label_comp_id:s}=e.atom_site
for(let t=0,r=e.atom_site._rowCount;t<r;t++){const e=a.value(t)
n.has(e)||(i.push(e),o.push((0,h.getEntityType)(s.value(t))),n.add(e))}const{entity_id:l}=e.ihm_sphere_obj_site
for(let t=0,r=e.ihm_sphere_obj_site._rowCount;t<r;t++){const e=l.value(t)
n.has(e)||(i.push(e),o.push("polymer"),n.add(e))}const{entity_id:c}=e.ihm_gaussian_obj_site
for(let t=0,r=e.ihm_gaussian_obj_site._rowCount;t<r;t++){const e=c.value(t)
n.has(e)||(i.push(e),o.push("polymer"),n.add(e))}t=r.XI.ofPartialColumns(U.e.entity,{id:r.VP.ofArray({array:i,schema:U.e.entity.id}),type:r.VP.ofArray({array:o,schema:U.e.entity.type})},i.length)}const n=r.VP.createIndexer(t.id),i=new Array(t._rowCount)
i.fill("other")
const o=new Set
let a=!1
if(e.entity_poly&&e.entity_poly.type.isDefined){const{entity_id:t,type:r,_rowCount:a}=e.entity_poly
for(let e=0;e<a;++e){const a=t.value(e)
i[n(a)]=r.value(e),o.add(a)}}else a=!0
if(e.pdbx_entity_branch&&e.pdbx_entity_branch.entity_id.isDefined){const{entity_id:t,type:r,_rowCount:a}=e.pdbx_entity_branch
for(let e=0;e<a;++e){const a=t.value(e)
i[n(a)]=r.value(e),o.add(a)}}else a=!0
if(o.size<i.length&&(a=!0),a){const t=new Map
if(e.chem_comp){const{id:n,type:r}=e.chem_comp
for(let i=0,o=e.chem_comp._rowCount;i<o;i++)t.set(n.value(i),r.value(i))}if(e.atom_site){const{label_entity_id:r,label_comp_id:a}=e.atom_site
for(let s=0,l=e.atom_site._rowCount;s<l;s++){const e=r.value(s)
if(!o.has(e)){const r=a.value(s),l=t.get(r)||"other"
i[n(e)]=(0,h.getEntitySubtype)(r,l),o.add(e)}}}}return{data:t,subtype:r.VP.ofArray({array:i,schema:ie}),getEntityIndex:n}}function ae(e,t,n){var i
if(!e.pdbx_molecule||!e.pdbx_molecule.prd_id.isDefined)return t
const o=new Array(t.data._rowCount)
o.fill("")
const{asym_id:a,prd_id:s,_rowCount:l}=e.pdbx_molecule
for(let r=0;r<l;++r){const e=a.value(r),l=null===(i=n.get(e))||void 0===i?void 0:i.entity_id
void 0!==l&&(o[t.getEntityIndex(l)]=s.value(r))}const c=r.VP.ofArray({array:o,schema:r.VP.Schema.str})
return{...t,prd_id:c}}var se=n(49610),le=n(94603)
async function ce(e,t,n){const i=function(e){return{missingResidues:J(e),chemicalComponentMap:ee(e),saccharideComponentMap:te(e)}}(e),a=e.ihm_model_list._rowCount>0?await async function(e,t,n,i){const o=oe(t),a=t.atom_site.ihm_model_id.isDefined?t.atom_site.ihm_model_id:t.atom_site.pdbx_PDB_model_num,s=he(t.atom_site,a),l=he(t.ihm_sphere_obj_site,t.ihm_sphere_obj_site.model_id),c=he(t.ihm_gaussian_obj_site,t.ihm_gaussian_obj_site.model_id),u=[]
if(t.ihm_model_list){const{model_id:a,model_name:d}=t.ihm_model_list
for(let p=0;p<t.ihm_model_list._rowCount;p++){const h=a.value(p)
let f,m
if(s.has(h)){const n=s.get(h),{atom_site:r,sourceIndex:i}=await W(e,t.atom_site,n.start,n.end)
f=r,m=i}else f=r.XI.window(t.atom_site,t.atom_site._schema,0,0),m=r.VP.ofIntArray([])
const g=de(t,{model_id:h,model_name:d.value(p),model_group_name:(0,se.O)(h,t),entities:o,atom_site:f,atom_site_sourceIndex:m,ihm_sphere_obj_site:l.has(h)?l.get(h).table:r.XI.window(t.ihm_sphere_obj_site,t.ihm_sphere_obj_site._schema,0,0),ihm_gaussian_obj_site:c.has(h)?c.get(h).table:r.XI.window(t.ihm_gaussian_obj_site,t.ihm_gaussian_obj_site._schema,0,0)},n,i)
u.push(g)}}return u}(n,e,i,t):await async function(e,t,n,r){const i=[]
if(t.atom_site){const o=t.atom_site.id.rowCount,a=oe(t)
let s=0
for(;s<o;){const o=pe(t.atom_site.pdbx_PDB_model_num,s),{atom_site:l,sourceIndex:c}=await W(e,t.atom_site,s,o),u=ue(t,l,c,a,n,r,i.length>0?i[i.length-1]:void 0)
i.push(u),s=o}}return i}(n,e,i,t)
for(let r=0;r<a.length;r++)o.K.TrajectoryInfo.set(a[r],{index:r,size:a.length})
return new le.P(a)}function ue(e,t,n,o,s,l,c){const u=P(t,n,o,s.chemicalComponentMap,l,c),d=t.pdbx_PDB_model_num.value(0)
if(c&&u.sameAsPrevious)return{...c,id:i.k.create22(),modelNum:d,atomicConformation:u.conformation,_dynamicPropertyData:Object.create(null)}
const p=G,h=X(e,o,u.hierarchy,p.hierarchy),f=Z(u.hierarchy,o,u.conformation,h),m=re(u.hierarchy),g=e.entry.id.valueKind(0)===r.VP.ValueKinds.Present?e.entry.id.value(0):l.name,y=[]
return g&&y.push(g),e.struct.title.valueKind(0)===r.VP.ValueKinds.Present&&y.push(e.struct.title.value(0)),{id:i.k.create22(),entryId:g,label:y.join(" | "),entry:g,sourceData:l,modelNum:d,parent:void 0,entities:ae(e,o,m),sequence:h,atomicHierarchy:u.hierarchy,atomicConformation:u.conformation,atomicRanges:f,atomicChainOperatorMappinng:u.chainOperatorMapping,coarseHierarchy:p.hierarchy,coarseConformation:p.conformation,properties:{...s,structAsymMap:m},customProperties:new a.v,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)}}function de(e,t,n,o){const s=P(t.atom_site,t.atom_site_sourceIndex,t.entities,n.chemicalComponentMap,o),l=function(e){const{ihm_sphere_obj_site:t,ihm_gaussian_obj_site:n}=e
if(0===t._rowCount&&0===n._rowCount)return G
const r=q(t),i=function(e){return{x:e.Cartn_x.toArray({array:Float32Array}),y:e.Cartn_y.toArray({array:Float32Array}),z:e.Cartn_z.toArray({array:Float32Array}),radius:e.object_radius.toArray({array:Float32Array}),rmsf:e.rmsf.toArray({array:Float32Array})}}(t),o=z(r,e.entities),a=V(r),s=q(n),l=function(e){const t=U.e.ihm_gaussian_obj_site.covariance_matrix.space,n=[],{covariance_matrix:r}=e
for(let i=0,o=r.rowCount;i<o;i++)n[i]=u.qY.toMat3((0,u.U)(),t,r.value(i))
return{x:e.mean_Cartn_x.toArray({array:Float32Array}),y:e.mean_Cartn_y.toArray({array:Float32Array}),z:e.mean_Cartn_z.toArray({array:Float32Array}),weight:e.weight.toArray({array:Float32Array}),covariance_matrix:n}}(n),c=z(s,e.entities),d=V(s)
return{hierarchy:{isDefined:!0,spheres:{...r,...o,...a},gaussians:{...s,...c,...d},index:E({spheres:r,gaussians:s})},conformation:{id:j.kk.create22(),spheres:i,gaussians:l}}}(t,n.chemicalComponentMap),c=X(e,t.entities,s.hierarchy,l.hierarchy),d=Z(s.hierarchy,t.entities,s.conformation,c),p=e.entry.id.valueKind(0)===r.VP.ValueKinds.Present?e.entry.id.value(0):o.name,h=[]
p&&h.push(p),e.struct.title.valueKind(0)===r.VP.ValueKinds.Present&&h.push(e.struct.title.value(0)),t.model_name&&h.push(t.model_name),t.model_group_name&&h.push(t.model_group_name)
const f=re(s.hierarchy,e)
return{id:i.k.create22(),entryId:p,label:h.join(" | "),entry:p,sourceData:o,modelNum:t.model_id,parent:void 0,entities:ae(e,t.entities,f),sequence:c,atomicHierarchy:s.hierarchy,atomicConformation:s.conformation,atomicRanges:d,atomicChainOperatorMappinng:s.chainOperatorMapping,coarseHierarchy:l.hierarchy,coarseConformation:l.conformation,properties:{...n,structAsymMap:f},customProperties:new a.v,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)}}function pe(e,t){const n=e.rowCount
if(!e.isDefined)return n
let r=t+1
for(;r<n&&e.areValuesEqual(t,r);)r++
return r}function he(e,t){const n=new Map,i=e._rowCount
let o=0
for(;o<i;){const i=pe(t,o),a=t.value(o)
n.set(a,{table:r.XI.window(e,e._schema,o,i),start:o,end:i}),o=i}return n}},24060(e,t,n){"use strict"
n.d(t,{Bs:()=>h,Bt:()=>z,C6:()=>s,CI:()=>_,DJ:()=>N,Du:()=>V,J6:()=>S,JR:()=>f,Jd:()=>F,Kt:()=>A,L4:()=>I,MS:()=>m,MT:()=>g,QB:()=>T,VD:()=>R,WD:()=>l,Yl:()=>E,Z1:()=>M,af:()=>v,bt:()=>b,ci:()=>L,ct:()=>y,dh:()=>u,e_:()=>c,fr:()=>j,jU:()=>w,kR:()=>k,l4:()=>d,m6:()=>x,n_:()=>C,qf:()=>O,qr:()=>B,qt:()=>D,w1:()=>p,wM:()=>P})
var r=n(5638),i=n(41197),o=n(62264),a=n(26991)
function s(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext}function l(e){if(s(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e),VERTEX_ATTRIB_ARRAY_DIVISOR:e.VERTEX_ATTRIB_ARRAY_DIVISOR}
{const t=e.getExtension("ANGLE_instanced_arrays")
return null===t?null:{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t),VERTEX_ATTRIB_ARRAY_DIVISOR:t.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE}}}function c(e){if(s(e))return{FRAGMENT_SHADER_DERIVATIVE_HINT:e.FRAGMENT_SHADER_DERIVATIVE_HINT}
{const t=e.getExtension("OES_standard_derivatives")
return null===t?null:{FRAGMENT_SHADER_DERIVATIVE_HINT:t.FRAGMENT_SHADER_DERIVATIVE_HINT_OES}}}function u(e){return s(e)?{}:e.getExtension("OES_element_index_uint")}function d(e){if(s(e))return{VERTEX_ARRAY_BINDING:e.VERTEX_ARRAY_BINDING,bindVertexArray:e.bindVertexArray.bind(e),createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),isVertexArray:e.isVertexArray.bind(e)}
{const t=e.getExtension("OES_vertex_array_object")
return null===t?null:{VERTEX_ARRAY_BINDING:t.VERTEX_ARRAY_BINDING_OES,bindVertexArray:t.bindVertexArrayOES.bind(t),createVertexArray:t.createVertexArrayOES.bind(t),deleteVertexArray:t.deleteVertexArrayOES.bind(t),isVertexArray:t.isVertexArrayOES.bind(t)}}}function p(e){return s(e)?{}:e.getExtension("OES_texture_float")}function h(e){return e.getExtension("OES_texture_float_linear")}function f(e){if(s(e))return{HALF_FLOAT:e.HALF_FLOAT}
{const t=e.getExtension("OES_texture_half_float")
return null===t?null:{HALF_FLOAT:t.HALF_FLOAT_OES}}}function m(e){return e.getExtension("OES_texture_half_float_linear")}function g(e){if(s(e))return{MIN:e.MIN,MAX:e.MAX}
{const t=e.getExtension("EXT_blend_minmax")
return null===t?null:{MIN:t.MIN_EXT,MAX:t.MAX_EXT}}}function y(e){return s(e)?{}:e.getExtension("EXT_frag_depth")}function v(e){if(s(e))return null===e.getExtension("EXT_color_buffer_float")?null:(e.getExtension("EXT_float_blend"),{RGBA32F:e.RGBA32F})
{const t=e.getExtension("WEBGL_color_buffer_float")
return null===t?(e.getExtension("OES_texture_float"),G(e,e.FLOAT)?{RGBA32F:34836}:null):(e.getExtension("EXT_float_blend"),{RGBA32F:t.RGBA32F_EXT})}}function b(e){if(s(e))return null===e.getExtension("EXT_color_buffer_half_float")?null:(e.getExtension("EXT_float_blend"),{RGBA16F:e.RGBA16F})
{const t=e.getExtension("EXT_color_buffer_half_float")
return null===t?(e.getExtension("OES_texture_half_float"),G(e,36193)?{RGBA16F:34842}:null):(e.getExtension("EXT_float_blend"),{RGBA16F:t.RGBA16F_EXT})}}function x(e){if(s(e))return{drawBuffers:e.drawBuffers.bind(e),COLOR_ATTACHMENT0:e.COLOR_ATTACHMENT0,COLOR_ATTACHMENT1:e.COLOR_ATTACHMENT1,COLOR_ATTACHMENT2:e.COLOR_ATTACHMENT2,COLOR_ATTACHMENT3:e.COLOR_ATTACHMENT3,COLOR_ATTACHMENT4:e.COLOR_ATTACHMENT4,COLOR_ATTACHMENT5:e.COLOR_ATTACHMENT5,COLOR_ATTACHMENT6:e.COLOR_ATTACHMENT6,COLOR_ATTACHMENT7:e.COLOR_ATTACHMENT7,DRAW_BUFFER0:e.DRAW_BUFFER0,DRAW_BUFFER1:e.DRAW_BUFFER1,DRAW_BUFFER2:e.DRAW_BUFFER2,DRAW_BUFFER3:e.DRAW_BUFFER3,DRAW_BUFFER4:e.DRAW_BUFFER4,DRAW_BUFFER5:e.DRAW_BUFFER5,DRAW_BUFFER6:e.DRAW_BUFFER6,DRAW_BUFFER7:e.DRAW_BUFFER7,MAX_COLOR_ATTACHMENTS:e.MAX_COLOR_ATTACHMENTS,MAX_DRAW_BUFFERS:e.MAX_DRAW_BUFFERS}
{const t=e.getExtension("WEBGL_draw_buffers")
return null===t?null:{drawBuffers:t.drawBuffersWEBGL.bind(t),COLOR_ATTACHMENT0:t.COLOR_ATTACHMENT0_WEBGL,COLOR_ATTACHMENT1:t.COLOR_ATTACHMENT1_WEBGL,COLOR_ATTACHMENT2:t.COLOR_ATTACHMENT2_WEBGL,COLOR_ATTACHMENT3:t.COLOR_ATTACHMENT3_WEBGL,COLOR_ATTACHMENT4:t.COLOR_ATTACHMENT4_WEBGL,COLOR_ATTACHMENT5:t.COLOR_ATTACHMENT5_WEBGL,COLOR_ATTACHMENT6:t.COLOR_ATTACHMENT6_WEBGL,COLOR_ATTACHMENT7:t.COLOR_ATTACHMENT7_WEBGL,DRAW_BUFFER0:t.DRAW_BUFFER0_WEBGL,DRAW_BUFFER1:t.DRAW_BUFFER1_WEBGL,DRAW_BUFFER2:t.DRAW_BUFFER2_WEBGL,DRAW_BUFFER3:t.DRAW_BUFFER3_WEBGL,DRAW_BUFFER4:t.DRAW_BUFFER4_WEBGL,DRAW_BUFFER5:t.DRAW_BUFFER5_WEBGL,DRAW_BUFFER6:t.DRAW_BUFFER6_WEBGL,DRAW_BUFFER7:t.DRAW_BUFFER7_WEBGL,MAX_COLOR_ATTACHMENTS:t.MAX_COLOR_ATTACHMENTS_WEBGL,MAX_DRAW_BUFFERS:t.MAX_DRAW_BUFFERS_WEBGL}}}function S(e){const t=e.getExtension("OES_draw_buffers_indexed")
return null===t?null:{enablei:t.enableiOES.bind(t),disablei:t.disableiOES.bind(t),blendEquationi:t.blendEquationiOES.bind(t),blendEquationSeparatei:t.blendEquationSeparateiOES.bind(t),blendFunci:t.blendFunciOES.bind(t),blendFuncSeparatei:t.blendFuncSeparateiOES.bind(t),colorMaski:t.colorMaskiOES.bind(t)}}function _(e){return s(e)?{}:e.getExtension("EXT_shader_texture_lod")}function C(e){if(s(e))return{UNSIGNED_INT_24_8:e.UNSIGNED_INT_24_8}
{const t=e.getExtension("WEBGL_depth_texture")
return null===t?null:{UNSIGNED_INT_24_8:t.UNSIGNED_INT_24_8_WEBGL}}}function w(e){if(s(e))return{FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING,SRGB8_ALPHA8:e.SRGB8_ALPHA8,SRGB8:e.SRGB8,SRGB:e.SRGB}
{const t=e.getExtension("EXT_sRGB")
return null===t?null:{FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT,SRGB8_ALPHA8:t.SRGB8_ALPHA8_EXT,SRGB8:t.SRGB_ALPHA_EXT,SRGB:t.SRGB_EXT}}}function T(e){if(s(e)){const t=e.getExtension("EXT_disjoint_timer_query_webgl2")||e.getExtension("EXT_disjoint_timer_query")
return null===t?null:{QUERY_COUNTER_BITS:t.QUERY_COUNTER_BITS_EXT,CURRENT_QUERY:e.CURRENT_QUERY,QUERY_RESULT:e.QUERY_RESULT,QUERY_RESULT_AVAILABLE:e.QUERY_RESULT_AVAILABLE,TIME_ELAPSED:t.TIME_ELAPSED_EXT,TIMESTAMP:t.TIMESTAMP_EXT,GPU_DISJOINT:t.GPU_DISJOINT_EXT,createQuery:e.createQuery.bind(e),deleteQuery:e.deleteQuery.bind(e),isQuery:e.isQuery.bind(e),beginQuery:e.beginQuery.bind(e),endQuery:e.endQuery.bind(e),queryCounter:t.queryCounterEXT.bind(t),getQuery:e.getQuery.bind(e),getQueryParameter:e.getQueryParameter.bind(e)}}{const t=e.getExtension("EXT_disjoint_timer_query")
return null===t?null:{QUERY_COUNTER_BITS:t.QUERY_COUNTER_BITS_EXT,CURRENT_QUERY:t.CURRENT_QUERY_EXT,QUERY_RESULT:t.QUERY_RESULT_EXT,QUERY_RESULT_AVAILABLE:t.QUERY_RESULT_AVAILABLE_EXT,TIME_ELAPSED:t.TIME_ELAPSED_EXT,TIMESTAMP:t.TIMESTAMP_EXT,GPU_DISJOINT:t.GPU_DISJOINT_EXT,createQuery:t.createQueryEXT.bind(t),deleteQuery:t.deleteQueryEXT.bind(t),isQuery:t.isQueryEXT.bind(t),beginQuery:t.beginQueryEXT.bind(t),endQuery:t.endQueryEXT.bind(t),queryCounter:t.queryCounterEXT.bind(t),getQuery:t.getQueryEXT.bind(t),getQueryParameter:t.getQueryObjectEXT.bind(t)}}}function A(e){const t=e.getExtension("WEBGL_multi_draw")
return t?{multiDrawArrays:t.multiDrawArraysWEBGL.bind(t),multiDrawElements:t.multiDrawElementsWEBGL.bind(t),multiDrawArraysInstanced:t.multiDrawArraysInstancedWEBGL.bind(t),multiDrawElementsInstanced:t.multiDrawElementsInstancedWEBGL.bind(t)}:null}function I(e){const t=e.getExtension("WEBGL_draw_instanced_base_vertex_base_instance")
return t?{drawArraysInstancedBaseInstance:t.drawArraysInstancedBaseInstanceWEBGL.bind(t),drawElementsInstancedBaseVertexBaseInstance:t.drawElementsInstancedBaseVertexBaseInstanceWEBGL.bind(t)}:null}function P(e){const t=e.getExtension("WEBGL_multi_draw_instanced_base_vertex_base_instance")
return t?{multiDrawArraysInstancedBaseInstance:t.multiDrawArraysInstancedBaseInstanceWEBGL.bind(t),multiDrawElementsInstancedBaseVertexBaseInstance:t.multiDrawElementsInstancedBaseVertexBaseInstanceWEBGL.bind(t)}:null}function B(e){const t=e.getExtension("KHR_parallel_shader_compile")
return null===t?null:{COMPLETION_STATUS:t.COMPLETION_STATUS_KHR}}function E(e){return s(e)?{}:e.getExtension("OES_fbo_render_mipmap")}function k(e){if(s(e)){const t=e.getExtension("WEBGL_provoking_vertex")
if(t)return{FIRST_VERTEX_CONVENTION:t.FIRST_VERTEX_CONVENTION_WEBGL,LAST_VERTEX_CONVENTION:t.LAST_VERTEX_CONVENTION_WEBGL,PROVOKING_VERTEX:t.PROVOKING_VERTEX_WEBGL,provokingVertex:t.provokingVertexWEBGL.bind(t)}}return null}function D(e){if(s(e)){const t=e.getExtension("WEBGL_clip_cull_distance")
if(t)return{MAX_CLIP_DISTANCES:t.MAX_CLIP_DISTANCES_WEBGL,MAX_CULL_DISTANCES:t.MAX_CULL_DISTANCES_WEBGL,MAX_COMBINED_CLIP_AND_CULL_DISTANCES:t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL,CLIP_DISTANCE0:t.CLIP_DISTANCE0_WEBGL,CLIP_DISTANCE1:t.CLIP_DISTANCE1_WEBGL,CLIP_DISTANCE2:t.CLIP_DISTANCE2_WEBGL,CLIP_DISTANCE3:t.CLIP_DISTANCE3_WEBGL,CLIP_DISTANCE4:t.CLIP_DISTANCE4_WEBGL,CLIP_DISTANCE5:t.CLIP_DISTANCE5_WEBGL,CLIP_DISTANCE6:t.CLIP_DISTANCE6_WEBGL,CLIP_DISTANCE7:t.CLIP_DISTANCE7_WEBGL}}return null}function M(e){return s(e)&&e.getExtension("EXT_conservative_depth")?{}:null}function R(e){if(s(e)){const t=e.getExtension("WEBGL_stencil_texturing")
if(t)return{DEPTH_STENCIL_TEXTURE_MODE:t.DEPTH_STENCIL_TEXTURE_MODE_WEBGL,STENCIL_INDEX:t.STENCIL_INDEX_WEBGL}}return null}function O(e){const t=e.getExtension("EXT_clip_control")
return t?{LOWER_LEFT:t.LOWER_LEFT_EXT,UPPER_LEFT:t.UPPER_LEFT_EXT,NEGATIVE_ONE_TO_ONE:t.NEGATIVE_ONE_TO_ONE_EXT,ZERO_TO_ONE:t.ZERO_TO_ONE_EXT,CLIP_ORIGIN:t.CLIP_ORIGIN_EXT,CLIP_DEPTH_MODE:t.CLIP_DEPTH_MODE_EXT,clipControl:t.clipControlEXT.bind(t)}:null}function L(e){return s(e)&&e.getExtension("EXT_render_snorm")?{}:null}function N(e){return s(e)&&e.getExtension("WEBGL_render_shared_exponent")?{}:null}function F(e){const t=e.getExtension("EXT_texture_norm16")
return t?{R16:t.R16_EXT,RG16:t.RG16_EXT,RGB16:t.RGB16_EXT,RGBA16:t.RGBA16_EXT,R16_SNORM:t.R16_SNORM_EXT,RG16_SNORM:t.RG16_SNORM_EXT,RGB16_SNORM:t.RGB16_SNORM_EXT,RGBA16_SNORM:t.RGBA16_SNORM_EXT}:null}function z(e){const t=e.getExtension("EXT_depth_clamp")
return t?{DEPTH_CLAMP:t.DEPTH_CLAMP_EXT}:null}function j(e){if(s(e)){const t=e.getExtension("OVR_multiview2")
if(t)return{FRAMEBUFFER_ATTACHMENT_TEXTURE_NUM_VIEWS:t.FRAMEBUFFER_ATTACHMENT_TEXTURE_NUM_VIEWS_OVR,FRAMEBUFFER_ATTACHMENT_TEXTURE_BASE_VIEW_INDEX:t.FRAMEBUFFER_ATTACHMENT_TEXTURE_BASE_VIEW_INDEX_OVR,MAX_VIEWS:t.MAX_VIEWS_OVR,FRAMEBUFFER_INCOMPLETE_VIEW_TARGETS:t.FRAMEBUFFER_INCOMPLETE_VIEW_TARGETS_OVR,framebufferTextureMultiview:t.framebufferTextureMultiviewOVR.bind(t)}}return null}function V(e){if(!s(e))return!1
if("undefined"!=typeof navigator){const e=window.navigator.userAgent.match(/Firefox\/([0-9]+)\./)
return!e||parseInt(e[1])>=85}return!1}const U=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1])
function G(e,t){const n=(0,a.A)(e,{type:"vert",source:"\nattribute vec4 aPosition;\n\nvoid main() {\n    gl_Position = aPosition;\n}"}),s=(0,a.A)(e,{type:"frag",source:"\nprecision mediump float;\nuniform vec4 uColor;\nuniform sampler2D uTexture;\n\nvoid main() {\n    gl_FragColor = texture2D(uTexture, vec2(0.5, 0.5)) * uColor;\n}"})
if(!n||!s)return!1
const l=(0,o.J)(e)
e.attachShader(l,n),e.attachShader(l,s),e.linkProgram(l),e.useProgram(l)
const c=e.getAttribLocation(l,"aPosition"),u=e.getUniformLocation(l,"uColor")
if(!u)return r.Bb&&console.log("error getting 'uColor' uniform location"),!1
const d=e.createBuffer()
e.bindBuffer(e.ARRAY_BUFFER,d),e.bufferData(e.ARRAY_BUFFER,U,e.STATIC_DRAW),e.enableVertexAttribArray(c),e.vertexAttribPointer(c,2,e.FLOAT,!1,0,0)
const p=e.createTexture(),h=new Uint8Array([255,255,255,255])
e.bindTexture(e.TEXTURE_2D,p),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,h)
const f=e.createTexture()
e.bindTexture(e.TEXTURE_2D,f),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,t,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST)
const m=e.createFramebuffer()
if(e.bindFramebuffer(e.FRAMEBUFFER,m),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,f,0),e.checkFramebufferStatus(e.FRAMEBUFFER)!==e.FRAMEBUFFER_COMPLETE)return r.Bb&&console.log(`error creating framebuffer for '${t}'`),!1
e.bindTexture(e.TEXTURE_2D,p),e.uniform4fv(u,[0,10,20,1]),e.drawArrays(e.TRIANGLES,0,6),e.bindTexture(e.TEXTURE_2D,f),e.bindFramebuffer(e.FRAMEBUFFER,null),e.clearColor(1,0,0,1),e.clear(e.COLOR_BUFFER_BIT),e.uniform4fv(u,[0,.1,.05,1]),e.drawArrays(e.TRIANGLES,0,6)
const g=new Uint8Array(4)
if(e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,g),0!==g[0]||g[1]<248||g[2]<248||g[3]<254)return r.Bb&&console.log(`not able to actually render to '${t}' texture`),!1
if(t===e.FLOAT){e.bindFramebuffer(e.FRAMEBUFFER,m)
const t=new Float32Array(4)
e.readPixels(0,0,1,1,e.RGBA,e.FLOAT,t)
const n=e.getError()
if(n)return r.Bb&&console.log(`error reading float pixels: '${(0,i.tL)(e,n)}'`),!1}return!0}},24762(e,t,n){"use strict"
n.d(t,{VP:()=>o.V,iu:()=>l,Wm:()=>i,XI:()=>r})
var r,i,o=n(83040),a=n(42988),s=n(23718)
!function(e){function t(e,t,n){const r=Object.create(null),i=Object.keys(t)
r._rowCount=n.length,r._columns=i,r._schema=t
for(const a of i)r[a]=o.V.view(e[a],n)
return r}function n(e,t){const n=Object.create(null),{_columns:r}=e
for(let i=0;i<r.length;i++){const o=r[i]
n[o]=e[o].value(t)}return n}e.is=function(e){return e&&"number"==typeof e._rowCount&&!!e._columns&&!!e._schema},e.pickColumns=function(e,t,n={}){const r=Object.create(null),i=Object.keys(e)
r._rowCount=t._rowCount,r._columns=i,r._schema=e
for(const o of i)if(t[o])r[o]=t[o]
else{if(!n[o])throw Error(`Cannot find column '${o}'.`)
r[o]=n[o]}return r},e.ofColumns=function(e,t){const n=Object.keys(t)
return{_rowCount:t[n[0]].rowCount,_columns:n,_schema:e,...t}},e.ofPartialColumns=function(e,t,n){const r=Object.create(null),i=Object.keys(e)
r._rowCount=n,r._columns=i,r._schema=e
for(const a of i)r[a]=a in t?t[a]:o.V.Undefined(n,e[a])
return r},e.ofUndefinedColumns=function(e,t){const n=Object.create(null),r=Object.keys(e)
n._rowCount=t,n._columns=r,n._schema=e
for(const i of r)n[i]=o.V.Undefined(t,e[i])
return n},e.ofRows=function(e,t){const n=Object.create(null),r=t.length,i=Object.keys(e)
n._rowCount=r,n._columns=i,n._schema=e
for(const a of i)n[a]=o.V.ofLambda({rowCount:r,schema:e[a],value:e=>t[e][a],valueKind:e=>void 0===t[e][a]?o.V.ValueKinds.NotPresent:o.V.ValueKinds.Present})
return n},e.ofArrays=function(e,t){var n
const r=Object.create(null),i=Object.keys(e)
r._rowCount=0,r._columns=i,r._schema=e
for(const a of i)void 0!==t[a]?(r[a]=o.V.ofArray({array:t[a],schema:e[a]}),r._rowCount=null===(n=t[a])||void 0===n?void 0:n.length):r[a]=o.V.Undefined(r._rowCount,e[a])
return r},e.view=t,e.pick=function(e,n,r){const i=[]
for(let t=0,o=e._rowCount;t<o;++t)r(t)&&i.push(t)
return t(e,n,i)},e.window=function(e,t,n,r){if(0===n&&r===e._rowCount)return e
const i=Object.create(null),a=Object.keys(t)
i._rowCount=r-n,i._columns=a,i._schema=t
for(const s of a)i[s]=o.V.window(e[s],n,r)
return i},e.concat=function(e,t){const n=Object.create(null),r=Object.keys(t)
n._rowCount=0
for(const o of e)n._rowCount+=o._rowCount
const i={}
for(const o of r)i[o]=new Array(n._rowCount)
n._columns=r,n._schema=t
let a=0
for(const s of e){for(const e of r)o.V.copyToArray(s[e],i[e],a)
a+=s._rowCount}for(const s of r)n[s]=o.V.ofArray({array:i[s],schema:t[s]})
return n},e.columnToArray=function(e,t,n){e[t]=o.V.asArrayColumn(e[t],n)},e.sort=function(e,t){const n=new Int32Array(e._rowCount)
for(let o=0,a=n.length;o<a;o++)n[o]=o;(0,a.eh)(n,(e,n,r)=>t(n,r))
let r=!0
for(let o=0,a=n.length;o<a;o++)if(n[o]!==o){r=!1
break}if(r)return e
const i=Object.create(null)
i._rowCount=e._rowCount,i._columns=e._columns,i._schema=e._schema
for(const a of e._columns)i[a]=o.V.view(e[a],n,!1)
return i},e.areEqual=function(e,t){if(e._rowCount!==t._rowCount)return!1
if(e._columns.length!==t._columns.length)return!1
for(const n of e._columns)if(!t[n])return!1
for(const n of e._columns)if(!o.V.areEqual(e[n],t[n]))return!1
return!0},e.getRow=n,e.pickRow=function(e,t){for(let r=0,i=e._rowCount;r<i;++r)if(t(r))return n(e,r)},e.getRows=function(e){const t=[],{_rowCount:r}=e
for(let i=0;i<r;i++)t[i]=n(e,i)
return t},e.toArrays=function(e){const t={},{_columns:n}=e
for(let r=0;r<n.length;r++){const i=n[r]
t[i]=e[i].toArray()}return t},e.formatToString=function(e){const t=s.f.create(),{_columns:n,_rowCount:r}=e
let i=1
s.f.write(t,"|")
for(let o=0;o<n.length;o++)s.f.write(t,n[o]),s.f.write(t,"|"),i+=n[o].length+1
s.f.newline(t),s.f.write(t,new Array(i+1).join("-")),s.f.newline(t)
for(let a=0;a<r;a++){s.f.write(t,"|")
for(let r=0;r<n.length;r++){const i=e[n[r]]
i.valueKind(a)===o.V.ValueKinds.Present?(s.f.write(t,i.value(a)),s.f.write(t,"|")):s.f.write(t,".|")}s.f.newline(t)}return s.f.getString(t)}}(r||(r={})),function(e){e.ofTables=function(e,t,n){const i=Object.keys(n),o=Object.create(null),a=[]
o._name=e,o._tableNames=a,o._schema=t
for(const s of i)r.is(n[s])&&(o[s]=n[s],a[a.length]=s)
return o},e.getTablesAsRows=function(e){const t={}
for(const n of e._tableNames)t[n]=r.getRows(e[n])
return t}}(i||(i={}))
var l=n(20924)},25176(e,t,n){"use strict"
n.d(t,{AN:()=>c})
var r=n(2092),i=n(29915),o=n(32773),a=n(6941),s=n(81916)
const l={"@header":"Internal Queries",generator:{"@header":"Generators",bundleElement:(0,s.HR)(a.d3.Dictionary({groupedUnits:(0,a.ef)(o.Z.Any),set:(0,a.ef)(o.Z.Any),ranges:(0,a.ef)(o.Z.Any)}),o.Z.Any),bundle:(0,s.HR)(a.d3.Dictionary({elements:(0,a.ef)(o.Z.Any)}),i.O.ElementSelectionQuery,"A selection with single structure containing represented by the bundle."),current:(0,s.HR)(a.d3.None,i.O.ElementSelectionQuery,"Current selection provided by the query context. Avoid using this in State Transforms.")}},c={core:r.I8,structureQuery:i.q,internal:l};(0,s.ec)(c)
const u=(0,s.br)(c)
!function(){const e=Object.create(null)
for(const t of u)e[t.id]=t}()},25382(e,t,n){"use strict"
n.d(t,{T:()=>_})
var r=n(92384),i=n(32751),o=n(16625),a=n(48393),s=n(30372),l=n(23729),c=n(3111),u=n(70292),d=n(89),p=n(40038),h=n(52408),f=n(83842),m=n(32775),g=n(67538),y=n(91030),v=n(45692),b=n(17515)
class x{set(e,t){const n=this.hashCode(e)
let r=this.buckets.get(n)
r||(r=[],this.buckets.set(n,r))
for(let i=0;i<r.length;i++)if(this.areEqual(r[i].key,e))return void(r[i].value=t)
r.push({key:e,value:t})}get(e){const t=this.hashCode(e),n=this.buckets.get(t)
if(n)for(const r of n)if(this.areEqual(r.key,e))return r.value}delete(e){const t=this.hashCode(e),n=this.buckets.get(t)
if(!n)return!1
for(let r=0;r<n.length;r++)if(this.areEqual(n[r].key,e))return n.splice(r,1),0===n.length&&this.buckets.delete(t),!0
return!1}forEach(e){for(const t of this.buckets.values())for(const n of t)e(n.value,n.key)}clear(){this.buckets.clear()}constructor(e,t){this.hashCode=e,this.areEqual=t,this.buckets=new Map}}function S(){return new x(e=>e.hashCode,a.Unit.SymmetryGroup.areInvariantElementsEqual)}function _(e,t,n,x){let _=0
const{webgl:C}=t,w=new s.B,T=(0,l.Q0)(),A=[],I=new o.YL.GeometryState,P=i.J1.create()
let B,E,k,D,M=S(),R=c.S.createEmpty()
function O(e,t,n){const{visible:r,alphaFactor:i,pickable:o,overpaint:a,transparency:s,emissive:l,substance:c,clipping:u,themeStrength:d,transform:p,unitTransforms:h}=n
void 0!==r&&e.setVisibility(r),void 0!==i&&e.setAlphaFactor(i),void 0!==o&&e.setPickable(o),void 0!==a&&e.setOverpaint(a,C),void 0!==s&&e.setTransparency(s,C),void 0!==l&&e.setEmissive(l,C),void 0!==c&&e.setSubstance(c,C),void 0!==u&&e.setClipping(u),void 0!==d&&e.setThemeStrength(d),void 0!==p&&(p===P.transform&&m.$I.areEqual(p,P.transform,m.p8)||e.setTransform(p)),void 0!==h&&(h?e.setTransform(void 0,h.getSymmetryGroupTransforms(t)):h!==P.unitTransforms&&e.setTransform(void 0,null))}return{label:e,get groupCount(){let e=0
return M.forEach(({visual:t})=>{t.renderObject&&(e+=t.groupCount)}),e},get geometryVersion(){return I.version},get props(){return D},get params(){return k},get state(){return P},get theme(){return R},renderObjects:A,updated:w,createOrUpdate:function(e={},i){return i&&i!==B&&(k=n(t,i),D||(D=r.t.getDefaultValues(k))),D=Object.assign({},D,e),u.Task.create("Creating or updating UnitsRepresentation",async e=>{var n,r,o
if(!B&&!i)throw new Error("missing structure")
if(i&&!B){E=i.unitSymmetryGroups
for(let t=0;t<E.length;t++){const n=E[t],r=x(T,i,D,C),o=r.createOrUpdate({webgl:C,runtime:e},R,D,{group:n,structure:i})
o&&await o,O(r,n,P),M.set(n,{visual:r,group:n}),e.shouldUpdate&&await e.update({message:"Creating or updating UnitsVisual",current:t,max:E.length})}}else if(!i||a.Structure.areUnitIdsAndIndicesEqual(i,B)&&i.child===B.child)if(i&&i!==B&&a.Structure.areUnitIdsAndIndicesEqual(i,B)){E=i.unitSymmetryGroups
for(let n=0;n<E.length;n++){const o=E[n],a=M.get(o)
if(!a)throw new Error(`expected to find visual for hashCode ${o.hashCode}`)
{let{visual:n}=a
if(null===(r=n.mustRecreate)||void 0===r?void 0:r.call(n,{group:o,structure:i},D,t.webgl)){n.destroy(),n=x(T,i,D,t.webgl),a.visual=n
const r=n.createOrUpdate({webgl:C,runtime:e},R,D,{group:o,structure:i})
r&&await r,O(n,o,P)}else{const t=n.createOrUpdate({webgl:C,runtime:e},R,D,{group:o,structure:i})
t&&await t}a.group=o}e.shouldUpdate&&await e.update({message:"Creating or updating UnitsVisual",current:n,max:E.length})}}else{const n=[]
M.forEach(e=>n.push(e))
for(let r=0,i=n.length;r<i;++r){let{visual:a,group:s}=n[r]
if(null===(o=a.mustRecreate)||void 0===o?void 0:o.call(a,{group:s,structure:B},D,t.webgl)){a.destroy(),a=x(T,B,D,C),n[r].visual=a
const t=a.createOrUpdate({webgl:C,runtime:e},R,D,{group:s,structure:B})
t&&await t,O(a,s,P)}else{const t=a.createOrUpdate({webgl:C,runtime:e},R,D)
t&&await t}e.shouldUpdate&&await e.update({message:"Creating or updating UnitsVisual",current:r,max:i})}}else{E=i.unitSymmetryGroups
const t=M
M=S()
for(let r=0;r<E.length;r++){const o=E[r],a=t.get(o)
if(a){let{visual:r}=a
if(null===(n=r.mustRecreate)||void 0===n?void 0:n.call(r,{group:o,structure:i},D,C)){r.destroy(),r=x(T,i,D,C)
const t=r.createOrUpdate({webgl:C,runtime:e},R,D,{group:o,structure:i})
t&&await t,O(r,o,P)}else{const t=r.createOrUpdate({webgl:C,runtime:e},R,D,{group:o,structure:i})
t&&await t}if(M.set(o,{visual:r,group:o}),t.delete(o),r.renderObject){const e=r.renderObject.values.tMarker.ref.value.array;(0,p.BH)(e,g.IX.ofBounds(0,e.length),p.xi.RemoveHighlight)}}else{const t=x(T,i,D,C),n=t.createOrUpdate({webgl:C,runtime:e},R,D,{group:o,structure:i})
n&&await n,O(t,o,P),M.set(o,{visual:t,group:o})}e.shouldUpdate&&await e.update({message:"Creating or updating UnitsVisual",current:r,max:E.length})}t.forEach(({visual:e})=>{e.destroy()})}A.length=0,M.forEach(({visual:e})=>{e.renderObject&&(A.push(e.renderObject),I.add(e.renderObject.id,e.geometryVersion))}),I.snapshot(),i&&(B=i),w.next(_++)})},setState:function(e){const{visible:t,alphaFactor:n,pickable:r,overpaint:o,transparency:a,emissive:s,substance:l,clipping:c,themeStrength:u,transform:d,unitTransforms:p,syncManually:g,markerActions:x}=e,S={}
void 0!==t&&(S.visible=t),void 0!==n&&(S.alphaFactor=n),void 0!==r&&(S.pickable=r),void 0!==o&&B&&(S.overpaint=h.l.remap(o,B)),void 0!==a&&B&&(S.transparency=f.x.remap(a,B)),void 0!==s&&B&&(S.emissive=b.a.remap(s,B)),void 0!==l&&B&&(S.substance=v.l.remap(l,B)),void 0!==c&&B&&(S.clipping=y.l.remap(c,B)),void 0!==u&&(S.themeStrength=u),void 0===d||m.$I.areEqual(d,P.transform,m.p8)||(S.transform=d),p===P.unitTransforms&&(null==p?void 0:p.version)===P.unitTransformsVersion||(S.unitTransforms=p,P.unitTransformsVersion=p?null==p?void 0:p.version:-1),void 0!==g&&(S.syncManually=g),void 0!==x&&(S.markerActions=x),M.forEach(({visual:e,group:t})=>O(e,t,S)),i.J1.update(P,S)},setTheme:function(e){R=e},getLoci:function(e){let t=d.EmptyLoci
return M.forEach(({visual:n})=>{const r=n.getLoci(e);(0,d.isEmptyLoci)(r)||(t=r)}),t},getAllLoci:function(){var e
return[a.Structure.Loci(null!==(e=B.child)&&void 0!==e?e:B)]},eachLocation:function(e){M.forEach(({visual:t})=>{t.eachLocation(e)})},mark:function(e,t){if(!B)return!1
if(!p.sY.is(P.markerActions,t))return!1
if(a.Structure.isLoci(e)||a.StructureElement.Loci.is(e)||a.Bond.isLoci(e)){if(!a.Structure.areRootsEquivalent(e.structure,B))return!1
e=d.Loci.remap(e,B),(a.Structure.isLoci(e)||a.StructureElement.Loci.is(e)&&a.StructureElement.Loci.isWholeStructure(e))&&(e=d.EveryLoci)}else if(!(0,d.isEveryLoci)(e)&&!(0,d.isDataLoci)(e))return!1
if(d.Loci.isEmpty(e))return!1
let n=!1
return M.forEach(({visual:r})=>{n=r.mark(e,t)||n}),n},destroy:function(){M.forEach(({visual:e})=>e.destroy()),M.clear()}}}},25602(e,t,n){"use strict"
e.exports=n(59923)},25914(e,t,n){"use strict"
function r([e]){return Math.fround(e)}n.r(t),n.d(t,{default:()=>i,fround:()=>r})
var i=(0,n(10336).helper)(r)},25919(e,t,n){"use strict"
n.d(t,{p:()=>l})
var r=n(37411),i=n(63317)
const o=r.e.add,a=r.e.squaredDistance,s=r.e.distance
class l{reset(){r.e.set(this.center,0,0,0),this.radiusSq=0,this.count=0}includeStep(e){o(this.center,this.center,e),this.count++}finishedIncludeStep(){0!==this.count&&r.e.scale(this.center,this.center,1/this.count)}radiusStep(e){const t=a(e,this.center)
t>this.radiusSq&&(this.radiusSq=t)}radiusSphereStep(e,t){const n=s(e,this.center)+t,r=n*n
r>this.radiusSq&&(this.radiusSq=r)}getSphere(e){return e||(e=(0,i.f)()),r.e.copy(e.center,this.center),e.radius=Math.sqrt(this.radiusSq),e}getCount(){return this.count}constructor(){this.count=0,this.center=(0,r.e)(),this.radiusSq=0}}!function(e){const t=new e,n=(0,r.e)(),i=(0,r.e)()
e.fromArrays=function({x:e,y:i,z:o},a){t.reset()
const s=e.length
for(let l=0;l<s;l++)r.e.set(n,e[l],i[l],o[l]),t.includeStep(n)
t.finishedIncludeStep()
for(let l=0;l<s;l++)r.e.set(n,e[l],i[l],o[l]),t.radiusStep(n)
return r.e.copy(a.center,t.center),a.radius=Math.sqrt(t.radiusSq),a},e.fromProvider=function(e,i,o){t.reset()
for(let r=0;r<e;r++)i(r,n),t.includeStep(n)
t.finishedIncludeStep()
for(let r=0;r<e;r++)i(r,n),t.radiusStep(n)
return r.e.copy(o.center,t.center),o.radius=Math.sqrt(t.radiusSq),o},e.fromPairProvider=function(e,o,a){t.reset()
for(let r=0;r<e;r++)o(r,n,i),t.includeStep(n),t.includeStep(i)
t.finishedIncludeStep()
for(let r=0;r<e;r++)o(r,n,i),t.radiusStep(n),t.radiusStep(i)
return r.e.copy(a.center,t.center),a.radius=Math.sqrt(t.radiusSq),a}}(l||(l={}))},26028(e,t,n){"use strict"
n.d(t,{h:()=>o})
class r{constructor(e,t){this.parent=null,this.child=null,this.degree=0,this.isMarked=!1,this.key=e,this.value=t,this.prev=this,this.next=this}}const i=new class{constructor(e){if(this._index=-1,this._items=[],this._len=0,e){let t=e,n=0
do{this._items[n++]=t,t=t.next}while(e!==t)
this._len=n}}hasNext(){return this._index<this._len-1}next(){return this._items[++this._index]}reset(e){this._index=-1,this._len=0
let t=e,n=0
do{this._items[n++]=t,t=t.next}while(e!==t)
this._len=n}}
class o{constructor(e){this._minNode=null,this._nodeCount=0,this._compare=e||this._defaultCompare}clear(){this._minNode=null,this._nodeCount=0}decreaseKey(e,t){if(!e)throw new Error("Cannot decrease key of non-existent node")
if(this._compare({key:t},{key:e.key})>0)throw new Error("New key is larger than old key")
e.key=t
const n=e.parent
n&&this._compare(e,n)<0&&(this._cut(e,n,this._minNode),this._cascadingCut(n,this._minNode)),this._compare(e,this._minNode)<0&&(this._minNode=e)}delete(e){const t=e.parent
t&&(this._cut(e,t,this._minNode),this._cascadingCut(t,this._minNode)),this._minNode=e,this.extractMinimum()}extractMinimum(){const e=this._minNode
if(e){if(e.child){let t=e.child
do{t.parent=null,t=t.next}while(t!==e.child)}let t=null
e.next!==e&&(t=e.next),this._removeNodeFromList(e),this._nodeCount--,this._minNode=this._mergeLists(t,e.child),this._minNode&&(this._minNode=this._consolidate(this._minNode))}return e}findMinimum(){return this._minNode}insert(e,t){const n=new r(e,t)
return this._minNode=this._mergeLists(this._minNode,n),this._nodeCount++,n}isEmpty(){return null===this._minNode}size(){return null===this._minNode?0:this._getNodeListSize(this._minNode)}union(e){this._minNode=this._mergeLists(this._minNode,e._minNode),this._nodeCount+=e._nodeCount}_defaultCompare(e,t){return e.key>t.key?1:e.key<t.key?-1:0}_cut(e,t,n){e.parent=null,t.degree--,e.next===e?t.child=null:t.child=e.next,this._removeNodeFromList(e)
const r=this._mergeLists(n,e)
return e.isMarked=!1,r}_cascadingCut(e,t){const n=e.parent
return n&&(e.isMarked?(t=this._cut(e,n,t),t=this._cascadingCut(n,t)):e.isMarked=!0),t}_consolidate(e){const t=[]
for(i.reset(e);i.hasNext();){let e=i.next(),n=t[e.degree]
for(;n;){if(this._compare(e,n)>0){const t=e
e=n,n=t}this._linkHeaps(n,e),t[e.degree]=null,e.degree++,n=t[e.degree]}t[e.degree]=e}let n=null
for(let r=0;r<t.length;r++){const e=t[r]
e&&(e.next=e,e.prev=e,n=this._mergeLists(n,e))}return n}_removeNodeFromList(e){const t=e.prev,n=e.next
t.next=n,n.prev=t,e.next=e,e.prev=e}_linkHeaps(e,t){this._removeNodeFromList(e),t.child=this._mergeLists(e,t.child),e.parent=t,e.isMarked=!1}_mergeLists(e,t){if(!e)return t||null
if(!t)return e
const n=e.next
return e.next=t.next,e.next.prev=e,t.next=n,t.next.prev=t,this._compare(e,t)<0?e:t}_getNodeListSize(e){let t=0,n=e
do{t++,n.child&&(t+=this._getNodeListSize(n.child)),n=n.next}while(n!==e)
return t}}},26429(e,t,n){"use strict"
n.d(t,{E2:()=>A,Nz:()=>T,WT:()=>w,kf:()=>C})
var r=n(34761),i=n(88434),o=n(96005),a=n(10268),s=n(10596),l=n(83794),c=n(88524),u=n(7818),d=n(43766),p=n(14294),h=n(32775),f=n(89),m=n(79111),g=n(17684),y=n(50709),v=n(40038),b=n(92384),x=n(91229),S=n(91763)
const _={alpha:b.t.Numeric(.51,{min:0,max:1,step:.01},{isEssential:!0,label:"Opacity"}),colorX:b.t.Color(y.ColorNames.red,{isEssential:!0}),colorY:b.t.Color(y.ColorNames.green,{isEssential:!0}),colorZ:b.t.Color(y.ColorNames.blue,{isEssential:!0}),scale:b.t.Numeric(.33,{min:.1,max:2,step:.1},{isEssential:!0}),location:b.t.Select("bottom-left",b.t.arrayToOptions(["bottom-left","bottom-right","top-left","top-right"])),locationOffsetX:b.t.Numeric(0),locationOffsetY:b.t.Numeric(0),originColor:b.t.Color(y.ColorNames.grey),radiusScale:b.t.Numeric(.075,{min:.01,max:.3,step:.001}),showPlanes:b.t.Boolean(!0),planeColorXY:b.t.Color(y.ColorNames.grey,{label:"Plane Color XY"}),planeColorXZ:b.t.Color(y.ColorNames.grey,{label:"Plane Color XZ"}),planeColorYZ:b.t.Color(y.ColorNames.grey,{label:"Plane Color YZ"}),showLabels:b.t.Boolean(!1),labelX:b.t.Text("X"),labelY:b.t.Text("Y"),labelZ:b.t.Text("Z"),labelColorX:b.t.Color(y.ColorNames.grey),labelColorY:b.t.Color(y.ColorNames.grey),labelColorZ:b.t.Color(y.ColorNames.grey),labelOpacity:b.t.Numeric(1,{min:0,max:1,step:.01}),labelScale:b.t.Numeric(.25,{min:.1,max:1,step:.01})},C={axes:b.t.MappedStatic("on",{on:b.t.Group(_),off:b.t.Group({})},{cycle:!0,description:"Show camera orientation axes"})}
class w{constructor(e,t={}){this.webgl=e,this.props={axes:{name:"off",params:{}}},this.pixelRatio=1,this.eachGroup=(e,t)=>{if(!A(e))return!1
let n=!1
if(this.meshRenderObject){const r=this.meshRenderObject.values.uGroupCount.ref.value
for(const{groupId:o,instanceId:a}of e.elements){const e=a*r+o
t(i.I.ofSingleton(e))&&(n=!0)}}if(this.textRenderObject){const r=this.textRenderObject.values.uGroupCount.ref.value
for(const{groupId:o,instanceId:a}of e.elements){const e=a*r+o
t(i.I.ofSingleton(e))&&(n=!0)}}return n},this.scene=d.Z.create(e,"blended"),this.camera=new S.i,h.eB.set(this.camera.up,0,1,0),h.eB.set(this.camera.target,0,0,0),this.setProps(t)}setProps(e){this.props=(0,r.j)(this.props,t=>{if(void 0!==e.axes&&(t.axes.name=e.axes.name,"on"===e.axes.name)){this.scene.clear(),this.pixelRatio=this.webgl.pixelRatio
const n={...e.axes.params,scale:e.axes.params.scale*this.pixelRatio,labelScale:e.axes.params.labelScale*this.pixelRatio}
this.meshRenderObject=function(e){const t=function(e){const t=100*e.scale,n=function(e){const t=l.P.createState(512,256,void 0),n=100*e.scale,r=e.radiusScale*n,i=e.showLabels?100*e.labelScale/3:0,s=h.eB.scale((0,h.eB)(),h.eB.unitX,n-i),c=h.eB.scale((0,h.eB)(),h.eB.unitY,n-i),u=h.eB.scale((0,h.eB)(),h.eB.unitZ,n-i),d={radiusTop:r,radiusBottom:r,radialSegments:32}
if(t.currentGroup=T.Origin,(0,a.X)(t,h.eB.origin,r,2),t.currentGroup=T.X,(0,a.X)(t,s,r,2),(0,o.y9)(t,h.eB.origin,s,1,d),t.currentGroup=T.Y,(0,a.X)(t,c,r,2),(0,o.y9)(t,h.eB.origin,c,1,d),t.currentGroup=T.Z,(0,a.X)(t,u,r,2),(0,o.y9)(t,h.eB.origin,u,1,d),e.showPlanes){h.eB.scale(s,s,.5),h.eB.scale(c,c,.5),h.eB.scale(u,u,.5),t.currentGroup=T.XY,l.P.addTriangle(t,h.eB.origin,s,c),l.P.addTriangle(t,h.eB.origin,c,s)
const e=h.eB.add((0,h.eB)(),s,c)
l.P.addTriangle(t,e,s,c),l.P.addTriangle(t,e,c,s),t.currentGroup=T.XZ,l.P.addTriangle(t,h.eB.origin,s,u),l.P.addTriangle(t,h.eB.origin,u,s)
const n=h.eB.add((0,h.eB)(),s,u)
l.P.addTriangle(t,n,s,u),l.P.addTriangle(t,n,u,s),t.currentGroup=T.YZ,l.P.addTriangle(t,h.eB.origin,c,u),l.P.addTriangle(t,h.eB.origin,u,c)
const r=h.eB.add((0,h.eB)(),c,u)
l.P.addTriangle(t,r,c,u),l.P.addTriangle(t,r,u,c)}return l.P.getMesh(t)}(e)
return n.setBoundingSphere(p.f8.create(h.eB.create(t/2,t/2,t/2),t+t/4)),m.y.create("axes-mesh",{},n,t=>{switch(t){case T.X:return e.colorX
case T.Y:return e.colorY
case T.Z:return e.colorZ
case T.XY:return e.planeColorXY
case T.XZ:return e.planeColorXZ
case T.YZ:return e.planeColorYZ
case T.Origin:return e.originColor
default:return y.ColorNames.grey}},()=>1,()=>"")}(e)
return m.y.createRenderObject(t,{...b.t.getDefaultValues(s.e.Params),...e,ignoreLight:!0,cellSize:0})}(n),this.scene.add(this.meshRenderObject),e.axes.params.showLabels?(this.textRenderObject=function(e){const t=function(e){const t=100*e.scale,n=function(e){const t=u.t.create(e,8,8,void 0),n=100*e.scale,r=h.eB.scale((0,h.eB)(),h.eB.unitX,n),i=h.eB.scale((0,h.eB)(),h.eB.unitY,n),o=h.eB.scale((0,h.eB)(),h.eB.unitZ,n),a=100*e.labelScale
return t.add(e.labelX,r[0],r[1],r[2],0,a,T.X),t.add(e.labelY,i[0],i[1],i[2],0,a,T.Y),t.add(e.labelZ,o[0],o[1],o[2],0,a,T.Z),t.getText()}(e)
return n.setBoundingSphere(p.f8.create(h.eB.create(t/2,t/2,t/2),t)),m.y.create("axes-text",{},n,t=>{switch(t){case T.X:return e.labelColorX
case T.Y:return e.labelColorY
case T.Z:return e.labelColorZ
default:return y.ColorNames.grey}},()=>1,()=>"")}(e)
return m.y.createRenderObject(t,{...b.t.getDefaultValues(c.E.Params),...e,alpha:e.labelOpacity,cellSize:0})}(n),this.scene.add(this.textRenderObject)):this.textRenderObject=void 0,this.scene.commit(),h.eB.set(this.camera.position,0,0,200*n.scale),h.$I.lookAt(this.camera.view,this.camera.position,this.camera.target,this.camera.up),t.axes.params={...e.axes.params}}})}get isEnabled(){return"on"===this.props.axes.name}getLoci(e){const{objectId:t,groupId:n,instanceId:r}=e
return(this.meshRenderObject&&t===this.meshRenderObject.id||this.textRenderObject&&t===this.textRenderObject.id)&&n!==T.None?function(e,t,n){return(0,f.DataLoci)("camera-axes",e,[{groupId:t,instanceId:n}],void 0,()=>function(e,t){const n=t.props.axes,r="on"===n.name?n.params.labelX:"X",i="on"===n.name?n.params.labelY:"Y",o="on"===n.name?n.params.labelZ:"Z"
switch(e){case T.X:return`${r} Axis`
case T.Y:return`${i} Axis`
case T.Z:return`${o} Axis`
case T.XY:return`${r}${i} Plane`
case T.XZ:return`${r}${o} Plane`
case T.YZ:return`${i}${o} Plane`
case T.Origin:return"Origin"
default:return"Axes"}}(t,e))}(this,n,r):f.EmptyLoci}mark(e,t){if(!v.sY.is(v.sY.Highlighting,t))return!1
if(!(0,f.isEveryLoci)(e)){if(!A(e))return!1
if(e.data!==this)return!1}return g.b.mark(this.meshRenderObject,e,t,this.eachGroup)||g.b.mark(this.textRenderObject,e,t,this.eachGroup)}update(e){if(!this.meshRenderObject||"off"===this.props.axes.name)return
this.pixelRatio!==this.webgl.pixelRatio&&this.setProps(this.props),function(e,t,n){const{near:r,far:i}=e,o=-t.width/2,a=t.width/2,s=t.height/2,l=-t.height/2,c=(a-o)/2,u=(s-l)/2,d=(a+o)/2,p=(s+l)/2
let f=d-c,m=d+c,g=p+u,y=p-u
if(n.enabled){const e=(a-o)/n.width,t=(s-l)/n.height
f+=e*n.offsetX,m=f+e*n.width,g-=t*n.offsetY,y=g-t*n.height}h.$I.ortho(e.projection,f,m,g,y,r,i)}(this.camera,e.viewport,e.viewOffset),h.$I.extractRotation(this.scene.view,e.view)
const t=this.textRenderObject?this.textRenderObject.values.boundingSphere.ref.value.radius:this.meshRenderObject.values.boundingSphere.ref.value.radius,n=this.props.axes.params.location,r=this.props.axes.params.locationOffsetX*this.pixelRatio,i=this.props.axes.params.locationOffsetY*this.pixelRatio
"bottom-left"===n?h.$I.setTranslation(this.scene.view,h.eB.create(-e.viewport.width/2+t+r,-e.viewport.height/2+t+i,0)):"bottom-right"===n?h.$I.setTranslation(this.scene.view,h.eB.create(e.viewport.width/2-t-r,-e.viewport.height/2+t+i,0)):"top-left"===n?h.$I.setTranslation(this.scene.view,h.eB.create(-e.viewport.width/2+t+r,e.viewport.height/2-t-i,0)):"top-right"===n?h.$I.setTranslation(this.scene.view,h.eB.create(e.viewport.width/2-t-r,e.viewport.height/2-t-i,0)):(0,x.dr)(n)}}var T
function A(e){return"data-loci"===e.kind&&"camera-axes"===e.tag}!function(e){e[e.None=0]="None",e[e.X=1]="X",e[e.Y=2]="Y",e[e.Z=3]="Z",e[e.XY=4]="XY",e[e.XZ=5]="XZ",e[e.YZ=6]="YZ",e[e.Origin=7]="Origin"}(T||(T={}))},26991(e,t,n){"use strict"
n.d(t,{A:()=>a,g:()=>s})
var r=n(9959),i=n(5638)
const o=(0,r.q)()
function a(e,t){const{type:n,source:r}=t,o=e.createShader("vert"===n?e.VERTEX_SHADER:e.FRAGMENT_SHADER)
if(null===o)throw new Error(`Error creating ${n} shader`)
if(e.shaderSource(o,r),e.compileShader(o),i.Bb&&!1===e.getShaderParameter(o,e.COMPILE_STATUS))throw console.warn(`'${n}' shader info log '${e.getShaderInfoLog(o)}'\n${function(e){const t=e.split("\n")
for(let n=0;n<t.length;++n)t[n]=n+1+": "+t[n]
return t.join("\n")}(r)}`),new Error(`Error compiling ${n} shader`)
return o}function s(e,t){let n=a(e,t)
return{id:o(),attach:t=>{e.attachShader(t,n)},reset:()=>{n=a(e,t)},destroy:()=>{e.deleteShader(n)}}}},27011(e,t,n){"use strict"
n.d(t,{i:()=>f,J:()=>h})
var r=n(32775),i=n(37392)
const o={radius:1,detail:0}
var a=n(40165),s=n(34322)
const l=(1+Math.sqrt(5))/2,c=[-1,l,0,1,l,0,-1,-l,0,1,-l,0,0,-1,l,0,1,l,0,-1,-l,0,1,-l,l,0,-1,l,0,1,-l,0,-1,-l,0,1]
let u;(0,s.L3)(c,[0,11,5,11,0,5,1,5,0,1,1,7,0,7,7,10,0,10,10,11,5,9,4,11,2,10,6,7,1,8,3,9,4,9,3,4,2,4,2,3,2,6,3,6,6,8,3,8,8,9,4,5,2,11,6,10,7,8,1,9])
const{vertices:d,indices:p}=(u||(u=(0,a.m9)(c,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1])),u)
function h(e){return 10*Math.pow(Math.pow(2,e),2)+2}function f(e){return function(e,t,n){const{radius:a,detail:s}={...o,...n},l=function(){const e=[],t=[],n=new Map
function r(t){const r=`${t[0].toFixed(5)}|${t[1].toFixed(5)}|${t[2].toFixed(5)}`
let i=n.get(r)
return void 0===i&&(i=e.length/3,n.set(r,i),e.push(...t)),i}return{vertices:e,indices:t,add:(e,n,i)=>{t.push(r(e),r(n),r(i))}}}(),{vertices:c,indices:u}=l
!function(n){const i=(0,r.eB)(),o=(0,r.eB)(),a=(0,r.eB)()
for(let s=0;s<t.length;s+=3)r.eB.fromArray(i,e,3*t[s+0]),r.eB.fromArray(o,e,3*t[s+1]),r.eB.fromArray(a,e,3*t[s+2]),p(i,o,a,n)}(s),(0,i.lm)(c,a)
const d=new Float32Array(c.length)
return(0,i.xL)(c,u,d,c.length/3,u.length/3),{vertices:new Float32Array(c),normals:new Float32Array(d),indices:new Uint32Array(u)}
function p(e,t,n,i){const o=Math.pow(2,i),a=[]
for(let s=0;s<=o;++s){a[s]=[]
const i=(0,r.eB)()
r.eB.lerp(i,e,n,s/o)
const l=(0,r.eB)()
r.eB.lerp(l,t,n,s/o)
const c=o-s
for(let e=0;e<=c;++e)if(0===e&&s===o)a[s][e]=i
else{const t=(0,r.eB)()
r.eB.lerp(t,i,l,e/c),a[s][e]=t}}for(let r=0;r<o;++r)for(let e=0;e<2*(o-r)-1;++e){const t=Math.floor(e/2)
e%2==0?l.add(a[r][t+1],a[r+1][t],a[r][t]):l.add(a[r][t+1],a[r+1][t+1],a[r+1][t])}}}(d,p,{detail:e,radius:1})}},28074(e,t,n){"use strict"
e.exports=n(14568)},28252(e,t,n){"use strict"
function r(e,t,n=1){let r=window.innerWidth,i=window.innerHeight
t!==document.body&&(r=t.offsetWidth,i=t.offsetHeight),function(e,t,n,r=1){e.width=Math.round(window.devicePixelRatio*r*t),e.height=Math.round(window.devicePixelRatio*r*n),Object.assign(e.style,{width:`${t}px`,height:`${n}px`})}(e,r,i,n)}async function i(e,t,n){return new Promise((r,i)=>{const o=e=>{e?r(e):i("no blob returned")}
HTMLCanvasElement.prototype.toBlob?e.toBlob(o,t,n):function(e,t,n,r){const i=atob(e.toDataURL(n,r).split(",")[1]),o=i.length,a=o>>2,s=new Uint8Array(o),l=new Uint32Array(s.buffer,0,a)
let c=0
for(let d=0;d<a;++d)l[d]=i.charCodeAt(c++)|i.charCodeAt(c++)<<8|i.charCodeAt(c++)<<16|i.charCodeAt(c++)<<24
let u=3&o
for(;u--;)s[c]=i.charCodeAt(c++)
t(new Blob([s],{type:n||"image/png"}))}(e,o,t,n)})}n.d(t,{H5:()=>r,PG:()=>i})},28269(e,t,n){"use strict"
function r(e){let t,n
return(...r)=>{if(!t||t.length!==r.length)return t=r,n=e.apply(void 0,r),n
for(let i=0,o=r.length;i<o;i++)if(r[i]!==t[i])return t=r,n=e.apply(void 0,r),n
return n}}function i(e){const t=new Map
return n=>{if(t.has(n))return t.get(n)
const r=e(n)
return t.set(n,r),r}}n.d(t,{E:()=>i,_:()=>r})},28539(e,t,n){"use strict"
n.d(t,{Kn:()=>l,yU:()=>s,Uv:()=>c})
var r=n(76513),i=n(18891),o=(0,n(497).L)(function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}),a=n(13352),s=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}var t
return e.prototype.unsubscribe=function(){var e,t,n,a,s
if(!this.closed){this.closed=!0
var l=this._parentage
if(l)if(this._parentage=null,Array.isArray(l))try{for(var c=(0,r.Ju)(l),d=c.next();!d.done;d=c.next())d.value.remove(this)}catch(t){e={error:t}}finally{try{d&&!d.done&&(t=c.return)&&t.call(c)}finally{if(e)throw e.error}}else l.remove(this)
var p=this.initialTeardown
if((0,i.T)(p))try{p()}catch(e){s=e instanceof o?e.errors:[e]}var h=this._finalizers
if(h){this._finalizers=null
try{for(var f=(0,r.Ju)(h),m=f.next();!m.done;m=f.next()){var g=m.value
try{u(g)}catch(e){s=null!=s?s:[],e instanceof o?s=(0,r.fX)((0,r.fX)([],(0,r.zs)(s)),(0,r.zs)(e.errors)):s.push(e)}}}catch(e){n={error:e}}finally{try{m&&!m.done&&(a=f.return)&&a.call(f)}finally{if(n)throw n.error}}}if(s)throw new o(s)}},e.prototype.add=function(t){var n
if(t&&t!==this)if(this.closed)u(t)
else{if(t instanceof e){if(t.closed||t._hasParent(this))return
t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage
return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage
this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage
t===e?this._parentage=null:Array.isArray(t)&&(0,a.o)(t,e)},e.prototype.remove=function(t){var n=this._finalizers
n&&(0,a.o)(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e}(),l=s.EMPTY
function c(e){return e instanceof s||e&&"closed"in e&&(0,i.T)(e.remove)&&(0,i.T)(e.add)&&(0,i.T)(e.unsubscribe)}function u(e){(0,i.T)(e)?e():e.unsubscribe()}},28626(e,t,n){"use strict"
n.d(t,{gn:()=>V,dZ:()=>d,kD:()=>j,MQ:()=>I})
var r,i=n(44688),o=n(87095),a=n(67538),s=n(25919),l=n(29067),c=n(97960),u=n(84512)
!function(e){e.Empty=l.O.create([],[],[],0,{flags:[],order:[],key:[]})}(r||(r={}))
class d extends u.Z{getBondFromLocation(e){return c.N.isAtomic(e.aUnit)&&c.N.isAtomic(e.bUnit)?this.getEdge(e.aIndex,e.aUnit.id,e.bIndex,e.bUnit.id):void 0}getBondIndexFromLocation(e){return c.N.isAtomic(e.aUnit)&&c.N.isAtomic(e.bUnit)?this.getEdgeIndex(e.aIndex,e.aUnit.id,e.bIndex,e.bUnit.id):-1}}!function(e){class t extends u.Z.UnitPairEdges{}e.UnitPairBonds=t}(d||(d={}))
var p=n(8507),h=n(11064),f=n(64367),m=n(39791),g=n(65746),y=n(32775),v=n(23325),b=n(93104),x=n(70012)
const S=y.eB.distance
function _(e,t,n,r,i,o,a){const s=new l.O.EdgeBuilder(o,e,t),c=new Uint16Array(s.slotCount),u=new Int8Array(s.slotCount),d=new Uint32Array(s.slotCount)
for(let l=0,p=s.edgeCount;l<p;l++)s.addNextEdge(),s.assignProperty(c,r[l]),s.assignProperty(u,n[l]),s.assignProperty(d,i[l])
return s.createGraph({flags:c,order:u,key:d},a)}const C=(0,y.eB)(),w=(0,y.eB)()
function T(e,t,n){return e.conformation.position(t,C),e.conformation.position(n,w),S(C,w)}const A=new Set
function I(e,t){const n={...p.kD,...t}
return n.noCompute||e.elements.length<=1?r.Empty:!n.forceCompute&&f.z.Provider.get(e.model)?function(e){if(-1===e.conformation.operator.key)return!1
const t=f.z.Provider.get(e.model)
return!!(null==t?void 0:t.hasOperators)}(e)?function(e){const t=f.z.Provider.get(e.model),n=t.bySameOperator.get(e.conformation.operator.key)
if(!n)return r.Empty
const{a:i,b:o,edgeProps:{key:s,flag:l,order:c}}=t.bonds,{invertedIndex:u}=b.K.getInvertedAtomSourceIndex(e.model),{elements:d}=e,p=[],h=[],m=[],g=[],y=[]
for(let r=0,f=n.length;r<f;++r){const e=n[r]
if(i[e]>=o[e])continue
const t=u[i[e]],f=a.X9.indexOf(d,t)
if(f<0)continue
const v=u[o[e]],b=a.X9.indexOf(d,v)
b<0||(p[p.length]=f,h[h.length]=b,m[m.length]=l[e],g[g.length]=c[e],y[y.length]=s[e])}return _(p,h,g,m,y,d.length,{canRemap:!1,cacheable:t.cacheable})}(e):function(e){const t=f.z.Provider.get(e.model),{elements:n}=e,{type_symbol:r}=e.model.atomicHierarchy.atoms,i=e.elements.length,{maxDistance:o}=t,{offset:s,b:l,edgeProps:{order:c,distance:u,flag:d,key:h,operatorA:m,operatorB:g}}=t.bonds,{atomSourceIndex:y}=e.model.atomicHierarchy,{invertedIndex:x}=b.K.getInvertedAtomSourceIndex(e.model),S=[],C=[],w=[],A=[],I=[],P=e.conformation.operator.key
for(let f=0;f<i;f++){const t=n[f],i=(0,p.Yd)(r.value(t)),b=(0,p.v3)(i),_=y.value(t)
for(let n=s[_],y=s[_+1];n<y;++n){const s=x[l[n]]
if(t>=s)continue
const y=a.X9.indexOf(e.elements,s)
if(y<0)continue
const _=m[n],B=g[n]
if(_>=0&&_!==P||B>=0&&B!==P)continue
const E=(0,p.Yd)(r.value(s)),k=u[n],D=T(e,t,s)
let M=!1
k>=0?M=(0,v.T)(D,k,.3):o>=0?M=D<o:(M=D<(0,p.on)(i,E,(0,p.O6)(i),(0,p.O6)(E)),b&&(0,p.v3)(E)&&(M=!1)),M&&(S[S.length]=f,C[C.length]=y,A[A.length]=c[n],w[w.length]=d[n],I[I.length]=h[n])}}return _(S,C,A,w,I,i,{canRemap:!1,cacheable:t.cacheable})}(e):function(e,t){const n=b.K.isCoarseGrained(e.model),r=n?6:t.maxRadius,{x:i,y:s,z:l}=e.model.atomicConformation,c=e.elements.length,{elements:u,residueIndex:d,chainIndex:f}=e,{type_symbol:y,label_atom_id:v,label_alt_id:S,label_comp_id:C}=e.model.atomicHierarchy.atoms,{label_seq_id:w}=e.model.atomicHierarchy.residues,{traceElementIndex:T}=e.model.atomicHierarchy.derived.residue,{index:I}=e.model.atomicHierarchy,{byEntityKey:P}=e.model.sequence,B=e.lookup3d,E=g.A.Provider.get(e.model),k=m.X.Provider.get(e.model),D=g.A.isExhaustive(e.model),M=[],R=[],O=[],L=[],N=[]
let F,z=-1,j=!0,V=!0,U=!0
const G=A,H=!!(null==E?void 0:E.residueCantorPairs.size)
for(let m=0;m<c;m++){const c=u[m],g=y.value(c)
j&&"H"!==g&&"O"!==g&&(j=!1)
const b=t.forceCompute?void 0:E&&E.byAtomIndex.get(c)
let _=!1
if(b)for(const t of b){const{partnerA:n,partnerB:r}=t
if(n.symmetry!==r.symmetry)continue
const i=n.atomIndex===c?r:n,o=a.X9.indexOf(e.elements,i.atomIndex)
o<0||u[o]<c||(M[M.length]=m,R[R.length]=o,O[O.length]=t.flags,L[L.length]=t.order,N[N.length]=t.rowIndex,_||G.clear(),_=!0,G.add(o))}if(D)continue
const A=d[c],q=w.value(A),Q=C.value(c)
if(!t.forceCompute&&A!==z)if(k&&k.entries.has(Q)){const e=P[I.getEntityFromChain(f[c])]
F=e&&e.sequence.microHet.has(q)?void 0:k.entries.get(Q).map}else F=void 0
z=A
const $=(0,p.Yd)(g),X=v.value(c),W=F?F.get(X):void 0,{indices:Y,count:Z,squaredDistances:K}=B.find(i[c],s[c],l[c],r),J=(0,p.v3)($),ee=(0,p.O6)($),te=S.value(c),ne=p.ZL.has($)
for(let e=0;e<Z;e++){const t=Y[e]
if(_&&G.has(t))continue
const r=u[t]
if(r<=c)continue
const i=S.value(r)
if(te&&i&&te!==i)continue
if(H){const e=(0,x.bd)(d[c],d[r])
if(E.residueCantorPairs.has(e))continue}const a=(0,p.Yd)(y.value(r)),s=(0,p.v3)(a)
if(J&&s)continue
const l=(ne||p.ZL.has(a))&&!(J||s),f=d[r]
if(A===f&&W){const e=W.get(v.value(r))
if(e){M[M.length]=m,R[R.length]=t,L[L.length]=e.order
let n=e.flags
l&&(n|o.BondType.Flag.Covalent&&(n^=o.BondType.Flag.Covalent),n|=o.BondType.Flag.MetallicCoordination),O[O.length]=n,N[N.length]=e.key}continue}const g=Math.sqrt(K[e])
if(0===g)continue
let b=!1
if(b=n?A===f?g<=5.5:g<=3.9&&T[A]===c&&T[f]===r:g<=(0,p.on)($,a,ee,(0,p.O6)(a)),b){M[M.length]=m,R[R.length]=t,L[L.length]=(0,h.e)(Q,X,v.value(r)),O[O.length]=(l?o.BondType.Flag.MetallicCoordination:o.BondType.Flag.Covalent)|o.BondType.Flag.Computed,N[N.length]=-1
const e=w.value(f)
q===e&&(V=!1),Math.abs(q-e)>1&&(U=!1)}}}return _(M,R,L,O,N,c,{canRemap:j||V&&U})}(e,n)}var P=n(20356),B=n(94050)
const E=y.eB.distance,k=y.eB.set,D=y.eB.squaredDistance,M=y.eB.transformMat4,R=(0,y.eB)(),O=(0,y.eB)()
function L(e,t,n,r){return e.conformation.position(t,R),n.conformation.position(r,O),E(R,O)}const N=(0,y.$I)(),F=(0,y.eB)(),z={...p.kD,ignoreWater:!0,ignoreIon:!0}
function j(e,t){const n={...z,...t}
return function(e,t){const n=new u.Z.Builder,r=e.models.some(e=>f.z.Provider.get(e)),i=e.models.some(e=>g.A.isExhaustive(e))
return t.noCompute||e.isCoarseGrained&&!r&&!i?new d(n.getMap()):!t.forceCompute&&function(e){for(const t of e.models){const e=f.z.Provider.get(t)
if(!(null==e?void 0:e.hasOperators))return!1}for(const t of e.units)if(-1===t.conformation.operator.key)return!1
return!0}(e)?(function(e,t){const n=new Map
for(const r of e.units){const{key:e}=r.conformation.operator
n.has(e)?n.get(e).add(r):n.set(e,new Set([r]))}for(const r of e.models){const i=f.z.Provider.get(r),{a:o,b:s}=i.bonds,{order:l,flag:u,key:d,operatorA:p,operatorB:h}=i.bonds.edgeProps,{invertedIndex:m}=B.Kx.getInvertedAtomSourceIndex(r),g=new Map
for(const t of e.units)if(t.model===r)for(let e=0,n=t.elements.length;e<n;++e){const n=t.elements[e]
g.has(n)?g.get(n).add(t):g.set(n,new Set([t]))}const y=new Map
for(let e=0,t=p.length;e<t;++e){let t,r
if(p[e]===h[e]?(t=g.get(m[o[e]]),r=g.get(m[s[e]])):(t=n.get(p[e]),r=n.get(h[e])),t&&r)for(const n of t)if(p[e]===n.conformation.operator.key)for(const t of r){if(h[e]!==t.conformation.operator.key)continue
if(n===t||!c.N.isAtomic(n)||!c.N.isAtomic(t))continue
if(n.id>t.id)continue
const r=(0,x.m1)(n.id,t.id)
y.has(r)?y.get(r).add(e):y.set(r,new Set([e]))}}const v=[-1,-1]
y.forEach((n,r)=>{const[i,c]=(0,x.Ao)(v,r),p=e.unitMap.get(i),h=e.unitMap.get(c)
t.startUnitPair(i,c),n.forEach(e=>{const n=m[o[e]],r=a.X9.indexOf(p.elements,n)
if(r<0)return
const i=m[s[e]],c=a.X9.indexOf(h.elements,i)
c<0||t.add(r,c,{order:l[e],flag:u[e],key:d[e]})}),t.finishUnitPair()})}}(e,n),new d(n.getMap())):(P.o.eachUnitPair(e,(e,r)=>{!function(e,t,n,r){const{maxRadius:i}=n,{elements:s,residueIndex:l}=e,{x:c,y:u,z:d}=e.model.atomicConformation,{elements:m,residueIndex:b}=t,S=e.elements.length,{type_symbol:_,label_alt_id:C,label_atom_id:w,label_comp_id:T}=e.model.atomicHierarchy.atoms,{type_symbol:A,label_alt_id:I,label_atom_id:P,label_comp_id:E}=t.model.atomicHierarchy.atoms,{auth_seq_id:R}=e.model.atomicHierarchy.residues,{auth_seq_id:O}=t.model.atomicHierarchy.residues,{occupancy:z}=e.model.atomicConformation,{occupancy:j}=t.model.atomicConformation,V=z.isDefined&&j.isDefined,U=e.model===t.model&&g.A.Provider.get(e.model),G=!n.forceCompute&&e.model===t.model&&f.z.Provider.get(e.model),{atomSourceIndex:H}=e.model.atomicHierarchy,{invertedIndex:q}=G?B.Kx.getInvertedAtomSourceIndex(t.model):{invertedIndex:void 0},Q=e.model===t.model&&g.A.isExhaustive(e.model),$=y.$I.mul(N,t.conformation.operator.inverse,e.conformation.operator.matrix),X=!y.$I.isIdentity($),{center:W,radius:Y}=t.boundary.sphere,Z=(Y+i)*(Y+i)
r.startUnitPair(e.id,t.id)
const K=e.conformation.operator.key,J=t.conformation.operator.key
for(let f=0;f<S;f++){const g=s[f]
if(k(F,c[g],u[g],d[g]),X&&M(F,F,$),D(F,W)>Z)continue
if(!n.forceCompute&&G){const{maxDistance:n}=G,{offset:i,b:o,edgeProps:{order:s,distance:l,flag:c,key:u,operatorA:d,operatorB:h}}=G.bonds,m=H.value(g),y=(0,p.Yd)(_.value(g))
for(let b=i[m],x=i[m+1];b<x;++b){const i=q[o[b]],m=a.X9.indexOf(t.elements,i)
if(m<0)continue
const x=d[b],S=h[b]
if(x>=0&&S>=0){if(x===S)continue
if(x!==K||S!==J)continue}const C=(0,p.Yd)(_.value(i)),w=l[b],T=L(e,g,t,i)
let A=!1
w>=0?A=(0,v.T)(T,w,.3):n>=0?A=T<n:(A=T<(0,p.on)(y,C,(0,p.O6)(y),(0,p.O6)(C)),(0,p.v3)(y)&&(0,p.v3)(C)&&(A=!1)),A&&r.add(f,m,{order:s[b],flag:c[b],key:u[b]})}continue}const y=n.forceCompute?void 0:U&&U.byAtomIndex.get(g)
if(y&&y.length){let n=!1
for(const o of y){const{partnerA:s,partnerB:l}=o,c=s.atomIndex===g?l:s,u=a.X9.indexOf(t.elements,c.atomIndex)
u<0||L(e,g,t,c.atomIndex)>i||(r.add(f,u,{order:o.order,flag:o.flags,key:o.rowIndex}),n=!0)}if(n)continue}if(Q)continue
const S=z.value(g),{lookup3d:B}=t,{indices:N,count:Y,squaredDistances:ee}=B.find(F[0],F[1],F[2],i)
if(0===Y)continue
const te=(0,p.Yd)(_.value(g)),ne=(0,p.v3)(te),re=(0,p.O6)(te),ie=C.value(g),oe=p.ZL.has(te),ae=w.value(g),se=T.value(l[g])
for(let n=0;n<Y;n++){const i=N[n],a=m[i],s=I.value(a)
if(ie&&s&&ie!==s)continue
if(V&&j.value(a)<1&&S<1&&R.value(l[g])===O.value(b[a]))continue
if(U&&e.model===t.model){const e=(0,x.bd)(l[g],b[a])
if(U.residueCantorPairs.has(e))continue}const c=(0,p.Yd)(A.value(a)),u=(0,p.v3)(c)
if(ne&&u)continue
const d=(oe||p.ZL.has(c))&&!(ne||u),y=Math.sqrt(ee[n])
if(0!==y&&y<=(0,p.on)(te,c,re,(0,p.O6)(c))){const e=P.value(a),t=E.value(b[a])
r.add(f,i,{order:(0,h.m)(se,t,ae,e),flag:(d?o.BondType.Flag.MetallicCoordination:o.BondType.Flag.Covalent)|o.BondType.Flag.Computed,key:-1})}}}r.finishUnitPair()}(e,r,t,n)},{maxRadius:t.maxRadius,validUnit:e=>t.validUnit(e),validUnitPair:(n,r)=>t.validUnitPair(e,n,r)}),new d(n.getMap()))}(e,{...n,validUnit:t&&t.validUnit||(e=>c.N.isAtomic(e)),validUnitPair:t&&t.validUnitPair||((e,t,r)=>{if(!P.o.validUnitPair(e,t,r))return!1
const i=t.model.atomicHierarchy.derived.residue.moleculeType,s=r.model.atomicHierarchy.derived.residue.moleculeType,l=!(c.N.isAtomic(t)&&i[t.residueIndex[t.elements[0]]]===o.MoleculeType.Water||c.N.isAtomic(r)&&s[r.residueIndex[r.elements[0]]]===o.MoleculeType.Water),u=!c.N.isAtomic(t)||i[t.residueIndex[t.elements[0]]]!==o.MoleculeType.Ion,d=!c.N.isAtomic(r)||s[r.residueIndex[r.elements[0]]]!==o.MoleculeType.Ion,p=u&&d
return!(!l&&n.ignoreWater||!p&&n.ignoreIon)||function(e,t){if(e.model!==t.model||!c.N.isAtomic(e)||!c.N.isAtomic(t))return!1
const n=g.A.Provider.get(e.model)
if(!n)return!1
const r=e.elements.length<t.elements.length?e:t,i=e.elements.length>=t.elements.length?e:t,{elements:o}=r,{elements:s}=i,{indexOf:l}=a.X9
for(let a=0,c=o.length;a<c;a++){const e=o[a],t=n.byAtomIndex.get(e)
if(null==t?void 0:t.length)for(const n of t)if(l(s,n.partnerA.atomIndex===e?n.partnerB.atomIndex:n.partnerA.atomIndex)>=0)return!0}return!1}(t,r)})})}var V
!function(e){function t(e,t,n,r,i,o){return{kind:"bond-location",aStructure:e,aUnit:t,aIndex:n,bStructure:r,bUnit:i,bIndex:o}}function n(e,t){return e.aStructure.label===t.aStructure.label&&e.bStructure.label===t.bStructure.label&&e.aIndex===t.aIndex&&e.bIndex===t.bIndex&&e.aUnit.id===t.aUnit.id&&e.bUnit.id===t.bUnit.id}function r(e,t){return{kind:"bond-loci",structure:e,bonds:t}}e.Location=t,e.isLocation=function(e){return!!e&&"bond-location"===e.kind},e.areLocationsEqual=n,e.Loci=r,e.isLoci=function(e){return!!e&&"bond-loci"===e.kind},e.areLociEqual=function(e,t){if(e.structure!==t.structure)return!1
if(e.bonds.length!==t.bonds.length)return!1
for(let r=0,i=e.bonds.length;r<i;++r)if(!n(e.bonds[r],t.bonds[r]))return!1
return!0},e.isLociEmpty=function(e){return 0===e.bonds.length},e.remapLoci=function(e,n){if(n===e.structure)return e
const i=[]
return e.bonds.forEach(r=>{const o=n.unitMap.get(r.aUnit.id)
if(!o)return
const s=n.unitMap.get(r.bUnit.id)
if(!s)return
const l=r.aUnit.elements[r.aIndex],c=a.X9.indexOf(o.elements,l)
if(-1===c)return
const u=r.bUnit.elements[r.bIndex],d=a.X9.indexOf(s.elements,u);-1!==d&&i.push(t(e.structure,o,c,e.structure,s,d))}),r(n,i)},e.toStructureElementLoci=function(e){const t=[],n=new Map
for(const r of e.bonds){const{aIndex:e,aUnit:t,bIndex:i,bUnit:o}=r
t===o?n.has(t.id)?n.get(t.id).push(e,i):n.set(t.id,[e,i]):(n.has(t.id)?n.get(t.id).push(e):n.set(t.id,[e]),n.has(o.id)?n.get(o.id).push(i):n.set(o.id,[i]))}return n.forEach((n,r)=>{t.push({unit:e.structure.unitMap.get(r),indices:a.X9.deduplicate(a.X9.ofUnsortedArray(n))})}),i.iZ.Loci(e.structure,t)},e.toFirstStructureElementLoci=function(e){const{aUnit:t,aIndex:n}=e.bonds[0]
return i.iZ.Loci(e.structure,[{unit:t,indices:a.CD.ofSingleton(n)}])},e.getType=function(e,t){if(t.aUnit===t.bUnit){const e=t.aUnit.bonds,n=e.getEdgeIndex(t.aIndex,t.bIndex)
return n<0?o.BondType.create(o.BondType.Flag.None):o.BondType.create(e.edgeProps.flags[n])}{const n=e.interUnitBonds.getBondFromLocation(t)
return n?o.BondType.create(n.props.flag):o.BondType.create(o.BondType.Flag.None)}},e.getOrder=function(e,t){if(t.aUnit===t.bUnit){const e=t.aUnit.bonds,n=e.getEdgeIndex(t.aIndex,t.bIndex)
return n<0?0:e.edgeProps.order[n]}{const n=e.interUnitBonds.getBondFromLocation(t)
return n?n.props.order:0}},e.getIntraUnitBondCount=function(e){let t=0
for(const n of e.unitSymmetryGroups){const e=n.units[0]
i.Nf.isAtomic(e)&&(t+=e.bonds.edgeCount*n.units.length)}return t},e.ElementBondIterator=class{move(){return this.advance(),this.current}setElement(e,t,n){this.structure=e,this.unit=t,this.index=n,this.interBondIndices=e.interUnitBonds.getEdgeIndices(n,t.id),this.interBondCount=this.interBondIndices.length,this.interBondIndex=0,this.intraBondEnd=t.bonds.offset[n+1],this.intraBondIndex=t.bonds.offset[n],this.hasNext=this.interBondIndex<this.interBondCount||this.intraBondIndex<this.intraBondEnd}advance(){if(this.intraBondIndex<this.intraBondEnd)this.current.otherUnit=this.unit,this.current.otherIndex=this.unit.bonds.b[this.intraBondIndex],this.current.type=this.unit.bonds.edgeProps.flags[this.intraBondIndex],this.current.order=this.unit.bonds.edgeProps.order[this.intraBondIndex],this.intraBondIndex+=1
else{if(!(this.interBondIndex<this.interBondCount))return void(this.hasNext=!1)
{const e=this.structure.interUnitBonds.edges[this.interBondIndices[this.interBondIndex]]
this.current.otherUnit=this.structure.unitMap.get(e.unitA!==this.unit.id?e.unitA:e.unitB),this.current.otherIndex=e.indexA!==this.index?e.indexA:e.indexB,this.current.type=e.props.flag,this.current.order=e.props.order,this.interBondIndex+=1}}this.hasNext=this.interBondIndex<this.interBondCount||this.intraBondIndex<this.intraBondEnd}constructor(){this.current={},this.hasNext=!1}},e.getBoundingSphere=function(e,t){return s.p.fromPairProvider(e.bonds.length,(t,n,r)=>{const{aUnit:i,aIndex:o,bUnit:a,bIndex:s}=e.bonds[t]
i.conformation.position(i.elements[o],n),a.conformation.position(a.elements[s],r)},t)}}(V||(V={}))},28721(e,t,n){"use strict"
n.d(t,{c:()=>B})
var r,i,o,a=n(24762),s=n(23718),l=n(17963),c=n(70254),u=n(91229)
function d(e){return(t,n)=>n[e].value(t)}function p(e){return(t,n)=>n[e].value(t).join(n[e].schema.separator)}function h(e,...t){return(n,r)=>r[e].schema.space.get(r[e].value(n),...t)}function f(e){return(t,n)=>n[e].valueKind(t)}function m(e,t){const n=[],i=r.Type.Float,o=f(e)
if(1===t.rank){const r=t.dimensions[0]
for(let t=0;t<r;t++){const r=`${e}[${t+1}]`
n.push({name:r,type:i,value:h(e,t),valueKind:o})}}else if(2===t.rank){const r=t.dimensions[0],a=t.dimensions[1]
for(let t=0;t<r;t++)for(let r=0;r<a;r++){const a=`${e}[${t+1}][${r+1}]`
n.push({name:a,type:i,value:h(e,t,r),valueKind:o})}}else{if(3!==t.rank)throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.")
{const r=t.dimensions[0],a=t.dimensions[1],s=t.dimensions[2]
for(let t=0;t<r;t++)for(let r=0;r<a;r++)for(let a=0;a<s;a++){const s=`${e}[${t+1}][${r+1}][${a+1}]`
n.push({name:s,type:i,value:h(e,t,r,a),valueKind:o})}}}return n}function g(e){const t=[]
for(const n of Object.keys(e)){const i=e[n]
"int"===i.valueType?t.push({name:n,type:r.Type.Int,value:d(n),valueKind:f(n)}):"float"===i.valueType?t.push({name:n,type:r.Type.Float,value:d(n),valueKind:f(n)}):"str"===i.valueType?t.push({name:n,type:r.Type.Str,value:d(n),valueKind:f(n)}):"list"===i.valueType?t.push({name:n,type:r.Type.Str,value:p(n),valueKind:f(n)}):"tensor"===i.valueType?t.push(...m(n,i.space)):(0,u.dr)(i.valueType)}return t}function y(e){return e.defaultFormat&&void 0!==e.defaultFormat.digitCount?Math.max(0,Math.min(e.defaultFormat.digitCount,16)):6}function v(e){return e.fields.some(e=>!!e.shouldInclude)?e.fields.filter(t=>!t.shouldInclude||e.source.some(e=>t.shouldInclude(e.data))):e.fields}function b(e,t){const n=e.instance(t),r=n.source.filter(e=>e.rowCount>0)
return r.length?{instance:n,rowCount:r.reduce((e,t)=>e+t.rowCount,0),source:r.map(e=>({data:e.data,keys:()=>e.keys?e.keys():l.f.Range(0,e.rowCount-1),rowCount:e.rowCount}))}:{instance:n,rowCount:0,source:[]}}!function(e){let t
function n(e,n,r){return{name:e,type:t.Int,value:n,valueKind:r&&r.valueKind,defaultFormat:r?{encoder:r.encoder,typedArray:r.typedArray}:void 0,shouldInclude:r&&r.shouldInclude}}!function(e){e[e.Str=0]="Str",e[e.Int=1]="Int",e[e.Float=2]="Float"}(t=e.Type||(e.Type={})),e.str=function(e,n,r){return{name:e,type:t.Str,value:n,valueKind:r&&r.valueKind,defaultFormat:r&&r.encoder?{encoder:r.encoder}:void 0,shouldInclude:r&&r.shouldInclude}},e.int=n,e.float=function(e,n,r){return{name:e,type:t.Float,value:n,valueKind:r&&r.valueKind,defaultFormat:r?{encoder:r.encoder,typedArray:r.typedArray,digitCount:void 0!==r.digitCount?r.digitCount:void 0}:void 0,shouldInclude:r&&r.shouldInclude}},e.index=function(e){return n(e,(e,t,n)=>n+1,{typedArray:Int32Array,encoder:c.ND.by(c.ND.delta).and(c.ND.runLength).and(c.ND.integerPacking)})}
class r{constructor(){this.fields=[]}index(t){return this.fields.push(e.index(t)),this}str(t,n,r){return this.fields.push(e.str(t,n,r)),this}int(t,n,r){return this.fields.push(e.int(t,n,r)),this}vec(t,n,r){for(let i=0;i<n.length;i++)this.fields.push(e.int(`${t}[${i+1}]`,n[i],r))
return this}float(t,n,r){return this.fields.push(e.float(t,n,r)),this}many(e){for(let t=0;t<e.length;t++)this.fields.push(e[t])
return this}add(e){return this.fields.push(e),this}getFields(){return this.fields}}e.Builder=r,e.build=function(){return new r}}(r||(r={})),function(e){e.Empty={fields:[],source:[]},e.filterOf=function(e){const t=[],n=[],r=[],i=[]
for(let a of e.split(/[\r\n]+/)){if(a=a.trim(),0===a.length)continue
const e=/^!/.test(a)
e&&(a=a.substr(1))
const o=a.split(/\./),s=o[1],l=e?s?i:n:s?r:t
l[l.length]=a,s&&!t.includes(o[0])&&(t[t.length]=o[0])}const o=r.map(e=>e.split(".")[0])
return{includeCategory:e=>!n.includes(e)&&(t.length<=0||-1!==t.indexOf(e)),includeField(e,t){const n=e+"."+t
return!i.includes(n)&&(!o.includes(e)||r.includes(n))}}},e.DefaultFilter={includeCategory:e=>!0,includeField:(e,t)=>!0},e.DefaultFormatter={getFormat(e,t){}},e.ofTable=function(e,t){return t?{fields:g(e._schema),source:[{data:e,rowCount:t.length,keys:()=>l.f.Array(t)}]}:{fields:g(e._schema),source:[{data:e,rowCount:e._rowCount}]}}}(i||(i={})),function(e){function t(e,t,n){e.startDataBlock(t)
for(const r of n._tableNames)e.writeCategory({name:r,instance:()=>i.ofTable(n[r])})}e.writeDatabase=t,e.writeDatabaseCollection=function(e,n){for(const r of Object.keys(n))t(e,r,n[r])}}(o||(o={})),n(67538),n(70012),n(71695)
class x{constructor(){this.builder=s.f.create(),this.encoded=!1,this.dataBlockCreated=!1,this.filter=i.DefaultFilter,this.formatter=i.DefaultFormatter,this.isBinary=!1,this.binaryEncodingProvider=void 0}setFilter(e){this.filter=e||i.DefaultFilter}isCategoryIncluded(e){return this.filter.includeCategory(e)}setFormatter(e){this.formatter=e||i.DefaultFormatter}startDataBlock(e){this.dataBlockCreated=!0,s.f.write(this.builder,`data_${(e||"").replace(/[ \n\t]/g,"").toUpperCase()}\n#\n`)}writeCategory(e,t,n){if(this.encoded)throw new Error("The writer contents have already been encoded, no more writing.")
if(!this.dataBlockCreated)throw new Error("No data block created.")
if(!(null==n?void 0:n.ignoreFilter)&&!this.filter.includeCategory(e.name))return
const{instance:r,rowCount:o,source:a}=b(e,t)
o&&(1===o?function(e,t,n,r,i,o){const a=v(t),l=n[0],c=l.data
let u=a.reduce((t,n)=>i.includeField(e.name,n.name)?Math.max(t,n.name.length):0,0)
if(0===u)return
u+=e.name.length+6
const d=l.keys().move(),p=_(e.name,t.fields,o)
for(let h=0;h<a.length;h++){const t=a[h]
i.includeField(e.name,t.name)&&(s.f.writePadRight(r,`_${e.name}.${t.name}`,u),S(r,c,d,t,p[h],0)||s.f.newline(r))}s.f.write(r,"#\n")}(e,r,a,this.builder,this.filter,this.formatter):function(e,t,n,r,o,a){const l=v(t),c=o===i.DefaultFilter?l:l.filter(t=>o.includeField(e.name,t.name)),u=c.length
if(0===u)return
const d=_(e.name,c,a)
C(r,"loop_")
for(let i=0;i<u;i++)C(r,`_${e.name}.${c[i].name}`)
let p=0
for(let i=0;i<n.length;i++){const e=n[i],t=e.data
if(0===e.rowCount)continue
const o=e.keys()
for(;o.hasNext;){const e=o.move()
let n=!1
for(let i=0;i<u;i++)n=S(r,t,e,c[i],d[i],p)
n||s.f.newline(r),p++}}s.f.write(r,"#\n")}(e,r,a,this.builder,this.filter,this.formatter))}encode(){this.encoded=!0}writeTo(e){const t=s.f.getChunks(this.builder)
for(let n=0,r=t.length;n<r;n++)e.writeString(t[n])}getSize(){return s.f.getSize(this.builder)}getData(){return s.f.getString(this.builder)}}function S(e,t,n,i,o,l){const c=i.valueKind,u=c?c(n,t):a.VP.ValueKinds.Present
if(u!==a.VP.ValueKinds.Present)u===a.VP.ValueKinds.NotPresent?function(e){s.f.writeSafe(e,". ")}(e):function(e){s.f.writeSafe(e,"? ")}(e)
else{const a=i.value(n,t,l),c=i.type
if(c===r.Type.Str)return"string"==typeof(d=a)&&d.indexOf("\n")>=0?(w(e,a),!0):function(e,t){if(!t)return s.f.writeSafe(e,". "),!1
const n=t.charCodeAt(0)
let r=!1,i=0,o=!1,a=!1
for(let s=0,l=t.length-1;s<=l;s++)switch(t.charCodeAt(s)){case 9:case 32:r=!0
break
case 10:return w(e,t),!0
case 34:if(s&&s===l)break
if(o)return w(e,t),!0
a=!0,r=!0,i=0
break
case 39:if(s&&s===l)break
if(a)return w(e,t),!0
o=!0,r=!0,i=1}return r||35!==n&&36!==n&&59!==n&&91!==n&&93!==n&&95!==n||(r=!0),r?(s.f.writeSafe(e,i?'"':"'"),s.f.writeSafe(e,t),s.f.writeSafe(e,i?'" ':"' ")):(s.f.writeSafe(e,t),s.f.writeSafe(e," ")),!1}(e,a)
c===r.Type.Int?function(e,t){s.f.writeInteger(e,t),s.f.whitespace1(e)}(e,a):function(e,t,n){s.f.writeFloat(e,t,n),s.f.whitespace1(e)}(e,a,o)}var d
return!1}function _(e,t,n){const i=[]
for(const o of t){const t=n.getFormat(e,o.name)
t&&void 0!==t.digitCount?i[i.length]=o.type===r.Type.Float?Math.pow(10,Math.max(0,Math.min(t.digitCount,15))):0:i[i.length]=o.type===r.Type.Float?Math.pow(10,y(o)):0}return i}function C(e,t){s.f.write(e,t),s.f.newline(e)}function w(e,t){s.f.writeSafe(e,"\n;"+t),s.f.writeSafe(e,"\n;\n")}var T=n(4800)
function A(e){const t=new ArrayBuffer(I(e)),n=new DataView(t),r=new Uint8Array(t)
return P(e,n,r,0),r}function I(e){const t=typeof e
if("string"===t){const t=(0,T.VH)(e)
if(t<32)return 1+t
if(t<256)return 2+t
if(t<65536)return 3+t
if(t<4294967296)return 5+t}if(e instanceof Uint8Array){const t=e.byteLength
if(t<256)return 2+t
if(t<65536)return 3+t
if(t<4294967296)return 5+t}if("number"===t){if(Math.floor(e)!==e)return 9
if(e>=0){if(e<128)return 1
if(e<256)return 2
if(e<65536)return 3
if(e<4294967296)return 5
throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return 1
if(e>=-128)return 2
if(e>=-32768)return 3
if(e>=-2147483648)return 5
throw new Error("Number too small -0x"+e.toString(16).substr(1))}if("boolean"===t||null==e)return 1
if("object"===t){let t,n=0
if(Array.isArray(e)){t=e.length
for(let r=0;r<t;r++)n+=I(e[r])}else{const r=Object.keys(e)
t=r.length
for(let i=0;i<t;i++){const t=r[i]
n+=I(t)+I(e[t])}}if(t<16)return 1+n
if(t<65536)return 3+n
if(t<4294967296)return 5+n
throw new Error("Array or object too long 0x"+t.toString(16))}throw new Error("Unknown type "+t)}function P(e,t,n,r){const i=typeof e
if("string"===i){const i=(0,T.VH)(e)
if(i<32)return t.setUint8(r,160|i),(0,T.rj)(n,r+1,e),1+i
if(i<256)return t.setUint8(r,217),t.setUint8(r+1,i),(0,T.rj)(n,r+2,e),2+i
if(i<65536)return t.setUint8(r,218),t.setUint16(r+1,i),(0,T.rj)(n,r+3,e),3+i
if(i<4294967296)return t.setUint8(r,219),t.setUint32(r+1,i),(0,T.rj)(n,r+5,e),5+i}if(e instanceof Uint8Array){const n=e.byteLength,i=new Uint8Array(t.buffer)
if(n<256)return t.setUint8(r,196),t.setUint8(r+1,n),i.set(e,r+2),2+n
if(n<65536)return t.setUint8(r,197),t.setUint16(r+1,n),i.set(e,r+3),3+n
if(n<4294967296)return t.setUint8(r,198),t.setUint32(r+1,n),i.set(e,r+5),5+n}if("number"===i){if(!isFinite(e))throw new Error("Number not finite: "+e)
if(Math.floor(e)!==e)return t.setUint8(r,203),t.setFloat64(r+1,e),9
if(e>=0){if(e<128)return t.setUint8(r,e),1
if(e<256)return t.setUint8(r,204),t.setUint8(r+1,e),2
if(e<65536)return t.setUint8(r,205),t.setUint16(r+1,e),3
if(e<4294967296)return t.setUint8(r,206),t.setUint32(r+1,e),5
throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return t.setInt8(r,e),1
if(e>=-128)return t.setUint8(r,208),t.setInt8(r+1,e),2
if(e>=-32768)return t.setUint8(r,209),t.setInt16(r+1,e),3
if(e>=-2147483648)return t.setUint8(r,210),t.setInt32(r+1,e),5
throw new Error("Number too small -0x"+(-e).toString(16).substr(1))}if(null==e)return t.setUint8(r,192),1
if("boolean"===i)return t.setUint8(r,e?195:194),1
if("object"===i){let i,o=0
const a=Array.isArray(e)
let s
if(a?i=e.length:(s=Object.keys(e),i=s.length),i<16?(t.setUint8(r,i|(a?144:128)),o=1):i<65536?(t.setUint8(r,a?220:222),t.setUint16(r+1,i),o=3):i<4294967296&&(t.setUint8(r,a?221:223),t.setUint32(r+1,i),o=5),a)for(let l=0;l<i;l++)o+=P(e[l],t,n,r+o)
else for(let l=0,c=s.length;l<c;l++){const i=s[l]
o+=P(i,t,n,r+o),o+=P(e[i],t,n,r+o)}return o}throw new Error("Unknown type "+i)}var B,E=n(99153)
class k{setFilter(e){this.filter=e||i.DefaultFilter}isCategoryIncluded(e){return this.filter.includeCategory(e)}setFormatter(e){this.formatter=e||i.DefaultFormatter}startDataBlock(e){this.dataBlocks.push({header:(e||"").replace(/[ \n\t]/g,"").toUpperCase(),categories:[]})}writeCategory(e,t,n){if(!this.data)throw new Error("The writer contents have already been encoded, no more writing.")
if(!this.dataBlocks.length)throw new Error("No data block created.")
if(!(null==n?void 0:n.ignoreFilter)&&!this.filter.includeCategory(e.name))return
const{instance:r,rowCount:i,source:o}=b(e,t)
if(!i)return
const a={name:"_"+e.name,columns:[],rowCount:i},s=v(r)
for(const l of s){if(!this.filter.includeField(e.name,l.name))continue
const t=this.formatter.getFormat(e.name,l.name)
a.columns.push(D(e.name,l,o,i,t,this.binaryEncodingProvider,this.autoClassify))}a.columns.length&&this.dataBlocks[this.dataBlocks.length-1].categories.push(a)}encode(){this.encodedData||(this.encodedData=A(this.data),this.data=null,this.dataBlocks=null)}writeTo(e){e.writeBinary(this.encodedData)}getData(){return this.encode(),this.encodedData}getSize(){return this.encodedData.length}constructor(e,t,n){this.autoClassify=n,this.dataBlocks=[],this.filter=i.DefaultFilter,this.formatter=i.DefaultFormatter,this.isBinary=!0,this.binaryEncodingProvider=void 0,this.binaryEncodingProvider=t,this.data={encoder:e,version:c.xv,dataBlocks:this.dataBlocks}}}function D(e,t,n,i,o,s,l){const{array:u,allPresent:d,mask:p}=function(e,t,n,i){const o=e.type===r.Type.Str,s=new t(n),l=new Uint8Array(n),c=e.valueKind,u=e.value
let d=!0,p=0
for(let r=0;r<i.length;r++){const e=i[r].data,t=i[r].keys()
for(;t.hasNext;){const n=t.move(),r=c?c(n,e):a.VP.ValueKinds.Present
if(r!==a.VP.ValueKinds.Present)l[p]=r,o&&(s[p]=""),d=!1
else{const t=u(n,e,p)
"string"!=typeof t||t?l[p]=a.VP.ValueKinds.Present:(l[p]=a.VP.ValueKinds.NotPresent,d=!1),s[p]=t}p++}}return{array:s,allPresent:d,mask:l}}(t,function(e,t){return t&&t.typedArray?t.typedArray:e.defaultFormat&&e.defaultFormat.typedArray?e.defaultFormat.typedArray:e.type===r.Type.Str?Array:e.type===r.Type.Int?Int32Array:Float64Array}(t,o),i,n)
let h
h=t.type===r.Type.Str?c.ar.by(c.ND.stringArray):function(e,t,n,r){return n&&n.encoder?n.encoder:t.defaultFormat&&t.defaultFormat.encoder?t.defaultFormat.encoder:r?r.get(e,t.name):void 0}(e,t,o,s),h||(h=l?function(e,t){return e===r.Type.Str?c.ar.by(c.ND.stringArray):e===r.Type.Int?(0,E.P)(t):(0,E.O)(t)}(t.type,u):t.type===r.Type.Str?c.ar.by(c.ND.stringArray):c.ar.by(c.ND.byteArray))
const f=h.encode(u)
let m
if(!d){const e=c.ar.by(c.ND.runLength).and(c.ND.byteArray).encode(p)
m=e.data.length<p.length?e:c.ar.by(c.ND.byteArray).encode(p)}return{name:t.name,data:f,mask:m}}!function(e){e.Encoder=o,e.Category=i,e.Field=r,e.Encoding=c.ND,e.createEncoder=function(e){const{binary:t=!1,encoderName:n="mol*"}=e||{}
return t?new k(n,e?e.binaryEncodingPovider:void 0,!!e&&!!e.binaryAutoClassifyEncoding):new x},e.fields=function(){return e.Field.build()}
var t=e.Encoding
function n(e){const n=e.precision
if(void 0!==n){const r=Math.pow(10,n),i=t.by(t.fixedPoint(r))
switch(e.encoding){case"pack":return i.and(t.integerPacking)
case"rle":return i.and(t.runLength).and(t.integerPacking)
case"delta":return i.and(t.delta).and(t.integerPacking)
case"delta-rle":return i.and(t.delta).and(t.runLength).and(t.integerPacking)}}else switch(e.encoding){case"pack":return t.by(t.integerPacking)
case"rle":return t.by(t.runLength).and(t.integerPacking)
case"delta":return t.by(t.delta).and(t.integerPacking)
case"delta-rle":return t.by(t.delta).and(t.runLength).and(t.integerPacking)}throw new Error("cannot be reached")}e.Encodings={deltaRLE:t.by(t.delta).and(t.runLength).and(t.integerPacking),fixedPoint2:t.by(t.fixedPoint(100)).and(t.delta).and(t.integerPacking),fixedPoint3:t.by(t.fixedPoint(1e3)).and(t.delta).and(t.integerPacking)},e.categoryInstance=function(e,t){return{fields:e,source:[t]}},e.createEncodingProviderFromCifFrame=function(e){return{get(t,n){const r=e.categories[t]
if(!r)return
const i=r.getField(n)
return i&&i.binaryEncoding?c.ar.fromEncoding(i.binaryEncoding):void 0}}},e.createEncodingProviderFromJsonConfig=function(e){return{get(t,r){for(let i=0;i<e.length;i++){const o=e[i]
if(o.categoryName===t&&o.columnName===r)return n(o)}}}}}(B||(B={}))},28901(e,t,n){"use strict"
n.d(t,{MR:()=>u,Pd:()=>c,nN:()=>l})
var r,i=n(24762),o=n(32775),a=n(9043),s=n(48298)
function l(e,t,n){const r={}
for(const i of t.blocks)r[i.header]=c(e,i,n)
return r}function c(e,t,n){return function(e,t,n){const r=Object.create(null)
for(const i of Object.keys(e))r[i]=y(i,e[i],t,n)
return i.Wm.ofTables(t.header,e,r)}(e,t,n)}function u(e,t){return new m(t,e,!0)}function d(e){switch(e.valueType){case"str":return(t,n,r)=>{return i=e,o=t,a=t.str,s=t.toStringArray,{schema:i,__array:o.__array,isDefined:o.isDefined,rowCount:o.rowCount,value:"lowercase"===i.transform?e=>a(e).toLowerCase():"uppercase"===i.transform?e=>a(e).toUpperCase():a,valueKind:o.valueKind,areValuesEqual:o.areValuesEqual,toArray:"lowercase"===i.transform?e=>Array.from(s(e)).map(e=>e.toLowerCase()):"uppercase"===i.transform?e=>Array.from(s(e)).map(e=>e.toUpperCase()):s}
var i,o,a,s}
case"int":return(t,n,r)=>p(e,t,t.int,t.toIntArray)
case"float":return(t,n,r)=>p(e,t,t.float,t.toFloatArray)
case"list":throw new Error("Use createListColumn instead.")
case"tensor":throw new Error("Use createTensorColumn instead.")}}function p(e,t,n,r){return{schema:e,__array:t.__array,isDefined:t.isDefined,rowCount:t.rowCount,value:n,valueKind:t.valueKind,areValuesEqual:t.areValuesEqual,toArray:r}}function h(e,t,n){const r=e.separator,o=e.itemParse,s=t.getField(n),l=s?e=>s.str(e).split(r).map(e=>o(e.trim())).filter(e=>!!e):e=>[]
return{schema:e,__array:void 0,isDefined:!!s,rowCount:t.rowCount,value:l,valueKind:s?s.valueKind:()=>i.VP.ValueKinds.NotPresent,areValuesEqual:(e,t)=>(0,a.af)(l(e),l(t)),toArray:e=>i.iu.createAndFillArray(t.rowCount,l,e)}}function f(e,t,n){const r=e.space,a=t.fieldNames.includes(`${n}[0]`)||t.fieldNames.includes(`${n}[0][0]`)||t.fieldNames.includes(`${n}[0][0][0]`),l=a?0:1,c=t.fieldNames.includes(`${n}_1`)||t.fieldNames.includes(`${n}_11`)||t.fieldNames.includes(`${n}_111`)?"underscore":"brackets",u=s.G(n,r.rank,a,c),d=t.getField(u(l,l,l))||i.VP.Undefined(t.rowCount,e),p=e=>s.cS(t,r,e,u)
return{schema:e,__array:void 0,isDefined:d.isDefined,rowCount:t.rowCount,value:p,valueKind:d.valueKind,areValuesEqual:(e,t)=>o.qY.areEqualExact(p(e),p(t)),toArray:e=>i.iu.createAndFillArray(t.rowCount,p,e)}}!function(e){function t(e){return e.replace(".","_").replace(/\[/,"_").replace(/(\[|\])/g,"")}e.canonical=t,e.equal=function(e,n){return t(e)===t(n)},e.create=function(e,n,r=!1){const i=`${e}${n?`.${n}`:""}`
return r?t(i):i}}(r||(r={}))
class m{constructor(e,t,n){this._isDefined=n
const r=Object.keys(t)
this._rowCount=e.rowCount,this._columns=r,this._schema=t
const o=Object.create(null)
for(const a of r)Object.defineProperty(this,a,{get:function(){if(o[a])return o[a]
const n=t[a]
if("list"===n.valueType)o[a]=h(n,e,a)
else if("tensor"===n.valueType)o[a]=f(n,e,a)
else{const t=d(n),r=e.getField(a)
o[a]=r?t(r,e,a):i.VP.Undefined(e.rowCount,n)}return o[a]},enumerable:!0,configurable:!1})}}function g(e,t,n,i){const o=r.create(t,e),a=r.canonical(o)
if(a in n)return n[a]
if(i&&o in i)for(const s of i[o]){const e=r.canonical(s)
if(e in n)return n[e]}}function y(e,t,n,i){let o=n.categories[e]
if(i){const a=function(e){const t=Object.create(null)
for(const n of Object.keys(e.categories))for(const i of e.categories[n].fieldNames)t[r.create(n,i,!0)]=e.categories[n].getField(i)
return t}(n),s=Object.create(null),l=[]
let c=0
for(const n of Object.keys(t)){const t=g(n,e,a,i)
t&&(s[n]=t,l.push(n),c=t.rowCount)}o={rowCount:c,name:e,fieldNames:[...l],getField:e=>s[e]}}return new m(o||s.xA.empty(e),t,!!o)}},29067(e,t,n){"use strict"
n.d(t,{O:()=>r})
var r,i=n(70012),o=n(67538)
function a(e,t,n,r,i){const{b:s,offset:l}=e,c=[]
for(let a=0,u=t.length;a<u;++a){const e=t[a]
for(let t=l[e],r=l[e+1];t<r;++t){const e=s[t]
if(!i.has(e)){if(o.X9.has(n,e))return!0
i.add(e),c[c.length]=e}}}return r>1&&a(e,c,n,r-1,i)}!function(e){e.areEqual=function(e,t){if(e===t)return!0
if(e.vertexCount!==t.vertexCount||e.edgeCount!==t.edgeCount)return!1
const{a:n,b:r,offset:i}=e,{a:o,b:a,offset:s}=t
for(let l=0,c=e.a.length;l<c;l++)if(n[l]!==o[l])return!1
for(let l=0,c=e.b.length;l<c;l++)if(r[l]!==a[l])return!1
for(let l=0,c=e.offset.length;l<c;l++)if(i[l]!==s[l])return!1
for(const l of Object.keys(e.edgeProps)){const n=e.edgeProps[l],r=t.edgeProps[l]
if(!r)return!1
for(let e=0,t=n.length;e<t;e++)if(n[e]!==r[e])return!1}return!0}
class t{getEdgeIndex(e,t){let n,r
e<t?(n=e,r=t):(n=t,r=e)
for(let i=this.offset[n],o=this.offset[n+1];i<o;i++)if(this.b[i]===r)return i
return-1}getDirectedEdgeIndex(e,t){for(let n=this.offset[e],r=this.offset[e+1];n<r;n++)if(this.b[n]===t)return n
return-1}getVertexEdgeCount(e){return this.offset[e+1]-this.offset[e]}constructor(e,t,n,r,i,o){this.offset=e,this.a=t,this.b=n,this.edgeCount=r,this.props=o,this.vertexCount=e.length-1,this.edgeProps=i||{}}}function n(e,n,r,i,o,a){return new t(e,n,r,i,o,a)}e.create=n
class r{createGraph(e,t){return n(this.offsets,this.a,this.b,this.edgeCount,e,t)}addNextEdge(){const e=this.xs[this.current],t=this.ys[this.current],n=this.offsets[e]+this.bucketFill[e]
this.a[n]=e,this.b[n]=t,this.bucketFill[e]++
const r=this.offsets[t]+this.bucketFill[t]
this.a[r]=t,this.b[r]=e,this.bucketFill[t]++,this.current++,this.curA=n,this.curB=r}addAllEdges(){for(let e=0;e<this.edgeCount;e++)this.addNextEdge()}assignProperty(e,t){e[this.curA]=t,e[this.curB]=t}assignDirectedProperty(e,t,n,r){e[this.curA]=t,e[this.curB]=r,n[this.curB]=t,n[this.curA]=r}constructor(e,t,n){this.vertexCount=e,this.xs=t,this.ys=n,this.current=0,this.curA=0,this.curB=0,this.edgeCount=t.length,this.offsets=new Int32Array(this.vertexCount+1),this.bucketFill=new Int32Array(this.vertexCount)
const r=new Int32Array(this.vertexCount)
for(let o=0,a=this.xs.length;o<a;o++)r[this.xs[o]]++
for(let o=0,a=this.ys.length;o<a;o++)r[this.ys[o]]++
let i=0
for(let o=0;o<this.vertexCount;o++)this.offsets[o]=i,i+=r[o]
this.offsets[this.vertexCount]=i,this.slotCount=i,this.a=new Int32Array(i),this.b=new Int32Array(i)}}function s(t,n,r){const i=new e.EdgeBuilder(t,n,r)
return i.addAllEdges(),i.createGraph({})}e.EdgeBuilder=r,e.DirectedEdgeBuilder=class{createGraph(e,t){return n(this.offsets,this.a,this.b,this.edgeCount,e,t)}addNextEdge(){const e=this.xs[this.current],t=this.ys[this.current],n=this.offsets[e]+this.bucketFill[e]
this.a[n]=e,this.b[n]=t,this.bucketFill[e]++,this.current++,this.curA=n}addAllEdges(){for(let e=0;e<this.edgeCount;e++)this.addNextEdge()}assignProperty(e,t){e[this.curA]=t}constructor(e,t,n){this.vertexCount=e,this.xs=t,this.ys=n,this.current=0,this.curA=0,this.edgeCount=t.length,this.offsets=new Int32Array(this.vertexCount+1),this.bucketFill=new Int32Array(this.vertexCount)
const r=new Int32Array(this.vertexCount)
for(let o=0,a=this.xs.length;o<a;o++)r[this.xs[o]]++
let i=0
for(let o=0;o<this.vertexCount;o++)this.offsets[o]=i,i+=r[o]
this.offsets[this.vertexCount]=i,this.slotCount=i,this.a=new Int32Array(i),this.b=new Int32Array(i)}},e.UniqueEdgeBuilder=class{addEdge(e,t){let n=e,r=t
e>t&&(n=t,r=e)
const o=(0,i.m1)(n,r)
return!this.included.has(o)&&(this.included.add(o),this.xs[this.xs.length]=n,this.ys[this.ys.length]=r,!0)}getGraph(){return s(this.vertexCount,this.xs,this.ys)}getEdgeBuiler(){return new r(this.vertexCount,this.xs,this.ys)}constructor(e){this.vertexCount=e,this.xs=[],this.ys=[],this.included=new Set}},e.fromVertexPairs=s,e.induceByVertices=function(e,t,r){const{b:o,offset:a,vertexCount:s,edgeProps:l}=e,c=new Int32Array(s)
for(let n=0,i=t.length;n<i;n++)c[t[n]]=n+1
let u=0
for(let n=0;n<s;n++)if(0!==c[n])for(let e=a[n],t=a[n+1];e<t;e++)o[e]>n&&0!==c[o[e]]&&u++
const d=new Int32Array(t.length+1),p=new Int32Array(2*u),h=new Int32Array(2*u),f=new Int32Array(2*u)
let m=0,g=0
for(let n=0;n<s;n++){if(0===c[n])continue
const e=c[n]-1
for(let t=a[n],r=a[n+1];t<r;t++){const n=c[o[t]]
0!==n&&(h[m]=e,f[m]=n-1,p[m]=t,m++)}d[++g]=m}const y={}
for(const n of Object.keys(l))y[n]=(0,i.qI)(l[n],p)
return n(d,h,f,u,y,r)},e.connectedComponents=function(e){const t=e.vertexCount
if(0===t)return{componentCount:0,componentIndex:new Int32Array(0)}
if(0===e.edgeCount){const e=new Int32Array(t)
for(let n=0,r=t;n<r;n++)e[n]=n
return{componentCount:t,componentIndex:e}}const n=new Int32Array(t)
for(let o=0,c=t;o<c;o++)n[o]=-1
let r=0
n[0]=r
const{offset:i,b:a}=e,s=[0],l=(0,o.YB)(t)
for(l.remove(0);s.length>0;){const e=s.pop(),t=n[e]
for(let r=i[e],o=i[e+1];r<o;r++){const e=a[r]
l.has(e)&&(l.remove(e),s.push(e),n[e]=t)}0===s.length&&l.head>=0&&(s.push(l.head),n[l.head]=++r,l.remove(l.head))}return{componentCount:t,componentIndex:n}},e.areVertexSetsConnected=function(e,t,n,r){if(o.X9.areIntersecting(t,n))return!0
if(r<1)return!1
const i=new Set
for(let o=0,a=t.length;o<a;++o)i.add(t[o])
return a(e,t,n,r,i)}}(r||(r={}))},29218(e,t,n){"use strict"
function r(e){return e.reduce((e,t)=>Number(e)*Number(t))}n.r(t),n.d(t,{default:()=>i,mult:()=>r})
var i=(0,n(10336).helper)(r)},29282(e,t,n){"use strict"
n.d(t,{r:()=>h})
var r=n(24762).VP.Schema
const i=r.str,o=r.int,a=r.float,s=r.coord,l=r.Aliased,c=r.Matrix,u=r.Vector,d=r.lstr,p=r.List,h={atom_site:{auth_asym_id:i,auth_atom_id:i,auth_comp_id:i,auth_seq_id:o,B_iso_or_equiv:a,Cartn_x:s,Cartn_y:s,Cartn_z:s,group_PDB:l(i),id:o,label_alt_id:i,label_asym_id:i,label_atom_id:i,label_comp_id:i,label_entity_id:i,label_seq_id:o,occupancy:a,type_symbol:i,pdbx_PDB_ins_code:i,pdbx_PDB_model_num:o,pdbx_formal_charge:o,pdbx_label_index:o,pdbx_sifts_xref_db_name:i,pdbx_sifts_xref_db_acc:i,pdbx_sifts_xref_db_num:i,pdbx_sifts_xref_db_res:i,ihm_model_id:o},atom_site_anisotrop:{id:o,type_symbol:i,U:c(3,3),U_esd:c(3,3),pdbx_auth_seq_id:o,pdbx_auth_asym_id:i,pdbx_auth_atom_id:i,pdbx_auth_comp_id:i,pdbx_label_seq_id:o,pdbx_label_alt_id:i,pdbx_label_asym_id:i,pdbx_label_atom_id:i,pdbx_label_comp_id:i,pdbx_PDB_ins_code:i},atom_sites:{entry_id:i,fract_transf_matrix:c(3,3),fract_transf_vector:u(3)},audit_author:{name:i,pdbx_ordinal:o,identifier_ORCID:i},audit_conform:{dict_location:i,dict_name:i,dict_version:i},cell:{angle_alpha:a,angle_beta:a,angle_gamma:a,entry_id:i,length_a:a,length_b:a,length_c:a,Z_PDB:o,pdbx_unique_axis:i},chem_comp:{formula:i,formula_weight:a,id:i,mon_nstd_flag:l(d),name:i,type:l(d),pdbx_synonyms:p(";",e=>e)},chem_comp_bond:{atom_id_1:i,atom_id_2:i,comp_id:i,value_order:l(d),pdbx_ordinal:o,pdbx_stereo_config:l(d),pdbx_aromatic_flag:l(d)},citation:{book_publisher:i,country:i,id:i,journal_abbrev:i,journal_id_ASTM:i,journal_id_CSD:i,journal_id_ISSN:i,journal_volume:i,page_first:i,page_last:i,title:i,year:o,pdbx_database_id_DOI:i,pdbx_database_id_PubMed:o},citation_author:{citation_id:i,name:i,ordinal:o},database_2:{database_id:l(d),database_code:i},entity:{details:i,formula_weight:a,id:i,src_method:l(d),type:l(d),pdbx_description:p(",",e=>e),pdbx_number_of_molecules:o,pdbx_parent_entity_id:i,pdbx_mutation:i,pdbx_fragment:i,pdbx_ec:p(",",e=>e)},entity_poly:{entity_id:i,nstd_linkage:l(d),nstd_monomer:l(d),type:l(i),pdbx_strand_id:p(",",e=>e),pdbx_seq_one_letter_code:i,pdbx_seq_one_letter_code_can:i,pdbx_target_identifier:i},entity_poly_seq:{entity_id:i,hetero:l(d),mon_id:i,num:o},entry:{id:i},exptl:{entry_id:i,method:l(i)},software:{classification:i,date:i,description:i,name:i,type:l(d),version:i,pdbx_ordinal:o},struct:{entry_id:i,title:i,pdbx_structure_determination_methodology:l(i),pdbx_descriptor:i},struct_asym:{details:i,entity_id:i,id:i,pdbx_modified:i,pdbx_blank_PDB_chainid_flag:l(i)},struct_conf:{beg_label_asym_id:i,beg_label_comp_id:i,beg_label_seq_id:o,beg_auth_asym_id:i,beg_auth_comp_id:i,beg_auth_seq_id:o,conf_type_id:l(d),details:i,end_label_asym_id:i,end_label_comp_id:i,end_label_seq_id:o,end_auth_asym_id:i,end_auth_comp_id:i,end_auth_seq_id:o,id:i,pdbx_beg_PDB_ins_code:i,pdbx_end_PDB_ins_code:i,pdbx_PDB_helix_class:i,pdbx_PDB_helix_length:o,pdbx_PDB_helix_id:i},struct_conn:{conn_type_id:l(d),details:i,id:i,ptnr1_label_asym_id:i,ptnr1_label_atom_id:i,ptnr1_label_comp_id:i,ptnr1_label_seq_id:o,ptnr1_auth_asym_id:i,ptnr1_auth_comp_id:i,ptnr1_auth_seq_id:o,ptnr1_symmetry:i,ptnr2_label_asym_id:i,ptnr2_label_atom_id:i,ptnr2_label_comp_id:i,ptnr2_label_seq_id:o,ptnr2_auth_asym_id:i,ptnr2_auth_comp_id:i,ptnr2_auth_seq_id:o,ptnr2_symmetry:i,pdbx_ptnr1_PDB_ins_code:i,pdbx_ptnr1_label_alt_id:i,pdbx_ptnr1_standard_comp_id:i,pdbx_ptnr2_PDB_ins_code:i,pdbx_ptnr2_label_alt_id:i,pdbx_ptnr3_PDB_ins_code:i,pdbx_ptnr3_label_alt_id:i,pdbx_ptnr3_label_asym_id:i,pdbx_ptnr3_label_atom_id:i,pdbx_ptnr3_label_comp_id:i,pdbx_ptnr3_label_seq_id:o,pdbx_PDB_id:i,pdbx_dist_value:a,pdbx_value_order:l(d)},struct_conn_type:{criteria:i,id:l(d),reference:i},struct_keywords:{entry_id:i,text:p(",",e=>e),pdbx_keywords:i},struct_mon_prot_cis:{label_alt_id:i,label_asym_id:i,label_comp_id:i,label_seq_id:o,auth_asym_id:i,auth_comp_id:i,auth_seq_id:o,pdbx_auth_asym_id_2:i,pdbx_auth_comp_id_2:i,pdbx_auth_seq_id_2:o,pdbx_label_asym_id_2:i,pdbx_label_comp_id_2:i,pdbx_label_seq_id_2:o,pdbx_PDB_ins_code:i,pdbx_PDB_ins_code_2:i,pdbx_PDB_model_num:o,pdbx_omega_angle:i,pdbx_id:i,pdbx_auth_ins_code:i,pdbx_auth_ins_code_2:i},struct_ncs_oper:{code:l(i),details:i,id:o,matrix:c(3,3),vector:u(3)},struct_sheet_range:{beg_label_asym_id:i,beg_label_comp_id:i,beg_label_seq_id:o,end_label_asym_id:i,end_label_comp_id:i,end_label_seq_id:o,beg_auth_asym_id:i,beg_auth_comp_id:i,beg_auth_seq_id:o,end_auth_asym_id:i,end_auth_comp_id:i,end_auth_seq_id:o,id:i,sheet_id:i,pdbx_beg_PDB_ins_code:i,pdbx_end_PDB_ins_code:i},struct_site:{details:i,id:i,pdbx_num_residues:o,pdbx_evidence_code:i,pdbx_auth_asym_id:i,pdbx_auth_comp_id:i,pdbx_auth_seq_id:o,pdbx_auth_ins_code:i},struct_site_gen:{details:i,id:i,label_alt_id:i,label_asym_id:i,label_atom_id:i,label_comp_id:i,label_seq_id:o,auth_asym_id:i,auth_atom_id:i,auth_comp_id:i,auth_seq_id:o,site_id:i,symmetry:i,pdbx_auth_ins_code:i,pdbx_num_res:o},struct_site_keywords:{site_id:i,text:i},symmetry:{entry_id:i,cell_setting:l(d),Int_Tables_number:o,space_group_name_Hall:i,"space_group_name_H-M":i},pdbx_database_status:{status_code:l(i),status_code_sf:l(i),status_code_mr:l(i),entry_id:i,recvd_initial_deposition_date:i,SG_entry:l(d),deposit_site:l(i),process_site:l(i),status_code_cs:l(i),methods_development_category:l(i),pdb_format_compatible:l(d)},pdbx_nonpoly_scheme:{asym_id:i,entity_id:i,mon_id:i,pdb_strand_id:i,ndb_seq_num:i,pdb_seq_num:i,auth_seq_num:i,pdb_mon_id:i,auth_mon_id:i,pdb_ins_code:i},pdbx_database_related:{db_name:l(i),details:i,db_id:i,content_type:l(i)},pdbx_entity_nonpoly:{entity_id:i,comp_id:i,name:i},pdbx_chem_comp_synonyms:{name:i,comp_id:i,provenance:l(i)},pdbx_chem_comp_identifier:{comp_id:i,identifier:i,type:l(i),program:i,program_version:i},pdbx_unobs_or_zero_occ_residues:{id:o,polymer_flag:l(d),occupancy_flag:l(o),PDB_model_num:o,auth_asym_id:i,auth_comp_id:i,auth_seq_id:o,PDB_ins_code:i,label_asym_id:i,label_comp_id:i,label_seq_id:o},pdbx_struct_mod_residue:{id:o,auth_asym_id:i,auth_comp_id:i,auth_seq_id:o,PDB_ins_code:i,label_asym_id:i,label_comp_id:i,label_seq_id:o,parent_comp_id:i,details:i},pdbx_struct_oper_list:{id:i,type:l(i),name:i,symmetry_operation:i,matrix:c(3,3),vector:u(3)},pdbx_struct_assembly:{method_details:i,oligomeric_details:i,oligomeric_count:o,details:i,id:i},pdbx_struct_assembly_gen:{asym_id_list:p(",",e=>e),assembly_id:i,oper_expression:i},pdbx_reference_entity_list:{prd_id:i,ref_entity_id:i,type:l(d),details:i,component_id:o},pdbx_reference_entity_link:{link_id:o,prd_id:i,details:i,ref_entity_id_1:i,ref_entity_id_2:i,entity_seq_num_1:o,entity_seq_num_2:o,comp_id_1:i,comp_id_2:i,atom_id_1:i,atom_id_2:i,value_order:l(d),component_1:o,component_2:o,link_class:l(i)},pdbx_reference_entity_poly_link:{link_id:o,prd_id:i,ref_entity_id:i,component_id:o,entity_seq_num_1:o,entity_seq_num_2:o,comp_id_1:i,comp_id_2:i,atom_id_1:i,atom_id_2:i,value_order:l(d)},pdbx_molecule:{prd_id:i,instance_id:o,asym_id:i},pdbx_molecule_features:{prd_id:i,class:l(d),type:l(d),name:i,details:i},entity_src_nat:{entity_id:i,pdbx_organism_scientific:i,pdbx_plasmid_name:i,pdbx_src_id:o,pdbx_beg_seq_num:o,pdbx_end_seq_num:o},entity_src_gen:{entity_id:i,pdbx_gene_src_gene:p(",",e=>e),pdbx_gene_src_scientific_name:i,plasmid_name:i,pdbx_src_id:o,pdbx_beg_seq_num:o,pdbx_end_seq_num:o},pdbx_entity_src_syn:{organism_scientific:i,entity_id:i,pdbx_src_id:o,pdbx_beg_seq_num:o,pdbx_end_seq_num:o},pdbx_entity_branch_descriptor:{entity_id:i,descriptor:i,type:l(d),program:i,program_version:i,ordinal:o},pdbx_entity_instance_feature:{details:i,feature_type:l(i),auth_asym_id:i,asym_id:i,auth_seq_num:i,seq_num:o,comp_id:i,auth_comp_id:i,ordinal:o},pdbx_entity_branch_list:{entity_id:i,hetero:l(d),comp_id:i,num:o},pdbx_entity_branch_link:{link_id:o,details:i,entity_id:i,entity_branch_list_num_1:o,entity_branch_list_num_2:o,comp_id_1:i,comp_id_2:i,atom_id_1:i,leaving_atom_id_1:i,atom_stereo_config_1:l(d),atom_id_2:i,leaving_atom_id_2:i,atom_stereo_config_2:l(d),value_order:l(d)},pdbx_entity_branch:{entity_id:i,type:l(i)},pdbx_branch_scheme:{entity_id:i,hetero:l(d),asym_id:i,mon_id:i,num:o,pdb_asym_id:i,pdb_seq_num:i,pdb_mon_id:i,auth_asym_id:i,auth_seq_num:i,auth_mon_id:i},pdbx_chem_comp_related:{comp_id:i,related_comp_id:i,relationship_type:l(i),details:i},ihm_starting_model_details:{starting_model_id:i,entity_id:i,entity_description:i,asym_id:i,entity_poly_segment_id:o,starting_model_source:l(i),starting_model_auth_asym_id:i,starting_model_sequence_offset:o,dataset_list_id:o},ihm_starting_comparative_models:{id:o,starting_model_id:i,starting_model_auth_asym_id:i,starting_model_seq_id_begin:o,starting_model_seq_id_end:o,template_auth_asym_id:i,template_seq_id_begin:o,template_seq_id_end:o,template_sequence_identity:a,template_sequence_identity_denominator:l(o),template_dataset_list_id:o,alignment_file_id:o},ihm_starting_model_seq_dif:{id:o,entity_id:i,asym_id:i,seq_id:o,comp_id:i,starting_model_id:i,db_asym_id:i,db_seq_id:o,db_comp_id:i,details:i},ihm_model_representation:{id:o,name:i,details:i},ihm_model_representation_details:{id:o,representation_id:o,entity_poly_segment_id:o,entity_id:i,entity_description:i,entity_asym_id:i,model_object_primitive:l(i),starting_model_id:i,model_mode:l(i),model_granularity:l(i),model_object_count:o},ihm_struct_assembly_details:{id:o,assembly_id:o,parent_assembly_id:o,entity_description:i,entity_id:i,asym_id:i,entity_poly_segment_id:o},ihm_struct_assembly:{id:o,name:i,description:i},ihm_modeling_protocol:{id:o,num_steps:o,protocol_name:i},ihm_modeling_protocol_details:{id:o,protocol_id:o,step_id:o,struct_assembly_id:o,dataset_group_id:o,struct_assembly_description:i,step_name:i,step_method:i,num_models_begin:o,num_models_end:o,multi_scale_flag:l(d),multi_state_flag:l(d),ordered_flag:l(d),script_file_id:o,software_id:o},ihm_multi_state_modeling:{state_id:o,state_group_id:o,population_fraction:a,population_fraction_sd:a,state_type:i,state_name:i,experiment_type:l(i),details:i},ihm_modeling_post_process:{id:o,protocol_id:o,analysis_id:o,step_id:o,type:l(i),feature:l(i),num_models_begin:o,num_models_end:o},ihm_ensemble_info:{ensemble_id:o,ensemble_name:i,post_process_id:o,model_group_id:o,ensemble_clustering_method:l(i),ensemble_clustering_feature:l(i),num_ensemble_models:o,num_ensemble_models_deposited:o,ensemble_precision_value:a,ensemble_file_id:o},ihm_model_list:{model_id:o,model_name:i,assembly_id:o,protocol_id:o,representation_id:o},ihm_model_group:{id:o,name:i,details:i},ihm_model_group_link:{model_id:o,group_id:o},ihm_model_representative:{id:o,model_group_id:o,model_id:o,selection_criteria:l(i)},ihm_dataset_list:{id:o,data_type:l(i),database_hosted:l(d)},ihm_dataset_group:{id:o,name:i,application:l(i),details:i},ihm_dataset_group_link:{dataset_list_id:o,group_id:o},ihm_related_datasets:{dataset_list_id_derived:o,dataset_list_id_primary:o},ihm_dataset_related_db_reference:{id:o,dataset_list_id:o,db_name:l(i),accession_code:i,version:i,details:i},ihm_external_reference_info:{reference_id:o,reference_provider:i,reference_type:l(i),reference:i,refers_to:l(i),associated_url:i},ihm_external_files:{id:o,reference_id:o,file_path:i,content_type:l(i),file_size_bytes:a,details:i},ihm_dataset_external_reference:{id:o,dataset_list_id:o,file_id:o},ihm_localization_density_files:{id:o,file_id:o,ensemble_id:o,entity_id:i,entity_poly_segment_id:o,asym_id:i},ihm_predicted_contact_restraint:{id:o,group_id:o,entity_id_1:i,entity_id_2:i,asym_id_1:i,asym_id_2:i,comp_id_1:i,comp_id_2:i,seq_id_1:o,seq_id_2:o,rep_atom_1:l(i),rep_atom_2:l(i),distance_lower_limit:a,distance_upper_limit:a,probability:a,restraint_type:l(i),model_granularity:l(i),dataset_list_id:o,software_id:o},ihm_cross_link_list:{id:o,group_id:o,entity_description_1:i,entity_description_2:i,entity_id_1:i,entity_id_2:i,comp_id_1:i,comp_id_2:i,seq_id_1:o,seq_id_2:o,linker_type:l(i),dataset_list_id:o},ihm_cross_link_restraint:{id:o,group_id:o,entity_id_1:i,entity_id_2:i,asym_id_1:i,asym_id_2:i,comp_id_1:i,comp_id_2:i,seq_id_1:o,seq_id_2:o,atom_id_1:i,atom_id_2:i,restraint_type:l(i),conditional_crosslink_flag:l(i),model_granularity:l(i),distance_threshold:a,psi:a,sigma_1:a,sigma_2:a},ihm_cross_link_result_parameters:{id:o,restraint_id:o,model_id:o,psi:a,sigma_1:a,sigma_2:a},ihm_2dem_class_average_restraint:{id:o,dataset_list_id:o,number_raw_micrographs:o,pixel_size_width:a,pixel_size_height:a,image_resolution:a,image_segment_flag:l(d),number_of_projections:o,struct_assembly_id:o,details:i},ihm_2dem_class_average_fitting:{id:o,restraint_id:o,model_id:o,cross_correlation_coefficient:a,rot_matrix:c(3,3),tr_vector:u(3)},ihm_3dem_restraint:{id:o,dataset_list_id:o,model_id:o,struct_assembly_id:o,fitting_method:i,number_of_gaussians:o,cross_correlation_coefficient:a},ihm_sas_restraint:{id:o,dataset_list_id:o,model_id:o,struct_assembly_id:o,profile_segment_flag:l(d),fitting_atom_type:i,fitting_method:i,fitting_state:l(i),radius_of_gyration:a,chi_value:a,details:i},ihm_starting_model_coord:{ordinal_id:o,starting_model_id:i,group_PDB:l(i),id:o,type_symbol:i,entity_id:i,atom_id:i,comp_id:i,seq_id:o,asym_id:i,Cartn_x:a,Cartn_y:a,Cartn_z:a,B_iso_or_equiv:a},ihm_sphere_obj_site:{id:o,entity_id:i,seq_id_begin:o,seq_id_end:o,asym_id:i,Cartn_x:a,Cartn_y:a,Cartn_z:a,object_radius:a,rmsf:a,model_id:o},ihm_gaussian_obj_site:{id:o,entity_id:i,seq_id_begin:o,seq_id_end:o,asym_id:i,mean_Cartn_x:a,mean_Cartn_y:a,mean_Cartn_z:a,weight:a,covariance_matrix:c(3,3),model_id:o},ihm_gaussian_obj_ensemble:{id:o,entity_id:i,seq_id_begin:o,seq_id_end:o,asym_id:i,mean_Cartn_x:a,mean_Cartn_y:a,mean_Cartn_z:a,weight:a,covariance_matrix:c(3,3),ensemble_id:o},ihm_feature_list:{feature_id:o,feature_type:l(i),entity_type:l(i)},ihm_poly_residue_feature:{ordinal_id:o,feature_id:o,entity_id:i,asym_id:i,comp_id_begin:i,comp_id_end:i,seq_id_begin:o,seq_id_end:o},ihm_derived_distance_restraint:{id:o,group_id:o,feature_id_1:o,feature_id_2:o,group_conditionality:l(i),random_exclusion_fraction:a,distance_upper_limit:a,restraint_type:l(i),dataset_list_id:o},ma_model_list:{ordinal_id:o,model_id:o,model_group_id:o,model_name:i,model_group_name:i,model_type:l(i),data_id:o},ma_target_entity:{entity_id:i,data_id:o,origin:l(i)},ma_target_entity_instance:{asym_id:i,entity_id:i,details:i},ma_target_ref_db_details:{target_entity_id:i,db_name:l(i),db_code:i,db_accession:i,seq_db_isoform:i,seq_db_align_begin:i,seq_db_align_end:i,ncbi_taxonomy_id:i,organism_scientific:i},ma_data:{id:o,content_type:l(i),content_type_other_details:i,name:i},ma_software_group:{ordinal_id:o,group_id:o,software_id:o},ma_qa_metric:{id:o,name:i,type:l(i),mode:l(i),software_group_id:o},ma_qa_metric_global:{ordinal_id:o,model_id:o,metric_id:o,metric_value:a},ma_qa_metric_local:{ordinal_id:o,model_id:o,label_asym_id:i,label_seq_id:o,label_comp_id:i,metric_id:o,metric_value:a},ma_qa_metric_local_pairwise:{ordinal_id:o,model_id:o,label_asym_id_1:i,label_seq_id_1:o,label_comp_id_1:i,label_asym_id_2:i,label_seq_id_2:o,label_comp_id_2:i,metric_id:o,metric_value:a}}},29472(e,t,n){"use strict"
n.d(t,{e:()=>s,z:()=>l})
var r=n(29282),i=n(24762)
r.r.atom_site.label_comp_id,r.r.atom_site.label_seq_id,r.r.atom_site.pdbx_PDB_ins_code,r.r.atom_site.label_asym_id,r.r.atom_site.label_entity_id,r.r.atom_site.auth_atom_id,r.r.atom_site.auth_seq_id,r.r.atom_site.auth_asym_id,r.r.chem_comp_bond,i.VP.Schema.Str()
const o={...r.r.chem_comp,type:i.VP.Schema.Aliased(i.VP.Schema.str)}
var a=n(49610)
const s={entry:r.r.entry,struct:r.r.struct,struct_asym:r.r.struct_asym,ihm_model_list:r.r.ihm_model_list,ihm_model_group:r.r.ihm_model_group,ihm_model_group_link:r.r.ihm_model_group_link,entity:r.r.entity,entity_poly:r.r.entity_poly,entity_poly_seq:r.r.entity_poly_seq,pdbx_entity_branch:r.r.pdbx_entity_branch,chem_comp:o,pdbx_chem_comp_identifier:r.r.pdbx_chem_comp_identifier,atom_site:r.r.atom_site,ihm_sphere_obj_site:r.r.ihm_sphere_obj_site,ihm_gaussian_obj_site:r.r.ihm_gaussian_obj_site,pdbx_unobs_or_zero_occ_residues:r.r.pdbx_unobs_or_zero_occ_residues,pdbx_molecule:r.r.pdbx_molecule}
function l(e,t=!1){const n=Object.create(null)
for(const r of Object.keys(s))n[r]=r in e?e[r]:i.XI.ofUndefinedColumns(s[r],0)
return t&&(n.atom_site=(0,a.W)(n.atom_site)),n}},29915(e,t,n){"use strict"
n.d(t,{O:()=>r,q:()=>u})
var r,i=n(32773),o=n(2092),a=n(6941),s=n(81916)
function l(e,t){return(0,s.HR)(a.d3.Dictionary({0:(0,a.ef)(r.ElementReference,{isOptional:!0,defaultValue:"slot.current-atom"})}),e,t)}function c(e,t){return(0,s.HR)(a.d3.None,e,t)}!function(e){e.ElementSymbol=i.Z.Value("Structure","ElementSymbol"),e.AtomName=i.Z.Value("Structure","AtomName"),e.BondFlag=i.Z.OneOf("Structure","BondFlag",i.Z.Str,["covalent","metallic","ion","hydrogen","sulfide","computed","aromatic"]),e.BondFlags=o.Or.Flags(e.BondFlag,"BondFlags"),e.SecondaryStructureFlag=i.Z.OneOf("Structure","SecondaryStructureFlag",i.Z.Str,["alpha","beta","3-10","pi","sheet","strand","helix","turn","none"]),e.SecondaryStructureFlags=o.Or.Flags(e.SecondaryStructureFlag,"SecondaryStructureFlag"),e.RingFingerprint=i.Z.Value("Structure","RingFingerprint"),e.EntityType=i.Z.OneOf("Structure","EntityType",i.Z.Str,["polymer","non-polymer","water","branched"]),e.EntitySubtype=i.Z.OneOf("Structure","EntitySubtype",i.Z.Str,["other","polypeptide(D)","polypeptide(L)","polydeoxyribonucleotide","polyribonucleotide","polydeoxyribonucleotide/polyribonucleotide hybrid","cyclic-pseudo-peptide","peptide nucleic acid","oligosaccharide"]),e.ObjectPrimitive=i.Z.OneOf("Structure","ObjectPrimitive",i.Z.Str,["atomistic","sphere","gaussian","other"]),e.ResidueId=i.Z.Value("Structure","ResidueId"),e.ElementSet=i.Z.Value("Structure","ElementSet"),e.ElementSelection=i.Z.Value("Structure","ElementSelection"),e.ElementReference=i.Z.Value("Structure","ElementReference"),e.ElementSelectionQuery=o.Or.Fn(e.ElementSelection,"ElementSelectionQuery")}(r||(r={}))
const u={"@header":"Structure Queries",type:{"@header":"Types",elementSymbol:(0,s.HR)(a.d3.Dictionary({0:(0,a.ef)(i.Z.Str)}),r.ElementSymbol,"Create element symbol representation from a string value."),atomName:(0,s.HR)(a.d3.Dictionary({0:(0,a.ef)(i.Z.AnyValue)}),r.AtomName,"Convert a value to an atom name."),entityType:(0,s.HR)(a.d3.Dictionary({0:(0,a.ef)(r.EntityType)}),r.EntityType,`Create normalized representation of entity type: ${i.Z.oneOfValues(r.EntityType).join(", ")}.`),bondFlags:(0,s.HR)(a.d3.List(r.BondFlag),r.BondFlags,`Create bond flags representation from a list of strings. Allowed flags: ${i.Z.oneOfValues(r.BondFlag).join(", ")}.`),ringFingerprint:(0,s.HR)(a.d3.List(r.ElementSymbol,{nonEmpty:!0}),r.RingFingerprint,"Create ring fingerprint from the supplied atom element list."),secondaryStructureFlags:(0,s.HR)(a.d3.List(r.SecondaryStructureFlag),r.SecondaryStructureFlags,`Create secondary structure flags representation from a list of strings. Allowed flags: ${i.Z.oneOfValues(r.SecondaryStructureFlag).join(", ")}.`),authResidueId:(0,s.HR)(a.d3.Dictionary({0:(0,a.ef)(i.Z.Str,{description:"auth_asym_id"}),1:(0,a.ef)(i.Z.Num,{description:"auth_seq_id"}),2:(0,a.ef)(i.Z.Str,{description:"pdbx_PDB_ins_code",isOptional:!0})}),r.ResidueId,'Residue identifier based on "auth_" annotation.'),labelResidueId:(0,s.HR)(a.d3.Dictionary({0:(0,a.ef)(i.Z.Str,{description:"label_entity_id"}),1:(0,a.ef)(i.Z.Str,{description:"label_asym_id"}),2:(0,a.ef)(i.Z.Num,{description:"label_seq_id"}),3:(0,a.ef)(i.Z.Str,{description:"pdbx_PDB_ins_code",isOptional:!0})}),r.ResidueId,'Residue identifier based on mmCIF\'s "label_" annotation.')},slot:{"@header":"Iteration Slots",element:(0,s.HR)(a.d3.None,r.ElementReference,"A reference to the current element."),elementSetReduce:(0,s.HR)(a.d3.None,i.Z.Variable("a",i.Z.AnyValue,!0),"Current value of the element set reducer.")},generator:{"@header":"Generators",all:(0,s.HR)(a.d3.None,r.ElementSelectionQuery,"The entire structure."),atomGroups:(0,s.HR)(a.d3.Dictionary({"entity-test":(0,a.ef)(i.Z.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom of every entity"}),"chain-test":(0,a.ef)(i.Z.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom of every chain"}),"residue-test":(0,a.ef)(i.Z.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom every residue"}),"atom-test":(0,a.ef)(i.Z.Bool,{isOptional:!0,defaultValue:!0}),"group-by":(0,a.ef)(i.Z.Any,{isOptional:!0,defaultValue:"atom-key",description:"Group atoms to sets based on this property. Default: each atom has its own set"})}),r.ElementSelectionQuery,"Return all atoms for which the tests are satisfied, grouped into sets."),bondedAtomicPairs:(0,s.HR)(a.d3.Dictionary({0:(0,a.ef)(i.Z.Bool,{isOptional:!0,defaultValue:"true for covalent bonds",description:"Test each bond with this predicate. Each bond is visited twice with swapped atom order."})}),r.ElementSelectionQuery,"Return all pairs of atoms for which the test is satisfied."),rings:(0,s.HR)(a.d3.Dictionary({fingerprint:(0,a.ef)(r.RingFingerprint,{isOptional:!0}),"only-aromatic":(0,a.ef)(i.Z.Bool,{isOptional:!0,defaultValue:!1})}),r.ElementSelectionQuery,"Return all rings or those with the specified fingerprint and/or only aromatic rings."),queryInSelection:(0,s.HR)(a.d3.Dictionary({0:(0,a.ef)(r.ElementSelectionQuery),query:(0,a.ef)(r.ElementSelectionQuery),"in-complement":(0,a.ef)(i.Z.Bool,{isOptional:!0,defaultValue:!1})}),r.ElementSelectionQuery,"Executes query only on atoms that are in the source selection."),empty:(0,s.HR)(a.d3.None,r.ElementSelectionQuery,"Nada.")},modifier:{"@header":"Selection Modifications",queryEach:(0,s.HR)(a.d3.Dictionary({0:(0,a.ef)(r.ElementSelectionQuery),query:(0,a.ef)(r.ElementSelectionQuery)}),r.ElementSelectionQuery,"Query every atom set in the input selection separately."),intersectBy:(0,s.HR)(a.d3.Dictionary({0:(0,a.ef)(r.ElementSelectionQuery),by:(0,a.ef)(r.ElementSelectionQuery)}),r.ElementSelectionQuery,"Intersect each atom set from the first sequence from atoms in the second one."),exceptBy:(0,s.HR)(a.d3.Dictionary({0:(0,a.ef)(r.ElementSelectionQuery),by:(0,a.ef)(r.ElementSelectionQuery)}),r.ElementSelectionQuery,"Remove all atoms from 'selection' that occur in 'by'."),unionBy:(0,s.HR)(a.d3.Dictionary({0:(0,a.ef)(r.ElementSelectionQuery),by:(0,a.ef)(r.ElementSelectionQuery)}),r.ElementSelectionQuery,"For each atom set A in the orginal sequence, combine all atoms sets in the target selection that intersect with A."),union:(0,s.HR)(a.d3.Dictionary({0:(0,a.ef)(r.ElementSelectionQuery)}),r.ElementSelectionQuery,"Collects all atom sets in the sequence into a single atom set."),cluster:(0,s.HR)(a.d3.Dictionary({0:(0,a.ef)(r.ElementSelectionQuery),"min-distance":(0,a.ef)(i.Z.Num,{isOptional:!0,defaultValue:0}),"max-distance":(0,a.ef)(i.Z.Num),"min-size":(0,a.ef)(i.Z.Num,{description:"Minimal number of sets to merge, must be at least 2",isOptional:!0,defaultValue:2}),"max-size":(0,a.ef)(i.Z.Num,{description:"Maximal number of sets to merge, if not set, no limit",isOptional:!0})}),r.ElementSelectionQuery,"Combines atom sets that have mutual distance in the interval [min-radius, max-radius]. Minimum/maximum size determines how many atom sets can be combined."),includeSurroundings:(0,s.HR)(a.d3.Dictionary({0:(0,a.ef)(r.ElementSelectionQuery),radius:(0,a.ef)(i.Z.Num),"atom-radius":(0,a.ef)(i.Z.Num,{isOptional:!0,defaultValue:0,description:"Value added to each atom before the distance check, for example VDW radius. Using this argument is computationally demanding."}),"as-whole-residues":(0,a.ef)(i.Z.Bool,{isOptional:!0})}),r.ElementSelectionQuery,"For each atom set in the selection, include all surrouding atoms/residues that are within the specified radius."),surroundingLigands:(0,s.HR)(a.d3.Dictionary({0:(0,a.ef)(r.ElementSelectionQuery),radius:(0,a.ef)(i.Z.Num),"include-water":(0,a.ef)(i.Z.Bool,{isOptional:!0,defaultValue:!0})}),r.ElementSelectionQuery,"Find all ligands components around the source query."),includeConnected:(0,s.HR)(a.d3.Dictionary({0:(0,a.ef)(r.ElementSelectionQuery),"bond-test":(0,a.ef)(i.Z.Bool,{isOptional:!0,defaultValue:"true for covalent bonds"}),"layer-count":(0,a.ef)(i.Z.Num,{isOptional:!0,defaultValue:1,description:"Number of bonded layers to include."}),"fixed-point":(0,a.ef)(i.Z.Bool,{isOptional:!0,defaultValue:!1,description:"Continue adding layers as long as new connections exist."}),"as-whole-residues":(0,a.ef)(i.Z.Bool,{isOptional:!0})}),r.ElementSelectionQuery,"Pick all atom sets that are connected to the target."),wholeResidues:(0,s.HR)(a.d3.Dictionary({0:(0,a.ef)(r.ElementSelectionQuery)}),r.ElementSelectionQuery,"Expand the selection to whole residues."),expandProperty:(0,s.HR)(a.d3.Dictionary({0:(0,a.ef)(r.ElementSelectionQuery),property:(0,a.ef)(i.Z.AnyValue)}),r.ElementSelectionQuery,"To each atom set in the selection, add all atoms that have the same property value that was already present in the set.")},filter:{"@header":"Selection Filters",pick:(0,s.HR)(a.d3.Dictionary({0:(0,a.ef)(r.ElementSelectionQuery),test:(0,a.ef)(i.Z.Bool)}),r.ElementSelectionQuery,"Pick all atom sets that satisfy the test."),first:(0,s.HR)(a.d3.Dictionary({0:(0,a.ef)(r.ElementSelectionQuery)}),r.ElementSelectionQuery,"Take the 1st atom set in the sequence."),withSameAtomProperties:(0,s.HR)(a.d3.Dictionary({0:(0,a.ef)(r.ElementSelectionQuery),source:(0,a.ef)(r.ElementSelectionQuery),property:(0,a.ef)(i.Z.Any)}),r.ElementSelectionQuery,"Pick all atom sets for which the set of given atom properties is a subset of the source properties."),intersectedBy:(0,s.HR)(a.d3.Dictionary({0:(0,a.ef)(r.ElementSelectionQuery),by:(0,a.ef)(r.ElementSelectionQuery)}),r.ElementSelectionQuery,"Pick all atom sets that have non-zero intersection with the target."),within:(0,s.HR)(a.d3.Dictionary({0:(0,a.ef)(r.ElementSelectionQuery),target:(0,a.ef)(r.ElementSelectionQuery),"min-radius":(0,a.ef)(i.Z.Num,{isOptional:!0,defaultValue:0}),"max-radius":(0,a.ef)(i.Z.Num),"atom-radius":(0,a.ef)(i.Z.Num,{isOptional:!0,defaultValue:0,description:"Value added to each atom before the distance check, for example VDW radius. Using this argument is computationally demanding."}),invert:(0,a.ef)(i.Z.Bool,{isOptional:!0,defaultValue:!1,description:"If true, pick only atom sets that are further than the specified radius."})}),r.ElementSelectionQuery,"Pick all atom sets from selection that have any atom within the radius of any atom from target."),isConnectedTo:(0,s.HR)(a.d3.Dictionary({0:(0,a.ef)(r.ElementSelectionQuery),target:(0,a.ef)(r.ElementSelectionQuery),"bond-test":(0,a.ef)(i.Z.Bool,{isOptional:!0,defaultValue:"true for covalent bonds"}),disjunct:(0,a.ef)(i.Z.Bool,{isOptional:!0,defaultValue:!0,description:"If true, there must exist a bond to an atom that lies outside the given atom set to pass test."}),invert:(0,a.ef)(i.Z.Bool,{isOptional:!0,defaultValue:!1,description:"If true, return atom sets that are not connected."})}),r.ElementSelectionQuery,"Pick all atom sets that are connected to the target.")},combinator:{"@header":"Selection Combinators",intersect:(0,s.HR)(a.d3.List(r.ElementSelectionQuery),r.ElementSelectionQuery,"Return all unique atom sets that appear in all of the source selections."),merge:(0,s.HR)(a.d3.List(r.ElementSelectionQuery),r.ElementSelectionQuery,"Merges multiple selections into a single one. Only unique atom sets are kept."),distanceCluster:(0,s.HR)(a.d3.Dictionary({matrix:(0,a.ef)(o.Or.List(o.Or.List(i.Z.Num)),{description:"Distance matrix, represented as list of rows (num[][])). Lower triangle is min distance, upper triangle is max distance."}),selections:(0,a.ef)(o.Or.List(r.ElementSelectionQuery),{description:"A list of held selections."})}),r.ElementSelectionQuery,"Pick combinations of atom sets from the source sequences that are mutually within distances specified by a matrix.")},atomSet:{"@header":"Atom Sets",atomCount:(0,s.HR)(a.d3.None,i.Z.Num),countQuery:(0,s.HR)(a.d3.Dictionary({0:(0,a.ef)(r.ElementSelectionQuery)}),i.Z.Num,"Counts the number of occurences of a specific query inside the current atom set."),reduce:(0,s.HR)(a.d3.Dictionary({initial:(0,a.ef)(i.Z.Variable("a",i.Z.AnyValue,!0),{description:"Initial value assigned to slot.atom-set-reduce. Current atom is set to the 1st atom of the current set for this."}),value:(0,a.ef)(i.Z.Variable("a",i.Z.AnyValue,!0),{description:"Expression executed for each atom in the set"})}),i.Z.Variable("a",i.Z.AnyValue,!0),"Execute the value expression for each atom in the current atom set and return the result. Works the same way as Array.reduce in JavaScript (``result = value(value(...value(initial)))``)"),propertySet:(0,s.HR)(a.d3.Dictionary({0:(0,a.ef)(o.Or.ConstrainedVar)}),o.Or.Set(o.Or.ConstrainedVar),"Returns a set with all values of the given property in the current atom set.")},atomProperty:{"@header":"Atom Properties",core:{"@header":"Core Properties",elementSymbol:l(r.ElementSymbol),vdw:l(i.Z.Num,"Van der Waals radius"),mass:l(i.Z.Num,"Atomic weight"),atomicNumber:l(i.Z.Num,"Atomic number"),x:l(i.Z.Num,"Cartesian X coordinate"),y:l(i.Z.Num,"Cartesian Y coordinate"),z:l(i.Z.Num,"Cartesian Z coordinate"),atomKey:l(i.Z.AnyValue,"Unique value for each atom. Main use case is grouping of atoms."),bondCount:(0,s.HR)(a.d3.Dictionary({0:(0,a.ef)(r.ElementReference,{isOptional:!0,defaultValue:"slot.current-atom"}),flags:(0,a.ef)(r.BondFlags,{isOptional:!0,defaultValue:"covalent"})}),i.Z.Num,"Number of bonds (by default only covalent bonds are counted)."),sourceIndex:l(i.Z.Num,"Index of the atom/element in the input file."),operatorName:l(i.Z.Str,"Name of the symmetry operator applied to this element."),instanceId:l(i.Z.Str,"Canonical name of the symmetry operator applied to this element."),operatorKey:l(i.Z.Num,"Key of the symmetry operator applied to this element."),modelIndex:l(i.Z.Num,"Index of the model in the input file."),modelLabel:l(i.Z.Str,"Label/header of the model in the input file."),modelEntryId:l(i.Z.Str,"Entry ID of the model (e.g., PDB ID).")},topology:{connectedComponentKey:l(i.Z.AnyValue,"Unique value for each connected component.")},macromolecular:{"@header":"Macromolecular Properties (derived from the mmCIF format)",authResidueId:l(r.ResidueId,"type.auth-residue-id symbol executed on current atom's residue"),labelResidueId:l(r.ResidueId,"type.label-residue-id symbol executed on current atom's residue"),residueKey:l(i.Z.AnyValue,"Unique value for each tuple ``(label_entity_id,auth_asym_id, auth_seq_id, pdbx_PDB_ins_code)``, main use case is grouping of atoms"),chainKey:l(i.Z.AnyValue,"Unique value for each tuple ``(label_entity_id, auth_asym_id)``, main use case is grouping of atoms"),entityKey:l(i.Z.AnyValue,"Unique value for each tuple ``label_entity_id``, main use case is grouping of atoms"),isHet:l(i.Z.Bool,"Equivalent to atom_site.group_PDB !== ATOM"),id:l(i.Z.Num,"_atom_site.id"),label_atom_id:l(r.AtomName),label_alt_id:l(i.Z.Str),label_comp_id:l(i.Z.Str),label_asym_id:l(i.Z.Str),label_entity_id:l(i.Z.Str),label_seq_id:l(i.Z.Num),auth_atom_id:l(r.AtomName),auth_comp_id:l(i.Z.Str),auth_asym_id:l(i.Z.Str),auth_seq_id:l(i.Z.Num),residueSourceIndex:l(i.Z.Num),pdbx_PDB_ins_code:l(i.Z.Str),pdbx_formal_charge:l(i.Z.Num),occupancy:l(i.Z.Num),B_iso_or_equiv:l(i.Z.Num),entityType:l(r.EntityType,"Type of the entity as defined in mmCIF (polymer, non-polymer, branched, water)"),entitySubtype:l(r.EntitySubtype,"Subtype of the entity as defined in mmCIF _entity_poly.type and _pdbx_entity_branch.type (other, polypeptide(D), polypeptide(L), polydeoxyribonucleotide, polyribonucleotide, polydeoxyribonucleotide/polyribonucleotide hybrid, cyclic-pseudo-peptide, peptide nucleic acid, oligosaccharide)"),entityPrdId:l(i.Z.Str,"The PRD ID of the entity."),entityDescription:l(o.Or.List(i.Z.Str)),objectPrimitive:l(r.ObjectPrimitive,"Type of the primitive object used to model this segment as defined in mmCIF/IHM (atomistic, sphere, gaussian, other)"),secondaryStructureKey:l(i.Z.AnyValue,"Unique value for each secondary structure element."),secondaryStructureFlags:l(r.SecondaryStructureFlags),isModified:l(i.Z.Bool,"True if the atom belongs to modification of a standard residue."),modifiedParentName:l(i.Z.Str,"'3-letter' code of the modifed parent residue."),isNonStandard:l(i.Z.Bool,"True if this is a non-standard residue."),chemCompType:l(i.Z.Str,"Type of the chemical component as defined in mmCIF.")},ihm:{hasSeqId:(0,s.HR)(a.d3.Dictionary({0:(0,a.ef)(i.Z.Num)}),i.Z.Bool,"Checks if the current element represents a given sequence id"),overlapsSeqIdRange:(0,s.HR)(a.d3.Dictionary({beg:(0,a.ef)(i.Z.Num),end:(0,a.ef)(i.Z.Num)}),i.Z.Bool,"Checks if the current element overlaps with the specified residue range")}},bondProperty:{"@header":"Bond Properties",flags:c(r.BondFlags),order:c(i.Z.Num),key:c(i.Z.Num),length:c(i.Z.Num),atomA:c(r.ElementReference),atomB:c(r.ElementReference)}}},30084(e,t,n){"use strict"
n.d(t,{q:()=>r})
var r,i=n(9043),o=n(32775),a=n(37392),s=n(65081),l=n(17782),c=n(68187),u=n(81871),d=n(17810),p=n(92384),h=n(31727),f=n(14294),m=n(9726),g=n(64170),y=n(69858),v=n(70012),b=n(40426),x=n(22394),S=n(71905)
!function(e){function t(e,t,n,o,s,l,c){return c?function(e,t,n,r,o,a,s){return a>s.lineCount&&(i.IQ.update(s.mappingBuffer,e),i.IQ.update(s.indexBuffer,t)),s.lineCount=a,i.IQ.update(s.groupBuffer,n),i.IQ.update(s.startBuffer,r),i.IQ.update(s.endBuffer,o),s}(e,t,n,o,s,l,c):function(e,t,n,o,s,l){const c=(0,f.f8)()
let u,d=-1,p=-1
const m={kind:"lines",lineCount:l,mappingBuffer:i.IQ.create(e),indexBuffer:i.IQ.create(t),groupBuffer:i.IQ.create(n),startBuffer:i.IQ.create(o),endBuffer:i.IQ.create(s),get boundingSphere(){const e=r(m)
if(e!==d){const t=(0,h.sL)(m.startBuffer.ref.value,4*m.lineCount,4),n=(0,h.sL)(m.endBuffer.ref.value,4*m.lineCount,4)
f.f8.expandBySphere(c,t,n),d=e}return c},get groupMapping(){return m.groupBuffer.ref.version!==p&&(u=(0,a.AA)(m.groupBuffer.ref.value,m.lineCount,4),p=m.groupBuffer.ref.version),u},setBoundingSphere(e){f.f8.copy(c,e),d=r(m)}}
return m}(e,t,n,o,s,l)}function n(e){return t(e?e.mappingBuffer.ref.value:new Float32Array(0),e?e.indexBuffer.ref.value:new Uint32Array(0),e?e.groupBuffer.ref.value:new Float32Array(0),e?e.startBuffer.ref.value:new Float32Array(0),e?e.endBuffer.ref.value:new Float32Array(0),0,e)}function r(e){return(0,v.TI)([e.lineCount,e.mappingBuffer.ref.version,e.indexBuffer.ref.version,e.groupBuffer.ref.version,e.startBuffer.ref.version,e.endBuffer.ref.version])}function _(e,t){const n=4*e.lineCount,r=t.instanceCount.ref.value,i=(0,u.tu)(),a=i.position,s=e.startBuffer.ref.value,l=e.endBuffer.ref.value,c=t.aTransform.ref.value
return(0,u.iQ)(n,r,2,(e,t)=>{const n=e%4==0?s:l
return t<0?o.eB.fromArray(a,n,3*e):o.eB.transformMat4Offset(a,n,c,0,3*e,16*t),i})}function C(e,t,n,r,a){const{instanceCount:u,groupCount:d}=n,p=_(e,t),v=(0,s.D1)(n,p,r.color),C=(0,c.v3)(n,r.size),w=a.instanceGranularity?(0,l.Km)(u,"instance"):(0,l.Km)(u*d,"groupInstance"),T=(0,g.WG)(),A=(0,y.MD)(),I=(0,S.JS)(),P=(0,x.IB)(),B=(0,b.EN)(),E={drawCount:2*e.lineCount*3,vertexCount:4*e.lineCount,groupCount:d,instanceCount:u},k=f.f8.clone(e.boundingSphere),D=(0,h.Ax)(k,t.aTransform.ref.value,u,0)
return{dGeometryType:i.IQ.create("lines"),aMapping:e.mappingBuffer,aGroup:e.groupBuffer,aStart:e.startBuffer,aEnd:e.endBuffer,elements:e.indexBuffer,boundingSphere:i.IQ.create(D),invariantBoundingSphere:i.IQ.create(k),uInvariantBoundingSphere:i.IQ.create(o.Zb.ofSphere(k)),...v,...C,...w,...T,...A,...I,...P,...B,...t,...m.iy.createValues(a,E),uSizeFactor:i.IQ.create(a.sizeFactor),dLineSizeAttenuation:i.IQ.create(a.lineSizeAttenuation),uDoubleSided:i.IQ.create(!0),dFlipSided:i.IQ.create(!1)}}e.create=t,e.createEmpty=n,e.fromMesh=function(e,t){const n=e.vertexBuffer.ref.value,r=e.indexBuffer.ref.value,i=e.groupBuffer.ref.value,o=d.d.create(3*e.triangleCount,e.triangleCount/10,t)
for(let a=0,s=3*e.triangleCount;a<s;a+=3){const e=r[a],t=r[a+1],s=r[a+2],l=n[3*e],c=n[3*e+1],u=n[3*e+2],d=n[3*t],p=n[3*t+1],h=n[3*t+2],f=n[3*s],m=n[3*s+1],g=n[3*s+2]
o.add(l,c,u,d,p,h,i[e]),o.add(l,c,u,f,m,g,i[e]),o.add(d,p,h,f,m,g,i[t])}return o.getLines()},e.transform=function(e,t){const n=e.startBuffer.ref.value;(0,a.pi)(t,n,0,4*e.lineCount),i.IQ.update(e.startBuffer,n)
const r=e.endBuffer.ref.value;(0,a.pi)(t,r,0,4*e.lineCount),i.IQ.update(e.endBuffer,r)},e.Params={...m.iy.Params,sizeFactor:p.t.Numeric(2,{min:0,max:10,step:.1}),lineSizeAttenuation:p.t.Boolean(!1)},e.Utils={Params:e.Params,createEmpty:n,createValues:C,createValuesSimple:function(t,n,r,i,o){const a=m.iy.createSimple(r,i,o),s={...p.t.getDefaultValues(e.Params),...n}
return C(t,a.transform,a.locationIterator,a.theme,s)},updateValues:function(e,t){m.iy.updateValues(e,t),i.IQ.updateIfChanged(e.uSizeFactor,t.sizeFactor),i.IQ.updateIfChanged(e.dLineSizeAttenuation,t.lineSizeAttenuation)},updateBoundingSphere:function(e,t){const n=f.f8.clone(t.boundingSphere),r=(0,h.Ax)(n,e.aTransform.ref.value,e.instanceCount.ref.value,0)
f.f8.equals(r,e.boundingSphere.ref.value)||i.IQ.update(e.boundingSphere,r),f.f8.equals(n,e.invariantBoundingSphere.ref.value)||(i.IQ.update(e.invariantBoundingSphere,n),i.IQ.update(e.uInvariantBoundingSphere,o.Zb.fromSphere(e.uInvariantBoundingSphere.ref.value,n)))},createRenderableState:m.iy.createRenderableState,updateRenderableState:m.iy.updateRenderableState,createPositionIterator:_}}(r||(r={}))},30372(e,t,n){"use strict"
n.d(t,{B:()=>c})
var r=n(76513),i=n(85404),o=n(28539),a=(0,n(497).L)(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),s=n(13352),l=n(10390),c=function(e){function t(){var t=e.call(this)||this
return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return(0,r.C6)(t,e),t.prototype.lift=function(e){var t=new u(this,this)
return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new a},t.prototype.next=function(e){var t=this;(0,l.Y)(function(){var n,i
if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers))
try{for(var o=(0,r.Ju)(t.currentObservers),a=o.next();!a.done;a=o.next())a.value.next(e)}catch(e){n={error:e}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}}})},t.prototype.error=function(e){var t=this;(0,l.Y)(function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e
for(var n=t.observers;n.length;)n.shift().error(e)}})},t.prototype.complete=function(){var e=this;(0,l.Y)(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0
for(var t=e.observers;t.length;)t.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e
return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=this,r=n.hasError,i=n.isStopped,a=n.observers
return r||i?o.Kn:(this.currentObservers=null,a.push(e),new o.yU(function(){t.currentObservers=null,(0,s.o)(a,e)}))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.hasError,r=t.thrownError,i=t.isStopped
n?e.error(r):i&&e.complete()},t.prototype.asObservable=function(){var e=new i.c
return e.source=this,e},t.create=function(e,t){return new u(e,t)},t}(i.c),u=function(e){function t(t,n){var r=e.call(this)||this
return r.destination=t,r.source=n,r}return(0,r.C6)(t,e),t.prototype.next=function(e){var t,n
null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)},t.prototype.error=function(e){var t,n
null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)},t.prototype.complete=function(){var e,t
null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,n
return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:o.Kn},t}(c)},30466(e,t,n){"use strict"
n.d(t,{lL:()=>a.lL,Ay:()=>a.il,o:()=>a.o})
var r,i=n(61603),o=n(77603),a=n(69441)
{let e=!1
{e=!0
const{buildSignalConfig:t}=(r=n(8738),r?.__esModule?r:{default:r,...r});(0,o.s)(t)}const t=["Using WarpDrive with EmberJS requires configuring it to use Ember's reactivity system.","Previously this was provided by installing the package '@ember-data/tracking', but this package is now deprecated.","","To resolve this deprecation, follow these steps:",!!e&&'- remove "@ember-data/tracking" and (if needed) "@ember-data-types/tracking" from your project in both your package.json and tsconfig.json','- add "@warp-drive/ember" to your project in both your package.json and tsconfig.json',"- add the following import to your app.js file:","","\t```","\timport '@warp-drive/ember/install';","\t```","","- mark this deprecation as resolved in your project by adding the following to your WarpDrive config in ember-cli-build.js:","","\t```",'\tconst { setConfig } = await import("@warp-drive/build-config");',"\tsetConfig(app, __dirname, {","\t  deprecations: {","\t    DEPRECATE_TRACKING_PACKAGE: false,","\t  },","\t});","\t```","","For more information, see the Package Unification RFC: https://rfcs.emberjs.com/id/1075-warp-drive-package-unification/"].filter(e=>!1!==e).join("\n");(0,i.deprecate)(t,!1,{id:"warp-drive.deprecate-tracking-package",until:"6.0.0",for:"warp-drive",since:{enabled:"5.3.4",available:"4.13"},url:"https://deprecations.emberjs.com/id/warp-drive.deprecate-tracking-package"})}},30517(e,t,n){"use strict"
n.d(t,{T:()=>i})
var r=n(18891)
function i(e){return Symbol.asyncIterator&&(0,r.T)(null==e?void 0:e[Symbol.asyncIterator])}},30650(e,t,n){"use strict"
function r(e,t,n){return n?.forceNumber&&("number"!=typeof e&&(e=Number(e)),"number"!=typeof t&&(t=Number(t))),e>t}n.r(t),n.d(t,{default:()=>r})},30846(e,t,n){"use strict"
n.d(t,{Jq:()=>c,jM:()=>u})
var r,i=n(14294),o=n(32775),a=n(67538),s=n(66588),l=n(26028)
function c(){return{result:r.create(),closeUnitsResult:i.Q7.create(),unitGroupResult:i.Q7.create()}}!function(e){e.add=function(e,t,n,r){e.indices[e.count]=n,e.units[e.count]=t,e.squaredDistances[e.count]=r,e.count++},e.create=function(){return{count:0,indices:[],units:[],squaredDistances:[]}},e.copy=function(e,t){for(let n=0;n<t.count;++n)e.indices[n]=t.indices[n],e.units[n]=t.units[n],e.squaredDistances[n]=t.squaredDistances[n]
return e.count=t.count,e}}(r||(r={}))
class u{findUnitIndices(e,t,n,r){return this.unitLookup.find(e,t,n,r)}find(e,t,n,r,i){return this._find(e,t,n,r,null!=i?i:this.findContext)}_find(e,t,n,a,s){i.Q7.reset(s.result)
const{units:l}=this.structure,c=this.unitLookup.find(e,t,n,a,s.closeUnitsResult)
if(0===c.count)return s.result
for(let i=0,u=c.count;i<u;i++){const u=l[c.indices[i]]
o.eB.set(this.pivot,e,t,n),u.conformation.operator.isIdentity||o.eB.transformMat4(this.pivot,this.pivot,u.conformation.operator.inverse)
const d=u.lookup3d.find(this.pivot[0],this.pivot[1],this.pivot[2],a,s.unitGroupResult)
for(let e=0,t=d.count;e<t;e++)r.add(s.result,u,d.indices[e],d.squaredDistances[e])}return s.result}nearest(e,t,n,r=1,i){return this._nearest(e,t,n,r,null!=i?i:this.findContext)}_nearest(e,t,n,a,s){const l=s.result,c=this.heap
i.Q7.reset(l),c.clear()
const{units:u}=this.structure
let d=0
const p=this.unitLookup.nearest(e,t,n,u.length,e=>(d+=u[e].elements.length)>=a,s.closeUnitsResult)
if(0===p.count)return l
let h=0,f=-Number.MAX_VALUE
for(let r=0,i=p.count;r<i;r++){const i=p.squaredDistances[r]
if(h>=a&&f<i)break
o.eB.set(this.pivot,e,t,n)
const l=u[p.indices[r]]
l.conformation.operator.isIdentity||o.eB.transformMat4(this.pivot,this.pivot,l.conformation.operator.inverse)
const d=l.lookup3d.nearest(this.pivot[0],this.pivot[1],this.pivot[2],a,void 0,s.unitGroupResult)
if(0!==d.count){h+=d.count,f=Math.max(f,d.squaredDistances[d.count-1])
for(let e=0,t=d.count;e<t;e++)c.insert(d.squaredDistances[e],{index:d.indices[e],unit:l})}}if(1===a){const e=c.findMinimum()
if(e){const{key:t}=e,{unit:n,index:i}=e.value
r.add(l,n,i,t)}}else for(;!c.isEmpty()&&l.count<a;){const e=c.extractMinimum(),{key:t}=e,{unit:n,index:i}=e.value
r.add(l,n,i,t)}return l}findIntoBuilder(e,t,n,r,i){const{units:a}=this.structure,s=this.unitLookup.find(e,t,n,r)
if(0!==s.count)for(let l=0,c=s.count;l<c;l++){const c=a[s.indices[l]]
o.eB.set(this.pivot,e,t,n),c.conformation.operator.isIdentity||o.eB.transformMat4(this.pivot,this.pivot,c.conformation.operator.inverse)
const u=c.lookup3d.find(this.pivot[0],this.pivot[1],this.pivot[2],r)
if(0===u.count)continue
const d=c.elements
i.beginUnit(c.id)
for(let e=0,t=u.count;e<t;e++)i.addElement(d[u.indices[e]])
i.commitUnit()}}findIntoBuilderIf(e,t,n,r,i,a){const{units:l}=this.structure,c=this.unitLookup.find(e,t,n,r)
if(0===c.count)return
const u=s.i.Location.create(this.structure)
for(let s=0,d=c.count;s<d;s++){const d=l[c.indices[s]]
o.eB.set(this.pivot,e,t,n),d.conformation.operator.isIdentity||o.eB.transformMat4(this.pivot,this.pivot,d.conformation.operator.inverse)
const p=d.lookup3d.find(this.pivot[0],this.pivot[1],this.pivot[2],r)
if(0===p.count)continue
const h=d.elements
u.unit=d,i.beginUnit(d.id)
for(let e=0,t=p.count;e<t;e++)u.element=h[p.indices[e]],a(u)&&i.addElement(u.element)
i.commitUnit()}}findIntoBuilderWithRadius(e,t,n,r,i,a,l,c){const{units:u}=this.structure,d=this.unitLookup.find(e,t,n,a)
if(0===d.count)return
const p=s.i.Location.create(this.structure),h=r+i+a
for(let s=0,f=d.count;s<f;s++){const i=u[d.indices[s]]
o.eB.set(this.pivot,e,t,n),i.conformation.operator.isIdentity||o.eB.transformMat4(this.pivot,this.pivot,i.conformation.operator.inverse)
const f=i.lookup3d.find(this.pivot[0],this.pivot[1],this.pivot[2],h)
if(0===f.count)continue
const m=i.elements
p.unit=i,c.beginUnit(i.id)
for(let e=0,t=f.count;e<t;e++){p.element=m[f.indices[e]]
const t=l(p)
Math.sqrt(f.squaredDistances[e])-r-t>a||c.addElement(m[f.indices[e]])}c.commitUnit()}}check(e,t,n,r){const{units:i}=this.structure,a=this.unitLookup.find(e,t,n,r)
if(0===a.count)return!1
for(let s=0,l=a.count;s<l;s++){const l=i[a.indices[s]]
if(o.eB.set(this.pivot,e,t,n),l.conformation.operator.isIdentity||o.eB.transformMat4(this.pivot,this.pivot,l.conformation.operator.inverse),l.lookup3d.check(this.pivot[0],this.pivot[1],this.pivot[2],r))return!0}return!1}approxNearest(e,t,n,r,i){return this._approxNearest(e,t,n,r,null!=i?i:this.findContext)}_approxNearest(e,t,n,a,s){i.Q7.reset(s.result)
const{units:l}=this.structure,c=this.unitLookup.find(e,t,n,a,s.closeUnitsResult)
if(0===c.count)return s.result
let u=Number.MAX_VALUE
for(let i=0,d=c.count;i<d;i++){const d=l[c.indices[i]]
o.eB.set(this.pivot,e,t,n),d.conformation.operator.isIdentity||o.eB.transformMat4(this.pivot,this.pivot,d.conformation.operator.inverse)
const p=d.lookup3d.approxNearest(this.pivot[0],this.pivot[1],this.pivot[2],a,s.unitGroupResult)
for(let e=0,t=p.count;e<t;e++)p.squaredDistances[e]<u&&(r.add(s.result,d,p.indices[e],p.squaredDistances[e]),u=p.squaredDistances[e])}return s.result}get boundary(){return this.structure.boundary}constructor(e){this.structure=e,this.pivot=(0,o.eB)(),this.heap=new l.h,this.findContext=c()
const{units:t,boundary:n}=e,r=t.length,s=new Float32Array(r),u=new Float32Array(r),d=new Float32Array(r),p=new Float32Array(r),h=(0,o.eB)()
for(let i=0;i<r;i++){const e=t[i],n=e.boundary.sphere
o.eB.transformMat4(h,n.center,e.conformation.operator.matrix),s[i]=h[0],u[i]=h[1],d[i]=h[2],p[i]=n.radius}const f={x:s,y:u,z:d,radius:p,indices:a.CD.ofBounds(0,r)}
this.unitLookup=(0,i.Eh)(f,n)}}},30897(e,t,n){"use strict"
n.d(t,{v:()=>X})
var r,i,o=n(88288),a=n(87095),s=n(92384),l=n(32775),c=n(87423),u=n(9043)
!function(e){let t
e.is=u.NJ.has,e.create=u.NJ.create,function(e){e[e._=0]="_",e[e.H=1]="H",e[e.B=2]="B",e[e.E=4]="E",e[e.G=8]="G",e[e.I=16]="I",e[e.S=32]="S",e[e.T=64]="T",e[e.T3=128]="T3",e[e.T4=256]="T4",e[e.T5=512]="T5",e[e.T3S=1024]="T3S",e[e.T4S=2048]="T4S",e[e.T5S=4096]="T5S"}(t=e.Flag||(e.Flag={}))}(r||(r={})),function(e){e[e.PARALLEL=0]="PARALLEL",e[e.ANTI_PARALLEL=1]="ANTI_PARALLEL"}(i||(i={}))
class d{constructor(e,t,n){this.partner1=Math.min(e,t),this.partner2=Math.max(e,t),this.type=n}}var p=n(29067)
const h=-27.888
function f(e,t,n,r){const i=l.eB.distance(e,r),o=l.eB.distance(t,r),a=l.eB.distance(t,n),s=l.eB.distance(e,n),c=h/i-h/o+(h/a-h/s)
return c<-9.9?-9.9:c}function m(e,t){if(t.type!==e.type)return!1
if(t.partner1!==e.firstEnd+1)return!1
if(t.type===i.PARALLEL){if(t.partner2===e.secondEnd+1)return!0}else if(t.partner2===e.secondStart-1)return!0
return!1}function g(e,t){return e.type===t.type&&t.firstStart-e.firstEnd<6&&e.firstStart<t.firstStart&&0===t.nextLadder&&(e.type===i.PARALLEL?y(e,t):y(t,e))}function y(e,t){return t.secondStart-e.secondEnd>0&&(t.secondStart-e.secondEnd<6&&t.firstStart-e.firstEnd<3||t.secondStart-e.secondEnd<3)}function v(e){return r.is(e,r.Flag.G)||r.is(e,r.Flag.H)||r.is(e,r.Flag.I)}var b=n(14294),x=n(67538),S=n(93036)
const _={oldDefinition:s.t.Boolean(!0,{description:"Whether to use the old DSSP convention for the annotation of turns and helices, causes them to be two residues shorter"}),oldOrdering:s.t.Boolean(!0,{description:"Alpha-helices are preferred over 3-10 helices"})},C=s.t.getDefaultValues(_)
async function w(e,t){const n=function(e){const{index:t}=e.model.atomicHierarchy,{proteinElements:n,residueIndex:r}=e,i=n.length,o=new Uint32Array(i),a=new Int32Array(i),s=new Int32Array(i),l=new Int32Array(i),c=new Int32Array(i)
for(let u=0;u<i;++u){const e=r[n[u]]
o[u]=e,a[u]=t.findAtomOnResidue(e,"C"),s[u]=t.findAtomOnResidue(e,"H"),l[u]=t.findAtomOnResidue(e,"O"),c[u]=t.findAtomOnResidue(e,"N")}return{residueIndices:x.X9.ofSortedArray(o),cIndices:a,hIndices:s,oIndices:l,nIndices:c}}(e),{residueIndices:a}=n,s=function(e,t){const{x:n,y:r,z:i}=e.model.atomicConformation,{traceElementIndex:o}=e.model.atomicHierarchy.derived.residue,a=new Uint32Array(t.length)
for(let l=0,c=t.length;l<c;++l)a[l]=o[t[l]]
const s={x:n,y:r,z:i,indices:x.X9.ofSortedArray(a)}
return(0,b.Eh)(s,(0,S.r)(s))}(e,a),u=function(e,t,n){const{residueIndices:r,cIndices:i,hIndices:o,nIndices:a,oIndices:s}=t,{index:c}=e.model.atomicHierarchy,u=e.conformation,{traceElementIndex:d}=e.model.atomicHierarchy.derived.residue,h=r.length,m=[],g=[],y=[],v=(0,l.eB)(),b=(0,l.eB)(),x=(0,l.eB)(),S=(0,l.eB)(),_=(0,l.eB)(),C=(0,l.eB)(),w=(0,l.eB)()
for(let p=0,T=r.length;p<T;++p){const e=p,t=r[p],h=s[e],T=i[e],A=d[t]
if(-1===h||-1===T)continue
if(-1!==c.findAtomOnResidue(t,"OXT"))continue
u.invariantPosition(h,v),u.invariantPosition(T,b),u.invariantPosition(A,x)
const{indices:I,count:P}=n.find(x[0],x[1],x[2],9)
for(let n=0;n<P;++n){const t=I[n]
if(t===e||t-1===e||t+1===e)continue
const r=a[t]
if(-1===r)continue
u.invariantPosition(r,S)
const c=o[t]
if(-1===c){if(0===t)continue
const e=t-1,n=s[e],r=i[e]
if(-1===n||-1===r)continue
u.invariantPosition(n,w),u.invariantPosition(r,C),l.eB.sub(_,C,w)
const o=l.eB.distance(w,C)
l.eB.scaleAndAdd(_,S,_,1/o)}else u.invariantPosition(c,_)
const d=f(v,b,S,_)
d>-.5||(m[m.length]=e,g[g.length]=t,y[y.length]=d)}}return function(e,t,n,r){const i=new p.O.DirectedEdgeBuilder(e,t,n),o=new Float32Array(i.slotCount)
for(let a=0,s=i.edgeCount;a<s;a++)i.addNextEdge(),i.assignProperty(o,r[a])
return i.createGraph({energies:r})}(h,m,g,y)}(e,n,s),h=a.length,y=new Uint32Array(h),_=function(e,t){const{cIndices:n,nIndices:r,residueIndices:i}=t,o=e.conformation,{index:a}=e.model.atomicHierarchy,{traceElementIndex:s}=e.model.atomicHierarchy.derived.residue,u=i.length,d=(e,t)=>-1===e?l.eB.setNaN(t):o.position(e,t)
let p=(0,l.eB)(),h=(0,l.eB)(),f=(0,l.eB)(),m=(0,l.eB)(),g=(0,l.eB)(),y=(0,l.eB)()
const v=(0,l.eB)(),b=(0,l.eB)(),x=(0,l.eB)()
if(0===u)return{phi:new Float32Array(0),psi:new Float32Array(0)}
const S=new Float32Array(u-1),_=new Float32Array(u-1)
d(-1,p),d(-1,h),d(-1,f),d(n[0],m),d(s[i[0]],g),d(r[0],y),d(n[1],v),d(s[i[1]],b),d(r[1],x)
for(let C=0;C<u-1;++C)-1===a.findAtomOnResidue(i[C],"OXT")&&(S[C]=(0,c.H)(l.eB.dihedralAngle(p,y,g,m)),_[C]=(0,c.H)(l.eB.dihedralAngle(y,g,m,x)),p=m,h=g,f=y,m=v,g=b,y=x,d(n[C+1],v),d(s[i[C+1]],b),d(r[C+1],x))
return{phi:S,psi:_}}(e,n),C=t.oldDefinition?I:B,w={params:t,getResidueFlag:C,getFlagName:t.oldOrdering?P:E,unit:e,proteinInfo:n,flags:y,hbonds:u,torsionAngles:_,ladders:[],bridges:[]}
!function(e){const{proteinInfo:t,hbonds:n,flags:i}=e,o=[r.Flag.T3S,r.Flag.T4S,r.Flag.T5S,r.Flag.T3,r.Flag.T4,r.Flag.T5]
for(let a=0;a<3;a++)for(let s=0,l=t.residueIndices.length-1;s<l;++s)if(-1!==n.getDirectedEdgeIndex(s,s+a+3))if(i[s]|=o[a+3]|o[a],e.params.oldDefinition)for(let e=1;e<a+3;++e)i[s+e]|=o[a+3]|r.Flag.T
else for(let e=0;e<=a+3;++e)i[s+e]|=o[a+3]|r.Flag.T}(w),function(e){const{proteinInfo:t,flags:n}=e,i=t.residueIndices.length,o=[r.Flag.T3S,r.Flag.T4S,r.Flag.T5S,r.Flag.T3,r.Flag.T4,r.Flag.T5],a=[0,0,0,r.Flag.G,r.Flag.H,r.Flag.I],s=e.params.oldOrdering?[4,3,5]:[3,4,5]
for(let l=0;l<s.length;l++){const t=s[l]
for(let s=1,l=i-t;s<l;s++){const i=r.create(n[s]),l=r.create(n[s-1]),c=r.create(n[s+1])
if(e.params.oldOrdering){if(3===t&&(r.is(i,r.Flag.H)||r.is(c,r.Flag.H))||5===t&&(r.is(i,r.Flag.H)||r.is(i,r.Flag.G)||r.is(c,r.Flag.H)||r.is(c,r.Flag.G)))continue}else if(4===t&&(r.is(i,r.Flag.G)||r.is(c,r.Flag.G))||5===t&&(r.is(i,r.Flag.H)||r.is(i,r.Flag.G)||r.is(c,r.Flag.H)||r.is(c,r.Flag.G)))continue
if(r.is(i,o[t])&&r.is(i,o[t-3])&&r.is(l,o[t])&&r.is(l,o[t-3]))if(e.params.oldDefinition)for(let e=0;e<t;e++)n[s+e]|=a[t]
else for(let e=-1;e<=t;e++)n[s+e]|=a[t]}}}(w),function(e){const{unit:t,flags:n,proteinInfo:i}=e,o=t.conformation,{traceElementIndex:a}=t.model.atomicHierarchy.derived.residue,{residueIndices:s,nIndices:u}=i,d=s.length,p=(e,t)=>-1===e?l.eB.setNaN(t):o.position(e,t),h=(0,l.eB)(),f=(0,l.eB)(),m=(0,l.eB)(),g=(0,l.eB)(),y=(0,l.eB)(),v=(0,l.eB)(),b=(0,l.eB)()
e:for(let x=2;x<d-2;x++){for(let n=0;n<4;n++){const e=x+n-2
if(p(a[e],g),p(u[e+1],y),l.eB.squaredDistance(g,y)>6.25)continue e}const e=s[x-2],t=s[x],i=s[x+2],o=a[e],d=a[t],S=a[i]
p(o,h),p(d,f),p(S,m),l.eB.sub(v,h,f),l.eB.sub(b,f,m)
const _=(0,c.H)(l.eB.angle(v,b))
_&&_>70&&(n[x]|=r.Flag.S)}}(w),function(e){const{proteinInfo:t,hbonds:n,flags:o,bridges:a}=e,{offset:s,b:l}=n
let c,u
for(let p=0,h=t.residueIndices.length;p<h;++p)for(let e=s[p],t=s[p+1];e<t;e++){const t=l[e]
p>t||(c=p+1,u=t,c!==u&&-1!==n.getDirectedEdgeIndex(u,c+1)&&(o[c]|=r.Flag.B,o[u]|=r.Flag.B,a[a.length]=new d(c,u,i.PARALLEL)),c=p,u=t-1,c!==u&&-1!==n.getDirectedEdgeIndex(u-1,c)&&(o[c]|=r.Flag.B,o[u]|=r.Flag.B,a[a.length]=new d(u,c,i.PARALLEL)),c=p,u=t,c!==u&&-1!==n.getDirectedEdgeIndex(u,c)&&(o[c]|=r.Flag.B,o[u]|=r.Flag.B,a[a.length]=new d(u,c,i.ANTI_PARALLEL)),c=p+1,u=t-1,c!==u&&-1!==n.getDirectedEdgeIndex(u-1,c+1)&&(o[c]|=r.Flag.B,o[u]|=r.Flag.B,a[a.length]=new d(u,c,i.ANTI_PARALLEL)))}a.sort((e,t)=>e.partner1>t.partner1?1:e.partner1<t.partner1?-1:0)}(w),function(e){const{bridges:t,ladders:n}=e
for(let r=0;r<t.length;r++){const e=t[r]
let o=!1
for(let t=0;t<n.length;t++){const r=n[t]
m(r,e)&&(o=!0,r.firstEnd++,e.type===i.PARALLEL?r.secondEnd++:r.secondStart--)}o||(n[n.length]={previousLadder:0,nextLadder:0,firstStart:e.partner1,firstEnd:e.partner1,secondStart:e.partner2,secondEnd:e.partner2,type:e.type})}for(let r=0;r<n.length;r++){const e=n[r]
for(let t=r;t<n.length;t++){const i=n[t]
g(e,i)&&(e.nextLadder=t,i.previousLadder=r)}}}(w),function(e){const{ladders:t,flags:n}=e
for(let o=0;o<t.length;o++){const e=t[o]
for(let t=e.firstStart;t<=e.firstEnd;t++){const i=e.firstStart-t,o=e.secondStart-i
e.firstStart!==e.firstEnd?(n[t]|=r.Flag.E,n[o]|=r.Flag.E):(!v(n[t])&&r.is(n[t],r.Flag.E)&&(n[t]|=r.Flag.B),!v(n[o])&&r.is(n[o],r.Flag.E)&&(n[o]|=r.Flag.B))}if(0===e.nextLadder)continue
const a=t[e.nextLadder]
for(let t=e.firstStart;t<=a.firstEnd;t++)n[t]|=r.Flag.E
if(e.type===i.PARALLEL)for(let t=e.secondStart;t<=a.secondEnd;t++)n[t]|=r.Flag.E
else for(let t=a.secondEnd;t<=e.secondStart;t++)n[t]|=r.Flag.E}}(w)
const k=function(e,t){const n=new Uint32Array(e.length)
for(let i=0,o=e.length;i<o;++i){const o=r.create(e[i])
n[i]=t(o)}return n}(y,C),D=new Uint32Array(h),M=[],R=[]
for(let r=0,i=a.length;r<i;++r){const e=k[r]
D[r]=e
const t=C(y[r])
0!==R.length&&t===R[R.length-1].flags||(R[R.length]=T(A(e),y[r],C)),M[r]=R.length-1}return(0,o.M)(D,M,R,e=>x.X9.indexOf(a,e))}function T(e,t,n){return"helix"===e?{kind:"helix",flags:n(t)}:"sheet"===e?{kind:"sheet",flags:n(t)}:"turn"===e||"bend"===e?{kind:"turn",flags:n(t)}:{kind:"none"}}function A(e){return e===a.SecondaryStructureType.SecondaryStructureDssp.H||e===a.SecondaryStructureType.SecondaryStructureDssp.G||e===a.SecondaryStructureType.SecondaryStructureDssp.I?"helix":e===a.SecondaryStructureType.SecondaryStructureDssp.B||e===a.SecondaryStructureType.SecondaryStructureDssp.E?"sheet":e===a.SecondaryStructureType.SecondaryStructureDssp.T?"turn":e===a.SecondaryStructureType.SecondaryStructureDssp.S?"bend":"none"}function I(e){return r.is(e,r.Flag.H)?a.SecondaryStructureType.SecondaryStructureDssp.H:r.is(e,r.Flag.E)?a.SecondaryStructureType.SecondaryStructureDssp.E:r.is(e,r.Flag.B)?a.SecondaryStructureType.SecondaryStructureDssp.B:r.is(e,r.Flag.G)?a.SecondaryStructureType.SecondaryStructureDssp.G:r.is(e,r.Flag.I)?a.SecondaryStructureType.SecondaryStructureDssp.I:r.is(e,r.Flag.T)?a.SecondaryStructureType.SecondaryStructureDssp.T:r.is(e,r.Flag.S)?a.SecondaryStructureType.SecondaryStructureDssp.S:a.SecondaryStructureType.Flag.None}function P(e){return r.is(e,r.Flag.H)?"H":r.is(e,r.Flag.E)?"E":r.is(e,r.Flag.B)?"B":r.is(e,r.Flag.G)?"G":r.is(e,r.Flag.I)?"I":r.is(e,r.Flag.T)?"T":r.is(e,r.Flag.S)?"S":"-"}function B(e){return r.is(e,r.Flag.I)?a.SecondaryStructureType.SecondaryStructureDssp.I:r.is(e,r.Flag.H)?a.SecondaryStructureType.SecondaryStructureDssp.H:r.is(e,r.Flag.E)?a.SecondaryStructureType.SecondaryStructureDssp.E:r.is(e,r.Flag.B)?a.SecondaryStructureType.SecondaryStructureDssp.B:r.is(e,r.Flag.G)?a.SecondaryStructureType.SecondaryStructureDssp.G:r.is(e,r.Flag.T)?a.SecondaryStructureType.SecondaryStructureDssp.T:r.is(e,r.Flag.S)?a.SecondaryStructureType.SecondaryStructureDssp.S:a.SecondaryStructureType.Flag.None}function E(e){return r.is(e,r.Flag.I)?"I":r.is(e,r.Flag.H)?"H":r.is(e,r.Flag.E)?"E":r.is(e,r.Flag.B)?"B":r.is(e,r.Flag.G)?"G":r.is(e,r.Flag.T)?"T":r.is(e,r.Flag.S)?"S":"-"}var k=n(44688),D=n(76840),M=n(15769),R=n(33205),O=n(94050),L=n(37411)
const N=[5.45,5.18,6.37],F=[6.1,10.4,13],z=(0,L.e)(),j=(0,L.e)()
function V(e,t,n,r,i){const o=e.conformation,{traceElementIndex:a}=e.model.atomicHierarchy.derived.residue
for(let s=Math.max(0,n-2);s<=n;++s)for(let e=2;e<5;++e){if(s+e>=t.length)return!1
const n=t[s],l=t[s+e],c=a[n],u=a[l]
if(-1===c||-1===u)return!1
o.invariantPosition(c,z),o.invariantPosition(u,j)
const d=L.e.distance(z,j)
if(Math.abs(d-r[e-2])>=i)return!1}return!0}async function U(e){const t=e.proteinElements.length,n=new Uint32Array(t),r=[],i=[],{proteinElements:s,residueIndex:l}=e,c=s.length,u=new Uint32Array(c)
for(let o=0;o<c;++o){const e=l[s[o]]
u[o]=e}const d=x.X9.ofSortedArray(u)
for(let o=0,p=d.length;o<p;++o){let t=a.SecondaryStructureType.Flag.None
V(e,d,o,N,2.1)?t=a.SecondaryStructureType.Flag.Helix:V(e,d,o,F,1.42)&&(t=a.SecondaryStructureType.Flag.Beta),n[o]=t,0!==i.length&&t===q(i[i.length-1])||(i[i.length]=G(H(t),t)),r[o]=i.length-1}return(0,o.M)(n,r,i,e=>x.X9.indexOf(d,e))}function G(e,t){return"helix"===e?{kind:"helix",flags:t}:"sheet"===e?{kind:"sheet",flags:t}:{kind:"none"}}function H(e){return e===a.SecondaryStructureType.Flag.Helix?"helix":e===a.SecondaryStructureType.Flag.Beta?"sheet":"none"}function q(e){return"helix"===e.kind||"sheet"===e.kind?e.flags:a.SecondaryStructureType.Flag.None}function Q(e){return{type:s.t.MappedStatic("auto",{auto:s.t.EmptyGroup({label:"Automatic"}),model:s.t.EmptyGroup({label:"Model"}),dssp:s.t.Group(_,{label:"DSSP",isFlat:!0}),"zhang-skolnick":s.t.EmptyGroup({label:"Zhang-Skolnick"})},{options:[["auto","Automatic"],["model","Model"],["dssp","DSSP"],["zhang-skolnick","Zhang-Skolnick"]]})}}const $=Q(),X=D.S.createProvider({label:"Secondary Structure",descriptor:(0,R.e)({name:"molstar_computed_secondary_structure"}),type:"root",defaultParams:$,getParams:Q,isApplicable:e=>!0,obtain:async(e,t,n)=>{const r={...s.t.getDefaultValues($),...n}
switch(r.type.name){case"auto":return{value:await W(t)}
case"dssp":return{value:await Y(t,r.type.params)}
case"model":return{value:await K(t)}
case"zhang-skolnick":return{value:await Z(t)}}}})
async function W(e){const t=new Map
for(let n=0,r=e.unitSymmetryGroups.length;n<r;++n){const r=e.unitSymmetryGroups[n].units[0],i=r.model
if(O.Kx.isFromPdbArchive(i)&&O.Kx.isExperimental(i)&&!O.Kx.isCoarseGrained(i)||O.Kx.hasSecondaryStructure(i)){const e=M.v.Provider.get(i)
e&&t.set(r.invariantId,e)}else if(k.Nf.isAtomic(r)&&!O.Kx.isCoarseGrained(i)){const e=await w(r,C)
t.set(r.invariantId,e)}else if(k.Nf.isAtomic(r)){const e=await U(r)
t.set(r.invariantId,e)}}return t}async function Y(e,t){const n=new Map
for(let r=0,i=e.unitSymmetryGroups.length;r<i;++r){const i=e.unitSymmetryGroups[r].units[0]
if(k.Nf.isAtomic(i)&&!O.Kx.isCoarseGrained(i.model)){const e=await w(i,t)
n.set(i.invariantId,e)}}return n}async function Z(e){const t=new Map
for(let n=0,r=e.unitSymmetryGroups.length;n<r;++n){const r=e.unitSymmetryGroups[n].units[0]
if(k.Nf.isAtomic(r)){const e=await U(r)
t.set(r.invariantId,e)}}return t}async function K(e){const t=new Map
for(let n=0,r=e.unitSymmetryGroups.length;n<r;++n){const r=e.unitSymmetryGroups[n].units[0]
if(k.Nf.isAtomic(r)){const e=M.v.Provider.get(r.model)
e&&t.set(r.invariantId,e)}}return t}},31312(e,t,n){"use strict"
n.d(t,{DG:()=>v,MQ:()=>C,Op:()=>y,R8:()=>f,Rb:()=>x,Vv:()=>_,a2:()=>m,fy:()=>b,nF:()=>g,nH:()=>w,xl:()=>S})
var r=n(40362),i=n(30084),o=n(10596),a=n(65580),s=n(32520),l=n(47404),c=n(88524),u=n(70948),d=n(71712),p=n(92384),h=n(7221)
function f(e){return p.t.MultiSelect(e,h.hi,{description:"For which kinds of units/chains to show the representation visuals."})}const m={unitKinds:f(["atomic","spheres"]),includeParent:p.t.Boolean(!1,{isHidden:!0})},g={...o.e.Params},y={...s.v.Params},v={...l.S.Params},b={...a.O.Params},x={...i.q.Params},S={...c.E.Params},_={...r.E.Params},C={...u.X.Params},w={...d._V.Params}},31683(e,t,n){"use strict"
n.d(t,{NP:()=>C,Pw:()=>h,Zb:()=>p,gV:()=>u,ji:()=>_,pg:()=>S,sZ:()=>b,z1:()=>x,z6:()=>w})
var r=n(9043),i=n(9959),o=n(24060),a=n(91229),s=n(95538),l=n(87423)
const c=(0,i.q)()
function u(e,t,n){switch(t){case"alpha":return!(0,o.C6)(e)||"float"!==n&&"fp16"!==n?(0,o.C6)(e)&&"int"===n?e.RED_INTEGER:e.ALPHA:e.RED
case"rgb":return(0,o.C6)(e)&&"int"===n?e.RGB_INTEGER:e.RGB
case"rg":if(!(0,o.C6)(e)||"float"!==n&&"fp16"!==n){if((0,o.C6)(e)&&"int"===n)return e.RG_INTEGER
throw new Error('texture format "rg" requires webgl2 and type "float" or int"')}return e.RG
case"rgba":return(0,o.C6)(e)&&"int"===n?e.RGBA_INTEGER:e.RGBA
case"depth":return e.DEPTH_COMPONENT}}function d(e,t,n,r,i){return p(e,t)*n*r*(i||1)}function p(e,t){return function(e){switch(e){case"alpha":return 1
case"rg":return 2
case"rgb":return 3
case"rgba":case"depth":return 4}}(e)*function(e){switch(e){case"ubyte":return 1
case"ushort":case"fp16":return 2
case"float":case"int":return 4}}(t)}function h(e,t,n){switch(n){case"ubyte":return e.UNSIGNED_BYTE
case"ushort":return e.UNSIGNED_SHORT
case"float":return e.FLOAT
case"fp16":if(t.textureHalfFloat)return t.textureHalfFloat.HALF_FLOAT
throw new Error('extension "texture_half_float" unavailable')
case"int":if((0,o.C6)(e))return e.INT
throw new Error('texture type "int" requires webgl2')}}function f(e,t){switch(t){case"nearest":return e.NEAREST
case"linear":return e.LINEAR}}function m(e,t,n){switch(n){case"depth":return e.DEPTH_ATTACHMENT
case"stencil":return e.STENCIL_ATTACHMENT
case"color0":case 0:return e.COLOR_ATTACHMENT0}if(t.drawBuffers)switch(n){case"color1":case 1:return t.drawBuffers.COLOR_ATTACHMENT1
case"color2":case 2:return t.drawBuffers.COLOR_ATTACHMENT2
case"color3":case 3:return t.drawBuffers.COLOR_ATTACHMENT3
case"color4":case 4:return t.drawBuffers.COLOR_ATTACHMENT4
case"color5":case 5:return t.drawBuffers.COLOR_ATTACHMENT5
case"color6":case 6:return t.drawBuffers.COLOR_ATTACHMENT6
case"color7":case 7:return t.drawBuffers.COLOR_ATTACHMENT7}throw new Error("unknown texture attachment")}function g(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement}function y(e,t,n){return t===n.TEXTURE_3D}function v(e){const t=e.createTexture()
if(null===t)throw new Error("Could not create WebGL texture")
return t}function b(e,t,n,r,i,a){const s=c()
let p=v(e)
if(n.endsWith("float32")&&"float"!==i||n.endsWith("float16")&&"fp16"!==i||n.endsWith("uint8")&&"ubyte"!==i||n.endsWith("int32")&&"int"!==i||n.endsWith("depth")&&"ushort"!==i&&"float"!==i)throw new Error(`texture kind '${n}' and type '${i}' are incompatible`)
if(!t.depthTexture&&"depth"===r)throw new Error("extension 'WEBGL_depth_texture' needed for 'depth' texture format")
const b=function(e,t){switch(t){case"image-uint8":case"image-float32":case"image-float16":case"image-depth":return e.TEXTURE_2D}if((0,o.C6)(e))switch(t){case"image-int32":return e.TEXTURE_2D
case"volume-uint8":case"volume-float32":case"volume-float16":return e.TEXTURE_3D}throw new Error(`unknown texture kind '${t}'`)}(e,n),x=f(e,a),S=u(e,r,i),_=function(e,t,n){if((0,o.C6)(e))switch(t){case"alpha":switch(n){case"ubyte":return e.ALPHA
case"float":return e.R32F
case"fp16":return e.R16F
case"int":return e.R32I}case"rg":switch(n){case"ubyte":return e.RG
case"float":return e.RG32F
case"fp16":return e.RG16F
case"int":return e.RG32I}case"rgb":switch(n){case"ubyte":return e.RGB
case"float":return e.RGB32F
case"fp16":return e.RGB16F
case"int":return e.RGB32I}case"rgba":switch(n){case"ubyte":return e.RGBA
case"float":return e.RGBA32F
case"fp16":return e.RGBA16F
case"int":return e.RGBA32I}case"depth":switch(n){case"ushort":return e.DEPTH_COMPONENT16
case"float":return e.DEPTH_COMPONENT32F}}return u(e,t,n)}(e,r,i),C=h(e,t,i)
function w(){e.bindTexture(b,p),e.texParameteri(b,e.TEXTURE_MAG_FILTER,x),e.texParameteri(b,e.TEXTURE_MIN_FILTER,x),e.texParameteri(b,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(b,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(b,null)}w()
let T,A=0,I=0,P=0,B=!1,E=!1
function k(t,n,r){if(0===t||0===n||(0,o.C6)(e)&&b===e.TEXTURE_3D&&0===r)throw new Error("empty textures are not allowed")
if(A!==t||I!==n||P!==(r||0))if(A=t,I=n,P=r||0,e.bindTexture(b,p),b===e.TEXTURE_2D)e.texImage2D(b,0,_,A,I,0,S,C,null)
else{if(!(0,o.C6)(e)||b!==e.TEXTURE_3D||void 0===P)throw new Error("unknown texture target")
e.texImage3D(b,0,_,A,I,P,0,S,C,null)}}function D(t,n=!1){if(0===t.width||0===t.height||!g(t)&&(0,o.C6)(e)&&y(0,b,e)&&0===t.depth)throw new Error("empty textures are not allowed")
if(e.bindTexture(b,p),e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),g(t))A=t.width,I=t.height,e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.bindTexture(e.TEXTURE_2D,p),e.texImage2D(e.TEXTURE_2D,0,_,S,C,t)
else if(function(e,t,n){return t===n.TEXTURE_2D}(0,b,e)){const r=t.filter?f(e,t.filter):x
e.texParameteri(b,e.TEXTURE_MAG_FILTER,r),e.texParameteri(b,e.TEXTURE_MIN_FILTER,r),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!!t.flipY),n?e.texSubImage2D(b,0,0,0,t.width,t.height,S,C,t.array):(A=t.width,I=t.height,e.texImage2D(b,0,_,A,I,0,S,C,t.array))}else{if(!(0,o.C6)(e)||!y(0,b,e))throw new Error("unknown texture target")
e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),n?e.texSubImage3D(b,0,0,0,0,t.width,t.height,t.depth,S,C,t.array):(A=t.width,I=t.height,P=t.depth,e.texImage3D(b,0,_,A,I,P,0,S,C,t.array))}e.bindTexture(b,null),T=t}function M(){if(b!==e.TEXTURE_2D)throw new Error("mipmap only supported for 2d textures")
if(!((0,o.C6)(e)||(0,l.r6)(A)&&(0,l.r6)(I)))throw new Error("mipmap unsupported for non-power-of-two textures and webgl1")
e.bindTexture(b,p),e.texParameteri(b,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.generateMipmap(b),e.bindTexture(b,null),B=!0}return k(1,1,(0,o.C6)(e)&&b===e.TEXTURE_3D?1:0),{id:s,target:b,format:S,internalFormat:_,type:C,filter:x,getWidth:()=>A,getHeight:()=>I,getDepth:()=>P,getByteCount:()=>d(r,i,A,I,P),define:k,load:D,mipmap:M,bind:t=>{e.activeTexture(e.TEXTURE0+t),e.bindTexture(b,p)},unbind:t=>{e.activeTexture(e.TEXTURE0+t),e.bindTexture(b,null)},attachFramebuffer:function(n,r,i){if(n.bind(),b===e.TEXTURE_2D)e.framebufferTexture2D(e.FRAMEBUFFER,m(e,t,r),e.TEXTURE_2D,p,0)
else{if(!(0,o.C6)(e)||b!==e.TEXTURE_3D)throw new Error("unknown/unsupported texture target")
if(void 0===i)throw new Error("need `layer` to attach 3D texture")
e.framebufferTextureLayer(e.FRAMEBUFFER,m(e,t,r),p,0,i)}},detachFramebuffer:(n,r)=>{if(n.bind(),b===e.TEXTURE_2D)e.framebufferTexture2D(e.FRAMEBUFFER,m(e,t,r),e.TEXTURE_2D,null,0)
else{if(!(0,o.C6)(e)||b!==e.TEXTURE_3D)throw new Error("unknown texture target")
e.framebufferTextureLayer(e.FRAMEBUFFER,m(e,t,r),null,0,0)}},reset:()=>{p=v(e),w()
const[t,n,r]=[A,I,P]
A=0,I=0,P=0,k(t,n,r),T&&D(T),B&&M()},destroy:()=>{E||(e.deleteTexture(p),E=!0)}}}function x(e,t,n){const{resources:r}=e,i=[]
return Object.keys(t).forEach(e=>{const o=t[e]
if("texture"===o.type){const t=n[e]
if(t)if("texture"===o.kind)i[i.length]=[e,t.ref.value]
else{const n=r.texture(o.kind,o.format,o.dataType,o.filter)
n.load(t.ref.value),i[i.length]=[e,n]}}}),i}function S(e,t,n){const i=new Image
i.onload=function(){n.load(i),r.IQ.update(t,n)},i.src=e}function _(e,t,n,r){const i=e.TEXTURE_CUBE_MAP,o=e.LINEAR,l=e.RGBA,u=e.RGBA,p=e.UNSIGNED_BYTE
let h=0,f=e.createTexture()
function m(t,a,s,c){0===h&&(h=s.width),e.bindTexture(i,f),e.texImage2D(t,a,l,h,h,0,u,p,null),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.bindTexture(i,f),e.texImage2D(t,a,l,u,p,s),y+=1,6===y&&(b||(n?(e.texParameteri(i,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.generateMipmap(i)):e.texParameteri(i,e.TEXTURE_MIN_FILTER,o),e.texParameteri(i,e.TEXTURE_MAG_FILTER,o)),c||null==r||r(b))}e.bindTexture(i,f)
const g=[]
let y=0;(0,s.IF)(t,(t,n)=>{if(!t)return
const i=function(e,t){switch(t){case"nx":return e.TEXTURE_CUBE_MAP_NEGATIVE_X
case"ny":return e.TEXTURE_CUBE_MAP_NEGATIVE_Y
case"nz":return e.TEXTURE_CUBE_MAP_NEGATIVE_Z
case"px":return e.TEXTURE_CUBE_MAP_POSITIVE_X
case"py":return e.TEXTURE_CUBE_MAP_POSITIVE_Y
case"pz":return e.TEXTURE_CUBE_MAP_POSITIVE_Z}}(e,n),o=new Image
t instanceof File?o.src=URL.createObjectURL(t):(0,a.$X)(t)?t.then(e=>{o.src=URL.createObjectURL(e)}):o.src=t,g.push({cubeTarget:i,level:0,image:o}),o.addEventListener("load",()=>{m(i,0,o,!1)}),o.addEventListener("error",()=>{null==r||r(!0)})})
let b=!1
return{id:c(),target:i,format:u,internalFormat:l,type:p,filter:o,getWidth:()=>h,getHeight:()=>h,getDepth:()=>0,getByteCount:()=>6*d("rgba","ubyte",h,h,0)*(n?2:1),define:()=>{},load:()=>{},mipmap:()=>{},bind:t=>{e.activeTexture(e.TEXTURE0+t),e.bindTexture(i,f)},unbind:t=>{e.activeTexture(e.TEXTURE0+t),e.bindTexture(i,null)},attachFramebuffer:()=>{},detachFramebuffer:()=>{},reset:()=>{f=v(e),e.bindTexture(i,f),y=0
for(const{cubeTarget:e,level:t,image:n}of g)m(e,t,n,!0)},destroy:()=>{b||(e.deleteTexture(f),b=!0)}}}function C(e){return-1===e.format}function w(e){var t
const n=null!==(t=null==e?void 0:e.TEXTURE_2D)&&void 0!==t?t:3553
return{id:c(),target:n,format:-1,internalFormat:0,type:0,filter:0,getWidth:()=>0,getHeight:()=>0,getDepth:()=>0,getByteCount:()=>0,define:()=>{},load:()=>{},mipmap:()=>{},bind:t=>{e&&(e.activeTexture(e.TEXTURE0+t),e.bindTexture(n,null))},unbind:t=>{e&&(e.activeTexture(e.TEXTURE0+t),e.bindTexture(n,null))},attachFramebuffer:()=>{throw new Error("cannot attach null-texture to a framebuffer")},detachFramebuffer:()=>{throw new Error("cannot detach null-texture from a framebuffer")},reset:()=>{},destroy:()=>{}}}},31727(e,t,n){"use strict"
n.d(t,{Ax:()=>m,sL:()=>h,xg:()=>l})
var r=n(14294),i=n(32775),o=n(10314)
n(63356)
const a=i.eB.fromArray,s=i.eB.transformMat4Offset
function l(e,t,n,r){const{length:i,width:o,height:a}=function(e,t){e=Math.max(e,2)
const n=Math.sqrt(e)
let r=Math.ceil(n)
r+=(t-r%t)%t
const i=r>0?Math.ceil(e/r):0
return{width:r,height:i,length:r*i*t}}(e,t)
return{array:r=r&&r.length>=i?r:new n(i),width:o,height:a}}const c=(0,i.eB)(),u=new o.Z("14"),d=new o.Z("98")
function p(e){return e>1e5?u:d}function h(e,t,n){const o=3*n,s=p(t)
s.reset()
for(let r=0,i=3*t;r<i;r+=o)a(c,e,r),s.includePosition(c)
s.finishedIncludeStep()
for(let r=0,i=3*t;r<i;r+=o)a(c,e,r),s.radiusPosition(c)
const l=s.getSphere()
if(t<=14){const n=[]
for(let r=0,s=3*t;r<s;r+=o)n.push(a((0,i.eB)(),e,r))
r.f8.setExtrema(l,n)}return l}const f=(0,i.$I)()
function m(e,t,n,o){if(1===n){i.$I.fromArray(f,t,o)
const n=r.f8.clone(e)
return i.$I.isIdentity(f)?n:r.f8.transform(n,n,f)}const a=p(n)
a.reset()
const{center:l,radius:u,extrema:d}=e
if(d&&n<=14){for(let e=0,r=n;e<r;++e)for(const n of d)s(c,n,t,0,0,16*e+o),a.includePosition(c)
a.finishedIncludeStep()
for(let e=0,r=n;e<r;++e)for(const n of d)s(c,n,t,0,0,16*e+o),a.radiusPosition(c)}else{for(let e=0,r=n;e<r;++e)s(c,l,t,0,0,16*e+o),a.includePositionRadius(c,u)
a.finishedIncludeStep()
for(let e=0,r=n;e<r;++e)s(c,l,t,0,0,16*e+o),a.radiusPositionRadius(c,u)}return a.getSphere()}},31993(e,t,n){"use strict"
n.d(t,{G:()=>l,c:()=>c})
var r=n(61993),i=n(22063),o=n(92384),a=n(21946)
async function s(e,t,n=!1){var i,a,s,l,c,u,d
if(t.data&&await e.runTask(e.state.data.setSnapshot(t.data)),null===(i=t.canvas3d)||void 0===i?void 0:i.props){const n=o.t.normalizeParams(r._i,t.canvas3d.props,"children");((null===(a=t.camera)||void 0===a?void 0:a.current)||(null===(s=t.camera)||void 0===s?void 0:s.focus))&&(n.camera=void 0,n.cameraClipping=void 0,n.cameraFog=void 0),null===(l=e.canvas3d)||void 0===l||l.setProps(n)}(null===(c=t.camera)||void 0===c?void 0:c.current)?null===(u=e.canvas3d)||void 0===u||u.requestCameraReset({snapshot:t.camera.current,durationMs:n||"instant"===t.camera.transitionStyle?0:t.camera.transitionDurationInMs}):(null===(d=t.camera)||void 0===d?void 0:d.focus)&&e.managers.camera.focusObject({...t.camera.focus,durationMs:n||"instant"===t.camera.transitionStyle?0:t.camera.transitionDurationInMs})}const l=a.b.create({name:"built-in.animate-state-snapshots",display:{name:"State Snapshots"},isExportable:!0,params:()=>({}),canApply(e){const t=e.managers.snapshot.state.entries
return t.size<1?{canApply:!1,reason:"At least 1 state required."}:t.some(e=>!!(null==e?void 0:e.snapshot.startAnimation))?{canApply:!1,reason:"Nested animations not supported."}:{canApply:e.managers.snapshot.state.entries.size>0}},setup(e,t,n){const r=n.managers.snapshot.state.entries.get(0)
s(n,r.snapshot,!0)},getDuration:(e,t)=>({kind:"fixed",durationMs:t.managers.snapshot.state.entries.toArray().reduce((e,t)=>{var n
return e+(null!==(n=t.snapshot.durationInMs)&&void 0!==n?n:0)},0)}),initialState:(e,t)=>{const n=t.managers.snapshot.state.entries.toArray()
return{totalDuration:n.reduce((e,t)=>{var n
return e+(null!==(n=t.snapshot.durationInMs)&&void 0!==n?n:0)},0),snapshots:n,currentIndex:0,currentTransitionFrame:0}},async apply(e,t,n){var r
if(t.current>=e.totalDuration)return{kind:"finished"}
let o=0,a=0,l=0
for(const i of e.snapshots){if(l=t.current-o,o+=null!==(r=i.snapshot.durationInMs)&&void 0!==r?r:0,t.current<o)break
a++}if(a>=e.snapshots.length)return{kind:"finished"}
const{transition:c,camera:u,canvas3d:d}=e.snapshots[a].snapshot,p=i.p.getStateTransitionFrameIndex(e.snapshots[a].snapshot,l)
return c&&void 0!==p?a===e.currentIndex&&p===e.currentTransitionFrame?{kind:"skip"}:(0===p||a!==e.currentIndex?await s(n.plugin,{...c.frames[p],camera:u,canvas3d:d}):await s(n.plugin,c.frames[p]),{kind:"next",state:{...e,currentIndex:a,currentAnimationFrame:p}}):a===e.currentIndex?{kind:"skip"}:(await s(n.plugin,e.snapshots[a].snapshot),{kind:"next",state:{...e,currentIndex:a,currentAnimationFrame:void 0}})}}),c=a.b.create({name:"built-in.animate-state-snapshot-transition",display:{name:"State Snapshot Transition"},isExportable:!0,params:()=>({}),canApply(e){const{snapshot:t}=e.managers,{current:n}=t
return(null==n?void 0:n.snapshot.transition)?{canApply:!0}:{canApply:!1,reason:"No transition found"}},setup(e,t,n){var r,i
const{current:o}=n.managers.snapshot
o&&s(n,null!==(i=null===(r=o.snapshot.transition)||void 0===r?void 0:r.frames[0])&&void 0!==i?i:o.snapshot,!0)},getDuration:(e,t)=>{var n,r
const{current:o}=t.managers.snapshot
return(null==o?void 0:o.snapshot.transition)?(null===(n=o.snapshot.transition)||void 0===n?void 0:n.loop)?{kind:"infinite"}:{kind:"fixed",durationMs:null!==(r=i.p.getStateTransitionDuration(o.snapshot))&&void 0!==r?r:0}:{kind:"fixed",durationMs:0}},initialState:(e,t)=>{var n,r
const{current:o}=t.managers.snapshot
if(o)return{totalDuration:(null===(n=o.snapshot.transition)||void 0===n?void 0:n.loop)?Number.MAX_VALUE:null!==(r=i.p.getStateTransitionDuration(o.snapshot))&&void 0!==r?r:0,snapshots:[o],currentIndex:0,currentTransitionFrame:void 0,isInitial:!0}},async apply(e,t,n){var r
const o=null===(r=e.snapshots[0])||void 0===r?void 0:r.snapshot
if(t.current>=e.totalDuration){if((null==o?void 0:o.transition)&&e.isInitial){const t=o.transition.frames.length-1
n.plugin.managers.snapshot.setSnapshotAnimationFrame(e.totalDuration,!1),await s(n.plugin,o.transition.frames[t])}return{kind:"finished"}}if(!o)return{kind:"finished"}
const{transition:a,camera:l,canvas3d:c}=o,u=i.p.getStateTransitionFrameIndex(o,t.current)
return a&&void 0!==u?u===e.currentTransitionFrame?{kind:"skip"}:(n.plugin.managers.snapshot.setSnapshotAnimationFrame(t.current,!1),0===u?await s(n.plugin,{...a.frames[u],camera:l,canvas3d:c}):await s(n.plugin,a.frames[u]),{kind:"next",state:{...e,currentAnimationFrame:u,isInitial:!1}}):{kind:"finished"}}})},32117(e,t,n){"use strict"
n.r(t),n.d(t,{ClippingStructureRepresentation3DFromBundle:()=>yn,ClippingStructureRepresentation3DFromScript:()=>gn,EmissiveStructureRepresentation3DFromBundle:()=>hn,EmissiveStructureRepresentation3DFromScript:()=>pn,ExplodeStructureRepresentation3D:()=>an,ModelUnitcell3D:()=>_n,OverpaintStructureRepresentation3DFromBundle:()=>cn,OverpaintStructureRepresentation3DFromScript:()=>ln,ShapeRepresentation3D:()=>Sn,SpinStructureRepresentation3D:()=>sn,StructureBoundingBox3D:()=>Cn,StructureRepresentation3D:()=>rn,StructureSelectionsAngle3D:()=>Tn,StructureSelectionsDihedral3D:()=>An,StructureSelectionsDistance3D:()=>wn,StructureSelectionsLabel3D:()=>In,StructureSelectionsOrientation3D:()=>Pn,StructureSelectionsPlane3D:()=>Bn,SubstanceStructureRepresentation3DFromBundle:()=>mn,SubstanceStructureRepresentation3DFromScript:()=>fn,ThemeStrengthRepresentation3D:()=>vn,TransparencyStructureRepresentation3DFromBundle:()=>dn,TransparencyStructureRepresentation3DFromScript:()=>un,UnwindStructureAssemblyRepresentation3D:()=>on,VolumeRepresentation3D:()=>xn,VolumeRepresentation3DHelpers:()=>bn})
var r=n(48393),i=n(90050),o=n(43472),a=n(70292),s=n(3111),l=n(92384),c=n(39298),u=n(50709),d=n(22703),p=n(16625),h=n(79111),f=n(30372),m=n(23729),g=n(41036),y=n(17782),v=n(40038),b=n(9043),x=n(65081),S=n(68187),_=n(89),C=n(67538),w=n(71196),T=n(17684),A=n(5638)
function I(e,t,n={}){let r=0
const i=new f.B,o=p.YL.createState(),c=(0,m.Q0)(),u=[]
let I,P,B=-1
const E=s.S.createEmpty(),k=t.Params
let D,M,R=l.t.getDefaultValues(k)
n.modifyState&&p.YL.updateState(o,n.modifyState(o))
const O=g.rj.create()
function L(e,t){return(0,_.isEveryLoci)(e)||h.y.isLoci(e)&&e.shape===P?R.instanceGranularity?t(C.IX.ofBounds(0,P.transforms.length)):t(C.IX.ofBounds(0,P.groupCount*P.transforms.length)):R.instanceGranularity?function(e,t,n){let r=!1
if(!h.$.isLoci(e))return!1
if(h.$.isLociEmpty(e))return!1
if(e.shape!==t)return!1
for(const i of e.groups)n(C.IX.ofSingleton(i.instance))&&(r=!0)
return r}(e,P,t):function(e,t,n){if(!h.$.isLoci(e))return!1
if(e.shape!==t)return!1
let r=!1
const{groupCount:i}=t,{groups:o}=e
for(const{ids:a,instance:s}of o)if(C.IX.is(a)){const e=s*i+C.IX.start(a),t=s*i+C.IX.end(a)
n(C.IX.ofBounds(e,t))&&(r=!0)}else for(let e=0,t=a.length;e<t;e++){const t=s*i+a[e]
n(C.IX.ofSingleton(t))&&(r=!0)}return r}(e,P,t)}return{label:"Shape geometry",get groupCount(){return D?D.count:0},get props(){return R},get params(){return k},get state(){return o},get theme(){return E},renderObjects:u,get geometryVersion(){return B},updated:i,createOrUpdate:function(s={},l){return n.modifyProps&&(s=n.modifyProps(s)),a.Task.create("ShapeRepresentation.create",async a=>{const f=Object.assign(R,s),v=l?await e(a,l,f,P):void 0
if(function(e={},t){g.rj.reset(O),(t||P)&&(t&&!P?O.createNew=!0:t&&P&&t.id===P.id||(t&&P&&t.id!==P.id?(O.updateTransform=!0,O.createGeometry=!0):t&&console.warn("unexpected state")),e.instanceGranularity!==R.instanceGranularity&&(O.updateTransform=!0),O.updateTransform&&(O.updateColor=!0,O.updateSize=!0,O.updateMatrix=!0),O.createGeometry&&(O.updateColor=!0,O.updateSize=!0))}(s,v),v&&(P=v,Object.assign(E,h.y.getTheme(P))),O.createNew){u.length=0,D=h.y.groupIterator(P)
const e=h.y.createTransform(P.transforms,P.geometry.boundingSphere,f.cellSize,f.batchSize),r=t.createValues(P.geometry,e,D,E,f),i=t.createRenderableState(f)
n.modifyState&&Object.assign(i,n.modifyState(i)),p.YL.updateState(o,i),I=(0,m.o)(P.geometry.kind,r,i,c),I&&u.push(I),M=t.createPositionIterator(P.geometry,I.values)}else{if(!I)throw new Error("expected renderObject to be available")
if(O.updateTransform){D=h.y.groupIterator(P)
const{instanceCount:e,groupCount:t}=D
s.instanceGranularity?(0,y.Km)(e,"instance",I.values):(0,y.Km)(e*t,"groupInstance",I.values)}O.updateMatrix&&(h.y.createTransform(P.transforms,P.geometry.boundingSphere,f.cellSize,f.batchSize,I.values),"lodLevels"in I.values&&b.IQ.update(I.values.lodLevels,I.values.lodLevels.ref.value)),O.createGeometry&&(b.IQ.updateIfChanged(I.values.drawCount,d.V.getDrawCount(P.geometry)),b.IQ.updateIfChanged(I.values.uVertexCount,d.V.getVertexCount(P.geometry)),b.IQ.updateIfChanged(I.values.uGroupCount,D.groupCount)),O.updateColor&&(0,x.D1)(D,M,E.color,I.values),O.updateSize&&"uSize"in I.values&&(0,S.v3)(D,E.size,I.values),t.updateValues(I.values,f),t.updateRenderableState(I.state,f),(O.updateTransform||O.createGeometry)&&(t.updateBoundingSphere(I.values,P.geometry),M=t.createPositionIterator(P.geometry,I.values))}R=f,(O.createGeometry||O.createNew)&&(B+=1),i.next(r++)})},getLoci(e){const{objectId:t,groupId:n,instanceId:r}=e
return I&&I.id===t?n===w.$.Null?h.y.Loci(P):h.$.Loci(P,[{ids:C.CD.ofSingleton(n),instance:r}]):_.EmptyLoci},getAllLoci:()=>[h.y.Loci(P)],eachLocation:e=>{for(D.reset();D.hasNext;){const{location:t,isSecondary:n}=D.move()
e(t,n)}},mark(e,t){if(!v.sY.is(o.markerActions,t))return!1
if(h.$.isLoci(e)||h.y.isLoci(e)){if(e.shape!==P)return!1}else if(!(0,_.isEveryLoci)(e))return!1
return T.b.mark(I,e,t,L)},setState(e){n.modifyState&&(e=n.modifyState(e)),I&&(void 0!==e.visible&&T.b.setVisibility(I,e.visible),void 0!==e.alphaFactor&&T.b.setAlphaFactor(I,e.alphaFactor),void 0!==e.pickable&&T.b.setPickable(I,e.pickable),void 0!==e.colorOnly&&T.b.setColorOnly(I,e.colorOnly),void 0!==e.overpaint&&T.b.setOverpaint(I,e.overpaint,L,!0),void 0!==e.transparency&&T.b.setTransparency(I,e.transparency,L,!0),void 0!==e.substance&&T.b.setSubstance(I,e.substance,L,!0),void 0!==e.transform&&T.b.setTransform(I,e.transform)),p.YL.updateState(o,e)},setTheme(e){A.Bb&&console.warn("The `ShapeRepresentation` theme is fixed to `ShapeGroupColorTheme` and `ShapeGroupSizeTheme`. Colors are taken from `Shape.getColor` and sizes from `Shape.getSize`")},destroy(){u.length=0,I&&(I.state.disposed=!0,I=void 0)}}}var P=n(32775),B=n(42594)
const E=(0,P.$I)()
class k{constructor(e){this.structure=e,this.groupUnitTransforms=[],this.unitOffsetMap=C.Yz.Mutable(),this.groupIndexMap=new Map,this._isIdentity=void 0,this.version=0,this.unitTransforms=new Float32Array(16*e.units.length),this.size=e.units.length,this.reset()
let t=0
for(let n=0,r=e.unitSymmetryGroups.length;n<r;++n){const r=e.unitSymmetryGroups[n]
this.groupIndexMap.set(r,n)
const i=this.unitTransforms.subarray(t,t+16*r.units.length)
this.groupUnitTransforms.push(i)
for(let e=0,n=r.units.length;e<n;++e)this.unitOffsetMap.set(r.units[e].id,t+16*e)
t+=16*r.units.length}}reset(){this.version=0,(0,B.ES)(this.unitTransforms,this.size),this._isIdentity=!0}get isIdentity(){if(void 0===this._isIdentity){this._isIdentity=!0
for(let e=0,t=16*this.size;e<t;e+=16)if(P.$I.fromArray(E,this.unitTransforms,e),!P.$I.isIdentity(E)){this._isIdentity=!1
break}}return this._isIdentity}setTransform(e,t){this.version=(this.version+1)%2147483647,P.$I.toArray(e,this.unitTransforms,this.unitOffsetMap.get(t.id)),this._isIdentity=void 0}getTransform(e,t){return P.$I.fromArray(e,this.unitTransforms,this.unitOffsetMap.get(t.id))}getSymmetryGroupTransforms(e){return this.groupUnitTransforms[this.groupIndexMap.get(e)]}}var D=n(14294)
const M=(0,P.$I)()
function R(e,t,n){for(let r=0,i=e.units.length;r<i;r++){const i=e.units[r]
D.JX.lerpFromIdentity(M,i.conformation.operator,n),t.setTransform(M,i)}}const O=(0,P.eB)(),L=(0,P.eB)(),N=(0,P.$I)()
function F(e,t,n,r){const i=r.radius*n
for(let o=0,a=e.units.length;o<a;o++){const n=e.units[o]
P.eB.transformMat4(O,n.lookup3d.boundary.sphere.center,n.conformation.operator.matrix),P.eB.sub(L,O,r.center),P.eB.setMagnitude(L,L,i),P.$I.fromTranslation(N,L),t.setTransform(N,n)}}const z={axis:l.t.MappedStatic("custom",{structure:l.t.Group({principalAxis:l.t.Select("dirA",[["dirA","A"],["dirB","B"],["dirC","C"]])}),custom:l.t.Group({vector:l.t.Vec3(P.eB.create(0,0,1))})}),origin:l.t.MappedStatic("structure",{structure:l.t.Group({}),custom:l.t.Group({vector:l.t.Vec3(P.eB.create(0,0,0))})})}
function j(e,t){let n,i
return n="custom"===t.axis.name?t.axis.params.vector:r.Structure.getPrincipalAxes(e).momentsAxes[t.axis.params.principalAxis],i="custom"===t.origin.name?t.origin.params.vector:r.Structure.getPrincipalAxes(e).momentsAxes.origin,{axis:n,origin:i}}const V=(0,P.$I)(),U=(0,P.$I)(),G=(0,P.$I)()
function H(e,t,n,r,i){for(let o=0,a=e.units.length;o<a;o++){const a=e.units[o]
P.eB.negate(L,i),P.$I.fromTranslation(N,L),P.$I.fromRotation(V,Math.PI*n*2,r),P.$I.fromTranslation(U,i),P.$I.mul(G,V,N),P.$I.mul(G,U,G),t.setTransform(G,a)}}var q=n(54749),Q=n(52408),$=n(83842),X=n(9726),W=n(7928),Y=n(10596),Z=n(83794),K=n(71545),J=n(34322)
const ee=P.$I.fromTranslation((0,P.$I)(),P.eB.create(.5,.5,.5)),te=(0,J.b0)((0,J.so)((0,K.UC)()),ee),ne=(0,P.eB)(),re=(0,P.$I)(),ie={...Y.e.Params,cellColor:l.t.Color(u.ColorNames.orange),cellScale:l.t.Numeric(2,{min:.1,max:5,step:.1}),ref:l.t.Select("model",l.t.objectToOptions({origin:"Origin",model:"Model"}),{isEssential:!0}),attachment:l.t.Select("corner",l.t.objectToOptions({corner:"Corner",center:"Center"}),{isEssential:!0})},oe={mesh:(e,t)=>I(se,Y.e.Utils)},ae={...ie}
function se(e,t,n,i){const o=function(e,t,n){const r=Z.P.createState(256,128,n),{fromFractional:i}=e.symmetry.spacegroup.cell
P.eB.copy(ne,e.ref),"center"===t.attachment?(P.eB.trunc(ne,ne),P.eB.subScalar(ne,ne,.5)):P.eB.floor(ne,ne),P.$I.fromTranslation(re,ne)
const o=(0,J.b0)((0,J.so)(te),re),a=Math.cbrt(e.symmetry.spacegroup.cell.volume)/300*t.cellScale
r.currentGroup=1,Z.P.addCage(r,i,o,a,2,20)
const s=D.f8.fromDimensionsAndTransform((0,D.f8)(),P.eB.unit,i)
P.eB.transformMat4(ne,ne,i),D.f8.translate(s,s,ne),D.f8.expand(s,s,a)
const l=Z.P.getMesh(r)
return l.setBoundingSphere(s),l}(t,n,i&&i.geometry),a=r.Symmetry.getUnitcellLabel(t.symmetry)
return h.y.create(a,t,o,()=>n.cellColor,()=>1,()=>a)}function le(e,t,n){const i=(0,P.eB)()
return"model"===n.ref&&P.eB.transformMat4(i,r.Model.getCenter(e),t.spacegroup.cell.toFractional),{symmetry:t,ref:i}}var ce=n(30084),ue=n(88524),de=n(17810),pe=n(7818),he=n(83748),fe=n(48475)
const me={unitLabel:l.t.Text("",{isEssential:!0})},ge={...ce.q.Params,...me,lineSizeAttenuation:l.t.Boolean(!0),linesColor:l.t.Color(u.ColorNames.lightgreen,{isEssential:!0}),linesSize:l.t.Numeric(.075,{min:.01,max:5,step:.01}),dashLength:l.t.Numeric(.2,{min:.01,max:.2,step:.01})},ye={...fe.$,...me},ve={lines:(e,t)=>I(Ce,ce.q.Utils,{modifyState:e=>({...e,markerActions:v.sY.Highlighting})}),text:(e,t)=>I(we,ue.E.Utils,{modifyState:e=>({...e,markerActions:v.xi.None})})},be={...ge,...ye,visuals:l.t.MultiSelect(["lines","text"],l.t.objectToOptions(ve))}
function xe(e,t){const{sphereA:n,sphereB:r,center:i}=t,[o,a]=e.loci
return _.Loci.getBoundingSphere(o,n),_.Loci.getBoundingSphere(a,r),P.eB.add(i,n.center,r.center),P.eB.scale(i,i,.5),t.distance=P.eB.distance(n.center,r.center),t}const Se={sphereA:(0,D.f8)(),sphereB:(0,D.f8)(),center:(0,P.eB)(),distance:0}
function _e(e,t){return 1===e.pairs.length?`Distance ${(0,he.W8)(e.pairs[0],{unitLabel:t,measureOnly:!0})}`:`${e.pairs.length} Distances`}function Ce(e,t,n,r){const i=function(e,t,n){const r=de.d.create(128,64,n)
for(let i=0,o=e.pairs.length;i<o;++i)xe(e.pairs[i],Se),r.addFixedLengthDashes(Se.sphereA.center,Se.sphereB.center,t.dashLength,i)
return r.getLines()}(t,n,r&&r.geometry),o=_e(t,n.unitLabel)
return h.y.create(o,t,i,()=>n.linesColor,()=>n.linesSize,e=>(0,he.W8)(t.pairs[e],n))}function we(e,t,n,r){const i=function(e,t,n){const r=pe.t.create(t,128,64,n)
for(let i=0,o=e.pairs.length;i<o;++i){xe(e.pairs[i],Se)
const{center:n,distance:o,sphereA:a,sphereB:s}=Se,l=t.customText||`${o.toFixed(2)} ${t.unitLabel}`,c=Math.max(2,a.radius,s.radius)/2
r.add(l,n[0],n[1],n[2],1,c,i)}return r.getText()}(t,n,r&&r.geometry),o=_e(t,n.unitLabel)
return h.y.create(o,t,i,()=>n.textColor,()=>n.textSize,e=>(0,he.W8)(t.pairs[e],n))}var Te=n(42127)
const Ae={...fe.$},Ie={text:(e,t)=>I(ke,ue.E.Utils)},Pe={...Ae,scaleByRadius:l.t.Boolean(!0),visuals:l.t.MultiSelect(["text"],l.t.objectToOptions(Ie)),snapshotKey:l.t.Text("",{isEssential:!0,disableInteractiveUpdates:!0,description:"Activate the snapshot with the provided key when clicking on the label"}),tooltip:l.t.Text("",{isEssential:!0,multiline:!0,disableInteractiveUpdates:!0,placeholder:"Tooltip",description:"Tooltip text to be displayed when hovering over the label"})},Be=(0,D.f8)()
function Ee(e,t=!1){return e.label||(0,he.YQ)(e.loci,{hidePrefix:!0,htmlStyling:!1,condensed:t})}function ke(e,t,n,r){var i,o
const a=function(e,t,n){const r=pe.t.create(t,128,64,n),i=t.customText.trim()
for(let o=0,a=e.infos.length;o<a;++o){const n=e.infos[o],a=_.Loci.getBoundingSphere(n.loci,Be)
if(!a)continue
const{center:s,radius:l}=a,c=i||Ee(n,!0)
r.add(c,s[0],s[1],s[2],t.scaleByRadius?l/.9:0,t.scaleByRadius?Math.max(1,l):1,o)}return r.getText()}(t,n,r&&r.geometry),s=function(e){return 1===e.infos.length?Ee(e.infos[0]):`${e.infos.length} Labels`}(t),l=null!==(o=null===(i=n.tooltip)||void 0===i?void 0:i.trim())&&void 0!==o?o:"",c=n.customText.trim()
let u
return u=l?e=>l:c?e=>c:e=>Ee(t.infos[e]),h.y.create(s,t,a,()=>n.textColor,()=>n.textSize,u)}const De=(0,P.eB)(),Me=P.$I.identity(),Re=new Float32Array(18),Oe=new Uint8Array([0,1,2,3,4,5])
n(96005),n(10268),P.eB.zero(),P.eB.zero()
const Le=(0,P.eB)(),Ne=(0,P.eB)(),Fe=(0,P.eB)(),ze=(0,P.eB)(),je=P.$I.identity(),Ve=new Float32Array(24),Ue=new Uint8Array([0,1,0,3,0,6,1,2,1,7,2,3,2,4,3,5,4,5,4,7,5,6,6,7])
var Ge=n(39376)
const He={color:l.t.Color(u.ColorNames.orange),scaleFactor:l.t.Numeric(1,{min:.1,max:10,step:.1}),radiusScale:l.t.Numeric(2,{min:.1,max:10,step:.1})},qe={...Y.e.Params,...He},Qe={...Y.e.Params,...He},$e={...Y.e.Params,...He},Xe={axes:(e,t)=>I(Ye,Y.e.Utils),box:(e,t)=>I(Ze,Y.e.Utils),ellipsoid:(e,t)=>I(Ke,Y.e.Utils)},We={...qe,...Qe,...$e,visuals:l.t.MultiSelect(["box"],l.t.objectToOptions(Xe))}
function Ye(e,t,n,i){const o=function(e,t,n){const i=Z.P.createState(256,128,n),o=r.StructureElement.Loci.getPrincipalAxesMany(e.locis)
return D.n.scale(o.momentsAxes,o.momentsAxes,t.scaleFactor),i.currentGroup=0,function(e,t,n){const{origin:r,dirA:i,dirB:o,dirC:a}=t
P.eB.add(De,r,i),P.eB.toArray(P.eB.add(De,r,i),Re,0),P.eB.toArray(P.eB.sub(De,r,i),Re,3),P.eB.toArray(P.eB.add(De,r,o),Re,6),P.eB.toArray(P.eB.sub(De,r,o),Re,9),P.eB.toArray(P.eB.add(De,r,a),Re,12),P.eB.toArray(P.eB.sub(De,r,a),Re,15)
const s=(0,J.L3)(Re,Oe),l=D.n.volume(t),c=Math.cbrt(l)/300*n
Z.P.addCage(e,Me,s,c,2,20)}(i,o.momentsAxes,t.radiusScale),Z.P.getMesh(i)}(t,n,i&&i.geometry),a=(s=t.locis,`Principal Axes of ${(0,he.k7)(s,{countsOnly:!0})}`)
var s
return h.y.create(a,t,o,()=>n.color,()=>1,()=>a)}function Ze(e,t,n,i){const o=function(e,t,n){const i=Z.P.createState(256,128,n),o=r.StructureElement.Loci.getPrincipalAxesMany(e.locis)
return D.n.scale(o.boxAxes,o.boxAxes,t.scaleFactor),i.currentGroup=0,function(e,t,n){const{origin:r,dirA:i,dirB:o,dirC:a}=t,s=P.eB.negate(Ne,i),l=P.eB.negate(Fe,o),c=P.eB.negate(ze,a)
let u=0
const d=function(e,t,n){P.eB.copy(Le,r),P.eB.add(Le,Le,e),P.eB.add(Le,Le,t),P.eB.add(Le,Le,n),P.eB.toArray(Le,Ve,u),u+=3}
d(i,o,a),d(i,o,c),d(i,l,c),d(i,l,a),d(s,l,c),d(s,l,a),d(s,o,a),d(s,o,c)
const p=(0,J.L3)(Ve,Ue),h=D.n.volume(t),f=Math.cbrt(h)/300*n
Z.P.addCage(e,je,p,f,2,20)}(i,o.boxAxes,t.radiusScale),Z.P.getMesh(i)}(t,n,i&&i.geometry),a=(s=t.locis,`Oriented Box of ${(0,he.k7)(s,{countsOnly:!0})}`)
var s
return h.y.create(a,t,o,()=>n.color,()=>1,()=>a)}function Ke(e,t,n,i){const o=function(e,t,n){const i=Z.P.createState(256,128,n),o=r.StructureElement.Loci.getPrincipalAxesMany(e.locis).boxAxes,{origin:a,dirA:s,dirB:l}=o,c=D.n.size((0,P.eB)(),o)
P.eB.scale(c,c,.5*t.scaleFactor)
const u=P.eB.create(c[2],c[1],c[0])
return i.currentGroup=0,(0,Ge.P)(i,a,s,l,u,2),Z.P.getMesh(i)}(t,n,i&&i.geometry),a=(s=t.locis,`Oriented Ellipsoid of ${(0,he.k7)(s,{countsOnly:!0})}`)
var s
return h.y.create(a,t,o,()=>n.color,()=>1,()=>a)}var Je=n(87423)
const et={radius:1,segments:36,thetaStart:0,thetaLength:2*Math.PI}
function tt(e){const{radius:t,segments:n,thetaStart:r,thetaLength:i}={...et,...e},o=i===2*Math.PI,a=o?n+1:n+2,s=new Float32Array(3*a),l=new Float32Array(3*a),c=new Uint32Array(3*n)
s[0]=0,s[1]=0,s[2]=0,l[0]=0,l[1]=1,l[2]=0
for(let u=0,d=3;u<n;++u,d+=3){const e=r+u/n*i
s[d]=t*Math.sin(e),s[d+1]=0,s[d+2]=t*Math.cos(e),l[d]=0,l[d+1]=1,l[d+2]=0}for(let u=1,d=0;u<n;++u,d+=3)c[d]=u,c[d+1]=u+1,c[d+2]=0
if(o){const e=3*(n-1)
c[e]=n,c[e+1]=1,c[e+2]=0}else{const e=r+i,o=3*(n+1)
s[o]=t*Math.sin(e),s[o+1]=0,s[o+2]=t*Math.cos(e),l[o]=0,l[o+1]=1,l[o+2]=0
const a=3*(n-1)
c[a]=n,c[a+1]=n+1,c[a+2]=0}return{vertices:s,normals:l,indices:c}}var nt=n(40165)
const rt={color:l.t.Color(u.ColorNames.lightgreen),arcScale:l.t.Numeric(.7,{min:.01,max:1,step:.01})},it={...ce.q.Params,...rt,lineSizeAttenuation:l.t.Boolean(!0),linesSize:l.t.Numeric(.04,{min:.01,max:5,step:.01}),dashLength:l.t.Numeric(.04,{min:.01,max:.2,step:.01})},ot={...it},at={...it},st={...Y.e.Params,...rt,ignoreLight:l.t.Boolean(!0),sectorOpacity:l.t.Numeric(.75,{min:0,max:1,step:.01})},lt={vectors:(e,t)=>I(gt,ce.q.Utils,{modifyState:e=>({...e,pickable:!1})}),arc:(e,t)=>I(yt,ce.q.Utils,{modifyState:e=>({...e,pickable:!1})}),sector:(e,t)=>I(vt,Y.e.Utils,{modifyProps:e=>({...e,alpha:e.sectorOpacity}),modifyState:e=>({...e,markerActions:v.sY.Highlighting})}),text:(e,t)=>I(bt,ue.E.Utils,{modifyState:e=>({...e,markerActions:v.xi.None})})},ct={...ot,...at,...st,...fe.$,visuals:l.t.MultiSelect(["vectors","sector","text"],l.t.objectToOptions(lt))},ut=(0,P.eB)(),dt=(0,P.$I)()
function pt(e,t,n){const{sphereA:r,sphereB:i,sphereC:o}=t,{arcDirA:a,arcDirC:s,arcNormal:l}=t,[c,u,d]=e.loci
_.Loci.getBoundingSphere(c,r),_.Loci.getBoundingSphere(u,i),_.Loci.getBoundingSphere(d,o),P.eB.sub(a,r.center,i.center),P.eB.sub(s,o.center,i.center),P.eB.cross(l,a,s)
const p=Math.min(P.eB.magnitude(a),P.eB.magnitude(s))*n
return t.radius=p,t.angle=P.eB.angle(a,s),t}function ht(e,t){const{radius:n,angle:r}=e,i=t?(0,Je.N7)(r,n)/t:32
P.$I.targetTo(dt,e.sphereB.center,e.sphereA.center,e.arcNormal),P.$I.setTranslation(dt,e.sphereB.center),P.$I.mul(dt,dt,P.$I.rotY180)
const o=tt({radius:n,thetaLength:r,segments:i})
return(0,nt._2)(o,dt)}const ft={sphereA:(0,D.f8)(),sphereB:(0,D.f8)(),sphereC:(0,D.f8)(),arcDirA:(0,P.eB)(),arcDirC:(0,P.eB)(),arcNormal:(0,P.eB)(),radius:0,angle:0}
function mt(e){return 1===e.triples.length?`Angle ${(0,he.k0)(e.triples[0],{measureOnly:!0})}`:`${e.triples.length} Angles`}function gt(e,t,n,r){const i=function(e,t,n){const r=de.d.create(128,64,n)
for(let i=0,o=e.triples.length;i<o;++i)pt(e.triples[i],ft,t.arcScale),r.addFixedLengthDashes(ft.sphereB.center,ft.sphereA.center,t.dashLength,i),r.addFixedLengthDashes(ft.sphereB.center,ft.sphereC.center,t.dashLength,i)
return r.getLines()}(t,n,r&&r.geometry),o=mt(t)
return h.y.create(o,t,i,()=>n.color,()=>n.linesSize,()=>"")}function yt(e,t,n,r){const i=function(e,t,n){const r=de.d.create(128,64,n)
for(let i=0,o=e.triples.length;i<o;++i){pt(e.triples[i],ft,t.arcScale)
const n=ht(ft,t.dashLength),{indices:o,vertices:a}=n
for(let e=0,t=o.length;e<t;e+=3){if(e%2==1)continue
const t=3*o[e],n=3*o[e+1],s=a[t],l=a[t+1],c=a[t+2],u=a[n],d=a[n+1],p=a[n+2]
r.add(s,l,c,u,d,p,i)}}return r.getLines()}(t,n,r&&r.geometry),o=mt(t)
return h.y.create(o,t,i,()=>n.color,()=>n.linesSize,()=>"")}function vt(e,t,n,r){const i=function(e,t,n){const r=Z.P.createState(128,64,n)
for(let i=0,o=e.triples.length;i<o;++i){pt(e.triples[i],ft,t.arcScale)
const n=ht(ft)
r.currentGroup=i,Z.P.addPrimitive(r,P.$I.id,n),Z.P.addPrimitiveFlipped(r,P.$I.id,n)}return Z.P.getMesh(r)}(t,n,r&&r.geometry),o=mt(t)
return h.y.create(o,t,i,()=>n.color,()=>1,e=>(0,he.k0)(t.triples[e]))}function bt(e,t,n,r){const i=function(e,t,n){const r=pe.t.create(t,128,64,n)
for(let i=0,o=e.triples.length;i<o;++i){pt(e.triples[i],ft,t.arcScale),P.eB.add(ut,ft.arcDirA,ft.arcDirC),P.eB.setMagnitude(ut,ut,ft.radius),P.eB.add(ut,ft.sphereB.center,ut)
const n=(0,Je.H)(ft.angle).toFixed(2),o=t.customText||`${n}`,a=Math.max(2,ft.sphereA.radius,ft.sphereB.radius,ft.sphereC.radius)/2
r.add(o,ut[0],ut[1],ut[2],.1,a,i)}return r.getText()}(t,n,r&&r.geometry),o=mt(t)
return h.y.create(o,t,i,()=>n.textColor,()=>n.textSize,e=>(0,he.k0)(t.triples[e]))}const xt={color:l.t.Color(u.ColorNames.lightgreen),arcScale:l.t.Numeric(.7,{min:.01,max:1,step:.01})},St={...ce.q.Params,...xt,lineSizeAttenuation:l.t.Boolean(!0),linesSize:l.t.Numeric(.04,{min:.01,max:5,step:.01}),dashLength:l.t.Numeric(.04,{min:.01,max:.2,step:.01})},_t={...St},Ct={...St},wt={...St},Tt={...St},At={...Y.e.Params,...xt,ignoreLight:l.t.Boolean(!0),sectorOpacity:l.t.Numeric(.75,{min:0,max:1,step:.01})},It={vectors:(e,t)=>I(Ot,ce.q.Utils,{modifyState:e=>({...e,pickable:!1})}),extenders:(e,t)=>I(Ft,ce.q.Utils,{modifyState:e=>({...e,pickable:!1})}),connector:(e,t)=>I(Lt,ce.q.Utils,{modifyState:e=>({...e,pickable:!1})}),arms:(e,t)=>I(Nt,ce.q.Utils,{modifyState:e=>({...e,pickable:!1})}),arc:(e,t)=>I(zt,ce.q.Utils,{modifyState:e=>({...e,pickable:!1})}),sector:(e,t)=>I(jt,Y.e.Utils,{modifyProps:e=>({...e,alpha:e.sectorOpacity}),modifyState:e=>({...e,markerActions:v.sY.Highlighting})}),text:(e,t)=>I(Vt,ue.E.Utils,{modifyState:e=>({...e,markerActions:v.xi.None})})},Pt={..._t,...Ct,...wt,...Tt,...At,...fe.$,visuals:l.t.MultiSelect(["extenders","arms","sector","text"],l.t.objectToOptions(It))},Bt=(0,P.eB)(),Et=(0,P.$I)()
function kt(e,t,n){const{sphereA:r,sphereB:i,sphereC:o,sphereD:a,dirBA:s,dirCD:l,projA:c,projD:u}=t,{arcPointA:d,arcPointD:p,arcDirA:h,arcDirD:f,arcCenter:m,arcNormal:g}=t,[y,v,b,x]=e.loci
_.Loci.getBoundingSphere(y,r),_.Loci.getBoundingSphere(v,i),_.Loci.getBoundingSphere(b,o),_.Loci.getBoundingSphere(x,a),P.eB.add(m,i.center,o.center),P.eB.scale(m,m,.5),P.eB.sub(s,r.center,i.center),P.eB.sub(l,a.center,o.center),P.eB.add(d,m,s),P.eB.add(p,m,l),P.eB.sub(g,o.center,i.center),P.eB.orthogonalize(h,g,s),P.eB.orthogonalize(f,g,l),P.eB.projectPointOnVector(c,d,h,m),P.eB.projectPointOnVector(u,p,f,m)
const S=Math.min(P.eB.distance(c,m),P.eB.distance(u,m))*n
P.eB.setMagnitude(h,h,S),P.eB.setMagnitude(f,f,S),P.eB.add(d,m,h),P.eB.add(p,m,f),t.radius=S,t.angle=P.eB.dihedralAngle(r.center,i.center,o.center,a.center),P.eB.matchDirection(Bt,g,P.eB.sub(Bt,d,r.center))
const C=P.eB.angle(s,Bt),w=S/Math.cos(C-Je.fC)
P.eB.add(c,i.center,P.eB.setMagnitude(Bt,s,w)),P.eB.matchDirection(Bt,g,P.eB.sub(Bt,p,a.center))
const T=P.eB.angle(l,Bt),A=S/Math.cos(T-Je.fC)
return P.eB.add(u,o.center,P.eB.setMagnitude(Bt,l,A)),t}function Dt(e,t){const{radius:n,angle:r}=e,i=t?(0,Je.N7)(r,n)/t:32
P.$I.targetTo(Et,e.arcCenter,r<0?e.arcPointD:e.arcPointA,e.arcNormal),P.$I.setTranslation(Et,e.arcCenter),P.$I.mul(Et,Et,P.$I.rotY180)
const o=tt({radius:n,thetaLength:Math.abs(r),segments:i})
return(0,nt._2)(o,Et)}const Mt={sphereA:(0,D.f8)(),sphereB:(0,D.f8)(),sphereC:(0,D.f8)(),sphereD:(0,D.f8)(),dirBA:(0,P.eB)(),dirCD:(0,P.eB)(),projA:(0,P.eB)(),projD:(0,P.eB)(),arcPointA:(0,P.eB)(),arcPointD:(0,P.eB)(),arcDirA:(0,P.eB)(),arcDirD:(0,P.eB)(),arcCenter:(0,P.eB)(),arcNormal:(0,P.eB)(),radius:0,angle:0}
function Rt(e){return 1===e.quads.length?`Dihedral ${(0,he.kd)(e.quads[0],{measureOnly:!0})}`:`${e.quads.length} Dihedrals`}function Ot(e,t,n,r){const i=function(e,t,n){const r=de.d.create(128,64,n)
for(let i=0,o=e.quads.length;i<o;++i)kt(e.quads[i],Mt,t.arcScale),r.addFixedLengthDashes(Mt.arcCenter,Mt.arcPointA,t.dashLength,i),r.addFixedLengthDashes(Mt.arcCenter,Mt.arcPointD,t.dashLength,i)
return r.getLines()}(t,n,r&&r.geometry),o=Rt(t)
return h.y.create(o,t,i,()=>n.color,()=>n.linesSize,()=>"")}function Lt(e,t,n,r){const i=function(e,t,n){const r=de.d.create(128,64,n)
for(let i=0,o=e.quads.length;i<o;++i)kt(e.quads[i],Mt,t.arcScale),r.addFixedLengthDashes(Mt.sphereB.center,Mt.sphereC.center,t.dashLength,i)
return r.getLines()}(t,n,r&&r.geometry),o=Rt(t)
return h.y.create(o,t,i,()=>n.color,()=>n.linesSize,()=>"")}function Nt(e,t,n,r){const i=function(e,t,n){const r=de.d.create(128,64,n)
for(let i=0,o=e.quads.length;i<o;++i)kt(e.quads[i],Mt,t.arcScale),r.addFixedLengthDashes(Mt.sphereB.center,Mt.sphereA.center,t.dashLength,i),r.addFixedLengthDashes(Mt.sphereC.center,Mt.sphereD.center,t.dashLength,i)
return r.getLines()}(t,n,r&&r.geometry),o=Rt(t)
return h.y.create(o,t,i,()=>n.color,()=>n.linesSize,()=>"")}function Ft(e,t,n,r){const i=function(e,t,n){const r=de.d.create(128,64,n)
for(let i=0,o=e.quads.length;i<o;++i)kt(e.quads[i],Mt,t.arcScale),r.addFixedLengthDashes(Mt.arcPointA,Mt.projA,t.dashLength,i),r.addFixedLengthDashes(Mt.arcPointD,Mt.projD,t.dashLength,i)
return r.getLines()}(t,n,r&&r.geometry),o=Rt(t)
return h.y.create(o,t,i,()=>n.color,()=>n.linesSize,()=>"")}function zt(e,t,n,r){const i=function(e,t,n){const r=de.d.create(128,64,n)
for(let i=0,o=e.quads.length;i<o;++i){kt(e.quads[i],Mt,t.arcScale)
const n=Dt(Mt,t.dashLength),{indices:o,vertices:a}=n
for(let e=0,t=o.length;e<t;e+=3){if(e%2==1)continue
const t=3*o[e],n=3*o[e+1],s=a[t],l=a[t+1],c=a[t+2],u=a[n],d=a[n+1],p=a[n+2]
r.add(s,l,c,u,d,p,i)}}return r.getLines()}(t,n,r&&r.geometry),o=Rt(t)
return h.y.create(o,t,i,()=>n.color,()=>n.linesSize,()=>"")}function jt(e,t,n,r){const i=function(e,t,n){const r=Z.P.createState(128,64,n)
for(let i=0,o=e.quads.length;i<o;++i){kt(e.quads[i],Mt,t.arcScale)
const n=Dt(Mt)
r.currentGroup=i,Z.P.addPrimitive(r,P.$I.id,n),Z.P.addPrimitiveFlipped(r,P.$I.id,n)}return Z.P.getMesh(r)}(t,n,r&&r.geometry),o=Rt(t)
return h.y.create(o,t,i,()=>n.color,()=>1,e=>(0,he.kd)(t.quads[e]))}function Vt(e,t,n,r){const i=function(e,t,n){const r=pe.t.create(t,128,64,n)
for(let i=0,o=e.quads.length;i<o;++i){kt(e.quads[i],Mt,t.arcScale),P.eB.add(Bt,Mt.arcDirA,Mt.arcDirD),P.eB.setMagnitude(Bt,Bt,Mt.radius),P.eB.add(Bt,Mt.arcCenter,Bt)
let n=(0,Je.H)(Mt.angle).toFixed(2)
"-0.00"===n&&(n="0.00")
const o=t.customText||`${n}`,a=Math.max(2,Mt.sphereA.radius,Mt.sphereB.radius,Mt.sphereC.radius,Mt.sphereD.radius)/2
r.add(o,Bt[0],Bt[1],Bt[2],.1,a,i)}return r.getText()}(t,n,r&&r.geometry),o=Rt(t)
return h.y.create(o,t,i,()=>n.textColor,()=>n.textSize,e=>(0,he.kd)(t.quads[e]))}var Ut=n(10212),Gt=n(91030),Ht=n(91229),qt=n(48559)
const Qt={vertices:new Float32Array([-.5,.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0]),normals:new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1]),indices:new Uint32Array([0,2,1,1,2,3])}
new Uint32Array([0,1,2,3,3,1,2,0])
const $t={...Y.e.Params,color:l.t.Color(u.ColorNames.orange),scaleFactor:l.t.Numeric(1,{min:.1,max:10,step:.1})},Xt={plane:(e,t)=>I(Kt,Y.e.Utils)},Wt={...$t,visuals:l.t.MultiSelect(["plane"],l.t.objectToOptions(Xt))},Yt=(0,P.$I)(),Zt=(0,P.eB)()
function Kt(e,t,n,i){const o=function(e,t,n){const i=Z.P.createState(256,128,n),o=r.StructureElement.Loci.getPrincipalAxesMany(e.locis).boxAxes,a=Qt
return P.eB.add(Zt,o.origin,o.dirC),P.$I.targetTo(Yt,Zt,o.origin,o.dirB),P.$I.scale(Yt,Yt,D.n.size(Zt,o)),P.$I.scaleUniformly(Yt,Yt,t.scaleFactor),P.$I.setTranslation(Yt,o.origin),i.currentGroup=0,Z.P.addPrimitive(i,Yt,a),Z.P.addPrimitiveFlipped(i,Yt,a),Z.P.getMesh(i)}(t,n,i&&i.geometry),a=(s=t.locis,`Best Fit Plane of ${(0,he.k7)(s,{countsOnly:!0})}`)
var s
return h.y.create(a,t,o,()=>n.color,()=>1,()=>a)}var Jt=n(45692),en=n(13564),tn=n(97564),nn=n(17515)
const rn=c.H.BuiltIn({name:"structure-representation-3d",display:"3D Representation",from:c.O.Molecule.Structure,to:c.O.Molecule.Structure.Representation3D,params:(e,t)=>{const{registry:n,themes:i}=t.representation.structure,o=n.get(n.default.name)
if(!e){const e={help:e=>{const{name:t,params:n}=e,r=i.colorThemeRegistry.get(t).factory({},n)
return{description:r.description,legend:r.legend}}}
return{type:l.t.Mapped(n.default.name,n.types,e=>l.t.Group(n.get(e).getParams(i,r.Structure.Empty))),colorTheme:l.t.Mapped(o.defaultColorTheme.name,i.colorThemeRegistry.types,e=>l.t.Group(i.colorThemeRegistry.get(e).getParams({structure:r.Structure.Empty})),e),sizeTheme:l.t.Mapped(o.defaultSizeTheme.name,i.sizeThemeRegistry.types,e=>l.t.Group(i.sizeThemeRegistry.get(e).getParams({structure:r.Structure.Empty})))}}const a={structure:e.data},s={help:e=>{const{name:t,params:n}=e,r=i.colorThemeRegistry.get(t).factory(a,n)
return{description:r.description,legend:r.legend}}}
return{type:l.t.Mapped(n.default.name,n.getApplicableTypes(e.data),t=>l.t.Group(n.get(t).getParams(i,e.data))),colorTheme:l.t.Mapped(o.defaultColorTheme.name,i.colorThemeRegistry.getApplicableTypes(a),e=>l.t.Group(i.colorThemeRegistry.get(e).getParams(a)),s),sizeTheme:l.t.Mapped(o.defaultSizeTheme.name,i.sizeThemeRegistry.getApplicableTypes(a),e=>l.t.Group(i.sizeThemeRegistry.get(e).getParams(a)))}}})({canAutoUpdate:({a:e,oldParams:t,newParams:n})=>e.data.elementCount<1e4||t.type.name===n.type.name&&"custom"!==n.type.params.quality,apply:({a:e,params:t,cache:n},r)=>a.Task.create("Structure Representation",async n=>{var i,o
const a={runtime:n,assetManager:r.managers.asset,errorContext:r.errorContext},l=r.representation.structure.registry.get(t.type.name),u=(null===(i=l.getData)||void 0===i?void 0:i.call(l,e.data,t.type.params))||e.data
l.ensureCustomProperties&&await l.ensureCustomProperties.attach(a,u)
const d=l.factory({webgl:null===(o=r.canvas3d)||void 0===o?void 0:o.webgl,...r.representation.structure.themes},l.getParams)
await s.S.ensureDependencies(a,r.representation.structure.themes,{structure:u},t),d.setTheme(s.S.create(r.representation.structure.themes,{structure:u},t))
const p=t.type.params||{}
return await d.createOrUpdate(p,u).runInContext(n),new c.O.Molecule.Structure.Representation3D({repr:d,sourceData:e.data},{label:l.label})}),update:({a:e,b:t,oldParams:n,newParams:r,cache:i},l)=>a.Task.create("Structure Representation",async i=>{var a,c
if(r.type.name!==n.type.name)return o.xE.UpdateResult.Recreate
const u=l.representation.structure.registry.get(r.type.name)
if(null===(a=u.mustRecreate)||void 0===a?void 0:a.call(u,n.type.params,r.type.params))return o.xE.UpdateResult.Recreate
const d=(null===(c=u.getData)||void 0===c?void 0:c.call(u,e.data,r.type.params))||e.data,p={runtime:i,assetManager:l.managers.asset,errorContext:l.errorContext}
u.ensureCustomProperties&&await u.ensureCustomProperties.attach(p,d),s.S.releaseDependencies(l.representation.structure.themes,{structure:t.data.sourceData},n),await s.S.ensureDependencies(p,l.representation.structure.themes,{structure:d},r),t.data.repr.setTheme(s.S.create(l.representation.structure.themes,{structure:d},r))
const h={...t.data.repr.props,...r.type.params}
return await t.data.repr.createOrUpdate(h,d).runInContext(i),t.data.sourceData=e.data,o.xE.UpdateResult.Updated}),dispose({b:e,params:t},n){if(!e||!t)return
const r=e.data.sourceData,i=n.representation.structure.registry.get(t.type.name)
i.ensureCustomProperties&&i.ensureCustomProperties.detach(r),s.S.releaseDependencies(n.representation.structure.themes,{structure:r},t)},interpolate(e,t,n){if("uniform"!==e.colorTheme.name||"uniform"!==t.colorTheme.name)return n<=.5?e:t
const r=e.colorTheme.params.value,i=t.colorTheme.params.value,o=q.Color.interpolate(r,i,n)
return{type:n<=.5?e.type:t.type,colorTheme:{name:"uniform",params:{value:o}},sizeTheme:n<=.5?e.sizeTheme:t.sizeTheme}}}),on=c.H.BuiltIn({name:"unwind-structure-assembly-representation-3d",display:"Unwind Assembly 3D Representation",from:c.O.Molecule.Structure.Representation3D,to:c.O.Molecule.Structure.Representation3DState,params:{t:l.t.Numeric(0,{min:0,max:1,step:.01})}})({canAutoUpdate:()=>!0,apply({a:e,params:t}){const n=e.data.sourceData,r=new k(n)
return R(n,r,t.t),new c.O.Molecule.Structure.Representation3DState({state:{unitTransforms:r},initialState:{unitTransforms:new k(n)},info:n,repr:e.data.repr},{label:`Unwind T = ${t.t.toFixed(2)}`})},update({a:e,b:t,newParams:n,oldParams:r}){const i=t.data.info
return e.data.sourceData!==i||e.data.repr!==t.data.repr?o.xE.UpdateResult.Recreate:r.t===n.t?o.xE.UpdateResult.Unchanged:(R(i,t.data.state.unitTransforms,n.t),t.label=`Unwind T = ${n.t.toFixed(2)}`,t.data.repr=e.data.repr,o.xE.UpdateResult.Updated)}}),an=c.H.BuiltIn({name:"explode-structure-representation-3d",display:"Explode 3D Representation",from:c.O.Molecule.Structure.Representation3D,to:c.O.Molecule.Structure.Representation3DState,params:{t:l.t.Numeric(0,{min:0,max:1,step:.01})}})({canAutoUpdate:()=>!0,apply({a:e,params:t}){const n=e.data.sourceData,r=new k(n)
return F(n,r,t.t,n.root.boundary.sphere),new c.O.Molecule.Structure.Representation3DState({state:{unitTransforms:r},initialState:{unitTransforms:new k(n)},info:n,repr:e.data.repr},{label:`Explode T = ${t.t.toFixed(2)}`})},update({a:e,b:t,newParams:n,oldParams:r}){const i=e.data.sourceData
return t.data.info!==i||e.data.repr!==t.data.repr?o.xE.UpdateResult.Recreate:r.t===n.t?o.xE.UpdateResult.Unchanged:(F(i,t.data.state.unitTransforms,n.t,i.root.boundary.sphere),t.label=`Explode T = ${n.t.toFixed(2)}`,t.data.repr=e.data.repr,o.xE.UpdateResult.Updated)}}),sn=c.H.BuiltIn({name:"spin-structure-representation-3d",display:"Spin 3D Representation",from:c.O.Molecule.Structure.Representation3D,to:c.O.Molecule.Structure.Representation3DState,params:{t:l.t.Numeric(0,{min:0,max:1,step:.01}),...z}})({canAutoUpdate:()=>!0,apply({a:e,params:t}){const n=e.data.sourceData,r=new k(n),{axis:i,origin:o}=j(n.root,t)
return H(n,r,t.t,i,o),new c.O.Molecule.Structure.Representation3DState({state:{unitTransforms:r},initialState:{unitTransforms:new k(n)},info:n,repr:e.data.repr},{label:`Spin T = ${t.t.toFixed(2)}`})},update({a:e,b:t,newParams:n,oldParams:r}){const i=e.data.sourceData
if(t.data.info!==i)return o.xE.UpdateResult.Recreate
if(e.data.repr!==t.data.repr)return o.xE.UpdateResult.Recreate
if(r.t===n.t&&r.axis===n.axis&&r.origin===n.origin)return o.xE.UpdateResult.Unchanged
const a=t.data.state.unitTransforms,{axis:s,origin:l}=j(i.root,n)
return H(i,a,n.t,s,l),t.label=`Spin T = ${n.t.toFixed(2)}`,t.data.repr=e.data.repr,o.xE.UpdateResult.Updated}}),ln=c.H.BuiltIn({name:"overpaint-structure-representation-3d-from-script",display:"Overpaint 3D Representation",from:c.O.Molecule.Structure.Representation3D,to:c.O.Molecule.Structure.Representation3DState,params:()=>({layers:l.t.ObjectList({script:l.t.Script((0,W.Script)("(sel.atom.all)","mol-script")),color:l.t.Color(u.ColorNames.blueviolet),clear:l.t.Boolean(!1)},e=>`${e.clear?"Clear":q.Color.toRgbString(e.color)}`,{defaultValue:[{script:(0,W.Script)("(sel.atom.all)","mol-script"),color:u.ColorNames.blueviolet,clear:!1}]})})})({canAutoUpdate:()=>!0,apply({a:e,params:t}){const n=e.data.sourceData,r=e.data.repr.geometryVersion,i=Q.l.ofScript(t.layers,n)
return new c.O.Molecule.Structure.Representation3DState({state:{overpaint:i},initialState:{overpaint:Q.l.Empty},info:{structure:n,geometryVersion:r},repr:e.data.repr},{label:`Overpaint (${i.layers.length} Layers)`})},update({a:e,b:t,newParams:n,oldParams:r}){const i=t.data.info,a=e.data.sourceData
if(a!==i.structure)return o.xE.UpdateResult.Recreate
if(e.data.repr!==t.data.repr)return o.xE.UpdateResult.Recreate
const s=e.data.repr.geometryVersion
if(s!==i.geometryVersion&&(0,X.jH)(e.data.repr.props))return o.xE.UpdateResult.Recreate
const l=t.data.state.overpaint,c=Q.l.ofScript(n.layers,a)
return Q.l.areEqual(l,c)?o.xE.UpdateResult.Unchanged:(i.geometryVersion=s,t.data.state.overpaint=c,t.data.repr=e.data.repr,t.label=`Overpaint (${c.layers.length} Layers)`,o.xE.UpdateResult.Updated)}}),cn=c.H.BuiltIn({name:"overpaint-structure-representation-3d-from-bundle",display:"Overpaint 3D Representation",from:c.O.Molecule.Structure.Representation3D,to:c.O.Molecule.Structure.Representation3DState,params:()=>({layers:l.t.ObjectList({bundle:l.t.Value(r.StructureElement.Bundle.Empty),color:l.t.Color(u.ColorNames.blueviolet),clear:l.t.Boolean(!1)},e=>`${e.clear?"Clear":q.Color.toRgbString(e.color)}`,{defaultValue:[{bundle:r.StructureElement.Bundle.Empty,color:u.ColorNames.blueviolet,clear:!1}],isHidden:!0})})})({canAutoUpdate:()=>!0,apply({a:e,params:t}){const n=e.data.sourceData,r=e.data.repr.geometryVersion,i=Q.l.ofBundle(t.layers,n)
return new c.O.Molecule.Structure.Representation3DState({state:{overpaint:i},initialState:{overpaint:Q.l.Empty},info:{structure:n,geometryVersion:r},repr:e.data.repr},{label:`Overpaint (${i.layers.length} Layers)`})},update({a:e,b:t,newParams:n,oldParams:r}){const i=t.data.info,a=e.data.sourceData
if(a!==i.structure)return o.xE.UpdateResult.Recreate
if(e.data.repr!==t.data.repr)return o.xE.UpdateResult.Recreate
const s=e.data.repr.geometryVersion
if(s!==i.geometryVersion&&(0,X.jH)(e.data.repr.props))return o.xE.UpdateResult.Recreate
const l=t.data.state.overpaint,c=Q.l.ofBundle(n.layers,a)
return Q.l.areEqual(l,c)?o.xE.UpdateResult.Unchanged:(i.geometryVersion=s,t.data.state.overpaint=c,t.data.repr=e.data.repr,t.label=`Overpaint (${c.layers.length} Layers)`,o.xE.UpdateResult.Updated)}}),un=c.H.BuiltIn({name:"transparency-structure-representation-3d-from-script",display:"Transparency 3D Representation",from:c.O.Molecule.Structure.Representation3D,to:c.O.Molecule.Structure.Representation3DState,params:()=>({layers:l.t.ObjectList({script:l.t.Script((0,W.Script)("(sel.atom.all)","mol-script")),value:l.t.Numeric(.5,{min:0,max:1,step:.01},{label:"Transparency"})},e=>`Transparency (${e.value})`,{defaultValue:[{script:(0,W.Script)("(sel.atom.all)","mol-script"),value:.5}]})})})({canAutoUpdate:()=>!0,apply({a:e,params:t}){const n=e.data.sourceData,r=e.data.repr.geometryVersion,i=$.x.ofScript(t.layers,n)
return new c.O.Molecule.Structure.Representation3DState({state:{transparency:i},initialState:{transparency:$.x.Empty},info:{structure:n,geometryVersion:r},repr:e.data.repr},{label:`Transparency (${i.layers.length} Layers)`})},update({a:e,b:t,newParams:n,oldParams:r}){const i=t.data.info,a=e.data.sourceData
if(a!==i.structure)return o.xE.UpdateResult.Recreate
if(e.data.repr!==t.data.repr)return o.xE.UpdateResult.Recreate
const s=e.data.repr.geometryVersion
if(s!==i.geometryVersion&&(0,X.jH)(e.data.repr.props))return o.xE.UpdateResult.Recreate
const l=t.data.state.transparency,c=$.x.ofScript(n.layers,a)
return $.x.areEqual(l,c)?o.xE.UpdateResult.Unchanged:(i.geometryVersion=s,t.data.state.transparency=c,t.data.repr=e.data.repr,t.label=`Transparency (${c.layers.length} Layers)`,o.xE.UpdateResult.Updated)}}),dn=c.H.BuiltIn({name:"transparency-structure-representation-3d-from-bundle",display:"Transparency 3D Representation",from:c.O.Molecule.Structure.Representation3D,to:c.O.Molecule.Structure.Representation3DState,params:()=>({layers:l.t.ObjectList({bundle:l.t.Value(r.StructureElement.Bundle.Empty),value:l.t.Numeric(.5,{min:0,max:1,step:.01},{label:"Transparency"})},e=>`Transparency (${e.value})`,{defaultValue:[{bundle:r.StructureElement.Bundle.Empty,value:.5}],isHidden:!0})})})({canAutoUpdate:()=>!0,apply({a:e,params:t}){const n=e.data.sourceData,r=e.data.repr.geometryVersion,i=$.x.ofBundle(t.layers,n)
return new c.O.Molecule.Structure.Representation3DState({state:{transparency:i},initialState:{transparency:$.x.Empty},info:{structure:n,geometryVersion:r},repr:e.data.repr},{label:`Transparency (${i.layers.length} Layers)`})},update({a:e,b:t,newParams:n,oldParams:r}){const i=t.data.info,a=e.data.sourceData
if(a!==i.structure)return o.xE.UpdateResult.Recreate
if(e.data.repr!==t.data.repr)return o.xE.UpdateResult.Recreate
const s=e.data.repr.geometryVersion
if(s!==i.geometryVersion&&(0,X.jH)(e.data.repr.props))return o.xE.UpdateResult.Recreate
const l=t.data.state.transparency,c=$.x.ofBundle(n.layers,a)
return $.x.areEqual(l,c)?o.xE.UpdateResult.Unchanged:(i.geometryVersion=s,t.data.state.transparency=c,t.data.repr=e.data.repr,t.label=`Transparency (${c.layers.length} Layers)`,o.xE.UpdateResult.Updated)}}),pn=c.H.BuiltIn({name:"emissive-structure-representation-3d-from-script",display:"Emissive 3D Representation",from:c.O.Molecule.Structure.Representation3D,to:c.O.Molecule.Structure.Representation3DState,params:()=>({layers:l.t.ObjectList({script:l.t.Script((0,W.Script)("(sel.atom.all)","mol-script")),value:l.t.Numeric(.5,{min:0,max:1,step:.01},{label:"Emissive"})},e=>`Emissive (${e.value})`,{defaultValue:[{script:(0,W.Script)("(sel.atom.all)","mol-script"),value:.5}]})})})({canAutoUpdate:()=>!0,apply({a:e,params:t}){const n=e.data.sourceData,r=e.data.repr.geometryVersion,i=nn.a.ofScript(t.layers,n)
return new c.O.Molecule.Structure.Representation3DState({state:{emissive:i},initialState:{emissive:nn.a.Empty},info:{structure:n,geometryVersion:r},repr:e.data.repr},{label:`Emissive (${i.layers.length} Layers)`})},update({a:e,b:t,newParams:n,oldParams:r}){const i=t.data.info,a=e.data.sourceData
if(a!==i.structure)return o.xE.UpdateResult.Recreate
if(e.data.repr!==t.data.repr)return o.xE.UpdateResult.Recreate
const s=e.data.repr.geometryVersion
if(s!==i.geometryVersion&&(0,X.jH)(e.data.repr.props))return o.xE.UpdateResult.Recreate
const l=t.data.state.emissive,c=nn.a.ofScript(n.layers,a)
return nn.a.areEqual(l,c)?o.xE.UpdateResult.Unchanged:(i.geometryVersion=s,t.data.state.emissive=c,t.data.repr=e.data.repr,t.label=`Emissive (${c.layers.length} Layers)`,o.xE.UpdateResult.Updated)}}),hn=c.H.BuiltIn({name:"emissive-structure-representation-3d-from-bundle",display:"Emissive 3D Representation",from:c.O.Molecule.Structure.Representation3D,to:c.O.Molecule.Structure.Representation3DState,params:()=>({layers:l.t.ObjectList({bundle:l.t.Value(r.StructureElement.Bundle.Empty),value:l.t.Numeric(.5,{min:0,max:1,step:.01},{label:"Emissive"})},e=>`Emissive (${e.value})`,{defaultValue:[{bundle:r.StructureElement.Bundle.Empty,value:.5}],isHidden:!0})})})({canAutoUpdate:()=>!0,apply({a:e,params:t}){const n=e.data.sourceData,r=e.data.repr.geometryVersion,i=nn.a.ofBundle(t.layers,n)
return new c.O.Molecule.Structure.Representation3DState({state:{emissive:i},initialState:{emissive:nn.a.Empty},info:{structure:n,geometryVersion:r},repr:e.data.repr},{label:`Emissive (${i.layers.length} Layers)`})},update({a:e,b:t,newParams:n,oldParams:r}){const i=t.data.info,a=e.data.sourceData
if(a!==i.structure)return o.xE.UpdateResult.Recreate
if(e.data.repr!==t.data.repr)return o.xE.UpdateResult.Recreate
const s=e.data.repr.geometryVersion
if(s!==i.geometryVersion&&(0,X.jH)(e.data.repr.props))return o.xE.UpdateResult.Recreate
const l=t.data.state.emissive,c=nn.a.ofBundle(n.layers,a)
return nn.a.areEqual(l,c)?o.xE.UpdateResult.Unchanged:(i.geometryVersion=s,t.data.state.emissive=c,t.data.repr=e.data.repr,t.label=`Emissive (${c.layers.length} Layers)`,o.xE.UpdateResult.Updated)}}),fn=c.H.BuiltIn({name:"substance-structure-representation-3d-from-script",display:"Substance 3D Representation",from:c.O.Molecule.Structure.Representation3D,to:c.O.Molecule.Structure.Representation3DState,params:()=>({layers:l.t.ObjectList({script:l.t.Script((0,W.Script)("(sel.atom.all)","mol-script")),material:en.i.getParam(),clear:l.t.Boolean(!1)},e=>`${e.clear?"Clear":en.i.toString(e.material)}`,{defaultValue:[{script:(0,W.Script)("(sel.atom.all)","mol-script"),material:(0,en.i)({roughness:1}),clear:!1}]})})})({canAutoUpdate:()=>!0,apply({a:e,params:t}){const n=e.data.sourceData,r=e.data.repr.geometryVersion,i=Jt.l.ofScript(t.layers,n)
return new c.O.Molecule.Structure.Representation3DState({state:{substance:i},initialState:{substance:Jt.l.Empty},info:{structure:n,geometryVersion:r},repr:e.data.repr},{label:`Substance (${i.layers.length} Layers)`})},update({a:e,b:t,newParams:n,oldParams:r}){const i=t.data.info,a=e.data.sourceData
if(a!==i.structure)return o.xE.UpdateResult.Recreate
if(e.data.repr!==t.data.repr)return o.xE.UpdateResult.Recreate
const s=e.data.repr.geometryVersion
if(s!==i.geometryVersion&&(0,X.jH)(e.data.repr.props))return o.xE.UpdateResult.Recreate
const l=t.data.state.substance,c=Jt.l.ofScript(n.layers,a)
return Jt.l.areEqual(l,c)?o.xE.UpdateResult.Unchanged:(i.geometryVersion=s,t.data.state.substance=c,t.data.repr=e.data.repr,t.label=`Substance (${c.layers.length} Layers)`,o.xE.UpdateResult.Updated)}}),mn=c.H.BuiltIn({name:"substance-structure-representation-3d-from-bundle",display:"Substance 3D Representation",from:c.O.Molecule.Structure.Representation3D,to:c.O.Molecule.Structure.Representation3DState,params:()=>({layers:l.t.ObjectList({bundle:l.t.Value(r.StructureElement.Bundle.Empty),material:en.i.getParam(),clear:l.t.Boolean(!1)},e=>`${e.clear?"Clear":en.i.toString(e.material)}`,{defaultValue:[{bundle:r.StructureElement.Bundle.Empty,material:(0,en.i)({roughness:1}),clear:!1}],isHidden:!0})})})({canAutoUpdate:()=>!0,apply({a:e,params:t}){const n=e.data.sourceData,r=e.data.repr.geometryVersion,i=Jt.l.ofBundle(t.layers,n)
return new c.O.Molecule.Structure.Representation3DState({state:{substance:i},initialState:{substance:Jt.l.Empty},info:{structure:n,geometryVersion:r},repr:e.data.repr},{label:`Substance (${i.layers.length} Layers)`})},update({a:e,b:t,newParams:n,oldParams:r}){const i=t.data.info,a=e.data.sourceData
if(a!==i.structure)return o.xE.UpdateResult.Recreate
if(e.data.repr!==t.data.repr)return o.xE.UpdateResult.Recreate
const s=e.data.repr.geometryVersion
if(s!==i.geometryVersion&&(0,X.jH)(e.data.repr.props))return o.xE.UpdateResult.Recreate
const l=t.data.state.substance,c=Jt.l.ofBundle(n.layers,a)
return Jt.l.areEqual(l,c)?o.xE.UpdateResult.Unchanged:(i.geometryVersion=s,t.data.state.substance=c,t.data.repr=e.data.repr,t.label=`Substance (${c.layers.length} Layers)`,o.xE.UpdateResult.Updated)}}),gn=c.H.BuiltIn({name:"clipping-structure-representation-3d-from-script",display:"Clipping 3D Representation",from:c.O.Molecule.Structure.Representation3D,to:c.O.Molecule.Structure.Representation3DState,params:()=>({layers:l.t.ObjectList({script:l.t.Script((0,W.Script)("(sel.atom.all)","mol-script")),groups:l.t.Converted(e=>Gt.l.Groups.toNames(e),e=>Gt.l.Groups.fromNames(e),l.t.MultiSelect((0,Ht.mX)(Gt.l.Groups.Names),l.t.objectToOptions(Gt.l.Groups.Names)))},e=>`${Gt.l.Groups.toNames(e.groups).length} group(s)`,{defaultValue:[{script:(0,W.Script)("(sel.atom.all)","mol-script"),groups:Gt.l.Groups.Flag.None}]})})})({canAutoUpdate:()=>!0,apply({a:e,params:t}){const n=e.data.sourceData,r=Gt.l.ofScript(t.layers,n)
return new c.O.Molecule.Structure.Representation3DState({state:{clipping:r},initialState:{clipping:Gt.l.Empty},info:n,repr:e.data.repr},{label:`Clipping (${r.layers.length} Layers)`})},update({a:e,b:t,newParams:n,oldParams:r}){const i=t.data.info
if(e.data.sourceData!==i)return o.xE.UpdateResult.Recreate
if(e.data.repr!==t.data.repr)return o.xE.UpdateResult.Recreate
const a=t.data.state.clipping,s=Gt.l.ofScript(n.layers,i)
return Gt.l.areEqual(a,s)?o.xE.UpdateResult.Unchanged:(t.data.state.clipping=s,t.data.repr=e.data.repr,t.label=`Clipping (${s.layers.length} Layers)`,o.xE.UpdateResult.Updated)}}),yn=c.H.BuiltIn({name:"clipping-structure-representation-3d-from-bundle",display:"Clipping 3D Representation",from:c.O.Molecule.Structure.Representation3D,to:c.O.Molecule.Structure.Representation3DState,params:()=>({layers:l.t.ObjectList({bundle:l.t.Value(r.StructureElement.Bundle.Empty),groups:l.t.Converted(e=>Gt.l.Groups.toNames(e),e=>Gt.l.Groups.fromNames(e),l.t.MultiSelect((0,Ht.mX)(Gt.l.Groups.Names),l.t.objectToOptions(Gt.l.Groups.Names)))},e=>`${Gt.l.Groups.toNames(e.groups).length} group(s)`,{defaultValue:[{bundle:r.StructureElement.Bundle.Empty,groups:Gt.l.Groups.Flag.None}],isHidden:!0})})})({canAutoUpdate:()=>!0,apply({a:e,params:t}){const n=e.data.sourceData,r=Gt.l.ofBundle(t.layers,n)
return new c.O.Molecule.Structure.Representation3DState({state:{clipping:r},initialState:{clipping:Gt.l.Empty},info:n,repr:e.data.repr},{label:`Clipping (${r.layers.length} Layers)`})},update({a:e,b:t,newParams:n,oldParams:r}){const i=t.data.info
if(e.data.sourceData!==i)return o.xE.UpdateResult.Recreate
if(e.data.repr!==t.data.repr)return o.xE.UpdateResult.Recreate
const a=t.data.state.clipping,s=Gt.l.ofBundle(n.layers,i)
return Gt.l.areEqual(a,s)?o.xE.UpdateResult.Unchanged:(t.data.state.clipping=s,t.data.repr=e.data.repr,t.label=`Clipping (${s.layers.length} Layers)`,o.xE.UpdateResult.Updated)}}),vn=c.H.BuiltIn({name:"theme-strength-representation-3d",display:"Theme Strength 3D Representation",from:c.O.Molecule.Structure.Representation3D,to:c.O.Molecule.Structure.Representation3DState,params:()=>({overpaintStrength:l.t.Numeric(1,{min:0,max:1,step:.01}),transparencyStrength:l.t.Numeric(1,{min:0,max:1,step:.01}),emissiveStrength:l.t.Numeric(1,{min:0,max:1,step:.01}),substanceStrength:l.t.Numeric(1,{min:0,max:1,step:.01})})})({canAutoUpdate:()=>!0,apply:({a:e,params:t})=>new c.O.Molecule.Structure.Representation3DState({state:{themeStrength:{overpaint:t.overpaintStrength,transparency:t.transparencyStrength,emissive:t.emissiveStrength,substance:t.substanceStrength}},initialState:{themeStrength:{overpaint:1,transparency:1,emissive:1,substance:1}},info:{},repr:e.data.repr},{label:"Theme Strength",description:`${t.overpaintStrength.toFixed(2)}, ${t.transparencyStrength.toFixed(2)}, ${t.emissiveStrength.toFixed(2)}, ${t.substanceStrength.toFixed(2)}`}),update({a:e,b:t,newParams:n,oldParams:r}){var i,a,s,l
return n.overpaintStrength===(null===(i=t.data.state.themeStrength)||void 0===i?void 0:i.overpaint)&&n.transparencyStrength===(null===(a=t.data.state.themeStrength)||void 0===a?void 0:a.transparency)&&n.emissiveStrength===(null===(s=t.data.state.themeStrength)||void 0===s?void 0:s.emissive)&&n.substanceStrength===(null===(l=t.data.state.themeStrength)||void 0===l?void 0:l.substance)?o.xE.UpdateResult.Unchanged:(t.data.state.themeStrength={overpaint:n.overpaintStrength,transparency:n.transparencyStrength,emissive:n.emissiveStrength,substance:n.substanceStrength},t.data.repr=e.data.repr,t.label="Theme Strength",t.description=`${n.overpaintStrength.toFixed(2)}, ${n.transparencyStrength.toFixed(2)}, ${n.emissiveStrength.toFixed(2)}, ${n.substanceStrength.toFixed(2)}`,o.xE.UpdateResult.Updated)},interpolate:(e,t,n)=>({overpaintStrength:(0,tn.Cc)(e.overpaintStrength,t.overpaintStrength,n),transparencyStrength:(0,tn.Cc)(e.transparencyStrength,t.transparencyStrength,n),emissiveStrength:(0,tn.Cc)(e.emissiveStrength,t.emissiveStrength,n),substanceStrength:(0,tn.Cc)(e.substanceStrength,t.substanceStrength,n)})})
var bn
!function(e){e.getDefaultParams=function(e,t,n,r,i,o,a,s){const c=e.representation.volume.registry.get(t),u=e.representation.volume.themes.colorThemeRegistry.get(i||c.defaultColorTheme.name),d=e.representation.volume.themes.sizeThemeRegistry.get(a||c.defaultSizeTheme.name),p=l.t.getDefaultValues(c.getParams(e.representation.volume.themes,n))
return{type:{name:t,params:r?{...p,...r}:p},colorTheme:{name:u.name,params:o?{...u.defaultValues,...o}:u.defaultValues},sizeTheme:{name:d.name,params:s?{...d.defaultValues,...s}:d.defaultValues}}},e.getDefaultParamsStatic=function(e,t,n,r,i,o,a){const s=e.representation.volume.registry.get(t),l=e.representation.volume.themes.colorThemeRegistry.get(r||s.defaultColorTheme.name),c=e.representation.volume.themes.sizeThemeRegistry.get(o||s.defaultSizeTheme.name)
return{type:{name:t,params:n?{...s.defaultValues,...n}:s.defaultValues},colorTheme:{name:s.defaultColorTheme.name,params:i?{...l.defaultValues,...i}:l.defaultValues},sizeTheme:{name:s.defaultSizeTheme.name,params:a?{...c.defaultValues,...a}:c.defaultValues}}},e.getDescription=function(e){var t,n,r,o
return e.isoValue?i.f.IsoValue.toString(e.isoValue):(null===(n=null===(t=e.renderMode)||void 0===t?void 0:t.params)||void 0===n?void 0:n.isoValue)?i.f.IsoValue.toString(null===(o=null===(r=e.renderMode)||void 0===r?void 0:r.params)||void 0===o?void 0:o.isoValue):void 0}}(bn||(bn={}))
const xn=c.H.BuiltIn({name:"volume-representation-3d",display:"3D Representation",from:c.O.Volume.Data,to:c.O.Volume.Representation3D,params:(e,t)=>{const{registry:n,themes:r}=t.representation.volume,o=n.get(n.default.name)
if(!e)return{type:l.t.Mapped(n.default.name,n.types,e=>l.t.Group(n.get(e).getParams(r,i.f.One))),colorTheme:l.t.Mapped(o.defaultColorTheme.name,r.colorThemeRegistry.types,e=>l.t.Group(r.colorThemeRegistry.get(e).getParams({volume:i.f.One}))),sizeTheme:l.t.Mapped(o.defaultSizeTheme.name,r.sizeThemeRegistry.types,e=>l.t.Group(r.sizeThemeRegistry.get(e).getParams({volume:i.f.One})))}
const a={volume:e.data}
return{type:l.t.Mapped(n.default.name,n.types,t=>l.t.Group(n.get(t).getParams(r,e.data))),colorTheme:l.t.Mapped(o.defaultColorTheme.name,r.colorThemeRegistry.getApplicableTypes(a),e=>l.t.Group(r.colorThemeRegistry.get(e).getParams(a))),sizeTheme:l.t.Mapped(o.defaultSizeTheme.name,r.sizeThemeRegistry.getApplicableTypes(a),e=>l.t.Group(r.sizeThemeRegistry.get(e).getParams(a)))}}})({canAutoUpdate:({oldParams:e,newParams:t})=>e.type.name===t.type.name,apply:({a:e,params:t},n)=>a.Task.create("Volume Representation",async r=>{var i
const o={runtime:r,assetManager:n.managers.asset,errorContext:n.errorContext},a=n.representation.volume.registry.get(t.type.name)
a.ensureCustomProperties&&await a.ensureCustomProperties.attach(o,e.data)
const l=a.factory({webgl:null===(i=n.canvas3d)||void 0===i?void 0:i.webgl,...n.representation.volume.themes},a.getParams)
l.setTheme(s.S.create(n.representation.volume.themes,{volume:e.data,locationKinds:a.locationKinds},t))
const u=t.type.params||{}
return await l.createOrUpdate(u,e.data).runInContext(r),new c.O.Volume.Representation3D({repr:l,sourceData:e.data},{label:a.label,description:bn.getDescription(u)})}),update:({a:e,b:t,oldParams:n,newParams:r},i)=>a.Task.create("Volume Representation",async a=>{var l
const c=i.representation.volume.registry.get(n.type.name)
if(r.type.name!==n.type.name)return null===(l=c.ensureCustomProperties)||void 0===l||l.detach(e.data),o.xE.UpdateResult.Recreate
const u={...t.data.repr.props,...r.type.params}
return t.data.repr.setTheme(s.S.create(i.representation.volume.themes,{volume:e.data,locationKinds:c.locationKinds},r)),await t.data.repr.createOrUpdate(u,e.data).runInContext(a),t.data.sourceData=e.data,t.description=bn.getDescription(u),o.xE.UpdateResult.Updated})}),Sn=c.H.BuiltIn({name:"shape-representation-3d",display:"3D Representation",from:c.O.Shape.Provider,to:c.O.Shape.Representation3D,params:(e,t)=>e?e.data.params:X.iy.Params})({canAutoUpdate:()=>!0,apply:({a:e,params:t})=>a.Task.create("Shape Representation",async n=>{const r={...l.t.getDefaultValues(e.data.params),...t},i=I(e.data.getShape,e.data.geometryUtils)
return await i.createOrUpdate(r,e.data.data).runInContext(n),new c.O.Shape.Representation3D({repr:i,sourceData:e.data},{label:e.data.label})}),update:({a:e,b:t,newParams:n})=>a.Task.create("Shape Representation",async r=>{const i={...t.data.repr.props,...n}
return await t.data.repr.createOrUpdate(i,e.data.data).runInContext(r),t.data.sourceData=e.data,o.xE.UpdateResult.Updated})}),_n=c.H.BuiltIn({name:"model-unitcell-3d",display:"Model Unit Cell",from:c.O.Molecule.Model,to:c.O.Shape.Representation3D,params:()=>({...ae})})({isApplicable:e=>!!Ut.i.Provider.get(e.data),canAutoUpdate:({oldParams:e,newParams:t})=>!0,apply:({a:e,params:t},n)=>a.Task.create("Model Unit Cell",async r=>{var i
const a=Ut.i.Provider.get(e.data)
if(!a)return o.BM.Null
const s=le(e.data,a,t),l=function(e){return p.YL.createMulti("Unit Cell",e,()=>ae,p.YL.StateBuilder,oe)}({webgl:null===(i=n.canvas3d)||void 0===i?void 0:i.webgl,...n.representation.structure.themes})
return await l.createOrUpdate(t,s).runInContext(r),new c.O.Shape.Representation3D({repr:l,sourceData:s},{label:"Unit Cell",description:a.spacegroup.name})}),update:({a:e,b:t,newParams:n})=>a.Task.create("Model Unit Cell",async r=>{const i=Ut.i.Provider.get(e.data)
if(!i)return o.xE.UpdateResult.Null
const a={...t.data.repr.props,...n},s=le(e.data,i,a)
return await t.data.repr.createOrUpdate(a,s).runInContext(r),t.data.sourceData=s,o.xE.UpdateResult.Updated})}),Cn=c.H.BuiltIn({name:"structure-bounding-box-3d",display:"Bounding Box",from:c.O.Molecule.Structure,to:c.O.Shape.Representation3D,params:{radius:l.t.Numeric(.05,{min:.01,max:4,step:.01},{isEssential:!0}),color:l.t.Color(u.ColorNames.red,{isEssential:!0}),...Y.e.Params}})({canAutoUpdate:()=>!0,apply:({a:e,params:t},n)=>a.Task.create("Bounding Box",async n=>{const r=I((e,t,n,r)=>{const i=(0,qt.getBoxMesh)(t.box,t.radius,null==r?void 0:r.geometry)
return h.y.create("Bouding Box",t,i,()=>t.color,()=>1,()=>"Bounding Box")},Y.e.Utils)
return await r.createOrUpdate(t,{box:e.data.boundary.box,radius:t.radius,color:t.color}).runInContext(n),new c.O.Shape.Representation3D({repr:r,sourceData:e.data},{label:"Bounding Box"})}),update:({a:e,b:t,oldParams:n,newParams:r},i)=>a.Task.create("Bounding Box",async n=>(await t.data.repr.createOrUpdate(r,{box:e.data.boundary.box,radius:r.radius,color:r.color}).runInContext(n),t.data.sourceData=e.data,o.xE.UpdateResult.Updated))}),wn=c.H.BuiltIn({name:"structure-selections-distance-3d",display:"3D Distance",from:c.O.Molecule.Structure.Selections,to:c.O.Shape.Representation3D,params:()=>({...be})})({canAutoUpdate:({oldParams:e,newParams:t})=>!0,apply:({a:e,params:t},n)=>a.Task.create("Structure Distance",async r=>{var i
const o=(0,Te.CR)(e.data),a=function(e){return p.YL.createMulti("Distance",e,()=>be,p.YL.StateBuilder,ve)}({webgl:null===(i=n.canvas3d)||void 0===i?void 0:i.webgl,...n.representation.structure.themes})
return await a.createOrUpdate(t,o).runInContext(r),new c.O.Shape.Representation3D({repr:a,sourceData:o},{label:"Distance"})}),update:({a:e,b:t,oldParams:n,newParams:r},i)=>a.Task.create("Structure Distance",async n=>{const i={...t.data.repr.props,...r},a=(0,Te.CR)(e.data)
return await t.data.repr.createOrUpdate(i,a).runInContext(n),t.data.sourceData=a,o.xE.UpdateResult.Updated})}),Tn=c.H.BuiltIn({name:"structure-selections-angle-3d",display:"3D Angle",from:c.O.Molecule.Structure.Selections,to:c.O.Shape.Representation3D,params:()=>({...ct})})({canAutoUpdate:({oldParams:e,newParams:t})=>!0,apply:({a:e,params:t},n)=>a.Task.create("Structure Angle",async r=>{var i
const o=(0,Te.mS)(e.data),a=function(e){return p.YL.createMulti("Angle",e,()=>ct,p.YL.StateBuilder,lt)}({webgl:null===(i=n.canvas3d)||void 0===i?void 0:i.webgl,...n.representation.structure.themes})
return await a.createOrUpdate(t,o).runInContext(r),new c.O.Shape.Representation3D({repr:a,sourceData:o},{label:"Angle"})}),update:({a:e,b:t,oldParams:n,newParams:r},i)=>a.Task.create("Structure Angle",async n=>{const i={...t.data.repr.props,...r},a=(0,Te.mS)(e.data)
return await t.data.repr.createOrUpdate(i,a).runInContext(n),t.data.sourceData=a,o.xE.UpdateResult.Updated})}),An=c.H.BuiltIn({name:"structure-selections-dihedral-3d",display:"3D Dihedral",from:c.O.Molecule.Structure.Selections,to:c.O.Shape.Representation3D,params:()=>({...Pt})})({canAutoUpdate:({oldParams:e,newParams:t})=>!0,apply:({a:e,params:t},n)=>a.Task.create("Structure Dihedral",async r=>{var i
const o=(0,Te.Qu)(e.data),a=function(e){return p.YL.createMulti("Dihedral",e,()=>Pt,p.YL.StateBuilder,It)}({webgl:null===(i=n.canvas3d)||void 0===i?void 0:i.webgl,...n.representation.structure.themes})
return await a.createOrUpdate(t,o).runInContext(r),new c.O.Shape.Representation3D({repr:a,sourceData:o},{label:"Dihedral"})}),update:({a:e,b:t,oldParams:n,newParams:r},i)=>a.Task.create("Structure Dihedral",async n=>{const i={...t.data.repr.props,...r},a=(0,Te.Qu)(e.data)
return await t.data.repr.createOrUpdate(i,a).runInContext(n),t.data.sourceData=a,o.xE.UpdateResult.Updated})}),In=c.H.BuiltIn({name:"structure-selections-label-3d",display:"3D Label",from:c.O.Molecule.Structure.Selections,to:c.O.Shape.Representation3D,params:()=>({...Pe})})({canAutoUpdate:({oldParams:e,newParams:t})=>!0,apply:({a:e,params:t},n)=>a.Task.create("Structure Label",async r=>{var i,o,a
const s=(0,Te.ne)(e.data),l=function(e){return p.YL.createMulti("Label",e,()=>Pe,p.YL.StateBuilder,Ie)}({webgl:null===(i=n.canvas3d)||void 0===i?void 0:i.webgl,...n.representation.structure.themes})
await l.createOrUpdate(t,s).runInContext(r)
const u=!(!(null===(o=t.snapshotKey)||void 0===o?void 0:o.trim())&&!(null===(a=t.tooltip)||void 0===a?void 0:a.trim()))
return l.setState({pickable:u,markerActions:u?v.sY.Highlighting:v.xi.None}),new c.O.Shape.Representation3D({repr:l,sourceData:s},{label:"Label"})}),update:({a:e,b:t,oldParams:n,newParams:r},i)=>a.Task.create("Structure Label",async n=>{var i,a
const s={...t.data.repr.props,...r},l=(0,Te.ne)(e.data)
await t.data.repr.createOrUpdate(s,l).runInContext(n),t.data.sourceData=l
const c=!(!(null===(i=r.snapshotKey)||void 0===i?void 0:i.trim())&&!(null===(a=r.tooltip)||void 0===a?void 0:a.trim()))
return t.data.repr.setState({pickable:c,markerActions:c?v.sY.Highlighting:v.xi.None}),o.xE.UpdateResult.Updated})}),Pn=c.H.BuiltIn({name:"structure-selections-orientation-3d",display:"3D Orientation",from:c.O.Molecule.Structure.Selections,to:c.O.Shape.Representation3D,params:()=>({...We})})({canAutoUpdate:({oldParams:e,newParams:t})=>!0,apply:({a:e,params:t},n)=>a.Task.create("Structure Orientation",async r=>{var i
const o=(0,Te.v6)(e.data),a=function(e){const t=p.YL.createMulti("Orientation",e,()=>We,p.YL.StateBuilder,Xe)
return t.setState({markerActions:v.sY.Highlighting}),t}({webgl:null===(i=n.canvas3d)||void 0===i?void 0:i.webgl,...n.representation.structure.themes})
return await a.createOrUpdate(t,o).runInContext(r),new c.O.Shape.Representation3D({repr:a,sourceData:o},{label:"Orientation"})}),update:({a:e,b:t,oldParams:n,newParams:r},i)=>a.Task.create("Structure Orientation",async n=>{const i={...t.data.repr.props,...r},a=(0,Te.v6)(e.data)
return await t.data.repr.createOrUpdate(i,a).runInContext(n),t.data.sourceData=a,o.xE.UpdateResult.Updated})}),Bn=c.H.BuiltIn({name:"structure-selections-plane-3d",display:"3D Plane",from:c.O.Molecule.Structure.Selections,to:c.O.Shape.Representation3D,params:()=>({...Wt})})({canAutoUpdate:({oldParams:e,newParams:t})=>!0,apply:({a:e,params:t},n)=>a.Task.create("Structure Plane",async r=>{var i
const o=(0,Te.hT)(e.data),a=function(e){const t=p.YL.createMulti("Plane",e,()=>Wt,p.YL.StateBuilder,Xt)
return t.setState({markerActions:v.sY.Highlighting}),t}({webgl:null===(i=n.canvas3d)||void 0===i?void 0:i.webgl,...n.representation.structure.themes})
return await a.createOrUpdate(t,o).runInContext(r),new c.O.Shape.Representation3D({repr:a,sourceData:o},{label:"Plane"})}),update:({a:e,b:t,oldParams:n,newParams:r},i)=>a.Task.create("Structure Plane",async n=>{const i={...t.data.repr.props,...r},a=(0,Te.hT)(e.data)
return await t.data.repr.createOrUpdate(i,a).runInContext(n),t.data.sourceData=a,o.xE.UpdateResult.Updated})})},32372(e,t,n){"use strict"
n.d(t,{E:()=>c,V:()=>r})
var r,i=n(22750),o=n(59455),a=n(70292),s=n(41009),l=n(41059)
!function(e){function t(e,t){return{kind:"url",id:i.k.create22(),url:e,...t}}e.Url=t,e.File=function(e){return{kind:"file",id:i.k.create22(),name:e.name,file:e}},e.isUrl=function(e){return"url"===(null==e?void 0:e.kind)},e.isFile=function(e){return"file"===(null==e?void 0:e.kind)},e.Wrapper=function(e,t,n){return{data:e,dispose:()=>{n.release(t)}}},e.getUrl=function(e){return"string"==typeof e?e:e.url},e.getUrlAsset=function(e,n,r){return"string"==typeof n?e.tryFindUrl(n,r)||t(n,{body:r}):n}}(r||(r={}))
class c{constructor(){this._assets=new Map}get assets(){return(0,l.ZR)(this._assets.values())}tryFindUrl(e,t){const n=this.assets.values()
for(;;){const i=n.next()
if(i.done)return
const o=i.value.asset
if(r.isUrl(o)&&o.url===e&&(o.body||"")===(t||""))return o}}tryFindFilename(e){const t=this._assets.values()
for(;;){const{done:n,value:r}=t.next()
if(n)break
if(r.file.name===e)return r.asset}}set(e,t,n){this._assets.set(e.id,{asset:e,file:t,refCount:0,tag:null==n?void 0:n.tag,isStatic:null==n?void 0:n.isStatic})}get(e){return this._assets.get(e.id)}delete(e){return this._assets.delete(e.id)}has(e){return this._assets.has(e.id)}resolve(e,t,n=!0){return r.isUrl(e)?a.Task.create(`Download ${e.title||e.url}`,async i=>{if(this._assets.has(e.id)){const n=this._assets.get(e.id)
return n.refCount++,r.Wrapper(await(0,o.dH)(n.file,t).runInContext(i),e,this)}if(!n)return r.Wrapper(await(0,o.hW)({...e,type:t}).runInContext(i),e,this)
const a=await(0,o.hW)({...e,type:"binary"}).runInContext(i),l=new s.e([a],"raw-data")
return this._assets.set(e.id,{asset:e,file:l,refCount:1}),r.Wrapper(await(0,o.dH)(l,t).runInContext(i),e,this)}):a.Task.create(`Read ${e.name}`,async i=>{if(this._assets.has(e.id)){const n=this._assets.get(e.id)
return n.refCount++,r.Wrapper(await(0,o.dH)(n.file,t).runInContext(i),e,this)}if(!(e.file instanceof s.e))throw new Error(`Cannot resolve file asset '${e.name}' (${e.id})`)
return n&&this._assets.set(e.id,{asset:e,file:e.file,refCount:1}),r.Wrapper(await(0,o.dH)(e.file,t).runInContext(i),e,this)})}release(e){const t=this._assets.get(e.id)
t&&(t.refCount--,t.refCount<=0&&!t.isStatic&&this._assets.delete(e.id))}clearTag(e){const t=Array.from(this._assets.keys())
for(const n of t){const t=this._assets.get(n)
t&&t.tag===e&&this._assets.delete(n)}}clear(){this._assets.clear()}dispose(){this.clear()}}},32520(e,t,n){"use strict"
n.d(t,{v:()=>r})
var r,i=n(9043),o=n(92384),a=n(81871),s=n(65081),l=n(17782),c=n(31727),u=n(14294),d=n(68187),p=n(9726),h=n(64170),f=n(69858),m=n(70012),g=n(37392),y=n(40426),v=n(32775),b=n(22394),x=n(71905),S=n(19231)
!function(e){function t(e,t,n,o){return o?function(e,t,n,r){return r.sphereCount=n,i.IQ.update(r.centerBuffer,e),i.IQ.update(r.groupBuffer,t),r.shaderData.update(),r}(e,t,n,o):function(e,t,n){const o=(0,u.f8)()
let a,s=-1,l=-1
const d=i.IQ.create((0,c.xg)(1,4,Float32Array)),p=i.IQ.create(v.ZY.create(0,0)),h=i.IQ.create([]),f=i.IQ.create(0),m={kind:"spheres",sphereCount:n,centerBuffer:i.IQ.create(e),groupBuffer:i.IQ.create(t),get boundingSphere(){const e=r(m)
if(e!==s){const t=(0,c.sL)(m.centerBuffer.ref.value,m.sphereCount,1)
u.f8.copy(o,t),s=e}return o},get groupMapping(){return m.groupBuffer.ref.version!==l&&(a=(0,g.AA)(m.groupBuffer.ref.value,m.sphereCount),l=m.groupBuffer.ref.version),a},setBoundingSphere(e){u.f8.copy(o,e),s=r(m)},shaderData:{positionGroup:d,texDim:p,lodLevels:h,sizeFactor:f,update(e){var t,n
const r=null!==(t=null==e?void 0:e.lodLevels)&&void 0!==t?t:w(h.ref.value),o=null!==(n=null==e?void 0:e.sizeFactor)&&void 0!==n?n:f.ref.value,a=A(r,o),s=(0,c.xg)(m.sphereCount,4,Float32Array,d.ref.value.array),l=_(s,m.centerBuffer.ref.value,m.groupBuffer.ref.value,m.sphereCount,a),u=l?C(r,o,l,m.sphereCount):[]
i.IQ.update(d,s),i.IQ.update(p,v.ZY.set(p.ref.value,s.width,s.height)),i.IQ.update(h,u),i.IQ.update(f,o)}}}
return m.shaderData.update(),m}(e,t,n)}function n(e){return t(e?e.centerBuffer.ref.value:new Float32Array(0),e?e.groupBuffer.ref.value:new Float32Array(0),0,e)}function r(e){return(0,m.TI)([e.sphereCount,e.centerBuffer.ref.version,e.groupBuffer.ref.version])}function _(e,t,n,r,i){const{array:o}=e
if(0===i.length){for(let e=0;e<r;++e)o[4*e+0]=t[3*e+0],o[4*e+1]=t[3*e+1],o[4*e+2]=t[3*e+2],o[4*e+3]=n[e]
return}const a=[0]
let s=0
for(let l=0,c=i.length;l<c;++l){const e=i[l]
for(let a=0;a<r;++a){let r=!1
for(let e=0;e<l;++e)if(a%i[e]===0){r=!0
break}r||a%e!==0||(o[4*s+0]=t[3*a+0],o[4*s+1]=t[3*a+1],o[4*s+2]=t[3*a+2],o[4*s+3]=n[a],s+=1)}a.push(6*s)}return a}function C(e,t,n,r){return e.map((e,i)=>{const o=T(e,t)
return[e.minDistance,e.maxDistance,e.overlap,n[n.length-1-i],Math.pow(Math.min(r,o),1/e.scaleBias),e.stride,e.scaleBias]})}function w(e){return e.map(e=>({minDistance:e[0],maxDistance:e[1],overlap:e[2],stride:e[5],scaleBias:e[6]}))}function T(e,t){return Math.max(1,Math.round(e.stride/Math.pow(t,e.scaleBias)))}function A(e,t){return e.map(e=>T(e,t)).reverse()}function I(e,t){const n=e.sphereCount,r=t.instanceCount.ref.value,i=(0,a.tu)(),o=i.position,s=e.centerBuffer.ref.value,l=t.aTransform.ref.value
return(0,a.iQ)(n,r,1,(e,t)=>(t<0?v.eB.fromArray(o,s,3*e):v.eB.transformMat4Offset(o,s,l,0,3*e,16*t),i))}function P(e,t,n,r,o){const{instanceCount:a,groupCount:m}=n,g=I(e,t),_=(0,s.D1)(n,g,r.color),C=(0,d.v3)(n,r.size),w=o.instanceGranularity?(0,l.Km)(a,"instance"):(0,l.Km)(a*m,"groupInstance"),T=(0,h.WG)(),A=(0,f.MD)(),P=(0,x.JS)(),B=(0,b.IB)(),E=(0,y.EN)(),k={drawCount:2*e.sphereCount*3,vertexCount:6*e.sphereCount,groupCount:m,instanceCount:a},D=e.boundingSphere.radius?(0,d.yx)(C)*o.sizeFactor:0,M=u.f8.expand((0,u.f8)(),e.boundingSphere,D),R=(0,c.Ax)(M,t.aTransform.ref.value,a,0)
return e.shaderData.update({lodLevels:o.lodLevels,sizeFactor:o.sizeFactor}),{dGeometryType:i.IQ.create("spheres"),uTexDim:e.shaderData.texDim,tPositionGroup:e.shaderData.positionGroup,boundingSphere:i.IQ.create(R),invariantBoundingSphere:i.IQ.create(M),uInvariantBoundingSphere:i.IQ.create(v.Zb.ofSphere(M)),..._,...C,...w,...T,...A,...P,...B,...E,...t,padding:i.IQ.create(D),...p.iy.createValues(o,k),uSizeFactor:e.shaderData.sizeFactor,uDoubleSided:i.IQ.create(o.doubleSided),dIgnoreLight:i.IQ.create(o.ignoreLight),dCelShaded:i.IQ.create(o.celShaded),dXrayShaded:i.IQ.create("inverted"===o.xrayShaded?"inverted":!0===o.xrayShaded?"on":"off"),dTransparentBackfaces:i.IQ.create(o.transparentBackfaces),dSolidInterior:i.IQ.create(o.solidInterior),dClipPrimitive:i.IQ.create(o.clipPrimitive),dApproximate:i.IQ.create(o.approximate),uAlphaThickness:i.IQ.create(o.alphaThickness),uBumpFrequency:i.IQ.create(o.bumpFrequency),uBumpAmplitude:i.IQ.create(o.bumpAmplitude),uInteriorColor:i.IQ.create((0,S.mT)(o.interior,(0,v.Zb)())),uInteriorSubstance:i.IQ.create((0,S.Zl)(o.interior,(0,v.Zb)())),lodLevels:e.shaderData.lodLevels,centerBuffer:e.centerBuffer,groupBuffer:e.groupBuffer}}function B(e,t){p.iy.updateRenderableState(e,t),e.opaque=e.opaque&&!t.xrayShaded,e.writeDepth=e.opaque}e.create=t,e.createEmpty=n,e.Params={...p.iy.Params,sizeFactor:o.t.Numeric(1,{min:0,max:10,step:.1}),doubleSided:o.t.Boolean(!1,p.iy.CustomQualityParamInfo),ignoreLight:o.t.Boolean(!1,p.iy.ShadingCategory),celShaded:o.t.Boolean(!1,p.iy.ShadingCategory),xrayShaded:o.t.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],p.iy.ShadingCategory),transparentBackfaces:o.t.Select("off",o.t.arrayToOptions(["off","on","opaque"]),p.iy.ShadingCategory),solidInterior:o.t.Boolean(!0,p.iy.ShadingCategory),clipPrimitive:o.t.Boolean(!1,{...p.iy.ShadingCategory,description:"Clip whole sphere instead of cutting it."}),approximate:o.t.Boolean(!1,{...p.iy.ShadingCategory,description:"Faster rendering, but has artifacts."}),alphaThickness:o.t.Numeric(0,{min:0,max:20,step:1},{...p.iy.ShadingCategory,description:"If not zero, adjusts alpha for radius."}),bumpFrequency:o.t.Numeric(0,{min:0,max:10,step:.1},p.iy.ShadingCategory),bumpAmplitude:o.t.Numeric(1,{min:0,max:5,step:.1},p.iy.ShadingCategory),interior:(0,S.ag)(),lodLevels:o.t.ObjectList({minDistance:o.t.Numeric(0),maxDistance:o.t.Numeric(0),overlap:o.t.Numeric(0),stride:o.t.Numeric(0),scaleBias:o.t.Numeric(3,{min:.1,max:10,step:.1})},e=>`${e.stride}`,{...p.iy.CullingLodCategory,defaultValue:[]})},e.Utils={Params:e.Params,createEmpty:n,createValues:P,createValuesSimple:function(t,n,r,i,a){const s=p.iy.createSimple(r,i,a),l={...o.t.getDefaultValues(e.Params),...n}
return P(t,s.transform,s.locationIterator,s.theme,l)},updateValues:function(e,t){p.iy.updateValues(e,t),i.IQ.updateIfChanged(e.uSizeFactor,t.sizeFactor),i.IQ.updateIfChanged(e.uDoubleSided,t.doubleSided),i.IQ.updateIfChanged(e.dIgnoreLight,t.ignoreLight),i.IQ.updateIfChanged(e.dCelShaded,t.celShaded),i.IQ.updateIfChanged(e.dXrayShaded,"inverted"===t.xrayShaded?"inverted":!0===t.xrayShaded?"on":"off"),i.IQ.updateIfChanged(e.dTransparentBackfaces,t.transparentBackfaces),i.IQ.updateIfChanged(e.dSolidInterior,t.solidInterior),i.IQ.updateIfChanged(e.dClipPrimitive,t.clipPrimitive),i.IQ.updateIfChanged(e.dApproximate,t.approximate),i.IQ.updateIfChanged(e.uAlphaThickness,t.alphaThickness),i.IQ.updateIfChanged(e.uBumpFrequency,t.bumpFrequency),i.IQ.updateIfChanged(e.uBumpAmplitude,t.bumpAmplitude),i.IQ.update(e.uInteriorColor,(0,S.mT)(t.interior,e.uInteriorColor.ref.value)),i.IQ.update(e.uInteriorSubstance,(0,S.Zl)(t.interior,e.uInteriorSubstance.ref.value))
const n=w(e.lodLevels.ref.value)
if(!function(e,t){if(e.length!==t.length)return!1
for(let n=0,r=e.length;n<r;++n){if(e[n].maxDistance!==t[n].maxDistance)return!1
if(e[n].minDistance!==t[n].minDistance)return!1
if(e[n].overlap!==t[n].overlap)return!1
if(e[n].stride!==t[n].stride)return!1
if(e[n].scaleBias!==t[n].scaleBias)return!1}return!0}(t.lodLevels,n)){const n=e.uVertexCount.ref.value/6,r=A(t.lodLevels,t.sizeFactor),o=_(e.tPositionGroup.ref.value,e.centerBuffer.ref.value,e.groupBuffer.ref.value,n,r),a=o?C(t.lodLevels,t.sizeFactor,o,n):[]
i.IQ.update(e.tPositionGroup,e.tPositionGroup.ref.value),i.IQ.update(e.lodLevels,a)}},updateBoundingSphere:function(e,t){const n=t.boundingSphere.radius?(0,d.yx)(e)*e.uSizeFactor.ref.value:0,r=u.f8.expand((0,u.f8)(),t.boundingSphere,n),o=(0,c.Ax)(r,e.aTransform.ref.value,e.instanceCount.ref.value,0)
u.f8.equals(o,e.boundingSphere.ref.value)||i.IQ.update(e.boundingSphere,o),u.f8.equals(r,e.invariantBoundingSphere.ref.value)||(i.IQ.update(e.invariantBoundingSphere,r),i.IQ.update(e.uInvariantBoundingSphere,v.Zb.fromSphere(e.uInvariantBoundingSphere.ref.value,r))),i.IQ.update(e.padding,n)},createRenderableState:function(e){const t=p.iy.createRenderableState(e)
return B(t,e),t},updateRenderableState:B,createPositionIterator:I}}(r||(r={}))},32751(e,t,n){"use strict"
n.d(t,{GT:()=>s,J1:()=>a,Kp:()=>i.K,TP:()=>o.T})
var r=n(16625),i=n(59792),o=(n(62837),n(25382))
n(81444)
const a={create:()=>({...r.YL.createState(),unitTransforms:null,unitTransformsVersion:-1}),update:(e,t)=>{r.YL.updateState(e,t),void 0!==t.unitTransforms&&(e.unitTransforms=t.unitTransforms)}}
function s(e){return e}},32773(e,t,n){"use strict"
var r
n.d(t,{Z:()=>r}),function(e){function t(e,t,n){return{kind:"value",namespace:e,name:t,parent:n}}function n(e,t,n,r){const i=Object.create(null)
for(const o of r)i[o]=!0
return{kind:"oneof",namespace:e,name:t,type:n,values:i}}e.Variable=function(e,t,n){return{kind:"variable",name:e,type:t,isConstraint:n}},e.Value=t,e.Container=function(e,t,n,r){return{kind:"container",namespace:e,name:t,child:n,alias:r}},e.Union=function(e){return{kind:"union",types:e}},e.OneOf=n,e.Any={kind:"any"},e.AnyValue={kind:"any-value"},e.Num=t("","Number"),e.Str=t("","String"),e.Bool=n("","Bool",e.Str,["true","false"]),e.oneOfValues=function({values:e}){return Object.keys(e).sort()}}(r||(r={}))},32775(e,t,n){"use strict"
n.d(t,{p8:()=>c.p,U:()=>i.U,$I:()=>r.$,k:()=>l.k,qY:()=>u.q,ZY:()=>o.Z,eB:()=>a.e,Zb:()=>s.Z})
var r=n(39250),i=n(69755),o=n(16124),a=n(37411),s=n(17370),l=n(6539),c=n(23325),u=n(42095)},32896(e,t,n){"use strict"
function r(e,t){return`${e}${"/"===e[e.length-1]||"/"===t[0]?"":"/"}${t}`}n.d(t,{r:()=>r})},33191(e,t,n){"use strict"
n.d(t,{j:()=>r})
var r,i=n(92726)
!function(e){e.Descriptor={name:"atom_partial_charge"},e.Provider=i.q.create(e.Descriptor)}(r||(r={}))},33204(e,t,n){"use strict"
n.d(t,{o:()=>i})
const r=["gz","zip"]
function i(e){let t=e,n=""
const i=t.lastIndexOf("?"),o=-1!==i?t.substring(i):""
t=t.substring(0,-1===i?t.length:i)
const a=t.replace(/^.*[\\/]/,"")
let s=a.substring(0,a.lastIndexOf("."))
const l=a.split(".")
let c=l.length>1?(l.pop()||"").toLowerCase():""
const u=t.match(/^(.+):\/\/(.+)$/)
u&&(n=u[1].toLowerCase(),t=u[2]||"")
const d=t.substring(0,t.lastIndexOf("/")+1)
if(r.includes(c)){const e=t.length-c.length-1
c=(t.substring(0,e).split(".").pop()||"").toLowerCase()
const n=s.length-c.length-1
s=s.substring(0,n)}return{path:t,name:a,ext:c,base:s,dir:d,protocol:n,query:o}}},33205(e,t,n){"use strict"
n.d(t,{e:()=>i,v:()=>o})
var r=n(9043)
function i(e){return e}!function(e){e.getUUID=function(e){return e.__key||(e.__key=r.kk.create22()),e.__key}}(i||(i={}))
class o{constructor(){this._list=[],this._set=new Set,this._refs=new Map,this._assets=new Map}get all(){return this._list}add(e){this._set.has(e)||(this._list.push(e),this._set.add(e))}reference(e,t){let n=this._refs.get(e)||0
n+=t?1:-1,this._refs.set(e,Math.max(n,0))}hasReference(e){return(this._refs.get(e)||0)>0}has(e){return this._set.has(e)}assets(e,t){const n=this._assets.get(e)
if(n)for(const r of n)r.dispose()
t?this._assets.set(e,t):this._assets.delete(e)}dispose(){this._assets.forEach(e=>{for(const t of e)t.dispose()})}}},33241(e,t,n){"use strict"
n.d(t,{f:()=>z})
var r={}
n.r(r),n.d(r,{CreateGroup:()=>u})
var i={}
n.r(i),n.d(i,{AssignColorVolume:()=>L,VolumeFromCcp4:()=>E,VolumeFromCube:()=>D,VolumeFromDensityServerCif:()=>R,VolumeFromDsn6:()=>k,VolumeFromDx:()=>M,VolumeFromSegmentationCif:()=>O,VolumeInstances:()=>F,VolumeTransform:()=>N})
var o=n(56382),a=n(43472),s=n(9043),l=n(92384),c=n(39298)
const u=c.H.BuiltIn({name:"create-group",display:{name:"Group"},from:[],to:c.O.Group,params:{label:l.t.Text("Group"),description:l.t.Optional(l.t.Text(""))}})({apply:({params:e})=>new c.O.Group({},e),update:({oldParams:e,newParams:t,b:n})=>(0,s.f8)(e,t)?a.xE.UpdateResult.Unchanged:(n.label=t.label,n.description=t.description,a.xE.UpdateResult.Updated)})
var d,p=n(2375),h=n(89748),f=n(32775),m=n(70292),g=n(14294),y=n(87423),v=n(51445),b=n(22219),x=n(63356),S=n(33205)
!function(e){e.is=function(e){return"ccp4"===(null==e?void 0:e.kind)},e.create=function(e){return{kind:"ccp4",name:e.name,data:e}}}(d||(d={}))
var _,C=n(46448)
!function(e){e.is=function(e){return"dsn6"===(null==e?void 0:e.kind)},e.create=function(e){return{kind:"dsn6",name:e.name,data:e}}}(_||(_={}))
var w,T=n(23121)
!function(e){e.is=function(e){return"dx"===(null==e?void 0:e.kind)},e.create=function(e){return{kind:"dx",name:e.name,data:e}}}(w||(w={}))
var A,I=n(90050),P=n(95538)
!function(e){e.is=function(e){return"segcif"===(null==e?void 0:e.kind)},e.create=function(e){return{kind:"segcif",name:e._name,data:e}}}(A||(A={}))
var B=n(42127)
const E=c.H.BuiltIn({name:"volume-from-ccp4",display:{name:"Volume from CCP4/MRC/MAP",description:"Create Volume from CCP4/MRC/MAP data"},from:c.O.Format.Ccp4,to:c.O.Volume.Data,params:e=>({voxelSize:l.t.Vec3(f.eB.create(1,1,1)),offset:l.t.Vec3(f.eB.create(0,0,0)),entryId:l.t.Text("")})})({apply:({a:e,params:t})=>m.Task.create("Create volume from CCP4/MRC/MAP",async n=>{const r=await function(e,t){return m.Task.create("Create Volume",async n=>{const{header:r,values:i}=e,o=f.eB.create(r.xLength,r.yLength,r.zLength)
t&&t.voxelSize&&f.eB.mul(o,o,t.voxelSize)
const a=f.eB.create((0,y.pu)(r.alpha),(0,y.pu)(r.beta),(0,y.pu)(r.gamma)),s=r.ISPG>65536?0:r.ISPG,l=g.O8.create(s||"P 1",o,a),c=f.eB.create(r.MAPC-1,r.MAPR-1,r.MAPS-1),u=f.qY.convertToCanonicalAxisIndicesFastToSlow(c),p=[r.NX,r.NY,r.NZ],h=u([r.NC,r.NR,r.NS]),m=function(e){return 0===e.originX&&0===e.originY&&0===e.originZ?f.eB.create(e.NCSTART,e.NRSTART,e.NSSTART):f.eB.create(e.originX/(e.xLength/e.NX),e.originY/(e.yLength/e.NY),e.originZ/(e.zLength/e.NZ))}(r);(null==t?void 0:t.offset)&&f.eB.add(m,m,t.offset)
const _=u(m),C=f.eB.create(_[0]/p[0],_[1]/p[1],_[2]/p[2]),w=f.eB.create(h[0]/p[0],h[1]/p[1],h[2]/p[2]),T=f.qY.Space(h,f.qY.invertAxisOrder(c),function(e){const t=(0,v.q7)(e)
switch(t){case b.RW.Float32:return Float32Array
case b.RW.Int8:return Int8Array
case b.RW.Int16:return Int16Array
case b.RW.Uint16:return Uint16Array}throw Error(`${t} is not a supported value format.`)}(r)),A=f.qY.create(T,f.qY.Data1(i)),I=0===r.AMIN&&0===r.AMAX&&0===r.AMEAN&&0===r.ARMS,P={transform:{kind:"spacegroup",cell:l,fractionalBox:g.DJ.create(C,f.eB.add((0,f.eB)(),C,w))},cells:A,stats:{min:Number.isNaN(r.AMIN)||I?(0,x.GP)(i):r.AMIN,max:Number.isNaN(r.AMAX)||I?(0,x._M)(i):r.AMAX,mean:Number.isNaN(r.AMEAN)||I?(0,x.VR)(i):r.AMEAN,sigma:Number.isNaN(r.ARMS)||0===r.ARMS?(0,x.C2)(i):r.ARMS}}
return{label:null==t?void 0:t.label,entryId:null==t?void 0:t.entryId,periodicity:f.eB.isInteger(w)?"xyz":"none",grid:P,instances:[{transform:f.$I.identity()}],sourceData:d.create(e),customProperties:new S.v,_propertyData:Object.create(null)}})}(e.data,{...t,label:e.data.name||e.label}).runInContext(n),i={label:r.label||"Volume",description:`Volume ${e.data.header.NX}${e.data.header.NX}${e.data.header.NX}`}
return new c.O.Volume.Data(r,i)}),dispose({b:e}){null==e||e.data.customProperties.dispose()}}),k=c.H.BuiltIn({name:"volume-from-dsn6",display:{name:"Volume from DSN6/BRIX",description:"Create Volume from DSN6/BRIX data"},from:c.O.Format.Dsn6,to:c.O.Volume.Data,params:e=>({voxelSize:l.t.Vec3(f.eB.create(1,1,1)),entryId:l.t.Text("")})})({apply:({a:e,params:t})=>m.Task.create("Create volume from DSN6/BRIX",async n=>{const r=await function(e,t){return m.Task.create("Create Volume",async n=>{const{header:r,values:i}=e,o=f.eB.create(r.xlen,r.ylen,r.zlen)
t&&t.voxelSize&&f.eB.mul(o,o,t.voxelSize)
const a=f.eB.create((0,y.pu)(r.alpha),(0,y.pu)(r.beta),(0,y.pu)(r.gamma)),s=g.O8.create("P 1",o,a),l=[r.xRate,r.yRate,r.zRate],c=[r.xExtent,r.yExtent,r.zExtent],u=[r.xStart,r.yStart,r.zStart],d=f.eB.create(u[0]/l[0],u[1]/l[1],u[2]/l[2]),p=f.eB.create(c[0]/l[0],c[1]/l[1],c[2]/l[2]),h=f.qY.Space(c,[0,1,2],Float32Array),m=f.qY.create(h,f.qY.Data1(i))
return{label:null==t?void 0:t.label,entryId:null==t?void 0:t.entryId,periodicity:f.eB.isInteger(p)?"xyz":"none",grid:{transform:{kind:"spacegroup",cell:s,fractionalBox:g.DJ.create(d,f.eB.add(f.eB.zero(),d,p))},cells:m,stats:{min:(0,x.GP)(i),max:(0,x._M)(i),mean:(0,x.VR)(i),sigma:void 0!==r.sigma?r.sigma:(0,x.C2)(i)}},instances:[{transform:f.$I.identity()}],sourceData:_.create(e),customProperties:new S.v,_propertyData:Object.create(null)}})}(e.data,{...t,label:e.data.name||e.label}).runInContext(n),i={label:r.label||"Volume",description:`Volume ${e.data.header.xExtent}${e.data.header.yExtent}${e.data.header.zExtent}`}
return new c.O.Volume.Data(r,i)}),dispose({b:e}){null==e||e.data.customProperties.dispose()}}),D=c.H.BuiltIn({name:"volume-from-cube",display:{name:"Volume from Cube",description:"Create Volume from Cube data"},from:c.O.Format.Cube,to:c.O.Volume.Data,params:e=>({dataIndex:e?l.t.Select(0,e.data.header.dataSetIds.map((e,t)=>[t,`${e}`])):l.t.Numeric(0),entryId:l.t.Text("")})})({apply:({a:e,params:t})=>m.Task.create("Create volume from Cube",async n=>{const r=await(0,T.C)(e.data,{...t,label:e.data.name||e.label}).runInContext(n),i={label:r.label||"Volume",description:`Volume ${e.data.header.dim[0]}${e.data.header.dim[1]}${e.data.header.dim[2]}`}
return new c.O.Volume.Data(r,i)}),dispose({b:e}){null==e||e.data.customProperties.dispose()}}),M=c.H.BuiltIn({name:"volume-from-dx",display:{name:"Parse DX",description:"Create volume from DX data."},from:c.O.Format.Dx,to:c.O.Volume.Data})({apply:({a:e})=>m.Task.create("Parse DX",async t=>{const n=await(r=e.data,i={label:e.data.name||e.label},m.Task.create("Create Volume",async()=>{const{header:e,values:t}=r,n=f.qY.Space(e.dim,[0,1,2],Float64Array),o=f.qY.create(n,f.qY.Data1(t)),a=f.$I.fromTranslation((0,f.$I)(),e.min),s=f.$I.fromScaling((0,f.$I)(),e.h)
return f.$I.mul(a,a,s),{label:null==i?void 0:i.label,entryId:null==i?void 0:i.entryId,grid:{transform:{kind:"matrix",matrix:a},cells:o,stats:{min:(0,x.GP)(t),max:(0,x._M)(t),mean:(0,x.VR)(t),sigma:(0,x.C2)(t)}},instances:[{transform:f.$I.identity()}],sourceData:w.create(r),customProperties:new S.v,_propertyData:Object.create(null)}})).runInContext(t)
var r,i
const o={label:n.label||"Volume",description:`Volume ${e.data.header.dim[0]}${e.data.header.dim[1]}${e.data.header.dim[2]}`}
return new c.O.Volume.Data(n,o)}),dispose({b:e}){null==e||e.data.customProperties.dispose()}}),R=c.H.BuiltIn({name:"volume-from-density-server-cif",display:{name:"Volume from density-server CIF",description:"Identify and create all separate models in the specified CIF data block"},from:c.O.Format.Cif,to:c.O.Volume.Data,params(e){if(!e)return{blockHeader:l.t.Optional(l.t.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."})),entryId:l.t.Text("")}
const t=e.data.blocks.slice(1)
return{blockHeader:l.t.Optional(l.t.Select(t[0]&&t[0].header,t.map(e=>[e.header,e.header]),{description:"Header of the block to parse"})),entryId:l.t.Text("")}}})({isApplicable:e=>e.data.blocks.length>0,apply:({a:e,params:t})=>m.Task.create("Parse density-server CIF",async n=>{var r
const i=t.blockHeader||e.data.blocks[1].header,o=e.data.blocks.find(e=>e.header===i)
if(!o)throw new Error(`Data block '${[i]}' not found.`)
const a=h.f$.schema.densityServer(o),s=await(0,C.G)(a,{entryId:t.entryId}).runInContext(n),[l,u,d]=s.grid.cells.space.dimensions,p={label:null!==(r=t.entryId)&&void 0!==r?r:a.volume_data_3d_info.name.value(0),description:`Volume ${l}${u}${d}`}
return new c.O.Volume.Data(s,p)}),dispose({b:e}){null==e||e.data.customProperties.dispose()}}),O=c.H.BuiltIn({name:"volume-from-segmentation-cif",display:{name:"Volume from Segmentation CIF"},from:c.O.Format.Cif,to:c.O.Volume.Data,params(e){const t=null==e?void 0:e.data.blocks.slice(1)
return{blockHeader:t?l.t.Optional(l.t.Select(t[0]&&t[0].header,t.map(e=>[e.header,e.header]),{description:"Header of the block to parse"})):l.t.Optional(l.t.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."})),segmentLabels:l.t.ObjectList({id:l.t.Numeric(-1),label:l.t.Text("")},e=>`${e.id} = ${e.label}`,{description:"Mapping of segment IDs to segment labels"}),ownerId:l.t.Text("",{isHidden:!0,description:"Reference to the object which manages this volume"})}}})({isApplicable:e=>e.data.blocks.length>0,apply:({a:e,params:t})=>m.Task.create("Parse segmentation CIF",async n=>{const r=t.blockHeader||e.data.blocks[1].header,i=e.data.blocks.find(e=>e.header===r)
if(!i)throw new Error(`Data block '${[r]}' not found.`)
const o=h.f$.schema.segmentation(i),a={}
for(const e of t.segmentLabels)a[e.id]=e.label
const s=await function(e,t){return m.Task.create("Create Segmentation Volume",async n=>{var r
const{volume_data_3d_info:i,segmentation_data_3d:o}=e,a=g.O8.create(i.spacegroup_number.value(0)||"P 1",f.eB.ofArray(i.spacegroup_cell_size.value(0)),f.eB.scale((0,f.eB)(),f.eB.ofArray(i.spacegroup_cell_angles.value(0)),Math.PI/180)),s=i.axis_order.value(0),l=f.qY.convertToCanonicalAxisIndicesFastToSlow(s),c=l(i.sample_count.value(0)),u=f.qY.Space(c,f.qY.invertAxisOrder(s),Float32Array),d=f.qY.create(u,f.qY.Data1(o.values.toArray({array:Float32Array}))),p=f.eB.ofArray(l(i.origin.value(0))),h=f.eB.ofArray(l(i.dimensions.value(0))),m={label:null==t?void 0:t.label,entryId:void 0,grid:{transform:{kind:"spacegroup",cell:a,fractionalBox:g.DJ.create(p,f.eB.add((0,f.eB)(),p,h))},cells:d,stats:{min:0,max:1,mean:0,sigma:1}},instances:[{transform:f.$I.identity()}],sourceData:A.create(e),customProperties:new S.v,_propertyData:{ownerId:null==t?void 0:t.ownerId}}
I.f.PickingGranularity.set(m,"object")
const y=new Map,v=new Map,{segment_id:b,set_id:x}=e.segmentation_data_table
for(let e=0,t=b.rowCount;e<t;++e){const t=b.value(e),n=x.value(e)
0!==n&&0!==t&&(v.has(n)||v.set(n,new Set),v.get(n).add(t))}v.forEach((e,t)=>{e.forEach(e=>{y.has(e)||y.set(e,new Set),y.get(e).add(t)})})
const _=[0,0,0],C=d.space.getCoords,w=d.data,[T,B,E]=m.grid.cells.space.dimensions,k=T-1,D=B-1,M=E-1,R={}
v.forEach((e,t)=>{R[t]=[k,D,M,-1,-1,-1]})
for(let e=0,t=w.length;e<t;++e){const t=w[e]
if(0===t)continue
C(e,_)
const n=R[t]
_[0]<n[0]&&(n[0]=_[0]),_[1]<n[1]&&(n[1]=_[1]),_[2]<n[2]&&(n[2]=_[2]),_[0]>n[3]&&(n[3]=_[0]),_[1]>n[4]&&(n[4]=_[1]),_[2]>n[5]&&(n[5]=_[2])}const O={}
return y.forEach((e,t)=>{O[t]=g.DJ.create(f.eB.create(k,D,M),f.eB.create(-1,-1,-1))}),(0,P.IF)(R,(e,t)=>{v.get(parseInt(t)).forEach(t=>{const n=O[t]
e[0]<n.min[0]&&(n.min[0]=e[0]),e[1]<n.min[1]&&(n.min[1]=e[1]),e[2]<n.min[2]&&(n.min[2]=e[2]),e[3]>n.max[0]&&(n.max[0]=e[3]),e[4]>n.max[1]&&(n.max[1]=e[4]),e[5]>n.max[2]&&(n.max[2]=e[5])})}),I.f.Segmentation.set(m,{segments:y,sets:v,bounds:O,labels:null!==(r=null==t?void 0:t.segmentLabels)&&void 0!==r?r:{}}),m})}(o,{segmentLabels:a,ownerId:t.ownerId}).runInContext(n),[l,u,d]=s.grid.cells.space.dimensions,p={label:o.volume_data_3d_info.name.value(0),description:`Segmentation ${l}${u}${d}`}
return new c.O.Volume.Data(s,p)}),dispose({b:e}){null==e||e.data.customProperties.dispose()}}),L=c.H.BuiltIn({name:"assign-color-volume",display:{name:"Assign Color Volume",description:"Assigns another volume to be available for coloring."},from:c.O.Volume.Data,to:c.O.Volume.Data,isDecorator:!0,params(e,t){if(!e)return{ref:l.t.Text()}
const n=t.state.data.select(a.QX.Generators.root.subtree().ofType(c.O.Volume.Data).filter(t=>{var n
return!!t.obj&&!(null===(n=t.obj)||void 0===n?void 0:n.data.colorVolume)&&t.obj!==e}))
return 0===n.length?{ref:l.t.Text("",{isHidden:!0})}:{ref:l.t.Select(n[0].transform.ref,n.map(e=>[e.transform.ref,e.obj.label]))}}})({apply:({a:e,params:t,dependencies:n})=>m.Task.create("Assign Color Volume",async r=>{if(!n||!n[t.ref])throw new Error("Dependency not available.")
const i=n[t.ref].data,o={...e.data,colorVolume:i},a={label:e.label,description:"Volume + Colors"}
return new c.O.Volume.Data(o,a)})}),N=c.H.BuiltIn({name:"volume-transform",display:{name:"Transform Volume"},isDecorator:!0,from:c.O.Volume.Data,to:c.O.Volume.Data,params:{transform:B.Eh}})({canAutoUpdate:()=>!1,apply({a:e,params:t}){const n=(0,B.tO)(t.transform)?I.x.getBoundingSphere(e.data.grid).center:f.eB.unit,r=(0,B.zk)(t.transform,n),i={kind:"matrix",matrix:f.$I.mul((0,f.$I)(),r,I.x.getGridToCartesianTransform(e.data.grid))}
return new c.O.Volume.Data({...e.data,grid:{...e.data.grid,transform:i}},{label:e.label,description:`${e.description} [Transformed]`})}}),F=c.H.BuiltIn({name:"volume-instances",display:{name:"Volume Instances"},isDecorator:!0,from:c.O.Volume.Data,to:c.O.Volume.Data,params:{transforms:l.t.ObjectList({transform:B.Eh},()=>"Transform")}})({canAutoUpdate:()=>!0,apply({a:e,params:t}){const n=t.transforms.some(e=>(0,B.tO)(e.transform))?I.x.getBoundingSphere(e.data.grid).center:f.eB.unit,r=t.transforms.map(e=>({transform:(0,B.zk)(e.transform,n)}))
return r.length?new c.O.Volume.Data({...e.data,instances:r},{label:e.label,description:`${e.description} [Instanced]`}):e}}),z={Data:o,Misc:r,Model:p,Volume:i,Representation:n(32117),Shape:n(48559)}},33404(e,t,n){"use strict"
function r([e]){return Math.atanh(e)}n.r(t),n.d(t,{atanh:()=>r,default:()=>i})
var i=(0,n(10336).helper)(r)},34322(e,t,n){"use strict"
n.d(t,{L3:()=>i,b0:()=>s,so:()=>o})
var r=n(32775)
function i(e,t){return{vertices:e,edges:t}}function o(e){return{vertices:new Float32Array(e.vertices),edges:new Uint32Array(e.edges)}}const a=r.eB.zero()
function s(e,t){const{vertices:n}=e
for(let i=0,o=n.length;i<o;i+=3)r.eB.transformMat4(a,r.eB.fromArray(a,n,i),t),r.eB.toArray(a,n,i)
return e}},34431(e,t,n){"use strict"
n.r(t),n.d(t,{atomicHet:()=>h,atomicSequence:()=>d,bundleElementImpl:()=>m,bundleGenerator:()=>g,defaultBondTest:()=>u,spheres:()=>f,water:()=>p})
var r=n(67538),i=n(66588),o=n(44688),a=n(20356),s=n(16913),l=n(87095),c=n(47589)
function u(e){return l.BondType.isCovalent(e.atomicBond.type)}function d(){return function(e){const{inputStructure:t}=e,n=i.i.Location.create(t),l=[]
for(const i of t.units){if(i.kind!==o.Nf.Kind.Atomic)continue
n.unit=i
const e=i.elements
if(n.element=e[0],"polymer"!==o.ZP.entity.type(n))continue
const t=r.hT.transientSegments(i.model.atomicHierarchy.residueAtomSegments,e)
let a=0
for(;t.hasNext;)a++,t.move()
a<8||l.push(i)}return s.c.Singletons(t,a.o.create(l,{parent:t}))}}function p(){return function(e){const{inputStructure:t}=e,n=i.i.Location.create(t),r=[]
for(const i of t.units){if(i.kind!==o.Nf.Kind.Atomic)continue
n.unit=i
const e=i.elements
n.element=e[0],"water"===o.ZP.entity.type(n)&&r.push(i)}return s.c.Singletons(t,a.o.create(r,{parent:t}))}}function h(){return function(e){const{inputStructure:t}=e,n=i.i.Location.create(t),l=[]
for(const i of t.units){if(i.kind!==o.Nf.Kind.Atomic)continue
n.unit=i
const e=i.elements
if(n.element=e[0],"water"!==o.ZP.entity.type(n)){if("polymer"===o.ZP.entity.type(n)){const t=r.hT.transientSegments(i.model.atomicHierarchy.residueAtomSegments,e)
let n=0
for(;t.hasNext;)n++,t.move()
if(n>=8)continue}l.push(i)}}return s.c.Singletons(t,a.o.create(l,{parent:t}))}}function f(){return function(e){const{inputStructure:t}=e,n=[]
for(const r of t.units)r.kind===o.Nf.Kind.Spheres&&n.push(r)
return s.c.Singletons(t,a.o.create(n,{parent:t}))}}function m(e,t,n){return{groupedUnits:e,ranges:t,set:n}}function g(e){return function(t){const n={hash:t.inputStructure.hashCode,elements:e}
return s.c.Sequence(t.inputStructure,[c.N.toStructure(n,t.inputStructure)])}}},34761(e,t,n){"use strict"
n.d(t,{j:()=>i})
var r=n(81501)
function i(e,t){return"object"!=typeof e||"prototype"in e?(0,r.create)(e,t):(0,r.create)({...e},t)}},34874(e,t,n){"use strict"
n.d(t,{K:()=>r})
var r,i=n(9043),o=n(92384)
!function(e){function t(e){const t={create:e=>({action:t,params:e}),id:i.kk.create22(),definition:e,createDefaultParams:(t,n)=>e.params?o.t.getDefaultValues(e.params(t,n)):{}}
return t}let n
e.create=t,e.fromTransformer=function(e){const n=e.definition
return t({from:n.from,display:n.display,params:n.params,isApplicable:e.definition.isApplicable?(t,n,r)=>e.definition.isApplicable(t,r):void 0,run({cell:t,state:n,params:r}){const i=n.build().to(t.transform.ref).apply(e,r)
return n.updateTree(i)}})},function(e){e.build=e=>function(e){return n=>t({from:e.from instanceof Array?e.from:e.from?[e.from]:[],display:"string"==typeof e.display?{name:e.display}:e.display?e.display:{name:"Unnamed State Action"},params:"object"==typeof e.params?()=>e.params:e.params?e.params:void 0,isApplicable:e.isApplicable,..."function"==typeof n?{run:n}:n})}(e)}(n=e.Builder||(e.Builder={})),e.build=n.build}(r||(r={}))},34943(e,t,n){"use strict"
function r(e,t){return e!==t}n.r(t),n.d(t,{default:()=>r})},35217(e,t,n){"use strict"
function r([e]){return Math.log10(e)}n.r(t),n.d(t,{default:()=>i,log10:()=>r})
var i=(0,n(10336).helper)(r)},36432(e,t,n){"use strict"
var r
n.d(t,{N:()=>r}),function(e){e.create=function(e){return e},e.has=function(e,t){return 0!==(e&t)},e.hasAll=function(e,t){return!!t&&(e&t)===t}}(r||(r={}))},36568(e,t,n){"use strict"
n.d(t,{R:()=>g,_:()=>y})
var r=n(80813),i=n(9959),o=n(97564),a=n(16698),s=n(87958),l=n(63317),c=n(17370),u=n(5638)
const d=s.i.distanceToPoint,p=a.Q.intersectsSphere3D,h=l.f.fromArray,f=(0,i.q)()
function m(e,t){return t&&t.instanceCounts.length>=e?t:{firsts:new Int32Array(e),counts:new Int32Array(e),offsets:new Int32Array(e),instanceCounts:new Int32Array(e),baseVertices:new Int32Array(e),baseInstances:new Uint32Array(e),count:0,uniforms:[]}}function g(e,t,n){const i=f()
let a=m(0)
const s=[]
let g=!1,y=-1
const v=(0,l.f)(),b=()=>{var e
const n=null===(e=t.lodLevels)||void 0===e?void 0:e.ref.value
if(n&&n.length>0){const{cellCount:e}=t.instanceGrid.ref.value
s.length=n.length
for(let t=0,r=n.length;t<r;++t)s[t]=m(e,s[t]),s[t].count=0
if(t.lodLevels.ref.version!==y){for(let e=0,t=n.length;e<t;++e)1!==s[e].uniforms.length&&(s[e].uniforms.length=1,s[e].uniforms[0]=["uLod",r.IQ.create((0,c.Z)())]),r.IQ.update(s[e].uniforms[0][1],c.Z.set(s[e].uniforms[0][1].ref.value,n[e][0],n[e][1],n[e][2],n[e][4]))
y=t.lodLevels.ref.version}}}
return b(),{id:i,materialId:e.materialId,values:t,state:n,cull:(e,n,r,i)=>{var o,l
if(g=!1,0===t.drawCount.ref.value)return
if(0===t.instanceCount.ref.value)return
if(t.instanceGrid.ref.value.cellSize<=1)return
const{cellOffsets:c,cellSpheres:f,cellCount:x,batchOffsets:S,batchSpheres:_,batchCount:C,batchCell:w,batchSize:T}=t.instanceGrid.ref.value,[A,I]=t.uLod.ref.value,P=0!==A||0!==I,B=2*T,E=null===(o=t.lodLevels)||void 0===o?void 0:o.ref.value
if(E&&E.length>0){if((null===(l=t.lodLevels)||void 0===l?void 0:l.ref.version)!==y)b()
else for(let e=0,t=E.length;e<t;++e)s[e].count=0
for(let t=0;t<C;++t){const o=S[t],a=S[t+1]
if(0===a-o)continue
h(v,_,4*t)
const l=d(e,v.center)
if(P&&(l+v.radius<A||l-v.radius>I))u.g$&&(i.culled.lod+=c[w[a-1]+1]-c[w[o]])
else if(p(n,v))if(null!==r&&r(v))u.g$&&(i.culled.occlusion+=c[w[a-1]+1]-c[w[o]])
else for(let t=o;t<a;++t){const o=w[t],a=c[o],l=c[o+1]-a
if(0===l)continue
h(v,f,4*o)
const m=d(e,v.center)
if(P&&(m+v.radius<A||m-v.radius>I))u.g$&&(i.culled.lod+=l)
else if(p(n,v))if(null!==r&&m-v.radius<B&&r(v))u.g$&&(i.culled.occlusion+=l)
else for(let e=0,t=E.length;e<t;++e){if(m+v.radius<E[e][0]||m-v.radius>E[e][1])continue
const t=s[e],n=t.count
n>0&&t.baseInstances[n-1]+t.instanceCounts[n-1]===a&&t.counts[n-1]===E[e][3]?t.instanceCounts[n-1]+=l:(t.counts[n]=E[e][3],t.instanceCounts[n]=l,t.baseInstances[n]=a,t.count+=1)}else u.g$&&(i.culled.frustum+=l)}else u.g$&&(i.culled.frustum+=c[w[a-1]+1]-c[w[o]])}}else{a=m(x,a)
const{baseInstances:o,instanceCounts:l,counts:g}=a
let y=0
for(let a=0;a<C;++a){const s=S[a],m=S[a+1]
if(0!==m-s){if(h(v,_,4*a),P){const t=d(e,v.center)
if(t+v.radius<A||t-v.radius>I){u.g$&&(i.culled.lod+=c[w[m-1]+1]-c[w[s]])
continue}}if(p(n,v))if(null!==r&&r(v))u.g$&&(i.culled.occlusion+=c[w[m-1]+1]-c[w[s]])
else for(let a=s;a<m;++a){const s=w[a],m=c[s],b=c[s+1]-m
if(0===b)continue
h(v,f,4*s)
const x=d(e,v.center)
P&&(x+v.radius<A||x-v.radius>I)?u.g$&&(i.culled.lod+=b):p(n,v)?null!==r&&x-v.radius<B&&r(v)?u.g$&&(i.culled.occlusion+=b):y>0&&o[y-1]+l[y-1]===m?l[y-1]+=b:(g[y]=t.drawCount.ref.value,l[y]=b,o[y]=m,y+=1):u.g$&&(i.culled.frustum+=b)}else u.g$&&(i.culled.frustum+=c[w[m-1]+1]-c[w[s]])}}a.count=y,s.length=1,s[0]=a,s[0].uniforms.length=0}g=!0},uncull:()=>{g=!1},cullSimple:(e,n,r)=>{var i,o
const a=null===(i=t.lodLevels)||void 0===i?void 0:i.ref.value
if(a&&0!==a.length){if((null===(o=t.lodLevels)||void 0===o?void 0:o.ref.version)!==y)b()
else for(let e=0,t=a.length;e<t;++e)s[e].count=0
for(let i=0,o=a.length;i<o;++i)if(e+n<a[i][1]*r){const e=s[i],n=e.count
e.counts[n]=a[i][3],e.instanceCounts[n]=t.instanceCount.ref.value,e.baseInstances[n]=0,e.count+=1
break}g=!0}},render:(i,a)=>{t.uAlpha&&t.alpha&&r.IQ.updateIfChanged(t.uAlpha,(0,o.qE)(t.alpha.ref.value*n.alphaFactor,0,1)),e.render(i,a,g?s:void 0)},getByteCount:()=>e.getByteCount(),getProgram:t=>e.getProgram(t),setTransparency:t=>e.setTransparency(t),update:()=>{e.update(),b()},dispose:()=>e.destroy()}}function y(e,t){return{id:f(),values:t,render:()=>{e.getProgram("compute").finalize(!0),e.render("compute",0)},update:()=>e.update(),dispose:()=>e.destroy()}}},37088(e,t,n){"use strict"
n.d(t,{NM:()=>o,Pi:()=>x,a5:()=>a,kB:()=>S})
var r=n(9043),i=n(95538)
function o(e,t){switch(t){case"b":case"b[]":return e.BOOL
case"f":case"f[]":return e.FLOAT
case"i":case"i[]":return e.INT
case"v2":case"v2[]":return e.FLOAT_VEC2
case"v3":case"v3[]":return e.FLOAT_VEC3
case"v4":case"v4[]":case"q":case"q[]":return e.FLOAT_VEC4
case"iv2":case"iv2[]":return e.INT_VEC2
case"iv3":case"iv3[]":return e.INT_VEC3
case"iv4":case"iv4[]":return e.INT_VEC4
case"m3":case"m3[]":return e.FLOAT_MAT3
case"m4":case"m4[]":return e.FLOAT_MAT4
default:console.error(`unknown uniform kind '${t}'`)}}function a(e){return e.endsWith("[]")}function s(e,t,n){e.uniform1f(t,n)}function l(e,t,n){e.uniform1fv(t,n)}function c(e,t,n){e.uniform1i(t,n)}function u(e,t,n){e.uniform1iv(t,n)}function d(e,t,n){e.uniform2fv(t,n)}function p(e,t,n){e.uniform3fv(t,n)}function h(e,t,n){e.uniform4fv(t,n)}function f(e,t,n){e.uniform2iv(t,n)}function m(e,t,n){e.uniform3iv(t,n)}function g(e,t,n){e.uniform4iv(t,n)}function y(e,t,n){e.uniformMatrix3fv(t,!1,n)}function v(e,t,n){e.uniformMatrix4fv(t,!1,n)}function b(e){switch(e){case"f":return s
case"f[]":return l
case"i":case"t":case"b":return c
case"i[]":case"t[]":case"b[]":return u
case"v2":case"v2[]":return d
case"v3":case"v3[]":return p
case"v4":case"v4[]":case"q":case"q[]":return h
case"iv2":case"iv2[]":return f
case"iv3":case"iv3[]":return m
case"iv4":case"iv4[]":return g
case"m3":case"m3[]":return y
case"m4":case"m4[]":return v}}function x(e){const t={}
return Object.keys(e).forEach(n=>{const r=e[n]
"uniform"===r.type?t[n]=b(r.kind):"texture"===r.type&&(t[n]=b("t"))}),t}function S(e){const t={}
return Object.keys(e).forEach(n=>{t[n]=r.IQ.create((0,i.Go)(e[n].ref.value))}),t}},37312(e,t,n){"use strict"
n.d(t,{f:()=>r})
const r=new class{constructor(){this.shouldUpdate=!1,this.isSynchronous=!0}update(e,t){}}},37392(e,t,n){"use strict"
n.d(t,{AA:()=>m,TL:()=>s,lm:()=>l,pi:()=>a,xL:()=>f})
var r=n(32775),i=n(63356)
const o=(0,r.eB)()
function a(e,t,n,i){for(let a=0,s=3*i;a<s;a+=3)r.eB.fromArray(o,t,n+a),r.eB.transformMat4(o,o,e),r.eB.toArray(o,t,n+a)}function s(e,t,n,i){for(let a=0,s=3*i;a<s;a+=3)r.eB.fromArray(o,t,n+a),r.eB.transformMat3(o,o,e),r.eB.toArray(o,t,n+a)}function l(e,t){for(let n=0,i=e.length;n<i;n+=3)r.eB.fromArray(o,e,n),r.eB.normalize(o,o),r.eB.scale(o,o,t),r.eB.toArray(o,e,n)}const c=(0,r.eB)(),u=(0,r.eB)(),d=(0,r.eB)(),p=(0,r.eB)(),h=(0,r.eB)()
function f(e,t,n,i,o){for(let a=0,s=3*o;a<s;a+=3){const i=3*t[a],o=3*t[a+1],s=3*t[a+2]
r.eB.fromArray(c,e,i),r.eB.fromArray(u,e,o),r.eB.fromArray(d,e,s),r.eB.sub(p,d,u),r.eB.sub(h,c,u),r.eB.cross(p,p,h),n[i]+=p[0],n[i+1]+=p[1],n[i+2]+=p[2],n[o]+=p[0],n[o+1]+=p[1],n[o+2]+=p[2],n[s]+=p[0],n[s+1]+=p[1],n[s+2]+=p[2]}return function(e,t){for(let n=0,r=3*t;n<r;n+=3){const t=e[n],r=e[n+1],i=e[n+2],o=1/Math.sqrt(t*t+r*r+i*i)
e[n]=t*o,e[n+1]=r*o,e[n+2]=i*o}return e}(n,i)}function m(e,t,n=1){const r=(0,i._M)(e),o=new Int32Array(r+2),a=new Int32Array(t),s=new Int32Array(t)
for(let i=0,u=t*n;i<u;i+=n)++s[e[i]]
let l=0
for(let i=0;i<t;i++)o[i]=l,l+=s[i]
o[t]=l
const c=new Int32Array(l)
for(let i=0,u=t*n;i<u;i+=n){const t=e[i]
c[o[t]+a[t]]=i,++a[t]}return{indices:c,offsets:o}}},37411(e,t,n){"use strict"
n.d(t,{e:()=>s})
var r=n(39250),i=n(97564),o=n(23325)
const a=isFinite
function s(){return s.zero()}!function(e){function t(){const e=[.1,0,0]
return e[0]=0,e}function n(e,n,r){const i=t()
return i[0]=e,i[1]=n,i[2]=r,i}function s(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function l(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function c(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function u(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function d(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}function p(e){const t=e[0],n=e[1],r=e[2]
return t*t+n*n+r*r}function h(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function f(e,t){const n=t[0],r=t[1],i=t[2]
let o=n*n+r*r+i*i
return o>0&&(o=1/Math.sqrt(o),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o),e}function m(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function g(e,t,n){const r=t[0],i=t[1],o=t[2],a=n[0],s=n[1],l=n[2]
return e[0]=i*l-o*s,e[1]=o*a-r*l,e[2]=r*s-i*a,e}e.zero=t,e.clone=function(e){const n=t()
return n[0]=e[0],n[1]=e[1],n[2]=e[2],n},e.isFinite=function(e){return a(e[0])&&a(e[1])&&a(e[2])},e.isInteger=function(e){return Number.isInteger(e[0])&&Number.isInteger(e[1])&&Number.isInteger(e[2])},e.hasNaN=function(e){return Number.isNaN(e[0])||Number.isNaN(e[1])||Number.isNaN(e[2])},e.setNaN=function(e){return e[0]=NaN,e[1]=NaN,e[2]=NaN,e},e.fromObj=function(e){return n(e.x,e.y,e.z)},e.toObj=function(e){return{x:e[0],y:e[1],z:e[2]}},e.fromArray=function(e,t,n){return e[0]=t[n+0],e[1]=t[n+1],e[2]=t[n+2],e},e.toArray=function(e,t,n){return t[n+0]=e[0],t[n+1]=e[1],t[n+2]=e[2],t},e.create=n,e.ofArray=function(e){const n=t()
return n[0]=e[0],n[1]=e[1],n[2]=e[2],n},e.set=function(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e},e.copy=s,e.add=l,e.sub=c,e.mul=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e},e.div=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e},e.scale=u,e.scaleAndAdd=d,e.scaleAndSub=function(e,t,n,r){return e[0]=t[0]-n[0]*r,e[1]=t[1]-n[1]*r,e[2]=t[2]-n[2]*r,e},e.addScalar=function(e,t,n){return e[0]=t[0]+n,e[1]=t[1]+n,e[2]=t[2]+n,e},e.subScalar=function(e,t,n){return e[0]=t[0]-n,e[1]=t[1]-n,e[2]=t[2]-n,e},e.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},e.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},e.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},e.trunc=function(e,t){return e[0]=Math.trunc(t[0]),e[1]=Math.trunc(t[1]),e[2]=Math.trunc(t[2]),e},e.abs=function(e,t){return e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e[2]=Math.abs(t[2]),e},e.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e},e.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e},e.clamp=function(e,t,n,r){return e[0]=Math.max(n[0],Math.min(r[0],t[0])),e[1]=Math.max(n[1],Math.min(r[1],t[1])),e[2]=Math.max(n[2],Math.min(r[2],t[2])),e},e.distance=function(e,t){const n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2]
return Math.sqrt(n*n+r*r+i*i)},e.squaredDistance=function(e,t){const n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2]
return n*n+r*r+i*i},e.magnitude=function(e){const t=e[0],n=e[1],r=e[2]
return Math.sqrt(t*t+n*n+r*r)},e.squaredMagnitude=p,e.setMagnitude=function(e,t,n){return u(e,f(e,t),n)},e.negate=h,e.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},e.normalize=f,e.dot=m,e.cross=g,e.lerp=function(e,t,n,r){const i=t[0],o=t[1],a=t[2]
return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e[2]=a+r*(n[2]-a),e}
const y=t()
function v(e,t){const n=Math.sqrt(p(e)*p(t))
if(0===n)return Math.PI/2
const r=m(e,t)/n
return Math.acos((0,i.qE)(r,-1,1))}e.slerp=function(e,t,n,r){const o=(0,i.qE)(m(t,n),-1,1),a=Math.acos(o)*r
return d(y,n,t,-o),f(y,y),l(e,u(e,t,Math.cos(a)),u(y,y,Math.sin(a)))},e.hermite=function(e,t,n,r,i,o){const a=o*o,s=a*(2*o-3)+1,l=a*(o-2)+o,c=a*(o-1),u=a*(3-2*o)
return e[0]=t[0]*s+n[0]*l+r[0]*c+i[0]*u,e[1]=t[1]*s+n[1]*l+r[1]*c+i[1]*u,e[2]=t[2]*s+n[2]*l+r[2]*c+i[2]*u,e},e.bezier=function(e,t,n,r,i,o){const a=1-o,s=a*a,l=o*o,c=s*a,u=3*o*s,d=3*l*a,p=l*o
return e[0]=t[0]*c+n[0]*u+r[0]*d+i[0]*p,e[1]=t[1]*c+n[1]*u+r[1]*d+i[1]*p,e[2]=t[2]*c+n[2]*u+r[2]*d+i[2]*p,e},e.quadraticBezier=function(e,t,n,r,o){return e[0]=(0,i.iD)(t[0],n[0],r[0],o),e[1]=(0,i.iD)(t[1],n[1],r[1],o),e[2]=(0,i.iD)(t[2],n[2],r[2],o),e},e.spline=function(e,t,n,r,o,a,s){return e[0]=(0,i.Y7)(t[0],n[0],r[0],o[0],a,s),e[1]=(0,i.Y7)(t[1],n[1],r[1],o[1],a,s),e[2]=(0,i.Y7)(t[2],n[2],r[2],o[2],a,s),e},e.random=function(e,t){const n=2*Math.random()*Math.PI,r=2*Math.random()-1,i=Math.sqrt(1-r*r)*t
return e[0]=Math.cos(n)*i,e[1]=Math.sin(n)*i,e[2]=r*t,e},e.transformMat4=function(e,t,n){const r=t[0],i=t[1],o=t[2],a=1/(n[3]*r+n[7]*i+n[11]*o+n[15]||1)
return e[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])*a,e[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])*a,e[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])*a,e},e.transformDirection=function(e,t,n){const r=t[0],i=t[1],o=t[2]
return e[0]=n[0]*r+n[4]*i+n[8]*o,e[1]=n[1]*r+n[5]*i+n[9]*o,e[2]=n[2]*r+n[6]*i+n[10]*o,f(e,e)},e.transformMat4Offset=function(e,t,n,r,i,o){const a=t[0+i],s=t[1+i],l=t[2+i],c=1/(n[3+o]*a+n[7+o]*s+n[11+o]*l+n[15+o]||1)
return e[0+r]=(n[0+o]*a+n[4+o]*s+n[8+o]*l+n[12+o])*c,e[1+r]=(n[1+o]*a+n[5+o]*s+n[9+o]*l+n[13+o])*c,e[2+r]=(n[2+o]*a+n[6+o]*s+n[10+o]*l+n[14+o])*c,e},e.transformDirectionOffset=function(e,t,n,r,i,o){const a=t[0+i],s=t[1+i],l=t[2+i]
e[0+r]=n[0+o]*a+n[4+o]*s+n[8+o]*l,e[1+r]=n[1+o]*a+n[5+o]*s+n[9+o]*l,e[2+r]=n[2+o]*a+n[6+o]*s+n[10+o]*l
const c=Math.hypot(e[0+r],e[1+r],e[2+r])
return c>0&&(e[0+r]/=c,e[1+r]/=c,e[2+r]/=c),e},e.transformMat3=function(e,t,n){const r=t[0],i=t[1],o=t[2]
return e[0]=r*n[0]+i*n[3]+o*n[6],e[1]=r*n[1]+i*n[4]+o*n[7],e[2]=r*n[2]+i*n[5]+o*n[8],e},e.transformQuat=function(e,t,n){const r=t[0],i=t[1],o=t[2],a=n[0],s=n[1],l=n[2],c=n[3],u=c*r+s*o-l*i,d=c*i+l*r-a*o,p=c*o+a*i-s*r,h=-a*r-s*i-l*o
return e[0]=u*c+h*-a+d*-l-p*-s,e[1]=d*c+h*-s+p*-a-u*-l,e[2]=p*c+h*-l+u*-s-d*-a,e},e.angle=v
const b=t(),x=t(),S=t(),_=t(),C=t(),w=t(),T=t()
e.dihedralAngle=function(e,t,n,r){c(b,e,t),c(x,n,t),c(S,t,n),c(_,r,n),g(C,b,x),g(w,S,_)
const i=v(C,w)
return g(T,C,w),m(x,T)>0?i:-i},e.directionFromSpherical=function(t,n,r,i){return e.set(t,i*Math.cos(r)*Math.sin(n),i*Math.sin(r)*Math.sin(n),i*Math.cos(n))},e.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},e.equals=function(e,t){const n=e[0],r=e[1],i=e[2],a=t[0],s=t[1],l=t[2]
return Math.abs(n-a)<=o.p*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-s)<=o.p*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-l)<=o.p*Math.max(1,Math.abs(i),Math.abs(l))}
const A=t()
function I(e){return 0===e[0]&&0===e[1]&&0===e[2]}e.makeRotation=function(t,n,i){const a=v(n,i)
if(Math.abs(a)<1e-4)return r.$.setIdentity(t)
if(Math.abs(a-Math.PI)<o.p)return r.$.fromRotation(t,Math.PI,Math.abs(n[0])<.9?e.unitX:e.unitZ)
const s=g(A,n,i)
return r.$.fromRotation(t,a,s)},e.isZero=I,e.projectPointOnVector=function(e,t,n,r){return c(e,t,r),l(e,u(e,n,m(n,e)/p(n)),r)}
const P=t()
function B(e,t,n){return u(e,n,m(n,t)/p(n))}e.projectPointOnPlane=function(e,t,n,r){return f(P,n),c(e,t,r),c(e,t,u(P,P,m(e,P)))},e.projectOnVector=B
const E=t()
e.projectOnPlane=function(e,t,n){return B(E,t,n),c(e,t,E)},e.orthogonalize=function(t,n,r){return f(t,g(t,g(t,n,r),n)),e.isZero(t)?(t[0]=1,t[1]=0,t[2]=0,f(t,g(t,g(t,n,t),n)),e.isZero(t)?(t[0]=0,t[1]=1,t[2]=0,f(t,g(t,g(t,n,t),n)),e.isZero(t)?(f(t,r),e.isZero(t)?(t[0]=1,t[1]=0,t[2]=0,t):t):t):t):t},e.matchDirection=function(e,t,n){return m(t,n)>0?s(e,t):h(e,s(e,t)),e},e.orthogonalDirection=function(n,r){if(I(r))return s(n,e.unitX)
{const e=t()
return Math.abs(r[0])<Math.abs(r[1])&&Math.abs(r[0])<Math.abs(r[2])?(e[0]=0,e[1]=r[2],e[2]=-r[1]):Math.abs(r[1])<Math.abs(r[2])?(e[0]=-r[2],e[1]=0,e[2]=r[0]):(e[0]=r[1],e[1]=-r[0],e[2]=0),f(n,e)}}
const k=t(),D=t()
e.triangleNormal=function(e,t,n,r){return c(k,n,t),c(D,r,t),f(e,g(e,k,D))}
const M=t()
e.center=function(t,n,r){return e.scaleAndAdd(t,n,e.sub(M,r,n),.5)},e.toString=function(e,t){return`[${e[0].toPrecision(t)} ${e[1].toPrecision(t)} ${e[2].toPrecision(t)}]`},e.origin=n(0,0,0),e.unit=n(1,1,1),e.negUnit=n(-1,-1,-1),e.unitX=n(1,0,0),e.unitY=n(0,1,0),e.unitZ=n(0,0,1),e.negUnitX=n(-1,0,0),e.negUnitY=n(0,-1,0),e.negUnitZ=n(0,0,-1)}(s||(s={}))},38382(e,t,n){"use strict"
n.d(t,{ER:()=>i,J6:()=>a,_q:()=>o,k0:()=>s,sw:()=>l})
var r=n(41113)
const i=(0,r.vs)("SkipCache",Symbol.for("wd:skip-cache")),o=(0,r.vs)("EnableHydration",Symbol.for("wd:enable-hydration")),a=(0,r.L1)("IS_FUTURE",Symbol("IS_FUTURE")),s=(0,r.L1)("DOC",Symbol("DOC"))
function l(e){return e}},38442(e,t,n){"use strict"
n.d(t,{N:()=>s})
var r=n(70012),i=n(65580)
const o=r.Gm.add3,a=r.Gm.add
var s
!function(e){e.create=function(e=2048,t=1024,n){const s=r.Gm.create(Float32Array,3,t,n?n.centerBuffer.ref.value:e),l=r.Gm.create(Float32Array,1,t,n?n.groupBuffer.ref.value:e)
return{add:(e,t,n,r)=>{o(s,e,t,n),a(l,r)},getPoints:()=>{const e=r.Gm.compact(s,!0),t=r.Gm.compact(l,!0)
return i.O.create(e,t,s.elementCount,n)}}}}(s||(s={}))},38547(e,t,n){"use strict"
n.d(t,{c:()=>m,P:()=>g})
var r=n(46357),i=n(36568),o=n(19708),a=n(95916),s=n(83164),l=n(31683),c=n(32775),u=n(9043),d=n(92384),p=n(85362),h=n(5638),f=n(28269)
const m={strength:d.t.Numeric(1,{min:0,max:3,step:.1}),radius:d.t.Numeric(0,{min:0,max:1,step:.01}),threshold:d.t.Numeric(0,{min:0,max:1,step:.01},{description:"Luminosity threshold",hideIf:e=>"emissive"===e.mode}),mode:d.t.Select("emissive",[["luminosity","Luminosity"],["emissive","Emissive"]])}
class g{static isEnabled(e){return e.enabled&&"on"===e.bloom.name}constructor(e,t,n){this.webgl=e,this.horizontalBlurTargets=[],this.verticalBlurTargets=[],this.emissiveTarget=e.createRenderTarget(t,n,!0,"uint8","linear","rgba"),this.luminosityTarget=e.createRenderTarget(t,n,!1,"uint8","linear"),this.compositeTarget=e.createRenderTarget(t,n,!1,"uint8","linear")
let o=Math.round(t/2),a=Math.round(n/2)
for(let r=0;r<5;++r)this.horizontalBlurTargets[r]=e.createRenderTarget(o,a,!1,"uint8","linear"),this.verticalBlurTargets[r]=e.createRenderTarget(o,a,!1,"uint8","linear"),o=Math.round(o/2),a=Math.round(a/2)
const d=(0,l.z6)()
this.luminosityRenderable=function(e,t,n,o){const a=t.getWidth(),l=t.getHeight(),d={...r.OM,tColor:u.IQ.create(t),tEmissive:u.IQ.create(n),tDepth:u.IQ.create(o),uTexSizeInv:u.IQ.create(c.ZY.create(1/a,1/l)),uDefaultColor:u.IQ.create((0,c.eB)()),uDefaultOpacity:u.IQ.create(0),uLuminosityThreshold:u.IQ.create(0),uSmoothWidth:u.IQ.create(1),dMode:u.IQ.create("emissive")},p={...y},h=(0,s.$h)(e,"triangles",v,p,d)
return(0,i._)(h,d)}(e,d,d,d),this.blurRenderable=function(e,t){const n=t.getWidth(),o=t.getHeight(),a={...r.OM,tInput:u.IQ.create(t),uTexSizeInv:u.IQ.create(c.ZY.create(1/n,1/o)),uDirection:u.IQ.create((0,c.ZY)()),uGaussianCoefficients:u.IQ.create([]),dKernelRadius:u.IQ.create(x[0])},l={...C},d=(0,s.$h)(e,"triangles",w,l,a)
return(0,i._)(d,a)}(e,d),this.compositeRenderable=function(e,t,n,o,a,l,d,p){const h={...r.OM,uTexSizeInv:u.IQ.create(c.ZY.create(t,n)),tBlur1:u.IQ.create(o),tBlur2:u.IQ.create(a),tBlur3:u.IQ.create(l),tBlur4:u.IQ.create(d),tBlur5:u.IQ.create(p),uBloomStrength:u.IQ.create(1),uBloomRadius:u.IQ.create(0),uBloomFactors:u.IQ.create([1,.8,.6,.4,.2]),uBloomTints:u.IQ.create(new Array(15).fill(1))},f={...T},m=(0,s.$h)(e,"triangles",A,f,h)
return(0,i._)(m,h)}(e,t,n,this.verticalBlurTargets[0].texture,this.verticalBlurTargets[1].texture,this.verticalBlurTargets[2].texture,this.verticalBlurTargets[3].texture,this.verticalBlurTargets[4].texture),this.copyRenderable=(0,r._0)(e,this.compositeTarget.texture)}getByteCount(){return this.emissiveTarget.getByteCount()+this.luminosityTarget.getByteCount()+this.compositeTarget.getByteCount()+this.horizontalBlurTargets.reduce((e,t)=>e+t.getByteCount(),0)+this.verticalBlurTargets.reduce((e,t)=>e+t.getByteCount(),0)}setSize(e,t){const n=this.luminosityTarget.getWidth(),r=this.luminosityTarget.getHeight()
if(e!==n||t!==r){this.emissiveTarget.setSize(e,t),this.luminosityTarget.setSize(e,t),this.compositeTarget.setSize(e,t)
let n=Math.round(e/2),r=Math.round(t/2)
for(let e=0;e<5;++e)this.horizontalBlurTargets[e].setSize(n,r),this.verticalBlurTargets[e].setSize(n,r),n=Math.round(n/2),r=Math.round(r/2)
u.IQ.update(this.luminosityRenderable.values.uTexSizeInv,c.ZY.set(this.compositeRenderable.values.uTexSizeInv.ref.value,1/e,1/t)),u.IQ.update(this.compositeRenderable.values.uTexSizeInv,c.ZY.set(this.compositeRenderable.values.uTexSizeInv.ref.value,1/e,1/t)),u.IQ.update(this.copyRenderable.values.uTexSize,c.ZY.set(this.copyRenderable.values.uTexSize.ref.value,e,t))}}update(e,t,n,r){let i=!1
this.luminosityRenderable.values.tColor.ref.value!==e&&(u.IQ.update(this.luminosityRenderable.values.tColor,e),i=!0),this.luminosityRenderable.values.tEmissive.ref.value!==t&&(u.IQ.update(this.luminosityRenderable.values.tEmissive,t),i=!0),this.luminosityRenderable.values.tDepth.ref.value!==n&&(u.IQ.update(this.luminosityRenderable.values.tDepth,n),i=!0),this.luminosityRenderable.values.dMode.ref.value!==r.mode&&(u.IQ.update(this.luminosityRenderable.values.dMode,r.mode),i=!0),u.IQ.updateIfChanged(this.luminosityRenderable.values.uLuminosityThreshold,r.threshold),i&&this.luminosityRenderable.update()
let o=!1
this.blurRenderable.values.tInput.ref.value!==e&&(u.IQ.update(this.blurRenderable.values.tInput,e),o=!0),o&&this.blurRenderable.update(),u.IQ.update(this.compositeRenderable.values.uBloomRadius,r.radius),u.IQ.update(this.compositeRenderable.values.uBloomStrength,r.strength)}render(e,t){h.g$&&this.webgl.timer.mark("BloomPass.render")
const{gl:n,state:r}=this.webgl,{x:i,y:o,width:a,height:s}=e
r.viewport(i,o,a,s),r.scissor(i,o,a,s),r.enable(n.SCISSOR_TEST),r.disable(n.BLEND),r.disable(n.DEPTH_TEST),r.depthMask(!1),this.luminosityTarget.bind(),this.luminosityRenderable.render()
for(let l=0;l<5;++l){const e=this.horizontalBlurTargets[l].getWidth(),t=this.horizontalBlurTargets[l].getHeight()
r.viewport(0,0,e,t),r.scissor(0,0,e,t),u.IQ.update(this.blurRenderable.values.dKernelRadius,x[l]),u.IQ.update(this.blurRenderable.values.uGaussianCoefficients,b(x[l])),u.IQ.update(this.blurRenderable.values.uTexSizeInv,c.ZY.set(this.blurRenderable.values.uTexSizeInv.ref.value,1/e,1/t)),this.horizontalBlurTargets[l].bind(),u.IQ.update(this.blurRenderable.values.tInput,0===l?this.luminosityTarget.texture:this.verticalBlurTargets[l-1].texture),u.IQ.update(this.blurRenderable.values.uDirection,S),this.blurRenderable.update(),this.blurRenderable.render(),this.verticalBlurTargets[l].bind(),u.IQ.update(this.blurRenderable.values.tInput,this.horizontalBlurTargets[l].texture),u.IQ.update(this.blurRenderable.values.uDirection,_),this.blurRenderable.update(),this.blurRenderable.render()}r.viewport(i,o,a,s),r.scissor(i,o,a,s),this.compositeTarget.bind(),this.compositeRenderable.update(),this.compositeRenderable.render(),t?t.bind():this.webgl.bindDrawingBuffer(),r.enable(n.BLEND),r.blendFunc(n.ONE,n.ONE),this.copyRenderable.render(),h.g$&&this.webgl.timer.markEnd("BloomPass.render")}}const y={...r.du,tColor:(0,o.$G)("texture","rgba","ubyte","linear"),tEmissive:(0,o.$G)("texture","rgba","ubyte","linear"),tDepth:(0,o.$G)("texture","rgba","ubyte","nearest"),uTexSizeInv:(0,o.w5)("v2"),uDefaultColor:(0,o.w5)("v3"),uDefaultOpacity:(0,o.w5)("f"),uLuminosityThreshold:(0,o.w5)("f"),uSmoothWidth:(0,o.w5)("f"),dMode:(0,o.$F)("string",["luminosity","emissive"])},v=(0,a.NG)("Bloom Luminosity",p.e,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tColor;\nuniform sampler2D tEmissive;\nuniform sampler2D tDepth;\nuniform vec2 uTexSizeInv;\n\nuniform vec3 uDefaultColor;\nuniform float uDefaultOpacity;\nuniform float uLuminosityThreshold;\nuniform float uSmoothWidth;\n\n#include common\n\nfloat getDepth(const in vec2 coords) {\n    #ifdef depthTextureSupport\n        return texture2D(tDepth, coords).r;\n    #else\n        return unpackRGBAToDepth(texture2D(tDepth, coords));\n    #endif\n}\n\nbool isBackground(const in float depth) {\n    return depth == 1.0;\n}\n\nvoid main(void) {\n    vec2 coords = gl_FragCoord.xy * uTexSizeInv;\n    vec4 texel = texture2D(tColor, coords);\n    float emissive = texture2D(tEmissive, coords).a;\n    float depth = getDepth(coords);\n\n    if (isBackground(depth)) {\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n        return;\n    }\n\n    vec4 outputColor = vec4(uDefaultColor.rgb, uDefaultOpacity);\n\n    #if defined(dMode_luminosity)\n        vec3 luma = vec3(0.299, 0.587, 0.114);\n        float v = dot(texel.xyz, luma);\n        float alpha = smoothstep(uLuminosityThreshold, uLuminosityThreshold + uSmoothWidth, v);\n\n        gl_FragColor = mix(outputColor, texel, alpha);\n    #elif defined(dMode_emissive)\n        gl_FragColor = mix(outputColor, texel, emissive);\n    #endif\n}\n"),b=(0,f.E)(function(e){const t=[]
for(let n=0;n<e;++n)t.push(.39894*Math.exp(-.5*n*n/(e*e))/e)
return t}),x=[3,5,7,9,11],S=c.ZY.create(1,0),_=c.ZY.create(0,1),C={...r.du,tInput:(0,o.$G)("texture","rgba","ubyte","linear"),uTexSizeInv:(0,o.w5)("v2"),uDirection:(0,o.w5)("v2"),uGaussianCoefficients:(0,o.w5)("f[]"),dKernelRadius:(0,o.$F)("number")},w=(0,a.NG)("Bloom Blur",p.e,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tInput;\nuniform vec2 uTexSizeInv;\n\nuniform vec2 uDirection;\nuniform float uGaussianCoefficients[dKernelRadius];\n\nvoid main(void) {\n    vec2 coords = gl_FragCoord.xy * uTexSizeInv;\n    float weightSum = uGaussianCoefficients[0];\n    vec4 diffuseSum = texture2D(tInput, coords) * weightSum;\n\n    for(int i = 1; i < dKernelRadius; ++i) {\n        float x = float(i);\n        float w = uGaussianCoefficients[i];\n        vec2 offset = uDirection * uTexSizeInv * x;\n        vec4 sample1 = texture2D(tInput, coords + offset);\n        vec4 sample2 = texture2D(tInput, coords - offset);\n        diffuseSum += (sample1 + sample2) * w;\n        weightSum += 2.0 * w;\n    }\n\n    gl_FragColor = diffuseSum / weightSum;\n}\n"),T={...r.du,tBlur1:(0,o.$G)("texture","rgba","ubyte","linear"),tBlur2:(0,o.$G)("texture","rgba","ubyte","linear"),tBlur3:(0,o.$G)("texture","rgba","ubyte","linear"),tBlur4:(0,o.$G)("texture","rgba","ubyte","linear"),tBlur5:(0,o.$G)("texture","rgba","ubyte","linear"),uTexSizeInv:(0,o.w5)("v2"),uBloomStrength:(0,o.w5)("f"),uBloomRadius:(0,o.w5)("f"),uBloomFactors:(0,o.w5)("f[]"),uBloomTints:(0,o.w5)("v3[]")},A=(0,a.NG)("Bloom Composite",p.e,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform vec2 uTexSizeInv;\n\nuniform sampler2D tBlur1;\nuniform sampler2D tBlur2;\nuniform sampler2D tBlur3;\nuniform sampler2D tBlur4;\nuniform sampler2D tBlur5;\nuniform float uBloomStrength;\nuniform float uBloomRadius;\nuniform float uBloomFactors[5];\nuniform vec3 uBloomTints[5];\n\nfloat lerpBloomFactor(const in float factor) {\n    float mirrorFactor = 1.2 - factor;\n    return mix(factor, mirrorFactor, uBloomRadius);\n}\n\nvoid main(void) {\n    vec2 coords = gl_FragCoord.xy * uTexSizeInv;\n\n    gl_FragColor = uBloomStrength * (\n        lerpBloomFactor(uBloomFactors[0]) * vec4(uBloomTints[0], 1.0) * texture2D(tBlur1, coords) +\n        lerpBloomFactor(uBloomFactors[1]) * vec4(uBloomTints[1], 1.0) * texture2D(tBlur2, coords) +\n        lerpBloomFactor(uBloomFactors[2]) * vec4(uBloomTints[2], 1.0) * texture2D(tBlur3, coords) +\n        lerpBloomFactor(uBloomFactors[3]) * vec4(uBloomTints[3], 1.0) * texture2D(tBlur4, coords) +\n        lerpBloomFactor(uBloomFactors[4]) * vec4(uBloomTints[4], 1.0) * texture2D(tBlur5, coords)\n    );\n}\n")},38981(e,t,n){"use strict"
n.d(t,{$n:()=>p,K0:()=>h,U2:()=>u,X3:()=>d,Yj:()=>m,eJ:()=>g,ff:()=>f,ks:()=>c,tW:()=>s})
var r=n(28074),i=n(25602),o=n(54749),a=n(41288)
class s extends i.Component{constructor(){super(...arguments),this.state={isExpanded:!!this.props.initialExpanded},this.headerClicked=()=>{this.props.onHeaderClick?this.props.onHeaderClick():this.setState({isExpanded:!this.state.isExpanded})}}render(){let e=this.props.hideOffset?"msp-control-group-children":"msp-control-group-children msp-control-offset"
return this.props.childrenClassName&&(e+=" "+this.props.childrenClassName),(0,r.jsxs)("div",{className:"msp-control-group-wrapper",style:{position:"relative",marginTop:this.props.noTopMargin?0:void 0},children:[(0,r.jsx)("div",{className:"msp-control-group-header",style:{marginLeft:this.props.headerLeftMargin},title:this.props.title,children:(0,r.jsxs)(p,{onClick:this.headerClicked,children:[!this.props.hideExpander&&(0,r.jsx)(a.In,{svg:this.state.isExpanded?a.Cp:a.DM}),this.props.topRightIcon&&(0,r.jsx)(a.In,{svg:this.props.topRightIcon,style:{position:"absolute",right:"2px",top:0}}),(0,r.jsx)("b",{children:this.props.header})]})}),this.state.isExpanded&&(0,r.jsx)("div",{className:e,style:{display:this.state.isExpanded?"block":"none",maxHeight:this.props.maxHeight,overflow:"hidden",overflowY:"auto"},children:this.props.children})]})}}function l(e){return e}class c extends i.PureComponent{constructor(){super(...arguments),this.input=i.createRef(),this.delayHandle=void 0,this.pendingValue=void 0,this.state={originalValue:"",value:""},this.onBlur=()=>{this.setState({value:""+this.state.originalValue}),this.props.onBlur&&this.props.onBlur()},this.raiseOnChange=()=>{void 0!==this.pendingValue&&(this.props.onChange(this.pendingValue),this.pendingValue=void 0)},this.onChange=e=>{const t=e.target.value
if(this.props.isValid&&!this.props.isValid(t)||this.props.numeric&&Number.isNaN(+t))return this.clearTimeout(),void this.setState({value:t})
if(this.props.numeric)this.setState({value:t},()=>this.triggerChanged(t,+t))
else{const e=(this.props.toValue||l)(t),n=(this.props.fromValue||l)(e)
this.setState({value:n},()=>this.triggerChanged(n,e))}},this.onKeyUp=e=>{27!==e.charCode&&27!==e.keyCode&&"Escape"!==e.key||this.props.blurOnEscape&&this.input.current&&this.input.current.blur()},this.onKeyPress=e=>{13!==e.keyCode&&13!==e.charCode&&"Enter"!==e.key||(this.isPending&&(this.clearTimeout(),this.raiseOnChange()),this.props.blurOnEnter&&this.input.current&&this.input.current.blur(),this.props.onEnter&&this.props.onEnter()),e.stopPropagation()}}get isPending(){return void 0!==this.delayHandle}clearTimeout(){this.isPending&&(clearTimeout(this.delayHandle),this.delayHandle=void 0)}triggerChanged(e,t){this.clearTimeout(),e!==this.state.originalValue&&(this.props.delayMs?(this.pendingValue=t,this.delayHandle=setTimeout(this.raiseOnChange,this.props.delayMs)):this.props.onChange(t))}static getDerivedStateFromProps(e,t){const n=e.fromValue?e.fromValue(e.value):e.value
return n===t.originalValue?null:{originalValue:n,value:n}}render(){return(0,r.jsx)("input",{type:"text",className:this.props.className,style:this.props.style,ref:this.input,onBlur:this.onBlur,value:this.state.value,placeholder:this.props.placeholder,onChange:this.onChange,onKeyPress:this.props.onEnter||this.props.blurOnEnter||this.props.blurOnEscape?this.onKeyPress:void 0,onKeyDown:this.props.blurOnEscape?this.onKeyUp:void 0,disabled:!!this.props.isDisabled})}}class u extends i.Component{constructor(){super(...arguments),this.state={isExpanded:!1},this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded})}render(){const{label:e,pivot:t,controls:n}=this.props
return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(g,{label:(0,r.jsxs)(r.Fragment,{children:[e,(0,r.jsx)("button",{className:"msp-btn-link msp-btn-icon msp-control-group-expander",onClick:this.toggleExpanded,title:(this.state.isExpanded?"Less":"More")+" options",style:{background:"transparent",textAlign:"left",padding:"0"},children:(0,r.jsx)(a.In,{svg:this.state.isExpanded?a.$j:a.CR,style:{display:"inline-block"}})})]}),control:t,children:this.props.colorStripe&&(0,r.jsx)("div",{className:"msp-expandable-group-color-stripe",style:{backgroundColor:o.Color.toStyle(this.props.colorStripe)}})}),this.state.isExpanded&&(0,r.jsx)("div",{className:"msp-control-offset",children:n})]})}}function d(e){return(0,r.jsxs)("div",{className:"msp-section-header"+(e.accent?" msp-transform-header-brand-"+e.accent:""),children:[e.icon&&(0,r.jsx)(a.In,{svg:e.icon}),e.title," ",(0,r.jsx)("small",{children:e.desc})]})}function p(e){let t,n="msp-btn"
return e.inline||(n+=" msp-btn-block"),e.noOverflow&&(n+=" msp-no-overflow"),e.flex&&(n+=" msp-flex-item"),("on"===e.commit||e.commit)&&(n+=" msp-btn-commit msp-btn-commit-on"),"off"===e.commit&&(n+=" msp-btn-commit msp-btn-commit-off"),e.children||(n+=" msp-btn-childless"),e.className&&(n+=" "+e.className),e.flex&&("number"==typeof e.flex?t={flex:`0 0 ${e.flex}px`,padding:0,maxWidth:`${e.flex}px`}:"string"==typeof e.flex&&(t={flex:`0 0 ${e.flex}`,padding:0,maxWidth:e.flex})),e.style&&(t?Object.assign(t,e.style):t=e.style),(0,r.jsxs)("button",{onClick:e.onClick,title:e.title,disabled:e.disabled,style:t,className:n,"data-id":e["data-id"],"data-color":e["data-color"],onContextMenu:e.onContextMenu,onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave,children:[e.icon&&(0,r.jsx)(a.In,{svg:e.icon}),e.children]})}function h(e){let t,n=`msp-btn msp-btn-icon${e.small?"-small":""}${e.className?" "+e.className:""}`
return void 0!==e.toggleState&&(n+=" msp-btn-link-toggle-"+(e.toggleState?"on":"off")),e.transparent&&(n+=" msp-transparent-bg"),e.flex&&(t="boolean"==typeof e.flex?{flex:"0 0 32px",padding:0}:"number"==typeof e.flex?{flex:`0 0 ${e.flex}px`,padding:0,maxWidth:`${e.flex}px`}:{flex:`0 0 ${e.flex}`,padding:0,maxWidth:e.flex}),e.style&&(t?Object.assign(t,e.style):t=e.style),(0,r.jsxs)("button",{className:n,onClick:e.onClick,title:e.title,disabled:e.disabled,"data-id":e["data-id"],style:t,children:[e.svg&&(0,r.jsx)(a.In,{svg:e.svg}),e.extraContent]})}class f extends i.PureComponent{constructor(){super(...arguments),this.onClick=e=>{e.currentTarget.blur(),this.props.toggle()}}render(){const e=this.props,t=e.label,n=e.isSelected?`${e.className||""} msp-control-current`:e.className
return(0,r.jsx)(p,{icon:this.props.icon,onClick:this.onClick,title:this.props.title,inline:this.props.inline,disabled:e.disabled,style:e.style,className:n,children:t&&this.props.isSelected?(0,r.jsx)("b",{children:t}):t})}}class m extends i.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!!this.props.initiallyExpanded},this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded})}render(){return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"msp-control-group-header",style:{marginTop:void 0!==this.props.marginTop?this.props.marginTop:"1px",marginLeft:this.props.headerLeftMargin},children:(0,r.jsxs)("button",{className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleExpanded,style:this.props.headerStyle,children:[(0,r.jsx)(a.In,{svg:this.state.isExpanded?a.DM:a.Cp}),this.props.header]})}),this.state.isExpanded&&(this.props.noOffset?this.props.children:(0,r.jsx)("div",{className:this.props.accent?"msp-accent-offset":"msp-control-offset",children:this.props.children}))]})}}function g(e){let t="msp-control-row"
return e.className&&(t+=" "+e.className),(0,r.jsxs)("div",{className:t,children:[(0,r.jsx)("span",{className:"msp-control-row-label",title:e.title,children:e.label}),(0,r.jsx)("div",{className:"msp-control-row-ctrl",children:e.control}),e.children]})}},39043(e,t,n){"use strict"
n.d(t,{I:()=>m,a:()=>C,c:()=>x,d:()=>p,e:()=>b,f:()=>d,g:()=>f,s:()=>h,u:()=>S})
var r=n(38382),i=n(41113)
function o(e,t){return e.get(a(e,t))}function a(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n
throw new TypeError("Private element is not present on this object")}function s(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e
var t=e[Symbol.toPrimitive]
if(void 0!==t){var n=t.call(e,"string")
if("object"!=typeof n)return n
throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e)
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}new Map([["duplex",["half"]],["records","array"],["data","json"],["body",{type:"string",klass:["Blob","ArrayBuffer","TypedArray","DataView","FormData","URLSearchParams","ReadableStream"]}],["disableTestWaiter","boolean"],["options","object"],["cacheOptions","object"],["op","string"],["store","object"],["url","string"],["cache",["default","force-cache","no-cache","no-store","only-if-cached","reload"]],["credentials",["include","omit","same-origin"]],["destination",["","object","audio","audioworklet","document","embed","font","frame","iframe","image","manifest","paintworklet","report","script","sharedworker","style","track","video","worker","xslt"]],["headers","headers"],["integrity","string"],["keepalive","boolean"],["method",["QUERY","GET","PUT","PATCH","DELETE","POST","OPTIONS","HEAD","CONNECT","TRACE"]],["mode",["same-origin","cors","navigate","no-cors"]],["redirect",["error","follow","manual"]],["referrer","string"],["signal","AbortSignal"],["controller","AbortController"],["referrerPolicy",["","same-origin","no-referrer","no-referrer-when-downgrade","origin","origin-when-cross-origin","strict-origin","strict-origin-when-cross-origin","unsafe-url"]]]),(0,i.L1)("IS_FROZEN",Symbol("FROZEN")),(0,i.L1)("IS_COLLECTION",Symbol.for("Collection")),new Set([])
const l=(0,i.vs)("PromiseCache",new WeakMap),c=(0,i.vs)("RequestMap",new Map)
function u(e,t){c.set(e,t)}function d(e){c.delete(e)}function p(e){return c.get(e)}function h(e,t){l.set(e,t)}function f(e){return l.get(e)}const m=(0,i.L1)("IS_CACHE_HANDLER",Symbol("IS_CACHE_HANDLER"))
function g(e){return e&&!0===e[r.k0]}function y(e,t,n){return g(t)?t:n?{[r.k0]:!0,request:e.request,response:e.getResponse(),error:t}:{[r.k0]:!0,request:e.request,response:e.getResponse(),content:t}}function v(e){return new DOMException(e||"The user aborted a request.","AbortError")}function b(e,t,n,i){const o=new w(t,i,0===n),a=(s=e[n],0===n&&Boolean(s[m]))
var s
const l=new A(o,a)
let c
try{c=e[n].request(l,function(t){return o.nextCalled++,b(e,t,n+1,i)}),a&&l._finalize(),c&&a&&(c instanceof Promise||(u(o.requestId,{isError:!1,result:y(o,c,!1)}),c=Promise.resolve(c)))}catch(e){a&&u(o.requestId,{isError:!0,result:y(o,e,!0)}),c=Promise.reject(e)}const d=function(e){const t=x()
let n,{promise:i}=t
return i=i.finally(()=>{e.resolveStream(),n&&n.forEach(e=>e())}),i.onFinalize=e=>{n=n||[],n.push(e)},i[r.J6]=!0,i.getStream=()=>e.getStream(),i.abort=t=>{e.abort(v(t))},i.id=e.requestId,i.lid=e.god.identifier,t.promise=i,t}(o)
return p=c,Boolean(p&&p instanceof Promise&&!0===p[r.J6])?function(e,t,n){return e.setStream(t.getStream()),t.then(t=>{const i={[r.k0]:!0,request:e.request,response:t.response,content:t.content}
n.resolve(i)},t=>{if(g(t)&&e.setStream(e.god.stream),!(t&&t instanceof Error))try{throw new Error(t||"Request Rejected with an Unknown Error")}catch(e){t&&"object"==typeof t&&(Object.assign(e,t),e.message=t.message||"Request Rejected with an Unknown Error"),t=e}t[r.k0]=!0,t.request=e.request,t.response=e.getResponse(),t.error=t.error||t.message,n.reject(t)}),n.promise}(o,c,d):function(e,t,n){return t.then(t=>{if(e.controller.signal.aborted)return void n.reject(v(e.controller.signal.reason))
g(t)&&(e.setStream(e.god.stream),t=t.content)
const i={[r.k0]:!0,request:e.request,response:e.getResponse(),content:t}
n.resolve(i)},t=>{if(g(t)&&e.setStream(e.god.stream),!(t&&t instanceof Error))try{throw new Error(t||"Request Rejected with an Unknown Error")}catch(e){t&&"object"==typeof t&&(Object.assign(e,t),e.message=t.message||"Request Rejected with an Unknown Error"),t=e}t[r.k0]=!0,t.request=e.request,t.response=e.getResponse(),t.error=t.error||t.message,n.reject(t)}),n.promise}(o,c,d)
var p}function x(){let e,t
const n=new Promise((n,r)=>{e=n,t=r})
return{resolve:e,reject:t,promise:n}}function S(e,t){return e[r.J6]=!0,e.getStream=t.getStream,e.abort=t.abort,e.onFinalize=t.onFinalize,e.id=t.id,e.lid=t.lid,e}function _(e){return e.clone=()=>new Headers(e),e.toJSON=()=>Array.from(e),e}function C(e){const{headers:t,ok:n,redirected:r,status:i,statusText:o,type:a,url:s}=e
return _(t),{headers:t,ok:n,redirected:r,status:i,statusText:o,type:a,url:s}}class w{constructor(e,t,n=!1){s(this,"hasSetStream",!1),s(this,"hasSetResponse",!1),s(this,"hasSubscribers",!1),s(this,"stream",x()),s(this,"response",null),s(this,"nextCalled",0),this.isRoot=n,this.requestId=t.id,this.controller=e.controller||t.controller,this.stream.promise.sizeHint=0,e.controller&&(e.controller!==t.controller&&t.controller.signal.addEventListener("abort",()=>{this.controller.abort(t.controller.signal.reason)}),delete e.controller)
let r=Object.assign({signal:this.controller.signal},e)
e.headers&&_(e.headers),this.enhancedRequest=r,this.request=e,this.god=t,this.stream.promise=this.stream.promise.then(e=>(this.god.stream===e&&this.hasSubscribers&&(this.god.stream=null),e))}get hasRequestedStream(){return this.god.hasRequestedStream}getResponse(){return this.hasSetResponse?this.response:1===this.nextCalled?this.god.response:null}getStream(){if(this.isRoot&&(this.god.hasRequestedStream=!0),!this.hasSetResponse){const e=this.god.response?.headers?.get("content-length")
this.stream.promise.sizeHint=e?parseInt(e,10):0}return this.hasSubscribers=!0,this.stream.promise}abort(e){this.controller.abort(e)}setStream(e){this.hasSetStream||(this.hasSetStream=!0,e instanceof Promise||(this.god.stream=e),this.stream.resolve(e))}resolveStream(){this.setStream(1===this.nextCalled?this.god.stream:null)}setResponse(e){if(!this.hasSetResponse)if(this.hasSetResponse=!0,e instanceof Response){let t=C(e)
this.response=t,this.god.response=t
const n=e.headers?.get("content-length")
this.stream.promise.sizeHint=n?parseInt(n,10):0}else this.response=e,this.god.response=e}}var T=new WeakMap
class A{constructor(e,t){var n,r;(function(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,void 0)})(this,T),this.id=e.requestId,r=e,(n=T).set(a(n,this),r),this.request=e.enhancedRequest,this._isCacheHandler=t,this._finalized=!1}setStream(e){o(T,this).setStream(e)}setResponse(e){o(T,this).setResponse(e)}setIdentifier(e){o(T,this).god.identifier=e}get hasRequestedStream(){return o(T,this).hasRequestedStream}_finalize(){this._finalized=!0}}},39250(e,t,n){"use strict"
n.d(t,{$:()=>s})
var r=n(23325),i=n(37411),o=n(6539),a=n(87423)
function s(){return s.zero()}!function(e){function t(){const e=[.1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
return e[0]=0,e}function n(){const e=t()
return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function s(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function l(e){for(let t=0;t<16;t++)e[t]=0
return e}e.zero=t,e.identity=n,e.setIdentity=s,e.isZero=function(e){for(let t=0;t<16;t++)if(0!==e[t])return!1
return!0},e.setZero=l,e.ofRows=function(e){const n=t()
for(let t=0;t<4;t++){const r=e[t]
for(let e=0;e<4;e++)n[4*e+t]=r[e]}return n}
const c=n()
function u(e,t,n){for(let r=0;r<16;r++)if(Math.abs(e[r]-t[r])>n)return!1
return!0}function d(e,t,n,r){e[4*n+t]=r}function p(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function h(e,t){const n=t[0]+t[5]+t[10]
let r=0
return n>0?(r=2*Math.sqrt(n+1),e[3]=.25*r,e[0]=(t[6]-t[9])/r,e[1]=(t[8]-t[2])/r,e[2]=(t[1]-t[4])/r):t[0]>t[5]&&t[0]>t[10]?(r=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/r,e[0]=.25*r,e[1]=(t[1]+t[4])/r,e[2]=(t[8]+t[2])/r):t[5]>t[10]?(r=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/r,e[0]=(t[1]+t[4])/r,e[1]=.25*r,e[2]=(t[6]+t[9])/r):(r=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/r,e[0]=(t[8]+t[2])/r,e[1]=(t[6]+t[9])/r,e[2]=.25*r),e}function f(e,t){const n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8],d=t[9],p=t[10],h=t[11],f=t[12],m=t[13],g=t[14],y=t[15],v=n*s-r*a,b=n*l-i*a,x=n*c-o*a,S=r*l-i*s,_=r*c-o*s,C=i*c-o*l,w=u*m-d*f,T=u*g-p*f,A=u*y-h*f,I=d*g-p*m,P=d*y-h*m,B=p*y-h*g
let E=v*B-b*P+x*I+S*A-_*T+C*w
return!!E&&(E=1/E,e[0]=(s*B-l*P+c*I)*E,e[1]=(i*P-r*B-o*I)*E,e[2]=(m*C-g*_+y*S)*E,e[3]=(p*_-d*C-h*S)*E,e[4]=(l*A-a*B-c*T)*E,e[5]=(n*B-i*A+o*T)*E,e[6]=(g*x-f*C-y*b)*E,e[7]=(u*C-p*x+h*b)*E,e[8]=(a*P-s*A+c*w)*E,e[9]=(r*A-n*P-o*w)*E,e[10]=(f*_-m*x+y*v)*E,e[11]=(d*x-u*_-h*v)*E,e[12]=(s*T-a*I-l*w)*E,e[13]=(n*I-r*T+i*w)*E,e[14]=(m*b-f*S-g*v)*E,e[15]=(u*S-d*b+p*v)*E,!0)}function m(e,t,n){const r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],d=t[8],p=t[9],h=t[10],f=t[11],m=t[12],g=t[13],y=t[14],v=t[15]
let b=n[0],x=n[1],S=n[2],_=n[3]
return e[0]=b*r+x*s+S*d+_*m,e[1]=b*i+x*l+S*p+_*g,e[2]=b*o+x*c+S*h+_*y,e[3]=b*a+x*u+S*f+_*v,b=n[4],x=n[5],S=n[6],_=n[7],e[4]=b*r+x*s+S*d+_*m,e[5]=b*i+x*l+S*p+_*g,e[6]=b*o+x*c+S*h+_*y,e[7]=b*a+x*u+S*f+_*v,b=n[8],x=n[9],S=n[10],_=n[11],e[8]=b*r+x*s+S*d+_*m,e[9]=b*i+x*l+S*p+_*g,e[10]=b*o+x*c+S*h+_*y,e[11]=b*a+x*u+S*f+_*v,b=n[12],x=n[13],S=n[14],_=n[15],e[12]=b*r+x*s+S*d+_*m,e[13]=b*i+x*l+S*p+_*g,e[14]=b*o+x*c+S*h+_*y,e[15]=b*a+x*u+S*f+_*v,e}function g(e,t,n,r){return e[0]=n[0],e[4]=n[1],e[8]=n[2],e[1]=r[0],e[5]=r[1],e[9]=r[2],e[2]=t[0],e[6]=t[1],e[10]=t[2],e}function y(e,t,n){let i=n[0],o=n[1],a=n[2],l=Math.sqrt(i*i+o*o+a*a)
if(Math.abs(l)<r.p)return s(e)
l=1/l,i*=l,o*=l,a*=l
const c=Math.sin(t),u=Math.cos(t),d=1-u
return e[0]=i*i*d+u,e[1]=o*i*d+a*c,e[2]=a*i*d-o*c,e[3]=0,e[4]=i*o*d-a*c,e[5]=o*o*d+u,e[6]=a*o*d+i*c,e[7]=0,e[8]=i*a*d+o*c,e[9]=o*a*d-i*c,e[10]=a*a*d+u,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}e.isIdentity=function(e,t){return u(e,c,void 0===t?r.p:t)},e.hasNaN=function(e){for(let t=0;t<16;t++)if(Number.isNaN(e[t]))return!0
return!1},e.areEqual=u,e.setValue=d,e.getValue=function(e,t,n){return e[4*n+t]},e.toArray=function(e,t,n){return t[n+0]=e[0],t[n+1]=e[1],t[n+2]=e[2],t[n+3]=e[3],t[n+4]=e[4],t[n+5]=e[5],t[n+6]=e[6],t[n+7]=e[7],t[n+8]=e[8],t[n+9]=e[9],t[n+10]=e[10],t[n+11]=e[11],t[n+12]=e[12],t[n+13]=e[13],t[n+14]=e[14],t[n+15]=e[15],t},e.fromArray=function(e,t,n){return e[0]=t[n+0],e[1]=t[n+1],e[2]=t[n+2],e[3]=t[n+3],e[4]=t[n+4],e[5]=t[n+5],e[6]=t[n+6],e[7]=t[n+7],e[8]=t[n+8],e[9]=t[n+9],e[10]=t[n+10],e[11]=t[n+11],e[12]=t[n+12],e[13]=t[n+13],e[14]=t[n+14],e[15]=t[n+15],e},e.fromBasis=function(e,t,n,r){return l(e),d(e,0,0,t[0]),d(e,1,0,t[1]),d(e,2,0,t[2]),d(e,0,1,n[0]),d(e,1,1,n[1]),d(e,2,1,n[2]),d(e,0,2,r[0]),d(e,1,2,r[1]),d(e,2,2,r[2]),d(e,3,3,1),e},e.copy=p,e.clone=function(e){return p(t(),e)},e.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},e.getScaling=function(e,t){const n=t[0],r=t[1],i=t[2],o=t[4],a=t[5],s=t[6],l=t[8],c=t[9],u=t[10]
return e[0]=Math.sqrt(n*n+r*r+i*i),e[1]=Math.sqrt(o*o+a*a+s*s),e[2]=Math.sqrt(l*l+c*c+u*u),e},e.getRotation=h,e.extractRotation=function(e,t){const n=1/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),r=1/Math.sqrt(t[4]*t[4]+t[5]*t[5]+t[6]*t[6]),i=1/Math.sqrt(t[8]*t[8]+t[9]*t[9]+t[10]*t[10])
return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=0,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=0,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.transpose=function(e,t){if(e===t){const n=t[1],r=t[2],i=t[3],o=t[6],a=t[7],s=t[11]
e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=o,e[11]=t[14],e[12]=i,e[13]=a,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15]
return e},e.tryInvert=f,e.invert=function(e,t){return f(e,t)||console.warn("non-invertible matrix.",t),e},e.mul=m,e.mulOffset=function(e,t,n,r,i,o){const a=t[0+i],s=t[1+i],l=t[2+i],c=t[3+i],u=t[4+i],d=t[5+i],p=t[6+i],h=t[7+i],f=t[8+i],m=t[9+i],g=t[10+i],y=t[11+i],v=t[12+i],b=t[13+i],x=t[14+i],S=t[15+i]
let _=n[0+o],C=n[1+o],w=n[2+o],T=n[3+o]
return e[0+r]=_*a+C*u+w*f+T*v,e[1+r]=_*s+C*d+w*m+T*b,e[2+r]=_*l+C*p+w*g+T*x,e[3+r]=_*c+C*h+w*y+T*S,_=n[4+o],C=n[5+o],w=n[6+o],T=n[7+o],e[4+r]=_*a+C*u+w*f+T*v,e[5+r]=_*s+C*d+w*m+T*b,e[6+r]=_*l+C*p+w*g+T*x,e[7+r]=_*c+C*h+w*y+T*S,_=n[8+o],C=n[9+o],w=n[10+o],T=n[11+o],e[8+r]=_*a+C*u+w*f+T*v,e[9+r]=_*s+C*d+w*m+T*b,e[10+r]=_*l+C*p+w*g+T*x,e[11+r]=_*c+C*h+w*y+T*S,_=n[12+o],C=n[13+o],w=n[14+o],T=n[15+o],e[12+r]=_*a+C*u+w*f+T*v,e[13+r]=_*s+C*d+w*m+T*b,e[14+r]=_*l+C*p+w*g+T*x,e[15+r]=_*c+C*h+w*y+T*S,e},e.mul3=function(e,t,n,r){return m(e,m(e,t,n),r)},e.translate=function(e,t,n){const r=n[0],i=n[1],o=n[2]
let a,s,l,c,u,d,p,h,f,m,g,y
return t===e?(e[12]=t[0]*r+t[4]*i+t[8]*o+t[12],e[13]=t[1]*r+t[5]*i+t[9]*o+t[13],e[14]=t[2]*r+t[6]*i+t[10]*o+t[14],e[15]=t[3]*r+t[7]*i+t[11]*o+t[15]):(a=t[0],s=t[1],l=t[2],c=t[3],u=t[4],d=t[5],p=t[6],h=t[7],f=t[8],m=t[9],g=t[10],y=t[11],e[0]=a,e[1]=s,e[2]=l,e[3]=c,e[4]=u,e[5]=d,e[6]=p,e[7]=h,e[8]=f,e[9]=m,e[10]=g,e[11]=y,e[12]=a*r+u*i+f*o+t[12],e[13]=s*r+d*i+m*o+t[13],e[14]=l*r+p*i+g*o+t[14],e[15]=c*r+h*i+y*o+t[15]),e},e.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},e.setTranslation=function(e,t){return e[12]=t[0],e[13]=t[1],e[14]=t[2],e},e.setAxes=g,e.rotate=function(e,t,i,o){let a=o[0],s=o[1],l=o[2],c=Math.sqrt(a*a+s*s+l*l)
if(Math.abs(c)<r.p)return n()
c=1/c,a*=c,s*=c,l*=c
const u=Math.sin(i),d=Math.cos(i),p=1-d,h=t[0],f=t[1],m=t[2],g=t[3],y=t[4],v=t[5],b=t[6],x=t[7],S=t[8],_=t[9],C=t[10],w=t[11],T=a*a*p+d,A=s*a*p+l*u,I=l*a*p-s*u,P=a*s*p-l*u,B=s*s*p+d,E=l*s*p+a*u,k=a*l*p+s*u,D=s*l*p-a*u,M=l*l*p+d
return e[0]=h*T+y*A+S*I,e[1]=f*T+v*A+_*I,e[2]=m*T+b*A+C*I,e[3]=g*T+x*A+w*I,e[4]=h*P+y*B+S*E,e[5]=f*P+v*B+_*E,e[6]=m*P+b*B+C*E,e[7]=g*P+x*B+w*E,e[8]=h*k+y*D+S*M,e[9]=f*k+v*D+_*M,e[10]=m*k+b*D+C*M,e[11]=g*k+x*D+w*M,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e},e.fromRotation=y,e.scale=function(e,t,n){const r=n[0],i=n[1],o=n[2]
return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.scaleUniformly=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.fromUniformScaling=function(e,t){return e[0]=t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}
const v=[0,0,0],b=[0,0,0]
e.fromPlane=function(e,t,n){const o=i.e.cross(v,t,i.e.unitX)
i.e.dot(o,o)<r.p&&i.e.cross(o,t,i.e.unitY),i.e.normalize(o,o)
const a=i.e.cross(b,t,o)
return i.e.normalize(a,a),g(e,t,o,a),e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},e.fromMat3=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[4]=t[3],e[5]=t[4],e[6]=t[5],e[8]=t[6],e[9]=t[7],e[10]=t[8],e},e.compose=function(e,t,n,r){const[i,o,a,s]=n,l=i+i,c=o+o,u=a+a,d=i*l,p=i*c,h=i*u,f=o*c,m=o*u,g=a*u,y=s*l,v=s*c,b=s*u,[x,S,_]=r
return e[0]=(1-(f+g))*x,e[1]=(p+b)*x,e[2]=(h-v)*x,e[3]=0,e[4]=(p-b)*S,e[5]=(1-(d+g))*S,e[6]=(m+y)*S,e[7]=0,e[8]=(h+v)*_,e[9]=(m-y)*_,e[10]=(1-(d+f))*_,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}
const x=[0,0,0],S=t()
function _(e,t,n,r){let o=i.e.magnitude(i.e.set(x,e[0],e[1],e[2]))
const a=i.e.magnitude(i.e.set(x,e[4],e[5],e[6])),s=i.e.magnitude(i.e.set(x,e[8],e[9],e[10]))
C(e)<0&&(o=-o),t[0]=e[12],t[1]=e[13],t[2]=e[14],p(S,e)
const l=1/o,c=1/a,u=1/s
return S[0]*=l,S[1]*=l,S[2]*=l,S[4]*=c,S[5]*=c,S[6]*=c,S[8]*=u,S[9]*=u,S[10]*=u,h(n,S),r[0]=o,r[1]=a,r[2]=s,e}function C(e){const t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8],u=e[9],d=e[10],p=e[11],h=e[12],f=e[13],m=e[14],g=e[15]
return(t*a-n*o)*(d*g-p*m)-(t*s-r*o)*(u*g-p*f)+(t*l-i*o)*(u*m-d*f)+(n*s-r*a)*(c*g-p*h)-(n*l-i*a)*(c*m-d*h)+(r*l-i*s)*(c*f-u*h)}e.decompose=_,e.getDecomposition=function(e){const t=(0,i.e)(),n=(0,o.k)(),r=(0,i.e)()
return _(e,t,n,r),{position:t,quaternion:n,scale:r}},e.makeTable=function(e){let t=""
for(let n=0;n<4;n++){for(let r=0;r<4;r++)t+=e[4*r+n].toString(),r<3&&(t+=" ")
n<3&&(t+="\n")}return t},e.determinant=C,e.isRotationAndTranslation=function(e,t){return function(e,t){const n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=e[6],u=e[7],d=e[8],p=e[9],h=e[10],f=e[11],m=e[15]
if(!((0,r.T)(m,1,t)&&(0,r.T)(a,0,t)&&(0,r.T)(u,0,t)&&(0,r.T)(f,0,t)))return!1
const g=Math.abs(n*(l*h-c*p)-i*(s*h-c*d)+o*(s*p-l*d))
return!!(0,r.T)(g,1,t)}(e,void 0!==t?t:r.p)},e.isTranslationAndUniformScaling=function(e,t){return function(e,t){const n=e[0]
return(0,r.T)(e[1],0,t)&&(0,r.T)(e[2],0,t)&&(0,r.T)(e[3],0,t)&&(0,r.T)(e[4],0,t)&&(0,r.T)(e[5],n,t)&&(0,r.T)(e[6],0,t)&&(0,r.T)(e[7],0,t)&&(0,r.T)(e[8],0,t)&&(0,r.T)(e[9],0,t)&&(0,r.T)(e[10],n,t)&&(0,r.T)(e[11],0,t)&&(0,r.T)(e[15],1,t)}(e,void 0!==t?t:r.p)},e.fromQuat=function(e,t){const n=t[0],r=t[1],i=t[2],o=t[3],a=n+n,s=r+r,l=i+i,c=n*a,u=r*a,d=r*s,p=i*a,h=i*s,f=i*l,m=o*a,g=o*s,y=o*l
return e[0]=1-d-f,e[1]=u+y,e[2]=p-g,e[3]=0,e[4]=u-y,e[5]=1-c-f,e[6]=h+m,e[7]=0,e[8]=p+g,e[9]=h-m,e[10]=1-c-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.fromEuler=function(e,t,n){const r=t[0],i=t[1],o=t[2],a=Math.cos(r),s=Math.sin(r),l=Math.cos(i),c=Math.sin(i),u=Math.cos(o),d=Math.sin(o)
if("XYZ"===n){const t=a*u,n=a*d,r=s*u,i=s*d
e[0]=l*u,e[4]=-l*d,e[8]=c,e[1]=n+r*c,e[5]=t-i*c,e[9]=-s*l,e[2]=i-t*c,e[6]=r+n*c,e[10]=a*l}else if("YXZ"===n){const t=l*u,n=l*d,r=c*u,i=c*d
e[0]=t+i*s,e[4]=r*s-n,e[8]=a*c,e[1]=a*d,e[5]=a*u,e[9]=-s,e[2]=n*s-r,e[6]=i+t*s,e[10]=a*l}else if("ZXY"===n){const t=l*u,n=l*d,r=c*u,i=c*d
e[0]=t-i*s,e[4]=-a*d,e[8]=r+n*s,e[1]=n+r*s,e[5]=a*u,e[9]=i-t*s,e[2]=-a*c,e[6]=s,e[10]=a*l}else if("ZYX"===n){const t=a*u,n=a*d,r=s*u,i=s*d
e[0]=l*u,e[4]=r*c-n,e[8]=t*c+i,e[1]=l*d,e[5]=i*c+t,e[9]=n*c-r,e[2]=-c,e[6]=s*l,e[10]=a*l}else if("YZX"===n){const t=a*l,n=a*c,r=s*l,i=s*c
e[0]=l*u,e[4]=i-t*d,e[8]=r*d+n,e[1]=d,e[5]=a*u,e[9]=-s*u,e[2]=-c*u,e[6]=n*d+r,e[10]=t-i*d}else if("XZY"===n){const t=a*l,n=a*c,r=s*l,i=s*c
e[0]=l*u,e[4]=-d,e[8]=c*u,e[1]=t*d+i,e[5]=a*u,e[9]=n*d-r,e[2]=r*d-n,e[6]=s*u,e[10]=i*d+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.perspective=function(e,t,n,r,i,o,a){const s=2*o/(n-t),l=2*o/(r-i),c=(n+t)/(n-t),u=(r+i)/(r-i),d=-(a+o)/(a-o),p=-2*a*o/(a-o)
return e[0]=s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=c,e[9]=u,e[10]=d,e[11]=-1,e[12]=0,e[13]=0,e[14]=p,e[15]=0,e},e.ortho=function(e,t,n,r,i,o,a){const s=1/(n-t),l=1/(r-i),c=1/(a-o),u=(n+t)*s,d=(r+i)*l,p=(a+o)*c
return e[0]=2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=-2*c,e[11]=0,e[12]=-u,e[13]=-d,e[14]=-p,e[15]=1,e},e.lookAt=function(e,t,n,i){let o,a,l,c,u,d,p,h,f,m
const g=t[0],y=t[1],v=t[2],b=i[0],x=i[1],S=i[2],_=n[0],C=n[1],w=n[2]
return Math.abs(g-_)<r.p&&Math.abs(y-C)<r.p&&Math.abs(v-w)<r.p?s(e):(p=g-_,h=y-C,f=v-w,m=1/Math.sqrt(p*p+h*h+f*f),p*=m,h*=m,f*=m,o=x*f-S*h,a=S*p-b*f,l=b*h-x*p,m=Math.sqrt(o*o+a*a+l*l),m?(m=1/m,o*=m,a*=m,l*=m):(o=0,a=0,l=0),c=h*l-f*a,u=f*o-p*l,d=p*a-h*o,m=Math.sqrt(c*c+u*u+d*d),m?(m=1/m,c*=m,u*=m,d*=m):(c=0,u=0,d=0),e[0]=o,e[1]=c,e[2]=p,e[3]=0,e[4]=a,e[5]=u,e[6]=h,e[7]=0,e[8]=l,e[9]=d,e[10]=f,e[11]=0,e[12]=-(o*g+a*y+l*v),e[13]=-(c*g+u*y+d*v),e[14]=-(p*g+h*y+f*v),e[15]=1,e)},e.targetTo=function(e,t,n,r){const i=t[0],o=t[1],a=t[2],s=r[0],l=r[1],c=r[2]
let u=i-n[0],d=o-n[1],p=a-n[2],h=u*u+d*d+p*p
h>0&&(h=1/Math.sqrt(h),u*=h,d*=h,p*=h)
let f=l*p-c*d,m=c*u-s*p,g=s*d-l*u
return h=f*f+m*m+g*g,h>0&&(h=1/Math.sqrt(h),f*=h,m*=h,g*=h),e[0]=f,e[1]=m,e[2]=g,e[3]=0,e[4]=d*g-p*m,e[5]=p*f-u*g,e[6]=u*m-d*f,e[7]=0,e[8]=u,e[9]=d,e[10]=p,e[11]=0,e[12]=i,e[13]=o,e[14]=a,e[15]=1,e},e.fromPermutation=function(e,t){l(e)
for(let n=0;n<4;n++)d(e,n,t[n],1)
return e},e.getMaxScaleOnAxis=function(e){const t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10]
return Math.sqrt(Math.max(t,n,r))},e.extractBasis=function(e){return{x:i.e.create(e[0],e[1],e[2]),y:i.e.create(e[4],e[5],e[6]),z:i.e.create(e[8],e[9],e[10])}}
const w=[1,0,0],T=[0,1,0],A=[0,0,1]
e.rotX90=y(t(),(0,a.pu)(90),w),e.rotX180=y(t(),(0,a.pu)(180),w),e.rotY90=y(t(),(0,a.pu)(90),T),e.rotY180=y(t(),(0,a.pu)(180),T),e.rotY270=y(t(),(0,a.pu)(270),T),e.rotZ90=y(t(),(0,a.pu)(90),A),e.rotZ180=y(t(),(0,a.pu)(180),A),e.rotXY90=m(t(),e.rotX90,e.rotY90),e.rotZY90=m(t(),e.rotZ90,e.rotY90),e.rotZYZ90=m(t(),e.rotZY90,e.rotZ90),e.rotZ90X180=m(t(),e.rotZ90,e.rotX180),e.rotY90Z180=m(t(),e.rotY90,e.rotZ180),e.id=n()}(s||(s={}))},39298(e,t,n){"use strict"
n.d(t,{H:()=>i,O:()=>r})
var r,i,o=n(43472)
!function(e){function t(t){return e.Create({...t,typeClass:"Representation3D"})}e.Create=o.BM.factory(),e.isRepresentation3D=function(e){return!!e&&"Representation3D"===e.type.typeClass},e.isBehavior=function(e){return!!e&&"Behavior"===e.type.typeClass},e.CreateRepresentation3D=t,e.CreateBehavior=function(t){return e.Create({...t,typeClass:"Behavior"})}
class n extends(e.Create({name:"Root",typeClass:"Root"})){}e.Root=n
class r extends(e.Create({name:"Group",typeClass:"Group"})){}let i,a,s,l,c
e.Group=r,function(t){class n extends(e.Create({name:"String Data",typeClass:"Data"})){}t.String=n
class r extends(e.Create({name:"Binary Data",typeClass:"Data"})){}t.Binary=r
class i extends(e.Create({name:"Data Blob",typeClass:"Data"})){}t.Blob=i}(i=e.Data||(e.Data={})),function(t){class n extends(e.Create({name:"JSON Data",typeClass:"Data"})){}t.Json=n
class r extends(e.Create({name:"CIF File",typeClass:"Data"})){}t.Cif=r
class i extends(e.Create({name:"Cube File",typeClass:"Data"})){}t.Cube=i
class o extends(e.Create({name:"PSF File",typeClass:"Data"})){}t.Psf=o
class a extends(e.Create({name:"PRMTOP File",typeClass:"Data"})){}t.Prmtop=a
class s extends(e.Create({name:"TOP File",typeClass:"Data"})){}t.Top=s
class l extends(e.Create({name:"PLY File",typeClass:"Data"})){}t.Ply=l
class c extends(e.Create({name:"CCP4/MRC/MAP File",typeClass:"Data"})){}t.Ccp4=c
class u extends(e.Create({name:"DSN6/BRIX File",typeClass:"Data"})){}t.Dsn6=u
class d extends(e.Create({name:"DX File",typeClass:"Data"})){}t.Dx=d
class p extends(e.Create({name:"Format Blob",typeClass:"Data"})){}t.Blob=p}(a=e.Format||(e.Format={})),function(n){class r extends(e.Create({name:"Coordinates",typeClass:"Object"})){}n.Coordinates=r
class i extends(e.Create({name:"Topology",typeClass:"Object"})){}n.Topology=i
class o extends(e.Create({name:"Model",typeClass:"Object"})){}n.Model=o
class a extends(e.Create({name:"Trajectory",typeClass:"Object"})){}n.Trajectory=a
class s extends(e.Create({name:"Structure",typeClass:"Object"})){}n.Structure=s,function(n){class r extends(t({name:"Structure 3D"})){}n.Representation3D=r
class i extends(e.Create({name:"Structure 3D State",typeClass:"Object"})){}n.Representation3DState=i
class o extends(e.Create({name:"Selections",typeClass:"Object"})){}n.Selections=o}(s=n.Structure||(n.Structure={}))}(s=e.Molecule||(e.Molecule={})),function(n){class r extends(e.Create({name:"Volume",typeClass:"Object"})){}n.Data=r
class i extends(e.Create({name:"Lazy Volume",typeClass:"Object"})){}n.Lazy=i
class o extends(t({name:"Volume 3D"})){}n.Representation3D=o}(l=e.Volume||(e.Volume={})),function(n){class r extends(e.Create({name:"Shape Provider",typeClass:"Object"})){}n.Provider=r
class i extends(t({name:"Shape 3D"})){}n.Representation3D=i}(c=e.Shape||(e.Shape={}))}(r||(r={})),function(e){e.CreateBuiltIn=o.xE.factory("ms-plugin"),e.BuiltIn=o.xE.builderFactory("ms-plugin")}(i||(i={}))},39376(e,t,n){"use strict"
n.d(t,{P:()=>l})
var r=n(32775),i=n(83794),o=n(10268)
const a=r.$I.identity(),s=(0,r.eB)()
function l(e,t,n,l,c,u){i.P.addPrimitive(e,function(e,t,n,i,o){return r.eB.add(s,t,n),r.$I.targetTo(e,t,s,i),r.$I.setTranslation(e,t),r.$I.scale(e,e,o)}(a,t,n,l,c),(0,o.q)(u))}},39419(e,t,n){"use strict"
n.d(t,{w:()=>r})
var r=new(n(85404).c)(function(e){return e.complete()})},39791(e,t,n){"use strict"
n.d(t,{X:()=>r})
var r,i=n(87095),o=n(29282),a=n(28721),s=n(24762),l=n(92726)
!function(e){e.Descriptor={name:"chem_comp_bond",cifExport:{prefix:"",categories:[{name:"chem_comp_bond",instance(t){const n=e.Provider.get(t.firstModel)
if(!n)return a.c.Category.Empty
const r=n.data
if(!r)return a.c.Category.Empty
const i=t.structures[0].uniqueResidueNames,{comp_id:o,_rowCount:s}=r,l=[]
for(let e=0;e<s;e++)i.has(o.value(e))&&(l[l.length]=e)
return a.c.Category.ofTable(r,l)}}]}},e.Provider=l.q.create(e.Descriptor),e.chemCompBondFromTable=function(e,t){return s.XI.pick(t,o.r.chem_comp_bond,n=>e.properties.chemicalComponentMap.has(t.comp_id.value(n)))},e.getEntriesFromChemCompBond=function(e){const n=new Map
function r(e){if(n.has(e))return n.get(e)
const r=new t(e)
return n.set(e,r),r}const{comp_id:o,atom_id_1:a,atom_id_2:s,value_order:l,pdbx_aromatic_flag:c,_rowCount:u,pdbx_ordinal:d}=e
let p=r(o.value(0))
for(let t=0;t<u;t++){const e=o.value(t),n=a.value(t),u=s.value(t),h=l.value(t),f="y"===c.value(t),m=d.value(t)
p.id!==e&&(p=r(e))
let g=i.BondType.Flag.Covalent,y=1
switch(f&&(g|=i.BondType.Flag.Aromatic),h.toLowerCase()){case"delo":g|=i.BondType.Flag.Aromatic
break
case"doub":y=2
break
case"trip":y=3
break
case"quad":y=4}p.add(n,u,y,g,m)}return n}
class t{add(e,t,n,r,i,o=!0){const a=this.map.get(e)
if(void 0!==a)void 0===a.get(t)&&a.set(t,{order:n,flags:r,key:i})
else{const o=new Map
o.set(t,{order:n,flags:r,key:i}),this.map.set(e,o)}o&&this.add(t,e,n,r,i,!1)}constructor(e){this.id=e,this.map=new Map}}e.Entry=t}(r||(r={}))},40038(e,t,n){"use strict"
n.d(t,{BH:()=>u,HX:()=>p,Ro:()=>d,sY:()=>i,uP:()=>l,xi:()=>r})
var r,i,o=n(88434),a=n(36432),s=n(91229)
function l(e,t,n){e.fill(t,0,n)}function c(e,t,n){switch(n){case r.Highlight:e[t]|=1
break
case r.RemoveHighlight:e[t]&=-2
break
case r.Select:e[t]|=2
break
case r.Deselect:e[t]&=-3
break
case r.Toggle:e[t]^=2
break
case r.Clear:e[t]=0}}function u(e,t,n){if(n===r.None)return!1
if(o.I.is(t)){const i=o.I.start(t),a=o.I.end(t),l=i+3>>2,u=l+(a-4*l>>2)
if(u<=l){for(let t=i;t<a;++t)c(e,t,n)
return!0}const d=new Uint32Array(e.buffer,0,e.buffer.byteLength>>2),p=i,h=Math.min(4*l,a),f=Math.max(i,4*u),m=a
switch(n){case r.Highlight:for(let e=l;e<u;++e)d[e]|=16843009
break
case r.RemoveHighlight:for(let e=l;e<u;++e)d[e]&=-16843010
break
case r.Select:for(let e=l;e<u;++e)d[e]|=33686018
break
case r.Deselect:for(let e=l;e<u;++e)d[e]&=-33686019
break
case r.Toggle:for(let e=l;e<u;++e)d[e]^=33686018
break
case r.Clear:for(let e=l;e<u;++e)d[e]=0
break
default:(0,s.dr)(n)}for(let t=p;t<h;++t)c(e,t,n)
for(let t=f;t<m;++t)c(e,t,n)}else switch(n){case r.Highlight:for(let n=0,r=t.length;n<r;++n)e[t[n]]|=1
break
case r.RemoveHighlight:for(let n=0,r=t.length;n<r;++n)e[t[n]]&=-2
break
case r.Select:for(let n=0,r=t.length;n<r;++n)e[t[n]]|=2
break
case r.Deselect:for(let n=0,r=t.length;n<r;++n)e[t[n]]&=-3
break
case r.Toggle:for(let n=0,r=t.length;n<r;++n)e[t[n]]^=2
break
case r.Clear:for(let n=0,r=t.length;n<r;++n)e[t[n]]=0
break
default:(0,s.dr)(n)}return!0}function d(e,t){let n=-1,i=-1
switch(e){case r.Highlight:0===t||1===t?(n=1,i=1):2===t||3===t?(n=1,i=3):n=1
break
case r.RemoveHighlight:0===t||1===t?(n=0,i=0):2!==t&&3!==t||(n=1,i=2)
break
case r.Select:1===t||3===t?(n=1,i=3):0===t||2===t?(n=1,i=2):n=1
break
case r.Deselect:1===t||3===t?(n=1,i=1):0!==t&&2!==t||(n=0,i=0)
break
case r.Toggle:1===t?(n=1,i=3):2===t?(n=0,i=0):3===t?(n=1,i=1):0===t&&(n=1,i=2)
break
case r.Clear:n=0,i=0}return{average:n,status:i}}function p(e,t){switch(e){case r.Highlight:return.5
case r.RemoveHighlight:return 0===t?0:2===t||3===t?.5:-1
case r.Select:return.5
case r.Deselect:return 1===t||3===t?.5:0===t?0:-1
case r.Toggle:return-1===t?-1:.5
case r.Clear:return-1===t?-1:0===t?0:.5
case r.None:return-1
default:(0,s.dr)(e)}}!function(e){e[e.None=0]="None",e[e.Highlight=1]="Highlight",e[e.RemoveHighlight=2]="RemoveHighlight",e[e.Select=4]="Select",e[e.Deselect=8]="Deselect",e[e.Toggle=16]="Toggle",e[e.Clear=32]="Clear"}(r||(r={})),function(e){e.is=a.N.has,e.All=r.Highlight|r.RemoveHighlight|r.Select|r.Deselect|r.Toggle|r.Clear,e.Highlighting=r.Highlight|r.RemoveHighlight|r.Clear,e.Selecting=r.Select|r.Deselect|r.Toggle|r.Clear,e.isReverse=function(e,t){return e===r.Highlight&&t===r.RemoveHighlight||e===r.RemoveHighlight&&t===r.Highlight||e===r.Select&&t===r.Deselect||e===r.Deselect&&t===r.Select||e===r.Toggle&&t===r.Toggle}}(i||(i={}))},40165(e,t,n){"use strict"
n.d(t,{_2:()=>p,m9:()=>s,nT:()=>c})
var r=n(32775)
const i=(0,r.eB)(),o=(0,r.eB)(),a=(0,r.eB)()
function s(e,t){const n=t.length,s=c(n/3)
for(let l=0;l<n;l+=3)r.eB.fromArray(i,e,3*t[l]),r.eB.fromArray(o,e,3*t[l+1]),r.eB.fromArray(a,e,3*t[l+2]),s.add(i,o,a)
return s.getPrimitive()}const l=(0,r.eB)()
function c(e,t){void 0===t&&(t=3*e)
const n=new Float32Array(3*t),i=new Float32Array(3*t),o=new Uint32Array(3*e)
let a=0,s=0
return{add:(e,t,c)=>{r.eB.toArray(e,n,a),r.eB.toArray(t,n,a+3),r.eB.toArray(c,n,a+6),r.eB.triangleNormal(l,e,t,c)
for(let n=0;n<3;++n)r.eB.toArray(l,i,a+3*n),o[s+n]=a/3+n
a+=9,s+=3},addQuad:(e,t,c,u)=>{r.eB.toArray(e,n,a),r.eB.toArray(t,n,a+3),r.eB.toArray(c,n,a+6),r.eB.toArray(u,n,a+9),r.eB.triangleNormal(l,e,t,c)
for(let n=0;n<4;++n)r.eB.toArray(l,i,a+3*n)
const d=a/3
o[s]=d,o[s+1]=d+1,o[s+2]=d+2,o[s+3]=d+2,o[s+4]=d+3,o[s+5]=d,a+=12,s+=6},getPrimitive:()=>({vertices:n,normals:i,indices:o})}}const u=(0,r.eB)(),d=(0,r.U)()
function p(e,t){const{vertices:n,normals:i}=e,o=r.U.directionTransform(d,t)
for(let a=0,s=n.length;a<s;a+=3)r.eB.transformMat4(u,r.eB.fromArray(u,n,a),t),r.eB.toArray(u,n,a),r.eB.transformMat3(u,r.eB.fromArray(u,i,a),o),r.eB.toArray(u,i,a)
return e}},40253(e,t,n){"use strict"
n.d(t,{AX:()=>u,h2:()=>c})
var r=n(54749),i=n(79111),o=n(92384),a=n(93076)
const s=(0,r.Color)(13421772),l={}
function c(e,t){return{factory:c,granularity:"groupInstance",color:e=>i.$.isLocation(e)?e.shape.getColor(e.group,e.instance):s,props:t,description:"Assigns colors as defined by the shape object."}}const u={name:"shape-group",label:"Shape Group",category:a.N.Misc,factory:c,getParams:function(e){return l},defaultValues:o.t.getDefaultValues(l),isApplicable:e=>!!e.shape}},40362(e,t,n){"use strict"
n.d(t,{E:()=>T})
var r=n(70012),i=n(81871),o=n(31727),a=n(31683),s=n(14294),l=n(32775),c=n(9043),u=n(92384),d=n(71545),p=n(9726),h=n(65081),f=n(17782),m=n(64170),g=n(69858),y=n(97564)
function v(e){return e.map(e=>({x:e[0],alpha:e[1]}))}function b(e,t){const n=[{x:0,alpha:0},{x:0,alpha:0},...e,{x:1,alpha:0},{x:1,alpha:0}],r=t?t.ref.value.array:new Uint8Array(256)
let i,o,a,s,l,u,d=0
const p=e.length+1
for(let c=0;c<p;++c){i=n[c+1].x,o=n[c+2].x,a=n[c].alpha,s=n[c+1].alpha,l=n[c+2].alpha,u=n[c+3].alpha
const e=Math.round(256*(o-i))
for(let t=0;t<e;++t){const n=t/e
r[d]=Math.max(0,255*(0,y.Y7)(a,s,l,u,n,.5)),++d}}const h={array:r,width:256,height:1}
return t?(c.IQ.update(t,h),t):c.IQ.create(h)}var x=n(40426),S=n(90050),_=n(22394),C=n(71905)
const w=(0,d.az)()
var T
!function(e){function t(e,t,r,i,o,a,u,d,p,h,f){return f?function(e,t,n,r,i,o,a,s,u,d,p){const h=o.getWidth(),f=o.getHeight(),m=o.getDepth()
return c.IQ.update(p.gridDimension,t),c.IQ.update(p.gridTexture,o),c.IQ.update(p.gridTextureDim,l.eB.set(p.gridTextureDim.ref.value,h,f,m)),c.IQ.update(p.gridStats,l.Zb.set(p.gridStats.ref.value,a.min,a.max,a.mean,a.sigma)),c.IQ.update(p.bboxMin,e.min),c.IQ.update(p.bboxMax,e.max),c.IQ.update(p.bboxSize,l.eB.sub(p.bboxSize.ref.value,e.max,e.min)),c.IQ.update(p.transform,n),c.IQ.update(p.cellDim,i),c.IQ.update(p.unitToCartn,r),c.IQ.update(p.cartnToUnit,l.$I.invert((0,l.$I)(),r)),c.IQ.updateIfChanged(p.packedGroup,s),c.IQ.updateIfChanged(p.axisOrder,l.eB.fromArray(p.axisOrder.ref.value,u,0)),c.IQ.updateIfChanged(p.dataType,d),p}(e,t,r,i,o,a,u,d,p,h,f):function(e,t,r,i,o,a,u,d,p,h){const f=(0,s.f8)()
let m=-1
const g=a.getWidth(),y=a.getHeight(),v=a.getDepth(),b={kind:"direct-volume",gridDimension:c.IQ.create(t),gridTexture:c.IQ.create(a),gridTextureDim:c.IQ.create(l.eB.create(g,y,v)),gridStats:c.IQ.create(l.Zb.create(u.min,u.max,u.mean,u.sigma)),bboxMin:c.IQ.create(e.min),bboxMax:c.IQ.create(e.max),bboxSize:c.IQ.create(l.eB.sub((0,l.eB)(),e.max,e.min)),transform:c.IQ.create(r),cellDim:c.IQ.create(o),unitToCartn:c.IQ.create(i),cartnToUnit:c.IQ.create(l.$I.invert((0,l.$I)(),i)),get boundingSphere(){const e=n(b)
if(e!==m){const t=function(e,t){return s.f8.fromDimensionsAndTransform((0,s.f8)(),e,t)}(b.gridDimension.ref.value,b.transform.ref.value)
s.f8.copy(f,t),m=e}return f},packedGroup:c.IQ.create(d),axisOrder:c.IQ.create(p),dataType:c.IQ.create(h),setBoundingSphere(e){s.f8.copy(f,e),m=n(b)},meta:{}}
return b}(e,t,r,i,o,a,u,d,p,h)}function n(e){return(0,r.TI)([e.bboxSize.ref.version,e.gridDimension.ref.version,e.gridTexture.ref.version,e.transform.ref.version,e.gridStats.ref.version])}function d(e){return t((0,s.DJ)(),(0,l.eB)(),l.$I.identity(),l.$I.identity(),(0,l.eB)(),(0,a.z6)(),S.x.One.stats,!1,l.eB.create(0,1,2),"byte",e)}function y(e,t){const n=e.transform.ref.value,[r,o,a]=e.gridDimension.ref.value,s=r*o*a,c=t.instanceCount.ref.value,u=(0,i.tu)(),d=u.position,p=t.aTransform.ref.value
return(0,i.iQ)(s,c,1,(e,t)=>{const r=Math.floor(e/a)
return d[0]=Math.floor(r/o),d[1]=r%o,d[2]=e%a,l.eB.transformMat4(d,d,n),t>=0&&l.eB.transformMat4Offset(d,d,p,0,0,16*t),u})}function T(e,t){return Math.ceil(l.eB.magnitude(e)*t)}function A(e,t){return Math.min(...e)*(1/t)}function I(e){return 1/e}function P(e,t,n,r,i){const{gridTexture:a,gridTextureDim:u,gridStats:d}=e,{bboxSize:S,bboxMin:P,bboxMax:B,gridDimension:E,transform:k}=e,{instanceCount:D,groupCount:M}=n,R=y(e,t),O=(0,h.D1)(n,R,r.color),L=i.instanceGranularity?(0,f.Km)(D,"instance"):(0,f.Km)(D*M,"groupInstance"),N=(0,m.WG)(),F=(0,g.MD)(),z=(0,C.JS)(),j=(0,_.IB)(),V=(0,x.EN)(),[U,G,H]=E.ref.value,q={drawCount:w.indices.length,vertexCount:U*G*H,groupCount:M,instanceCount:D},Q=s.f8.clone(e.boundingSphere),$=(0,o.Ax)(Q,t.aTransform.ref.value,D,0),X=b(v(i.controlPoints))
return{dGeometryType:c.IQ.create("directVolume"),...O,...L,...N,...F,...z,...j,...V,...t,...p.iy.createValues(i,q),aPosition:c.IQ.create(w.vertices),elements:c.IQ.create(w.indices),boundingSphere:c.IQ.create($),invariantBoundingSphere:c.IQ.create(Q),uInvariantBoundingSphere:c.IQ.create(l.Zb.ofSphere(Q)),uBboxMin:P,uBboxMax:B,uBboxSize:S,uMaxSteps:c.IQ.create(T(E.ref.value,i.stepsPerCell)),uStepScale:c.IQ.create(A(e.cellDim.ref.value,i.stepsPerCell)),uJumpLength:c.IQ.create(i.jumpLength),uTransform:k,uGridDim:E,tTransferTex:X,uTransferScale:c.IQ.create(I(i.stepsPerCell)),dGridTexType:c.IQ.create(a.ref.value.getDepth()>0?"3d":"2d"),uGridTexDim:u,tGridTex:a,uGridStats:d,uCellDim:e.cellDim,uCartnToUnit:e.cartnToUnit,uUnitToCartn:e.unitToCartn,dPackedGroup:e.packedGroup,dAxisOrder:c.IQ.create(e.axisOrder.ref.value.join("")),dIgnoreLight:c.IQ.create(i.ignoreLight),dCelShaded:c.IQ.create(i.celShaded),dXrayShaded:c.IQ.create("inverted"===i.xrayShaded?"inverted":!0===i.xrayShaded?"on":"off"),meta:c.IQ.create(e.meta)}}e.create=t,e.createEmpty=d,e.Params={...p.iy.Params,ignoreLight:u.t.Boolean(!1,p.iy.ShadingCategory),celShaded:u.t.Boolean(!1,p.iy.ShadingCategory),xrayShaded:u.t.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],p.iy.ShadingCategory),controlPoints:u.t.LineGraph([l.ZY.create(.19,0),l.ZY.create(.2,.05),l.ZY.create(.25,.05),l.ZY.create(.26,0),l.ZY.create(.79,0),l.ZY.create(.8,.05),l.ZY.create(.85,.05),l.ZY.create(.86,0)],{isEssential:!0}),stepsPerCell:u.t.Numeric(3,{min:1,max:10,step:1}),jumpLength:u.t.Numeric(0,{min:0,max:20,step:.1})},e.Utils={Params:e.Params,createEmpty:d,createValues:P,createValuesSimple:function(t,n,r,i,o){const a=p.iy.createSimple(r,i,o),s={...u.t.getDefaultValues(e.Params),...n}
return P(t,a.transform,a.locationIterator,a.theme,s)},updateValues:function(e,t){p.iy.updateValues(e,t),c.IQ.updateIfChanged(e.dIgnoreLight,t.ignoreLight),c.IQ.updateIfChanged(e.dCelShaded,t.celShaded),c.IQ.updateIfChanged(e.dXrayShaded,"inverted"===t.xrayShaded?"inverted":!0===t.xrayShaded?"on":"off"),b(v(t.controlPoints),e.tTransferTex),c.IQ.updateIfChanged(e.uMaxSteps,T(e.uGridDim.ref.value,t.stepsPerCell)),c.IQ.updateIfChanged(e.uStepScale,A(e.uCellDim.ref.value,t.stepsPerCell)),c.IQ.updateIfChanged(e.uTransferScale,I(t.stepsPerCell)),c.IQ.updateIfChanged(e.uJumpLength,t.jumpLength)},updateBoundingSphere:function(e,t){const n=s.f8.clone(t.boundingSphere),r=(0,o.Ax)(n,e.aTransform.ref.value,e.instanceCount.ref.value,0)
s.f8.equals(r,e.boundingSphere.ref.value)||c.IQ.update(e.boundingSphere,r),s.f8.equals(n,e.invariantBoundingSphere.ref.value)||(c.IQ.update(e.invariantBoundingSphere,n),c.IQ.update(e.uInvariantBoundingSphere,l.Zb.fromSphere(e.uInvariantBoundingSphere.ref.value,n)))},createRenderableState:function(e){const t=p.iy.createRenderableState(e)
return t.opaque=!1,t.writeDepth=!1,t},updateRenderableState:function(e,t){p.iy.updateRenderableState(e,t),e.opaque=!1,e.writeDepth=!1},createPositionIterator:y}}(T||(T={}))},40426(e,t,n){"use strict"
n.d(t,{$G:()=>l,EN:()=>u,HB:()=>a,eO:()=>s})
var r=n(80813),i=n(32775),o=n(31727)
function a(e,t,n,r){return e.fill(r,t,n),!0}function s(e,t,n){e.fill(0,t,n)}function l(e,t,n){const a=(0,o.xg)(Math.max(1,e),1,Uint8Array,n&&n.tClipping.ref.value.array)
return n?(r.IQ.update(n.tClipping,a),r.IQ.update(n.uClippingTexDim,i.ZY.create(a.width,a.height)),r.IQ.updateIfChanged(n.dClipping,e>0),r.IQ.updateIfChanged(n.dClippingType,t),n):{tClipping:r.IQ.create(a),uClippingTexDim:r.IQ.create(i.ZY.create(a.width,a.height)),dClipping:r.IQ.create(e>0),dClippingType:r.IQ.create(t)}}const c={array:new Uint8Array(1),width:1,height:1}
function u(e){return e?(r.IQ.update(e.tClipping,c),r.IQ.update(e.uClippingTexDim,i.ZY.create(1,1)),r.IQ.updateIfChanged(e.dClipping,!1),e):{tClipping:r.IQ.create(c),uClippingTexDim:r.IQ.create(i.ZY.create(1,1)),dClipping:r.IQ.create(!1),dClippingType:r.IQ.create("groupInstance")}}},40615(e,t,n){"use strict"
n.d(t,{W:()=>r})
var r,i=n(24762),o=n(717),a=n(33205),s=n(99852)
!function(e){function t(e){if(!o.K4.is(e.sourceData))return!1
const{pdbx_sifts_xref_db_name:t,pdbx_sifts_xref_db_acc:n,pdbx_sifts_xref_db_num:r,pdbx_sifts_xref_db_res:i}=e.sourceData.data.db.atom_site
return t.isDefined&&n.isDefined&&r.isDefined&&i.isDefined}function n(e){if(!o.K4.is(e.sourceData))return
const{pdbx_sifts_xref_db_name:t,pdbx_sifts_xref_db_acc:n,pdbx_sifts_xref_db_num:r,pdbx_sifts_xref_db_res:a}=e.sourceData.data.db.atom_site
if(!(t.isDefined&&n.isDefined&&r.isDefined&&a.isDefined))return
const{atomSourceIndex:s}=e.atomicHierarchy,{count:l,offsets:c}=e.atomicHierarchy.residueAtomSegments,u=new Array(l),d=new Array(l),p=new Array(l),h=new Array(l)
for(let o=0;o<l;o++){const e=s.value(c[o])
t.valueKind(e)===i.VP.ValueKinds.Present?(u[o]=t.value(e),d[o]=n.value(e),p[o]=r.value(e),h[o]=a.value(e)):(u[o]="",d[o]="",p[o]="",h[o]="")}return{dbName:u,accession:d,num:p,residue:h}}e.Provider=s._.createProvider({label:"SIFTS Mapping",descriptor:(0,a.e)({name:"sifts_sequence_mapping"}),type:"static",defaultParams:{},getParams:()=>({}),isApplicable:e=>t(e),obtain:async(e,t)=>({value:n(t)})}),e.isAvailable=t,e.getKey=function(t){const n=t.unit.model,r=e.Provider.get(n).value
if(!r)return""
const i=n.atomicHierarchy.residueAtomSegments.index[t.element]
return r.accession[i]},e.getLabel=function(t){const n=t.unit.model,r=e.Provider.get(n).value
if(!r)return
const i=n.atomicHierarchy.residueAtomSegments.index[t.element],o=r.dbName[i]
return o?`${o} ${r.accession[i]} ${r.num[i]} ${r.residue[i]}`:void 0}}(r||(r={}))},40685(e,t,n){"use strict"
function r(e,t,n){return n?.forceNumber&&("number"!=typeof e&&(e=Number(e)),"number"!=typeof t&&(t=Number(t))),e<t}n.r(t),n.d(t,{default:()=>r})},41009(e,t,n){"use strict"
n.d(t,{K:()=>r,e:()=>i})
const r="undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node,i=function(){if("undefined"==typeof File||r){class e{arrayBuffer(){return this.blob.arrayBuffer()}slice(e,t,n){return this.blob.slice(e,t,n)}stream(){return this.blob.stream()}text(){return this.blob.text()}bytes(){return this.blob.bytes()}constructor(e,t,n){var r
this.blob=new Blob(e,n),this.size=this.blob.size,this.type=this.blob.type,this.name=t,this.lastModified=null!==(r=null==n?void 0:n.lastModified)&&void 0!==r?r:0,this.webkitRelativePath=""}}return e}return File}()},41036(e,t,n){"use strict"
n.d(t,{V8:()=>p,m$:()=>h,rj:()=>r})
var r,i=n(9043),o=n(48393),a=n(14294),s=n(10212),l=n(90050),c=n(72169)
!function(e){e.create=function(){return{updateTransform:!1,updateMatrix:!1,updateColor:!1,updateSize:!1,createGeometry:!1,createNew:!1,info:{}}},e.reset=function(e){e.updateTransform=!1,e.updateMatrix=!1,e.updateColor=!1,e.updateSize=!1,e.createGeometry=!1,e.createNew=!1}}(r||(r={}))
const u={lowestElementCount:1e6,lowerElementCount:5e5,lowElementCount:1e5,mediumElementCount:2e4,highElementCount:2e3,coarseGrainedFactor:10,elementCountFactor:1}
var d
function p(e,t={}){const n={...u,...t}
let r=e.elementCount*n.elementCountFactor
return(e.isCoarseGrained||e.isCoarse)&&(r*=n.coarseGrainedFactor),r>n.lowestElementCount?"lowest":r>n.lowerElementCount?"lower":r>n.lowElementCount?"low":r>n.mediumElementCount?"medium":r>n.highElementCount?"high":"higher"}function h(e,t){let n=(0,i.NT)(e.quality,"auto"),r=(0,i.NT)(e.detail,1),u=(0,i.NT)(e.radialSegments,12),h=(0,i.NT)(e.linearSegments,8),f=(0,i.NT)(e.resolution,2),m=(0,i.NT)(e.imageResolution,1),g=(0,i.NT)(e.probePositions,12),y=(0,i.NT)(e.doubleSided,!0),v=0
if("auto"===n)if(t instanceof o.Structure)n=p(t.root),v=function(e){if(1===e.root.models.length){const t=s.i.Provider.get(e.root.model)
if(t&&"P 1"===t.spacegroup.name&&!a.O8.isZero(t.spacegroup.cell))return t.spacegroup.cell.volume}return a.DJ.volume(e.root.boundary.box)}(t)
else if(l.f.is(t)){const[e,r,i]=t.grid.cells.space.dimensions
v=e*r*i,n=v<1e7?"medium":"low"}if("custom"!==n&&"auto"!==n){let e=function(e){switch(e){case"lowest":return d.Lowest
case"lower":return d.Lower
case"low":return d.Low
case"medium":return d.Medium
case"high":return d.High
case"higher":return d.Higher
case"highest":return d.Highest}}(n)
switch((0,c.Z5)()&&(e=Math.max(e-1,d.Lowest)),e){case d.Highest:r=3,u=36,h=18,f=.1,m=.01,g=72,y=!0
break
case d.Higher:r=3,u=28,h=14,f=.3,m=.05,g=48,y=!0
break
case d.High:r=2,u=20,h=10,f=.5,m=.1,g=36,y=!0
break
case d.Medium:r=1,u=12,h=8,f=.8,m=.2,g=24,y=!0
break
case d.Low:r=0,u=8,h=3,f=1.3,m=.4,g=24,y=!1
break
case d.Lower:r=0,u=4,h=2,f=3,m=.7,g=12,y=!1
break
case d.Lowest:r=0,u=2,h=1,f=8,m=1,g=12,y=!1}}return v>0&&(f=Math.max(f,v/3e8),f=Math.min(f,20)),"off"===e.transparentBackfaces&&(void 0!==e.alpha&&e.alpha<1||e.xrayShaded)&&(y=!1),{detail:r,radialSegments:u,linearSegments:h,resolution:f,imageResolution:m,probePositions:g,doubleSided:y}}!function(e){e[e.Lowest=0]="Lowest",e[e.Lower=1]="Lower",e[e.Low=2]="Low",e[e.Medium=3]="Medium",e[e.High=4]="High",e[e.Higher=5]="Higher",e[e.Highest=6]="Highest"}(d||(d={}))},41041(e,t,n){"use strict"
n.r(t),n.d(t,{structureAreEqual:()=>s,structureAreIntersecting:()=>l,structureIntersect:()=>c,structureSubtract:()=>u,structureUnion:()=>o})
var r=n(44688),i=n(67538)
function o(e,t){if(0===t.length)return r.oE.Empty
if(1===t.length)return t[0]
const n=new Map,o=new Set
for(const{units:r}of t)for(let t=0,a=r.length;t<a;t++){const a=r[t]
if(n.has(a.id)){if(o.has(a.id))continue
const t=i.X9.union(n.get(a.id),a.elements)
n.set(a.id,t),t.length===e.unitMap.get(a.id).elements.length&&o.add(a.id)}else n.set(a.id,a.elements),a.elements.length===e.unitMap.get(a.id).elements.length&&o.add(a.id)}const s=e.subsetBuilder(!0)
return n.forEach(a,s),s.getStructure()}function a(e,t){this.setUnit(t,e)}function s(e,t){if(e===t)return!0
if(e.units.length!==t.units.length)return!1
const n=e.units,r=t.unitMap
for(let o=0,a=n.length;o<a;o++){const e=n[o]
if(!r.has(e.id))return!1
const t=r.get(e.id)
if(!i.X9.areEqual(e.elements,t.elements))return!1}return!0}function l(e,t){if(e===t)return!0
let n,r
e.units.length<t.units.length?(n=e,r=t):(n=t,r=e)
const o=n.units,a=r.unitMap
for(let s=0,l=o.length;s<l;s++){const e=o[s]
if(!a.has(e.id))continue
const t=a.get(e.id)
if(i.X9.areIntersecting(e.elements,t.elements))return!0}return!1}function c(e,t){if(e===t)return e
if(!l(e,t))return r.oE.Empty
let n,o
e.units.length<t.units.length?(n=e,o=t):(n=t,o=e)
const a=n.units,s=o.unitMap,c=[]
for(let r=0,l=a.length;r<l;r++){const e=a[r]
if(!s.has(e.id))continue
const t=s.get(e.id)
if(i.X9.areIntersecting(e.elements,t.elements)){const n=i.X9.intersect(e.elements,t.elements)
c[c.length]=e.getChild(n)}}return r.oE.create(c,{parent:e.parent||t.parent})}function u(e,t){if(e===t)return r.oE.Empty
if(!l(e,t))return e
const n=e.units,o=t.unitMap,a=[]
for(let r=0,s=n.length;r<s;r++){const e=n[r]
if(!o.has(e.id)){a[a.length]=e
continue}const t=o.get(e.id),s=i.X9.subtract(e.elements,t.elements)
s.length>0&&(a[a.length]=e.getChild(s))}return r.oE.create(a,{parent:e.parent||t.parent})}},41059(e,t,n){"use strict"
function r(e,t){for(let n=0,r=e.length;n<r;n++)if(t(e[n]))return e[n]}function i(e){if(Array.from)return Array.from(e)
const t=[]
for(;;){const{done:n,value:r}=e.next()
if(n)break
t[t.length]=r}return t}function o(e,t,n){const r=t-e+1,i=n?new n(r):new Int32Array(r)
for(let o=0;o<r;o++)i[o]=o+e
return i}function a(e,t){const n=new(function(e){const t=e.constructor
if(!t)throw new Error("data does not define a constructor and it should")
return t}(e))(t.length)
for(let r=0,i=t.length;r<i;r++)n[r]=e[t[r]]
return n}n.d(t,{L9:()=>r,ZR:()=>i,qI:()=>a,vc:()=>o})},41113(e,t,n){"use strict"
n.d(t,{L1:()=>l,Yj:()=>c,dN:()=>p,dV:()=>u,ml:()=>h,vs:()=>d})
const r="@warp-drive/core",i=globalThis,o=i.__warpDrive_universalCache=i.__warpDrive_universalCache??{}
i[r]=i[r]??{__version:"5.6.0"}
const a=i[r],s=a.__warpDrive_ModuleScopedCaches??{}
if(a.__warpDrive_hasOtherCopy)throw new Error("Multiple copies of WarpDrive detected, the application will malfunction.")
function l(e,t){return t}function c(e){return s[`(transient) ${e}`]??null}function u(e,t){return s[`(transient) ${e}`]=t}function d(e,t){return t}function p(e){return o[`(transient) ${e}`]??null}function h(e,t){return o[`(transient) ${e}`]=t}a.__warpDrive_hasOtherCopy=!0},41197(e,t,n){"use strict"
n.d(t,{q6:()=>V,tL:()=>k,$i:()=>E})
var r=n(24060),i=n(9959)
const o=(0,i.q)()
function a(e,t){const n=e.checkFramebufferStatus(e.FRAMEBUFFER)
if(n!==e.FRAMEBUFFER_COMPLETE){const i=function(e,t){switch(t){case e.FRAMEBUFFER_COMPLETE:return"complete"
case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"incomplete attachment"
case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"incomplete missing attachment"
case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"incomplete dimensions"
case e.FRAMEBUFFER_UNSUPPORTED:return"unsupported"}if((0,r.C6)(e))switch(t){case e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:return"incomplete multisample"
case e.RENDERBUFFER_SAMPLES:return"renderbuffer samples"}return"unknown error"}(e,n)
throw new Error(`Framebuffer status: ${i}${t?` (${t})`:""}`)}}function s(e){const t=e.createFramebuffer()
if(null===t)throw new Error("Could not create WebGL framebuffer")
return t}var l=n(70292),c=n(5638),u=n(95538)
function d(e){const t=(0,r.WD)(e)
if(null===t)throw new Error('Could not find support for "instanced_arrays"')
const n=(0,r.dh)(e)
if(null===n)throw new Error('Could not find support for "element_index_uint"')
const i=(0,r.e_)(e)
if(null===i)throw new Error('Could not find support for "standard_derivatives"')
const o=(0,r.w1)(e)
c.Bb&&null===o&&console.log('Could not find support for "texture_float"')
const a=(0,r.Bs)(e)
c.Bb&&null===a&&console.log('Could not find support for "texture_float_linear"')
const s=(0,r.JR)(e)
c.Bb&&null===s&&console.log('Could not find support for "texture_half_float"')
const l=(0,r.MS)(e)
c.Bb&&null===l&&console.log('Could not find support for "texture_half_float_linear"')
const u=(0,r.n_)(e)
c.Bb&&null===u&&console.log('Could not find support for "depth_texture"')
const d=(0,r.MT)(e)
c.Bb&&null===d&&console.log('Could not find support for "blend_minmax"')
const p=(0,r.l4)(e)
c.Bb&&null===p&&console.log('Could not find support for "vertex_array_object"')
const h=(0,r.ct)(e)
c.Bb&&null===h&&console.log('Could not find support for "frag_depth"')
const f=(0,r.af)(e)
c.Bb&&null===f&&console.log('Could not find support for "color_buffer_float"')
const m=(0,r.bt)(e)
c.Bb&&null===m&&console.log('Could not find support for "color_buffer_half_float"')
const g=(0,r.m6)(e)
c.Bb&&null===g&&console.log('Could not find support for "draw_buffers"')
const y=(0,r.J6)(e)
c.Bb&&null===y&&console.log('Could not find support for "draw_buffers_indexed"')
const v=(0,r.CI)(e)
c.Bb&&null===v&&console.log('Could not find support for "shader_texture_lod"')
const b=(0,r.jU)(e)
c.Bb&&null===b&&console.log('Could not find support for "sRGB"')
const x=(0,r.QB)(e)
c.Bb&&null===x&&console.log('Could not find support for "disjoint_timer_query"')
const S=(0,r.Kt)(e)
c.Bb&&null===S&&console.log('Could not find support for "multi_draw"')
const _=(0,r.L4)(e)
c.Bb&&null===_&&console.log('Could not find support for "draw_instanced_base_vertex_base_instance"')
const C=(0,r.wM)(e)
c.Bb&&null===C&&console.log('Could not find support for "multi_draw_instanced_base_vertex_base_instance"')
const w=(0,r.qr)(e)
c.Bb&&null===w&&console.log('Could not find support for "parallel_shader_compile"')
const T=(0,r.Yl)(e)
c.Bb&&null===T&&console.log('Could not find support for "fbo_render_mipmap"')
const A=(0,r.kR)(e)
c.Bb&&null===A&&console.log('Could not find support for "provoking_vertex"')
const I=(0,r.qt)(e)
c.Bb&&null===I&&console.log('Could not find support for "clip_cull_distance"')
const P=(0,r.Z1)(e)
c.Bb&&null===P&&console.log('Could not find support for "conservative_depth"')
const B=(0,r.VD)(e)
c.Bb&&null===B&&console.log('Could not find support for "stencil_texturing"')
const E=(0,r.qf)(e)
c.Bb&&null===E&&console.log('Could not find support for "clip_control"')
const k=(0,r.ci)(e)
c.Bb&&null===k&&console.log('Could not find support for "render_snorm"')
const D=(0,r.DJ)(e)
c.Bb&&null===D&&console.log('Could not find support for "render_shared_exponent"')
const M=(0,r.Jd)(e)
c.Bb&&null===M&&console.log('Could not find support for "texture_norm16"')
const R=(0,r.Bt)(e)
c.Bb&&null===R&&console.log('Could not find support for "depth_clamp"')
const O=(0,r.fr)(e)
return c.Bb&&null===O&&console.log('Could not find support for "multiview2"'),{instancedArrays:t,standardDerivatives:i,elementIndexUint:n,textureFloat:o,textureFloatLinear:a,textureHalfFloat:s,textureHalfFloatLinear:l,depthTexture:u,blendMinMax:d,vertexArrayObject:p,fragDepth:h,colorBufferFloat:f,colorBufferHalfFloat:m,drawBuffers:g,drawBuffersIndexed:y,shaderTextureLod:v,sRGB:b,disjointTimerQuery:x,multiDraw:S,drawInstancedBaseVertexBaseInstance:_,multiDrawInstancedBaseVertexBaseInstance:C,parallelShaderCompile:w,fboRenderMipmap:T,provokingVertex:A,clipCullDistance:I,conservativeDepth:P,stencilTexturing:B,clipControl:E,renderSnorm:k,renderSharedExponent:D,textureNorm16:M,depthClamp:R,multiview2:O,noNonInstancedActiveAttribs:(0,r.Du)(e)}}var p=n(62264),h=n(26991),f=n(80856),m=n(63356)
function g(e,t,n){const r=new Map,i=[]
return{get:n=>{const o=e(n)
let a=r.get(o)
return a||(a=function(e,t=0){return{value:e,usageCount:t}}(t(n)),r.set(o,a),i.push(a.value)),a.usageCount+=1,function(e){return{free:()=>{e.usageCount-=1},value:e.value}}(a)},clear:()=>{r.forEach((e,t)=>{e.usageCount<=0&&(e.usageCount<0&&console.warn("Reference usageCount below zero."),n(e.value),r.delete(t),(0,m.mO)(i,e.value))})},get count(){return r.size},values:i,dispose:()=>{r.forEach(e=>n(e.value)),r.clear(),i.length=0}}}var y=n(70012)
const v=(0,i.q)()
function b(e){const t=e.createRenderbuffer()
if(null===t)throw new Error("Could not create WebGL renderbuffer")
return t}var x=n(31683)
const S=(0,i.q)()
function _(e){const{vertexArrayObject:t}=e
if(!t)throw new Error("VertexArrayObject not supported")
const n=t.createVertexArray()
if(!n)throw new Error("Could not create WebGL vertex array")
return n}function C(e){const{vertexArrayObject:t}=e
if(null===t)throw new Error("VertexArrayObject not supported")
return t}var w=n(70429)
function T(e){return{...e.value,destroy:()=>{e.free()}}}function A(e,t,n,i,l){const u={attribute:new Set,elements:new Set,pixelPack:new Set,framebuffer:new Set,program:new Set,renderbuffer:new Set,shader:new Set,texture:new Set,cubeTexture:new Set,vertexArray:new Set}
function d(e,t){return u[e].add(t),n.resourceCounts[e]+=1,{...t,destroy:()=>{t.destroy(),u[e].delete(t),n.resourceCounts[e]-=1}}}const m=g(e=>JSON.stringify(e),t=>d("shader",(0,h.g)(e,t)),e=>{e.destroy()})
function A(e,t){return T(m.get({type:e,source:t}))}const I=new Set,P=g(e=>{var t
const n=[e.shaderCode.id],r=(null===(t=e.defineValues.dRenderVariant)||void 0===t?void 0:t.ref.value)||""
return Object.keys(e.defineValues).forEach(t=>{var i,o,a;(null===(o=(i=e.shaderCode).ignoreDefine)||void 0===o?void 0:o.call(i,t,r,e.defineValues))||n.push((0,y.YZ)(t),"boolean"==typeof(a=e.defineValues[t].ref.value)?a?1:0:"number"==typeof a?1e4*a:(0,y.YZ)(a))}),(0,y.TI)(n).toString()},n=>{const r=(0,p.r)(e,t,i,l,A,n)
return"compute"!==r.variant&&I.add(r),d("program",r)},e=>{I.delete(e),e.destroy()})
return{attribute:(n,r,o,a)=>d("attribute",(0,f.Fu)(e,t,i,n,r,o,a)),elements:(t,n)=>d("elements",(0,f.ki)(e,t,n)),pixelPack:(t,n)=>{if(!(0,r.C6)(e))throw new Error("WebGL2 is required for pixel-pack buffers")
return d("pixelPack",(0,f.K8)(e,i,t,n))},framebuffer:()=>d("framebuffer",function(e){let t=s(e),n=!1
return{id:o(),bind:()=>e.bindFramebuffer(e.FRAMEBUFFER,t),reset:()=>{t=s(e)},destroy:()=>{n||(e.deleteFramebuffer(t),n=!0)}}}(e)),program:(e,t,n)=>T(P.get({defineValues:e,shaderCode:t,schema:n})),renderbuffer:(t,n,i,o)=>d("renderbuffer",function(e,t,n,i,o){let s=b(e)
const l=()=>e.bindRenderbuffer(e.RENDERBUFFER,s),u=function(e,t){switch(t){case"depth16":return e.DEPTH_COMPONENT16
case"stencil8":return e.STENCIL_INDEX8
case"rgba4":return e.RGBA4
case"depth-stencil":return e.DEPTH_STENCIL
case"depth24":if((0,r.C6)(e))return e.DEPTH_COMPONENT24
throw new Error("WebGL2 needed for `depth24` renderbuffer format")
case"depth32f":if((0,r.C6)(e))return e.DEPTH_COMPONENT32F
throw new Error("WebGL2 needed for `depth32f` renderbuffer format")
case"depth24-stencil8":if((0,r.C6)(e))return e.DEPTH24_STENCIL8
throw new Error("WebGL2 needed for `depth24-stencil8` renderbuffer format")
case"depth32f-stencil8":if((0,r.C6)(e))return e.DEPTH32F_STENCIL8
throw new Error("WebGL2 needed for `depth32f-stencil8` renderbuffer format")}}(e,t),d=function(e,t){switch(t){case"depth":return e.DEPTH_ATTACHMENT
case"stencil":return e.STENCIL_ATTACHMENT
case"depth-stencil":return e.DEPTH_STENCIL_ATTACHMENT
case"color0":return e.COLOR_ATTACHMENT0}}(e,n)
function p(){l(),e.renderbufferStorage(e.RENDERBUFFER,u,i,o)}p()
let h=!1
return{id:v(),getByteCount:()=>function(e){switch(e){case"depth16":case"rgba4":case"depth-stencil":case"depth32f":case"depth24-stencil8":return 4
case"stencil8":return 2
case"depth24":return 3
case"depth32f-stencil8":return 5}}(t)*i*o,bind:l,attachFramebuffer:t=>{t.bind(),l(),e.framebufferRenderbuffer(e.FRAMEBUFFER,d,e.RENDERBUFFER,s),c.Bb&&a(e)},detachFramebuffer:t=>{t.bind(),l(),e.framebufferRenderbuffer(e.FRAMEBUFFER,d,e.RENDERBUFFER,null),c.Bb&&a(e)},setSize:(e,t)=>{i=e,o=t,p()},reset:()=>{s=b(e),p()},destroy:()=>{h||(e.deleteRenderbuffer(s),h=!0)}}}(e,t,n,i,o)),shader:A,texture:(t,n,r,o)=>d("texture",(0,x.sZ)(e,i,t,n,r,o)),cubeTexture:(t,n,r)=>d("cubeTexture",(0,x.ji)(e,t,n,r)),vertexArray:(t,n,r)=>d("vertexArray",function(e,t,n,r,i){const o=S()
let a=_(t),s=C(t)
function l(){s.bindVertexArray(a),i&&i.bind(),n.bindAttributes(r),s.bindVertexArray(null),c=!0}let c=!1,u=!1
return{id:o,bind:()=>{c||l(),s.bindVertexArray(a)},update:l,reset:()=>{a=_(t),s=C(t),c=!1},destroy:()=>{u||(i&&(s.bindVertexArray(a),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),s.deleteVertexArray(a),u=!0)}}}(e,i,t,n,r)),getByteCounts:()=>{let e=0
u.texture.forEach(t=>{e+=t.getByteCount()})
let t=0
u.cubeTexture.forEach(e=>{t+=e.getByteCount()})
let n=0
u.attribute.forEach(e=>{n+=e.getByteCount()})
let r=0
u.elements.forEach(e=>{r+=e.getByteCount()})
let i=0
u.pixelPack.forEach(e=>{i+=e.getByteCount()})
let o=0
return u.renderbuffer.forEach(e=>{o+=e.getByteCount()}),{texture:e,cubeTexture:t,attribute:n,elements:r,pixelPack:i,renderbuffer:o}},linkPrograms:e=>{for(const t of I)e&&!e.includes(t.variant)||t.link()},finalizePrograms:(e,t)=>{let n=!0,r=0
for(const s of I)s.isReady()&&I.delete(s),e&&!e.includes(s.variant)||(n=!1,r+=1)
if(n)return!0
let i=!0,o=0
const a=(0,w.t)()
for(const s of I)if((!e||e.includes(s.variant))&&(s.finalize(t)?(I.delete(s),o+=1):i=!1,!t&&(0,w.t)()-a>16)){i=!1
break}return c.g$&&console.log(`Finalized ${o} of ${r} programs (${e?e.join(", "):"all"}) in ${((0,w.t)()-a).toFixed(2)} ms`),i},reset:()=>{u.attribute.forEach(e=>e.reset()),u.elements.forEach(e=>e.reset()),u.pixelPack.forEach(e=>e.reset()),u.framebuffer.forEach(e=>e.reset()),u.renderbuffer.forEach(e=>e.reset()),u.shader.forEach(e=>e.reset()),u.program.forEach(e=>e.reset()),u.vertexArray.forEach(e=>e.reset()),u.texture.forEach(e=>e.reset()),u.cubeTexture.forEach(e=>e.reset())},destroy:()=>{u.attribute.forEach(e=>e.destroy()),u.elements.forEach(e=>e.destroy()),u.pixelPack.forEach(e=>e.destroy()),u.framebuffer.forEach(e=>e.destroy()),u.renderbuffer.forEach(e=>e.destroy()),u.shader.forEach(e=>e.destroy()),u.program.forEach(e=>e.destroy()),u.vertexArray.forEach(e=>e.destroy()),u.texture.forEach(e=>e.destroy()),u.cubeTexture.forEach(e=>e.destroy()),m.clear(),P.clear(),I.clear()}}}const I=(0,i.q)()
var P=n(30372),B=n(43901)
function E(e,t){function n(n){try{return e.getContext(n,t)}catch(e){return null}}const i=((null==t?void 0:t.preferWebGl1)?null:n("webgl2"))||n("webgl")||n("experimental-webgl")
return c.Bb&&console.log(`isWebgl2: ${(0,r.C6)(i)}`),i}function k(e,t){switch(t){case e.NO_ERROR:return"no error"
case e.INVALID_ENUM:return"invalid enum"
case e.INVALID_VALUE:return"invalid value"
case e.INVALID_OPERATION:return"invalid operation"
case e.INVALID_FRAMEBUFFER_OPERATION:return"invalid framebuffer operation"
case e.OUT_OF_MEMORY:return"out of memory"
case e.CONTEXT_LOST_WEBGL:return"context lost"}return"unknown error"}function D(e,t){const n=e.getError()
n!==e.NO_ERROR&&console.log(`WebGL error: '${k(e,n)}'${t?` (${t})`:""}`)}const M=new Uint8Array(4)
function R(e,t,n){e.getSyncParameter(t,e.SYNC_STATUS)===e.SIGNALED?(e.deleteSync(t),n()):l.Scheduler.setImmediate(R,e,t,n)}let O=!1
function L(e){e.bindFramebuffer(e.FRAMEBUFFER,null),e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,M)}function N(e,t){t?e.bindFramebuffer(e.FRAMEBUFFER,t.framebuffer):e.bindFramebuffer(e.FRAMEBUFFER,null)}function F(e,t,n){var r,i
let o=null!==(r=null==t?void 0:t.framebufferWidth)&&void 0!==r?r:e.drawingBufferWidth
return"screen-space"===n&&(o*=2),{width:o,height:null!==(i=null==t?void 0:t.framebufferHeight)&&void 0!==i?i:e.drawingBufferHeight}}function z(e,t,n,r){const i="vertex"===t?e.VERTEX_SHADER:e.FRAGMENT_SHADER,o=e[`${n.toUpperCase()}_${r.toUpperCase()}`]
return e.getShaderPrecisionFormat(i,o)}function j(e,t){return{lowFloat:z(e,t,"low","float"),mediumFloat:z(e,t,"medium","float"),highFloat:z(e,t,"high","float"),lowInt:z(e,t,"low","int"),mediumInt:z(e,t,"medium","int"),highInt:z(e,t,"high","int")}}function V(e,t={}){const n=d(e),i=function(e,t){let n={},r=e.getParameter(e.FRONT_FACE),i=e.getParameter(e.CULL_FACE_MODE),o=e.getParameter(e.DEPTH_WRITEMASK),a=e.getParameter(e.DEPTH_CLEAR_VALUE),s=e.getParameter(e.DEPTH_FUNC),l=e.getParameter(e.COLOR_WRITEMASK),c=e.getParameter(e.COLOR_CLEAR_VALUE),u=e.getParameter(e.BLEND_SRC_RGB),d=e.getParameter(e.BLEND_DST_RGB),p=e.getParameter(e.BLEND_SRC_ALPHA),h=e.getParameter(e.BLEND_DST_ALPHA),f=e.getParameter(e.BLEND_COLOR),m=e.getParameter(e.BLEND_EQUATION_RGB),g=e.getParameter(e.BLEND_EQUATION_ALPHA),y=e.getParameter(e.STENCIL_FUNC),v=e.getParameter(e.STENCIL_VALUE_MASK),b=e.getParameter(e.STENCIL_REF),x=e.getParameter(e.STENCIL_BACK_FUNC),S=e.getParameter(e.STENCIL_BACK_VALUE_MASK),_=e.getParameter(e.STENCIL_BACK_REF),C=e.getParameter(e.STENCIL_WRITEMASK),w=e.getParameter(e.STENCIL_BACK_WRITEMASK),T=e.getParameter(e.STENCIL_FAIL),A=e.getParameter(e.STENCIL_PASS_DEPTH_PASS),I=e.getParameter(e.STENCIL_PASS_DEPTH_FAIL),P=e.getParameter(e.STENCIL_BACK_FAIL),B=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_PASS),E=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_FAIL),k=e.getParameter(e.MAX_VERTEX_ATTRIBS)
const D=[]
let M=e.getParameter(e.VIEWPORT),R=e.getParameter(e.SCISSOR_BOX),O=t.clipControl?e.getParameter(t.clipControl.CLIP_ORIGIN):-1,L=t.clipControl?e.getParameter(t.clipControl.CLIP_DEPTH_MODE):-1
const N=()=>{for(let e=0;e<k;++e)D[e]=0}
return N(),{currentProgramId:-1,currentMaterialId:-1,currentRenderItemId:-1,enable:t=>{!0!==n[t]&&(e.enable(t),n[t]=!0)},disable:t=>{!1!==n[t]&&(e.disable(t),n[t]=!1)},frontFace:t=>{t!==r&&(e.frontFace(t),r=t)},cullFace:t=>{t!==i&&(e.cullFace(t),i=t)},depthMask:t=>{t!==o&&(e.depthMask(t),o=t)},clearDepth:t=>{t!==a&&(e.clearDepth(t),a=t)},depthFunc:t=>{t!==s&&(e.depthFunc(t),s=t)},colorMask:(t,n,r,i)=>{t===l[0]&&n===l[1]&&r===l[2]&&i===l[3]||(e.colorMask(t,n,r,i),l[0]=t,l[1]=n,l[2]=r,l[3]=i)},clearColor:(t,n,r,i)=>{t===c[0]&&n===c[1]&&r===c[2]&&i===c[3]||(e.clearColor(t,n,r,i),c[0]=t,c[1]=n,c[2]=r,c[3]=i)},blendFunc:(t,n)=>{t===u&&n===d&&t===p&&n===h||(e.blendFunc(t,n),u=t,d=n,p=t,h=n)},blendFuncSeparate:(t,n,r,i)=>{t===u&&n===d&&r===p&&i===h||(e.blendFuncSeparate(t,n,r,i),u=t,d=n,p=r,h=i)},blendEquation:t=>{t===m&&t===g||(e.blendEquation(t),m=t,g=t)},blendEquationSeparate:(t,n)=>{t===m&&n===g||(e.blendEquationSeparate(t,n),m=t,g=n)},blendColor:(t,n,r,i)=>{t===f[0]&&n===f[1]&&r===f[2]&&i===f[3]||(e.blendColor(t,n,r,i),f[0]=t,f[1]=n,f[2]=r,f[3]=i)},stencilFunc:(t,n,r)=>{t===y&&n===b&&r===v&&t===x&&n===_&&r===S||(e.stencilFunc(t,n,r),y=t,b=n,v=r,x=t,_=n,S=r)},stencilFuncSeparate:(t,n,r,i)=>{t===e.FRONT?n===y&&r===b&&i===v||(e.stencilFuncSeparate(t,n,r,i),y=n,b=r,v=i):t===e.BACK?n===x&&r===_&&i===S||(e.stencilFuncSeparate(t,n,r,i),x=n,_=r,S=i):t===e.FRONT_AND_BACK&&(n===y&&r===b&&i===v&&n===x&&r===_&&i===S||(e.stencilFuncSeparate(t,n,r,i),y=n,b=r,v=i,x=n,_=r,S=i))},stencilMask:t=>{t===C&&t===w||(e.stencilMask(t),C=t,w=t)},stencilMaskSeparate:(t,n)=>{t===e.FRONT?n!==C&&(e.stencilMaskSeparate(t,n),C=n):t===e.BACK?n!==w&&(e.stencilMaskSeparate(t,n),w=n):t===e.FRONT_AND_BACK&&(n===C&&n===w||(e.stencilMaskSeparate(t,n),C=n,w=n))},stencilOp:(t,n,r)=>{t===T&&n===I&&r===A&&t===P&&n===E&&r===B||(e.stencilOp(t,n,r),T=t,I=n,A=r,P=t,E=n,B=r)},stencilOpSeparate:(t,n,r,i)=>{t===e.FRONT?n===T&&r===I&&i===A||(e.stencilOpSeparate(t,n,r,i),T=n,I=r,A=i):t===e.BACK?n===P&&r===E&&i===B||(e.stencilOpSeparate(t,n,r,i),P=n,E=r,B=i):t===e.FRONT_AND_BACK&&(n===T&&r===I&&i===A&&n===P&&r===E&&i===B||(e.stencilOpSeparate(t,n,r,i),T=n,I=r,A=i,P=n,E=r,B=i))},enableVertexAttrib:t=>{e.enableVertexAttribArray(t),D[t]=1},clearVertexAttribsState:N,disableUnusedVertexAttribs:()=>{for(let t=0;t<k;++t)0===D[t]&&e.disableVertexAttribArray(t)},viewport:(t,n,r,i)=>{t===M[0]&&n===M[1]&&r===M[2]&&i===M[3]||(e.viewport(t,n,r,i),M[0]=t,M[1]=n,M[2]=r,M[3]=i)},scissor:(t,n,r,i)=>{t===R[0]&&n===R[1]&&r===R[2]&&i===R[3]||(e.scissor(t,n,r,i),R[0]=t,R[1]=n,R[2]=r,R[3]=i)},clipControl:t.clipControl?(e,n)=>{e===O&&n===L||(t.clipControl.clipControl(e,n),O=e,L=n)}:void 0,reset:()=>{n={},r=e.getParameter(e.FRONT_FACE),i=e.getParameter(e.CULL_FACE_MODE),o=e.getParameter(e.DEPTH_WRITEMASK),a=e.getParameter(e.DEPTH_CLEAR_VALUE),s=e.getParameter(e.DEPTH_FUNC),l=e.getParameter(e.COLOR_WRITEMASK),c=e.getParameter(e.COLOR_CLEAR_VALUE),u=e.getParameter(e.BLEND_SRC_RGB),d=e.getParameter(e.BLEND_DST_RGB),p=e.getParameter(e.BLEND_SRC_ALPHA),h=e.getParameter(e.BLEND_DST_ALPHA),f=e.getParameter(e.BLEND_COLOR),m=e.getParameter(e.BLEND_EQUATION_RGB),g=e.getParameter(e.BLEND_EQUATION_ALPHA),y=e.getParameter(e.STENCIL_FUNC),v=e.getParameter(e.STENCIL_VALUE_MASK),b=e.getParameter(e.STENCIL_REF),x=e.getParameter(e.STENCIL_BACK_FUNC),S=e.getParameter(e.STENCIL_BACK_VALUE_MASK),_=e.getParameter(e.STENCIL_BACK_REF),C=e.getParameter(e.STENCIL_WRITEMASK),w=e.getParameter(e.STENCIL_BACK_WRITEMASK),T=e.getParameter(e.STENCIL_FAIL),A=e.getParameter(e.STENCIL_PASS_DEPTH_PASS),I=e.getParameter(e.STENCIL_PASS_DEPTH_FAIL),P=e.getParameter(e.STENCIL_BACK_FAIL),B=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_PASS),E=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_FAIL),k=e.getParameter(e.MAX_VERTEX_ATTRIBS),D.length=0
for(let e=0;e<k;++e)D[e]=0
M=e.getParameter(e.VIEWPORT),R=e.getParameter(e.SCISSOR_BOX),O=t.clipControl?e.getParameter(t.clipControl.CLIP_ORIGIN):-1,L=t.clipControl?e.getParameter(t.clipControl.CLIP_DEPTH_MODE):-1}}}(e,n),s={resourceCounts:{attribute:0,elements:0,pixelPack:0,framebuffer:0,program:0,renderbuffer:0,shader:0,texture:0,cubeTexture:0,vertexArray:0},drawCount:0,instanceCount:0,instancedDrawCount:0,calls:{drawInstanced:0,drawInstancedBase:0,multiDrawInstancedBase:0,counts:0},culled:{lod:0,frustum:0,occlusion:0}},p=function(e,t){return{maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),max3dTextureSize:(0,r.C6)(e)?e.getParameter(e.MAX_3D_TEXTURE_SIZE):0,maxRenderbufferSize:e.getParameter(e.MAX_RENDERBUFFER_SIZE),maxDrawBuffers:t.drawBuffers?e.getParameter(t.drawBuffers.MAX_DRAW_BUFFERS):0,maxTextureImageUnits:e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS)}}(e,n),h=A(e,i,s,n,p),f=(0,B.C)(e,n,s)
if(p.maxVertexTextureImageUnits<8)throw new Error('Need "MAX_VERTEX_TEXTURE_IMAGE_UNITS" >= 8')
const m={vertex:j(e,"vertex"),fragment:j(e,"fragment")}
c.Bb&&console.log({parameters:p,shaderPrecisionFormats:m})
const g=n.provokingVertex
null==g||g.provokingVertex(g.FIRST_VERTEX_CONVENTION)
let y=!1
const v=new P.B
let b=t.pixelScale||1
const S={session:void 0,layer:void 0,changed:new P.B,clear:()=>{S.layer=void 0,S.session=void 0,S.changed.next()}},_=new Set
return{gl:e,isWebGL2:(0,r.C6)(e),get pixelRatio(){return("undefined"!=typeof window&&window.devicePixelRatio||1)*(b||1)},extensions:n,state:i,stats:s,resources:h,timer:f,get maxTextureSize(){return p.maxTextureSize},get max3dTextureSize(){return p.max3dTextureSize},get maxRenderbufferSize(){return p.maxRenderbufferSize},get maxDrawBuffers(){return p.maxDrawBuffers},get maxTextureImageUnits(){return p.maxTextureImageUnits},get shaderPrecisionFormats(){return m},namedComputeRenderables:Object.create(null),namedFramebuffers:Object.create(null),namedTextures:Object.create(null),get isContextLost(){return y||e.isContextLost()},contextRestored:v,setContextLost:()=>{y=!0,f.clear()},handleContextRestored:t=>{!function(e,t){const n=d(e);(0,u.IF)(t,(e,r)=>{"noNonInstancedActiveAttribs"===r?t.noNonInstancedActiveAttribs=n.noNonInstancedActiveAttribs:null!==e&&(null===n[r]?t[r]=null:Object.assign(e,n[r]))})}(e,n),i.reset(),i.currentMaterialId=-1,i.currentProgramId=-1,i.currentRenderItemId=-1,h.reset(),_.forEach(e=>e.reset()),null==t||t(),y=!1,v.next((0,w.t)())},xr:{get session(){return S.session},changed:S.changed,set:async(t,n)=>{var r,i
if(S.session!==t&&(await(null===(r=S.session)||void 0===r?void 0:r.end()),void 0!==t))try{await e.makeXRCompatible(),S.session=t,S.layer=new XRWebGLLayer(S.session,e,{antialias:!0,alpha:!0,depth:!0,framebufferScaleFactor:b*(null!==(i=null==n?void 0:n.resolutionScale)&&void 0!==i?i:1)}),await S.session.updateRenderState({baseLayer:S.layer}),S.session.addEventListener("end",S.clear),S.changed.next()}catch(e){throw t?await t.end():(S.layer=void 0,S.session=void 0),e}},end:async()=>{var e
return null===(e=S.session)||void 0===e?void 0:e.end()}},setPixelScale:e=>{b=e},createRenderTarget:(t,n,i,o,a,s)=>{const l=function(e,t,n,i,o=!0,a="uint8",s="nearest",l="rgba"){if("alpha"===l&&!(0,r.C6)(e))throw new Error("cannot render to alpha format in webgl1")
const c=t.framebuffer(),u="fp16"===a?t.texture("image-float16",l,"fp16",s):"float32"===a?t.texture("image-float32",l,"float",s):t.texture("image-uint8",l,"ubyte",s),d=o?(0,r.C6)(e)?t.renderbuffer("depth32f","depth",n,i):t.renderbuffer("depth16","depth",n,i):null
function p(){u.define(n,i),u.attachFramebuffer(c,"color0"),d&&d.attachFramebuffer(c)}p()
let h=!1
return{id:I(),texture:u,framebuffer:c,depthRenderbuffer:d,getByteCount:()=>u.getByteCount()+(d?d.getByteCount():0),getWidth:()=>n,getHeight:()=>i,bind:()=>{c.bind()},setSize:(e,t)=>{n===e&&i===t||(n=e,i=t,u.define(n,i),d&&d.setSize(n,i))},reset:()=>{p()},destroy:()=>{h||(u.destroy(),c.destroy(),d&&d.destroy(),h=!0)}}}(e,h,t,n,i,o,a,s)
return _.add(l),{...l,destroy:()=>{l.destroy(),_.delete(l)}}},createDrawTarget:()=>({id:-1,texture:(0,x.z6)(e),framebuffer:{id:o(),bind:()=>{},reset:()=>{},destroy:()=>{}},depthRenderbuffer:null,getByteCount:()=>0,getWidth:()=>{var t
return F(e,S.layer,null===(t=S.session)||void 0===t?void 0:t.interactionMode).width},getHeight:()=>{var t
return F(e,S.layer,null===(t=S.session)||void 0===t?void 0:t.interactionMode).height},bind:()=>{N(e,S.layer)},setSize:()=>{},reset:()=>{},destroy:()=>{}}),bindDrawingBuffer:()=>N(e,S.layer),getDrawingBufferSize:()=>{var t
return F(e,S.layer,null===(t=S.session)||void 0===t?void 0:t.interactionMode)},readPixels:(t,n,i,o,s)=>{!function(e,t,n,i,o,s){if(c.Bb&&a(e),s instanceof Uint8Array)e.readPixels(t,n,i,o,e.RGBA,e.UNSIGNED_BYTE,s)
else if(s instanceof Float32Array)e.readPixels(t,n,i,o,e.RGBA,e.FLOAT,s)
else{if(!(s instanceof Int32Array&&(0,r.C6)(e)))throw new Error("unsupported readPixels buffer type")
e.readPixels(t,n,i,o,e.RGBA_INTEGER,e.INT,s)}c.Bb&&D(e)}(e,t,n,i,o,s)},waitForGpuCommandsComplete:()=>function(e){return new Promise(t=>{(0,r.C6)(e)?function(e,t){const n=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0)
n?l.Scheduler.setImmediate(R,e,n,t):(console.warn("Could not create a WebGLSync object"),e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,M),t())}(e,t):(O||(console.info("Sync object not supported in WebGL"),O=!0),L(e),t())})}(e),waitForGpuCommandsCompleteSync:()=>L(e),getFenceSync:()=>(0,r.C6)(e)?e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0):null,checkSyncStatus:t=>!(0,r.C6)(e)||e.getSyncParameter(t,e.SYNC_STATUS)===e.SIGNALED&&(e.deleteSync(t),!0),deleteSync:t=>{(0,r.C6)(e)&&e.deleteSync(t)},clear:(t,n,r,o)=>{const a=F(e,S.layer)
N(e,S.layer),i.enable(e.SCISSOR_TEST),i.depthMask(!0),i.colorMask(!0,!0,!0,!0),i.clearColor(t,n,r,o),i.viewport(0,0,a.width,a.height),i.scissor(0,0,a.width,a.height),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)},checkError:t=>{D(e,t)},checkFramebufferStatus:t=>{a(e,t)},destroy:t=>{var n,i,o,a
h.destroy(),function(e){const t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)
for(let o=0;o<t;++o)e.activeTexture(e.TEXTURE0+o),e.bindTexture(e.TEXTURE_2D,null),e.bindTexture(e.TEXTURE_CUBE_MAP,null),(0,r.C6)(e)&&(e.bindTexture(e.TEXTURE_2D_ARRAY,null),e.bindTexture(e.TEXTURE_3D,null))
const n=e.createBuffer()
e.bindBuffer(e.ARRAY_BUFFER,n)
const i=e.getParameter(e.MAX_VERTEX_ATTRIBS)
for(let r=0;r<i;++r)e.vertexAttribPointer(r,1,e.FLOAT,!1,0,0)
e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),(0,r.C6)(e)&&(e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBuffer(e.PIXEL_PACK_BUFFER,null))}(e),null===(n=S.session)||void 0===n||n.removeEventListener("end",S.clear),null===(i=S.session)||void 0===i||i.end(),v.complete(),S.changed.complete(),(null==t?void 0:t.doNotForceWebGLContextLoss)||(null===(o=e.getExtension("WEBGL_lose_context"))||void 0===o||o.loseContext(),null===(a=e.getExtension("STACKGL_destroy_context"))||void 0===a||a.destroy())}}}},41288(e,t,n){"use strict"
n.d(t,{$8:()=>It,$j:()=>Je,B7:()=>f,Bw:()=>Be,C$:()=>J,CQ:()=>de,CR:()=>I,Cj:()=>V,Cp:()=>O,DM:()=>M,E2:()=>De,FJ:()=>Se,FP:()=>z,Fi:()=>G,Hk:()=>ft,ID:()=>T,In:()=>i,L3:()=>tt,M6:()=>We,MI:()=>_t,Mm:()=>ye,NT:()=>ut,OY:()=>te,QM:()=>l,RZ:()=>Z,Rf:()=>xt,Rm:()=>g,U3:()=>Re,VH:()=>oe,X6:()=>he,XD:()=>re,XI:()=>me,Xq:()=>ce,_c:()=>S,c3:()=>v,cv:()=>Ve,d6:()=>Ge,e:()=>rt,fL:()=>Ce,fe:()=>$,fl:()=>W,hU:()=>B,ij:()=>Ze,je:()=>at,l8:()=>Te,le:()=>wt,lj:()=>Pt,mf:()=>Ie,ml:()=>Le,p8:()=>N,qF:()=>gt,qp:()=>k,sM:()=>q,sd:()=>$e,sx:()=>p,sy:()=>pt,tk:()=>u,vC:()=>se,xY:()=>lt,xf:()=>qe,y5:()=>be,yF:()=>C,yG:()=>Tt,yf:()=>Fe,z7:()=>At,zs:()=>vt})
var r=n(28074)
function i(e){return e.svg?(0,r.jsx)("span",{className:"msp-icon msp-material-icon"+(e.inline?" msp-icon-inline":""),title:e.title,style:e.style,children:(0,r.jsx)(e.svg,{})}):null}const o=(0,r.jsx)("circle",{r:"6px",id:"circle-left",cy:"12px",cx:"8px",strokeWidth:"1px"}),a=(0,r.jsx)("circle",{r:"6px",id:"circle-right",cy:"12px",cx:"16px",strokeWidth:"1px"}),s=(0,r.jsxs)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:[(0,r.jsxs)("defs",{children:[o,a]}),(0,r.jsxs)("g",{children:[(0,r.jsx)("use",{href:"#circle-left",className:"msp-shape-filled"}),(0,r.jsx)("use",{href:"#circle-right",className:"msp-shape-filled"}),(0,r.jsx)("use",{href:"#circle-left",className:"msp-shape-empty"})]})]})
function l(){return s}const c=(0,r.jsxs)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:[(0,r.jsxs)("defs",{children:[o,a,(0,r.jsxs)("mask",{id:"mask-left",children:[(0,r.jsx)("use",{href:"#circle-left",fill:"white",stroke:"white"}),(0,r.jsx)("use",{href:"#circle-right",fill:"black",strokeWidth:"0px",stroke:"white"})]})]}),(0,r.jsxs)("g",{children:[(0,r.jsx)("use",{href:"#circle-left",className:"msp-shape-filled",mask:"url(#mask-left)"}),(0,r.jsx)("use",{href:"#circle-right",className:"msp-shape-empty"})]})]})
function u(){return c}const d=(0,r.jsxs)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:[(0,r.jsxs)("defs",{children:[o,a,(0,r.jsx)("clipPath",{id:"clip-left",children:(0,r.jsx)("use",{href:"#circle-right"})})]}),(0,r.jsxs)("g",{children:[(0,r.jsx)("use",{href:"#circle-left",className:"msp-shape-filled",clipPath:"url(#clip-left)"}),(0,r.jsx)("use",{href:"#circle-left",className:"msp-shape-empty"}),(0,r.jsx)("use",{href:"#circle-right",className:"msp-shape-empty"})]})]})
function p(){return d}const h=(0,r.jsxs)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:[(0,r.jsxs)("defs",{children:[o,a]}),(0,r.jsxs)("g",{children:[(0,r.jsx)("use",{href:"#circle-left",className:"msp-shape-empty"}),(0,r.jsx)("use",{href:"#circle-right",className:"msp-shape-filled"})]})]})
function f(){return h}const m=(0,r.jsx)("svg",{width:"17px",height:"17px",viewBox:"0 0 299.463 299.463",strokeWidth:"6px",children:(0,r.jsx)("g",{children:(0,r.jsx)("path",{d:"M256.851,173.832v-48.201c22.916-4.918,34.151-30.668,22.556-50.771c-11.547-20.004-39.486-23.251-55.242-5.844 l-41.746-24.106C189.618,22.603,172.861,0,149.734,0c-23.132,0-39.881,22.609-32.685,44.911L75.305,69.016 C59.522,51.586,31.597,54.88,20.061,74.863c-11.63,20.163-0.298,45.862,22.557,50.769v48.2 c-22.821,4.898-34.195,30.591-22.556,50.771c11.529,19.972,39.454,23.285,55.242,5.845l41.746,24.106 c-7.199,22.308,9.559,44.911,32.685,44.911c23.132,0,39.88-22.609,32.685-44.911l41.745-24.106 c15.817,17.469,43.73,14.099,55.242-5.844c0,0,0-0.001,0.001-0.002c4.587-7.953,5.805-17.213,3.431-26.076 C279.392,185.657,269.129,176.461,256.851,173.832z M249.62,72.088c20.568,0,27.428,27.191,10.008,37.239 c-0.003,0.002-0.006,0.003-0.009,0.005c-10.04,5.81-22.85,1.762-27.877-8.475C225.206,87.548,234.938,72.088,249.62,72.088z M149.734,14.4c11.005,0,19.958,8.954,19.958,19.959c0,11.127-9.077,19.958-19.958,19.958c-10.95,0-19.958-8.9-19.958-19.958 C129.776,23.354,138.729,14.4,149.734,14.4z M39.84,109.328c-17.451-10.067-10.534-37.24,10.01-37.24 c15.311,0,24.922,16.653,17.251,29.942C61.681,111.397,49.517,114.925,39.84,109.328z M59.802,224.702 c-9.535,5.503-21.768,2.229-27.268-7.298c-7.639-13.242,1.887-29.945,17.236-29.945c0.013,0,0.027,0,0.04,0 C70.07,187.48,77.49,214.469,59.802,224.702z M149.734,285.062c-11.005,0-19.958-8.954-19.958-19.958 c0-11.127,9.077-19.958,19.958-19.958c10.954,0,19.958,8.903,19.958,19.958C169.693,276.109,160.74,285.062,149.734,285.062z M216.953,217.982l-41.727,24.095c-13.778-15.22-37.459-14.94-50.983,0l-41.728-24.096c6.196-19.289-5.541-39.835-25.498-44.149 V125.63c19.752-4.268,31.762-24.65,25.498-44.149l41.727-24.095c13.629,15.055,37.32,15.093,50.983,0l41.728,24.096 c-6.196,19.29,5.534,39.835,25.498,44.149v48.202C222.61,178.123,210.721,198.581,216.953,217.982z M266.935,217.404 c-5.501,9.528-17.732,12.802-27.261,7.302c-17.682-10.23-10.301-37.247,10.032-37.247 C264.984,187.459,274.602,204.112,266.935,217.404z"})})})
function g(){return m}const y=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,r.jsx)("path",{d:"M21,16.5C21,16.88 20.79,17.21 20.47,17.38L12.57,21.82C12.41,21.94 12.21,22 12,22C11.79,22 11.59,21.94 11.43,21.82L3.53,17.38C3.21,17.21 3,16.88 3,16.5V7.5C3,7.12 3.21,6.79 3.53,6.62L11.43,2.18C11.59,2.06 11.79,2 12,2C12.21,2 12.41,2.06 12.57,2.18L20.47,6.62C20.79,6.79 21,7.12 21,7.5V16.5M12,4.15L6.04,7.5L12,10.85L17.96,7.5L12,4.15M5,15.91L11,19.29V12.58L5,9.21V15.91M19,15.91V9.21L13,12.58V19.29L19,15.91Z"})})
function v(){return y}(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,r.jsx)("path",{d:"M17,22V20H20V17H22V20.5C22,20.89 21.84,21.24 21.54,21.54C21.24,21.84 20.89,22 20.5,22H17M7,22H3.5C3.11,22 2.76,21.84 2.46,21.54C2.16,21.24 2,20.89 2,20.5V17H4V20H7V22M17,2H20.5C20.89,2 21.24,2.16 21.54,2.46C21.84,2.76 22,3.11 22,3.5V7H20V4H17V2M7,2V4H4V7H2V3.5C2,3.11 2.16,2.76 2.46,2.46C2.76,2.16 3.11,2 3.5,2H7M13,17.25L17,14.95V10.36L13,12.66V17.25M12,10.92L16,8.63L12,6.28L8,8.63L12,10.92M7,14.95L11,17.25V12.66L7,10.36V14.95M18.23,7.59C18.73,7.91 19,8.34 19,8.91V15.23C19,15.8 18.73,16.23 18.23,16.55L12.75,19.73C12.25,20.05 11.75,20.05 11.25,19.73L5.77,16.55C5.27,16.23 5,15.8 5,15.23V8.91C5,8.34 5.27,7.91 5.77,7.59L11.25,4.41C11.5,4.28 11.75,4.22 12,4.22C12.25,4.22 12.5,4.28 12.75,4.41L18.23,7.59Z"})}),(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,r.jsx)("path",{d:"M16,4L9,8.04V15.96L16,20L23,15.96V8.04M16,6.31L19.8,8.5L16,10.69L12.21,8.5M0,7V9H7V7M11,10.11L15,12.42V17.11L11,14.81M21,10.11V14.81L17,17.11V12.42M2,11V13H7V11M4,15V17H7V15"})})
const b=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M10.07,14.27C10.57,14.03 11.16,14.25 11.4,14.75L13.7,19.74L15.5,18.89L13.19,13.91C12.95,13.41 13.17,12.81 13.67,12.58L13.95,12.5L16.25,12.05L8,5.12V15.9L9.82,14.43L10.07,14.27M13.64,21.97C13.14,22.21 12.54,22 12.31,21.5L10.13,16.76L7.62,18.78C7.45,18.92 7.24,19 7,19A1,1 0 0,1 6,18V3A1,1 0 0,1 7,2C7.24,2 7.47,2.09 7.64,2.23L7.65,2.22L19.14,11.86C19.57,12.22 19.62,12.85 19.27,13.27C19.12,13.45 18.91,13.57 18.7,13.61L15.54,14.23L17.74,18.96C18,19.46 17.76,20.05 17.26,20.28L13.64,21.97Z"})});(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,r.jsx)("path",{fill:"currentColor",d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"})}),(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,r.jsx)("path",{fill:"currentColor",d:"M20,11H23V13H20V11M1,11H4V13H1V11M13,1V4H11V1H13M4.92,3.5L7.05,5.64L5.63,7.05L3.5,4.93L4.92,3.5M16.95,5.63L19.07,3.5L20.5,4.93L18.37,7.05L16.95,5.63M12,6A6,6 0 0,1 18,12C18,14.22 16.79,16.16 15,17.2V19A1,1 0 0,1 14,20H10A1,1 0 0,1 9,19V17.2C7.21,16.16 6,14.22 6,12A6,6 0 0,1 12,6M14,21V22A1,1 0 0,1 13,23H11A1,1 0 0,1 10,22V21H14M11,18H13V15.87C14.73,15.43 16,13.86 16,12A4,4 0 0,0 12,8A4,4 0 0,0 8,12C8,13.86 9.27,15.43 11,15.87V18Z"})})
const x=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{fill:"currentColor",d:"M7.5,5.6L5,7L6.4,4.5L5,2L7.5,3.4L10,2L8.6,4.5L10,7L7.5,5.6M19.5,15.4L22,14L20.6,16.5L22,19L19.5,17.6L17,19L18.4,16.5L17,14L19.5,15.4M22,2L20.6,4.5L22,7L19.5,5.6L17,7L18.4,4.5L17,2L19.5,3.4L22,2M13.34,12.78L15.78,10.34L13.66,8.22L11.22,10.66L13.34,12.78M14.37,7.29L16.71,9.63C17.1,10 17.1,10.65 16.71,11.04L5.04,22.71C4.65,23.1 4,23.1 3.63,22.71L1.29,20.37C0.9,20 0.9,19.35 1.29,18.96L12.96,7.29C13.35,6.9 14,6.9 14.37,7.29Z"})})
function S(){return x}const _=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,r.jsx)("path",{d:"M3 17.25V21H6.75L17.81 9.93L14.06 6.18L3 17.25M22.61 18.36L18.36 22.61L13.16 17.41L14.93 15.64L15.93 16.64L18.4 14.16L19.82 15.58L18.36 17L19.42 18L20.84 16.6L22.61 18.36M6.61 10.83L1.39 5.64L5.64 1.39L7.4 3.16L4.93 5.64L6 6.7L8.46 4.22L9.88 5.64L8.46 7.05L9.46 8.05L6.61 10.83M20.71 7C21.1 6.61 21.1 6 20.71 5.59L18.37 3.29C18 2.9 17.35 2.9 16.96 3.29L15.12 5.12L18.87 8.87L20.71 7Z"})})
function C(){return _}const w=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M22 11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3h7zM7 9H4V5h3v4zm10 6h3v4h-3v-4zm0-10h3v4h-3V5z"})})
function T(){return w}const A=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})})
function I(){return A}const P=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M20 12l-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8 8-8z"})})
function B(){return E}const E=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M15 2c-2.71 0-5.05 1.54-6.22 3.78-1.28.67-2.34 1.72-3 3C3.54 9.95 2 12.29 2 15c0 3.87 3.13 7 7 7 2.71 0 5.05-1.54 6.22-3.78 1.28-.67 2.34-1.72 3-3C20.46 14.05 22 11.71 22 9c0-3.87-3.13-7-7-7M9 20c-2.76 0-5-2.24-5-5 0-1.12.37-2.16 1-3 0 3.87 3.13 7 7 7-.84.63-1.88 1-3 1m3-3c-2.76 0-5-2.24-5-5 0-1.12.37-2.16 1-3 0 3.86 3.13 6.99 7 7-.84.63-1.88 1-3 1m4.7-3.3c-.53.19-1.1.3-1.7.3-2.76 0-5-2.24-5-5 0-.6.11-1.17.3-1.7.53-.19 1.1-.3 1.7-.3 2.76 0 5 2.24 5 5 0 .6-.11 1.17-.3 1.7M19 12c0-3.86-3.13-6.99-7-7 .84-.63 1.87-1 3-1 2.76 0 5 2.24 5 5 0 1.12-.37 2.16-1 3"})})
function k(){return P}const D=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M7 10l5 5 5-5z"})})
function M(){return D}const R=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M10 17l5-5-5-5v10z"})})
function O(){return R}const L=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M4 12l1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8-8 8z"})})
function N(){return L}const F=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6zm6.76 1.74L17.3 9.2c.44.84.7 1.79.7 2.8 0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26z"})})
function z(){return F}const j=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M19 12h-2v3h-3v2h5zM7 9h3V7H5v5h2zm14-6H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16.01H3V4.99h18z"})})
function V(){return j}const U=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M6 13c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-8c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm-3 .5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM6 5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm15 5.5c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zM14 7c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0-3.5c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zm-11 10c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm7 7c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm0-17c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zM10 7c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0 5.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm8 .5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-8c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm3 8.5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM14 17c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 3.5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm-4-12c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0 8.5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm4-4.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-4c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5z"})})
function G(){return U}const H=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M15 7v12.97l-4.21-1.81-.79-.34-.79.34L5 19.97V7h10m4-6H8.99C7.89 1 7 1.9 7 3h10c1.1 0 2 .9 2 2v13l2 1V3c0-1.1-.9-2-2-2zm-4 4H5c-1.1 0-2 .9-2 2v16l7-3 7 3V7c0-1.1-.9-2-2-2z"})})
function q(){return H}const Q=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M7 14c-1.66 0-3 1.34-3 3 0 1.31-1.16 2-2 2 .92 1.22 2.49 2 4 2 2.21 0 4-1.79 4-4 0-1.66-1.34-3-3-3zm13.71-9.37l-1.34-1.34a.9959.9959 0 00-1.41 0L9 12.25 11.75 15l8.96-8.96c.39-.39.39-1.02 0-1.41z"})})
function $(){return Q}const X=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M22.61 18.99l-9.08-9.08c.93-2.34.45-5.1-1.44-7C9.79.61 6.21.4 3.66 2.26L7.5 6.11 6.08 7.52 2.25 3.69C.39 6.23.6 9.82 2.9 12.11c1.86 1.86 4.57 2.35 6.89 1.48l9.11 9.11c.39.39 1.02.39 1.41 0l2.3-2.3c.4-.38.4-1.01 0-1.41zm-3 1.6l-9.46-9.46c-.61.45-1.29.72-2 .82-1.36.2-2.79-.21-3.83-1.25C3.37 9.76 2.93 8.5 3 7.26l3.09 3.09 4.24-4.24-3.09-3.09c1.24-.07 2.49.37 3.44 1.31 1.08 1.08 1.49 2.57 1.24 3.96-.12.71-.42 1.37-.88 1.96l9.45 9.45-.88.89z"})})
function W(){return X}const Y=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"})})
function Z(){return Y}const K=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M14.25 2.26l-.08-.04-.01.02C13.46 2.09 12.74 2 12 2 6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10c0-4.75-3.31-8.72-7.75-9.74zM19.41 9h-7.99l2.71-4.7c2.4.66 4.35 2.42 5.28 4.7zM13.1 4.08L10.27 9l-1.15 2L6.4 6.3C7.84 4.88 9.82 4 12 4c.37 0 .74.03 1.1.08zM5.7 7.09L8.54 12l1.15 2H4.26C4.1 13.36 4 12.69 4 12c0-1.85.64-3.55 1.7-4.91zM4.59 15h7.98l-2.71 4.7c-2.4-.67-4.34-2.42-5.27-4.7zm6.31 4.91L14.89 13l2.72 4.7C16.16 19.12 14.18 20 12 20c-.38 0-.74-.04-1.1-.09zm7.4-3l-4-6.91h5.43c.17.64.27 1.31.27 2 0 1.85-.64 3.55-1.7 4.91z"})})
function J(){return K}const ee=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M9.4 10.5l4.77-8.26C13.47 2.09 12.75 2 12 2c-2.4 0-4.6.85-6.32 2.25l3.66 6.35.06-.1zM21.54 9c-.92-2.92-3.15-5.26-6-6.34L11.88 9h9.66zm.26 1h-7.49l.29.5 4.76 8.25C21 16.97 22 14.61 22 12c0-.69-.07-1.35-.2-2zM8.54 12l-3.9-6.75C3.01 7.03 2 9.39 2 12c0 .69.07 1.35.2 2h7.49l-1.15-2zm-6.08 3c.92 2.92 3.15 5.26 6 6.34L12.12 15H2.46zm11.27 0l-3.9 6.76c.7.15 1.42.24 2.17.24 2.4 0 4.6-.85 6.32-2.25l-3.66-6.35-.93 1.6z"})})
function te(){return ee}const ne=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3.59-13L12 10.59 8.41 7 7 8.41 10.59 12 7 15.59 8.41 17 12 13.41 15.59 17 17 15.59 13.41 12 17 8.41z"})})
function re(){return ne}const ie=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"})})
function oe(){return ie}const ae=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm-7 7H3v4c0 1.1.9 2 2 2h4v-2H5v-4zM5 5h4V3H5c-1.1 0-2 .9-2 2v4h2V5zm14-2h-4v2h4v4h2V5c0-1.1-.9-2-2-2zm0 16h-4v2h4c1.1 0 2-.9 2-2v-4h-2v4z"})})
function se(){return ae}const le=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})})
function ce(){return le}const ue=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})})
function de(){return ue}const pe=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})})
function he(){return pe}const fe=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"})})
function me(){return fe}const ge=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"})})
function ye(){return ge}const ve=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4H8c-1.1 0-1.99.9-1.99 2L6 21c0 1.1.89 2 1.99 2H19c1.1 0 2-.9 2-2V11l-6-6zM8 21V7h6v5h5v9H8z"})})
function be(){return ve}const xe=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M17 15h2V7c0-1.1-.9-2-2-2H9v2h8v8zM7 17V1H5v4H1v2h4v10c0 1.1.9 2 2 2h10v4h2v-4h4v-2H7z"})})
function Se(){return xe}const _e=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M3 5v4h2V5h4V3H5c-1.1 0-2 .9-2 2zm2 10H3v4c0 1.1.9 2 2 2h4v-2H5v-4zm14 4h-4v2h4c1.1 0 2-.9 2-2v-4h-2v4zm0-16h-4v2h4v4h2V5c0-1.1-.9-2-2-2z"})})
function Ce(){return _e}const we=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zm-5.04-6.71l-2.75 3.54-1.96-2.36L6.5 17h11l-3.54-4.71z"})})
function Te(){return we}const Ae=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z"})})
function Ie(){return Ae}(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"})})
const Pe=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})})
function Be(){return Pe}(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M20.5 11H19V7c0-1.1-.9-2-2-2h-4V3.5C13 2.12 11.88 1 10.5 1S8 2.12 8 3.5V5H4c-1.1 0-1.99.9-1.99 2v3.8H3.5c1.49 0 2.7 1.21 2.7 2.7s-1.21 2.7-2.7 2.7H2V20c0 1.1.9 2 2 2h3.8v-1.5c0-1.49 1.21-2.7 2.7-2.7 1.49 0 2.7 1.21 2.7 2.7V22H17c1.1 0 2-.9 2-2v-4h1.5c1.38 0 2.5-1.12 2.5-2.5S21.88 11 20.5 11z"})})
const Ee=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,r.jsx)("path",{d:"M3 13h2v-2H3v2zm0 4h2v-2H3v2zm2 4v-2H3c0 1.1.89 2 2 2zM3 9h2V7H3v2zm12 12h2v-2h-2v2zm4-18H9c-1.11 0-2 .9-2 2v10c0 1.1.89 2 2 2h10c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 12H9V5h10v10zm-8 6h2v-2h-2v2zm-4 0h2v-2H7v2z"})});(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M5 16h3v3h2v-5H5zm3-8H5v2h5V5H8zm6 11h2v-3h3v-2h-5zm2-11V5h-2v5h5V8z"})})
const ke=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"})})
function De(){return ke}const Me=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"})})
function Re(){return Me}const Oe=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"})})
function Le(){return Oe}const Ne=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M12 5.69l5 4.5V18h-2v-6H9v6H7v-7.81l5-4.5M12 3L2 12h3v8h6v-6h2v6h6v-8h3L12 3z"})})
function Fe(){return Ne}(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"})})
const ze=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M19.5 9.5c-1.03 0-1.9.62-2.29 1.5h-2.92c-.39-.88-1.26-1.5-2.29-1.5s-1.9.62-2.29 1.5H6.79c-.39-.88-1.26-1.5-2.29-1.5C3.12 9.5 2 10.62 2 12s1.12 2.5 2.5 2.5c1.03 0 1.9-.62 2.29-1.5h2.92c.39.88 1.26 1.5 2.29 1.5s1.9-.62 2.29-1.5h2.92c.39.88 1.26 1.5 2.29 1.5 1.38 0 2.5-1.12 2.5-2.5s-1.12-2.5-2.5-2.5z"})}),je=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})})
function Ve(){return je}const Ue=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})})
function Ge(){return Ue}const He=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"})})
function qe(){return He}const Qe=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M19 4H5c-1.11 0-2 .9-2 2v12c0 1.1.89 2 2 2h4v-2H5V8h14v10h-4v2h4c1.1 0 2-.9 2-2V6c0-1.1-.89-2-2-2zm-7 6l-4 4h3v6h2v-6h3l-4-4z"})})
function $e(){return Qe}const Xe=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M8 5v14l11-7z"})})
function We(){return Xe}const Ye=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"})})
function Ze(){return Ye}const Ke=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M19 13H5v-2h14v2z"})})
function Je(){return Ke}const et=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"})})
function tt(){return et}const nt=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,r.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm2 16H5V5h11.17L19 7.83V19zm-7-7c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3zM6 6h9v4H6z"})})
function rt(){return nt}const it=(0,r.jsxs)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{cx:"7",cy:"14",r:"3"}),(0,r.jsx)("circle",{cx:"11",cy:"6",r:"3"}),(0,r.jsx)("circle",{cx:"16.6",cy:"17.6",r:"3"})]});(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"})})
const ot=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M6 6h2v12H6zm3.5 6l8.5 6V6z"})})
function at(){return ot}const st=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M6 6h12v12H6z"})})
function lt(){return st}const ct=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M4 6h16v2H4zm2-4h12v2H6zm14 8H4c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2v-8c0-1.1-.9-2-2-2zm0 10H4v-8h16v8zm-10-7.27v6.53L16 16z"})})
function ut(){return ct}const dt=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M6.99 11L3 15l3.99 4v-3H14v-2H6.99v-3zM21 9l-3.99-4v3H10v2h7.01v3L21 9z"})})
function pt(){return dt}(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M21 4H7V2H5v20h2v-8h14l-2-5zm-6 5c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2"})})
const ht=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"})})
function ft(){return ht}const mt=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M12 6c3.79 0 7.17 2.13 8.82 5.5-.59 1.22-1.42 2.27-2.41 3.12l1.41 1.41c1.39-1.23 2.49-2.77 3.18-4.53C21.27 7.11 17 4 12 4c-1.27 0-2.49.2-3.64.57l1.65 1.65C10.66 6.09 11.32 6 12 6zm-1.07 1.14L13 9.21c.57.25 1.03.71 1.28 1.28l2.07 2.07c.08-.34.14-.7.14-1.07C16.5 9.01 14.48 7 12 7c-.37 0-.72.05-1.07.14zM2.01 3.87l2.68 2.68C3.06 7.83 1.77 9.53 1 11.5 2.73 15.89 7 19 12 19c1.52 0 2.98-.29 4.32-.82l3.42 3.42 1.41-1.41L3.42 2.45 2.01 3.87zm7.5 7.5l2.61 2.61c-.04.01-.08.02-.12.02-1.38 0-2.5-1.12-2.5-2.5 0-.05.01-.08.01-.13zm-3.4-3.4l1.75 1.75c-.23.55-.36 1.15-.36 1.78 0 2.48 2.02 4.5 4.5 4.5.63 0 1.23-.13 1.77-.36l.98.98c-.88.24-1.8.38-2.75.38-3.79 0-7.17-2.13-8.82-5.5.7-1.43 1.72-2.61 2.93-3.53z"})})
function gt(){return mt}(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2M6 9h12v2H6zm8 5H6v-2h8zm4-6H6V6h12z"})}),(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M4 4h16v12H5.17L4 17.17zm0-2c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm2 10h8v2H6zm0-3h12v2H6zm0-3h12v2H6z"})}),(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-2 10h-4v4h-2v-4H7v-2h4V7h2v4h4z"})}),(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-2 10H7v-2h10z"})})
const yt=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M12 6c3.79 0 7.17 2.13 8.82 5.5C19.17 14.87 15.79 17 12 17s-7.17-2.13-8.82-5.5C4.83 8.13 8.21 6 12 6m0-2C7 4 2.73 7.11 1 11.5 2.73 15.89 7 19 12 19s9.27-3.11 11-7.5C21.27 7.11 17 4 12 4zm0 5c1.38 0 2.5 1.12 2.5 2.5S13.38 14 12 14s-2.5-1.12-2.5-2.5S10.62 9 12 9m0-2c-2.48 0-4.5 2.02-4.5 4.5S9.52 16 12 16s4.5-2.02 4.5-4.5S14.48 7 12 7z"})})
function vt(){return yt}const bt=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"})})
function xt(){return bt}(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M 9.64 7.64 c 0.23 -0.5 0.36 -1.05 0.36 -1.64 c 0 -2.21 -1.79 -4 -4 -4 S 2 3.79 2 6 s 1.79 4 4 4 c 0.59 0 1.14 -0.13 1.64 -0.36 L 10 12 l -2.36 2.36 C 7.14 14.13 6.59 14 6 14 c -2.21 0 -4 1.79 -4 4 s 1.79 4 4 4 s 4 -1.79 4 -4 c 0 -0.59 -0.13 -1.14 -0.36 -1.64 L 12 14 l 7 7 h 3 v -1 L 9.64 7.64 Z M 6 8 c -1.1 0 -2 -0.89 -2 -2 s 0.9 -2 2 -2 s 2 0.89 2 2 s -0.9 2 -2 2 Z m 0 12 c -1.1 0 -2 -0.89 -2 -2 s 0.9 -2 2 -2 s 2 0.89 2 2 s -0.9 2 -2 2 Z m 6 -7.5 c -0.28 0 -0.5 -0.22 -0.5 -0.5 s 0.22 -0.5 0.5 -0.5 s 0.5 0.22 0.5 0.5 s -0.22 0.5 -0.5 0.5 Z M 19 3 l -6 6 l 2 2 l 7 -7 V 3 Z"})})
const St=(0,r.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{d:"M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0 c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2 c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1 C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06 c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41 l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41 c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36 c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"})})
function _t(){return St}const Ct=(0,r.jsxs)("svg",{width:"16px",height:"16px",viewBox:"0 0 16 16",children:[(0,r.jsx)("path",{d:"M8 1.248c1.857 0 3.526.641 4.65 1.794a5 5 0 0 1 2.518 1.09C13.907 1.482 11.295 0 8 0 4.75 0 2.12 1.48.844 4.122a5 5 0 0 1 2.289-1.047C4.236 1.872 5.974 1.248 8 1.248"}),(0,r.jsx)("path",{d:"M12 12a4 4 0 0 1-2.786-1.13l-.002-.002a1.6 1.6 0 0 0-.276-.167A2.2 2.2 0 0 0 8 10.5c-.414 0-.729.103-.935.201a1.6 1.6 0 0 0-.277.167l-.002.002A4 4 0 1 1 4 4h8a4 4 0 0 1 0 8"})]})
function wt(){return Ct}const Tt=function(){return b},At=function(){return it},It=function(){return ze},Pt=function(){return Ee}},41428(e,t,n){"use strict"
n.d(t,{U0:()=>Ft,AF:()=>c.A,Zw:()=>zt})
var r={}
n.r(r),n.d(r,{SyncRepresentationToCanvas:()=>h,SyncStructureRepresentation3DState:()=>f,UpdateRepresentationVisibility:()=>m,registerDefault:()=>p})
var i={}
n.r(i),n.d(i,{Focus:()=>S,FocusObject:()=>_,OrientAxes:()=>C,Reset:()=>b,ResetAxes:()=>w,SetSnapshot:()=>x,registerDefault:()=>v})
var o={}
n.r(o),n.d(o,{Canvas3DSetSettings:()=>I,registerDefault:()=>A})
var a={}
n.r(a),n.d(a,{CameraAxisHelper:()=>H,CameraControls:()=>$,DefaultClickResetCameraOnEmpty:()=>z,DefaultClickResetCameraOnEmptySelectMode:()=>j,DefaultFocusLociBindings:()=>V,FocusLoci:()=>G})
var s={}
n.r(s),n.d(s,{SnapshotControls:()=>K})
var l={}
n.r(l),n.d(l,{AccessibleSurfaceArea:()=>Re,BestDatabaseSequenceMapping:()=>et,CrossLinkRestraint:()=>Lt,Interactions:()=>Ue,SecondaryStructure:()=>He,StructureInfo:()=>te,ValenceModel:()=>$e})
var c=n(48187),u=n(99507),d=n(39298)
function p(e){h(e),f(e),m(e)}function h(e){const t=e.state.data.events
t.object.created.subscribe(t=>{var n
d.O.isRepresentation3D(t.obj)&&(g(t.state.cells.get(t.ref),t.obj.data.repr),t.obj.data.repr.setState({syncManually:!0}),null===(n=e.canvas3d)||void 0===n||n.add(t.obj.data.repr))}),t.object.updated.subscribe(t=>{var n,r
t.oldObj&&d.O.isRepresentation3D(t.oldObj)&&(null===(n=e.canvas3d)||void 0===n||n.remove(t.oldObj.data.repr),t.oldObj.data.repr.destroy()),d.O.isRepresentation3D(t.obj)&&(g(t.state.cells.get(t.ref),t.obj.data.repr),"recreate"===t.action&&t.obj.data.repr.setState({syncManually:!0}),null===(r=e.canvas3d)||void 0===r||r.add(t.obj.data.repr))}),t.object.removed.subscribe(t=>{var n
d.O.isRepresentation3D(t.obj)&&(null===(n=e.canvas3d)||void 0===n||n.remove(t.obj.data.repr),t.obj.data.repr.destroy())})}function f(e){const t=e.state.data.events
t.object.created.subscribe(t=>{var n
if(!d.O.Molecule.Structure.Representation3DState.is(t.obj))return
const r=t.obj.data
r.repr.setState(r.state),null===(n=e.canvas3d)||void 0===n||n.update(r.repr)}),t.object.updated.subscribe(t=>{var n
if(!d.O.Molecule.Structure.Representation3DState.is(t.obj))return
const r=t.obj.data
r.repr.setState(r.state),null===(n=e.canvas3d)||void 0===n||n.update(r.repr)}),t.object.removed.subscribe(t=>{var n
if(!d.O.Molecule.Structure.Representation3DState.is(t.obj))return
const r=t.obj.data
r.repr.setState(r.initialState),null===(n=e.canvas3d)||void 0===n||n.update(r.repr)})}function m(e){e.state.data.events.cell.stateUpdated.subscribe(t=>{var n
const r=t.state.cells.get(t.ref)
d.O.isRepresentation3D(r.obj)&&g(r,r.obj.data.repr)&&(null===(n=e.canvas3d)||void 0===n||n.syncVisibility())})}function g(e,t){return t.state.visible===!!e.state.isHidden&&(t.setState({visible:!e.state.isHidden}),!0)}var y=n(15382)
function v(e){b(e),S(e),_(e),x(e),C(e),w(e)}function b(e){y.PluginCommands.Camera.Reset.subscribe(e,t=>{e.managers.camera.reset(null==t?void 0:t.snapshot,null==t?void 0:t.durationMs)})}function x(e){y.PluginCommands.Camera.SetSnapshot.subscribe(e,({snapshot:t,durationMs:n})=>{e.managers.camera.setSnapshot(t,n)})}function S(e){y.PluginCommands.Camera.Focus.subscribe(e,({center:t,radius:n,durationMs:r})=>{e.managers.camera.focusSphere({center:t,radius:n},{durationMs:r}),e.events.canvas3d.settingsUpdated.next(void 0)})}function _(e){y.PluginCommands.Camera.FocusObject.subscribe(e,async t=>{e.managers.camera.focusObject(t)})}function C(e){y.PluginCommands.Camera.OrientAxes.subscribe(e,({structures:t,durationMs:n})=>{e.managers.camera.orientAxes(t,n)})}function w(e){y.PluginCommands.Camera.ResetAxes.subscribe(e,({durationMs:t})=>{e.managers.camera.resetAxes(t)})}var T=n(61993)
function A(e){I(e)}function I(e){y.PluginCommands.Canvas3D.ResetSettings.subscribe(e,()=>{var t
null===(t=e.canvas3d)||void 0===t||t.setProps(T.FN),e.events.canvas3d.settingsUpdated.next(void 0)}),y.PluginCommands.Canvas3D.SetSettings.subscribe(e,t=>{var n
e.canvas3d&&(null===(n=e.canvas3d)||void 0===n||n.setProps(t.settings),e.events.canvas3d.settingsUpdated.next(void 0))})}var P=n(5422),B=n(89),E=n(92384),k=n(99321),D=n(9052),M=n(26429),R=n(32775)
const O=k.qt,L=k.Fs,N=D.O.Trigger,F=D.O.TriggerKey,z=(0,D.O)([N(O.Flag.Primary,L.create()),N(O.Flag.Secondary,L.create()),N(O.Flag.Primary,L.create({control:!0})),N(O.Flag.Trigger)],"Reset camera focus","Click on nothing using ${triggers}"),j=(0,D.O)([N(O.Flag.Secondary,L.create()),N(O.Flag.Primary,L.create({control:!0}))],"Reset camera focus (Selection Mode)","Click on nothing using ${triggers}"),V={clickCenterFocus:(0,D.O)([N(O.Flag.Primary,L.create()),N(O.Flag.Secondary,L.create()),N(O.Flag.Primary,L.create({control:!0})),N(O.Flag.Trigger)],"Camera center and focus","Click element using ${triggers}"),clickCenterFocusSelectMode:(0,D.O)([N(O.Flag.Secondary,L.create()),N(O.Flag.Primary,L.create({control:!0}))],"Camera center and focus (Selection Mode)","Click element using ${triggers}"),clickResetCameraOnEmpty:z,clickResetCameraOnEmptySelectMode:j},U={minRadius:E.t.Numeric(8,{min:1,max:50,step:1}),extraRadius:E.t.Numeric(4,{min:1,max:50,step:1},{description:"Value added to the bounding-sphere radius of the Loci"}),durationMs:E.t.Numeric(250,{min:0,max:1e3,step:1},{description:"Camera transition duration"}),bindings:E.t.Value(V,{isHidden:!0})},G=c.A.create({name:"camera-focus-loci",category:"interaction",ctor:class extends c.A.Handler{register(){this.subscribeObservable(this.ctx.behaviors.interaction.click,({current:e,button:t,modifiers:n})=>{var r,i,o,a,s,l,c,u
if(!this.ctx.canvas3d)return
const d=this.ctx.selectionMode?this.params.bindings.clickCenterFocusSelectMode:this.params.bindings.clickCenterFocus,p=this.ctx.selectionMode?null!==(r=this.params.bindings.clickResetCameraOnEmptySelectMode)&&void 0!==r?r:j:null!==(i=this.params.bindings.clickResetCameraOnEmpty)&&void 0!==i?i:z
if(B.Loci.isEmpty(e.loci)&&D.O.match(p,t,n))return void y.PluginCommands.Camera.Reset(this.ctx,{})
const h=null!==(l=null===(s=null===(a=null===(o=e.repr)||void 0===o?void 0:o.props)||void 0===a?void 0:a.snapshotKey)||void 0===s?void 0:s.trim())&&void 0!==l?l:"",f=null===(u=null===(c=e.repr)||void 0===c?void 0:c.props)||void 0===u?void 0:u.markdownCommands
if(!(h||"object"==typeof f&&Object.keys(f).length>0)&&D.O.match(d,t,n)){const t=B.Loci.normalize(e.loci,this.ctx.managers.interactivity.props.granularity)
this.ctx.managers.camera.focusLoci(t,this.params)}})}},params:()=>U,display:{name:"Camera Focus Loci on Canvas"}}),H=c.A.create({name:"camera-axis-helper",category:"interaction",ctor:class extends c.A.Handler{register(){let e=M.Nz.None,t=0
this.subscribeObservable(this.ctx.behaviors.interaction.click,({current:n})=>{if(!this.ctx.canvas3d||!(0,M.E2)(n.loci))return
const r=n.loci.elements[0].groupId
if(r===M.Nz.None)return e=M.Nz.None,void(t=0)
const{camera:i}=this.ctx.canvas3d
let o,a
if(r>=M.Nz.X&&r<=M.Nz.Z){e=M.Nz.None,t=0
const n=R.eB.sub((0,R.eB)(),i.target,i.position),s=R.eB.cross((0,R.eB)(),n,i.up)
a=(0,R.eB)(),a[r-1]=1,o=R.eB.cross((0,R.eB)(),a,s),0===R.eB.magnitude(o)&&(o=n)}else e===r?t=(t+1)%2:(e=r,t=0),r===M.Nz.XY?(a=t?R.eB.unitX:R.eB.unitY,o=R.eB.negUnitZ):r===M.Nz.XZ?(a=t?R.eB.unitX:R.eB.unitZ,o=R.eB.negUnitY):(a=t?R.eB.unitY:R.eB.unitZ,o=R.eB.negUnitX)
this.ctx.canvas3d.requestCameraReset({snapshot:(e,t)=>t.getInvariantFocus(e.boundingSphereVisible.center,e.boundingSphereVisible.radius,a,o)})})}},params:()=>({}),display:{name:"Camera Axis Helper"}}),q={keySpinAnimation:(0,D.O)([F("I")],"Spin Animation","Press ${triggers}"),keyRockAnimation:(0,D.O)([F("O")],"Rock Animation","Press ${triggers}"),keyToggleFlyMode:(0,D.O)([F("Space",L.create({shift:!0}))],"Toggle Fly Mode","Press ${triggers}"),keyResetView:(0,D.O)([F("T")],"Reset View","Press ${triggers}"),keyGlobalIllumination:(0,D.O)([F("G")],"Global Illumination","Press ${triggers}")},Q={bindings:E.t.Value(q,{isHidden:!0})},$=c.A.create({name:"camera-controls",category:"interaction",ctor:class extends c.A.Handler{register(){this.subscribeObservable(this.ctx.behaviors.interaction.key,({code:e,key:t,modifiers:n})=>{var r
if(!this.ctx.canvas3d)return
const i={...q,...this.params.bindings},o=this.ctx.canvas3d.props.trackball,a=this.ctx.canvas3d.props.illumination
if(D.O.matchKey(i.keySpinAnimation,e,n,t)){const e="spin"!==o.animate.name?"spin":"off"
"off"===e?y.PluginCommands.Canvas3D.SetSettings(this.ctx,{settings:{trackball:{...o,animate:{name:e,params:{}}}}}):y.PluginCommands.Canvas3D.SetSettings(this.ctx,{settings:{trackball:{...o,animate:{name:e,params:{speed:.1}}}}})}if(D.O.matchKey(i.keyRockAnimation,e,n,t)){const e="rock"!==o.animate.name?"rock":"off"
"off"===e?y.PluginCommands.Canvas3D.SetSettings(this.ctx,{settings:{trackball:{...o,animate:{name:e,params:{}}}}}):y.PluginCommands.Canvas3D.SetSettings(this.ctx,{settings:{trackball:{...o,animate:{name:e,params:{speed:.3,angle:10}}}}})}if(D.O.matchKey(i.keyToggleFlyMode,e,n,t)){const e=!o.flyMode
y.PluginCommands.Canvas3D.SetSettings(this.ctx,{settings:{trackball:{...o,flyMode:e}}}),(null===(r=this.ctx.canvas3dContext)||void 0===r?void 0:r.canvas)&&(this.ctx.canvas3dContext.canvas.style.cursor=e?"crosshair":"unset")}D.O.matchKey(i.keyResetView,e,n,t)&&y.PluginCommands.Camera.Reset(this.ctx,{}),D.O.matchKey(i.keyGlobalIllumination,e,n,t)&&y.PluginCommands.Canvas3D.SetSettings(this.ctx,{settings:{illumination:{...a,enabled:!a.enabled}}})})}},params:()=>Q,display:{name:"Camera Controls on Canvas"}}),X=k.Fs,W=D.O.TriggerKey,Y={next:(0,D.O)([W("ArrowRight",X.create({control:!0})),W("GamepadY")]),previous:(0,D.O)([W("ArrowLeft",X.create({control:!0})),W("GamepadX")]),first:(0,D.O)([W("ArrowUp",X.create({control:!0}))]),last:(0,D.O)([W("ArrowDown",X.create({control:!0}))])},Z={bindings:E.t.Value(Y,{isHidden:!0})},K=c.A.create({name:"snapshot-controls",category:"interaction",ctor:class extends c.A.Handler{register(){this.subscribeObservable(this.ctx.behaviors.interaction.keyReleased,({code:e,modifiers:t,key:n})=>{if(!this.ctx.canvas3d||this.ctx.isBusy)return
const r=this.params.bindings,{snapshot:i}=this.ctx.managers
if(D.O.matchKey(r.next,e,t,n)&&i.applyNext(1),D.O.matchKey(r.previous,e,t,n)&&i.applyNext(-1),D.O.matchKey(r.first,e,t,n)){const e=i.state.entries.get(0),t=i.setCurrent(e.snapshot.id)
if(t)return this.ctx.state.setSnapshot(t)}if(D.O.matchKey(r.last,e,t,n)){const e=i.state.entries.get(i.state.entries.size-1),t=i.setCurrent(e.snapshot.id)
if(t)return this.ctx.state.setSnapshot(t)}})}},params:()=>Z,display:{name:"Snapshot Controls"}})
var J=n(48393),ee=n(43472)
const te=c.A.create({name:"structure-info-prop",category:"custom-props",display:{name:"Structure Info"},ctor:class extends c.A.Handler{get maxModelIndex(){var e,t
let n=-1
const r=this.ctx.state.data.select(ee.QX.Generators.rootsOfType(d.O.Molecule.Model))
for(const i of r){const r=(null===(e=i.obj)||void 0===e?void 0:e.data)&&J.Model.Index.get(null===(t=i.obj)||void 0===t?void 0:t.data).value
void 0!==r&&r>n&&(n=r)}return n}get maxStructureIndex(){var e,t
let n=-1
const r=this.ctx.state.data.select(ee.QX.Generators.rootsOfType(d.O.Molecule.Structure))
for(const i of r){const r=(null===(e=i.obj)||void 0===e?void 0:e.data)&&J.Structure.Index.get(null===(t=i.obj)||void 0===t?void 0:t.data).value
void 0!==r&&r>n&&(n=r)}return n}get asymIdOffset(){var e
let t=0,n=0
const r=this.ctx.state.data.select(ee.QX.Generators.rootsOfType(d.O.Molecule.Model))
for(const i of r){const r=null===(e=i.obj)||void 0===e?void 0:e.data
if(r){const e=J.Model.AsymIdCount.get(r),i=J.Model.AsymIdOffset.get(r).value
void 0!==e&&void 0!==i&&(t=Math.max(t,i.auth+e.auth),n=Math.max(n,i.label+e.label))}}return{auth:t,label:n}}setModelMaxIndex(){var e
const t=this.maxModelIndex,n=this.ctx.state.data.select(ee.QX.Generators.rootsOfType(d.O.Molecule.Model))
for(const r of n){const n=null===(e=r.obj)||void 0===e?void 0:e.data
n&&J.Model.MaxIndex.get(n).value!==t&&J.Model.MaxIndex.set(n,{value:t},t)}}setStructureMaxIndex(){var e
const t=this.maxModelIndex,n=this.ctx.state.data.select(ee.QX.Generators.rootsOfType(d.O.Molecule.Structure))
for(const r of n){const n=null===(e=r.obj)||void 0===e?void 0:e.data
n&&J.Structure.MaxIndex.get(n).value!==t&&J.Structure.MaxIndex.set(n,{value:t},t)}}handleModel(e,t){if(void 0===J.Model.Index.get(e).value){const n=t&&J.Model.Index.get(t).value,r=null!=n?n:this.maxModelIndex+1
J.Model.Index.set(e,{value:r},r)}if(void 0===J.Model.AsymIdOffset.get(e).value){const n=t&&J.Model.AsymIdOffset.get(t).value,r=null!=n?n:{...this.asymIdOffset}
J.Model.AsymIdOffset.set(e,{value:r},r)}}handleStructure(e,t){if(void 0!==e.parent)return
if(void 0!==J.Structure.Index.get(e).value)return
const n=t&&J.Structure.Index.get(t).value,r=null!=n?n:this.maxStructureIndex+1
J.Structure.Index.set(e,{value:r},r)}handle(e,t,n){d.O.Molecule.Structure.is(t)?this.ctx.state.data.tree.transforms.get(e).transformer.definition.isDecorator||void 0!==t.data.parent||this.handleStructure(t.data,null==n?void 0:n.data):d.O.Molecule.Model.is(t)&&(this.ctx.state.data.tree.transforms.get(e).transformer.definition.isDecorator||this.handleModel(t.data,null==n?void 0:n.data))}register(){this.ctx.customModelProperties.register(J.Model.AsymIdOffset,!0),this.ctx.customModelProperties.register(J.Model.Index,!0),this.ctx.customModelProperties.register(J.Model.MaxIndex,!0),this.ctx.customStructureProperties.register(J.Structure.Index,!0),this.ctx.customStructureProperties.register(J.Structure.MaxIndex,!0),this.subscribeObservable(this.ctx.state.data.events.object.created,e=>{this.handle(e.ref,e.obj),this.setModelMaxIndex(),this.setStructureMaxIndex()}),this.subscribeObservable(this.ctx.state.data.events.object.updated,e=>{this.handle(e.ref,e.obj,e.oldObj)})}unregister(){this.ctx.customModelProperties.unregister(J.Model.AsymIdOffset.descriptor.name),this.ctx.customModelProperties.unregister(J.Model.Index.descriptor.name),this.ctx.customModelProperties.unregister(J.Model.MaxIndex.descriptor.name),this.ctx.customStructureProperties.unregister(J.Structure.Index.descriptor.name),this.ctx.customStructureProperties.unregister(J.Structure.MaxIndex.descriptor.name)}}})
var ne=n(70292)
const re=[-1,1.76,1.87,1.65,1.5,1.4,1.85,1.8,1.6,1.4],ie={ALA:121,ARG:265,ASN:187,ASP:187,CYS:148,GLU:214,GLN:214,GLY:97,HIS:216,ILE:195,LEU:191,LYS:230,MET:203,PHE:228,PRO:154,SER:143,THR:163,TRP:264,TYR:255,VAL:165}
var oe=n(8507),ae=n(87095),se=n(87933),le=n(44688),ce=n(13686)
function ue(e,t,n){switch(t){case"O":return 5
case"S":return 6
case"N":return"NZ"===e?4:3
case"C":switch(e){case"C":case"CE1":case"CE2":case"CE3":case"CH2":case"CZ":case"CZ2":case"CZ3":return 1
case"CA":case"CB":case"CE":case"CG1":case"CG2":return 2
default:switch(n){case"PHE":case"TRP":case"TYR":case"HIS":case"ASP":case"ASN":return 1
case"PRO":case"LYS":case"ARG":case"MET":case"ILE":case"LEU":return 2
case"GLU":case"GLN":return"CD"===e?1:2}}}return pe(t)}function de(e,t,n){switch(t){case"C":return 7
case"N":return 8
case"P":return 9
case"O":return 5}return pe(t)}function pe(e){const t=(0,se.sO)(e)
let n=re.indexOf(t)
return-1===n&&(n=re.length,re[n]=t),n}function he(e,t,n){const{structure:r,atomRadiusType:i,serialResidueIndex:o,area:a,spherePoints:s,scalingConstant:l,maxLookupRadius:c,probeSize:u}=e,{lookup3d:d,serialMapping:p,unitIndexMap:h,units:f}=r,{cumulativeUnitElementCount:m,elementIndices:g,unitIndices:y}=p
for(let v=t;v<n;++v){const e=re[i[v]]
if(e===re[0])continue
const t=f[y[v]],n=g[v],r=t.conformation.x(n),p=t.conformation.y(n),b=t.conformation.z(n),{count:x,units:S,indices:_,squaredDistances:C}=d.find(r,p,b,c),w=u+e,T=u+w,A=[]
for(let o=0;o<x;++o){const e=S[o],a=m[h.get(e.id)]+_[o],s=g[a],l=re[i[a]]
if(t===e&&n===s||l===re[0])continue
const c=u+l
if(C[o]<(T+l)*(T+l)){const t=g[a]
A[A.length]=[C[o],(C[o]+w*w-c*c)/(2*w),e.conformation.x(t)-r,e.conformation.y(t)-p,e.conformation.z(t)-b]}}A.sort((e,t)=>e[0]-t[0])
let I=0
e:for(let i=0;i<s.length;++i){const[e,t,n]=s[i]
for(let r=0;r<A.length;++r){const[,i,o,a,s]=A[r]
if(e*o+t*a+n*s>i)continue e}++I}a[o[v]]+=l*I*w*w}}var fe=n(67538)
const me={numberOfSpherePoints:E.t.Numeric(92,{min:12,max:360,step:1},{description:"Number of sphere points to sample per atom: 92 (original paper), 960 (BioJava), 3000 (EPPIC) - see Shrake A, Rupley JA: Environment and exposure to solvent of protein atoms. Lysozyme and insulin. J Mol Biol 1973."}),probeSize:E.t.Numeric(1.4,{min:.1,max:4,step:.01},{description:"Corresponds to the size of a water molecule: 1.4 (original paper), 1.5 (occassionally used)"}),nonPolymer:E.t.Boolean(!1,{description:"Include non-polymer atoms as occluders."}),traceOnly:E.t.Boolean(!1,{description:"Compute only using alpha-carbons, if true increase probeSize accordingly (e.g., 4 A). Considers only canonical amino acids."})}
var ge
!function(e){function t(e){const t=[],n=Math.PI*(3-Math.sqrt(5)),r=2/e
for(let i=0;i<e;++i){const e=i*r-1+r/2,o=Math.sqrt(1-e*e),a=i*n
t[t.length]=R.eB.create(Math.cos(a)*o,e,Math.sin(a)*o)}return t}let n
function r(e,t){return t/(ie[e]||121)}function i(e,t){const{area:n,serialResidueIndex:r}=t,i=r[fe.X9.indexOf(fe.X9.ofSortedArray(e.structure.root.serialMapping.elementIndices),e.element)]
return-1===i?-1:n[i]}function o(e,t){const n=i(e,t)
return-1===n?-1:r(J.StructureProperties.atom.label_comp_id(e),n)}e.compute=function(e,n={}){const r={...E.t.getDefaultValues(me),...n}
return ne.Task.create("Compute Accessible Surface Area",async n=>await async function(e,n,r){const i=function(e,n){const{elementCount:r,atomicResidueCount:i}=e,{probeSize:o,nonPolymer:a,traceOnly:s,numberOfSpherePoints:l}=n
return{structure:e,probeSize:o,nonPolymer:a,traceOnly:s,spherePoints:t(l),scalingConstant:4*Math.PI/l,maxLookupRadius:2*n.probeSize+2*re[2],atomRadiusType:new Int8Array(r),serialResidueIndex:new Int32Array(r),area:new Float32Array(i)}}(n,r);(function(e){const{key:t}=le.ZP.residue,{type_symbol:n,label_atom_id:r,label_comp_id:i}=le.ZP.atom,{structure:o,atomRadiusType:a,serialResidueIndex:s}=e,l=le.iZ.Location.create(o)
let c=0,u=0,d=-1
l.structure=o
for(let p=0,h=0,f=o.units.length;p<f;++p){const f=o.units[p],{elements:m}=f
l.unit=f,c=-1
for(let o=0,p=m.length;o<p;++o){const p=m[o],g=h+o
l.element=p,u=t(l),c!==u&&++d,c=u
const y=n(l),v=(0,oe.Yd)(y)
if((0,oe.v3)(v)){a[g]=0,s[g]=-1
continue}const b=r(l),x=(0,ce.Ju)(f,p)
if(x===ae.MoleculeType.Water||!e.nonPolymer&&!(0,ae.isPolymer)(x)){a[g]=0,s[g]=-1
continue}const S=i(l)
!e.traceOnly||("CA"===b||"BB"===b)&&ie[S]?((0,ae.isNucleic)(x)?a[g]=de(0,y):x===ae.MoleculeType.Protein?a[g]=ue(b,y,S):a[g]=pe(y),s[g]=d):(a[g]=0,s[g]=d)}h+=m.length}})(i),await async function(e,t){const{atomRadiusType:n}=t
for(let r=0;r<n.length;r+=5e3)e.shouldUpdate&&await e.update({message:"Computing per residue surface accessibility...",current:r,max:n.length}),he(t,r,Math.min(r+5e3,n.length))}(e,i)
const{area:o,serialResidueIndex:a}=i
return{area:o,serialResidueIndex:a}}(n,e,r))},function(e){e[e.NA=0]="NA",e[e.Buried=1]="Buried",e[e.Accessible=2]="Accessible"}(n=e.Flags||(e.Flags={})),e.Flag={NA:n.NA,Buried:n.Buried,Accessible:n.Accessible},e.normalize=r,e.getValue=i,e.getNormalizedValue=o,e.getFlag=function(e,t){const r=o(e,t)
return-1===r?n.NA:r<.16?n.Buried:n.Accessible}}(ge||(ge={}))
var ye=n(76840),ve=n(85554),be=n(6941),xe=n(32773),Se=n(33205)
const _e={...me},Ce={isBuried:ve.Bg.Dynamic((0,be.vy)("computed","accessible-surface-area.is-buried",xe.Z.Bool),e=>{if(!J.Unit.isAtomic(e.element.unit))return!1
const t=we.get(e.element.structure).value
return!!t&&ge.getFlag(e.element,t)===ge.Flags.Buried}),isAccessible:ve.Bg.Dynamic((0,be.vy)("computed","accessible-surface-area.is-accessible",xe.Z.Bool),e=>{if(!J.Unit.isAtomic(e.element.unit))return!1
const t=we.get(e.element.structure).value
return!!t&&ge.getFlag(e.element,t)===ge.Flags.Accessible})},we=ye.S.createProvider({label:"Accessible Surface Area",descriptor:(0,Se.e)({name:"molstar_accessible_surface_area",symbols:Ce}),type:"root",defaultParams:_e,getParams:e=>_e,isApplicable:e=>!0,obtain:async(e,t,n)=>{const r={...E.t.getDefaultValues(_e),...n}
return{value:await ge.compute(t,r).runInContext(e.runtime)}}})
var Te=n(54749),Ae=n(70012),Ie=n(93076)
const Pe=(0,Te.Color)(16448250),Be={list:E.t.ColorList("yellow-green-blue",{presetKind:"scale"})},Ee={name:"accessible-surface-area",label:"Accessible Surface Area",category:Ie.N.Residue,factory:function e(t,n){let r
const i=Te.ColorScale.create({listOrName:n.list.colors,minLabel:"buried",maxLabel:"exposed",domain:[0,1]}),o=t.structure&&we.get(t.structure),a=o?(0,Ae.vb)(o.id,o.version):-1
if((null==o?void 0:o.value)&&t.structure){const e=J.StructureElement.Location.create(t.structure),n=o.value,a=e=>{const t=ge.getNormalizedValue(e,n)
return-1===t?Pe:i.color(t)}
r=t=>J.StructureElement.Location.is(t)&&J.Unit.isAtomic(t.unit)?a(t):J.Bond.isLocation(t)?(e.unit=t.aUnit,e.element=t.aUnit.elements[t.aIndex],a(e)):Pe}else r=()=>Pe
return{factory:e,granularity:"group",preferSmoothing:!0,color:r,props:n,contextHash:a,description:"Assigns a color based on the relative accessible surface area of a residue.",legend:i?i.legend:void 0}},getParams:function(e){return Be},defaultValues:E.t.getDefaultValues(Be),isApplicable:e=>!!e.structure,ensureCustomProperties:{attach:(e,t)=>t.structure?we.attach(e,t.structure,void 0,!0):Promise.resolve(),detach:e=>e.structure&&we.ref(e.structure,!1)}}
var ke=n(63356),De=n(66187),Me=n(99302)
const Re=c.A.create({name:"computed-accessible-surface-area-prop",category:"custom-props",display:{name:"Accessible Surface Area"},ctor:class extends c.A.Handler{constructor(){super(...arguments),this.provider=we,this.labelProvider={label:e=>{if(this.params.showTooltip)return function(e){if("element-loci"===e.kind){if(0===e.elements.length)return
const t=we.get(e.structure).value
if(!t||e.structure.customPropertyDescriptors.hasReference(we.descriptor))return
const{getSerialIndex:n}=e.structure.root.serialMapping,{area:r,serialResidueIndex:i}=t,o=new Set
let a=0
for(const{indices:s,unit:l}of e.elements){const{elements:e}=l
fe.CD.forEach(s,t=>{const s=i[n(l,e[t])];-1===s||o.has(s)||(a+=r[s],o.add(s))})}if(0===o.size)return
return`Accessible Surface Area <small>(${o.size} ${o.size>1?"Residues sum":"Residue"})</small>: ${a.toFixed(2)} <sup>2</sup>`}if("structure-loci"===e.kind){const t=we.get(e.structure).value
if(!t||e.structure.customPropertyDescriptors.hasReference(we.descriptor))return
return`Accessible Surface Area <small>(Whole Structure)</small>: ${(0,ke.jJ)(t.area).toFixed(2)} <sup>2</sup>`}}(e)}}}update(e){const t=this.params.autoAttach!==e.autoAttach||this.params.showTooltip!==e.showTooltip
return this.params.autoAttach=e.autoAttach,this.params.showTooltip=e.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),t}register(){ve.oY.addCustomProp(this.provider.descriptor),this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(Ee),this.ctx.managers.lociLabels.addProvider(this.labelProvider),this.ctx.query.structure.registry.add(Oe),this.ctx.query.structure.registry.add(Le)}unregister(){ve.oY.removeCustomProp(this.provider.descriptor),this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(Ee),this.ctx.managers.lociLabels.removeProvider(this.labelProvider),this.ctx.query.structure.registry.remove(Oe),this.ctx.query.structure.registry.remove(Le)}},params:()=>({autoAttach:E.t.Boolean(!1),showTooltip:E.t.Boolean(!0)})}),Oe=(0,De.StructureSelectionQuery)("Buried Protein Residues",Me.MolScriptBuilder.struct.modifier.union([Me.MolScriptBuilder.struct.modifier.wholeResidues([Me.MolScriptBuilder.struct.modifier.union([Me.MolScriptBuilder.struct.generator.atomGroups({"chain-test":Me.MolScriptBuilder.core.rel.eq([Me.MolScriptBuilder.ammp("objectPrimitive"),"atomistic"]),"residue-test":Ce.isBuried.symbol()})])])]),{description:"Select buried protein residues.",category:De.StructureSelectionCategory.Residue,ensureCustomProperties:(e,t)=>we.attach(e,t)}),Le=(0,De.StructureSelectionQuery)("Accessible Protein Residues",Me.MolScriptBuilder.struct.modifier.union([Me.MolScriptBuilder.struct.modifier.wholeResidues([Me.MolScriptBuilder.struct.modifier.union([Me.MolScriptBuilder.struct.generator.atomGroups({"chain-test":Me.MolScriptBuilder.core.rel.eq([Me.MolScriptBuilder.ammp("objectPrimitive"),"atomistic"]),"residue-test":Ce.isAccessible.symbol()})])])]),{description:"Select accessible protein residues.",category:De.StructureSelectionCategory.Residue,ensureCustomProperties:(e,t)=>we.attach(e,t)})
var Ne=n(88720),Fe=n(66588),ze=n(56294),je=n(7773),Ve=n(72996)
const Ue=c.A.create({name:"computed-interactions-prop",category:"custom-props",display:{name:"Interactions"},ctor:class extends c.A.Handler{constructor(){super(...arguments),this.provider=Ne.r,this.labelProvider={label:e=>{if(this.params.showTooltip&&"element-loci"===e.kind){if(0===e.elements.length)return
const t=[],n=this.getStructures(e.structure)
for(const r of n){const n=this.provider.get(r).value
if(!n)continue
const i=Fe.i.Loci.remap(e,r)
if(1!==i.elements.length)continue
const o=i.elements[0]
if(1!==fe.CD.size(o.indices))continue
const a=n.unitsFeatures.get(o.unit.id)
if(!a)continue
const s=[],l=[],c=[],u=fe.CD.start(o.indices),{types:d,groups:p,elementsIndex:{indices:h,offsets:f}}=a
for(let e=f[u],t=f[u+1];e<t;++e){const t=h[e],n=d[t],r=p[t]
n&&s.push((0,ze.XH)(n)),r&&l.push((0,ze.y9)(r))}s.length&&c.push(`<small>Types</small> ${s.join(", ")}`),l.length&&c.push(`<small>Groups</small> ${l.join(", ")}`),c.length&&t.push(`Interaction Feature: ${c.join(" | ")}`)}return t.length?t.join("<br/>"):void 0}}}}getStructures(e){const t=[],n=this.ctx.helpers.substructureParent.get(e)
if(n){const e=this.ctx.state.data.select(ee.QX.Generators.ofType(d.O.Molecule.Structure,n.transform.ref))
for(const n of e)n.obj&&(0,ke.Z2)(t,n.obj.data)}return t}update(e){const t=this.params.autoAttach!==e.autoAttach||this.params.showTooltip!==e.showTooltip
return this.params.autoAttach=e.autoAttach,this.params.showTooltip=e.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),t}register(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(je.YU),this.ctx.managers.lociLabels.addProvider(this.labelProvider),this.ctx.representation.structure.registry.add(Ve.MH)}unregister(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(je.YU),this.ctx.managers.lociLabels.removeProvider(this.labelProvider),this.ctx.representation.structure.registry.remove(Ve.MH)}},params:()=>({autoAttach:E.t.Boolean(!1),showTooltip:E.t.Boolean(!0)})})
var Ge=n(30897)
const He=c.A.create({name:"computed-secondary-structure-prop",category:"custom-props",display:{name:"Secondary Structure"},ctor:class extends c.A.Handler{constructor(){super(...arguments),this.provider=Ge.v}update(e){const t=this.params.autoAttach!==e.autoAttach
return this.params.autoAttach=e.autoAttach,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),t}register(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach)}unregister(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name)}},params:()=>({autoAttach:E.t.Boolean(!1)})})
var qe=n(11825),Qe=n(93362)
const $e=c.A.create({name:"computed-valence-model-prop",category:"custom-props",display:{name:"Valence Model"},ctor:class extends c.A.Handler{constructor(){super(...arguments),this.provider=qe.F,this.labelProvider={label:e=>{if(this.params.showTooltip&&"element-loci"===e.kind){if(0===e.elements.length)return
const t=[],n=this.getStructures(e.structure)
for(const r of n){const n=this.provider.get(r).value
if(!n)continue
const i=J.StructureElement.Loci.remap(e,r)
if(1!==i.elements.length)continue
const o=i.elements[0]
if(1!==fe.CD.size(o.indices))continue
const a=n.get(o.unit.id)
if(!a)continue
const s=fe.CD.start(o.indices),l=a.charge[s],c=a.idealGeometry[s],u=a.implicitH[s],d=a.totalH[s]
t.push(`Valence Model: <small>Charge</small> ${l} | <small>Ideal Geometry</small> ${(0,Qe.Fc)(c)} | <small>Implicit H</small> ${u} | <small>Total H</small> ${d}`)}return t.length?t.join("<br/>"):void 0}}}}getStructures(e){const t=[],n=this.ctx.helpers.substructureParent.get(e)
if(n){const e=this.ctx.state.data.select(ee.QX.Generators.ofType(d.O.Molecule.Structure,n.transform.ref))
for(const n of e)n.obj&&(0,ke.Z2)(t,n.obj.data)}return t}update(e){const t=this.params.autoAttach!==e.autoAttach||this.params.showTooltip!==e.showTooltip
return this.params.autoAttach=e.autoAttach,this.params.showTooltip=e.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),t}register(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.managers.lociLabels.addProvider(this.labelProvider)}unregister(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.managers.lociLabels.removeProvider(this.labelProvider)}},params:()=>({autoAttach:E.t.Boolean(!1),showTooltip:E.t.Boolean(!0)})})
var Xe=n(40615),We=n(96561)
const Ye=(0,Te.Color)(16448250),Ze=new Map,Ke={...(0,We.U)({type:"colors",colorList:"set-1"})},Je={name:"sifts-mapping",label:"SIFTS Mapping",category:Ie.N.Residue,factory:function e(t,n){let r
if(t.structure){for(const n of t.structure.models){const e=Xe.W.Provider.get(n).value
if(e)for(const t of e.accession)t&&!Ze.has(t)&&Ze.set(t,Ze.size)}const e=J.StructureElement.Location.create(t.structure),i=(0,We.S)(Ze.size+1,n,{valueLabel:e=>`${e}`}),o=new Map,a=e=>{const t=Xe.W.getKey(e)
if(!t)return Ye
if(o.has(t))return o.get(t)
const n=i.color(Ze.get(t))
return o.set(t,n),n}
r=t=>J.StructureElement.Location.is(t)&&J.Unit.isAtomic(t.unit)?a(t):J.Bond.isLocation(t)?(e.unit=t.aUnit,e.element=t.aUnit.elements[t.aIndex],a(e)):Ye}else r=()=>Ye
return{factory:e,granularity:"group",preferSmoothing:!0,color:r,props:n,description:"Assigns a color based on SIFTS mapping."}},getParams:function(e){return Ke},defaultValues:E.t.getDefaultValues(Ke),isApplicable:e=>{var t
return!!(null===(t=e.structure)||void 0===t?void 0:t.models.some(e=>Xe.W.Provider.isApplicable(e)))},ensureCustomProperties:{attach:async(e,t)=>{if(t.structure)for(const n of t.structure.models)await Xe.W.Provider.attach(e,n,void 0,!0)},detach:e=>{if(e.structure)for(const t of e.structure.models)Xe.W.Provider.ref(t,!1)}}},et=c.A.create({name:"sifts-mapping-prop",category:"custom-props",display:{name:"SIFTS Mapping"},ctor:class extends c.A.Handler{constructor(){super(...arguments),this.provider=Xe.W.Provider,this.labelProvider={label:e=>{if(this.params.showTooltip)return function(e){if("element-loci"===e.kind){if(0===e.elements.length)return
const t=e.elements[0],n=t.unit,r=J.StructureElement.Location.create(e.structure,n,n.elements[fe.CD.getAt(t.indices,0)])
return Xe.W.getLabel(r)}}(e)}}}update(e){const t=this.params.autoAttach!==e.autoAttach||this.params.showTooltip!==e.showTooltip
return this.params.autoAttach=e.autoAttach,this.params.showTooltip=e.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),t}register(){this.ctx.customModelProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(Je),this.ctx.managers.lociLabels.addProvider(this.labelProvider)}unregister(){this.ctx.customModelProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(Je),this.ctx.managers.lociLabels.removeProvider(this.labelProvider)}},params:()=>({autoAttach:E.t.Boolean(!0),showTooltip:E.t.Boolean(!0)})})
var tt,nt=n(92726)
!function(e){e.Descriptor={name:"ihm_cross_link_restraint"},e.Provider=nt.q.create(e.Descriptor),e.fromTable=function(e,t){const n={entity_id:e.entity_id_1,asym_id:e.asym_id_1,seq_id:e.seq_id_1,atom_id:e.atom_id_1},r={entity_id:e.entity_id_2,asym_id:e.asym_id_2,seq_id:e.seq_id_2,atom_id:e.atom_id_2}
function i(e,t,n){const r=e.get(t)
r?r.push(n):e.set(t,[n])}function o(n,r){const o=r.entity_id.value(n),c=r.asym_id.value(n),u=r.seq_id.value(n)
if("by-atom"===e.model_granularity.value(n)){const e=t.atomicHierarchy.index.findAtom({auth_seq_id:u,label_asym_id:c,label_atom_id:r.atom_id.value(n),label_entity_id:o})
e>=0&&i(a,e,n)}else if(t.coarseHierarchy.isDefined){const e=t.coarseHierarchy.spheres.findSequenceKey(o,c,u)
if(e>=0)i(s,e,n)
else{const e=t.coarseHierarchy.gaussians.findSequenceKey(o,c,u)
e>=0&&i(l,e,n)}}}const a=new Map,s=new Map,l=new Map,c=[]
for(let u=0;u<e._rowCount;++u)o(u,n),o(u,r)
return{getIndicesByElement:(e,t)=>{const n=function(e){switch(e){case J.Unit.Kind.Atomic:return a
case J.Unit.Kind.Spheres:return s
case J.Unit.Kind.Gaussians:return l}}(t),r=n.get(e)
return void 0!==r?r:c},data:e}}}(tt||(tt={}))
var rt=n(717),it=n(16625),ot=n(10596),at=n(81871),st=n(66044),lt=n(62837),ct=n(32751)
const ut=[]
function dt(e,t,n,r){return`${e}|${t.id}|${n}|${r.id}`}class pt{getPairIndices(e,t,n,r){const i=dt(e,t,n,r)
return this.pairKeyIndices.get(i)||ut}getPairs(e,t,n,r){return this.getPairIndices(e,t,n,r).map(e=>this.pairs[e])}constructor(e){this.pairs=e
const t=new Map
this.pairs.forEach((e,n)=>{const r=dt(e.indexA,e.unitA,e.indexB,e.unitB),i=t.get(r)
i?i.push(n):t.set(r,[n])}),this.count=e.length,this.pairKeyIndices=t}}var ht=n(16159),ft=n(25919),mt=n(83748)
const gt=ye.S.createProvider({label:"Cross Link Restraint",descriptor:(0,Se.e)({name:"integrative-cross-link-restraint"}),type:"local",defaultParams:{},getParams:e=>({}),isApplicable:e=>e.models.some(e=>!!tt.Provider.get(e)),obtain:async(e,t,n)=>({value:_t(t)})})
var yt
function vt(e,t,n){const{elements:r}=t,i=r.length,o=t.kind
for(let a=0;a<i;a++){const t=r[a]
n.getIndicesByElement(t,o).forEach(t=>e.set(t,a))}}function bt(e,t,n){if(t.model!==n.model)return
if("mmCIF"!==t.model.sourceData.kind)return
const r=tt.Provider.get(t.model)
if(!r)return
const i=new Map,o=new Map
vt(i,t,r),vt(o,n,r),i.forEach((i,a)=>{const s=o.get(a)
void 0!==s&&e.push(St(t,i,n,s,r,a),St(n,s,t,i,r,a))})}function xt(e,t){if("mmCIF"!==t.model.sourceData.kind)return
const n=tt.Provider.get(t.model)
if(!n)return
const{elements:r}=t,i=r.length,o=t.kind,a=new Map
for(let s=0;s<i;s++){const e=r[s]
n.getIndicesByElement(e,o).forEach(e=>{const t=a.get(e)
t?t.push(s):a.set(e,[s])})}a.forEach((r,i)=>{if(r.length<2)return
const[o,a]=r
e.push(St(t,o,t,a,n,i),St(t,a,t,o,n,i))})}function St(e,t,n,r,i,o){return{unitA:e,indexA:t,unitB:n,indexB:r,restraintType:i.data.restraint_type.value(o),distanceThreshold:i.data.distance_threshold.value(o),psi:i.data.psi.value(o),sigma1:i.data.sigma_1.value(o),sigma2:i.data.sigma_2.value(o)}}function _t(e){const t=[]
if(!e.models.some(e=>tt.Provider.get(e)))return new pt(t)
const n=e.units.length
for(let r=0;r<n;++r){const i=e.units[r]
xt(t,i)
for(let o=r+1;o<n;++o){const n=e.units[o]
i.model===n.model&&bt(t,i,n)}}return new pt(t)}!function(e){let t
!function(e){e.CrossLinkRestraint="cross-link-restraint"}(t=e.Tag||(e.Tag={})),e.isApplicable=function(e){return e.models.some(e=>!!tt.Provider.get(e))}
const n=(0,R.eB)(),r=(0,R.eB)()
function i(e){return e.unitA.conformation.position(e.unitA.elements[e.indexA],n),e.unitB.conformation.position(e.unitB.elements[e.indexB],r),R.eB.distance(n,r)}function o(e,t){const n=e.pairs[t]
return`Cross Link Restraint | Type: ${n.restraintType} | Threshold: ${n.distanceThreshold}  | Psi: ${n.psi} | Sigma 1: ${n.sigma1} | Sigma 2: ${n.sigma2} | Distance: ${i(n).toFixed(2)} `}function a(e,t,n){return ft.p.fromPairProvider(t.length,(n,r,i)=>{const o=e.pairs[t[n]]
o.unitA.conformation.position(o.unitA.elements[o.indexA],r),o.unitB.conformation.position(o.unitB.elements[o.indexB],i)},n)}function s(e,t,n){const r=n[0]
if(void 0===r)return""
const i=t.pairs[r]
return[o(t,r),(0,mt.CR)(J.Bond.Location(e,i.unitA,i.indexA,e,i.unitB,i.indexB))].join("</br>")}e.distance=i,e.Location=function(e,t,n){return(0,ht.cG)("cross-link-restraints",{structure:t,crossLinkRestraints:e},n)},e.isLocation=function(e){return!!e&&"data-location"===e.kind&&"cross-link-restraints"===e.tag},e.areLocationsEqual=function(e,t){return e.data.structure===t.data.structure&&e.data.crossLinkRestraints===t.data.crossLinkRestraints&&e.element===t.element},e.locationLabel=function(e){return o(e.data.crossLinkRestraints,e.element)},e.Loci=function(e,t,n){return(0,B.DataLoci)("cross-link-restraints",{structure:e,crossLinkRestraints:t},n,e=>a(t,n,e),()=>s(e,t,n))},e.isLoci=function(e){return!!e&&"data-loci"===e.kind&&"interactions"===e.tag},e.getBoundingSphere=a,e.getLabel=s}(yt||(yt={}))
var Ct=n(14294)
function wt(e,t,n,r,i){const o=gt.get(t).value
if(!o.count)return ot.e.createEmpty(i)
const{sizeFactor:a}=r,s=J.StructureElement.Location.create(t),l={linkCount:o.count,position:(e,t,n)=>{const r=o.pairs[n],i=r.unitA,a=r.unitB
i.conformation.position(i.elements[r.indexA],e),a.conformation.position(a.elements[r.indexB],t)},radius:e=>{const t=o.pairs[e]
return s.unit=t.unitA,s.element=t.unitA.elements[t.indexA],n.size.size(s)*a}},{mesh:c,boundingSphere:u}=(0,st.C1)(e,l,r,i)
if(u)c.setBoundingSphere(u)
else if(c.triangleCount>0){const e=Ct.f8.expand((0,Ct.f8)(),t.boundary.sphere,1*a)
c.setBoundingSphere(e)}return c}const Tt={...lt.EN,...st.Lr,sizeFactor:E.t.Numeric(.5,{min:0,max:10,step:.1})}
function At(e){return(0,lt.wA)({defaultProps:E.t.getDefaultValues(Tt),createGeometry:wt,createLocationIterator:It,getLoci:Pt,eachLocation:Bt,setUpdateState:(e,t,n)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.radialSegments!==n.radialSegments||t.linkCap!==n.linkCap}},e)}function It(e){const t=gt.get(e).value,{pairs:n}=t,r=n.length,i=yt.Location(t,e)
return(0,at.iQ)(r,1,1,e=>(i.element=e,i),!0)}function Pt(e,t,n){const{objectId:r,groupId:i}=e
if(n===r){const e=gt.get(t).value
if(e.pairs[i])return yt.Loci(t,e,[i])}return B.EmptyLoci}function Bt(e,t,n){let r=!1
if(yt.isLoci(e)){if(!J.Structure.areEquivalent(e.data.structure,t))return!1
const i=gt.get(t).value
if(e.data.crossLinkRestraints!==i)return!1
for(const t of e.elements)n(fe.IX.ofSingleton(t))&&(r=!0)}return r}const Et={"cross-link-restraint":(e,t)=>(0,ct.Kp)("Cross-link restraint",e,t,At)},kt={...Tt},Dt=(0,ct.GT)({name:yt.Tag.CrossLinkRestraint,label:"Cross Link Restraint",description:"Displays cross-link restraints.",factory:function(e,t){return it.YL.createMulti("CrossLinkRestraint",e,t,ct.J1,Et)},getParams:function(e,t){return E.t.clone(kt)},defaultValues:E.t.getDefaultValues(kt),defaultColorTheme:{name:yt.Tag.CrossLinkRestraint},defaultSizeTheme:{name:"uniform"},isApplicable:e=>yt.isApplicable(e),ensureCustomProperties:{attach:(e,t)=>gt.attach(e,t,void 0,!0),detach:e=>gt.ref(e,!1)}}),Mt=(0,Te.Color)(13421772),Rt={domain:E.t.Interval([.5,1.5],{step:.01}),list:E.t.ColorList("red-grey",{presetKind:"scale"})},Ot={name:"cross-link",label:"Cross Link",category:Ie.N.Misc,factory:function e(t,n){let r,i
const o=t.structure&&gt.get(t.structure).value
if(o){i=Te.ColorScale.create({domain:n.domain,listOrName:n.list.colors})
const e=i.color
r=t=>{if(yt.isLocation(t)){const n=o.pairs[t.element]
if(n)return e(yt.distance(n)/n.distanceThreshold)}return Mt}}else r=()=>Mt
return{factory:e,granularity:"group",color:r,props:n,description:"Colors cross-links by the deviation of the observed distance versus the modeled distance (e.g. modeled / `ihm_cross_link_restraint.distance_threshold`).",legend:i?i.legend:void 0}},getParams:function(e){return Rt},defaultValues:E.t.getDefaultValues(Rt),isApplicable:e=>!!e.structure&&yt.isApplicable(e.structure),ensureCustomProperties:{attach:(e,t)=>t.structure?gt.attach(e,t.structure,void 0,!0):Promise.resolve(),detach:e=>e.structure&&gt.ref(e.structure,!1)}},Lt=c.A.create({name:"integrative-cross-link-restraint",category:"custom-props",display:{name:"Cross Link Restraint"},ctor:class extends c.A.Handler{constructor(){super(...arguments),this.provider=tt.Provider}register(){this.provider.formatRegistry.add("mmCIF",Nt),this.ctx.representation.structure.themes.colorThemeRegistry.add(Ot),this.ctx.representation.structure.registry.add(Dt)}unregister(){this.provider.formatRegistry.remove("mmCIF"),this.ctx.representation.structure.themes.colorThemeRegistry.remove(Ot),this.ctx.representation.structure.registry.remove(Dt)}}})
function Nt(e){if(!rt.K4.is(e.sourceData))return
const{ihm_cross_link_restraint:t}=e.sourceData.data.db
return 0!==t._rowCount?tt.fromTable(t,e):void 0}const Ft={State:u,Representation:r,Camera:i,Misc:o},zt={Representation:P,Camera:a,State:s,CustomProps:l}},41736(e,t,n){"use strict"
n.d(t,{N:()=>i,v:()=>o})
var r=n(80012)
function i(e){return e}function o(e,t){if("bcif"===e.ext)try{const e=(0,r.J)(t)
if(e.encoder.startsWith("VolumeServer"))return"dscif"
if(e.encoder.startsWith("volseg-volume-server"))return"segcif"
if(s(e,"volume_data_3d_info")){if(s(e,"volume_data_3d"))return"dscif"
if(s(e,"segmentation_data_3d"))return"segcif"}}catch(e){console.error(e)}else if("cif"===e.ext){const e=t
if(e.startsWith("data_SERVER\n#\n_density_server_result"))return"dscif"
if(e.startsWith("data_SERVER\n#\ndata_SEGMENTATION_DATA"))return"segcif"
if(a(e,"volume_data_3d_info")){if(a(e,"volume_data_3d"))return"dscif"
if(a(e,"segmentation_data_3d"))return"segcif"}if(e.includes("atom_site_fract_x")||e.includes("atom_site.fract_x"))return"coreCif"}return-1}function a(e,t){return e.includes(`_${t}.`)}function s(e,t){for(const n of e.dataBlocks)for(const e of n.categories)if(e.name===t)return!0
return!1}},42095(e,t,n){"use strict"
n.d(t,{q:()=>r})
var r,i=n(39250),o=n(69755)
!function(e){function t(e,t,i){const o=function(e,t,n){const r=[]
for(let o=0;o<t.length;o++)r[o]=t[t.length-o-1]
const i=[1]
for(let o=1;o<e.length;o++)i[o]=e[r[o-1]]
return{dimensions:e,axisOrderFastToSlow:r,axisOrderSlowToFast:t,accessDimensions:i,defaultCtor:n||Float64Array}}(e,t,i),{get:a,set:s,add:l,dataOffset:c,getCoords:u}=n(o)
return{rank:e.length,dimensions:e,axisOrderSlowToFast:t,create:r(o),get:a,set:s,add:l,dataOffset:c,getCoords:u}}function n(e){const{dimensions:t,axisOrderFastToSlow:n}=e
switch(t.length){case 1:return{get:(e,t)=>e[t],set:(e,t,n)=>e[t]=n,add:(e,t,n)=>e[t]+=n,dataOffset:e=>e,getCoords:(e,t)=>(t[0]=e,t)}
case 2:if(0===n[0]&&1===n[1]){const e=t[0]
return{get:(t,n,r)=>t[r*e+n],set:(t,n,r,i)=>t[r*e+n]=i,add:(t,n,r,i)=>t[r*e+n]+=i,dataOffset:(t,n)=>n*e+t,getCoords:(t,n)=>(n[0]=t%e,n[1]=Math.floor(t/e),n)}}if(1===n[0]&&0===n[1]){const e=t[1]
return{get:(t,n,r)=>t[n*e+r],set:(t,n,r,i)=>t[n*e+r]=i,add:(t,n,r,i)=>t[n*e+r]+=i,dataOffset:(t,n)=>t*e+n,getCoords:(t,n)=>(n[0]=Math.floor(t/e),n[1]=t%e,n)}}throw new Error("bad axis order")
case 3:if(0===n[0]&&1===n[1]&&2===n[2]){const e=t[0],n=t[1],r=e*n
return{get:(t,n,i,o)=>t[n+i*e+o*r],set:(t,n,i,o,a)=>t[n+i*e+o*r]=a,add:(t,n,i,o,a)=>t[n+i*e+o*r]+=a,dataOffset:(t,n,i)=>t+n*e+i*r,getCoords:(t,r)=>{const i=Math.floor(t/e)
return r[0]=t%e,r[1]=i%n,r[2]=Math.floor(i/n),r}}}if(0===n[0]&&2===n[1]&&1===n[2]){const e=t[0],n=t[2],r=e*n
return{get:(t,n,i,o)=>t[n+o*e+i*r],set:(t,n,i,o,a)=>t[n+o*e+i*r]=a,add:(t,n,i,o,a)=>t[n+o*e+i*r]+=a,dataOffset:(t,n,i)=>t+i*e+n*r,getCoords:(t,r)=>{const i=Math.floor(t/e)
return r[0]=t%e,r[1]=Math.floor(i/n),r[2]=i%n,r}}}if(1===n[0]&&0===n[1]&&2===n[2]){const e=t[1],n=t[0],r=e*n
return{get:(t,n,i,o)=>t[i+n*e+o*r],set:(t,n,i,o,a)=>t[i+n*e+o*r]=a,add:(t,n,i,o,a)=>t[i+n*e+o*r]+=a,dataOffset:(t,n,i)=>n+t*e+i*r,getCoords:(t,r)=>{const i=Math.floor(t/e)
return r[0]=i%n,r[1]=t%e,r[2]=Math.floor(i/n),r}}}if(1===n[0]&&2===n[1]&&0===n[2]){const e=t[1],n=t[2],r=e*n
return{get:(t,n,i,o)=>t[i+o*e+n*r],set:(t,n,i,o,a)=>t[i+o*e+n*r]=a,add:(t,n,i,o,a)=>t[i+o*e+n*r]+=a,dataOffset:(t,n,i)=>n+i*e+t*r,getCoords:(t,r)=>{const i=Math.floor(t/e)
return r[0]=Math.floor(i/n),r[1]=t%e,r[2]=i%n,r}}}if(2===n[0]&&0===n[1]&&1===n[2]){const e=t[2],n=t[0],r=e*n
return{get:(t,n,i,o)=>t[o+n*e+i*r],set:(t,n,i,o,a)=>t[o+n*e+i*r]=a,add:(t,n,i,o,a)=>t[o+n*e+i*r]+=a,dataOffset:(t,n,i)=>i+t*e+n*r,getCoords:(t,r)=>{const i=Math.floor(t/e)
return r[0]=i%n,r[1]=Math.floor(i/n),r[2]=t%e,r}}}if(2===n[0]&&1===n[1]&&0===n[2]){const e=t[2],n=t[1],r=e*n
return{get:(t,n,i,o)=>t[o+i*e+n*r],set:(t,n,i,o,a)=>t[o+i*e+n*r]=a,add:(t,n,i,o,a)=>t[o+i*e+n*r]+=a,dataOffset:(t,n,i)=>i+n*e+t*r,getCoords:(t,r)=>{const i=Math.floor(t/e)
return r[0]=Math.floor(i/n),r[1]=i%n,r[2]=t%e,r}}}throw new Error("bad axis order")
default:return{get:(t,...n)=>t[a(e,n)],set:(t,...n)=>t[a(e,n)]=n[n.length-1],add:(t,...n)=>t[a(e,n)]+=n[n.length-1],dataOffset:(...t)=>a(e,t),getCoords:(t,n)=>function(e,t,n){const{dimensions:r,axisOrderFastToSlow:i}=e,o=r.length
let a=t
for(let s=0;s<o;s++){const e=r[i[s]]
n[i[s]]=a%e,a=Math.floor(a/e)}return n[i[o+1]]=a,n}(e,t,n)}}}function r(e){const{dimensions:t}=e
let n=1
for(let r=0,i=t.length;r<i;r++)n*=t[r]
return t=>new(t||e.defaultCtor)(n)}function a(e,t){const{accessDimensions:n,axisOrderFastToSlow:r}=e,i=n.length-1
let o=n[i]*t[r[i]]
for(let a=i-1;a>=0;a--)o=(o+t[r[a]])*n[a]
return o}function s(e,t){const n=[]
for(let r=0;r<e.length;r++)n[r]=e[t[r]]
return n}e.create=function(e,t){return{space:e,data:t}},e.Space=t,e.Data1=function(e){return e},e.Vector=function(e,n){return t([e],[0],n)},e.ColumnMajorMatrix=function(e,n,r){return t([e,n],[1,0],r)},e.RowMajorMatrix=function(e,n,r){return t([e,n],[0,1],r)},e.toMat4=function(e,t,n){if(2!==t.rank)throw new Error("Invalid tensor rank")
const r=Math.min(4,t.dimensions[0]),o=Math.min(4,t.dimensions[1])
for(let a=0;a<r;a++)for(let r=0;r<o;r++)i.$.setValue(e,a,r,t.get(n,a,r))
return e},e.toMat3=function(e,t,n){if(2!==t.rank)throw new Error("Invalid tensor rank")
const r=Math.min(3,t.dimensions[0]),i=Math.min(3,t.dimensions[1])
for(let a=0;a<r;a++)for(let r=0;r<i;r++)o.U.setValue(e,a,r,t.get(n,a,r))
return e},e.toVec3=function(e,t,n){if(1!==t.rank)throw new Error("Invalid tensor rank")
const r=Math.min(3,t.dimensions[0])
for(let i=0;i<r;i++)e[i]=n[i]
return e},e.toVec4=function(e,t,n){if(1!==t.rank)throw new Error("Invalid tensor rank")
const r=Math.min(4,t.dimensions[0])
for(let i=0;i<r;i++)e[i]=n[i]
return e},e.areEqualExact=function(e,t){const n=e.length
if(n!==t.length)return!1
for(let r=0;r<n;r++)if(e[r]!==t[r])return!1
return!0},e.invertAxisOrder=function(e){const t=[]
for(let n=0;n<e.length;n++)t[n]=e[e.length-n-1]
return t},e.convertToCanonicalAxisIndicesFastToSlow=function(e){const t=new Int32Array(e.length)
for(let n=0;n<e.length;n++)t[e[n]]=n
return e=>s(e,t)},e.convertToCanonicalAxisIndicesSlowToFast=function(e){const t=new Int32Array(e.length)
for(let n=0;n<e.length;n++)t[e[e.length-n-1]]=n
return e=>s(e,t)}}(r||(r={}))},42127(e,t,n){"use strict"
n.d(t,{CR:()=>o,Eh:()=>f,Qu:()=>s,hT:()=>u,mS:()=>a,ne:()=>l,tO:()=>p,v6:()=>c,zk:()=>h})
var r=n(92384),i=n(32775)
function o(e){return{pairs:[{loci:[e[0].loci,e[1].loci]}]}}function a(e){return{triples:[{loci:[e[0].loci,e[1].loci,e[2].loci]}]}}function s(e){return{quads:[{loci:[e[0].loci,e[1].loci,e[2].loci,e[3].loci]}]}}function l(e){return{infos:[{loci:e[0].loci}]}}function c(e){return{locis:e.map(e=>e.loci)}}function u(e){return{locis:e.map(e=>e.loci)}}const d={center:(0,i.eB)(),rotation:(0,i.$I)(),translationToCenter:(0,i.$I)(),translationFromCenter:(0,i.$I)(),translation:(0,i.$I)(),local:(0,i.$I)()}
function p(e){var t
return"components"===e.name&&"centroid"===(null===(t=e.params.rotationCenter)||void 0===t?void 0:t.name)}function h(e,t){var n,r
if("matrix"===e.name){const t=(0,i.$I)()
return i.$I.copy(t,e.params.data),e.params.transpose&&i.$I.transpose(t,t),t}{"centroid"===(null===(n=e.params.rotationCenter)||void 0===n?void 0:n.name)?i.eB.copy(d.center,t):"point"===(null===(r=e.params.rotationCenter)||void 0===r?void 0:r.name)?i.eB.copy(d.center,e.params.rotationCenter.params.point):i.eB.set(d.center,0,0,0),i.$I.fromTranslation(d.translationToCenter,d.center),i.$I.fromRotation(d.rotation,e.params.angle*Math.PI/180,e.params.axis),i.$I.fromTranslation(d.translationFromCenter,i.eB.negate(d.center,d.center))
const o=i.$I.mul3((0,i.$I)(),d.translationToCenter,d.rotation,d.translationFromCenter)
return i.$I.fromTranslation(d.translation,e.params.translation),i.$I.mul(o,d.translation,o),o}}const f=r.t.MappedStatic("matrix",{matrix:r.t.Group({data:r.t.Mat4(i.$I.identity()),transpose:r.t.Boolean(!1)},{isFlat:!0}),components:r.t.Group({translation:r.t.Vec3(i.eB.create(0,0,0)),axis:r.t.Vec3(i.eB.create(1,0,0)),angle:r.t.Numeric(0,{min:-360,max:360,step:1},{description:"Angle in Degrees"}),rotationCenter:r.t.MappedStatic("point",{point:r.t.Group({point:r.t.Vec3(i.eB.create(0,0,0))},{isFlat:!0}),centroid:r.t.Group({})})},{isFlat:!0})},{label:"Kind"})},42231(e,t,n){"use strict"
n.d(t,{$A:()=>c,AR:()=>a,lL:()=>l,rO:()=>s,t9:()=>u})
var r=n(48393),i=n(717),o=n(19288)
function a(e,t="x-ray"){if(!e)return t
const n=e.models[0]
return i.K4.is(n.sourceData)?r.Model.hasEmMap(n)?"em":r.Model.hasXrayMap(n)?"x-ray":r.Model.isFromEm(n)?"em":r.Model.isFromXray(n)?"x-ray":t:t}function s(e,t){if(!t||!t.models.length)return[]
const n=t.models[0]
switch(e){case"em":return function(e){const t=[]
if(!i.K4.is(e.sourceData))return[e.entryId]
const{db_id:n,db_name:r,content_type:o}=e.sourceData.data.db.pdbx_database_related
if(!r.isDefined)return[e.entryId]
for(let i=0,a=r.rowCount;i<a;++i)"EMDB"===r.value(i).toUpperCase()&&"associated EM volume"===o.value(i)&&t.push(n.value(i))
return t}(n)
case"x-ray":return function(e){return[e.entryId]}(n)}}async function l(e,t,n,r){switch(e){case"emdb":return c(t,n,r)
case"pdbe":return async function(e,t,n){var r,i,o,a
n=n.toUpperCase()
const s=await e.fetch({url:`https://www.ebi.ac.uk/emdb/api/entry/map/${n}`,type:"json"}).runInContext(t),l=null===(i=null===(r=null==s?void 0:s.map)||void 0===r?void 0:r.contour_list)||void 0===i?void 0:i.contour
return l&&0!==l.length?null!==(a=null===(o=l.find(e=>e.primary))||void 0===o?void 0:o.level)&&void 0!==a?a:l[0].level:async function(e,t,n){var r,i,o
n=n.toUpperCase()
const a=await e.fetch({url:`https://www.ebi.ac.uk/pdbe/api/emdb/entry/map/${n}`,type:"json"}).runInContext(t),s=null==a?void 0:a[n]
let l
return void 0!==(null===(o=null===(i=null===(r=null==s?void 0:s[0])||void 0===r?void 0:r.map)||void 0===i?void 0:i.contour_level)||void 0===o?void 0:o.value)&&(l=+s[0].map.contour_level.value),l}(e,t,n)}(t,n,r)}}async function c(e,t,n){const r=e.config.get(o.PluginConfig.VolumeStreaming.EmdbHeaderServer),i=(await e.fetch({url:`${r}/${n.toUpperCase()}/header/${n.toLowerCase()}.xml`,type:"xml"}).runInContext(t)).getElementsByTagName("map")[0].getElementsByTagName("contour")
let a=i[0]
for(let o=1;o<i.length;o++)if("true"===i[o].getAttribute("primary")){a=i[o]
break}return parseFloat(a.getElementsByTagName("level")[0].textContent)}async function u(e,t,n){var r
const i=await e.fetch({url:`https://www.ebi.ac.uk/pdbe/api/pdb/entry/summary/${n}`,type:"json"}).runInContext(t),o=null==i?void 0:i[n],a=[]
if(!(null===(r=null==o?void 0:o[0])||void 0===r?void 0:r.related_structures))throw new Error(`No related EMDB entry found for '${n}'.`)
{const e=o[0].related_structures.filter(e=>"EMDB"===e.resource&&"associated EM volume"===e.relationship)
if(!e.length)throw new Error(`No related EMDB entry found for '${n}'.`)
a.push(...e.map(e=>e.accession))}return a}},42248(e,t,n){"use strict"
n.d(t,{L:()=>r})
var r,i=n(9043),o=n(87852)
!function(e){e.fromBuffer=function(e,t){return{name:t,readBuffer:(t,n,r,a)=>{let s,l
if("number"==typeof n){r=(0,i.NT)(r,n)
const a=t,c=Math.min(e.length,a+r)
s=c-a,l=o.N.fromUint8Array(new Uint8Array(e.buffer,a,c-a))}else{r=(0,i.NT)(r,n.length)
const o=t,c=Math.min(e.length,o+r)
n.set(e.subarray(o,c),a),s=c-o,l=n}return r!==s&&console.warn(`byteCount ${r} and bytesRead ${s} differ`),Promise.resolve({bytesRead:s,buffer:l})},writeBuffer:(e,t,n)=>(n=(0,i.NT)(n,t.length),console.error(".writeBuffer not implemented for FileHandle.fromBuffer"),Promise.resolve(0)),writeBufferSync:(e,t,n)=>(n=(0,i.NT)(n,t.length),console.error(".writeSync not implemented for FileHandle.fromBuffer"),0),close:i.lQ}}}(r||(r={}))},42261(e,t,n){"use strict"
var r
n.d(t,{M:()=>r}),function(e){e.toArray=function(e){return Array.from(e.values())},e.isSuperset=function(e,t){if(e===t)return!0
if(e.size<t.size)return!1
for(const n of t)if(!e.has(n))return!1
return!0},e.add=function(e,...t){for(let n=0;n<t.length;n++)for(const r of t[n])e.add(r)
return e},e.union=function(e,t){const n=new Set(e)
if(e===t)return n
for(const r of t)n.add(r)
return n},e.unionMany=function(...e){if(0===e.length)return new Set
const t=new Set(e[0])
for(let n=1,r=e.length;n<r;n++)for(const i of e[n])t.add(i)
return t},e.unionManyArrays=function(e){if(0===e.length)return new Set
const t=new Set(e[0])
for(let n=1;n<e.length;n++)for(const r of e[n])t.add(r)
return t},e.intersection=function(e,t){if(e===t)return new Set(e)
const n=new Set
for(const r of t)e.has(r)&&n.add(r)
return n},e.areIntersecting=function(e,t){if(e===t)return e.size>0
e.size<t.size&&([e,t]=[t,e])
for(const n of t)if(e.has(n))return!0
return!1},e.intersectionSize=function(e,t){if(e===t)return e.size
e.size<t.size&&([e,t]=[t,e])
let n=0
for(const r of t)e.has(r)&&(n+=1)
return n},e.difference=function(e,t){if(e===t)return new Set
const n=new Set(e)
for(const r of t)n.delete(r)
return n},e.differenceSize=function(e,t){if(e===t)return 0
let n=e.size
for(const r of e)t.has(r)&&(n-=1)
return n},e.areEqual=function(e,t){if(e===t)return!0
if(e.size!==t.size)return!1
for(const n of t)if(!e.has(n))return!1
return!0}}(r||(r={}))},42402(e,t,n){"use strict"
n.d(t,{VE:()=>a,jM:()=>o})
var r=n(33241),i=n(41736)
const o="Coordinates",a=[["dcd",(0,i.N)({label:"DCD",description:"DCD",category:o,binaryExtensions:["dcd"],parse:(e,t)=>e.state.data.build().to(t).apply(r.f.Model.CoordinatesFromDcd).commit()})],["xtc",(0,i.N)({label:"XTC",description:"XTC",category:o,binaryExtensions:["xtc"],parse:(e,t)=>e.state.data.build().to(t).apply(r.f.Model.CoordinatesFromXtc).commit()})],["trr",(0,i.N)({label:"TRR",description:"TRR",category:o,binaryExtensions:["trr"],parse:(e,t)=>e.state.data.build().to(t).apply(r.f.Model.CoordinatesFromTrr).commit()})],["nctraj",(0,i.N)({label:"NCTRAJ",description:"NCTRAJ",category:o,binaryExtensions:["nc","nctraj"],parse:(e,t)=>e.state.data.build().to(t).apply(r.f.Model.CoordinatesFromNctraj).commit()})],["lammpstrj",(0,i.N)({label:"LAMMPSTRAJ",description:"LAMMPSTRAJ",category:o,stringExtensions:["lammpstrj"],parse:(e,t)=>e.state.data.build().to(t).apply(r.f.Model.CoordinatesFromLammpstraj).commit()})]]},42529(e,t,n){"use strict"
n.d(t,{J:()=>An})
var r=n(54749),i=n(48393),o=n(11350),a=n(92384),s=n(85032),l=n(93076)
const c=(0,r.Color)(13421772),u={},d={name:"carbohydrate-symbol",label:"Carbohydrate Symbol",category:l.N.Residue,factory:function e(t,n){let r
if(t.structure){const{elements:e,getElementIndices:n}=t.structure.carbohydrates,a=(t,r)=>{if(!i.Unit.isAtomic(t))return c
const o=n(t,r)
return o.length>0?e[o[0]].component.color:c}
r=(e,t)=>t?o.G7.Secondary:i.StructureElement.Location.is(e)?a(e.unit,e.element):i.Bond.isLocation(e)?a(e.aUnit,e.aUnit.elements[e.aIndex]):c}else r=()=>c
return{factory:e,granularity:"group",color:r,props:n,description:"Assigns colors according to the Symbol Nomenclature for Glycans (SNFG).",legend:(0,s.h)(o.dV)}},getParams:function(e){return u},defaultValues:a.t.getDefaultValues(u),isApplicable:e=>!!e.structure&&e.structure.models.some(e=>i.Model.hasCarbohydrate(e))}
var p=n(83854),h=n(9043),f=n(3111),m=n(52429),g=n(20321),y=n(96561)
const v=(0,r.Color)(13421772),b={...(0,y.U)({type:"colors",colorList:"red-yellow-blue"})},x={name:"element-index",label:"Element Index",category:l.N.Atom,factory:function e(t,n){let r,o
if(t.structure){const{units:e}=t.structure.root,a=e.length,s=new Map,l=new Map
let c=0
for(let t=0;t<a;++t)s.set(t,c),c+=e[t].elements.length,l.set(e[t].id,t)
const u=(0,y.S)(c,n)
o=u.legend,r=t=>{if(i.StructureElement.Location.is(t)){const n=l.get(t.unit.id),r=g.C.findPredecessorIndex(e[n].elements,t.element)
return u.color(s.get(n)+r)}if(i.Bond.isLocation(t)){const n=l.get(t.aUnit.id),r=g.C.findPredecessorIndex(e[n].elements,t.aUnit.elements[t.aIndex])
return u.color(s.get(n)+r)}return v}}else r=()=>v
return{factory:e,granularity:"groupInstance",preferSmoothing:!0,color:r,props:n,description:"Gives every element (atom or coarse sphere/gaussian) a unique color based on the position (index) of the element in the list of elements in the structure.",legend:o}},getParams:function(e){return b},defaultValues:a.t.getDefaultValues(b),isApplicable:e=>!!e.structure}
var S=n(45996),_=n(95538)
function C(e){const t={}
return(0,_.IF)(e,(n,r)=>{t[r]=a.t.Color(e[r])}),t}var w=n(70594)
const T=(0,r.Color)(16448250),A=(0,r.Color)(16715021),I={...(0,y.U)({type:"colors",colorList:"many-distinct"}),overrideWater:a.t.Boolean(!1,{description:"Override the color for water molecules."}),waterColor:a.t.Color(A,{hideIf:e=>!e.overrideWater,description:"Color for water molecules (if overrideWater is true)."})}
function P(e,t){return`${e}|${t}`}function B(e,t){let n,r
if(e.structure){const o=i.StructureElement.Location.create(e.structure.root),a=function(e){const t=new WeakMap
let n=0
for(let r=0,i=e.models.length;r<i;++r){const i=e.models[r].sourceData
t.has(i)||t.set(i,n++)}return t}(e.structure),s=function(e,t){var n
const r=new Map
for(let i=0,o=e.models.length;i<o;++i){const o=null!==(n=t.get(e.models[i].sourceData))&&void 0!==n?n:-1,{label_entity_id:a}=e.models[i].atomicHierarchy.chains
for(let e=0,t=a.rowCount;e<t;++e){const t=P(a.value(e),o)
r.has(t)||r.set(t,r.size)}const{coarseHierarchy:s}=e.models[i]
if(s.isDefined){const{entity_id:e}=s.spheres
for(let n=0,i=e.rowCount;n<i;++n){const t=P(e.value(n),o)
r.has(t)||r.set(t,r.size)}const{entity_id:t}=s.gaussians
for(let n=0,i=t.rowCount;n<i;++n){const e=P(t.value(n),o)
r.has(e)||r.set(e,r.size)}}}return r}(e.structure.root,a),l=Array.from(s.keys()),c=e=>l[e],u=(0,y.S)(s.size,t,{valueLabel:c})
r=u.legend,n=e=>{var n
let r
if(i.StructureElement.Location.is(e))r=e
else{if(!i.Bond.isLocation(e))return T
o.unit=e.aUnit,o.element=e.aUnit.elements[e.aIndex],r=o}const l=function(e){switch(e.unit.kind){case i.Unit.Kind.Atomic:return i.StructureProperties.chain.label_entity_id(e)
case i.Unit.Kind.Spheres:case i.Unit.Kind.Gaussians:return i.StructureProperties.coarse.entity_id(e)}}(r),c=null!==(n=a.get(r.unit.model.sourceData))&&void 0!==n?n:-1
if(t.overrideWater){const e=r.unit.model.entities
if("water"===e.data.type.value(e.getEntityIndex(l)))return t.waterColor}const d=P(l,c),p=s.get(d)
return void 0===p?T:u.color(p)}}else n=()=>T
return{factory:B,granularity:"group",color:n,props:t,description:"Gives every chain a color based on its `label_entity_id` value.",legend:r}}const E={name:"entity-id",label:"Entity Id",category:l.N.Chain,factory:B,getParams:function(e){return a.t.clone(I)},defaultValues:a.t.getDefaultValues(I),isApplicable:e=>!!e.structure}
var k=n(91229),D=n(83040),M=n(69396),R=n(1712),O=n(717)
const L="dark-2",N=(0,r.Color)(16448250),F={...(0,y.U)({type:"colors",colorList:L})}
function z(e,t){return`${e}|${t}`}function j(e,t,n,r,i,o){return`${e}|${t}|${n}|${o||i||r}`}function V(e,t,n,r,i,o,a,s){const{entity_id:l,pdbx_src_id:c,pdbx_beg_seq_num:u,pdbx_end_seq_num:d}=i
for(let p=0,h=i._rowCount;p<h;++p){const i=l.value(p),h=z(n,i)
let f
if(e.has(h))f=e.get(h)
else{const t=r.entities.getEntityIndex(i),n=r.sequence.sequences[t].sequence
f=new Int16Array(n.length),e.set(h,f)}const m=a?a.value(p):"",g=s?s.value(p)[0]:"",y=j(n,i,o.value(p),c.value(p),m,g),v=u.valueKind(p)===D.V.ValueKinds.Present?u.value(p):1,b=d.valueKind(p)===D.V.ValueKinds.Present?d.value(p):f.length
let x
t.has(y)?x=t.get(y):(x=t.size+1,t.set(y,x))
for(let e=v,t=b;e<=t;++e)f[e-1]=x}}function U(e){const t=new Map,n=new Map
for(let r=0,i=e.length;r<i;++r){const i=e[r]
if(!O.K4.is(i.sourceData))continue
const{entity_src_gen:o,entity_src_nat:a,pdbx_entity_src_syn:s}=i.sourceData.data.db
V(t,n,r,i,o,o.pdbx_gene_src_scientific_name,o.plasmid_name,o.pdbx_gene_src_gene),V(t,n,r,i,a,a.pdbx_organism_scientific,a.pdbx_plasmid_name),V(t,n,r,i,s,s.organism_scientific)}return{seqToSrcByModelEntity:t,srcKeySerialMap:n}}function G(e,t){let n,r
if(e.structure){const o=i.StructureElement.Location.create(e.structure),{models:a}=e.structure.root,{seqToSrcByModelEntity:s,srcKeySerialMap:l}=U(a),c=function(e){let t=0
return Array.from(e.keys()).map(e=>{const n=e.split("|"),r=n[2]
return`${(0,M.Fq)(n[3])?"Unnamed "+ ++t:n[3]}${r?` (${r})`:""}`})}(l),u=e=>c[e],d=(0,y.S)(l.size,t,{valueLabel:u})
r=d.legend
const p=e=>{const t=z(a.indexOf(e.unit.model),i.StructureProperties.entity.id(e)),n=s.get(t)
if(n){const t=n[i.StructureProperties.residue.label_seq_id(e)-1]-1
return-1===t?N:d.color(t)}return N}
n=e=>i.StructureElement.Location.is(e)?p(e):i.Bond.isLocation(e)?(o.unit=e.aUnit,o.element=e.aUnit.elements[e.aIndex],p(o)):N}else n=()=>N
return{factory:G,granularity:"group",color:n,props:t,description:"Gives ranges of a polymer chain a color based on the entity source it originates from (e.g. gene, plasmid, organism).",legend:r}}const H={name:"entity-source",label:"Entity Source",category:l.N.Chain,factory:G,getParams:function(e){const t=a.t.clone(F)
return e.structure&&U(e.structure.root.models).srcKeySerialMap.size>R.VI[L].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params={...t.palette.defaultValue.params,list:{kind:"interpolate",colors:(0,R.JA)(L).list}}),t},defaultValues:a.t.getDefaultValues(F),isApplicable:e=>!!e.structure},q=(0,r.Color)(13421772),Q={...(0,y.U)({type:"colors",colorList:"many-distinct"})}
function $(e,t){var n
let r,o,a=-1
if(e.structure){const s=(null!==(n=i.Model.MaxIndex.get(e.structure.models[0]).value)&&void 0!==n?n:-1)+1
a=s
const l=(0,y.S)(s,t)
o=l.legend,r=e=>i.StructureElement.Location.is(e)?l.color(i.Model.Index.get(e.unit.model).value||0):i.Bond.isLocation(e)?l.color(i.Model.Index.get(e.aUnit.model).value||0):q}else r=()=>q
return{factory:$,granularity:"instance",color:r,props:t,contextHash:a,description:"Gives every model a unique color based on its index.",legend:o}}const X={name:"model-index",label:"Model Index",category:l.N.Chain,factory:$,getParams:function(e){return a.t.clone(Q)},defaultValues:a.t.getDefaultValues(Q),isApplicable:e=>!!e.structure&&e.structure.elementCount>0},W=(0,r.Color)(13421772),Y={...(0,y.U)({type:"colors",colorList:"many-distinct"})}
function Z(e,t){var n
let r,o,a=-1
if(e.structure){const s=(null!==(n=i.Structure.MaxIndex.get(e.structure).value)&&void 0!==n?n:-1)+1
a=s
const l=(0,y.S)(s,t)
o=l.legend,r=e=>i.StructureElement.Location.is(e)?l.color(i.Structure.Index.get(e.structure).value||0):i.Bond.isLocation(e)?l.color(i.Structure.Index.get(e.aStructure).value||0):W}else r=()=>W
return{factory:Z,granularity:"instance",color:r,props:t,contextHash:a,description:"Gives every structure a unique color based on its index.",legend:o}}const K={name:"structure-index",label:"Structure Index",category:l.N.Chain,factory:Z,getParams:function(e){return a.t.clone(Y)},defaultValues:a.t.getDefaultValues(Y),isApplicable:e=>!!e.structure&&e.structure.elementCount>0},J="dark-2",ee=(0,r.Color)(13421772),te={...(0,y.U)({type:"colors",colorList:J})}
function ne(e,t){let n,r
if(e.structure){const{units:o}=e.structure.root,a=(0,y.S)(o.length,t)
r=a.legend
const s=new Map
for(let e=0,t=o.length;e<t;++e)s.set(o[e].id,a.color(e))
n=e=>i.StructureElement.Location.is(e)?s.get(e.unit.id):i.Bond.isLocation(e)?s.get(e.aUnit.id):ee}else n=()=>ee
return{factory:ne,granularity:"instance",color:n,props:t,description:"Gives every chain instance (single chain or collection of single elements) a unique color based on the position (index) of the chain in the list of chains in the structure.",legend:r}}const re={name:"unit-index",label:"Chain Instance",category:l.N.Chain,factory:ne,getParams:function(e){const t=a.t.clone(te)
return e.structure&&e.structure.root.units.length>R.VI[J].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params={...t.palette.defaultValue.params,list:{kind:"interpolate",colors:(0,R.JA)(J).list}}),t},defaultValues:a.t.getDefaultValues(te),isApplicable:e=>!!e.structure}
var ie=n(95472)
const oe=(0,r.Color)(13421772),ae={...(0,y.U)({type:"colors",colorList:"purples"})}
function se(e,t){var n,r
let o,a,s=-1
if(e.structure){const{models:l}=e.structure.root
let c=0
for(const e of l)c=Math.max(c,(null===(n=i.Model.TrajectoryInfo.get(e))||void 0===n?void 0:n.size)||0)
const u=[c],d=(0,y.S)(c,t)
a=d.legend
const p=new Map
for(let e=0,t=l.length;e<t;++e){const t=(null===(r=i.Model.TrajectoryInfo.get(l[e]))||void 0===r?void 0:r.index)||0
p.set(t,d.color(t)),u.push(t)}s=(0,ie.TI)(u),o=e=>i.StructureElement.Location.is(e)?p.get(i.Model.TrajectoryInfo.get(e.unit.model).index):i.Bond.isLocation(e)?p.get(i.Model.TrajectoryInfo.get(e.aUnit.model).index):oe}else o=()=>oe
return{factory:se,granularity:"instance",color:o,props:t,contextHash:s,description:"Gives every model (frame) a unique color based on the index in its trajectory.",legend:a}}const le={name:"trajectory-index",label:"Trajectory Index",category:l.N.Chain,factory:se,getParams:function(e){return a.t.clone(ae)},defaultValues:a.t.getDefaultValues(ae),isApplicable:e=>!!e.structure&&e.structure.elementCount>0&&i.Model.TrajectoryInfo.get(e.structure.models[0]).size>1},ce=(0,r.ColorMap)({H:16777215,D:16777152,T:16777120,HE:14286847,LI:13402367,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,NE:11789301,NA:11230450,MG:9109248,AL:12560038,SI:1578e4,P:16744448,S:16777008,CL:2093087,AR:8442339,K:9388244,CA:4062976,SC:15132390,TI:12567239,V:10921643,CR:9083335,MN:10255047,FE:14706227,CO:15765664,NI:5296208,CU:13140019,ZN:8224944,GA:12750735,GE:6721423,AS:12419299,SE:16752896,BR:10889513,KR:6076625,RB:7351984,SR:65280,Y:9764863,ZR:9756896,NB:7586505,MO:5551541,TC:3907230,RU:2396047,RH:687500,PD:27013,AG:12632256,CD:16767375,IN:10909043,SN:6717568,SB:10380213,TE:13924864,I:9699476,XE:9699476,CS:5707663,BA:51456,LA:7394559,CE:16777159,PR:14286791,ND:13107143,PM:10747847,SM:9437127,EU:6422471,GD:4587463,TB:3211207,DY:2097095,HO:65436,ER:58997,TM:54354,YB:48952,LU:43812,HF:5096191,TA:5089023,W:2200790,RE:2522539,OS:2516630,IR:1528967,PT:13684960,AU:16765219,HG:12105936,TL:10900557,PB:5724513,BI:10375093,PO:11230208,AT:7688005,RN:4358806,FR:4325478,RA:32e3,AC:7384058,TH:47871,PA:41471,U:36863,NP:33023,PU:27647,AM:5528818,CM:7888099,BK:9064419,CF:10565332,ES:11739092,FM:11739066,MD:11734438,NO:12389767,LR:13041766,RF:13369433,DB:13697103,SG:14221381,BH:14680120,HS:15073326,MT:15400998,DS:16777215,RG:16777215,CN:16777215,UUT:16777215,FL:16777215,UUP:16777215,LV:16777215,UUH:16777215}),ue=(0,r.Color)(16777215),de={carbonColor:a.t.MappedStatic("chain-id",{"chain-id":a.t.Group(m.t4),"unit-index":a.t.Group(te,{label:"Chain Instance"}),"entity-id":a.t.Group(I),"entity-source":a.t.Group(F),"operator-name":a.t.Group(w.qg),"model-index":a.t.Group(Q),"structure-index":a.t.Group(Y),"trajectory-index":a.t.Group(ae),uniform:a.t.Group(p.vz),"element-symbol":a.t.EmptyGroup()},{description:"Use chain-id coloring for carbon atoms."}),saturation:a.t.Numeric(0,{min:-6,max:6,step:.1}),lightness:a.t.Numeric(.2,{min:-6,max:6,step:.1}),colors:a.t.MappedStatic("default",{default:a.t.EmptyGroup(),custom:a.t.Group(C(ce))})}
function pe(e,t){var n
const r=(0,S.Ak)("default"===t.colors.name?ce:t.colors.params,t.saturation,t.lightness),o=function(e,t){switch(t.name){case"chain-id":return(0,m.Zv)(e,t.params)
case"unit-index":return ne(e,t.params)
case"entity-id":return B(e,t.params)
case"entity-source":return G(e,t.params)
case"operator-name":return(0,w.ci)(e,t.params)
case"model-index":return $(e,t.params)
case"structure-index":return Z(e,t.params)
case"trajectory-index":return se(e,t.params)
case"uniform":return(0,p.TA)(e,t.params)
case"element-symbol":return
default:(0,k.dr)(t)}}(e,t.carbonColor),a=(null==o||o.color,null!==(n=null==o?void 0:o.contextHash)&&void 0!==n?n:-1)
function l(e,t){return function(e,t){const n=e[t]
return void 0===n?ue:n}(r,e)}return{factory:pe,granularity:"operator-name"===t.carbonColor.name||"unit-index"===t.carbonColor.name?"groupInstance":"group",preferSmoothing:!0,color:function(e){if(i.StructureElement.Location.is(e)){if(i.Unit.isAtomic(e.unit)){const{type_symbol:t}=e.unit.model.atomicHierarchy.atoms
return l(t.value(e.element))}}else if(i.Bond.isLocation(e)&&i.Unit.isAtomic(e.aUnit)){const{type_symbol:t}=e.aUnit.model.atomicHierarchy.atoms
return l(t.value(e.aUnit.elements[e.aIndex]))}return ue},props:t,contextHash:a,description:"Assigns a color to every atom according to its chemical element.",legend:(0,s.h)(Object.keys(r).map(e=>[e,r[e]]))}}const he={name:"element-symbol",label:"Element Symbol",category:l.N.Atom,factory:pe,getParams:function(e){return a.t.clone(de)},defaultValues:a.t.getDefaultValues(de),isApplicable:e=>!!e.structure}
var fe=n(87095),me=n(13686)
const ge=(0,r.ColorMap)({water:3697840,ion:15729279,protein:12496596,RNA:16629894,DNA:12540695,PNA:4367514,saccharide:8374655}),ye=(0,r.Color)(16777113),ve={saturation:a.t.Numeric(0,{min:-6,max:6,step:.1}),lightness:a.t.Numeric(0,{min:-6,max:6,step:.1}),colors:a.t.MappedStatic("default",{default:a.t.EmptyGroup(),custom:a.t.Group(C(ge))})}
function be(e,t,n){switch((0,me.Ju)(t,n)){case fe.MoleculeType.Water:return e.water
case fe.MoleculeType.Ion:return e.ion
case fe.MoleculeType.Protein:return e.protein
case fe.MoleculeType.RNA:return e.RNA
case fe.MoleculeType.DNA:return e.DNA
case fe.MoleculeType.PNA:return e.PNA
case fe.MoleculeType.Saccharide:return e.saccharide}return ye}function xe(e,t){const n=(0,S.Ak)("default"===t.colors.name?ge:t.colors.params,t.saturation,t.lightness)
return{factory:xe,granularity:"group",color:function(e){return i.StructureElement.Location.is(e)?be(n,e.unit,e.element):i.Bond.isLocation(e)?be(n,e.aUnit,e.aUnit.elements[e.aIndex]):ye},props:t,description:"Assigns a color based on the molecule type of a residue.",legend:(0,s.h)(Object.keys(n).map(e=>[e,n[e]]).concat([["Other/unknown",ye]]))}}const Se={name:"molecule-type",label:"Molecule Type",category:l.N.Residue,factory:xe,getParams:function(e){return ve},defaultValues:a.t.getDefaultValues(ve),isApplicable:e=>!!e.structure}
var _e=n(65939)
const Ce="dark-2",we=(0,r.Color)(16448250),Te={...(0,y.U)({type:"colors",colorList:Ce})}
function Ae(e){switch(e.kind){case i.Unit.Kind.Atomic:return i.StructureProperties.chain.label_asym_id
case i.Unit.Kind.Spheres:case i.Unit.Kind.Gaussians:return i.StructureProperties.coarse.asym_id}}function Ie(e){const t=new Map
for(let n=0,r=e.unitSymmetryGroups.length;n<r;++n){const r=e.unitSymmetryGroups[n].units[0],{model:o}=r
if(i.Unit.isAtomic(r)){const{chainAtomSegments:e,chains:n}=o.atomicHierarchy,i=_e.h.transientSegments(e,r.elements)
for(;i.hasNext;){const{index:e}=i.move(),r=n.label_entity_id.value(e),a=o.entities.getEntityIndex(r)
if("polymer"===o.entities.data.type.value(a)){const r=n.label_asym_id.value(e)
t.has(r)||t.set(r,t.size)}}}else if(i.Unit.isCoarse(r)){const{chainElementSegments:e,asym_id:n,entity_id:a}=i.Unit.isSpheres(r)?o.coarseHierarchy.spheres:o.coarseHierarchy.gaussians,s=_e.h.transientSegments(e,r.elements)
for(;s.hasNext;){const{index:r}=s.move(),i=e.offsets[r],l=a.value(i),c=o.entities.getEntityIndex(l)
if("polymer"===o.entities.data.type.value(c)){const e=n.value(i)
t.has(e)||t.set(e,t.size)}}}}return t}const Pe={name:"polymer-id",label:"Polymer Chain Id",category:l.N.Chain,factory:function e(t,n){let r,o
if(t.structure){const e=i.StructureElement.Location.create(t.structure),a=Ie(t.structure.root),s=Array.from(a.keys()),l=e=>s[e],c=(0,y.S)(a.size,n,{valueLabel:l})
o=c.legend,r=t=>{let n
if(i.StructureElement.Location.is(t)){const e=Ae(t.unit)
n=a.get(e(t))}else if(i.Bond.isLocation(t)){const r=Ae(t.aUnit)
e.unit=t.aUnit,e.element=t.aUnit.elements[t.aIndex],n=a.get(r(e))}return void 0===n?we:c.color(n)}}else r=()=>we
return{factory:e,granularity:"group",color:r,props:n,description:"Gives every polymer chain a color based on its `asym_id` value.",legend:o}},getParams:function(e){const t=a.t.clone(Te)
return e.structure&&Ie(e.structure.root).size>R.VI[Ce].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params={...t.palette.defaultValue.params,list:{kind:"interpolate",colors:(0,R.JA)(Ce).list}}),t},defaultValues:a.t.getDefaultValues(Te),isApplicable:e=>!!e.structure},Be="dark-2",Ee=(0,r.Color)(13421772),ke={...(0,y.U)({type:"colors",colorList:Be})}
function De(e){let t=0
const{units:n}=e
for(let r=0,i=n.length;r<i;++r)n[r].polymerElements.length>0&&++t
return t}const Me={name:"polymer-index",label:"Polymer Chain Instance",category:l.N.Chain,factory:function e(t,n){let r,o
if(t.structure){const e=(0,y.S)(De(t.structure.root),n)
o=e.legend
const{units:a}=t.structure.root,s=new Map
for(let t=0,n=0,r=a.length;t<r;++t)a[t].polymerElements.length>0&&(s.set(a[t].id,e.color(n)),++n)
r=e=>{let t
return i.StructureElement.Location.is(e)?t=s.get(e.unit.id):i.Bond.isLocation(e)&&(t=s.get(e.aUnit.id)),void 0!==t?t:Ee}}else r=()=>Ee
return{factory:e,granularity:"instance",color:r,props:n,description:"Gives every polymer chain instance a unique color based on the position (index) of the polymer in the list of polymers in the structure.",legend:o}},getParams:function(e){const t=a.t.clone(ke)
return e.structure&&De(e.structure.root)>R.VI[Be].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params={...t.palette.defaultValue.params,list:{kind:"interpolate",colors:(0,R.JA)(Be).list}}),t},defaultValues:a.t.getDefaultValues(ke),isApplicable:e=>!!e.structure},Re=(0,r.ColorMap)({ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:15658734,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,A:14423100,G:3329330,I:10145074,C:16766720,T:4286945,U:4251856,DA:14423100,DG:3329330,DI:10145074,DC:16766720,DT:4286945,DU:4251856,APN:14423100,GPN:3329330,CPN:16766720,TPN:4286945}),Oe=(0,r.Color)(16711935),Le={saturation:a.t.Numeric(0,{min:-6,max:6,step:.1}),lightness:a.t.Numeric(1,{min:-6,max:6,step:.1}),colors:a.t.MappedStatic("default",{default:a.t.EmptyGroup(),custom:a.t.Group(C(Re))})}
function Ne(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(t)}function Fe(e,t){const n=e.coarseElements.seq_id_begin.value(t)
if(n===e.coarseElements.seq_id_end.value(t)){const r=e.coarseElements.entityKey[t]
return e.model.sequence.byEntityKey[r].sequence.compId.value(n-1)}}function ze(e,t){const n=e[t]
return void 0===n?Oe:n}function je(e,t){const n=(0,S.Ak)("default"===t.colors.name?Re:t.colors.params,t.saturation,t.lightness)
return{factory:je,granularity:"group",preferSmoothing:!0,color:function(e){if(i.StructureElement.Location.is(e)){if(i.Unit.isAtomic(e.unit)){const t=Ne(e.unit,e.element)
return ze(n,t)}{const t=Fe(e.unit,e.element)
if(t)return ze(n,t)}}else if(i.Bond.isLocation(e)){if(i.Unit.isAtomic(e.aUnit)){const t=Ne(e.aUnit,e.aUnit.elements[e.aIndex])
return ze(n,t)}{const t=Fe(e.aUnit,e.aUnit.elements[e.aIndex])
if(t)return ze(n,t)}}return Oe},props:t,description:"Assigns a color to every residue according to its name.",legend:(0,s.h)(Object.keys(n).map(e=>[e,n[e]]).concat([["Unknown",Oe]]))}}const Ve={name:"residue-name",label:"Residue Name",category:l.N.Residue,factory:je,getParams:function(e){return Le},defaultValues:a.t.getDefaultValues(Le),isApplicable:e=>!!e.structure},Ue=(0,r.ColorMap)({ARG:255,ASP:16711680,GLU:16711680,HIS:3392505,LYS:255,ALA:16777215,ASN:16777215,CYS:16777215,GLN:16777215,GLY:16777215,ILE:16777215,LEU:16777215,MET:16777215,PHE:16777215,PRO:16777215,SER:16777215,THR:16777215,TRP:16777215,TYR:16777215,VAL:16777215,MSE:16777215,SEP:16777215,TPO:16777215,PTR:16777215,PCA:16777215,HYP:16777215,HSD:16777215,HSE:16777215,HSP:255,LSN:16777215,ASPP:16777215,GLUP:16777215,HID:16777215,HIE:16777215,HIP:255,LYN:16777215,ASH:16777215,GLH:16777215,A:16777215,G:16777215,I:16777215,C:16777215,T:16777215,U:16777215,DA:16777215,DG:16777215,DI:16777215,DC:16777215,DT:16777215,DU:16777215,APN:16777215,GPN:16777215,CPN:16777215,TPN:16777215}),Ge=(0,r.Color)(16711935),He={method:a.t.MappedStatic("by-name",{"by-name":a.t.Group({saturation:a.t.Numeric(0,{min:-6,max:6,step:.1}),lightness:a.t.Numeric(0,{min:-6,max:6,step:.1}),colors:a.t.MappedStatic("default",{default:a.t.EmptyGroup(),custom:a.t.Group(C(Ue))})},{isFlat:!0})})}
function qe(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(t)}function Qe(e,t){const n=e.coarseElements.seq_id_begin.value(t)
if(n===e.coarseElements.seq_id_end.value(t)){const r=e.coarseElements.entityKey[t]
return e.model.sequence.byEntityKey[r].sequence.compId.value(n-1)}}function $e(e,t){const n=e[t]
return void 0===n?Ge:n}const Xe={name:"residue-charge",label:"Residue Charge",category:l.N.Residue,factory:function e(t,n){const{saturation:r,lightness:o,colors:a}=n.method.params,l=(0,S.Ak)("default"===n.method.params.colors.name?Ue:a.params,r,o)
return{factory:e,granularity:"group",preferSmoothing:!0,color:function(e){if(i.StructureElement.Location.is(e)){if(i.Unit.isAtomic(e.unit)){const t=qe(e.unit,e.element)
return $e(l,t)}{const t=Qe(e.unit,e.element)
if(t)return $e(l,t)}}else if(i.Bond.isLocation(e)){if(i.Unit.isAtomic(e.aUnit)){const t=qe(e.aUnit,e.aUnit.elements[e.aIndex])
return $e(l,t)}{const t=Qe(e.aUnit,e.aUnit.elements[e.aIndex])
if(t)return $e(l,t)}}return Ge},props:n,description:"Assigns a color to every residue based on its charge state.",legend:(0,s.h)(Object.keys(l).map(e=>[e,l[e]]).concat([["Unknown",Ge]]))}},getParams:function(e){return a.t.clone(He)},defaultValues:a.t.getDefaultValues(He),isApplicable:e=>!!e.structure}
var We=n(30897)
const Ye=(0,r.ColorMap)({alphaHelix:16711808,threeTenHelix:10485888,piHelix:6291584,betaTurn:6324479,betaStrand:16762880,coil:16777215,bend:6740169,turn:45670,dna:11403518,rna:16580962,carbohydrate:10921722}),Ze=(0,r.Color)(8421504),Ke={saturation:a.t.Numeric(-1,{min:-6,max:6,step:.1}),lightness:a.t.Numeric(0,{min:-6,max:6,step:.1}),colors:a.t.MappedStatic("default",{default:a.t.EmptyGroup(),custom:a.t.Group(C(Ye))})}
function Je(e,t,n,r){let o=fe.SecondaryStructureType.create(fe.SecondaryStructureType.Flag.None)
if(r&&i.Unit.isAtomic(t)){const e=r.get(t.invariantId)
e&&(o=e.type[e.getIndex(t.residueIndex[n])])}if(fe.SecondaryStructureType.is(o,fe.SecondaryStructureType.Flag.Helix))return fe.SecondaryStructureType.is(o,fe.SecondaryStructureType.Flag.Helix3Ten)?e.threeTenHelix:fe.SecondaryStructureType.is(o,fe.SecondaryStructureType.Flag.HelixPi)?e.piHelix:e.alphaHelix
if(fe.SecondaryStructureType.is(o,fe.SecondaryStructureType.Flag.Beta))return e.betaStrand
if(fe.SecondaryStructureType.is(o,fe.SecondaryStructureType.Flag.Bend))return e.bend
if(fe.SecondaryStructureType.is(o,fe.SecondaryStructureType.Flag.Turn))return e.turn
{const r=(0,me.Ju)(t,n)
if(r===fe.MoleculeType.DNA)return e.dna
if(r===fe.MoleculeType.RNA)return e.rna
if(r===fe.MoleculeType.Saccharide)return e.carbohydrate
if(r===fe.MoleculeType.Protein)return e.coil}return Ze}function et(e,t){const n=e.structure&&We.v.get(e.structure),r=n?(0,ie.vb)(n.id,n.version):-1,o=(0,S.Ak)("default"===t.colors.name?Ye:t.colors.params,t.saturation,t.lightness)
return{factory:et,granularity:"group",preferSmoothing:!0,color:function(e){return i.StructureElement.Location.is(e)?Je(o,e.unit,e.element,null==n?void 0:n.value):i.Bond.isLocation(e)?Je(o,e.aUnit,e.aUnit.elements[e.aIndex],null==n?void 0:n.value):Ze},props:t,contextHash:r,description:"Assigns a color based on the type of secondary structure and basic molecule type.",legend:(0,s.h)(Object.keys(o).map(e=>[e,o[e]]).concat([["Other",Ze]]))}}const tt={name:"secondary-structure",label:"Secondary Structure",category:l.N.Residue,factory:et,getParams:function(e){return Ke},defaultValues:a.t.getDefaultValues(Ke),isApplicable:e=>!!e.structure,ensureCustomProperties:{attach:(e,t)=>t.structure?We.v.attach(e,t.structure,void 0,!0):Promise.resolve(),detach:e=>e.structure&&We.v.ref(e.structure,!1)}},nt=(0,r.Color)(13421772),rt={list:a.t.ColorList("turbo-no-black",{presetKind:"scale"})}
function it(e,t){const{model:n}=e
switch(e.kind){case i.Unit.Kind.Atomic:const e=n.atomicHierarchy.residueAtomSegments.index[t]
return n.atomicHierarchy.residues.label_seq_id.value(e)
case i.Unit.Kind.Spheres:return Math.round((n.coarseHierarchy.spheres.seq_id_begin.value(t)+n.coarseHierarchy.spheres.seq_id_end.value(t))/2)
case i.Unit.Kind.Gaussians:return Math.round((n.coarseHierarchy.gaussians.seq_id_begin.value(t)+n.coarseHierarchy.gaussians.seq_id_end.value(t))/2)}}function ot(e,t){const{model:n}=e
let r=""
switch(e.kind){case i.Unit.Kind.Atomic:const e=n.atomicHierarchy.chainAtomSegments.index[t]
r=n.atomicHierarchy.chains.label_entity_id.value(e)
break
case i.Unit.Kind.Spheres:r=n.coarseHierarchy.spheres.entity_id.value(t)
break
case i.Unit.Kind.Gaussians:r=n.coarseHierarchy.gaussians.entity_id.value(t)}if(""===r)return 0
const o=n.entities.getEntityIndex(r)
if(-1===o)return 0
const a=n.sequence.byEntityKey[o]
return void 0===a?0:a.sequence.length}function at(e,t){const n=r.ColorScale.create({listOrName:t.list.colors,minLabel:"Start",maxLabel:"End"})
return{factory:at,granularity:"group",preferSmoothing:!0,color:e=>{if(i.StructureElement.Location.is(e)){const{unit:t,element:r}=e,i=it(t,r)
if(i>0){const e=ot(t,r)
if(e)return n.setDomain(0,e-1),n.color(i)}}else if(i.Bond.isLocation(e)){const{aUnit:t,aIndex:r}=e,i=it(t,t.elements[r])
if(i>0){const e=ot(t,t.elements[r])
if(e)return n.setDomain(0,e-1),n.color(i)}}return nt},props:t,description:"Gives every polymer residue a color based on its `seq_id` value.",legend:n?n.legend:void 0}}const st={name:"sequence-id",label:"Sequence Id",category:l.N.Residue,factory:at,getParams:function(e){return rt},defaultValues:a.t.getDefaultValues(rt),isApplicable:e=>!!e.structure}
var lt=n(40253)
const ct=(0,r.Color)(16777113),ut={domain:a.t.Interval([0,100]),list:a.t.ColorList("red-white-blue",{presetKind:"scale"})}
function dt(e,t){return i.Unit.isAtomic(e)?e.model.atomicConformation.B_iso_or_equiv.value(t):i.Unit.isSpheres(e)?e.model.coarseConformation.spheres.rmsf[t]:0}function pt(e,t){let n
return n="set"===t.list.kind?r.ColorScale.createDiscrete({reverse:!0,domain:t.domain,listOrName:t.list.colors}):r.ColorScale.create({reverse:!0,domain:t.domain,listOrName:t.list.colors}),{factory:pt,granularity:"group",preferSmoothing:!0,color:function(e){return i.StructureElement.Location.is(e)?n.color(dt(e.unit,e.element)):i.Bond.isLocation(e)?n.color(dt(e.aUnit,e.aUnit.elements[e.aIndex])):ct},props:t,description:"Assigns a color based on the uncertainty or disorder of an element's position, e.g. B-factor or RMSF, depending on the data availability and experimental technique.",legend:n?n.legend:void 0}}const ht={name:"uncertainty",label:"Uncertainty/Disorder",category:l.N.Atom,factory:pt,getParams:function(e){return ut},defaultValues:a.t.getDefaultValues(ut),isApplicable:e=>!!e.structure&&e.structure.models.some(e=>e.atomicConformation.B_iso_or_equiv.isDefined||e.coarseHierarchy.isDefined)},ft=(0,r.Color)(15658734),mt={style:a.t.MappedStatic("entity-id",{uniform:a.t.Group(p.vz),"chain-id":a.t.Group(m.t4),"entity-id":a.t.Group(I),"entity-source":a.t.Group(F),"molecule-type":a.t.Group(ve),"model-index":a.t.Group(Q),"structure-index":a.t.Group(Y),"trajectory-index":a.t.Group(ae)}),carbonLightness:a.t.Numeric(.8,{min:-6,max:6,step:.1})},gt={name:"illustrative",label:"Illustrative",category:l.N.Misc,factory:function e(t,n){const{color:o,legend:a,contextHash:s}=function(e,t){switch(t.name){case"uniform":return(0,p.TA)(e,t.params)
case"chain-id":return(0,m.Zv)(e,t.params)
case"entity-id":return B(e,t.params)
case"entity-source":return G(e,t.params)
case"molecule-type":return xe(0,t.params)
case"model-index":return $(e,t.params)
case"structure-index":return Z(e,t.params)
case"trajectory-index":return se(e,t.params)
default:(0,k.dr)(t)}}(t,n.style)
function l(e,t){const i=o(e,!1)
return"C"===t?r.Color.lighten(i,n.carbonLightness):i}return{factory:e,granularity:"group",preferSmoothing:!0,color:function(e){if(i.StructureElement.Location.is(e)&&i.Unit.isAtomic(e.unit)){const t=e.unit.model.atomicHierarchy.atoms.type_symbol.value(e.element)
return l(e,t)}if(i.Bond.isLocation(e)&&i.Unit.isAtomic(e.aUnit)){const t=e.aUnit.elements[e.aIndex],n=e.aUnit.model.atomicHierarchy.atoms.type_symbol.value(t)
return l(e,n)}return ft},props:n,contextHash:s,description:"Assigns an illustrative color that gives every chain a color based on the chosen style but with lighter carbons (inspired by David Goodsell's Molecule of the Month style).",legend:a}},getParams:function(e){return a.t.clone(mt)},defaultValues:a.t.getDefaultValues(mt),isApplicable:e=>!!e.structure},yt={list:a.t.ColorList("red-yellow-green",{presetKind:"scale"}),scale:a.t.Select("DGwif",[["DGwif","DG water-membrane"],["DGwoct","DG water-octanol"],["Oct-IF","DG difference"]])},vt={DGwif:0,DGwoct:1,"Oct-IF":2}
function bt(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(t)}function xt(e,t){const n=e.coarseElements.seq_id_begin.value(t)
if(n===e.coarseElements.seq_id_end.value(t)){const r=e.coarseElements.entityKey[t]
return e.model.sequence.byEntityKey[r].sequence.compId.value(n-1)}}function St(e,t){const n=vt[t.scale]
let o=1/0,a=-1/0
for(const r in fe.ResidueHydrophobicity){const e=fe.ResidueHydrophobicity[r][n]
o=Math.min(o,e),a=Math.max(a,e)}const s=r.ColorScale.create({listOrName:t.list.colors,domain:[a,o],minLabel:"Hydrophilic",maxLabel:"Hydrophobic"})
return{factory:St,granularity:"group",preferSmoothing:!0,color:function(e){let t
return i.StructureElement.Location.is(e)?t=i.Unit.isAtomic(e.unit)?bt(e.unit,e.element):xt(e.unit,e.element):i.Bond.isLocation(e)&&(t=i.Unit.isAtomic(e.aUnit)?bt(e.aUnit,e.aUnit.elements[e.aIndex]):xt(e.aUnit,e.aUnit.elements[e.aIndex])),s.color(t?function(e,t){const n=fe.ResidueHydrophobicity[e]
return void 0===n?0:n[t]}(t,n):0)},props:t,description:'Assigns a color to every amino acid according to the "Experimentally determined hydrophobicity scale for proteins at membrane interfaces" by Wimely and White (doi:10.1038/nsb1096-842).',legend:s?s.legend:void 0}}const _t={name:"hydrophobicity",label:"Hydrophobicity",category:l.N.Residue,factory:St,getParams:function(e){return yt},defaultValues:a.t.getDefaultValues(yt),isApplicable:e=>!!e.structure},Ct=(0,r.Color)(13421772),wt={domain:a.t.Interval([0,1]),list:a.t.ColorList("purples",{presetKind:"scale"})}
function Tt(e,t){return i.Unit.isAtomic(e)?e.model.atomicConformation.occupancy.value(t):0}function At(e,t){const n=r.ColorScale.create({reverse:!1,domain:t.domain,listOrName:t.list.colors})
return{factory:At,granularity:"group",preferSmoothing:!0,color:function(e){return i.StructureElement.Location.is(e)?n.color(Tt(e.unit,e.element)):i.Bond.isLocation(e)?n.color(Tt(e.aUnit,e.aUnit.elements[e.aIndex])):Ct},props:t,description:"Assigns a color based on the occupancy of an atom.",legend:n?n.legend:void 0}}const It={name:"occupancy",label:"Occupancy",category:l.N.Atom,factory:At,getParams:function(e){return wt},defaultValues:a.t.getDefaultValues(wt),isApplicable:e=>!!e.structure&&e.structure.models.some(e=>e.atomicConformation.occupancy.isDefined)}
var Pt=n(32775)
const Bt="dark-2",Et=(0,r.Color)(13421772),kt={...(0,y.U)({type:"colors",colorList:Bt})},Dt=1e4
function Mt(e){return e.map(e=>`${e+Dt}`.padStart(5,"0")).join("")}function Rt(e){const t=(0,M.bL)(Dt,0),n=parseInt(e.substr(0,t)),r=parseInt(e.substr(t,t)),i=parseInt(e.substr(t+t,t))
return Pt.eB.create(n-Dt,r-Dt,i-Dt)}function Ot(e){return e.map(e=>e+5).join("")}function Lt(e){const t=new Map,n=new Set
for(let i=0,o=e.units.length;i<o;++i){const t=Mt(e.units[i].conformation.operator.hkl)
n.add(t)}const r=Array.from(n.values()).sort()
return r.forEach(e=>t.set(e,t.size)),{min:Rt(r[0]),max:Rt(r[r.length-1]),map:t}}const Nt={name:"operator-hkl",label:"Operator HKL",category:l.N.Symmetry,factory:function e(t,n){let r,o
if(t.structure){const{min:e,max:a,map:s}=Lt(t.structure.root),l=[]
s.forEach((e,t)=>{const n=e%s.size,r=Ot(Rt(t))
void 0===l[n]?l[n]=r:l[n]+=`, ${r}`})
const c={minLabel:Ot(e),maxLabel:Ot(a),valueLabel:e=>l[e]},u=(0,y.S)(s.size,n,c)
o=u.legend,r=e=>{let t
if(i.StructureElement.Location.is(e)){const n=Mt(e.unit.conformation.operator.hkl)
t=s.get(n)}else if(i.Bond.isLocation(e)){const n=Mt(e.aUnit.conformation.operator.hkl)
t=s.get(n)}return void 0===t?Et:u.color(t)}}else r=()=>Et
return{factory:e,granularity:"instance",color:r,props:n,description:"Assigns a color based on the operator HKL value of a transformed chain.",legend:o}},getParams:function(e){const t=a.t.clone(kt)
return e.structure&&Lt(e.structure.root).map.size>R.VI[Bt].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params={...t.palette.defaultValue.params,list:{kind:"interpolate",colors:(0,R.JA)(Bt).list}}),t},defaultValues:a.t.getDefaultValues(kt),isApplicable:e=>!!e.structure}
var Ft=n(33191)
const zt=(0,r.Color)(16777113),jt={domain:a.t.Interval([-1,1]),list:a.t.ColorList("red-white-blue",{presetKind:"scale"})}
function Vt(e,t){var n
return null===(n=Ft.j.Provider.get(e.model))||void 0===n?void 0:n.data.value(t)}function Ut(e,t){const n=r.ColorScale.create({domain:t.domain,listOrName:t.list.colors})
return{factory:Ut,granularity:"group",preferSmoothing:!0,color:function(e){if(i.StructureElement.Location.is(e)){const t=Vt(e.unit,e.element)
return void 0!==t?n.color(t):zt}if(i.Bond.isLocation(e)){const t=Vt(e.aUnit,e.aUnit.elements[e.aIndex])
return void 0!==t?n.color(t):zt}return zt},props:t,description:"Assigns a color based on the partial charge of an atom.",legend:n?n.legend:void 0}}const Gt={name:"partial-charge",label:"Partial Charge",category:l.N.Atom,factory:Ut,getParams:function(e){return jt},defaultValues:a.t.getDefaultValues(jt),isApplicable:e=>!!e.structure&&e.structure.models.some(e=>void 0!==Ft.j.Provider.get(e))},Ht=(0,r.Color)(16448250),qt={...(0,y.U)({type:"colors",colorList:"many-distinct"})},Qt={name:"atom-id",label:"Atom Id",category:l.N.Atom,factory:function e(t,n){let r,o
if(t.structure){const e=i.StructureElement.Location.create(t.structure.root),a=function(e){const t=new Map
for(const n of e.models){const{label_atom_id:e}=n.atomicHierarchy.atoms
for(let n=0,r=e.rowCount;n<r;++n){const r=e.value(n)
t.has(r)||t.set(r,t.size)}}return t}(t.structure.root),s=Array.from(a.keys()),l=e=>s[e],c=(0,y.S)(a.size,n,{valueLabel:l})
o=c.legend,r=t=>{let n
if(i.StructureElement.Location.is(t)){const e=i.StructureProperties.atom.label_atom_id(t)
n=a.get(e)}else if(i.Bond.isLocation(t)){e.unit=t.aUnit,e.element=t.aUnit.elements[t.aIndex]
const r=i.StructureProperties.atom.label_atom_id(e)
n=a.get(r)}return void 0===n?Ht:c.color(n)}}else r=()=>Ht
return{factory:e,granularity:"group",preferSmoothing:!0,color:r,props:n,description:"Gives every atom a color based on its `label_atom_id` value.",legend:o}},getParams:function(e){return a.t.clone(qt)},defaultValues:a.t.getDefaultValues(qt),isApplicable:e=>!!e.structure}
var $t=n(50709),Xt=n(60939),Wt=n(97564),Yt=n(84645),Zt=n(81871)
const Kt="Assign color based on the given value of a volume cell.",Jt={colorList:a.t.ColorList({kind:"interpolate",colors:[[$t.ColorNames.white,0],[$t.ColorNames.red,.25],[$t.ColorNames.white,.5],[$t.ColorNames.blue,.75],[$t.ColorNames.white,1]]},{offsets:!0,isEssential:!0}),domain:a.t.MappedStatic("auto",{custom:a.t.Interval([-1,1],{step:.001}),auto:a.t.Group({symmetric:a.t.Boolean(!1,{description:"If true the automatic range is determined as [-|max|, |max|]."})})}),isRelative:a.t.Boolean(!1,{description:"If true the value is treated as relative to the volume mean and sigma."}),defaultColor:a.t.Color((0,S.Q1)(13421772))},en={name:"volume-value",label:"Volume Value",category:l.N.Misc,factory:function e(t,n){var r
if(t.volume){const{min:i,max:o,mean:a,sigma:s}=t.volume.grid.stats,l="custom"===n.domain.name?n.domain.params:[i,o],{colorList:c,defaultColor:u}=n
if("auto"===n.domain.name&&n.isRelative&&(l[0]=(l[0]-a)/s,l[1]=(l[1]-a)/s),"auto"===n.domain.name&&n.domain.params.symmetric){const e=Math.max(Math.abs(l[0]),Math.abs(l[1]))
l[0]=-e,l[1]=e}if(null===(r=t.locationKinds)||void 0===r?void 0:r.includes("direct-location")){const t=[(0,Wt.S8)(l[0],i,o),(0,Wt.S8)(l[1],i,o)],r=An.Palette(c.colors,c.kind,t,u)
return{factory:e,granularity:"direct",props:n,description:Kt,palette:r}}{const r=Yt.x.makeGetTrilinearlyInterpolated(t.volume.grid,"none")
return{factory:e,granularity:"vertex",preferSmoothing:!0,color:e=>{if(!(0,Zt.ZC)(e))return n.defaultColor
const t=r(e.position)
return Number.isNaN(t)?n.defaultColor:(0,Wt.qE)((t-l[0])/(l[1]-l[0]),0,1)*An.PaletteScale},palette:An.Palette(c.colors,c.kind,void 0,u),props:n,description:Kt}}}return{factory:e,granularity:"uniform",color:()=>n.defaultColor,props:n,description:Kt}},getParams:function(e){return Jt},defaultValues:a.t.getDefaultValues(Jt),isApplicable:e=>!!e.volume&&!Xt.f.Segmentation.get(e.volume)},tn=(0,r.Color)(13421772),nn={...(0,y.U)({type:"colors",colorList:"many-distinct"})},rn={name:"volume-segment",label:"Volume Segment",category:l.N.Misc,factory:function e(t,n){let r,i
const o=t.volume&&Xt.f.Segmentation.get(t.volume)
if(o){const e=o.segments.size,t=Array.from(o.segments.keys()),a=(0,y.S)(e,n)
i=a.legend,r=e=>Xt.f.Segment.isLocation(e)?a.color(t.indexOf(e.segment)):tn}else r=()=>tn
return{factory:e,granularity:"instance",color:r,props:n,description:"Gives every volume segment a unique color.",legend:i}},getParams:function(e){return a.t.clone(nn)},defaultValues:a.t.getDefaultValues(nn),isApplicable:e=>!!e.volume&&!!Xt.f.Segmentation.get(e.volume)}
var on=n(90050)
const an={volume:a.t.ValueRef(e=>e.state.data.selectQ(e=>e.root.subtree().filter(e=>{var t
return on.f.is(null===(t=e.obj)||void 0===t?void 0:t.data)})).map(e=>{var t,n
return[e.transform.ref,null!==(n=null===(t=e.obj)||void 0===t?void 0:t.label)&&void 0!==n?n:"<unknown>"]}),(e,t)=>t(e)),coloring:a.t.MappedStatic("absolute-value",{"absolute-value":a.t.Group({domain:a.t.MappedStatic("auto",{custom:a.t.Interval([-1,1],{step:.001}),auto:a.t.Group({symmetric:a.t.Boolean(!1,{description:"If true the automatic range is determined as [-|max|, |max|]."})})}),list:a.t.ColorList("red-white-blue",{presetKind:"scale"})}),"relative-value":a.t.Group({domain:a.t.MappedStatic("auto",{custom:a.t.Interval([-1,1],{step:.001}),auto:a.t.Group({symmetric:a.t.Boolean(!1,{description:"If true the automatic range is determined as [-|max|, |max|]."})})}),list:a.t.ColorList("red-white-blue",{presetKind:"scale"})})}),defaultColor:a.t.Color((0,r.Color)(13421772)),normalOffset:a.t.Numeric(0,{min:0,max:20,step:.1},{description:"Offset vertex position along its normal by given amount."}),usePalette:a.t.Boolean(!1,{description:"Use a palette to color at the pixel level."})},sn={name:"external-volume",label:"External Volume",category:l.N.Misc,factory:function e(t,n){let i,o,a
try{i=n.volume.getValue()}catch(e){}const{normalOffset:s,defaultColor:l,usePalette:c}=n
if(i){const e=n.coloring.params,{stats:t}=i.grid,u="custom"===e.domain.name?e.domain.params:[t.min,t.max],d="relative-value"===n.coloring.name
if("auto"===e.domain.name&&d&&(u[0]=(u[0]-t.mean)/t.sigma,u[1]=(u[1]-t.mean)/t.sigma),"auto"===e.domain.name&&e.domain.params.symmetric){const e=Math.max(Math.abs(u[0]),Math.abs(u[1]))
u[0]=-e,u[1]=e}const p=r.ColorScale.create({domain:u,listOrName:e.list.colors}),h=(0,Pt.eB)(),f=on.x.makeGetTrilinearlyInterpolated(i.grid,d?"relative":"none")
o=e=>{if(!(0,Zt.ZC)(e))return l
s>0?Pt.eB.scaleAndAdd(h,e.position,e.normal,s):Pt.eB.copy(h,e.position)
const t=f(h)
return Number.isNaN(t)?l:c?(0,Wt.qE)((t-u[0])/(u[1]-u[0]),0,1)*An.PaletteScale:p.color(t)},a=c?{colors:e.list.colors.map(e=>Array.isArray(e)?e[0]:e),filter:"set"===e.list.kind?"nearest":"linear"}:void 0}else o=()=>l
return{factory:e,granularity:"vertex",preferSmoothing:!0,color:o,palette:a,props:n,description:"Assigns a color based on volume value at a given vertex."}},getParams:()=>an,defaultValues:a.t.getDefaultValues(an),isApplicable:e=>!0},ln={mainchain:a.t.MappedStatic("molecule-type",{uniform:a.t.Group(p.vz),"chain-id":a.t.Group(m.t4),"entity-id":a.t.Group(I),"entity-source":a.t.Group(F),"molecule-type":a.t.Group(ve),"model-index":a.t.Group(Q),"structure-index":a.t.Group(Y),"secondary-structure":a.t.Group(Ke),"trajectory-index":a.t.Group(ae)}),sidechain:a.t.MappedStatic("residue-name",{uniform:a.t.Group(p.vz),"residue-name":a.t.Group(Le),"element-symbol":a.t.Group(de),hydrophobicity:a.t.Group(yt),uncertainty:a.t.Group(ut),occupancy:a.t.Group(wt),"sequence-id":a.t.Group(rt),"partial-charge":a.t.Group(jt)})},cn={name:"cartoon",label:"Cartoon",category:l.N.Misc,factory:function e(t,n){var r,i,o,a
const s=function(e,t){switch(t.name){case"uniform":return(0,p.TA)(e,t.params)
case"chain-id":return(0,m.Zv)(e,t.params)
case"entity-id":return B(e,t.params)
case"entity-source":return G(e,t.params)
case"molecule-type":return xe(0,t.params)
case"model-index":return $(e,t.params)
case"structure-index":return Z(e,t.params)
case"secondary-structure":return et(e,t.params)
case"trajectory-index":return se(e,t.params)
default:(0,k.dr)(t)}}(t,n.mainchain),l=function(e,t){switch(t.name){case"uniform":return(0,p.TA)(e,t.params)
case"residue-name":return je(0,t.params)
case"element-symbol":return pe(e,t.params)
case"hydrophobicity":return St(0,t.params)
case"uncertainty":return pt(0,t.params)
case"occupancy":return At(0,t.params)
case"sequence-id":return at(0,t.params)
case"partial-charge":return Ut(0,t.params)
default:(0,k.dr)(t)}}(t,n.sidechain),c=(0,ie.vb)(null!==(r=s.contextHash)&&void 0!==r?r:0,null!==(i=l.contextHash)&&void 0!==i?i:0)
let u=s.legend
return"table-legend"===(null===(o=s.legend)||void 0===o?void 0:o.kind)&&"table-legend"===(null===(a=l.legend)||void 0===a?void 0:a.kind)&&(u={kind:"table-legend",table:[...s.legend.table,...l.legend.table]}),{factory:e,granularity:"group",preferSmoothing:!1,color:function(e,t){return t?s.color(e,!1):l.color(e,!1)},props:n,contextHash:c,description:"Uses separate themes for coloring mainchain and sidechain visuals.",legend:u}},getParams:function(e){return a.t.clone(ln)},defaultValues:a.t.getDefaultValues(ln),isApplicable:e=>!!e.structure},un=(0,r.Color)(16777113),dn={domain:a.t.Interval([-3,3]),list:a.t.ColorList({kind:"set",colors:R.VI["red-white-blue"].list})}
function pn(e,t){return i.Unit.isAtomic(e)?e.model.atomicHierarchy.atoms.pdbx_formal_charge.value(t):0}const hn={name:"formal-charge",label:"Formal Charge",category:l.N.Atom,factory:function e(t,n){const o=r.ColorScale.create({domain:n.domain,listOrName:n.list.colors})
return{factory:e,granularity:"group",preferSmoothing:!0,color:function(e){if(i.StructureElement.Location.is(e)){const t=pn(e.unit,e.element)
return void 0!==t?o.color(t):un}if(i.Bond.isLocation(e)){const t=pn(e.aUnit,e.aUnit.elements[e.aIndex])
return void 0!==t?o.color(t):un}return un},props:n,description:"Assigns a color based on the formal charge of an atom.",legend:o?o.legend:void 0}},getParams:function(e){return dn},defaultValues:a.t.getDefaultValues(dn),isApplicable:e=>!!e.structure&&e.structure.models.some(e=>e.atomicHierarchy.atoms.pdbx_formal_charge.isDefined)}
var fn=n(78450),mn=n(39298),gn=n(30846),yn=n(66187),vn=n(37411)
const bn={structure:a.t.ValueRef(e=>e.state.data.select(fn.Q.Generators.rootsOfType(mn.O.Molecule.Structure)).filter(e=>{var t
return null===(t=e.obj)||void 0===t?void 0:t.data}).map(e=>{var t,n
return[e.transform.ref,null!==(n=null===(t=e.obj)||void 0===t?void 0:t.label)&&void 0!==n?n:"<unknown>"]}),(e,t)=>t(e)),style:a.t.MappedStatic("chain-id",{"chain-id":a.t.Group(m.t4),"entity-id":a.t.Group(I),"entity-source":a.t.Group(F),"molecule-type":a.t.Group(ve),"model-index":a.t.Group(Q),"structure-index":a.t.Group(Y)}),defaultColor:a.t.Color((0,r.Color)(13421772)),maxDistance:a.t.Numeric(8,{min:.1,max:24,step:.1},{description:"Maximum distance to search for the nearest structure element. This is done only if the approximate search fails."}),approxMaxDistance:a.t.Numeric(4,{min:0,max:12,step:.1},{description:"Maximum distance to search for an approximately nearest structure element. This is done before the extact search."}),normalOffset:a.t.Numeric(0,{min:-10,max:20,step:.1},{description:"Offset vertex position along its normal by given amount."}),backboneOnly:a.t.Boolean(!1)},xn={name:"external-structure",label:"External Structure",category:l.N.Misc,factory:function e(t,n){let r,o,a,s
try{r=n.structure.getValue()}catch(e){}const{maxDistance:l,approxMaxDistance:c,normalOffset:u,defaultColor:d,backboneOnly:p}=n
if(r){const e=function(e,t){switch(t.name){case"chain-id":return(0,m.Zv)(e,t.params)
case"entity-id":return B(e,t.params)
case"entity-source":return G(e,t.params)
case"molecule-type":return xe(0,t.params)
case"model-index":return $(e,t.params)
case"structure-index":return Z(e,t.params)
default:(0,k.dr)(t)}}({...t,structure:r},n.style),h=(0,gn.Jq)(),f=(0,gn.Jq)()
let g=r
p&&(g=i.StructureSelection.unionStructure(yn.StructureSelectionQueries.backbone.query(new i.QueryContext(r))))
const y=(0,vn.e)(),v=i.StructureElement.Location.create(g)
o=(t,n)=>{if(!(0,Zt.ZC)(t))return d
0!==u?vn.e.scaleAndAdd(y,t.position,t.normal,u):vn.e.copy(y,t.position)
const[r,i,o]=y
if(c>0){const t=g.lookup3d.approxNearest(r,i,o,c,h)
if(t.count>0)return v.unit=t.units[0],v.element=v.unit.elements[t.indices[0]],e.color(v,n)}const a=g.lookup3d.find(r,i,o,l,f)
if(a.count>0){let t=0,r=a.squaredDistances[0]
for(let e=1;e<a.count;++e)a.squaredDistances[e]<r&&(r=a.squaredDistances[e],t=e)
return v.unit=a.units[t],v.element=v.unit.elements[a.indices[t]],e.color(v,n)}return d},a=e.contextHash,s=e.legend}else o=()=>d
return{factory:e,granularity:"vertex",preferSmoothing:!0,color:o,props:n,contextHash:a,description:"Assigns a color based on structure property at a given vertex.",legend:s}},getParams:()=>bn,defaultValues:a.t.getDefaultValues(bn),isApplicable:e=>!0}
var Sn=n(52349)
const _n="dark-2",Cn=(0,r.Color)(13421772),wn={...(0,y.U)({type:"colors",colorList:_n})},Tn={name:"volume-instance",label:"Volume Instance",category:l.N.Misc,factory:function e(t,n){let r,i
if(t.volume){const e=(0,y.S)(t.volume.instances.length,n)
i=e.legend
const o=Xt.f.Cell.isLocation
r=t=>o(t)?e.color(t.instance):Cn}else r=()=>Cn
return{factory:e,granularity:"instance",color:r,props:n,description:"Gives every volume instance a unique color based on the position (index) of the instance in the list of instances of the volume.",legend:i}},getParams:function(e){const t=a.t.clone(wn)
return e.volume&&e.volume.instances.length>R.VI[_n].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params={...t.palette.defaultValue.params,list:{kind:"interpolate",colors:(0,R.JA)(_n).list}}),t},defaultValues:a.t.getDefaultValues(wn),isApplicable:e=>!!e.volume}
var An
!function(e){e.Category=l.N,e.Palette=function(e,t,n,r){const i=[]
if(e.every(e=>Array.isArray(e))){let t=0
for(const i of e)if(Array.isArray(i)){const e=(0,M.XV)(i[1])
e>t&&(t=e)}const n=Math.pow(10,t),r=[...e]
r.sort((e,t)=>e[1]-t[1])
const o=r.map(e=>e[0]),a=Sn.X.ofSortedArray(r.map(e=>e[1])),s=[]
for(let e=0,i=a.length-1;e<i;++e)s.push(a[e]+(a[e+1]-a[e])/2)
s.push(a[a.length-1])
const l=Sn.X.ofSortedArray(s)
for(let c=0,u=Math.max(n,e.length);c<u;++c){const e=(0,Wt.S8)(c,0,n-1),t=Sn.X.findPredecessorIndex(l,e)
i[c]=o[t]}}else for(const o of e)Array.isArray(o)?i.push(o[0]):i.push(o)
return{colors:i,filter:"set"===t?"nearest":"linear",domain:n,defaultColor:r}},e.PaletteScale=16777214,e.EmptyFactory=()=>e.Empty
const t=(0,r.Color)(13421772)
e.Empty={factory:e.EmptyFactory,granularity:"uniform",color:()=>t,props:{}},e.areEqual=function(e,t){return e.contextHash===t.contextHash&&e.factory===t.factory&&(0,h.bD)(e.props,t.props)},e.EmptyProvider={name:"",label:"",category:"",factory:e.EmptyFactory,getParams:()=>({}),defaultValues:{},isApplicable:()=>!0},e.createRegistry=function(){return new f.D(e.BuiltIn,e.EmptyProvider)},e.BuiltIn={"atom-id":Qt,"carbohydrate-symbol":d,cartoon:cn,"chain-id":m.oy,"element-index":x,"element-symbol":he,"entity-id":E,"entity-source":H,"external-structure":xn,"external-volume":sn,"formal-charge":hn,hydrophobicity:_t,illustrative:gt,"model-index":X,"molecule-type":Se,occupancy:It,"operator-hkl":Nt,"operator-name":w.PO,"partial-charge":Gt,"polymer-id":Pe,"polymer-index":Me,"residue-charge":Xe,"residue-name":Ve,"secondary-structure":tt,"sequence-id":st,"shape-group":lt.AX,"structure-index":K,"trajectory-index":le,uncertainty:ht,"unit-index":re,uniform:p.Wr,"volume-instance":Tn,"volume-segment":rn,"volume-value":en}}(An||(An={}))},42594(e,t,n){"use strict"
n.d(t,{Zk:()=>v,l1:()=>g,ES:()=>b,CY:()=>x})
var r=n(9043),i=n(32775),o=n(63356),a=n(20321),s=n(52057),l=n(37411),c=n(82094),u=n(63317)
const d=l.e.transformMat4Offset,p=l.e.fromArray,h=s.D.add,f=(0,i.U)(),m=(0,i.$I)()
function g(e,t,n,a,s,l){const c=function(e,t){for(let n=0;n<t;n++)if(i.U.fromMat4(f,i.$I.fromArray(m,e,16*n)),i.U.determinant(f)<0)return!0
return!1}(e,t)
if(l){r.IQ.update(l.matrix,l.matrix.ref.value)
const n=l.transform.ref.value.length>=16*t?l.transform.ref.value:new Float32Array(16*t)
n.set(e),r.IQ.update(l.transform,n),r.IQ.updateIfChanged(l.uInstanceCount,t),r.IQ.updateIfChanged(l.instanceCount,t)
const i=l.aTransform.ref.value.length>=16*t?l.aTransform.ref.value:new Float32Array(16*t)
r.IQ.update(l.aTransform,i)
const a=l.extraTransform.ref.value.length>=16*t?l.extraTransform.ref.value:new Float32Array(16*t)
r.IQ.update(l.extraTransform,b(a,t))
const s=l.aInstance.ref.value.length>=t?l.aInstance.ref.value:new Float32Array(t)
r.IQ.update(l.aInstance,(0,o.WE)(s,t)),r.IQ.update(l.hasReflection,c)}else l={aTransform:r.IQ.create(new Float32Array(16*t)),matrix:r.IQ.create(i.$I.identity()),transform:r.IQ.create(new Float32Array(e)),extraTransform:r.IQ.create(b(new Float32Array(16*t),t)),uInstanceCount:r.IQ.create(t),instanceCount:r.IQ.create(t),aInstance:r.IQ.create((0,o.WE)(new Float32Array(t))),hasReflection:r.IQ.create(c),instanceGrid:r.IQ.create({cellSize:0,cellCount:0,cellOffsets:new Uint32Array,cellSpheres:new Float32Array,cellTransform:new Float32Array,cellInstance:new Float32Array,batchSize:0,batchCount:0,batchOffsets:new Uint32Array,batchSpheres:new Float32Array,batchCell:new Uint32Array})}
return x(l,n,a,s),l}const y=new Float32Array(16)
function v(e){return g(new Float32Array(y),1,void 0,0,0,e)}function b(e,t){for(let n=0;n<t;n++)e.set(y,16*n)
return e}function x(e,t,n,f){const m=e.aTransform.ref.value,g=e.aInstance.ref.value,y=e.instanceCount.ref.value,v=e.matrix.ref.value,b=e.transform.ref.value,x=e.extraTransform.ref.value
for(let r=0;r<y;r++){const e=16*r
i.$I.mulOffset(m,x,b,e,e,e),i.$I.mulOffset(m,v,m,e,0,e),g[r]=r}if(t&&y>0){const i=function(e,t,n){const r=function(e,t){const{instanceCount:n,instance:r,transform:i,invariantBoundingSphere:o}=e,p=new Float32Array(n),f=new Float32Array(n),m=new Float32Array(n),g=a.C.ofBounds(0,n),y=s.D.setEmpty((0,s.D)()),{center:v,radius:b}=o,x=l.e.create(b,b,b),S=(0,l.e)()
for(let a=0;a<n;++a)d(S,v,i,0,0,16*a),p[a]=S[0],f[a]=S[1],m[a]=S[2],h(y,S)
s.D.expand(y,y,x)
const _={x:p,y:f,z:m,indices:g},C={box:y,sphere:u.f.fromBox3D((0,u.f)(),y)},w=(0,c.E)(_,C,l.e.create(t,t,t)),{array:T,offset:A,count:I}=w.buckets,P=A.length,B=new Uint32Array(P+1),E=new Float32Array(4*P),k=new Float32Array(16*n),D=new Float32Array(n),M=(0,s.D)(),R=(0,u.f)()
let O=0
for(let a=0;a<P;++a){const e=A[a],t=I[a]
B[a]=e
const n=O
for(let o=e,a=e+t;o<a;++o){const e=T[o]
D[O]=r[e]
for(let t=0;t<16;++t)k[16*O+t]=i[16*e+t]
O+=1}if(1===t)d(E,v,k,4*a,0,16*n),E[4*a+3]=b
else{s.D.setEmpty(M)
const e=16*n
for(let n=0;n<t;++n)d(S,v,k,0,0,16*n+e),h(M,S)
s.D.expand(M,M,x),u.f.fromBox3D(R,M),u.f.toArray(R,E,4*a)}}return B[P]=A[P-1]+I[P-1],{cellSize:t,cellCount:P,cellOffsets:B,cellSpheres:E,cellTransform:k,cellInstance:D}}(e,t),i=function(e,t){const{cellCount:n,cellSpheres:r}=e,i=new Float32Array(n),o=new Float32Array(n),d=new Float32Array(n),f=a.C.ofBounds(0,n),m=s.D.setEmpty((0,s.D)()),g=(0,l.e)()
let y=0
for(let a=0;a<n;++a){const e=4*a
p(g,r,e),i[a]=g[0],o[a]=g[1],d[a]=g[2],h(m,g),y=Math.max(y,r[e+3])}const v=l.e.create(y,y,y)
s.D.expand(m,m,v)
const b={x:i,y:o,z:d,indices:f},x={box:m,sphere:u.f.fromBox3D((0,u.f)(),m)},S=(0,c.E)(b,x,l.e.create(t,t,t)),{array:_,offset:C,count:w}=S.buckets,T=C.length,A=new Uint32Array(T+1),I=new Float32Array(4*T),P=new Uint32Array(n),B=(0,s.D)(),E=(0,u.f)()
let k=0
for(let a=0;a<T;++a){const e=C[a],t=w[a]
A[a]=e
for(let n=e,r=e+t;n<r;++n)P[k]=_[n],k+=1
if(1===t){const t=_[e]
I[4*a]=r[4*t],I[4*a+1]=r[4*t+1],I[4*a+2]=r[4*t+2],I[4*a+3]=r[4*t+3]}else{s.D.setEmpty(B),y=0
for(let n=e,i=e+t;n<i;++n){const e=_[n]
g[0]=r[4*e],g[1]=r[4*e+1],g[2]=r[4*e+2],h(B,g),y=Math.max(y,r[4*e+3])}l.e.set(v,y,y,y),s.D.expand(B,B,v),u.f.fromBox3D(E,B),u.f.toArray(E,I,4*a)}}return A[T]=C[T-1]+w[T-1],{batchSize:t,batchCount:T,batchOffsets:A,batchSpheres:I,batchCell:P}}(r,n),f=new Uint32Array(r.cellOffsets.length),m=new Float32Array(r.cellSpheres.length),g=new Float32Array(r.cellInstance.length)
let y=0
for(let o=0,a=i.batchCell.length;o<a;++o){const t=i.batchCell[o],n=r.cellOffsets[t],a=r.cellOffsets[t+1]-n
f[o+1]=f[o]+a
for(let e=0;e<4;++e)m[4*o+e]=r.cellSpheres[4*t+e]
for(let i=0;i<a;++i){const t=n+i,o=r.cellInstance[t]
for(let n=0;n<16;++n)r.cellTransform[16*y+n]=e.transform[16*o+n]
g[y]=o,y+=1}}return{cellSize:r.cellSize,cellCount:r.cellCount,cellOffsets:f,cellSpheres:m,cellTransform:r.cellTransform,cellInstance:g,batchSize:i.batchSize,batchCount:i.batchCount,batchOffsets:i.batchOffsets,batchSpheres:i.batchSpheres,batchCell:(0,o.WE)(i.batchCell)}}({instanceCount:y,instance:g,transform:m,invariantBoundingSphere:t},n,f)
r.IQ.update(e.instanceGrid,i),r.IQ.update(e.aInstance,i.cellInstance),r.IQ.update(e.aTransform,i.cellTransform)}else r.IQ.update(e.aInstance,g),r.IQ.update(e.aTransform,m)}i.$I.toArray(i.$I.identity(),y,0)},42629(e,t,n){"use strict"
function r(e,t,n){return{i:e,j:t,k:n}}function i(e,t){return{a:e,b:t}}n.d(t,{Dn:()=>s,IT:()=>l,WH:()=>a,my:()=>u,sE:()=>c})
const o=[r(0,0,0),r(1,0,0),r(1,1,0),r(0,1,0),r(0,0,1),r(1,0,1),r(1,1,1),r(0,1,1)],a=[i(o[0],o[1]),i(o[1],o[2]),i(o[2],o[3]),i(o[3],o[0]),i(o[4],o[5]),i(o[5],o[6]),i(o[6],o[7]),i(o[7],o[4]),i(o[0],o[4]),i(o[1],o[5]),i(o[2],o[6]),i(o[3],o[7])],s=[{i:0,j:0,k:0,e:0},{i:1,j:0,k:0,e:1},{i:0,j:1,k:0,e:0},{i:0,j:0,k:0,e:1},{i:0,j:0,k:1,e:0},{i:1,j:0,k:1,e:1},{i:0,j:1,k:1,e:0},{i:0,j:0,k:1,e:1},{i:0,j:0,k:0,e:2},{i:1,j:0,k:0,e:2},{i:1,j:1,k:0,e:2},{i:0,j:1,k:0,e:2}],l=[0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0],c=[[],[0,8,3],[0,1,9],[1,8,3,9,8,1],[1,2,10],[0,8,3,1,2,10],[9,2,10,0,2,9],[2,8,3,2,10,8,10,9,8],[3,11,2],[0,11,2,8,11,0],[1,9,0,2,3,11],[1,11,2,1,9,11,9,8,11],[3,10,1,11,10,3],[0,10,1,0,8,10,8,11,10],[3,9,0,3,11,9,11,10,9],[9,8,10,10,8,11],[4,7,8],[4,3,0,7,3,4],[0,1,9,8,4,7],[4,1,9,4,7,1,7,3,1],[1,2,10,8,4,7],[3,4,7,3,0,4,1,2,10],[9,2,10,9,0,2,8,4,7],[2,10,9,2,9,7,2,7,3,7,9,4],[8,4,7,3,11,2],[11,4,7,11,2,4,2,0,4],[9,0,1,8,4,7,2,3,11],[4,7,11,9,4,11,9,11,2,9,2,1],[3,10,1,3,11,10,7,8,4],[1,11,10,1,4,11,1,0,4,7,11,4],[4,7,8,9,0,11,9,11,10,11,0,3],[4,7,11,4,11,9,9,11,10],[9,5,4],[9,5,4,0,8,3],[0,5,4,1,5,0],[8,5,4,8,3,5,3,1,5],[1,2,10,9,5,4],[3,0,8,1,2,10,4,9,5],[5,2,10,5,4,2,4,0,2],[2,10,5,3,2,5,3,5,4,3,4,8],[9,5,4,2,3,11],[0,11,2,0,8,11,4,9,5],[0,5,4,0,1,5,2,3,11],[2,1,5,2,5,8,2,8,11,4,8,5],[10,3,11,10,1,3,9,5,4],[4,9,5,0,8,1,8,10,1,8,11,10],[5,4,0,5,0,11,5,11,10,11,0,3],[5,4,8,5,8,10,10,8,11],[9,7,8,5,7,9],[9,3,0,9,5,3,5,7,3],[0,7,8,0,1,7,1,5,7],[1,5,3,3,5,7],[9,7,8,9,5,7,10,1,2],[10,1,2,9,5,0,5,3,0,5,7,3],[8,0,2,8,2,5,8,5,7,10,5,2],[2,10,5,2,5,3,3,5,7],[7,9,5,7,8,9,3,11,2],[9,5,7,9,7,2,9,2,0,2,7,11],[2,3,11,0,1,8,1,7,8,1,5,7],[11,2,1,11,1,7,7,1,5],[9,5,8,8,5,7,10,1,3,10,3,11],[5,7,0,5,0,9,7,11,0,1,0,10,11,10,0],[11,10,0,11,0,3,10,5,0,8,0,7,5,7,0],[11,10,5,7,11,5],[10,6,5],[0,8,3,5,10,6],[9,0,1,5,10,6],[1,8,3,1,9,8,5,10,6],[1,6,5,2,6,1],[1,6,5,1,2,6,3,0,8],[9,6,5,9,0,6,0,2,6],[5,9,8,5,8,2,5,2,6,3,2,8],[2,3,11,10,6,5],[11,0,8,11,2,0,10,6,5],[0,1,9,2,3,11,5,10,6],[5,10,6,1,9,2,9,11,2,9,8,11],[6,3,11,6,5,3,5,1,3],[0,8,11,0,11,5,0,5,1,5,11,6],[3,11,6,0,3,6,0,6,5,0,5,9],[6,5,9,6,9,11,11,9,8],[5,10,6,4,7,8],[4,3,0,4,7,3,6,5,10],[1,9,0,5,10,6,8,4,7],[10,6,5,1,9,7,1,7,3,7,9,4],[6,1,2,6,5,1,4,7,8],[1,2,5,5,2,6,3,0,4,3,4,7],[8,4,7,9,0,5,0,6,5,0,2,6],[7,3,9,7,9,4,3,2,9,5,9,6,2,6,9],[3,11,2,7,8,4,10,6,5],[5,10,6,4,7,2,4,2,0,2,7,11],[0,1,9,4,7,8,2,3,11,5,10,6],[9,2,1,9,11,2,9,4,11,7,11,4,5,10,6],[8,4,7,3,11,5,3,5,1,5,11,6],[5,1,11,5,11,6,1,0,11,7,11,4,0,4,11],[0,5,9,0,6,5,0,3,6,11,6,3,8,4,7],[6,5,9,6,9,11,4,7,9,7,11,9],[10,4,9,6,4,10],[4,10,6,4,9,10,0,8,3],[10,0,1,10,6,0,6,4,0],[8,3,1,8,1,6,8,6,4,6,1,10],[1,4,9,1,2,4,2,6,4],[3,0,8,1,2,9,2,4,9,2,6,4],[0,2,4,4,2,6],[8,3,2,8,2,4,4,2,6],[10,4,9,10,6,4,11,2,3],[0,8,2,2,8,11,4,9,10,4,10,6],[3,11,2,0,1,6,0,6,4,6,1,10],[6,4,1,6,1,10,4,8,1,2,1,11,8,11,1],[9,6,4,9,3,6,9,1,3,11,6,3],[8,11,1,8,1,0,11,6,1,9,1,4,6,4,1],[3,11,6,3,6,0,0,6,4],[6,4,8,11,6,8],[7,10,6,7,8,10,8,9,10],[0,7,3,0,10,7,0,9,10,6,7,10],[10,6,7,1,10,7,1,7,8,1,8,0],[10,6,7,10,7,1,1,7,3],[1,2,6,1,6,8,1,8,9,8,6,7],[2,6,9,2,9,1,6,7,9,0,9,3,7,3,9],[7,8,0,7,0,6,6,0,2],[7,3,2,6,7,2],[2,3,11,10,6,8,10,8,9,8,6,7],[2,0,7,2,7,11,0,9,7,6,7,10,9,10,7],[1,8,0,1,7,8,1,10,7,6,7,10,2,3,11],[11,2,1,11,1,7,10,6,1,6,7,1],[8,9,6,8,6,7,9,1,6,11,6,3,1,3,6],[0,9,1,11,6,7],[7,8,0,7,0,6,3,11,0,11,6,0],[7,11,6],[7,6,11],[3,0,8,11,7,6],[0,1,9,11,7,6],[8,1,9,8,3,1,11,7,6],[10,1,2,6,11,7],[1,2,10,3,0,8,6,11,7],[2,9,0,2,10,9,6,11,7],[6,11,7,2,10,3,10,8,3,10,9,8],[7,2,3,6,2,7],[7,0,8,7,6,0,6,2,0],[2,7,6,2,3,7,0,1,9],[1,6,2,1,8,6,1,9,8,8,7,6],[10,7,6,10,1,7,1,3,7],[10,7,6,1,7,10,1,8,7,1,0,8],[0,3,7,0,7,10,0,10,9,6,10,7],[7,6,10,7,10,8,8,10,9],[6,8,4,11,8,6],[3,6,11,3,0,6,0,4,6],[8,6,11,8,4,6,9,0,1],[9,4,6,9,6,3,9,3,1,11,3,6],[6,8,4,6,11,8,2,10,1],[1,2,10,3,0,11,0,6,11,0,4,6],[4,11,8,4,6,11,0,2,9,2,10,9],[10,9,3,10,3,2,9,4,3,11,3,6,4,6,3],[8,2,3,8,4,2,4,6,2],[0,4,2,4,6,2],[1,9,0,2,3,4,2,4,6,4,3,8],[1,9,4,1,4,2,2,4,6],[8,1,3,8,6,1,8,4,6,6,10,1],[10,1,0,10,0,6,6,0,4],[4,6,3,4,3,8,6,10,3,0,3,9,10,9,3],[10,9,4,6,10,4],[4,9,5,7,6,11],[0,8,3,4,9,5,11,7,6],[5,0,1,5,4,0,7,6,11],[11,7,6,8,3,4,3,5,4,3,1,5],[9,5,4,10,1,2,7,6,11],[6,11,7,1,2,10,0,8,3,4,9,5],[7,6,11,5,4,10,4,2,10,4,0,2],[3,4,8,3,5,4,3,2,5,10,5,2,11,7,6],[7,2,3,7,6,2,5,4,9],[9,5,4,0,8,6,0,6,2,6,8,7],[3,6,2,3,7,6,1,5,0,5,4,0],[6,2,8,6,8,7,2,1,8,4,8,5,1,5,8],[9,5,4,10,1,6,1,7,6,1,3,7],[1,6,10,1,7,6,1,0,7,8,7,0,9,5,4],[4,0,10,4,10,5,0,3,10,6,10,7,3,7,10],[7,6,10,7,10,8,5,4,10,4,8,10],[6,9,5,6,11,9,11,8,9],[3,6,11,0,6,3,0,5,6,0,9,5],[0,11,8,0,5,11,0,1,5,5,6,11],[6,11,3,6,3,5,5,3,1],[1,2,10,9,5,11,9,11,8,11,5,6],[0,11,3,0,6,11,0,9,6,5,6,9,1,2,10],[11,8,5,11,5,6,8,0,5,10,5,2,0,2,5],[6,11,3,6,3,5,2,10,3,10,5,3],[5,8,9,5,2,8,5,6,2,3,8,2],[9,5,6,9,6,0,0,6,2],[1,5,8,1,8,0,5,6,8,3,8,2,6,2,8],[1,5,6,2,1,6],[1,3,6,1,6,10,3,8,6,5,6,9,8,9,6],[10,1,0,10,0,6,9,5,0,5,6,0],[0,3,8,5,6,10],[10,5,6],[11,5,10,7,5,11],[11,5,10,11,7,5,8,3,0],[5,11,7,5,10,11,1,9,0],[10,7,5,10,11,7,9,8,1,8,3,1],[11,1,2,11,7,1,7,5,1],[0,8,3,1,2,7,1,7,5,7,2,11],[9,7,5,9,2,7,9,0,2,2,11,7],[7,5,2,7,2,11,5,9,2,3,2,8,9,8,2],[2,5,10,2,3,5,3,7,5],[8,2,0,8,5,2,8,7,5,10,2,5],[9,0,1,5,10,3,5,3,7,3,10,2],[9,8,2,9,2,1,8,7,2,10,2,5,7,5,2],[1,3,5,3,7,5],[0,8,7,0,7,1,1,7,5],[9,0,3,9,3,5,5,3,7],[9,8,7,5,9,7],[5,8,4,5,10,8,10,11,8],[5,0,4,5,11,0,5,10,11,11,3,0],[0,1,9,8,4,10,8,10,11,10,4,5],[10,11,4,10,4,5,11,3,4,9,4,1,3,1,4],[2,5,1,2,8,5,2,11,8,4,5,8],[0,4,11,0,11,3,4,5,11,2,11,1,5,1,11],[0,2,5,0,5,9,2,11,5,4,5,8,11,8,5],[9,4,5,2,11,3],[2,5,10,3,5,2,3,4,5,3,8,4],[5,10,2,5,2,4,4,2,0],[3,10,2,3,5,10,3,8,5,4,5,8,0,1,9],[5,10,2,5,2,4,1,9,2,9,4,2],[8,4,5,8,5,3,3,5,1],[0,4,5,1,0,5],[8,4,5,8,5,3,9,0,5,0,3,5],[9,4,5],[4,11,7,4,9,11,9,10,11],[0,8,3,4,9,7,9,11,7,9,10,11],[1,10,11,1,11,4,1,4,0,7,4,11],[3,1,4,3,4,8,1,10,4,7,4,11,10,11,4],[4,11,7,9,11,4,9,2,11,9,1,2],[9,7,4,9,11,7,9,1,11,2,11,1,0,8,3],[11,7,4,11,4,2,2,4,0],[11,7,4,11,4,2,8,3,4,3,2,4],[2,9,10,2,7,9,2,3,7,7,4,9],[9,10,7,9,7,4,10,2,7,8,7,0,2,0,7],[3,7,10,3,10,2,7,4,10,1,10,0,4,0,10],[1,10,2,8,7,4],[4,9,1,4,1,7,7,1,3],[4,9,1,4,1,7,0,8,1,8,7,1],[4,0,3,7,4,3],[4,8,7],[9,10,8,10,11,8],[3,0,9,3,9,11,11,9,10],[0,1,10,0,10,8,8,10,11],[3,1,10,11,3,10],[1,2,11,1,11,9,9,11,8],[3,0,9,3,9,11,1,2,9,2,11,9],[0,2,11,8,0,11],[3,2,11],[2,3,8,2,8,10,10,8,9],[9,10,2,0,9,2],[2,3,8,2,8,10,0,1,8,1,10,8],[1,10,2],[1,3,8,9,1,8],[0,9,1],[0,3,8],[]],u=[[0,4,4,4,2,0,0,0,2,2,0,0],[4,0,4,4,0,8,0,0,0,8,8,0],[4,4,0,4,0,0,8,0,0,0,8,8],[4,4,4,0,0,0,0,1,1,0,0,1],[2,0,0,0,0,8,8,8,2,2,0,0],[0,8,0,0,8,0,8,8,0,8,8,0],[0,0,8,0,8,8,0,8,0,0,8,8],[0,0,0,1,8,8,8,0,1,0,0,1],[2,0,0,1,2,0,0,1,0,2,0,1],[2,8,0,0,2,8,0,0,2,0,8,0],[0,8,8,0,0,8,8,0,0,8,0,8],[0,0,8,1,0,0,8,1,1,0,8,0]]},42872(e,t,n){"use strict"
n.d(t,{PS:()=>f,G:()=>m})
var r=n(46357),i=n(19708),o=n(95916),a=n(9043),s=n(83164),l=n(36568),c=n(32775),u=n(92384),d=n(85362),p=n(5638),h=n(54749)
const f={scale:u.t.Numeric(1,{min:1,max:5,step:1}),threshold:u.t.Numeric(.33,{min:.01,max:1,step:.01}),color:u.t.Color((0,h.Color)(0)),includeTransparent:u.t.Boolean(!0,{description:"Whether to show outline for transparent objects"})}
class m{static isEnabled(e){return e.enabled&&"off"!==e.outline.name}constructor(e,t,n,i,u){this.webgl=e,this.target=e.createRenderTarget(t,n,!1),this.renderable=function(e,t,n){const i=t.getWidth(),u=t.getHeight(),p={...r.OM,tDepthOpaque:a.IQ.create(t),tDepthTransparent:a.IQ.create(n),uTexSize:a.IQ.create(c.ZY.create(i,u)),dOrthographic:a.IQ.create(0),uNear:a.IQ.create(1),uFar:a.IQ.create(1e4),uInvProjection:a.IQ.create(c.$I.identity()),uOutlineThreshold:a.IQ.create(.33),dTransparentOutline:a.IQ.create(!0)},h={...g},f=(0,o.NG)("outlines",d.e,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tDepthOpaque;\nuniform sampler2D tDepthTransparent;\nuniform vec2 uTexSize;\n\nuniform float uNear;\nuniform float uFar;\nuniform mat4 uInvProjection;\n\nuniform float uOutlineThreshold;\n\n#include common\n\nfloat getViewZ(const in float depth) {\n    #if dOrthographic == 1\n        return orthographicDepthToViewZ(depth, uNear, uFar);\n    #else\n        return perspectiveDepthToViewZ(depth, uNear, uFar);\n    #endif\n}\n\nfloat getDepthOpaque(const in vec2 coords) {\n    #ifdef depthTextureSupport\n        return texture2D(tDepthOpaque, coords).r;\n    #else\n        return unpackRGBAToDepth(texture2D(tDepthOpaque, coords));\n    #endif\n}\n\nvec2 getDepthTransparentWithAlpha(const in vec2 coords) {\n    #ifdef dTransparentOutline\n        return unpackRGBAToDepthWithAlpha(texture2D(tDepthTransparent, coords));\n    #else\n        return vec2(1.0, 0.0);\n    #endif\n}\n\nbool isBackground(const in float depth) {\n    return depth == 1.0;\n}\n\nfloat getPixelSize(const in vec2 coords, const in float depth) {\n    vec3 viewPos0 = screenSpaceToViewSpace(vec3(coords, depth), uInvProjection);\n    vec3 viewPos1 = screenSpaceToViewSpace(vec3(coords + vec2(1.0, 0.0) / uTexSize, depth), uInvProjection);\n    return distance(viewPos0, viewPos1);\n}\n\nvoid main(void) {\n    float backgroundViewZ = 2.0 * uFar;\n\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n    vec2 invTexSize = 1.0 / uTexSize;\n\n    float selfDepthOpaque = getDepthOpaque(coords);\n    float selfViewZOpaque = isBackground(selfDepthOpaque) ? backgroundViewZ : getViewZ(selfDepthOpaque);\n    float pixelSizeOpaque = getPixelSize(coords, selfDepthOpaque) * uOutlineThreshold;\n\n    vec2 selfDepthTransparentWithAlpha = getDepthTransparentWithAlpha(coords);\n    float selfDepthTransparent = selfDepthTransparentWithAlpha.x;\n    float selfViewZTransparent = isBackground(selfDepthTransparent) ? backgroundViewZ : getViewZ(selfDepthTransparent);\n    float pixelSizeTransparent = getPixelSize(coords, selfDepthTransparent) * uOutlineThreshold;\n\n    float bestOpaqueDepth = 1.0;\n    float bestTransparentDepth = 1.0;\n    float bestTransparentAlpha = 0.0;\n\n    float opaqueOutlineFlag = 0.0;\n    float transparentOutlineFlag = 0.0;\n\n    for (int y = -1; y <= 1; y++) {\n        for (int x = -1; x <= 1; x++) {\n            vec2 sampleCoords = coords + vec2(float(x), float(y)) * invTexSize;\n\n            // Opaque\n            float sampleDepthOpaque = getDepthOpaque(sampleCoords);\n            float sampleViewZOpaque = isBackground(sampleDepthOpaque) ? backgroundViewZ : getViewZ(sampleDepthOpaque);\n            if (abs(selfViewZOpaque - sampleViewZOpaque) > pixelSizeOpaque && selfDepthOpaque > sampleDepthOpaque && sampleDepthOpaque <= bestOpaqueDepth) {\n                bestOpaqueDepth = sampleDepthOpaque;\n                opaqueOutlineFlag = 1.0;\n            }\n\n            // Transparent\n            vec2 sampleDepthTransparentWithAlpha = getDepthTransparentWithAlpha(sampleCoords);\n            float sampleDepthTransparent = sampleDepthTransparentWithAlpha.x;\n            float sampleAlphaTransparent = sampleDepthTransparentWithAlpha.y;\n            float sampleViewZTransparent = isBackground(sampleDepthTransparent) ? backgroundViewZ : getViewZ(sampleDepthTransparent);\n            if (abs(selfViewZTransparent - sampleViewZTransparent) > pixelSizeTransparent && selfDepthTransparent > sampleDepthTransparent && sampleDepthTransparent <= bestTransparentDepth) {\n                bestTransparentDepth = sampleDepthTransparent;\n                bestTransparentAlpha = sampleAlphaTransparent;\n                transparentOutlineFlag = 1.0;\n            }\n        }\n    }\n\n    if (transparentOutlineFlag > 0.0 && bestOpaqueDepth < 1.0 && bestTransparentDepth > bestOpaqueDepth) {\n        transparentOutlineFlag = 0.0;\n        bestTransparentAlpha = 0.0;\n    }\n\n    vec2 depthPacked; // Pack depth in G/B channels\n    float outlineTypeFlag = 0.0;\n    if (opaqueOutlineFlag > 0.0 && transparentOutlineFlag > 0.0) {\n        outlineTypeFlag = 0.75; // Both\n        depthPacked = packUnitIntervalToRG(bestOpaqueDepth);\n    } else if (transparentOutlineFlag > 0.0) {\n        outlineTypeFlag = 0.5;  // Transparent only\n        depthPacked = packUnitIntervalToRG(bestTransparentDepth);\n    } else if (opaqueOutlineFlag > 0.0) {\n        outlineTypeFlag = 0.25; // Opaque only\n        depthPacked = packUnitIntervalToRG(bestOpaqueDepth);\n    }\n\n    float alpha = clamp(bestTransparentAlpha, 0.0, 0.5) * 2.0; // limiting to range [0.0, 0.5] to improve alpha precision since we don't need a wider range\n    float packedFlagWithAlpha = pack2x4(vec2(outlineTypeFlag, alpha)); // pack outlineType with alpha\n    gl_FragColor = vec4(packedFlagWithAlpha, depthPacked.x, depthPacked.y, bestTransparentDepth);\n}\n"),m=(0,s.$h)(e,"triangles",f,h,p)
return(0,l._)(m,p)}(e,u,i)}getByteCount(){return this.target.getByteCount()}setSize(e,t){const[n,r]=this.renderable.values.uTexSize.ref.value
e===n&&t===r||(this.target.setSize(e,t),a.IQ.update(this.renderable.values.uTexSize,c.ZY.set(this.renderable.values.uTexSize.ref.value,e,t)))}update(e,t,n,r){var i
let o=!1
const s="orthographic"===e.state.mode?1:0,l=this.renderable.values.uInvProjection.ref.value
c.$I.invert(l,e.projection)
const u=null===(i=t.includeTransparent)||void 0===i||i,d=Math.max(1,Math.round(t.scale*this.webgl.pixelRatio))-1,p=50*t.threshold*this.webgl.pixelRatio
return a.IQ.updateIfChanged(this.renderable.values.uNear,e.near),a.IQ.updateIfChanged(this.renderable.values.uFar,e.far),a.IQ.update(this.renderable.values.uInvProjection,l),this.renderable.values.dTransparentOutline.ref.value!==u&&(o=!0,a.IQ.update(this.renderable.values.dTransparentOutline,u)),this.renderable.values.dOrthographic.ref.value!==s&&(o=!0,a.IQ.update(this.renderable.values.dOrthographic,s)),a.IQ.updateIfChanged(this.renderable.values.uOutlineThreshold,p),this.renderable.values.tDepthTransparent.ref.value!==n&&(o=!0,a.IQ.update(this.renderable.values.tDepthTransparent,n)),this.renderable.values.tDepthOpaque.ref.value!==r&&(o=!0,a.IQ.update(this.renderable.values.tDepthOpaque,r)),o&&this.renderable.update(),{transparentOutline:u,outlineScale:d}}render(){p.g$&&this.webgl.timer.mark("OutlinePass.render"),this.target.bind(),this.renderable.render(),p.g$&&this.webgl.timer.markEnd("OutlinePass.render")}}const g={...r.du,tDepthOpaque:(0,i.$G)("texture","rgba","ubyte","nearest"),tDepthTransparent:(0,i.$G)("texture","rgba","ubyte","nearest"),uTexSize:(0,i.w5)("v2"),dOrthographic:(0,i.$F)("number"),uNear:(0,i.w5)("f"),uFar:(0,i.w5)("f"),uInvProjection:(0,i.w5)("m4"),uOutlineThreshold:(0,i.w5)("f"),dTransparentOutline:(0,i.$F)("boolean")}},42988(e,t,n){"use strict"
function r(e,t,n){return e[t]-e[n]}function i(e,t,n){const r=e[t]
e[t]=e[n],e[n]=r}function o(e,t,n,r){const i=n+r>>1
return t(e,n,r)>0?t(e,n,i)>0?t(e,i,r)>0?i:r:n:t(e,r,i)>0?t(e,i,n)>0?i:n:r}function a(e,t,n){const{cmp:r,swap:i,data:a,parts:s}=e
let l=t+1,c=n
for(i(a,t,o(a,r,t,n));r(a,c,t)>0;)--c
for(let o=t+1;o<=c;o++){const e=r(a,o,t)
if(e>0){for(i(a,o,c),--c;r(a,c,t)>0;)--c
o--}else 0===e&&(i(a,o,l),l++)}for(let o=t;o<l;o++)i(a,o,t+c-o)
s[0]=c-l+t+1,s[1]=c}function s({data:e,cmp:t,swap:n},r,i){for(let o=r+1;o<=i;o++){let i=o-1
for(;i>=r&&t(e,i,i+1)>0;)n(e,i,i+1),i-=1}}function l(e,t,n){const{parts:r}=e
for(;t<n;){if(n-t<16)return void s(e,t,n)
a(e,t,n)
const i=r[0],o=r[1]
i-t<n-o?(l(e,t,i-1),t=o+1):(l(e,o+1,n),n=i-1)}}function c(e,t,n,a){let s=n+1,l=a
i(e,n,o(e,r,n,a))
const c=e[n]
for(;e[l]>c;)--l
for(let r=n+1;r<=l;r++){const t=e[r]
if(t>c){for(i(e,r,l),--l;e[l]>c;)--l
r--}else t===c&&(i(e,r,s),++s)}for(let r=n;r<s;r++)i(e,r,n+l-r)
t[0]=l-s+n+1,t[1]=l}function u(e,t,n){for(let r=t+1;r<=n;r++){const n=e[r]
let i=r-1
for(;i>=t&&e[i]>n;)e[i+1]=e[i],i-=1
e[i+1]=n}}function d(e,t,n,r){for(;n<r;){if(r-n<16)return void u(e,n,r)
c(e,t,n,r)
const i=t[0],o=t[1]
i-n<r-o?(d(e,t,n,i-1),n=o+1):(d(e,t,o+1,r),r=i-1)}}function p(e,t=r){return function(e,t,n,o=r){return o===r?d(e,[0,0],t,n-1):l({data:e,cmp:o,swap:i,parts:[0,0]},t,n-1),e}(e,0,e.length,t)}function h(e,t,n,r,i){return l({data:e,cmp:r,swap:i,parts:[0,0]},t,n-1),e}n.d(t,{VE:()=>i,di:()=>h,eh:()=>p})},43052(e,t,n){"use strict"
function r([e]){return Math.trunc(e)}n.r(t),n.d(t,{default:()=>i,trunc:()=>r})
var i=(0,n(10336).helper)(r)},43227(e,t,n){"use strict"
n.d(t,{ZH:()=>f,_k:()=>p,z9:()=>h})
var r=n(15546),i=n(9054)
const o=/(\-|\_|\.|\s)+(.)?/g,a=/(^|\/)([A-Z])/g,s=(new r.qK(e=>e.replace(o,(e,t,n)=>n?n.toUpperCase():"").replace(a,e=>e.toLowerCase())),/([a-z\d])([A-Z]+)/g),l=/\-|\s+/g,c=new r.qK(e=>e.replace(s,"$1_$2").replace(l,"_").toLowerCase()),u=/(^|\/)([a-z\u00C0-\u024F])/g,d=new r.qK(e=>e.replace(u,e=>e.toUpperCase())),p=r._k
function h(e){return c.get(e)}function f(e){return d.get(e)}const m=/^\s*$/,g=/([\w/-]+[_/\s-])([a-z\d]+$)/,y=/([\w/\s-]+)([A-Z][a-z\d]*$)/,v=/[A-Z][a-z\d]*$/,b=(new r.qK(e=>function(e){return w(e,_,S)}(e)),new r.qK(e=>function(e){return w(e,C,x)}(e)),new Set(i.C.uncountable)),x=new Map,S=new Map,_=new Map(i.C.singular.reverse()),C=new Map(i.C.plurals.reverse())
function w(e,t,n){if(!e||m.test(e))return e
const r=e.toLowerCase()
if(b.has(r))return e
const i=g.exec(e)||y.exec(e),o=i?i[2].toLowerCase():null
if(o&&b.has(o))return e
const a=v.test(e)
for(let[s,l]of n)if(r.match(s+"$"))return a&&o&&n.has(o)&&(l=f(l),s=f(s)),e.replace(new RegExp(s,"i"),l)
for(const[s,l]of t)if(s.test(e))return e.replace(s,l)
return e}i.C.irregularPairs.forEach(e=>{x.set(e[0].toLowerCase(),e[1]),x.set(e[1].toLowerCase(),e[1]),S.set(e[1].toLowerCase(),e[0]),S.set(e[0].toLowerCase(),e[0])})},43472(e,t,n){"use strict"
n.d(t,{Uw:()=>P,KW:()=>X.K,BM:()=>r,so:()=>o,QX:()=>h.Q,Cn:()=>u.C,xE:()=>d.x,uF:()=>c.u})
var r,i,o,a=n(9043)
!function(e){function t(e){var t
return(t=class{static is(t){return!!t&&e===t.type}constructor(t,n){this.data=t,this.id=a.kk.create22(),this.type=e,this.label=n&&n.label||e.name,this.description=n&&n.description}}).type=e,t}e.factory=function(){return e=>t(e)},e.create=t,e.hasTag=function(e,t){if(!e.tags)return!1
for(const n of e.tags)if(n===t)return!0
return!1},e.Null={id:a.kk.create22(),type:{name:"Null",typeClass:"Null"},data:void 0,label:"Null"}}(r||(r={})),function(e){e.is=function(e){const t=e
return!!(t&&t.transform&&t.parent&&t.status)},e.resolve=function(t,n){const r="string"==typeof n?n:e.is(n)?n.transform.ref:n.ref
return t.cells.get(r)}}(i||(i={}))
class s{get cell(){var e
return null===(e=this.state)||void 0===e?void 0:e.cells.get(this.ref)}get obj(){var e,t
return null===(t=null===(e=this.state)||void 0===e?void 0:e.cells.get(this.ref))||void 0===t?void 0:t.obj}get data(){var e
return null===(e=this.obj)||void 0===e?void 0:e.data}update(e,t){if(!this.state)throw new Error("To use update() from StateObjectSelector, 'state' must be defined.")
return t||(t=this.state.build()),(t||this.state.build()).to(this).update(e),t}checkValid(){if(!this.state)throw new Error("Unassigned State.")
const e=this.cell
if(!e)throw new Error("Not created at all. Did you await/then the corresponding state update?")
if("ok"===e.status)return!0
if("error"===e.status)throw new Error(e.errorText)
if(e.obj===r.Null)throw new Error("The object is Null.")
throw new Error("Unresolved. Did you await/then the corresponding state update?")}get isOk(){const e=this.cell
return e&&"ok"===e.status&&e.obj!==r.Null}constructor(e,t){this.ref=e,this.state=t}}!function(e){function t(e,t){if(t)return i.is(t)?t:"string"==typeof t?e.cells.get(t):t.cell}e.resolveRef=function(e){var t
if(e)return"string"==typeof e?e:i.is(e)?e.transform.ref:null===(t=e.cell)||void 0===t?void 0:t.transform.ref},e.resolve=t,e.resolveAndCheck=function(e,n){const r=t(e,n)
if(r&&r.obj&&"ok"===r.status)return r}}(o||(o={}))
var l,c=n(96156),u=n(58558),d=n(69185),p=n(70292),h=n(78450),f=n(17487),m=n(70331),g=n(34761)
function y(...e){let t
const n=[]
for(const r of e)if(r)if(t||(t=new Set),"string"==typeof r){if(t.has(r))continue
t.add(r),n.push(r)}else for(const e of r)t.has(e)||(t.add(e),n.push(e))
return n}!function(e){function t(e){const t=new Set
for(const n of e.actions)switch(n.kind){case"add":t.add(n.transform.ref)
break
case"update":case"delete":t.add(n.ref)
break
case"insert":{t.add(n.ref),t.add(n.transform.ref)
const r=e.tree.children.get(n.ref).toArray()
for(const e of r)t.add(e)
break}}return Array.from(t)}function n(e,n){if(!e.state||e.state.tree===e.editInfo.sourceTree){const r=e.tree.asImmutable()
return(null==n?void 0:n.useHashVersion)&&m.u.setParamHashVersion(r,t(e)),r}const r=e.state.tree.asTransient()
for(const t of e.actions)switch(t.kind){case"add":r.add(t.transform)
break
case"update":r.setParams(t.ref,t.params)
break
case"delete":r.remove(t.ref)
break
case"insert":{const e=r.children.get(t.ref).toArray()
r.add(t.transform)
for(const n of e)r.changeParent(n,t.transform.ref)
break}}e.editInfo.sourceTree=e.tree
const i=r.asImmutable()
return(null==n?void 0:n.useHashVersion)&&m.u.setParamHashVersion(i,t(e)),i}e.is=function(e){return!!e&&"function"==typeof e.getTree},e.isTo=function(e){return!!e&&"function"==typeof e.getTree&&"string"==typeof e.ref},e.Root=class{get editInfo(){return this.state.editInfo}get currentTree(){return this.state.tree}to(e){const t="string"==typeof e?e:i.is(e)?e.transform.ref:e.ref
return new r(this.state,t,this)}toRoot(){return new r(this.state,this.state.tree.root.ref,this)}delete(e){const t=o.resolveRef(e)
return t&&this.state.tree.transforms.has(t)?(this.editInfo.count++,this.state.tree.remove(t),this.state.actions.push({kind:"delete",ref:t}),this):this}getTree(e){return n(this.state,e)}commit(e){if(!this.state.state)throw new Error("Cannot commit template tree")
return this.state.state.runTask(this.state.state.updateTree(this,e))}constructor(e,t){this.state={state:t,tree:e.asTransient(),actions:[],editInfo:{applied:!1,sourceTree:e,count:0,lastUpdate:void 0}}}}
class r{get editInfo(){return this.state.editInfo}get selector(){return new s(this.ref,this.state.state)}getApplyRoot(){return m.u.getDecoratorRoot(this.state.tree,this.ref)}apply(e,t,n){if(e.definition.isDecorator)return this.insert(e,t,n)
const i=this.getApplyRoot(),o=e.apply(i,t,n)
return this.state.tree.add(o),this.editInfo.count++,this.editInfo.lastUpdate=o.ref,this.state.actions.push({kind:"add",transform:o}),new r(this.state,o.ref,this.root)}applyOrUpdate(e,t,n,r){if(this.state.tree.transforms.has(e)){const t=this.to(e)
return n&&t.update(n),t}return this.apply(t,n,{...r,ref:e})}applyOrUpdateTagged(e,t,n,i){if(t.definition.isDecorator)throw new Error("Can't use applyOrUpdateTagged on decorator transformers.")
const o=this.getApplyRoot(),a=this.state.tree.children.get(o).values()
for(;;){const t=a.next()
if(t.done)break
const r=this.state.tree.transforms.get(t.value)
if(r&&u.C.hasTags(r,e)){const o=this.to(t.value)
return o.updateTagged(n,y(r.tags,e,i&&i.tags)),o}}const s=t.apply(o,n,{...i,tags:y(e,i&&i.tags)})
return this.state.tree.add(s),this.editInfo.count++,this.editInfo.lastUpdate=s.ref,this.state.actions.push({kind:"add",transform:s}),new r(this.state,s.ref,this.root)}group(e,t,n){return this.apply(e,t,n)}insert(e,t,n){const i=this.state.tree.children.get(this.ref).toArray(),o=e.apply(this.ref,t,n)
this.state.tree.add(o)
for(const r of i)this.state.tree.changeParent(r,o.ref)
return this.editInfo.count++,this.editInfo.lastUpdate=o.ref,this.state.actions.push({kind:"insert",ref:this.ref,transform:o}),new r(this.state,o.ref,this.root)}updateTagged(e,t){(this.state.tree.setParams(this.ref,e)||this.state.tree.setTags(this.ref,t))&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.push({kind:"update",ref:this.ref,params:e}))}update(e,t){let n
if(t){const e=this.state.tree.transforms.get(this.ref)
n=(0,g.j)(e.params,t)}else n="function"==typeof e?(0,g.j)(this.state.tree.transforms.get(this.ref).params,e):e
return this.state.tree.setParams(this.ref,n)&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.push({kind:"update",ref:this.ref,params:n})),this.root}updateState(e){const t=this.state.tree.transforms.get(this.ref)
u.C.isStateChange(t.state,e)&&(this.state.tree.assignState(this.ref,e),this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.find(e=>"update"===e.kind&&e.ref===this.ref)||this.state.actions.push({kind:"update",ref:this.ref,params:t.params}))}tag(e){const t=this.state.tree.transforms.get(this.ref)
return this.updateTagged(t.params,y(t.tags,e)),this}dependsOn(e){const t=this.state.tree.transforms.get(this.ref)
this.state.tree.setDependsOn(this.ref,y(t.dependsOn,e))&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.push({kind:"update",ref:this.ref,params:t.params}))}to(e){return this.root.to(e)}toRoot(){return this.root.toRoot()}delete(e){return this.root.delete(e)}getTree(e){return n(this.state,e)}commit(e){if(!this.state.state)throw new Error("Cannot commit template tree")
return this.state.state.runTask(this.state.state.updateTree(this,e))}constructor(e,t,n){if(this.state=e,this.root=n,this.ref=t,!this.state.tree.transforms.has(t))throw new Error(`Could not find node '${t}'.`)}}e.To=r}(l||(l={}))
var v=n(63356)
class b{constructor(){this.ev=f.V.create(),this.actions=new Map,this.fromTypeIndex=new Map,this.events={added:this.ev(),removed:this.ev()}}add(e){const t=d.x.is(e)?e.toAction():e
if(this.actions.has(t.id))return this
this.actions.set(t.id,t)
for(const n of t.definition.from)this.fromTypeIndex.has(n.type)?this.fromTypeIndex.get(n.type).push(t):this.fromTypeIndex.set(n.type,[t])
return this.events.added.next(void 0),this}remove(e){const t=d.x.is(e)?e.toAction().id:a.kk.is(e)?e:e.id,n=this.actions.get(t)
if(!n)return this
this.actions.delete(t)
for(const r of n.definition.from){const e=this.fromTypeIndex.get(r.type)
e&&((0,v.K3)(e,n),0===e.length&&this.fromTypeIndex.delete(r.type))}return this.events.removed.next(void 0),this}fromCell(e,t){const n=e.obj
if(!n)return[]
const r=this.fromTypeIndex.get(n.type)
if(!r)return[]
let i=!1
for(const a of r)if(a.definition.isApplicable){i=!0
break}if(!i)return r
const o=[]
for(const a of r)a.definition.isApplicable?a.definition.isApplicable(n,e.transform,t)&&o.push(a):o.push(a)
return o}dispose(){this.ev.dispose()}}var x=n(69082),S=n(70429),_=n(92384),C=n(48604),w=n(30372)
class T{constructor(){this.queue=[],this.signal=new w.B}get length(){return this.queue.length}enqueue(e){return this.queue.push(e),1===this.queue.length||this.waitFor(e)}handled(e){(0,v.mO)(this.queue,e),this.queue.length>0&&this.signal.next({v:this.queue[0],stillPresent:!0})}remove(e){const t=(0,v.mO)(this.queue,e)
return t&&this.signal.next({v:e,stillPresent:!1}),t}waitFor(e){return new Promise(t=>{const n=this.signal.subscribe(({v:r,stillPresent:i})=>{r===e&&(n.unsubscribe(),t(i))})})}}var A=n(78660),I=n(95538)
class P{get tree(){return this._tree}get transforms(){return this._tree.transforms}get current(){return this.behaviors.currentObject.value.ref}get root(){return this.cells.get(this._tree.root.ref)}build(){return new l.Root(this.tree,this)}registerRefResolver(e,t){this.refResolvers.push([e,t])}removeRefResolver(e){this.refResolvers=this.refResolvers.filter(t=>t[0]!==e)}addHistory(e,t){0!==this.historyCapacity&&(this.history.unshift([e,t||"Update"]),this.history.length>this.historyCapacity&&this.history.pop(),this.events.historyUpdated.next({state:this}))}clearHistory(){0!==this.history.length&&(this.history=[],this.events.historyUpdated.next({state:this}))}get latestUndoLabel(){return this.history.length>0?this.history[0][1]:void 0}get canUndo(){return this.history.length>0}undo(){return p.Task.create("Undo",async e=>{const t=this.history.shift()
if(t){this.events.historyUpdated.next({state:this}),this.undoingHistory=!0
try{await this.updateTree(t[0],{canUndo:!1}).runInContext(e)}finally{this.undoingHistory=!1}}})}getSnapshot(){return{tree:c.u.toJSON(this._tree)}}setSnapshot(e){const t=c.u.fromJSON(e.tree)
return this.updateTree(t)}setCurrent(e){this.behaviors.currentObject.next({state:this,ref:e})}updateCellState(e,t){const n=this.cells.get(e)
if(!n)return
const r="function"==typeof t?t(n.state):t
u.C.assignState(n.state,r)&&(n.transform=this._tree.assignState(n.transform.ref,r),this.events.cell.stateUpdated.next({state:this,ref:e,cell:n}))}dispose(){this.ev.dispose(),this.actions.dispose()}select(e){return h.Q.select(e,this)}selectQ(e){return"string"==typeof e?h.Q.select(e,this):h.Q.select(e(h.Q.Generators),this)}applyAction(e,t,n=u.C.RootRef){return p.Task.create("Apply Action",r=>{const i=this.cells.get(n)
if(!i)throw new Error(`'${n}' does not exist.`)
if("ok"!==i.status)throw new Error(`Action cannot be applied to a cell with status '${i.status}'`)
return q(e.definition.run({ref:n,cell:i,a:i.obj,params:t,state:this},this.globalContext),r)})}transaction(e,t){return p.Task.create("State Transaction",async n=>{const r=this.inTransaction,i=this._tree.asImmutable()
let o=!1
try{r||this.behaviors.isUpdating.next(!0),this.inTransaction=!0,this.inTransactionError=!1,await e(n),this.inTransactionError&&(o=!0,await this.updateTree(i).runInContext(n))}catch(e){if(o||(o=!0,await this.updateTree(i).runInContext(n),this.events.log.next(x.x.error("Error during state transaction, reverting"))),r)throw this.inTransactionError=!0,e
if(null==t?void 0:t.rethrowErrors)throw e
console.error(e)}finally{r||(this.inTransaction=!1,this.events.changed.next({state:this,inTransaction:!1}),this.behaviors.isUpdating.next(!1),o||((null==t?void 0:t.canUndo)?this.addHistory(i,"string"==typeof t.canUndo?t.canUndo:void 0):this.clearHistory()))}})}get inUpdate(){return this._inUpdate}updateTree(e,t){const n={tree:e,options:t}
return p.Task.create("Update Tree",async r=>{if(!await this.updateQueue.enqueue(n))return
this._inUpdate=!0
const i=(null==t?void 0:t.canUndo)?this._tree.asImmutable():void 0
let o=!1
this.inTransaction||this.behaviors.isUpdating.next(!0)
try{if(l.is(e)){if(e.editInfo.applied)throw new Error("This builder has already been applied. Create a new builder for further state updates")
e.editInfo.applied=!0}this.reverted=!1
const i=t&&(t.revertIfAborted||t.revertOnError)?await this._revertibleTreeUpdate(r,n,t):await this._updateTree(r,n)
if(o=this.reverted,i.ctx.hadError&&(this.inTransactionError=!0),!i.cell)return
return new s(i.cell.transform.ref,this)}finally{this._inUpdate=!1,this.updateQueue.handled(n),this.inTransaction||(this.behaviors.isUpdating.next(!1),(null==t?void 0:t.canUndo)?o||this.addHistory(i,"string"==typeof t.canUndo?t.canUndo:void 0):this.undoingHistory||this.clearHistory())}},()=>{this.updateQueue.remove(n)})}async _revertibleTreeUpdate(e,t,n){const r=this.tree,i=await this._updateTree(e,t)
return(i.ctx.hadError||i.ctx.wasAborted)&&n.revertOnError||i.ctx.wasAborted&&n.revertIfAborted?(this.reverted=!0,await this._updateTree(e,{tree:r,options:t.options})):i}async _updateTree(e,t){let n=!1
const i=this.updateTreeAndCreateCtx(t.tree,e,t.options)
try{return n=await async function(e){let t,n,i=[]
if(e.editInfo&&1===e.editInfo.count&&e.editInfo.lastUpdate&&e.editInfo.sourceTree===e.oldTree)t=[],n=[e.editInfo.lastUpdate]
else{t=function(e){const t={newTree:e.tree,cells:e.cells,deletes:[]}
return c.u.doPostOrder(e.oldTree,e.oldTree.root,t,k),t.deletes}(e)
const r=e.parent.current
let o=!1
for(const e of t)if(e===r){o=!0
break}if(o){const n=F(e.oldTree,r,t,e.cells)
e.parent.setCurrent(n)}for(let n=t.length-1;n>=0;n--){const r=e.cells.get(t[n])
r&&G(r.transform,r.obj,null==r?void 0:r.transform.params,r.cache,e.parent.globalContext)}for(const n of t){const t=e.cells.get(n)
t&&(t.parent=void 0,O(t))
const r=t&&t.obj
e.cells.delete(n),i.push(r)}n=function(e,t){const n={roots:[],cells:e}
return c.u.doPreOrder(t,t.root,n,E),n.roots}(e.cells,e.tree)}const o=function(e,t){const n={ctx:e,visited:new Set,added:[]}
for(const i of t)c.u.doPreOrder(e.tree,e.tree.transforms.get(i),n,L)
for(const i of n.added)N(i,e)
let r
return n.visited.forEach(t=>{const i=e.cells.get(t)
for(const e of i.dependencies.dependentBy)n.visited.has(e.transform.ref)||(r||(r=A.t.create()),A.t.add(r,e.transform.ref,e))}),{added:n.added,dependent:r?r.array:void 0}}(e,n)
for(const r of o.added)e.parent.events.cell.created.next({state:e.parent,ref:r.transform.ref,cell:r})
for(let r=0;r<t.length;r++){const n=t[r],o=e.oldTree.transforms.get(n).parent
e.parent.events.object.removed.next({state:e.parent,ref:n,obj:i[r]}),e.parent.events.cell.removed.next({state:e.parent,ref:n,parent:o})}if(i.length&&(i=[]),o.dependent)for(const r of o.dependent)n.push(r.transform.ref)
!function(e,t){for(const n of t)c.u.doPreOrder(e.tree,e.tree.transforms.get(n),e,R)}(e,n)
for(const r of n)await U(e,r)
e.editInfo||function(e){c.u.doPreOrder(e.tree,e.tree.root,e,D)}(e)
let a=e.newCurrent
for(const s of e.results)"created"===s.action?(e.parent.events.object.created.next({state:e.parent,ref:s.ref,obj:s.obj}),e.newCurrent||e.tree.transforms.get(s.ref).state.isGhost||s.obj===r.Null||(a=s.ref)):"updated"===s.action?e.parent.events.object.updated.next({state:e.parent,ref:s.ref,action:"in-place",obj:s.obj,oldData:s.oldData}):"replaced"===s.action&&e.parent.events.object.updated.next({state:e.parent,ref:s.ref,action:"recreate",obj:s.obj,oldObj:s.oldObj})
if(a)e.options.doNotUpdateCurrent||e.parent.setCurrent(a)
else{const t=e.parent.current,n=e.cells.get(t)
n&&(n.obj===r.Null||"error"===n.status&&n.errorText===V)&&(a=F(e.oldTree,t,[],e.cells),e.parent.setCurrent(a))}return t.length>0||n.length>0||e.changed}(i),l.isTo(t.tree)?{ctx:i,cell:this.select(t.tree.ref)[0]}:{ctx:i}}finally{this.spine.current=void 0,n&&this.events.changed.next({state:this,inTransaction:this.inTransaction})}}updateTreeAndCreateCtx(e,t,n){const r=(l.is(e)?e.getTree():e).asTransient(),i=this._tree
this._tree=r
const o={parent:this,editInfo:l.is(e)?e.editInfo:void 0,errorFree:this.errorFree,taskCtx:t,oldTree:i,tree:r,cells:this.cells,spine:this.spine,results:[],options:{...B,...n},changed:!1,hadError:!1,wasAborted:!1,newCurrent:void 0,getCellData:this.tryGetCellData}
return this.errorFree=!0,o}constructor(e,t){this.errorFree=!0,this.ev=f.V.create(),this.globalContext=void 0,this.events={cell:{stateUpdated:this.ev(),created:this.ev(),removed:this.ev()},object:{updated:this.ev(),created:this.ev(),removed:this.ev()},log:this.ev(),changed:this.ev(),historyUpdated:this.ev()},this.behaviors={currentObject:this.ev.behavior({state:this,ref:u.C.RootRef}),isUpdating:this.ev.behavior(!1)},this.actions=new b,this.cells=new Map,this.spine=new C.P.Impl(this.cells),this.refResolvers=[],this.tryGetCellData=e=>{var t,n
let r=null===(n=null===(t=this.cells.get(e))||void 0===t?void 0:t.obj)||void 0===n?void 0:n.data
if(void 0===r){for(const[,t]of this.refResolvers)if(r=t(this,e),void 0!==r)break
if(void 0===r)throw new Error(`Cell '${e}' data undefined.`)}return r},this.historyCapacity=5,this.history=[],this.undoingHistory=!1,this.inTransaction=!1,this.inTransactionError=!1,this._inUpdate=!1,this.reverted=!1,this.updateQueue=new T,this._tree=c.u.createEmpty(u.C.createRoot(t&&t.rootState)).asTransient()
const n=this._tree.root
this.runTask=t.runTask,void 0!==(null==t?void 0:t.historyCapacity)&&(this.historyCapacity=t.historyCapacity),this.cells.set(n.ref,{parent:this,transform:n,sourceRef:void 0,obj:e,status:"ok",state:{...n.state},errorText:void 0,params:{definition:{},values:{}},dependencies:{dependentBy:[],dependsOn:[]},cache:{}}),this.globalContext=t&&t.globalContext}}!function(e){let t
e.create=function(t,n){return new e(t,n)},function(e){e.isCell=function(e,t){return!!t&&e.ref===t.transform.ref&&e.state===t.parent}}(t=e.ObjectEvent||(e.ObjectEvent={}))}(P||(P={}))
const B={doNotLogTiming:!1,doNotUpdateCurrent:!0,revertIfAborted:!1,revertOnError:!1,canUndo:!1}
function E(e,t,n){const i=n.cells.get(e.ref)
return i&&i.transform.version===e.version?"error"!==i.status&&(!i||i.obj!==r.Null):(n.roots.push(e.ref),!1)}function k(e,t,n){!n.newTree.transforms.has(e.ref)&&n.cells.has(e.ref)&&n.deletes.push(e.ref)}function D(e,t,n){const r=n.cells.get(e.ref)
r&&u.C.syncState(r.state,e.state)&&n.parent.events.cell.stateUpdated.next({state:n.parent,ref:e.ref,cell:r})}function M(e,t,n,r){const i=e.cells.get(t),o=i.status!==n
i.status=n,i.errorText=r,o&&e.parent.events.cell.stateUpdated.next({state:e.parent,ref:t,cell:i})}function R(e,t,n){n.cells.get(e.ref).transform=e,M(n,e.ref,"pending")}function O(e){for(const t of e.dependencies.dependsOn)(0,v.K3)(t.dependencies.dependentBy,e)}function L(e,t,{ctx:n,added:r,visited:i}){if(i.add(e.ref),n.cells.has(e.ref))return
const o={parent:n.parent,transform:e,sourceRef:void 0,status:"pending",state:{...e.state},errorText:void 0,params:void 0,dependencies:{dependentBy:[],dependsOn:[]},cache:void 0}
n.cells.set(e.ref,o),r.push(o)}function N(e,t){if(e.transform.dependsOn)for(const n of e.transform.dependsOn){if(!t.tree.transforms.get(n))throw new Error("Cannot depend on a non-existent transform.")
const r=t.cells.get(n);(0,v.Z2)(e.dependencies.dependsOn,r),(0,v.Z2)(r.dependencies.dependentBy,e)}}function F(e,t,n,r){return z(e,t,new Set(n),r)}function z(e,t,n,i){if(t===u.C.RootRef)return t
const o=e.transforms.get(t),a=e.children.get(o.parent).values()
let s,l=!1
for(;;){const o=a.next()
if(o.done)break
if(n.has(o.value))continue
const c=i.get(o.value)
if(!c||"error"===c.status||c.obj===r.Null)continue
const u=e.transforms.get(o.value)
if(!u.state.isGhost)if(o.value!==t){if(l)return u.ref
s=u.ref}else l=!0,n.has(t)||(s=t)}return s||z(e,o.parent,n,i)}function j(e,t,n,r){r||(e.hadError=!0,e.parent.errorFree=!1)
const i=e.cells.get(t)
if(n){e.wasAborted=e.wasAborted||p.Task.isAbort(n)
const i=""+n
M(e,t,"error",i),r||e.parent.events.log.next({type:"error",timestamp:new Date,message:i})}else i.params=void 0
if(i.obj){const n=i.obj
i.obj=void 0,i.cache=void 0,e.parent.events.object.removed.next({state:e.parent,ref:t,obj:n})}const o=e.tree.children.get(t).values()
for(;;){const t=o.next()
if(t.done)return
j(e,t.value,void 0,r)}}const V="Parent is null"
async function U(e,t){M(e,t,"processing")
let n=!1
try{const i=(0,S.t)(),o=await async function(e,t){var n
const{oldTree:i,tree:o}=e,a=e.cells.get(t),s=a.transform
if(a.transform.ref===u.C.RootRef)return{action:"none"}
const l=e.cells.get(a.transform.parent)
if((null==l?void 0:l.obj)===r.Null){if(a.sourceRef=l.transform.ref,i.transforms.has(t)&&a.params){const n=a.params.values,i=a.cache
return G(s,a.obj,n,i,e.parent.globalContext),a.params=void 0,a.obj=r.Null,{ref:t,action:"updated",obj:a.obj}}return a.params=void 0,{ref:t,action:"created",obj:r.Null}}const c=0===s.transformer.definition.from.length?l:h.Q.findAncestorOfType(o,e.cells,t,s.transformer.definition.from)
if(!c)throw new Error(`No suitable parent found for '${t}'`)
e.spine.current=a
const p=c.obj
a.sourceRef=c.transform.ref
const f=function(e,t,n){const r=t.transformer.definition.params,i=r?r(n,e.parent.globalContext):{}
if(t.version!==t._normalized_param_version)t.params=_.t.normalizeParams(i,t.params,"all"),t._normalized_param_version=t.version
else{const e=_.t.getDefaultValues(i)
t.params=t.params?(0,I.JW)(t.params,e):e}return _.t.resolveRefs(i,t.params,e.getCellData),{definition:i,values:t.params}}(e,s,p)
if(!i.transforms.has(t)||!a.params){a.params=f
const n=await $(e,a,s.transformer,p,f.values)
return H(n,s),a.obj=n,{ref:t,action:"created",obj:n}}{const i=a.params.values,o=a.cache,l=null===(n=a.obj)||void 0===n?void 0:n.data,c=f.values
a.params=f
const u=a.obj&&a.obj!==r.Null?await async function(e,t,n,r,i,o,a){return n.definition.update?(t.cache||(t.cache=Object.create(null)),q(n.definition.update({a:r,oldParams:o,b:i,newParams:a,cache:t.cache,spine:e.spine,dependencies:Q(t)},e.parent.globalContext),e.taskCtx)):d.x.UpdateResult.Recreate}(e,a,s.transformer,p,a.obj,i,c):d.x.UpdateResult.Recreate
switch(u){case d.x.UpdateResult.Recreate:{const n=a.obj
G(s,n,i,o,e.parent.globalContext)
const r=await $(e,a,s.transformer,p,c)
return H(r,s),a.obj=r,{ref:t,action:"replaced",oldObj:n,obj:r}}case d.x.UpdateResult.Updated:return H(a.obj,s),{ref:t,action:"updated",oldData:l,obj:a.obj}
case d.x.UpdateResult.Null:return G(s,a.obj,i,o,e.parent.globalContext),a.obj=r.Null,{ref:t,action:"updated",obj:a.obj}
default:return{action:"none"}}}}(e,t),a=(0,S.t)()-i
"none"!==o.action&&(e.changed=!0),M(e,t,"ok"),e.results.push(o),"created"===o.action?(n=o.obj===r.Null,n||e.options.doNotLogTiming||e.parent.events.log.next(x.x.info(`Created ${o.obj.label} in ${(0,S.H)(a)}.`))):("updated"===o.action||"replaced"===o.action)&&(n=o.obj===r.Null,n||e.options.doNotLogTiming||e.parent.events.log.next(x.x.info(`Updated ${o.obj.label} in ${(0,S.H)(a)}.`)))}catch(n){return e.changed=!0,e.hadError||(e.newCurrent=t),j(e,t,n,!1),void console.error(n)}const i=e.tree.children.get(t).values()
for(;;){const t=i.next()
if(t.done)return
n?j(e,t.value,void 0,!0):await U(e,t.value)}}function G(e,t,n,i,o){var a,s
null===(s=(a=e.transformer.definition).dispose)||void 0===s||s.call(a,{b:t!==r.Null?t:void 0,params:n,cache:i},o)}function H(e,t){e&&e!==r.Null&&(e.tags=t.tags)}function q(e,t){return"function"==typeof e.runInContext?e.runInContext(t):e}function Q(e){if(0===e.dependencies.dependsOn.length)return
const t=Object.create(null)
for(const n of e.dependencies.dependsOn){if(!n.obj)throw new Error("Unresolved dependency.")
t[n.transform.ref]=n.obj}return t}function $(e,t,n,r,i){return t.cache||(t.cache=Object.create(null)),q(n.definition.apply({a:r,params:i,cache:t.cache,spine:e.spine,dependencies:Q(t)},e.parent.globalContext),e.taskCtx)}var X=n(34874)},43702(e,t,n){"use strict"
function r([e]){return Math.atan(e)}n.r(t),n.d(t,{atan:()=>r,default:()=>i})
var i=(0,n(10336).helper)(r)},43766(e,t,n){"use strict"
n.d(t,{Z:()=>b})
var r,i=n(23729),o=n(39250),a=n(37411)
!function(e){e.create=function(){return{view:o.$.identity(),position:a.e.create(0,0,0),direction:a.e.create(0,0,-1),up:a.e.create(0,1,0)}}}(r||(r={}))
var s=n(63317),l=n(77323)
class c{constructor(){this.removeList=(0,l.w)(),this.removeMap=new Map,this.addList=(0,l.w)(),this.addMap=new Map}get isEmpty(){return 0===this.removeList.count&&0===this.addList.count}get size(){return this.removeMap.size+this.addMap.size}add(e){if(this.removeMap.has(e)){const t=this.removeMap.get(e)
this.removeMap.delete(e),this.removeList.remove(t)}if(this.addMap.has(e))return
const t=this.addList.addLast(e)
this.addMap.set(e,t)}remove(e){if(this.addMap.has(e)){const t=this.addMap.get(e)
this.addMap.delete(e),this.addList.remove(t)}if(this.removeMap.has(e))return
const t=this.removeList.addLast(e)
this.removeMap.set(e,t)}tryGetRemove(){const e=this.removeList.removeFirst()
return e&&this.removeMap.delete(e),e}tryGetAdd(){const e=this.addList.removeFirst()
return e&&this.addMap.delete(e),e}}var u=n(70429),d=n(63356),p=n(10314),h=n(70012),f=n(97564),m=n(80813)
const g=new p.Z("98")
function y(e,t,n){g.reset()
for(let r=0,i=e.length;r<i;++r){if(n&&!e[r].state.visible)continue
if(!e[r].values.drawCount.ref.value)continue
const t=e[r].values.boundingSphere.ref.value
t.radius&&g.includeSphere(t)}g.finishedIncludeStep()
for(let r=0,i=e.length;r<i;++r){if(n&&!e[r].state.visible)continue
if(!e[r].values.drawCount.ref.value)continue
const t=e[r].values.boundingSphere.ref.value
t.radius&&g.radiusSphere(t)}return g.getSphere(t)}function v(e,t){const n=e.getProgram("color").id,r=t.getProgram("color").id,i=e.materialId,o=t.materialId
return n!==r?n-r:i!==o?i-o:e.id-t.id}var b
!function(e){e.create=function(e,t="blended",n={dColorMarker:!0,dLightCount:1}){const o=new Map,a=[],l=(0,s.f)(),p=(0,s.f)(),g=[],b=[]
let x=!0,S=!0,_=!0,C=!0,w=!0,T=!0,A=!0,I=0,P=0,B=0,E=0,k=!1
const D=r.create(),{view:M,position:R,direction:O,up:L}=D
function N(r){if(o.has(r))console.warn(`RenderObject with id '${r.id}' already present`)
else{const s=(0,i.R2)(e,r,t,n)
a.push(s),"direct-volume"===r.type?b.push(s):g.push(s),o.set(r,s),x=!0,S=!0}}function F(e){const t=o.get(e)
t&&(t.dispose(),(0,d.K3)(a,t),(0,d.K3)(g,t),(0,d.K3)(b,t),o.delete(e),x=!0,S=!0)}const z=new c
let j=-1
function V(){const e=function(){let e=23
for(let t=0,n=a.length;t<n;++t)a[t].state.visible&&(e=31*e+a[t].id|0)
return e=(0,h.C_)(e),-1===e&&(e=0),e}()
return e!==j&&(S=!0,_=!0,C=!0,w=!0,T=!0,A=!0,j=e,!0)}return{view:M,position:R,direction:O,up:L,renderables:a,primitives:{view:M,position:R,direction:O,up:L,renderables:g},volumes:{view:M,position:R,direction:O,up:L,renderables:b},syncVisibility:V,setTransparency:e=>{t=e
for(let t=0,n=a.length;t<n;++t)a[t].setTransparency(e)},setGlobals:e=>{n=e
for(const t of a)m.IQ.updateIfChanged(t.values.dColorMarker,e.dColorMarker),m.IQ.updateIfChanged(t.values.dLightCount,e.dLightCount),t.update()},update(e,t){var n
if(e)for(let r=0,i=e.length;r<i;++r)null===(n=o.get(e[r]))||void 0===n||n.update()
else for(let r=0,i=a.length;r<i;++r)a[r].update()
t?V():(x=!0,S=!0),_=!0,C=!0,w=!0,T=!0,A=!0},add:e=>z.add(e),remove:e=>z.remove(e),commit:(e=Number.MAX_VALUE)=>function(e){const t=(0,u.t)()
let n=0
for(;;){const r=z.tryGetRemove()
if(!r)break
if(F(r),++n%100==0&&(0,u.t)()-t>e)return!1}for(;;){const r=z.tryGetAdd()
if(!r)break
if(N(r),++n%100==0&&(0,u.t)()-t>e)return!1}return a.sort(v),_=!0,C=!0,w=!0,T=!0,A=!0,!0}(e),get commitQueueSize(){return z.size},get needsCommit(){return!z.isEmpty},has:e=>o.has(e),clear:()=>{for(let e=0,t=a.length;e<t;++e)a[e].dispose()
a.length=0,g.length=0,b.length=0,o.clear(),x=!0,S=!0},forEach:e=>{o.forEach(e)},get count(){return a.length},get boundingSphere(){return x&&(y(a,l,!1),x=!1),l},get boundingSphereVisible(){return S&&(y(a,p,!0),S=!1),p},get transparency(){return t},get markerAverage(){return _&&(I=function(){if(0===g.length)return 0
let e=0,t=0
for(let n=0,r=g.length;n<r;++n)g[n].state.visible&&(t+=g[n].values.markerAverage.ref.value,e+=1)
return e>0?t/e:0}(),_=!1),I},get emissiveAverage(){return C&&(P=function(){if(0===g.length)return 0
let e=0,t=0
for(let n=0,r=g.length;n<r;++n)g[n].state.visible&&(t+=g[n].values.emissiveAverage.ref.value+g[n].values.uEmissive.ref.value,e+=1)
return e>0?t/e:0}(),C=!1),P},get opacityAverage(){return w&&(B=function(){var e,t,n
if(0===g.length)return 0
let r=0,i=0
for(let o=0,a=g.length;o<a;++o){const a=g[o]
if(!a.state.visible)continue
const s=(0,f.qE)(a.values.alpha.ref.value*a.state.alphaFactor,0,1),l="on"===(null===(e=a.values.dXrayShaded)||void 0===e?void 0:e.ref.value)||"inverted"===(null===(t=a.values.dXrayShaded)||void 0===t?void 0:t.ref.value)?.5:1,c="fuzzy"===(null===(n=a.values.dPointStyle)||void 0===n?void 0:n.ref.value)?.5:1,u="text"===a.values.dGeometryType.ref.value?.5:1,d="image"===a.values.dGeometryType.ref.value?.5:1
i+=(1-a.values.transparencyAverage.ref.value)*s*l*c*u*d,r+=1}return r>0?i/r:0}(),w=!1),B},get transparencyMin(){return T&&(E=function(){var e,t,n
if(0===g.length)return 1
let r=1
const i=[]
for(let o=0,a=g.length;o<a;++o){const a=g[o]
if(!a.state.visible)continue
i.length=0
const s=(0,f.qE)(a.values.alpha.ref.value*a.state.alphaFactor,0,1)
s<1&&i.push(1-s),"on"!==(null===(e=a.values.dXrayShaded)||void 0===e?void 0:e.ref.value)&&"inverted"!==(null===(t=a.values.dXrayShaded)||void 0===t?void 0:t.ref.value)&&"fuzzy"!==(null===(n=a.values.dPointStyle)||void 0===n?void 0:n.ref.value)&&"text"!==a.values.dGeometryType.ref.value&&"image"!==a.values.dGeometryType.ref.value||i.push(.5),a.values.transparencyMin.ref.value>0&&i.push(a.values.transparencyMin.ref.value),r=Math.min(r,...i)}return r}(),T=!1),E},get hasOpaque(){return A&&(k=function(){var e
if(0===g.length)return!1
for(let t=0,n=g.length;t<n;++t){const n=g[t]
if(n.state.visible){if(n.state.opaque)return!0
if(1===n.state.alphaFactor&&1===n.values.alpha.ref.value&&1!==n.values.transparencyAverage.ref.value)return!0
if("opaque"===(null===(e=n.values.dTransparentBackfaces)||void 0===e?void 0:e.ref.value))return!0}}return!1}(),A=!1),k}}}}(b||(b={}))},43901(e,t,n){"use strict"
n.d(t,{C:()=>o,d:()=>a})
var r=n(70429)
class i{add(e,t){let n=this.avgs.get(e)||t
return n=function(e,t,n){return(e-=e/n)+t/n}(n,t,this.count),this.avgs.set(e,n),n}get(e){return this.avgs.get(e)}stats(){return Object.fromEntries(this.avgs.entries())}clear(){this.avgs.clear()}constructor(e){this.count=e,this.avgs=new Map}}function o(e,t,n,o){var a
const s=t.disjointTimerQuery,l=null!==(a=null==o?void 0:o.avgCount)&&void 0!==a?a:30,c=new Map,u=new Map,d=[],p=new i(l),h=new i(l)
let f=[],m=null,g=!1
const y=()=>{u.clear(),d.length=0,p.clear(),h.clear(),f=[],m=null,g=!1,s&&c.forEach((e,t)=>{s.deleteQuery(t)}),c.clear()},v=()=>{if(!s)return
const e=function(e){return e.disjointTimerQuery?e.disjointTimerQuery.createQuery():null}(t)
e&&(s.beginQuery(s.TIME_ELAPSED,e),u.forEach((t,n)=>{t.queries.push(e)}),c.set(e,{refCount:u.size}),m=e)}
return{resolve:()=>{const t=[]
if(!s||!f.length||g)return t
c.forEach((t,n)=>{if(void 0!==t.timeElapsed)return
const r=s.getQueryParameter(n,s.QUERY_RESULT_AVAILABLE),i=e.getParameter(s.GPU_DISJOINT)
if(r&&!i){const e=s.getQueryParameter(n,s.QUERY_RESULT)
t.timeElapsed=e}(r||i)&&s.deleteQuery(n)})
const n=[]
for(const e of f)if(e.queries.every(e=>{var t
return void 0!==(null===(t=c.get(e))||void 0===t?void 0:t.timeElapsed)})){let n=0
for(const t of e.queries){const e=c.get(t)
n+=e.timeElapsed,e.refCount-=1}if(e.timeElapsed=n,e.root){const r=[],i=(e,t)=>{for(const n of e){const e=n.timeElapsed,r=n.cpu.end-n.cpu.start,o={label:n.label,gpuElapsed:e,gpuAvg:p.add(n.label,e),cpuElapsed:r,cpuAvg:h.add(n.label,r),children:[],calls:n.calls,note:n.note}
t.push(o),i(n.children,o.children)}}
i(e.children,r)
const o=e.cpu.end-e.cpu.start
t.push({label:e.label,gpuElapsed:n,gpuAvg:p.add(e.label,n),cpuElapsed:o,cpuAvg:h.add(e.label,o),children:r,calls:e.calls,note:e.note})}}else n.push(e)
return f=n,c.forEach((e,t)=>{0===e.refCount&&c.delete(t)}),t},mark:(e,t)=>{var i
if(!s)return
if(u.has(e))throw new Error(`Timer mark for '${e}' already exists`)
const o=null!==(i=null==t?void 0:t.captureStats)&&void 0!==i&&i
null!==m&&s.endQuery(s.TIME_ELAPSED)
const a={label:e,queries:[],children:[],root:null===m,cpu:{start:(0,r.t)(),end:-1},captureStats:o}
if((null==t?void 0:t.note)&&(a.note=t.note),u.set(e,a),d.length&&d[d.length-1].children.push(a),d.push(a),o){if(g)throw new Error("Already capturing stats")
!function(e){e.calls.drawInstanced=0,e.calls.drawInstancedBase=0,e.calls.multiDrawInstancedBase=0,e.calls.counts=0,e.culled.lod=0,e.culled.frustum=0,e.culled.occlusion=0}(n),g=!0}v()},markEnd:e=>{var t
if(!s)return
const i=u.get(e)
if(!i)throw new Error(`Timer mark for '${e}' does not exist`)
if((null===(t=d.pop())||void 0===t?void 0:t.label)!==e)throw new Error(`Timer mark for '${e}' has pending nested mark`)
s.endQuery(s.TIME_ELAPSED),u.delete(e),i.cpu.end=(0,r.t)(),i.captureStats&&(i.calls={...n.calls},g=!1),f.push(i),u.size>0?v():m=null},stats:()=>({gpu:p.stats(),cpu:h.stats()}),formatedStats:()=>{const e={},t=p.stats(),n=h.stats()
for(const r of Object.keys(t)){const i=`${(t[r]/1e3/1e3).toFixed(2)}`,o=`${n[r].toFixed(2)}`
e[r]=`${i} ms | CPU: ${o} ms`}return e},clear:y,destroy:()=>{y()}}}function a(e){e.map(e=>{const t=function(e){const t=`${(e.gpuElapsed/1e3/1e3).toFixed(2)}`,n=`${(e.gpuAvg/1e3/1e3).toFixed(2)}`,r=`${e.cpuElapsed.toFixed(2)}`,i=`${e.cpuAvg.toFixed(2)}`
return`${e.label} ${t} ms (avg. ${n} ms) | CPU: ${r} ms (avg. ${i} ms)`}(e)
e.children.length||e.calls||e.note?(console.groupCollapsed(t),e.calls&&console.log(e.calls),e.note&&console.log(e.note),a(e.children),console.groupEnd()):console.log(t)})}},44067(e,t,n){"use strict"
function r(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}n.d(t,{L:()=>r})},44195(e,t,n){"use strict"
n.d(t,{RT:()=>be,cY:()=>f,Oz:()=>l,cv:()=>c.c})
var r={}
n.r(r),n.d(r,{all:()=>C,atoms:()=>P,bondedAtomicPairs:()=>D,chains:()=>T,none:()=>_,querySelection:()=>k,residues:()=>w,rings:()=>E})
var i={}
n.r(i),n.d(i,{exceptBy:()=>W,expandProperty:()=>Z,includeConnected:()=>K,includeSurroundings:()=>Q,intersectBy:()=>X,querySelection:()=>$,surroundingLigands:()=>ee,union:()=>Y,wholeResidues:()=>V})
var o={}
n.r(o),n.d(o,{areIntersectedBy:()=>de,first:()=>le,getCurrentStructureProperties:()=>ce,isConnectedTo:()=>he,pick:()=>se,withSameAtomProperties:()=>ue,within:()=>pe})
var a={}
n.r(a),n.d(a,{intersect:()=>me,merge:()=>fe})
var s={}
n.r(s),n.d(s,{atomCount:()=>ge,countQuery:()=>ye,propertySet:()=>ve})
var l,c=n(16913),u=n(44688),d=n(70429),p=n(87095),h=n(34431)
class f{pushCurrentElement(){return this.currentElementStack[this.currentElementStack.length]=this.element,this.element=u.iZ.Location.create(void 0),this.element}popCurrentElement(){this.element=this.currentElementStack.pop()}pushCurrentBond(){return this.atomicBond&&this.currentAtomicBondStack.push(this.atomicBond),this.atomicBond=new m,this.atomicBond}popCurrentBond(){this.currentAtomicBondStack.length>0?this.atomicBond=this.currentAtomicBondStack.pop():this.atomicBond=void 0}pushCurrentStructure(){this.currentStructure&&this.currentStructureStack.push(this.currentStructure)}popCurrentStructure(){this.currentStructureStack.length?this.currentStructure=this.currentStructureStack.pop():this.currentStructure=void 0}pushInputStructure(e){this.inputStructureStack.push(this.inputStructure),this.inputStructure=e}popInputStructure(){if(0===this.inputStructureStack.length)throw new Error("Must push before pop.")
this.inputStructure=this.inputStructureStack.pop()}throwIfTimedOut(){if(0!==this.timeoutMs&&(0,d.t)()-this.timeCreated>this.timeoutMs)throw new Error(`The query took too long to execute (> ${this.timeoutMs/1e3}s).`)}tryGetCurrentSelection(){if(!this.currentSelection)throw new Error("The current selection is not assigned.")
return this.currentSelection}constructor(e,t){this.currentElementStack=[],this.currentAtomicBondStack=[],this.currentStructureStack=[],this.inputStructureStack=[],this.timeCreated=(0,d.t)(),this.element=u.iZ.Location.create(void 0),this.currentStructure=void 0,this.atomicBond=new m,this.currentSelection=void 0,this.inputStructure=e,this.timeoutMs=t&&t.timeoutMs||0,this.currentSelection=t&&t.currentSelection}}class m{constructor(){this.a=u.iZ.Location.create(void 0),this.aIndex=0,this.b=u.iZ.Location.create(void 0),this.bIndex=0,this.type=p.BondType.Flag.None,this.order=0,this.key=-1,this.testFn=h.defaultBondTest}setStructure(e){this.a.structure=e,this.b.structure=e}setTestFn(e){this.testFn=e||h.defaultBondTest}test(e,t){return!!this.testFn(e)||!!t&&(this.swap(),this.testFn(e))}swap(){const e=this.aIndex
this.aIndex=this.bIndex,this.bIndex=e
const t=this.a.unit
this.a.unit=this.b.unit,this.b.unit=t
const n=this.a.element
this.a.element=this.b.element,this.b.element=n}get length(){return u.iZ.Location.distance(this.a,this.b)}}!function(e){e.run=function(e,t,n){return e(new f(t,n))},e.loci=function(e,t,n){const r=e(new f(t,n))
return c.c.toLociWithSourceUnits(r)}}(l||(l={}))
var g=n(71695),y=n(67538),v=n(20356),b=n(41041)
class x{add(e){e.elementCount&&(1!==e.elementCount&&(this.allSingletons=!1),this.set.add(e)&&(this.structures[this.structures.length]=e))}getSelection(){return this.allSingletons?c.c.Singletons(this.source,(0,b.structureUnion)(this.source,this.structures)):c.c.Sequence(this.source,this.structures)}constructor(e){this.source=e,this.set=(0,g.bw)(u.oE.hashCode,u.oE.areUnitIdsAndIndicesEqual),this.structures=[],this.allSingletons=!0}}class S{add(e,t,n){let r=this.builderMap.get(e)
r||(r=this.source.subsetBuilder(!0),this.builders[this.builders.length]=r,this.builderMap.set(e,r)),r.addToUnit(t,n)}allSingletons(){for(let e=0,t=this.builders.length;e<t;e++)if(this.builders[e].elementCount>1)return!1
return!0}singletonSelection(){const e=this.source.subsetBuilder(!0),t=u.iZ.Location.create(this.source)
for(let n=0,r=this.builders.length;n<r;n++)this.builders[n].setSingletonLocation(t),e.addToUnit(t.unit.id,t.element)
return c.c.Singletons(this.source,e.getStructure())}fullSelection(){const e=new Array(this.builders.length)
for(let t=0,n=this.builders.length;t<n;t++)e[t]=this.builders[t].getStructure()
return c.c.Sequence(this.source,e)}getSelection(){return 0===this.builders.length?c.c.Empty(this.source):this.allSingletons()?this.singletonSelection():this.fullSelection()}constructor(e){this.source=e,this.builders=[],this.builderMap=new Map}}const _=e=>c.c.Sequence(e.inputStructure,[]),C=e=>c.c.Singletons(e.inputStructure,e.inputStructure)
function w(e){return P({...e,groupBy:e=>u.ZP.residue.key(e.element)})}function T(e){return P({...e,groupBy:e=>u.ZP.chain.key(e.element)})}function A(e){return!0}function I(e){return 0}function P(e){if(!e||!(e.atomTest||e.residueTest||e.chainTest||e.entityTest||e.unitTest||e.groupBy))return C
if(e.atomTest&&!e.residueTest&&!e.chainTest&&!e.entityTest&&!e.unitTest&&!e.groupBy)return t=e.atomTest,function(e){const{inputStructure:n}=e,{units:r}=n,i=e.pushCurrentElement(),o=n.subsetBuilder(!0)
i.structure=n
for(const a of r){i.unit=a
const n=a.elements
o.beginUnit(a.id)
for(let r=0,a=n.length;r<a;r++)i.element=n[r],t(e)&&o.addElement(i.element)
o.commitUnit(),e.throwIfTimedOut()}return e.popCurrentElement(),c.c.Singletons(n,o.getStructure())}
var t
const n={unitTest:e.unitTest||A,entityTest:e.entityTest||A,chainTest:e.chainTest||A,residueTest:e.residueTest||A,atomTest:e.atomTest||A,groupBy:e.groupBy||I}
return e.groupBy?function({unitTest:e,entityTest:t,chainTest:n,residueTest:r,atomTest:i,groupBy:o}){return function(a){const{inputStructure:s}=a,{units:l}=s,c=a.pushCurrentElement(),d=new S(s)
c.structure=s
for(const p of l){if(c.unit=p,!e(a))continue
const{elements:s,model:l}=p
if(p.kind===u.Nf.Kind.Atomic){const e=y.hT.transientSegments(l.atomicHierarchy.chainAtomSegments,s),u=y.hT.transientSegments(l.atomicHierarchy.residueAtomSegments,s)
for(;e.hasNext;){const l=e.move()
if(c.element=s[l.start],t(a)&&n(a))for(u.setSegment(l);u.hasNext;){const e=u.move()
if(c.element=s[e.start],r(a))for(let t=e.start,n=e.end;t<n;t++)c.element=s[t],i(a)&&d.add(o(a),p.id,c.element)}}}else{const{chainElementSegments:e}=p.kind===u.Nf.Kind.Spheres?l.coarseHierarchy.spheres:l.coarseHierarchy.gaussians,i=y.hT.transientSegments(e,s)
for(;i.hasNext;){const e=i.move()
if(c.element=s[e.start],t(a)&&n(a))for(let t=e.start,n=e.end;t<n;t++)c.element=s[t],r(a)&&d.add(o(a),p.id,c.element)}}a.throwIfTimedOut()}return a.popCurrentElement(),d.getSelection()}}(n):function({unitTest:e,entityTest:t,chainTest:n,residueTest:r,atomTest:i}){return function(o){const{inputStructure:a}=o,{units:s}=a,l=o.pushCurrentElement(),d=a.subsetBuilder(!0),p=r===A&&i===A,h=i===A
l.structure=a
for(const c of s){if(l.unit=c,!e(o))continue
const{elements:a,model:s}=c
if(d.beginUnit(c.id),c.kind===u.Nf.Kind.Atomic){const e=y.hT.transientSegments(c.model.atomicHierarchy.chainAtomSegments,a),s=y.hT.transientSegments(c.model.atomicHierarchy.residueAtomSegments,a)
for(;e.hasNext;){const c=e.move()
if(l.element=a[c.start],t(o)&&n(o))if(p)d.addElementRange(a,c.start,c.end)
else for(s.setSegment(c);s.hasNext;){const e=s.move()
if(l.element=a[e.start],r(o))if(h)d.addElementRange(a,e.start,e.end)
else for(let t=e.start,n=e.end;t<n;t++)l.element=a[t],i(o)&&d.addElement(l.element)}}}else{const{chainElementSegments:e}=c.kind===u.Nf.Kind.Spheres?s.coarseHierarchy.spheres:s.coarseHierarchy.gaussians,i=y.hT.transientSegments(e,a)
for(;i.hasNext;){const e=i.move()
if(l.element=a[e.start],t(o)&&n(o))if(p)d.addElementRange(a,e.start,e.end)
else for(let t=e.start,n=e.end;t<n;t++)l.element=a[t],r(o)&&d.addElement(l.element)}}d.commitUnit(),o.throwIfTimedOut()}return o.popCurrentElement(),c.c.Singletons(a,d.getStructure())}}(n)}function B(e,t,n){const r=new Int32Array(t.length)
for(let i=0,o=t.length;i<o;i++)r[i]=e.elements[t[i]]
return v.o.create([e.getChild(y.X9.ofSortedArray(r))],{parent:n})}function E(e,t){return function(n){const{units:r}=n.inputStructure,i=c.c.LinearBuilder(n.inputStructure)
if(e&&0!==e.length){const o=g.th.create()
for(let t=0;t<e.length;t++)g.th.add(o,e[t],e[t])
for(const e of r){if(!u.Nf.isAtomic(e))continue
const r=e.rings
for(const a of o.array)if(r.byFingerprint.has(a))for(const o of r.byFingerprint.get(a))t&&!r.aromaticRings.includes(o)||i.add(B(e,r.all[o],n.inputStructure))}}else for(const e of r)if(u.Nf.isAtomic(e))if(t)for(const t of e.rings.aromaticRings)i.add(B(e,e.rings.all[t],n.inputStructure))
else for(const t of e.rings.all)i.add(B(e,t,n.inputStructure))
return i.getSelection()}}function k(e,t,n=!1){return function(r){const i=e(r)
if(0===c.c.structureCount(i))return i
const o=n?(0,b.structureSubtract)(r.inputStructure,c.c.unionStructure(i)):c.c.unionStructure(i)
if(0===o.elementCount)return c.c.Empty(r.inputStructure)
r.throwIfTimedOut(),r.pushInputStructure(o)
const a=t(r)
return r.popInputStructure(),c.c.withInputStructure(a,r.inputStructure)}}function D(e){return function(t){const n=t.inputStructure,r=n.interUnitBonds,i=c.c.UniqueBuilder(t.inputStructure)
t.pushCurrentBond()
const o=t.atomicBond
o.setTestFn(e),o.setStructure(n)
for(const e of n.units){if(e.kind!==u.Nf.Kind.Atomic)continue
const{offset:r,b:a,edgeProps:{flags:s,order:l,key:c}}=e.bonds
o.a.unit=e,o.b.unit=e
for(let u=0,d=e.elements.length;u<d;u++){o.aIndex=u,o.a.element=e.elements[u]
for(let d=r[u],p=r[u+1];d<p;d++)if(o.bIndex=a[d],o.b.element=e.elements[a[d]],o.type=s[d],o.order=l[d],o.key=c[d],o.test(t,!1)){const t=n.subsetBuilder(!1)
t.beginUnit(e.id),t.addElement(o.a.element),t.addElement(o.b.element),t.commitUnit(),i.add(t.getStructure())}}}for(const e of r.edges)if(o.a.unit=n.unitMap.get(e.unitA),o.a.element=o.a.unit.elements[e.indexA],o.aIndex=e.indexA,o.b.unit=n.unitMap.get(e.unitB),o.b.element=o.b.unit.elements[e.indexB],o.bIndex=e.indexB,o.order=e.props.order,o.type=e.props.flag,o.key=e.props.key,o.test(t,!1)){const e=n.subsetBuilder(!1)
e.addToUnit(o.a.unit.id,o.a.element),e.addToUnit(o.b.unit.id,o.b.element),i.add(e.getStructure())}return t.popCurrentBond(),i.getSelection()}}var M=n(70012),R=n(8294)
class O{addToUnit(e,t){const n=this.unitMap.get(e)
if(n)g.th.add(n,t,t)&&this.elementCount++
else{const n=g.th.create()
g.th.add(n,t,t),this.unitMap.set(e,n),this.ids[this.ids.length]=e,this.elementCount++}}has(e,t){const n=this.unitMap.get(e)
return!!n&&g.th.has(n,t)}beginUnit(e){this.parentId=e,this.unitMap.has(e)?this.currentUnit=this.unitMap.get(e):this.currentUnit=this.currentUnit.array.length>0?g.th.create():this.currentUnit}addElement(e){g.th.add(this.currentUnit,e,e)&&this.elementCount++}commitUnit(){0===this.currentUnit.array.length||this.unitMap.has(this.parentId)||(this.ids[this.ids.length]=this.parentId,this.unitMap.set(this.parentId,this.currentUnit),this.parentId=-1)}getStructure(){if(this.isEmpty)return v.o.Empty
const e=[];(0,M.eh)(this.ids)
const t=R.u.UnitEquivalenceBuilder()
for(let n=0,r=this.ids.length;n<r;n++){const r=this.ids[n],i=this.parent.unitMap.get(r),o=this.unitMap.get(r).array,a=o.length
if(o.length===i.elements.length){e[e.length]=i,t.add(i.id,i)
continue}a>1&&(0,M.eh)(o)
let s=i.getChild(y.X9.ofSortedArray(o))
const l=t.add(s.id,s)
s!==l&&(s=l.applyOperator(s.id,s.conformation.operator,!0)),e[e.length]=s}return v.o.create(e,{parent:this.parent})}get isEmpty(){return 0===this.elementCount}constructor(e){this.parent=e,this.ids=[],this.unitMap=y.Yz.Mutable(),this.parentId=-1,this.currentUnit=g.th.create(),this.elementCount=0}}var L=n(66588),N=n(68329)
class F{add(e){let t=this.index.get(e.label_asym_id)
t||(t=new Map,this.index.set(e.label_asym_id,t))
let n=t.get(e.label_seq_id)
return n||(n=[],t.set(e.label_seq_id,n)),!this._find(e,n)&&(n.push(e),!0)}hasLabelAsymId(e){return this.index.has(e)}has(e){var t,n
const r=this._asym_id(e)
if(!this.index.has(r))return
const i=this.index.get(r),o=this._seq_id(e)
if(!i.has(o))return
const a=i.get(o),s=this._comp_id(e),l=this._alt_id(e),c=this._ins_code(e),u=null!==(t=this._op_name(e))&&void 0!==t?t:"1_555"
for(const d of a)if(d.label_comp_id===s&&d.label_alt_id===l&&d.ins_code===c&&(!this.checkOperator||(null!==(n=d.operator_name)&&void 0!==n?n:"1_555")===u))return d}static getLabel(e,t=!1){var n
return`${e.label_asym_id} ${e.label_comp_id} ${e.label_seq_id}:${e.ins_code}:${e.label_alt_id}${t?" "+(null!==(n=e.operator_name)&&void 0!==n?n:"1_555"):""}`}static getEntryFromLocation(e){var t
return{label_asym_id:N.Z.chain.label_asym_id(e),label_comp_id:N.Z.atom.label_comp_id(e),label_seq_id:N.Z.residue.label_seq_id(e),label_alt_id:N.Z.atom.label_alt_id(e),ins_code:N.Z.residue.pdbx_PDB_ins_code(e),operator_name:null!==(t=N.Z.unit.operator_name(e))&&void 0!==t?t:"1_555"}}_find(e,t){var n,r
for(const i of t)if(i.label_comp_id===e.label_comp_id&&i.label_alt_id===e.label_alt_id&&i.ins_code===e.ins_code&&(!this.checkOperator||(null!==(n=i.operator_name)&&void 0!==n?n:"1_555")===(null!==(r=e.operator_name)&&void 0!==r?r:"1_555")))return!0
return!1}constructor(e){var t
this.index=new Map,this.checkOperator=!1,this._asym_id=N.Z.chain.label_asym_id,this._seq_id=N.Z.residue.label_seq_id,this._comp_id=N.Z.atom.label_comp_id,this._alt_id=N.Z.atom.label_alt_id,this._ins_code=N.Z.residue.pdbx_PDB_ins_code,this._op_name=N.Z.unit.operator_name,this.checkOperator=null!==(t=null==e?void 0:e.checkOperator)&&void 0!==t&&t}}var z=n(63356)
function j(e,t,n){const r=t.subsetBuilder(!0)
for(const i of n.units){if(i.kind!==u.Nf.Kind.Atomic){r.setUnit(i.id,i.elements)
continue}const{residueAtomSegments:n}=i.model.atomicHierarchy,o=t.unitMap.get(i.id).elements,a=i.elements
r.beginUnit(i.id)
const s=y.hT.transientSegments(n,a)
for(;s.hasNext;){const e=s.move().index
for(let t=n.offsets[e],i=n.offsets[e+1];t<i;t++)y.X9.has(o,t)&&r.addElement(t)}r.commitUnit(),e.throwIfTimedOut()}return r.getStructure()}function V(e){return function(t){const n=e(t)
if(c.c.isSingleton(n))return c.c.Singletons(t.inputStructure,j(t,t.inputStructure,n.structure))
{const e=new x(t.inputStructure)
for(const r of n.structures)e.add(j(t,t.inputStructure,r))
return e.getSelection()}}}function U(e,t,n,r){const i=new O(t),o=t.lookup3d,a=r.radius
for(const s of n.units){const t=s.conformation,n=s.elements
for(let e=0,r=n.length;e<r;e++){const r=n[e]
o.findIntoBuilder(t.x(r),t.y(r),t.z(r),a,i)}e.throwIfTimedOut()}return r.wholeResidues?j(e,t,i.getStructure()):i.getStructure()}function G(e,t,n,r){const i=new O(t),o=t.lookup3d,{elementRadius:a,elementRadiusClosure:s,sourceMaxRadius:l,radius:c}=r
e.pushCurrentElement(),e.element.structure=n
for(const u of n.units){e.element.unit=u
const t=u.conformation,n=u.elements
for(let r=0,u=n.length;r<u;r++){const u=n[r]
e.element.element=u
const d=a(e)
o.findIntoBuilderWithRadius(t.x(u),t.y(u),t.z(u),d,l,c,s,i)}e.throwIfTimedOut()}return e.popCurrentElement(),r.wholeResidues?j(e,t,i.getStructure()):i.getStructure()}function H(e,t){return n=>(e.element.structure=n.structure,e.element.unit=n.unit,e.element.element=n.element,t(e))}function q(e,t){let n=0
e.element.structure=e.inputStructure
for(const r of e.inputStructure.units){e.element.unit=r
const i=r.elements
for(let r=0,o=i.length;r<o;r++){const o=i[r]
e.element.element=o
const a=t(e)
a>n&&(n=a)}}return e.throwIfTimedOut(),n}function Q(e,t){return function(n){const r=e(n)
if(t.elementRadius){const e={...t,elementRadius:t.elementRadius,elementRadiusClosure:H(n,t.elementRadius),sourceMaxRadius:q(n,t.elementRadius)}
if(c.c.isSingleton(r)){const t=G(n,n.inputStructure,r.structure,e)
return c.c.Singletons(n.inputStructure,t)}{const t=new x(n.inputStructure)
for(const i of r.structures)t.add(G(n,n.inputStructure,i,e))
return t.getSelection()}}if(c.c.isSingleton(r)){const e=U(n,n.inputStructure,r.structure,t)
return c.c.Singletons(n.inputStructure,e)}{const e=new x(n.inputStructure)
for(const i of r.structures)e.add(U(n,n.inputStructure,i,t))
return e.getSelection()}}}function $(e,t){return function(n){const r=e(n)
if(0===c.c.structureCount(r))return r
const i=c.c.UniqueBuilder(n.inputStructure),o=e=>i.add(e)
return c.c.forEach(r,(e,r)=>{n.pushInputStructure(e),c.c.forEach(t(n),o),n.popInputStructure(),r%10==0&&n.throwIfTimedOut()}),i.getSelection()}}function X(e,t){return function(n){const r=e(n)
if(0===c.c.structureCount(r))return r
const i=t(n)
if(0===c.c.structureCount(i))return c.c.Empty(n.inputStructure)
const o=c.c.unionStructure(i),a=c.c.UniqueBuilder(n.inputStructure)
return c.c.forEach(r,(e,t)=>{const r=(0,b.structureIntersect)(o,e)
0!==r.elementCount&&a.add(r),t%50==0&&n.throwIfTimedOut()}),a.getSelection()}}function W(e,t){return function(n){const r=e(n)
if(0===c.c.structureCount(r))return r
const i=t(n)
if(0===c.c.structureCount(i))return r
const o=c.c.unionStructure(i),a=c.c.UniqueBuilder(n.inputStructure)
return c.c.forEach(r,(e,t)=>{const r=(0,b.structureSubtract)(e,o)
0!==r.elementCount&&a.add(r),t%50==0&&n.throwIfTimedOut()}),a.getSelection()}}function Y(e){return function(t){const n=c.c.LinearBuilder(t.inputStructure)
return n.add(c.c.unionStructure(e(t))),n.getSelection()}}function Z(e,t){return function(n){const r=e(n),i=new Map,o=[]
n.pushCurrentElement(),c.c.forEach(r,(e,r)=>{n.element.structure=e
for(const o of e.units){n.element.unit=o
const e=o.elements
for(let o=0,a=e.length;o<a;o++){n.element.element=e[o]
const a=t(n)
let s
i.has(a)?s=i.get(a):(s=g.th.create(),i.set(a,s)),g.th.add(s,r,r)}}o[r]=n.inputStructure.subsetBuilder(!0),r%10==0&&n.throwIfTimedOut()}),n.element.structure=n.inputStructure
for(const e of n.inputStructure.units){n.element.unit=e
const r=e.elements
for(let a=0,s=r.length;a<s;a++){n.element.element=r[a]
const s=t(n)
if(!i.has(s))continue
const l=i.get(s).array
for(let t=0,n=l.length;t<n;t++)o[l[t]].addToUnit(e.id,r[a])}}n.popCurrentElement()
const a=c.c.UniqueBuilder(n.inputStructure)
for(const e of o)a.add(e.getStructure())
return a.getSelection()}}function K({query:e,layerCount:t,wholeResidues:n,bondTest:r,fixedPoint:i}){const o=Math.max(t,0)
return function(t){const a=c.c.UniqueBuilder(t.inputStructure),s=e(t)
return t.pushCurrentBond(),t.atomicBond.setTestFn(r),c.c.forEach(s,(e,r)=>{let s=e
if(i)for(;;){const e=s.elementCount
if(s=J(t,n,s),s.elementCount===e)break}else for(let i=0;i<o;i++)s=J(t,n,s)
a.add(s),r%10==0&&t.throwIfTimedOut()}),t.popCurrentBond(),a.getSelection()}}function J(e,t,n){const r=function(e,t){const n=e.inputStructure,r=n.interUnitBonds,i=new O(n),o=e.atomicBond
for(const a of t.units){if(a.kind!==u.Nf.Kind.Atomic){i.beginUnit(a.id)
for(let e=0,t=a.elements.length;e<t;e++)i.addElement(a.elements[e])
i.commitUnit()
continue}const s=n.unitMap.get(a.id),{offset:l,b:c,edgeProps:{flags:d,order:p,key:h}}=s.bonds
o.setStructure(n),o.a.unit=s,o.b.unit=s
for(let t=0,n=a.elements.length;t<n;t++){i.addToUnit(a.id,a.elements[t])
const n=y.X9.indexOf(s.elements,a.elements[t])
for(let r=l[n],u=l[n+1];r<u;r++){const l=c[r],u=s.elements[l]
y.X9.has(a.elements,u)||i.has(a.id,u)||(o.aIndex=n,o.a.element=a.elements[t],o.bIndex=l,o.b.element=u,o.type=d[r],o.order=p[r],o.key=h[r],o.test(e,!0)&&i.addToUnit(a.id,u))}}for(const u of r.getConnectedUnits(s.id)){const r=t.unitMap.get(u.unitB),l=n.unitMap.get(u.unitB)
for(const t of u.connectedIndices)if(y.X9.has(a.elements,s.elements[t]))for(const n of u.getEdges(t)){const a=l.elements[n.indexB]
r&&y.X9.has(r.elements,a)||i.has(u.unitB,a)||(o.a.unit=s,o.aIndex=t,o.a.element=s.elements[t],o.b.unit=l,o.bIndex=n.indexB,o.b.element=a,o.type=n.props.flag,o.order=n.props.order,o.key=n.props.key,o.test(e,!0)&&i.addToUnit(u.unitB,a))}}}return i.getStructure()}(e,n)
return t?j(e,e.inputStructure,r):r}function ee({query:e,radius:t,includeWater:n}){const r=N.Z.entity.type
function i(e){return"water"===r(e)}return function(r){const o=c.c.unionStructure(e(r)),a=j(r,r.inputStructure,U(r,r.inputStructure,o,{radius:t})),s=function(e){var t
const n=e.models[0],r=new Set
if("mmCIF"!==(null===(t=n.sourceData)||void 0===t?void 0:t.kind))return r
const{_rowCount:i,asym_id:o}=n.sourceData.data.db.pdbx_molecule
for(let a=0;a<i;a++)r.add(o.value(a))
return r}(r.inputStructure),l=function(e){var t,n,r
const i=e.models[0],o=new te
if("mmCIF"!==(null===(t=i.sourceData)||void 0===t?void 0:t.kind))return o
const a=i.sourceData.data.db.struct_conn,{conn_type_id:s}=a,{ptnr1_label_asym_id:l,ptnr1_label_comp_id:c,ptnr1_label_seq_id:u,ptnr1_symmetry:d,pdbx_ptnr1_label_alt_id:p,pdbx_ptnr1_PDB_ins_code:h}=a,{ptnr2_label_asym_id:f,ptnr2_label_comp_id:m,ptnr2_label_seq_id:g,ptnr2_symmetry:y,pdbx_ptnr2_label_alt_id:v,pdbx_ptnr2_PDB_ins_code:b}=a
for(let x=0;x<a._rowCount;x++){const e=s.value(x)
if("covale"!==e&&"metalc"!==e)continue
const t={label_asym_id:l.value(x),label_comp_id:c.value(x),label_seq_id:u.value(x),label_alt_id:p.value(x),ins_code:h.value(x),operator_name:null!==(n=d.value(x))&&void 0!==n?n:"1_555"},i={label_asym_id:f.value(x),label_comp_id:m.value(x),label_seq_id:g.value(x),label_alt_id:v.value(x),ins_code:b.value(x),operator_name:null!==(r=y.value(x))&&void 0!==r?r:"1_555"}
o.addEdge(t,i)}return o}(r.inputStructure),d=L.i.Location.create(a),p=new Map,h=new F({checkOperator:!0})
for(const e of a.units){if(e.kind!==u.Nf.Kind.Atomic)continue
d.unit=e
const{elements:t}=e,n=y.hT.transientSegments(e.model.atomicHierarchy.chainAtomSegments,t),i=y.hT.transientSegments(e.model.atomicHierarchy.residueAtomSegments,t)
for(;n.hasNext;){const e=n.move()
d.element=t[e.start]
const r=N.Z.chain.label_asym_id(d),o=N.Z.unit.operator_name(d)
if(s.has(r)){p.has(r)?(0,z.Z2)(p.get(r),o):p.set(r,[o])
continue}const a=N.Z.entity.type(d)
if("water"!==a&&"polymer"!==a)for(i.setSegment(e);i.hasNext;){const e=i.move()
d.element=t[e.start],l.addComponent(F.getEntryFromLocation(d),h)}}r.throwIfTimedOut()}const f=r.inputStructure.subsetBuilder(!0)
for(const e of r.inputStructure.units){if(e.kind!==u.Nf.Kind.Atomic)continue
d.unit=e
const{elements:t}=e,n=y.hT.transientSegments(e.model.atomicHierarchy.chainAtomSegments,t),i=y.hT.transientSegments(e.model.atomicHierarchy.residueAtomSegments,t)
for(f.beginUnit(e.id);n.hasNext;){const e=n.move()
d.element=t[e.start]
const r=N.Z.chain.label_asym_id(d),o=N.Z.unit.operator_name(d)
if(p.has(r)&&p.get(r).indexOf(o)>=0)f.addElementRange(t,e.start,e.end)
else if(h.hasLabelAsymId(r))for(i.setSegment(e);i.hasNext;){const e=i.move()
d.element=t[e.start],h.has(d)&&f.addElementRange(t,e.start,e.end)}}f.commitUnit(),r.throwIfTimedOut()}const m=(0,b.structureUnion)(r.inputStructure,[f.getStructure(),o])
if(n){const e=new O(r.inputStructure),n=r.inputStructure.lookup3d
for(const o of m.units){const a=o.conformation,s=o.elements
for(let r=0,l=s.length;r<l;r++){const l=s[r]
n.findIntoBuilderIf(a.x(l),a.y(l),a.z(l),t,e,i),e.addToUnit(o.id,l)}r.throwIfTimedOut()}return c.c.Sequence(r.inputStructure,[e.getStructure()])}return c.c.Sequence(r.inputStructure,[m])}}class te{constructor(){this.vertices=new Map,this.edges=new Map}addVertex(e,t){this.vertices.has(t)||(this.vertices.set(t,e),this.edges.set(t,[]))}addEdge(e,t){const n=F.getLabel(e),r=F.getLabel(t)
this.addVertex(e,n),this.addVertex(t,r),(0,z.Z2)(this.edges.get(n),r),(0,z.Z2)(this.edges.get(r),n)}addComponent(e,t){const n=F.getLabel(e)
if(!this.vertices.has(n))return void t.add(e)
const r=new Set,i=new Set,o=[n]
for(i.add(n),t.add(e);o.length>0;){const n=o.pop()
r.add(n)
const a=this.vertices.get(n)
for(const s of this.edges.get(n)){if(r.has(s))continue
if(o.push(s),i.has(s))continue
i.add(s)
const n=this.vertices.get(s)
a.operator_name===n.operator_name?t.add({...n,operator_name:e.operator_name}):t.add(n)}}}}var ne,re,ie,oe=n(42261),ae=n(32775)
function se(e,t){return n=>{const r=e(n),i=c.c.LinearBuilder(n.inputStructure)
return n.pushCurrentElement(),c.c.forEach(r,(e,r)=>{n.currentStructure=e,t(n)&&i.add(e),r%100&&n.throwIfTimedOut()}),n.popCurrentStructure(),i.getSelection()}}function le(e){return t=>{const n=e(t),r=c.c.LinearBuilder(t.inputStructure)
if("singletons"===n.kind){if(n.structure.elementCount>0){const e=n.structure.units[0],i=v.o.create([e.getChild(y.X9.ofSingleton(e.elements[0]))],{parent:t.inputStructure})
r.add(i)}}else n.structures.length>0&&r.add(n.structures[0])
return r.getSelection()}}function ce(e,t,n){const{units:r}=e.currentStructure,i=e.pushCurrentElement()
i.structure=e.currentStructure
for(const o of r){i.unit=o
const r=o.elements,a=t
if(a){for(let t=0,o=r.length;t<o;t++)i.element=r[t],n.add(a(e))
e.throwIfTimedOut()}}return e.popCurrentElement(),n}function ue(e,t,n){return r=>{const i=e(r),o=function(e,t,n){const r=new Set,i=t(e)
return e.pushCurrentElement(),c.c.forEach(i,(t,i)=>{e.currentStructure=t,ce(e,n,r),i%10&&e.throwIfTimedOut()}),e.popCurrentElement(),r}(r,t,n),a=c.c.LinearBuilder(r.inputStructure)
return r.pushCurrentStructure(),c.c.forEach(i,(e,t)=>{r.currentStructure=e
const i=ce(r,n,new Set)
oe.M.isSuperset(o,i)&&a.add(e),t%10&&r.throwIfTimedOut()}),r.popCurrentStructure(),a.getSelection()}}function de(e,t){return n=>{const r=c.c.unionStructure(t(n)),i=c.c.LinearBuilder(n.inputStructure)
return c.c.forEach(e(n),(e,t)=>{(0,b.structureAreIntersecting)(r,e)&&i.add(e),t%10&&n.throwIfTimedOut()}),i.getSelection()}}function pe(e){return t=>{const n={queryCtx:t,selection:e.query(t),target:e.target(t),maxRadius:e.maxRadius,minRadius:e.minRadius?Math.max(0,e.minRadius):0,elementRadius:e.elementRadius,invert:!!e.invert}
return 0===n.minRadius&&void 0===e.minRadius?function({queryCtx:e,selection:t,target:n,maxRadius:r,invert:i}){const o=c.c.unionStructure(n).lookup3d,a=c.c.LinearBuilder(e.inputStructure),s=ae.eB.zero()
return c.c.forEach(t,(t,n)=>{const{units:l}=t
let c=!1
for(let e=0,i=l.length;e<i;e++){const t=l[e],{elements:n,conformation:i}=t
for(let e=0,a=n.length;e<a;e++){const t=n[e]
if(i.position(t,s),o.check(s[0],s[1],s[2],r+i.r(t))){c=!0
break}}if(c)break}i&&(c=!c),c&&a.add(t),n%10==0&&e.throwIfTimedOut()}),a.getSelection()}(n):0===n.minRadius?function({queryCtx:e,selection:t,target:n,maxRadius:r,invert:i,elementRadius:o}){const a=c.c.unionStructure(n),s=c.c.LinearBuilder(e.inputStructure)
return e.pushCurrentElement(),c.c.forEach(t,(t,n)=>{let l=function(e,t,n,r,i){return 0===t.elementCount||0===n.elementCount||(t.elementCount<=n.elementCount?re.check(e,t,n,r,i):re.check(e,n,t,r,i))}(e,a,t,r,o)
i&&(l=!l),l&&s.add(t),n%10==0&&e.throwIfTimedOut()}),e.popCurrentElement(),s.getSelection()}(n):function({queryCtx:e,selection:t,target:n,minRadius:r,maxRadius:i,invert:o,elementRadius:a}){const s=c.c.unionStructure(n),l=c.c.LinearBuilder(e.inputStructure)
return e.pushCurrentElement(),c.c.forEach(t,(t,n)=>{let c=function(e,t,n,r,i,o){return 0===t.elementCount||0===n.elementCount||(t.elementCount<=n.elementCount?ne.check(e,t,n,r,i,o):ne.check(e,n,t,r,i,o))}(e,s,t,r,i,a)
o&&(c=!c),c&&l.add(t),n%10==0&&e.throwIfTimedOut()}),e.popCurrentElement(),l.getSelection()}(n)}}function he({query:e,target:t,disjunct:n,invert:r,bondTest:i}){return o=>{const a=t(o)
if(c.c.isEmpty(a))return a
const s=e(o)
if(c.c.isEmpty(s))return s
const l={queryCtx:o,input:o.inputStructure,disjunct:n,target:c.c.unionStructure(a)},d=c.c.LinearBuilder(o.inputStructure)
return o.pushCurrentBond(),o.atomicBond.setTestFn(i),c.c.forEach(s,(e,t)=>{!function(e,t){const{queryCtx:n,input:r,target:i,disjunct:o}=e,a=n.atomicBond,s=r.interUnitBonds
a.setStructure(r)
for(const l of t.units){if(!u.Nf.isAtomic(l))continue
const e=r.unitMap.get(l.id),{offset:c,b:d,edgeProps:{flags:p,order:h,key:f}}=e.bonds,m=s.getConnectedUnits(l.id),g=m.length,v=l.elements,b=e.elements
for(let s=0,u=v.length;s<u;s++){const u=y.X9.indexOf(b,v[s])
a.a.unit=e,a.b.unit=e
for(let t=c[u],r=c[u+1];t<r;t++)if(a.b.element=e.elements[d[t]],(!o||!y.X9.has(l.elements,a.b.element))&&i.hasElement(a.b)&&(a.aIndex=u,a.a.element=v[s],a.bIndex=d[t],a.type=p[t],a.order=h[t],a.key=f[t],a.test(n,!0)))return!0
for(let l=0;l<g;l++){const c=m[l],d=r.unitMap.get(c.unitB),p=d.elements,h=c.getEdges(u)
for(let r=0,l=h.length;r<l;r++){const l=h[r]
if(a.b.unit=d,a.b.element=p[l.indexB],i.hasElement(a.b)&&(!o||!t.hasElement(a.b))&&(a.a.unit=e,a.aIndex=u,a.a.element=v[s],a.bIndex=l.indexB,a.type=l.props.flag,a.order=l.props.order,a.key=l.props.key,a.test(n,!0)))return!0}}}}return!1}(l,e)?r&&d.add(e):d.add(e),t%5==0&&o.throwIfTimedOut()}),o.popCurrentBond(),d.getSelection()}}function fe(e){return 0===e.length?_:1===e.length?e[0]:t=>{const n=c.c.UniqueBuilder(t.inputStructure)
for(let r=0;r<e.length;r++)c.c.forEach(e[r](t),(e,i)=>{n.add(e),r%100&&t.throwIfTimedOut()})
return n.getSelection()}}function me(e){return 0===e.length?_:1===e.length?e[0]:t=>{const n=[]
for(let s=0;s<e.length;s++)n.push(e[s](t))
let r=0,i=c.c.structureCount(n[0])
for(let e=1;e<n.length;e++){const t=c.c.structureCount(n[e])
t<i&&(r=e,i=t)}t.throwIfTimedOut()
const o=(0,g.bw)(e=>e.hashCode,u.oE.areUnitIdsAndIndicesEqual)
c.c.forEach(n[r],e=>o.add(e))
const a=c.c.UniqueBuilder(t.inputStructure)
for(let e=0;e<n.length;e++)e!==r&&(c.c.forEach(n[e],e=>{o.has(e)&&a.add(e)}),t.throwIfTimedOut())
return a.getSelection()}}function ge(e){return e.currentStructure.elementCount}function ye(e){return t=>{const n=e(t)
return c.c.structureCount(n)}}function ve(e){return t=>{const n=new Set
return ce(t,e,n)}}!function(e){let t
!function(e){e[e.BelowMin=0]="BelowMin",e[e.WithinMax=1]="WithinMax",e[e.Miss=2]="Miss"}(t||(t={}))
const n=(0,ae.eB)()
function r(e,r,i,o,a,s,l){const{elements:c,conformation:u}=r,d=n
e.element.unit=r
let p=!1
for(let n=0,h=c.length;n<h;n++){const r=c[n]
e.element.element=r
const h=Math.max(0,ae.eB.distance(i,u.position(r,d))-o-l(e))
if(h<a)return t.BelowMin
h<s&&(p=!0)}return p?t.WithinMax:t.Miss}function i(e,n,i,o,a,s,l){const{units:c}=n
let u=!1
for(let d=0,p=c.length;d<p;d++){const n=r(e,c[d],i,o,a,s,l)
if(n===t.BelowMin)return t.BelowMin
n===t.WithinMax&&(u=!0)}return u?t.WithinMax:t.Miss}const o=(0,ae.eB)()
e.check=function(e,n,r,a,s,l){if(0===n.elementCount||0===r.elementCount)return 0
const{units:c}=n
let u=!1
e.element.structure=n
for(let d=0,p=c.length;d<p;d++){const n=c[d],{elements:p,conformation:h}=n
e.element.unit=n
for(let c=0,d=p.length;c<d;c++){const n=p[c]
e.element.element=n
const d=i(e,r,h.position(n,o),l(e),a,s,l)
if(d===t.BelowMin)return!1
d===t.WithinMax&&(u=!0)}}return u}}(ne||(ne={})),function(e){const t=(0,ae.eB)()
function n(e,n,r,i,o,a){const{elements:s,conformation:l}=n,c=t
e.element.unit=n
for(let t=0,u=s.length;t<u;t++){const n=s[t]
if(e.element.element=n,Math.max(0,ae.eB.distance(r,l.position(n,c))-i-a(e))<=o)return!0}return!1}function r(e,t,r,i,o,a){const{units:s}=t
for(let l=0,c=s.length;l<c;l++)if(n(e,s[l],r,i,o,a))return!0
return!1}const i=(0,ae.eB)()
e.check=function(e,t,n,o,a){if(0===t.elementCount||0===n.elementCount)return 0
const{units:s}=t
e.element.structure=t
for(let l=0,c=s.length;l<c;l++){const t=s[l]
e.element.unit=t
const{elements:c,conformation:u}=t
for(let s=0,l=c.length;s<l;s++){const t=c[s]
if(e.element.element=t,r(e,n,u.position(t,i),a(e),o,a))return!0}}return!1}}(re||(re={})),function(e){function t(e){return!0}function n(e){return!1}e.eq=function(e,t){return n=>e(n)===t},e.lt=function(e,t){return n=>e(n)<t},e.lte=function(e,t){return n=>e(n)<=t},e.gt=function(e,t){return n=>e(n)>t},e.gte=function(e,t){return n=>e(n)>=t},e.inSet=function(e,t){if((r=t)&&r.has)return n=>t.has(e(n))
{if(0===t.length)return n
const r=new Set
for(let e=0;e<t.length;e++)r.add(t[e])
return t=>r.has(e(t))}var r},e.and=function(...e){switch(e.length){case 0:return t
case 1:return e[0]
case 2:{const t=e[0],n=e[1]
return e=>t(e)&&n(e)}case 3:{const t=e[0],n=e[1],r=e[2]
return e=>t(e)&&n(e)&&r(e)}case 4:{const t=e[0],n=e[1],r=e[2],i=e[3]
return e=>t(e)&&n(e)&&r(e)&&i(e)}case 5:{const t=e[0],n=e[1],r=e[2],i=e[3],o=e[4]
return e=>t(e)&&n(e)&&r(e)&&i(e)&&o(e)}case 6:{const t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5]
return e=>t(e)&&n(e)&&r(e)&&i(e)&&o(e)&&a(e)}default:{const t=e.length
return n=>{for(let r=0;r<t;r++)if(!e[r])return!1
return!0}}}},e.or=function(...e){switch(e.length){case 0:return n
case 1:return e[0]
case 2:{const t=e[0],n=e[1]
return e=>t(e)||n(e)}case 3:{const t=e[0],n=e[1],r=e[2]
return e=>t(e)||n(e)||r(e)}case 4:{const t=e[0],n=e[1],r=e[2],i=e[3]
return e=>t(e)||n(e)||r(e)||i(e)}case 5:{const t=e[0],n=e[1],r=e[2],i=e[3],o=e[4]
return e=>t(e)||n(e)||r(e)||i(e)||o(e)}case 6:{const t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5]
return e=>t(e)||n(e)||r(e)||i(e)||o(e)||a(e)}default:{const t=e.length
return n=>{for(let r=0;r<t;r++)if(e[r])return!0
return!1}}}}}(ie||(ie={}))
const be={generators:r,filters:o,modifiers:i,combinators:a,pred:ie,internal:h,atomset:s}},44688(e,t,n){"use strict"
n.d(t,{gn:()=>s.gn,yj:()=>J,oE:()=>i.o,iZ:()=>r.i,ZP:()=>l.Z,us:()=>a.u,Nf:()=>o.N,X$:()=>c.X,gE:()=>c.g,jB:()=>de,_9:()=>ce,rs:()=>pe})
var r=n(66588),i=n(20356),o=n(97960),a=n(8294),s=n(28626),l=n(68329),c=n(9014),u=n(28721),d=n(717),p=n(40615),h=(u.c.Field,u.c.Encodings)
function f(e){const t=l.Z.chain.label_asym_id(e),n=e.unit.conformation.operator.suffix
return n?t+n:t}function m(e){const t=l.Z.chain.auth_asym_id(e),n=e.unit.conformation.operator.suffix
return n?t+n:t}const g={shouldInclude(e){var t
return!!(null===(t=e.atom_site)||void 0===t?void 0:t.pdbx_label_index.isDefined)},value(e,t){const n=t.sourceIndex.value(e.element)
return t.atom_site.pdbx_label_index.value(n)}},y={shouldInclude:e=>p.W.isAvailable(e.structure.models[0]),pdbx_sifts_xref_db_name:{value(e,t){const n=t.sourceIndex.value(e.element)
return t.atom_site.pdbx_sifts_xref_db_name.value(n)},valueKind(e,t){const n=t.sourceIndex.value(e.element)
return t.atom_site.pdbx_sifts_xref_db_name.valueKind(n)}},pdbx_sifts_xref_db_acc:{value(e,t){const n=t.sourceIndex.value(e.element)
return t.atom_site.pdbx_sifts_xref_db_acc.value(n)},valueKind(e,t){const n=t.sourceIndex.value(e.element)
return t.atom_site.pdbx_sifts_xref_db_acc.valueKind(n)}},pdbx_sifts_xref_db_num:{value(e,t){const n=t.sourceIndex.value(e.element)
return t.atom_site.pdbx_sifts_xref_db_num.value(n)},valueKind(e,t){const n=t.sourceIndex.value(e.element)
return t.atom_site.pdbx_sifts_xref_db_num.valueKind(n)}},pdbx_sifts_xref_db_res:{value(e,t){const n=t.sourceIndex.value(e.element)
return t.atom_site.pdbx_sifts_xref_db_res.value(n)},valueKind(e,t){const n=t.sourceIndex.value(e.element)
return t.atom_site.pdbx_sifts_xref_db_res.valueKind(n)}}},v=e=>{const t=u.c.fields()
return t.str("group_PDB",l.Z.residue.group_PDB),e?t.int("id",l.Z.atom.id):t.index("id"),t.str("type_symbol",l.Z.atom.type_symbol).str("label_atom_id",l.Z.atom.label_atom_id).str("label_comp_id",l.Z.atom.label_comp_id).int("label_seq_id",l.Z.residue.label_seq_id,{encoder:h.deltaRLE,valueKind:(e,t)=>{const n=e.unit.model
return n.atomicHierarchy.residues.label_seq_id.valueKind(n.atomicHierarchy.residueAtomSegments.index[e.element])}}).str("label_alt_id",l.Z.atom.label_alt_id).str("pdbx_PDB_ins_code",l.Z.residue.pdbx_PDB_ins_code).str("label_asym_id",f).str("label_entity_id",l.Z.chain.label_entity_id).float("Cartn_x",l.Z.atom.x,{digitCount:3,encoder:h.fixedPoint3}).float("Cartn_y",l.Z.atom.y,{digitCount:3,encoder:h.fixedPoint3}).float("Cartn_z",l.Z.atom.z,{digitCount:3,encoder:h.fixedPoint3}).float("occupancy",l.Z.atom.occupancy,{digitCount:2,encoder:h.fixedPoint2}).float("B_iso_or_equiv",l.Z.atom.B_iso_or_equiv,{digitCount:2,encoder:h.fixedPoint2}).int("pdbx_formal_charge",l.Z.atom.pdbx_formal_charge,{encoder:h.deltaRLE,valueKind:(e,t)=>e.unit.model.atomicHierarchy.atoms.pdbx_formal_charge.valueKind(e.element)}).str("auth_atom_id",l.Z.atom.auth_atom_id).str("auth_comp_id",l.Z.atom.auth_comp_id).int("auth_seq_id",l.Z.residue.auth_seq_id,{encoder:h.deltaRLE}).str("auth_asym_id",m).int("pdbx_PDB_model_num",l.Z.unit.model_num,{encoder:h.deltaRLE}).int("pdbx_label_index",g.value,{shouldInclude:g.shouldInclude}).str("pdbx_sifts_xref_db_name",y.pdbx_sifts_xref_db_name.value,{shouldInclude:y.shouldInclude,valueKind:y.pdbx_sifts_xref_db_name.valueKind}).str("pdbx_sifts_xref_db_acc",y.pdbx_sifts_xref_db_acc.value,{shouldInclude:y.shouldInclude,valueKind:y.pdbx_sifts_xref_db_acc.valueKind}).str("pdbx_sifts_xref_db_num",y.pdbx_sifts_xref_db_num.value,{shouldInclude:y.shouldInclude,valueKind:y.pdbx_sifts_xref_db_num.valueKind}).str("pdbx_sifts_xref_db_res",y.pdbx_sifts_xref_db_res.value,{shouldInclude:y.shouldInclude,valueKind:y.pdbx_sifts_xref_db_res.valueKind}),t.getFields()},b=e=>({name:"atom_site",instance:({structures:t})=>({fields:v(null==e?void 0:e.keepId),source:t.map(e=>({data:{structure:e,sourceIndex:e.model.atomicHierarchy.atomSourceIndex,atom_site:d.K4.is(e.model.sourceData)?e.model.sourceData.data.db.atom_site:void 0},rowCount:e.elementCount,keys:()=>e.elementLocations()}))})})
function x(e,t){return e?`${e}_${t}`:t}function S(e,t){return(n,r)=>t(e(n,r))}function _(e,t){const n=t&&t.prefix,r=u.c.fields().str(x(n,"label_comp_id"),S(e,l.Z.atom.label_comp_id)).int(x(n,"label_seq_id"),S(e,l.Z.residue.label_seq_id),{encoder:h.deltaRLE,valueKind:(t,n)=>{const r=e(t,n),i=r.unit.model
return i.atomicHierarchy.residues.label_seq_id.valueKind(i.atomicHierarchy.residueAtomSegments.index[r.element])}}).str(function(e){return e?`pdbx_${e}_PDB_ins_code`:"pdbx_PDB_ins_code"}(n),S(e,l.Z.residue.pdbx_PDB_ins_code)).str(x(n,"label_asym_id"),S(e,l.Z.chain.label_asym_id)).str(x(n,"label_entity_id"),S(e,l.Z.chain.label_entity_id)).str(x(n,"auth_comp_id"),S(e,l.Z.atom.auth_comp_id)).int(x(n,"auth_seq_id"),S(e,l.Z.residue.auth_seq_id),{encoder:h.deltaRLE}).str(x(n,"auth_asym_id"),S(e,l.Z.chain.auth_asym_id))
return function(e,t,n){n&&n.includeModelNum&&e.int("pdbx_PDB_model_num",S(t,l.Z.unit.model_num))}(r,e,t),r.getFields()}var C=n(67538),w=n(24762),T=n(15769),A=u.c.Field
const I={name:"struct_conf",instance(e){const t=D(e,"helix")
return{fields:E(),source:[{data:t,rowCount:t.length}]}}},P={name:"struct_sheet_range",instance(e){const t=D(e,"sheet").sort(B)
return{fields:k(),source:[{data:t,rowCount:t.length}]}}}
function B(e,t){const n=e.element,r=t.element
return n.sheet_id<r.sheet_id?-1:n.sheet_id===r.sheet_id?e.start.element-t.start.element:1}const E=()=>[A.str("conf_type_id",(e,t)=>t[e].element.type_id),A.str("id",(e,t,n)=>`${t[e].element.type_id}${n+1}`),..._((e,t)=>t[e].start,{prefix:"beg"}),..._((e,t)=>t[e].end,{prefix:"end"}),A.str("pdbx_PDB_helix_class",(e,t)=>t[e].element.helix_class),A.str("details",(e,t)=>t[e].element.details||"",{valueKind:(e,t)=>t[e].element.details?w.VP.ValueKinds.Present:w.VP.ValueKinds.Unknown}),A.int("pdbx_PDB_helix_length",(e,t)=>t[e].length)],k=()=>[A.str("sheet_id",(e,t)=>t[e].element.sheet_id),A.index("id"),..._((e,t)=>t[e].start,{prefix:"beg"}),..._((e,t)=>t[e].end,{prefix:"end"}),A.str("symmetry",(e,t)=>"",{valueKind:(e,t)=>w.VP.ValueKinds.Unknown})]
function D(e,t){const n=T.v.Provider.get(e.firstModel)
if(!n)return[]
const{key:i,elements:a}=n,s=[],l=e.structures[0]
for(const{units:c}of l.unitSymmetryGroups){const e=c[0]
if(!o.N.isAtomic(e))continue
const n=e.model.atomicHierarchy.residueAtomSegments,u=C.hT.transientSegments(n,e.elements)
let d,p=!0
for(;u.hasNext;){p&&(d=u.move())
const o=d.index,c=i[o],h=a[c]
if(h.kind!==t){p=!0
continue}let f=o
for(;u.hasNext;)if(f=d.index,d=u.move(),c!==i[d.index]){p=!1,s[s.length]={start:r.i.Location.create(l,e,n.offsets[o]),end:r.i.Location.create(l,e,n.offsets[f]),length:f-o+1,element:h}
break}}}return s}var M=n(42261),R=n(71695),O=n(70012),L=n(89748)
function N(e,t){if(d.K4.is(e.sourceData))return e.sourceData.data.db[t]}function F(e){return M.M.unionMany(...e.map(e=>e.uniqueResidueNames))}function z(e){if(0===e.length)return[]
if(1===e.length)return e[0].entityIndices
const t=R.th.create()
for(const n of e)for(const e of n.entityIndices)R.th.add(t,e,e)
return(0,O.eh)(t.array),t.array}function j(e,t){return{name:e,instance({structures:n}){if(t&&!t(n[0]))return u.c.Category.Empty
const r=n[0].model
if(!d.K4.is(r.sourceData))return u.c.Category.Empty
const i=r.sourceData.data.db[e]
return i&&i._rowCount?u.c.Category.ofTable(i):u.c.Category.Empty}}}function V(e,t,n){if(!d.K4.is(t.firstModel.sourceData))return
const r=u.c.fields()
if(e.isBinary)for(const o of n.fieldNames){const e=U(o,n.getField(o))
r.add(e)}else for(const o of n.fieldNames){const e=n.getField(o)
r.str(o,t=>e.str(t))}const i=r.getFields()
return{name:n.name,instance:()=>({fields:i,source:[{data:void 0,rowCount:n.rowCount}]})}}function U(e,t){const n=(0,L.j1)(t)
return"str"===n["@type"]?{name:e,type:u.c.Field.Type.Str,value:t.str,valueKind:t.valueKind}:"float"===n["@type"]?u.c.Field.float(e,t.float,{valueKind:t.valueKind,typedArray:Float64Array}):u.c.Field.int(e,t.int,{valueKind:t.valueKind,typedArray:Int32Array})}var G=u.c.Category
const H={name:"chem_comp",instance({firstModel:e,structures:t,cache:n}){const r=N(t[0].model,"chem_comp")
if(!r)return G.Empty
const{id:i}=r,o=n.uniqueResidueNames||(n.uniqueResidueNames=F(t)),a=w.VP.indicesOf(i,e=>o.has(e))
return G.ofTable(r,a)}},q={name:"chem_comp_bond",instance({firstModel:e,structures:t,cache:n}){const r=N(t[0].model,"chem_comp_bond")
if(!r)return G.Empty
const{comp_id:i}=r,o=n.uniqueResidueNames||(n.uniqueResidueNames=F(t)),a=w.VP.indicesOf(i,e=>o.has(e))
return G.ofTable(r,a)}},Q={name:"pdbx_chem_comp_identifier",instance({firstModel:e,structures:t,cache:n}){const r=N(e,"pdbx_chem_comp_identifier")
if(!r)return G.Empty
const{comp_id:i}=r,o=n.uniqueResidueNames||(n.uniqueResidueNames=F(t)),a=w.VP.indicesOf(i,e=>o.has(e))
return G.ofTable(r,a)}},$={name:"pdbx_nonpoly_scheme",instance({firstModel:e,structures:t,cache:n}){const r=N(e,"pdbx_nonpoly_scheme")
return r?G.ofTable(r):G.Empty}}
var X=u.c.Category
const W=K("struct_asym"),Y=K("entity_poly"),Z=K("entity_poly_seq")
function K(e){return{name:e,instance:({structures:t,cache:n})=>function(e,t,n){const r=N(e[0].model,t)
if(!r)return X.Empty
const{entity_id:i}=r,o=n.uniqueEntityIds||(n.uniqueEntityIds=function(e){if(0===e.length)return new Set
const t=e[0].model.entities.data.id
return new Set(z(e).map(e=>t.value(e)))}(e)),a=w.VP.indicesOf(i,e=>o.has(e))
return X.ofTable(r,a)}(t,e,n)}}var J,ee=n(33205),te=n(48905),ne=n(50558),re=u.c.Category
!function(e){e.create=function(e){const t=Array.isArray(e)?e:[e]
return{structures:t,firstModel:t[0].model,cache:Object.create(null)}}}(J||(J={}))
const ie={name:"entity",instance({structures:e}){const t=z(e)
return re.ofTable(e[0].model.entities.data,t)}}
function oe(e){return e.units.every(e=>e.conformation.operator.isIdentity)}function ae(e){return oe(e)&&e.units.every(e=>!e.conformation.operator.assembly&&!e.conformation.operator.suffix)}const se=e=>[j("entry"),j("exptl"),ie,j("cell",oe),j("symmetry",oe),j("pdbx_struct_assembly",ae),j("pdbx_struct_assembly_gen",ae),j("pdbx_struct_oper_list",ae),I,P,W,Y,Z,j("pdbx_entity_branch"),j("pdbx_entity_branch_link"),j("pdbx_branch_scheme"),j("struct_conn"),H,q,Q,j("atom_sites"),$,b({keepId:null==e?void 0:e.keepAtomSiteId})]
var le
!function(e){e.AtomSitePositionsFieldNames=new Set(["id","Cartn_x","Cartn_y","Cartn_z"])}(le||(le={}))
const ce={onlyPositions:{includeCategory:e=>"atom_site"===e,includeField:(e,t)=>le.AtomSitePositionsFieldNames.has(t)}}
function ue(e,t,n){var r
if(!e.cifExport||0===e.cifExport.categories.length)return[]
const i=e.cifExport.prefix,o=e.cifExport.categories
let a=t
if(e.cifExport.context){const n=ee.e.getUUID(e)
t.cache[n+"__ctx"]?a=t.cache[n+"__ctx"]:(a=e.cifExport.context(t)||t,t.cache[n+"__ctx"]=a)}const s=[]
for(const l of o)if(!(null===(r=null==n?void 0:n.skipCategoryNames)||void 0===r?void 0:r.has(l.name))&&(!(null==n?void 0:n.includedCategoryNames)||n.includedCategoryNames.has(l.name))){if(0!==l.name.indexOf(i))throw new Error(`Custom category '${l.name}' name must start with prefix '${i}.'`)
s.push([l,a])}return s}function de(e,t,n){const r=(Array.isArray(t)?t[0]:t).models
if(1!==r.length)throw new Error("Can't export stucture composed from multiple models.")
const i=(null==n?void 0:n.exportCtx)||J.create(t);(null==n?void 0:n.copyAllCategories)&&d.K4.is(r[0].sourceData)?function(e,t,n){var r,i
const o=new Map
for(const u of se({keepAtomSiteId:(null===(r=null==n?void 0:n.extensions)||void 0===r?void 0:r.molstar_bond_site)||(null==n?void 0:n.doNotReindexAtomSiteId)}))o.set(u.name,[u,t])
const a=(0,te.OT)(t)
a&&o.set(a[0].name,a)
const s=n||{}
for(const u of t.firstModel.customProperties.all)for(const e of ue(u,t,s))o.set(e[0].name,e)
if(null==n?void 0:n.customProperties)for(const u of null==n?void 0:n.customProperties)for(const e of ue(u,t,s))o.set(e[0].name,e)
for(const u of t.structures)if(u.hasCustomProperties)for(const e of u.customPropertyDescriptors.all)for(const n of ue(e,t))o.set(n[0].name,n)
const l=new Set,c=t.firstModel.sourceData.data
for(const u of c.frame.categoryNames)if(l.add(u),o.has(u)){const t=o.get(u)
e.writeCategory(t[0],t[1],t[2])}else if(c.db[u]){const n=j(u)
e.writeCategory(n,t)}else{const n=V(e,t,c.frame.categories[u])
n&&e.writeCategory(n)}if(o.forEach((t,n)=>{l.has(n)||e.writeCategory(t[0],t[1],t[2])}),null===(i=null==n?void 0:n.extensions)||void 0===i?void 0:i.molstar_bond_site){const n=(0,ne.j)(t)
n&&e.writeCategory(n[0],n[1],n[2])}}(e,i,n):function(e,t,n){var r,i,o
for(const s of se({keepAtomSiteId:(null===(r=null==n?void 0:n.extensions)||void 0===r?void 0:r.molstar_bond_site)||(null==n?void 0:n.doNotReindexAtomSiteId)}))(null==n?void 0:n.skipCategoryNames)&&(null==n?void 0:n.skipCategoryNames.has(s.name))||(null==n?void 0:n.includedCategoryNames)&&!n.includedCategoryNames.has(s.name)||e.writeCategory(s,t)
if(!(null===(i=null==n?void 0:n.skipCategoryNames)||void 0===i?void 0:i.has("atom_site"))&&e.isCategoryIncluded("atom_site")){const n=(0,te.OT)(t)
n&&e.writeCategory(n[0],n[1],n[2])}if(null===(o=null==n?void 0:n.extensions)||void 0===o?void 0:o.molstar_bond_site){const n=(0,ne.j)(t)
n&&e.writeCategory(n[0],n[1],n[2])}const a=n||{}
for(const s of t.firstModel.customProperties.all)for(const[n,r]of ue(s,t,a))e.writeCategory(n,r)
if(null==n?void 0:n.customProperties)for(const s of null==n?void 0:n.customProperties)for(const[n,r]of ue(s,t,a))e.writeCategory(n,r)
for(const s of t.structures)if(s.hasCustomProperties)for(const n of s.customPropertyDescriptors.all)for(const[r,i]of ue(n,t,a))e.writeCategory(r,i)}(e,i,n)}function pe(e,t,n=!1,r){var i
const o=null!==(i=null==r?void 0:r.encoder)&&void 0!==i?i:u.c.createEncoder({binary:n})
return o.startDataBlock(e),de(o,t,r),o.getData()}},44931(e,t,n){"use strict"
function r([e]){return Math.cbrt(e)}n.r(t),n.d(t,{cbrt:()=>r,default:()=>i})
var i=(0,n(10336).helper)(r)},45477(e,t,n){"use strict"
n.d(t,{c1:()=>s,or:()=>l,vE:()=>c,wi:()=>o,yA:()=>a})
var r=n(24762),i=n(29282)
const o={type_symbol:r.VP.Schema.Aliased(i.r.atom_site.type_symbol),label_atom_id:i.r.atom_site.label_atom_id,auth_atom_id:i.r.atom_site.auth_atom_id,label_alt_id:i.r.atom_site.label_alt_id,label_comp_id:i.r.atom_site.label_comp_id,auth_comp_id:i.r.atom_site.auth_comp_id,pdbx_formal_charge:i.r.atom_site.pdbx_formal_charge},a={group_PDB:i.r.atom_site.group_PDB,label_seq_id:i.r.atom_site.label_seq_id,auth_seq_id:i.r.atom_site.auth_seq_id,pdbx_PDB_ins_code:i.r.atom_site.pdbx_PDB_ins_code},s={label_asym_id:i.r.atom_site.label_asym_id,auth_asym_id:i.r.atom_site.auth_asym_id,label_entity_id:i.r.atom_site.label_entity_id}
var l,c
!function(e){e.EmptyResidueKey=function(){return{label_entity_id:"",label_asym_id:"",auth_seq_id:0,pdbx_PDB_ins_code:void 0}}}(l||(l={})),function(e){function t(e,t){return e.residueAtomSegments.index[e.chainAtomSegments.offsets[t]]}function n(e,t){return e.residueAtomSegments.index[e.chainAtomSegments.offsets[t+1]-1]+1}e.chainStartResidueIndex=t,e.chainEndResidueIndexExcl=n,e.chainResidueCount=function(e,r){return n(e,r)-t(e,r)},e.residueFirstAtomIndex=function(e,t){return e.residueAtomSegments.offsets[t]},e.atomChainIndex=function(e,t){return e.chainAtomSegments.index[t]},e.residueChainIndex=function(e,t){return e.chainAtomSegments.index[e.residueAtomSegments.offsets[t]]}}(c||(c={}))},45592(e,t,n){"use strict"
function r(e){return e.reduce((e,t)=>Math.pow(e,t))}n.r(t),n.d(t,{default:()=>i,pow:()=>r})
var i=(0,n(10336).helper)(r)},45692(e,t,n){"use strict"
n.d(t,{l:()=>l})
var r=n(89),i=n(48393),o=n(7928),a=n(13564),s=n(95538)
function l(e,t){return{kind:e,layers:t}}!function(e){function t(e){return 0===e.layers.length}e.Empty={kind:"empty-loci",layers:[]},e.areEqual=function(e,t){if(0===e.layers.length&&0===t.layers.length)return!0
if(e.layers.length!==t.layers.length)return!1
for(let n=0,i=e.layers.length;n<i;++n){if(e.layers[n].clear!==t.layers[n].clear)return!1
if(!(0,s.bN)(e.layers[n].material,t.layers[n].material))return!1
if(!r.Loci.areEqual(e.layers[n].loci,t.layers[n].loci))return!1}return!0},e.isEmpty=t,e.remap=function(e,t){if("element-loci"===e.kind){const n=[]
for(const r of e.layers){let{loci:e,material:o,clear:a}=r
e=i.StructureElement.Loci.remap(e,t),i.StructureElement.Loci.isEmpty(e)||n.push({loci:e,material:o,clear:a})}return{kind:"element-loci",layers:n}}return e},e.merge=function(e){if(t(e))return e
if("element-loci"===e.kind){const{structure:t}=e.layers[0].loci
let n
const r=new Map
let o=i.StructureElement.Loci.none(t)
for(let a=0,l=e.layers.length;a<l;++a){let{loci:t,material:s,clear:c}=e.layers[l-a-1]
t=i.StructureElement.Loci.subtract(t,o),o=i.StructureElement.Loci.union(t,o),i.StructureElement.Loci.isEmpty(t)||(c?n=n?i.StructureElement.Loci.union(t,n):t:(r.has(s)&&(t=i.StructureElement.Loci.union(t,r.get(s))),r.set(s,t)))}const s=[]
return n&&s.push({loci:n,material:(0,a.i)(),clear:!0}),r.forEach((e,t)=>{s.push({loci:e,material:t,clear:!1})}),{kind:"element-loci",layers:s}}return e},e.filter=function(e,n){if(t(e))return e
if("element-loci"===e.kind){const{structure:t}=e.layers[0].loci,r=[]
for(const o of e.layers){let{loci:e,material:a,clear:s}=o
const l=i.StructureElement.Loci.remap(e,n)
e=i.StructureElement.Loci.remap(l,t),i.StructureElement.Loci.isEmpty(e)||r.push({loci:e,material:a,clear:s})}return{kind:"element-loci",layers:r}}return e},e.ofScript=function(e,t){const n=[]
for(let r=0,a=e.length;r<a;++r){const{script:a,material:s,clear:l}=e[r],c=o.Script.toLoci(a,t)
i.StructureElement.Loci.isEmpty(c)||n.push({loci:c,material:s,clear:l})}return{kind:"element-loci",layers:n}},e.ofBundle=function(e,t){const n=[]
for(let r=0,o=e.length;r<o;++r){const{bundle:o,material:a,clear:s}=e[r],l=i.StructureElement.Bundle.toLoci(o,t.root)
n.push({loci:l,material:a,clear:s})}return{kind:"element-loci",layers:n}},e.toBundle=function(e){const t=[]
for(let n=0,r=e.layers.length;n<r;++n){const{loci:r,material:o,clear:a}=e.layers[n],s=i.StructureElement.Bundle.fromLoci(r)
t.push({bundle:s,material:o,clear:a})}return{kind:"element-loci",layers:t}}}(l||(l={}))},45996(e,t,n){"use strict"
n.d(t,{Q1:()=>s,Q5:()=>l,_j:()=>u,qM:()=>p,e:()=>c,Ak:()=>d})
var r=n(48866),i=n(47546)
function o(){return o.zero()}function a(){return a.zero()}function s(e){return e}function l(e,t,n,r){return{label:e,description:n,list:r,type:t}}function c(e){return e}function u(e){return e}function d(e,t,n){const r={}
for(const i in e){let o=e[i]
o=s.saturate(o,t),o=s.darken(o,-n),r[i]=o}return r}function p(e){return e}!function(e){e.zero=function(){const e=[.1,0,0]
return e[0]=0,e},e.fromColor=function(e,t){return e[0]=(t>>16&255)/255,e[1]=(t>>8&255)/255,e[2]=(255&t)/255,e},e.toColor=function(e){return 255*e[0]<<16|255*e[1]<<8|255*e[2]}}(o||(o={})),function(e){e.zero=function(){const e=[.1,0,0]
return e[0]=0,e}
const t=o()
e.fromColor=function(n,r){return o.fromColor(t,r),e.fromRgb(n,t)},e.toColor=function(e){return i(t,e),o.toColor(t)},e.fromRgb=function(e,t){const[n,r,i]=t,o=Math.min(n,r,i),a=Math.max(n,r,i),s=(a+o)/2
let l=0,c=0
return a===o?(l=0,c=Number.NaN):l=s<.5?(a-o)/(a+o):(a-o)/(2-a-o),n===a?c=(r-i)/(a-o):r===a?c=2+(i-n)/(a-o):i===a&&(c=4+(n-r)/(a-o)),c*=60,c<0&&(c+=360),e[0]=c,e[1]=l,e[2]=s,e}
const n=[0,0,0],r=[0,0,0]
function i(e,t){const[i,o,a]=t
let s,l,c
if(0===o)s=l=c=a
else{const e=n,t=r,u=a<.5?a*(1+o):a+o-a*o,d=2*a-u,p=i/360
e[0]=p+1/3,e[1]=p,e[2]=p-1/3
for(let n=0;n<3;n++)e[n]<0&&(e[n]+=1),e[n]>1&&(e[n]-=1),6*e[n]<1?t[n]=d+6*(u-d)*e[n]:2*e[n]<1?t[n]=u:3*e[n]<2?t[n]=d+(u-d)*(2/3-e[n])*6:t[n]=d
s=t[0],l=t[1],c=t[2]}return e[0]=s,e[1]=l,e[2]=c,e}e.toRgb=i,e.interpolate=function(e,t,n,r){const i=t,o=n,[a,s,l]=i,[c,u,d]=o
let p,h,f
isNaN(a)||isNaN(c)?isNaN(a)?isNaN(c)?h=Number.NaN:(h=c,1!==l&&0!==l||(p=u)):(h=a,1!==d&&0!==d||(p=s)):(f=c>a&&c-a>180?c-(a+360):c<a&&a-c>180?c+360-a:c-a,h=a+r*f),void 0===p&&(p=s+r*(u-s))
const m=l+r*(d-l)
return e[0]=h,e[1]=p,e[2]=m,e}}(a||(a={})),function(e){function t(e,t,n){return e<<16|t<<8|n}function n(e,t,n){return 255*e<<16|255*t<<8|255*n}e.toStyle=function(e){return`rgb(${e>>16&255}, ${e>>8&255}, ${255&e})`},e.toHexStyle=function(e){return"#"+("000000"+e.toString(16)).slice(-6)},e.toHexString=function(e){return"0x"+("000000"+e.toString(16)).slice(-6)},e.toRgbString=function(t){return`RGB: ${e.toRgb(t).join(", ")}`},e.toRgb=function(e){return[e>>16&255,e>>8&255,255&e]},e.toRgbNormalized=function(e){return[(e>>16&255)/255,(e>>8&255)/255,(255&e)/255]},e.fromHexStyle=function(e){return parseInt(e.replace("#","0x"))},e.fromHexString=function(e){return parseInt(e)},e.fromRgb=t,e.fromNormalizedRgb=n,e.fromArray=function(e,n){return t(e[n],e[n+1],e[n+2])},e.fromNormalizedArray=function(e,t){return n(e[t],e[t+1],e[t+2])},e.fromColorListEntry=function(e){return"number"==typeof e?e:e[0]},e.toArray=function(e,t,n){return t[n]=e>>16&255,t[n+1]=e>>8&255,t[n+2]=255&e,t},e.toArrayNormalized=function(e,t,n){return t[n]=(e>>16&255)/255,t[n+1]=(e>>8&255)/255,t[n+2]=(255&e)/255,t},e.toVec3=function(e,t){return e[0]=t>>16&255,e[1]=t>>8&255,e[2]=255&t,e},e.toVec3Normalized=function(e,t){return e[0]=(t>>16&255)/255,e[1]=(t>>8&255)/255,e[2]=(255&t)/255,e},e.interpolate=function(e,t,n){const r=e>>16&255,i=e>>8&255,o=255&e
return r+((t>>16&255)-r)*n<<16|i+((t>>8&255)-i)*n<<8|o+((255&t)-o)*n}
const o=a.zero(),s=a.zero()
function l(e){const t=e>>16&255
return t!==(e>>8&255)||t!==(255&e)}e.interpolateHsl=function(e,t,n){const r=a.fromColor(o,e),i=a.fromColor(s,t)
return a.interpolate(r,r,i,n),a.toColor(r)},e.hasHue=l
const c=[0,0,0]
function u(e,t){return l(e)?(r.G.fromColor(c,e),r.G.toColor(r.G.saturate(c,c,t))):e}e.saturate=u,e.desaturate=function(e,t){return u(e,-t)}
const d=[0,0,0]
function p(e,t){return i.E.fromColor(d,e),i.E.toColor(i.E.darken(d,d,t))}function h(e){return e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)}function f(e){return.2126*h((e>>16&255)/255)+.7152*h((e>>8&255)/255)+.0722*h((255&e)/255)}function m(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function g(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}e.darken=p,e.lighten=function(e,t){return p(e,-t)},e.luminance=f,e.contrast=function(e,t){const n=f(e),r=f(t)
return n>r?(n+.05)/(r+.05):(r+.05)/(n+.05)},e.sRGBToLinear=function(e){return n(m((e>>16&255)/255),m((e>>8&255)/255),m((255&e)/255))},e.linearToSRGB=function(e){return n(g((e>>16&255)/255),g((e>>8&255)/255),g((255&e)/255))}}(s||(s={}))},46098(e,t,n){"use strict"
n.d(t,{VK:()=>u,aU:()=>s,dL:()=>l,jB:()=>c})
var r=n(28074),i=n(25602),o=n(38981),a=n(41288)
const s=i.createContext(void 0)
class l extends i.Component{subscribe(e,t){void 0===this.subs&&(this.subs=[]),this.subs.push(e.subscribe(t))}componentWillUnmount(){if(this.subs){for(const e of this.subs)e.unsubscribe()
this.subs=void 0}}constructor(e,t){super(e),this.subs=void 0,this.plugin=t,this.init&&this.init()}}l.contextType=s
class c extends i.PureComponent{subscribe(e,t){void 0===this.subs&&(this.subs=[]),this.subs.push(e.subscribe(t))}componentWillUnmount(){if(this.subs){for(const e of this.subs)e.unsubscribe()
this.subs=void 0}}constructor(e,t){super(e,t),this.subs=void 0,this.plugin=t,this.init&&this.init()}}c.contextType=s
class u extends l{toggleCollapsed(){this.setState({isCollapsed:!this.state.isCollapsed})}componentDidUpdate(e){void 0!==this.props.initiallyCollapsed&&e.initiallyCollapsed!==this.props.initiallyCollapsed&&this.setState({isCollapsed:this.props.initiallyCollapsed})}render(){var e
if(this.state.isHidden)return null
const t=this.state.header.toLowerCase().replace(/\s/g,""),n=this.state.isCollapsed?"msp-transform-wrapper msp-transform-wrapper-collapsed":"msp-transform-wrapper"
return(0,r.jsxs)("div",{className:n,children:[(0,r.jsx)("div",{id:t,className:"msp-transform-header",children:(0,r.jsxs)(o.$n,{icon:this.state.brand?void 0:this.state.isCollapsed?a.Cp:a.DM,noOverflow:!0,onClick:()=>this.toggleCollapsed(),className:this.state.brand?`msp-transform-header-brand msp-transform-header-brand-${this.state.brand.accent}`:void 0,title:"Click to "+(this.state.isCollapsed?"expand":"collapse"),children:[(0,r.jsx)(a.In,{svg:null===(e=this.state.brand)||void 0===e?void 0:e.svg,inline:!0}),this.state.header,(0,r.jsx)("small",{style:{margin:"0 6px"},children:this.state.isCollapsed?"":this.state.description})]})}),!this.state.isCollapsed&&this.renderControls()]})}constructor(e,t){super(e,t)
const n=this.defaultState()
void 0!==e.initiallyCollapsed&&(n.isCollapsed=e.initiallyCollapsed),void 0!==e.header&&(n.header=e.header),this.state=n}}},46357(e,t,n){"use strict"
n.d(t,{Wp:()=>u,du:()=>d,OM:()=>p,_0:()=>m}),n(31683)
var r=n(9043),i=n(19708),o=n(32775),a=n(95916),s=n(85362),l=n(83164),c=n(36568)
const u=new Float32Array([1,1,-1,1,-1,-1,-1,-1,1,-1,1,1]),d={drawCount:(0,i.Xb)("number"),instanceCount:(0,i.Xb)("number"),aPosition:(0,i.Yz)("float32",2,0),uQuadScale:(0,i.w5)("v2")},p={drawCount:r.IQ.create(6),instanceCount:r.IQ.create(1),aPosition:r.IQ.create(u),uQuadScale:r.IQ.create(o.ZY.create(1,1))},h={...d,tColor:(0,i.$G)("texture","rgba","ubyte","nearest"),uTexSize:(0,i.w5)("v2")},f=(0,a.NG)("copy",s.e,"\nprecision highp float;\nprecision highp sampler2D;\n\nuniform sampler2D tColor;\nuniform vec2 uTexSize;\n\nvoid main() {\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n    gl_FragColor = texture2D(tColor, coords);\n}\n")
function m(e,t){const n={...p,tColor:r.IQ.create(t),uTexSize:r.IQ.create(o.ZY.create(t.getWidth(),t.getHeight()))},i={...h},a=(0,l.$h)(e,"triangles",f,i,n)
return(0,c._)(a,n)}},46448(e,t,n){"use strict"
n.d(t,{G:()=>l,T:()=>r})
var r,i=n(70292),o=n(14294),a=n(32775),s=n(33205)
function l(e,t){return i.Task.create("Create Volume",async n=>{const{volume_data_3d_info:i,volume_data_3d:l}=e,c=o.O8.create(i.spacegroup_number.value(0)||"P 1",a.eB.ofArray(i.spacegroup_cell_size.value(0)),a.eB.scale(a.eB.zero(),a.eB.ofArray(i.spacegroup_cell_angles.value(0)),Math.PI/180)),u=i.axis_order.value(0),d=a.qY.convertToCanonicalAxisIndicesFastToSlow(u),p=d(i.sample_count.value(0)),h=a.qY.Space(p,a.qY.invertAxisOrder(u),Float32Array),f=a.qY.create(h,a.qY.Data1(l.values.toArray({array:Float32Array}))),m=a.eB.ofArray(d(i.origin.value(0))),g=a.eB.ofArray(d(i.dimensions.value(0)))
return{label:null==t?void 0:t.label,entryId:null==t?void 0:t.entryId,periodicity:a.eB.isInteger(g)?"xyz":"none",grid:{transform:{kind:"spacegroup",cell:c,fractionalBox:o.DJ.create(m,a.eB.add(a.eB.zero(),m,g))},cells:f,stats:{min:i.min_sampled.value(0),max:i.max_sampled.value(0),mean:i.mean_sampled.value(0),sigma:i.sigma_sampled.value(0)}},instances:[{transform:a.$I.identity()}],sourceData:r.create(e),customProperties:new s.v,_propertyData:Object.create(null)}})}!function(e){e.is=function(e){return"dscif"===(null==e?void 0:e.kind)},e.create=function(e){return{kind:"dscif",name:e._name,data:e}}}(r||(r={}))},46712(e,t,n){"use strict"
n.d(t,{LQ:()=>i,Mx:()=>o,Sn:()=>a})
var r=n(4800)
const i={is:e=>"function"==typeof e.charCodeAt,toString(e){try{return e.toString()}catch(t){throw new Error(`Failed to convert StringLike object into string. This might be because the length ${e.length} exceeds maximum allowed string length ${o}. (${t})`)}}},o=536870888
class a{get length(){return this._length}constructor(e=28){this._chunks=[],this._length=0,this._tmpArray=[],this.STRING_CHUNK_SIZE=2**e,this.STRING_CHUNK_SHIFT=e,this.STRING_CHUNK_MASK=2**e-1}static fromString(e,t=28){const n=new a(t)
return n._append(e),n}static fromStrings(e,t=28){const n=new a(t)
for(const r of e)n._append(r)
return n}static fromUtf8Data(e,t=0,n=e.length,i=28){const o=2**i,s=[]
let l=t
for(;l<n;){let t=Math.min(l+o,n)
if(t<n)for(;128==(192&e[t]);)if(t--,t===l)throw new Error("Input is rubbish, no UTF-8 character start found in a chunk")
const i=(0,r.ss)(e,l,t-l)
s.push(i),l=t}return a.fromStrings(s,i)}_append(e){const t=this.STRING_CHUNK_SIZE,n=0===this._chunks.length||this._chunks[this._chunks.length-1].length===t?"":this._chunks.pop()
let r=t-n.length
for(this._chunks.push(n+e.substring(0,r));r<e.length;)this._chunks.push(e.substring(r,r+t)),r+=t
this._length+=e.length}_getChunkIndex(e){return e>>>this.STRING_CHUNK_SHIFT}_getIndexInChunk(e){return e&this.STRING_CHUNK_MASK}_isOutOfRange(e){return e<0||e>=this.length}at(e){return-this.length<=e&&e<0?this.at(e+this.length):this.charAt(e)||void 0}charAt(e){if(this._isOutOfRange(e))return""
const t=this._getChunkIndex(e),n=this._getIndexInChunk(e)
return this._chunks[t][n]}charCodeAt(e){if(this._isOutOfRange(e))return NaN
const t=this._getChunkIndex(e),n=this._getIndexInChunk(e)
return this._chunks[t].charCodeAt(n)}substring(e,t){const n=Math.min(Math.max(null!=e?e:0,0),this.length),r=Math.min(Math.max(null!=t?t:this.length,0),this.length)
if(n>r)return this.substring(r,n)
if(n===r)return""
if(r-n>o)throw new Error(`Trying to create get a substring longer (${r-n}) than maximum allowed string length (${o}).`)
const i=this._getChunkIndex(n),a=this._getIndexInChunk(n),s=this._getChunkIndex(r),l=this._getIndexInChunk(r)
if(i===s)return this._chunks[i].substring(a,l)
{const e=this._getTmpArray()
e.push(this._chunks[i].substring(a,this.STRING_CHUNK_SIZE))
for(let t=i+1;t<s;t++)e.push(this._chunks[t])
return e.push(this._chunks[s].substring(0,l)),e.join("")}}_getTmpArray(){for(;this._tmpArray.length;)this._tmpArray.pop()
return this._tmpArray}indexOf(e,t=0){if(e.length>this.STRING_CHUNK_SIZE)throw new Error("NotImplementedError: indexOf is only implemented for searchString shorter than STRING_CHUNK_SIZE")
t<0&&(t=0)
const n=this._getChunkIndex(t)
for(let r=n;r<this._chunks.length;r++){const i=this._chunks[r],o=r===n?this._getIndexInChunk(t):0,a=i.indexOf(e,o)
if(a>=0)return r*this.STRING_CHUNK_SIZE+a
if(r!==this._chunks.length-1){const t=Math.max(this.STRING_CHUNK_SIZE-e.length+1,o),n=(i.substring(t,void 0)+this._chunks[r+1].substring(0,e.length-1)).indexOf(e)
if(n>=0)return r*this.STRING_CHUNK_SIZE+t+n}}return-1}includes(e,t=0){return this.indexOf(e,t)>=0}startsWith(e,t=0){if(e.length>this.STRING_CHUNK_SIZE)throw new Error("NotImplementedError: startsWith is only implemented for searchString shorter than STRING_CHUNK_SIZE")
return this.substring(t,t+e.length)===e}toString(){try{return this._chunks.join("")}catch(e){throw new Error(`Failed to convert StringLike object into string. This might be because the length ${this.length} exceeds maximum allowed string length ${o}. (${e})`)}}}},47134(e,t,n){"use strict"
n.d(t,{Q:()=>s})
var r=n(70012),i=n(32520)
const o=r.Gm.add3,a=r.Gm.add
var s
!function(e){e.create=function(e=2048,t=1024,n){const s=r.Gm.create(Float32Array,3,t,n?n.centerBuffer.ref.value:e),l=r.Gm.create(Float32Array,1,t,n?n.groupBuffer.ref.value:e)
return{add:(e,t,n,r)=>{o(s,e,t,n),a(l,r)},getSpheres:()=>{const e=r.Gm.compact(s,!0),t=r.Gm.compact(l,!0)
return i.v.create(e,t,s.elementCount,n)}}}}(s||(s={}))},47404(e,t,n){"use strict"
n.d(t,{S:()=>r})
var r,i=n(9043),o=n(32775),a=n(37392),s=n(65081),l=n(17782),c=n(68187),u=n(81871),d=n(92384),p=n(31727),h=n(14294),f=n(9726),m=n(64170),g=n(69858),y=n(70012),v=n(40426),b=n(22394),x=n(71905),S=n(19231)
!function(e){function t(e,t,n,o,s,l,c,u,d,f){return f?function(e,t,n,r,o,a,s,l,c,u){return c>u.cylinderCount&&(i.IQ.update(u.mappingBuffer,e),i.IQ.update(u.indexBuffer,t)),u.cylinderCount=c,i.IQ.update(u.groupBuffer,n),i.IQ.update(u.startBuffer,r),i.IQ.update(u.endBuffer,o),i.IQ.update(u.scaleBuffer,a),i.IQ.update(u.capBuffer,s),i.IQ.update(u.colorModeBuffer,l),u}(e,t,n,o,s,l,c,u,d,f):function(e,t,n,o,s,l,c,u,d){const f=(0,h.f8)()
let m,g=-1,y=-1
const v={kind:"cylinders",cylinderCount:d,mappingBuffer:i.IQ.create(e),indexBuffer:i.IQ.create(t),groupBuffer:i.IQ.create(n),startBuffer:i.IQ.create(o),endBuffer:i.IQ.create(s),scaleBuffer:i.IQ.create(l),capBuffer:i.IQ.create(c),colorModeBuffer:i.IQ.create(u),get boundingSphere(){const e=r(v)
if(e!==g){const t=(0,p.sL)(v.startBuffer.ref.value,6*v.cylinderCount,6),n=(0,p.sL)(v.endBuffer.ref.value,6*v.cylinderCount,6)
h.f8.expandBySphere(f,t,n),g=e}return f},get groupMapping(){return v.groupBuffer.ref.version!==y&&(m=(0,a.AA)(v.groupBuffer.ref.value,v.cylinderCount,6),y=v.groupBuffer.ref.version),m},setBoundingSphere(e){h.f8.copy(f,e),g=r(v)}}
return v}(e,t,n,o,s,l,c,u,d)}function n(e){return t(e?e.mappingBuffer.ref.value:new Float32Array(0),e?e.indexBuffer.ref.value:new Uint32Array(0),e?e.groupBuffer.ref.value:new Float32Array(0),e?e.startBuffer.ref.value:new Float32Array(0),e?e.endBuffer.ref.value:new Float32Array(0),e?e.scaleBuffer.ref.value:new Float32Array(0),e?e.capBuffer.ref.value:new Float32Array(0),e?e.colorModeBuffer.ref.value:new Float32Array(0),0,e)}function r(e){return(0,y.TI)([e.cylinderCount,e.mappingBuffer.ref.version,e.indexBuffer.ref.version,e.groupBuffer.ref.version,e.startBuffer.ref.version,e.endBuffer.ref.version,e.scaleBuffer.ref.version,e.capBuffer.ref.version,e.colorModeBuffer.ref.version])}function _(e,t){const n=6*e.cylinderCount,r=t.instanceCount.ref.value,i=(0,u.tu)(),a=i.position,s=e.startBuffer.ref.value,l=e.endBuffer.ref.value,c=t.aTransform.ref.value
return(0,u.iQ)(n,r,2,(e,t)=>{const n=e%6==0?s:l
return t<0?o.eB.fromArray(a,n,3*e):o.eB.transformMat4Offset(a,n,c,0,3*e,16*t),i})}function C(e,t,n,r,a){const{instanceCount:u,groupCount:d}=n,y=_(e,t),C=(0,s.D1)(n,y,r.color),w=(0,c.v3)(n,r.size),T=a.instanceGranularity?(0,l.Km)(u,"instance"):(0,l.Km)(u*d,"groupInstance"),A=(0,m.WG)(),I=(0,g.MD)(),P=(0,x.JS)(),B=(0,b.IB)(),E=(0,v.EN)(),k={drawCount:4*e.cylinderCount*3,vertexCount:6*e.cylinderCount,groupCount:d,instanceCount:u},D=(0,c.yx)(w)*a.sizeFactor,M=h.f8.clone(e.boundingSphere),R=(0,p.Ax)(M,t.aTransform.ref.value,u,0)
return{dGeometryType:i.IQ.create("cylinders"),aMapping:e.mappingBuffer,aGroup:e.groupBuffer,aStart:e.startBuffer,aEnd:e.endBuffer,aScale:e.scaleBuffer,aCap:e.capBuffer,aColorMode:e.colorModeBuffer,elements:e.indexBuffer,boundingSphere:i.IQ.create(R),invariantBoundingSphere:i.IQ.create(M),uInvariantBoundingSphere:i.IQ.create(o.Zb.ofSphere(M)),...C,...w,...T,...A,...I,...P,...B,...E,...t,padding:i.IQ.create(D),...f.iy.createValues(a,k),uSizeFactor:i.IQ.create(a.sizeFactor*a.sizeAspectRatio),uDoubleSided:i.IQ.create(a.doubleSided),dIgnoreLight:i.IQ.create(a.ignoreLight),dCelShaded:i.IQ.create(a.celShaded),dXrayShaded:i.IQ.create("inverted"===a.xrayShaded?"inverted":!0===a.xrayShaded?"on":"off"),dTransparentBackfaces:i.IQ.create(a.transparentBackfaces),dSolidInterior:i.IQ.create(a.solidInterior),uBumpFrequency:i.IQ.create(a.bumpFrequency),uBumpAmplitude:i.IQ.create(a.bumpAmplitude),uInteriorColor:i.IQ.create((0,S.mT)(a.interior,(0,o.Zb)())),uInteriorSubstance:i.IQ.create((0,S.Zl)(a.interior,(0,o.Zb)())),dDualColor:i.IQ.create("interpolate"===a.colorMode)}}function w(e,t){f.iy.updateRenderableState(e,t),e.opaque=e.opaque&&!t.xrayShaded,e.writeDepth=e.opaque}e.create=t,e.createEmpty=n,e.transform=function(e,t){const n=e.startBuffer.ref.value;(0,a.pi)(t,n,0,6*e.cylinderCount),i.IQ.update(e.startBuffer,n)
const r=e.endBuffer.ref.value;(0,a.pi)(t,r,0,6*e.cylinderCount),i.IQ.update(e.endBuffer,r)},e.Params={...f.iy.Params,sizeFactor:d.t.Numeric(1,{min:0,max:10,step:.1}),sizeAspectRatio:d.t.Numeric(1,{min:0,max:3,step:.01}),doubleSided:d.t.Boolean(!1,f.iy.CustomQualityParamInfo),ignoreLight:d.t.Boolean(!1,f.iy.ShadingCategory),celShaded:d.t.Boolean(!1,f.iy.ShadingCategory),xrayShaded:d.t.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],f.iy.ShadingCategory),transparentBackfaces:d.t.Select("off",d.t.arrayToOptions(["off","on","opaque"]),f.iy.ShadingCategory),solidInterior:d.t.Boolean(!0,f.iy.ShadingCategory),bumpFrequency:d.t.Numeric(0,{min:0,max:10,step:.1},f.iy.ShadingCategory),bumpAmplitude:d.t.Numeric(1,{min:0,max:5,step:.1},f.iy.ShadingCategory),interior:(0,S.ag)(),colorMode:d.t.Select("default",d.t.arrayToOptions(["default","interpolate"]),f.iy.ShadingCategory)},e.Utils={Params:e.Params,createEmpty:n,createValues:C,createValuesSimple:function(t,n,r,i,o){const a=f.iy.createSimple(r,i,o),s={...d.t.getDefaultValues(e.Params),...n}
return C(t,a.transform,a.locationIterator,a.theme,s)},updateValues:function(e,t){f.iy.updateValues(e,t),i.IQ.updateIfChanged(e.uSizeFactor,t.sizeFactor*t.sizeAspectRatio),i.IQ.updateIfChanged(e.uDoubleSided,t.doubleSided),i.IQ.updateIfChanged(e.dIgnoreLight,t.ignoreLight),i.IQ.updateIfChanged(e.dCelShaded,t.celShaded),i.IQ.updateIfChanged(e.dXrayShaded,"inverted"===t.xrayShaded?"inverted":!0===t.xrayShaded?"on":"off"),i.IQ.updateIfChanged(e.dTransparentBackfaces,t.transparentBackfaces),i.IQ.updateIfChanged(e.dSolidInterior,t.solidInterior),i.IQ.updateIfChanged(e.uBumpFrequency,t.bumpFrequency),i.IQ.updateIfChanged(e.uBumpAmplitude,t.bumpAmplitude),i.IQ.update(e.uInteriorColor,(0,S.mT)(t.interior,e.uInteriorColor.ref.value)),i.IQ.update(e.uInteriorSubstance,(0,S.Zl)(t.interior,e.uInteriorSubstance.ref.value)),i.IQ.updateIfChanged(e.dDualColor,"interpolate"===t.colorMode)},updateBoundingSphere:function(e,t){const n=h.f8.clone(t.boundingSphere),r=(0,p.Ax)(n,e.aTransform.ref.value,e.instanceCount.ref.value,0)
h.f8.equals(r,e.boundingSphere.ref.value)||i.IQ.update(e.boundingSphere,r),h.f8.equals(n,e.invariantBoundingSphere.ref.value)||(i.IQ.update(e.invariantBoundingSphere,n),i.IQ.update(e.uInvariantBoundingSphere,o.Zb.fromSphere(e.uInvariantBoundingSphere.ref.value,n)))},createRenderableState:function(e){const t=f.iy.createRenderableState(e)
return w(t,e),t},updateRenderableState:w,createPositionIterator:_}}(r||(r={}))},47546(e,t,n){"use strict"
n.d(t,{E:()=>s})
var r=n(45996),i=n(48866),o=n(87423),a=n(97564)
function s(){return s.zero()}!function(e){function t(){const e=[.1,0,0]
return e[0]=0,e}function n(e,t){const[n,r,i]=t,a=Math.sqrt(r*r+i*i)
let s=((0,o.H)(Math.atan2(i,r))+360)%360
return 0===Math.round(1e4*a)&&(s=Number.NaN),e[0]=s,e[1]=a,e[2]=n,e}function s(e,t,n){return e[0]=t[0]-u*n,e[1]=t[1],e[2]=t[2],e}e.zero=t,e.create=function(e,n,r){const i=t()
return i[0]=e,i[1]=n,i[2]=r,i},e.set=function(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e},e.distance=function(e,t){const n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2]
return Math.sqrt(n*n+r*r+i*i)},e.fromColor=function(e,t){const[n,i,o]=r.Q1.toRgb(t),[a,s,l]=function(e,t,n){return[S((.4124564*(e=x(e))+.3575761*(t=x(t))+.1804375*(n=x(n)))/d),S((.2126729*e+.7151522*t+.072175*n)/p),S((.0193339*e+.119192*t+.9503041*n)/h)]}(n,i,o),c=116*s-16
return e[0]=c<0?0:c,e[1]=500*(a-s),e[2]=200*(s-l),e},e.fromHcl=function(e,t){return i.G.toLab(e,t)},e.toColor=function(e){let t=(e[0]+16)/116,n=isNaN(e[1])?t:t+e[1]/500,i=isNaN(e[2])?t:t-e[2]/200
t=p*b(t),n=d*b(n),i=h*b(i)
const o=v(3.2404542*n-1.5371385*t-.4985314*i),s=v(-.969266*n+1.8760108*t+.041556*i),l=v(.0556434*n-.2040259*t+1.0572252*i)
return r.Q1.fromRgb(Math.round((0,a.qE)(o,0,255)),Math.round((0,a.qE)(s,0,255)),Math.round((0,a.qE)(l,0,255)))},e.toHcl=n,e.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},e.darken=s,e.lighten=function(e,t,n){return s(e,t,-n)}
const l=[0,0,0]
function c(e,t,r){return n(l,t),i.G.toLab(e,i.G.saturate(l,l,r))}e.saturate=c,e.desaturate=function(e,t,n){return c(e,t,-n)}
const u=18,d=.95047,p=1,h=1.08883,f=.137931034,m=.206896552,g=.12841855,y=.008856452
function v(e){return 255*(e<=.00304?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function b(e){return e>m?e*e*e:g*(e-f)}function x(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function S(e){return e>y?Math.pow(e,1/3):e/g+f}}(s||(s={}))},47589(e,t,n){"use strict"
n.d(t,{N:()=>r})
var r,i=n(67538),o=n(20356),a=n(70012),s=n(10773),l=n(21700),c=n(99302),u=n(44195),d=n(71534)
!function(e){function t(e){const t=[]
for(const o of e.elements){const{unit:e,indices:n}=o
if(0===i.CD.size(n))continue
const r=[],a=[]
if(i.CD.isInterval(n))1===i.CD.size(n)?a.push(i.IX.min(n)):r.push(i.IX.min(n),i.IX.max(n))
else{let e=0
const t=n.length
for(;e<t;){const i=e
for(e++;e<t&&n[e-1]+1===n[e];)e++
const o=e
if(o-i>2)r.push(n[i],n[o-1])
else for(let e=i;e<o;e++)a[a.length]=n[e]}}t.push({unit:e,set:i.X9.ofSortedArray(a),ranges:s.m.ofSortedRanges(r)})}const n=new Map
for(let i=0,o=t.length;i<o;++i){const e=t[i],r=(0,a.vb)((0,a.TI)(e.ranges),(0,a.TI)(e.set))
if(n.has(r)){const{groupedUnits:t}=n.get(r)
t.has(e.unit.invariantId)?t.get(e.unit.invariantId).push(e.unit.id):t.set(e.unit.invariantId,[e.unit.id])}else{const t=new Map
t.set(e.unit.invariantId,[e.unit.id]),n.set(r,{groupedUnits:t,set:e.set,ranges:e.ranges})}}const r=[]
return n.forEach(e=>{const t=[]
e.groupedUnits.forEach(e=>t.push(i.X9.ofUnsortedArray(e))),t.sort((e,t)=>e[0]-t[0]),r.push({groupedUnits:t,set:e.set,ranges:e.ranges})}),{hash:e.structure.hashCode,elements:r}}function n(e,t){const n=[]
for(let r=0,i=e.length;r<i;++r){const i=e[r]
t.unitMap.has(i)&&n.push(t.unitMap.get(i))}return n}function r(e){return c.MolScriptBuilder.internal.generator.bundleElement({groupedUnits:c.MolScriptBuilder.core.type.list(e.groupedUnits.map(e=>c.MolScriptBuilder.core.type.list(e))),ranges:c.MolScriptBuilder.core.type.list(e.ranges),set:c.MolScriptBuilder.core.type.list(e.set)})}e.Empty={hash:-1,elements:[]},e.fromSubStructure=function(e,n){return t(u.cv.toLociWithSourceUnits(u.cv.Singletons(e,n)))},e.fromSelection=function(e){return t(u.cv.toLociWithSourceUnits(e))},e.fromExpression=function(e,n,r){return t(l.Q.fromExpression(e,n,r))},e.fromQuery=function(e,n,r){return t(l.Q.fromQuery(e,n,r))},e.fromSchema=function(e,t,n){return d.Schema.toBundle(e,t,n)},e.fromLoci=t,e.toLoci=function(e,t){-1!==e.hash&&e.hash!==t.hashCode&&new Error("Bundle not compatible with given structure")
const r=[]
for(const o of e.elements)for(const e of o.groupedUnits){const a=n(e,t)
if(0===a.length)continue
let l
if(0===o.ranges.length)l=o.set
else if(0===o.set.length)if(2===o.ranges.length)l=i.IX.ofRange(o.ranges[0],o.ranges[1])
else{const e=new Int32Array(s.m.size(o.ranges))
s.m.forEach(o.ranges,(t,n)=>e[n]=t),l=i.X9.ofSortedArray(e)}else{const e=s.m.size(o.ranges),t=new Int32Array(o.set.length+e)
s.m.forEach(o.ranges,(e,n)=>t[n]=e),t.set(o.set,e),l=i.X9.ofUnsortedArray(t)}for(const e of a)r.push({unit:e,indices:l})}return(0,l.Q)(t,r)},e.toStructure=function(e,t){-1!==e.hash&&e.hash!==t.hashCode&&new Error("Bundle not compatible with given structure")
const r=[]
for(const o of e.elements)for(const e of o.groupedUnits){const a=n(e,t)
if(0===a.length)continue
const l=a[0].elements,c=s.m.size(o.ranges),u=o.set.length,d=new Int32Array(u+c)
let p
if(0===c){for(let e=0,t=u;e<t;++e)d[e]=l[o.set[e]]
p=i.X9.ofSortedArray(d)}else if(0===u)s.m.forEach(o.ranges,(e,t)=>d[t]=l[e]),p=i.X9.ofSortedArray(d)
else if(i.X9.min(o.set)>s.m.max(o.ranges)){s.m.forEach(o.ranges,(e,t)=>d[t]=l[e])
for(let e=0,t=u;e<t;++e)d[e+c]=l[o.set[e]]
p=i.X9.ofSortedArray(d)}else if(s.m.min(o.ranges)>i.X9.max(o.set)){for(let e=0,t=u;e<t;++e)d[e]=l[o.set[e]]
s.m.forEach(o.ranges,(e,t)=>d[t+u]=l[e]),p=i.X9.ofSortedArray(d)}else{s.m.forEach(o.ranges,(e,t)=>d[t]=l[e])
for(let e=0,t=u;e<t;++e)d[e+c]=l[o.set[e]]
p=i.X9.ofUnsortedArray(d)}for(const e of a)r.push(e.getChild(p))}return o.o.create(r,{parent:t})},e.toExpression=function(e){return c.MolScriptBuilder.internal.generator.bundle({elements:c.MolScriptBuilder.core.type.list(e.elements.map(r))})},e.areEqual=function(e,t){if(e.elements.length!==t.elements.length)return!1
for(let n=0,r=e.elements.length;n<r;++n){const r=e.elements[n],o=t.elements[n]
if(r.groupedUnits.length!==o.groupedUnits.length)return!1
for(let e=0,t=o.groupedUnits.length;e<t;++e)if(!i.X9.areEqual(r.groupedUnits[e],o.groupedUnits[e]))return!1
if(!i.X9.areEqual(r.set,o.set))return!1
if(!s.m.areEqual(r.ranges,o.ranges))return!1}return!0}}(r||(r={}))},47944(e,t,n){"use strict"
function r(e,t){return e[t]|e[t+1]<<8}function i(e,t,n){e[t]=255&n,e[t+1]=n>>8&255}function o(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])}function a(e,t,n){e[t]=255&n,e[t+1]=n>>8&255,e[t+2]=n>>16&255,e[t+3]=n>>24&255}function s(e){return e.length<2?"0"+e:e}function l(e){const t=e.length
let n=0
for(let r=0;r<t;r++){const t=e.charCodeAt(r)
if(4294967168&t)if(4294965248&t)if(4294901760&t){if(4292870144&t)throw new Error("e")
n+=4}else n+=3
else n+=2
else n++}return n}n.d(t,{qQ:()=>$,Aq:()=>q,$1:()=>U})
const c=function(){const e=new Uint32Array(256)
for(let t=0;t<256;t++){let n=t
for(let e=0;e<8;e++)1&n?n=3988292384^n>>>1:n>>>=1
e[t]=n}return e}()
function u(e,t,n){return 4294967295^function(e,t,n,r){for(let i=0;i<r;i++)e=c[255&(e^t[n+i])]^e>>>8
return e}(4294967295,e,t,n)}const d={deflate:void 0,"deflate-raw":void 0,gzip:void 0}
function p(e){if(void 0===d[e])try{new CompressionStream(e),d[e]=!0}catch(t){d[e]=!1}return!!d[e]}const h=function(){const e=Uint16Array,t=Uint32Array
return{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new t(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new t(286),dhst:new t(30),ihst:new t(19),lits:new t(15e3),strt:new e(65536),prev:new e(32768)}}()
function f(e,t,n){const r=e.length,i=h.rev15
for(let o=0;o<r;o+=2)if(0!==e[o+1]){const r=o>>1,a=e[o+1],s=r<<4|a,l=t-a
let c=e[o]<<l
const u=c+(1<<l)
for(;c!==u;)n[i[c]>>>15-t]=s,c++}}function m(e,t){const n=e.length,r=h.bl_count
for(let a=0;a<=t;a++)r[a]=0
for(let a=1;a<n;a+=2)r[e[a]]++
const i=h.next_code
let o=0
r[0]=0
for(let a=1;a<=t;a++)o=o+r[a-1]<<1,i[a]=o
for(let a=0;a<n;a+=2){const t=e[a+1]
0!==t&&(e[a]=i[t],i[t]++)}}function g(e,t){const n=h.rev15,r=15-t
for(let i=0;i<e.length;i+=2){const o=e[i]<<t-e[i+1]
e[i]=n[o]>>>r}}function y(e,t){const{data:n,noBuf:r}=e
let{buf:i,BFINAL:o,off:a,pos:s}=e,l=0
for(;0===o&&l<t;){let e,t,c=0,u=0
o=_(n,s,1),l+=1
const d=_(n,s+1,2)
if(s+=3,0===d){7&s&&(s+=8-(7&s))
const e=(s>>>3)+4,t=n[e-4]|n[e-3]<<8
r&&(i=v(i,a+t)),i.set(new Uint8Array(n.buffer,n.byteOffset+e,t),a),s=e+t<<3,a+=t
continue}if(r&&(i=v(i,a+(1<<17))),1===d)e=h.flmap,t=h.fdmap,c=511,u=31
else{if(2!==d)throw new Error(`unknown BTYPE ${d}`)
{const r=S(n,s,5)+257,i=S(n,s+5,5)+1,o=S(n,s+10,4)+4
s+=14
for(let e=0;e<38;e+=2)h.itree[e]=0,h.itree[e+1]=0
let a=1
for(let e=0;e<o;e++){const t=S(n,s+3*e,3)
h.itree[1+(h.ordr[e]<<1)]=t,t>a&&(a=t)}s+=3*o,m(h.itree,a),f(h.itree,a,h.imap),e=h.lmap,t=h.dmap,s=b(h.imap,(1<<a)-1,r+i,n,s,h.ttree)
const l=x(h.ttree,0,r,h.ltree)
c=(1<<l)-1
const d=x(h.ttree,r,i,h.dtree)
u=(1<<d)-1,m(h.ltree,l),f(h.ltree,l,e),m(h.dtree,d),f(h.dtree,d,t)}}for(;;){const o=e[C(n,s)&c]
s+=15&o
const l=o>>>4
if(l>>>8==0)i[a++]=l
else{if(256===l)break
{let e=a+l-254
if(l>264){const t=h.ldef[l-257]
e=a+(t>>>3)+S(n,s,7&t),s+=7&t}const o=t[C(n,s)&u]
s+=15&o
const c=o>>>4,d=h.ddef[c],p=(d>>>4)+_(n,s,15&d)
for(s+=15&d,r&&(i=v(i,a+(1<<17)));a<e;)i[a]=i[a++-p],i[a]=i[a++-p],i[a]=i[a++-p],i[a]=i[a++-p]
a=e}}}}e.buf=i,e.BFINAL=o,e.off=a,e.pos=s}function v(e,t){const n=e.length
if(t<=n)return e
const r=new Uint8Array(Math.max(n<<1,t))
return r.set(e,0),r}function b(e,t,n,r,i,o){let a=0
for(;a<n;){const n=e[C(r,i)&t]
i+=15&n
const s=n>>>4
if(s<=15)o[a]=s,a++
else{let e=0,t=0
16===s?(t=3+S(r,i,2),i+=2,e=o[a-1]):17===s?(t=3+S(r,i,3),i+=3):18===s&&(t=11+S(r,i,7),i+=7)
const n=a+t
for(;a<n;)o[a]=e,a++}}return i}function x(e,t,n,r){let i=0,o=0
const a=r.length>>>1
for(;o<n;){const n=e[o+t]
r[o<<1]=0,r[1+(o<<1)]=n,n>i&&(i=n),o++}for(;o<a;)r[o<<1]=0,r[1+(o<<1)]=0,o++
return i}function S(e,t,n){return(e[t>>>3]|e[(t>>>3)+1]<<8)>>>(7&t)&(1<<n)-1}function _(e,t,n){return(e[t>>>3]|e[(t>>>3)+1]<<8|e[(t>>>3)+2]<<16)>>>(7&t)&(1<<n)-1}function C(e,t){return(e[t>>>3]|e[(t>>>3)+1]<<8|e[(t>>>3)+2]<<16)>>>(7&t)}!function(){for(let t=0;t<32768;t++){let e=t
e=(2863311530&e)>>>1|(1431655765&e)<<1,e=(3435973836&e)>>>2|(858993459&e)<<2,e=(4042322160&e)>>>4|(252645135&e)<<4,e=(4278255360&e)>>>8|(16711935&e)<<8,h.rev15[t]=(e>>>16|e<<16)>>>17}function e(e,t,n){for(;0!==t--;)e.push(0,n)}for(let t=0;t<32;t++)h.ldef[t]=h.of0[t]<<3|h.exb[t],h.ddef[t]=h.df0[t]<<4|h.dxb[t]
e(h.fltree,144,8),e(h.fltree,112,9),e(h.fltree,24,7),e(h.fltree,8,8),m(h.fltree,9),f(h.fltree,9,h.flmap),g(h.fltree,9),e(h.fdtree,32,5),m(h.fdtree,5),f(h.fdtree,5,h.fdmap),g(h.fdtree,5),e(h.itree,19,0),e(h.ltree,286,0),e(h.dtree,30,0),e(h.ttree,320,0)}()
var w=n(91229)
function T(e,t,n){const r=[],i=e.length,o=t.length
for(let f=0;f<o;f+=2)t[f]=0,t[f+1]=0
for(let f=0;f<i;f++)0!==e[f]&&r.push({lit:f,f:e[f],d:void 0})
const a=r.length,s=r.slice(0)
if(0===a)return 0
if(1===a){const e=r[0].lit,n=0===e?1:0
return t[1+(e<<1)]=1,t[1+(n<<1)]=1,1}r.sort(function(e,t){return e.f-t.f})
let l=r[0],c=r[1],u=0,d=1,p=2
for(r[0]={lit:-1,f:l.f+c.f,l:l,r:c,d:0};d!==a-1;)l=u!==d&&(p===a||r[u].f<r[p].f)?r[u++]:r[p++],c=u!==d&&(p===a||r[u].f<r[p].f)?r[u++]:r[p++],r[d++]={lit:-1,f:l.f+c.f,l:l,r:c,d:void 0}
let h=A(r[d-1],0)
h>n&&(function(e,t,n){let r=0,i=0
const o=1<<n-t
for(e.sort(function(e,t){return t.d===e.d?e.f-t.f:t.d-e.d}),r=0;r<e.length&&e[r].d>t;r++){const a=e[r].d
e[r].d=t,i+=o-(1<<n-a)}for(i>>>=n-t;i>0;){const n=e[r].d
n<t?(e[r].d++,i-=1<<t-n-1):r++}for(;r>=0;r--)e[r].d===t&&i<0&&(e[r].d--,i++)
0!==i&&console.log("debt left")}(s,n,h),h=n)
for(let f=0;f<a;f++)t[1+(s[f].lit<<1)]=s[f].d
return h}function A(e,t){return-1!==e.lit?(e.d=t,t):Math.max(A(e.l,t+1),A(e.r,t+1))}function I(e,t){const{data:n,dlen:r,out:i,opt:o}=e
let{i:a,pos:s,cvrd:l,li:c,lc:u,bs:d,ebits:p,c:f,nc:m}=e
const{lits:g,strt:y,prev:v}=h,b=Math.min(a+t,r)
for(;a<b;a++){if(f=m,a+1<r-2){m=k(n,a+1)
const e=a+1&32767
v[e]=y[m],y[m]=e}if(l<=a){(c>14e3||u>26697)&&r-a>100&&(l<a&&(g[c]=a-l,c+=2,l=a),s=D(a===r-1||l===r?1:0,g,c,p,n,d,a-d,i,s),c=u=p=0,d=a)
let e=0
if(a<r-2&&(e=B(n,a,v,f,Math.min(o[2],r-a),o[3])),0!==e){const t=e>>>16,n=65535&e,r=N(t,h.of0)
h.lhst[257+r]++
const i=N(n,h.df0)
h.dhst[i]++,p+=h.exb[r]+h.dxb[i],g[c]=t<<23|a-l,g[c+1]=n<<16|r<<8|i,c+=2,l=a+t}else h.lhst[n[a]]++
u++}}e.i=a,e.pos=s,e.cvrd=l,e.li=c,e.lc=u,e.bs=d,e.ebits=p,e.c=f,e.nc=m}const P=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]]
function B(e,t,n,r,i,o){let a=32767&t,s=n[a],l=a-s+32768&32767
if(s===a||r!==k(e,t-l))return 0
let c=0,u=0
const d=Math.min(32767,t)
for(;l<=d&&0!==--o&&s!==a;){if(0===c||e[t+c]===e[t+c-l]){let r=E(e,t,l)
if(r>c){if(c=r,u=l,c>=i)break
l+2<r&&(r=l+2)
let e=0
for(let i=0;i<r-2;i++){const r=t-l+i+32768&32767,o=r-n[r]+32768&32767
o>e&&(e=o,s=r)}}}a=s,s=n[a],l+=a-s+32768&32767}return c<<16|u}function E(e,t,n){if(e[t]!==e[t-n]||e[t+1]!==e[t+1-n]||e[t+2]!==e[t+2-n])return 0
const r=t,i=Math.min(e.length,t+258)
for(t+=3;t<i&&e[t]===e[t-n];)t++
return t-r}function k(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535}function D(e,t,n,r,i,o,a,s,l){h.lhst[256]++
const[c,u,d,p,f,y,v,b]=function(){const e=T(h.lhst,h.ltree,15),t=T(h.dhst,h.dtree,15),n=[],r=L(h.ltree,n),i=[],o=L(h.dtree,i)
for(let l=0;l<n.length;l+=2)h.ihst[n[l]]++
for(let l=0;l<i.length;l+=2)h.ihst[i[l]]++
const a=T(h.ihst,h.itree,7)
let s=19
for(;s>4&&0===h.itree[1+(h.ordr[s-1]<<1)];)s--
return[e,t,a,r,o,s,n,i]}(),x=32+(l+3&7?8-(l+3&7):0)+(a<<3),S=r+R(h.fltree,h.lhst)+R(h.fdtree,h.dhst)
let _=r+R(h.ltree,h.lhst)+R(h.dtree,h.dhst)
_+=14+3*y+R(h.itree,h.ihst)+(2*h.ihst[16]+3*h.ihst[17]+7*h.ihst[18])
for(let m=0;m<286;m++)h.lhst[m]=0
for(let m=0;m<30;m++)h.dhst[m]=0
for(let m=0;m<19;m++)h.ihst[m]=0
const C=x<S&&x<_?0:S<_?1:2
if(j(s,l,e),j(s,l+1,C),l+=3,0===C){for(;7&l;)l++
l=M(i,o,a,s,l)}else{let e,r
if(1===C)e=h.fltree,r=h.fdtree
else if(2===C){m(h.ltree,c),g(h.ltree,c),m(h.dtree,u),g(h.dtree,u),m(h.itree,d),g(h.itree,d),e=h.ltree,r=h.dtree,z(s,l,p-257),z(s,l+=5,f-1),z(s,l+=5,y-4),l+=4
for(let e=0;e<y;e++)z(s,l+3*e,h.itree[1+(h.ordr[e]<<1)])
l+=3*y,l=O(v,h.itree,s,l),l=O(b,h.itree,s,l)}else(0,w.dr)(C)
let a=o
for(let o=0;o<n;o+=2){const n=t[o],c=n>>>23,u=a+(8388607&n)
for(;a<u;)l=F(i[a++],e,s,l)
if(0!==c){const n=t[o+1],i=n>>16,u=n>>8&255,d=255&n
z(s,l=F(257+u,e,s,l),c-h.of0[u]),j(s,l=F(d,r,s,l+=h.exb[u]),i-h.df0[d]),l+=h.dxb[d],a+=c}}l=F(256,e,s,l)}return l}function M(e,t,n,r,i){let o=i>>>3
return r[o]=n,r[o+1]=n>>>8,r[o+2]=255-r[o],r[o+3]=255-r[o+1],o+=4,r.set(new Uint8Array(e.buffer,t,n),o),i+(n+4<<3)}function R(e,t){let n=0
for(let r=0;r<t.length;r++)n+=t[r]*e[1+(r<<1)]
return n}function O(e,t,n,r){for(let i=0;i<e.length;i+=2){const o=e[i],a=e[i+1]
r=F(o,t,n,r)
const s=16===o?2:17===o?3:7
o>15&&(z(n,r,a),r+=s)}return r}function L(e,t){let n=e.length
for(;2!==n&&0===e[n-1];)n-=2
for(let r=0;r<n;r+=2){const i=e[r+1],o=r+3<n?e[r+3]:-1,a=r+5<n?e[r+5]:-1,s=0===r?-1:e[r-1]
if(0===i&&o===i&&a===i){let o=r+5
for(;o+2<n&&e[o+2]===i;)o+=2
const a=Math.min(o+1-r>>>1,138)
a<11?t.push(17,a-3):t.push(18,a-11),r+=2*a-2}else if(i===s&&o===i&&a===i){let o=r+5
for(;o+2<n&&e[o+2]===i;)o+=2
const a=Math.min(o+1-r>>>1,6)
t.push(16,a-3),r+=2*a-2}else t.push(i,0)}return n>>>1}function N(e,t){let n=0
return t[16|n]<=e&&(n|=16),t[8|n]<=e&&(n|=8),t[4|n]<=e&&(n|=4),t[2|n]<=e&&(n|=2),t[1|n]<=e&&(n|=1),n}function F(e,t,n,r){return j(n,r,t[e<<1]),r+t[1+(e<<1)]}function z(e,t,n){n<<=7&t
const r=t>>>3
e[r]|=n,e[r+1]|=n>>>8}function j(e,t,n){n<<=7&t
const r=t>>>3
e[r]|=n,e[r+1]|=n>>>8,e[r+2]|=n>>>16}var V=n(70292)
async function U(e,t,n=!1){const i=Object.create(null),a=new Uint8Array(t)
if(19280!==r(a,0))throw new Error('Invalid ZIP file. A valid ZIP file must start with two magic bytes \\x50\\x4b ("PK" in ASCII).')
let s=a.length-4
for(;101010256!==o(a,s);)s--
let l=s
l+=4,l+=4
const c=r(a,l)
l+=2,l+=2,l+=4
const u=o(a,l)
l+=4,l=u
for(let d=0;d<c;d++){l+=4,l+=4,l+=4,l+=4,l+=4,l+=4,l+=4
const t=r(a,l),s=r(a,l+2),c=r(a,l+4)
l+=6,l+=8
const u=o(a,l)
l+=4,l+=t+s+c,await G(e,a,u,i,n)}return i}async function G(e,t,n,i,a){n+=4,n+=2
const l=r(t,n+=2)
n+=2,n+=4
const c=o(t,n+=4),u=o(t,n+=4),d=r(t,n+=4),p=r(t,n+=2),h=function(e,t,n){let r,i=""
for(let o=0;o<n;o++)i+="%"+s(e[t+o].toString(16))
try{r=decodeURIComponent(i)}catch(r){return function(e,t,n){let r=""
for(let i=0;i<n;i++)r+=String.fromCharCode(e[t+i])
return r}(e,t,n)}return r}(t,n+=2,d)
if(n+=d,n+=p,a)return void(i[h]={size:u,csize:c})
const f=new Uint8Array(t.buffer,n,c)
if(0===l)i[h]=f
else{if(8!==l)throw new Error(`unknown compression method: ${l}`)
{const t=new Uint8Array(u)
await H(e,f,t),i[h]=t}}}async function H(e,t,n){return async function(e,t,n){if(3===t[0]&&0===t[1])return n||new Uint8Array(0)
if(p("deflate-raw")){const r=new DecompressionStream("deflate-raw"),i=new Blob([t]).stream().pipeThrough(r)
let o=0
const a=[],s=i.getReader(),l=async()=>{const{done:t,value:r}=await s.read()
if(!t)return e.shouldUpdate&&await e.update({message:"Inflating blocks...",current:o,max:null==n?void 0:n.length}),n?n.set(r,o):a.push(r),o+=r.length,l()}
if(await l(),!n){n=new Uint8Array(o)
for(let e=0,t=0;e<a.length;e++)n.set(a[e],t),t+=a[e].length}return n}const r=function(e,t){const n=void 0===t
return void 0===t&&(t=new Uint8Array(e.length>>>2<<3)),{data:e,buf:t,noBuf:n,BFINAL:0,off:0,pos:0}}(t,n)
for(;0===r.BFINAL;)e.shouldUpdate&&await e.update({message:"Inflating blocks...",current:r.pos,max:t.length}),y(r,100)
return r.buf.length===r.off?r.buf:r.buf.slice(0,r.off)}(e,t,n)}async function q(e,t,n){const i=t[3]
let a=10
if(4&i&&(a+=r(t,a)),8&i){let e=a
for(;0!==t[e];)++e
a=e+1}if(16&i){let e=a
for(;0!==t[e];)++e
a=e+1}1&i&&(a+=2)
const s=0|o(t,t.length-8),l=o(t,t.length-4)
void 0===n&&(n=new Uint8Array(l))
const c=new Uint8Array(t.buffer,t.byteOffset+a,t.length-a-8),d=await H(e,c,n)
return s!==u(d,0,d.length)&&console.error("ungzip: checksums don't match"),d}async function Q(e,t,n){void 0===n&&(n={level:6})
const r=new Uint8Array(50+Math.floor(1.1*t.length)),i=await async function(e,t,n,r,i){if(p("deflate-raw")){const r=new CompressionStream("deflate-raw"),i=new Blob([t]).stream().pipeThrough(r).getReader()
let o=0
const a=async()=>{const{done:t,value:r}=await i.read()
if(!t)return e.shouldUpdate&&await e.update({message:"Deflating...",current:o,max:n.length}),n.set(r,o),o+=r.length,a()}
return await a(),o}const o=function(e,t,n,r){const{lits:i,strt:o,prev:a}=h
return{data:e,out:t,opt:P[r],i:0,pos:0,cvrd:0,dlen:e.length,li:0,lc:0,bs:0,ebits:0,c:0,nc:0,lits:i,strt:o,prev:a}}(t,n,0,i),{dlen:a}=o
if(0===i){let{i:e,pos:r}=o
for(;e<a;){const i=Math.min(65535,a-e)
z(n,r,e+i===a?1:0),r=M(t,e,i,n,r+8),e+=i}return r>>>3}for(a>2&&(o.nc=k(t,0),o.strt[o.nc]=0);o.i<a;)e.shouldUpdate&&await e.update({message:"Deflating...",current:o.i,max:a}),I(o,1048576)
let{li:s,cvrd:l,pos:c}=o
const{i:u,lits:d,bs:f,ebits:m}=o
for(f===u&&0!==t.length||(l<u&&(d[s]=u-l,s+=2,l=u),c=D(1,d,s,m,t,f,u-f,n,c));7&c;)c++
return c>>>3}(e,t,r,0,n.level)
return new Uint8Array(r.buffer,0,i)}function $(e,t=!1){return V.Task.create("Zip",n=>async function(e,t,n=!1){let r=0
const o={}
for(const i in t){const r=!X(i)&&!n,a=t[i],s=u(a,0,a.length)
o[i]={cpr:r,usize:a.length,crc:s,file:r?await Q(e,a):a}}for(const i in o)r+=o[i].file.length+30+46+2*l(i)
r+=22
const s=new Uint8Array(r)
let c=0
const d=[]
for(const i in o){const e=o[i]
d.push(c),c=W(s,c,i,e,0)}let p=0
const h=c
for(const i in o){const e=o[i]
d.push(c),c=W(s,c,i,e,1,d[p++])}const f=c-h
return a(s,c,101010256),c+=4,c+=4,i(s,c,p),c+=2,i(s,c,p),c+=2,a(s,c,f),c+=4,a(s,c,h),c+=4,c+=2,s.buffer}(n,e,t))}function X(e){const t=e.split(".").pop().toLowerCase()
return-1!=="png,jpg,jpeg,zip".indexOf(t)}function W(e,t,n,r,o,s=0){const c=r.file
a(e,t,0===o?67324752:33639248),t+=4,1===o&&(t+=2),i(e,t,20),i(e,t+=2,0),i(e,t+=2,r.cpr?8:0),a(e,t+=2,0),a(e,t+=4,r.crc),a(e,t+=4,c.length),a(e,t+=4,r.usize),i(e,t+=4,l(n)),i(e,t+=2,0),t+=2,1===o&&(t+=2,t+=2,a(e,t+=6,s),t+=4)
const u=function(e,t,n){const r=n.length
let i=0
for(let o=0;o<r;o++){const r=n.charCodeAt(o)
if(4294967168&r)if(4294965248&r)if(4294901760&r){if(4292870144&r)throw new Error("e")
e[t+i]=240|r>>18,e[t+i+1]=128|r>>12&63,e[t+i+2]=128|r>>6&63,e[t+i+3]=128|63&r,i+=4}else e[t+i]=224|r>>12,e[t+i+1]=128|r>>6&63,e[t+i+2]=128|63&r,i+=3
else e[t+i]=192|r>>6,e[t+i+1]=128|63&r,i+=2
else e[t+i]=r,i++}return i}(e,t,n)
return t+=u,0===o&&(e.set(c,t),t+=c.length),t}},47954(e,t,n){"use strict"
n.r(t),n.d(t,{StructureFocusRepresentation:()=>S,StructureFocusRepresentationTags:()=>v})
var r=n(72996),i=n(7773),o=n(48393),a=n(58070),s=n(33241),l=n(41428),c=n(99302),u=n(43472),d=n(55165),p=n(92384),h=n(15382),f=n(13564),m=n(64299),g=n(19231)
const y=["target","surroundings","interactions"]
var v
!function(e){e.TargetSel="structure-focus-target-sel",e.TargetRepr="structure-focus-target-repr",e.SurrSel="structure-focus-surr-sel",e.SurrRepr="structure-focus-surr-repr",e.SurrNciRepr="structure-focus-surr-nci-repr"}(v||(v={}))
const b=new Set([v.TargetSel,v.TargetRepr,v.SurrSel,v.SurrRepr,v.SurrNciRepr])
class x extends l.AF.WithSubscribers{constructor(){super(...arguments),this.currentSource=void 0}get surrLabel(){return`[Focus] Surroundings (${this.params.expandRadius} )`}getReprParams(e){return{...e,type:{name:e.type.name,params:{...e.type.params,ignoreHydrogens:this.params.ignoreHydrogens,ignoreHydrogensVariant:this.params.ignoreHydrogensVariant,ignoreLight:this.params.ignoreLight,material:this.params.material,clip:this.params.clip,interior:this.params.interior}}}}ensureShape(e){var t
const n=this.plugin.state.data,i=n.tree,a=n.build(),l=u.QX.findUniqueTagsInSubtree(i,e.transform.ref,b)
l[v.TargetSel]||(l[v.TargetSel]=a.to(e).apply(s.f.Model.StructureSelectionFromBundle,{bundle:o.StructureElement.Bundle.Empty,label:"[Focus] Target"},{tags:v.TargetSel}).ref),l[v.SurrSel]||(l[v.SurrSel]=a.to(e).apply(s.f.Model.StructureSelectionFromExpression,{expression:c.MolScriptBuilder.struct.generator.empty(),label:this.surrLabel},{tags:v.SurrSel}).ref)
const d=this.params.components
return d.indexOf("target")>=0&&!l[v.TargetRepr]&&(l[v.TargetRepr]=a.to(l[v.TargetSel]).apply(s.f.Representation.StructureRepresentation3D,this.getReprParams(this.params.targetParams),{tags:v.TargetRepr}).ref),d.indexOf("surroundings")>=0&&!l[v.SurrRepr]&&(l[v.SurrRepr]=a.to(l[v.SurrSel]).apply(s.f.Representation.StructureRepresentation3D,this.getReprParams(this.params.surroundingsParams),{tags:v.SurrRepr}).ref),d.indexOf("interactions")>=0&&!l[v.SurrNciRepr]&&e.obj&&r.MH.isApplicable(null===(t=e.obj)||void 0===t?void 0:t.data)&&(l[v.SurrNciRepr]=a.to(l[v.SurrSel]).apply(s.f.Representation.StructureRepresentation3D,this.getReprParams(this.params.nciParams),{tags:v.SurrNciRepr}).ref),{state:n,builder:a,refs:l}}clear(e){const t=this.plugin.state.data
this.currentSource=void 0
const n=t.select(u.QX.Generators.byRef(e).subtree().withTag(v.TargetSel)),r=t.select(u.QX.Generators.byRef(e).subtree().withTag(v.SurrSel))
if(0===n.length&&0===r.length)return
const i=t.build(),a=o.StructureElement.Bundle.Empty
for(const o of n)i.to(o).update(s.f.Model.StructureSelectionFromBundle,e=>({...e,bundle:a}))
const l=c.MolScriptBuilder.struct.generator.empty()
for(const o of r)i.to(o).update(s.f.Model.StructureSelectionFromExpression,e=>({...e,expression:l}))
return h.PluginCommands.State.Update(this.plugin,{state:t,tree:i,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})}async focus(e){const t=this.plugin.helpers.substructureParent.get(e.structure)
if(!t||!t.obj)return
this.currentSource=e
const n=o.StructureElement.Loci.remap(e,t.obj.data),r=o.StructureElement.Loci.extendToWholeResidues(n),i=o.StructureElement.Bundle.fromLoci(r),a=o.StructureElement.Bundle.toExpression(i)
let l=c.MolScriptBuilder.struct.modifier.includeSurroundings({0:a,radius:this.params.expandRadius,"as-whole-residues":!0})
this.params.excludeTargetFromSurroundings&&(l=c.MolScriptBuilder.struct.modifier.exceptBy({0:l,by:a}))
const{state:u,builder:d,refs:p}=this.ensureShape(t)
d.to(p[v.TargetSel]).update(s.f.Model.StructureSelectionFromBundle,e=>({...e,bundle:i})),d.to(p[v.SurrSel]).update(s.f.Model.StructureSelectionFromExpression,e=>({...e,expression:l,label:this.surrLabel})),await h.PluginCommands.State.Update(this.plugin,{state:u,tree:d,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})}register(e){this.subscribeObservable(this.plugin.managers.structure.focus.behaviors.current,e=>{e?this.focus(e.loci):this.clear(u.Cn.RootRef)})}async update(e){const t=this.params
if(this.params=e,t.excludeTargetFromSurroundings!==e.excludeTargetFromSurroundings)return this.currentSource&&this.focus(this.currentSource),!0
const n=this.plugin.state.data,r=n.build(),i=u.QX.Generators.root.subtree(),o=this.params.components
let a=o.indexOf("target")>=0
for(const s of n.select(i.withTag(v.TargetRepr)))a?r.to(s).update(this.getReprParams(this.params.targetParams)):r.delete(s.transform.ref)
a=o.indexOf("surroundings")>=0
for(const s of n.select(i.withTag(v.SurrRepr)))a?r.to(s).update(this.getReprParams(this.params.surroundingsParams)):r.delete(s.transform.ref)
a=o.indexOf("interactions")>=0
for(const s of n.select(i.withTag(v.SurrNciRepr)))a?r.to(s).update(this.getReprParams(this.params.nciParams)):r.delete(s.transform.ref)
return await h.PluginCommands.State.Update(this.plugin,{state:n,tree:r,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}}),e.expandRadius===t.expandRadius||(this.currentSource&&this.focus(this.currentSource),!0)}}const S=l.AF.create({name:"create-structure-focus-representation",display:{name:"Structure Focus Representation"},category:"interaction",ctor:x,params:(e,t)=>(e=>{const t=s.f.Representation.StructureRepresentation3D.definition.params(void 0,e)
return{expandRadius:p.t.Numeric(5,{min:1,max:10,step:1}),targetParams:p.t.Group(t,{label:"Target",customDefault:(0,a.pQ)(e,void 0,{type:"ball-and-stick",size:"physical",typeParams:{sizeFactor:.22,sizeAspectRatio:.73,adjustCylinderLength:!0,xrayShaded:!0,aromaticBonds:!1,multipleBonds:"off",excludeTypes:["hydrogen-bond","metal-coordination"]}})}),surroundingsParams:p.t.Group(t,{label:"Surroundings",customDefault:(0,a.pQ)(e,void 0,{type:"ball-and-stick",size:"physical",typeParams:{sizeFactor:.16,excludeTypes:["hydrogen-bond","metal-coordination"]}})}),nciParams:p.t.Group(t,{label:"Non-covalent Int.",customDefault:(0,a.pQ)(e,void 0,{type:r.MH,color:i.YU,size:d.F.BuiltIn.uniform})}),components:p.t.MultiSelect(y,p.t.arrayToOptions(y)),excludeTargetFromSurroundings:p.t.Boolean(!1,{label:"Exclude Target",description:'Exclude the focus "target" from the surroudings component.'}),ignoreHydrogens:p.t.Boolean(!1),ignoreHydrogensVariant:p.t.Select("all",p.t.arrayToOptions(["all","non-polar"])),ignoreLight:p.t.Boolean(!1),material:f.i.getParam(),clip:p.t.Group(m.B.Params),interior:(0,g.ag)()}})(t)})},48187(e,t,n){"use strict"
n.d(t,{A:()=>r})
var r,i=n(39298),o=n(43472),a=n(70292),s=n(92384),l=n(9043)
!function(e){class t extends(i.O.Create({name:"Root",typeClass:"Root"})){}e.Root=t
class n extends(i.O.Create({name:"Category",typeClass:"Object"})){}e.Category=n
class r extends(i.O.CreateBehavior({name:"Behavior"})){}e.Behavior=r,e.Categories={common:"Common",representation:"Representation",interaction:"Interaction","custom-props":"Custom Properties",misc:"Miscellaneous"},e.CreateCategory=i.H.BuiltIn({name:"create-behavior-category",display:{name:"Behavior Category"},from:t,to:n,params:{label:s.t.Text("",{isHidden:!0})}})({apply:({params:e})=>new n({},{label:e.label})})
const c=new Map
e.getCategoryId=function(e){return c.get(e.id)},e.create=function(e){const n=i.H.CreateBuiltIn({name:e.name,display:e.display,from:[t],to:[r],params:e.params,apply({params:t},n){const i=e.label?e.label(t):{label:e.display.name,description:e.display.description}
return new r(new e.ctor(n,t),i)},update:({b:e,newParams:t})=>a.Task.create("Update Behavior",async()=>e.data.update&&await e.data.update(t)?o.xE.UpdateResult.Updated:o.xE.UpdateResult.Unchanged),canAutoUpdate:e.canAutoUpdate})
return c.set(n.id,e.category),n},e.simpleCommandHandler=function(e,t){return class{register(){this.sub=e.subscribe(this.ctx,e=>t(e,this.ctx))}dispose(){this.sub&&this.sub.unsubscribe(),this.sub=void 0}constructor(e){this.ctx=e,this.sub=void 0}}},e.Handler=class{subscribeCommand(e,t){this.subs.push(e.subscribe(this.ctx,t))}subscribeObservable(e,t){this.subs.push(e.subscribe(t))}track(e){this.subs.push(e)}dispose(){for(const e of this.subs)e.unsubscribe()
this.subs=[]}update(e){return!(0,l.f8)(e,this.params)&&(this.params=e,!0)}constructor(e,t){this.ctx=e,this.params=t,this.subs=[]}},e.WithSubscribers=class{subscribeCommand(e,t){this.subs.push(e.subscribe(this.plugin,t))}subscribeObservable(e,t){const n=e.subscribe(t)
return this.subs.push(n),{unsubscribe:()=>{const e=this.subs.indexOf(n)
e>=0&&(this.subs.splice(e,1),n.unsubscribe())}}}dispose(){for(const e of this.subs)e.unsubscribe()
this.subs=[]}constructor(e,t){this.plugin=e,this.params=t,this.subs=[]}}}(r||(r={}))},48298(e,t,n){"use strict"
n.d(t,{G:()=>d,IU:()=>l,RF:()=>r,cS:()=>p,j1:()=>h,jG:()=>s,p4:()=>c,xA:()=>u})
var r,i=n(24762),o=n(97016),a=n(96883)
function s(e,t){return{name:t,blocks:e}}function l(e,t,n,r=[]){return{categoryNames:e,header:n,categories:t,saveFrames:r,getField(e){const[n,r]=e.split(".")
return t[n].getField(r||"")}}}function c(e,t,n){return{categoryNames:e,header:n,categories:t}}function u(e,t,n,r){return{rowCount:t,name:e,fieldNames:[...n],getField:e=>r[e]}}function d(e,t,n,r){const i=n?0:1
switch(t){case 1:return"brackets"===r?t=>`${e}[${t+i}]`:t=>`${e}_${t+i}`
case 2:return"brackets"===r?(t,n)=>`${e}[${t+i}][${n+i}]`:(t,n)=>`${e}_${t+i}${n+i}`
case 3:return"brackets"===r?(t,n,r)=>`${e}[${t+i}][${n+i}][${r+i}]`:(t,n,r)=>`${e}_${t+i}${n+i}${r+i}`
default:throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.")}}function p(e,t,n,r){const i=t.create()
if(1===t.rank){const o=t.dimensions[0]
for(let a=0;a<o;a++){const o=e.getField(r(a))
t.set(i,a,o?o.float(n):0)}}else if(2===t.rank){const o=t.dimensions[0],a=t.dimensions[1]
for(let s=0;s<o;s++)for(let o=0;o<a;o++){const a=e.getField(r(s,o))
t.set(i,s,o,a?a.float(n):0)}}else{if(3!==t.rank)throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.")
{const o=t.dimensions[0],a=t.dimensions[1],s=t.dimensions[2]
for(let l=0;l<o;l++)for(let o=0;o<a;o++)for(let a=0;a<s;a++){const s=e.getField(r(l,o,a))
t.set(i,l,o,a,s?s.float(n):0)}}}return i}function h(e){let t=0,n=!1,r=0
for(let a=0,s=e.rowCount;a<s;a++){if(e.valueKind(a)!==i.VP.ValueKinds.Present){r++
continue}const s=(0,o.o_)(e.str(a))
if(s!==o.bt.Int){if(s!==o.bt.Float){n=!0
break}t++}}return n||r===e.rowCount?i.VP.Schema.str:t>0?i.VP.Schema.float:i.VP.Schema.int}!function(e){function t(e,t){const n=Object.keys(t)
return{rowCount:n.length>0?t[n[0]].rowCount:0,name:e,fieldNames:n,getField:e=>t[e]}}e.empty=function(e){return{rowCount:0,name:e,fieldNames:[],getField(e){}}},e.ofFields=t,e.ofTable=function(e,n){const i={}
for(const t of n._columns)i[t]=r.ofColumn(n[t])
return t(e,i)}}(u||(u={})),function(e){function t(e){const t=e.length,n=t=>{const n=e[t]
return n&&"."!==n&&"?"!==n?n:""},r=t=>{const n=e[t]
return(0,o.H9)(n,0,n.length)||0},a=t=>{const n=e[t]
return(0,o.sS)(n,0,n.length)||0}
return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:t,str:n,int:r,float:a,valueKind:t=>{const n=e[t],r=n.length
if(r>1)return i.VP.ValueKinds.Present
if(0===r)return i.VP.ValueKinds.NotPresent
const o=n.charCodeAt(0)
return 46===o?i.VP.ValueKinds.NotPresent:63===o?i.VP.ValueKinds.Unknown:i.VP.ValueKinds.Present},areValuesEqual:(t,n)=>e[t]===e[n],toStringArray:r=>r?i.iu.createAndFillArray(t,n,r):e,toIntArray:e=>i.iu.createAndFillArray(t,r,e),toFloatArray:e=>i.iu.createAndFillArray(t,a,e)}}function n(e){const{rowCount:t,valueKind:n,areValuesEqual:r,isDefined:a}=e
let s,l,c
switch(e.schema.valueType){case"float":case"int":s=t=>""+e.value(t),l=e.value,c=e.value
break
case"str":s=e.value,l=t=>{const n=e.value(t)
return(0,o.H9)(n,0,n.length)||0},c=t=>{const n=e.value(t)
return(0,o.sS)(n,0,n.length)||0}
break
case"list":const{separator:t}=e.schema
s=n=>e.value(n).join(t),l=e=>NaN,c=e=>NaN
break
default:throw new Error(`unsupported valueType '${e.schema.valueType}'`)}return{__array:void 0,binaryEncoding:void 0,isDefined:a,rowCount:t,str:s,int:l,float:c,valueKind:n,areValuesEqual:r,toStringArray:e=>i.iu.createAndFillArray(t,s,e),toIntArray:e=>i.iu.createAndFillArray(t,l,e),toFloatArray:e=>i.iu.createAndFillArray(t,c,e)}}e.ofString=function(e){return t([e])},e.ofStrings=t,e.ofNumbers=function(e){const t=e.length,n=t=>""+e[t],r=t=>e[t],o=n=>!n||n.array&&e instanceof n.array?e:i.iu.createAndFillArray(t,r,n)
return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:t,str:n,int:r,float:r,valueKind:e=>i.VP.ValueKinds.Present,areValuesEqual:(t,n)=>e[t]===e[n],toStringArray:e=>i.iu.createAndFillArray(t,n,e),toIntArray:o,toFloatArray:o}},e.ofTokens=function(e){const{data:t,indices:n,count:r}=e,s=e=>{const r=t.substring(n[2*e],n[2*e+1])
return"."===r||"?"===r?"":r},l=e=>(0,o.H9)(t,n[2*e],n[2*e+1])||0,c=e=>(0,o.sS)(t,n[2*e],n[2*e+1])||0
return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:r,str:s,int:l,float:c,valueKind:e=>{const r=n[2*e],o=n[2*e+1]-r
if(o>1)return i.VP.ValueKinds.Present
if(0===o)return i.VP.ValueKinds.NotPresent
const a=t.charCodeAt(r)
return 46===a?i.VP.ValueKinds.NotPresent:63===a?i.VP.ValueKinds.Unknown:i.VP.ValueKinds.Present},areValuesEqual:(0,a.k5)(e),toStringArray:e=>i.iu.createAndFillArray(r,s,e),toIntArray:e=>i.iu.createAndFillArray(r,l,e),toFloatArray:e=>i.iu.createAndFillArray(r,c,e)}},e.ofColumn=n,e.ofUndefined=function(e,t){return n(i.VP.Undefined(e,t))}}(r||(r={}))},48393(e,t,n){"use strict"
n.r(t),n.d(t,{ArrayTrajectory:()=>l.P,Bond:()=>a.gn,CifExportContext:()=>a.yj,Coordinates:()=>r.E,IndexedCustomProperty:()=>o.iY,Model:()=>o.Kx,Queries:()=>s.RT,QueryContext:()=>s.cY,Structure:()=>a.oE,StructureElement:()=>a.iZ,StructureProperties:()=>a.ZP,StructureQuery:()=>s.Oz,StructureSelection:()=>s.cv,StructureSequence:()=>o.VP,StructureSymmetry:()=>a.us,Symmetry:()=>o.vw,Time:()=>r.g,Topology:()=>i.c,Types:()=>o.Or,Unit:()=>a.Nf,UnitRing:()=>a.X$,UnitRings:()=>a.gE,encode_mmCIF_categories:()=>a.jB,mmCIF_Export_Filters:()=>a._9,to_mmCIF:()=>a.rs})
var r=n(1496),i=n(76515),o=n(94050),a=n(44688),s=n(44195),l=n(94603)},48475(e,t,n){"use strict"
n.d(t,{$:()=>s,w:()=>a})
var r=n(92384),i=n(50709),o=n(88524)
const a={customText:r.t.Text("",{label:"Text",description:"Override the label with custom value.",isEssential:!0}),textColor:r.t.Color(i.ColorNames.black,{isEssential:!0}),textSize:r.t.Numeric(.5,{min:.1,max:10,step:.1},{isEssential:!0})},s={...o.E.Params,...a,borderWidth:r.t.Numeric(.2,{min:0,max:.5,step:.01})}},48559(e,t,n){"use strict"
n.r(t),n.d(t,{BoxShape3D:()=>h,getBoxMesh:()=>f})
var r=n(10596),i=n(83794),o=n(71545),a=n(14294),s=n(32775),l=n(79111),c=n(70292),u=n(50709),d=n(92384),p=n(39298)
const h=p.H.BuiltIn({name:"box-shape-3d",display:"Box Shape",from:p.O.Root,to:p.O.Shape.Provider,params:{bottomLeft:d.t.Vec3((0,s.eB)()),topRight:d.t.Vec3(s.eB.create(1,1,1)),radius:d.t.Numeric(.15,{min:.01,max:4,step:.01}),color:d.t.Color(u.ColorNames.red)}})({canAutoUpdate:()=>!0,apply:({params:e})=>c.Task.create("Shape Representation",async t=>new p.O.Shape.Provider({label:"Box",data:e,params:r.e.Params,getShape:(t,n)=>{const r=f(a.DJ.create(e.bottomLeft,e.topRight),e.radius)
return l.y.create("Box",n,r,()=>n.color,()=>1,()=>"Box")},geometryUtils:r.e.Utils},{label:"Box"}))})
function f(e,t,n){const r=s.eB.sub((0,s.eB)(),e.max,e.min),l=s.$I.fromTranslation((0,s.$I)(),s.eB.create(.5,.5,.5)),c=s.$I.fromScaling((0,s.$I)(),r),u=s.$I.fromTranslation((0,s.$I)(),e.min),d=s.$I.mul3((0,s.$I)(),u,c,l),p=i.P.createState(256,128,n)
p.currentGroup=1,i.P.addCage(p,d,(0,o.UC)(),t,2,20)
const h=i.P.getMesh(p),f=s.eB.scaleAndAdd((0,s.eB)(),e.min,r,.5),m=s.eB.distance(e.min,f)
return h.setBoundingSphere(a.f8.create(f,m)),h}},48589(e,t,n){"use strict"
function r([e]){return Math.cosh(e)}n.r(t),n.d(t,{cosh:()=>r,default:()=>i})
var i=(0,n(10336).helper)(r)},48604(e,t,n){"use strict"
n.d(t,{P:()=>r})
var r,i=n(58558)
!function(e){e.Impl=class{get current(){return this._current}set current(e){this._current=e}getAncestorOfType(e){if(!this._current)return
let t=this._current
for(;;){if(t=this.cells.get(t.transform.parent),!t.obj)return
if(t.obj.type===e.type)return t.obj
if(t.transform.ref===i.C.RootRef)return}}getRootOfType(e){if(!this._current)return
let t,n=this._current
for(;;){if(!n.obj)return
if(n.obj.type===e.type&&(t=n),n.transform.ref===i.C.RootRef)return t?t.obj:void 0
n=this.cells.get(n.transform.parent)}}constructor(e){this.cells=e,this._current=void 0}},e.getDecoratorChain=function(e,t){const n=e.cells
let r=n.get(t)
const i=[r]
for(;null==r?void 0:r.transform.transformer.definition.isDecorator;)r=n.get(r.transform.parent),i.push(r)
return i},e.getRootOfType=function(e,t,n){let r,o=e.cells.get(n)
if(o)for(;;){if(!o.obj)return
if(o.obj.type===t.type&&(r=o),o.transform.ref===i.C.RootRef)return r?r.obj:void 0
o=e.cells.get(o.transform.parent)}}}(r||(r={}))},48861(e,t,n){"use strict"
n.d(t,{h:()=>A})
var r=n(8726),i=n(62618),o=n(20610)
function a(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=!1)
var o=t.schedule(function(){n(),i?e.add(this.schedule(null,r)):this.unsubscribe()},r)
if(e.add(o),!i)return o}var s=n(91660),l=n(18891)
function c(e,t,n){return void 0===n&&(n=1/0),(0,l.T)(t)?c(function(n,o){return(0,r.T)(function(e,r){return t(n,e,o,r)})((0,i.Tg)(e(n,o)))},n):("number"==typeof t&&(n=t),(0,o.N)(function(t,r){return function(e,t,n,r){var o=[],a=0,l=0,c=!1,u=function(){!c||o.length||a||t.complete()},d=function(e){a++
var c=!1;(0,i.Tg)(n(e,l++)).subscribe((0,s._)(t,function(e){t.next(e)},function(){c=!0},void 0,function(){if(c)try{a--
for(var e=function(){var e=o.shift()
d(e)};o.length&&a<r;)e()
u()}catch(e){t.error(e)}}))}
return e.subscribe((0,s._)(t,function(e){return a<r?d(e):o.push(e)},function(){c=!0,u()})),function(){}}(t,r,e,n)}))}var u=n(83569),d=n(39419),p=n(66706)
function h(e){return e[e.length-1]}function f(e,t){return void 0===t&&(t=0),(0,o.N)(function(n,r){n.subscribe((0,s._)(r,function(n){return a(r,e,function(){return r.next(n)},t)},function(){return a(r,e,function(){return r.complete()},t)},function(n){return a(r,e,function(){return r.error(n)},t)}))})}function m(e,t){return void 0===t&&(t=0),(0,o.N)(function(n,r){r.add(e.schedule(function(){return n.subscribe(r)},t))})}var g=n(85404),y=n(81357)
function v(e,t){if(!e)throw new Error("Iterable cannot be null")
return new g.c(function(n){a(n,t,function(){var r=e[Symbol.asyncIterator]()
a(n,t,function(){r.next().then(function(e){e.done?n.complete():n.next(e.value)})},0,!0)})})}var b=n(83939),x=n(97270),S=n(87949),_=n(22153),C=n(30517),w=n(44067),T=n(9336)
function A(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]
var n=function(e){return(0,p.m)(h(e))?e.pop():void 0}(e),r=function(e){return"number"==typeof h(e)?e.pop():1/0}(e),o=e
return o.length?1===o.length?(0,i.Tg)(o[0]):function(e){return void 0===e&&(e=1/0),c(u.D,e)}(r)(function(e,t){return t?function(e,t){if(null!=e){if((0,b.l)(e))return function(e,t){return(0,i.Tg)(e).pipe(m(t),f(t))}(e,t)
if((0,S.X)(e))return function(e,t){return new g.c(function(n){var r=0
return t.schedule(function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())})})}(e,t)
if((0,x.y)(e))return function(e,t){return(0,i.Tg)(e).pipe(m(t),f(t))}(e,t)
if((0,C.T)(e))return v(e,t)
if((0,_.x)(e))return function(e,t){return new g.c(function(n){var r
return a(n,t,function(){r=e[y.l](),a(n,t,function(){var e,t,i
try{t=(e=r.next()).value,i=e.done}catch(e){return void n.error(e)}i?n.complete():n.next(t)},0,!0)}),function(){return(0,l.T)(null==r?void 0:r.return)&&r.return()}})}(e,t)
if((0,T.U)(e))return function(e,t){return v((0,T.C)(e),t)}(e,t)}throw(0,w.L)(e)}(e,t):(0,i.Tg)(e)}(o,n)):d.w}},48866(e,t,n){"use strict"
n.d(t,{G:()=>o})
var r=n(87423),i=n(47546)
function o(){return o.zero()}!function(e){function t(){const e=[.1,0,0]
return e[0]=0,e}e.zero=t,e.create=function(e,n,r){const i=t()
return i[0]=e,i[1]=n,i[2]=r,i},e.set=function(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e},e.hasHue=function(e){return!isNaN(e[0])}
const n=[0,0,0]
e.fromColor=function(e,t){return i.E.toHcl(e,i.E.fromColor(n,t))},e.fromLab=function(e,t){return i.E.toHcl(e,t)}
const o=[0,0,0]
function a(e,t){let[n,i,o]=t
return isNaN(n)&&(n=0),n=(0,r.pu)(n),e[0]=o,e[1]=Math.cos(n)*i,e[2]=Math.sin(n)*i,e}function s(e,t,n){return e[0]=t[0],e[1]=Math.max(0,t[1]+u*n),e[2]=t[2],e}e.toColor=function(e){return i.E.toColor(a(o,e))},e.toLab=a,e.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},e.saturate=s,e.desaturate=function(e,t,n){return s(e,t,-n)}
const l=[0,0,0]
function c(e,t,n){return a(l,t),i.E.toHcl(e,i.E.darken(l,l,n))}e.darken=c,e.lighten=function(e,t,n){return c(e,t,-n)}
const u=18}(o||(o={}))},48905(e,t,n){"use strict"
n.d(t,{OT:()=>l,mQ:()=>c})
var r=n(44688),i=n(97960),o=n(67538),a=n(28721),s=n(24762)
function l(e){const t=function(e){const t=new Set,n=[]
for(const a of e.structures){const e=r.iZ.Location.create(a)
for(const s of a.units){const a=s.conformation.operator
if(!a.suffix||s.kind!==i.N.Kind.Atomic)continue
e.unit=s
const{elements:l}=s,c=o.hT.transientSegments(s.model.atomicHierarchy.chainAtomSegments,l)
for(;c.hasNext;){const i=c.move()
e.element=l[i.start]
const o=r.ZP.chain.label_asym_id(e),s=`${o}${a.suffix}`
if(t.has(s))continue
t.add(s)
const u=r.ZP.chain.label_asym_id(e)
n.push({label_asym_id:o,auth_asym_id:u,operator:a})}}}return n}(e)
if(0!==t.length)return[h,t,{ignoreFilter:!0}]}const c={molstar_atom_site_operator_mapping:{label_asym_id:s.VP.Schema.Str(),auth_asym_id:s.VP.Schema.Str(),operator_name:s.VP.Schema.Str(),suffix:s.VP.Schema.Str(),assembly_id:s.VP.Schema.Str(),assembly_operator_id:s.VP.Schema.Int(),symmetry_operator_index:s.VP.Schema.Int(),symmetry_hkl:s.VP.Schema.Vector(3),ncs_id:s.VP.Schema.Int()}},u=(e,t)=>void 0===t[e].operator.assembly?s.VP.ValueKinds.NotPresent:s.VP.ValueKinds.Present,d=(e,t)=>-1===t[e].operator.spgrOp?s.VP.ValueKinds.NotPresent:s.VP.ValueKinds.Present,p=a.c.fields().str("label_asym_id",(e,t)=>t[e].label_asym_id).str("auth_asym_id",(e,t)=>t[e].auth_asym_id).str("operator_name",(e,t)=>t[e].operator.name).str("suffix",(e,t)=>t[e].operator.suffix).str("assembly_id",(e,t)=>{var n
return(null===(n=t[e].operator.assembly)||void 0===n?void 0:n.id)||""},{valueKind:u}).int("assembly_operator_id",(e,t)=>{var n
return(null===(n=t[e].operator.assembly)||void 0===n?void 0:n.operId)||0},{valueKind:u}).int("symmetry_operator_index",(e,t)=>t[e].operator.spgrOp,{valueKind:d}).vec("symmetry_hkl",[(e,t)=>t[e].operator.hkl[0],(e,t)=>t[e].operator.hkl[1],(e,t)=>t[e].operator.hkl[2]],{valueKind:d}).int("ncs_id",(e,t)=>t[e].operator.ncsId,{valueKind:d}).getFields(),h={name:"molstar_atom_site_operator_mapping",instance:e=>({fields:p,source:[{data:e,rowCount:e.length}]})}},49610(e,t,n){"use strict"
n.d(t,{O:()=>i,W:()=>s})
var r=n(24762)
function i(e,t){const{ihm_model_group:n,ihm_model_group_link:i}=t,o=r.XI.pickRow(i,t=>i.model_id.value(t)===e)
if(o){const e=r.XI.pickRow(n,e=>n.id.value(e)===o.group_id)
if(e)return e.name}return""}function o(e){for(let t=0,n=e.rowCount;t<n;t++)if(e.valueKind(t)===r.VP.ValueKinds.Present)return!0
return!1}function a(e,t,n){e[t].isDefined&&o(e[t])||(e[t]=e[n]),e[n].isDefined&&o(e[n])||(e[n]=e[t])}function s(e){const t=r.XI.ofColumns(e._schema,e)
return a(t,"label_atom_id","auth_atom_id"),a(t,"label_comp_id","auth_comp_id"),a(t,"label_seq_id","auth_seq_id"),a(t,"label_asym_id","auth_asym_id"),a(t,"label_entity_id","label_asym_id"),t}},49622(e,t,n){"use strict"
function r(e){return e.reduce((e,t)=>Number(e)%Number(t))}n.r(t),n.d(t,{default:()=>i,mod:()=>r})
var i=(0,n(10336).helper)(r)},49731(e,t,n){"use strict"
n.r(t),n.d(t,{and:()=>r.default,eq:()=>i.default,gt:()=>o.default,gte:()=>a.default,isArray:()=>s.default,isEmpty:()=>l.isEmpty,isEqual:()=>l.isEqual,lt:()=>c.default,lte:()=>u.default,not:()=>p.default,notEq:()=>d.default,or:()=>h.default,xor:()=>f.default})
var r=n(69024),i=n(70651),o=n(30650),a=n(19379),s=n(14389),l=n(59553),c=n(40685),u=n(69230),d=n(34943),p=n(23692),h=n(93588),f=n(20456)},50081(e,t,n){"use strict"
function r(e,t,n){return(t="symbol"==typeof(r=function(e){if("object"!=typeof e||!e)return e
var t=e[Symbol.toPrimitive]
if(void 0!==t){var n=t.call(e,"string")
if("object"!=typeof n)return n
throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(t))?r:String(r))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e
var r}function i(e,t,n,r){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}function o(e,t,n,r,i){var o={}
return Object.keys(r).forEach(function(e){o[e]=r[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}n.d(t,{_:()=>o,a:()=>i,b:()=>r})},50558(e,t,n){"use strict"
n.d(t,{G:()=>c,j:()=>l})
var r=n(24762),i=n(28721),o=n(87095),a=n(44688),s=n(70012)
function l(e){const t=function(e){const t=[],n=new Set,r=a.iZ.Location.create(),{id:i}=a.ZP.atom,o=[void 0,void 0],l=(e,r)=>{const i=(0,s.bd)(e,r)
n.has(i)||(n.add(i),e>r?t.push({atom_id_1:r,atom_id_2:e,value_order:o[0],type_id:o[1]}):t.push({atom_id_1:e,atom_id_2:r,value_order:o[0],type_id:o[1]}))}
for(const s of e.structures){r.structure=s
for(const e of s.units){if(!a.Nf.isAtomic(e))continue
const{elements:t}=e,{a:n,b:s,edgeProps:c}=e.bonds
r.unit=e
for(let e=0;e<n.length;e++){r.element=t[n[e]]
const a=i(r)
r.element=t[s[e]]
const u=i(r)
p(c.order[e],c.flags[e],o),l(a,u)}}s.interUnitBonds.edges.forEach(e=>{let t=s.unitMap.get(e.unitA)
r.unit=t,r.element=t.elements[e.indexA]
const n=i(r)
t=s.unitMap.get(e.unitB),r.unit=t,r.element=t.elements[e.indexB]
const a=i(r)
p(e.props.order,e.props.flag,o),l(n,a)})}return t.sort((e,t)=>e.atom_id_1!==t.atom_id_1?e.atom_id_1-t.atom_id_1:e.atom_id_2!==t.atom_id_2?e.atom_id_2-t.atom_id_2:0),t}(e)
if(0!==t.length)return[d,t,{ignoreFilter:!0}]}const c={molstar_bond_site:{atom_id_1:r.VP.Schema.int,atom_id_2:r.VP.Schema.int,value_order:r.VP.Schema.Aliased(r.VP.Schema.lstr),type_id:r.VP.Schema.Aliased(r.VP.Schema.lstr)}},u=i.c.fields().int("atom_id_1",(e,t)=>t[e].atom_id_1).int("atom_id_2",(e,t)=>t[e].atom_id_2).str("value_order",(e,t)=>{var n
return null!==(n=t[e].value_order)&&void 0!==n?n:""},{valueKind:(e,t)=>void 0===t[e].value_order?r.VP.ValueKinds.NotPresent:r.VP.ValueKinds.Present}).str("type_id",(e,t)=>{var n
return null!==(n=t[e].type_id)&&void 0!==n?n:""},{valueKind:(e,t)=>void 0===t[e].type_id?r.VP.ValueKinds.NotPresent:r.VP.ValueKinds.Present}).getFields(),d={name:"molstar_bond_site",instance:e=>({fields:u,source:[{data:e,rowCount:e.length}]})}
function p(e,t,n){n[0]=void 0,n[1]=void 0,1===e?n[0]="sing":2===e?n[0]="doub":3===e?n[0]="trip":4===e&&(n[0]="quad"),o.BondType.is(t,o.BondType.Flag.Aromatic)&&(n[0]="arom"),o.BondType.is(t,o.BondType.Flag.Disulfide)?n[1]="disulf":o.BondType.is(t,o.BondType.Flag.Covalent)?n[1]="covale":o.BondType.is(t,o.BondType.Flag.MetallicCoordination)?n[1]="metalc":o.BondType.is(t,o.BondType.Flag.HydrogenBond)&&(n[1]="hydrog")}},50690(e,t,n){"use strict"
n.d(t,{$X:()=>i,B8:()=>p,Hm:()=>c,IS:()=>u,LH:()=>h,M0:()=>o,nZ:()=>a,q9:()=>s,tZ:()=>l,z7:()=>d})
var r=n(87095)
function i(e,t){return e.model.atomicHierarchy.atoms.type_symbol.value(e.elements[t])}function o(e,t){return e.model.atomicHierarchy.atoms.pdbx_formal_charge.value(e.elements[t])}function a(e,t){return e.model.atomicHierarchy.atoms.label_atom_id.value(e.elements[t])}function s(e,t){return e.model.atomicHierarchy.atoms.label_alt_id.value(e.elements[t])}function l(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(e.elements[t])}function c(e,t,n){return function(e,t,n){let i=0
const o=e.interUnitBonds.getEdgeIndices(n,t.id)
for(let a=0,s=o.length;a<s;++a){const t=e.interUnitBonds.edges[o[a]]
r.BondType.isCovalent(t.props.flag)&&(i+=1)}return i}(e,t,n)+function(e,t){let n=0
const{offset:i,edgeProps:{flags:o}}=e.bonds
for(let a=i[t],s=i[t+1];a<s;++a)r.BondType.isCovalent(o[a])&&(n+=1)
return n}(t,n)}function u(e,t,n,r){let o=0
return h(e,t,n,(e,t)=>{i(e,t)===r&&(o+=1)}),o}function d(e,t,n,i,o){return t===i?function(e,t,n){const{offset:i,b:o,edgeProps:{flags:a}}=e.bonds
r.BondType.is
for(let s=i[t],l=i[t+1];s<l;++s)if(o[s]===n&&r.BondType.isCovalent(a[s]))return!0
return!1}(t,n,o):function(e,t,n,i,o){const a=e.interUnitBonds.getEdge(n,t.id,o,i.id)
return a&&r.BondType.isCovalent(a.props.flag)}(e,t,n,i,o)}function p(e,t,n){const{offset:i,b:o,edgeProps:{flags:a}}=e.bonds
for(let s=i[t],l=i[t+1];s<l;++s)r.BondType.isCovalent(a[s])&&n(e,o[s])}function h(e,t,n,i){!function(e,t,n,i){const o=e.interUnitBonds.getEdgeIndices(n,t.id)
for(let a=0,s=o.length;a<s;++a){const t=e.interUnitBonds.edges[o[a]],n=e.unitMap.get(t.unitB)
r.BondType.isCovalent(t.props.flag)&&i(n,t.indexB)}}(e,t,n,i),p(t,n,i)}n(67538)},50709(e,t,n){"use strict"
n.r(t),n.d(t,{ColorNames:()=>r,ColorNamesValueMap:()=>i})
const r=(0,n(45996)._j)({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflower:6591981,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,laserlemon:16777044,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrod:16448210,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,maroon2:8323072,maroon3:11546720,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,purple2:8323199,purple3:10494192,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074}),i=function(){const e=new Map
return Object.keys(r).forEach(t=>{e.set(r[t],t)}),e}()},50730(e,t,n){"use strict"
function r([e]){return Math.abs(e)}n.r(t),n.d(t,{abs:()=>r,default:()=>i})
var i=(0,n(10336).helper)(r)},51089(e,t,n){"use strict"
function r([e]){return Math.log1p(e)}n.r(t),n.d(t,{default:()=>i,log1p:()=>r})
var i=(0,n(10336).helper)(r)},51177(e,t,n){"use strict"
function r([e]){return Math.ceil(e)}n.r(t),n.d(t,{ceil:()=>r,default:()=>i})
var i=(0,n(10336).helper)(r)},51445(e,t,n){"use strict"
n.d(t,{q7:()=>u,qg:()=>d})
var r=n(70292),i=n(10196),o=n(42248),a=n(87852),s=n(22219)
function l(e){switch(e){case 0:return s.RW.Int8
case 1:return s.RW.Int16
case 2:return s.RW.Float32
case 3:throw new Error("mode 3 unsupported, complex 16-bit integers")
case 4:throw new Error("mode 4 unsupported, complex 32-bit reals")
case 6:s.RW.Uint16
case 16:throw new Error("mode 16 unsupported, unsigned char * 3 (for rgb data, non-standard)")}throw new Error(`unknown mode '${e}'`)}function c(e){return-128===e.userFlag1&&127===e.userFlag2}function u(e){return c(e)?s.RW.Float32:l(e.MODE)}function d(e,t){return n=o.L.fromBuffer(a.N.fromUint8Array(e),t),e.length,r.Task.create("Parse CCP4/MRC/MAP",async e=>{try{return i.H.success(await async function(e,t,n){await n.update({message:"Parsing CCP4/MRC/MAP file..."})
const{header:r,littleEndian:i}=await async function(e){const{buffer:t}=await e.readBuffer(0,1024),n=String.fromCharCode(t.readUInt8(208),t.readUInt8(209),t.readUInt8(210),t.readUInt8(211))
if("MAP "!==n)throw new Error('ccp4 format error, missing "MAP " string')
const r=[t.readUInt8(212),t.readUInt8(213)]
let i=!1
68===r[0]&&65===r[1]?i=!0:17===r[0]&&17===r[1]?i=!1:t.readInt32LE(12)<=16&&(i=!0)
const o=i?e=>t.readInt32LE(4*e):e=>t.readInt32BE(4*e),a=i?e=>t.readFloatLE(4*e):e=>t.readFloatBE(4*e)
return{header:{NC:o(0),NR:o(1),NS:o(2),MODE:o(3),NCSTART:o(4),NRSTART:o(5),NSSTART:o(6),NX:o(7),NY:o(8),NZ:o(9),xLength:a(10),yLength:a(11),zLength:a(12),alpha:a(13),beta:a(14),gamma:a(15),MAPC:o(16),MAPR:o(17),MAPS:o(18),AMIN:a(19),AMAX:a(20),AMEAN:a(21),ISPG:o(22),NSYMBT:o(23),LSKFLG:o(24),SKWMAT:[],SKWTRN:[],userFlag1:o(39),userFlag2:o(40),originX:a(49),originY:a(50),originZ:a(51),MAP:n,MACHST:r,ARMS:a(54)},littleEndian:i}}(e),o=function(e){return 1024+e.NSYMBT}(r),a=l(r.MODE),d=u(r),p=r.NC*r.NR*r.NS,h=p*(0,s.SV)(a),f=(0,s.tM)(p,d)
return async function(e,t,n,r,i,o){if(c(e)){const o=3*i
await n.readBuffer(r,t.readBuffer,i,o)
const a=new Int8Array(t.valuesBuffer.buffer,o),s=(e.AMAX-e.AMIN)/255,l=.5*(e.AMIN+e.AMAX+s)
for(let e=0,n=i;e<n;++e)t.values[e]=s*a[e]+l}else await(0,s.ye)(t,n,r,i,0,o)}(r,f,e,o,h,i),{header:r,values:f.values,name:e.name}}(n,0,e))}catch(e){return i.H.error(e)}})
var n}},51473(e,t,n){"use strict"
n.d(t,{V:()=>r})
var r,i=n(24762),o=n(75386)
!function(e){const t={byEntityKey:{},sequences:[]}
function n(...e){const t=[],n={}
for(let r=0,i=e.length;r<i;++r)t.push(...e[r].sequences),Object.assign(n,e[r].byEntityKey)
return{sequences:t,byEntityKey:n}}function r(e,t){const{label_comp_id:n}=t.atoms,{label_seq_id:r}=t.residues,{chainAtomSegments:a,residueAtomSegments:s}=t,{count:l,offsets:c}=a,u={},d=[]
if(1===l&&0===c[0]&&0===c[1])return{byEntityKey:u,sequences:d}
for(let p=0,h=t.chains._rowCount;p<h;p++){const a=t.index.getEntityFromChain(p)
if(void 0!==u[a]||"polymer"!==e.data.type.value(a))continue
const l=p
for(p++;p<h&&a===t.index.getEntityFromChain(p)&&"polymer"!==e.data.type.value(a);)p++
p--
const f=s.index[c[l]],m=s.index[c[p+1]-1]+1,g=i.VP.window(r,f,m),y=[]
for(let e=f;e<m;++e)y.push(n.value(s.offsets[e]))
const v=i.VP.ofStringArray(y)
u[a]={entityId:e.data.id.value(a),sequence:o.g.ofResidueNames(v,g)},d.push(u[a])}return{byEntityKey:u,sequences:d}}function a(e,t){return n(s(e,t.spheres),s(e,t.gaussians))}function s(e,t){const{chainElementSegments:n,seq_id_begin:r,seq_id_end:a}=t,{count:s,offsets:l}=n,c={},u=[]
if(1===s&&0===l[0]&&0===l[1])return{byEntityKey:c,sequences:u}
for(let d=0,p=s;d<p;d++){const n=t.getEntityFromChain(d)
if(void 0!==c[n])continue
const s=d
for(d++;d<p&&n===t.getEntityFromChain(d);)d++
d--
const h=l[s],f=l[d+1]-1,m=i.VP.window(r,h,f),g=i.VP.window(a,h,f)
c[n]={entityId:e.data.id.value(n),sequence:o.g.ofSequenceRanges(m,g)},u.push(c[n])}return{byEntityKey:c,sequences:u}}e.fromHierarchy=function(e,i,o){return n(r(e,i),o.isDefined?a(e,o):t)},e.fromAtomicHierarchy=r,e.fromCoarseHierarchy=a,e.fromCoarseElements=s}(r||(r={}))},51520(e,t,n){"use strict"
n.d(t,{PO:()=>a,nE:()=>o})
var r=n(33241),i=n(41736)
const o="Topology",a=[["psf",(0,i.N)({label:"PSF",description:"PSF",category:o,stringExtensions:["psf"],parse:async(e,t)=>{const n=e.state.data.build().to(t).apply(r.f.Data.ParsePsf,{},{state:{isGhost:!0}}),i=n.apply(r.f.Model.TopologyFromPsf)
return await n.commit(),{format:n.selector,topology:i.selector}}})],["prmtop",(0,i.N)({label:"PRMTOP",description:"PRMTOP",category:o,stringExtensions:["prmtop","parm7"],parse:async(e,t)=>{const n=e.state.data.build().to(t).apply(r.f.Data.ParsePrmtop,{},{state:{isGhost:!0}}),i=n.apply(r.f.Model.TopologyFromPrmtop)
return await n.commit(),{format:n.selector,topology:i.selector}}})],["top",(0,i.N)({label:"TOP",description:"TOP",category:o,stringExtensions:["top"],parse:async(e,t)=>{const n=e.state.data.build().to(t).apply(r.f.Data.ParseTop,{},{state:{isGhost:!0}}),i=n.apply(r.f.Model.TopologyFromTop)
return await n.commit(),{format:n.selector,topology:i.selector}}})]]},52057(e,t,n){"use strict"
n.d(t,{D:()=>a})
var r=n(20321),i=n(63317),o=n(37411)
function a(){return a.zero()}!function(e){function t(){return{min:(0,o.e)(),max:(0,o.e)()}}function n(e,t){return o.e.copy(e.min,t.min),o.e.copy(e.max,t.max),e}e.create=function(e,t){return{min:e,max:t}},e.zero=t,e.copy=n,e.set=function(e,t,n){return o.e.copy(e.min,t),o.e.copy(e.max,n),e},e.clone=function(e){return n(t(),e)}
const a=(0,o.e)()
function s(e,t){for(let n=0,r=t.length;n<r;n++)p(e,t[n])
return e}function l(e,t){return d(e),s(e,t),e}function c(e,t){return o.e.sub(e,t.max,t.min)}e.fromSphere3D=function(e,t){return i.f.hasExtrema(t)&&t.extrema.length>=14?l(e,t.extrema):(o.e.set(a,t.radius,t.radius,t.radius),o.e.sub(e.min,t.center,a),o.e.add(e.max,t.center,a),e)},e.addVec3Array=s,e.fromVec3Array=l,e.addSphere3D=function(e,t){return i.f.hasExtrema(t)&&t.extrema.length>=14?s(e,t.extrema):(p(e,o.e.subScalar(a,t.center,t.radius)),p(e,o.e.addScalar(a,t.center,t.radius)),e)},e.addBox3D=function(e,t){return p(e,t.min),p(e,t.max),e},e.intersectsSphere3D=function(e,t){return o.e.clamp(a,t.center,e.min,e.max),o.e.squaredDistance(a,t.center)<=t.radius*t.radius},e.computeBounding=function(e){const t=o.e.create(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=o.e.create(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),{x:i,y:a,z:s,indices:l}=e
for(let o=0,c=r.C.size(l);o<c;o++){const e=r.C.getAt(l,o)
t[0]=Math.min(i[e],t[0]),t[1]=Math.min(a[e],t[1]),t[2]=Math.min(s[e],t[2]),n[0]=Math.max(i[e],n[0]),n[1]=Math.max(a[e],n[1]),n[2]=Math.max(s[e],n[2])}return{min:t,max:n}},e.size=c
const u=(0,o.e)()
function d(e){return o.e.set(e.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),o.e.set(e.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),e}function p(e,t){return o.e.min(e.min,e.min,t),o.e.max(e.max,e.max,t),e}e.volume=function(e){return c(u,e),u[0]*u[1]*u[2]},e.setEmpty=d,e.add=p,e.expand=function(e,t,n){return o.e.sub(e.min,t.min,n),o.e.add(e.max,t.max,n),e},e.expandUniformly=function(e,t,n){return o.e.subScalar(e.min,t.min,n),o.e.addScalar(e.max,t.max,n),e},e.scale=function(e,t,n){return o.e.scale(e.min,t.min,n),o.e.scale(e.max,t.max,n),e}
const h=(0,o.e)()
e.transform=function(e,t,n){const[r,i,a]=t.min,[s,l,c]=t.max
return d(e),p(e,o.e.transformMat4(h,o.e.set(h,r,i,a),n)),p(e,o.e.transformMat4(h,o.e.set(h,r,i,c),n)),p(e,o.e.transformMat4(h,o.e.set(h,r,l,a),n)),p(e,o.e.transformMat4(h,o.e.set(h,r,l,c),n)),p(e,o.e.transformMat4(h,o.e.set(h,s,i,a),n)),p(e,o.e.transformMat4(h,o.e.set(h,s,i,c),n)),p(e,o.e.transformMat4(h,o.e.set(h,s,l,a),n)),p(e,o.e.transformMat4(h,o.e.set(h,s,l,c),n)),e},e.containsVec3=function(e,t){return!(t[0]<e.min[0]||t[0]>e.max[0]||t[1]<e.min[1]||t[1]>e.max[1]||t[2]<e.min[2]||t[2]>e.max[2])},e.overlaps=function(e,t){return!(e.max[0]<t.min[0]||e.min[0]>t.max[0]||e.max[1]<t.min[1]||e.min[1]>t.max[1]||e.max[2]<t.min[2]||e.min[2]>t.max[2])},e.containsSphere3D=function(e,t){const n=t.center,r=t.radius
return!(n[0]-r<e.min[0]||n[0]+r>e.max[0]||n[1]-r<e.min[1]||n[1]+r>e.max[1]||n[2]-r<e.min[2]||n[2]+r>e.max[2])},e.center=function(e,t){return o.e.center(e,t.max,t.min)},e.exactEquals=function(e,t){return o.e.exactEquals(e.min,t.min)&&o.e.exactEquals(e.max,t.max)},e.equals=function(e,t){return o.e.equals(e.min,t.min)&&o.e.equals(e.max,t.max)}}(a||(a={}))},52095(e,t,n){"use strict"
n.d(t,{y$:()=>d,WC:()=>h,cq:()=>c})
var r=n(28074),i=n(54749),o=n(12288),a=n(25602),s=n(38981)
const l=(0,n(45996).qM)([["black",0],["gray",8421504],["white",16777215],["red",13840661],["orange",14840576],["yellow",16565248],["green",6863872],["cyan",1484197],["blue",40160],["purple",8086783],["magenta",16394495],["violet",8200583]])
class c extends a.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!!this.props.param.isExpanded||!!this.props.hideNameRow,lightness:0},this.toggleExpanded=e=>{this.setState({isExpanded:!this.state.isExpanded}),e.currentTarget.blur()},this.onClickSwatch=e=>{const t=i.Color.fromHexString(e.currentTarget.getAttribute("data-color")||"0")
t!==this.props.value&&(this.props.param.isExpanded||this.setState({isExpanded:!1}),this.update(t))},this.onR=e=>{const[,t,n]=i.Color.toRgb(this.props.value),r=i.Color.fromRgb(e,t,n)
r!==this.props.value&&this.update(r)},this.onG=e=>{const[t,,n]=i.Color.toRgb(this.props.value),r=i.Color.fromRgb(t,e,n)
r!==this.props.value&&this.update(r)},this.onB=e=>{const[t,n]=i.Color.toRgb(this.props.value),r=i.Color.fromRgb(t,n,e)
r!==this.props.value&&this.update(r)},this.onRGB=e=>{const t=i.Color.fromHexStyle(e.currentTarget.value||"0")
t!==this.props.value&&this.update(t)},this.onLighten=()=>{this.update(i.Color.lighten(this.props.value,.1))},this.onDarken=()=>{this.update(i.Color.darken(this.props.value,.1))}}update(e){this.props.onChange({param:this.props.param,name:this.props.name,value:e})}swatch(){return(0,r.jsx)("div",{className:"msp-combined-color-swatch",children:l.map(e=>(0,r.jsx)(s.$n,{inline:!0,"data-color":e[1],onClick:this.onClickSwatch,style:{background:i.Color.toStyle(e[1])}},e[1]))})}render(){const e=this.props.param.label||(0,o.Hh)(this.props.name),[t,n,a]=i.Color.toRgb(this.props.value),l=(0,r.jsxs)(r.Fragment,{children:[this.swatch(),(0,r.jsx)(s.eJ,{label:"RGB",className:"msp-control-label-short",control:(0,r.jsxs)("div",{style:{display:"flex",textAlignLast:"center",left:"80px"},children:[(0,r.jsx)(s.ks,{onChange:this.onR,numeric:!0,value:t,delayMs:250,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0}),(0,r.jsx)(s.ks,{onChange:this.onG,numeric:!0,value:n,delayMs:250,style:{order:2,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0}),(0,r.jsx)(s.ks,{onChange:this.onB,numeric:!0,value:a,delayMs:250,style:{order:3,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0}),(0,r.jsx)("input",{onInput:this.onRGB,type:"color",value:i.Color.toHexStyle(this.props.value),style:{order:4,flex:"1 1 auto",minWidth:"32px",width:"32px",height:"32px",padding:"0 2px 0 2px",background:"none",border:"none",cursor:"pointer"}})]})}),(0,r.jsxs)("div",{style:{display:"flex",textAlignLast:"center"},children:[(0,r.jsx)(s.$n,{onClick:this.onLighten,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control",children:"Lighten"}),(0,r.jsx)(s.$n,{onClick:this.onDarken,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control",children:"Darken"})]})]})
return this.props.hideNameRow?l:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.eJ,{title:this.props.param.description,label:e,control:(0,r.jsx)(s.$n,{onClick:this.toggleExpanded,inline:!0,className:"msp-combined-color-button",style:{background:i.Color.toStyle(this.props.value)}})}),this.state.isExpanded&&(0,r.jsx)("div",{className:"msp-control-offset",children:l})]})}}let u
function d(){return u||(u=(0,r.jsx)(r.Fragment,{children:l.map(e=>(0,r.jsx)("option",{value:e[1],style:{background:`${i.Color.toStyle(e[1])}`},children:(0,o.Mk)(e[0])},e[1]))}),u)}const p=function(){const e=new Map
for(const t of l)e.set(t[1],t[0])
return e}()
function h(e){return p.has(e)?null:(0,r.jsx)("option",{value:e,style:{background:`${i.Color.toStyle(e)}`},children:i.Color.toRgbString(e)},i.Color.toHexString(e))}},52234(e,t,n){"use strict"
n.d(t,{f:()=>i})
var r=n(76513),i={setTimeout:function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o]
var a=i.delegate
return(null==a?void 0:a.setTimeout)?a.setTimeout.apply(a,(0,r.fX)([e,t],(0,r.zs)(n))):setTimeout.apply(void 0,(0,r.fX)([e,t],(0,r.zs)(n)))},clearTimeout:function(e){var t=i.delegate
return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0}},52338(e,t,n){"use strict"
function r(e){return Math.min(...e)}n.r(t),n.d(t,{default:()=>i,min:()=>r})
var i=(0,n(10336).helper)(r)},52349(e,t,n){"use strict"
n.d(t,{X:()=>U})
var r=n(41059),i=n(95472),o=n(42988),a=n(88434)
const s=[]
function l(e){return[e]}function c(e){return e}function u(e){return(0,o.eh)(e),e}function d(e,t){if(t<e)return[]
const n=new Int32Array(t-e+1)
for(let r=e;r<=t;r++)n[r-e]=r
return n}function p(e){return e&&(Array.isArray(e)||!!e.buffer)}function h(e){return e[e.length-1]-e[0]+1===e.length}function f(e){return e[0]}function m(e){return e[e.length-1]+1}function g(e){return e[0]}function y(e){return e[e.length-1]}function v(e){return e.length}function b(e){const t=e.length
return t?t>2?(0,i.hX)(t,e[0],e[t-1],e[t>>1]):(0,i.CP)(t,e[0],e[t-1]):0}function x(e){const t=e.length
return t>5?`[${e[0]}, ${e[1]}, ..., ${e[t-1]}], length ${t}`:`[${e.join(", ")}]`}function S(e,t){const n=e.length
return 0===n?-1:e[0]<=t&&t<=e[n-1]?B(e,t,0,n):-1}function _(e,t,n){return C(e,t,a.I.start(n),a.I.end(n))}function C(e,t,n,r){return 0===e.length||r<=n?-1:e[n]<=t&&t<=e[r-1]?B(e,t,n,r):-1}function w(e,t){return S(e,t)>=0}function T(e,t){if(e===t)return!0
let n=e.length
if(n!==t.length||e[0]!==t[0]||e[n-1]!==t[n-1])return!1
if(h(e))return!0
n--
for(let r=1;r<n;r++)if(e[r]!==t[r])return!1
return!0}function A(e,t){return E(e,t,0,e.length)}function I(e,t,n){return E(e,t,a.I.start(n),a.I.end(n))}function P(e,t,n){return a.I.ofBounds(A(e,t),A(e,n+1))}function B(e,t,n,r){let i=n,o=r-1
for(;i<=o;){if(i+11>o){for(let n=i;n<=o;n++)if(t===e[n])return n
return-1}const n=i+o>>1,r=e[n]
if(t<r)o=n-1
else{if(!(t>r))return n
i=n+1}}return-1}function E(e,t,n,r){if(n===r)return n
if(e[n]>=t)return n
if(e[r-1]<t)return r
let i=n,o=r
for(;o-i>4;){const n=i+o>>1
e[n]>=t?o=n:i=n+1}for(let a=i;a<o;a++)if(e[a]>=t)return a
return o}function k(e,t){if(e===t)return!0
let{startI:n,startJ:r,endI:i,endJ:o}=V(e,t)
for(;n<i&&r<o;){const i=e[n],o=t[r]
if(i<o)n++
else{if(!(i>o))return!0
r++}}return!1}function D(e,t){if(e===t)return!0
const n=t.length
let{startI:r,startJ:i,endI:o,endJ:a}=V(e,t)
if(a-i<n||o-r<n)return!1
let s=0
for(;r<o&&i<a;){const n=e[r],o=t[i]
n<o?r++:n>o?i++:(r++,i++,s++)}return s===n}function M(e,t){if(e===t)return e
const n=e.length,r=t.length
if(0===n)return t
if(0===r)return e
if(e[0]>t[0])return M(t,e)
const{startI:i,startJ:o,endI:a,endJ:s}=V(e,t),l=O(e,t,i,o,a,s)
if(l===n&&l===r||l===r)return e
if(l===n)return t
const c=new Int32Array(n+r-l)
let u=0,d=0,p=0
for(u=0;u<i;u++)c[p++]=e[u]
for(;d<s&&e[i]>t[d];)c[p++]=t[d++]
for(;u<a&&d<s;){const n=e[u],r=t[d]
n<r?(c[p++]=n,u++):n>r?(c[p++]=r,d++):(c[p++]=n,u++,d++)}for(;u<a;u++)c[p++]=e[u]
for(;d<s;d++)c[p++]=t[d]
for(;u<n;u++)c[p++]=e[u]
for(;d<r;d++)c[p++]=t[d]
return c}function R(e,t){if(e===t)return v(e)
const{startI:n,startJ:r,endI:i,endJ:o}=V(e,t)
return O(e,t,n,r,i,o)}function O(e,t,n,r,i,o){let a=n,s=r,l=0
for(;a<i&&s<o;){const n=e[a],r=t[s]
n<r?a++:n>r?s++:(a++,s++,l++)}return l}function L(e,t){if(e===t)return e
const{startI:n,startJ:r,endI:i,endJ:o}=V(e,t),a=O(e,t,n,r,i,o),l=e.length,c=t.length
if(!a)return s
if(a===l&&a===c||a===c)return t
if(a===l)return e
const u=new Int32Array(a)
let d=0,p=n,h=r
for(;p<i&&h<o;){const n=e[p],r=t[h]
n<r?p++:(n>r||(u[d++]=n,p++),h++)}return u}function N(e,t){if(e===t)return s
const n=e.length,{startI:r,startJ:i,endI:o,endJ:a}=V(e,t)
let l=r,c=i,u=0
for(;l<o&&c<a;){const n=e[l],r=t[c]
n<r?l++:n>r?c++:(l++,c++,u++)}if(!u)return e
if(u>=n)return s
const d=new Int32Array(n-u)
let p=0
for(let s=0;s<r;s++)d[p++]=e[s]
for(l=r,c=i;l<o&&c<a;){const n=e[l],r=t[c]
n<r?(d[p++]=n,l++):(n>r||l++,c++)}for(;l<n;l++)d[p++]=e[l]
return d}function F(e){if(e.length<2)return e
let t=1
for(let i=0,o=e.length-1;i<o;i++)e[i]!==e[i+1]&&t++
if(t===e.length)return e
const n=new Int32Array(t)
let r=0
for(let i=0,o=e.length-1;i<o;i++)e[i]!==e[i+1]&&(n[r++]=e[i])
return n[r]=e[e.length-1],n}function z(e,t){if(T(e,t))return(0,r.vc)(0,e.length-1)
const{startI:n,startJ:i,endI:o,endJ:a}=V(e,t)
let l=n,c=i,u=0
for(;l<o&&c<a;){const n=e[l],r=t[c]
n<r?l++:n>r?c++:(l++,c++,u++)}const d=e.length
if(!u)return s
if(u===d)return(0,r.vc)(0,e.length-1)
const p=new Int32Array(u)
let h=0
for(l=n,c=i;l<o&&c<a;){const n=e[l],r=t[c]
n<r?l++:(n>r||(p[h++]=l,l++),c++)}return p}const j={startI:0,startJ:0,endI:0,endJ:0}
function V(e,t){const n=e.length,r=t.length,i=n/r
return n>=128||r>=128||i<=.34||i>=2.99?(j.startI=A(e,f(t)),j.startJ=A(t,f(e)),j.endI=A(e,m(t)),j.endJ=A(t,m(e))):(j.startI=0,j.startJ=0,j.endI=n,j.endJ=r),j}var U
!function(e){e.Empty=s,e.ofUnsortedArray=u,e.ofSingleton=l,e.ofSortedArray=c,e.ofRange=d,e.ofBounds=(e,t)=>d(e,t-1),e.is=p,e.isRange=h,e.has=w,e.indexOf=S,e.indexOfInInterval=_,e.indexOfInRange=C,e.start=f,e.end=m,e.min=g,e.max=y,e.size=v,e.hashCode=b,e.toString=x,e.areEqual=T,e.areIntersecting=k,e.isSubset=D,e.union=M,e.intersect=L,e.subtract=N,e.findPredecessorIndex=A,e.findPredecessorIndexInInterval=I,e.findRange=P,e.intersectionSize=R,e.deduplicate=F,e.indicesOf=z}(U||(U={}))},52408(e,t,n){"use strict"
n.d(t,{l:()=>s})
var r=n(89),i=n(54749),o=n(48393),a=n(7928)
function s(e,t){return{kind:e,layers:t}}!function(e){function t(e){return 0===e.layers.length}e.Empty={kind:"empty-loci",layers:[]},e.areEqual=function(e,t){if(0===e.layers.length&&0===t.layers.length)return!0
if(e.layers.length!==t.layers.length)return!1
for(let n=0,i=e.layers.length;n<i;++n){if(e.layers[n].clear!==t.layers[n].clear)return!1
if(e.layers[n].color!==t.layers[n].color)return!1
if(!r.Loci.areEqual(e.layers[n].loci,t.layers[n].loci))return!1}return!0},e.isEmpty=t,e.remap=function(e,t){if("element-loci"===e.kind){const n=[]
for(const r of e.layers){let{loci:e,color:i,clear:a}=r
e=o.StructureElement.Loci.remap(e,t),o.StructureElement.Loci.isEmpty(e)||n.push({loci:e,color:i,clear:a})}return{kind:"element-loci",layers:n}}return e},e.merge=function(e){if(t(e))return e
if("element-loci"===e.kind){const{structure:t}=e.layers[0].loci,n=new Map
let r=o.StructureElement.Loci.none(t)
for(let i=0,s=e.layers.length;i<s;++i){let{loci:t,color:a,clear:l}=e.layers[s-i-1]
if(t=o.StructureElement.Loci.subtract(t,r),r=o.StructureElement.Loci.union(t,r),!o.StructureElement.Loci.isEmpty(t)){const e=l?-1:a
n.has(e)&&(t=o.StructureElement.Loci.union(t,n.get(e))),n.set(e,t)}}const a=[]
return n.forEach((e,t)=>{const n=-1===t,r=n?(0,i.Color)(0):t
a.push({loci:e,color:r,clear:n})}),{kind:"element-loci",layers:a}}return e},e.filter=function(e,n){if(t(e))return e
if("element-loci"===e.kind){const{structure:t}=e.layers[0].loci,r=[]
for(const i of e.layers){let{loci:e,color:a,clear:s}=i
const l=o.StructureElement.Loci.remap(e,n)
e=o.StructureElement.Loci.remap(l,t),o.StructureElement.Loci.isEmpty(e)||r.push({loci:e,color:a,clear:s})}return{kind:"element-loci",layers:r}}return e},e.ofScript=function(e,t){const n=[]
for(let r=0,i=e.length;r<i;++r){const{script:i,color:s,clear:l}=e[r],c=a.Script.toLoci(i,t)
o.StructureElement.Loci.isEmpty(c)||n.push({loci:c,color:s,clear:l})}return{kind:"element-loci",layers:n}},e.ofBundle=function(e,t){const n=[]
for(let r=0,i=e.length;r<i;++r){const{bundle:i,color:a,clear:s}=e[r],l=o.StructureElement.Bundle.toLoci(i,t.root)
n.push({loci:l,color:a,clear:s})}return{kind:"element-loci",layers:n}},e.toBundle=function(e){const t=[]
for(let n=0,r=e.layers.length;n<r;++n){const{loci:r,color:i,clear:a}=e.layers[n],s=o.StructureElement.Bundle.fromLoci(r)
t.push({bundle:s,color:i,clear:a})}return{kind:"element-loci",layers:t}}}(s||(s={}))},52429(e,t,n){"use strict"
n.d(t,{Zv:()=>p,oy:()=>h,t4:()=>c})
var r=n(48393),i=n(54749),o=n(92384),a=n(96561),s=n(93076)
const l=(0,i.Color)(16448250),c={asymId:o.t.Select("auth",o.t.arrayToOptions(["auth","label"])),...(0,a.U)({type:"colors",colorList:"many-distinct"})}
function u(e,t){const n=function(e,t){switch(e.kind){case r.Unit.Kind.Atomic:return"auth"===t?r.StructureProperties.chain.auth_asym_id:r.StructureProperties.chain.label_asym_id
case r.Unit.Kind.Spheres:case r.Unit.Kind.Gaussians:return r.StructureProperties.coarse.asym_id}}(e.unit,t)(e)
return e.structure.root.models.length>1?d(e.unit.model,n):n}function d(e,t){return`${t}|${(r.Model.Index.get(e).value||0)+1}`}function p(e,t){let n,i
if(e.structure){const o=r.StructureElement.Location.create(e.structure.root),s=function(e,t){const n=new Map
for(const i of e.models){const o=r.Model.AsymIdOffset.get(i).value,a=("auth"===t?null==o?void 0:o.auth:null==o?void 0:o.label)||0
let s=0
i.properties.structAsymMap.forEach(({auth_id:r},o)=>{const l="auth"===t?r:o,c=e.models.length>1?d(i,l):l
n.has(c)||(n.set(c,s+a),++s)})}return n}(e.structure.root,t.asymId),c=Array.from(s.keys()),p=e=>c[e],h=(0,a.S)(s.size,t,{valueLabel:p})
i=h.legend,n=e=>{let n
if(r.StructureElement.Location.is(e)){const r=u(e,t.asymId)
n=s.get(r)}else if(r.Bond.isLocation(e)){o.unit=e.aUnit,o.element=e.aUnit.elements[e.aIndex]
const r=u(o,t.asymId)
n=s.get(r)}return void 0===n?l:h.color(n)}}else n=()=>l
return{factory:p,granularity:"group",color:n,props:t,description:"Gives every chain a color based on its `asym_id` value.",legend:i}}const h={name:"chain-id",label:"Chain Id",category:s.N.Chain,factory:p,getParams:function(e){var t
const n=o.t.clone(c)
return(null===(t=e.structure)||void 0===t?void 0:t.models.some(e=>e.coarseHierarchy.isDefined))&&(n.asymId.defaultValue="label"),n},defaultValues:o.t.getDefaultValues(c),isApplicable:e=>!!e.structure}},52813(e,t,n){"use strict"
function r(e){return e.reduce((e,t)=>Number(e)+Number(t))}n.r(t),n.d(t,{add:()=>r,default:()=>i})
var i=(0,n(10336).helper)(r)},53123(e,t,n){"use strict"
n.d(t,{w:()=>u})
var r=n(45996),i=n(1712),o=n(9043),a=n(85032),s=n(52349),l=n(97564)
const c={domain:[0,1],reverse:!1,listOrName:"red-yellow-blue",minLabel:"",maxLabel:""}
var u
!function(e){function t(e,t){const{domain:n,reverse:u,listOrName:d}={...c,...e},p="string"==typeof d?(0,i.JA)(d).list:d,h=u?p.slice().reverse():p
let f=0,m=0,g=0
function y(e,t){m=e,g=t,f=g-m||1}y(n[0],n[1])
const v=(0,o.NT)(e.minLabel,m.toString()),b=(0,o.NT)(e.maxLabel,g.toString())
let x
if(h.every(e=>Array.isArray(e))){const e=[...h]
e.sort((e,t)=>e[1]-t[1])
const n=e.map(e=>e[0]),i=s.X.ofSortedArray(e.map(e=>e[1])),o=n.length-1
switch(t){case"continuous":x=e=>function(e,t,n,i,o,a){const c=(0,l.qE)((e-i)/a,0,1),u=s.X.findPredecessorIndex(n,c)
if(0===u)return t[0]
if(u>o)return t[o]
const d=n[u-1],p=n[u],h=(0,l.qE)((c-d)/(p-d),0,1)
return r.Q1.interpolate(t[u-1],t[u],h)}(e,n,i,m,o,f)
break
case"discrete":x=e=>function(e,t,n,i,o,a){if(0===t.length)return r.Q1.fromRgb(0,0,0)
const c=(0,l.qE)((e-i)/a,0,1),u=s.X.findPredecessorIndex(n,c)
return 0===u?t[0]:u>o?t[o]:t[u]}(e,n,i,m,o,f)}}else switch(t){case"continuous":x=e=>function(e,t,n,i){const o=Math.min(t.length-1,Math.max(0,(e-n)/i*(t.length-1))),a=Math.floor(o),s=t[a],l=t[Math.ceil(o)]
return r.Q1.interpolate(s,l,o-a)}(e,h,m,f)
break
case"discrete":x=e=>function(e,t,n,i,o){if(0===t.length)return r.Q1.fromRgb(0,0,0)
const a=o/t.length
return e<=n?t[0]:e>=i?t[t.length-1]:t[Math.min(t.length-1,Math.floor((e-n)/a))]}(e,h,m,g,f)}return{color:x,colorToArray:(e,t,n)=>{r.Q1.toArray(x(e),t,n)},normalizedColorToArray:(e,t,n)=>{r.Q1.toArrayNormalized(x(e),t,n)},setDomain:y,get legend(){return(0,a.A)(v,b,h)}}}e.create=function(e){return t(e,"continuous")},e.createDiscrete=function(e){return t(e,"discrete")}}(u||(u={}))},53138(e,t,n){"use strict"
n.d(t,{FO:()=>p,Gu:()=>a,OK:()=>s,fE:()=>h})
var r=n(97564),i=n(37411),o=n(17370)
function a(e,t,n){return e=(0,r.qE)(Math.round(e),0,16777215)+1,t[n+2]=e%256,e=Math.floor(e/256),t[n+1]=e%256,e=Math.floor(e/256),t[n]=e%256,t}function s(e,t,n){return 256*Math.floor(e)*256+256*Math.floor(t)+Math.floor(n)-1}const l=255/256,c=i.e.create(16777216,65536,256),u=o.Z.create(l/c[0],l/c[1],l/c[2],.99609375),d=(0,o.Z)()
function p(e,t,n,r){return o.Z.set(d,e/255,t/255,n/255,r/255),o.Z.dot(d,u)}function h(e,t){let n=-1/0
for(let r=0,i=e.length;r<i;r+=t){const t=s(e[r],e[r+1],e[r+2])
t>n&&(n=t)}return n}},54121(e,t,n){"use strict"
function r([e]){return Math.cos(e)}n.r(t),n.d(t,{cos:()=>r,default:()=>i})
var i=(0,n(10336).helper)(r)},54509(e,t,n){"use strict"
n.d(t,{A9:()=>s,K9:()=>r,PR:()=>l,sO:()=>a})
const r={H:1,D:1,T:1,HE:2,LI:3,BE:4,B:5,C:6,N:7,O:8,F:9,NE:10,NA:11,MG:12,AL:13,SI:14,P:15,S:16,CL:17,AR:18,K:19,CA:20,SC:21,TI:22,V:23,CR:24,MN:25,FE:26,CO:27,NI:28,CU:29,ZN:30,GA:31,GE:32,AS:33,SE:34,BR:35,KR:36,RB:37,SR:38,Y:39,ZR:40,NB:41,MO:42,TC:43,RU:44,RH:45,PD:46,AG:47,CD:48,IN:49,SN:50,SB:51,TE:52,I:53,XE:54,CS:55,BA:56,LA:57,CE:58,PR:59,ND:60,PM:61,SM:62,EU:63,GD:64,TB:65,DY:66,HO:67,ER:68,TM:69,YB:70,LU:71,HF:72,TA:73,W:74,RE:75,OS:76,IR:77,PT:78,AU:79,HG:80,TL:81,PB:82,BI:83,PO:84,AT:85,RN:86,FR:87,RA:88,AC:89,TH:90,PA:91,U:92,NP:93,PU:94,AM:95,CM:96,BK:97,CF:98,ES:99,FM:100,MD:101,NO:102,LR:103,RF:104,DB:105,SG:106,BH:107,HS:108,MT:109},i={1:1.1,2:1.4,3:1.81,4:1.53,5:1.92,6:1.7,7:1.55,8:1.52,9:1.47,10:1.54,11:2.27,12:1.73,13:1.84,14:2.1,15:1.8,16:1.8,17:1.75,18:1.88,19:2.75,20:2.31,21:2.3,22:2.15,23:2.05,24:2.05,25:2.05,26:2.05,27:2,28:2,29:2,30:2.1,31:1.87,32:2.11,33:1.85,34:1.9,35:1.83,36:2.02,37:3.03,38:2.49,39:2.4,40:2.3,41:2.15,42:2.1,43:2.05,44:2.05,45:2,46:2.05,47:2.1,48:2.2,49:2.2,50:1.93,51:2.17,52:2.06,53:1.98,54:2.16,55:3.43,56:2.68,57:2.5,58:2.48,59:2.47,60:2.45,61:2.43,62:2.42,63:2.4,64:2.38,65:2.37,66:2.35,67:2.33,68:2.32,69:2.3,70:2.28,71:2.27,72:2.25,73:2.2,74:2.1,75:2.05,76:2,77:2,78:2.05,79:2.1,80:2.05,81:1.96,82:2.02,83:2.07,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:2.4,91:2,92:2.3,93:2,94:2,95:2,96:2,97:2,98:2,99:2,100:2,101:2,102:2,103:2,104:2,105:2,106:2,107:2,108:2,109:2},o={1:1.008,2:4.0026,3:6.94,4:9.0122,5:10.81,6:10.81,7:14.007,8:15.999,9:18.998,10:20.18,11:22.99,12:24.305,13:26.982,14:28.085,15:30.974,16:32.06,17:35.45,18:39.948,19:39.098,20:40.078,21:44.956,22:47.867,23:50.942,24:51.996,25:54.938,26:55.845,27:58.933,28:58.693,29:63.546,30:65.38,31:69.723,32:72.63,33:74.922,34:78.971,35:79.904,36:83.798,37:85.468,38:87.62,39:88.906,40:91.224,41:92.906,42:95.95,43:96.906,44:101.07,45:102.91,46:106.42,47:107.87,48:112.41,49:114.82,50:118.71,51:121.76,52:127.6,53:127.6,54:131.29,55:132.91,56:137.33,57:138.91,58:140.12,59:140.91,60:144.24,61:144.912,62:150.36,63:151.96,64:157.25,65:158.93,66:162.5,67:164.93,68:167.26,69:168.93,70:173.05,71:174.97,72:178.49,73:180.95,74:183.84,75:186.21,76:190.23,77:192.22,78:195.08,79:196.97,80:200.59,81:204.38,82:207.2,83:208.98,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:232.04,91:231.04,92:238.03,93:237.048,94:244.064,95:243.061,96:247.07,97:247.07,98:251.079,99:252.083,100:257.095,101:258.098,102:259.101,103:262.11,104:267.122,105:270.131,106:271.134,107:270.133,108:270.134,109:278.156}
function a(e){const t=r[e]
return void 0===t?1.7:i[t]}function s(e){const t=r[e]
return void 0===t?10.81:o[t]}function l(e){const t=r[e]
return void 0===t?0:t}},54749(e,t,n){"use strict"
n.r(t),n.d(t,{Color:()=>r.Q1,ColorMap:()=>r._j,ColorScale:()=>i.w,ColorTable:()=>r.e})
var r=n(45996),i=n(53123)},55165(e,t,n){"use strict"
n.d(t,{F:()=>x})
var r=n(96174),i=n(3111),o=n(48393),a=n(87933),s=n(92384)
const l={scale:s.t.Numeric(1,{min:.1,max:5,step:.1})}
function c(e,t){return o.Unit.isAtomic(e)?(0,a.sO)(e.model.atomicHierarchy.atoms.type_symbol.value(t)):o.Unit.isSpheres(e)?e.model.coarseConformation.spheres.radius[t]:0}const u={name:"physical",label:"Physical",category:"",factory:function e(t,n){const r=void 0===n.scale?1:n.scale
return{factory:e,granularity:"group",size:function(e){let t
return t=o.StructureElement.Location.is(e)?r*c(e.unit,e.element):o.Bond.isLocation(e)?r*Math.min(c(e.aUnit,e.aUnit.elements[e.aIndex]),c(e.bUnit,e.bUnit.elements[e.bIndex])):1*r,t},props:n,description:"Assigns a physical size, i.e. vdW radius for atoms or given radius for coarse spheres."}},getParams:function(e){return l},defaultValues:s.t.getDefaultValues(l),isApplicable:e=>!!e.structure}
var d=n(9043),p=n(19613)
const h={bfactorFactor:s.t.Numeric(.1,{min:0,max:1,step:.01}),rmsfFactor:s.t.Numeric(.05,{min:0,max:1,step:.01}),baseSize:s.t.Numeric(.2,{min:0,max:2,step:.1})}
function f(e,t,n){return o.Unit.isAtomic(e)?e.model.atomicConformation.B_iso_or_equiv.value(t)*n.bfactorFactor:o.Unit.isSpheres(e)?e.model.coarseConformation.spheres.rmsf[t]*n.rmsfFactor:0}const m={name:"uncertainty",label:"Uncertainty/Disorder",category:"",factory:function e(t,n){return{factory:e,granularity:"group",size:function(e){let t=n.baseSize
return o.StructureElement.Location.is(e)?t+=f(e.unit,e.element,n):o.Bond.isLocation(e)&&(t+=f(e.aUnit,e.aUnit.elements[e.aIndex],n)),t},props:n,description:"Assigns a size reflecting the uncertainty or disorder of an element's position, e.g. B-factor or RMSF, depending on the data availability and experimental technique."}},getParams:function(e){return h},defaultValues:s.t.getDefaultValues(h),isApplicable:e=>!!e.structure&&e.structure.models.some(e=>e.atomicConformation.B_iso_or_equiv.isDefined||e.coarseHierarchy.isDefined)}
var g=n(60939)
const y="Assign size based on the given value of a volume cell. Negative values are made positive.",v={scale:s.t.Numeric(1,{min:.1,max:5,step:.1})},b={name:"volume-value",label:"Volume Value",category:"",factory:function e(t,n){if(t.volume){const{data:r}=t.volume.grid.cells,i=g.f.Cell.isLocation
return{factory:e,granularity:"group",size:e=>i(e)?Math.abs(r[e.cell])*n.scale:0,props:n,description:y}}return{factory:e,granularity:"uniform",size:()=>n.scale,props:n,description:y}},getParams:function(e){return v},defaultValues:s.t.getDefaultValues(v),isApplicable:e=>!!e.volume&&!g.f.Segmentation.get(e.volume)}
var x
!function(e){e.EmptyFactory=()=>e.Empty,e.Empty={factory:e.EmptyFactory,granularity:"uniform",size:()=>1,props:{}},e.areEqual=function(e,t){return e.contextHash===t.contextHash&&e.factory===t.factory&&(0,d.bD)(e.props,t.props)},e.EmptyProvider={name:"",label:"",category:"",factory:e.EmptyFactory,getParams:()=>({}),defaultValues:{},isApplicable:()=>!0},e.createRegistry=function(){return new i.D(e.BuiltIn,e.EmptyProvider)},e.BuiltIn={physical:u,"shape-group":p.Ev,uncertainty:m,uniform:r.kk,"volume-value":b}}(x||(x={}))},55167(e,t,n){"use strict"
function r([e]){return Math.expm1(e)}n.r(t),n.d(t,{default:()=>i,expm1:()=>r})
var i=(0,n(10336).helper)(r)},55920(e,t,n){"use strict"
n.d(t,{U:()=>i})
var r=n(37411)
function i(){return i.create(r.e.create(0,0,0),r.e.create(1,0,0))}!function(e){function t(e,t){return r.e.copy(e.origin,t.origin),r.e.copy(e.direction,t.direction),e}e.create=function(e,t){return{origin:e,direction:t}},e.copy=t,e.clone=function(n){return t(e(),n)},e.targetTo=function(e,t,n){return r.e.copy(e.origin,t.origin),r.e.normalize(e.direction,r.e.sub(e.direction,n,t.origin)),e},e.transform=function(e,t,n){return r.e.transformMat4(e.origin,t.origin,n),r.e.transformDirection(e.direction,t.direction,n),e}
const n=(0,r.e)()
function i(e,t){const{center:i,radius:o}=t,{origin:a,direction:s}=e,l=r.e.sub(n,a,i),c=r.e.dot(s,s),u=2*r.e.dot(l,s),d=u*u-4*c*(r.e.dot(l,l)-o*o)
if(d<0)return-1
const p=(-u-Math.sqrt(d))/(2*c)
return p<0?-1:p}function o(e,t){const{origin:n,direction:r}=e,[i,o,a]=t.min,[s,l,c]=t.max,[u,d,p]=n,h=1/r[0],f=1/r[1],m=1/r[2]
let g,y,v,b,x,S
return h>=0?(g=(i-u)*h,y=(s-u)*h):(g=(s-u)*h,y=(i-u)*h),f>=0?(v=(o-d)*f,b=(l-d)*f):(v=(l-d)*f,b=(o-d)*f),g>b||v>y?-1:(v>g&&(g=v),b<y&&(y=b),m>=0?(x=(a-p)*m,S=(c-p)*m):(x=(c-p)*m,S=(a-p)*m),g>S||x>y?-1:(x>g&&(g=x),S<y&&(y=S),g>=0?g:-1))}e.intersectSphere3D=function(e,t,n){const o=i(t,n)
return!(o<0||(r.e.scaleAndAdd(e,t.origin,t.direction,o),0))},e.isIntersectingSphere3D=function(e,t){return i(e,t)>=0},e.isInsideSphere3D=function(e,t){return r.e.distance(e.origin,t.center)<t.radius},e.intersectBox3D=function(e,t,n){const i=o(t,n)
return!(i<0||(r.e.scaleAndAdd(e,t.origin,t.direction,i),0))},e.isIntersectingBox3D=function(e,t){return o(e,t)>=0}}(i||(i={}))},56294(e,t,n){"use strict"
n.d(t,{Ls:()=>d,Tg:()=>u,X8:()=>o,XH:()=>p,dE:()=>r,lo:()=>a,mO:()=>l,tA:()=>i,y9:()=>h})
var r,i,o,a,s,l,c=n(84512)
!function(e){e.createElementsIndex=function(e,t,n){const r=new Int32Array(n+1),i=new Int32Array(n),o=new Int32Array(n),{members:a,offsets:s}=t
for(let u=0,d=2*e.edgeCount;u<d;++u){const t=e.a[u],n=e.b[u]
if(!(t>n)){for(let e=s[t],n=s[t+1];e<n;++e)++o[a[e]]
for(let e=s[n],t=s[n+1];e<t;++e)++o[a[e]]}}let l=0
for(let u=0;u<n;u++)r[u]=l,l+=o[u]
r[n]=l
const c=new Int32Array(l)
for(let u=0,d=2*e.edgeCount;u<d;++u){const t=e.a[u],n=e.b[u]
if(!(t>n)){for(let e=s[t],n=s[t+1];e<n;++e){const t=a[e]
c[r[t]+i[t]]=u,++i[t]}for(let e=s[n],t=s[n+1];e<t;++e){const t=a[e]
c[r[t]+i[t]]=u,++i[t]}}}return{indices:c,offsets:r}}}(r||(r={}))
class u extends c.Z{getContactIndicesForElement(e,t){return this.elementKeyIndex.get(this.getElementKey(e,t.id))||[]}getElementKey(e,t){return`${e}|${t}`}constructor(e,t){super(e),this.elementKeyIndex=new Map
for(let n=0,r=this.edges.length;n<r;++n){const{unitA:e,indexA:r}=this.edges[n],{offsets:i,members:o}=t.get(e)
for(let t=i[r],a=i[r+1];t<a;++t){const r=this.getElementKey(o[t],e),i=this.elementKeyIndex.get(r)
void 0===i?this.elementKeyIndex.set(r,[n]):i.push(n)}}}}function d(e){switch(e){case o.HydrogenBond:return"Hydrogen Bond"
case o.Hydrophobic:return"Hydrophobic Contact"
case o.HalogenBond:return"Halogen Bond"
case o.Ionic:return"Ionic Interaction"
case o.MetalCoordination:return"Metal Coordination"
case o.CationPi:return"Cation-Pi Interaction"
case o.PiStacking:return"Pi Stacking"
case o.WeakHydrogenBond:return"Weak Hydrogen Bond"
case o.Unknown:return"Unknown Interaction"}}function p(e){switch(e){case a.None:return"None"
case a.PositiveCharge:return"Positive Charge"
case a.NegativeCharge:return"Negative Charge"
case a.AromaticRing:return"Aromatic Ring"
case a.HydrogenDonor:return"Hydrogen Donor"
case a.HydrogenAcceptor:return"Hydrogen Acceptor"
case a.HalogenDonor:return"Halogen Donor"
case a.HalogenAcceptor:return"Halogen Acceptor"
case a.HydrophobicAtom:return"HydrophobicAtom"
case a.WeakHydrogenDonor:return"Weak Hydrogen Donor"
case a.IonicTypePartner:return"Ionic Type Partner"
case a.DativeBondPartner:return"Dative Bond Partner"
case a.TransitionMetal:return"Transition Metal"
case a.IonicTypeMetal:return"Ionic Type Metal"}}function h(e){switch(e){case l.None:return"None"
case l.QuaternaryAmine:return"Quaternary Amine"
case l.TertiaryAmine:return"Tertiary Amine"
case l.Sulfonium:return"Sulfonium"
case l.SulfonicAcid:return"Sulfonic Acid"
case l.Sulfate:return"Sulfate"
case l.Phosphate:return"Phosphate"
case l.Halocarbon:return"Halocarbon"
case l.Guanidine:return"Guanidine"
case l.Acetamidine:return"Acetamidine"
case l.Carboxylate:return"Carboxylate"}}!function(e){e[e.None=0]="None",e[e.Filtered=1]="Filtered"}(i||(i={})),function(e){e[e.Unknown=0]="Unknown",e[e.Ionic=1]="Ionic",e[e.CationPi=2]="CationPi",e[e.PiStacking=3]="PiStacking",e[e.HydrogenBond=4]="HydrogenBond",e[e.HalogenBond=5]="HalogenBond",e[e.Hydrophobic=6]="Hydrophobic",e[e.MetalCoordination=7]="MetalCoordination",e[e.WeakHydrogenBond=8]="WeakHydrogenBond"}(o||(o={})),function(e){e[e.None=0]="None",e[e.PositiveCharge=1]="PositiveCharge",e[e.NegativeCharge=2]="NegativeCharge",e[e.AromaticRing=3]="AromaticRing",e[e.HydrogenDonor=4]="HydrogenDonor",e[e.HydrogenAcceptor=5]="HydrogenAcceptor",e[e.HalogenDonor=6]="HalogenDonor",e[e.HalogenAcceptor=7]="HalogenAcceptor",e[e.HydrophobicAtom=8]="HydrophobicAtom",e[e.WeakHydrogenDonor=9]="WeakHydrogenDonor",e[e.IonicTypePartner=10]="IonicTypePartner",e[e.DativeBondPartner=11]="DativeBondPartner",e[e.TransitionMetal=12]="TransitionMetal",e[e.IonicTypeMetal=13]="IonicTypeMetal"}(a||(a={})),function(e){e[e.None=0]="None",e[e.PositiveCharge=1]="PositiveCharge",e[e.NegativeCharge=2]="NegativeCharge",e[e.AromaticRing=3]="AromaticRing",e[e.HydrogenDonor=4]="HydrogenDonor",e[e.HydrogenAcceptor=5]="HydrogenAcceptor",e[e.HalogenDonor=6]="HalogenDonor",e[e.HalogenAcceptor=7]="HalogenAcceptor",e[e.HydrophobicAtom=8]="HydrophobicAtom",e[e.WeakHydrogenDonor=9]="WeakHydrogenDonor",e[e.IonicTypePartner=10]="IonicTypePartner",e[e.DativeBondPartner=11]="DativeBondPartner",e[e.TransitionMetal=12]="TransitionMetal",e[e.IonicTypeMetal=13]="IonicTypeMetal"}(s||(s={})),function(e){e[e.None=0]="None",e[e.QuaternaryAmine=1]="QuaternaryAmine",e[e.TertiaryAmine=2]="TertiaryAmine",e[e.Sulfonium=3]="Sulfonium",e[e.SulfonicAcid=4]="SulfonicAcid",e[e.Sulfate=5]="Sulfate",e[e.Phosphate=6]="Phosphate",e[e.Halocarbon=7]="Halocarbon",e[e.Guanidine=8]="Guanidine",e[e.Acetamidine=9]="Acetamidine",e[e.Carboxylate=10]="Carboxylate"}(l||(l={}))},56382(e,t,n){"use strict"
n.r(t),n.d(t,{DeflateData:()=>fe,Download:()=>pe,DownloadBlob:()=>he,ImportJson:()=>Pe,ImportString:()=>Ie,LazyVolume:()=>Ee,ParseBlob:()=>ye,ParseCcp4:()=>we,ParseCif:()=>ve,ParseCube:()=>be,ParseDsn6:()=>Te,ParseDx:()=>Ae,ParseJson:()=>Be,ParsePly:()=>Ce,ParsePrmtop:()=>Se,ParsePsf:()=>xe,ParseTop:()=>_e,RawData:()=>me,ReadFile:()=>ge})
var r=n(51445),i=n(89748),o=n(70292),a=n(10196),s=n(42248),l=n(87852)
function c(e){const{xExtent:t,yExtent:n,zExtent:r}=e
return{xBlocks:Math.ceil(t/8),yBlocks:Math.ceil(n/8),zBlocks:Math.ceil(r/8)}}async function u(e,t,n){await n.update({message:"Parsing DSN6/BRIX file..."})
const{header:r,littleEndian:i}=await async function(e){const{buffer:t}=await e.readBuffer(0,512),n=String.fromCharCode.apply(null,t),r=n.startsWith(":-)"),i=r||100===t.readInt16LE(36),o=r?(a=n,{xStart:parseInt(a.substr(10,5)),yStart:parseInt(a.substr(15,5)),zStart:parseInt(a.substr(20,5)),xExtent:parseInt(a.substr(32,5)),yExtent:parseInt(a.substr(38,5)),zExtent:parseInt(a.substr(42,5)),xRate:parseInt(a.substr(52,5)),yRate:parseInt(a.substr(58,5)),zRate:parseInt(a.substr(62,5)),xlen:parseFloat(a.substr(73,10)),ylen:parseFloat(a.substr(83,10)),zlen:parseFloat(a.substr(93,10)),alpha:parseFloat(a.substr(103,10)),beta:parseFloat(a.substr(113,10)),gamma:parseFloat(a.substr(123,10)),divisor:parseFloat(a.substr(138,12)),summand:parseInt(a.substr(155,8)),sigma:parseFloat(a.substr(170,12))}):function(e,t){const n=t?t=>e.readInt16LE(2*t):t=>e.readInt16BE(2*t),r=1/n(17)
return{xStart:n(0),yStart:n(1),zStart:n(2),xExtent:n(3),yExtent:n(4),zExtent:n(5),xRate:n(6),yRate:n(7),zRate:n(8),xlen:n(9)*r,ylen:n(10)*r,zlen:n(11)*r,alpha:n(12)*r,beta:n(13)*r,gamma:n(14)*r,divisor:n(15)/100,summand:n(16),sigma:void 0}}(t,i)
var a
return{header:o,littleEndian:i}}(e),{buffer:o}=await e.readBuffer(512,t-512),{valueCount:a}=function(e){const{xExtent:t,yExtent:n,zExtent:r}=e,{xBlocks:i,yBlocks:o,zBlocks:a}=c(e),s=8*i*o*8*a*8
return{count:s,byteCount:1*s,valueCount:t*n*r}}(r),s=new Float32Array(a)
return await async function(e,t,n,r){r||l.N.flipByteOrderInPlace2(t.buffer)
const{divisor:i,summand:o,xExtent:a,yExtent:s,zExtent:u}=e,{xBlocks:d,yBlocks:p,zBlocks:h}=c(e)
let f=0
for(let l=0;l<h;++l)for(let e=0;e<p;++e)for(let r=0;r<d;++r)for(let c=0;c<8;++c){const d=8*l+c
for(let l=0;l<8;++l){const c=8*e+l
for(let e=0;e<8;++e){const l=8*r+e
if(!(l<a&&c<s&&d<u)){f+=8-e
break}n[(l*s+c)*u+d]=(t[f]-o)/i,++f}}}}(r,o,s,i),{header:r,values:s,name:e.name}}const d=new Set(Object.keys({char:1,uchar:1,short:2,ushort:2,int:4,uint:4,float:4,double:8,int8:1,uint8:1,int16:2,uint16:2,int32:4,uint32:4,float32:4,float64:8}))
function p(e){if(!d.has(e))throw new Error(`unknown ply type '${e}'`)
return e}var h=n(10134),f=n(24762),m=n(96883)
function g(e){switch(e){case"char":case"uchar":case"int8":case"uint8":case"short":case"ushort":case"int16":case"uint16":case"int":case"uint":case"int32":case"uint32":return f.VP.Schema.int
case"float":case"double":case"float32":case"float64":return f.VP.Schema.float}}function y(e,t){const{elements:n,tokenizer:r}=e,{count:i,properties:o}=t,a=o.length,s=[],l=[],c=[],u=new Map
for(let d=0,p=a;d<p;++d){const e=h.tM.create(r.data,2*i)
c.push(e)}for(let d=0,p=i;d<p;++d)for(let e=0,t=a;e<t;++e)h._F.skipWhitespace(r),h._F.markStart(r),h._F.eatValue(r),h.tM.addUnchecked(c[e],r.tokenStart,r.tokenEnd)
for(let d=0,p=a;d<p;++d){const{type:e,name:t}=o[d],n=(0,m.E7)(c[d],g(e))
s.push(t),l.push(e),u.set(t,n)}n.push({kind:"table",rowCount:i,propertyNames:s,propertyTypes:l,getProperty:e=>u.get(e)})}function v(e,t){const{elements:n,tokenizer:r}=e,{count:i,property:o}=t,a=h.tM.create(r.data,2*i*3),s=new Uint32Array(i+1)
let l=0
for(let d=0,p=i;d<p;++d){for(h._F.skipWhitespace(r),h._F.markStart(r);10!==h._F.skipWhitespace(r);)++l,h._F.markStart(r),h._F.eatValue(r),h.tM.addToken(a,r)
s[d+1]=l}const c={entries:[],count:0},u=(0,m.E7)(a,g(o.dataType))
n.push({kind:"list",rowCount:i,name:o.name,type:o.dataType,value:e=>{const t=s[e]+1,n=u.value(t-1)
for(let r=t,i=t+n;r<i;++r)c.entries[r-t]=u.value(r)
return c.count=n,c}})}const{readLine:b,skipWhitespace:x,eatValue:S,eatLine:_,markStart:C}=h._F,w=/\s+/,T=/(^\*|REMARK)*/
async function A(e,t){const{tokenizer:n}=e,r=h.tM.create(n.data,2*t),i=h.tM.create(n.data,2*t),a=h.tM.create(n.data,2*t),s=h.tM.create(n.data,2*t),l=h.tM.create(n.data,2*t),c=h.tM.create(n.data,2*t),u=h.tM.create(n.data,2*t),d=h.tM.create(n.data,2*t),{position:p}=n,g=b(n).trim()
n.position=p
const y=7===g.split(w).length,v=y?6:8,{length:T}=n
let A=0
return await(0,o.chunkedSubtask)(e.runtimeCtx,1e5,void 0,e=>{const o=Math.min(t-A,e)
for(let t=0;t<o;++t){for(let e=0;e<v;++e)if(x(n),C(n),S(n),y)switch(e){case 0:h.tM.addUnchecked(r,n.tokenStart,n.tokenEnd)
break
case 1:h.tM.addUnchecked(a,n.tokenStart,n.tokenEnd)
break
case 2:h.tM.addUnchecked(l,n.tokenStart,n.tokenEnd)
break
case 3:h.tM.addUnchecked(c,n.tokenStart,n.tokenEnd)
break
case 4:h.tM.addUnchecked(u,n.tokenStart,n.tokenEnd)
break
case 5:h.tM.addUnchecked(d,n.tokenStart,n.tokenEnd)}else switch(e){case 0:h.tM.addUnchecked(r,n.tokenStart,n.tokenEnd)
break
case 1:h.tM.addUnchecked(i,n.tokenStart,n.tokenEnd)
break
case 2:h.tM.addUnchecked(a,n.tokenStart,n.tokenEnd)
break
case 3:h.tM.addUnchecked(s,n.tokenStart,n.tokenEnd)
break
case 4:h.tM.addUnchecked(l,n.tokenStart,n.tokenEnd)
break
case 5:h.tM.addUnchecked(c,n.tokenStart,n.tokenEnd)
break
case 6:h.tM.addUnchecked(u,n.tokenStart,n.tokenEnd)
break
case 7:h.tM.addUnchecked(d,n.tokenStart,n.tokenEnd)}_(n),C(n)}return A+=o,o},e=>e.update({message:"Parsing...",current:n.position,max:T})),{count:t,atomId:(0,m.do)(r)(f.VP.Schema.int),segmentName:y?(0,m.do)(a)(f.VP.Schema.str):(0,m.do)(i)(f.VP.Schema.str),residueId:(0,m.do)(a)(f.VP.Schema.int),residueName:y?(0,m.do)(a)(f.VP.Schema.str):(0,m.do)(s)(f.VP.Schema.str),atomName:(0,m.do)(l)(f.VP.Schema.str),atomType:(0,m.do)(c)(f.VP.Schema.str),charge:(0,m.do)(u)(f.VP.Schema.float),mass:(0,m.do)(d)(f.VP.Schema.float)}}async function I(e,t){const{tokenizer:n}=e,r=h.tM.create(n.data,2*t),i=h.tM.create(n.data,2*t),{length:a}=n
let s=0
return await(0,o.chunkedSubtask)(e.runtimeCtx,10,void 0,e=>{const o=Math.min(t-s,e)
for(let t=0;t<o;++t)for(let e=0;e<2;++e)switch(x(n),C(n),S(n),e){case 0:h.tM.addUnchecked(r,n.tokenStart,n.tokenEnd)
break
case 1:h.tM.addUnchecked(i,n.tokenStart,n.tokenEnd)}return s+=o,o},e=>e.update({message:"Parsing...",current:n.position,max:a})),{count:t,atomIdA:(0,m.do)(r)(f.VP.Schema.int),atomIdB:(0,m.do)(i)(f.VP.Schema.int)}}function P(e,t){const n=[]
for(let r=0;r<t;++r){const t=b(e.tokenizer)
n.push(t.replace(T,"").trim())}return n}var B=n(43472),E=n(59455),k=n(92384),D=n(39298),M=n(32372),R=n(32775),O=n(97016)
const L=.529177210859
var N=n(46712),F=n(4800)
function z(e){const t={h:(0,R.eB)()}
let n=0,r=0
const i=/\s+/g
for(;;){const o=h._F.readLine(e)
let a
if(o.startsWith("object 1"))a=o.split(i),t.dim=R.eB.create(parseInt(a[5]),parseInt(a[6]),parseInt(a[7]))
else if(o.startsWith("origin"))a=o.split(i),t.min=R.eB.create(parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]))
else if(o.startsWith("delta"))a=o.split(i),0===r?t.h[0]=parseFloat(a[1]):1===r?t.h[1]=parseFloat(a[2]):2===r&&(t.h[2]=parseFloat(a[3])),r+=1
else if(o.startsWith("object 3")){n+=o.length+1
break}n+=o.length+1}return{header:t,headerByteCount:n}}var j=n(50709),V=n(91229)
const U=Object.keys({NATOM:"",NTYPES:"",NBONH:"",MBONA:"",NTHETH:"",MTHETA:"",NPHIH:"",MPHIA:"",NHPARM:"",NPARM:"",NNB:"",NRES:"",NBONA:"",NTHETA:"",NPHIA:"",NUMBND:"",NUMANG:"",NPTRA:"",NATYP:"",NPHB:"",IFPERT:"",NBPER:"",NGPER:"",NDPER:"",MBPER:"",MGPER:"",MDPER:"",IFBOX:"",NMXRS:"",IFCAP:"",NUMEXTRA:"",NCOPY:""}),{readLine:G,markLine:H,trim:q}=h._F
function Q(e){const{tokenizer:t}=e,n=[]
for(;t.tokenEnd<t.length&&"%"!==t.data.charAt(t.position);){const e=G(t).trim()
e&&n.push(e)}return n}function $(e){const{tokenizer:t}=e,n=Object.create(null)
U.forEach(e=>{n[e]=0})
let r=0
for(;t.tokenEnd<t.length&&"%"!==t.data.charAt(t.position);){const e=G(t),i=Math.min(r+10,32)
for(let t=0;r<i;++t,++r)n[U[r]]=parseInt(e.substring(8*t,8*t+8).trim())}return n}function X(e,t,n,r){const{tokenizer:i}=e,o=h.tM.create(i.data,2*t)
let a=0
for(;i.tokenEnd<i.length&&"%"!==i.data.charAt(i.position);){i.tokenStart=i.position
const e=Math.min(a+n,t)
for(let t=0;a<e;++t,++a){const e=i.position
q(i,i.position,i.position+r),h.tM.addUnchecked(o,i.tokenStart,i.tokenEnd),i.position=e+r}H(i)}return o}const W={nr:f.VP.Schema.Int(),type:f.VP.Schema.Str(),resnr:f.VP.Schema.Int(),residu:f.VP.Schema.Str(),atom:f.VP.Schema.Str(),cgnr:f.VP.Schema.Int(),charge:f.VP.Schema.Float(),mass:f.VP.Schema.Float()},Y={ai:f.VP.Schema.Int(),aj:f.VP.Schema.Int()},Z={compound:f.VP.Schema.Str(),molCount:f.VP.Schema.Int()},{readLine:K,markLine:J,skipWhitespace:ee,markStart:te,eatValue:ne,eatLine:re}=h._F,ie=/\[ (.+) \]/,oe=/\s+/
function ae(e){const{tokenizer:t}=e
let n
for(;t.tokenEnd<t.length;){ee(t)
const e=t.data.charAt(t.position)
if("["===e)break
if(";"!==e&&"*"!==e){if(void 0!==n)throw new Error("more than one molName")
n=K(t).split(oe)[0]}else J(t)}if(void 0===n)throw new Error("missing molName")
return n}function se(e){const{tokenizer:t}=e,n=h.tM.create(t.data,64),r=h.tM.create(t.data,64),i=h.tM.create(t.data,64),o=h.tM.create(t.data,64),a=h.tM.create(t.data,64),s=h.tM.create(t.data,64),l=h.tM.create(t.data,64),c=h.tM.create(t.data,64)
for(;t.tokenEnd<t.length;){ee(t)
const e=t.data.charAt(t.position)
if("["===e)break
if(";"!==e&&"*"!==e){for(let e=0;e<8;++e)switch(ee(t),te(t),ne(t),e){case 0:h.tM.add(n,t.tokenStart,t.tokenEnd)
break
case 1:h.tM.add(r,t.tokenStart,t.tokenEnd)
break
case 2:h.tM.add(i,t.tokenStart,t.tokenEnd)
break
case 3:h.tM.add(o,t.tokenStart,t.tokenEnd)
break
case 4:h.tM.add(a,t.tokenStart,t.tokenEnd)
break
case 5:h.tM.add(s,t.tokenStart,t.tokenEnd)
break
case 6:h.tM.add(l,t.tokenStart,t.tokenEnd)
break
case 7:h.tM.add(c,t.tokenStart,t.tokenEnd)}J(t)}else J(t)}return f.XI.ofColumns(W,{nr:(0,m.do)(n)(f.VP.Schema.int),type:(0,m.do)(r)(f.VP.Schema.str),resnr:(0,m.do)(i)(f.VP.Schema.int),residu:(0,m.do)(o)(f.VP.Schema.str),atom:(0,m.do)(a)(f.VP.Schema.str),cgnr:(0,m.do)(s)(f.VP.Schema.int),charge:(0,m.do)(l)(f.VP.Schema.float),mass:(0,m.do)(c)(f.VP.Schema.float)})}function le(e){const{tokenizer:t}=e,n=h.tM.create(t.data,64),r=h.tM.create(t.data,64)
for(;t.tokenEnd<t.length;){ee(t)
const e=t.data.charAt(t.position)
if("["===e)break
if(";"!==e&&"*"!==e){for(let e=0;e<2;++e)switch(ee(t),te(t),ne(t),e){case 0:h.tM.add(n,t.tokenStart,t.tokenEnd)
break
case 1:h.tM.add(r,t.tokenStart,t.tokenEnd)}J(t)}else J(t)}return f.XI.ofColumns(Y,{ai:(0,m.do)(n)(f.VP.Schema.int),aj:(0,m.do)(r)(f.VP.Schema.int)})}function ce(e){const{tokenizer:t}=e
let n
for(;t.tokenEnd<t.length;){ee(t)
const e=t.data.charAt(t.position)
if("["===e)break
if(";"!==e&&"*"!==e){if(void 0!==n)throw new Error("more than one system")
n=K(t).trim()}else J(t)}if(void 0===n)throw new Error("missing system")
return n}function ue(e){const{tokenizer:t}=e,n=h.tM.create(t.data,64),r=h.tM.create(t.data,64)
for(;t.tokenEnd<t.length&&(ee(t),!(t.position>=t.length));){const e=t.data.charAt(t.position)
if("["===e)break
if(";"!==e&&"*"!==e){for(let e=0;e<2;++e)switch(ee(t),te(t),ne(t),e){case 0:h.tM.add(n,t.tokenStart,t.tokenEnd)
break
case 1:h.tM.add(r,t.tokenStart,t.tokenEnd)}re(t),te(t)}else J(t)}return f.XI.ofColumns(Z,{compound:(0,m.do)(n)(f.VP.Schema.str),molCount:(0,m.do)(r)(f.VP.Schema.int)})}var de=n(47944)
const pe=D.H.BuiltIn({name:"download",display:{name:"Download",description:"Download string or binary data from the specified URL"},from:[D.O.Root],to:[D.O.Data.String,D.O.Data.Binary],params:{url:k.t.Url("https://www.ebi.ac.uk/pdbe/static/entry/1cbs_updated.cif",{description:"Resource URL. Must be the same domain or support CORS."}),label:k.t.Optional(k.t.Text("")),isBinary:k.t.Optional(k.t.Boolean(!1,{description:"If true, download data as binary (string otherwise)"}))}})({apply:({params:e,cache:t},n)=>o.Task.create("Download",async r=>{const i=M.V.getUrlAsset(n.managers.asset,e.url),o=await n.managers.asset.resolve(i,e.isBinary?"binary":"string").runInContext(r)
return t.asset=o,e.isBinary?new D.O.Data.Binary(o.data,{label:e.label?e.label:i.url}):new D.O.Data.String(o.data,{label:e.label?e.label:i.url})}),dispose({cache:e}){var t
null===(t=null==e?void 0:e.asset)||void 0===t||t.dispose()},update:({oldParams:e,newParams:t,b:n})=>e.url!==t.url||e.isBinary!==t.isBinary?B.xE.UpdateResult.Recreate:e.label!==t.label?(n.label=t.label||("string"==typeof t.url?t.url:t.url.url),B.xE.UpdateResult.Updated):B.xE.UpdateResult.Unchanged}),he=D.H.BuiltIn({name:"download-blob",display:{name:"Download Blob",description:"Download multiple string or binary data from the specified URLs."},from:D.O.Root,to:D.O.Data.Blob,params:{sources:k.t.ObjectList({id:k.t.Text("",{label:"Unique ID"}),url:k.t.Url("https://www.ebi.ac.uk/pdbe/static/entry/1cbs_updated.cif",{description:"Resource URL. Must be the same domain or support CORS."}),isBinary:k.t.Optional(k.t.Boolean(!1,{description:"If true, download data as binary (string otherwise)"})),canFail:k.t.Optional(k.t.Boolean(!1,{description:"Indicate whether the download can fail and not be included in the blob as a result."}))},e=>`${e.id}: ${e.url}`),maxConcurrency:k.t.Optional(k.t.Numeric(4,{min:1,max:12,step:1},{description:"The maximum number of concurrent downloads."}))}})({apply:({params:e,cache:t},n)=>o.Task.create("Download Blob",async r=>{const i=[],o=await(0,E.Ui)(r,n.managers.asset,e.sources,e.maxConcurrency||4),a=[]
for(let t=0;t<o.length;t++){const r=o[t],s=e.sources[t]
"error"===r.kind?n.log.warn(`Download ${r.id} (${s.url}) failed: ${r.error}`):(a.push(r.result),i.push(s.isBinary?{id:r.id,kind:"binary",data:r.result.data}:{id:r.id,kind:"string",data:r.result.data}))}return t.assets=a,new D.O.Data.Blob(i,{label:"Data Blob",description:`${i.length} ${1===i.length?"entry":"entries"}`})}),dispose({cache:e},t){const n=null==e?void 0:e.assets
if(n)for(const r of n)r.dispose()}}),fe=D.H.BuiltIn({name:"defalate-data",display:{name:"Deflate",description:"Deflate compressed data"},params:{method:k.t.Select("gzip",[["gzip","gzip"]]),isString:k.t.Boolean(!1),stringEncoding:k.t.Optional(k.t.Select("utf-8",[["utf-8","UTF8"]])),label:k.t.Optional(k.t.Text(""))},from:[D.O.Data.Binary],to:[D.O.Data.Binary,D.O.Data.String]})({apply:({a:e,params:t},n)=>o.Task.create("Gzip",async n=>{const r=await(0,de.Aq)(n,e.data),i=t.label?t.label:e.label
if(t.isString){const e=(0,F.uu)(r)
return new D.O.Data.String(e,{label:i})}return new D.O.Data.Binary(r,{label:i})})}),me=D.H.BuiltIn({name:"raw-data",display:{name:"Raw Data",description:"Raw data supplied by value."},from:[D.O.Root],to:[D.O.Data.String,D.O.Data.Binary],params:{data:k.t.Value("",{isHidden:!0}),label:k.t.Optional(k.t.Text(""))}})({apply:({params:e})=>o.Task.create("Raw Data",async()=>"string"==typeof e.data?new D.O.Data.String(e.data,{label:e.label?e.label:"String"}):Array.isArray(e.data)||e.data instanceof ArrayBuffer?new D.O.Data.Binary(new Uint8Array(e.data),{label:e.label?e.label:"Binary"}):e.data instanceof Uint8Array?new D.O.Data.Binary(e.data,{label:e.label?e.label:"Binary"}):void(0,V.dr)(e.data)),update:({oldParams:e,newParams:t,b:n})=>e.data!==t.data?B.xE.UpdateResult.Recreate:e.label!==t.label?(n.label=t.label||n.label,B.xE.UpdateResult.Updated):B.xE.UpdateResult.Unchanged,customSerialization:{toJSON(e){if("string"==typeof e.data||Array.isArray(e.data))return e
if(e.data instanceof ArrayBuffer){const t=new Uint8Array(e.data),n=new Array(t.length)
for(let e=0,r=t.length;e<r;e++)n[e]=t[e]
return{data:n,label:e.label}}if(e.data instanceof Uint8Array){const t=new Array(e.data.length)
for(let n=0,r=e.data.length;n<r;n++)t[n]=e.data[n]
return{data:t,label:e.label}}},fromJSON:e=>e}}),ge=D.H.BuiltIn({name:"read-file",display:{name:"Read File",description:"Read string or binary data from the specified file"},from:D.O.Root,to:[D.O.Data.String,D.O.Data.Binary],params:{file:k.t.File(),label:k.t.Optional(k.t.Text("")),isBinary:k.t.Optional(k.t.Boolean(!1,{description:"If true, open file as as binary (string otherwise)"}))}})({apply:({params:e,cache:t},n)=>o.Task.create("Open File",async r=>{if(null===e.file)return n.log.error("No file(s) selected"),B.BM.Null
const i=await n.managers.asset.resolve(e.file,e.isBinary?"binary":"string").runInContext(r)
return t.asset=i,e.isBinary?new D.O.Data.Binary(i.data,{label:e.label?e.label:e.file.name}):new D.O.Data.String(i.data,{label:e.label?e.label:e.file.name})}),dispose({cache:e}){var t
null===(t=null==e?void 0:e.asset)||void 0===t||t.dispose()},update({oldParams:e,newParams:t,b:n}){var r
return e.label!==t.label?(n.label=t.label||(null===(r=e.file)||void 0===r?void 0:r.name)||"",B.xE.UpdateResult.Updated):B.xE.UpdateResult.Unchanged},isSerializable:()=>({isSerializable:!1,reason:"Cannot serialize user loaded files."})}),ye=D.H.BuiltIn({name:"parse-blob",display:{name:"Parse Blob",description:"Parse multiple data enties"},from:D.O.Data.Blob,to:D.O.Format.Blob,params:{formats:k.t.ObjectList({id:k.t.Text("",{label:"Unique ID"}),format:k.t.Select("cif",[["cif","cif"]])},e=>`${e.id}: ${e.format}`)}})({apply:({a:e,params:t},n)=>o.Task.create("Parse Blob",async n=>{const r=new Map
for(const e of t.formats)r.set(e.id,e.format)
const o=[]
for(const t of e.data){if(!r.has(t.id))continue
const e=await("string"===t.kind?i.f$.parse(t.data):i.f$.parseBinary(t.data)).runInContext(n)
if(e.isError)throw new Error(`${t.id}: ${e.message}`)
o.push({id:t.id,kind:"cif",data:e.result})}return new D.O.Format.Blob(o,{label:"Format Blob",description:`${o.length} ${1===o.length?"entry":"entries"}`})})}),ve=D.H.BuiltIn({name:"parse-cif",display:{name:"Parse CIF",description:"Parse CIF from String or Binary data"},from:[D.O.Data.String,D.O.Data.Binary],to:D.O.Format.Cif})({apply:({a:e})=>o.Task.create("Parse CIF",async t=>{const n=await i.f$.parse(e.data).runInContext(t)
if(n.isError)throw new Error(n.message)
return 0===n.result.blocks.length?B.BM.Null:new D.O.Format.Cif(n.result)})}),be=D.H.BuiltIn({name:"parse-cube",display:{name:"Parse Cube",description:"Parse Cube from String data"},from:D.O.Data.String,to:D.O.Format.Cube})({apply:({a:e})=>o.Task.create("Parse Cube",async t=>{const n=await function(e,t){return o.Task.create("Parse Cube",async n=>{await n.update("Reading header...")
const r=(0,h._F)(e),{header:i,atoms:s}=function(e){const t=h._F.readLines(e,6),n=(e,n)=>{const r=+t[e].trim().split(/\s+/g)[n]
return Number.isNaN(r)?0:r},r=e=>{const t=n(e+2,0),r=L
return[Math.abs(t),R.eB.create(n(e+2,1)*r,n(e+2,2)*r,n(e+2,3)*r),t]},i=t[0].trim(),o=t[1].trim(),[a,s,l]=r(0),[c,u]=r(1),[d,p]=r(2),[m,g]=r(3),y=function(e,t,n){const r=new Int32Array(t),i=new Float64Array(t),o=new Float32Array(t),a=new Float32Array(t),s=new Float32Array(t)
for(let l=0;l<t;l++){const t=h._F.readLine(e).trim().split(/\s+/g)
r[l]=+t[0],i[l]=+t[1],o[l]=+t[2]*n,a[l]=+t[3]*n,s[l]=+t[4]*n}return{count:t,number:f.VP.ofArray({array:r,schema:f.VP.Schema.int}),nuclearCharge:f.VP.ofArray({array:i,schema:f.VP.Schema.float}),x:f.VP.ofArray({array:o,schema:f.VP.Schema.float}),y:f.VP.ofArray({array:a,schema:f.VP.Schema.float}),z:f.VP.ofArray({array:s,schema:f.VP.Schema.float})}}(e,a,L),v=[]
if(l>=0){let e=n(2,4)
0===e&&(e=1)
for(let t=0;t<e;t++)v.push(t)}else{const t=h._F.readLine(e).trim().split(/\s+/g)
for(let e=0,n=+t[0];e<n;e++)v.push(+t[e+1])}return{header:{orbitals:l<0,comment1:i,comment2:o,atomCount:a,origin:s,dim:R.eB.create(c,d,m),basisX:u,basisY:p,basisZ:g,dataSetIds:v},atoms:y}}(r),l=await function(e,t,n){const r=n.dim[0]*n.dim[1]*n.dim[2]*n.dataSetIds.length,i=1e6,a=new Float64Array(r)
let s=0
return(0,o.chunkedSubtask)(e,i,a,(e,n)=>{const o=Math.min(r,s+e)
for(let r=s;r<o;r++)h._F.skipWhitespace(t),t.tokenStart=t.position,h._F.eatValue(t),n[r]=(0,O.sS)(t.data,t.tokenStart,t.tokenEnd)
return s=o,o===r?0:i},(e,t,n)=>e.update({current:Math.min(n,r),max:r}))}(n,r,i)
return a.H.success({header:i,atoms:s,values:l,name:t})})}(e.data,e.label).runInContext(t)
if(n.isError)throw new Error(n.message)
return new D.O.Format.Cube(n.result)})}),xe=D.H.BuiltIn({name:"parse-psf",display:{name:"Parse PSF",description:"Parse PSF from String data"},from:[D.O.Data.String],to:D.O.Format.Psf})({apply:({a:e})=>o.Task.create("Parse PSF",async t=>{const n=await(r=e.data,o.Task.create("Parse PSF",async e=>await async function(e,t){const n=(0,h._F)(e),r=function(e,t){return{tokenizer:e,runtimeCtx:t}}(n,t)
let i,o,s
const l=b(r.tokenizer).trim()
for(;n.tokenEnd<n.length;){const e=b(r.tokenizer).trim()
if(e.includes("!NTITLE"))i=P(r,parseInt(e.split(w)[0]))
else if(e.includes("!NATOM")){const t=parseInt(e.split(w)[0])
o=await A(r,t)}else{if(e.includes("!NBOND")){const t=parseInt(e.split(w)[0])
s=await I(r,t)
break}e.includes("!NTHETA")||e.includes("!NPHI")||e.includes("!NIMPHI")||e.includes("!NDON")||e.includes("!NACC")||e.includes("!NNB")||e.includes("!NGRP NST2")||e.includes("!MOLNT")||e.includes("!NUMLP NUMLPH")||e.includes("!NCRTERM")}}if(void 0===i&&(i=[]),void 0===o)return a.H.error("no atoms data")
if(void 0===s)return a.H.error("no bonds data")
const c={id:l,title:i,atoms:o,bonds:s}
return a.H.success(c)}(r,e))).runInContext(t)
var r
if(n.isError)throw new Error(n.message)
return new D.O.Format.Psf(n.result)})}),Se=D.H.BuiltIn({name:"parse-prmtop",display:{name:"Parse PRMTOP",description:"Parse PRMTOP from String data"},from:[D.O.Data.String],to:D.O.Format.Prmtop})({apply:({a:e})=>o.Task.create("Parse PRMTOP",async t=>{const n=await(r=e.data,o.Task.create("Parse PRMTOP",async e=>await async function(e,t){const n=(0,h._F)(e),r={tokenizer:n,runtimeCtx:t},i=Object.create(null)
let o=0
for(;n.tokenEnd<n.length;){n.position-o>1e5&&t.shouldUpdate&&(o=n.position,await t.update({current:n.position,max:n.length}))
const e=G(r.tokenizer).trim()
if(e.startsWith("%VERSION"))i.version=e.substring(8).trim()
else if(e.startsWith("%FLAG")){const t=e.substring(5).trim()
let o=G(r.tokenizer).trim()
for(;o.startsWith("%COMMENT");)o=G(r.tokenizer).trim()
if(!o.startsWith("%FORMAT"))throw new Error(`expected %FORMAT got "${o}"`)
if("TITLE"===t||"CTITLE"===t)i.title=Q(r)
else if("POINTERS"===t)i.pointers=$(r)
else if("ATOM_NAME"===t){const e=X(r,i.pointers.NATOM,20,4)
i.atomName=(0,m.do)(e)(f.VP.Schema.str)}else if("CHARGE"===t){const e=X(r,i.pointers.NATOM,5,16)
i.charge=(0,m.do)(e)(f.VP.Schema.float)}else if("MASS"===t){const e=X(r,i.pointers.NATOM,5,16)
i.mass=(0,m.do)(e)(f.VP.Schema.float)}else if("RESIDUE_LABEL"===t){const e=X(r,i.pointers.NRES,20,4)
i.residueLabel=(0,m.do)(e)(f.VP.Schema.str)}else if("RESIDUE_POINTER"===t){const e=X(r,i.pointers.NRES,10,8)
i.residuePointer=(0,m.do)(e)(f.VP.Schema.int)}else if("BONDS_INC_HYDROGEN"===t){const e=X(r,3*i.pointers.NBONH,10,8)
i.bondsIncHydrogen=(0,m.do)(e)(f.VP.Schema.int)}else if("BONDS_WITHOUT_HYDROGEN"===t){const e=X(r,3*i.pointers.NBONA,10,8)
i.bondsWithoutHydrogen=(0,m.do)(e)(f.VP.Schema.int)}else if("RADII"===t){const e=X(r,i.pointers.NATOM,5,16)
i.radii=(0,m.do)(e)(f.VP.Schema.float)}else for(;n.tokenEnd<n.length&&"%"!==n.data.charAt(n.position);)H(n)}}return a.H.success(i)}(r,e))).runInContext(t)
var r
if(n.isError)throw new Error(n.message)
return new D.O.Format.Prmtop(n.result)})}),_e=D.H.BuiltIn({name:"parse-top",display:{name:"Parse TOP",description:"Parse TOP from String data"},from:[D.O.Data.String],to:D.O.Format.Top})({apply:({a:e})=>o.Task.create("Parse TOP",async t=>{const n=await(r=e.data,o.Task.create("Parse TOP",async e=>await async function(e,t){const n=(0,h._F)(e),r={tokenizer:n,runtimeCtx:t},i=Object.create(null)
let o=0
i.compounds={}
let s={},l=""
function c(){l&&s.atoms&&(i.compounds[l]=s,s={},l="")}for(;n.tokenEnd<n.length;){n.position-o>1e5&&t.shouldUpdate&&(o=n.position,await t.update({current:n.position,max:n.length}))
const e=K(r.tokenizer).trim()
if(e&&"*"!==e[0]&&";"!==e[0]){if(e.startsWith("#include"))throw new Error("#include statements not allowed")
if(e.startsWith("[")){const t=e.match(ie)
if(null===t)throw new Error("expected field name")
const o=t[1]
if("moleculetype"===o)c(),l=ae(r)
else if("atoms"===o)s.atoms=se(r)
else if("bonds"===o)s.bonds=le(r)
else if("system"===o)i.system=ce(r)
else if("molecules"===o)c(),i.molecules=ue(r)
else for(;n.tokenEnd<n.length&&"["!==n.data.charAt(n.position);)J(n)}}}return a.H.success(i)}(r,e))).runInContext(t)
var r
if(n.isError)throw new Error(n.message)
return new D.O.Format.Top(n.result)})}),Ce=D.H.BuiltIn({name:"parse-ply",display:{name:"Parse PLY",description:"Parse PLY from String data"},from:[D.O.Data.String],to:D.O.Format.Ply})({apply:({a:e})=>o.Task.create("Parse PLY",async t=>{const n=await(r=e.data,o.Task.create("Parse PLY",async e=>await async function(e,t){const n=function(e,t){return{data:e,tokenizer:(0,h._F)(e),runtimeCtx:t,comments:[],elementSpecs:[],elements:[]}}(e,t)
t.update({message:"Parsing...",current:0,max:e.length}),function(e){const{tokenizer:t,comments:n,elementSpecs:r}=e
!function(e){const t=e.data.indexOf("end_header",e.position)
if(-1===t)throw new Error("no 'end_header' record found")
e.tokenStart=e.position,e.tokenEnd=t,e.position=t,h._F.eatLine(e)}(t)
const i=h._F.getTokenString(t).split(/\r?\n/)
if("ply"!==i[0])throw new Error("data not starting with 'ply'")
if("format ascii 1.0"!==i[1])throw new Error("format not 'ascii 1.0'")
let o,a,s
function l(){if(void 0!==o&&void 0!==a&&void 0!==s){let e=!1
for(let t=0,n=s.length;t<n;++t)if("list"===s[t].kind){e=!0
break}e&&s.length,e?r.push({kind:"list",name:o,count:a,property:s[0]}):r.push({kind:"table",name:o,count:a,properties:s})}}for(let c=2,u=i.length;c<u;++c){const e=i[c],t=e.split(" ")
if(e.startsWith("comment"))n.push(e.substr(8))
else if(e.startsWith("element"))l(),s=[],o=t[1],a=parseInt(t[2])
else if(e.startsWith("property")){if(void 0===s)throw new Error("properties outside of element")
"list"===t[1]?s.push({kind:"list",countType:p(t[2]),dataType:p(t[3]),name:t[4]}):s.push({kind:"column",type:p(t[1]),name:t[2]})}else e.startsWith("end_header")?l():console.warn("unknown header line")}}(n),function(e){const{elementSpecs:t}=e
for(let n=0,r=t.length;n<r;++n){const r=t[n]
"table"===r.kind?y(e,r):"list"===r.kind&&v(e,r)}}(n)
const{elements:r,elementSpecs:i,comments:o}=n,s=function(e,t,n){const r=new Map
for(let i=0,o=t.length;i<o;++i)r.set(t[i],e[i])
return{comments:n,elementNames:t,getElement:e=>r.get(e)}}(r,i.map(e=>e.name),o)
return a.H.success(s)}(r,e))).runInContext(t)
var r
if(n.isError)throw new Error(n.message)
return new D.O.Format.Ply(n.result,{label:n.result.comments[0]||"PLY Data"})})}),we=D.H.BuiltIn({name:"parse-ccp4",display:{name:"Parse CCP4/MRC/MAP",description:"Parse CCP4/MRC/MAP from Binary data"},from:[D.O.Data.Binary],to:D.O.Format.Ccp4})({apply:({a:e})=>o.Task.create("Parse CCP4/MRC/MAP",async t=>{const n=await r.qg(e.data,e.label).runInContext(t)
if(n.isError)throw new Error(n.message)
return new D.O.Format.Ccp4(n.result)})}),Te=D.H.BuiltIn({name:"parse-dsn6",display:{name:"Parse DSN6/BRIX",description:"Parse CCP4/BRIX from Binary data"},from:[D.O.Data.Binary],to:D.O.Format.Dsn6})({apply:({a:e})=>o.Task.create("Parse DSN6/BRIX",async t=>{const n=await(r=e.data,i=e.label,c=s.L.fromBuffer(l.N.fromUint8Array(r),i),d=r.length,o.Task.create("Parse DSN6/BRIX",async e=>{try{return a.H.success(await u(c,d,e))}catch(e){return a.H.error(e)}})).runInContext(t)
var r,i,c,d
if(n.isError)throw new Error(n.message)
return new D.O.Format.Dsn6(n.result)})}),Ae=D.H.BuiltIn({name:"parse-dx",display:{name:"Parse DX",description:"Parse DX from Binary/String data"},from:[D.O.Data.Binary,D.O.Data.String],to:D.O.Format.Dx})({apply:({a:e})=>o.Task.create("Parse DX",async t=>{const n=await function(e,t){return o.Task.create("Parse DX",n=>N.LQ.is(e)?async function(e,t,n){await e.update("Reading header...")
const r=(0,h._F)(t),{header:i}=z(r)
await e.update("Reading values...")
const s=await function(e,t,n){const r=n.dim[0]*n.dim[1]*n.dim[2],i=1e6,a=new Float64Array(r)
let s=0
return(0,o.chunkedSubtask)(e,i,a,(e,n)=>{const o=Math.min(r,s+e)
for(let r=s;r<o;r++)h._F.skipWhitespace(t),t.tokenStart=t.position,h._F.eatValue(t),n[r]=(0,O.sS)(t.data,t.tokenStart,t.tokenEnd)
return s=o,o===r?0:i},(e,t,n)=>e.update({current:Math.min(n,r),max:r}))}(e,r,i)
return a.H.success({header:i,values:s,name:n})}(n,e,t):async function(e,t,n){await e.update("Reading header...")
const r=(0,F.ss)(t,0,1e3),i=(0,h._F)(r),{header:o,headerByteCount:s}=z(i)
await e.update("Reading values...")
const l=o.dim[0]*o.dim[1]*o.dim[2],c=new DataView(t.buffer,t.byteOffset+s),u=new Float64Array(l)
for(let a=0;a<l;a++)u[a]=c.getFloat64(8*a,!0)
return a.H.success({header:o,values:u,name:n})}(n,e,t))}(e.data,e.label).runInContext(t)
if(n.isError)throw new Error(n.message)
return new D.O.Format.Dx(n.result)})}),Ie=D.H.BuiltIn({name:"import-string",display:{name:"Import String",description:"Import given data as a string"},from:D.O.Root,to:D.O.Data.String,params:{data:k.t.Value(""),label:k.t.Optional(k.t.Text(""))}})({apply:({params:{data:e,label:t}})=>new D.O.Data.String(e,{label:t||""}),update:({oldParams:e,newParams:t,b:n})=>e.data!==t.data?B.xE.UpdateResult.Recreate:e.label!==t.label?(n.label=t.label||"",B.xE.UpdateResult.Updated):B.xE.UpdateResult.Unchanged,isSerializable:()=>({isSerializable:!1,reason:"Cannot serialize user imported strings."})}),Pe=D.H.BuiltIn({name:"import-json",display:{name:"Import JSON",description:"Import given data as a JSON"},from:D.O.Root,to:D.O.Format.Json,params:{data:k.t.Value({}),label:k.t.Optional(k.t.Text(""))}})({apply:({params:{data:e,label:t}})=>new D.O.Format.Json(e,{label:t||""}),update:({oldParams:e,newParams:t,b:n})=>e.data!==t.data?B.xE.UpdateResult.Recreate:e.label!==t.label?(n.label=t.label||"",B.xE.UpdateResult.Updated):B.xE.UpdateResult.Unchanged,isSerializable:()=>({isSerializable:!1,reason:"Cannot serialize user imported JSON."})}),Be=D.H.BuiltIn({name:"parse-json",display:{name:"Parse JSON",description:"Parse JSON from String data"},from:[D.O.Data.String],to:D.O.Format.Json})({apply:({a:e})=>o.Task.create("Parse JSON",async t=>{const n=await new Response(N.LQ.toString(e.data)).json()
return new D.O.Format.Json(n)})}),Ee=D.H.BuiltIn({name:"lazy-volume",display:{name:"Lazy Volume",description:"A placeholder for lazy loaded volume representation"},from:D.O.Root,to:D.O.Volume.Lazy,params:{url:k.t.Url(""),isBinary:k.t.Boolean(!1),format:k.t.Text("ccp4"),entryId:k.t.Value("",{isHidden:!0}),isovalues:k.t.ObjectList({type:k.t.Text("relative"),value:k.t.Numeric(0),color:k.t.Color(j.ColorNames.black),alpha:k.t.Numeric(1,{min:0,max:1,step:.01}),volumeIndex:k.t.Numeric(0)},e=>`${e.type} ${e.value}`)}})({apply:({a:e,params:t})=>o.Task.create("Lazy Volume",async e=>{const n=Array.isArray(t.entryId)?t.entryId.join(", "):t.entryId
return new D.O.Volume.Lazy(t,{label:`${n||t.url}`,description:"Lazy Volume"})})})},56642(e,t,n){"use strict"
n.d(t,{e:()=>p,O:()=>d})
var r=n(70292),i=n(42629),o=n(9043),a=n(70012),s=n(10596),l=n(17810)
function c(e){return{...e,bottomLeft:(0,o.NT)(e.bottomLeft,[0,0,0]),topRight:(0,o.NT)(e.topRight,e.scalarField.space.dimensions)}}function u(e){return{dX:e.topRight[0]-e.bottomLeft[0],dY:e.topRight[1]-e.bottomLeft[1],dZ:e.topRight[2]-e.bottomLeft[2]}}function d(e,t){return r.Task.create("Marching Cubes Mesh",async n=>{const r=c(e),{dX:i,dY:o,dZ:l}=u(r),d=function(e,t){const n=Math.min(65536,4*e),r=a.Gm.create(Float32Array,3,e,t&&t.vertexBuffer.ref.value),i=a.Gm.create(Float32Array,3,e,t&&t.normalBuffer.ref.value),o=a.Gm.create(Float32Array,1,e,t&&t.groupBuffer.ref.value),l=a.Gm.create(Uint32Array,3,n,t&&t.indexBuffer.ref.value)
let c=0,u=0
return{addVertex:(e,t,n)=>(++c,a.Gm.add3(r,e,t,n)),addNormal:(e,t,n)=>{a.Gm.add3(i,e,t,n)},addGroup:e=>{a.Gm.add(o,e)},addTriangle:(e,t,n,r)=>{const i=e[t],o=e[n],s=e[r]
i>=0&&o>=0&&s>=0&&(++u,a.Gm.add3(l,i,o,s))},get:()=>{const e=a.Gm.compact(r,!0),n=a.Gm.compact(i,!0),d=a.Gm.compact(l,!0),p=a.Gm.compact(o,!0)
return s.e.create(e,d,n,p,c,u,t)}}}(Math.min(262144,Math.max(i*o*l/32,1024)),t)
return await new h(n,d,r).run(),d.get()})}function p(e,t){return r.Task.create("Marching Cubes Lines",async n=>{const r=c(e),{dX:s,dY:d,dZ:p}=u(r),f=function(e,t){const n=a.Gm.create(Float32Array,3,e),r=a.Gm.create(Float32Array,1,e),s=a.Gm.create(Float32Array,2,e)
let c=0
return{addVertex:(e,t,r)=>a.Gm.add3(n,e,t,r),addNormal:()=>o.lQ,addGroup:e=>{a.Gm.add(r,e)},addTriangle:(e,t,n,r,o)=>{const l=e[t],u=e[n],d=e[r]
l>=0&&u>=0&&d>=0&&(i.my[t][n]&o&&(++c,a.Gm.add2(s,e[t],e[n])),i.my[n][r]&o&&(++c,a.Gm.add2(s,e[n],e[r])),i.my[t][r]&o&&(++c,a.Gm.add2(s,e[t],e[r])))},get:()=>{const e=a.Gm.compact(n,!0),i=a.Gm.compact(s,!0),o=a.Gm.compact(r,!0),u=l.d.create(c,c/10,t)
for(let t=0;t<c;++t){const n=i[2*t],r=i[2*t+1]
u.add(e[3*n],e[3*n+1],e[3*n+2],e[3*r],e[3*r+1],e[3*r+2],o[n])}return u.getLines()}}}(Math.min(262144,Math.max(s*d*p/32,1024)),t)
return await new h(n,f,r).run(),f.get()})}class h{async doSlices(){let e=0
this.edgeFilter=15
for(let t=this.minZ;t<this.maxZ;t++,this.edgeFilter&=-5)this.slice(t),e+=this.sliceSize,this.ctx.shouldUpdate&&await this.ctx.update({message:"Computing surface...",current:e,max:this.size})}slice(e){this.edgeFilter|=2
for(let t=this.minY;t<this.maxY;t++,this.edgeFilter&=-3){this.edgeFilter|=1
for(let n=this.minX;n<this.maxX;n++,this.edgeFilter&=-2)this.state.processCell(n,t,e,this.edgeFilter)}this.state.clearEdgeVertexIndexSlice(e)}async run(){await this.doSlices()}constructor(e,t,n){this.ctx=e,this.minX=0,this.minY=0,this.minZ=0,this.maxX=0,this.maxY=0,this.maxZ=0,this.state=new f(t,n),this.minX=n.bottomLeft[0],this.minY=n.bottomLeft[1],this.minZ=n.bottomLeft[2],this.maxX=n.topRight[0]-1,this.maxY=n.topRight[1]-1,this.maxZ=n.topRight[2]-1,this.size=(this.maxX-this.minX)*(this.maxY-this.minY)*(this.maxZ-this.minZ),this.sliceSize=(this.maxX-this.minX)*(this.maxY-this.minY)}}class f{get3dOffsetFromEdgeInfo(e){return this.nX*((this.k+e.k)%2*this.nY+this.j+e.j)+this.i+e.i}clearEdgeVertexIndexSlice(e){const t=e%2==0?0:3*this.nX*this.nY,n=e%2==0?3*this.nX*this.nY:this.verticesOnEdges.length
this.verticesOnEdges.fill(0,t,n)}interpolate(e){const t=i.Dn[e],n=3*this.get3dOffsetFromEdgeInfo(t)+t.e,r=this.verticesOnEdges[n]
if(r>0)return r-1
const o=this.scalarField,a=this.scalarFieldGet,s=i.WH[e],l=s.a,c=s.b,u=l.i+this.i,d=l.j+this.j,p=l.k+this.k,h=c.i+this.i,f=c.j+this.j,m=c.k+this.k,g=a(o,u,d,p),y=a(o,h,f,m),v=(this.isoLevel-g)/(g-y)
if(this.idField){const e=this.idFieldGet(this.idField,u,d,p),t=this.idFieldGet(this.idField,h,f,m)
let n=v<.5?e:t
if(-1===n&&(n=v<.5?t:e),-2===n)return-1
this.builder.addGroup(n)}else this.builder.addGroup(0)
const b=this.builder.addVertex(u+v*(u-h),d+v*(d-f),p+v*(p-m))
this.verticesOnEdges[n]=b+1
const x=a(o,Math.max(0,u-1),d,p)-a(o,Math.min(this.nX-1,u+1),d,p),S=a(o,u,Math.max(0,d-1),p)-a(o,u,Math.min(this.nY-1,d+1),p),_=a(o,u,d,Math.max(0,p-1))-a(o,u,d,Math.min(this.nZ-1,p+1)),C=x+v*(x-(a(o,Math.max(0,h-1),f,m)-a(o,Math.min(this.nX-1,h+1),f,m))),w=S+v*(S-(a(o,h,Math.max(0,f-1),m)-a(o,h,Math.min(this.nY-1,f+1),m))),T=_+v*(_-(a(o,h,f,Math.max(0,m-1))-a(o,h,f,Math.min(this.nZ-1,m+1))))
return this.isoLevel>=0?this.builder.addNormal(C,w,T):this.builder.addNormal(-C,-w,-T),b}constructor(e,t){this.builder=e,this.vertList=[0,0,0,0,0,0,0,0,0,0,0,0],this.i=0,this.j=0,this.k=0
const n=t.scalarField.space.dimensions
this.nX=n[0],this.nY=n[1],this.nZ=n[2],this.isoLevel=t.isoLevel,this.scalarFieldGet=t.scalarField.space.get,this.scalarField=t.scalarField.data,t.idField&&(this.idField=t.idField.data,this.idFieldGet=t.idField.space.get),this.verticesOnEdges=new Int32Array(3*this.nX*this.nY*2)}get(e,t,n){return this.scalarFieldGet(this.scalarField,e,t,n)}processCell(e,t,n,r){let o=0
if(this.get(e,t,n)<this.isoLevel&&(o|=1),this.get(e+1,t,n)<this.isoLevel&&(o|=2),this.get(e+1,t+1,n)<this.isoLevel&&(o|=4),this.get(e,t+1,n)<this.isoLevel&&(o|=8),this.get(e,t,n+1)<this.isoLevel&&(o|=16),this.get(e+1,t,n+1)<this.isoLevel&&(o|=32),this.get(e+1,t+1,n+1)<this.isoLevel&&(o|=64),this.get(e,t+1,n+1)<this.isoLevel&&(o|=128),0===o||255===o)return
this.i=e,this.j=t,this.k=n
const a=i.IT[o];(1&a)>0&&(this.vertList[0]=this.interpolate(0)),(2&a)>0&&(this.vertList[1]=this.interpolate(1)),(4&a)>0&&(this.vertList[2]=this.interpolate(2)),(8&a)>0&&(this.vertList[3]=this.interpolate(3)),(16&a)>0&&(this.vertList[4]=this.interpolate(4)),(32&a)>0&&(this.vertList[5]=this.interpolate(5)),(64&a)>0&&(this.vertList[6]=this.interpolate(6)),(128&a)>0&&(this.vertList[7]=this.interpolate(7)),(256&a)>0&&(this.vertList[8]=this.interpolate(8)),(512&a)>0&&(this.vertList[9]=this.interpolate(9)),(1024&a)>0&&(this.vertList[10]=this.interpolate(10)),(2048&a)>0&&(this.vertList[11]=this.interpolate(11))
const s=i.sE[o]
for(let i=0;i<s.length;i+=3){const e=s[i],t=s[i+1],n=s[i+2]
this.isoLevel>=0?this.builder.addTriangle(this.vertList,e,t,n,r):this.builder.addTriangle(this.vertList,n,t,e,r)}}}},56811(e,t,n){"use strict"
n.d(t,{A4:()=>_,Fy:()=>S,OK:()=>r,mO:()=>y})
var r,i,o=n(66006),a=n(32775),s=n(54749),l=n(9043),c=n(92384),u=n(87423),d=n(63356),p=n(97564),h=n(5638),f=n(16698),m=n(87958),g=n(14294)
!function(e){e[e.None=0]="None",e[e.Object=1]="Object",e[e.Instance=2]="Instance",e[e.Group=3]="Group"}(r||(r={})),function(e){e[e.None=0]="None",e[e.Depth=1]="Depth",e[e.Mask=2]="Mask"}(i||(i={}))
const y={backgroundColor:c.t.Color((0,s.Color)(0),{description:"Background color of the 3D canvas"}),pickingAlphaThreshold:c.t.Numeric(.5,{min:0,max:1,step:.01},{description:"The minimum opacity value needed for an object to be pickable."}),colorMarker:c.t.Boolean(!0,{description:"Enable color marker"}),highlightColor:c.t.Color(s.Color.fromNormalizedRgb(1,.4,.6)),selectColor:c.t.Color(s.Color.fromNormalizedRgb(.2,1,.1)),dimColor:c.t.Color(s.Color.fromNormalizedRgb(1,1,1)),highlightStrength:c.t.Numeric(.3,{min:0,max:1,step:.1}),selectStrength:c.t.Numeric(.3,{min:0,max:1,step:.1}),dimStrength:c.t.Numeric(0,{min:0,max:1,step:.1}),markerPriority:c.t.Select(1,[[1,"Highlight"],[2,"Select"]]),xrayEdgeFalloff:c.t.Numeric(1,{min:0,max:3,step:.1}),celSteps:c.t.Numeric(5,{min:2,max:16,step:1}),exposure:c.t.Numeric(1,{min:0,max:3,step:.01}),light:c.t.ObjectList({inclination:c.t.Numeric(150,{min:0,max:180,step:1}),azimuth:c.t.Numeric(320,{min:0,max:360,step:1}),color:c.t.Color(s.Color.fromNormalizedRgb(1,1,1)),intensity:c.t.Numeric(.6,{min:0,max:5,step:.01})},e=>s.Color.toHexString(e.color),{defaultValue:[{inclination:150,azimuth:320,color:s.Color.fromNormalizedRgb(1,1,1),intensity:.6}]}),ambientColor:c.t.Color(s.Color.fromNormalizedRgb(1,1,1)),ambientIntensity:c.t.Numeric(.4,{min:0,max:2,step:.01})},v=(0,a.eB)(),b=(0,a.eB)()
function x(e,t){const n=e.length,{direction:r,color:i}=t||{direction:new Array(3*n).fill(0),color:new Array(3*n).fill(0)}
for(let o=0;o<n;++o){const t=e[o]
a.eB.directionFromSpherical(v,(0,u.pu)(t.inclination),(0,u.pu)(t.azimuth),1),a.eB.toArray(v,r,3*o),a.eB.scale(b,s.Color.toVec3Normalized(b,t.color),t.intensity),a.eB.toArray(b,i,3*o)}return{count:n,direction:r,color:i}}function S(e,t){const n=new Array(3*e.count)
for(let r=0,i=e.count;r<i;++r)a.eB.fromArray(v,e.direction,3*r),a.eB.transformDirection(v,v,t),a.eB.toArray(v,n,3*r)
return n}var _
!function(e){let t,n
!function(e){e[e.None=0]="None",e[e.BlendedFront=1]="BlendedFront",e[e.BlendedBack=2]="BlendedBack"}(t||(t={})),function(e){e[e.All=0]="All",e[e.Opaque=1]="Opaque",e[e.Transparent=2]="Transparent"}(n||(n={})),e.create=function(e,u={}){const{gl:v,state:b,stats:_}=e,C=c.t.merge(y,c.t.getDefaultValues(y),u),w=x(C.light),T=(0,o.LM)(),A=a.ZY.create(v.drawingBufferWidth,v.drawingBufferHeight),I=s.Color.toVec3Normalized((0,a.eB)(),C.backgroundColor)
let P=!1,B=null
const E=e.resources.texture("image-uint8","rgba","ubyte","nearest")
E.define(1,1),E.load({array:new Uint8Array([255,255,255,255]),width:1,height:1})
const k=[["tDepth",E]],D=(0,a.$I)(),M=(0,a.$I)(),R=(0,a.$I)(),O=(0,a.$I)(),L=(0,a.$I)(),N=(0,a.$I)(),F=(0,a.$I)(),z=(0,a.$I)(),j=(0,a.$I)(),V=(0,a.$I)(),U=(0,a.$I)(),G=(0,a.eB)(),H=(0,a.eB)(),q=(0,a.eB)(),Q=(0,m.i)(),$=(0,a.ZY)(),X=(0,f.Q)()
let W=1
const Y=(0,g.f8)(),Z=(0,a.eB)()
a.eB.scale(Z,s.Color.toArrayNormalized(C.ambientColor,Z,0),C.ambientIntensity)
const K={uDrawId:l.IQ.create(0),uModel:l.IQ.create(a.$I.identity()),uView:l.IQ.create(M),uInvView:l.IQ.create(R),uModelView:l.IQ.create(O),uInvModelView:l.IQ.create(L),uInvProjection:l.IQ.create(N),uProjection:l.IQ.create((0,a.$I)()),uModelViewProjection:l.IQ.create(F),uInvModelViewProjection:l.IQ.create(z),uHasHeadRotation:l.IQ.create(!1),uInvHeadRotation:l.IQ.create(j),uHasEyeCamera:l.IQ.create(!1),uModelViewEye:l.IQ.create(V),uInvModelViewEye:l.IQ.create(U),uIsAsymmetricProjection:l.IQ.create(!1),uIsOrtho:l.IQ.create(1),uViewOffset:l.IQ.create($),uModelScale:l.IQ.create(1),uPixelRatio:l.IQ.create(e.pixelRatio),uViewport:l.IQ.create(o.LM.toVec4((0,a.Zb)(),T)),uDrawingBufferSize:l.IQ.create(A),uCameraPosition:l.IQ.create(H),uCameraDir:l.IQ.create(G),uCameraPlane:l.IQ.create(m.i.toArray(Q,(0,a.Zb)(),0)),uNear:l.IQ.create(1),uFar:l.IQ.create(1e4),uFog:l.IQ.create(!0),uFogNear:l.IQ.create(1),uFogFar:l.IQ.create(1e4),uFogColor:l.IQ.create(I),uRenderMask:l.IQ.create(0),uMarkingDepthTest:l.IQ.create(!1),uPickType:l.IQ.create(r.None),uMarkingType:l.IQ.create(i.None),uTransparentBackground:l.IQ.create(!1),uLightDirection:l.IQ.create(w.direction),uLightColor:l.IQ.create(w.color),uAmbientColor:l.IQ.create(Z),uPickingAlphaThreshold:l.IQ.create(C.pickingAlphaThreshold),uHighlightColor:l.IQ.create(s.Color.toVec3Normalized((0,a.eB)(),C.highlightColor)),uSelectColor:l.IQ.create(s.Color.toVec3Normalized((0,a.eB)(),C.selectColor)),uDimColor:l.IQ.create(s.Color.toVec3Normalized((0,a.eB)(),C.dimColor)),uHighlightStrength:l.IQ.create(C.highlightStrength),uSelectStrength:l.IQ.create(C.selectStrength),uDimStrength:l.IQ.create(C.dimStrength),uMarkerPriority:l.IQ.create(C.markerPriority),uMarkerAverage:l.IQ.create(0),uXrayEdgeFalloff:l.IQ.create(C.xrayEdgeFalloff),uCelSteps:l.IQ.create(C.celSteps),uExposure:l.IQ.create(C.exposure)},J=Object.entries(K)
let ee=!0
const te=(n,r,i)=>{var o,a,s
if(n.state.disposed||!n.state.visible||!n.state.pickable&&"pick"===r)return
if(!n.values.drawCount.ref.value)return
if(g.f8.scaleNX(Y,n.values.boundingSphere.ref.value,W),!f.Q.intersectsSphere3D(X,Y))return
const[l,c]=n.values.uLod.ref.value
if(0!==l||0!==c){const{center:e,radius:t}=Y,n=m.i.distanceToPoint(Q,e)
if(n+t<l*W)return
if(n-t>c*W)return}if(1===W){if(null!==B&&B(Y))return
const t=n.values.instanceGrid.ref.value.cellSize>0,r=n.values.uInstanceCount.ref.value>1
t&&(r||n.values.lodLevels)?n.cull(Q,X,B,e.stats):n.uncull()}else if(n.values.lodLevels){const{center:e,radius:t}=Y,r=m.i.distanceToPoint(Q,e)
n.cullSimple(r,t,W)}else n.uncull()
const u=n.getProgram(r)
if(b.currentProgramId!==u.id&&(ee=!0,u.use()),ee&&(u.setUniforms(J),u.bindTextures(k,0),ee=!1),"directVolume"===n.values.dGeometryType.ref.value){if("color"!==r)return
b.disable(v.CULL_FACE),b.frontFace(v.CCW)}else i===t.BlendedFront?(b.enable(v.CULL_FACE),(null===(o=n.values.dFlipSided)||void 0===o?void 0:o.ref.value)?(b.frontFace(v.CW),b.cullFace(v.FRONT)):(b.frontFace(v.CCW),b.cullFace(v.BACK))):i===t.BlendedBack?(b.enable(v.CULL_FACE),(null===(a=n.values.dFlipSided)||void 0===a?void 0:a.ref.value)?(b.frontFace(v.CW),b.cullFace(v.BACK)):(b.frontFace(v.CCW),b.cullFace(v.FRONT))):(n.values.uDoubleSided?n.values.uDoubleSided.ref.value||n.values.hasReflection.ref.value?b.disable(v.CULL_FACE):b.enable(v.CULL_FACE):b.disable(v.CULL_FACE),(null===(s=n.values.dFlipSided)||void 0===s?void 0:s.ref.value)?(b.frontFace(v.CW),b.cullFace(v.FRONT)):(b.frontFace(v.CCW),b.cullFace(v.BACK)))
n.render(r,k.length)},ne=(e,t,n,r,i)=>{(0,d.$6)(k,"tDepth",n||E),W=t.scale,l.IQ.update(K.uModel,a.$I.scaleUniformly(D,e.view,W)),l.IQ.update(K.uModelView,a.$I.mul(O,t.view,D)),l.IQ.update(K.uInvModelView,a.$I.invert(L,O)),l.IQ.update(K.uModelViewProjection,a.$I.mul(F,O,t.projection)),l.IQ.update(K.uInvModelViewProjection,a.$I.invert(z,F)),l.IQ.updateIfChanged(K.uRenderMask,r),l.IQ.updateIfChanged(K.uMarkingDepthTest,i),a.$I.isZero(t.viewEye)?(l.IQ.updateIfChanged(K.uHasEyeCamera,!1),l.IQ.updateIfChanged(K.uModelViewEye,a.$I.id),l.IQ.updateIfChanged(K.uInvModelViewEye,a.$I.id)):(l.IQ.updateIfChanged(K.uHasEyeCamera,!0),l.IQ.update(K.uModelViewEye,a.$I.mul(V,t.viewEye,D)),l.IQ.update(K.uInvModelViewEye,a.$I.invert(U,V))),b.enable(v.SCISSOR_TEST),b.colorMask(!0,!0,!0,!0)
const{x:o,y:s,width:c,height:u}=T
b.viewport(o,s,c,u),b.scissor(o,s,c,u),ee=!0,b.currentRenderItemId=-1},re=function(e){var t,n,r,i
const o=(0,p.qE)(e.values.alpha.ref.value*e.state.alphaFactor,0,1),a="on"===(null===(t=e.values.dXrayShaded)||void 0===t?void 0:t.ref.value)||"inverted"===(null===(n=e.values.dXrayShaded)||void 0===n?void 0:n.ref.value)
return 1===o&&1!==e.values.transparencyAverage.ref.value&&"directVolume"!==e.values.dGeometryType.ref.value&&"fuzzy"!==(null===(r=e.values.dPointStyle)||void 0===r?void 0:r.ref.value)&&!a||"opaque"===(null===(i=e.values.dTransparentBackfaces)||void 0===i?void 0:i.ref.value)},ie=function(e){var t,n,r
const i=(0,p.qE)(e.values.alpha.ref.value*e.state.alphaFactor,0,1),o="on"===(null===(t=e.values.dXrayShaded)||void 0===t?void 0:t.ref.value)||"inverted"===(null===(n=e.values.dXrayShaded)||void 0===n?void 0:n.ref.value)
return 0!==i&&(i<1||e.values.transparencyAverage.ref.value>0||"directVolume"===e.values.dGeometryType.ref.value||"fuzzy"===(null===(r=e.values.dPointStyle)||void 0===r?void 0:r.ref.value)||"text"===e.values.dGeometryType.ref.value||"image"===e.values.dGeometryType.ref.value||o)},oe=(r,i)=>{h.g$&&e.timer.mark("Renderer.renderOpaque"),b.disable(v.BLEND),b.enable(v.DEPTH_TEST),b.depthMask(!0),ne(r,i,null,n.Opaque,!1)
const{renderables:o}=r
for(let e=0,n=o.length;e<n;++e){const n=o[e]
re(n)&&te(n,"color",t.None)}h.g$&&e.timer.markEnd("Renderer.renderOpaque")},ae=(r,i)=>{var o,a
h.g$&&e.timer.mark("Renderer.renderBlendedTransparent"),P?b.blendFunc(v.ONE,v.ONE_MINUS_SRC_ALPHA):b.blendFuncSeparate(v.SRC_ALPHA,v.ONE_MINUS_SRC_ALPHA,v.ONE,v.ONE_MINUS_SRC_ALPHA),b.enable(v.BLEND),b.enable(v.DEPTH_TEST),b.depthMask(!1),ne(r,i,null,n.Transparent,!1)
const{renderables:s}=r
for(let e=0,n=s.length;e<n;++e){const n=s[e]
ie(n)&&((null===(o=n.values.uDoubleSided)||void 0===o?void 0:o.ref.value)?("opaque"!==(null===(a=n.values.dTransparentBackfaces)||void 0===a?void 0:a.ref.value)&&te(n,"color",t.BlendedBack),te(n,"color",t.BlendedFront)):te(n,"color",t.None))}h.g$&&e.timer.markEnd("Renderer.renderBlendedTransparent")}
return{clear:(e,t,n)=>{b.enable(v.SCISSOR_TEST),b.enable(v.DEPTH_TEST),b.colorMask(!0,!0,!0,!0),b.depthMask(!0),n||P&&!t?b.clearColor(0,0,0,0):e?b.clearColor(I[0],I[1],I[2],1):b.clearColor(1,1,1,1),v.clear(v.COLOR_BUFFER_BIT|v.DEPTH_BUFFER_BIT)},clearDepth:(e=!1)=>{b.enable(v.SCISSOR_TEST),b.enable(v.DEPTH_TEST),b.depthMask(!0),e?(b.colorMask(!0,!0,!0,!0),b.clearColor(1,1,1,1),v.clear(v.COLOR_BUFFER_BIT|v.DEPTH_BUFFER_BIT)):v.clear(v.DEPTH_BUFFER_BIT)},update:(e,t)=>{l.IQ.update(K.uView,e.view),l.IQ.update(K.uInvView,a.$I.invert(R,e.view)),l.IQ.update(K.uProjection,e.projection),l.IQ.update(K.uInvProjection,a.$I.invert(N,e.projection)),l.IQ.updateIfChanged(K.uIsOrtho,"orthographic"===e.state.mode?1:0),l.IQ.update(K.uViewOffset,e.viewOffset.enabled?a.ZY.set($,16*e.viewOffset.offsetX,16*e.viewOffset.offsetY):a.ZY.set($,0,0)),l.IQ.updateIfChanged(K.uModelScale,e.scale),l.IQ.update(K.uCameraPosition,a.$I.getTranslation(H,R)),a.eB.scale(q,e.state.target,e.scale),a.eB.normalize(G,a.eB.sub(G,q,H)),l.IQ.update(K.uCameraDir,G),l.IQ.updateIfChanged(K.uFar,e.far),l.IQ.updateIfChanged(K.uNear,e.near),l.IQ.updateIfChanged(K.uFog,e.state.fog>0),l.IQ.updateIfChanged(K.uFogFar,e.fogFar),l.IQ.updateIfChanged(K.uFogNear,e.fogNear),l.IQ.updateIfChanged(K.uTransparentBackground,P),f.Q.fromProjectionMatrix(X,e.projectionView),m.i.copy(Q,X[f.Q.PlaneIndex.Near]),Q.constant-=m.i.distanceToPoint(Q,H),l.IQ.update(K.uCameraPlane,m.i.toArray(Q,K.uCameraPlane.ref.value,0)),l.IQ.updateIfChanged(K.uMarkerAverage,t.markerAverage),a.$I.isZero(e.headRotation)?(l.IQ.updateIfChanged(K.uHasHeadRotation,!1),l.IQ.updateIfChanged(K.uInvHeadRotation,a.$I.id),l.IQ.update(K.uLightDirection,w.direction)):(l.IQ.updateIfChanged(K.uHasHeadRotation,!0),l.IQ.update(K.uInvHeadRotation,a.$I.invert(j,e.headRotation)),l.IQ.update(K.uLightDirection,S(w,j))),l.IQ.update(K.uIsAsymmetricProjection,e.isAsymmetricProjection)},renderPick:(r,i,o,a)=>{h.g$&&e.timer.mark("Renderer.renderPick"),b.disable(v.BLEND),b.enable(v.DEPTH_TEST),b.depthMask(!0),ne(r,i,null,n.All,!1),l.IQ.updateIfChanged(K.uPickType,a)
const{renderables:s}=r
for(let e=0,n=s.length;e<n;++e)s[e].state.colorOnly||te(s[e],o,t.None)
h.g$&&e.timer.markEnd("Renderer.renderPick")},renderDepth:(r,i)=>{h.g$&&e.timer.mark("Renderer.renderDepth"),b.disable(v.BLEND),b.enable(v.DEPTH_TEST),b.depthMask(!0),ne(r,i,null,n.All,!1)
const{renderables:o}=r
for(let e=0,n=o.length;e<n;++e)te(o[e],"depth",t.None)
h.g$&&e.timer.markEnd("Renderer.renderDepth")},renderDepthOpaque:(r,i)=>{h.g$&&e.timer.mark("Renderer.renderDepthOpaque"),b.disable(v.BLEND),b.enable(v.DEPTH_TEST),b.depthMask(!0),ne(r,i,null,n.Opaque,!1)
const{renderables:o}=r
for(let e=0,n=o.length;e<n;++e){const n=o[e]
re(n)&&te(n,"depth",t.None)}h.g$&&e.timer.markEnd("Renderer.renderDepthOpaque")},renderDepthOpaqueBack:(r,i)=>{h.g$&&e.timer.mark("Renderer.renderDepthOpaqueBack"),b.disable(v.BLEND),b.enable(v.DEPTH_TEST),b.depthMask(!0),b.depthFunc(v.GREATER),ne(r,i,null,n.Opaque,!1)
const{renderables:o}=r
for(let e=0,n=o.length;e<n;++e){const n=o[e]
re(n)&&te(n,"depth",t.BlendedBack)}b.depthFunc(v.LESS),h.g$&&e.timer.markEnd("Renderer.renderDepthOpaqueBack")},renderDepthTransparent:(r,i,o)=>{h.g$&&e.timer.mark("Renderer.renderDepthTransparent"),b.disable(v.BLEND),b.enable(v.DEPTH_TEST),b.depthMask(!0),ne(r,i,o,n.Transparent,!1)
const{renderables:a}=r
for(let e=0,n=a.length;e<n;++e){const n=a[e]
ie(n)&&te(n,"depth",t.None)}h.g$&&e.timer.markEnd("Renderer.renderDepthTransparent")},renderMarkingDepth:(r,o)=>{h.g$&&e.timer.mark("Renderer.renderMarkingDepth"),b.disable(v.BLEND),b.enable(v.DEPTH_TEST),b.depthMask(!0),ne(r,o,null,n.All,!1),l.IQ.updateIfChanged(K.uMarkingType,i.Depth)
const{renderables:a}=r
for(let e=0,n=a.length;e<n;++e){const n=a[e]
0!==(0,p.qE)(n.values.alpha.ref.value*n.state.alphaFactor,0,1)&&1!==n.values.transparencyAverage.ref.value&&1!==n.values.markerAverage.ref.value&&te(a[e],"marking",t.None)}h.g$&&e.timer.markEnd("Renderer.renderMarkingDepth")},renderMarkingMask:(r,o,a)=>{h.g$&&e.timer.mark("Renderer.renderMarkingMask"),b.disable(v.BLEND),b.enable(v.DEPTH_TEST),b.depthMask(!0),ne(r,o,a,n.All,!!a),l.IQ.updateIfChanged(K.uMarkingType,i.Mask)
const{renderables:s}=r
for(let e=0,n=s.length;e<n;++e)s[e].values.markerAverage.ref.value>0&&te(s[e],"marking",t.None)
h.g$&&e.timer.markEnd("Renderer.renderMarkingMask")},renderEmissive:(r,i)=>{h.g$&&e.timer.mark("Renderer.renderEmissive"),b.disable(v.BLEND),b.enable(v.DEPTH_TEST),b.depthMask(!0),ne(r,i,null,n.Opaque,!1)
const{renderables:o}=r
for(let e=0,n=o.length;e<n;++e){const n=o[e]
re(n)&&te(n,"emissive",t.None)}h.g$&&e.timer.markEnd("Renderer.renderEmissive")},renderTracing:(r,i)=>{h.g$&&e.timer.mark("Renderer.renderTracing"),b.disable(v.BLEND),b.enable(v.DEPTH_TEST),b.depthMask(!0),ne(r,i,null,n.Opaque,!1)
const{renderables:o}=r
for(let e=0,n=o.length;e<n;++e){const n=o[e]
re(n)&&te(n,"tracing",t.None)}h.g$&&e.timer.markEnd("Renderer.renderTracing")},renderBlended:(e,t)=>{e.hasOpaque&&oe(e,t),e.opacityAverage<1&&ae(e,t)},renderOpaque:oe,renderBlendedTransparent:ae,renderVolume:(r,i,o)=>{h.g$&&e.timer.mark("Renderer.renderVolume"),b.blendFunc(v.ONE,v.ONE_MINUS_SRC_ALPHA),b.enable(v.BLEND),b.disable(v.DEPTH_TEST),b.depthMask(!1),ne(r,i,o,n.Transparent,!1)
const{renderables:a}=r
for(let e=0,n=a.length;e<n;++e){const n=a[e]
"directVolume"===n.values.dGeometryType.ref.value&&te(n,"color",t.None)}h.g$&&e.timer.markEnd("Renderer.renderVolume")},renderWboitTransparent:(r,i,o)=>{h.g$&&e.timer.mark("Renderer.renderWboitTransparent"),ne(r,i,o,n.Transparent,!1)
const{renderables:a}=r
for(let e=0,n=a.length;e<n;++e){const n=a[e]
ie(n)&&te(n,"color",t.None)}h.g$&&e.timer.markEnd("Renderer.renderWboitTransparent")},renderDpoitTransparent:(r,i,o,a)=>{h.g$&&e.timer.mark("Renderer.renderDpoitTransparent"),b.enable(v.BLEND),(0,d.$6)(k,"tDpoitDepth",a.depth),(0,d.$6)(k,"tDpoitFrontColor",a.frontColor),(0,d.$6)(k,"tDpoitBackColor",a.backColor),ne(r,i,o,n.Transparent,!1)
const{renderables:s}=r
for(let e=0,n=s.length;e<n;++e){const n=s[e]
ie(n)&&te(n,"color",t.None)}h.g$&&e.timer.markEnd("Renderer.renderDpoitTransparent")},setProps:e=>{void 0!==e.backgroundColor&&e.backgroundColor!==C.backgroundColor&&(C.backgroundColor=e.backgroundColor,s.Color.toVec3Normalized(I,C.backgroundColor),l.IQ.update(K.uFogColor,a.eB.copy(K.uFogColor.ref.value,I))),void 0!==e.pickingAlphaThreshold&&e.pickingAlphaThreshold!==C.pickingAlphaThreshold&&(C.pickingAlphaThreshold=e.pickingAlphaThreshold,l.IQ.update(K.uPickingAlphaThreshold,C.pickingAlphaThreshold)),void 0!==e.colorMarker&&e.colorMarker!==C.colorMarker&&(C.colorMarker=e.colorMarker),void 0!==e.highlightColor&&e.highlightColor!==C.highlightColor&&(C.highlightColor=e.highlightColor,l.IQ.update(K.uHighlightColor,s.Color.toVec3Normalized(K.uHighlightColor.ref.value,C.highlightColor))),void 0!==e.selectColor&&e.selectColor!==C.selectColor&&(C.selectColor=e.selectColor,l.IQ.update(K.uSelectColor,s.Color.toVec3Normalized(K.uSelectColor.ref.value,C.selectColor))),void 0!==e.dimColor&&e.dimColor!==C.dimColor&&(C.dimColor=e.dimColor,l.IQ.update(K.uDimColor,s.Color.toVec3Normalized(K.uDimColor.ref.value,C.dimColor))),void 0!==e.highlightStrength&&e.highlightStrength!==C.highlightStrength&&(C.highlightStrength=e.highlightStrength,l.IQ.update(K.uHighlightStrength,C.highlightStrength)),void 0!==e.selectStrength&&e.selectStrength!==C.selectStrength&&(C.selectStrength=e.selectStrength,l.IQ.update(K.uSelectStrength,C.selectStrength)),void 0!==e.dimStrength&&e.dimStrength!==C.dimStrength&&(C.dimStrength=e.dimStrength,l.IQ.update(K.uDimStrength,C.dimStrength)),void 0!==e.markerPriority&&e.markerPriority!==C.markerPriority&&(C.markerPriority=e.markerPriority,l.IQ.update(K.uMarkerPriority,C.markerPriority)),void 0!==e.xrayEdgeFalloff&&e.xrayEdgeFalloff!==C.xrayEdgeFalloff&&(C.xrayEdgeFalloff=e.xrayEdgeFalloff,l.IQ.update(K.uXrayEdgeFalloff,C.xrayEdgeFalloff)),void 0!==e.celSteps&&e.celSteps!==C.celSteps&&(C.celSteps=e.celSteps,l.IQ.update(K.uCelSteps,C.celSteps)),void 0!==e.exposure&&e.exposure!==C.exposure&&(C.exposure=e.exposure,l.IQ.update(K.uExposure,C.exposure)),void 0===e.light||(0,l.bD)(e.light,C.light)||(C.light=e.light,Object.assign(w,x(e.light,w)),l.IQ.update(K.uLightDirection,w.direction),l.IQ.update(K.uLightColor,w.color)),void 0!==e.ambientColor&&e.ambientColor!==C.ambientColor&&(C.ambientColor=e.ambientColor,a.eB.scale(Z,s.Color.toArrayNormalized(C.ambientColor,Z,0),C.ambientIntensity),l.IQ.update(K.uAmbientColor,Z)),void 0!==e.ambientIntensity&&e.ambientIntensity!==C.ambientIntensity&&(C.ambientIntensity=e.ambientIntensity,a.eB.scale(Z,s.Color.toArrayNormalized(C.ambientColor,Z,0),C.ambientIntensity),l.IQ.update(K.uAmbientColor,Z))},setViewport:(e,t,n,r)=>{b.viewport(e,t,n,r),b.scissor(e,t,n,r),e===T.x&&t===T.y&&n===T.width&&r===T.height||(o.LM.set(T,e,t,n,r),l.IQ.update(K.uViewport,a.Zb.set(K.uViewport.ref.value,e,t,n,r)))},setTransparentBackground:e=>{P=e},setDrawingBufferSize:(e,t)=>{e===A[0]&&t===A[1]||l.IQ.update(K.uDrawingBufferSize,a.ZY.set(A,e,t))},setPixelRatio:e=>{l.IQ.update(K.uPixelRatio,e)},setOcclusionTest:e=>{B=e},props:C,get stats(){return{programCount:e.stats.resourceCounts.program,shaderCount:e.stats.resourceCounts.shader,attributeCount:e.stats.resourceCounts.attribute,elementsCount:e.stats.resourceCounts.elements,framebufferCount:e.stats.resourceCounts.framebuffer,renderbufferCount:e.stats.resourceCounts.renderbuffer,textureCount:e.stats.resourceCounts.texture,vertexArrayCount:e.stats.resourceCounts.vertexArray,drawCount:_.drawCount,instanceCount:_.instanceCount,instancedDrawCount:_.instancedDrawCount}},get light(){return w},get ambientColor(){return K.uAmbientColor.ref.value},dispose:()=>{}}}}(_||(_={}))},56825(e,t,n){"use strict"
function r([e]){return Math.tanh(e)}n.r(t),n.d(t,{default:()=>i,tanh:()=>r})
var i=(0,n(10336).helper)(r)},57320(e,t,n){"use strict"
function r([e]){return Math.sin(e)}n.r(t),n.d(t,{default:()=>i,sin:()=>r})
var i=(0,n(10336).helper)(r)},57331(e,t,n){"use strict"
n.d(t,{jH:()=>E,y1:()=>I,dr:()=>P,UT:()=>j,Z4:()=>D})
var r=n(28074),i=n(25602),o=n(32775),a=n(7928),s=n(32372),l=n(54749),c=n(1712),u=n(28269),d=n(69396),p=n(92384),h=n(12288),f=n(46098),m=n(95408),g=n(52095),y=n(38981),v=n(41288)
class b extends i.PureComponent{render(){const{legend:e}=this.props,t=e.colors.map(e=>Array.isArray(e)?`${l.Color.toStyle(e[0])} ${100*e[1]}%`:l.Color.toStyle(e)).join(", ")
return(0,r.jsx)("div",{className:"msp-scale-legend",children:(0,r.jsxs)("div",{style:{background:`linear-gradient(to right, ${t})`},children:[(0,r.jsx)("span",{style:{float:"left"},children:e.minLabel}),(0,r.jsx)("span",{style:{float:"right"},children:e.maxLabel})]})})}}class x extends i.PureComponent{render(){const{legend:e}=this.props
return(0,r.jsx)("div",{className:"msp-table-legend",children:e.table.map((e,t)=>{const[n,i]=e
return(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"msp-table-legend-color",style:{backgroundColor:l.Color.toStyle(i)}}),(0,r.jsx)("div",{className:"msp-table-legend-text",children:n})]},t)})})}}class S extends i.Component{constructor(e){super(e),this.state={show:!1},this.handleHover=this.handleHover.bind(this),this.handleHoverOff=this.handleHoverOff.bind(this),this.deletePoint=this.deletePoint.bind(this)}handleHover(){this.setState({show:!0})
const e=o.ZY.create(this.props.nX,this.props.nY)
this.props.onmouseover(e)}handleHoverOff(){this.setState({show:!1}),this.props.onmouseover(void 0)}deletePoint(){this.props.delete(this.props.id)}render(){return[(0,r.jsx)("circle",{r:"10",id:`${this.props.id}`,cx:this.props.x,cy:this.props.y,onClick:this.props.onclick,onDoubleClick:this.props.delete(this.props.id),onMouseEnter:this.handleHover,onMouseLeave:this.handleHoverOff,onMouseDown:this.props.onmousedown,fill:"black"},`${this.props.id}circle`)]}}var _=n(90050),C=n(63356)
class w extends i.Component{constructor(e){super(e),this.handleKeyDown=e=>{},this.handleKeyUp=e=>{},this.handleClick=e=>e=>{},this.handleMouseDown=e=>t=>{if(0===e||e===this.state.points.length-1)return
if(this.state.canSelectMultiple)return
const n=this.normalizePoint(o.ZY.create(this.state.points[e][0],this.state.points[e][1]))
this.ghostPoints.push(document.createElementNS(this.namespace,"circle")),this.ghostPoints[0].setAttribute("r","10"),this.ghostPoints[0].setAttribute("fill","orange"),this.ghostPoints[0].setAttribute("cx",`${n[0]}`),this.ghostPoints[0].setAttribute("cy",`${n[1]}`),this.ghostPoints[0].setAttribute("style","display: none"),this.gElement.appendChild(this.ghostPoints[0]),this.updatedX=n[0],this.updatedY=n[1],this.selected=[e]},this.deletePoint=e=>t=>{if(0===e||e===this.state.points.length-1)return
const n=this.state.points.filter((t,n)=>n!==e)
n.sort((e,t)=>e[0]===t[0]?0===e[0]?e[1]-t[1]:1===e[1]?t[1]-e[1]:e[1]-t[1]:e[0]-t[0]),this.setState({points:n}),this.change(n),t.stopPropagation()},this.myRef=i.createRef(),this.state={points:[o.ZY.create(0,0),o.ZY.create(1,0)],copyPoint:void 0,canSelectMultiple:!1},this.height=400,this.width=600,this.padding=70,this.selected=void 0,this.ghostPoints=[],this.namespace="http://www.w3.org/2000/svg"
for(const t of this.props.data)this.state.points.push(t)
this.state.points.sort((e,t)=>e[0]===t[0]?0===e[0]?e[1]-t[1]:1===e[1]?t[1]-e[1]:e[1]-t[1]:e[0]-t[0]),this.handleDrag=this.handleDrag.bind(this),this.handleMultipleDrag=this.handleMultipleDrag.bind(this),this.handleDoubleClick=this.handleDoubleClick.bind(this),this.refCallBack=this.refCallBack.bind(this),this.handlePointUpdate=this.handlePointUpdate.bind(this),this.change=this.change.bind(this),this.handleKeyUp=this.handleKeyUp.bind(this),this.handleLeave=this.handleLeave.bind(this),this.handleEnter=this.handleEnter.bind(this)}render(){const e=this.renderPoints(),t=this.renderLines(),n=this.renderHistogram()
return[(0,r.jsx)("div",{children:(0,r.jsxs)("svg",{className:"msp-canvas",ref:this.refCallBack,viewBox:`0 0 ${this.width+this.padding} ${this.height+this.padding}`,onMouseMove:this.handleDrag,onMouseUp:this.handlePointUpdate,onMouseLeave:this.handleLeave,onMouseEnter:this.handleEnter,tabIndex:0,onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,onDoubleClick:this.handleDoubleClick,children:[(0,r.jsxs)("g",{stroke:"black",fill:"black",children:[n,t,e]}),(0,r.jsx)("g",{className:"ghost-points",stroke:"black",fill:"black"})]})},"LineGraph"),(0,r.jsx)("div",{id:"modal-root"},"modal")]}componentDidMount(){this.gElement=document.getElementsByClassName("ghost-points")[0]}change(e){const t=e.slice()
t.shift(),t.pop(),this.props.onChange(t)}handleDrag(e){if(void 0===this.selected)return
const t=this.myRef.createSVGPoint()
let n
const r=this.padding/2
t.x=e.clientX,t.y=e.clientY
const i=t.matrixTransform(this.myRef.getScreenCTM().inverse())
n=o.ZY.create(i.x,i.y),n=(i.x<r||i.x>this.width+r)&&(i.y>this.height+r||i.y<r)?o.ZY.create(this.updatedX,this.updatedY):i.x<r?o.ZY.create(r,i.y):i.x>this.width+r?o.ZY.create(this.width+r,i.y):i.y>this.height+r?o.ZY.create(i.x,this.height+r):i.y<r?o.ZY.create(i.x,r):o.ZY.create(i.x,i.y),this.updatedX=n[0],this.updatedY=n[1]
const a=this.unNormalizePoint(n)
this.ghostPoints[0].setAttribute("style","display: visible"),this.ghostPoints[0].setAttribute("cx",`${n[0]}`),this.ghostPoints[0].setAttribute("cy",`${n[1]}`),this.props.onDrag(a)}handleMultipleDrag(){}handlePointUpdate(e){const t=this.selected
if(this.state.canSelectMultiple)return
if(void 0===t||0===t[0]||t[0]===this.state.points.length-1)return void this.setState({copyPoint:void 0})
this.selected=void 0
const n=this.unNormalizePoint(o.ZY.create(this.updatedX,this.updatedY)),r=this.state.points.filter((e,n)=>n!==t[0])
r.push(n),r.sort((e,t)=>e[0]===t[0]?0===e[0]?e[1]-t[1]:1===e[1]?t[1]-e[1]:e[1]-t[1]:e[0]-t[0]),this.setState({points:r}),this.change(r),this.gElement.innerHTML="",this.ghostPoints=[],document.removeEventListener("mousemove",this.handleDrag,!0),document.removeEventListener("mouseup",this.handlePointUpdate,!0)}handleDoubleClick(e){const t=this.myRef.createSVGPoint()
t.x=e.clientX,t.y=e.clientY
const n=t.matrixTransform(this.myRef.getScreenCTM().inverse()),r=this.state.points,i=this.padding/2
if(n.x<i||n.x>this.width+i||n.y>this.height+i||n.y<this.padding/2)return
const a=this.unNormalizePoint(o.ZY.create(n.x,n.y))
r.push(a),r.sort((e,t)=>e[0]===t[0]?0===e[0]?e[1]-t[1]:1===e[1]?t[1]-e[1]:e[1]-t[1]:e[0]-t[0]),this.setState({points:r}),this.change(r)}handleLeave(){void 0!==this.selected&&(document.addEventListener("mousemove",this.handleDrag,!0),document.addEventListener("mouseup",this.handlePointUpdate,!0))}handleEnter(){document.removeEventListener("mousemove",this.handleDrag,!0),document.removeEventListener("mouseup",this.handlePointUpdate,!0)}normalizePoint(e){const t=this.padding/2,n=this.width+t,r=this.height+t,i=e[0]*(n-t)+t,a=e[1]*(r-t)+t,s=this.height+this.padding-a
return o.ZY.create(i,s)}unNormalizePoint(e){const t=this.padding/2,n=this.width+t,r=this.height+t,i=(e[0]-t)/(n-t),a=(this.height+this.padding-e[1]-t)/(r-t)
return o.ZY.create(i,a)}refCallBack(e){e&&(this.myRef=e)}renderHistogram(){if(!this.props.volume)return null
const e=_.x.getHistogram(this.props.volume.grid,40),t=[],n=e.counts.length,i=this.width/n,o=this.padding/2,a=(0,C._M)(e.counts)||1
for(let s=0;s<n;s++){const l=this.width*s/(n-1)+o,c=this.height+o,u=this.height*(1-e.counts[s]/a)+o
t.push((0,r.jsx)("line",{x1:l,x2:l,y1:c,y2:u,stroke:"#ded9ca",strokeWidth:i},`histogram${s}`))}return t}renderPoints(){const e=[]
let t
for(let n=0;n<this.state.points.length;n++)0!==n&&n!==this.state.points.length-1&&(t=this.normalizePoint(this.state.points[n]),e.push((0,r.jsx)(S,{id:n,x:t[0],y:t[1],nX:this.state.points[n][0],nY:this.state.points[n][1],selected:!1,delete:this.deletePoint,onmouseover:this.props.onHover,onmousedown:this.handleMouseDown(n),onclick:this.handleClick(n)},n)))
return e}renderLines(){const e=[],t=[]
let n,i,a,s,l
const c=this.padding/2
for(const r of this.state.points)n=this.width+c,i=this.height+this.padding,a=r[0]*(n-c)+c,s=r[1]*(i-c)+c,l=this.height+this.padding-s,e.push(o.ZY.create(a,l))
const u=e,d=u.length
for(let o=0;o<d-1;o++){const e=u[o][0],n=u[o][1],i=u[o+1][0],a=u[o+1][1]
t.push((0,r.jsx)("line",{x1:e,x2:i,y1:n,y2:a,stroke:"#cec9ba",strokeWidth:"5"},`lineOf${o}`))}return t}}var T=n(87877),A=n(59048)
class I extends i.PureComponent{constructor(){super(...arguments),this.onChange=e=>{var t,n
if(null===(n=(t=this.props).onChange)||void 0===n||n.call(t,e,this.props.values),this.props.onChangeValues){const t={...this.props.values,[e.name]:e.value}
this.props.onChangeValues(t,this.props.values)}},this.paramGroups=(0,u._)(e=>function(e){function t(e,t,n){const r=B(t)
if(r)if(t.category){n.map||(n.map=new Map)
let i=n.map.get(t.category)
i||(i=[],n.map.set(t.category,i),n.params.push(i)),i.push([e,t,r])}else n.params[0].push([e,t,r])}function n(e,t){const n=e[0],r=t[0]
return n&&n[1].category?r&&r[1].category&&n[1].category<r[1].category?-1:1:-1}const r=Object.keys(e),i={params:[[]],map:void 0},o={params:[[]],map:void 0}
for(const a of r){const n=e[a]
n.isHidden||(n.isEssential?t(a,n,i):t(a,n,o))}return i.params.sort(n),o.params.sort(n),{essentials:i.params,advanced:o.params}}(e))}renderGroup(e){var t
if(0===e.length)return null
const n=this.props.values
let i,o=null
for(const[a,s,l]of e)(null===(t=s.hideIf)||void 0===t?void 0:t.call(s,n))||(o||(o=[]),i=s.category,o.push((0,r.jsx)(l,{param:s,onChange:this.onChange,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled,name:a,value:n[a]},a)))
return o?i?[(0,r.jsx)(y.Yj,{header:i,children:o},i)]:o:null}renderPart(e){let t=null
for(const n of e){const e=this.renderGroup(n)
if(e){t||(t=[])
for(const n of e)t.push(n)}}return t}render(){const e=this.paramGroups(this.props.params),t=this.renderPart(e.essentials),n=this.renderPart(e.advanced)
return t&&n?(0,r.jsxs)(r.Fragment,{children:[t,(0,r.jsx)(y.Yj,{header:"Advanced Options",children:n})]}):t||n}}class P extends f.dL{constructor(){super(...arguments),this.state={isDisabled:!1},this.setSettings=(e,t)=>{const n={...t,[e.name]:e.value},r=this.props.mapping.update(n,this.plugin)
this.props.mapping.apply(r,this.plugin)}}componentDidMount(){this.subscribe(this.plugin.state.data.behaviors.isUpdating,e=>{this.setState({isDisabled:e})})}render(){const e=this.props.mapping.getTarget(this.plugin),t=this.props.mapping.getValues(e,this.plugin),n=this.props.mapping.params(this.plugin)
return(0,r.jsx)(I,{params:n,values:t,onChange:this.setSettings,isDisabled:this.state.isDisabled})}}function B(e){switch(e.type){case"value":case"data-ref":return
case"boolean":return R
case"number":return void 0!==e.min&&void 0!==e.max?N:L
case"converted":return ue
case"conditioned":return ce
case"multi-select":return re
case"color":return g.cq
case"color-list":return e.offsets?Z:Y
case"vec3":return K
case"mat4":return J
case"url":return ee
case"file":return te
case"file-list":return ne
case"select":return V
case"value-ref":return U
case"text":return F
case"interval":return void 0!==e.min&&void 0!==e.max?H:G
case"group":return ie
case"mapped":return oe
case"line-graph":return O
case"script":return de
case"object-list":return le
default:const t=e
return void console.warn(`${t} has no associated UI component`)}}class E extends i.PureComponent{render(){const{legend:e,description:t}=this.props,n=e&&function(e){switch(e.kind){case"scale-legend":return b
case"table-legend":return x
default:const t=e
return void console.warn(`${t} has no associated UI component`)}}(e)
return(0,r.jsx)("div",{className:"msp-help-text",children:(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"msp-help-description",children:[(0,r.jsx)(v.In,{svg:v.ml,inline:!0}),t]}),n&&(0,r.jsx)("div",{className:"msp-help-legend",children:(0,r.jsx)(n,{legend:e})})]})})}}function k(e){const{props:t,state:n,control:i,toggleHelp:o,addOn:a}=e,s=[]
t.param.shortLabel&&s.push("msp-control-label-short"),t.param.twoColumns&&s.push("msp-control-col-2"),t.param.multiline&&s.push("msp-control-twoline")
const l=s.join(" "),c=t.param.label||(0,h.Hh)(t.name),u=t.param.help?t.param.help(t.value):{description:t.param.description,legend:t.param.legend},d=u.description||u.legend,p=c+(d?". Click for help.":"")
return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(y.eJ,{className:l,title:p,label:(0,r.jsxs)(r.Fragment,{children:[c,d&&(0,r.jsx)(D,{show:n.showHelp,toggle:o,title:p})]}),control:i}),d&&n.showHelp&&(0,r.jsx)("div",{className:"msp-control-offset",children:(0,r.jsx)(E,{legend:u.legend,description:u.description})}),a]})}function D({show:e,toggle:t,title:n}){return(0,r.jsx)("button",{className:"msp-help msp-btn-link msp-btn-icon msp-control-group-expander",onClick:t,title:n||(e?"Hide":"Show")+" help",style:{background:"transparent",textAlign:"left",padding:"0"},children:(0,r.jsx)(v.In,{svg:v.ml})})}class M extends i.PureComponent{constructor(){super(...arguments),this.state={showHelp:!1},this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}update(e){this.props.onChange({param:this.props.param,name:this.props.name,value:e})}renderAddOn(){return null}render(){return k({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})}}class R extends M{constructor(){super(...arguments),this.onClick=e=>{this.update(!this.props.value),e.currentTarget.blur()}}renderControl(){return(0,r.jsxs)("button",{onClick:this.onClick,disabled:this.props.isDisabled,children:[(0,r.jsx)(v.In,{svg:this.props.value?v.Xq:v.CQ}),this.props.value?"On":"Off"]})}}class O extends i.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1,isOverPoint:!1,message:`${this.props.param.defaultValue.length} points`},this.onHover=e=>{this.setState({isOverPoint:!this.state.isOverPoint}),e?this.setState({message:this.pointToLabel(e)}):this.setState({message:`${this.props.value.length} points`})},this.onDrag=e=>{this.setState({message:this.pointToLabel(e)})},this.onChange=e=>{this.props.onChange({name:this.props.name,param:this.props.param,value:e})},this.toggleExpanded=e=>{this.setState({isExpanded:!this.state.isExpanded}),e.currentTarget.blur()}}pointToLabel(e){var t,n
if(!e)return""
const r=null===(n=(t=this.props.param).getVolume)||void 0===n?void 0:n.call(t)
if(r){const{min:t,max:n,mean:i,sigma:o}=r.grid.stats,a=t+(n-t)*e[0],s=(a-i)/o
return`(${a.toFixed(2)} | ${s.toFixed(2)}, ${e[1].toFixed(2)})`}return`(${e[0].toFixed(2)}, ${e[1].toFixed(2)})`}render(){var e,t
const n=this.props.param.label||(0,h.Hh)(this.props.name)
return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(y.eJ,{label:n,control:(0,r.jsx)("button",{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:`${this.state.message}`})}),(0,r.jsx)("div",{className:"msp-control-offset",style:{display:this.state.isExpanded?"block":"none",marginTop:1},children:(0,r.jsx)(w,{data:this.props.value,volume:null===(t=(e=this.props.param).getVolume)||void 0===t?void 0:t.call(e),onChange:this.onChange,onHover:this.onHover,onDrag:this.onDrag})})]})}}class L extends i.PureComponent{constructor(){super(...arguments),this.state={value:"0"},this.update=e=>{const t=(0,d.XV)(this.props.param.step||.01)
e=parseFloat(e.toFixed(t)),this.props.onChange({param:this.props.param,name:this.props.name,value:e})}}render(){const e=this.props.param.label||(0,h.Hh)(this.props.name),t=this.props.param.label||(0,h.Hh)(this.props.name),n=(0,d.XV)(this.props.param.step||.01)
return(0,r.jsx)(y.eJ,{title:this.props.param.description,label:t,control:(0,r.jsx)(y.ks,{numeric:!0,value:parseFloat(this.props.value.toFixed(n)),onEnter:this.props.onEnter,placeholder:e,isDisabled:this.props.isDisabled,onChange:this.update})})}}class N extends M{constructor(){super(...arguments),this.onChange=e=>{this.update(e)}}renderControl(){const e=void 0===this.props.value?this.props.param.defaultValue:this.props.value
return(0,r.jsx)(T.Ap,{value:e,min:this.props.param.min,max:this.props.param.max,step:this.props.param.step,onChange:this.onChange,onChangeImmediate:this.props.param.immediateUpdate?this.onChange:void 0,disabled:this.props.isDisabled,onEnter:this.props.onEnter})}}class F extends M{constructor(){super(...arguments),this.updateValue=e=>{e!==this.props.value&&this.update(e)}}renderControl(){const e=this.props.param.placeholder||this.props.param.label||(0,h.Hh)(this.props.name)
return(0,r.jsx)(z,{props:this.props,placeholder:e,update:this.updateValue})}}function z({props:e,placeholder:t,update:n}){const[o,a]=i.useState(e.value),[s,l]=i.useState(!1)
i.useEffect(()=>a(e.value),[e.value])
const c=t=>{s||e.param.disableInteractiveUpdates?a(t.target.value):n(t.target.value)},u=t=>{l(!1)
const r=t.target
e.param.disableInteractiveUpdates?a(r.value):n(r.value)},d=t=>{e.param.disableInteractiveUpdates&&n(t.target.value)},p=t=>{"Enter"===t.key&&(e.onEnter&&!e.param.multiline?(t.stopPropagation(),e.onEnter()):t.shiftKey||t.ctrlKey||t.metaKey?t.currentTarget.blur():e.param.disableInteractiveUpdates&&!e.param.multiline&&n(o))}
return e.param.multiline?(0,r.jsx)("div",{className:"msp-control-text-area-wrapper",children:(0,r.jsx)("textarea",{value:null!=o?o:"",placeholder:t,disabled:e.isDisabled,onChange:c,onBlur:d,onKeyDown:p,onCompositionStart:()=>l(!0),onCompositionEnd:u})}):(0,r.jsx)("input",{type:"text",value:null!=o?o:"",placeholder:t,disabled:e.isDisabled,onChange:c,onBlur:d,onKeyDown:p,onCompositionStart:()=>l(!0),onCompositionEnd:u})}class j extends i.PureComponent{constructor(){super(...arguments),this.onChange=e=>{"number"==typeof this.props.param.defaultValue?this.update(parseInt(e.target.value,10)):this.update(e.target.value)}}update(e){this.props.onChange({param:this.props.param,name:this.props.name,value:e})}render(){const e=void 0!==this.props.value&&!this.props.param.options.some(e=>e[0]===this.props.value)
return(0,r.jsxs)("select",{className:"msp-form-control",title:this.props.title,value:void 0!==this.props.value?this.props.value:this.props.param.defaultValue,onChange:this.onChange,disabled:this.props.isDisabled,children:[e&&(0,r.jsx)("option",{value:this.props.value,children:`[Invalid] ${this.props.value}`},this.props.value),this.props.param.options.map(([e,t])=>(0,r.jsx)("option",{value:e,children:t},e))]})}}class V extends i.PureComponent{constructor(){super(...arguments),this.state={showHelp:!1,showOptions:!1},this.onSelect=e=>{e&&e.value!==this.props.value?this.setState({showOptions:!1},()=>{this.props.onChange({param:this.props.param,name:this.props.name,value:e.value})}):this.setState({showOptions:!1})},this.toggle=()=>this.setState({showOptions:!this.state.showOptions}),this.cycle=()=>{const{options:e}=this.props.param,t=e.findIndex(e=>e[0]===this.props.value),n=t===e.length-1?0:t+1
this.props.onChange({param:this.props.param,name:this.props.name,value:e[n][0]})},this.items=(0,u._)(e=>m.W.createItemsFromSelectOptions(e.options)),this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}renderControl(){var e
const t=this.items(this.props.param),n=void 0!==this.props.value?m.W.findItem(t,this.props.value):void 0,i=n?n.label:void 0===this.props.value?`${(null===(e=m.W.getFirstItem(t))||void 0===e?void 0:e.label)||""} [Default]`:`[Invalid] ${this.props.value}`,o=this.props.param.cycle?this.cycle:this.toggle,a=this.props.param.cycle?"center":"left",s=this.props.param.cycle?"on"===this.props.value?v.Xq:"off"===this.props.value?v.CQ:void 0:void 0
return(0,r.jsx)(y.ff,{disabled:this.props.isDisabled,style:{textAlign:a,overflow:"hidden",textOverflow:"ellipsis"},label:i,title:i,icon:s,toggle:o,isSelected:this.state.showOptions,className:"msp-select-toggle"})}renderAddOn(){if(!this.state.showOptions)return null
const e=this.items(this.props.param),t=m.W.findItem(e,this.props.value)
return(0,r.jsx)(m.W,{items:e,current:t,onSelect:this.onSelect})}render(){return k({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})}}class U extends i.PureComponent{constructor(){super(...arguments),this.state={showHelp:!1,showOptions:!1},this.onSelect=e=>{e&&e.value!==this.props.value?this.setState({showOptions:!1},()=>{this.props.onChange({param:this.props.param,name:this.props.name,value:{ref:e.value}})}):this.setState({showOptions:!1})},this.toggle=()=>this.setState({showOptions:!this.state.showOptions}),this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}get items(){return m.W.createItemsFromSelectOptions(this.props.param.getOptions(this.context))}renderControl(){var e
const t=this.items,n=this.props.value.ref?m.W.findItem(t,this.props.value.ref):void 0,i=n?n.label:`[Ref] ${null!==(e=this.props.value.ref)&&void 0!==e?e:""}`
return(0,r.jsx)(y.ff,{disabled:this.props.isDisabled,style:{textAlign:"left",overflow:"hidden",textOverflow:"ellipsis"},label:i,title:i,toggle:this.toggle,isSelected:this.state.showOptions})}renderAddOn(){if(!this.state.showOptions)return null
const e=this.items,t=m.W.findItem(e,this.props.value.ref)
return(0,r.jsx)(m.W,{items:e,current:t,onSelect:this.onSelect})}render(){return k({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})}}U.contextType=f.aU
class G extends i.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1},this.components={0:p.t.Numeric(0,{step:this.props.param.step},{label:"Min"}),1:p.t.Numeric(0,{step:this.props.param.step},{label:"Max"})},this.componentChange=({name:e,value:t})=>{const n=[...this.props.value]
n[+e]=t,this.change(n)},this.toggleExpanded=e=>{this.setState({isExpanded:!this.state.isExpanded}),e.currentTarget.blur()}}change(e){this.props.onChange({name:this.props.name,param:this.props.param,value:e})}render(){const e=this.props.value,t=this.props.param.label||(0,h.Hh)(this.props.name),n=(0,d.XV)(this.props.param.step||.01),i=`[${e[0].toFixed(n)}, ${e[1].toFixed(n)}]`
return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(y.eJ,{label:t,control:(0,r.jsx)("button",{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:i})}),this.state.isExpanded&&(0,r.jsx)("div",{className:"msp-control-offset",children:(0,r.jsx)(I,{params:this.components,values:e,onChange:this.componentChange,onEnter:this.props.onEnter})})]})}}class H extends M{constructor(){super(...arguments),this.onChange=e=>{this.update(e)}}renderControl(){return(0,r.jsx)(T.Mm,{value:this.props.value,min:this.props.param.min,max:this.props.param.max,step:this.props.param.step,onChange:this.onChange,disabled:this.props.isDisabled,onEnter:this.props.onEnter})}}const q=(0,u.E)(A.Ch),Q=(0,u.E)(A.y8)
function $(e,t="0"){return{background:(n=e.colors,r="set"===e.kind,r?Q(n):q(n)),position:"absolute",bottom:"0",height:"4px",right:t,left:"0"}
var n,r}let X
function W(){return X||(X=function(){const e=e=>{const t=(0,c.JA)(e[0])
return(0,r.jsx)("div",{style:$({kind:"qualitative"!==t.type?"interpolate":"set",colors:t.list})})}
return{ColorPresets:{all:m.W.createItemsFromSelectOptions(c.CL,{addOn:e,description:e=>e[3]}),scale:m.W.createItemsFromSelectOptions(c.Qx,{addOn:e,description:e=>e[3]}),set:m.W.createItemsFromSelectOptions(c.cG,{addOn:e,description:e=>e[3]})},ColorsParam:p.t.ObjectList({color:p.t.Color(0)},({color:e})=>l.Color.toHexString(e).toUpperCase()),OffsetColorsParam:p.t.ObjectList({color:p.t.Color(0),offset:p.t.Numeric(0,{min:0,max:1,step:.01})},({color:e,offset:t})=>`${l.Color.toHexString(e).toUpperCase()} [${t.toFixed(2)}]`),IsInterpolatedParam:p.t.Boolean(!1,{label:"Interpolated"})}}(),X)}class Y extends i.PureComponent{constructor(){super(...arguments),this.state={showHelp:!1,show:void 0},this.toggleEdit=()=>this.setState({show:"edit"===this.state.show?void 0:"edit"}),this.togglePresets=()=>this.setState({show:"presets"===this.state.show?void 0:"presets"}),this.selectPreset=e=>{if(!e)return
this.setState({show:void 0})
const t=(0,c.JA)(e.value)
this.update({kind:"qualitative"!==t.type?"interpolate":"set",colors:t.list})},this.colorsChanged=({value:e})=>{this.update({kind:this.props.value.kind,colors:e.map(e=>e.color)})},this.isInterpolatedChanged=({value:e})=>{this.update({kind:e?"interpolate":"set",colors:this.props.value.colors})},this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}update(e){this.props.onChange({param:this.props.param,name:this.props.name,value:e})}renderControl(){const{value:e}=this.props
return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("button",{onClick:this.toggleEdit,style:{position:"relative",paddingRight:"33px"},children:[1===e.colors.length?"1 color":`${e.colors.length} colors`,(0,r.jsx)("div",{style:$(e,"33px")})]}),(0,r.jsx)(y.K0,{svg:v.sM,onClick:this.togglePresets,toggleState:"presets"===this.state.show,title:"Color Presets",style:{padding:0,position:"absolute",right:0,top:0,width:"32px"}})]})}renderColors(){if(!this.state.show)return null
const{ColorPresets:e,ColorsParam:t,IsInterpolatedParam:n}=W(),i=e[this.props.param.presetKind]
if("presets"===this.state.show)return(0,r.jsx)(m.W,{items:i,onSelect:this.selectPreset})
const o=this.props.value.colors.map(e=>({color:Array.isArray(e)?e[0]:e}))
return(0,r.jsxs)("div",{className:"msp-control-offset",children:[(0,r.jsx)(le,{name:"colors",param:t,value:o,onChange:this.colorsChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter}),(0,r.jsx)(R,{name:"isInterpolated",param:n,value:"interpolate"===this.props.value.kind,onChange:this.isInterpolatedChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter})]})}render(){return k({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderColors()})}}class Z extends i.PureComponent{constructor(){super(...arguments),this.state={showHelp:!1,show:void 0},this.toggleEdit=()=>this.setState({show:"edit"===this.state.show?void 0:"edit"}),this.togglePresets=()=>this.setState({show:"presets"===this.state.show?void 0:"presets"}),this.selectPreset=e=>{if(!e)return
this.setState({show:void 0})
const t=(0,c.JA)(e.value)
this.update({kind:"qualitative"!==t.type?"interpolate":"set",colors:t.list})},this.colorsChanged=({value:e})=>{const t=e.map(e=>[e.color,e.offset])
t.sort((e,t)=>e[1]-t[1]),this.update({kind:this.props.value.kind,colors:t})},this.isInterpolatedChanged=({value:e})=>{this.update({kind:e?"interpolate":"set",colors:this.props.value.colors})},this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}update(e){this.props.onChange({param:this.props.param,name:this.props.name,value:e})}renderControl(){const{value:e}=this.props
return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("button",{onClick:this.toggleEdit,style:{position:"relative",paddingRight:"33px"},children:[1===e.colors.length?"1 color":`${e.colors.length} colors`,(0,r.jsx)("div",{style:$(e,"33px")})]}),(0,r.jsx)(y.K0,{svg:v.sM,onClick:this.togglePresets,toggleState:"presets"===this.state.show,title:"Color Presets",style:{padding:0,position:"absolute",right:0,top:0,width:"32px"}})]})}renderColors(){if(!this.state.show)return null
const{ColorPresets:e,OffsetColorsParam:t,IsInterpolatedParam:n}=W(),i=e[this.props.param.presetKind]
if("presets"===this.state.show)return(0,r.jsx)(m.W,{items:i,onSelect:this.selectPreset})
const o=this.props.value.colors,a=o.map((e,t)=>Array.isArray(e)?{color:e[0],offset:e[1]}:{color:e,offset:t/o.length})
return a.sort((e,t)=>e.offset-t.offset),(0,r.jsxs)("div",{className:"msp-control-offset",children:[(0,r.jsx)(le,{name:"colors",param:t,value:a,onChange:this.colorsChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter}),(0,r.jsx)(R,{name:"isInterpolated",param:n,value:"interpolate"===this.props.value.kind,onChange:this.isInterpolatedChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter})]})}render(){return k({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderColors()})}}class K extends i.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1},this.components={0:p.t.Numeric(0,{step:this.props.param.step},{label:this.props.param.fieldLabels&&this.props.param.fieldLabels.x||"X"}),1:p.t.Numeric(0,{step:this.props.param.step},{label:this.props.param.fieldLabels&&this.props.param.fieldLabels.y||"Y"}),2:p.t.Numeric(0,{step:this.props.param.step},{label:this.props.param.fieldLabels&&this.props.param.fieldLabels.z||"Z"})},this.componentChange=({name:e,value:t})=>{const n=o.eB.copy(o.eB.zero(),this.props.value)
n[+e]=t,this.change(n)},this.toggleExpanded=e=>{this.setState({isExpanded:!this.state.isExpanded}),e.currentTarget.blur()}}change(e){this.props.onChange({name:this.props.name,param:this.props.param,value:e})}render(){const e=this.props.value,t=this.props.param.label||(0,h.Hh)(this.props.name),n=(0,d.XV)(this.props.param.step||.01),i=`[${e[0].toFixed(n)}, ${e[1].toFixed(n)}, ${e[2].toFixed(n)}]`
return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(y.eJ,{label:t,control:(0,r.jsx)("button",{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:(0,r.jsx)("div",{title:i,className:"msp-no-overflow",style:{display:"block"},children:i})})}),this.state.isExpanded&&(0,r.jsx)("div",{className:"msp-control-offset",children:(0,r.jsx)(I,{params:this.components,values:e,onChange:this.componentChange,onEnter:this.props.onEnter})})]})}}class J extends i.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1},this.components={json:p.t.Text(JSON.stringify((0,o.$I)()),{description:"JSON array with 4x4 matrix in a column major (j * 4 + i indexing) format"})},this.componentChange=({name:e,value:t})=>{const n=o.$I.copy((0,o.$I)(),this.props.value)
"json"===e?o.$I.copy(n,JSON.parse(t)):n[+e]=t,this.change(n)},this.toggleExpanded=e=>{this.setState({isExpanded:!this.state.isExpanded}),e.currentTarget.blur()}}change(e){this.props.onChange({name:this.props.name,param:this.props.param,value:e})}changeValue(e){return t=>{const n=o.$I.copy((0,o.$I)(),this.props.value)
n[e]=t,this.change(n)}}get grid(){const e=this.props.value,t=[]
for(let n=0;n<4;n++){const i=[]
for(let t=0;t<4;t++)i.push((0,r.jsx)(y.ks,{numeric:!0,delayMs:50,value:o.$I.getValue(e,n,t),onChange:this.changeValue(4*t+n),className:"msp-form-control",blurOnEnter:!0,isDisabled:this.props.isDisabled},t))
t.push((0,r.jsx)("div",{className:"msp-flex-row",children:i},n))}return(0,r.jsx)("div",{className:"msp-parameter-matrix",children:t})}render(){const e={json:JSON.stringify(this.props.value)},t=this.props.param.label||(0,h.Hh)(this.props.name)
return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(y.eJ,{label:t,control:(0,r.jsx)("button",{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:(0,r.jsx)("div",{className:"msp-no-overflow",style:{display:"block"},children:"44 Matrix"})})}),this.state.isExpanded&&(0,r.jsxs)("div",{className:"msp-control-offset",children:[this.grid,(0,r.jsx)(I,{params:this.components,values:e,onChange:this.componentChange,onEnter:this.props.onEnter})]})]})}}class ee extends M{constructor(){super(...arguments),this.onChange=e=>{const t=e.target.value
t!==s.V.getUrl(this.props.value||"")&&this.update(s.V.Url(t))},this.onKeyPress=e=>{13!==e.keyCode&&13!==e.charCode&&"Enter"!==e.key||this.props.onEnter&&this.props.onEnter(),e.stopPropagation()}}renderControl(){const e=this.props.param.label||(0,h.Hh)(this.props.name)
return(0,r.jsx)("input",{type:"text",value:s.V.getUrl(this.props.value||""),placeholder:e,onChange:this.onChange,onKeyPress:this.props.onEnter?this.onKeyPress:void 0,disabled:this.props.isDisabled})}}class te extends i.PureComponent{constructor(){super(...arguments),this.state={showHelp:!1},this.onChangeFile=e=>{this.change(e.target.files[0])},this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}change(e){this.props.onChange({name:this.props.name,param:this.props.param,value:s.V.File(e)})}renderControl(){const e=this.props.value
return(0,r.jsxs)("div",{className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file",style:{marginTop:"1px"},children:[e?e.name:"Select a file..."," ",(0,r.jsx)("input",{disabled:this.props.isDisabled,onChange:this.onChangeFile,type:"file",multiple:!1,accept:this.props.param.accept})]})}render(){return this.props.param.label?k({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:null}):this.renderControl()}}class ne extends i.PureComponent{constructor(){super(...arguments),this.state={showHelp:!1},this.onChangeFileList=e=>{this.change(e.target.files)},this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}change(e){const t=[]
if(e)for(let n=0,r=e.length;n<r;++n)t.push(s.V.File(e[n]))
this.props.onChange({name:this.props.name,param:this.props.param,value:t})}renderControl(){const e=this.props.value,t=[]
if(e)for(const r of e)t.push(r.name)
const n=0===t.length?"Select files...":1===t.length?t[0]:`${t.length} files selected`
return(0,r.jsxs)("div",{className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file",style:{marginTop:"1px"},children:[n," ",(0,r.jsx)("input",{disabled:this.props.isDisabled,onChange:this.onChangeFileList,type:"file",multiple:!0,accept:this.props.param.accept})]})}render(){return this.props.param.label?k({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:null}):this.renderControl()}}class re extends i.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1},this.toggleExpanded=e=>{this.setState({isExpanded:!this.state.isExpanded}),e.currentTarget.blur()}}change(e){this.props.onChange({name:this.props.name,param:this.props.param,value:e})}toggle(e){return t=>{this.props.value.indexOf(e)<0?this.change(this.props.value.concat(e)):this.change(this.props.value.filter(t=>t!==e)),t.currentTarget.blur()}}render(){const e=this.props.value,t=this.props.param.emptyValue,n=this.props.param.label||(0,h.Hh)(this.props.name)
return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(y.eJ,{label:n,control:(0,r.jsx)("button",{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:0===e.length&&t?t:`${e.length} of ${this.props.param.options.length}`})}),this.state.isExpanded&&(0,r.jsx)("div",{className:"msp-control-offset",children:this.props.param.options.map(([t,n])=>{const i=e.indexOf(t)>=0
return(0,r.jsx)(y.$n,{onClick:this.toggle(t),disabled:this.props.isDisabled,style:{marginTop:"1px"},children:(0,r.jsx)("span",{style:{float:i?"left":"right"},children:i?` ${n}`:`${n} `})},t)})})]})}}class ie extends i.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!!this.props.param.isExpanded,showPresets:!1,showHelp:!1},this.onChangeParam=e=>{this.change({...this.props.value,[e.name]:e.value})},this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded}),this.toggleShowPresets=()=>this.setState({showPresets:!this.state.showPresets}),this.presetItems=(0,u._)(e=>{var t
return m.W.createItemsFromSelectOptions(null!==(t=e.presets)&&void 0!==t?t:[])}),this.onSelectPreset=e=>{this.setState({showPresets:!1}),this.change(null==e?void 0:e.value)}}change(e){this.props.onChange({name:this.props.name,param:this.props.param,value:e})}pivotedPresets(){if(!this.props.param.presets)return null
const e=this.props.param.label||(0,h.Hh)(this.props.name)
return(0,r.jsxs)("div",{className:"msp-control-group-wrapper",children:[(0,r.jsx)("div",{className:"msp-control-group-header",children:(0,r.jsxs)("button",{className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleShowPresets,children:[(0,r.jsx)(v.In,{svg:v.sM}),e," Presets"]})}),this.state.showPresets&&(0,r.jsx)(m.W,{items:this.presetItems(this.props.param),onSelect:this.onSelectPreset})]})}presets(){return this.props.param.presets?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"msp-control-group-presets-wrapper",children:(0,r.jsx)("div",{className:"msp-control-group-header",children:(0,r.jsxs)("button",{className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleShowPresets,children:[(0,r.jsx)(v.In,{svg:v.sM}),"Presets"]})})}),this.state.showPresets&&(0,r.jsx)(m.W,{items:this.presetItems(this.props.param),onSelect:this.onSelectPreset})]}):null}pivoted(){const e=this.props.param.pivot,t=this.props.param.params,n=t[e],i=B(n),o=(0,r.jsx)(i,{name:e,param:n,value:this.props.value[e],onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled})
if(!this.state.isExpanded)return(0,r.jsxs)("div",{className:"msp-mapped-parameter-group",children:[o,(0,r.jsx)(y.K0,{svg:v.Hk,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:"More Options",style:{opacity:.7}})]})
const a=Object.create(null)
for(const r of Object.keys(t))r!==e&&(a[r]=t[r])
return(0,r.jsxs)("div",{className:"msp-mapped-parameter-group",children:[o,(0,r.jsx)(y.K0,{svg:v.Hk,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:"More Options"}),(0,r.jsxs)("div",{className:"msp-control-offset",children:[this.pivotedPresets(),(0,r.jsx)(I,{params:a,onEnter:this.props.onEnter,values:this.props.value,onChange:this.onChangeParam,isDisabled:this.props.isDisabled})]})]})}render(){const e=this.props.param.params
if(0===Object.keys(e).length)return null
if(this.props.param.pivot)return this.pivoted()
const t=this.props.param.label||(0,h.Hh)(this.props.name),n=(0,r.jsx)(I,{params:e,onChange:this.onChangeParam,values:this.props.value,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled})
return this.props.inMapped?(0,r.jsx)("div",{className:"msp-control-offset",children:n}):this.props.param.isFlat?n:(0,r.jsxs)("div",{className:"msp-control-group-wrapper",style:{position:"relative"},children:[(0,r.jsx)("div",{className:"msp-control-group-header",children:(0,r.jsxs)("button",{className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleExpanded,children:[(0,r.jsx)(v.In,{svg:this.state.isExpanded?v.DM:v.Cp}),t]})}),this.presets(),this.state.isExpanded&&(0,r.jsx)("div",{className:"msp-control-offset",children:n})]})}}class oe extends i.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1},this.valuesCache={},this.onChangeName=e=>{this.change({name:e.value,params:this.getValues(e.value)})},this.onChangeParam=e=>{this.setValues(this.props.value.name,e.value),this.change({name:this.props.value.name,params:e.value})},this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded})}setValues(e,t){this.valuesCache[e]=t}getValues(e){return e in this.valuesCache?this.valuesCache[e]:this.props.param.map(e).defaultValue}change(e){this.props.onChange({name:this.props.name,param:this.props.param,value:e})}areParamsEmpty(e){for(const t of Object.keys(e))if(!e[t].isHidden)return!1
return!0}render(){const e=this.props.value||this.props.param.defaultValue,t=this.props.param.map(e.name),n=this.props.param.label||(0,h.Hh)(this.props.name),i=B(t),o=this.props.param.help,a=o?{...this.props.param.select,help:e=>o({name:e,params:this.getValues(e)})}:this.props.param.select,s=(0,r.jsx)(V,{param:a,isDisabled:this.props.isDisabled,onChange:this.onChangeName,onEnter:this.props.onEnter,name:n,value:e.name})
return i?"group"!==t.type||t.isFlat?(0,r.jsxs)(r.Fragment,{children:[s,(0,r.jsx)(i,{param:t,value:e.params,name:e.name,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled})]}):this.areParamsEmpty(t.params)?s:(0,r.jsxs)("div",{className:"msp-mapped-parameter-group",children:[s,(0,r.jsx)(y.K0,{svg:v.Hk,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:`${n} Properties`,style:{opacity:this.state.isExpanded?void 0:.7}}),this.state.isExpanded&&(0,r.jsx)(ie,{inMapped:!0,param:t,value:e.params,name:e.name,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled})]}):s}}class ae extends i.PureComponent{constructor(){super(...arguments),this.state={current:this.props.value},this.onChangeParam=e=>{this.setState({current:{...this.state.current,[e.name]:e.value}})},this.apply=()=>{this.props.apply(this.state.current)}}componentDidUpdate(e){this.props.params===e.params&&this.props.value===e.value||this.setState({current:this.props.value})}render(){return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(I,{params:this.props.params,onChange:this.onChangeParam,values:this.state.current,onEnter:this.apply,isDisabled:this.props.isDisabled}),(0,r.jsx)("button",{className:"msp-btn msp-btn-block msp-form-control msp-control-top-offset",onClick:this.apply,disabled:this.props.isDisabled,children:this.props.isUpdate?"Update":"Add"})]})}}class se extends i.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1},this.update=e=>{this.props.actions.update(e,this.props.index)},this.moveUp=()=>{this.props.actions.move(this.props.index,-1)},this.moveDown=()=>{this.props.actions.move(this.props.index,1)},this.remove=()=>{this.setState({isExpanded:!1}),this.props.actions.remove(this.props.index)},this.toggleExpanded=e=>{this.setState({isExpanded:!this.state.isExpanded}),e.currentTarget.blur()}}render(){return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"msp-param-object-list-item",children:[(0,r.jsxs)("button",{className:"msp-btn msp-btn-block msp-form-control",onClick:this.toggleExpanded,children:[(0,r.jsx)("span",{children:`${this.props.index+1}: `}),this.props.param.getLabel(this.props.value)]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(y.K0,{svg:v.qp,title:"Move Up",onClick:this.moveUp,small:!0}),(0,r.jsx)(y.K0,{svg:v.p8,title:"Move Down",onClick:this.moveDown,small:!0}),(0,r.jsx)(y.K0,{svg:v.mf,title:"Remove",onClick:this.remove,small:!0})]})]}),this.state.isExpanded&&(0,r.jsx)("div",{className:"msp-control-offset",children:(0,r.jsx)(ae,{params:this.props.param.element,apply:this.update,value:this.props.value,isUpdate:!0,isDisabled:this.props.isDisabled})})]})}}class le extends i.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1},this.add=e=>{this.change([...this.props.value,e])},this.actions={update:(e,t)=>{const n=this.props.value.slice(0)
n[t]=e,this.change(n)},move:(e,t)=>{let n=this.props.value
if(1===n.length)return
let r=(e+t)%n.length
r<0&&(r+=n.length),n=n.slice(0)
const i=n[e]
n[e]=n[r],n[r]=i,this.change(n)},remove:e=>{const t=this.props.value,n=[]
for(let r=0;r<t.length;r++)e!==r&&n.push(t[r])
this.change(n)}},this.toggleExpanded=e=>{this.setState({isExpanded:!this.state.isExpanded}),e.currentTarget.blur()}}change(e){this.props.onChange({name:this.props.name,param:this.props.param,value:e})}render(){const e=this.props.value,t=this.props.param.label||(0,h.Hh)(this.props.name),n=`${e.length} item${1!==e.length?"s":""}`
return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(y.eJ,{label:t,control:(0,r.jsx)("button",{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:n})}),this.state.isExpanded&&(0,r.jsxs)("div",{className:"msp-control-offset",children:[this.props.value.map((e,t)=>(0,r.jsx)(se,{param:this.props.param,value:e,index:t,actions:this.actions,isDisabled:this.props.isDisabled},t)),(0,r.jsx)(y.tW,{header:"New Item",children:(0,r.jsx)(ae,{params:this.props.param.element,apply:this.add,value:this.props.param.ctor(),isDisabled:this.props.isDisabled})})]})]})}}class ce extends i.PureComponent{constructor(){super(...arguments),this.onChangeCondition=e=>{this.change(this.props.param.conditionedValue(this.props.value,e.value))},this.onChangeParam=e=>{this.change(e.value)}}change(e){this.props.onChange({name:this.props.name,param:this.props.param,value:e})}render(){const e=this.props.value,t=this.props.param.conditionForValue(e),n=this.props.param.conditionParams[t],i=this.props.param.label||(0,h.Hh)(this.props.name),o=B(n),a=(0,r.jsx)(V,{param:this.props.param.select,isDisabled:this.props.isDisabled,onChange:this.onChangeCondition,onEnter:this.props.onEnter,name:`${i} Kind`,value:t})
return o?(0,r.jsxs)(r.Fragment,{children:[a,(0,r.jsx)(o,{param:n,value:e,name:i,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled})]}):a}}class ue extends i.PureComponent{constructor(){super(...arguments),this.onChange=e=>{this.props.onChange({name:this.props.name,param:this.props.param,value:this.props.param.toValue(e.value)})}}render(){const e=this.props.param.fromValue(this.props.value),t=B(this.props.param.converted)
return t?(0,r.jsx)(t,{param:this.props.param.converted,value:e,name:this.props.name,onChange:this.onChange,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled}):null}}class de extends i.PureComponent{constructor(){super(...arguments),this.onChange=({name:e,value:t})=>{const n=e
t!==this.props.value[n]&&this.props.onChange({param:this.props.param,name:this.props.name,value:{...this.props.value,[n]:t}})}}render(){const e={defaultValue:this.props.value.language,options:p.t.objectToOptions(a.Script.Info),type:"select"},t=(0,r.jsx)(V,{param:e,isDisabled:this.props.isDisabled,onChange:this.onChange,onEnter:this.props.onEnter,name:"language",value:this.props.value.language}),n={defaultValue:this.props.value.language,type:"text"},i=(0,r.jsx)(F,{param:n,isDisabled:this.props.isDisabled,onChange:this.onChange,name:"expression",value:this.props.value.expression})
return(0,r.jsxs)(r.Fragment,{children:[t,"mol-script"!==this.props.value.language&&(0,r.jsxs)("div",{className:"msp-help-text",style:{padding:"10px"},children:[(0,r.jsx)(v.In,{svg:v.Rf})," Support for PyMOL, VMD, and Jmol selections is an experimental feature and may not always work as intended."]}),i]})}}},57523(e,t,n){"use strict"
var r
n.d(t,{u:()=>r}),function(e){e.create=function(e,t,n=Float32Array){const r=e*t
return{data:new n(r),size:r,cols:e,rows:t}},e.get=function(e,t,n){return e.data[e.rows*n+t]},e.set=function(e,t,n,r){return e.data[e.rows*n+t]=r,e},e.add=function(e,t,n,r){return e.data[e.rows*n+t]+=r,e},e.makeZero=function(e){return e.data.fill(0),e},e.clone=function(e){return{data:e.data.slice(),size:e.size,cols:e.cols,rows:e.rows}},e.fromArray=function(e,t,n){return{data:e,size:t*n,cols:t,rows:n}},e.transpose=function(e,t){if(e.cols!==t.rows||e.rows!==t.cols)throw new Error("transpose: matrix dimensions incompatible")
if(e.data===t.data)throw new Error("transpose: matrices share memory")
const n=t.rows,r=t.cols,i=t.data,o=e.data
for(let a=0,s=0,l=0;a<n;l+=1,s+=r,++a){let e=l
for(let t=0;t<r;e+=n,t++)o[e]=i[s+t]}return e},e.multiplyABt=function(e,t,n){const r=t.cols,i=t.rows,o=n.rows,a=t.data,s=n.data,l=e.data
for(let c=0,u=0,d=0;c<i;u+=r,c++)for(let e=0,t=0;t<o;d++,t++){let t=0,n=u
for(let i=0;i<r;n++,e++,i++)t+=a[n]*s[e]
l[d]=t}return e},e.meanRows=function(e){const t=e.rows,n=e.cols,r=e.data,i=new Array(n)
for(let o=0;o<n;++o)i[o]=0
for(let o=0,a=0;o<t;++o)for(let e=0;e<n;++e,++a)i[e]+=r[a]
for(let o=0;o<n;++o)i[o]/=t
return i},e.subRows=function(e,t){const n=e.rows,r=e.cols,i=e.data
for(let o=0,a=0;o<n;++o)for(let e=0;e<r;++e,++a)i[a]-=t[e]
return e}}(r||(r={}))},57959(e,t,n){"use strict"
n.d(t,{Y:()=>r})
var r,i=n(5378),o=n(37312),a=n(9959)
!function(e){class t{run(e,t=250){return e?(0,i.hM)(this,e,t):this.f(o.f)}runAsChild(e,t){return e.isSynchronous?this.f(o.f):(0,i.Vs)(e,this,t)}runInContext(e){return e.isSynchronous?this.f(o.f):(0,i.yR)(e,this)}constructor(e,t,n){this.name=e,this.f=t,this.onAbort=n,this.id=s()}}function n(e){const t=e
return!!e&&"number"==typeof t.id&&"string"==typeof t.name&&!!t.run}function r(e,n,r){return new t(e,n,r)}e.is=n,e.isAbort=function(e){return!!e&&!!e.isAborted},e.Aborted=function(e){return{isAborted:!0,reason:e,toString:()=>"Aborted"+(e?": "+e:"")}},e.create=r,e.constant=function(e,t){return r(e,async e=>t)},e.empty=function(){return r("",async e=>{})},e.fail=function(e,t){return r(e,async e=>{throw new Error(t)})},e.resolveInContext=function(e,t){return n(e)?t?e.runInContext(t):e.run():e}
const s=(0,a.q)(0,1073741823)}(r||(r={}))},58070(e,t,n){"use strict"
n.d(t,{A8:()=>a,IZ:()=>s,eD:()=>l,pQ:()=>o})
var r=n(48393),i=n(92384)
function o(e,t,n={}){const i=n
return"string"==typeof i.type||"string"==typeof i.color||"string"==typeof i.size?function(e,t,n){const r=n.type&&e.representation.structure.registry.get(n.type)||e.representation.structure.registry.default.provider,i=n.color&&e.representation.structure.themes.colorThemeRegistry.get(n.color)||e.representation.structure.themes.colorThemeRegistry.get(r.defaultColorTheme.name),o=n.size&&e.representation.structure.themes.sizeThemeRegistry.get(n.size)||e.representation.structure.themes.sizeThemeRegistry.get(r.defaultSizeTheme.name)
return c(e,t,{type:r,typeParams:n.typeParams,color:i,colorParams:n.colorParams,size:o,sizeParams:n.sizeParams})}(e,t||r.Structure.Empty,n):c(e,t||r.Structure.Empty,n)}function a(e,t){const{themes:n}=e.representation.structure
return t?n.colorThemeRegistry.getApplicableTypes({structure:t}):n.colorThemeRegistry.types}function s(e,t,n,o,a){const{registry:s,themes:l}=e.representation.structure,c=s.get(n||s.default.name),u=l.colorThemeRegistry.get(o||c.defaultColorTheme.name),d=i.t.getDefaultValues(u.getParams({structure:t||r.Structure.Empty}))
return u.name===c.defaultColorTheme.name&&Object.assign(d,c.defaultColorTheme.props),{name:u.name,params:Object.assign(d,a)}}function l(e,t,n,o,a){const{registry:s,themes:l}=e.representation.structure,c=s.get(n||s.default.name),u=l.sizeThemeRegistry.get(o||c.defaultSizeTheme.name),d=i.t.getDefaultValues(u.getParams({structure:t||r.Structure.Empty}))
return u.name===c.defaultSizeTheme.name&&Object.assign(d,c.defaultSizeTheme.props),{name:u.name,params:Object.assign(d,a)}}function c(e,t,n={}){const{themes:r}=e.representation.structure,o={structure:t},a=n.type||e.representation.structure.registry.default.provider,s=i.t.getDefaultValues(a.getParams(r,t)),l=Object.assign(s,n.typeParams),c=n.color||r.colorThemeRegistry.get(a.defaultColorTheme.name),u=i.t.getDefaultValues(c.getParams(o))
c.name===a.defaultColorTheme.name&&Object.assign(u,a.defaultColorTheme.props)
const d=Object.assign(u,n.colorParams),p=n.size||r.sizeThemeRegistry.get(a.defaultSizeTheme.name),h=i.t.getDefaultValues(p.getParams(o))
p.name===a.defaultSizeTheme.name&&Object.assign(h,a.defaultSizeTheme.props)
const f=Object.assign(h,n.sizeParams)
return{type:{name:a.name,params:l},colorTheme:{name:c.name,params:d},sizeTheme:{name:p.name,params:f}}}},58295(e){"use strict"
var t=Object.prototype.hasOwnProperty,n=Object.prototype.toString,r=Object.defineProperty,i=Object.getOwnPropertyDescriptor,o=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"[object Array]"===n.call(e)},a=function(e){if(!e||"[object Object]"!==n.call(e))return!1
var r,i=t.call(e,"constructor"),o=e.constructor&&e.constructor.prototype&&t.call(e.constructor.prototype,"isPrototypeOf")
if(e.constructor&&!i&&!o)return!1
for(r in e);return void 0===r||t.call(e,r)},s=function(e,t){r&&"__proto__"===t.name?r(e,t.name,{enumerable:!0,configurable:!0,value:t.newValue,writable:!0}):e[t.name]=t.newValue},l=function(e,n){if("__proto__"===n){if(!t.call(e,n))return
if(i)return i(e,n).value}return e[n]}
e.exports=function e(){var t,n,r,i,c,u,d=arguments[0],p=1,h=arguments.length,f=!1
for("boolean"==typeof d&&(f=d,d=arguments[1]||{},p=2),(null==d||"object"!=typeof d&&"function"!=typeof d)&&(d={});p<h;++p)if(null!=(t=arguments[p]))for(n in t)r=l(d,n),d!==(i=l(t,n))&&(f&&i&&(a(i)||(c=o(i)))?(c?(c=!1,u=r&&o(r)?r:[]):u=r&&a(r)?r:{},s(d,{name:n,newValue:e(f,u,i)})):void 0!==i&&s(d,{name:n,newValue:i}))
return d}},58558(e,t,n){"use strict"
n.d(t,{C:()=>r})
var r,i=n(69185),o=n(9043),a=n(95472)
!function(e){function t(e,t,n,r){const i=r&&r.ref?r.ref:o.kk.create22()
let a
return r&&r.tags&&(a="string"==typeof r.tags?[r.tags]:r.tags,0===a.length?a=void 0:a.sort()),{parent:e,transformer:t,state:(null==r?void 0:r.state)||{},tags:a,ref:i,dependsOn:r&&r.dependsOn,params:n,version:o.kk.create22()}}function n(e,t){return!!e.tags&&e.tags.indexOf(t)>=0}e.RootRef="-=root=-",e.isStateChange=function(e,t){return!!t&&(void 0!==t.isCollapsed&&e.isCollapsed!==t.isCollapsed||void 0!==t.isHidden&&e.isHidden!==t.isHidden||void 0!==t.isGhost&&e.isGhost!==t.isGhost||void 0!==t.isLocked&&e.isLocked!==t.isLocked)},e.assignState=function(e,t){if(!t)return!1
let n=!1
for(const r of Object.keys(t)){const i=t[r]
!!i!=!!e[r]&&(n=!0,e[r]=i)}return n},e.syncState=function(e,t){if(!t)return!1
let n=!1
for(const r of Object.keys(t)){const i=t[r]
!!i!=!!e[r]&&(n=!0,void 0!==i?e[r]=i:delete e[r])}for(const r of Object.keys(e)){const i=t[r]
!!i!=!!e[r]&&(n=!0,void 0!==i?e[r]=i:delete e[r])}return n},e.create=t,e.withParams=function(e,t){return{...e,params:t,version:o.kk.create22()}},e.withState=function(e,t){return t?{...e,state:{...e.state,...t}}:e},e.withTags=function(e,t){let n
return t&&(n="string"==typeof t?[t]:t,0===n.length?n=void 0:n.sort()),{...e,tags:n,version:o.kk.create22()}},e.withDependsOn=function(e,t){let n
return t&&(n="string"==typeof t?[t]:t,0===n.length?n=void 0:n.sort()),{...e,dependsOn:n,version:o.kk.create22()}},e.withParent=function(e,t){return{...e,parent:t,version:o.kk.create22()}},e.createRoot=function(n){return t(e.RootRef,i.x.ROOT,{},{ref:e.RootRef,state:n})},e.hasTag=n,e.hasTags=function(e,t){if(!e.tags)return"string"!=typeof t&&0===t.length
if("string"==typeof t)return n(e,t)
for(const n of t)if(e.tags.indexOf(n)<0)return!1
return!0}
const r={}
function s(e){return e}e.setParamsHashVersion=function(e){var t,n
let i
try{i=(0,a.XS)(null!==(t=e.params)&&void 0!==t?t:r)}catch(t){const o=e.transformer.definition.customSerialization?e.transformer.definition.customSerialization.toJSON:s
i=(0,a.XS)(o(null!==(n=e.params)&&void 0!==n?n:r))}e.version=i},e.toJSON=function(e){const t=e.transformer.definition.customSerialization?e.transformer.definition.customSerialization.toJSON:s
let n
for(const r of Object.keys(e.state))e.state[r]&&(n||(n={}),n[r]=!0)
return{parent:e.parent,transformer:e.transformer.id,params:e.params?t(e.params):void 0,state:n,tags:e.tags,ref:e.ref,dependsOn:e.dependsOn,version:e.version}},e.fromJSON=function(e){const t=i.x.get(e.transformer),n=t.definition.customSerialization?t.definition.customSerialization.fromJSON:s
return{parent:e.parent,transformer:t,params:e.params?n(e.params):void 0,state:e.state||{},tags:e.tags,ref:e.ref,dependsOn:e.dependsOn,version:e.version}}}(r||(r={}))},59048(e,t,n){"use strict"
n.d(t,{Ch:()=>c,fs:()=>d,y8:()=>l})
var r=n(45996),i=n(50709)
const o=/^#([0-9A-F]{3}){1,2}$/i,a=/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/i
function s(e){if(null==e)return
let t
if(o.test(e)&&(4===e.length&&(e=`#${e[1]}${e[1]}${e[2]}${e[2]}${e[3]}${e[3]}`),t=r.Q1.fromHexStyle(e),void 0!==t&&!isNaN(t)))return t
if(t=i.ColorNames[e.toLowerCase()],void 0!==t)return t
const n=a.exec(e)
if(n){const e=parseInt(n[1],10),t=parseInt(n[2],10),i=parseInt(n[3],10)
if(e>=0&&e<=255&&t>=0&&t<=255&&i>=0&&i<=255)return r.Q1.fromRgb(e,t,i)}}function l(e){const t=e.length,n=[]
if(e.every(e=>Array.isArray(e))){const t=[...e]
if(!t[0])return"linear-gradient(to right, #000 0%, #000 100%)"
t.sort((e,t)=>e[1]-t[1]),n.push(`${r.Q1.toStyle(t[0][0])} ${(100*t[0][1]).toFixed(2)}%`)
for(let e=0,i=t.length-1;e<i;++e){const[i,o]=t[e],[a,s]=t[e+1],l=o+(s-o)/2
n.push(`${r.Q1.toStyle(i)} ${(100*l).toFixed(2)}%`,`${r.Q1.toStyle(a)} ${(100*l).toFixed(2)}%`)}n.push(`${r.Q1.toStyle(t[t.length-1][0])} ${(100*t[t.length-1][1]).toFixed(2)}%`)}else{n.push(`${u(e[0])} ${1/t*100}%`)
for(let r=1,i=t-1;r<i;++r)n.push(`${u(e[r])} ${r/t*100}%`,`${u(e[r])} ${(r+1)/t*100}%`)
n.push(`${u(e[t-1])} ${(t-1)/t*100}%`)}return`linear-gradient(to right, ${n.join(", ")})`}function c(e){if(0===e.length)return"linear-gradient(to right, #000 0%, #000 100%)"
let t
if(e.every(e=>Array.isArray(e))){const n=[...e]
n.sort((e,t)=>e[1]-t[1]),t=n.map(e=>u(e,!0))}else t=e.map(e=>u(e))
return`linear-gradient(to right, ${t.join(", ")})`}function u(e,t=!1){return Array.isArray(e)?t?`${r.Q1.toStyle(e[0])} ${(100*e[1]).toFixed(2)}%`:r.Q1.toStyle(e[0]):r.Q1.toStyle(e)}function d(e,t=/,/){const n=[],r=e.replace(/\s+/g,"")
let i=0,o=0
for(let a=0,l=r.length;a<l;++a){const e=r[a]
if("("===e){o++
continue}if(")"===e){o>0&&o--
continue}if(o>0)continue
if(!t.test(e))continue
const l=r.substring(i,a)
i=a+1
const c=s(l)
void 0!==c&&n.push(c)}if(i<r.length){const e=r.substring(i),t=s(e)
console.log(e,t),void 0!==t&&n.push(t)}return n}},59455(e,t,n){"use strict"
n.d(t,{Ui:()=>v,dH:()=>c,hW:()=>u})
var r,i=n(4800),o=n(70292),a=n(32372),s=n(41009),l=n(47944)
function c(e,t){return function(e,t){if(s.K)return function(e,t){return o.Task.create("Read File",async n=>{await n.update({message:"Opening file...",canAbort:!1})
const r=await e.arrayBuffer()
return await n.update({message:"Processing file...",canAbort:!1}),await m(n,r,t,h(e.name))})}(e,t)
let n
return o.Task.create("Read File",async r=>{try{await r.update({message:"Opening file...",canAbort:!0}),n=new FileReader,n.readAsArrayBuffer(e)
const i=(await p(r,"Reading...",n)).result
return await r.update({message:"Processing file...",canAbort:!1}),await m(r,i,t,h(e.name))}finally{n=void 0}},()=>{n&&n.abort()})}(e,t)}function u(e){return"string"==typeof e?y(e,e,"string"):y(e.title,e.url,e.type||"string",e.body,e.headers)}function d(e){return e?"Failed to download data. Possible reasons: Resource is not available, or CORS is not allowed on the server.":"Failed to open file."}function p(e,t,n){if(s.K)throw new Error("`readData` should not be used when running in Node.js")
return new Promise((r,i)=>{if(function(e){if(s.K)throw new Error("`isDone` should not be used when running in Node.js")
if(e instanceof FileReader)return e.readyState===FileReader.DONE
if(e instanceof XMLHttpRequest)return e.readyState===XMLHttpRequest.DONE
throw new Error("unknown data type")}(n)){const{error:e}=n
return void(null!=e?i(null!=e?e:d(n instanceof XMLHttpRequest)):r(n))}let o=!1
n.onerror=e=>{if(o)return
const{error:t}=e.target
i(null!=t?t:d(n instanceof XMLHttpRequest))},n.onprogress=n=>{if(e.shouldUpdate&&!o)try{n.lengthComputable?e.update({message:t,isIndeterminate:!1,current:n.loaded,max:n.total}):e.update({message:`${t} ${(n.loaded/1024/1024).toFixed(2)} MB`,isIndeterminate:!0})}catch(n){o=!0,i(n)}},n.onload=e=>{r(n)}})}function h(e){return/\.gz$/i.test(e)?r.Gzip:/\.zip$/i.test(e)?r.Zip:r.None}!function(e){e[e.None=0]="None",e[e.Gzip=1]="Gzip",e[e.Zip=2]="Zip"}(r||(r={}))
const f=/^(__MACOSX|.DS_Store)/
async function m(e,t,n,o){if(null===t)throw new Error("no data given")
let a=new Uint8Array(t)
if(o!==r.None&&"zip"!==n&&(a=await async function(e,t,n){switch(n){case r.None:return t
case r.Gzip:return(0,l.Aq)(e,t)
case r.Zip:const n=await(0,l.$1)(e,t.buffer),i=Object.keys(n).filter(e=>!f.test(e))
if(1!==i.length)throw new Error("can only decompress zip files with a single entry")
return n[i[0]]}}(e,a,o)),"binary"===n)return a
if("zip"===n)return await(0,l.$1)(e,a.buffer)
if("string"===n)return(0,i.uu)(a)
if("xml"===n)return(new DOMParser).parseFromString((0,i.ss)(a),"application/xml")
if("json"===n)return JSON.parse((0,i.ss)(a))
throw new Error(`could not get requested response data '${n}'`)}class g{static get(){if(s.K)throw new Error("`RequestPool.get` should not be used when running in Node.js")
return this.pool.length?this.pool.pop():new XMLHttpRequest}static emptyFunc(){}static deposit(e){this.pool.length<this.poolSize&&(e.onabort=g.emptyFunc,e.onerror=g.emptyFunc,e.onload=g.emptyFunc,e.onprogress=g.emptyFunc,this.pool.push(e))}}function y(e,t,n,i,a){if(s.K)return t.startsWith("file://")?function(e,t,n){if(!s.K)throw new Error("This function should only be used when running in Node.js")
if(!t.startsWith("file://"))throw new Error("This function is only for URLs with protocol file://")
return o.Task.create(null!=e?e:"Download",async e=>{const i=t.substring(7)
await e.update({message:"Loading file...",canAbort:!1})
const o=await function(e){return new Promise((t,n)=>{(function(){throw new Error("When running in Node.js and reading from files, call mol-util/data-source's setFSModule function first.")})().readFile(e,(e,r)=>{e?n(e):t(r)})})}(i)
return await e.update({message:"Parsing response...",canAbort:!1}),await m(e,o.buffer,n,r.None)})}(e,t,n):function(e,t,n){if(!s.K)throw new Error("This function should only be used when running in Node.js")
const i=new AbortController
return o.Task.create(null!=e?e:"Download",async e=>{await e.update({message:"Downloading...",canAbort:!0})
const o=await fetch(t,{signal:i.signal})
if(!(o.status>=200&&o.status<400))throw new Error(`Download failed with status code ${o.status}`)
const a=await o.bytes()
return await e.update({message:"Parsing response...",canAbort:!1}),await m(e,a.buffer,n,r.None)},()=>{i.abort()})}(e,t,n)
let l
return o.Task.create(e||"Download",async e=>{if(l=g.get(),l.open(i?"post":"get",t,!0),a)for(const[t,n]of a)l.setRequestHeader(t,n)
l.responseType=function(e){switch(e){case"json":return"json"
case"xml":return"document"
case"string":return"text"
case"binary":case"zip":return"arraybuffer"}}(n),l.send(i),await e.update({message:"Waiting for server...",canAbort:!0})
const r=await p(e,"Downloading...",l)
l=void 0,await e.update({message:"Parsing response...",canAbort:!1})
const o=function(e,t){if(e.status>=200&&e.status<400){const{response:n}=e
if(g.deposit(e),("binary"===t||"zip"===t)&&n instanceof ArrayBuffer)return new Uint8Array(n)
if("string"===t&&"string"==typeof n)return n
if("xml"===t&&n instanceof XMLDocument)return n
if("json"===t&&"object"==typeof n)return n
throw new Error(`could not get requested response data '${t}'`)}throw g.deposit(e),new Error(`Download failed with status code ${e.status}`)}(r,n)
return o},()=>{l&&(l.abort(),l=void 0)})}async function v(e,t,n,r){const i=n.length,o=new Array(n.length)
await e.update({message:"Downloading...",current:0,max:i})
let s=[],l=[],c=0
for(let d=Math.min(i,r);c<d;c++){const r=n[c]
s.push(x(c,r.id,t.resolve(a.V.getUrlAsset(t,r.url),r.isBinary?"binary":"string").runAsChild(e))),l.push(c)}let u=0
for(;s.length>0;){const r=await Promise.race(s),d=n[r.index],p=l.indexOf(r.index)
if(u++,"error"===r.kind&&!d.canFail)throw new Error(`${d.url}: ${r.error}`)
if(e.shouldUpdate&&await e.update({message:"Downloading...",current:u,max:i}),o[r.index]=r,s=s.filter(b,p),l=l.filter(b,p),c<i){const r=n[c],i=t.resolve(a.V.getUrlAsset(t,r.url),r.isBinary?"binary":"string").runAsChild(e)
s.push(x(c,r.id,i)),l.push(c),c++}}return o}function b(e,t){return this!==t}async function x(e,t,n){try{return{kind:"ok",result:await n,index:e,id:t}}catch(n){return{kind:"error",error:n,index:e,id:t}}}g.pool=[],g.poolSize=15},59457(e,t,n){"use strict"
n.d(t,{nZ:()=>u,pS:()=>c})
var r=n(92384)
function i(e,t,n,r,i,a,s){for(let l=0;l<t;l++){for(let i=0;i<n;i++)r[i]=e[i*t+l]
o(r,i,a,s,n)
for(let r=0;r<n;r++)e[r*t+l]=i[r]}for(let l=0;l<n;l++){for(let n=0;n<t;n++)r[n]=e[l*t+n]
o(r,i,a,s,t)
for(let n=0;n<t;n++)e[l*t+n]=Math.sqrt(i[n])}}function o(e,t,n,r,i){n[0]=0,r[0]=Number.MIN_SAFE_INTEGER,r[1]=Number.MAX_SAFE_INTEGER
for(let o=1,a=0;o<i;o++){let t=(e[o]+o*o-(e[n[a]]+n[a]*n[a]))/(2*o-2*n[a])
for(;t<=r[a];)a--,t=(e[o]+o*o-(e[n[a]]+n[a]*n[a]))/(2*o-2*n[a])
a++,n[a]=o,r[a]=t,r[a+1]=Number.MAX_SAFE_INTEGER}for(let o=0,a=0;o<i;o++){for(;r[a+1]<o;)a++
t[o]=(o-n[a])*(o-n[a])+e[n[a]]}}var a=n(31727),s=n(41009)
const l={}
function c(e){const t=JSON.stringify(e)
return void 0===l[t]&&(l[t]=new d(e)),l[t]}const u={fontFamily:r.t.Select("sans-serif",[["sans-serif","Sans Serif"],["monospace","Monospace"],["serif","Serif"],["cursive","Cursive"]]),fontQuality:r.t.Select(3,[[0,"lower"],[1,"low"],[2,"medium"],[3,"high"],[4,"higher"]]),fontStyle:r.t.Select("normal",[["normal","Normal"],["italic","Italic"],["oblique","Oblique"]]),fontVariant:r.t.Select("normal",[["normal","Normal"],["small-caps","Small Caps"]]),fontWeight:r.t.Select("normal",[["normal","Normal"],["bold","Bold"]])}
class d{constructor(e={}){this.mapped={},this.scratchW=0,this.scratchH=0,this.currentX=0,this.currentY=0,this.cutoff=.5
const t={...r.t.getDefaultValues(u),...e}
this.props=t
const n=32*(t.fontQuality+1)
this.buffer=n/8,this.radius=n/3,this.lineHeight=Math.round(n+2*this.buffer+this.radius),this.maxWidth=Math.round(.75*this.lineHeight),this.texture=(0,a.xg)(350*this.lineHeight*this.maxWidth,1,Uint8Array),this.scratchContext=function(e,t,n){if(s.K)return function(){throw new Error("When running in Node.js and wanting to use Canvas API, call mol-util/data-source's setCanvasModule function first and pass imported `canvas` module to it.")}().createCanvas(e,t).getContext("2d",n)
{const r=document.createElement("canvas")
return r.width=e,r.height=t,r.getContext("2d",n)}}(this.maxWidth,this.lineHeight,{willReadFrequently:!0}),this.scratchContext.font=`${t.fontStyle} ${t.fontVariant} ${t.fontWeight} ${n}px ${t.fontFamily}`,this.scratchContext.fillStyle="black",this.scratchContext.textBaseline="middle",this.scratchData=new Uint8Array(this.lineHeight*this.maxWidth),this.gridOuter=new Float64Array(this.lineHeight*this.maxWidth),this.gridInner=new Float64Array(this.lineHeight*this.maxWidth),this.f=new Float64Array(Math.max(this.lineHeight,this.maxWidth)),this.d=new Float64Array(Math.max(this.lineHeight,this.maxWidth)),this.z=new Float64Array(Math.max(this.lineHeight,this.maxWidth)+1),this.v=new Int16Array(Math.max(this.lineHeight,this.maxWidth)),this.middle=Math.ceil(this.lineHeight/2),this.placeholder=this.get(String.fromCharCode(65533))}get(e){if(void 0===this.mapped[e]){this.draw(e)
const{array:t,width:n,height:r}=this.texture,i=this.scratchData
if(this.currentX+this.scratchW>n&&(this.currentX=0,this.currentY+=this.scratchH),this.currentY+this.scratchH>r)return console.warn("canvas to small"),this.placeholder
this.mapped[e]={x:this.currentX,y:this.currentY,w:this.scratchW,h:this.scratchH,nw:this.scratchW/this.lineHeight,nh:this.scratchH/this.lineHeight}
for(let e=0;e<this.scratchH;++e)for(let r=0;r<this.scratchW;++r)t[n*(this.currentY+e)+this.currentX+r]=i[e*this.scratchW+r]
this.currentX+=this.scratchW}return this.mapped[e]}draw(e){const t=this.lineHeight,n=this.scratchContext,r=this.scratchData,o=n.measureText(e),a=Math.min(this.maxWidth,Math.ceil(o.width+2*this.buffer)),s=a*t
n.clearRect(0,0,a,t),n.fillText(e,this.buffer,this.middle)
const l=n.getImageData(0,0,a,t)
for(let i=0;i<s;i++){const e=l.data[4*i+3]/255
this.gridOuter[i]=1===e?0:0===e?Number.MAX_SAFE_INTEGER:Math.pow(Math.max(0,.5-e),2),this.gridInner[i]=1===e?Number.MAX_SAFE_INTEGER:0===e?0:Math.pow(Math.max(0,e-.5),2)}i(this.gridOuter,a,t,this.f,this.d,this.v,this.z),i(this.gridInner,a,t,this.f,this.d,this.v,this.z)
for(let i=0;i<s;i++){const e=this.gridOuter[i]-this.gridInner[i]
r[i]=Math.max(0,Math.min(255,Math.round(255-255*(e/this.radius+this.cutoff))))}this.scratchW=a,this.scratchH=t}}},59792(e,t,n){"use strict"
n.d(t,{K:()=>v})
var r=n(92384),i=n(32751),o=n(16625),a=n(48393),s=n(30372),l=n(23729),c=n(3111),u=n(70292),d=n(89),p=n(40038),h=n(52408),f=n(91030),m=n(83842),g=n(45692),y=n(17515)
function v(e,t,n,v){let b=0
const{webgl:x}=t,S=new s.B,_=new o.YL.GeometryState,C=(0,l.Q0)(),w=[],T=i.J1.create()
let A,I,P,B,E=c.S.createEmpty()
function k(e){if(i.J1.update(T,e),void 0!==e.visible&&A&&A.setVisibility(e.visible&&(null===T.unitTransforms||T.unitTransforms.isIdentity)),void 0!==e.alphaFactor&&A&&A.setAlphaFactor(e.alphaFactor),void 0!==e.pickable&&A&&A.setPickable(e.pickable),void 0!==e.overpaint&&A){const t=h.l.remap(e.overpaint,I)
A.setOverpaint(t,x)}if(void 0!==e.transparency&&A){const t=m.x.remap(e.transparency,I)
A.setTransparency(t,x)}if(void 0!==e.emissive&&A){const t=y.a.remap(e.emissive,I)
A.setEmissive(t,x)}if(void 0!==e.substance&&A){const t=g.l.remap(e.substance,I)
A.setSubstance(t,x)}if(void 0!==e.clipping&&A){const t=f.l.remap(e.clipping,I)
A.setClipping(t)}void 0!==e.themeStrength&&A&&A.setThemeStrength(e.themeStrength),void 0!==e.transform&&A&&A.setTransform(e.transform),void 0!==e.unitTransforms&&A&&A.setVisibility(T.visible&&(null===e.unitTransforms||e.unitTransforms.isIdentity))}return{label:e,get groupCount(){return A?A.groupCount:0},get props(){return B},get params(){return P},get state(){return T},get theme(){return E},get geometryVersion(){return _.version},renderObjects:w,updated:S,createOrUpdate:function(e={},i){return i&&i!==I&&(P=n(t,i),I=i,B||(B=r.t.getDefaultValues(P))),B=Object.assign({},B,e),u.Task.create("Creating or updating ComplexRepresentation",async e=>{var t
let n=!1
A?(null===(t=A.mustRecreate)||void 0===t?void 0:t.call(A,I,B,x))&&(A.destroy(),A=v(C,I,B,x),n=!0):(A=v(C,I,B,x),n=!0)
const r=A.createOrUpdate({webgl:x,runtime:e},E,B,i)
r&&await r,n&&k(T),w.length=0,A&&A.renderObject&&(w.push(A.renderObject),_.add(A.renderObject.id,A.geometryVersion)),_.snapshot(),b+=1,S.next(b)})},setState:k,setTheme:function(e){E=e},getLoci:function(e){return A?A.getLoci(e):d.EmptyLoci},getAllLoci:function(){var e
return[a.Structure.Loci(null!==(e=I.child)&&void 0!==e?e:I)]},eachLocation:function(e){null==A||A.eachLocation(e)},mark:function(e,t){if(!I)return!1
if(!p.sY.is(T.markerActions,t))return!1
if(a.Structure.isLoci(e)||a.StructureElement.Loci.is(e)||a.Bond.isLoci(e)){if(!a.Structure.areRootsEquivalent(e.structure,I))return!1
e=d.Loci.remap(e,I),(a.Structure.isLoci(e)||a.StructureElement.Loci.is(e)&&a.StructureElement.Loci.isWholeStructure(e))&&(e=d.EveryLoci)}else if(!(0,d.isEveryLoci)(e)&&!(0,d.isDataLoci)(e))return!1
return!d.Loci.isEmpty(e)&&!!A&&A.mark(e,t)},destroy:function(){A&&A.destroy()}}}},59923(e,t){"use strict"
var n=Symbol.for("react.transitional.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),h=Symbol.for("react.activity"),f=Symbol.iterator,m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,y={}
function v(e,t,n){this.props=e,this.context=t,this.refs=y,this.updater=n||m}function b(){}function x(e,t,n){this.props=e,this.context=t,this.refs=y,this.updater=n||m}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.")
this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},b.prototype=v.prototype
var S=x.prototype=new b
S.constructor=x,g(S,v.prototype),S.isPureReactComponent=!0
var _=Array.isArray
function C(){}var w={H:null,A:null,T:null,S:null},T=Object.prototype.hasOwnProperty
function A(e,t,r){var i=r.ref
return{$$typeof:n,type:e,key:t,ref:void 0!==i?i:null,props:r}}function I(e){return"object"==typeof e&&null!==e&&e.$$typeof===n}var P=/\/+/g
function B(e,t){return"object"==typeof e&&null!==e&&null!=e.key?(n=""+e.key,r={"=":"=0",":":"=2"},"$"+n.replace(/[=:]/g,function(e){return r[e]})):t.toString(36)
var n,r}function E(e,t,i,o,a){var s=typeof e
"undefined"!==s&&"boolean"!==s||(e=null)
var l,c,u=!1
if(null===e)u=!0
else switch(s){case"bigint":case"string":case"number":u=!0
break
case"object":switch(e.$$typeof){case n:case r:u=!0
break
case p:return E((u=e._init)(e._payload),t,i,o,a)}}if(u)return a=a(e),u=""===o?"."+B(e,0):o,_(a)?(i="",null!=u&&(i=u.replace(P,"$&/")+"/"),E(a,t,i,"",function(e){return e})):null!=a&&(I(a)&&(l=a,c=i+(null==a.key||e&&e.key===a.key?"":(""+a.key).replace(P,"$&/")+"/")+u,a=A(l.type,c,l.props)),t.push(a)),1
u=0
var d,h=""===o?".":o+":"
if(_(e))for(var m=0;m<e.length;m++)u+=E(o=e[m],t,i,s=h+B(o,m),a)
else if("function"==typeof(m=null===(d=e)||"object"!=typeof d?null:"function"==typeof(d=f&&d[f]||d["@@iterator"])?d:null))for(e=m.call(e),m=0;!(o=e.next()).done;)u+=E(o=o.value,t,i,s=h+B(o,m++),a)
else if("object"===s){if("function"==typeof e.then)return E(function(e){switch(e.status){case"fulfilled":return e.value
case"rejected":throw e.reason
default:switch("string"==typeof e.status?e.then(C,C):(e.status="pending",e.then(function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)},function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value
case"rejected":throw e.reason}}throw e}(e),t,i,o,a)
throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return u}function k(e,t,n){if(null==e)return e
var r=[],i=0
return E(e,r,"","",function(e){return t.call(n,e,i++)}),r}function D(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default
throw e._result}var M="function"==typeof reportError?reportError:function(e){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof e&&null!==e&&"string"==typeof e.message?String(e.message):String(e),error:e})
if(!window.dispatchEvent(t))return}else if("object"==typeof process&&"function"==typeof process.emit)return void process.emit("uncaughtException",e)
console.error(e)},R={map:k,forEach:function(e,t,n){k(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0
return k(e,function(){t++}),t},toArray:function(e){return k(e,function(e){return e})||[]},only:function(e){if(!I(e))throw Error("React.Children.only expected to receive a single React element child.")
return e}}
t.Activity=h,t.Children=R,t.Component=v,t.Fragment=i,t.Profiler=a,t.PureComponent=x,t.StrictMode=o,t.Suspense=u,t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=w,t.__COMPILER_RUNTIME={__proto__:null,c:function(e){return w.H.useMemoCache(e)}},t.cache=function(e){return function(){return e.apply(null,arguments)}},t.cacheSignal=function(){return null},t.cloneElement=function(e,t,n){if(null==e)throw Error("The argument must be a React element, but you passed "+e+".")
var r=g({},e.props),i=e.key
if(null!=t)for(o in void 0!==t.key&&(i=""+t.key),t)!T.call(t,o)||"key"===o||"__self"===o||"__source"===o||"ref"===o&&void 0===t.ref||(r[o]=t[o])
var o=arguments.length-2
if(1===o)r.children=n
else if(1<o){for(var a=Array(o),s=0;s<o;s++)a[s]=arguments[s+2]
r.children=a}return A(e.type,i,r)},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:s,_context:e},e},t.createElement=function(e,t,n){var r,i={},o=null
if(null!=t)for(r in void 0!==t.key&&(o=""+t.key),t)T.call(t,r)&&"key"!==r&&"__self"!==r&&"__source"!==r&&(i[r]=t[r])
var a=arguments.length-2
if(1===a)i.children=n
else if(1<a){for(var s=Array(a),l=0;l<a;l++)s[l]=arguments[l+2]
i.children=s}if(e&&e.defaultProps)for(r in a=e.defaultProps)void 0===i[r]&&(i[r]=a[r])
return A(e,o,i)},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=I,t.lazy=function(e){return{$$typeof:p,_payload:{_status:-1,_result:e},_init:D}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=w.T,n={}
w.T=n
try{var r=e(),i=w.S
null!==i&&i(n,r),"object"==typeof r&&null!==r&&"function"==typeof r.then&&r.then(C,M)}catch(e){M(e)}finally{null!==t&&null!==n.types&&(t.types=n.types),w.T=t}},t.unstable_useCacheRefresh=function(){return w.H.useCacheRefresh()},t.use=function(e){return w.H.use(e)},t.useActionState=function(e,t,n){return w.H.useActionState(e,t,n)},t.useCallback=function(e,t){return w.H.useCallback(e,t)},t.useContext=function(e){return w.H.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e,t){return w.H.useDeferredValue(e,t)},t.useEffect=function(e,t){return w.H.useEffect(e,t)},t.useEffectEvent=function(e){return w.H.useEffectEvent(e)},t.useId=function(){return w.H.useId()},t.useImperativeHandle=function(e,t,n){return w.H.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return w.H.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return w.H.useLayoutEffect(e,t)},t.useMemo=function(e,t){return w.H.useMemo(e,t)},t.useOptimistic=function(e,t){return w.H.useOptimistic(e,t)},t.useReducer=function(e,t,n){return w.H.useReducer(e,t,n)},t.useRef=function(e){return w.H.useRef(e)},t.useState=function(e){return w.H.useState(e)},t.useSyncExternalStore=function(e,t,n){return w.H.useSyncExternalStore(e,t,n)},t.useTransition=function(){return w.H.useTransition()},t.version="19.2.3"},60566(e,t,n){"use strict"
n.d(t,{N:()=>l,v:()=>r})
var r,i=n(70012),o=n(14294),a=n(10212),s=n(87423)
class l{get operatorGroups(){return this._operators||(this._operators=this.operatorsProvider()),this._operators}constructor(e,t,n){this.operatorsProvider=n,this.id=e,this.details=t}}!function(e){e.create=function(t,n,r){return new e(t,n,r)}}(l||(l={})),function(e){e.Default={assemblies:[],spacegroup:o.is.ZeroP1,isNonStandardCrystalFrame:!1},e.findAssembly=function(e,t){const n=t.toLocaleLowerCase(),r=a.i.Provider.get(e)
return r?(0,i.L9)(r.assemblies,e=>e.id.toLowerCase()===n):void 0},e.getUnitcellLabel=function(e){const{cell:t,name:n,num:r}=e.spacegroup,{size:i,anglesInRadians:o}=t,a=i[0].toFixed(2),l=i[1].toFixed(2),c=i[2].toFixed(2),u=(0,s.H)(o[0]).toFixed(2),d=(0,s.H)(o[1]).toFixed(2),p=(0,s.H)(o[2]).toFixed(2),h=[]
return h.push(`Unit Cell <b>${n}</b> #${r}`),h.push(`${a}${l}${c} `),h.push(`=${u} =${d} =${p}`),h.join(" | ")}}(r||(r={}))},60658(e,t,n){"use strict"
n.d(t,{_:()=>l})
var r=n(29282),i=n(28721),o=n(92726),a=n(717)
const s={U:r.r.atom_site_anisotrop.U,U_esd:r.r.atom_site_anisotrop.U_esd}
var l
!function(e){e.Schema=s,e.Descriptor={name:"atom_site_anisotrop",cifExport:{prefix:"",categories:[{name:"atom_site_anisotrop",instance:t=>e.Provider.get(t.firstModel)&&a.K4.is(t.firstModel.sourceData)?i.c.Category.ofTable(t.firstModel.sourceData.data.db.atom_site_anisotrop):i.c.Category.Empty}]}},e.Provider=o.q.create(e.Descriptor),e.getElementToAnsiotrop=function(e,t){const n=new Int32Array(e.rowCount)
n.fill(-1)
for(let i=0,o=e.rowCount;i<o;i++)n[e.value(i)]=i
const r=new Int32Array(e.rowCount)
r.fill(-1)
for(let i=0,o=t.rowCount;i<o;++i){const e=n[t.value(i)];-1!==e&&(r[e]=i)}return r},e.getElementToAnsiotropFromLabel=function(e,t){const n={}
for(let i=0,o=e.rowCount;i<o;i++)n[e.value(i)]=i
const r=new Int32Array(e.rowCount)
r.fill(-1)
for(let i=0,o=t.rowCount;i<o;++i){const e=n[t.value(i)]
void 0!==e&&(r[e]=i)}return r}}(l||(l={}))},60755(e){"use strict"
var t=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,n=/\n/g,r=/^\s*/,i=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,o=/^:\s*/,a=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,s=/^[;\s]*/,l=/^\s+|\s+$/g,c=""
function u(e){return e?e.replace(l,c):c}e.exports=function(e,l){if("string"!=typeof e)throw new TypeError("First argument must be a string")
if(!e)return[]
l=l||{}
var d=1,p=1
function h(e){var t=e.match(n)
t&&(d+=t.length)
var r=e.lastIndexOf("\n")
p=~r?e.length-r:p+e.length}function f(){var e={line:d,column:p}
return function(t){return t.position=new m(e),v(),t}}function m(e){this.start=e,this.end={line:d,column:p},this.source=l.source}function g(t){var n=new Error(l.source+":"+d+":"+p+": "+t)
if(n.reason=t,n.filename=l.source,n.line=d,n.column=p,n.source=e,!l.silent)throw n}function y(t){var n=t.exec(e)
if(n){var r=n[0]
return h(r),e=e.slice(r.length),n}}function v(){y(r)}function b(e){var t
for(e=e||[];t=x();)!1!==t&&e.push(t)
return e}function x(){var t=f()
if("/"==e.charAt(0)&&"*"==e.charAt(1)){for(var n=2;c!=e.charAt(n)&&("*"!=e.charAt(n)||"/"!=e.charAt(n+1));)++n
if(n+=2,c===e.charAt(n-1))return g("End of comment missing")
var r=e.slice(2,n-2)
return p+=2,h(r),e=e.slice(n),p+=2,t({type:"comment",comment:r})}}function S(){var e=f(),n=y(i)
if(n){if(x(),!y(o))return g("property missing ':'")
var r=y(a),l=e({type:"declaration",property:u(n[0].replace(t,c)),value:r?u(r[0].replace(t,c)):c})
return y(s),l}}return m.prototype.content=e,v(),function(){var e,t=[]
for(b(t);e=S();)!1!==e&&(t.push(e),b(t))
return t}()}},60939(e,t,n){"use strict"
n.d(t,{f:()=>r})
var r,i=n(84645),o=n(67538),a=n(14294),s=n(32775),l=n(10314),c=n(23121),u=n(23325),d=n(33205),p=n(92384),h=n(69396),f=n(46448)
!function(e){let t
e.is=function(e){var t,n,r,i
return(null===(i=null===(r=null===(n=null===(t=null==e?void 0:e.grid)||void 0===t?void 0:t.cells)||void 0===n?void 0:n.space)||void 0===r?void 0:r.dimensions)||void 0===i?void 0:i.length)&&(null==e?void 0:e.sourceData)&&(null==e?void 0:e.customProperties)&&(null==e?void 0:e._propertyData)},function(e){function t(t,n){return"absolute"===t.kind?t:{kind:"absolute",absoluteValue:e.calcAbsolute(n,t.relativeValue)}}e.areSame=function(e,n,r){return(0,u.T)(t(e,r).absoluteValue,t(n,r).absoluteValue,r.sigma/100)},e.absolute=function(e){return{kind:"absolute",absoluteValue:e}},e.relative=function(e){return{kind:"relative",relativeValue:e}},e.calcAbsolute=function(e,t){return t*e.sigma+e.mean},e.calcRelative=function(e,t){return 0===e.sigma?0:(t-e.mean)/e.sigma},e.toAbsolute=t,e.toRelative=function(t,n){return"relative"===t.kind?t:{kind:"relative",relativeValue:e.calcRelative(n,t.absoluteValue)}},e.toString=function(e){return"relative"===e.kind?`${e.relativeValue.toFixed(2)} `:`${e.absoluteValue.toPrecision(4)}`}}(t=e.IsoValue||(e.IsoValue={})),e.adjustedIsoValue=function(n,r,i){if("relative"===i)return t.relative(r)
const o=t.absolute(r)
if(f.T.is(n.sourceData)){const t={min:n.sourceData.data.volume_data_3d_info.min_source.value(0),max:n.sourceData.data.volume_data_3d_info.max_source.value(0),mean:n.sourceData.data.volume_data_3d_info.mean_source.value(0),sigma:n.sourceData.data.volume_data_3d_info.sigma_source.value(0)}
return e.IsoValue.toRelative(o,t)}return o}
const n={min:-1,max:1,mean:0,sigma:.1}
function r(t,r){const o=r||n,{min:a,max:s,mean:l,sigma:c}=o,u=(a-l)/c,d=(s-l)/c
let f=t
return"absolute"===t.kind?t.absoluteValue<a?f=e.IsoValue.absolute(a):t.absoluteValue>s&&(f=e.IsoValue.absolute(s)):t.relativeValue<u?f=e.IsoValue.relative(u):t.relativeValue>d&&(f=e.IsoValue.relative(d)),p.t.Conditioned(f,{absolute:p.t.Converted(t=>e.IsoValue.toAbsolute(t,i.x.One.stats).absoluteValue,t=>e.IsoValue.absolute(t),p.t.Numeric(l,{min:a,max:s,step:(0,h.QX)(c/100,2)},{immediateUpdate:!0})),relative:p.t.Converted(t=>e.IsoValue.toRelative(t,i.x.One.stats).relativeValue,t=>e.IsoValue.relative(t),p.t.Numeric(Math.min(1,d),{min:u,max:d,step:(0,h.QX)(Math.round((s-a)/c)/100,2)},{immediateUpdate:!0}))},e=>"absolute"===e.kind?"absolute":"relative",(t,n)=>"absolute"===n?e.IsoValue.toAbsolute(t,o):e.IsoValue.toRelative(t,o),{isEssential:!0})}function m(e,t){if(e.instances.length!==t.instances.length)return!1
for(let n=0,r=e.instances.length;n<r;++n)if(!s.$I.areEqual(e.instances[n].transform,t.instances[n].transform,u.p))return!1
return!0}function g(e){return i.x.isEmpty(e.grid)||0===e.instances.length}let y,v,b
e.createIsoValueParam=r,e.IsoValueParam=r(e.IsoValue.relative(2)),e.One={label:"",grid:i.x.One,instances:[],sourceData:{kind:"",name:"",data:{}},customProperties:new d.v,_propertyData:Object.create(null)},e.areEquivalent=function(e,t){return i.x.areEquivalent(e.grid,t.grid)&&m(e,t)},e.areInstanceTransformsEqual=m,e.isEmpty=g,e.isOrbitals=function(e){return!!c.f.is(e.sourceData)&&e.sourceData.data.header.orbitals},e.Loci=function(e,t){return{kind:"volume-loci",volume:e,instances:t}},e.isLoci=function(e){return!!e&&"volume-loci"===e.kind},e.areLociEqual=function(e,t){return e.volume===t.volume&&o.CD.areEqual(e.instances,t.instances)},e.isLociEmpty=function(e){return g(e.volume)||o.CD.isEmpty(e.instances)},e.getBoundingSphere=function(e,t){return i.x.getBoundingSphere(e.grid,t)},function(t){t.Loci=function(e,t,n){return{kind:"isosurface-loci",volume:e,isoValue:t,instances:n}},t.isLoci=function(e){return!!e&&"isosurface-loci"===e.kind},t.areLociEqual=function(t,n){return t.volume===n.volume&&e.IsoValue.areSame(t.isoValue,n.isoValue,t.volume.grid.stats)&&o.CD.areEqual(t.instances,n.instances)},t.isLociEmpty=function(e){return g(e.volume)||o.CD.isEmpty(e.instances)}
const n=(0,a.DJ)()
t.getBoundingSphere=function(t,r,o){const l=e.IsoValue.toAbsolute(r,t.grid.stats).absoluteValue,c=l<0,u=[0,0,0],d=t.grid.cells.space.getCoords,p=t.grid.cells.data,[h,f,m]=t.grid.cells.space.dimensions
let g=h-1,y=f-1,v=m-1,b=0,x=0,S=0
for(let e=0,n=p.length;e<n;++e)(c&&p[e]<=l||!c&&p[e]>=l)&&(d(e,u),u[0]<g&&(g=u[0]),u[1]<y&&(y=u[1]),u[2]<v&&(v=u[2]),u[0]>b&&(b=u[0]),u[1]>x&&(x=u[1]),u[2]>S&&(S=u[2]))
s.eB.set(n.min,g-1,y-1,v-1),s.eB.set(n.max,b+1,x+1,S+1)
const _=i.x.getGridToCartesianTransform(t.grid)
return a.DJ.transform(n,n,_),a.f8.fromBox3D(o||(0,a.f8)(),n)}}(y=e.Isosurface||(e.Isosurface={})),function(e){e.Loci=function(e,t){return{kind:"cell-loci",volume:e,elements:t}},e.isLoci=function(e){return!!e&&"cell-loci"===e.kind},e.areLociEqual=function(e,t){if(e.volume!==t.volume||e.elements.length!==t.elements.length)return!1
for(let n=0,r=e.elements.length;n<r;++n){const r=e.elements[n],i=t.elements[n]
if(!o.CD.areEqual(r.instances,i.instances)||!o.CD.areEqual(r.indices,i.indices))return!1}return!0},e.isLociEmpty=function(e){for(const{indices:t,instances:n}of e.elements)if(!o.CD.isEmpty(n)||!o.CD.isEmpty(t))return!1
return!0},e.getLociSize=function(e){let t=0
for(const{indices:n,instances:r}of e.elements)t+=o.CD.size(n)*o.CD.size(r)
return t},e.Location=function(e,t,n){return{kind:"cell-location",volume:e,cell:t,instance:n}},e.isLocation=function(e){return!!e&&"cell-location"===e.kind}
const t=new l.Z("98"),n=(0,s.eB)(),r=(0,s.eB)()
e.getBoundingSphere=function(e,l,c){t.reset()
const u=i.x.getGridToCartesianTransform(e.grid),{getCoords:d}=e.grid.cells.space
for(const{indices:i,instances:a}of l)for(let l=0,c=o.CD.size(i);l<c;l++){d(o.CD.getAt(i,l),n),s.eB.transformMat4(n,n,u)
for(let i=0,l=o.CD.size(a);i<l;i++){const l=e.instances[o.CD.getAt(a,i)]
s.eB.transformMat4(r,n,l.transform),t.includePosition(r)}}t.finishedIncludeStep()
for(const{indices:i,instances:a}of l)for(let l=0,c=o.CD.size(i);l<c;l++){d(o.CD.getAt(i,l),n),s.eB.transformMat4(n,n,u)
for(let i=0,l=o.CD.size(a);i<l;i++){const l=e.instances[o.CD.getAt(a,i)]
s.eB.transformMat4(r,n,l.transform),t.radiusPosition(r)}}const p=t.getSphere(c)
return a.f8.expand(p,p,10*s.$I.getMaxScaleOnAxis(u))}}(v=e.Cell||(e.Cell={})),function(t){t.Loci=function(e,t){return{kind:"segment-loci",volume:e,elements:t}},t.isLoci=function(e){return!!e&&"segment-loci"===e.kind},t.areLociEqual=function(e,t){if(e.volume!==t.volume||e.elements.length!==t.elements.length)return!1
for(let n=0,r=e.elements.length;n<r;++n){const r=e.elements[n],i=t.elements[n]
if(!o.CD.areEqual(r.instances,i.instances)||!o.CD.areEqual(r.segments,i.segments))return!1}return!0},t.isLociEmpty=function(e){for(const{segments:t,instances:n}of e.elements)if(!o.CD.isEmpty(n)||!o.CD.isEmpty(t))return!1
return!0},t.getLociSize=function(e){let t=0
for(const{segments:n,instances:r}of e.elements)t+=o.CD.size(n)*o.CD.size(r)
return t}
const n=(0,a.DJ)(),r=(0,a.DJ)(),s=(0,a.DJ)()
t.getBoundingSphere=function(t,l,c){const u=e.Segmentation.get(t)
if(u){a.DJ.setEmpty(n)
const e=i.x.getGridToCartesianTransform(t.grid)
for(const{segments:i,instances:c}of l){a.DJ.setEmpty(r)
for(let e=0,t=o.CD.size(i);e<t;e++){const t=o.CD.getAt(i,e),n=u.bounds[t]
a.DJ.add(r,n.min),a.DJ.add(r,n.max)}a.DJ.transform(r,r,e)
for(let e=0,i=o.CD.size(c);e<i;e++){const i=t.instances[o.CD.getAt(c,e)]
a.DJ.transform(s,r,i.transform),a.DJ.addBox3D(n,s)}}return a.f8.fromBox3D(c||(0,a.f8)(),n)}return e.getBoundingSphere(t,c)},t.Location=function(e,t,n){return{kind:"segment-location",volume:e,segment:t,instance:n}},t.isLocation=function(e){return!!e&&"segment-location"===e.kind}}(b=e.Segment||(e.Segment={})),e.PickingGranularity={set(e,t){e._propertyData.__picking_granularity__=t},get(e){var t
return null!==(t=e._propertyData.__picking_granularity__)&&void 0!==t?t:"voxel"}},e.Segmentation={set(e,t){e._propertyData.__segmentation__=t},get:e=>e._propertyData.__segmentation__}}(r||(r={}))},60980(e,t,n){"use strict"
function r([e]){return Math.log2(e)}n.r(t),n.d(t,{default:()=>i,log2:()=>r})
var i=(0,n(10336).helper)(r)},61361(e,t,n){"use strict"
n.d(t,{OG:()=>Ke,yB:()=>st,h3:()=>lt})
var r,i,o=n(92384),a=n(48393),s=n(70012),l=n(14294),c=n(67538),u=n(11825),d=n(32775),p=n(93036)
!function(e){function t(e,t){const n=new Int32Array(t+1),r=new Int32Array(t),i=new Int32Array(t),{members:o,count:a,offsets:s}=e
for(let u=0,d=s[a];u<d;++u)++i[o[u]]
let l=0
for(let u=0;u<t;u++)n[u]=l,l+=i[u]
n[t]=l
const c=new Int32Array(l)
for(let u=0;u<a;++u)for(let e=s[u],t=s[u+1];e<t;++e){const t=o[e]
c[n[t]+r[t]]=u,++r[t]}return{indices:c,offsets:n}}function n(e,t){let n
const{count:r,types:i}=e,o=[]
for(let s=0;s<r;++s)t.has(i[s])&&o.push(s)
const a=c.X9.ofSortedArray(o)
return{indices:a,get lookup3d(){if(!n){const t={x:e.x,y:e.y,z:e.z,indices:a}
n=(0,l.Eh)(t,(0,p.r)(t))}return n}}}e.setPosition=function(e,t,n,r){return d.eB.set(e,r.x[n],r.y[n],r.z[n]),d.eB.transformMat4(e,e,t.conformation.operator.matrix),e},e.createElementsIndex=t,e.create=function(e,r){let i,o
return{...r,get lookup3d(){if(!i){const e={x:r.x,y:r.y,z:r.z,indices:c.CD.ofBounds(0,r.count)}
i=(0,l.Eh)(e,(0,p.r)(e))}return i},get elementsIndex(){return o||(o=t(r,e))},subset:e=>n(r,e)}},e.createSubset=n,e.Info=function(e,t,n){const r=u.F.get(e).value
if(!r||!r.has(t.id))throw new Error("valence model required")
return{unit:t,types:n.types,feature:-1,x:n.x,y:n.y,z:n.z,members:n.members,offsets:n.offsets,idealGeometry:r.get(t.id).idealGeometry}},e.position=function(e,t){return d.eB.set(e,t.x[t.feature],t.y[t.feature],t.z[t.feature]),d.eB.transformMat4(e,e,t.unit.conformation.operator.matrix),e}
const r=(0,d.eB)(),i=(0,d.eB)()
e.distance=function(e,t){const n=e.members[e.offsets[e.feature]],o=t.members[t.offsets[t.feature]]
return e.unit.conformation.position(e.unit.elements[n],r),t.unit.conformation.position(t.unit.elements[o],i),d.eB.distance(r,i)},e.Provider=function(e,t){return{types:new Set(e),add:t}}}(r||(r={})),function(e){e.create=function(e=2048,t=1024,n){const i=s.Gm.create(Float32Array,1,t,n?n.x:e),o=s.Gm.create(Float32Array,1,t,n?n.y:e),a=s.Gm.create(Float32Array,1,t,n?n.z:e),l=s.Gm.create(Uint8Array,1,t,n?n.types:e),c=s.Gm.create(Uint8Array,1,t,n?n.groups:e),u=s.Gm.create(Uint32Array,1,t,n?n.offsets:e),d=s.Gm.create(Uint32Array,1,t,n?n.members:e),p={x:0,y:0,z:0,offset:0,count:0}
return{startState:()=>{p.x=0,p.y=0,p.z=0,p.offset=d.elementCount,p.count=0},pushMember:(e,t,n,r)=>{s.Gm.add(d,r),p.x+=e,p.y+=t,p.z+=n,p.count+=1},finishState:(e,t)=>{const{count:n}=p
0!==n&&(s.Gm.add(l,e),s.Gm.add(c,t),s.Gm.add(i,p.x/n),s.Gm.add(o,p.y/n),s.Gm.add(a,p.z/n),s.Gm.add(u,p.offset))},add:(e,t,n,r,p,h)=>{s.Gm.add(l,e),s.Gm.add(c,t),s.Gm.add(i,n),s.Gm.add(o,r),s.Gm.add(a,p),s.Gm.add(u,d.elementCount),s.Gm.add(d,h)},getFeatures:e=>{s.Gm.add(u,d.elementCount)
const t=s.Gm.compact(i,!0),n=s.Gm.compact(o,!0),p=s.Gm.compact(a,!0),h=i.elementCount
return r.create(e,{x:t,y:n,z:p,count:h,types:s.Gm.compact(l,!0),groups:s.Gm.compact(c,!0),offsets:s.Gm.compact(u,!0),members:s.Gm.compact(d,!0)})}}}}(i||(i={}))
var h,f,m=n(56294),g=n(29067),y=n(84512)
!function(e){e.create=function(e,t){const n=[],r=[],i=[]
return{add(e,t,o){n[n.length]=e,r[r.length]=t,i[i.length]=o},getContacts(){const o=new g.O.EdgeBuilder(e.count,n,r),a=new Int8Array(o.slotCount),s=new Int8Array(o.slotCount)
for(let e=0,t=o.edgeCount;e<t;e++)o.addNextEdge(),o.assignProperty(a,i[e])
const l=o.createGraph({type:a,flag:s})
let c
return Object.defineProperty(l,"elementsIndex",{get:()=>c||(c=m.dE.createElementsIndex(l,e,t))})}}}}(h||(h={})),function(e){e.create=function(){const e=new y.Z.Builder
return{startUnitPair(t,n){e.startUnitPair(t.id,n.id)},finishUnitPair(){e.finishUnitPair()},add(t,n,r){e.add(t,n,{type:r,flag:m.tA.None})},getContacts:t=>new m.Tg(e.getMap(),t)}}}(f||(f={}))
var v=n(87933),b=n(95579),x=n(30846),S=n(50690)
const _={lineOfSightDistFactor:o.t.Numeric(1,{min:0,max:3,step:.1})}
function C(e,t,n){const r=t.members[t.offsets[t.feature]],i=n.members[n.offsets[n.feature]]
if(r===i&&t.unit===n.unit)return!1
const o=(0,S.q9)(t.unit,r),a=(0,S.q9)(n.unit,i)
return!(o&&a&&o!==a||t.unit===n.unit&&t.unit.model.atomicHierarchy.residueAtomSegments.count>1&&t.unit.residueIndex[t.unit.elements[r]]===n.unit.residueIndex[n.unit.elements[i]]||(0,S.z7)(e,t.unit,r,n.unit,i))}function w(e,t,n,r){const i=(0,S.q9)(e,t),o=(0,S.q9)(n,r)
return i&&o&&i!==o}function T(e,t){const{feature:n,offsets:r,members:i}=t
for(let o=r[n],a=r[n+1];o<a;++o)if(i[o]===e)return!0
return!1}const A=(0,d.eB)(),I=(0,d.eB)(),P=(0,d.eB)(),B=(0,x.Jq)()
function E(e,t,n,i){const o=t.feature,s=n.feature,l=t.members[t.offsets[o]],c=n.members[n.offsets[s]]
r.position(I,t),r.position(P,n),d.eB.scale(A,d.eB.add(A,I,P),.5)
const u=3*i,{count:p,indices:h,units:f,squaredDistances:m}=e.lookup3d.find(A[0],A[1],A[2],u,B)
if(0===p)return!0
for(let r=0;r<p;++r){const e=h[r],o=f[r]
if(!a.Unit.isAtomic(o))continue
const s=(0,S.$X)(o,e)
if(s===b.S8.H)continue
const u=(0,v.sO)(s)
if(!(u*u*i*i<=m[r]||w(o,e,t.unit,l)||w(o,e,n.unit,c)||t.unit===o&&T(e,t)||n.unit===o&&T(e,n)||(o.conformation.position(o.elements[e],A),d.eB.squaredDistance(A,I)<1||d.eB.squaredDistance(A,P)<1)))return!1}return!0}function k(e,t,n,i,o,a){const{x:s,y:l,z:u}=n,{lookup3d:d,indices:p}=n.subset(o.requiredFeatures),h=r.Info(e,t,n),f={...h},m=a.lineOfSightDistFactor
for(let r=0,g=c.CD.size(p);r<g;++r){const t=c.CD.getAt(p,r),{count:n,indices:a,squaredDistances:g}=d.find(s[t],l[t],u[t],o.maxDistance)
if(0!==n){h.feature=t
for(let r=0;r<n;++r){const n=c.CD.getAt(p,a[r])
if(n<=t)continue
if(f.feature=n,!C(e,h,f))continue
const s=o.getType(e,h,f,g[r])
s&&E(e,h,f,m)&&i.add(t,n,s)}}}}const D=(0,d.$I)()
var M=n(93362),R=n(87423)
const O={distanceMax:o.t.Numeric(4,{min:1,max:5,step:.1}),angleMax:o.t.Numeric(30,{min:0,max:60,step:1})},L=[b.S8.CL,b.S8.BR,b.S8.I,b.S8.AT],N=[b.S8.N,b.S8.O,b.S8.S],F=[b.S8.C,b.S8.N,b.S8.P,b.S8.S],z=(0,R.pu)(180),j=(0,R.pu)(120),V=r.Provider([m.lo.HalogenDonor],function(e,t,n){const{elements:r}=t,{x:i,y:o,z:a}=t.model.atomicConformation
for(let s=0,l=r.length;s<l;++s){const e=(0,S.$X)(t,s)
L.includes(e)&&n.add(m.lo.HalogenDonor,m.mO.None,i[r[s]],o[r[s]],a[r[s]],s)}}),U=r.Provider([m.lo.HalogenAcceptor],function(e,t,n){const{elements:r}=t,{x:i,y:o,z:a}=t.model.atomicConformation
for(let s=0,l=r.length;s<l;++s){const l=(0,S.$X)(t,s)
if(N.includes(l)){let l=!1;(0,S.LH)(e,t,s,(e,t)=>{F.includes((0,S.$X)(e,t))&&(l=!0)}),l&&n.add(m.lo.HalogenAcceptor,m.mO.None,i[r[s]],o[r[s]],a[r[s]],s)}}}),G={name:"halogen-bonds",params:O,createTester:e=>{const t=function(e){return{angleMax:(0,R.pu)(e.angleMax)}}(e)
return{maxDistance:e.distanceMax,requiredFeatures:new Set([m.lo.HalogenDonor,m.lo.HalogenAcceptor]),getType:(e,n,r)=>function(e,t,n,r){const i=t.types[t.feature]
if(a=n.types[n.feature],!((o=i)===m.lo.HalogenAcceptor&&a===m.lo.HalogenDonor||o===m.lo.HalogenDonor&&a===m.lo.HalogenAcceptor))return
var o,a
const[s,l]=i===m.lo.HalogenDonor?[t,n]:[n,t],c=s.members[s.offsets[s.feature]],u=l.members[l.offsets[l.feature]],[d]=(0,M.Ci)(e,s.unit,c,l.unit,u)
if(1!==d.length)return
if(z-d[0]>r.angleMax)return
const[p]=(0,M.Ci)(e,l.unit,u,s.unit,c)
return 0===p.length||p.some(e=>j-e>r.angleMax)?void 0:m.X8.HalogenBond}(e,n,r,t)}}}
var H=n(87095)
const q={distanceMax:o.t.Numeric(3.5,{min:1,max:5,step:.1}),backbone:o.t.Boolean(!0,{description:"Include backbone-to-backbone hydrogen bonds"}),accAngleDevMax:o.t.Numeric(45,{min:0,max:180,step:1},{description:"Max deviation from ideal acceptor angle"}),ignoreHydrogens:o.t.Boolean(!1,{description:"Ignore explicit hydrogens in geometric constraints"}),donAngleDevMax:o.t.Numeric(45,{min:0,max:180,step:1},{description:"Max deviation from ideal donor angle"}),accOutOfPlaneAngleMax:o.t.Numeric(90,{min:0,max:180,step:1}),donOutOfPlaneAngleMax:o.t.Numeric(45,{min:0,max:180,step:1})},Q={...q,water:o.t.Boolean(!1,{description:"Include water-to-water hydrogen bonds"}),sulfurDistanceMax:o.t.Numeric(4.1,{min:1,max:5,step:.1})},$={...q}
function X(e,t){const n=u.F.get(e).value
if(!n)throw Error("expected valence model to be available")
const r=n.get(t.id)
if(!r)throw Error("expected valence model for unit to be available")
return r}function W(e,t){const{elementAromaticRingIndices:n,all:r}=e.rings,i=n.get(t)
if(void 0===i)return!1
for(let o=0,a=i.length;o<a;++o){const t=r[i[o]]
for(let n=0,r=t.length;n<r;++n){const r=(0,S.$X)(e,t[n])
if(r===b.S8.N||r===b.S8.O)return!0}}return!1}function Y(e,t){return e.model.atomicHierarchy.derived.residue.moleculeType[e.residueIndex[e.elements[t]]]===H.MoleculeType.Water}function Z(e,t){return H.ProteinBackboneAtoms.has((0,S.nZ)(e,t))}function K(e,t){return"HIS"===(0,S.tZ)(e,t)&&(0,S.$X)(e,t)===b.S8.N&&function(e,t){return e.rings.elementRingIndices.has(t)}(e,t)}function J(e){return{ignoreHydrogens:e.ignoreHydrogens,includeBackbone:e.backbone,maxAccAngleDev:(0,R.pu)(e.accAngleDevMax),maxDonAngleDev:(0,R.pu)(e.donAngleDevMax),maxAccOutOfPlaneAngle:(0,R.pu)(e.accOutOfPlaneAngleMax),maxDonOutOfPlaneAngle:(0,R.pu)(e.donOutOfPlaneAngleMax)}}const ee=(0,R.pu)(120)
function te(e,t,n,r){const i=t.members[t.offsets[t.feature]],o=n.members[n.offsets[n.feature]]
if(!r.includeBackbone&&(a=t.unit,s=i,l=n.unit,c=o,Z(a,s)&&Z(l,c)))return
var a,s,l,c
const[u,d]=(0,M.Ci)(e,t.unit,i,n.unit,o,r.ignoreHydrogens),p=M.UV.get(t.idealGeometry[i])||ee
if(u.some(e=>Math.abs(p-e)>r.maxDonAngleDev))return
if(d.length&&!d.some(e=>e<r.maxDonAngleDev))return
if(t.idealGeometry[i]===M.G0.Trigonal){const a=(0,M.$Z)(e,t.unit,i,n.unit,o)
if(void 0!==a&&a>r.maxDonOutOfPlaneAngle)return}let h=i
!r.ignoreHydrogens&&d.length>0&&(h=(0,M.W_)(e,t.unit,i,n.unit,o))
const[f,m]=(0,M.Ci)(e,n.unit,o,t.unit,h,r.ignoreHydrogens),g=M.UV.get(n.idealGeometry[o])||ee
if(!f.some(e=>g-e>r.maxAccAngleDev)&&!m.some(e=>g-e>r.maxAccAngleDev)){if(n.idealGeometry[o]===M.G0.Trigonal){const a=(0,M.$Z)(e,n.unit,o,t.unit,i)
if(void 0!==a&&a>r.maxAccOutOfPlaneAngle)return}return!0}}const ne=r.Provider([m.lo.HydrogenDonor],function(e,t,n){const{totalH:r}=X(e,t),{elements:i}=t,{x:o,y:a,z:s}=t.model.atomicConformation
for(let l=0,c=i.length;l<c;++l){const e=(0,S.$X)(t,l);(K(t,l)||r[l]>0&&(e===b.S8.N||e===b.S8.O||e===b.S8.S))&&n.add(m.lo.HydrogenDonor,m.mO.None,o[i[l]],a[i[l]],s[i[l]],l)}}),re=r.Provider([m.lo.WeakHydrogenDonor],function(e,t,n){const{totalH:r}=X(e,t),{elements:i}=t,{x:o,y:a,z:s}=t.model.atomicConformation
for(let l=0,c=i.length;l<c;++l)(0,S.$X)(t,l)===b.S8.C&&r[l]>0&&((0,S.IS)(e,t,l,b.S8.N)>0||(0,S.IS)(e,t,l,b.S8.O)>0||W(t,l))&&n.add(m.lo.WeakHydrogenDonor,m.mO.None,o[i[l]],a[i[l]],s[i[l]],l)}),ie=r.Provider([m.lo.HydrogenAcceptor],function(e,t,n){const{charge:r,implicitH:i,idealGeometry:o}=X(e,t),{elements:a}=t,{x:s,y:l,z:c}=t.model.atomicConformation,u=e=>{n.add(m.lo.HydrogenAcceptor,m.mO.None,s[a[e]],l[a[e]],c[a[e]],e)}
for(let d=0,p=a.length;d<p;++d){const n=(0,S.$X)(t,d)
if(n===b.S8.O)u(d)
else if(n===b.S8.N){if(K(t,d))u(d)
else if(r[d]<1){const n=(0,S.Hm)(e,t,d)+i[d],r=o[d];(r===M.G0.Tetrahedral&&n<4||r===M.G0.Trigonal&&n<3||r===M.G0.Linear&&n<2)&&u(d)}}else if(n===b.S8.S){const e=(0,S.tZ)(t,d)
"CYS"!==e&&"MET"!==e&&-1!==(0,S.M0)(t,d)||u(d)}}}),oe={name:"hydrogen-bonds",params:Q,createTester:e=>{const t=Math.max(e.distanceMax,e.sulfurDistanceMax),n=function(e){return{...J(e),includeWater:e.water,maxSulfurDistSq:e.sulfurDistanceMax*e.sulfurDistanceMax,maxDistSq:e.distanceMax*e.distanceMax}}(e)
return{maxDistance:t,requiredFeatures:new Set([m.lo.HydrogenDonor,m.lo.HydrogenAcceptor]),getType:(e,t,r,i)=>function(e,t,n,r,i){const o=t.types[t.feature],a=n.types[n.feature]
if(l=a,!((s=o)===m.lo.HydrogenAcceptor&&l===m.lo.HydrogenDonor||s===m.lo.HydrogenDonor&&l===m.lo.HydrogenAcceptor))return
var s,l
const[c,u]=a===m.lo.HydrogenAcceptor?[t,n]:[n,t],d=c.members[c.offsets[c.feature]],p=u.members[u.offsets[u.feature]]
var h,f,g,y
return r>((0,S.$X)(c.unit,d)===b.S8.S||(0,S.$X)(u.unit,p)===b.S8.S?i.maxSulfurDistSq:i.maxDistSq)||!i.includeWater&&(h=c.unit,f=d,g=u.unit,y=p,Y(h,f)&&Y(g,y))||!te(e,c,u,i)?void 0:m.X8.HydrogenBond}(e,t,r,i,n)}}},ae={name:"weak-hydrogen-bonds",params:$,createTester:e=>{const t=J(e)
return{maxDistance:e.distanceMax,requiredFeatures:new Set([m.lo.WeakHydrogenDonor,m.lo.HydrogenAcceptor]),getType:(e,n,r,i)=>function(e,t,n,r,i){const o=t.types[t.feature],a=n.types[n.feature]
if(l=a,!((s=o)===m.lo.WeakHydrogenDonor&&l===m.lo.HydrogenAcceptor||s===m.lo.HydrogenAcceptor&&l===m.lo.WeakHydrogenDonor))return
var s,l
const[c,u]=a===m.lo.HydrogenAcceptor?[t,n]:[n,t]
return te(e,c,u,i)?m.X8.WeakHydrogenBond:void 0}(e,n,r,0,t)}}}
var se=n(22493)
const le={distanceMax:o.t.Numeric(5,{min:0,max:8,step:.1})},ce={distanceMax:o.t.Numeric(5.5,{min:1,max:8,step:.1}),offsetMax:o.t.Numeric(2,{min:0,max:4,step:.1}),angleDevMax:o.t.Numeric(30,{min:0,max:180,step:1})},ue={distanceMax:o.t.Numeric(6,{min:1,max:8,step:.1}),offsetMax:o.t.Numeric(2,{min:0,max:4,step:.1})},de=["ARG","HIS","LYS"],pe=["GLU","ASP"]
function he(e,t){const n=u.F.get(e).value
if(!n)throw Error("expected valence model to be available")
const r=n.get(t.id)
if(!r)throw Error("expected valence model for unit to be available")
return r}const fe=(0,d.eB)(),me=(0,d.eB)(),ge=(0,d.eB)(),ye=(0,d.eB)(),ve=(0,d.eB)(),be=(0,d.eB)()
function xe(e,t){const{unit:n,feature:r,offsets:i,members:o}=t,{elements:a}=n,s=i[r]
return t.unit.conformation.position(a[o[s]],ge),t.unit.conformation.position(a[o[s+1]],ye),t.unit.conformation.position(a[o[s+2]],ve),d.eB.triangleNormal(e,ge,ye,ve)}const Se=function(e,t,n){return r.position(ge,e),r.position(ye,t),d.eB.sub(ve,ge,ye),d.eB.projectOnPlane(be,ve,n),d.eB.add(be,be,ye),d.eB.distance(be,ye)},_e=(0,R.pu)(180),Ce=(0,R.pu)(90),we=(0,d.eB)(),Te=(0,d.eB)(),Ae=r.Provider([m.lo.NegativeCharge],function(e,t,n){const{charge:r}=he(e,t),{elements:i}=t,{x:o,y:a,z:s}=t.model.atomicConformation,l=new Set,{label_comp_id:u}=t.model.atomicHierarchy.atoms,d=c.hT.transientSegments(t.model.atomicHierarchy.residueAtomSegments,i)
for(;d.hasNext;){const{index:c,start:p,end:h}=d.move(),f=u.value(t.model.atomicHierarchy.residueAtomSegments.offsets[c])
if(pe.includes(f)){n.startState()
for(let e=p;e<h;++e)(0,S.$X)(t,e)!==b.S8.O||H.ProteinBackboneAtoms.has((0,S.nZ)(t,e))||n.pushMember(o[i[e]],a[i[e]],s[i[e]],e)
n.finishState(m.lo.NegativeCharge,m.mO.None)}else if(H.BaseNames.has(f))for(let r=p;r<h;++r)(0,se.lo)(e,t,r)&&(n.startState(),(0,S.LH)(e,t,r,(e,r)=>{(0,S.$X)(t,r)===b.S8.O&&n.pushMember(o[i[r]],a[i[r]],s[i[r]],r)}),n.finishState(m.lo.NegativeCharge,m.mO.Phosphate))
else if(!H.PolymerNames.has(f)){for(let r=p;r<h;++r){n.startState(),(0,S.$X)(t,r)!==b.S8.N||H.ProteinBackboneAtoms.has((0,S.nZ)(t,r))||n.pushMember(o[i[r]],a[i[r]],s[i[r]],r),n.finishState(m.lo.NegativeCharge,m.mO.None)
let c=m.mO.None;(0,se.VL)(e,t,r)?c=m.mO.SulfonicAcid:(0,se.lo)(e,t,r)?c=m.mO.Phosphate:(0,se.bf)(e,t,r)?c=m.mO.Sulfate:(0,se.z$)(e,t,r)&&(c=m.mO.Carboxylate),c&&(n.startState(),(0,S.LH)(e,t,r,(e,r)=>{(0,S.$X)(t,r)===b.S8.O&&(l.add(r),n.pushMember(o[i[r]],a[i[r]],s[i[r]],r))}),n.finishState(m.lo.NegativeCharge,c))}for(let e=p;e<h;++e)r[e]<0&&!l.has(e)&&n.add(m.lo.NegativeCharge,m.mO.None,o[i[e]],a[i[e]],s[i[e]],e)}}}),Ie=r.Provider([m.lo.PositiveCharge],function(e,t,n){const{charge:r}=he(e,t),{elements:i}=t,{x:o,y:a,z:s}=t.model.atomicConformation,l=new Set,{label_comp_id:u}=t.model.atomicHierarchy.atoms,d=c.hT.transientSegments(t.model.atomicHierarchy.residueAtomSegments,i)
for(;d.hasNext;){const{index:c,start:p,end:h}=d.move(),f=u.value(t.model.atomicHierarchy.residueAtomSegments.offsets[c])
if(de.includes(f)){n.startState()
for(let e=p;e<h;++e)(0,S.$X)(t,e)!==b.S8.N||H.ProteinBackboneAtoms.has((0,S.nZ)(t,e))||n.pushMember(o[i[e]],a[i[e]],s[i[e]],e)
n.finishState(m.lo.PositiveCharge,m.mO.None)}else if(!H.PolymerNames.has(f)){l.clear()
for(let r=p;r<h;++r){let c=m.mO.None;(0,se.vM)(e,t,r)?c=m.mO.Guanidine:(0,se.XM)(e,t,r)&&(c=m.mO.Acetamidine),c&&(n.startState(),(0,S.LH)(e,t,r,(e,r)=>{(0,S.$X)(t,r)===b.S8.N&&(l.add(r),n.pushMember(o[i[r]],a[i[r]],s[i[r]],r))}),n.finishState(m.lo.PositiveCharge,c))}for(let e=p;e<h;++e)r[e]>0&&!l.has(e)&&n.add(m.lo.PositiveCharge,m.mO.None,o[i[e]],a[i[e]],s[i[e]],e)}}}),Pe=r.Provider([m.lo.AromaticRing],function(e,t,n){const{elements:r}=t,{x:i,y:o,z:a}=t.model.atomicConformation
for(const s of t.rings.aromaticRings){const e=t.rings.all[s]
n.startState()
for(let t=0,s=e.length;t<s;++t){const s=e[t]
n.pushMember(i[r[s]],o[r[s]],a[r[s]],s)}n.finishState(m.lo.AromaticRing,m.mO.None)}}),Be={name:"ionic",params:le,createTester:e=>{const t=function(e){return{distanceMaxSq:e.distanceMax*e.distanceMax}}(e)
return{maxDistance:e.distanceMax,requiredFeatures:new Set([m.lo.NegativeCharge,m.lo.PositiveCharge]),getType:(e,n,r,i)=>function(e,t,n,r,i){const o=t.types[t.feature]
if(s=n.types[n.feature],((a=o)===m.lo.NegativeCharge&&s===m.lo.PositiveCharge||a===m.lo.PositiveCharge&&s===m.lo.NegativeCharge)&&function(e,t,n){const{feature:r,offsets:i,members:o}=e,{feature:a,offsets:s,members:l}=t
for(let c=i[r],u=i[r+1];c<u;++c){const r=o[c]
e.unit.conformation.position(e.unit.elements[r],fe)
for(let e=s[a],i=s[a+1];e<i;++e){const r=l[e]
if(t.unit.conformation.position(t.unit.elements[r],me),d.eB.squaredDistance(fe,me)<n)return!0}}return!1}(t,n,i.distanceMaxSq))return m.X8.Ionic
var a,s}(0,n,r,0,t)}}},Ee={name:"pi-stacking",params:ce,createTester:e=>{const t=function(e){return{offsetMax:e.offsetMax,angleDevMax:(0,R.pu)(e.angleDevMax)}}(e)
return{maxDistance:e.distanceMax,requiredFeatures:new Set([m.lo.AromaticRing]),getType:(e,n,r,i)=>function(e,t,n,r,i){const o=t.types[t.feature]
if(a=n.types[n.feature],o===m.lo.AromaticRing&&a===m.lo.AromaticRing){xe(we,t),xe(Te,n)
const e=d.eB.angle(we,Te)
if(Math.min(Se(t,n,Te),Se(n,t,we))<=i.offsetMax){if(e<=i.angleDevMax||e>=_e-i.angleDevMax)return m.X8.PiStacking
if(e<=i.angleDevMax+Ce&&e>=Ce-i.angleDevMax)return m.X8.PiStacking}}var a}(0,n,r,0,t)}}},ke={name:"cation-pi",params:ue,createTester:e=>{const t=function(e){return{offsetMax:e.offsetMax}}(e)
return{maxDistance:e.distanceMax,requiredFeatures:new Set([m.lo.AromaticRing,m.lo.PositiveCharge]),getType:(e,n,r,i)=>function(e,t,n,r,i){const o=t.types[t.feature]
if(s=n.types[n.feature],(a=o)===m.lo.AromaticRing&&s===m.lo.PositiveCharge||a===m.lo.PositiveCharge&&s===m.lo.AromaticRing){const[e,r]=o===m.lo.AromaticRing?[t,n]:[n,t]
if(xe(we,e),Se(r,e,we)<=i.offsetMax)return m.X8.CationPi}var a,s}(0,n,r,0,t)}}},De={distanceMax:o.t.Numeric(4,{min:1,max:5,step:.1})},Me=r.Provider([m.lo.HydrophobicAtom],function(e,t,n){const{elements:r}=t,{x:i,y:o,z:a}=t.model.atomicConformation
for(let s=0,l=r.length;s<l;++s){const l=(0,S.$X)(t,s)
let c=!1
l===b.S8.C?(c=!0,(0,S.LH)(e,t,s,(e,t)=>{const n=(0,S.$X)(e,t)
n!==b.S8.C&&n!==b.S8.H&&(c=!1)})):l===b.S8.F&&(c=!0),c&&n.add(m.lo.HydrophobicAtom,m.mO.None,i[r[s]],o[r[s]],a[r[s]],s)}}),Re={name:"hydrophobic",params:De,createTester:e=>({maxDistance:e.distanceMax,requiredFeatures:new Set([m.lo.HydrophobicAtom]),getType:(e,t,n,r)=>function(e,t,n){const r=t.types[t.feature]
if(i=n.types[n.feature],r!==m.lo.HydrophobicAtom||i!==m.lo.HydrophobicAtom)return
var i
const o=t.members[t.offsets[t.feature]],a=n.members[n.offsets[n.feature]]
return(0,S.$X)(t.unit,o)!==b.S8.F||(0,S.$X)(n.unit,a)!==b.S8.F?m.X8.Hydrophobic:void 0}(0,t,n)})}
var Oe=n(42261)
const Le={distanceMax:o.t.Numeric(3,{min:1,max:5,step:.1})},Ne=[b.S8.LI,b.S8.NA,b.S8.K,b.S8.RB,b.S8.CS,b.S8.MG,b.S8.CA,b.S8.SR,b.S8.BA,b.S8.AL,b.S8.GA,b.S8.IN,b.S8.TL,b.S8.SC,b.S8.SN,b.S8.PB,b.S8.BI,b.S8.SB,b.S8.HG]
function Fe(e){return!H.ProteinBackboneAtoms.has(e)}function ze(e){return H.ProteinBackboneAtoms.has(e)}function je(e){return H.NucleicBackboneAtoms.has(e)}function Ve(e,t){return e===m.lo.TransitionMetal?t===m.lo.DativeBondPartner||t===m.lo.TransitionMetal:e===m.lo.IonicTypeMetal?t===m.lo.IonicTypePartner:void 0}const Ue=r.Provider([m.lo.IonicTypeMetal,m.lo.TransitionMetal],function(e,t,n){const{elements:r}=t,{x:i,y:o,z:a}=t.model.atomicConformation
for(let s=0,l=r.length;s<l;++s){const e=(0,S.$X)(t,s)
let l=m.lo.None
Ne.includes(e)?l=m.lo.IonicTypeMetal:((0,b.Hx)(e)||e===b.S8.ZN||e===b.S8.CD)&&(l=m.lo.TransitionMetal),l&&n.add(l,m.mO.None,i[r[s]],o[r[s]],a[r[s]],s)}}),Ge=r.Provider([m.lo.IonicTypePartner,m.lo.DativeBondPartner],function(e,t,n){const{elements:r}=t,{x:i,y:o,z:a}=t.model.atomicConformation
for(let s=0,l=r.length;s<l;++s){const e=(0,S.$X)(t,s),l=(0,S.tZ)(t,s),c=(0,S.nZ)(t,s)
let u=!1,d=!1
const p=H.AminoAcidNames.has(l),h=H.BaseNames.has(l)
p||h?p?e===b.S8.O?(["ASP","GLU","SER","THR","TYR","ASN","GLN"].includes(l)&&Fe(c)||ze(c))&&(u=!0,d=!0):e!==b.S8.S||"CYS"!==l&&"MET"!==l?e===b.S8.N&&"HIS"===l&&Fe(c)&&(u=!0):(u=!0,d=!0):h&&(e===b.S8.O&&je(c)?(u=!0,d=!0):["N3","N4","N7"].includes(c)?u=!0:["O2","O4","O6"].includes(c)&&(u=!0,d=!0)):(0,b.lb)(e)||e===b.S8.O||e===b.S8.S?(u=!0,d=!0):e===b.S8.N&&(u=!0),u&&n.add(m.lo.DativeBondPartner,m.mO.None,i[r[s]],o[r[s]],a[r[s]],s),d&&n.add(m.lo.IonicTypePartner,m.mO.None,i[r[s]],o[r[s]],a[r[s]],s)}}),He={name:"metal-coordination",params:Le,createTester:e=>({maxDistance:e.distanceMax,requiredFeatures:new Set([m.lo.IonicTypeMetal,m.lo.TransitionMetal,m.lo.IonicTypePartner,m.lo.DativeBondPartner]),getType:(e,t,n,r)=>function(e,t,n){const r=t.types[t.feature],i=n.types[n.feature]
if(Ve(r,i)||Ve(i,r))return m.X8.MetalCoordination}(0,t,n)})}
function qe(e,t){const{contacts:n}=t,i=function(e,t,n,r,i){const[o,a]=r.get(n)||[1/0,-1]
e<o?(-1!==a&&i(a),r.set(n,[e,t])):i(t)}
function o(e,t,n,o,a){const s=t.members[t.offsets[t.feature]],l=n.members[n.offsets[n.feature]],c=t.unit.getResidueIndex(s),u=n.unit.getResidueIndex(l),d=`${s}|${t.unit.id}|${u}|${n.unit.id}|A`,p=`${l}|${n.unit.id}|${c}|${t.unit.id}|B`,h=r.distance(t,n)
i(h,e,d,o,a),i(h,e,p,o,a)}const a=new Map,s=e=>n.edges[e].props.flag=m.tA.Filtered
let l,c
return{isApplicable:e=>e===m.X8.Hydrophobic,handleInterContact:(e,t,n)=>{o(e,t,n,a,s)},startUnit:(e,t,n)=>{l=new Map,c=e=>t.edgeProps.flag[e]=m.tA.Filtered},handleIntraContact:(e,t,n)=>{o(e,t,n,l,c)}}}function Qe(e,t){const{contacts:n}=t,r=(e,r)=>{const i=e.types[e.feature]===m.lo.WeakHydrogenDonor?r:e,o=i.members[i.offsets[i.feature]],{edgeProps:{type:a},elementsIndex:{offsets:s,indices:l}}=t.unitsContacts.get(i.unit.id)
for(let t=s[o],n=s[o+1];t<n;++t)if(a[l[t]]===m.X8.HydrogenBond)return!0
const c=n.getEdgeIndices(i.feature,i.unit.id)
for(let t=0,u=c.length;t<u;++t)if(n.edges[c[t]].props.type===m.X8.HydrogenBond)return!0
return!1}
return{isApplicable:e=>e===m.X8.WeakHydrogenBond,handleInterContact:(e,t,i)=>{r(t,i)&&(n.edges[e].props.flag=m.tA.Filtered)},startUnit:()=>{},handleIntraContact:(e,n,i)=>{if(r(n,i)){const{flag:r}=t.unitsContacts.get(n.unit.id).edgeProps
r[e]=m.tA.Filtered}}}}function $e(e,t,n,r,i){const{offsets:o,feature:a}=n,{offsets:s,feature:l}=r
for(let c=o[a],u=o[a+1];c<u;++c){const o=n.members[c],a=i.getContactIndicesForElement(o,n.unit)
for(let n=0,c=a.length;n<c;++n){const o=a[n]
if(e.includes(i.edges[o].props.type))for(let e=s[l],n=s[l+1];e<n;++e){const n=r.members[e]
if(i.getContactIndicesForElement(n,r.unit).includes(o))return void(i.edges[t].props.flag=m.tA.Filtered)}}}}function Xe(e,t,n,r,i){const{edgeProps:{type:o,flag:a},elementsIndex:{offsets:s,indices:l}}=i,{offsets:c,feature:u}=n,{offsets:d,feature:p}=r
for(let h=c[u],f=c[u+1];h<f;++h){const i=n.members[h]
for(let n=s[i],c=s[i+1];n<c;++n){const i=l[n]
if(e.includes(o[i]))for(let e=d[p],n=d[p+1];e<n;++e){const n=r.members[e]
for(let e=s[n],r=s[n+1];e<r;++e)if(i===l[e])return void(a[t]=m.tA.Filtered)}}}}function We(e,t){const{contacts:n}=t
return{isApplicable:e=>e===m.X8.Ionic,handleInterContact:(e,t,r)=>{$e([m.X8.HydrogenBond,m.X8.WeakHydrogenBond],e,t,r,n)},startUnit:()=>{},handleIntraContact:(e,n,r)=>{Xe([m.X8.HydrogenBond,m.X8.WeakHydrogenBond],e,n,r,t.unitsContacts.get(n.unit.id))}}}function Ye(e,t){const{contacts:n}=t
return{isApplicable:e=>e===m.X8.Hydrophobic||e===m.X8.CationPi,handleInterContact:(e,t,r)=>{$e([m.X8.PiStacking],e,t,r,n)},startUnit:()=>{},handleIntraContact:(e,n,r)=>{Xe([m.X8.PiStacking],e,n,r,t.unitsContacts.get(n.unit.id))}}}function Ze(e,t){const{contacts:n}=t
return{isApplicable:e=>e===m.X8.Ionic,handleInterContact:(e,t,r)=>{$e([m.X8.MetalCoordination],e,t,r,n)},startUnit:()=>{},handleIntraContact:(e,n,r)=>{Xe([m.X8.MetalCoordination],e,n,r,t.unitsContacts.get(n.unit.id))}}}var Ke,Je=n(16159),et=n(25919),tt=n(89),nt=n(83748),rt=n(91229)
!function(e){function t(e,t){const{unitA:n,indexA:r,unitB:i,indexB:o}=t,{contacts:a,unitsContacts:s}=e
if(n===i){const e=s.get(n.id),t=e.getDirectedEdgeIndex(r,o)
return(0,m.Ls)(e.edgeProps.type[t])}{const e=a.getEdgeIndex(r,n.id,o,i.id)
return(0,m.Ls)(a.edges[e].props.type)}}function n(e,t,n){const{unitsFeatures:i}=e
return et.p.fromPairProvider(t.length,(e,n,o)=>{const a=t[e]
r.setPosition(n,a.unitA,a.indexA,i.get(a.unitA.id)),r.setPosition(o,a.unitB,a.indexB,i.get(a.unitB.id))},n)}function i(e,n,r){const i=r[0]
if(void 0===i)return""
const{unitA:o,indexA:s,unitB:l,indexB:c}=i,{unitsFeatures:u}=n,{members:d,offsets:p}=u.get(o.id),{members:h,offsets:f}=u.get(l.id),m={granularity:"element"}
return(p[s+1]-p[s]>1||f[c+1]-f[c]>1)&&(m.granularity="residue"),[t(n,i),(0,nt.CR)(a.Bond.Location(e,o,d[p[s]],e,l,h[f[c]]),m)].join("</br>")}e.Location=function(e,t,n,r,i,o){return(0,Je.cG)("interactions",{structure:t,interactions:e},{unitA:n,indexA:r,unitB:i,indexB:o})},e.isLocation=function(e){return!!e&&"data-location"===e.kind&&"interactions"===e.tag},e.areLocationsEqual=function(e,t){return e.data.structure===t.data.structure&&e.data.interactions===t.data.interactions&&e.element.indexA===t.element.indexA&&e.element.indexB===t.element.indexB&&e.element.unitA===t.element.unitA&&e.element.unitB===t.element.unitB},e.locationLabel=function(e){return t(e.data.interactions,e.element)},e.Loci=function(e,t,r){return(0,tt.DataLoci)("interactions",{structure:e,interactions:t},r,e=>n(t,r,e),()=>i(e,t,r))},e.isLoci=function(e){return!!e&&"data-loci"===e.kind&&"interactions"===e.tag},e.getBoundingSphere=n,e.getLabel=i}(Ke||(Ke={}))
const it=[ne,re,ie,Ae,Ie,Pe,V,U,Me,Ue,Ge],ot={ionic:Be,"pi-stacking":Ee,"cation-pi":ke,"halogen-bonds":G,"hydrogen-bonds":oe,"weak-hydrogen-bonds":ae,hydrophobic:Re,"metal-coordination":He},at=function(e=[]){const t=Object.create(null)
return Object.keys(ot).forEach(n=>{t[n]=o.t.MappedStatic(e.includes(n)?"on":"off",{on:o.t.Group(ot[n].params),off:o.t.Group({})},{cycle:!0})}),t}(["cation-pi","pi-stacking","hydrogen-bonds","halogen-bonds","metal-coordination"]),st={providers:o.t.Group(at,{isFlat:!0}),contacts:o.t.Group(_,{label:"Advanced Options"})}
async function lt(e,t,n,i){const s={...o.t.getDefaultValues(st),...n},l=JSON.stringify(s)
await u.F.attach(e,t)
const p=[];(0,rt.mX)(ot).forEach(e=>{const{name:t,params:n}=s.providers[e]
"on"===t&&p.push(ot[e].createTester(n))})
const h=new Set
p.forEach(e=>Oe.M.add(h,e.requiredFeatures))
const m=it.filter(e=>Oe.M.areIntersecting(h,e.types)),g=c.Yz.Mutable(),y=c.Yz.Mutable()
for(let r=0,o=t.unitSymmetryGroups.length;r<o;++r){const n=t.unitSymmetryGroups[r]
e.runtime.shouldUpdate&&await e.runtime.update({message:"computing interactions",current:r,max:o})
const a=ct(t,n.units[0],m,l)
for(let e=0,t=n.units.length;e<t;++e){const t=n.units[e]
g.set(t.id,a)}if(null==i?void 0:i.skipIntraContacts)continue
const c=ut(t,n.units[0],a,p,s.contacts)
for(let e=0,t=n.units.length;e<t;++e){const t=n.units[e]
y.set(t.id,c)}}const v=function(e,t,n,i,o){const s=f.create()
return a.Structure.eachUnitPair(e,(o,a)=>{const l=t.get(o.id),c=t.get(a.id)
!function(e,t,n,i,o,a,s,l){const{count:c,x:u,y:p,z:h}=n,{lookup3d:f}=o,m=d.$I.mul(D,i.conformation.operator.inverse,t.conformation.operator.matrix),g=!d.$I.isIdentity(m),y=(0,d.eB)(),v=Math.max(...s.map(e=>e.maxDistance)),{center:b,radius:x}=f.boundary.sphere,S=(x+v)*(x+v),_=l.lineOfSightDistFactor,w=r.Info(e,t,n),T=r.Info(e,i,o)
a.startUnitPair(t,i)
for(let r=0;r<c;++r){if(d.eB.set(y,u[r],p[r],h[r]),g&&d.eB.transformMat4(y,y,m),d.eB.squaredDistance(y,b)>S)continue
const{indices:t,count:n,squaredDistances:i}=f.find(y[0],y[1],y[2],v)
if(0!==n){w.feature=r
for(let o=0;o<n;++o){const n=t[o]
if(T.feature=n,!C(e,w,T))continue
const l=i[o]
for(const t of s)if(l<t.maxDistance*t.maxDistance){const i=t.getType(e,w,T,l)
if(i&&E(e,w,T,_)){a.add(r,n,i)
break}}}}}a.finishUnitPair()}(e,o,l,a,c,s,n,i)},{maxRadius:Math.max(...n.map(e=>e.maxDistance)),validUnit:e=>a.Unit.isAtomic(e),validUnitPair:(t,n)=>(null==o?void 0:o.unitPairTest)?o.unitPairTest(t,n):a.Structure.validUnitPair(e,t,n)}),s.getContacts(t)}(t,g,p,s.contacts,i),b={unitsFeatures:g,unitsContacts:y,contacts:v}
return function(e,t){const{contacts:n,unitsContacts:i,unitsFeatures:o}=t,s=[qe(0,t),Qe(0,t),We(0,t),Ye(0,t),Ze(0,t)]
for(let a=0,c=n.edgeCount;a<c;++a){const t=n.edges[a],i=e.unitMap.get(t.unitA),l=e.unitMap.get(t.unitB),c=r.Info(e,i,o.get(t.unitA))
c.feature=t.indexA
const u=r.Info(e,l,o.get(t.unitB))
u.feature=t.indexB
for(const e of s)e.isApplicable(t.props.type)&&e.handleInterContact(a,c,u)}const l=i.keys()
for(;;){const{done:t,value:n}=l.next()
if(t)break
const c=i.get(n),u=o.get(n),d=e.unitMap.get(n)
if(!a.Unit.isAtomic(d))continue
const p=r.Info(e,d,u),h=r.Info(e,d,u)
for(const e of s)e.startUnit(d,c,u)
for(let e=0,r=2*c.edgeCount;e<r;++e){p.feature=c.a[e],h.feature=c.b[e]
for(const t of s)t.isApplicable(c.edgeProps.type[e])&&t.handleIntraContact(e,p,h)}}}(t,b),b}function ct(e,t,n,r){const o=`features-${r}`
if(t.transientCache.has(o))return t.transientCache.get(o)
const s=t.elements.length,l=i.create(s,s/2)
if(a.Unit.isAtomic(t))for(const i of n)i.add(e,t,l)
const c=l.getFeatures(s)
return t.transientCache.set(o,c),c}function ut(e,t,n,r,i){const o=h.create(n,t.elements.length)
return a.Unit.isAtomic(t)&&function(e,t,n,r,i,o){for(const a of i)k(e,t,n,r,a,o)}(e,t,n,o,r,i),o.getContacts()}},61379(e,t){"use strict"
function n(e,t){var n=e.length
e.push(t)
e:for(;0<n;){var r=n-1>>>1,i=e[r]
if(!(0<o(i,t)))break e
e[r]=t,e[n]=i,n=r}}function r(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null
var t=e[0],n=e.pop()
if(n!==t){e[0]=n
e:for(var r=0,i=e.length,a=i>>>1;r<a;){var s=2*(r+1)-1,l=e[s],c=s+1,u=e[c]
if(0>o(l,n))c<i&&0>o(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[s]=n,r=s)
else{if(!(c<i&&0>o(u,n)))break e
e[r]=u,e[c]=n,r=c}}}return t}function o(e,t){var n=e.sortIndex-t.sortIndex
return 0!==n?n:e.id-t.id}if(t.unstable_now=void 0,"object"==typeof performance&&"function"==typeof performance.now){var a=performance
t.unstable_now=function(){return a.now()}}else{var s=Date,l=s.now()
t.unstable_now=function(){return s.now()-l}}var c=[],u=[],d=1,p=null,h=3,f=!1,m=!1,g=!1,y=!1,v="function"==typeof setTimeout?setTimeout:null,b="function"==typeof clearTimeout?clearTimeout:null,x="undefined"!=typeof setImmediate?setImmediate:null
function S(e){for(var t=r(u);null!==t;){if(null===t.callback)i(u)
else{if(!(t.startTime<=e))break
i(u),t.sortIndex=t.expirationTime,n(c,t)}t=r(u)}}function _(e){if(g=!1,S(e),!m)if(null!==r(c))m=!0,w||(w=!0,C())
else{var t=r(u)
null!==t&&D(_,t.startTime-e)}}var C,w=!1,T=-1,A=5,I=-1
function P(){return!(!y&&t.unstable_now()-I<A)}function B(){if(y=!1,w){var e=t.unstable_now()
I=e
var n=!0
try{e:{m=!1,g&&(g=!1,b(T),T=-1),f=!0
var o=h
try{t:{for(S(e),p=r(c);null!==p&&!(p.expirationTime>e&&P());){var a=p.callback
if("function"==typeof a){p.callback=null,h=p.priorityLevel
var s=a(p.expirationTime<=e)
if(e=t.unstable_now(),"function"==typeof s){p.callback=s,S(e),n=!0
break t}p===r(c)&&i(c),S(e)}else i(c)
p=r(c)}if(null!==p)n=!0
else{var l=r(u)
null!==l&&D(_,l.startTime-e),n=!1}}break e}finally{p=null,h=o,f=!1}n=void 0}}finally{n?C():w=!1}}}if("function"==typeof x)C=function(){x(B)}
else if("undefined"!=typeof MessageChannel){var E=new MessageChannel,k=E.port2
E.port1.onmessage=B,C=function(){k.postMessage(null)}}else C=function(){v(B,0)}
function D(e,n){T=v(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_next=function(e){switch(h){case 1:case 2:case 3:var t=3
break
default:t=h}var n=h
h=t
try{return e()}finally{h=n}},t.unstable_requestPaint=function(){y=!0},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break
default:e=3}var n=h
h=e
try{return t()}finally{h=n}},t.unstable_scheduleCallback=function(e,i,o){var a=t.unstable_now()
switch(o="object"==typeof o&&null!==o&&"number"==typeof(o=o.delay)&&0<o?a+o:a,e){case 1:var s=-1
break
case 2:s=250
break
case 5:s=1073741823
break
case 4:s=1e4
break
default:s=5e3}return e={id:d++,callback:i,priorityLevel:e,startTime:o,expirationTime:s=o+s,sortIndex:-1},o>a?(e.sortIndex=o,n(u,e),null===r(c)&&e===r(u)&&(g?(b(T),T=-1):g=!0,D(_,o-a))):(e.sortIndex=s,n(c,e),m||f||(m=!0,w||(w=!0,C()))),e},t.unstable_shouldYield=P,t.unstable_wrapCallback=function(e){var t=h
return function(){var n=h
h=t
try{return e.apply(this,arguments)}finally{h=n}}}},61993(e,t,n){"use strict"
n.d(t,{mX:()=>Cn,H7:()=>bn,_i:()=>gn,FN:()=>yn})
var r=n(30372),i=n(15376),o=n(48861),a=n(90756),s=n(70429),l=n(32775),c=n(99321),u=n(56811),d=n(66006),p=n(92384),h=n(87423),f=n(9052)
const m=c.qt,g=c.Fs,y=f.O.Trigger,v=f.O.TriggerKey,b={dragRotate:(0,f.O)([y(m.Flag.Primary,g.create()),y(m.Flag.Trigger)],"Rotate","Drag using ${triggers}"),dragRotateZ:(0,f.O)([y(m.Flag.Primary,g.create({shift:!0,control:!0}))],"Rotate around z-axis (roll)","Drag using ${triggers}"),dragPan:(0,f.O)([y(m.Flag.Secondary,g.create()),y(m.Flag.Primary,g.create({control:!0}))],"Pan","Drag using ${triggers}"),dragZoom:f.O.Empty,dragFocus:(0,f.O)([y(m.Flag.Forth,g.create())],"Focus","Drag using ${triggers}"),dragFocusZoom:(0,f.O)([y(m.Flag.Auxilary,g.create())],"Focus and zoom","Drag using ${triggers}"),scrollZoom:(0,f.O)([y(m.Flag.Auxilary,g.create())],"Zoom","Scroll using ${triggers}"),scrollFocus:(0,f.O)([y(m.Flag.Auxilary,g.create({shift:!0}))],"Clip","Scroll using ${triggers}"),scrollFocusZoom:f.O.Empty,keyMoveForward:(0,f.O)([v("KeyW"),v("GamepadUp")],"Move forward","Press ${triggers}"),keyMoveBack:(0,f.O)([v("KeyS"),v("GamepadDown")],"Move back","Press ${triggers}"),keyMoveLeft:(0,f.O)([v("KeyA")],"Move left","Press ${triggers}"),keyMoveRight:(0,f.O)([v("KeyD")],"Move right","Press ${triggers}"),keyMoveUp:(0,f.O)([v("KeyR")],"Move up","Press ${triggers}"),keyMoveDown:(0,f.O)([v("KeyF")],"Move down","Press ${triggers}"),keyRollLeft:(0,f.O)([v("KeyQ")],"Roll left","Press ${triggers}"),keyRollRight:(0,f.O)([v("KeyE")],"Roll right","Press ${triggers}"),keyPitchUp:(0,f.O)([v("ArrowUp",g.create({shift:!0}))],"Pitch up","Press ${triggers}"),keyPitchDown:(0,f.O)([v("ArrowDown",g.create({shift:!0}))],"Pitch down","Press ${triggers}"),keyYawLeft:(0,f.O)([v("ArrowLeft",g.create({shift:!0}))],"Yaw left","Press ${triggers}"),keyYawRight:(0,f.O)([v("ArrowRight",g.create({shift:!0}))],"Yaw right","Press ${triggers}"),boostMove:(0,f.O)([v("ShiftLeft")],"Boost move","Press ${triggers}"),enablePointerLock:(0,f.O)([v("Space",g.create({control:!0}))],"Enable pointer lock","Press ${triggers}")},x={rotateSpeed:p.t.Numeric(5,{min:1,max:10,step:1}),zoomSpeed:p.t.Numeric(7,{min:1,max:15,step:1}),panSpeed:p.t.Numeric(1,{min:.1,max:5,step:.1}),moveSpeed:p.t.Numeric(.75,{min:.1,max:3,step:.1}),boostMoveFactor:p.t.Numeric(5,{min:.1,max:10,step:.1}),flyMode:p.t.Boolean(!1),animate:p.t.MappedStatic("off",{off:p.t.EmptyGroup(),spin:p.t.Group({speed:p.t.Numeric(.1,{min:-2,max:2,step:.01},{description:"Number of rotations per second"})},{description:"Spin the 3D scene around the x-axis in view space"}),rock:p.t.Group({speed:p.t.Numeric(.3,{min:-5,max:5,step:.1},{description:"Number of oscilations per second"}),angle:p.t.Numeric(10,{min:0,max:90,step:1},{description:"How many degrees to rotate in each direction."})},{description:"Rock the 3D scene around the x-axis in view space"})}),staticMoving:p.t.Boolean(!0,{isHidden:!0}),dynamicDampingFactor:p.t.Numeric(.2,{},{isHidden:!0}),minDistance:p.t.Numeric(.01,{},{isHidden:!0}),maxDistance:p.t.Numeric(1e150,{},{isHidden:!0}),gestureScaleFactor:p.t.Numeric(1,{},{isHidden:!0}),maxWheelDelta:p.t.Numeric(.02,{},{isHidden:!0}),autoAdjustMinMaxDistance:p.t.MappedStatic("on",{off:p.t.EmptyGroup(),on:p.t.Group({minDistanceFactor:p.t.Numeric(0),minDistancePadding:p.t.Numeric(5),maxDistanceFactor:p.t.Numeric(10),maxDistanceMin:p.t.Numeric(20)})},{isHidden:!0})},S={bindings:b}
var _
!function(e){e.create=function(e,t,n,r={},i={}){const o={...p.t.getDefaultValues(x),...r},a={...S,...i},s=a.bindings,c=d.LM.clone(t.viewport)
let u=!1
const m=e.drag.subscribe(function({x:n,y:r,dx:i,dy:o,pageX:a,pageY:u,buttons:d,modifiers:p,isStart:h,useDelta:m}){const g=!m&&ye(n,r)
if(h&&g)return
if(!h&&!A)return
A=!0,Te()
const y=f.O.match(s.dragRotate,d,p),v=f.O.match(s.dragRotateZ,d,p),b=f.O.match(s.dragPan,d,p),x=f.O.match(s.dragZoom,d,p),S=f.O.match(s.dragFocus,d,p),_=f.O.match(s.dragFocusZoom,d,p)
m&&y&&l.ZY.copy(B,Y(a-i,u-o)),Y(a,u),X(a,u)
const C=e.pixelRatio,w=(n*C-c.width/2-c.x)/c.width,T=-(e.height-r*C-c.height/2-c.y)/c.height
if(h&&(y&&(l.ZY.copy(E,W),l.ZY.copy(B,E)),v&&(l.ZY.set(R,w,T),l.ZY.copy(M,R)),(x||_)&&(l.ZY.copy(F,$),l.ZY.copy(z,F)),S&&(l.ZY.copy(j,$),l.ZY.copy(V,j)),b&&(l.ZY.copy(U,$),l.ZY.copy(G,U))),y&&l.ZY.copy(E,W),v&&l.ZY.set(R,w,T),(x||_)&&l.ZY.copy(z,$),S&&l.ZY.copy(V,$),_){const e=l.eB.distance(t.state.position,t.state.target)
t.setState({radius:e/5})}b&&l.ZY.copy(G,$)}),g=e.interactionEnd.subscribe(function(){A=!1}),y=e.wheel.subscribe(function({x:e,y:t,spinX:n,spinY:r,dz:i,buttons:a,modifiers:l}){if(ye(e,t))return
let c=(0,h.TY)(.075*n,.075*r,1e-4*i)
c<-o.maxWheelDelta?c=-o.maxWheelDelta:c>o.maxWheelDelta&&(c=o.maxWheelDelta),f.O.match(s.scrollZoom,a,l)&&(z[1]+=c),f.O.match(s.scrollFocus,a,l)&&(V[1]+=c)}),v=e.pinch.subscribe(function({isStart:e,startX:t,startY:n,centerPageX:r,centerPageY:i,fractionDelta:a,buttons:c,modifiers:u}){if(ye(t,n))return
const d=f.O.match(s.dragPan,c,u),p=f.O.match(s.scrollZoom,c,u)
A=d||p,d&&(X(r,i),e?(l.ZY.copy(U,$),l.ZY.copy(G,U)):l.ZY.copy(G,$)),p&&(z[1]+=o.gestureScaleFactor*a)}),b=e.keyDown.subscribe(function({modifiers:t,code:n,key:r,x:i,y:o}){ye(i,o)||(f.O.matchKey(s.keyMoveForward,n,t,r)?he.moveForward=1:f.O.matchKey(s.keyMoveBack,n,t,r)?he.moveBack=1:f.O.matchKey(s.keyMoveLeft,n,t,r)?he.moveLeft=1:f.O.matchKey(s.keyMoveRight,n,t,r)?he.moveRight=1:f.O.matchKey(s.keyMoveUp,n,t,r)?he.moveUp=1:f.O.matchKey(s.keyMoveDown,n,t,r)?he.moveDown=1:f.O.matchKey(s.keyRollLeft,n,t,r)?he.rollLeft=1:f.O.matchKey(s.keyRollRight,n,t,r)?he.rollRight=1:f.O.matchKey(s.keyPitchUp,n,t,r)?he.pitchUp=1:f.O.matchKey(s.keyPitchDown,n,t,r)?he.pitchDown=1:f.O.matchKey(s.keyYawLeft,n,t,r)?he.yawLeft=1:f.O.matchKey(s.keyYawRight,n,t,r)&&(he.yawRight=1),f.O.matchKey(s.boostMove,n,t,r)&&(he.boostMove=1),f.O.matchKey(s.enablePointerLock,n,t,r)&&e.requestPointerLock(c))}),_=e.keyUp.subscribe(function({modifiers:e,code:t,key:n,x:r,y:i}){var o,a,l,c,u,d,p,h,m,g,y,v
if(ye(r,i))return
let b=!1
t.startsWith("Alt")?(b=!0,e.alt=!0):t.startsWith("Shift")?(b=!0,e.shift=!0):t.startsWith("Control")?(b=!0,e.control=!0):t.startsWith("Meta")&&(b=!0,e.meta=!0)
const x=[]
b?(he.moveForward&&x.push((null===(o=s.keyMoveForward.triggers[0])||void 0===o?void 0:o.code)||""),he.moveBack&&x.push((null===(a=s.keyMoveBack.triggers[0])||void 0===a?void 0:a.code)||""),he.moveLeft&&x.push((null===(l=s.keyMoveLeft.triggers[0])||void 0===l?void 0:l.code)||""),he.moveRight&&x.push((null===(c=s.keyMoveRight.triggers[0])||void 0===c?void 0:c.code)||""),he.moveUp&&x.push((null===(u=s.keyMoveUp.triggers[0])||void 0===u?void 0:u.code)||""),he.moveDown&&x.push((null===(d=s.keyMoveDown.triggers[0])||void 0===d?void 0:d.code)||""),he.rollLeft&&x.push((null===(p=s.keyRollLeft.triggers[0])||void 0===p?void 0:p.code)||""),he.rollRight&&x.push((null===(h=s.keyRollRight.triggers[0])||void 0===h?void 0:h.code)||""),he.pitchUp&&x.push((null===(m=s.keyPitchUp.triggers[0])||void 0===m?void 0:m.code)||""),he.pitchDown&&x.push((null===(g=s.keyPitchDown.triggers[0])||void 0===g?void 0:g.code)||""),he.yawLeft&&x.push((null===(y=s.keyYawLeft.triggers[0])||void 0===y?void 0:y.code)||""),he.yawRight&&x.push((null===(v=s.keyYawRight.triggers[0])||void 0===v?void 0:v.code)||"")):x.push(t)
for(const S of x)f.O.matchKey(s.keyMoveForward,S,e,n)?he.moveForward=0:f.O.matchKey(s.keyMoveBack,S,e,n)?he.moveBack=0:f.O.matchKey(s.keyMoveLeft,S,e,n)?he.moveLeft=0:f.O.matchKey(s.keyMoveRight,S,e,n)?he.moveRight=0:f.O.matchKey(s.keyMoveUp,S,e,n)?he.moveUp=0:f.O.matchKey(s.keyMoveDown,S,e,n)?he.moveDown=0:f.O.matchKey(s.keyRollLeft,S,e,n)?he.rollLeft=0:f.O.matchKey(s.keyRollRight,S,e,n)?he.rollRight=0:f.O.matchKey(s.keyPitchUp,S,e,n)?he.pitchUp=0:f.O.matchKey(s.keyPitchDown,S,e,n)?he.pitchDown=0:f.O.matchKey(s.keyYawLeft,S,e,n)?he.yawLeft=0:f.O.matchKey(s.keyYawRight,S,e,n)&&(he.yawRight=0)
f.O.matchKey(s.boostMove,t,e,n)&&(he.boostMove=0)}),C=e.move.subscribe(function({movementX:t,movementY:n}){if(!e.pointerLock||void 0===t||void 0===n)return
const r=.5*c.width-c.x,i=.5*c.height-c.y
l.ZY.copy(B,Y(r,i)),l.ZY.copy(E,Y(t+r,n+i))}),w=e.lock.subscribe(function(e){e?xe():Se()}),T=e.leave.subscribe(function(){he.moveForward=0,he.moveBack=0,he.moveLeft=0,he.moveRight=0,he.moveUp=0,he.moveDown=0,he.rollLeft=0,he.rollRight=0,he.pitchUp=0,he.pitchDown=0,he.yawLeft=0,he.yawRight=0,he.boostMove=0})
let A=!1
const I=(0,l.eB)(),P=(0,l.eB)(),B=(0,l.ZY)(),E=(0,l.ZY)(),k=(0,l.eB)()
let D=0
const M=(0,l.ZY)(),R=(0,l.ZY)()
let O=0,L=0,N=0
const F=(0,l.ZY)(),z=(0,l.ZY)(),j=(0,l.ZY)(),V=(0,l.ZY)(),U=(0,l.ZY)(),G=(0,l.ZY)(),H=l.eB.clone(t.target),q=l.eB.clone(t.position),Q=l.eB.clone(t.up),$=(0,l.ZY)()
function X(e,t){return l.ZY.set($,(e-c.x)/c.width,(t-c.y)/c.height)}const W=(0,l.ZY)()
function Y(e,t){return l.ZY.set(W,(e-.5*c.width-c.x)/(.5*c.width),(c.height+2*(c.y-t))/c.width)}function Z(){const t=e.width/e.height||1
return o.rotateSpeed*e.pixelRatio*t}const K=(0,l.eB)(),J=(0,l.k)(),ee=(0,l.eB)(),te=(0,l.eB)(),ne=(0,l.eB)(),re=(0,l.eB)(),ie=(0,l.k)(),oe=(0,l.eB)(),ae=(0,l.k)(),se=(0,l.eB)(),le=(0,l.k)(),ce=(0,l.eB)(),ue=(0,l.ZY)(),de=(0,l.eB)(),pe=(0,l.eB)(),he={moveUp:0,moveDown:0,moveLeft:0,moveRight:0,moveForward:0,moveBack:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0,boostMove:0},fe=(0,l.eB)(),me=(0,l.eB)()
function ge(){const e=Math.min(Math.max(1e3*t.state.radiusMax,.01),o.maxDistance)
l.eB.squaredMagnitude(P)>e*e&&(l.eB.setMagnitude(P,P,e),l.eB.add(t.position,t.target,P),l.ZY.copy(F,z),l.ZY.copy(j,V)),l.eB.squaredMagnitude(P)<o.minDistance*o.minDistance&&(l.eB.setMagnitude(P,P,o.minDistance),l.eB.add(t.position,t.target,P),l.ZY.copy(F,z),l.ZY.copy(j,V))}function ye(t,n){return t*=e.pixelRatio,n*=e.pixelRatio,t>c.x+c.width||e.height-n>c.y+c.height||t<c.x||e.height-n<c.y}let ve=-1
function be(r){if(ve===r)return
const i=r-ve
ve>0&&("spin"===o.animate.name?function(e){if("spin"!==o.animate.name||0===o.animate.params.speed||A)return
const t=2*Math.PI*o.animate.params.speed/1e3
_e[0]=e*t/Z(),l.ZY.add(E,B,_e)}(i):"rock"===o.animate.name&&function(e){if("rock"!==o.animate.name||0===o.animate.params.speed||A)return
const t=e/1e3*o.animate.params.speed,n=(0,h.pu)(o.animate.params.angle)/Z(),r=Math.sin(Ce*Math.PI*2)*n,i=Math.sin((Ce+t)*Math.PI*2)*n
we[0]=i-r,l.ZY.add(E,B,we),Ce+=t,Ce>=1&&(Ce=0)}(i)),l.eB.sub(P,t.position,t.target),function(){const e=E[0]-B[0],n=E[1]-B[1]
l.eB.set(re,e,n,0)
const r=l.eB.magnitude(re)*Z()
r?(l.eB.sub(P,t.position,t.target),l.eB.normalize(ee,P),l.eB.normalize(te,t.up),l.eB.normalize(ne,l.eB.cross(ne,te,ee)),l.eB.setMagnitude(te,te,n),l.eB.setMagnitude(ne,ne,e),l.eB.add(re,te,ne),l.eB.normalize(K,l.eB.cross(K,re,P)),l.k.setAxisAngle(J,K,r),l.eB.transformQuat(P,P,J),l.eB.transformQuat(t.up,t.up,J),l.eB.copy(k,K),D=r):!o.staticMoving&&D&&(D*=Math.sqrt(1-o.dynamicDampingFactor),l.eB.sub(P,t.position,t.target),l.k.setAxisAngle(J,k,D),l.eB.transformQuat(P,P,J),l.eB.transformQuat(t.up,t.up,J)),l.ZY.copy(B,E)}(),function(){const e=(he.rollRight-he.rollLeft)/45,n=(R[0]-M[0])*-Math.sign(R[1]),r=(R[1]-M[1])*-Math.sign(R[0]),i=-o.rotateSpeed*(-n+r)+e
i?(l.eB.normalize(oe,P),l.k.setAxisAngle(ie,oe,i),l.eB.transformQuat(t.up,t.up,ie),O=i):!o.staticMoving&&O&&(O*=Math.sqrt(1-o.dynamicDampingFactor),l.eB.normalize(oe,P),l.k.setAxisAngle(ie,oe,O),l.eB.transformQuat(t.up,t.up,ie)),l.ZY.copy(M,R)}(),function(){const e=(he.pitchUp-he.pitchDown)/(o.flyMode?360:90),n=-o.rotateSpeed*e
n?(l.eB.cross(se,P,t.up),l.eB.normalize(se,se),l.k.setAxisAngle(ae,se,n),l.eB.transformQuat(P,P,ae),l.eB.transformQuat(t.up,t.up,ae),L=n):!o.staticMoving&&L&&(L*=Math.sqrt(1-o.dynamicDampingFactor),l.eB.cross(se,P,t.up),l.eB.normalize(se,se),l.k.setAxisAngle(ae,se,L),l.eB.transformQuat(P,P,ae),l.eB.transformQuat(t.up,t.up,ae))}(),function(){const e=(he.yawRight-he.yawLeft)/(o.flyMode?360:90),n=-o.rotateSpeed*e
n?(l.eB.normalize(ce,t.up),l.k.setAxisAngle(le,ce,n),l.eB.transformQuat(P,P,le),l.eB.transformQuat(t.up,t.up,le),N=n):!o.staticMoving&&N&&(N*=Math.sqrt(1-o.dynamicDampingFactor),l.eB.normalize(ce,t.up),l.k.setAxisAngle(le,ce,N),l.eB.transformQuat(P,P,le),l.eB.transformQuat(t.up,t.up,le))}(),function(){const e=1+(z[1]-F[1])*o.zoomSpeed
1!==e&&e>0&&l.eB.scale(P,P,e),o.staticMoving?l.ZY.copy(F,z):F[1]+=(z[1]-F[1])*o.dynamicDampingFactor}(),function(){const e=(V[1]-j[1])*o.zoomSpeed
if(0!==e){const n=Math.max(1,t.state.radius+t.state.radius*e)
t.setState({radius:n})}o.staticMoving?l.ZY.copy(j,V):j[1]+=(V[1]-j[1])*o.dynamicDampingFactor}(),function(){if(l.ZY.sub(ue,l.ZY.copy(ue,G),U),l.ZY.squaredMagnitude(ue)){const n=e.pixelRatio*o.panSpeed
ue[0]*=1/t.zoom*t.viewport.width*n,ue[1]*=1/t.zoom*t.viewport.height*n,l.eB.cross(pe,l.eB.copy(pe,P),t.up),l.eB.setMagnitude(pe,pe,ue[0]),l.eB.setMagnitude(de,t.up,ue[1]),l.eB.add(pe,pe,de),l.eB.add(t.position,t.position,pe),l.eB.add(t.target,t.target,pe),o.staticMoving?l.ZY.copy(U,G):(l.ZY.sub(ue,G,U),l.ZY.scale(ue,ue,o.dynamicDampingFactor),l.ZY.add(U,U,ue))}}(),l.eB.add(t.position,t.target,P),ge(),ve>0&&function(r){l.eB.sub(me,t.position,t.target)
const i=Math.max(t.state.minNear,o.minDistance)
l.eB.setMagnitude(me,me,i)
const a=o.flyMode||e.pointerLock,s=.06*r*o.moveSpeed*(1===he.boostMove?o.boostMoveFactor:1)
if(1===he.moveForward&&(l.eB.distance(t.position,n.boundingSphereVisible.center)<n.boundingSphereVisible.radius&&a?(l.eB.normalize(fe,me),l.eB.scaleAndSub(t.position,t.position,fe,s)):(l.eB.sub(fe,t.position,t.target),l.eB.scale(fe,fe,1-s/100),l.eB.add(t.position,t.target,fe)),a&&l.eB.sub(t.target,t.position,me)),1===he.moveBack&&(l.eB.distance(t.position,n.boundingSphereVisible.center)<n.boundingSphereVisible.radius&&a?(l.eB.normalize(fe,me),l.eB.scaleAndAdd(t.position,t.position,fe,s)):(l.eB.sub(fe,t.position,t.target),l.eB.scale(fe,fe,1+s/100),l.eB.add(t.position,t.target,fe)),a&&l.eB.sub(t.target,t.position,me)),1===he.moveLeft&&(l.eB.cross(fe,me,t.up),l.eB.normalize(fe,fe),a?(l.eB.scaleAndAdd(t.position,t.position,fe,s),l.eB.sub(t.target,t.position,me)):(l.eB.scaleAndSub(t.position,t.position,fe,s),l.eB.sub(t.target,t.position,P))),1===he.moveRight&&(l.eB.cross(fe,me,t.up),l.eB.normalize(fe,fe),a?(l.eB.scaleAndSub(t.position,t.position,fe,s),l.eB.sub(t.target,t.position,me)):(l.eB.scaleAndAdd(t.position,t.position,fe,s),l.eB.sub(t.target,t.position,P))),1===he.moveUp&&(l.eB.normalize(fe,t.up),a?(l.eB.scaleAndAdd(t.position,t.position,fe,s),l.eB.sub(t.target,t.position,me)):(l.eB.scaleAndSub(t.position,t.position,fe,s),l.eB.sub(t.target,t.position,P))),1===he.moveDown&&(l.eB.normalize(fe,t.up),a?(l.eB.scaleAndSub(t.position,t.position,fe,s),l.eB.sub(t.target,t.position,me)):(l.eB.scaleAndAdd(t.position,t.position,fe,s),l.eB.sub(t.target,t.position,P))),a){const e=l.eB.distance(t.position,n.boundingSphereVisible.center)
t.setState({minFar:e+n.boundingSphereVisible.radius})}}(Math.min(i,250)),l.eB.sub(P,t.position,t.target),ge(),l.eB.squaredDistance(I,t.position)>l.p8&&l.eB.copy(I,t.position),ve=r}function xe(){l.eB.sub(me,t.position,t.target)
const e=Math.max(t.state.minNear,o.minDistance)
l.eB.setMagnitude(me,me,e),l.eB.sub(t.target,t.position,me)
const r=l.eB.distance(t.position,n.boundingSphereVisible.center)
t.setState({minFar:r+n.boundingSphereVisible.radius})}function Se(){const{center:e,radius:r}=n.boundingSphereVisible
if(l.eB.distance(t.position,e)>r){const n=t.getFocus(e,r)
t.setState({...n,minFar:0})}else t.setState({minFar:0,radius:n.boundingSphereVisible.radius})}const _e=l.ZY.create(.005,0)
let Ce=0
const we=l.ZY.create(.005,0)
function Te(){Ce=0}return{viewport:c,get isAnimating(){return"off"!==o.animate.name},get isMoving(){return 1===he.moveForward||1===he.moveBack||1===he.moveLeft||1===he.moveRight||1===he.moveUp||1===he.moveDown||1===he.rollLeft||1===he.rollRight||1===he.pitchUp||1===he.pitchDown||1===he.yawLeft||1===he.yawRight},get props(){return o},setProps:e=>{var t
"rock"===(null===(t=e.animate)||void 0===t?void 0:t.name)&&"rock"!==o.animate.name&&Te(),void 0!==e.flyMode&&e.flyMode!==o.flyMode&&(e.flyMode?xe():Se()),Object.assign(o,e)},get attribs(){return a},setAttribs:e=>{Object.assign(a,e),Object.assign(s,a.bindings)},start:function(e){ve=-1,be(e)},update:be,reset:function(){l.eB.copy(t.target,H),l.eB.copy(t.position,q),l.eB.copy(t.up,Q),l.eB.sub(P,t.position,t.target),l.eB.copy(I,t.position)},dispose:function(){u||(u=!0,m.unsubscribe(),y.unsubscribe(),v.unsubscribe(),g.unsubscribe(),b.unsubscribe(),_.unsubscribe(),C.unsubscribe(),w.unsubscribe(),T.unsubscribe())}}}}(_||(_={}))
var C=n(41197),w=n(16625),T=n(43766),A=n(89),I=n(91763),P=n(23729),B=n(83794),E=n(10268),k=n(10596),D=n(14294),M=n(50709),R=n(27011),O=n(9043),L=n(22703)
const N={sceneBoundingSpheres:p.t.Boolean(!1,{description:"Show full scene bounding spheres."}),visibleSceneBoundingSpheres:p.t.Boolean(!1,{description:"Show visible scene bounding spheres."}),objectBoundingSpheres:p.t.Boolean(!1,{description:"Show bounding spheres of visible render objects."}),instanceBoundingSpheres:p.t.Boolean(!1,{description:"Show bounding spheres of visible instances."})}
class F{constructor(e,t,n){this.objectsData=new Map,this.instancesData=new Map,this.scene=T.Z.create(e,"blended"),this.parent=t,this._props={...p.t.getDefaultValues(N),...n}}update(){const e=z(this.scene,this.parent.boundingSphere,this.sceneData,M.ColorNames.lightgrey,j)
e&&(this.sceneData=e)
const t=z(this.scene,this.parent.boundingSphereVisible,this.visibleSceneData,M.ColorNames.black,V)
t&&(this.visibleSceneData=t),this.parent.forEach((e,t)=>{const n=this.objectsData.get(t),r=z(this.scene,e.values.boundingSphere.ref.value,n,M.ColorNames.tomato,U)
r&&this.objectsData.set(t,r)
const i=this.instancesData.get(t),o=z(this.scene,e.values.invariantBoundingSphere.ref.value,i,M.ColorNames.skyblue,G,{aTransform:t.values.aTransform,matrix:t.values.matrix,transform:t.values.transform,extraTransform:t.values.extraTransform,uInstanceCount:t.values.uInstanceCount,instanceCount:t.values.instanceCount,aInstance:t.values.aInstance,hasReflection:t.values.hasReflection,instanceGrid:t.values.instanceGrid})
o&&this.instancesData.set(t,o)}),this.objectsData.forEach((e,t)=>{this.parent.has(t)||(this.scene.remove(e.renderObject),this.objectsData.delete(t))}),this.instancesData.forEach((e,t)=>{this.parent.has(t)||(this.scene.remove(e.renderObject),this.instancesData.delete(t))}),this.scene.update(void 0,!1),this.scene.commit()}syncVisibility(){this.sceneData&&(this.sceneData.renderObject.state.visible=this._props.sceneBoundingSpheres),this.visibleSceneData&&(this.visibleSceneData.renderObject.state.visible=this._props.visibleSceneBoundingSpheres),this.parent.forEach((e,t)=>{const n=this.objectsData.get(t)
n&&(n.renderObject.state.visible=t.state.visible&&this._props.objectBoundingSpheres)
const r=this.instancesData.get(t)
r&&(r.renderObject.state.visible=t.state.visible&&this._props.instanceBoundingSpheres)})}clear(){this.sceneData=void 0,this.objectsData.clear(),this.scene.clear()}get isEnabled(){return this._props.sceneBoundingSpheres||this._props.visibleSceneBoundingSpheres||this._props.objectBoundingSpheres||this._props.instanceBoundingSpheres}get props(){return this._props}setProps(e){Object.assign(this._props,e),this.isEnabled&&this.update()}}function z(e,t,n,r,i,o){if(!n||!D.f8.equals(n.boundingSphere,t)){const a=function(e,t){const n=(0,R.J)(2),r=B.P.createState(n,n/2,t)
if(e.radius&&((0,E.X)(r,e.center,e.radius,2),D.f8.hasExtrema(e)))for(const i of e.extrema)(0,E.X)(r,i,1,0)
return B.P.getMesh(r)}(t,n&&n.mesh),s=n?n.renderObject:function(e,t,n,r){const i=k.e.Utils.createValuesSimple(e,{alpha:.1,doubleSided:!1,cellSize:0,batchSize:0},t,1,r)
return(0,P.o)("mesh",i,{disposed:!1,visible:!0,alphaFactor:1,pickable:!1,colorOnly:!1,opaque:!1,writeDepth:!1},n)}(a,r,i,o)
return n?O.IQ.updateIfChanged(s.values.drawCount,L.V.getDrawCount(a)):e.add(s),{boundingSphere:D.f8.clone(t),renderObject:s,mesh:a}}}const j=(0,P.Q0)(),V=(0,P.Q0)(),U=(0,P.Q0)(),G=(0,P.Q0)()
var H=n(42261),q=n(17487),Q=n(48393),$=n(55920)
const X=(0,l.eB)(),W=(0,l.eB)(),Y=(0,l.eB)(),Z={maxFps:p.t.Numeric(30,{min:10,max:60,step:10}),preferAtomPixelPadding:p.t.Numeric(3,{min:0,max:20,step:1},{description:"Number of extra pixels at which to prefer atoms over bonds."}),convertCoordsToRay:p.t.Boolean(!1,{description:"Convert screen coordinates to ray for picking."})}
class K{setProps(e){Object.assign(this.props,e)}getTarget(){return this.ray?this.ray:this.props.convertCoordsToRay?this.camera.getRay((0,$.U)(),this.endX,this.input.height-this.endY):l.ZY.create(this.endX,this.endY)}handleMove(){(this.startX!==this.endX||this.startY!==this.endY||this.input.pointerLock&&!this.controls.isMoving)&&(this.pickData=this.canvasAsyncIdentify(this.getTarget()),this.startX=this.endX,this.startY=this.endY)}handleClick(){const e=this.canvasIdentify(this.getTarget()),t=this.getLoci(null==e?void 0:e.id,null==e?void 0:e.position)
this.events.click.next({current:t,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:l.ZY.create(this.endX,this.endY),position:null==e?void 0:e.position}),this.prevLoci=t}handleDrag(){(this.startX!==this.endX||this.startY!==this.endY||this.input.pointerLock&&!this.controls.isMoving)&&!this.outsideViewport(this.startX,this.startY,this.ray)&&(this.events.drag.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers,pageStart:l.ZY.create(this.startX,this.startY),pageEnd:l.ZY.create(this.endX,this.endY)}),this.startX=this.endX,this.startY=this.endY)}tick(e){if(this.inside){if(this.pickData){const e=this.pickData.tryGet()
if("pending"!==e){if(this.position=null==e?void 0:e.position,this.inside){const t=this.getLoci(null==e?void 0:e.id,null==e?void 0:e.position)
this.events.hover.next({current:t,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:l.ZY.create(this.endX,this.endY),position:null==e?void 0:e.position}),this.prevLoci=t}this.pickData=void 0}}e-this.prevT>1e3/this.props.maxFps&&(this.prevT=e,this.isInteracting?this.handleDrag():this.handleMove())}}leave(){this.inside=!1,w.YL.Loci.isEmpty(this.prevLoci)||(this.prevLoci=w.YL.Loci.Empty,this.events.hover.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers}))}move(e,t,n,r,i,o){this.inside=!0,this.buttons=n,this.button=r,this.modifiers=i,this.ray=o,this.endX=e,this.endY=t}click(e,t,n,r,i,o){this.endX=e,this.endY=t,this.buttons=n,this.button=r,this.modifiers=i,this.ray=o,this.handleClick()}drag(e,t,n,r,i){this.endX=e,this.endY=t,this.buttons=n,this.button=r,this.modifiers=i,this.handleDrag()}modify(e){c.Fs.areEqual(e,this.modifiers)||(this.modifiers=e,this.events.hover.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:l.ZY.create(this.endX,this.endY),position:this.position}))}outsideViewport(e,t,n){if(n)return!1
const{input:r,camera:{viewport:i}}=this
return e*=r.pixelRatio,t*=r.pixelRatio,e>i.x+i.width||r.height-t>i.y+i.height||e<i.x||r.height-t<i.y}getLoci(e,t){var n
const{repr:r,loci:i}=this.lociGetter(e)
if(t&&r&&Q.Bond.isLoci(i)&&2===i.bonds.length){const{aUnit:e,aIndex:o}=i.bonds[0]
e.conformation.position(e.elements[o],X),l.eB.sub(Y,this.camera.state.position,this.camera.state.target),l.eB.projectPointOnPlane(W,t,Y,X)
const a=this.camera.getPixelSize(W)
let s=r.theme.size.size(i.bonds[0])*(null!==(n=r.props.sizeFactor)&&void 0!==n?n:1)
if(!1===r.props.lineSizeAttenuation&&(s*=a/2),s+=this.props.preferAtomPixelPadding*a,l.eB.distance(W,X)<s)return{repr:r,loci:Q.Bond.toFirstStructureElementLoci(i)}}return{repr:r,loci:i}}dispose(){this.ev.dispose()}constructor(e,t,n,r,i,o,a={}){this.canvasIdentify=e,this.canvasAsyncIdentify=t,this.lociGetter=n,this.input=r,this.camera=i,this.controls=o,this.ev=q.V.create(),this.events={hover:this.ev(),drag:this.ev(),click:this.ev()},this.startX=-1,this.startY=-1,this.endX=-1,this.endY=-1,this.ray=void 0,this.pickData=void 0,this.position=void 0,this.isInteracting=!1,this.prevLoci=w.YL.Loci.Empty,this.prevT=0,this.inside=!1,this.buttons=c.qt.create(0),this.button=c.qt.create(0),this.modifiers=c.Fs.None,this.props={...p.t.getDefaultValues(Z),...a},r.drag.subscribe(({x:e,y:t,buttons:n,button:r,modifiers:i})=>{this.isInteracting=!0,this.drag(e,t,n,r,i)}),r.move.subscribe(({x:e,y:t,inside:n,buttons:r,button:i,modifiers:o,onElement:a,ray:s})=>{n&&!this.isInteracting&&(a?this.move(e,t,r,i,o,s):this.leave())}),r.leave.subscribe(()=>{this.leave()}),r.click.subscribe(({x:e,y:t,buttons:n,button:r,modifiers:i,ray:o})=>{this.outsideViewport(e,t,o)||this.click(e,t,n,r,i,o)}),r.interactionEnd.subscribe(()=>{this.isInteracting=!1}),r.modifiers.subscribe(e=>{this.modify(e)})}}var J=n(8881),ee=n(46357),te=n(19708),ne=n(95916),re=n(83164),ie=n(36568),oe=n(85362)
const ae="\nprecision highp float;\nprecision highp sampler2D;\n\nuniform sampler2D tColor;\nuniform vec2 uTexSize;\nuniform float uWeight;\n\nvoid main() {\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n    gl_FragColor = texture2D(tColor, coords) * uWeight;\n}\n"
var se=n(5638)
const le={...ee.du,tColor:(0,te.$G)("texture","rgba","ubyte","nearest"),uTexSize:(0,te.w5)("v2"),uWeight:(0,te.w5)("f")},ce=(0,ne.NG)("compose",oe.e,ae),ue={mode:p.t.Select("temporal",[["off","Off"],["on","On"],["temporal","Temporal"]]),sampleLevel:p.t.Numeric(2,{min:0,max:5,step:1},{description:"Take level^2 samples."}),reduceFlicker:p.t.Boolean(!0,{description:'Reduce flicker in "temporal" mode.'}),reuseOcclusion:p.t.Boolean(!0,{description:"Reuse occlusion data. It is faster but has some artefacts."})}
class de{static isEnabled(e){return"off"!==e.mode}constructor(e,t){this.webgl=e,this.drawPass=t
const{colorBufferFloat:n,textureFloat:r,colorBufferHalfFloat:i,textureHalfFloat:o}=e.extensions,a=t.colorTarget.getWidth(),s=t.colorTarget.getHeight()
this.colorTarget=e.createRenderTarget(a,s,!1)
const c=i&&o?"fp16":n&&r?"float32":"uint8"
this.composeTarget=e.createRenderTarget(a,s,!1,c),this.holdTarget=e.createRenderTarget(a,s,!1),this.compose=function(e,t){const n={...ee.OM,tColor:O.IQ.create(t),uTexSize:O.IQ.create(l.ZY.create(t.getWidth(),t.getHeight())),uWeight:O.IQ.create(1)},r={...le},i=(0,re.$h)(e,"triangles",ce,r,n)
return(0,ie._)(i,n)}(e,t.colorTarget.texture)}getByteCount(){return this.colorTarget.getByteCount()+this.composeTarget.getByteCount()+this.holdTarget.getByteCount()}syncSize(){const e=this.drawPass.colorTarget.getWidth(),t=this.drawPass.colorTarget.getHeight(),[n,r]=this.compose.values.uTexSize.ref.value
e===n&&t===r||(this.colorTarget.setSize(e,t),this.composeTarget.setSize(e,t),this.holdTarget.setSize(e,t),O.IQ.update(this.compose.values.uTexSize,l.ZY.set(this.compose.values.uTexSize.ref.value,e,t)))}render(e,t,n,r,i){return"temporal"!==n.multiSample.mode||i?(this.renderMultiSample(t,r,n),-2):this.renderTemporalMultiSample(e,t,n,r)}bindOutputTarget(e){e?this.webgl.bindDrawingBuffer():this.colorTarget.bind()}renderMultiSample(e,t,n){const{camera:r}=e,{compose:i,composeTarget:o,drawPass:a,webgl:s}=this,{gl:l,state:c}=s
se.g$&&s.timer.mark("MultiSamplePass.renderMultiSample")
const u=pe[Math.max(0,Math.min(n.multiSample.sampleLevel,5))],{x:d,y:p,width:h,height:f}=r.viewport,m=1/u.length
r.viewOffset.enabled=!0,O.IQ.update(i.values.tColor,a.getColorTarget(n.postprocessing).texture),i.update()
for(let g=0;g<u.length;++g){const t=u[g]
I.i.setViewOffset(r.viewOffset,h,f,t[0],t[1],h,f),r.update()
const s=m+.03125*((g+.5)/u.length-.5)
O.IQ.update(i.values.uWeight,s),0!==g&&n.multiSample.reuseOcclusion?a.postprocessing.setOcclusionOffset(t[0]/h,t[1]/f):a.postprocessing.setOcclusionOffset(0,0),a.render(e,n,!1),o.bind(),c.enable(l.BLEND),c.blendEquationSeparate(l.FUNC_ADD,l.FUNC_ADD),c.blendFuncSeparate(l.ONE,l.ONE,l.ONE,l.ONE),c.disable(l.DEPTH_TEST),c.depthMask(!1),c.viewport(d,p,h,f),c.scissor(d,p,h,f),0===g&&(c.clearColor(0,0,0,0),l.clear(l.COLOR_BUFFER_BIT)),i.render()}a.postprocessing.setOcclusionOffset(0,0),O.IQ.update(i.values.uWeight,1),O.IQ.update(i.values.tColor,o.texture),i.update(),this.bindOutputTarget(t),c.viewport(d,p,h,f),c.scissor(d,p,h,f),c.disable(l.BLEND),i.render(),r.viewOffset.enabled=!1,r.update(),se.g$&&s.timer.markEnd("MultiSamplePass.renderMultiSample")}renderTemporalMultiSample(e,t,n,r){const{camera:i}=t,{compose:o,composeTarget:a,holdTarget:s,drawPass:l,webgl:c}=this,{gl:u,state:d}=c
se.g$&&c.timer.mark("MultiSamplePass.renderTemporalMultiSample")
const p=pe[Math.max(0,Math.min(n.multiSample.sampleLevel,5))]
if(-2===e||e>=p.length)return-2
const{x:h,y:f,width:m,height:g}=i.viewport,y=1/p.length
if(-1===e)l.render(t,n,!1),O.IQ.update(o.values.uWeight,1),O.IQ.update(o.values.tColor,l.getColorTarget(n.postprocessing).texture),o.update(),s.bind(),d.disable(u.BLEND),d.disable(u.DEPTH_TEST),d.depthMask(!1),d.viewport(h,f,m,g),d.scissor(h,f,m,g),o.render(),e+=1
else{i.viewOffset.enabled=!0,O.IQ.update(o.values.tColor,l.getColorTarget(n.postprocessing).texture),O.IQ.update(o.values.uWeight,y),o.update()
const r=Math.pow(2,Math.max(0,n.multiSample.sampleLevel-2))
for(let s=0;s<r;++s){const r=p[e]
if(I.i.setViewOffset(i.viewOffset,m,g,r[0],r[1],m,g),i.update(),0!==e&&n.multiSample.reuseOcclusion?l.postprocessing.setOcclusionOffset(r[0]/m,r[1]/g):l.postprocessing.setOcclusionOffset(0,0),l.render(t,n,!1),a.bind(),d.enable(u.BLEND),d.blendEquationSeparate(u.FUNC_ADD,u.FUNC_ADD),d.blendFuncSeparate(u.ONE,u.ONE,u.ONE,u.ONE),d.disable(u.DEPTH_TEST),d.depthMask(!1),d.viewport(h,f,m,g),d.scissor(h,f,m,g),0===e&&(d.clearColor(0,0,0,0),u.clear(u.COLOR_BUFFER_BIT)),o.render(),(e+=1)>=p.length)break}}l.postprocessing.setOcclusionOffset(0,0),this.bindOutputTarget(r),d.viewport(h,f,m,g),d.scissor(h,f,m,g)
const v=e*y
return v>0&&(O.IQ.update(o.values.uWeight,1),O.IQ.update(o.values.tColor,a.texture),o.update(),d.disable(u.BLEND),o.render()),v<1&&(O.IQ.update(o.values.uWeight,1-v),O.IQ.update(o.values.tColor,s.texture),o.update(),0===v?d.disable(u.BLEND):d.enable(u.BLEND),o.render()),i.viewOffset.enabled=!1,i.update(),se.g$&&c.timer.markEnd("MultiSamplePass.renderTemporalMultiSample"),e>=p.length?-2:e}}const pe=[[[0,0]],[[0,0],[-4,-4]],[[0,0],[6,-2],[-6,2],[2,6]],[[0,0],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[0,0],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[0,0],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]]
pe.forEach(e=>{e.forEach(e=>{e[0]*=.0625,e[1]*=.0625})})
class he{update(e,t){return e&&(this.sampleIndex=-1),"temporal"===t.mode&&-2!==this.sampleIndex}render(e,t,n,r){return this.sampleIndex=this.multiSamplePass.render(this.sampleIndex,e,t,n,!!r),this.sampleIndex<0}constructor(e){this.multiSamplePass=e,this.sampleIndex=-2}}var fe=n(71196),me=n(24060),ge=n(53138)
class ye{constructor(e,t,n,r){this.webgl=e,this.width=t,this.height=n,this.pickScale=r
const i=r/e.pixelRatio
this.pickWidth=Math.ceil(t*i),this.pickHeight=Math.ceil(n*i)
const{resources:o,extensions:{drawBuffers:a},gl:s}=e
a?(this.objectPickTexture=o.texture("image-uint8","rgba","ubyte","nearest"),this.objectPickTexture.define(this.pickWidth,this.pickHeight),this.instancePickTexture=o.texture("image-uint8","rgba","ubyte","nearest"),this.instancePickTexture.define(this.pickWidth,this.pickHeight),this.groupPickTexture=o.texture("image-uint8","rgba","ubyte","nearest"),this.groupPickTexture.define(this.pickWidth,this.pickHeight),this.depthPickTexture=o.texture("image-uint8","rgba","ubyte","nearest"),this.depthPickTexture.define(this.pickWidth,this.pickHeight),this.framebuffer=o.framebuffer(),this.objectPickFramebuffer=o.framebuffer(),this.instancePickFramebuffer=o.framebuffer(),this.groupPickFramebuffer=o.framebuffer(),this.depthPickFramebuffer=o.framebuffer(),this.framebuffer.bind(),a.drawBuffers([a.COLOR_ATTACHMENT0,a.COLOR_ATTACHMENT1,a.COLOR_ATTACHMENT2,a.COLOR_ATTACHMENT3]),this.objectPickTexture.attachFramebuffer(this.framebuffer,"color0"),this.instancePickTexture.attachFramebuffer(this.framebuffer,"color1"),this.groupPickTexture.attachFramebuffer(this.framebuffer,"color2"),this.depthPickTexture.attachFramebuffer(this.framebuffer,"color3"),this.depthRenderbuffer=(0,me.C6)(s)?o.renderbuffer("depth32f","depth",this.pickWidth,this.pickHeight):o.renderbuffer("depth16","depth",this.pickWidth,this.pickHeight),this.depthRenderbuffer.attachFramebuffer(this.framebuffer),this.objectPickTexture.attachFramebuffer(this.objectPickFramebuffer,"color0"),this.instancePickTexture.attachFramebuffer(this.instancePickFramebuffer,"color0"),this.groupPickTexture.attachFramebuffer(this.groupPickFramebuffer,"color0"),this.depthPickTexture.attachFramebuffer(this.depthPickFramebuffer,"color0")):(this.objectPickTarget=e.createRenderTarget(this.pickWidth,this.pickHeight),this.instancePickTarget=e.createRenderTarget(this.pickWidth,this.pickHeight),this.groupPickTarget=e.createRenderTarget(this.pickWidth,this.pickHeight),this.depthPickTarget=e.createRenderTarget(this.pickWidth,this.pickHeight))}getByteCount(){return this.webgl.extensions.drawBuffers?this.objectPickTexture.getByteCount()+this.instancePickTexture.getByteCount()+this.groupPickTexture.getByteCount()+this.depthPickTexture.getByteCount()+this.depthRenderbuffer.getByteCount():this.objectPickTarget.getByteCount()+this.instancePickTarget.getByteCount()+this.groupPickTarget.getByteCount()+this.depthPickTarget.getByteCount()}dispose(){this.webgl.extensions.drawBuffers?(this.framebuffer.destroy(),this.objectPickTexture.destroy(),this.instancePickTexture.destroy(),this.groupPickTexture.destroy(),this.depthPickTexture.destroy(),this.objectPickFramebuffer.destroy(),this.instancePickFramebuffer.destroy(),this.groupPickFramebuffer.destroy(),this.depthPickFramebuffer.destroy(),this.depthRenderbuffer.destroy()):(this.objectPickTarget.destroy(),this.instancePickTarget.destroy(),this.groupPickTarget.destroy(),this.depthPickTarget.destroy())}get pickRatio(){return this.pickScale/this.webgl.pixelRatio}setPickScale(e){this.pickScale=e,this.setSize(this.width,this.height)}bindObject(){this.webgl.extensions.drawBuffers?this.objectPickFramebuffer.bind():this.objectPickTarget.bind()}bindInstance(){this.webgl.extensions.drawBuffers?this.instancePickFramebuffer.bind():this.instancePickTarget.bind()}bindGroup(){this.webgl.extensions.drawBuffers?this.groupPickFramebuffer.bind():this.groupPickTarget.bind()}bindDepth(){this.webgl.extensions.drawBuffers?this.depthPickFramebuffer.bind():this.depthPickTarget.bind()}get drawingBufferHeight(){return this.height}setSize(e,t){this.width=e,this.height=t
const n=this.pickScale/this.webgl.pixelRatio,r=Math.ceil(this.width*n),i=Math.ceil(this.height*n)
r===this.pickWidth&&i===this.pickHeight||(this.pickWidth=r,this.pickHeight=i,this.webgl.extensions.drawBuffers?(this.objectPickTexture.define(this.pickWidth,this.pickHeight),this.instancePickTexture.define(this.pickWidth,this.pickHeight),this.groupPickTexture.define(this.pickWidth,this.pickHeight),this.depthPickTexture.define(this.pickWidth,this.pickHeight),this.depthRenderbuffer.setSize(this.pickWidth,this.pickHeight)):(this.objectPickTarget.setSize(this.pickWidth,this.pickHeight),this.instancePickTarget.setSize(this.pickWidth,this.pickHeight),this.groupPickTarget.setSize(this.pickWidth,this.pickHeight),this.depthPickTarget.setSize(this.pickWidth,this.pickHeight)))}reset(){const{drawBuffers:e}=this.webgl.extensions
e&&(this.framebuffer.bind(),e.drawBuffers([e.COLOR_ATTACHMENT0,e.COLOR_ATTACHMENT1,e.COLOR_ATTACHMENT2,e.COLOR_ATTACHMENT3]),this.objectPickTexture.attachFramebuffer(this.framebuffer,"color0"),this.instancePickTexture.attachFramebuffer(this.framebuffer,"color1"),this.groupPickTexture.attachFramebuffer(this.framebuffer,"color2"),this.depthPickTexture.attachFramebuffer(this.framebuffer,"color3"),this.depthRenderbuffer.attachFramebuffer(this.framebuffer),this.objectPickTexture.attachFramebuffer(this.objectPickFramebuffer,"color0"),this.instancePickTexture.attachFramebuffer(this.instancePickFramebuffer,"color0"),this.groupPickTexture.attachFramebuffer(this.groupPickFramebuffer,"color0"),this.depthPickTexture.attachFramebuffer(this.depthPickFramebuffer,"color0"))}renderVariant(e,t,n,r,i,o){e.clear(!1),e.update(t,n),e.renderPick(n.primitives,t,i,o),r.handle.isEnabled&&e.renderPick(r.handle.scene,t,i,o),r.camera.isEnabled&&(r.camera.update(t),e.update(r.camera.camera,r.camera.scene),e.renderPick(r.camera.scene,r.camera.camera,i,o))}render(e,t,n,r){this.webgl.extensions.drawBuffers?(this.framebuffer.bind(),this.renderVariant(e,t,n,r,"pick",u.OK.None)):(this.objectPickTarget.bind(),this.renderVariant(e,t,n,r,"pick",u.OK.Object),this.instancePickTarget.bind(),this.renderVariant(e,t,n,r,"pick",u.OK.Instance),this.groupPickTarget.bind(),this.renderVariant(e,t,n,r,"pick",u.OK.Group),this.depthPickTarget.bind(),this.renderVariant(e,t,n,r,"depth",u.OK.None))}}let ve=!1
function be(e){return!!e.isWebGL2||(se.Bb&&!ve&&(console.log("WebGL2 required for async picking. Falling back to synchronous picking."),ve=!0),!1)}var xe
!function(e){e[e.Pending=0]="Pending",e[e.Resolved=1]="Resolved",e[e.Failed=2]="Failed"}(xe||(xe={}))
class Se{setup(){const e=this.viewport.width*this.viewport.height*4
this.object&&this.object.length===e||(this.object=new Uint8Array(e),this.instance=new Uint8Array(e),this.group=new Uint8Array(e),this.depth=new Uint8Array(e))}setViewport(e,t,n,r){d.LM.set(this.viewport,e,t,n,r),this.setup()}read(){se.g$&&this.webgl.timer.mark("PickBuffers.read")
const{x:e,y:t,width:n,height:r}=this.viewport
this.pickPass.bindObject(),this.webgl.readPixels(e,t,n,r,this.object),this.pickPass.bindInstance(),this.webgl.readPixels(e,t,n,r,this.instance),this.pickPass.bindGroup(),this.webgl.readPixels(e,t,n,r,this.group),this.pickPass.bindDepth(),this.webgl.readPixels(e,t,n,r,this.depth),this.ready=!0,se.g$&&this.webgl.timer.markEnd("PickBuffers.read")}asyncRead(){const{gl:e}=this.webgl
if(!(0,me.C6)(e))return
se.g$&&this.webgl.timer.mark("PickBuffers.asyncRead"),null!==this.fenceSync&&e.deleteSync(this.fenceSync)
const{x:t,y:n,width:r,height:i}=this.viewport
this.pickPass.bindObject(),this.objectBuffer.read(t,n,r,i),this.pickPass.bindInstance(),this.instanceBuffer.read(t,n,r,i),this.pickPass.bindGroup(),this.groupBuffer.read(t,n,r,i),this.pickPass.bindDepth(),this.depthBuffer.read(t,n,r,i),this.fenceTimestamp=(0,s.t)(),this.fenceSync=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0),e.flush(),this.ready=!1,se.g$&&this.webgl.timer.markEnd("PickBuffers.asyncRead")}check(){if(this.ready)return xe.Resolved
if(null===this.fenceSync)return xe.Failed
const{gl:e}=this.webgl
if(!(0,me.C6)(e))return xe.Failed
const t=e.clientWaitSync(this.fenceSync,0,0)
return t===e.WAIT_FAILED||this.lag>=this.maxAsyncReadLag?t!==e.WAIT_FAILED&&(0,s.t)()-this.fenceTimestamp<1e3/60?(this.lag+=1,xe.Pending):(e.deleteSync(this.fenceSync),this.fenceSync=null,this.lag=0,this.ready=!1,xe.Failed):t===e.TIMEOUT_EXPIRED?(this.lag+=1,xe.Pending):(this.objectBuffer.getSubData(this.object),this.instanceBuffer.getSubData(this.instance),this.groupBuffer.getSubData(this.group),this.depthBuffer.getSubData(this.depth),e.deleteSync(this.fenceSync),this.fenceSync=null,this.lag=0,this.ready=!0,xe.Resolved)}getIdx(e,t){return 4*(t*this.viewport.width+e)}getDepth(e,t){if(!this.ready)return-1
const n=this.getIdx(e,t),r=this.depth
return(0,ge.FO)(r[n],r[n+1],r[n+2],r[n+3])}getId(e,t,n){if(!this.ready)return-1
const r=this.getIdx(e,t)
return(0,ge.OK)(n[r],n[r+1],n[r+2])}getObjectId(e,t){return this.getId(e,t,this.object)}getInstanceId(e,t){return this.getId(e,t,this.instance)}getGroupId(e,t){return this.getId(e,t,this.group)}getPickingId(e,t){const n=this.getObjectId(e,t)
if(-1===n||n===fe.$.Null)return
const r=this.getInstanceId(e,t)
if(-1===r||r===fe.$.Null)return
const i=this.getGroupId(e,t)
return-1!==i?{objectId:n,instanceId:r,groupId:i}:void 0}reset(){this.fenceSync=null,this.ready=!1,this.lag=0,this.fenceTimestamp=0}dispose(){const{gl:e}=this.webgl;(0,me.C6)(e)&&(this.objectBuffer.destroy(),this.instanceBuffer.destroy(),this.groupBuffer.destroy(),this.depthBuffer.destroy(),null!==this.fenceSync&&(e.deleteSync(this.fenceSync),this.fenceSync=null))}constructor(e,t,n=5){this.webgl=e,this.pickPass=t,this.maxAsyncReadLag=n,this.viewport=d.LM.create(0,0,0,0),this.fenceSync=null,this.fenceTimestamp=0,this.ready=!1,this.lag=0,e.isWebGL2&&(this.objectBuffer=e.resources.pixelPack("rgba","ubyte"),this.instanceBuffer=e.resources.pixelPack("rgba","ubyte"),this.groupBuffer=e.resources.pixelPack("rgba","ubyte"),this.depthBuffer=e.resources.pixelPack("rgba","ubyte")),this.setup()}}var _e=n(37411)
const Ce={eyeSeparation:p.t.Numeric(.062,{min:.02,max:.1,step:.001},{description:"Distance between left and right camera."}),focus:p.t.Numeric(10,{min:1,max:20,step:.1},{description:"Apparent object distance."})},we=p.t.getDefaultValues(Ce)
class Te{get viewport(){return this.parent.viewport}get viewOffset(){return this.parent.viewOffset}constructor(e,t={}){this.parent=e,this.left=new Ae,this.right=new Ae,this.props={...we,...t}}setProps(e){Object.assign(this.props,e)}update(e){this.parent.update(),e?function(e,t,n,r){Ee(e,t,r.pose.views[0],r.layer),1===r.pose.views.length?n.disabled=!0:Ee(e,n,r.pose.views[1],r.layer)}(this.parent,this.left,this.right,e):function(e,t,n,r){Be(e,n),Be(e,r)
const i=Math.floor(e.viewport.width/2),o=i/e.viewport.height
n.viewport.width=i,r.viewport.x+=i,r.viewport.width-=i
const a=t.eyeSeparation/2,s=a*e.near/t.focus,c=e.near*Math.tan(.5*e.state.fov)
let u,d
Ie[12]=-a,Pe[12]=a,u=-c*o+s,d=c*o+s,n.projection[0]=2*e.near/(d-u),n.projection[8]=(d+u)/(d-u),l.$I.mul(n.view,n.view,Ie),l.$I.mul(n.projectionView,n.projection,n.view),l.$I.invert(n.inverseProjectionView,n.projectionView),u=-c*o-s,d=c*o-s,r.projection[0]=2*e.near/(d-u),r.projection[8]=(d+u)/(d-u),l.$I.mul(r.view,r.view,Pe),l.$I.mul(r.projectionView,r.projection,r.view),l.$I.invert(r.inverseProjectionView,r.projectionView),n.disabled=!1,r.disabled=!1}(this.parent,this.props,this.left,this.right)}}!function(e){e.is=function(e){return"left"in e&&"right"in e}}(Te||(Te={}))
class Ae{constructor(){this.viewport=d.LM.create(0,0,0,0),this.view=(0,l.$I)(),this.projection=(0,l.$I)(),this.projectionView=(0,l.$I)(),this.inverseProjectionView=(0,l.$I)(),this.headRotation=(0,l.$I)(),this.viewEye=(0,l.$I)(),this.isAsymmetricProjection=!0,this.state=I.i.createDefaultSnapshot(),this.viewOffset=I.i.ViewOffset(),this.far=0,this.near=0,this.fogFar=0,this.fogNear=0,this.forceFull=!1,this.scale=0,this.minTargetDistance=0,this.disabled=!1}getRay(e,t,n){return l.$I.getTranslation(e.origin,l.$I.invert((0,l.$I)(),this.view)),l.eB.set(e.direction,t,n,.5),(0,d.IW)(e.direction,e.direction,this.viewport,this.inverseProjectionView),l.eB.normalize(e.direction,l.eB.sub(e.direction,e.direction,e.origin)),e}}const Ie=l.$I.identity(),Pe=l.$I.identity()
function Be(e,t){d.LM.copy(t.viewport,e.viewport),l.$I.copy(t.view,e.view),l.$I.copy(t.projection,e.projection),l.$I.copy(t.headRotation,e.headRotation),I.i.copySnapshot(t.state,e.state),I.i.copyViewOffset(t.viewOffset,e.viewOffset),t.far=e.far,t.near=e.near,t.fogFar=e.fogFar,t.fogNear=e.fogNear,t.forceFull=e.forceFull,t.scale=e.scale,t.minTargetDistance=e.minTargetDistance}function Ee(e,t,n,r){Be(e,t)
const i=r.getViewport(n)
d.LM.set(t.viewport,i.x,i.y,i.width,i.height),l.$I.fromArray(t.projection,n.projectionMatrix,0),l.$I.fromArray(t.view,n.transform.inverse.matrix,0),l.$I.mul(t.projectionView,t.projection,t.view),l.$I.invert(t.inverseProjectionView,t.projectionView),t.disabled=!1}class ke{setViewport(e,t,n,r){d.LM.set(this.viewport,e,t,n,r),this.update()}setPickPadding(e){this.pickPadding!==e&&(this.pickPadding=e,this.update())}update(){const{x:e,y:t,width:n,height:r}=this.viewport
this.pickRatio=this.pickPass.pickRatio,this.pickX=Math.ceil(e*this.pickRatio),this.pickY=Math.ceil(t*this.pickRatio)
const i=Math.floor(n*this.pickRatio),o=Math.floor(r*this.pickRatio)
i===this.pickWidth&&o===this.pickHeight||(this.pickWidth=i,this.pickHeight=o,this.halfPickWidth=Math.floor(this.pickWidth/2),this.buffers.setViewport(this.pickX,this.pickY,this.pickWidth,this.pickHeight)),this.spiral=(0,h.k4)(Math.ceil(this.pickRatio*this.pickPadding)),this.dirty=!0}render(e){se.g$&&this.webgl.timer.mark("PickHelper.render",{captureStats:!0})
const{pickX:t,pickY:n,pickWidth:r,pickHeight:i,halfPickWidth:o}=this,{renderer:a,scene:s,helper:l}=this
a.setTransparentBackground(!1),a.setDrawingBufferSize(r,i),a.setPixelRatio(this.pickRatio),Te.is(e)?(a.setViewport(t,n,o,i),this.pickPass.render(a,e.left,s,l),a.setViewport(t+o,n,r-o,i),this.pickPass.render(a,e.right,s,l)):(a.setViewport(t,n,r,i),this.pickPass.render(a,e,s,l)),this.dirty=!1,se.g$&&this.webgl.timer.markEnd("PickHelper.render")}identifyInternal(e,t,n){if(this.webgl.isContextLost)return
const{webgl:r,pickRatio:i}=this
if(r.isContextLost)return
e*=r.pixelRatio,t*=r.pixelRatio,t=this.pickPass.drawingBufferHeight-t
const{viewport:o}=this
if(e<o.x||t<o.y||e>o.x+o.width||t>o.y+o.height)return
const a=e-o.x,s=t-o.y,l=Math.floor(a*i),c=Math.floor(s*i),u=this.buffers.getPickingId(l,c)
if(void 0===u)return
const p=this.buffers.getDepth(l,c),h=_e.e.create(e,t,p)
if(Te.is(n)){const t=Math.floor(o.width/2)
e>o.x+t?(h[0]=o.x+2*(a-t),(0,d.IW)(h,h,o,n.right.inverseProjectionView)):(h[0]=o.x+2*a,(0,d.IW)(h,h,o,n.left.inverseProjectionView))}else(0,d.IW)(h,h,o,n.inverseProjectionView)
return{id:u,position:h}}prepare(){this.pickRatio!==this.pickPass.pickRatio&&this.update()}getPickData(e,t,n){for(const r of this.spiral){const i=this.identifyInternal(e+r[0],t+r[1],n)
if(i)return i}}identify(e,t,n){return this.prepare(),this.dirty&&(se.g$&&this.webgl.timer.mark("PickHelper.identify"),this.webgl.resources.finalizePrograms(["pick"],!0),this.render(n),this.buffers.read(),se.g$&&this.webgl.timer.markEnd("PickHelper.identify")),this.getPickData(e,t,n)}asyncIdentify(e,t,n){return this.prepare(),this.dirty&&(se.g$&&this.webgl.timer.mark("PickHelper.asyncIdentify"),this.render(n),this.buffers.asyncRead(),se.g$&&this.webgl.timer.markEnd("PickHelper.asyncIdentify")),{tryGet:()=>{const r=this.buffers.check()
return r===xe.Resolved?this.getPickData(e,t,n):r===xe.Pending?"pending":void(r===xe.Failed&&(this.dirty=!0))}}}reset(){this.buffers.reset(),this.dirty=!0}dispose(){this.buffers.dispose()}constructor(e,t,n,r,i,o,a){this.webgl=e,this.renderer=t,this.scene=n,this.helper=r,this.pickPass=i,this.dirty=!0,this.buffers=new Se(this.webgl,this.pickPass),this.viewport=(0,d.LM)(),this.setViewport(o.x,o.y,o.width,o.height),this.pickPadding=a.pickPadding,be(e)||(this.asyncIdentify=(e,t,n)=>({tryGet:()=>this.identify(e,t,n)}))}}const De={...ee.du,tWboitA:(0,te.$G)("texture","rgba","float","nearest"),tWboitB:(0,te.$G)("texture","rgba","float","nearest"),uTexSize:(0,te.w5)("v2")},Me=(0,ne.NG)("evaluate-wboit",oe.e,"\nprecision highp float;\n\nuniform sampler2D tWboitA;\nuniform sampler2D tWboitB;\nuniform vec2 uTexSize;\n\nvoid main() {\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n\n    vec4 accum = texture2D(tWboitA, coords);\n    float r = 1.0 - accum.a;\n\n    accum.a = texture2D(tWboitB, coords).r;\n    // divisor needs to allow very small values for nice fading\n    gl_FragColor = vec4(accum.rgb / clamp(accum.a, 0.00000001, 50000.0), r);\n}\n")
class Re{get supported(){return this._supported}getByteCount(){return this._supported?this.textureA.getByteCount()+this.textureB.getByteCount()+this.depthRenderbuffer.getByteCount():0}bind(){const{state:e,gl:t}=this.webgl
this.framebuffer.bind(),e.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT),e.disable(t.DEPTH_TEST),e.blendFuncSeparate(t.ONE,t.ONE,t.ZERO,t.ONE_MINUS_SRC_ALPHA),e.enable(t.BLEND)}render(){se.g$&&this.webgl.timer.mark("WboitPass.render")
const{state:e,gl:t}=this.webgl
e.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),e.enable(t.BLEND),this.renderable.update(),this.renderable.render(),se.g$&&this.webgl.timer.markEnd("WboitPass.render")}setSize(e,t){const[n,r]=this.renderable.values.uTexSize.ref.value
e===n&&t===r||(this.textureA.define(e,t),this.textureB.define(e,t),this.depthRenderbuffer.setSize(e,t),O.IQ.update(this.renderable.values.uTexSize,l.ZY.set(this.renderable.values.uTexSize.ref.value,e,t)))}reset(){this._supported&&this._init()}_init(){const{extensions:{drawBuffers:e}}=this.webgl
this.framebuffer.bind(),e.drawBuffers([e.COLOR_ATTACHMENT0,e.COLOR_ATTACHMENT1]),this.textureA.attachFramebuffer(this.framebuffer,"color0"),this.textureB.attachFramebuffer(this.framebuffer,"color1"),this.depthRenderbuffer.attachFramebuffer(this.framebuffer)}static isSupported(e){const{extensions:{drawBuffers:t,textureFloat:n,colorBufferFloat:r,depthTexture:i}}=e
if(n&&r&&i&&t)return!0
if(se.Bb){const e=[]
n||e.push("textureFloat"),r||e.push("colorBufferFloat"),i||e.push("depthTexture"),t||e.push("drawBuffers"),console.log(`Missing "${e.join('", "')}" extensions required for "wboit"`)}return!1}constructor(e,t,n){if(this.webgl=e,this._supported=!1,!Re.isSupported(e))return
const{resources:r,gl:i}=e
this.textureA=r.texture("image-float32","rgba","float","nearest"),this.textureA.define(t,n),this.textureB=r.texture("image-float32","rgba","float","nearest"),this.textureB.define(t,n),this.depthRenderbuffer=(0,me.C6)(i)?r.renderbuffer("depth32f","depth",t,n):r.renderbuffer("depth16","depth",t,n),this.renderable=function(e,t,n){const r={...ee.OM,tWboitA:O.IQ.create(t),tWboitB:O.IQ.create(n),uTexSize:O.IQ.create(l.ZY.create(t.getWidth(),t.getHeight()))},i={...De},o=(0,re.$h)(e,"triangles",Me,i,r)
return(0,ie._)(o,r)}(e,this.textureA,this.textureB),this.framebuffer=r.framebuffer(),this._supported=!0,this._init()}}const Oe={...ee.du,tDpoitBackColor:(0,te.$G)("texture","rgba","float","nearest"),uTexSize:(0,te.w5)("v2")},Le=(0,ne.NG)("blend-back-dpoit",oe.e,"\n    precision highp float;\n\n    uniform sampler2D tDpoitBackColor;\n    uniform vec2 uTexSize;\n\n    void main() {\n        vec2 coords = gl_FragCoord.xy / uTexSize;\n        gl_FragColor = texture2D(tDpoitBackColor, coords);\n        if (gl_FragColor.a == 0.0) {\n            discard;\n        }\n    }\n"),Ne={...ee.du,tDpoitFrontColor:(0,te.$G)("texture","rgba","float","nearest"),uTexSize:(0,te.w5)("v2")},Fe=(0,ne.NG)("evaluate-dpoit",oe.e,"\nprecision highp float;\n\nuniform sampler2D tDpoitFrontColor;\nuniform vec2 uTexSize;\n\nvoid main() {\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n    gl_FragColor = texture2D(tDpoitFrontColor, coords);\n}\n")
class ze{get supported(){return this._supported}getByteCount(){return this._supported?this.depthTextures[0].getByteCount()+this.depthTextures[1].getByteCount()+this.colorFrontTextures[0].getByteCount()+this.colorFrontTextures[1].getByteCount()+this.colorBackTextures[0].getByteCount()+this.colorBackTextures[1].getByteCount():0}bind(){const{state:e,gl:t,extensions:{blendMinMax:n}}=this.webgl
return this.passCount=0,this.depthFramebuffers[0].bind(),e.clearColor(this.DEPTH_CLEAR_VALUE,this.DEPTH_CLEAR_VALUE,0,0),t.clear(t.COLOR_BUFFER_BIT),this.depthFramebuffers[1].bind(),e.clearColor(-this.MIN_DEPTH,this.MAX_DEPTH,0,0),t.clear(t.COLOR_BUFFER_BIT),this.colorFramebuffers[0].bind(),e.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),this.colorFramebuffers[1].bind(),e.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),this.depthFramebuffers[0].bind(),e.blendEquation(n.MAX),e.depthMask(!1),{depth:this.depthTextures[1],frontColor:this.colorFrontTextures[1],backColor:this.colorBackTextures[1]}}bindDualDepthPeeling(){const{state:e,gl:t,extensions:{blendMinMax:n}}=this.webgl
return this.readId=this.passCount%2,this.writeId=1-this.readId,this.passCount+=1,this.depthFramebuffers[this.writeId].bind(),e.clearColor(this.DEPTH_CLEAR_VALUE,this.DEPTH_CLEAR_VALUE,0,0),t.clear(t.COLOR_BUFFER_BIT),this.colorFramebuffers[this.writeId].bind(),e.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),this.depthFramebuffers[this.writeId].bind(),e.blendEquation(n.MAX),e.depthMask(!1),{depth:this.depthTextures[this.readId],frontColor:this.colorFrontTextures[this.readId],backColor:this.colorBackTextures[this.readId]}}renderBlendBack(){se.g$&&this.webgl.timer.mark("DpoitPass.renderBlendBack")
const{state:e,gl:t}=this.webgl
e.blendEquation(t.FUNC_ADD),e.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),O.IQ.update(this.blendBackRenderable.values.tDpoitBackColor,this.colorBackTextures[this.writeId]),this.blendBackRenderable.update(),this.blendBackRenderable.render(),se.g$&&this.webgl.timer.markEnd("DpoitPass.renderBlendBack")}render(){se.g$&&this.webgl.timer.mark("DpoitPass.render")
const{state:e,gl:t}=this.webgl
e.blendEquation(t.FUNC_ADD),e.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),O.IQ.update(this.renderable.values.tDpoitFrontColor,this.colorFrontTextures[this.writeId]),this.renderable.update(),this.renderable.render(),se.g$&&this.webgl.timer.markEnd("DpoitPass.render")}setSize(e,t){const[n,r]=this.renderable.values.uTexSize.ref.value
if(e!==n||t!==r){for(let n=0;n<2;n++)this.depthTextures[n].define(e,t),this.colorFrontTextures[n].define(e,t),this.colorBackTextures[n].define(e,t)
O.IQ.update(this.renderable.values.uTexSize,l.ZY.set(this.renderable.values.uTexSize.ref.value,e,t)),O.IQ.update(this.blendBackRenderable.values.uTexSize,l.ZY.set(this.blendBackRenderable.values.uTexSize.ref.value,e,t))}}reset(){this._supported&&this._init()}_init(){const{extensions:{drawBuffers:e}}=this.webgl
for(let t=0;t<2;t++)this.depthFramebuffers[t].bind(),e.drawBuffers([e.COLOR_ATTACHMENT0,e.COLOR_ATTACHMENT1,e.COLOR_ATTACHMENT2]),this.colorFrontTextures[t].attachFramebuffer(this.depthFramebuffers[t],"color0"),this.colorBackTextures[t].attachFramebuffer(this.depthFramebuffers[t],"color1"),this.depthTextures[t].attachFramebuffer(this.depthFramebuffers[t],"color2"),this.colorFramebuffers[t].bind(),e.drawBuffers([e.COLOR_ATTACHMENT0,e.COLOR_ATTACHMENT1]),this.colorFrontTextures[t].attachFramebuffer(this.colorFramebuffers[t],"color0"),this.colorBackTextures[t].attachFramebuffer(this.colorFramebuffers[t],"color1")}static isSupported(e){const{extensions:{drawBuffers:t,textureFloat:n,colorBufferFloat:r,depthTexture:i,blendMinMax:o}}=e
if(n&&r&&i&&t&&o)return!0
if(se.Bb){const e=[]
n||e.push("textureFloat"),r||e.push("colorBufferFloat"),i||e.push("depthTexture"),t||e.push("drawBuffers"),o||e.push("blendMinMax"),console.log(`Missing "${e.join('", "')}" extensions required for "dpoit"`)}return!1}constructor(e,t,n){if(this.webgl=e,this.DEPTH_CLEAR_VALUE=-99999,this.MAX_DEPTH=1,this.MIN_DEPTH=0,this.passCount=0,this._supported=!1,!ze.isSupported(e))return
const{resources:r,extensions:{colorBufferHalfFloat:i,textureHalfFloat:o}}=e;(0,me.C6)(e.gl)?(this.depthTextures=[r.texture("image-float32","rg","float","nearest"),r.texture("image-float32","rg","float","nearest")],this.colorFrontTextures=i&&o?[r.texture("image-float16","rgba","fp16","nearest"),r.texture("image-float16","rgba","fp16","nearest")]:[r.texture("image-float32","rgba","float","nearest"),r.texture("image-float32","rgba","float","nearest")],this.colorBackTextures=i&&o?[r.texture("image-float16","rgba","fp16","nearest"),r.texture("image-float16","rgba","fp16","nearest")]:[r.texture("image-float32","rgba","float","nearest"),r.texture("image-float32","rgba","float","nearest")]):(this.depthTextures=[r.texture("image-float32","rgba","float","nearest"),r.texture("image-float32","rgba","float","nearest")],this.colorFrontTextures=[r.texture("image-float32","rgba","float","nearest"),r.texture("image-float32","rgba","float","nearest")],this.colorBackTextures=[r.texture("image-float32","rgba","float","nearest"),r.texture("image-float32","rgba","float","nearest")]),this.depthTextures[0].define(t,n),this.depthTextures[1].define(t,n),this.colorFrontTextures[0].define(t,n),this.colorFrontTextures[1].define(t,n),this.colorBackTextures[0].define(t,n),this.colorBackTextures[1].define(t,n),this.depthFramebuffers=[r.framebuffer(),r.framebuffer()],this.colorFramebuffers=[r.framebuffer(),r.framebuffer()],this.blendBackRenderable=function(e,t){const n={...ee.OM,tDpoitBackColor:O.IQ.create(t),uTexSize:O.IQ.create(l.ZY.create(t.getWidth(),t.getHeight()))},r={...Oe},i=(0,re.$h)(e,"triangles",Le,r,n)
return(0,ie._)(i,n)}(e,this.colorBackTextures[0]),this.renderable=function(e,t){const n={...ee.OM,tDpoitFrontColor:O.IQ.create(t),uTexSize:O.IQ.create(l.ZY.create(t.getWidth(),t.getHeight()))},r={...Ne},i=(0,re.$h)(e,"triangles",Fe,r,n)
return(0,ie._)(i,n)}(e,this.colorFrontTextures[0]),this._supported=!0,this._init()}}var je=n(54749)
const Ve={enabled:p.t.Boolean(!0),highlightEdgeColor:p.t.Color(je.Color.darken(je.Color.fromNormalizedRgb(1,.4,.6),1)),selectEdgeColor:p.t.Color(je.Color.darken(je.Color.fromNormalizedRgb(.2,1,.1),1)),edgeScale:p.t.Numeric(1,{min:1,max:3,step:1},{description:"Thickness of the edge."}),highlightEdgeStrength:p.t.Numeric(1,{min:0,max:1,step:.1}),selectEdgeStrength:p.t.Numeric(1,{min:0,max:1,step:.1}),ghostEdgeStrength:p.t.Numeric(.3,{min:0,max:1,step:.1},{description:"Opacity of the hidden edges that are covered by other geometry. When set to 1, one less geometry render pass is done."}),innerEdgeFactor:p.t.Numeric(1.5,{min:0,max:3,step:.1},{description:"Factor to multiply the inner edge color with - for added contrast."})}
class Ue{static isEnabled(e){return e.enabled}constructor(e,t,n){this.webgl=e,this.depthTarget=e.createRenderTarget(t,n),this.maskTarget=e.createRenderTarget(t,n),this.edgesTarget=e.createRenderTarget(t,n),this.edge=function(e,t){const n=t.getWidth(),r=t.getHeight(),i={...ee.OM,tMaskTexture:O.IQ.create(t),uTexSizeInv:O.IQ.create(l.ZY.create(1/n,1/r)),dEdgeScale:O.IQ.create(1)},o={...Ge},a=(0,re.$h)(e,"triangles",He,o,i)
return(0,ie._)(a,i)}(e,this.maskTarget.texture),this.overlay=function(e,t){const n=t.getWidth(),r=t.getHeight(),i={...ee.OM,tEdgeTexture:O.IQ.create(t),uTexSizeInv:O.IQ.create(l.ZY.create(1/n,1/r)),uHighlightEdgeColor:O.IQ.create((0,l.eB)()),uSelectEdgeColor:O.IQ.create((0,l.eB)()),uHighlightEdgeStrength:O.IQ.create(1),uSelectEdgeStrength:O.IQ.create(1),uGhostEdgeStrength:O.IQ.create(0),uInnerEdgeFactor:O.IQ.create(0)},o={...qe},a=(0,re.$h)(e,"triangles",Qe,o,i)
return(0,ie._)(a,i)}(e,this.edgesTarget.texture)}getByteCount(){return this.depthTarget.getByteCount()+this.maskTarget.getByteCount()+this.edgesTarget.getByteCount()}setEdgeState(e){const{gl:t,state:n}=this.webgl
n.enable(t.SCISSOR_TEST),n.enable(t.BLEND),n.blendFunc(t.ONE,t.ONE),n.blendEquation(t.FUNC_ADD),n.disable(t.DEPTH_TEST),n.depthMask(!1)
const{x:r,y:i,width:o,height:a}=e
n.viewport(r,i,o,a),n.scissor(r,i,o,a),n.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT)}setOverlayState(e){const{gl:t,state:n}=this.webgl
n.enable(t.SCISSOR_TEST),n.enable(t.BLEND),n.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),n.blendEquation(t.FUNC_ADD),n.disable(t.DEPTH_TEST),n.depthMask(!1)
const{x:r,y:i,width:o,height:a}=e
n.viewport(r,i,o,a),n.scissor(r,i,o,a)}setSize(e,t){const n=this.depthTarget.getWidth(),r=this.depthTarget.getHeight()
e===n&&t===r||(this.depthTarget.setSize(e,t),this.maskTarget.setSize(e,t),this.edgesTarget.setSize(e,t),O.IQ.update(this.edge.values.uTexSizeInv,l.ZY.set(this.edge.values.uTexSizeInv.ref.value,1/e,1/t)),O.IQ.update(this.overlay.values.uTexSizeInv,l.ZY.set(this.overlay.values.uTexSizeInv.ref.value,1/e,1/t)))}update(e){const{highlightEdgeColor:t,selectEdgeColor:n,edgeScale:r,innerEdgeFactor:i,ghostEdgeStrength:o,highlightEdgeStrength:a,selectEdgeStrength:s}=e,{values:l}=this.edge,c=Math.max(1,Math.round(r*this.webgl.pixelRatio))
l.dEdgeScale.ref.value!==c&&(O.IQ.update(l.dEdgeScale,c),this.edge.update())
const{values:u}=this.overlay
O.IQ.update(u.uHighlightEdgeColor,je.Color.toVec3Normalized(u.uHighlightEdgeColor.ref.value,t)),O.IQ.update(u.uSelectEdgeColor,je.Color.toVec3Normalized(u.uSelectEdgeColor.ref.value,n)),O.IQ.updateIfChanged(u.uInnerEdgeFactor,i),O.IQ.updateIfChanged(u.uGhostEdgeStrength,o),O.IQ.updateIfChanged(u.uHighlightEdgeStrength,a),O.IQ.updateIfChanged(u.uSelectEdgeStrength,s)}render(e,t){se.g$&&this.webgl.timer.mark("MarkingPass.render"),this.edgesTarget.bind(),this.setEdgeState(e),this.edge.render(),t.bind(),this.setOverlayState(e),this.overlay.render(),se.g$&&this.webgl.timer.markEnd("MarkingPass.render")}}const Ge={...ee.du,tMaskTexture:(0,te.$G)("texture","rgba","ubyte","linear"),uTexSizeInv:(0,te.w5)("v2"),dEdgeScale:(0,te.$F)("number")},He=(0,ne.NG)("edge",oe.e,"\nprecision highp float;\nprecision highp sampler2D;\n\nuniform sampler2D tMaskTexture;\nuniform vec2 uTexSizeInv;\n\nvoid main() {\n    vec2 coords = gl_FragCoord.xy * uTexSizeInv;\n    vec4 offset = vec4(float(dEdgeScale), 0.0, 0.0, float(dEdgeScale)) * vec4(uTexSizeInv, uTexSizeInv);\n    vec4 c0 = texture2D(tMaskTexture, coords);\n    vec4 c1 = texture2D(tMaskTexture, coords + offset.xy);\n    vec4 c2 = texture2D(tMaskTexture, coords - offset.xy);\n    vec4 c3 = texture2D(tMaskTexture, coords + offset.yw);\n    vec4 c4 = texture2D(tMaskTexture, coords - offset.yw);\n    float diff1 = (c1.r - c2.r) * 0.5;\n    float diff2 = (c3.r - c4.r) * 0.5;\n    float d = length(vec2(diff1, diff2));\n    if (d <= 0.0)\n        discard;\n    float a1 = min(c1.g, c2.g);\n    float a2 = min(c3.g, c4.g);\n    float visibility = min(a1, a2) > 0.001 ? 1.0 : 0.0;\n    float mask = c0.r;\n    float marker = min(c1.b, min(c2.b, min(c3.b, c4.b)));\n    float fogAlpha = min(c1.a, min(c2.a, min(c3.a, c4.a)));\n    gl_FragColor = vec4(visibility, mask, marker, fogAlpha);\n}\n"),qe={...ee.du,tEdgeTexture:(0,te.$G)("texture","rgba","ubyte","linear"),uTexSizeInv:(0,te.w5)("v2"),uHighlightEdgeColor:(0,te.w5)("v3"),uSelectEdgeColor:(0,te.w5)("v3"),uHighlightEdgeStrength:(0,te.w5)("f"),uSelectEdgeStrength:(0,te.w5)("f"),uGhostEdgeStrength:(0,te.w5)("f"),uInnerEdgeFactor:(0,te.w5)("f")},Qe=(0,ne.NG)("overlay",oe.e,"\nprecision highp float;\nprecision highp sampler2D;\n\nuniform vec2 uTexSizeInv;\nuniform sampler2D tEdgeTexture;\nuniform vec3 uHighlightEdgeColor;\nuniform vec3 uSelectEdgeColor;\nuniform float uHighlightEdgeStrength;\nuniform float uSelectEdgeStrength;\nuniform float uGhostEdgeStrength;\nuniform float uInnerEdgeFactor;\n\nvoid main() {\n    vec2 coords = gl_FragCoord.xy * uTexSizeInv;\n    vec4 edgeValue = texture2D(tEdgeTexture, coords);\n    if (edgeValue.a > 0.0) {\n        vec3 edgeColor = edgeValue.b == 1.0 ? uHighlightEdgeColor : uSelectEdgeColor;\n        gl_FragColor.rgb = edgeValue.g > 0.0 ? edgeColor : edgeColor * uInnerEdgeFactor;\n        gl_FragColor.a = (edgeValue.r == 1.0 ? uGhostEdgeStrength : 1.0) * edgeValue.a;\n        float edgeStrength = edgeValue.b == 1.0 ? uHighlightEdgeStrength : uSelectEdgeStrength;\n        gl_FragColor.a *= edgeStrength;\n    } else {\n        gl_FragColor = vec4(0.0);\n    }\n}\n")
var $e,Xe=n(18460),We=n(38547)
class Ye{setTransparency(e){"wboit"===e?(this.transparencyMode=this.wboit.supported?"wboit":"blended",se.Bb&&!this.wboit.supported&&console.log('Missing "wboit" support, falling back to "blended".')):"dpoit"===e?(this.transparencyMode=this.dpoit.supported?"dpoit":"blended",se.Bb&&!this.dpoit.supported&&console.log('Missing "dpoit" support, falling back to "blended".')):this.transparencyMode="blended",this.depthTextureOpaque.detachFramebuffer(this.postprocessing.target.framebuffer,"depth")}get transparency(){return this.transparencyMode}constructor(e,t,n,r,i){this.webgl=e,this.transparencyMode="blended"
const{extensions:o,resources:a,isWebGL2:s}=e
this.drawTarget=e.createDrawTarget(),this.colorTarget=e.createRenderTarget(n,r,!0,"uint8","linear"),this.transparentColorTarget=e.createRenderTarget(n,r,!1,"uint8","linear"),this.packedDepth=!o.depthTexture,this.depthTargetTransparent=e.createRenderTarget(n,r),this.depthTextureTransparent=this.depthTargetTransparent.texture,this.depthTargetOpaque=this.packedDepth?e.createRenderTarget(n,r):null,this.depthTextureOpaque=this.depthTargetOpaque?this.depthTargetOpaque.texture:a.texture("image-depth","depth",s?"float":"ushort","nearest"),this.packedDepth||this.depthTextureOpaque.define(n,r),this.wboit=new Re(e,n,r),this.dpoit=new ze(e,n,r),this.marking=new Ue(e,n,r),this.postprocessing=new J.Pv(e,t,this),this.antialiasing=new J.SK(e,n,r),this.bloom=new We.P(e,n,r),this.dof=new Xe.z(e,n,r),this.copyFboTarget=(0,ee._0)(e,this.colorTarget.texture),this.copyFboPostprocessing=(0,ee._0)(e,this.postprocessing.target.texture),this.setTransparency(i)}getByteCount(){return this.drawTarget.getByteCount()+this.colorTarget.getByteCount()+this.transparentColorTarget.getByteCount()+this.depthTargetTransparent.getByteCount()+(this.depthTargetOpaque?this.depthTargetOpaque.getByteCount():this.depthTextureOpaque.getByteCount())+this.wboit.getByteCount()+this.dpoit.getByteCount()+this.marking.getByteCount()+this.postprocessing.getByteCount()+this.antialiasing.getByteCount()+this.bloom.getByteCount()+this.dof.getByteCount()}reset(){this.wboit.reset(),this.dpoit.reset(),this.postprocessing.reset()}setSize(e,t){const n=this.colorTarget.getWidth(),r=this.colorTarget.getHeight()
e===n&&t===r||(this.colorTarget.setSize(e,t),this.depthTargetTransparent.setSize(e,t),this.transparentColorTarget.setSize(e,t),this.depthTargetOpaque?this.depthTargetOpaque.setSize(e,t):this.depthTextureOpaque.define(e,t),O.IQ.update(this.copyFboTarget.values.uTexSize,l.ZY.set(this.copyFboTarget.values.uTexSize.ref.value,e,t)),O.IQ.update(this.copyFboPostprocessing.values.uTexSize,l.ZY.set(this.copyFboPostprocessing.values.uTexSize.ref.value,e,t))),this.wboit.supported&&this.wboit.setSize(e,t),this.dpoit.supported&&this.dpoit.setSize(e,t),this.marking.setSize(e,t),this.postprocessing.setSize(e,t),this.antialiasing.setSize(e,t),this.dof.setSize(e,t),this.bloom.setSize(e,t)}_renderDpoit(e,t,n,r,i,o){if(!this.dpoit.supported)throw new Error("expected dpoit to be supported")
this.depthTextureOpaque.attachFramebuffer(this.colorTarget.framebuffer,"depth"),e.clear(!0),n.hasOpaque&&e.renderOpaque(n.primitives,t),this.depthTextureOpaque.detachFramebuffer(this.colorTarget.framebuffer,"depth"),J.Pv.isTransparentDepthRequired(n,o)&&(this.depthTargetTransparent.bind(),e.clearDepth(!0),n.opacityAverage<1&&e.renderDepthTransparent(n.primitives,t,this.depthTextureOpaque))
const a=J.Pv.isEnabled(o)
if(n.opacityAverage<1){const i=a?this.transparentColorTarget:this.colorTarget
a&&(i.bind(),e.clear(!1,!1,!0))
const o=this.dpoit.bind()
e.renderDpoitTransparent(n.primitives,t,this.depthTextureOpaque,o)
for(let a=0;a<r;a++){se.g$&&this.webgl.timer.mark("DpoitPass.layer")
const o=this.dpoit.bindDualDepthPeeling()
e.renderDpoitTransparent(n.primitives,t,this.depthTextureOpaque,o),r>1&&(i.bind(),this.dpoit.renderBlendBack()),se.g$&&this.webgl.timer.markEnd("DpoitPass.layer")}i.bind(),this.dpoit.render()}J.Pv.isEnabled(o)&&this.postprocessing.render(t,n,!1,i,e.props.backgroundColor,o,e.light,e.ambientColor),n.volumes.renderables.length>0&&e.renderVolume(n.volumes,t,this.depthTextureOpaque)}_renderWboit(e,t,n,r,i){if(!this.wboit.supported)throw new Error("expected wboit to be supported")
this.depthTextureOpaque.attachFramebuffer(this.colorTarget.framebuffer,"depth"),e.clear(!0),n.hasOpaque&&e.renderOpaque(n.primitives,t),J.Pv.isTransparentDepthRequired(n,i)&&(this.depthTargetTransparent.bind(),e.clearDepth(!0),n.opacityAverage<1&&e.renderDepthTransparent(n.primitives,t,this.depthTextureOpaque))
const o=J.Pv.isEnabled(i)
if(n.opacityAverage<1){const r=o?this.transparentColorTarget:this.colorTarget
o&&(r.bind(),e.clear(!1,!1,!0)),this.wboit.bind(),e.renderWboitTransparent(n.primitives,t,this.depthTextureOpaque),r.bind(),this.wboit.render()}J.Pv.isEnabled(i)&&this.postprocessing.render(t,n,!1,r,e.props.backgroundColor,i,e.light,e.ambientColor),n.volumes.renderables.length>0&&(this.wboit.bind(),e.renderWboitTransparent(n.volumes,t,this.depthTextureOpaque),(o?this.postprocessing.target:this.colorTarget).bind(),this.wboit.render())}_renderBlended(e,t,n,r,i,o){var a,s,l,c,u,d
if(r?this.drawTarget.bind():this.packedDepth?this.colorTarget.bind():this.depthTextureOpaque.attachFramebuffer(this.colorTarget.framebuffer,"depth"),e.clear(!0),n.hasOpaque&&e.renderOpaque(n.primitives,t),r)n.opacityAverage<1&&e.renderBlendedTransparent(n.primitives,t)
else{this.depthTargetOpaque&&(this.depthTargetOpaque.bind(),e.clearDepth(!0),e.renderDepthOpaque(n.primitives,t),this.colorTarget.bind()),J.Pv.isTransparentDepthRequired(n,o)&&(this.depthTargetTransparent.bind(),e.clearDepth(!0),n.opacityAverage<1&&e.renderDepthTransparent(n.primitives,t,this.depthTextureOpaque))
const r=J.Pv.isEnabled(o)
if(n.opacityAverage<1&&(r&&(this.transparentColorTarget.bind(),e.clear(!1,!1,!0),this.packedDepth?null===(a=this.colorTarget.depthRenderbuffer)||void 0===a||a.attachFramebuffer(this.transparentColorTarget.framebuffer):this.depthTextureOpaque.attachFramebuffer(this.transparentColorTarget.framebuffer,"depth")),e.renderBlendedTransparent(n.primitives,t),r&&(this.packedDepth?null===(s=this.colorTarget.depthRenderbuffer)||void 0===s||s.detachFramebuffer(this.transparentColorTarget.framebuffer):this.depthTextureOpaque.detachFramebuffer(this.transparentColorTarget.framebuffer,"depth"))),r&&(this.packedDepth?null===(l=this.colorTarget.depthRenderbuffer)||void 0===l||l.detachFramebuffer(this.postprocessing.target.framebuffer):this.depthTextureOpaque.detachFramebuffer(this.postprocessing.target.framebuffer,"depth"),this.postprocessing.render(t,n,!1,i,e.props.backgroundColor,o,e.light,e.ambientColor),this.packedDepth?null===(c=this.colorTarget.depthRenderbuffer)||void 0===c||c.attachFramebuffer(this.postprocessing.target.framebuffer):this.depthTextureOpaque.attachFramebuffer(this.postprocessing.target.framebuffer,"depth")),n.volumes.renderables.length>0){const r=J.Pv.isEnabled(o)?this.postprocessing.target:this.colorTarget
this.packedDepth?null===(u=this.colorTarget.depthRenderbuffer)||void 0===u||u.detachFramebuffer(r.framebuffer):this.depthTextureOpaque.detachFramebuffer(r.framebuffer,"depth"),r.bind(),e.renderVolume(n.volumes,t,this.depthTextureOpaque),this.packedDepth?null===(d=this.colorTarget.depthRenderbuffer)||void 0===d||d.attachFramebuffer(r.framebuffer):this.depthTextureOpaque.attachFramebuffer(r.framebuffer,"depth"),r.bind()}}}_render(e,t,n,r,i,o,a){var s,l
if(t.disabled)return
const c=n.volumes.renderables.length>0,u=J.Pv.isEnabled(a.postprocessing),d=J.SK.isEnabled(a.postprocessing),p=Ue.isEnabled(a.marking),h=Xe.z.isEnabled(a.postprocessing),f=We.P.isEnabled(a.postprocessing),{x:m,y:g,width:y,height:v}=t.viewport
e.setViewport(m,g,y,v),e.update(t,n),o&&!d&&i&&(this.drawTarget.bind(),e.clear(!1))
let b=!1
"wboit"===this.transparencyMode&&this.wboit.supported?(this._renderWboit(e,t,n,o,a.postprocessing),b=!0):"dpoit"===this.transparencyMode&&this.dpoit.supported?(this._renderDpoit(e,t,n,a.dpoitIterations,o,a.postprocessing),b=!0):this._renderBlended(e,t,n,!c&&!u&&!d&&i,o,a.postprocessing)
const x=u?this.postprocessing.target:!i||c||b?this.colorTarget:this.drawTarget
if(p&&n.markerAverage>0){const r=a.marking.ghostEdgeStrength<1
r&&1!==n.markerAverage&&(this.marking.depthTarget.bind(),e.clear(!1,!0),e.renderMarkingDepth(n.primitives,t)),this.marking.maskTarget.bind(),e.clear(!1,!0),e.renderMarkingMask(n.primitives,t,r?this.marking.depthTarget.texture:null),this.marking.update(a.marking),this.marking.render(t.viewport,x)}else x.bind()
r.debug.isEnabled&&(r.debug.syncVisibility(),e.renderBlended(r.debug.scene,t)),r.handle.isEnabled&&e.renderBlended(r.handle.scene,t),r.pointer.isEnabled&&(r.pointer.setCamera(t),e.update(r.pointer.camera,r.pointer.scene),e.renderBlended(r.pointer.scene,r.pointer.camera)),r.camera.isEnabled&&(r.camera.update(t),e.update(r.camera.camera,r.camera.scene),e.renderBlended(r.camera.scene,r.camera.camera))
let S=!1
if(d){const e=J.Pv.isEnabled(a.postprocessing)?this.postprocessing.target.texture:this.colorTarget.texture
this.antialiasing.render(t,e,i&&!h,a.postprocessing)}else i&&!Xe.z.isEnabled(a.postprocessing)&&(S=!0)
if(h&&"on"===a.postprocessing.dof.name){const e=J.SK.isEnabled(a.postprocessing)?this.antialiasing.target.texture:J.Pv.isEnabled(a.postprocessing)?this.postprocessing.target.texture:this.colorTarget.texture
this.dof.update(t,e,(null===(s=this.depthTargetOpaque)||void 0===s?void 0:s.texture)||this.depthTextureOpaque,this.depthTextureTransparent,a.postprocessing.dof.params,n.boundingSphereVisible),this.dof.render(t.viewport,i?void 0:this.getColorTarget(a.postprocessing))}else i&&!J.SK.isEnabled(a.postprocessing)&&(S=!0)
if(S&&(this.drawTarget.bind(),this.webgl.state.disable(this.webgl.gl.DEPTH_TEST),u?this.copyFboPostprocessing.render():(c||b)&&this.copyFboTarget.render()),f&&"on"===a.postprocessing.bloom.name){const r="emissive"===a.postprocessing.bloom.params.mode
r&&n.emissiveAverage>0&&(this.bloom.emissiveTarget.bind(),e.clear(!1,!0),e.update(t,n),e.renderEmissive(n.primitives,t)),(!r||n.emissiveAverage>0)&&(this.bloom.update(this.colorTarget.texture,this.bloom.emissiveTarget.texture,(null===(l=this.depthTargetOpaque)||void 0===l?void 0:l.texture)||this.depthTextureOpaque,a.postprocessing.bloom.params),this.bloom.render(t.viewport,i?void 0:this.getColorTarget(a.postprocessing)))}this.webgl.gl.flush()}render(e,t,n){se.g$&&this.webgl.timer.mark("DrawPass.render")
const{renderer:r,camera:i,scene:o,helper:a}=e
this.postprocessing.setTransparentBackground(t.transparentBackground)
const s=t.transparentBackground||this.postprocessing.background.isEnabled(t.postprocessing)
r.setTransparentBackground(s),r.setDrawingBufferSize(this.colorTarget.getWidth(),this.colorTarget.getHeight()),r.setPixelRatio(this.webgl.pixelRatio),Te.is(i)?(se.g$&&this.webgl.timer.mark("StereoCamera.left"),this._render(r,i.left,o,a,n,s,t),se.g$&&this.webgl.timer.markEnd("StereoCamera.left"),se.g$&&this.webgl.timer.mark("StereoCamera.right"),this._render(r,i.right,o,a,n,s,t),se.g$&&this.webgl.timer.markEnd("StereoCamera.right")):this._render(r,i,o,a,n,s,t),se.g$&&this.webgl.timer.markEnd("DrawPass.render")}getColorTarget(e){return Xe.z.isEnabled(e)?this.dof.target:J.SK.isEnabled(e)?this.antialiasing.target:J.Pv.isEnabled(e)?this.postprocessing.target:this.colorTarget}}!function(e){e.create=function(e,t,n){return{array:e,width:t,height:n}},e.flipY=function(e){const{array:t,width:n,height:r}=e,i=n*(t.length/(n*r))
for(let o=0,a=r/2;o<a;++o)for(let e=0,n=i;e<n;++e){const n=o*i+e,a=(r-o-1)*i+e,s=t[n]
t[n]=t[a],t[a]=s}return e},e.divideByAlpha=function(e){const{array:t}=e,n=t instanceof Uint8Array?255:1
for(let r=0,i=t.length;r<i;r+=4){const e=t[r+3]/n
t[r]/=e,t[r+1]/=e,t[r+2]/=e}return e}}($e||($e={}))
var Ze=n(26429),Ke=n(16124),Je=n(45996),et=n(39250),tt=n(17370),nt=n(97564)
const rt={rendersPerFrame:p.t.Interval([1,16],{min:1,max:64,step:1},{description:"Number of rays per pixel each frame. May be adjusted to reach targetFps but will stay within given interval."}),targetFps:p.t.Numeric(30,{min:0,max:120,step:.1},{description:"Target FPS per frame. If observed FPS is lower or higher, some parameters may get adjusted."}),steps:p.t.Numeric(32,{min:1,max:1024,step:1}),firstStepSize:p.t.Numeric(.01,{min:.001,max:1,step:.001}),refineSteps:p.t.Numeric(4,{min:0,max:8,step:1},{description:"Number of refine steps per ray hit. May be lower to reach targetFps."}),rayDistance:p.t.Numeric(256,{min:1,max:8192,step:1},{description:"Maximum distance a ray can travel (in world units)."}),thicknessMode:p.t.Select("auto",p.t.arrayToOptions(["auto","fixed"])),minThickness:p.t.Numeric(.5,{min:.1,max:16,step:.1},{hideIf:e=>"fixed"===e.thicknessMode}),thicknessFactor:p.t.Numeric(1,{min:.1,max:2,step:.05},{hideIf:e=>"fixed"===e.thicknessMode}),thickness:p.t.Numeric(4,{min:.1,max:512,step:.1},{hideIf:e=>"auto"===e.thicknessMode}),bounces:p.t.Numeric(4,{min:1,max:32,step:1},{description:"Number of bounces for each ray."}),glow:p.t.Boolean(!0,{description:"Bounced rays always get the full light. This produces a slight glowing effect."}),shadowEnable:p.t.Boolean(!1),shadowSoftness:p.t.Numeric(.1,{min:.01,max:1,step:.01}),shadowThickness:p.t.Numeric(.5,{min:.1,max:32,step:.1})}
class it{constructor(e,t){this.webgl=e,this.drawPass=t,this.clearAdjustedProps=!0,this.prevTime=0,this.currTime=0,this.rendersPerFrame=1,this.refineSteps=1,this.steps=16
const{extensions:{drawBuffers:n,colorBufferHalfFloat:r,textureHalfFloat:i},resources:o,isWebGL2:a}=e,{depthTextureOpaque:s}=t,l=s.getWidth(),c=s.getHeight()
a?(this.shadedTextureOpaque=o.texture("image-uint8","rgba","ubyte","nearest"),this.shadedTextureOpaque.define(l,c),this.normalTextureOpaque=r&&i?o.texture("image-float16","rgba","fp16","nearest"):o.texture("image-float32","rgba","float","nearest"),this.normalTextureOpaque.define(l,c),this.colorTextureOpaque=o.texture("image-uint8","rgba","ubyte","nearest"),this.colorTextureOpaque.define(l,c)):(this.shadedTextureOpaque=o.texture("image-float32","rgba","float","nearest"),this.shadedTextureOpaque.define(l,c),this.normalTextureOpaque=o.texture("image-float32","rgba","float","nearest"),this.normalTextureOpaque.define(l,c),this.colorTextureOpaque=o.texture("image-float32","rgba","float","nearest"),this.colorTextureOpaque.define(l,c)),this.framebuffer=o.framebuffer(),this.framebuffer.bind(),n.drawBuffers([n.COLOR_ATTACHMENT0,n.COLOR_ATTACHMENT1,n.COLOR_ATTACHMENT2]),this.shadedTextureOpaque.attachFramebuffer(this.framebuffer,"color0"),this.normalTextureOpaque.attachFramebuffer(this.framebuffer,"color1"),this.colorTextureOpaque.attachFramebuffer(this.framebuffer,"color2"),this.thicknessTarget=e.createRenderTarget(l,c,!0,"uint8","nearest"),this.holdTarget=e.createRenderTarget(l,c,!1,"float32"),this.accumulateTarget=e.createRenderTarget(l,c,!1,"float32"),this.composeTarget=e.createRenderTarget(l,c,!1,"uint8","linear"),this.traceRenderable=function(e,t,n,r,i,o,a){const s={...ee.OM,tColor:O.IQ.create(t),tNormal:O.IQ.create(n),tShaded:O.IQ.create(r),tThickness:O.IQ.create(i),tAccumulate:O.IQ.create(o),tDepth:O.IQ.create(a),uTexSize:O.IQ.create(Ke.Z.create(t.getWidth(),t.getHeight())),dOrthographic:O.IQ.create(0),uNear:O.IQ.create(1),uFar:O.IQ.create(1e4),uFogNear:O.IQ.create(1e4),uFogFar:O.IQ.create(1e4),uFogColor:O.IQ.create(_e.e.create(1,1,1)),uProjection:O.IQ.create(et.$.identity()),uInvProjection:O.IQ.create(et.$.identity()),uBounds:O.IQ.create((0,tt.Z)()),uLightDirection:O.IQ.create([]),uLightColor:O.IQ.create([]),dLightCount:O.IQ.create(0),uAmbientColor:O.IQ.create((0,_e.e)()),uLightStrength:O.IQ.create(_e.e.create(1,1,1)),uFrameNo:O.IQ.create(0),dRendersPerFrame:O.IQ.create(1),dGlow:O.IQ.create(!0),dBounces:O.IQ.create(4),dSteps:O.IQ.create(32),dFirstStepSize:O.IQ.create(.01),dRefineSteps:O.IQ.create(4),uRayDistance:O.IQ.create(256),dThicknessMode:O.IQ.create("auto"),uMinThickness:O.IQ.create(.5),uThicknessFactor:O.IQ.create(1),uThickness:O.IQ.create(4),dShadowEnable:O.IQ.create(!1),uShadowSoftness:O.IQ.create(.1),uShadowThickness:O.IQ.create(.1)},l={...ot},c=(0,re.$h)(e,"triangles",at,l,s)
return(0,ie._)(c,s)}(e,this.colorTextureOpaque,this.normalTextureOpaque,this.shadedTextureOpaque,this.thicknessTarget.texture,this.accumulateTarget.texture,this.drawPass.depthTextureOpaque),this.accumulateRenderable=function(e,t){const n={...ee.OM,tColor:O.IQ.create(t),uTexSize:O.IQ.create(Ke.Z.create(t.getWidth(),t.getHeight())),uWeight:O.IQ.create(1)},r={...st},i=(0,re.$h)(e,"triangles",lt,r,n)
return(0,ie._)(i,n)}(e,this.holdTarget.texture)}getByteCount(){return this.thicknessTarget.getByteCount()+this.holdTarget.getByteCount()+this.accumulateTarget.getByteCount()+this.composeTarget.getByteCount()+this.colorTextureOpaque.getByteCount()+this.normalTextureOpaque.getByteCount()+this.shadedTextureOpaque.getByteCount()}renderInput(e,t,n,r){se.g$&&this.webgl.timer.mark("TracePass.renderInput")
const{gl:i,state:o}=this.webgl
this.framebuffer.bind(),this.drawPass.depthTextureOpaque.attachFramebuffer(this.framebuffer,"depth"),e.clear(!0),e.renderTracing(n.primitives,t),"auto"===r.thicknessMode&&(this.thicknessTarget.bind(),o.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),e.renderDepthOpaqueBack(n.primitives,t)),se.g$&&this.webgl.timer.markEnd("TracePass.renderInput")}setSize(e,t){const n=this.composeTarget.getWidth(),r=this.composeTarget.getHeight()
e===n&&t===r||(this.thicknessTarget.setSize(e,t),this.holdTarget.setSize(e,t),this.accumulateTarget.setSize(e,t),this.composeTarget.setSize(e,t),this.colorTextureOpaque.define(e,t),this.normalTextureOpaque.define(e,t),this.shadedTextureOpaque.define(e,t),O.IQ.update(this.traceRenderable.values.uTexSize,Ke.Z.set(this.traceRenderable.values.uTexSize.ref.value,e,t)),O.IQ.update(this.accumulateRenderable.values.uTexSize,Ke.Z.set(this.accumulateRenderable.values.uTexSize.ref.value,e,t)))}reset(){const{drawBuffers:e}=this.webgl.extensions
this.framebuffer.bind(),e.drawBuffers([e.COLOR_ATTACHMENT0,e.COLOR_ATTACHMENT1,e.COLOR_ATTACHMENT2]),this.shadedTextureOpaque.attachFramebuffer(this.framebuffer,"color0"),this.normalTextureOpaque.attachFramebuffer(this.framebuffer,"color1"),this.colorTextureOpaque.attachFramebuffer(this.framebuffer,"color2"),this.restart(!0)}restart(e=!1){const{gl:t,state:n}=this.webgl
this.accumulateTarget.bind(),n.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),this.composeTarget.bind(),n.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),e&&(this.prevTime=0,this.currTime=0,this.clearAdjustedProps=!0)}increaseAdjustedProps(e){this.steps+=1,this.steps>e.steps&&(this.refineSteps+=1),this.refineSteps>e.refineSteps&&(this.rendersPerFrame+=1)}decreaseAdjustedProps(e){const t=Math.min(1,e.refineSteps)
this.rendersPerFrame-=1,this.rendersPerFrame<1&&(this.refineSteps-=1),this.refineSteps<t&&(this.steps-=1)}getAdjustedProps(e,t){this.currTime=(0,s.t)()
const n=Math.min(1,e.refineSteps),r=Math.round(e.steps/2)
if(this.clearAdjustedProps&&(this.rendersPerFrame=e.rendersPerFrame[0],this.refineSteps=n,this.steps=r,this.clearAdjustedProps=!1),t>0){const t=1e3/e.targetFps,n=this.currTime-this.prevTime
let r=Math.round(n/t)
if(r>=2)for(;r>0;)this.decreaseAdjustedProps(e),r-=1
else n<t?this.increaseAdjustedProps(e):n>t+.5&&this.decreaseAdjustedProps(e)}return this.prevTime=this.currTime,this.rendersPerFrame=(0,nt.qE)(this.rendersPerFrame,e.rendersPerFrame[0],e.rendersPerFrame[1]),this.refineSteps=(0,nt.qE)(this.refineSteps,n,e.refineSteps),this.steps=(0,nt.qE)(this.steps,r,e.steps),{rendersPerFrame:0===t?Math.ceil(this.rendersPerFrame/2):this.rendersPerFrame,refineSteps:0===t?n:this.refineSteps,steps:0===t?r:this.steps}}render(e,t,n,r,i){const{rendersPerFrame:o,refineSteps:a,steps:s}=this.getAdjustedProps(n,r)
se.g$&&this.webgl.timer.mark("TracePass.render",{note:`${o} rendersPerFrame, ${a} refineSteps, ${s} steps`})
const{renderer:l,camera:c,scene:u}=e,{gl:d,state:p}=this.webgl,{x:h,y:f,width:m,height:g}=c.viewport;(0===r||i)&&(l.setTransparentBackground(t),l.setDrawingBufferSize(this.composeTarget.getWidth(),this.composeTarget.getHeight()),l.setPixelRatio(this.webgl.pixelRatio),l.setViewport(h,f,m,g),l.update(c,u),this.renderInput(l,c,u,n)),p.disable(d.BLEND),p.disable(d.DEPTH_TEST),p.disable(d.CULL_FACE),p.depthMask(!1),p.viewport(h,f,m,g),p.scissor(h,f,m,g)
const y=et.$.identity()
et.$.invert(y,c.projection)
const v="orthographic"===c.state.mode?1:0,[b,x]=this.traceRenderable.values.uTexSize.ref.value,S=c.viewport,_=(0,_e.e)()
_e.e.scale(_,Je.Q1.toArrayNormalized(l.props.ambientColor,_,0),l.props.ambientIntensity)
const C=_e.e.clone(_)
for(let T=0,A=l.light.count;T<A;++T){const e=_e.e.fromArray((0,_e.e)(),l.light.color,3*T)
_e.e.add(C,C,e)}this.holdTarget.bind()
let w=!1
O.IQ.update(this.traceRenderable.values.uFrameNo,r),this.traceRenderable.values.dRendersPerFrame.ref.value!==o&&(O.IQ.update(this.traceRenderable.values.dRendersPerFrame,o),w=!0),O.IQ.update(this.traceRenderable.values.uProjection,c.projection),O.IQ.update(this.traceRenderable.values.uInvProjection,y),tt.Z.set(this.traceRenderable.values.uBounds.ref.value,S.x/b,S.y/x,(S.x+S.width)/b,(S.y+S.height)/x),O.IQ.update(this.traceRenderable.values.uBounds,this.traceRenderable.values.uBounds.ref.value),O.IQ.updateIfChanged(this.traceRenderable.values.uNear,c.near),O.IQ.updateIfChanged(this.traceRenderable.values.uFar,c.far),O.IQ.updateIfChanged(this.traceRenderable.values.uFogFar,c.fogFar),O.IQ.updateIfChanged(this.traceRenderable.values.uFogNear,c.fogNear),O.IQ.update(this.traceRenderable.values.uFogColor,Je.Q1.toVec3Normalized(this.traceRenderable.values.uFogColor.ref.value,l.props.backgroundColor)),this.traceRenderable.values.dOrthographic.ref.value!==v&&(O.IQ.update(this.traceRenderable.values.dOrthographic,v),w=!0),O.IQ.update(this.traceRenderable.values.uLightDirection,l.light.direction),O.IQ.update(this.traceRenderable.values.uLightColor,l.light.color),this.traceRenderable.values.dLightCount.ref.value!==l.light.count&&(O.IQ.update(this.traceRenderable.values.dLightCount,l.light.count),w=!0),O.IQ.update(this.traceRenderable.values.uAmbientColor,_),O.IQ.update(this.traceRenderable.values.uLightStrength,C),this.traceRenderable.values.dGlow.ref.value!==n.glow&&(O.IQ.update(this.traceRenderable.values.dGlow,n.glow),w=!0),this.traceRenderable.values.dBounces.ref.value!==n.bounces&&(O.IQ.update(this.traceRenderable.values.dBounces,n.bounces),w=!0),this.traceRenderable.values.dSteps.ref.value!==s&&(O.IQ.update(this.traceRenderable.values.dSteps,s),w=!0),this.traceRenderable.values.dFirstStepSize.ref.value!==n.firstStepSize&&(O.IQ.update(this.traceRenderable.values.dFirstStepSize,n.firstStepSize),w=!0),this.traceRenderable.values.dRefineSteps.ref.value!==a&&(O.IQ.update(this.traceRenderable.values.dRefineSteps,a),w=!0),O.IQ.updateIfChanged(this.traceRenderable.values.uRayDistance,n.rayDistance),this.traceRenderable.values.dThicknessMode.ref.value!==n.thicknessMode&&(O.IQ.update(this.traceRenderable.values.dThicknessMode,n.thicknessMode),w=!0),O.IQ.updateIfChanged(this.traceRenderable.values.uMinThickness,n.minThickness),O.IQ.updateIfChanged(this.traceRenderable.values.uThicknessFactor,n.thicknessFactor),O.IQ.updateIfChanged(this.traceRenderable.values.uThickness,n.thickness),this.traceRenderable.values.dShadowEnable.ref.value!==n.shadowEnable&&(O.IQ.update(this.traceRenderable.values.dShadowEnable,n.shadowEnable),w=!0),O.IQ.updateIfChanged(this.traceRenderable.values.uShadowSoftness,n.shadowSoftness),O.IQ.updateIfChanged(this.traceRenderable.values.uShadowThickness,n.shadowThickness),w&&this.traceRenderable.update(),se.g$&&this.webgl.timer.mark("TracePass.renderTrace"),this.traceRenderable.render(),se.g$&&this.webgl.timer.markEnd("TracePass.renderTrace"),this.accumulateTarget.bind(),this.accumulateRenderable.render(),se.g$&&this.webgl.timer.markEnd("TracePass.render")}}const ot={...ee.du,tColor:(0,te.$G)("texture","rgba","ubyte","nearest"),tNormal:(0,te.$G)("texture","rgba","ubyte","nearest"),tShaded:(0,te.$G)("texture","rgba","ubyte","nearest"),tThickness:(0,te.$G)("texture","rgba","ubyte","nearest"),tAccumulate:(0,te.$G)("texture","rgba","ubyte","nearest"),tDepth:(0,te.$G)("texture","rgba","ubyte","nearest"),uTexSize:(0,te.w5)("v2"),dOrthographic:(0,te.$F)("number"),uNear:(0,te.w5)("f"),uFar:(0,te.w5)("f"),uFogNear:(0,te.w5)("f"),uFogFar:(0,te.w5)("f"),uFogColor:(0,te.w5)("v3"),uProjection:(0,te.w5)("m4"),uInvProjection:(0,te.w5)("m4"),uBounds:(0,te.w5)("v4"),uLightDirection:(0,te.w5)("v3[]"),uLightColor:(0,te.w5)("v3[]"),dLightCount:(0,te.$F)("number"),uAmbientColor:(0,te.w5)("v3"),uLightStrength:(0,te.w5)("v3"),uFrameNo:(0,te.w5)("i"),dRendersPerFrame:(0,te.$F)("number"),dGlow:(0,te.$F)("boolean"),dBounces:(0,te.$F)("number"),dSteps:(0,te.$F)("number"),dFirstStepSize:(0,te.$F)("number"),dRefineSteps:(0,te.$F)("number"),uRayDistance:(0,te.w5)("f"),dThicknessMode:(0,te.$F)("string"),uMinThickness:(0,te.w5)("f"),uThicknessFactor:(0,te.w5)("f"),uThickness:(0,te.w5)("f"),dShadowEnable:(0,te.$F)("boolean"),uShadowSoftness:(0,te.w5)("f"),uShadowThickness:(0,te.w5)("f")},at=(0,ne.NG)("trace",oe.e,"\nprecision highp int;\nprecision highp float;\nprecision highp sampler2D;\n\nuniform sampler2D tColor;\nuniform sampler2D tNormal;\nuniform sampler2D tShaded;\nuniform sampler2D tThickness;\nuniform sampler2D tAccumulate;\nuniform sampler2D tDepth;\nuniform vec2 uTexSize;\nuniform vec4 uBounds;\n\nuniform float uNear;\nuniform float uFar;\nuniform float uFogNear;\nuniform float uFogFar;\nuniform vec3 uFogColor;\n\n#if dLightCount != 0\n    uniform vec3 uLightDirection[dLightCount];\n    uniform vec3 uLightColor[dLightCount];\n#endif\nuniform vec3 uAmbientColor;\nuniform vec3 uLightStrength;\n\nuniform int uFrameNo;\n\nuniform float uRayDistance;\nuniform float uMinThickness;\nuniform float uThicknessFactor;\nuniform float uThickness;\n\nuniform float uShadowSoftness;\nuniform float uShadowThickness;\n\nuniform mat4 uProjection;\nuniform mat4 uInvProjection;\n\n#include common\n\n// parts adapted from\n// - https://blog.demofox.org/2020/05/25/casual-shadertoy-path-tracing-1-basic-camera-diffuse-emissive/\n// - https://github.com/0beqz/realism-effects/blob/v2-debug/src/ssgi/shader/ssgi.frag\n\n//\n\n// after a hit, it moves the ray this far along the normal away from a surface.\n// Helps prevent incorrect intersections when rays bounce off of objects.\n#define RayPosNormalNudge 0.0001\n\n#if __VERSION__ == 100\n    #define StateType float\n\n    // from https://www.shadertoy.com/view/4djSRW\n    float hash14(vec4 p4) {\n        p4 = fract(p4  * vec4(0.1031, 0.1030, 0.0973, 0.1099));\n        p4 += dot(p4, p4.wzxy + 33.33);\n        return fract((p4.x + p4.y) * (p4.z + p4.w));\n    }\n\n    float randomFloat(inout float state) {\n        state += 0.06711056;\n        return 1.0 - hash14(vec4(gl_FragCoord.xy, float(uFrameNo), state));\n    }\n#else\n    #define StateType uint\n\n    // https://www.pcg-random.org/\n    // https://jcgt.org/published/0009/03/02/\n    uint pcg(inout uint seed) {\n        seed = seed * 747796405u + 2891336453u;\n        uint word = ((seed >> ((seed >> 28u) + 4u)) ^ seed) * 277803737u;\n        return (word >> 22u) ^ word;\n    }\n\n    float randomFloat(inout uint state) {\n        return float(pcg(state)) / 4294967296.0;\n    }\n#endif\n\nvec3 randomUnitVector(inout StateType state) {\n    float z = randomFloat(state) * 2.0 - 1.0;\n    float a = randomFloat(state) * TWO_PI;\n    float r = sqrt(1.0 - z * z);\n    float x = r * cos(a);\n    float y = r * sin(a);\n    return vec3(x, y, z);\n}\n\nstruct RayHitInfo {\n    bool missed;\n    vec3 position;\n    vec3 normal;\n    vec3 color;\n    vec3 emissive;\n};\n\n//\n\nfloat getDepth(const in vec2 coords) {\n    vec2 c = vec2(clamp(coords.x, uBounds.x, uBounds.z), clamp(coords.y, uBounds.y, uBounds.w));\n    return texture2D(tDepth, c).r;\n}\n\nfloat getThickness(const in vec2 coords) {\n    vec2 c = vec2(clamp(coords.x, uBounds.x, uBounds.z), clamp(coords.y, uBounds.y, uBounds.w));\n    return unpackRGBAToDepth(texture2D(tThickness, c));\n}\n\nbool isBackground(const in float depth) {\n    return depth == 1.0;\n}\n\nfloat getViewZ(const in float depth) {\n    #if dOrthographic == 1\n        return orthographicDepthToViewZ(depth, uNear, uFar);\n    #else\n        return perspectiveDepthToViewZ(depth, uNear, uFar);\n    #endif\n}\n\nvec2 viewSpaceToScreenSpace(const vec3 position) {\n    vec4 projectedCoord = uProjection * vec4(position, 1.0);\n    projectedCoord.xy /= projectedCoord.w;\n    // [-1, 1] --\x3e [0, 1] (NDC to screen position)\n    projectedCoord.xy = projectedCoord.xy * 0.5 + 0.5;\n    return projectedCoord.xy;\n}\n\nvec2 binarySearch(inout vec3 dir, inout vec3 hitPos) {\n    float rayHitDepthDifference;\n    vec2 coords;\n\n    dir *= 0.5;\n    hitPos -= dir;\n\n    for (int i = 0; i < dRefineSteps; i++) {\n        coords = viewSpaceToScreenSpace(hitPos);\n        float depth = getDepth(coords);\n        float z = getViewZ(depth);\n        rayHitDepthDifference = z - hitPos.z;\n\n        dir *= 0.5;\n        if (rayHitDepthDifference >= 0.0) {\n            hitPos -= dir;\n        } else {\n            hitPos += dir;\n        }\n    }\n\n    coords = viewSpaceToScreenSpace(hitPos);\n\n    return coords;\n}\n\nfloat calculateGrowthFactor(float begin, float end, float steps) {\n    return pow(end / begin, 1.0 / steps);\n}\n\nvec2 rayMarch(in vec3 dir, in float thickness, inout vec3 hitPos, out bool missed) {\n    float rayHitDepthDifference;\n    vec2 coords;\n\n    float begin = float(dFirstStepSize);\n    dir *= begin;\n    missed = false;\n    float gf = calculateGrowthFactor(begin, uRayDistance, float(dSteps));\n\n    for (int i = 1; i < dSteps; i++) {\n        hitPos += dir;\n        dir *= gf;\n\n        coords = viewSpaceToScreenSpace(hitPos);\n        float depth = getDepth(coords);\n        float z = getViewZ(depth);\n        rayHitDepthDifference = z - hitPos.z;\n\n        if (thickness == 0.0) {\n            #ifdef dThicknessMode_auto\n                thickness = max(uMinThickness, (getViewZ(getThickness(coords)) - z) * uThicknessFactor * texture2D(tColor, coords).a);\n            #else\n                thickness = uThickness;\n            #endif\n        }\n\n        if (rayHitDepthDifference >= 0.0 && rayHitDepthDifference < thickness) {\n            if (dRefineSteps == 0) {\n                return coords;\n            } else {\n                return binarySearch(dir, hitPos);\n            }\n        }\n    }\n\n    missed = true;\n\n    return coords;\n}\n\n//\n\nvoid trace(in vec3 rayPos, in vec3 rayDir, inout RayHitInfo hitInfo) {\n    vec3 hitPos = vec3(rayPos);\n    bool missed;\n    vec2 coords;\n    coords = rayMarch(rayDir, 0.0, hitPos, missed);\n\n    hitInfo.missed = missed;\n    hitInfo.position = hitPos;\n    hitInfo.normal = -texture2D(tNormal, coords).rgb;\n    hitInfo.color = texture2D(tColor, coords).rgb;\n    hitInfo.emissive = texture2D(tColor, coords).rgb * texture2D(tNormal, coords).a * 2.0;\n\n    float depth = getDepth(coords);\n    if (isBackground(depth)) {\n        hitInfo.emissive = vec3(0.0);\n    }\n}\n\nvec3 viewPos;\n\nvec3 colorForRay(in vec3 startRayPos, in vec3 startRayDir, inout StateType rngState) {\n    vec3 ret = vec3(0.0, 0.0, 0.0);\n\n    vec3 throughput = vec3(1.0, 1.0, 1.0);\n    vec3 rayPos = startRayPos;\n    vec3 rayDir = startRayDir;\n\n    RayHitInfo hitInfo;\n    RayHitInfo prevHitInfo;\n\n    for (int bounceIndex = 0; bounceIndex <= dBounces; ++bounceIndex) {\n        // shoot a ray out into the world\n        if (bounceIndex == 0) {\n            vec2 coords = gl_FragCoord.xy / uTexSize;\n            float depth = getDepth(coords);\n\n            hitInfo.missed = false;\n            hitInfo.position = screenSpaceToViewSpace(vec3(coords, depth), uInvProjection);\n            hitInfo.normal = -texture2D(tNormal, coords).rgb;\n            hitInfo.color = texture2D(tShaded, coords).rgb;\n            hitInfo.emissive = texture2D(tColor, coords).rgb * texture2D(tNormal, coords).a;\n\n            // shadow\n            #ifdef dShadowEnable\n                #if dLightCount != 0\n                    vec3 directLight = vec3(uAmbientColor);\n                    #pragma unroll_loop_start\n                    bool missed;\n                    vec3 hitPos;\n                    for (int i = 0; i < dLightCount; ++i) {\n                        missed = false;\n                        hitPos = viewPos + hitInfo.normal * RayPosNormalNudge;\n                        hitPos += -uLightDirection[i] * (randomFloat(rngState));\n                        rayMarch(-uLightDirection[i] + randomUnitVector(rngState) * uShadowSoftness, uShadowThickness, hitPos, missed);\n                        if (missed) directLight += uLightColor[i];\n                    }\n                    #pragma unroll_loop_end\n                    hitInfo.color *= directLight / uLightStrength;\n                #endif\n            #endif\n\n            if (hitInfo.normal == vec3(0.0)) {\n                hitInfo.missed = true;\n            }\n        } else {\n            prevHitInfo = hitInfo;\n            trace(rayPos, rayDir, hitInfo);\n        }\n\n        // if the ray missed, we are done\n        if (hitInfo.missed) {\n            vec3 accIrradiance = vec3(1.0);\n            #ifdef dGlow\n                if (bounceIndex > 1) {\n                    accIrradiance = uLightStrength;\n                }\n            #else\n                if (bounceIndex > 1) {\n                    accIrradiance = uAmbientColor;\n                    #if dLightCount != 0\n                        #pragma unroll_loop_start\n                        float dotNL;\n                        vec3 irradiance;\n                        for (int i = 0; i < dLightCount; ++i) {\n                            dotNL = saturate(dot(prevHitInfo.normal, -uLightDirection[i]));\n                            irradiance = dotNL * uLightColor[i];\n                            accIrradiance += irradiance;\n                        }\n                        #pragma unroll_loop_end\n                    #endif\n                }\n            #endif\n            ret += prevHitInfo.color * accIrradiance * throughput;\n            break;\n        }\n\n        // add emissive light\n        ret += hitInfo.emissive * throughput;\n\n        // update the ray position\n        rayPos = hitInfo.position + hitInfo.normal * RayPosNormalNudge;\n\n        // new ray direction from normal oriented cosine weighted hemisphere sample\n        rayDir = normalize(hitInfo.normal + randomUnitVector(rngState));\n\n        if (bounceIndex == 0) {\n            continue;\n        }\n\n        // update the colorMultiplier.\n        throughput *= hitInfo.color;\n\n        // Russian Roulette\n        // As the throughput gets smaller, the ray is more likely to get terminated early.\n        // Survivors have their value boosted to make up for fewer samples being in the average.\n        {\n            float p = max(throughput.r, max(throughput.g, throughput.b));\n            if (randomFloat(rngState) > p)\n                break;\n\n            // Add the energy we 'lose' by randomly terminating paths\n            throughput *= 1.0 / p;\n        }\n    }\n\n    // return pixel color\n    return ret;\n}\n\nvoid main() {\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n    float depth = getDepth(coords);\n\n    if (isBackground(depth)) {\n        gl_FragColor = texture2D(tColor, coords);\n        return;\n    }\n\n    #if __VERSION__ == 100\n        float rngState = 26699.0;\n    #else\n        // initialize a random number state based on gl_FragCoord and uFrameNo\n        uint rngState = uint(uint(gl_FragCoord.x) * 1973u + uint(gl_FragCoord.y) * 9277u + uint(uFrameNo) * 26699u) | 1u;\n    #endif\n\n    vec3 cameraPos = vec3(0.0, 0.0, 0.0);\n    viewPos = screenSpaceToViewSpace(vec3(coords, depth), uInvProjection);\n    vec3 rayDir = normalize(viewPos);\n\n    // raytrace for this pixel\n    vec3 color = vec3(0.0, 0.0, 0.0);\n    for (int index = 0; index < int(dRendersPerFrame); ++index) {\n        color += colorForRay(cameraPos, rayDir, rngState) / float(dRendersPerFrame);\n    }\n\n    // average the frames together\n    vec4 lastFrameColor = texture2D(tAccumulate, coords);\n    float blend = (uFrameNo < 1 || lastFrameColor.a == 0.0) ? 1.0 : 1.0 / (1.0 + (1.0 / lastFrameColor.a));\n    color = mix(lastFrameColor.rgb, color, blend);\n\n    // show the result\n    gl_FragColor = vec4(color, blend);\n}\n"),st={...ee.du,tColor:(0,te.$G)("texture","rgba","ubyte","nearest"),uTexSize:(0,te.w5)("v2"),uWeight:(0,te.w5)("f")},lt=(0,ne.NG)("accumulate",oe.e,"\nprecision highp float;\nprecision highp sampler2D;\n\nuniform sampler2D tColor;\nuniform vec2 uTexSize;\nuniform float uWeight;\n\nvoid main() {\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n    gl_FragColor = texture2D(tColor, coords) * uWeight;\n}\n")
var ct=n(42872)
let ut=!1
function dt(e){const{drawBuffers:t,textureFloat:n,colorBufferFloat:r,depthTexture:i}=e.extensions
if(n&&r&&i&&t)return!0
if(se.Bb&&!ut){const e=[]
n||e.push("textureFloat"),r||e.push("colorBufferFloat"),i||e.push("depthTexture"),t||e.push("drawBuffers"),console.log(`Missing "${e.join('", "')}" extensions required for "illumination"`),ut=!0}return!1}const pt={enabled:p.t.Boolean(!1),maxIterations:p.t.Numeric(5,{min:0,max:16,step:1},{description:"Maximum number of tracing iterations. Final iteration count is 2^x."}),denoise:p.t.Boolean(!0),denoiseThreshold:p.t.Interval([.15,1],{min:0,max:4,step:.01},{description:"Threshold for denoising. Automatically adjusted within given interval based on current iteration."}),ignoreOutline:p.t.Boolean(!0,{description:"Ignore outline in illumination pass where it is generally not needed for visual clarity. Useful when illumination is often toggled on/off."}),...rt}
class ht{get iteration(){return this._iteration}get colorTarget(){return this._colorTarget}get supported(){return this._supported}getByteCount(){return this._supported?this.tracing.getByteCount()+this.transparentTarget.getByteCount()+this.outputTarget.getByteCount()+this.multiSampleComposeTarget.getByteCount()+this.multiSampleHoldTarget.getByteCount()+this.multiSampleAccumulateTarget.getByteCount():0}getMaxIterations(e){return Math.pow(2,e.maxIterations)}static isSupported(e){return dt(e)}static isEnabled(e,t){return t.enabled&&dt(e)}constructor(e,t){if(this.webgl=e,this.drawPass=t,this._iteration=0,this._supported=!1,this.prevSampleIndex=-1,!ht.isSupported(e))return
const{colorTarget:n}=t,r=n.getWidth(),i=n.getHeight()
this.tracing=new it(e,this.drawPass),this.transparentTarget=e.createRenderTarget(r,i,!1,"uint8","nearest"),this.outputTarget=e.createRenderTarget(r,i,!1,"uint8","linear"),this.copyRenderable=(0,ee._0)(e,this.transparentTarget.texture),this.composeRenderable=function(e,t,n,r,i,o,a,s,l,c){const u={...ee.OM,tColor:O.IQ.create(t),tNormal:O.IQ.create(n),tShaded:O.IQ.create(r),tTransparentColor:O.IQ.create(s),dBlendTransparency:O.IQ.create(!0),tSsaoDepth:O.IQ.create(l),tSsaoDepthTransparent:O.IQ.create(c),tDepthOpaque:O.IQ.create(i),tDepthTransparent:O.IQ.create(o),tOutlines:O.IQ.create(a),uTexSize:O.IQ.create(Ke.Z.create(t.getWidth(),t.getHeight())),dDenoise:O.IQ.create(!0),uDenoiseThreshold:O.IQ.create(.1),dOrthographic:O.IQ.create(0),uNear:O.IQ.create(1),uFar:O.IQ.create(1e4),uFogNear:O.IQ.create(1e4),uFogFar:O.IQ.create(1e4),uFogColor:O.IQ.create(_e.e.create(1,1,1)),uOutlineColor:O.IQ.create(_e.e.create(0,0,0)),uOcclusionColor:O.IQ.create(_e.e.create(0,0,0)),uTransparentBackground:O.IQ.create(!1),dOcclusionEnable:O.IQ.create(!1),dOutlineEnable:O.IQ.create(!1),dOutlineScale:O.IQ.create(1),dTransparentOutline:O.IQ.create(!1)},d={...ft},p=(0,re.$h)(e,"triangles",mt,d,u)
return(0,ie._)(p,u)}(e,this.tracing.accumulateTarget.texture,this.tracing.normalTextureOpaque,this.tracing.colorTextureOpaque,this.drawPass.depthTextureOpaque,this.drawPass.depthTargetTransparent.texture,this.drawPass.postprocessing.outline.target.texture,this.transparentTarget.texture,this.drawPass.postprocessing.ssao.ssaoDepthTexture,this.drawPass.postprocessing.ssao.ssaoDepthTransparentTexture),this.multiSampleComposeTarget=e.createRenderTarget(r,i,!1,"float32"),this.multiSampleHoldTarget=e.createRenderTarget(r,i,!1),this.multiSampleAccumulateTarget=e.createRenderTarget(r,i,!1,"float32"),this.multiSampleCompose=function(e,t){const n={...ee.OM,tColor:O.IQ.create(t),uTexSize:O.IQ.create(Ke.Z.create(t.getWidth(),t.getHeight())),uWeight:O.IQ.create(1)},r={...gt},i=(0,re.$h)(e,"triangles",yt,r,n)
return(0,ie._)(i,n)}(e,this.outputTarget.texture),this._supported=!0}renderInput(e,t,n,r){se.g$&&this.webgl.timer.mark("IlluminationPass.renderInput")
const{gl:i,state:o}=this.webgl,a=Ue.isEnabled(r.marking),s=n.opacityAverage<1||n.volumes.renderables.length>0,l=a&&n.markerAverage>0
this.transparentTarget.bind(),o.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT)
const c=J.Pv.isTransparentOutlineEnabled(r.postprocessing)&&!r.illumination.ignoreOutline,u=Xe.z.isEnabled(r.postprocessing),d=J.Pv.isTransparentSsaoEnabled(n,r.postprocessing)
if((c||u||d)&&(this.drawPass.depthTargetTransparent.bind(),e.clearDepth(!0)),s){if("wboit"===this.drawPass.transparency)this.drawPass.wboit.bind(),e.renderWboitTransparent(n.primitives,t,this.drawPass.depthTextureOpaque),n.volumes.renderables.length>0&&e.renderWboitTransparent(n.volumes,t,this.drawPass.depthTextureOpaque),this.transparentTarget.bind(),this.drawPass.wboit.render()
else if("dpoit"===this.drawPass.transparency){const i=this.drawPass.dpoit.bind()
e.renderDpoitTransparent(n.primitives,t,this.drawPass.depthTextureOpaque,i)
for(let o=0,a=r.dpoitIterations;o<a;o++){se.g$&&this.webgl.timer.mark("DpoitPass.layer")
const r=this.drawPass.dpoit.bindDualDepthPeeling()
e.renderDpoitTransparent(n.primitives,t,this.drawPass.depthTextureOpaque,r),a>1&&(this.transparentTarget.bind(),this.drawPass.dpoit.renderBlendBack()),se.g$&&this.webgl.timer.markEnd("DpoitPass.layer")}this.transparentTarget.bind(),this.drawPass.dpoit.render(),n.volumes.renderables.length>0&&e.renderVolume(n.volumes,t,this.drawPass.depthTextureOpaque)}else this.transparentTarget.bind(),this.drawPass.depthTextureOpaque.attachFramebuffer(this.transparentTarget.framebuffer,"depth"),e.renderBlendedTransparent(n.primitives,t),this.drawPass.depthTextureOpaque.detachFramebuffer(this.transparentTarget.framebuffer,"depth"),n.volumes.renderables.length>0&&e.renderVolume(n.volumes,t,this.drawPass.depthTextureOpaque);(c||u||d)&&(this.drawPass.depthTargetTransparent.bind(),n.opacityAverage<1&&e.renderDepthTransparent(n.primitives,t,this.drawPass.depthTextureOpaque)),d&&(this.drawPass.postprocessing.ssao.update(t,n,r.postprocessing.occlusion.params,!0),this.drawPass.postprocessing.ssao.render(t))}if(l){const i=r.marking.ghostEdgeStrength<1
i&&1!==n.markerAverage&&(this.drawPass.marking.depthTarget.bind(),e.clear(!1,!0),e.renderMarkingDepth(n.primitives,t)),this.drawPass.marking.maskTarget.bind(),e.clear(!1,!0),e.renderMarkingMask(n.primitives,t,i?this.drawPass.marking.depthTarget.texture:null),this.drawPass.marking.update(r.marking),this.drawPass.marking.render(t.viewport,this.transparentTarget)}this.tracing.composeTarget.bind(),o.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),se.g$&&this.webgl.timer.markEnd("IlluminationPass.renderInput")}shouldRender(e){return this._supported&&e.enabled&&this._iteration<this.getMaxIterations(e)}setSize(e,t){if(!this._supported)return
const n=this.outputTarget.getWidth(),r=this.outputTarget.getHeight()
e===n&&t===r||(this.tracing.setSize(e,t),this.transparentTarget.setSize(e,t),this.outputTarget.setSize(e,t),O.IQ.update(this.copyRenderable.values.uTexSize,Ke.Z.set(this.copyRenderable.values.uTexSize.ref.value,e,t)),O.IQ.update(this.composeRenderable.values.uTexSize,Ke.Z.set(this.composeRenderable.values.uTexSize.ref.value,e,t)),this.multiSampleComposeTarget.setSize(e,t),this.multiSampleHoldTarget.setSize(e,t),this.multiSampleAccumulateTarget.setSize(e,t),O.IQ.update(this.multiSampleCompose.values.uTexSize,Ke.Z.set(this.multiSampleCompose.values.uTexSize.ref.value,e,t))),this.drawPass.setSize(e,t)}reset(){this._supported&&(this.tracing.reset(),this._iteration=0,this.prevSampleIndex=-1)}restart(e=!1){this._supported&&(this.tracing.restart(e),this._iteration=0,this.prevSampleIndex=-1)}renderInternal(e,t,n,r){if(!this.shouldRender(t.illumination))return
se.g$&&this.webgl.timer.mark("IlluminationPass.render",{note:`iteration ${this._iteration+1} of ${this.getMaxIterations(t.illumination)}`}),this.tracing.render(e,t.transparentBackground,t.illumination,this._iteration,r)
const{renderer:i,camera:o,scene:a,helper:s}=e,{gl:l,state:c}=this.webgl,{x:u,y:d,width:p,height:h}=o.viewport;(0===this._iteration||r)&&(i.setTransparentBackground(t.transparentBackground),i.setDrawingBufferSize(this.tracing.composeTarget.getWidth(),this.tracing.composeTarget.getHeight()),i.setPixelRatio(this.webgl.pixelRatio),i.setViewport(u,d,p,h),i.update(o,a),this.renderInput(i,o,a,t)),c.disable(l.BLEND),c.disable(l.DEPTH_TEST),c.disable(l.CULL_FACE),c.depthMask(!1),c.viewport(u,d,p,h),c.scissor(u,d,p,h)
const f="orthographic"===o.state.mode?1:0,m=J.SK.isEnabled(t.postprocessing),g=ct.G.isEnabled(t.postprocessing)&&!t.illumination.ignoreOutline,y=J.Pv.isTransparentSsaoEnabled(a,t.postprocessing),v=We.P.isEnabled(t.postprocessing),b=Xe.z.isEnabled(t.postprocessing),x=Ue.isEnabled(t.marking),S=a.opacityAverage<1||a.volumes.renderables.length>0,_=x&&a.markerAverage>0
let C=!1
if(this.composeRenderable.values.dOutlineEnable.ref.value!==g&&(C=!0,O.IQ.update(this.composeRenderable.values.dOutlineEnable,g)),g&&"on"===t.postprocessing.outline.name){const{transparentOutline:e,outlineScale:n}=this.drawPass.postprocessing.outline.update(o,t.postprocessing.outline.params,this.drawPass.depthTargetTransparent.texture,this.drawPass.depthTextureOpaque)
this.drawPass.postprocessing.outline.render(),O.IQ.update(this.composeRenderable.values.uOutlineColor,Je.Q1.toVec3Normalized(this.composeRenderable.values.uOutlineColor.ref.value,t.postprocessing.outline.params.color)),this.composeRenderable.values.dOutlineScale.ref.value!==n&&(C=!0,O.IQ.update(this.composeRenderable.values.dOutlineScale,n)),this.composeRenderable.values.dTransparentOutline.ref.value!==e&&(C=!0,O.IQ.update(this.composeRenderable.values.dTransparentOutline,e))}this.composeRenderable.values.dOcclusionEnable.ref.value!==y&&(C=!0,O.IQ.update(this.composeRenderable.values.dOcclusionEnable,y)),y&&"on"===t.postprocessing.occlusion.name&&O.IQ.update(this.composeRenderable.values.uOcclusionColor,Je.Q1.toVec3Normalized(this.composeRenderable.values.uOcclusionColor.ref.value,t.postprocessing.occlusion.params.color))
const w=S||_
this.composeRenderable.values.dBlendTransparency.ref.value!==w&&(C=!0,O.IQ.update(this.composeRenderable.values.dBlendTransparency,w)),O.IQ.updateIfChanged(this.composeRenderable.values.uNear,o.near),O.IQ.updateIfChanged(this.composeRenderable.values.uFar,o.far),O.IQ.updateIfChanged(this.composeRenderable.values.uFogFar,o.fogFar),O.IQ.updateIfChanged(this.composeRenderable.values.uFogNear,o.fogNear),O.IQ.update(this.composeRenderable.values.uFogColor,Je.Q1.toVec3Normalized(this.composeRenderable.values.uFogColor.ref.value,i.props.backgroundColor)),this.composeRenderable.values.dOrthographic.ref.value!==f&&(O.IQ.update(this.composeRenderable.values.dOrthographic,f),C=!0),!n||m||b?this.tracing.composeTarget.bind():this.webgl.bindDrawingBuffer(),this._colorTarget=this.tracing.composeTarget,this.drawPass.postprocessing.background.update(o,t.postprocessing.background),this.drawPass.postprocessing.background.clear(t.postprocessing.background,t.transparentBackground,i.props.backgroundColor),this.drawPass.postprocessing.background.render(t.postprocessing.background),O.IQ.updateIfChanged(this.composeRenderable.values.uTransparentBackground,t.transparentBackground||this.drawPass.postprocessing.background.isEnabled(t.postprocessing)),this.composeRenderable.values.dDenoise.ref.value!==t.illumination.denoise&&(O.IQ.update(this.composeRenderable.values.dDenoise,t.illumination.denoise),C=!0)
const T="on"===t.multiSample.mode?t.illumination.denoiseThreshold[0]:(0,nt.Cc)(t.illumination.denoiseThreshold[1],t.illumination.denoiseThreshold[0],(0,nt.qE)(this.iteration/(this.getMaxIterations(t.illumination)/2),0,1))
O.IQ.updateIfChanged(this.composeRenderable.values.uDenoiseThreshold,T),C&&this.composeRenderable.update(),this.composeRenderable.render(),i.setDrawingBufferSize(this.tracing.composeTarget.getWidth(),this.tracing.composeTarget.getHeight()),i.setPixelRatio(this.webgl.pixelRatio),i.setViewport(u,d,p,h),i.update(o,a),s.debug.isEnabled&&(s.debug.syncVisibility(),i.renderBlended(s.debug.scene,o)),s.handle.isEnabled&&i.renderBlended(s.handle.scene,o),s.camera.isEnabled&&(s.camera.update(o),i.update(s.camera.camera,s.camera.scene),i.renderBlended(s.camera.scene,s.camera.camera))
let A=!1,I=this.outputTarget
if(m){const e=n&&!b
this.drawPass.antialiasing.render(o,this.tracing.composeTarget.texture,!!e||this.outputTarget,t.postprocessing),e?A=!0:(this._colorTarget=this.outputTarget,I=this.tracing.composeTarget)}if(v&&"on"===t.postprocessing.bloom.name){const e=n&&!b||A
this.drawPass.bloom.update(this.tracing.colorTextureOpaque,this.tracing.normalTextureOpaque,this.drawPass.depthTextureOpaque,t.postprocessing.bloom.params),this.drawPass.bloom.render(o.viewport,e?void 0:this._colorTarget)}if(b&&"on"===t.postprocessing.dof.name){const e=n||A
this.drawPass.dof.update(o,this._colorTarget.texture,this.drawPass.depthTextureOpaque,this.drawPass.depthTargetTransparent.texture,t.postprocessing.dof.params,a.boundingSphereVisible),this.drawPass.dof.render(o.viewport,e?void 0:I),e||(this._colorTarget=I)}this._iteration+=1,se.g$&&this.webgl.timer.markEnd("IlluminationPass.render"),this.webgl.gl.flush()}renderMultiSample(e,t,n){const{camera:r}=e,{multiSampleCompose:i,multiSampleComposeTarget:o,multiSampleHoldTarget:a,webgl:s}=this,{gl:l,state:c}=s,u=pe[Math.max(0,Math.min(t.multiSample.sampleLevel,5))],d=this.getMaxIterations(t.illumination),p=Math.min(this._iteration,d),h=Math.floor(p/d*u.length)
se.g$&&s.timer.mark("IlluminationPass.renderMultiSample",{note:`sampleIndex ${h+1} of ${u.length}`})
const{x:f,y:m,width:g,height:y}=r.viewport,v=1/d
if(0===p)this.renderInternal(e,t,!1,!0),O.IQ.update(i.values.uWeight,1),O.IQ.update(i.values.tColor,this._colorTarget.texture),i.update(),a.bind(),c.disable(l.BLEND),c.disable(l.DEPTH_TEST),c.depthMask(!1),c.viewport(f,m,g,y),c.scissor(f,m,g,y),i.render()
else{r.viewOffset.enabled=!0,O.IQ.update(i.values.tColor,this._colorTarget.texture),O.IQ.update(i.values.uWeight,v),i.update()
const n=u[h]
I.i.setViewOffset(r.viewOffset,g,y,n[0],n[1],g,y),r.update(),this.renderInternal(e,t,!1,this.prevSampleIndex!==h),o.bind(),c.enable(l.BLEND),c.blendEquationSeparate(l.FUNC_ADD,l.FUNC_ADD),c.blendFuncSeparate(l.ONE,l.ONE,l.ONE,l.ONE),c.disable(l.DEPTH_TEST),c.depthMask(!1),c.viewport(f,m,g,y),c.scissor(f,m,g,y),1===p&&(c.clearColor(0,0,0,0),l.clear(l.COLOR_BUFFER_BIT)),i.render()}this.prevSampleIndex=h,n?this.webgl.bindDrawingBuffer():this.multiSampleAccumulateTarget.bind(),c.viewport(f,m,g,y),c.scissor(f,m,g,y)
const b=p*v
b>0&&(O.IQ.update(i.values.uWeight,1),O.IQ.update(i.values.tColor,o.texture),i.update(),c.disable(l.BLEND),i.render()),b<1&&(O.IQ.update(i.values.uWeight,1-b),O.IQ.update(i.values.tColor,a.texture),i.update(),0===b?c.disable(l.BLEND):c.enable(l.BLEND),i.render()),n||(c.disable(l.BLEND),this.colorTarget.bind(),this.copyRenderable.values.tColor.ref.value!==this.multiSampleAccumulateTarget.texture&&(O.IQ.update(this.copyRenderable.values.tColor,this.multiSampleAccumulateTarget.texture),this.copyRenderable.update()),this.copyRenderable.render()),r.viewOffset.enabled=!1,r.update(),se.g$&&s.timer.markEnd("IlluminationPass.renderMultiSample")}render(e,t,n){this._supported&&("on"===t.multiSample.mode?this.renderMultiSample(e,t,n):this.renderInternal(e,t,n,!1))}}const ft={...ee.du,tColor:(0,te.$G)("texture","rgba","ubyte","nearest"),tNormal:(0,te.$G)("texture","rgba","ubyte","nearest"),tShaded:(0,te.$G)("texture","rgba","ubyte","nearest"),tTransparentColor:(0,te.$G)("texture","rgba","ubyte","nearest"),dBlendTransparency:(0,te.$F)("boolean"),tSsaoDepth:(0,te.$G)("texture","rgba","ubyte","nearest"),tSsaoDepthTransparent:(0,te.$G)("texture","rgba","ubyte","nearest"),tDepthOpaque:(0,te.$G)("texture","rgba","ubyte","nearest"),tDepthTransparent:(0,te.$G)("texture","rgba","ubyte","nearest"),tOutlines:(0,te.$G)("texture","rgba","ubyte","nearest"),uTexSize:(0,te.w5)("v2"),dDenoise:(0,te.$F)("boolean"),uDenoiseThreshold:(0,te.w5)("f"),dOrthographic:(0,te.$F)("number"),uNear:(0,te.w5)("f"),uFar:(0,te.w5)("f"),uFogNear:(0,te.w5)("f"),uFogFar:(0,te.w5)("f"),uFogColor:(0,te.w5)("v3"),uOutlineColor:(0,te.w5)("v3"),uOcclusionColor:(0,te.w5)("v3"),uTransparentBackground:(0,te.w5)("b"),dOcclusionEnable:(0,te.$F)("boolean"),dOutlineEnable:(0,te.$F)("boolean"),dOutlineScale:(0,te.$F)("number"),dTransparentOutline:(0,te.$F)("boolean")},mt=(0,ne.NG)("compose",oe.e,"\nprecision highp float;\nprecision highp sampler2D;\n\nuniform sampler2D tShaded;\nuniform sampler2D tColor;\nuniform sampler2D tNormal;\nuniform sampler2D tTransparentColor;\nuniform sampler2D tSsaoDepth;\nuniform sampler2D tSsaoDepthTransparent;\nuniform sampler2D tDepthOpaque;\nuniform sampler2D tDepthTransparent;\nuniform sampler2D tOutlines;\nuniform vec2 uTexSize;\n\nuniform float uNear;\nuniform float uFar;\nuniform float uFogNear;\nuniform float uFogFar;\nuniform vec3 uFogColor;\nuniform vec3 uOutlineColor;\nuniform vec3 uOcclusionColor;\nuniform bool uTransparentBackground;\n\nuniform float uDenoiseThreshold;\n\n#include common\n\nfloat getViewZ(const in float depth) {\n    #if dOrthographic == 1\n        return orthographicDepthToViewZ(depth, uNear, uFar);\n    #else\n        return perspectiveDepthToViewZ(depth, uNear, uFar);\n    #endif\n}\n\nfloat getDepthOpaque(const in vec2 coords) {\n    #ifdef depthTextureSupport\n        return texture2D(tDepthOpaque, coords).r;\n    #else\n        return unpackRGBAToDepth(texture2D(tDepthOpaque, coords));\n    #endif\n}\n\nfloat getDepthTransparent(const in vec2 coords) {\n    #if defined(dTransparentOutline) || defined(dOcclusionEnable)\n        return unpackRGBAToDepthWithAlpha(texture2D(tDepthTransparent, coords)).x;\n    #else\n        return 1.0;\n    #endif\n}\n\nbool isBackground(const in float depth) {\n    return depth == 1.0;\n}\n\nfloat getSsao(vec2 coords) {\n    float rawSsao = unpackRGToUnitInterval(texture2D(tSsaoDepth, coords).xy);\n    if (rawSsao > 0.999) {\n        return 1.0;\n    } else if (rawSsao > 0.001) {\n        return rawSsao;\n    }\n    // treat values close to 0.0 as errors and return no occlusion\n    return 1.0;\n}\n\nfloat getSsaoTransparent(vec2 coords) {\n    float rawSsao = unpackRGToUnitInterval(texture2D(tSsaoDepthTransparent, coords).xy);\n    if (rawSsao > 0.999) {\n        return 1.0;\n    } else if (rawSsao > 0.001) {\n        return rawSsao;\n    }\n    // treat values close to 0.0 as errors and return no occlusion\n    return 1.0;\n}\n\n//\n\n// TODO: investigate\n// https://interplayoflight.wordpress.com/2022/03/26/raytraced-global-illumination-denoising/\n\n//\n\n#define INV_SQRT_OF_2PI 0.39894228040143267793994605993439  // 1.0/SQRT_OF_2PI\n#define INV_PI 0.31830988618379067153776752674503\n\n// https://github.com/BrutPitt/glslSmartDeNoise\n//\n//  smartDeNoise - parameters\n//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n//\n//  sampler2D tex     - sampler image / texture\n//  vec2 uv           - actual fragment coord\n//  float sigma  >  0 - sigma Standard Deviation\n//  float kSigma >= 0 - sigma coefficient\n//      kSigma * sigma  --\x3e  radius of the circular kernel\n//  float threshold   - edge sharpening threshold\n\nfloat NormalWeightStrength = 6.0;\n\nvec4 smartDeNoise(sampler2D tex, vec2 uv) {\n    float sigma = 3.0;\n    float kSigma = 2.0;\n    float threshold = uDenoiseThreshold;\n\n    vec4 centrPx = texture2D(tex, uv);\n    if (threshold == 0.0) return centrPx;\n\n    float invSigmaQx2 = 0.5 / (sigma * sigma);      // 1.0 / (sigma^2 * 2.0)\n    float invSigmaQx2PI = INV_PI * invSigmaQx2;    // 1.0 / (sqrt(PI) * sigma)\n\n    float invThresholdSqx2 = 0.5 / (threshold * threshold);     // 1.0 / (sigma^2 * 2.0)\n    float invThresholdSqrt2PI = INV_SQRT_OF_2PI / threshold;   // 1.0 / (sqrt(2*PI) * sigma)\n\n    float zBuff = 0.0;\n    vec4 aBuff = vec4(0.0);\n\n    vec3 normal = texture2D(tNormal, uv).xyz;\n\n    for (int x = -6; x <= 6; ++x) {\n        for (int y = -6; y <= 6; ++y) {\n            vec2 d = vec2(float(x), float(y));\n\n            float blurFactor = exp(-dot(d , d) * invSigmaQx2) * invSigmaQx2PI;\n            vec2 uvSample = uv + d / uTexSize;\n\n            vec3 normalSample = texture2D(tNormal, uvSample).xyz;\n            float normalW = saturate(dot(normal, normalSample));\n            normalW = pow(normalW, NormalWeightStrength);\n            blurFactor *= normalW;\n\n            vec4 walkPx = texture2D(tex, uvSample);\n\n            vec4 dC = walkPx - centrPx;\n            float deltaFactor = exp(-dot(dC, dC) * invThresholdSqx2) * invThresholdSqrt2PI * blurFactor;\n\n            zBuff += deltaFactor;\n            aBuff += deltaFactor * walkPx;\n        }\n    }\n\n    if (zBuff <= EPSILON) {\n        return centrPx;\n    }\n\n    return aBuff / zBuff;\n}\n\nint squaredOutlineScale = dOutlineScale * dOutlineScale;\nvoid getOutline(const in vec2 coords, out bool hasOpaque, out bool hasTransparent, out float opaqueDepth, out float transparentDepth, out float alpha) {\n    vec2 invTexSize = 1.0 / uTexSize;\n    \n    hasOpaque = false;\n    hasTransparent = false;\n    opaqueDepth = 1.0;\n    transparentDepth = 1.0;\n    alpha = 0.0;\n    for (int y = -dOutlineScale; y <= dOutlineScale; y++) {\n        for (int x = -dOutlineScale; x <= dOutlineScale; x++) {\n            if (x * x + y * y > squaredOutlineScale) {\n                continue;\n            }\n\n            vec2 sampleCoords = coords + vec2(float(x), float(y)) * invTexSize;\n\n            vec4 sampleOutlineCombined = texture2D(tOutlines, sampleCoords);\n            float sampleOpaqueDepth = unpackRGToUnitInterval(sampleOutlineCombined.gb);\n            float sampleTransparentDepth = sampleOutlineCombined.a;\n            vec2 sampleFlagWithAlpha = unpack2x4(sampleOutlineCombined.r);\n\n            float sampleFlag = sampleFlagWithAlpha.x;\n            float sampleAlpha = clamp(sampleFlagWithAlpha.y * 0.5, 0.01, 1.0);\n            \n            if ((sampleFlag > 0.20 && sampleFlag < 0.30) || (sampleFlag > 0.70 && sampleFlag < 0.80)) { // transparent || both\n                if (sampleOpaqueDepth < opaqueDepth) {\n                    hasOpaque = true;\n                    opaqueDepth = sampleOpaqueDepth;\n                }\n            }\n            \n            if ((((sampleFlag > 0.45 && sampleFlag < 0.55) || (sampleFlag > 0.70 && sampleFlag < 0.80))) && sampleTransparentDepth < transparentDepth) { // transparent || both\n                hasTransparent = true;\n                transparentDepth = sampleTransparentDepth;\n                alpha = sampleAlpha;\n            }\n        }\n    }\n}\n\nvoid main() {\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n\n    #ifdef dDenoise\n        vec4 color = smartDeNoise(tColor, coords);\n    #else\n        vec4 color = texture2D(tColor, coords);\n    #endif\n\n    float opaqueDepth = getDepthOpaque(coords);\n    float backgroundViewZ = 2.0 * uFar;\n    float opaqueSelfViewZ = isBackground(opaqueDepth) ? backgroundViewZ : getViewZ(opaqueDepth);\n    float fogFactor = smoothstep(uFogNear, uFogFar, abs(opaqueSelfViewZ));\n    float fogAlpha = 1.0 - fogFactor;\n\n    float transparentDepth = 1.0;\n    #ifdef dBlendTransparency\n        bool blendTransparency = true;\n        vec4 transparentColor = texture2D(tTransparentColor, coords);\n\n        transparentDepth = getDepthTransparent(coords);\n    #endif\n\n    float alpha = 1.0;\n    if (!uTransparentBackground) {\n        // mix opaque objects with background color\n        color.rgb = mix(color.rgb, uFogColor, fogFactor);\n    } else {\n        // pre-multiplied alpha expected for transparent background\n        alpha = fogAlpha;\n        color.rgb *= fogAlpha;\n    }\n\n    #if defined(dOcclusionEnable)\n        if (!isBackground(opaqueDepth)) {\n            float occlusionFactor = getSsao(coords);\n\n            if (!uTransparentBackground) {\n                color.rgb = mix(mix(uOcclusionColor, uFogColor, fogFactor), color.rgb, occlusionFactor);\n            } else {\n                color.rgb = mix(uOcclusionColor * (1.0 - fogFactor), color.rgb, occlusionFactor);\n            }\n        }\n        #ifdef dBlendTransparency\n            if (!isBackground(transparentDepth)) {\n                float viewDist = abs(getViewZ(transparentDepth));\n                float fogFactor = smoothstep(uFogNear, uFogFar, viewDist);\n                float occlusionFactor = getSsaoTransparent(coords);\n                transparentColor.rgb = mix(uOcclusionColor * (1.0 - fogFactor), transparentColor.rgb, occlusionFactor);\n            }\n        #endif\n    #endif\n\n    #ifdef dOutlineEnable\n        bool hasOpaque;\n        bool hasTransparent;\n        float outlineOpaqueDepth;\n        float outlineTransparentDepth;\n        float outlineAlpha;\n        getOutline(coords, hasOpaque, hasTransparent, outlineOpaqueDepth, outlineTransparentDepth, outlineAlpha);\n\n        if (hasOpaque) {\n            float viewDist = abs(getViewZ(outlineOpaqueDepth));\n            float fogFactor = smoothstep(uFogNear, uFogFar, viewDist);\n            if (!uTransparentBackground) {                    \n                color.rgb = mix(uOutlineColor, uFogColor, fogFactor);\n            } else {\n                alpha = 1.0 - fogFactor;\n                color.rgb = mix(uOutlineColor, vec3(0.0), fogFactor);\n            }\n        }  \n\n        #ifdef dBlendTransparency            \n            if (hasTransparent) {\n                if (hasOpaque && outlineOpaqueDepth < outlineTransparentDepth) {\n                    blendTransparency = false;\n                } else {\n                    float finalOutlineAlpha = clamp(outlineAlpha * 2.0, 0.0, 1.0);\n                    float viewDist = abs(getViewZ(outlineTransparentDepth));\n                    float fogFactor = smoothstep(uFogNear, uFogFar, viewDist);\n                    float finalAlpha = max(transparentColor.a, finalOutlineAlpha * (1.0 - fogFactor));\n                    transparentColor.a = finalAlpha;\n                    transparentColor.rgb = uOutlineColor * finalAlpha;\n                }\n            }\n        #endif\n    #endif\n\n    #ifdef dBlendTransparency\n        if (blendTransparency) {\n            if (transparentColor.a != 0.0) {\n                // blending\n                color = transparentColor + color * (1.0 - transparentColor.a);\n                alpha = transparentColor.a + alpha * (1.0 - transparentColor.a);\n            }\n        }\n    #endif\n\n    gl_FragColor = vec4(color.rgb, alpha);\n}\n"),gt={...ee.du,tColor:(0,te.$G)("texture","rgba","ubyte","nearest"),uTexSize:(0,te.w5)("v2"),uWeight:(0,te.w5)("f")},yt=(0,ne.NG)("compose",oe.e,ae)
var vt=n(43901)
class bt{static ensureRequired(e,t,n){const r=new bt(e,t)
r.updateRequired(n),r.finalizeRequired(!0)}constructor(e,t){this.webgl=e,this.scene=t,this.required=[]}updateRequired(e){this.required.length=0,this.required.push("color"),ht.isEnabled(this.webgl,e.illumination)&&this.required.push("tracing"),Ue.isEnabled(e.marking)&&this.scene.markerAverage>0&&this.required.push("marking"),We.P.isEnabled(e.postprocessing)&&this.scene.emissiveAverage>0&&this.required.push("emissive"),!J.Pv.isTransparentDepthRequired(this.scene,e.postprocessing)&&this.webgl.extensions.drawBuffers&&this.webgl.extensions.depthTexture&&!ht.isEnabled(this.webgl,e.illumination)||this.required.push("depth"),this.webgl.resources.linkPrograms(this.required)}finalizeRequired(e){return this.finalize(this.required,e)}finalize(e,t){return this.webgl.resources.finalizePrograms(e,t)}}const xt={transparentBackground:p.t.Boolean(!1),dpoitIterations:p.t.Numeric(2,{min:1,max:10,step:1}),multiSample:p.t.Group(ue),postprocessing:p.t.Group(J.co),marking:p.t.Group(Ve),illumination:p.t.Group(pt),cameraHelper:p.t.Group(Ze.kf),renderer:p.t.Group(u.mO)}
class St{get colorTarget(){return this._colorTarget}get width(){return this._width}get height(){return this._height}constructor(e,t,n,r,i,o,a){this.webgl=e,this.renderer=n,this.scene=r,this.camera=i,this._width=0,this._height=0,this._camera=new I.i,this.props={...p.t.getDefaultValues(xt),...a},this.drawPass=new Ye(e,t,128,128,r.transparency),this.illuminationPass=new ht(e,this.drawPass),this.multiSamplePass=new de(e,this.drawPass),this.multiSampleHelper=new he(this.multiSamplePass),this.helper={camera:new Ze.WT(e,this.props.cameraHelper),debug:o.debug,handle:o.handle,pointer:o.pointer},this.setSize(1024,768)}getByteCount(){return this.drawPass.getByteCount()+this.illuminationPass.getByteCount()+this.multiSamplePass.getByteCount()}updateBackground(){return new Promise(e=>{this.drawPass.postprocessing.background.update(this.camera,this.props.postprocessing.background,()=>{e()})})}setSize(e,t){e===this._width&&t===this._height||(this._width=e,this._height=t,this.drawPass.setSize(e,t),this.illuminationPass.setSize(e,t),this.multiSamplePass.syncSize())}setProps(e={}){Object.assign(this.props,e),e.cameraHelper&&this.helper.camera.setProps(e.cameraHelper)}async render(e){this.drawPass.setTransparency(this.scene.transparency),bt.ensureRequired(this.webgl,this.scene,this.props),I.i.copySnapshot(this._camera.state,this.camera.state),d.LM.set(this._camera.viewport,0,0,this._width,this._height),this._camera.update()
const t={renderer:this.renderer,camera:this._camera,scene:this.scene,helper:this.helper}
if(this.illuminationPass.supported&&this.props.illumination.enabled){for(await e.update({message:"Tracing...",current:1,max:this.illuminationPass.getMaxIterations(this.props.illumination)}),this.illuminationPass.restart(!0);this.illuminationPass.shouldRender(this.props.illumination);)se.g$&&this.webgl.timer.mark("ImagePass.render",{captureStats:!0}),this.illuminationPass.render(t,this.props,!1),se.g$&&this.webgl.timer.markEnd("ImagePass.render"),e.shouldUpdate&&await e.update({current:this.illuminationPass.iteration}),await this.webgl.waitForGpuCommandsComplete()
this._colorTarget=this.illuminationPass.colorTarget}else se.g$&&this.webgl.timer.mark("ImagePass.render",{captureStats:!0}),de.isEnabled(this.props.multiSample)?(this.multiSampleHelper.render(t,this.props,!1),this._colorTarget=this.multiSamplePass.colorTarget):(this.drawPass.render(t,this.props,!1),this._colorTarget=this.drawPass.getColorTarget(this.props.postprocessing)),se.g$&&this.webgl.timer.markEnd("ImagePass.render")
if(se.g$){const e=this.webgl.timer.resolve()
if(e)for(const t of e)(0,vt.d)([t])}se.Bb&&console.log(`image pass byte count ${(this.getByteCount()/1024/1024).toFixed(3)} MiB`)}async getImageData(e,t,n,r){var i,o
this.setSize(t,n),await this.render(e),this.colorTarget.bind()
const a=null!==(i=null==r?void 0:r.width)&&void 0!==i?i:t,s=null!==(o=null==r?void 0:r.height)&&void 0!==o?o:n,l=new Uint8Array(a*s*4)
r?this.webgl.readPixels(r.x,n-r.y-r.height,a,s,l):this.webgl.readPixels(0,0,a,s,l)
const c=$e.create(l,a,s)
return $e.flipY(c),$e.divideByAlpha(c),new ImageData(new Uint8ClampedArray(l),a,s)}}var _t=n(96005),Ct=n(34761),wt=n(79111),Tt=n(40038),At=n(17684),It=n(67538)
const Pt={...k.e.Params,alpha:{...k.e.Params.alpha,defaultValue:1},ignoreLight:{...k.e.Params.ignoreLight,defaultValue:!0},colorX:p.t.Color(M.ColorNames.red,{isEssential:!0}),colorY:p.t.Color(M.ColorNames.green,{isEssential:!0}),colorZ:p.t.Color(M.ColorNames.blue,{isEssential:!0}),scale:p.t.Numeric(.33,{min:.1,max:2,step:.1},{isEssential:!0})},Bt={handle:p.t.MappedStatic("off",{on:p.t.Group(Pt),off:p.t.Group({})},{cycle:!0,description:"Show handle tool"})}
class Et{getBoundingSphere(e,t){return this.renderObject&&(D.f8.copy(e,this.renderObject.values.invariantBoundingSphere.ref.value),l.$I.fromArray(this._transform,this.renderObject.values.aTransform.ref.value,16*t),D.f8.transform(e,e,this._transform)),e}setProps(e){this.props=(0,Ct.j)(this.props,t=>{if(void 0!==e.handle&&(t.handle.name=e.handle.name,"on"===e.handle.name)){this.scene.clear(),this.pixelRatio=this.webgl.pixelRatio
const n={...e.handle.params,scale:e.handle.params.scale*this.webgl.pixelRatio,cellSize:0}
this.renderObject=function(e){const t=function(e){const t=10*e.scale,n=function(e){const t=B.P.createState(512,256,void 0),n=.05*e,r=l.eB.scale((0,l.eB)(),l.eB.unitX,e),i=l.eB.scale((0,l.eB)(),l.eB.unitY,e),o=l.eB.scale((0,l.eB)(),l.eB.unitZ,e),a={radiusTop:n,radiusBottom:n,radialSegments:32}
return t.currentGroup=kt.TranslateScreenXY,(0,E.X)(t,l.eB.origin,3*n,2),t.currentGroup=kt.TranslateObjectX,(0,E.X)(t,r,n,2),(0,_t.y9)(t,l.eB.origin,r,1,a),t.currentGroup=kt.TranslateObjectY,(0,E.X)(t,i,n,2),(0,_t.y9)(t,l.eB.origin,i,1,a),t.currentGroup=kt.TranslateObjectZ,(0,E.X)(t,o,n,2),(0,_t.y9)(t,l.eB.origin,o,1,a),B.P.getMesh(t)}(t)
return n.setBoundingSphere(D.f8.create(l.eB.create(t/2,t/2,t/2),t+t/4)),wt.y.create("handle",{},n,t=>{switch(t){case kt.TranslateObjectX:return e.colorX
case kt.TranslateObjectY:return e.colorY
case kt.TranslateObjectZ:return e.colorZ
default:return M.ColorNames.grey}},()=>1,()=>"")}(e)
return wt.y.createRenderObject(t,e)}(n),this.scene.add(this.renderObject),this.scene.commit(),t.handle.params={...e.handle.params}}})}get isEnabled(){return"on"===this.props.handle.name}update(e,t,n){this.renderObject&&(this.pixelRatio!==this.webgl.pixelRatio&&this.setProps(this.props),l.$I.setTranslation(this.renderObject.values.aTransform.ref.value,t),l.$I.fromMat3(this.renderObject.values.aTransform.ref.value,n),O.IQ.update(this.renderObject.values.aTransform,this.renderObject.values.aTransform.ref.value),this.scene.update([this.renderObject],!0))}getLoci(e){const{objectId:t,groupId:n,instanceId:r}=e
return this.renderObject&&t===this.renderObject.id?function(e,t,n){return(0,A.DataLoci)("handle",e,[{groupId:t,instanceId:n}],t=>e.getBoundingSphere(t,n),()=>`Handle Helper | Group Id ${t} | Instance Id ${n}`)}(this,n,r):A.EmptyLoci}mark(e,t){if(!Tt.sY.is(Tt.sY.Highlighting,t))return!1
if(!(0,A.isEveryLoci)(e)){if(!Dt(e))return!1
if(e.data!==this)return!1}return At.b.mark(this.renderObject,e,t,this.eachGroup)}constructor(e,t={}){this.webgl=e,this.props={handle:{name:"off",params:{}}},this.pixelRatio=1,this._transform=(0,l.$I)(),this.eachGroup=(e,t)=>{if(!this.renderObject)return!1
if(!Dt(e))return!1
let n=!1
const r=this.renderObject.values.uGroupCount.ref.value,{elements:i}=e
for(const{groupId:o,instanceId:a}of i){const e=a*r+o
t(It.IX.ofSingleton(e))&&(n=!0)}return n},this.scene=T.Z.create(e,"blended"),this.setProps(t)}}const kt={None:0,TranslateScreenXY:1,TranslateObjectX:3,TranslateObjectY:4,TranslateObjectZ:5}
function Dt(e){return"data-loci"===e.kind&&"handle"===e.tag}var Mt=n(99809)
const Rt={...k.e.Params,enabled:p.t.Select("off",p.t.arrayToOptions(["on","off"]),{isEssential:!0}),ignoreLight:{...k.e.Params.ignoreLight,defaultValue:!0},color:p.t.Color(M.ColorNames.grey,{isEssential:!0}),hitColor:p.t.Color(M.ColorNames.pink,{isEssential:!0})}
class Ot{setProps(e){Object.assign(this.props,e),this.isEnabled&&this.update(this.pointers,this.points,this.hit)}ensureEnabled(){"on"!==this.props.enabled&&(this.props.enabled="on")}get isEnabled(){return"on"===this.props.enabled}setCamera(e){I.i.copySnapshot(this.camera.state,e.state),d.LM.copy(this.camera.viewport,e.viewport),l.$I.copy(this.camera.view,e.view),l.$I.copy(this.camera.projection,e.projection),l.$I.copy(this.camera.projectionView,e.projectionView),l.$I.copy(this.camera.headRotation,e.headRotation),I.i.copyViewOffset(this.camera.viewOffset,e.viewOffset),this.camera.far=e.far,this.camera.near=e.near,this.camera.fogFar=e.fogFar,this.camera.fogNear=e.fogNear,this.camera.forceFull=e.forceFull,this.camera.scale=1,this.modelScale=e.scale}update(e,t,n){this.pointers=e,this.points=t,this.hit=n,"on"===this.props.enabled?(this.shape=zt(this.getData(),this.props,this.shape),O.IQ.updateIfChanged(this.renderObject.values.drawCount,L.V.getDrawCount(this.shape.geometry)),O.IQ.updateIfChanged(this.renderObject.values.uVertexCount,L.V.getVertexCount(this.shape.geometry)),O.IQ.updateIfChanged(this.renderObject.values.uGroupCount,2),k.e.Utils.updateBoundingSphere(this.renderObject.values,this.shape.geometry),k.e.Utils.updateValues(this.renderObject.values,this.props),k.e.Utils.updateRenderableState(this.renderObject.state,this.props),this.renderObject.state.visible=!0,this.scene.update(void 0,!1),this.scene.commit()):this.renderObject&&(this.renderObject.state.visible=!1)}getData(){return{pointers:this.pointers,points:this.points,hit:this.hit,modelScale:this.modelScale,camera:this.camera,pixels:12}}constructor(e,t={}){this.pixelScale=1,this.modelScale=1,this.pointers=[],this.points=[],this.hit=void 0,this.scene=T.Z.create(e,"blended"),this.props={...p.t.getDefaultValues(Rt),...t},this.camera=new I.i,this.shape=zt(this.getData(),this.props,this.shape),this.renderObject=function(e,t){return Mt.y.createRenderObject(e,{...p.t.getDefaultValues(k.e.Params),...t,ignoreLight:t.ignoreLight,cellSize:0})}(this.shape,this.props),this.scene.add(this.renderObject)}}var Lt
!function(e){e[e.None=0]="None",e[e.Hit=1]="Hit"}(Lt||(Lt={}))
const Nt=(0,l.eB)()
function Ft(e,t,n,r){const i=l.eB.scale(Nt,n.state.position,r),o=l.eB.distance(e,i)
return 2*Math.tan(n.state.fov/2)*o/n.viewport.height*t}function zt(e,t,n){const r=function(e,t){const n=B.P.createState(512,256,t),r=5e-4,i={radiusTop:r,radiusBottom:r,radialSegments:32},{modelScale:o,camera:a,pixels:s}=e
n.currentGroup=Lt.None
for(const l of e.pointers){(0,_t.Hb)(n,l,.2,i)
const e=Ft(l.origin,s,a,o);(0,E.X)(n,l.origin,e,1)}for(const l of e.points){const e=Ft(l,s,a,o);(0,E.X)(n,l,e,1)}if(e.hit){n.currentGroup=Lt.Hit
const t=Ft(e.hit,s,a,o);(0,E.X)(n,e.hit,t,1)}return B.P.getMesh(n)}(e,null==n?void 0:n.geometry)
return Mt.y.create("pointer-mesh",e,r,e=>e===Lt.Hit?t.hitColor:t.color,()=>1,()=>"",void 0,2)}const jt={debug:p.t.Group(N),camera:p.t.Group({helper:p.t.Group(Ze.kf)}),handle:p.t.Group(Bt),pointer:p.t.Group(Rt)},Vt=p.t.getDefaultValues(jt)
class Ut{constructor(e,t,n={}){const r={...Vt,...n}
this.debug=new F(e,t,r.debug),this.camera=new Ze.WT(e,r.camera.helper),this.handle=new Et(e,r.handle),this.pointer=new Ot(e,r.pointer)}}class Gt{constructor(e,t,n={}){this.webgl=e
const r=this.webgl.getDrawingBufferSize()
this.draw=new Ye(e,t,r.width,r.height,n.transparency||"blended"),this.pick=new ye(e,r.width,r.height,n.pickScale||.25),this.multiSample=new de(e,this.draw),this.illumination=new ht(e,this.draw)}getByteCount(){return this.draw.getByteCount()+this.pick.getByteCount()+this.multiSample.getByteCount()+this.illumination.getByteCount()}setPickScale(e){this.pick.setPickScale(e)}setTransparency(e){this.draw.setTransparency(e)}updateSize(){const e=this.webgl.getDrawingBufferSize(),t=Math.max(e.width,2),n=Math.max(e.height,2)
this.draw.setSize(t,n),this.pick.setSize(t,n),this.multiSample.syncSize(),this.illumination.setSize(t,n)}}var Ht=n(95538),qt=n(80813)
const Qt={...ee.du,tPreviousLevel:(0,te.$G)("texture","alpha","float","nearest"),uInvSize:(0,te.w5)("v2"),uOffset:(0,te.w5)("v2")},$t=(0,ne.NG)("hi-z",oe.e,"\nprecision highp float;\nprecision highp sampler2D;\n\nuniform sampler2D tPreviousLevel;\nuniform vec2 uInvSize;\nuniform vec2 uOffset;\n\nvoid main(void) {\n    vec2 position = gl_FragCoord.xy * uInvSize + uOffset;\n\n    float x = texture(tPreviousLevel, position).r;\n    float y = textureOffset(tPreviousLevel, position, ivec2(-1, 0)).r;\n    float z = textureOffset(tPreviousLevel, position, ivec2(-1, -1)).r;\n    float w = textureOffset(tPreviousLevel, position, ivec2(0, -1)).r;\n\n    gl_FragColor = vec4(max(max(x, y), max(z, w)));\n}\n")
var Xt=n(92219)
const Wt=_e.e.transformMat4,Yt=l.Zb.set,Zt=Xt.ey
function Kt(e,t,n,r){return-1===r[11]?function(e,t,n){return t*n/((n-t)*e-n)}(e,t,n):function(e,t,n){return e*(t-n)-t}(e,t,n)}const Jt={enabled:p.t.Boolean(!1,{description:"Hierarchical Z-buffer occlusion culling. Only available for WebGL2."}),maxFrameLag:p.t.Numeric(10,{min:1,max:30,step:1},{description:"Maximum number of frames to wait for Z-buffer data."}),minLevel:p.t.Numeric(3,{min:1,max:10,step:1})}
class en{getByteCount(){return this.supported?this.tex.getByteCount()+this.buf.getByteCount()+this.levelData.reduce((e,t)=>e+t.texture.getByteCount(),0):0}clear(){if(!this.supported)return
const{gl:e}=this.webgl;(0,me.C6)(e)&&(null!==this.sync&&(e.deleteSync(this.sync),this.sync=null),this.frameLag=0,this.ready=!1,this.debug&&(this.debug.rect.style.display="none",this.debug.container.style.display="none"))}render(e){if(!this.supported||!this.props.enabled)return
const{gl:t,state:n}=this.webgl
if(!(0,me.C6)(t)||null!==this.sync)return
this.nextNear=e.near,this.nextFar=e.far,l.$I.copy(this.nextView,e.view),l.$I.copy(this.nextProjection,e.projection),se.g$&&this.webgl.timer.mark("hi-Z"),n.disable(t.CULL_FACE),n.disable(t.BLEND),n.disable(t.DEPTH_TEST),n.disable(t.SCISSOR_TEST),n.depthMask(!1),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0)
const r=this.renderable.values,i=Math.pow(2,Math.ceil(Math.log(Math.max(t.drawingBufferWidth,t.drawingBufferHeight))/Math.log(2))-1)
for(let s=0,l=this.levelData.length;s<l;++s){const e=this.levelData[s]
e.framebuffer.bind(),s>0?(qt.IQ.update(r.uInvSize,e.invSize),qt.IQ.update(r.uOffset,Ke.Z.set(r.uOffset.ref.value,0,0)),qt.IQ.update(r.tPreviousLevel,this.levelData[s-1].texture)):(qt.IQ.update(r.uInvSize,Ke.Z.set(r.uInvSize.ref.value,1/i,1/i)),qt.IQ.update(r.uOffset,Ke.Z.set(r.uOffset.ref.value,this.viewport.x/t.drawingBufferWidth,this.viewport.y/t.drawingBufferHeight)),qt.IQ.update(r.tPreviousLevel,this.drawPass.depthTextureOpaque)),n.currentRenderItemId=-1,n.viewport(0,0,e.size[0],e.size[1]),t.clear(t.COLOR_BUFFER_BIT),this.renderable.update(),this.renderable.render(),s>=this.props.minLevel&&(this.tex.bind(0),t.copyTexSubImage2D(t.TEXTURE_2D,0,e.offset,0,0,0,e.size[0],e.size[1]),this.tex.unbind(0))}this.tex.attachFramebuffer(this.fb,0)
const o=this.tex.getWidth(),a=this.tex.getHeight()
this.buf.read(0,0,o,a),this.sync=t.fenceSync(t.SYNC_GPU_COMMANDS_COMPLETE,0),t.flush(),se.g$&&this.webgl.timer.markEnd("hi-Z")}tick(){if(!this.supported||!this.props.enabled||null===this.sync)return
const{gl:e}=this.webgl
if(!(0,me.C6)(e))return
const t=e.clientWaitSync(this.sync,0,0)
t===e.WAIT_FAILED||this.frameLag>=this.props.maxFrameLag?(e.deleteSync(this.sync),this.sync=null,this.frameLag=0,this.ready=!1):t===e.TIMEOUT_EXPIRED?this.frameLag+=1:(this.buf.getSubData(this.buffer),e.deleteSync(this.sync),this.sync=null,this.frameLag=0,this.ready=!0,this.near=this.nextNear,this.far=this.nextFar,l.$I.copy(this.view,this.nextView),l.$I.copy(this.projection,this.nextProjection))}transform(e){const{view:t,vp:n}=this
return Wt(n,e.center,t),{vp:n,r:1.2*e.radius+1.52}}project(e,t){const{projection:n,aabb:r,viewport:i}=this
!function(e,t,n,r){-1===r[11]?function(e,t,n,r){const i=t[0]*n,o=t[1]*n,a=t[2]*n,s=t[2]*t[2]-n*n,l=Math.sqrt(t[0]*t[0]+s),c=(l*t[0]-a)/(l*t[2]+i)*r[0],u=(l*t[0]+a)/(l*t[2]-i)*r[0],d=Math.sqrt(t[1]*t[1]+s),p=(d*t[1]-a)/(d*t[2]+o)*r[5],h=(d*t[1]+a)/(d*t[2]-o)*r[5]
Yt(e,-.5*u+.5,.5*p+.5,-.5*c+.5,.5*h+.5)}(e,t,n,r):function(e,t,n,r){const i=r[0],o=r[5],a=(t[0]+n)*i,s=(t[0]-n)*i,l=(t[1]+n)*o,c=(t[1]-n)*o
Yt(e,.5*s+.5,-.5*l+.5,.5*a+.5,-.5*c+.5)}(e,t,n,r)}(r,e,t,n)
const o=r[2]-r[0],a=r[3]-r[1],s=Math.max(o*i.width,a*i.height)
return{aabb:r,w:o,h:a,pr:s,lod:Math.ceil(Zt(s/2))}}setViewport(e,t,n,r){if(!this.supported)return
n=Math.max(n,2),r=Math.max(r,2),d.LM.set(this.viewport,e,t,n,r)
const i=Math.ceil(Math.log(Math.max(n,r))/Math.log(2))
if(i===this.levelData.length)return
const{minLevel:o}=this.props
this.buffer=new Float32Array(Math.pow(2,i-o)*Math.pow(2,i-1-o)),this.tex.define(Math.pow(2,i-o),Math.pow(2,i-1-o))
for(const s of this.levelData)s.framebuffer.destroy(),s.texture.destroy()
this.levelData.length=0
for(let s=0;s<i;++s){const e=this.webgl.resources.framebuffer(),t=Math.pow(2,i-s-1),n=Ke.Z.create(t,t),r=Ke.Z.create(1/t,1/t),o=this.webgl.resources.texture("image-float32","alpha","float","nearest")
o.define(t,t),o.attachFramebuffer(e,0),this.levelData.push({texture:o,framebuffer:e,size:n,invSize:r,offset:0})}let a=0
for(let s=0,l=i;s<l;++s){const e=this.levelData[s]
s>=o&&(this.levelData[s].offset=a,a+=e.size[0])}this.clear()}setProps(e){if(this.supported)if(this.props.minLevel!==e.minLevel){Object.assign(this.props,e)
const{x:t,y:n,width:r,height:i}=this.viewport
this.setViewport(t,n,r,i)}else Object.assign(this.props,e),this.props.enabled||this.clear()}initDebug(e){if(!e.parentElement)return
const t=document.createElement("div")
Object.assign(t.style,{display:"block",position:"absolute",pointerEvents:"none"}),e.parentElement.appendChild(t)
const n=document.createElement("canvas"),r=n.getContext("2d")
if(!r)throw new Error("Could not create canvas 2d context")
Object.assign(n.style,{width:"100%",height:"100%",imageRendering:"pixelated",position:"relative",pointerEvents:"none"}),t.appendChild(n)
const i=document.createElement("div")
Object.assign(i.style,{display:"none",position:"absolute",pointerEvents:"none"}),e.parentElement.appendChild(i),this.debug={container:t,canvas:n,ctx:r,rect:i}}canDebug(e){return this.supported&&this.props.enabled&&this.ready&&!!this.debug}showRect(e,t){if(!this.canDebug(this.debug))return
const{gl:{drawingBufferHeight:n},pixelRatio:r}=this.webgl,{viewport:{x:i,y:o,width:a,height:s}}=this,l=(e[0]*a+i)/r,c=(e[1]*s-o)/r,u=(e[2]*a+i)/r,d=(e[3]*s-o)/r,p=(n-s)/r
Object.assign(this.debug.rect.style,{border:t?"solid red":"solid green",display:"block",left:`${l}px`,top:`${c+p}px`,width:u-l+"px",height:d-c+"px"})}showBuffer(e){if(!this.canDebug(this.debug))return
if(e>=this.levelData.length||e<this.props.minLevel)return void(this.debug.container.style.display="none")
const{offset:t,size:[n,r]}=this.levelData[e],i=this.tex.getWidth(),o=new Uint8ClampedArray(n*r*4)
o.fill(255)
for(let p=0;p<r;++p)for(let e=0;e<n;++e){const a=(r-p-1)*n+e,s=255*this.buffer[p*i+e+t]
o[4*a+0]=s,o[4*a+3]=255-s}const a=new ImageData(o,n,r)
this.debug.canvas.width=a.width,this.debug.canvas.height=a.height,this.debug.ctx.putImageData(a,0,0)
const{viewport:{x:s,y:l,width:c,height:u},webgl:{pixelRatio:d}}=this
Object.assign(this.debug.container.style,{display:"block",bottom:l/d+"px",left:s/d+"px",width:c/d+"px",height:u/d+"px"})}debugOcclusion(e){if(!this.canDebug(this.debug))return
if(!e)return this.debug.rect.style.display="none",void(this.debug.container.style.display="none")
const t=this.isOccluded(e),{vp:n,r:r}=this.transform(e),{aabb:i,lod:o}=this.project(n,r)
this.showRect(i,t),this.showBuffer(o)}reset(){this.sync=null,this.ready=!1,this.frameLag=0,this.levelData.length=0
const{x:e,y:t,width:n,height:r}=this.viewport
this.setViewport(e,t,n,r)}dispose(){if(this.supported){this.clear(),this.fb.destroy(),this.tex.destroy(),this.buf.destroy(),this.renderable.dispose()
for(const e of this.levelData)e.framebuffer.destroy(),e.texture.destroy()}}constructor(e,t,n,r){this.webgl=e,this.drawPass=t,this.viewport=(0,d.LM)(),this.near=0,this.far=0,this.view=(0,l.$I)(),this.projection=(0,l.$I)(),this.nextNear=0,this.nextFar=0,this.nextView=(0,l.$I)(),this.nextProjection=(0,l.$I)(),this.aabb=(0,l.Zb)(),this.vp=(0,_e.e)(),this.levelData=[],this.sync=null,this.buffer=new Float32Array(0),this.frameLag=0,this.ready=!1,this.isOccluded=e=>{if(!this.supported||!this.props.enabled||!this.ready)return!1
const{vp:t,r:n}=this.transform(e),{near:r,far:i,projection:o}=this,a=t[2]+n
if(-a<r)return!1
const{aabb:s,w:l,h:c,lod:u}=this.project(t,n)
if(u>=this.levelData.length||u<this.props.minLevel)return!1
const{offset:d,size:p}=this.levelData[u],h=s[0]+l/2,f=s[1]+c/2,m=p[0],g=h*m,y=f*m,v=Math.floor(g),b=Math.ceil(y),x=this.tex.getWidth()
if(v+1>=m||b+1>=m)return!1
const S=(m-b-1)*x+v+d
if(a>Kt(this.buffer[S],r,i,o))return!1
if(a>Kt(this.buffer[S+1],r,i,o))return!1
const _=(m-b+1-1)*x+v+d
return!(a>Kt(this.buffer[_],r,i,o)||a>Kt(this.buffer[_+1],r,i,o))},this.props={...p.t.getDefaultValues(Jt),...r}
const{gl:i,extensions:o}=e
if(!(0,me.C6)(i)||!o.colorBufferFloat)return se.Bb&&console.log('Missing webgl2 and/or colorBufferFloat support required for "Hi-Z"'),void(this.supported=!1)
this.fb=e.resources.framebuffer(),this.tex=e.resources.texture("image-float32","alpha","float","nearest"),this.tex.attachFramebuffer(this.fb,0)
const a=i.getParameter(i.IMPLEMENTATION_COLOR_READ_FORMAT),s=i.getParameter(i.IMPLEMENTATION_COLOR_READ_TYPE)
if(a!==i.RED||s!==i.FLOAT)return se.Bb&&console.log('Missing red/float reading support required for "Hi-Z"'),void(this.supported=!1)
this.supported=!0,this.buf=e.resources.pixelPack("alpha","float"),this.renderable=function(e,t){const n={...ee.OM,tPreviousLevel:qt.IQ.create(t),uInvSize:qt.IQ.create((0,Ke.Z)()),uOffset:qt.IQ.create((0,Ke.Z)())},r={...Qt},i=(0,re.$h)(e,"triangles",$t,r,n)
return(0,ie._)(i,n)}(e,this.drawPass.depthTextureOpaque),se.Bb&&n&&this.initDebug(n)}}var tn=n(72169),nn=n(6539),rn=n(87958)
const on=c.qt,an=f.O.Trigger,sn=f.O.TriggerKey
function ln(e,t){const n=_e.e.fromObj(e.transform.position),r=et.$.fromArray((0,et.$)(),e.transform.matrix,0),i=et.$.getDecomposition(r),o=et.$.fromQuat((0,et.$)(),i.quaternion),a=_e.e.transformMat4((0,_e.e)(),_e.e.negUnitZ,o),s=$.U.create(n,a)
return t&&$.U.transform(s,s,et.$.invert((0,et.$)(),t)),s}const cn={bindings:{exit:(0,f.O)([sn("GamepadB")]),togglePassthrough:(0,f.O)([sn("GamepadA")]),gestureScale:(0,f.O)([an(on.Flag.Trigger)])}},un={minTargetDistance:p.t.Numeric(.4,{min:.001,max:1,step:.001}),disablePostprocessing:p.t.Boolean(!0),resolutionScale:p.t.Numeric(1,{min:.1,max:2,step:.1}),sceneRadiusInMeters:p.t.Numeric(.25,{min:.01,max:2,step:.01},{description:"The radius of the scene bounding sphere in meters, used to set the initial camera scale."})}
class dn{get session(){return this.xrSession}setProps(e){Object.assign(this.props,e)}setAttribs(e){Object.assign(this.attribs,e)}intersect(e,t,n,r){const i=(0,_e.e)(),o=ln(r,t)
if(rn.i.intersectRay3D(i,n,o)){const{height:t}=e.viewport,n=(0,d.$u)((0,tt.Z)(),i,e.viewport,e.projectionView)
return{point:i,screen:Ke.Z.create(Math.floor(n[0]),t-Math.floor(n[1]))}}}setScaleFactor(e){this.scaleFactor=e}resetScale(){this.scaleFactor=1,this.prevScale=0}update(e){var t,n,r,i,o,a,s
const{xrSession:l,xrRefSpace:u,input:d,camera:p,stereoCamera:h,pointerHelper:f}=this
if(!e||!l||!u)return!1
p.scale=p.scale*this.scaleFactor,this.prevScale=p.scale
const m=_e.e.sub((0,_e.e)(),p.position,p.target)
_e.e.scaleAndAdd(p.position,p.position,m,1-this.scaleFactor),this.scaleFactor=1
const g=function(e){const t=et.$.getDecomposition(e)
return new XRRigidTransform(_e.e.toObj(t.position),nn.k.toObj(t.quaternion))}(p.view),y=u.getOffsetReferenceSpace(g),v=e.getViewerPose(y)
if(!v)return!1
const b=e.getViewerPose(u)
if(b){const e=nn.k.fromObj(b.transform.orientation)
et.$.fromQuat(p.headRotation,e)}const{depthFar:x,depthNear:S,baseLayer:_}=l.renderState
if(!_)return!1
x===p.far&&S===p.near||l.updateRenderState({depthNear:p.near,depthFar:p.far}),h.update({pose:v,layer:_})
const C=h.left,w=_e.e.scale((0,_e.e)(),C.state.target,C.scale),T=et.$.getTranslation((0,_e.e)(),et.$.invert((0,et.$)(),C.view)),A=_e.e.sub((0,_e.e)(),T,w),I=rn.i.fromNormalAndCoplanarPoint((0,rn.i)(),A,w),P=[],B=[],E=[],k=[]
if(l.inputSources)for(const M of l.inputSources){if("screen"===M.targetRayMode){if(M.gamepad){const{axes:e}=M.gamepad,{width:t,height:n}=C.viewport,r=(e[0]+1)/2*t,i=(e[1]+1)/2*n,o=C.getRay((0,$.U)(),r,n-i)
k.push({x:r,y:i,ray:o})}continue}if("tracked-pointer"!==M.targetRayMode)continue
const{handedness:l,targetRaySpace:d,gamepad:h}=M
if(!l)continue
const f=e.getPose(d,u)
if(!f)continue
const m=ln(f,p.view)
P.push(m)
const g=D.f8.scaleNX((0,D.f8)(),this.scene.boundingSphereVisible,C.scale),y=(0,_e.e)()
$.U.intersectSphere3D(y,m,g)&&B.push(y)
let v=c.qt.create(c.qt.Flag.None);(null===(t=null==h?void 0:h.buttons[0])||void 0===t?void 0:t.pressed)&&(v|=c.qt.Flag.Primary),(null===(n=null==h?void 0:h.buttons[1])||void 0===n?void 0:n.pressed)&&(v|=c.qt.Flag.Secondary),(null===(r=null==h?void 0:h.buttons[3])||void 0===r?void 0:r.pressed)&&(v|=c.qt.Flag.Auxilary),(null===(i=null==h?void 0:h.buttons[4])||void 0===i?void 0:i.pressed)&&(v|=c.qt.Flag.Forth),(null===(o=null==h?void 0:h.buttons[5])||void 0===o?void 0:o.pressed)&&(v|=c.qt.Flag.Five)
const b="left"===l?this.prevInput.left:this.prevInput.right,x=this.intersect(C,p.view,I,f),S=b?this.intersect(C,p.view,I,b.targetRayPose):void 0,[_,w]=null!==(a=null==x?void 0:x.screen)&&void 0!==a?a:[0,0],[T,A]=null!==(s=null==S?void 0:S.screen)&&void 0!==s?s:[_,w],R=Ke.Z.set((0,Ke.Z)(),_-T,w-A)
Ke.Z.setMagnitude(R,R,Math.min(100,Ke.Z.magnitude(R)))
const[O,L]=Ke.Z.round(R,R)
E.push({handedness:l,buttons:v,x:_,y:w,dx:O,dy:L,ray:m,axes:null==h?void 0:h.axes}),"left"===l?this.prevInput.left={targetRayPose:f}:this.prevInput.right={targetRayPose:f}}else this.prevInput.left=void 0,this.prevInput.right=void 0
return d.updateTrackedPointers(E),d.updateScreenTouches(k),f.ensureEnabled(),f.update(P,B,this.hit),!0}async setSession(e){if(this.xrSession!==e)if(await this.webgl.xr.set(e,{resolutionScale:this.props.resolutionScale}),this.xrSession=this.webgl.xr.session,this.prevInput={},this.hit=void 0,this.xrSession){this.xrRefSpace=await this.xrSession.requestReferenceSpace("local"),this.pointerHelper.setProps({enabled:"on"})
let e=this.prevScale
if(0===e){const{radius:t}=this.scene.boundingSphereVisible
e=t?1/t*this.props.sceneRadiusInMeters:.01}this.camera.forceFull=!0,this.camera.scale=e,this.camera.minTargetDistance=this.props.minTargetDistance,this.prevScale=e}else this.xrRefSpace=void 0,et.$.setZero(this.camera.headRotation),this.pointerHelper.setProps({enabled:"off"}),this.camera.forceFull=!1,this.camera.scale=1,this.camera.minTargetDistance=0}async end(){await this.webgl.xr.end()}async request(){if(!navigator.xr)return
const e=await navigator.xr.isSessionSupported("immersive-ar")?await navigator.xr.requestSession("immersive-ar"):await navigator.xr.requestSession("immersive-vr")
await this.setSession(e)}dispose(){var e
this.hoverSub.unsubscribe(),this.keyUpSub.unsubscribe(),this.gestureSub.unsubscribe(),this.sessionChangedSub.unsubscribe(),this.togglePassthrough.complete(),this.sessionChanged.complete(),this.isSupported.complete(),null===(e=navigator.xr)||void 0===e||e.removeEventListener("devicechange",this.checkSupported)}constructor(e,t,n,o,a,s,l,c={},u={}){var d
this.webgl=e,this.input=t,this.scene=n,this.camera=o,this.stereoCamera=a,this.pointerHelper=s,this.interactionHelper=l,this.togglePassthrough=new r.B,this.sessionChanged=new r.B,this.isSupported=new i.t(!1),this.xrSession=void 0,this.xrRefSpace=void 0,this.scaleFactor=1,this.prevScale=0,this.prevInput={},this.hit=void 0,this.checkSupported=async()=>{if(!navigator.xr)return!1
const[e,t]=await Promise.all([navigator.xr.isSessionSupported("immersive-ar"),navigator.xr.isSessionSupported("immersive-vr")])
this.isSupported.next(e||t)},this.props={...p.t.getDefaultValues(un),...c},this.attribs={...cn,...u},this.hoverSub=this.interactionHelper.events.hover.subscribe(({position:e})=>{this.hit=e}),this.sessionChangedSub=e.xr.changed.subscribe(async()=>{await this.setSession(e.xr.session),this.sessionChanged.next()}),this.checkSupported(),null===(d=navigator.xr)||void 0===d||d.addEventListener("devicechange",this.checkSupported),this.keyUpSub=t.keyUp.subscribe(({code:e,modifiers:t,key:n})=>{const r=this.attribs.bindings
f.O.matchKey(r.exit,e,t,n)&&this.end(),f.O.matchKey(r.togglePassthrough,e,t,n)&&this.togglePassthrough.next()}),this.gestureSub=t.gesture.subscribe(({scale:e,button:t,modifiers:n})=>{const r=this.attribs.bindings
f.O.match(r.gestureScale,t,n)&&this.setScaleFactor(e)})}}var pn=n(63317)
class hn{setPickPadding(e){this.pickPadding!==e&&(this.pickPadding=e,this.update())}update(){const e=2*this.pickPadding+1
d.LM.set(this.viewport,0,0,e,e),this.buffers.setViewport(0,0,e,e),this.spiral=(0,h.k4)(this.pickPadding),this.size=e,this.pickPass.setSize(e,e)}render(e){se.g$&&this.webgl.timer.mark("RayHelper.render",{captureStats:!0})
const{renderer:t,scene:n,helper:r}=this
t.setTransparentBackground(!1),t.setDrawingBufferSize(this.size,this.size),t.setPixelRatio(1),t.setViewport(0,0,this.size,this.size),this.pickPass.render(t,e,n,r),se.g$&&this.webgl.timer.markEnd("RayHelper.render")}identifyInternal(e,t){if(this.webgl.isContextLost)return
const{viewport:n}=this,r=this.buffers.getPickingId(e,t)
if(void 0===r)return
const i=this.buffers.getDepth(e,t),o=l.eB.create(e,t,i)
return(0,d.IW)(o,o,n,this.camera.inverseProjectionView),{id:r,position:o}}prepare(e,t){this.camera.far=t.far,this.camera.near=t.near,this.camera.fogFar=t.fogFar,this.camera.fogNear=t.fogNear,this.camera.forceFull=t.forceFull,this.camera.scale=t.scale,d.LM.copy(this.camera.viewport,this.viewport),I.i.copySnapshot(this.camera.state,{...t.state,mode:"orthographic"}),function(e,t,n){const{near:r,far:i,viewport:o}=e,a=2*Math.tan((0,h.pu)(.1)/2)*l.eB.distance(e.position,e.target)*e.scale,s=o.height/a,c=-o.width/2,u=o.width/2,d=o.height/2,p=-o.height/2,f=(u-c)/(2*s),m=(d-p)/(2*s),g=(u+c)/2,y=(d+p)/2,v=g-f,b=g+f,x=y+m,S=y-m
l.$I.ortho(e.projection,v,b,x,S,r,i)
const _=l.eB.normalize((0,l.eB)(),t.direction),C=l.k.fromUnitVec3((0,l.k)(),_,l.eB.negUnitZ)
l.k.invert(C,C)
const w=l.eB.clone(t.origin),T=l.eB.add((0,l.eB)(),w,_)
l.$I.lookAt(e.view,w,T,n)}(this.camera,e,t.up),l.$I.mul(this.camera.projectionView,this.camera.projection,this.camera.view),l.$I.tryInvert(this.camera.inverseProjectionView,this.camera.projectionView),l.$I.copy(this.camera.viewEye,t.view)}getPickData(){const e=this.pickPadding
for(const t of this.spiral){const n=this.identifyInternal(e+t[0],e+t[1])
if(n)return n}}intersectsScene(e,t){return pn.f.scaleNX(this.sphere,this.scene.boundingSphereVisible,t),$.U.isInsideSphere3D(e,this.sphere)||$.U.isIntersectingSphere3D(e,this.sphere)}identify(e,t){if(this.intersectsScene(e,t.scale))return this.prepare(e,t),se.g$&&this.webgl.timer.mark("RayHelper.identify"),this.render(this.camera),this.buffers.read(),se.g$&&this.webgl.timer.markEnd("RayHelper.identify"),this.getPickData()}asyncIdentify(e,t){if(this.intersectsScene(e,t.scale))return this.prepare(e,t),se.g$&&this.webgl.timer.mark("RayHelper.asyncIdentify"),this.render(this.camera),this.buffers.asyncRead(),se.g$&&this.webgl.timer.markEnd("RayHelper.asyncIdentify"),{tryGet:()=>{const e=this.buffers.check()
return e===xe.Resolved?this.getPickData():e===xe.Pending?"pending":void 0}}}reset(){this.buffers.reset(),this.pickPass.reset()}dispose(){this.buffers.dispose(),this.pickPass.dispose()}constructor(e,t,n,r,i){this.webgl=e,this.renderer=t,this.scene=n,this.helper=r,this.viewport=(0,d.LM)(),this.sphere=(0,pn.f)()
const o=2*i.pickPadding+1
this.camera=new I.i,this.pickPass=new ye(e,o,o,1),this.buffers=new Se(this.webgl,this.pickPass,i.maxAsyncReadLag),this.pickPadding=i.pickPadding,this.update(),be(e)||(this.asyncIdentify=(e,t)=>({tryGet:()=>this.identify(e,t)}))}}var fn=n(69396)
const mn={intensity:p.t.Numeric(15,{min:1,max:100,step:1})},gn={camera:p.t.Group({mode:p.t.Select("perspective",p.t.arrayToOptions(["perspective","orthographic"]),{label:"Camera"}),helper:p.t.Group(Ze.kf,{isFlat:!0}),stereo:p.t.MappedStatic("off",{on:p.t.Group(Ce),off:p.t.Group({})},{cycle:!0,hideIf:e=>"perspective"!==(null==e?void 0:e.mode)}),fov:p.t.Numeric(45,{min:10,max:130,step:1},{label:"Field of View"}),manualReset:p.t.Boolean(!1,{isHidden:!0})},{pivot:"mode"}),cameraFog:p.t.MappedStatic("on",{on:p.t.Group(mn),off:p.t.Group({})},{cycle:!0,description:"Show fog in the distance"}),cameraClipping:p.t.Group({radius:p.t.Numeric(100,{min:0,max:99,step:1},{label:"Clipping",description:"How much of the scene to show."}),far:p.t.Boolean(!0,{description:"Hide scene in the distance"}),minNear:p.t.Numeric(1,{min:.1,max:100,step:.1},{description:"Minimal allowed distance of near clipping plane from the camera. Note, may cause performance issues rendering impostors when set too small and cause issues with outline rendering when too close to 0."})},{pivot:"radius"}),viewport:p.t.MappedStatic("canvas",{canvas:p.t.Group({}),"static-frame":p.t.Group({x:p.t.Numeric(0),y:p.t.Numeric(0),width:p.t.Numeric(128),height:p.t.Numeric(128)}),"relative-frame":p.t.Group({x:p.t.Numeric(.33,{min:0,max:1,step:.01}),y:p.t.Numeric(.33,{min:0,max:1,step:.01}),width:p.t.Numeric(.5,{min:.01,max:1,step:.01}),height:p.t.Numeric(.5,{min:.01,max:1,step:.01})})}),cameraResetDurationMs:p.t.Numeric(250,{min:0,max:1e3,step:1},{description:"The time it takes to reset the camera."}),sceneRadiusFactor:p.t.Numeric(1,{min:1,max:10,step:.1}),transparentBackground:p.t.Boolean(!1),checkeredTransparentBackground:p.t.Boolean(!1),dpoitIterations:p.t.Numeric(2,{min:1,max:10,step:1}),pickPadding:p.t.Numeric(3,{min:0,max:10,step:1},{description:"Extra pixels to around target to check in case target is empty."}),userInteractionReleaseMs:p.t.Numeric(250,{min:0,max:1e3,step:1},{description:"The time before the user is not considered interacting anymore."}),multiSample:p.t.Group(ue),postprocessing:p.t.Group(J.co),marking:p.t.Group(Ve),illumination:p.t.Group(pt),hiZ:p.t.Group(Jt),renderer:p.t.Group(u.mO),trackball:p.t.Group(x),interaction:p.t.Group(Z),debug:p.t.Group(N),handle:p.t.Group(Bt),pointer:p.t.Group(Rt),xr:p.t.Group(un,{label:"XR"})},yn=p.t.getDefaultValues(gn),vn={trackball:S,xr:cn}
var bn
!function(e){e.DefaultAttribs={powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,antialias:!0,preserveDrawingBuffer:!0,preferWebGl1:!1,handleResize:()=>{}},e.Params={resolutionMode:p.t.Select("auto",p.t.arrayToOptions(["auto","scaled","native"])),pixelScale:p.t.Numeric(1,{min:.1,max:2,step:.05}),pickScale:p.t.Numeric(.25,{min:.1,max:1,step:.05}),transparency:p.t.Select("wboit",[["blended","Blended"],["wboit","Weighted, Blended"],["dpoit","Depth Peeling"]])},e.DefaultProps=p.t.getDefaultValues(e.Params),e.fromCanvas=function(t,n,o={},a={}){const l={...e.DefaultAttribs,...o},u={...e.DefaultProps,...a},{powerPreference:d,failIfMajorPerformanceCaveat:p,antialias:h,preserveDrawingBuffer:f,preferWebGl1:m}=l,g=(0,C.$i)(t,{powerPreference:d,failIfMajorPerformanceCaveat:p,antialias:h,preserveDrawingBuffer:f,alpha:!0,depth:!0,premultipliedAlpha:!0,preferWebGl1:m})
if(null===g)throw new Error("Could not create a WebGL rendering context")
const y=()=>{const e=u.pixelScale/("undefined"!=typeof window&&(null===window||void 0===window?void 0:window.devicePixelRatio)||1)
return"auto"===u.resolutionMode?(0,tn.rr)()?e:u.pixelScale:"native"===u.resolutionMode?u.pixelScale:e},v=()=>{const e=y()
_.setPixelScale(e),w.setPixelScale(e)},{pickScale:b,transparency:x}=u,S=y(),_=c.bP.fromElement(t,{pixelScale:S,preventGestures:!0}),w=(0,C.q6)(g,{pixelScale:S}),T=new Gt(w,n,{pickScale:b,transparency:x})
if(se.Bb){const e=g.getExtension("WEBGL_lose_context")
e&&t.addEventListener("mousedown",t=>{w.isContextLost||t.shiftKey&&t.ctrlKey&&t.altKey&&(se.Bb&&console.log("lose context"),e.loseContext(),setTimeout(()=>{w.isContextLost&&(se.Bb&&console.log("restore context"),e.restoreContext())},1e3))},!1)}const A=new r.B,I=e=>{w.setContextLost(),e.preventDefault(),se.Bb&&console.log("context lost"),A.next((0,s.t)())},P=()=>{w.isContextLost&&(w.handleContextRestored(()=>{T.draw.reset(),T.pick.reset(),T.illumination.reset()}),se.Bb&&console.log("context restored"))}
t.addEventListener("webglcontextlost",I,!1),t.addEventListener("webglcontextrestored",P,!1)
const B=new i.t(void 0)
return{canvas:t,webgl:w,input:_,passes:T,attribs:l,get props(){return{...u}},contextLost:A,contextRestored:w.contextRestored,assetManager:n,changed:B,get pixelScale(){return y()},syncPixelScale:v,setProps:e=>{if(!e)return
let t=!1,n=!1
void 0!==e.resolutionMode&&e.resolutionMode!==u.resolutionMode&&(u.resolutionMode=e.resolutionMode,n=!0),void 0!==e.pixelScale&&e.pixelScale!==u.pixelScale&&(u.pixelScale=e.pixelScale,n=!0),n&&(v(),l.handleResize(),t=!0),void 0!==e.pickScale&&e.pickScale!==u.pickScale&&(u.pickScale=e.pickScale,T.setPickScale(e.pickScale),t=!0),void 0!==e.transparency&&e.transparency!==u.transparency&&(u.transparency=e.transparency,T.setTransparency(e.transparency),t=!0),t&&B.next(void 0)},dispose:e=>{_.dispose(),t.removeEventListener("webglcontextlost",I,!1),t.removeEventListener("webglcontextrestored",P,!1),w.destroy(e),A.complete(),B.complete()}}}}(bn||(bn={}))
const xn="undefined"!=typeof window?window.requestAnimationFrame:e=>setImmediate(()=>e(Date.now())),Sn="undefined"!=typeof window?window.cancelAnimationFrame:e=>clearImmediate(e)
function _n(e,t){t.transparentBackground&&t.checkeredTransparentBackground?Object.assign(e.style,{"background-image":"linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%, lightgrey), linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%, lightgrey)","background-size":"60px 60px","background-position":"0 0, 30px 30px"}):Object.assign(e.style,{"background-image":"","background-size":"","background-position":""})}var Cn
!function(e){e.create=function(e,t={},n={}){var c,p
const{webgl:f,input:m,passes:g,assetManager:y,canvas:v,contextLost:b}=e,x={...(0,Ht.Go)(yn),...(0,Ht.Go)(t)},S={...(0,Ht.Go)(vn),...(0,Ht.Go)(n)},C=new Map,P=new Map,B=new i.t(0),E=new r.B
let k=(0,s.t)()
const M=new i.t(0),R=new i.t(0),L=new i.t(0),{contextRestored:N}=f
let F=0,z=0,j=128,V=128,U=!1,G=0
_n(v,x),tt()
const q=T.Z.create(f,g.draw.transparency,{dColorMarker:x.renderer.colorMarker,dLightCount:null===(c=x.renderer.light)||void 0===c?void 0:c.length})
function Q(){return q.boundingSphere.radius*x.sceneRadiusFactor}const $=new I.i({position:l.eB.create(0,0,100),mode:x.camera.mode,fog:"on"===x.cameraFog.name?x.cameraFog.params.intensity:0,clipFar:x.cameraClipping.far,minNear:x.cameraClipping.minNear,fov:(0,h.pu)(x.camera.fov)},{x:F,y:z,width:j,height:V}),X=new Te($,x.camera.stereo.params),W=_.create(m,$,q,x.trackball,S.trackball),Y=new Ut(f,q,x),Z=new en(f,g.draw,v,x.hiZ),J=u.A4.create(f,x.renderer)
J.setOcclusionTest(Z.isOccluded)
const ee=new bt(f,q)
ee.updateRequired(x)
const te={pickPadding:x.pickPadding,maxAsyncReadLag:5},ne=new ke(f,J,q,Y,g.pick,{x:F,y:z,width:j,height:V},te),re=new hn(f,J,q,Y,te),ie=new K(ze,je,Se,m,$,W,x.interaction),oe=new he(g.multiSample)
g.draw.postprocessing.background.update($,x.postprocessing.background,e=>{e&&Ee()})
let ae,le,ce=!1,ue=!1
function pe(){return{transparency:e.props.transparency,transparentBackground:x.transparentBackground,hiZ:Z.props.enabled,postprocessing:x.postprocessing.enabled,axes:(0,Ht.Go)(Y.camera.props.axes)}}const fe=pe()
function me(){var t
x.postprocessing.enabled=!ge.props.disablePostprocessing,e.setProps({transparency:"blended"}),Z.setProps({enabled:!1}),Y.camera.setProps({axes:{name:"off",params:{}}}),"alpha-blend"===(null===(t=ge.session)||void 0===t?void 0:t.environmentBlendMode)&&(x.transparentBackground=ve)}const ge=new dn(f,m,q,$,X,Y.pointer,ie,x.xr,S.xr),ye={request:async()=>{try{await ge.request()}catch(e){console.error(e),ye.requestFailed.next(e)}},end:()=>ge.end(),isSupported:new i.t(!1),isPresenting:new i.t(!1),requestFailed:new r.B}
let ve=!1
const be=[ge.isSupported.subscribe(e=>ye.isSupported.next(e)),ge.togglePassthrough.subscribe(()=>{var e
"alpha-blend"===(null===(e=ge.session)||void 0===e?void 0:e.environmentBlendMode)&&(ve=!x.transparentBackground)}),ge.sessionChanged.subscribe(()=>{var t
we=null,ue=!0,ge.session?(Object.assign(fe,pe()),ve="alpha-blend"===(null===(t=ge.session)||void 0===t?void 0:t.environmentBlendMode),me()):(x.postprocessing.enabled=fe.postprocessing,x.transparentBackground=fe.transparentBackground,e.setProps({transparency:fe.transparency}),Z.setProps({enabled:fe.hiZ}),Y.camera.setProps({axes:fe.axes})),Fe(),ye.isPresenting.next(!!ge.session)})]
let xe=!0
function Se(e){let t=A.EmptyLoci,n=w.YL.Empty
if(e){const r=Y.camera.getLoci(e)
if(r!==A.EmptyLoci)return{loci:r,repr:n}
t=Y.handle.getLoci(e),C.forEach((r,i)=>{const o=i.getLoci(e);(0,A.isEmptyLoci)(o)||((0,A.isEmptyLoci)(t)||console.warn("found another loci, this should not happen"),t=o,n=i)})}return{loci:t,repr:n}}let _e=[]
function Ce(e,t){const{repr:n,loci:r}=e
let i=!1
return n?i=n.mark(r,t)||i:C.forEach((e,n)=>{i=n.mark(r,t)||i}),i=Y.handle.mark(r,t)||i,i=Y.camera.mark(r,t)||i,i}let we=null,Ae=!1,Ie=!1,Pe=!1
function Be(e){Ie||Pe||(ee.finalizeRequired(null==e?void 0:e.isSynchronous)?function(e,t){if(f.isContextLost)return!1
if(f.xr.session&&!t)return!1
let n=!1
ue&&(Ye(!1),ue=!1,n=!0)
const r=f.getDrawingBufferSize()
if(F>r.width||F+j<0||z>r.height||z+V<0)return!1
if(null!==we&&!t){if(!f.checkSyncStatus(we))return!1
we=null}t&&(me(),x.transparentBackground=ve)
const i=function(){let e=!1
for(const[t,n]of _e)e=Ce(t,n)||e
return _e=[],e&&(q.update(void 0,!0),Y.handle.scene.update(void 0,!0),Y.camera.scene.update(void 0,!0),ee.updateRequired(x),ee.finalizeRequired(!0),E.next()),e}()&&(J.props.colorMarker||x.marking.enabled)
let o=!1
W.update(G)
const a=$.update(),s=ge.update(t)
if(!s&&t)return!1
const l=e||a||n||U||s
if(U=!1,g.illumination.supported&&x.illumination.enabled&&!t){if((l||i)&&(J.setOcclusionTest(null),g.illumination.restart()),g.illumination.shouldRender(x.illumination)&&(!Je&&q.count>0||0===g.illumination.iteration||0===x.userInteractionReleaseMs)){se.g$&&f.timer.mark("Canvas3D.render",{captureStats:!0})
const e={renderer:J,camera:$,scene:q,helper:Y}
g.illumination.render(e,x,!0),se.g$&&f.timer.markEnd("Canvas3D.render"),ne.dirty=ne.dirty||l,o=!0}}else{const e=oe.update(i||l,x.multiSample)&&!t
if(l||e||i){J.setOcclusionTest(Z.isOccluded)
let e=$;("on"===x.camera.stereo.name||s)&&(s||X.update(),e=X),se.g$&&f.timer.mark("Canvas3D.render",{captureStats:!0})
const n={renderer:J,camera:e,scene:q,helper:Y}
if(de.isEnabled(x.multiSample)&&!t){const e=x.multiSample.reduceFlicker&&!a&&i&&!W.isAnimating
oe.render(n,x,!0,e)}else g.draw.render(n,x,!0)
Z.render($),se.g$&&f.timer.markEnd("Canvas3D.render"),ne.dirty=ne.dirty||l,o=!0}}return o&&!t&&(we=f.getFenceSync()),o}(!!(null==e?void 0:e.force),null==e?void 0:e.xrFrame)&&xe&&M.next((0,s.t)()-k):U=!0)}function Ee(){U=!0}let De,Me=0
function Re(e,t){Pe||f.xr.session&&!(null==t?void 0:t.xrFrame)||(G=e,Ve(null==t?void 0:t.isSynchronous),(null==t?void 0:t.updateControls)&&W.update(G),$.transition.tick(G),Z.tick(),(null==t?void 0:t.manualDraw)||(Be({isSynchronous:null==t?void 0:t.isSynchronous,xrFrame:null==t?void 0:t.xrFrame}),$.transition.inTransition||f.isContextLost||ie.tick(G)))}function Oe(e){return De=e,f.xr.session?f.xr.session.requestAnimationFrame(e):xn(e)}function Le(e){De=void 0,f.xr.session?f.xr.session.cancelAnimationFrame(e):Sn(e)}function Ne(e,t){Re((0,s.t)(),{xrFrame:t}),Me=Oe(Ne)}function Fe(){Ie=!1,De&&Oe(De)}function ze(e){if(!f.isContextLost){if(ee.finalize(["pick"],!0),"origin"in e)return re.identify(e,$)
{const t="on"===x.camera.stereo.name?X:$
return ne.identify(e[0],e[1],t)}}}function je(e){if(!f.isContextLost){if(ee.finalize(["pick"],!0),"origin"in e)return re.asyncIdentify(e,$)
{const t="on"===x.camera.stereo.name?X:$
return ne.asyncIdentify(e[0],e[1],t)}}}function Ve(e=!1){const t=function(e){return!q.needsCommit||(D.f8.copy(Ue,q.boundingSphereVisible),Z.clear(),q.commit(e?void 0:He)?(L.next(0),Y.debug.isEnabled&&Y.debug.update(),x.camera.manualReset||0!==B.value&&!function(){if(0===$.state.radiusMax)return!0
if($.transition.inTransition||le)return!1
let e=!0,t=!0
D.f8.set(Ge,$.state.target,$.state.radius)
for(const n of q.renderables){if(!n.state.visible)continue
const r=n.values.boundingSphere.ref.value
if(!r.radius)continue
t=!1
const i=l.eB.distance(Ge.center,r.center)
if((i>Ge.radius||i>r.radius||r.radius>$.state.radiusMax)&&!D.f8.includes(Ue,r))return!0
D.f8.overlaps(Ge,r)&&(e=!1)}return e||!t&&Ge.radius<=.1}()||(ce=!0),0===Ue.radius&&(ae=0),x.camera.manualReset||$.setState({radiusMax:Q()},0),B.next(C.size),se.Bb&&qe(),!0):(L.next(q.commitQueueSize),!1))}(e)
ee.updateRequired(x),t&&(function(){if(!ce)return
ye.isPresenting.value||ge.resetScale()
const e=q.boundingSphereVisible,{center:t,radius:n}=e,r=W.props.autoAdjustMinMaxDistance
if("on"===r.name){const e=r.params.minDistanceFactor*n+r.params.minDistancePadding,t=Math.max(r.params.maxDistanceFactor*n,r.params.maxDistanceMin)
W.setProps({minDistance:e,maxDistance:t})}if(n>0){const e=void 0===ae?x.cameraResetDurationMs:ae,r=$.getFocus(t,n),i="function"==typeof le?le(q,$):le,o=i?{...r,...i}:r
$.setState({...o,radiusMax:Q()},e)}ae=void 0,le=void 0,ce=!1}(),Ae&&(Y.debug.isEnabled&&Y.debug.update(),Be({force:!0}),Ae=!1),R.next((0,s.t)()))}const Ue=(0,D.f8)(),Ge=(0,D.f8)(),He=250
function qe(){const e=q.renderables.map(e=>({drawCount:e.values.drawCount.ref.value,instanceCount:e.values.instanceCount.ref.value,materialId:e.materialId,renderItemId:e.id,geometryType:e.values.dGeometryType.ref.value,"byteCount [MiB]":(0,fn.Mg)(e.getByteCount()/1024/1024,3)}))
console.groupCollapsed(`${e.length} RenderItems`),e.length<=64?console.table(e):console.log(e),console.log(JSON.stringify(f.stats,void 0,4))
const{texture:t,cubeTexture:n,attribute:r,elements:i,pixelPack:o,renderbuffer:a}=f.resources.getByteCounts()
console.log(JSON.stringify({texture:`${(t/1024/1024).toFixed(3)} MiB`,cubeTexture:`${(n/1024/1024).toFixed(3)} MiB`,attribute:`${(r/1024/1024).toFixed(3)} MiB`,elements:`${(i/1024/1024).toFixed(3)} MiB`,pixelPack:`${(o/1024/1024).toFixed(3)} MiB`,renderbuffer:`${(a/1024/1024).toFixed(3)} MiB`},void 0,4)),console.log(JSON.stringify({renderables:`${(q.renderables.reduce((e,t)=>e+t.getByteCount(),0)/1024/1024).toFixed(3)} MiB`,passes:{draw:`${(g.draw.getByteCount()/1024/1024).toFixed(3)} MiB`,illumination:`${(g.illumination.getByteCount()/1024/1024).toFixed(3)} MiB`,pick:`${(g.pick.getByteCount()/1024/1024).toFixed(3)} MiB`,hiZ:`${(Z.getByteCount()/1024/1024).toFixed(3)} MiB`}},void 0,4)),se.g$&&console.log(JSON.stringify(f.timer.formatedStats(),void 0,4)),console.groupEnd()}function Qe(){const e=q.boundingSphere.radius>0?100-Math.round($.transition.target.radius/Q()*100):0
return{camera:{mode:$.state.mode,helper:{...Y.camera.props},stereo:{...x.camera.stereo},fov:Math.round((0,h.H)($.state.fov)),manualReset:!!x.camera.manualReset},cameraFog:$.state.fog>0?{name:"on",params:{intensity:$.state.fog}}:{name:"off",params:{}},cameraClipping:{far:$.state.clipFar,radius:e,minNear:$.state.minNear},cameraResetDurationMs:x.cameraResetDurationMs,sceneRadiusFactor:x.sceneRadiusFactor,transparentBackground:x.transparentBackground,checkeredTransparentBackground:x.checkeredTransparentBackground,dpoitIterations:x.dpoitIterations,pickPadding:x.pickPadding,userInteractionReleaseMs:x.userInteractionReleaseMs,viewport:x.viewport,postprocessing:{...x.postprocessing},marking:{...x.marking},multiSample:{...x.multiSample},illumination:{...x.illumination},hiZ:{...Z.props},renderer:{...J.props},trackball:{...W.props},interaction:{...ie.props},debug:{...Y.debug.props},handle:{...Y.handle.props},pointer:{...Y.pointer.props},xr:{...ge.props}}}const $e=null==b?void 0:b.subscribe(()=>{Pe=!0,we=null,ne.dirty=!0}),Xe=N.subscribe(()=>{ne.reset(),re.reset(),Z.reset(),q.forEach(e=>{var t;(null===(t=e.values.meta)||void 0===t?void 0:t.ref.value.reset)&&(e.values.meta.ref.value.reset(),e.update())}),Pe=!1,Be({force:!0}),Be({force:!0})}),We=new i.t(0)
function Ye(e=!0){g.updateSize(),tt(),nt(),e&&Ee(),We.next(+new Date)}(0,se.fv)(qe)
const Ze=null===(p=e.changed)||void 0===p?void 0:p.subscribe(()=>{q.setTransparency(g.draw.transparency),Ee()})
let Ke=!1,Je=!1
const et=[m.drag.subscribe(()=>{Ke=!0}),m.interactionEnd.subscribe(()=>{Ke=!1}),(0,o.h)(m.drag,m.pinch,m.wheel,m.interactionEnd).subscribe(()=>{E.next()}),E.subscribe(()=>{Je=!0}),E.pipe((0,a.B)(x.userInteractionReleaseMs)).subscribe(()=>{Je=Ke,!Ke&&g.illumination.supported&&x.illumination.enabled&&Ee()})]
if(se.Bb&&v){let e
const t=e=>{const t=e&&A.Loci.getBoundingSphere(A.Loci.normalize(e,"residue"))
Z.debugOcclusion(t)}
m.click.subscribe(n=>{if(!n.modifiers.control||2!==n.button)return
const r=ze(l.ZY.create(n.x,n.y))
if(!r)return e=void 0,void t(e)
const i=Se(r.id)
e=i.loci,t(e)}),M.subscribe(()=>{setTimeout(()=>{t(e)},100)})}return{webgl:f,add:function e(t){!function(t){P.has(t)||P.set(t,t.updated.subscribe(n=>{t.state.syncManually||e(t)}))}(t)
const n=C.get(t),r=new Set
t.renderObjects.forEach(e=>r.add(e)),n?H.M.areEqual(r,n)||(r.forEach(e=>{n.has(e)||q.add(e)}),n.forEach(e=>{r.has(e)||q.remove(e)})):t.renderObjects.forEach(e=>q.add(e)),C.set(t,r),q.update(t.renderObjects,!1),Ae=!0,se.Bb&&qe()},remove:function(e){!function(e){const t=P.get(e)
t&&(t.unsubscribe(),P.delete(e))}(e)
const t=C.get(e)
t&&(t.forEach(e=>q.remove(e)),C.delete(e),Ae=!0,se.Bb&&qe())},commit:Ve,update:(e,t)=>{if(e){if(!C.has(e))return
q.update(e.renderObjects,!!t)}else q.update(void 0,!!t)
Ae=!0},clear:()=>{P.forEach(e=>e.unsubscribe()),P.clear(),C.clear(),q.clear(),Y.debug.clear(),null!==we&&(f.deleteSync(we),we=null),Ee(),B.next(C.size)},syncVisibility:()=>{0===$.state.radiusMax&&(ce=!0,ae=0),q.syncVisibility()&&Y.debug.isEnabled&&Y.debug.update(),Ee()},requestDraw:Ee,tick:Re,animate:function(){Ie=!1,W.start((0,s.t)()),0===Me&&Ne()},resetTime:function(e){k=e,W.start(e)},pause:function(e=!1){Ie=e,0!==Me&&(Le(Me),Me=0)},resume:Fe,requestAnimationFrame:Oe,cancelAnimationFrame:Le,identify:ze,asyncIdentify:je,mark:function(e,t){_e.push([e,t])},getLoci:Se,handleResize:Ye,requestResize:()=>{ue=!0},requestCameraReset:e=>{ae=null==e?void 0:e.durationMs,le=null==e?void 0:e.snapshot,ce=!0},camera:$,boundingSphere:q.boundingSphere,boundingSphereVisible:q.boundingSphereVisible,get notifyDidDraw(){return xe},set notifyDidDraw(e){xe=e},didDraw:M,commited:R,commitQueueSize:L,reprCount:B,resized:We,setProps:(e,t=!1)=>{var n,r,i,o,a,s,l
const c="function"==typeof e?(0,Ct.j)(Qe(),e):e
void 0!==c.sceneRadiusFactor&&(x.sceneRadiusFactor=c.sceneRadiusFactor,$.setState({radiusMax:Q()},0))
const u=Object.create(null)
c.camera&&void 0!==c.camera.mode&&c.camera.mode!==$.state.mode&&(u.mode=c.camera.mode)
const d=Math.round((0,h.H)($.state.fov))
if(c.camera&&void 0!==c.camera.fov&&c.camera.fov!==d&&(u.fov=(0,h.pu)(c.camera.fov)),void 0!==c.cameraFog&&c.cameraFog.params){const e="on"===c.cameraFog.name?c.cameraFog.params.intensity:0
e!==$.state.fog&&(u.fog=e)}if(void 0!==c.cameraClipping&&(void 0!==c.cameraClipping.far&&c.cameraClipping.far!==$.state.clipFar&&(u.clipFar=c.cameraClipping.far),void 0!==c.cameraClipping.minNear&&c.cameraClipping.minNear!==$.state.minNear&&(u.minNear=c.cameraClipping.minNear),void 0!==c.cameraClipping.radius)){const e=Q()/100*(100-c.cameraClipping.radius)
e>0&&e!==u.radius&&(u.radius=Math.max(e,.01))}Object.keys(u).length>0&&$.setState(u),(null===(n=c.camera)||void 0===n?void 0:n.helper)&&Y.camera.setProps(c.camera.helper),void 0!==(null===(r=c.camera)||void 0===r?void 0:r.manualReset)&&(x.camera.manualReset=c.camera.manualReset),void 0!==(null===(i=c.camera)||void 0===i?void 0:i.stereo)&&(Object.assign(x.camera.stereo,c.camera.stereo),X.setProps(x.camera.stereo.params)),void 0!==c.cameraResetDurationMs&&(x.cameraResetDurationMs=c.cameraResetDurationMs),void 0!==c.transparentBackground&&(x.transparentBackground=c.transparentBackground),void 0!==c.checkeredTransparentBackground&&(x.checkeredTransparentBackground=c.checkeredTransparentBackground),void 0!==c.dpoitIterations&&(x.dpoitIterations=c.dpoitIterations),void 0!==c.pickPadding&&(x.pickPadding=c.pickPadding,ne.setPickPadding(x.pickPadding)),void 0!==c.userInteractionReleaseMs&&(x.userInteractionReleaseMs=c.userInteractionReleaseMs),void 0!==c.viewport&&(x.viewport===c.viewport||x.viewport.name===c.viewport.name&&(0,O.bN)(x.viewport.params,c.viewport.params)||(x.viewport=c.viewport,tt(),nt())),(null===(o=c.postprocessing)||void 0===o?void 0:o.background)&&(Object.assign(x.postprocessing.background,c.postprocessing.background),g.draw.postprocessing.background.update($,x.postprocessing.background,e=>{e&&!t&&Ee()})),c.postprocessing&&Object.assign(x.postprocessing,c.postprocessing),c.marking&&Object.assign(x.marking,c.marking),c.illumination&&Object.assign(x.illumination,c.illumination),c.multiSample&&Object.assign(x.multiSample,c.multiSample),c.hiZ&&Z.setProps(c.hiZ),c.renderer&&(q.setGlobals({dColorMarker:null!==(a=c.renderer.colorMarker)&&void 0!==a?a:J.props.colorMarker,dLightCount:null!==(l=null===(s=c.renderer.light)||void 0===s?void 0:s.length)&&void 0!==l?l:J.props.light.length}),J.setProps(c.renderer)),c.trackball&&W.setProps(c.trackball),c.interaction&&ie.setProps(c.interaction),c.debug&&Y.debug.setProps(c.debug),c.handle&&Y.handle.setProps(c.handle),c.pointer&&Y.pointer.setProps(c.pointer),c.xr&&ge.setProps(c.xr),"orthographic"===u.mode&&(x.camera.stereo.name="off"),("transparentBackground"in c||"checkeredTransparentBackground"in c||c.renderer&&"backgroundColor"in c.renderer)&&_n(v,x),ee.updateRequired(x),t||Ee()},setAttribs:e=>{e.trackball&&W.setAttribs(e.trackball),e.xr&&ge.setAttribs(e.xr)},getImagePass:(e={})=>new St(f,y,J,q,$,Y,e),getRenderObjects(){const e=[]
return q.forEach((t,n)=>e.push(n)),e},get props(){return Qe()},get attribs(){return{trackball:W.attribs,xr:ge.attribs}},get input(){return m},get stats(){return J.stats},get interaction(){return ie.events},xr:ye,dispose:()=>{null==$e||$e.unsubscribe(),Xe.unsubscribe(),null==Ze||Ze.unsubscribe()
for(const e of be)e.unsubscribe()
be.length=0
for(const e of et)e.unsubscribe()
et.length=0,Sn(Me),De=void 0,_e=[],q.clear(),Y.debug.clear(),W.dispose(),J.dispose(),ie.dispose(),Z.dispose(),ne.dispose(),re.dispose(),ge.dispose(),null!==we&&(f.deleteSync(we),we=null),B.complete(),E.complete(),M.complete(),We.complete(),R.complete(),L.complete(),ye.isPresenting.complete(),ye.isSupported.complete(),ye.requestFailed.complete(),(0,se.EF)(qe)}}
function tt(){const e=F,t=z,n=j,r=V,i=f.getDrawingBufferSize()
"canvas"===x.viewport.name?(F=0,z=0,j=i.width,V=i.height):"static-frame"===x.viewport.name?(F=x.viewport.params.x*f.pixelRatio,V=x.viewport.params.height*f.pixelRatio,z=i.height-V-x.viewport.params.y*f.pixelRatio,j=x.viewport.params.width*f.pixelRatio):"relative-frame"===x.viewport.name&&(F=Math.round(x.viewport.params.x*i.width),V=Math.round(x.viewport.params.height*i.height),z=Math.round(i.height-V-x.viewport.params.y*i.height),j=Math.round(x.viewport.params.width*i.width)),e===F&&t===z&&n===j&&r===V||(U=!0)}function nt(){ne.setViewport(F,z,j,V),J.setViewport(F,z,j,V),d.LM.set($.viewport,F,z,j,V),d.LM.set(W.viewport,F,z,j,V),Z.setViewport(F,z,j,V)}}}(Cn||(Cn={}))},62264(e,t,n){"use strict"
n.d(t,{J:()=>u,r:()=>d})
var r=n(95916),i=n(37088),o=n(80856),a=n(9959),s=n(5638),l=n(24060)
const c=(0,a.q)()
function u(e){const t=e.createProgram()
if(null===t)throw new Error("Could not create WebGL program")
return t}function d(e,t,n,a,d,p){const{defineValues:h,shaderCode:f,schema:m}=p
let g=u(e)
const y=c(),v=function(e){if("string"!=typeof e)throw new Error(`unknown program variant: ${e}`)
return e.startsWith("color")?"color":e.startsWith("pick")?"pick":e}(h.dRenderVariant.ref.value),b=(0,r.NB)(e,n,a,h,f),x=d("vert",b.vert),S=d("frag",b.frag)
let _,C,w=!1,T=!1,A=!1
function I(){x.attach(g),S.attach(g),e.linkProgram(g),s.Bb&&function(e,t){if(!e.getProgramParameter(t,e.LINK_STATUS))throw new Error(`Could not compile WebGL program. \n\n${e.getProgramInfoLog(t)}`)}(e,g),w=!0}function P(){_=function(e,t,n){const r={}
return Object.keys(n).forEach(o=>{const a=n[o]
if("attribute"===a.type){const n=e.getAttribLocation(t,o)
r[o]=n}else if("uniform"===a.type){let n=e.getUniformLocation(t,o)
null===n&&(0,i.a5)(a.kind)&&(n=e.getUniformLocation(t,o+"[0]")),r[o]=n}else if("texture"===a.type){const n=e.getUniformLocation(t,o)
r[o]=n}}),r}(e,g,m),C=(0,i.Pi)(m),s.Bb&&(function(e,t,n){const r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES)
for(let i=0;i<r;++i){const r=e.getActiveAttrib(t,i)
if(r){const{name:t,type:i}=r
if(t.startsWith("__activeAttribute"))continue
if("gl_InstanceID"===t)continue
if("gl_VertexID"===t)continue
if("gl_DrawID"===t)continue
if("gl_ViewID_OVR"===t)continue
const a=n[t]
if(void 0===a)throw new Error(`missing 'uniform' or 'texture' with name '${t}' in schema`)
if("attribute"!==a.type)throw new Error(`'${t}' must be of type 'attribute' but is '${a.type}'`)
const s=(0,o.xB)(e,a.kind,a.itemSize)
if(s!==i)throw new Error(`unexpected attribute type '${s}' for ${t}, expected '${i}'`)}}}(e,g,m),function(e,t,n){const r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS)
for(let o=0;o<r;++o){const r=e.getActiveUniform(t,o)
if(r){const{name:t,type:o}=r
if(t.startsWith("__activeUniform"))continue
if("gl_InstanceID"===t)continue
if("gl_VertexID"===t)continue
if("gl_DrawID"===t)continue
if("gl_ViewID_OVR"===t)continue
const a=n[t.replace(/[[0-9]+\]$/,"")]
if(void 0===a)throw new Error(`missing 'uniform' or 'texture' with name '${t}' in schema`)
if("uniform"===a.type){if((0,i.NM)(e,a.kind)!==o)throw new Error(`unexpected uniform type for ${t}`)}else{if("texture"!==a.type)throw new Error(`'${t}' must be of type 'uniform' or 'texture' but is '${a.type}'`)
if("image-float32"===a.kind||"image-uint8"===a.kind){if(o!==e.SAMPLER_2D)throw new Error(`unexpected sampler type for '${t}'`)}else if("volume-float32"===a.kind||"volume-uint8"===a.kind){if(!(0,l.C6)(e))throw new Error("WebGL2 is required to use SAMPLER_3D")
if(o!==e.SAMPLER_3D)throw new Error(`unexpected sampler type for '${t}'`)}}}}}(e,g,m)),T=!0}return"compute"===v&&I(),{id:y,variant:v,isReady:()=>T,link:()=>{w||I()},finalize:t=>(w||I(),T||!t&&n.parallelShaderCompile&&!e.getProgramParameter(g,n.parallelShaderCompile.COMPLETION_STATUS)||P(),T),use:()=>{if(s.Bb&&!T)throw new Error(`program not finalized: ${v}`)
t.currentProgramId=y,e.useProgram(g)},setUniforms:t=>{for(let n=0,r=t.length;n<r;++n){const[r,i]=t[n]
if(i){const t=_[r]
null!==t&&C[r](e,t,i.ref.value)}}},uniform:(t,n)=>{const r=_[t]
null!==r&&C[t](e,r,n)},bindAttributes:e=>{t.clearVertexAttribsState()
for(let t=0,n=e.length;t<n;++t){const[n,r]=e[t],i=_[n];-1!==i&&r.bind(i)}t.disableUnusedVertexAttribs()},offsetAttributes:(e,t)=>{for(let n=0,r=e.length;n<r;++n){const[r,i]=e[n],o=_[r];-1!==o&&i.changeOffset(o,t)}},bindTextures:(t,n)=>{for(let r=0,i=t.length;r<i;++r){const[i,o]=t[r],a=_[i]
null!=a&&(o.bind(r+n),C[i](e,a,r+n))}},reset:()=>{g=u(e),w&&I(),T&&P()},destroy:()=>{A||(x.destroy(),S.destroy(),e.deleteProgram(g),A=!0)}}}},62618(e,t,n){"use strict"
n.d(t,{Tg:()=>m})
var r=n(76513),i=n(87949),o=n(97270),a=n(85404),s=n(83939),l=n(30517),c=n(44067),u=n(22153),d=n(9336),p=n(18891),h=n(17642),f=n(62626)
function m(e){if(e instanceof a.c)return e
if(null!=e){if((0,s.l)(e))return v=e,new a.c(function(e){var t=v[f.s]()
if((0,p.T)(t.subscribe))return t.subscribe(e)
throw new TypeError("Provided object does not correctly implement Symbol.observable")})
if((0,i.X)(e))return y=e,new a.c(function(e){for(var t=0;t<y.length&&!e.closed;t++)e.next(y[t])
e.complete()})
if((0,o.y)(e))return m=e,new a.c(function(e){m.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,h.m)})
if((0,l.T)(e))return g(e)
if((0,u.x)(e))return n=e,new a.c(function(e){var t,i
try{for(var o=(0,r.Ju)(n),a=o.next();!a.done;a=o.next()){var s=a.value
if(e.next(s),e.closed)return}}catch(e){t={error:e}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(t)throw t.error}}e.complete()})
if((0,d.U)(e))return t=e,g((0,d.C)(t))}var t,n,m,y,v
throw(0,c.L)(e)}function g(e){return new a.c(function(t){(function(e,t){var n,i,o,a
return(0,r.sH)(this,void 0,void 0,function(){var s,l
return(0,r.YH)(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=(0,r.xN)(e),c.label=1
case 1:return[4,n.next()]
case 2:if((i=c.sent()).done)return[3,4]
if(s=i.value,t.next(s),t.closed)return[2]
c.label=3
case 3:return[3,1]
case 4:return[3,11]
case 5:return l=c.sent(),o={error:l},[3,11]
case 6:return c.trys.push([6,,9,10]),i&&!i.done&&(a=n.return)?[4,a.call(n)]:[3,8]
case 7:c.sent(),c.label=8
case 8:return[3,10]
case 9:if(o)throw o.error
return[7]
case 10:return[7]
case 11:return t.complete(),[2]}})})})(e,t).catch(function(e){return t.error(e)})})}},62626(e,t,n){"use strict"
n.d(t,{s:()=>r})
var r="function"==typeof Symbol&&Symbol.observable||"@@observable"},62837(e,t,n){"use strict"
n.d(t,{EN:()=>k,Go:()=>U,Hj:()=>q,I:()=>G,KE:()=>O,T9:()=>M,UM:()=>L,YD:()=>z,Yl:()=>H,cT:()=>X,hJ:()=>Q,ip:()=>V,m7:()=>$,wA:()=>D,yW:()=>F,yd:()=>j,yv:()=>N,zo:()=>R})
var r=n(17684),i=n(48393),o=n(22703),a=n(3111),s=n(42594),l=n(23729),c=n(89),u=n(67538),d=n(41036),p=n(42529),h=n(9043),f=n(68187),m=n(65081),g=n(40038),y=n(10596),v=n(47404),b=n(30084),x=n(88524),S=n(55165),_=n(40362),C=n(17782),w=n(31312),T=n(70948),A=n(91229),I=n(32520),P=n(65580),B=n(71712)
function E(e,t){const{defaultProps:n,createGeometry:y,createLocationIterator:v,getLoci:b,eachLocation:x,setUpdateState:_,mustRecreate:w,processValues:T,dispose:I}=e,{updateValues:P,updateBoundingSphere:B,updateRenderableState:E,createPositionIterator:k}=e.geometryUtils,D=d.rj.create(),M={loci:c.EmptyLoci,action:g.xi.None,status:-1}
let R,O,L,N,F,z,j,V,U=Object.assign({},n),G=a.S.createEmpty(),H=-1
function q(e){if(D.createNew){if(j=v(N,O),!e)throw new Error("expected geometry to be given")
R=function(e,t,n,r,i,a){const{createValues:c,createRenderableState:u}=o.V.getUtils(t),d=c(t,(0,s.Zk)(),n,r,i),p=u(i)
return(0,l.o)(t.kind,d,p,a)}(0,e,j,L,O,t),V=k(e,R.values)}else{if(!R)throw new Error("expected renderObject to be available")
if((D.updateColor||D.updateSize||D.updateTransform)&&(j=v(N,O)),D.updateTransform){const{instanceCount:e,groupCount:t}=j
O.instanceGranularity?(0,C.Km)(e,"instance",R.values):(0,C.Km)(e*t,"groupInstance",R.values)}if(D.createGeometry){if(!e)throw new Error("expected geometry to be given")
h.IQ.updateIfChanged(R.values.drawCount,o.V.getDrawCount(e)),h.IQ.updateIfChanged(R.values.uVertexCount,o.V.getVertexCount(e)),h.IQ.updateIfChanged(R.values.uGroupCount,j.groupCount)}(D.updateTransform||D.createGeometry)&&(B(R.values,e||z),V=k(z,R.values)),D.updateSize&&"uSize"in R.values&&(0,f.v3)(j,L.size,R.values),D.updateColor&&(0,m.D1)(j,V,L.color,R.values),P(R.values,O),E(R.state,O)}U=O,G=L,F=N,e&&(z=e,H+=1)}function Q(e,t,n){return function(e){return!!(0,c.isEveryLoci)(e)||!(!i.Structure.isLoci(e)||!i.Structure.areRootsEquivalent(e.structure,F))||!!(i.StructureElement.Loci.is(e)&&i.Structure.areRootsEquivalent(e.structure,F)&&i.StructureElement.Loci.isWholeStructure(e))}(e)?U.instanceGranularity?t(u.IX.ofBounds(0,j.instanceCount)):t(u.IX.ofBounds(0,j.groupCount*j.instanceCount)):U.instanceGranularity?function(e,t,n){let r=!1
return!(!i.StructureElement.Loci.is(e)&&!i.Bond.isLoci(e))&&!!i.Structure.areEquivalent(e.structure,t)&&(n(u.IX.ofSingleton(0))&&(r=!0),r)}(e,F,t):x(e,F,t,n)}function $(e){R&&(null==T||T(R.values,z,U,G,e.webgl))}return{get groupCount(){return j?j.count:0},get renderObject(){return j&&j.count?R:void 0},get geometryVersion(){return H},createOrUpdate(e,t,n={},r){if(function(e,t,n){if(!n&&!F)throw new Error("missing structure")
if(O=Object.assign({},U,t),L=e,N=n,d.rj.reset(D),!R||!F)return D.createNew=!0,void(D.createGeometry=!0)
_(D,O,U,L,G,N,F),i.Structure.areEquivalent(N,F)||(D.createGeometry=!0),i.Structure.areHierarchiesEqual(N,F)||(D.updateTransform=!0,D.createGeometry=!0),p.J.areEqual(e.color,G.color)||(D.updateColor=!0),S.F.areEqual(e.size,G.size)||(D.updateSize=!0),(0,h.bD)(O.unitKinds,U.unitKinds)||(D.createGeometry=!0),F.child!==N.child&&(D.createGeometry=!0,D.updateTransform=!0),O.instanceGranularity!==U.instanceGranularity&&(D.updateTransform=!0),D.updateSize&&!("uSize"in R.values)&&(D.createGeometry=!0),D.createGeometry&&(D.updateColor=!0,D.updateSize=!0)}(t,n,r||F),D.createGeometry){const t=y(e,N,L,O,z)
if((0,A.$X)(t))return t.then(t=>{q(t),$(e)})
q(t)}else q()
$(e)},getLoci:e=>R?b(e,F,R.id):c.EmptyLoci,eachLocation(e){for(j.reset();j.hasNext;){const{location:t,isSecondary:n}=j.move()
e(t,n)}},mark:(e,t)=>r.b.mark(R,e,t,Q,M),setVisibility(e){r.b.setVisibility(R,e)},setAlphaFactor(e){r.b.setAlphaFactor(R,e)},setPickable(e){r.b.setPickable(R,e)},setColorOnly(e){r.b.setColorOnly(R,e)},setTransform(e,t){r.b.setTransform(R,e,t)},setOverpaint(e,t){const n={geometry:z,props:U,webgl:t}
r.b.setOverpaint(R,e,Q,!0,n)},setTransparency(e,t){const n={geometry:z,props:U,webgl:t}
r.b.setTransparency(R,e,Q,!0,n)},setEmissive(e,t){const n={geometry:z,props:U,webgl:t}
r.b.setEmissive(R,e,Q,!0,n)},setSubstance(e,t){const n={geometry:z,props:U,webgl:t}
r.b.setSubstance(R,e,Q,!0,n)},setClipping(e){r.b.setClipping(R,e,Q,!0)},setThemeStrength(e){r.b.setThemeStrength(R,e)},destroy(){null==I||I(z),R&&(R.state.disposed=!0,R=void 0)},mustRecreate:w}}const k={...w.nF,...w.a2}
function D(e,t){return E({...e,setUpdateState:(t,n,r,i,o,a,s)=>{e.setUpdateState(t,n,r,i,o,a,s),S.F.areEqual(i.size,o.size)||(t.createGeometry=!0)},geometryUtils:y.e.Utils},t)}const M={...w.Op,...w.a2}
function R(e,t){return E({...e,setUpdateState:(t,n,r,i,o,a,s)=>{e.setUpdateState(t,n,r,i,o,a,s),S.F.areEqual(i.size,o.size)||(t.updateSize=!0)},geometryUtils:I.v.Utils},t)}const O={...w.DG,...w.a2}
function L(e,t){return E({...e,setUpdateState:(t,n,r,i,o,a,s)=>{e.setUpdateState(t,n,r,i,o,a,s),S.F.areEqual(i.size,o.size)||(t.updateSize=!0)},geometryUtils:v.S.Utils},t)}const N={...w.fy,...w.a2}
function F(e,t){return E({...e,setUpdateState:(t,n,r,i,o,a,s)=>{e.setUpdateState(t,n,r,i,o,a,s),S.F.areEqual(i.size,o.size)||(t.updateSize=!0)},geometryUtils:P.O.Utils},t)}const z={...w.Rb,...w.a2}
function j(e,t){return E({...e,setUpdateState:(t,n,r,i,o,a,s)=>{e.setUpdateState(t,n,r,i,o,a,s),S.F.areEqual(i.size,o.size)||(t.updateSize=!0)},geometryUtils:b.q.Utils},t)}const V={...w.xl,...w.a2}
function U(e,t){return E({...e,setUpdateState:(t,n,r,i,o,a,s)=>{e.setUpdateState(t,n,r,i,o,a,s),S.F.areEqual(i.size,o.size)||(t.updateSize=!0),n.background!==r.background&&(t.createGeometry=!0),n.backgroundMargin!==r.backgroundMargin&&(t.createGeometry=!0),n.tether!==r.tether&&(t.createGeometry=!0),n.tetherLength!==r.tetherLength&&(t.createGeometry=!0),n.tetherBaseWidth!==r.tetherBaseWidth&&(t.createGeometry=!0),n.attachment!==r.attachment&&(t.createGeometry=!0),n.fontFamily!==r.fontFamily&&(t.createGeometry=!0),n.fontQuality!==r.fontQuality&&(t.createGeometry=!0),n.fontStyle!==r.fontStyle&&(t.createGeometry=!0),n.fontVariant!==r.fontVariant&&(t.createGeometry=!0),n.fontWeight!==r.fontWeight&&(t.createGeometry=!0)},geometryUtils:x.E.Utils},t)}const G={...w.Vv,...w.a2}
function H(e,t){return E({...e,setUpdateState:(t,n,r,i,o,a,s)=>{e.setUpdateState(t,n,r,i,o,a,s),S.F.areEqual(i.size,o.size)||(t.createGeometry=!0)},geometryUtils:_.E.Utils},t)}const q={...w.MQ,...w.a2}
function Q(e,t){return E({...e,setUpdateState:(t,n,r,i,o,a,s)=>{e.setUpdateState(t,n,r,i,o,a,s),S.F.areEqual(i.size,o.size)||(t.createGeometry=!0)},geometryUtils:T.X.Utils},t)}const $={...w.nH,...w.a2}
function X(e,t){return E({...e,setUpdateState:(t,n,r,i,o,a,s)=>{e.setUpdateState(t,n,r,i,o,a,s),S.F.areEqual(i.size,o.size)||(t.createGeometry=!0)},geometryUtils:B._V.Utils},t)}},63317(e,t,n){"use strict"
n.d(t,{f:()=>c})
var r=n(20321),i=n(76677),o=n(76242),a=n(37411),s=n(39250),l=n(23325)
function c(){return c.zero()}!function(e){function t(e){return void 0!==e.extrema}function n(e,t){return{center:e,radius:t}}function c(e,t){return void 0!==e.extrema?(e.extrema.length=0,e.extrema.push(...t)):e.extrema=t,e}e.hasExtrema=t,e.create=n,e.zero=function(){return{center:(0,a.e)(),radius:0}},e.clone=function(e){const r=n(a.e.clone(e.center),e.radius)
return t(e)&&(r.extrema=e.extrema.map(e=>a.e.clone(e))),r},e.set=function(e,t,n){return a.e.copy(e.center,t),e.radius=n,e},e.copy=function(e,n){return a.e.copy(e.center,n.center),e.radius=n.radius,t(n)&&c(e,n.extrema.map(e=>a.e.clone(e))),e},e.setExtrema=c,e.computeBounding=function(e){const{x:t,y:n,z:i,indices:o}=e
let s=0,l=0,c=0,u=0
const d=r.C.size(o)
for(let a=0;a<d;a++){const e=r.C.getAt(o,a)
s+=t[e],l+=n[e],c+=i[e]}d>0&&(s/=d,l/=d,c/=d)
for(let a=0;a<d;a++){const e=r.C.getAt(o,a),d=t[e]-s,p=n[e]-l,h=i[e]-c,f=d*d+p*p+h*h
f>u&&(u=f)}return{center:a.e.create(s,l,c),radius:Math.sqrt(u)}},e.transform=function(e,n,r){return a.e.transformMat4(e.center,n.center,r),e.radius=n.radius*s.$.getMaxScaleOnAxis(r),t(n)&&c(e,n.extrema.map(e=>a.e.transformMat4((0,a.e)(),e,r))),e},e.translate=function(e,n,r){return a.e.add(e.center,n.center,r),t(n)&&c(e,n.extrema.map(e=>a.e.add((0,a.e)(),e,r))),e},e.scale=function(e,n,r){return a.e.scale(e.center,n.center,r),e.radius=n.radius*r,t(n)&&c(e,n.extrema.map(e=>a.e.scale((0,a.e)(),e,r))),e},e.scaleNX=function(e,t,n){return a.e.scale(e.center,t.center,n),e.radius=t.radius*n,e},e.toArray=function(e,t,n){return a.e.toArray(e.center,t,n),t[n+3]=e.radius,t},e.fromArray=function(e,t,n){return a.e.fromArray(e.center,t,n),e.radius=t[n+3],e},e.fromBox3D=function(t,n){return a.e.scale(t.center,a.e.add(t.center,n.max,n.min),.5),t.radius=a.e.distance(t.center,n.max),e.setExtrema(t,[a.e.create(n.min[0],n.min[1],n.min[2]),a.e.create(n.max[0],n.max[1],n.max[2]),a.e.create(n.max[0],n.min[1],n.min[2]),a.e.create(n.min[0],n.max[1],n.max[2]),a.e.create(n.min[0],n.min[1],n.max[2]),a.e.create(n.max[0],n.min[1],n.max[2]),a.e.create(n.max[0],n.max[1],n.min[2]),a.e.create(n.min[0],n.max[1],n.min[2])]),t},e.fromAxes3D=function(e,t){return a.e.copy(e.center,t.origin),e.radius=Math.max(a.e.magnitude(t.dirA),a.e.magnitude(t.dirB),a.e.magnitude(t.dirC)),e}
const u=(0,a.e)()
e.fromDimensionsAndTransform=function(t,n,r){const[i,o,s]=n,l=a.e.create(0,0,0)
a.e.transformMat4(l,l,r)
const c=a.e.create(i,o,s)
a.e.transformMat4(c,c,r)
const d=a.e.create(i,0,0)
a.e.transformMat4(d,d,r)
const p=a.e.create(0,o,s)
a.e.transformMat4(p,p,r)
const h=a.e.create(0,0,s)
a.e.transformMat4(h,h,r)
const f=a.e.create(i,0,s)
a.e.transformMat4(f,f,r)
const m=a.e.create(i,o,0)
a.e.transformMat4(m,m,r)
const g=a.e.create(0,o,0)
a.e.transformMat4(g,g,r),a.e.add(u,l,c),a.e.scale(u,u,.5)
const y=Math.max(a.e.distance(l,c),a.e.distance(d,p))
return e.set(t,u,y/2),e.setExtrema(t,[l,c,d,p,h,f,m,g]),t}
const d=(0,a.e)()
e.addVec3=function(t,n,r){return a.e.distance(n.center,r)<n.radius?e.copy(t,n):(a.e.sub(d,n.center,r),a.e.sub(d,n.center,d),a.e.setMagnitude(d,d,n.radius),a.e.scale(t.center,a.e.add(d,d,r),.5),t.radius=a.e.distance(t.center,r),t)},e.expandBySphere=function(e,n,r){return a.e.copy(e.center,n.center),e.radius=Math.max(n.radius,a.e.distance(n.center,r.center)+r.radius),t(n)&&t(r)&&c(e,[...n.extrema.map(e=>a.e.clone(e)),...r.extrema.map(e=>a.e.clone(e))]),e}
const p=(0,a.e)()
e.expand=function(e,n,r){var s,l
if(a.e.copy(e.center,n.center),e.radius=n.radius+r,n.radius<1e-12||(null!==(l=null===(s=n.extrema)||void 0===s?void 0:s.length)&&void 0!==l?l:0)<=1)return e.extrema=void 0,e
if(t(n)){const t=new Float32Array(3*n.extrema.length)
for(let e=0;e<n.extrema.length;e++)a.e.toArray(n.extrema[e],t,3*e)
const s=o.c.calculateMomentsAxes(t)
i.n.scale(s,i.n.normalize(s,s),r),c(e,n.extrema.map(t=>{a.e.normalize(p,a.e.sub(p,t,n.center))
const r=a.e.clone(t),i=a.e.dot(p,s.dirA)<0?-1:1
a.e.scaleAndAdd(r,r,s.dirA,i)
const o=a.e.dot(p,s.dirB)<0?-1:1
a.e.scaleAndAdd(r,r,s.dirB,o)
const l=a.e.dot(p,s.dirC)<0?-1:1
return a.e.scaleAndAdd(r,r,s.dirC,l),a.e.distance(e.center,r)>e.radius&&(n.extrema.length>=14&&a.e.normalize(p,a.e.sub(p,r,n.center)),a.e.scaleAndAdd(r,e.center,p,e.radius)),r}))}return e},e.exactEquals=function(e,t){return e.radius===t.radius&&a.e.exactEquals(e.center,t.center)},e.equals=function(e,t){const n=e.radius,r=t.radius
return Math.abs(n-r)<=l.p*Math.max(1,Math.abs(n),Math.abs(r))&&a.e.equals(e.center,t.center)},e.includes=function(e,n){if(t(n)){for(const t of n.extrema)if(a.e.distance(e.center,t)>e.radius)return!1
return!0}return a.e.distance(e.center,n.center)+n.radius<=e.radius},e.overlaps=function(e,t){return a.e.distance(e.center,t.center)<=e.radius+t.radius},e.distance=function(e,t){return a.e.distance(e.center,t.center)-e.radius+t.radius},e.distanceToVec=function(e,t){const{center:n,radius:r}=e
return a.e.distance(t,n)-r}}(c||(c={}))},63356(e,t,n){"use strict"
function r(e){let t=-1/0
for(let n=0,r=e.length;n<r;++n)e[n]>t&&(t=e[n])
return t}function i(e){let t=1/0
for(let n=0,r=e.length;n<r;++n)e[n]<t&&(t=e[n])
return t}function o(e){let t=1/0,n=-1/0
for(let r=0,i=e.length;r<i;++r)e[r]<t&&(t=e[r]),e[r]>n&&(n=e[r])
return[t,n]}function a(e,t=1,n=0){const r=e.length
let i=0
for(let o=n;o<r;o+=t)i+=e[o]
return i}function s(e,t=1,n=0){return a(e,t,n)/(e.length/t)}function l(e){const t=e.length
let n=0
for(let r=0;r<t;++r){const t=e[r]
n+=t*t}return Math.sqrt(n/t)}function c(e,t){for(let n=0,r=t?Math.min(t,e.length):e.length;n<r;++n)e[n]=n
return e}function u(e,t){let n=0,r=!1
for(const i=e.length;n<i;n++)if(e[n]===t){r=!0
break}return!!r&&(d(e,n),!0)}function d(e,t){for(let n=t,r=e.length-1;n<r;n++)e[n]=e[n+1]
e.pop()}function p(e,t){return!(e.indexOf(t)>=0||(e.push(t),0))}function h(e,t){const n=e.indexOf(t)
if(n<0)return!1
for(let r=n,i=e.length-1;r<i;r++)e[r]=e[r+1]
return e.pop(),!0}function f(e,t){let n=0
for(let r=0,i=e.length;r<i;++r)t.includes(e[r])&&(n+=1)
return n}function m(e,t){if(!e||0===e.length)return!t||0===t.length
if(!t)return!1
const n=e.length
if(n!==t.length)return!1
for(let r=0;r<n;r++)if(e[r]!==t[r])return!1
return!0}function g(e){for(let t=0,n=e.length;t<n;t++)if(e[t]!==t)return!1
return!0}function y(e,t,n){for(let r=0,i=e.length;r<i;++r)if(e[r][0]===t)return void(e[r][1]=n)
e.push([t,n])}function v(e,t){void 0===t&&(t=e,e=0)
const n=Math.max(t-e,0),r=Array(n)
for(let i=0;i<n;i++)r[i]=e+i
return r}n.d(t,{af:()=>m,u$:()=>f,qW:()=>g,$6:()=>y,_M:()=>r,VR:()=>s,GP:()=>i,em:()=>o,P6:()=>d,mO:()=>u,C2:()=>l,Z2:()=>p,K3:()=>h,jJ:()=>a,WE:()=>c,y1:()=>v}),n(95538)},63445(e,t,n){"use strict"
n.r(t),n.d(t,{default:()=>m})
var r=n(62663),i=n(31130),o=n(71223),a=n(61115)
function s(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e
var t=e[Symbol.toPrimitive]
if(void 0!==t){var n=t.call(e,"string")
if("object"!=typeof n)return n
throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e)
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const l=new WeakMap,c=new WeakMap
let u=class{constructor(e,t){s(this,"args",void 0),this.args=t,l.set(this,!1),c.set(this,!1)}get isDestroying(){return l.get(this)||!1}get isDestroyed(){return c.get(this)||!1}willDestroy(){}}
class d{constructor(e){s(this,"owner",void 0),this.owner=e}createComponent(e,t){return new e(this.owner,t.named)}getContext(e){return e}}const p=(0,r.capabilities)("3.13",{destructor:!0,asyncLifecycleCallbacks:!1,updateHook:!1})
function h(e){e.isDestroyed||((0,i.destroy)(e),function(e){c.set(e,!0)}(e))}class f extends d{constructor(...e){super(...e),s(this,"capabilities",p)}destroyComponent(e){e.isDestroying||(function(e){l.set(e,!0)}(e),(0,o.schedule)("actions",e,e.willDestroy),(0,o.schedule)("destroy",this,h,e))}}class m extends u{constructor(e,t){super(e,t),(0,a.setOwner)(this,e)}}(0,r.setComponentManager)(e=>new f(e),m)},63767(e,t,n){"use strict"
n.d(t,{B:()=>j,E:()=>N,F:()=>U,J:()=>K,S:()=>$e,a:()=>C,b:()=>f,d:()=>Te,f:()=>Re,h:()=>ce,i:()=>_,j:()=>ue,k:()=>re,l:()=>Ke,n:()=>g,p:()=>oe,r:()=>le,s:()=>de,v:()=>$,w:()=>X,x:()=>G,y:()=>q,z:()=>Q})
var r=n(38382),i=n(61603),o=n(80191),a=n(41113)
Symbol("record-originated-on-client"),Symbol("identifier-bucket"),Symbol("warpDriveStaleCache")
const s="__$co"
var l,c=n(15546),u=n(77603),d=n(39043)
function p(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e
var t=e[Symbol.toPrimitive]
if(void 0!==t){var n=t.call(e,"string")
if("object"!=typeof n)return n
throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e)
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function h(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n
throw new TypeError("Private element is not present on this object")}function f(e){{let t
return t=null==e||""===e?null:String(e),(0,i.deprecate)(`The resource id '<${typeof e}> ${String(e)} ' is not normalized. Update your application code to use '${JSON.stringify(t)}' instead.`,t===e,{id:"ember-data:deprecate-non-strict-id",until:"6.0",for:"ember-data",since:{available:"4.13",enabled:"5.3"}}),t}}function m(e){let t=null
return"string"==typeof e?t=e.length>0?e:null:"number"!=typeof e||isNaN(e)||(t=String(e)),t}function g(e){{const t=(0,c._k)(e)
return(0,i.deprecate)(`The resource type '${e}' is not normalized. Update your application code to use '${t}' instead of '${e}'.`,t===e,{id:"ember-data:deprecate-non-strict-types",until:"6.0",for:"ember-data",since:{available:"4.13",enabled:"5.3"}}),t}}function y(e){return Boolean(e&&"object"==typeof e)}function v(e,t){return Boolean(y(e)&&t in e&&"string"==typeof e[t]&&e[t].length)}function b(e){return v(e,"lid")}function x(e){return v(e,"id")||Boolean(y(e)&&"id"in e&&"number"==typeof e.id)}const S=(0,a.L1)("DOCUMENTS",new Set)
function _(e){return void 0!==e[s]}function C(e){return S.has(e)}const w="undefined"!=typeof FastBoot?FastBoot.require("crypto"):globalThis.crypto,T=new Map
let A=0
function I(e,t,n){"record"===n&&!e.id&&x(t)&&function(e,t,n){let r=e.get(t.type)
r||(r=new Map,e.set(t.type,r)),r.set(n,t.lid)}(T,e,t.id)}function P(e,t){const n=x(e)?f(e.id):null
return{type:function(e){return v(e,"type")}(e)?g(e.type):t?t.type:null,id:n}}function B(e,t){if("record"===t){if(b(e))return e.lid
if(x(e)){const t=g(e.type),n=T.get(t)?.get(e.id)
return n||`@lid:${t}-${e.id}`}return w.randomUUID()}if("document"===t)return e.url?e.method&&"GET"!==e.method.toUpperCase()?null:e.url:null}function E(...e){}function k(e,t,n){return e}class D{constructor(){this._generate=(0,a.Yj)("configuredGenerationMethod")||B,this._update=(0,a.Yj)("configuredUpdateMethod")||I,this._forget=(0,a.Yj)("configuredForgetMethod")||E,this._reset=(0,a.Yj)("configuredResetMethod")||E,this._merge=k,this._keyInfoForResource=(0,a.Yj)("configuredKeyInfoMethod")||P,this._id=A++,this._cache={resources:new Map,resourcesByType:Object.create(null),documents:new Map,polymorphicLidBackMap:new Map}}__configureMerge(e){this._merge=e||k}upgradeIdentifier(e){return this._getRecordIdentifier(e,2)}_getRecordIdentifier(e,t){if(_(e))return e
const n=this._generate(e,"record")
let r=R(this._cache,n)
if(null!==r)return r
if(0!==t){if(2===t)e.lid=n,e[s]=this._id,r=M(e)
else{const t=this._keyInfoForResource(e,null)
t.lid=n,t[s]=this._id,r=M(t)}return O(this._cache,r),r}}peekRecordIdentifier(e){return this._getRecordIdentifier(e,0)}getOrCreateDocumentIdentifier(e){let t=e.cacheOptions?.key
if(t||(t=this._generate(e,"document")),!t)return null
let n=this._cache.documents.get(t)
return void 0===n&&(n={lid:t},S.add(n),this._cache.documents.set(t,n)),n}getOrCreateRecordIdentifier(e){return this._getRecordIdentifier(e,1)}createIdentifierForNewRecord(e){const t=this._generate(e,"record"),n=M({id:e.id||null,type:e.type,lid:t,[s]:this._id})
return O(this._cache,n),n}updateRecordIdentifier(e,t){let n=this.getOrCreateRecordIdentifier(e)
const r=this._keyInfoForResource(t,n)
let i=function(e,t,n,r){const i=t.id,{id:o,type:a,lid:s}=n,l=e.resourcesByType[n.type]
if(null!==o&&o!==i&&null!==i){const e=l&&l.id.get(i)
return void 0!==e&&e}{const n=t.type
if(null!==o&&o===i&&n===a&&b(r)&&r.lid!==s)return R(e,r.lid)||!1
if(null!==o&&o===i&&n&&n!==a&&b(r)&&r.lid===s){const t=e.resourcesByType[n],r=t&&t.id.get(i)
return void 0!==r&&r}}return!1}(this._cache,r,n,t)
const o=b(t)
if(i||n.type!==r.type&&(o&&delete t.lid,i=this.getOrCreateRecordIdentifier(t)),i){const e=n
n=this._mergeRecordIdentifiers(r,e,i,t),o&&(t.lid=n.lid)}const a=n.id;(function(e,t,n,r){r(e,n,"record"),void 0!==n.id&&(e.id=f(n.id))})(n,0,t,this._update)
const s=n.id
if(a!==s&&null!==s){const e=this._cache.resourcesByType[n.type]
e.id.set(s,n),null!==a&&e.id.delete(a)}return n}_mergeRecordIdentifiers(e,t,n,r){const i=this._merge(t,n,r),o=i===t?n:t,a=this._cache.polymorphicLidBackMap.get(o.lid)
a&&this._cache.polymorphicLidBackMap.delete(o.lid),this.forgetRecordIdentifier(o),this._cache.resources.set(o.lid,i)
const s=this._cache.polymorphicLidBackMap.get(i.lid)??[]
return s.push(o.lid),a&&a.forEach(e=>{s.push(e),this._cache.resources.set(e,i)}),this._cache.polymorphicLidBackMap.set(i.lid,s),i}forgetRecordIdentifier(e){const t=this.getOrCreateRecordIdentifier(e),n=this._cache.resourcesByType[t.type]
null!==t.id&&n.id.delete(t.id),this._cache.resources.delete(t.lid),n.lid.delete(t.lid)
const r=this._cache.polymorphicLidBackMap.get(t.lid)
r&&(r.forEach(e=>{this._cache.resources.delete(e)}),this._cache.polymorphicLidBackMap.delete(t.lid)),t[s]=void 0,this._forget(t,"record")}destroy(){T.clear(),this._cache.documents.forEach(e=>{S.delete(e)}),this._reset()}}function M(e,t,n){return e}function R(e,t,n){return e.resources.get(t)||null}function O(e,t){e.resources.set(t.lid,t)
let n=e.resourcesByType[t.type]
n||(n={lid:new Map,id:new Map},e.resourcesByType[t.type]=n),n.lid.set(t.lid,t),t.id&&n.id.set(t.id,t)}const L=(0,a.L1)("Signals",Symbol("Signals"))
function N(e){return void 0===e[L]&&function(e){e[L]=new Map}(e),e[L]}function F(e,t,n,r){const i={key:n,context:t,signal:(0,u.a)(t,n),value:r,isStale:!1}
return e.set(n,i),i}function z(e,t,n,r){let i=j(e,n)
return i||(i=F(e,t,n,r)),i}function j(e,t){return e?.get(t)}function V(e){(0,u.b)(e.signal)}function U(e){e&&(e.isStale=!0,(0,u.n)(e.signal))}function G(e,t,n,r){let i=j(e,n)
return i||(i=F(e,t,n,r)),V(i),i}function H(e,t){return{enumerable:!0,configurable:!1,get(){return G(N(this),this,e,t).value},set(n){const r=z(N(this),this,e,t)
r.value!==n&&(r.value=n,U(r))}}}function q(e,t,n){Object.defineProperty(e,t,H(t,n))}function Q(e,t,n){const r=H(t,n)
r.enumerable=!1,Object.defineProperty(e,t,r)}function $(e,t,n){const r=n.get
return n.get=function(){const e=N(this)
let n=e.get(t)
return n||(n=(0,u.c)(this,t,r.bind(this)),e.set(t,n)),n()},n}function X(e,t,n){const r=n.get,i=n.set
return n.get=function(){const e=N(this)
let n=j(e,t)
return n?n.isStale&&(n.isStale=!1,n.value=r.call(this)):n=F(e,this,t,r.call(this)),V(n),n.value},i&&(n.set=function(e){const n=N(this)
let r=j(n,t)
r||(r=F(n,this,t,void 0),r.isStale=!0),i.call(this,e)}),n}function W(e,t,n){const r=Object.assign({enumerable:!0,configurable:!1},X(0,t,n))
Object.defineProperty(e,t,r)}function Y(e){return"string"==typeof e?e:e.href}var Z=new WeakSet
class K{constructor(e,t,n){var r;(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(this,r=Z),r.add(this),this._store=e,this._localCache=n,this.identifier=t
const i=N(this)
t&&e.notifications.subscribe(t,(e,t)=>{"updated"===t&&(U(j(i,"data")),U(j(i,"links")),U(j(i,"meta")),U(j(i,"errors")))})}fetch(e=(0,r.sw)({url:"",method:"GET"})){return e.cacheOptions=e.cacheOptions||{},e.cacheOptions.key=this.identifier?.lid,h(Z,this,J).call(this,this.links.related?"related":"self",e)}next(e){return h(Z,this,J).call(this,"next",e)}prev(e){return h(Z,this,J).call(this,"prev",e)}first(e){return h(Z,this,J).call(this,"first",e)}last(e){return h(Z,this,J).call(this,"last",e)}toJSON(){const e={}
return e.identifier=this.identifier,void 0!==this.data&&(e.data=this.data),void 0!==this.links&&(e.links=this.links),void 0!==this.errors&&(e.errors=this.errors),void 0!==this.meta&&(e.meta=this.meta),e}}async function J(e,t=(0,r.sw)({url:"",method:"GET"})){const n=this.links?.[e]
return n?(t.method=t.method||"GET",Object.assign(t,{url:Y(n)}),(await this._store.request(t)).content):null}W(K.prototype,"errors",{get(){const{identifier:e}=this
if(!e){const{document:e}=this._localCache
return"errors"in e?e.errors:void 0}const t=this._store.cache.peek(e)
return"errors"in t?t.errors:void 0}}),W(K.prototype,"data",{get(){const{identifier:e,_localCache:t}=this,n=e?this._store.cache.peek(e):t.document,r="data"in n?n.data:void 0
return Array.isArray(r)?this._store.recordArrayManager.getCollection({type:e?e.lid:t.request.url,identifiers:r.slice(),doc:e?void 0:n,identifier:e??null}):r?this._store.peekRecord(r):r}}),W(K.prototype,"links",{get(){const{identifier:e}=this
return e?this._store.cache.peek(e).links:this._localCache.document.links}}),W(K.prototype,"meta",{get(){const{identifier:e}=this
return e?this._store.cache.peek(e).meta:this._localCache.document.meta}})
class ee{constructor(e,t){this.store=e,this.___identifier=t,this.___token=e.notifications.subscribe(t,(e,t,n)=>{("identity"===t||"attributes"===t&&"id"===n)&&this._ref++})}destroy(){this.store.notifications.unsubscribe(this.___token)}get type(){return this.identifier().type}id(){return this._ref,this.___identifier.id}identifier(){return this.___identifier}remoteType(){return"identity"}push(e){return Promise.resolve(e).then(e=>this.store.push(e))}value(){return this.store.peekRecord(this.___identifier)}load(){const e=this.id()
if(null!==e)return this.store.findRecord(this.type,e)}reload(){const e=this.id()
if(null!==e)return this.store.findRecord(this.type,e,{reload:!0})}}q(ee.prototype,"_ref")
class te{constructor(e){this._store=e,this._willNotify=!1,this._pendingNotifies=new Map}get identifierCache(){return this._store.identifierCache}_scheduleNotification(e,t){let n=this._pendingNotifies.get(e)
n||(n=new Set,this._pendingNotifies.set(e,n)),n.add(t),!0!==this._willNotify&&(this._willNotify=!0,this._store._cbs?this._store._schedule("notify",()=>this._flushNotifications()):this._flushNotifications())}_flushNotifications(){if(!1===this._willNotify)return
const e=this._pendingNotifies
this._pendingNotifies=new Map,this._willNotify=!1,e.forEach((e,t)=>{e.forEach(e=>{this._store.notifications.notify(t,"relationships",e)})})}notifyChange(e,t,n){"relationships"===t&&n?this._scheduleNotification(e,n):this._store.notifications.notify(e,t,n)}get schema(){return this._store.schema}setRecordId(e,t){this._store._instanceCache.setRecordId(e,t)}hasRecord(e){return Boolean(this._store._instanceCache.peek(e))}disconnectRecord(e){this._store._instanceCache.disconnect(e),this._pendingNotifies.delete(e)}}te.prototype.getSchemaDefinitionService=function(){return this._store.schema}
const ne=(0,a.L1)("CacheForIdentifierCache",new Map)
function re(e,t){ne.set(e,t)}function ie(e){ne.delete(e)}function oe(e){return ne.has(e)?ne.get(e):null}const ae=(0,a.L1)("RecordCache",new Map)
function se(e){return ae.get(e)}function le(e){return ae.get(e)}function ce(e,t){ae.set(e,t)}const ue=(0,a.L1)("StoreMap",new Map)
function de(e){return ue.get(e)}class pe{constructor(e){this.store=e,this.__instances={record:new Map,reference:new WeakMap,document:new Map},this._storeWrapper=new te(this.store),e.identifierCache.__configureMerge((e,t,n)=>{let r=e
e.id!==t.id?r="id"in n&&e.id===n.id?e:t:e.type!==t.type&&(r="type"in n&&e.type===n.type?e:t)
const i=e===r?t:e,o=this.__instances.record.has(r),a=this.__instances.record.has(i)
if(o&&a&&"id"in n)throw new Error(`Failed to update the 'id' for the RecordIdentifier '${e.type}:${String(e.id)} (${e.lid})' to '${String(n.id)}', because that id is already in use by '${t.type}:${String(t.id)} (${t.lid})'`)
return this.store.cache.patch({op:"mergeIdentifiers",record:i,value:r}),this.unloadRecord(i),r})}peek(e){return this.__instances.record.get(e)}getDocument(e){let t=this.__instances.document.get(e)
return t||(t=new K(this.store,e,null),this.__instances.document.set(e,t)),t}getRecord(e,t){let n=this.__instances.record.get(e)
if(!n){const r=this.store.cache
re(e,r),n=this.store.instantiateRecord(e,t||{}),ce(n,e),re(n,r),ue.set(n,this.store),this.__instances.record.set(e,n)}return n}getReference(e){const t=this.__instances.reference
let n=t.get(e)
return n||(n=new ee(this.store,e),t.set(e,n)),n}recordIsLoaded(e,t=!1){const n=this.cache
if(!n)return!1
const r=n.isNew(e),i=n.isEmpty(e)
return r?!n.isDeleted(e):!(t&&n.isDeletionCommitted(e)||i)}disconnect(e){this.__instances.record.get(e),this.store._graph?.remove(e),this.store.identifierCache.forgetRecordIdentifier(e),ie(e),this.store._requestCache._clearEntries(e)}unloadRecord(e){this.store._join(()=>{const t=this.__instances.record.get(e),n=this.cache
t&&(this.store.teardownRecord(t),this.__instances.record.delete(e),ue.delete(t),ae.delete(t),ie(t)),n?(n.unloadRecord(e),ie(e)):this.disconnect(e),this.store._requestCache._clearEntries(e)})}clear(e){const t=this.store.identifierCache._cache
if(void 0===e)t.resources.forEach(e=>{this.unloadRecord(e)})
else{const n=t.resourcesByType,r=n[e]?.lid
r&&r.forEach(e=>{this.unloadRecord(e)})}}setRecordId(e,t){const{type:n,lid:r}=e,o=e.id
null===o||null!==t?(this.store.identifierCache.peekRecordIdentifier({type:n,id:t}),null===e.id&&this.store.identifierCache.updateRecordIdentifier(e,{type:n,id:t}),this.store.notifications.notify(e,"identity")):(0,i.warn)(`Your ${n} record was saved to the server, but the response does not have an id.`,!(null!==o&&null===t))}}function he(e,t){return"string"==typeof e||"number"==typeof e?{type:t,id:m(e)}:le(e)}const fe=(0,a.L1)("AvailableShims",new WeakMap)
class me{constructor(e,t){this.__store=e,this.modelName=t}get fields(){const e=new Map
return this.__store.schema.fields({type:this.modelName}).forEach((t,n)=>{"attribute"!==t.kind&&"belongsTo"!==t.kind&&"hasMany"!==t.kind||e.set(n,t.kind)}),e}get attributes(){const e=new Map
return this.__store.schema.fields({type:this.modelName}).forEach((t,n)=>{"attribute"===t.kind&&e.set(n,t)}),e}get relationshipsByName(){const e=new Map
return this.__store.schema.fields({type:this.modelName}).forEach((t,n)=>{"belongsTo"!==t.kind&&"hasMany"!==t.kind||e.set(n,t)}),e}eachAttribute(e,t){this.__store.schema.fields({type:this.modelName}).forEach((n,r)=>{"attribute"===n.kind&&e.call(t,r,n)})}eachRelationship(e,t){this.__store.schema.fields({type:this.modelName}).forEach((n,r)=>{"belongsTo"!==n.kind&&"hasMany"!==n.kind||e.call(t,r,n)})}eachTransformedAttribute(e,t){this.__store.schema.fields({type:this.modelName}).forEach((n,r)=>{if("attribute"===n.kind){const i=n.type
i&&e.call(t,r,i)}})}}function ge(e){return"added"===e||"state"===e||"updated"===e||"removed"===e||"invalidated"===e}class ye{constructor(e){this.store=e,this.isDestroyed=!1,this._buffered=new Map,this._hasFlush=!1,this._cache=new Map}subscribe(e,t){let n=this._cache.get(e)
return t.for=e,n||(n=[],this._cache.set(e,n)),n.push(t),t}unsubscribe(e){this.isDestroyed||function(e,t){const n=e.for
if(n){const r=t.get(n)
if(!r)return
const i=r.indexOf(e)
if(-1===i)return
r.splice(i,1)}}(e,this._cache)}notify(e,t,n){if(!_(e)&&!C(e))return!1
const r=Boolean(this._cache.get(e)?.length)
if(ge(t)||r){let r=this._buffered.get(e)
r||(r=[],this._buffered.set(e,r)),r.push([t,n]),this._scheduleNotify()}return r}_onNextFlush(e){this._onFlushCB=e}_scheduleNotify(){const e=this.store._enableAsyncFlush
return!(this._hasFlush&&!1!==e&&!(0,u.d)()||(e&&!(0,u.d)()?(this._hasFlush=!0,1):(this._flush(),0)))}_flush(){const e=this._buffered
e.size&&(this._buffered=new Map,e.forEach((e,t)=>{e.forEach(e=>{this._flushNotification(t,e[0],e[1])})})),this._hasFlush=!1,this._onFlushCB?.(),this._onFlushCB=void 0}_flushNotification(e,t,n){if(ge(t)){const n=this._cache.get(C(e)?"document":"resource")
n&&n.forEach(n=>{n(e,t)})}const r=this._cache.get(e)
return!(!r||!r.length||(r.forEach(r=>{r(e,t,n)}),0))}destroy(){this.isDestroyed=!0,this._cache.clear()}}function ve(e,t){return Boolean(e&&"number"!=typeof t&&e.has(t))}const be=Proxy,xe=new Set([Symbol.iterator,"concat","entries","every","fill","filter","find","findIndex","flat","flatMap","forEach","includes","indexOf","join","keys","lastIndexOf","map","reduce","reduceRight","slice","some","values"]),Se=new Set(["push","pop","unshift","shift","splice","sort"]),_e=new Set(["[]","length","links","meta"])
function Ce(e){return xe.has(e)}function we(e,t){return t in e}const Te=(0,a.L1)("#source",Symbol("#source")),Ae=(0,a.L1)("#update",Symbol("#update")),Ie=(0,a.L1)("IS_COLLECTION",Symbol.for("Collection"))
function Pe(e){if("symbol"==typeof e)return null
const t=Number(e)
return isNaN(t)?null:t%1==0?t:null}const Be=["_updatingPromise","isDestroying","isDestroyed","query","isUpdating","isLoaded","meta","links","isAsync","isPolymorphic","identifier","cache","_inverseIsAsync","key","DEPRECATED_CLASS_NAME"]
class Ee{destroy(e){this.isDestroying=!e,this[Te].length=0,U(this[u.A]),this.isDestroyed=!e}constructor(e){p(this,"isLoaded",!0),p(this,"isDestroying",!1),p(this,"isDestroyed",!1),p(this,"_updatingPromise",null),p(this,"identifier",void 0)
const t=this
this.modelName=e.type,this.store=e.store,this._manager=e.manager,this.identifier=e.identifier||null,this[Te]=e.identifiers,this[Ie]=!0
const n=N(this),r=e.store,i=new Map,o={links:e.links||null,meta:e.meta||null}
let a=!1,s=null
const l=e.field&&this.store.schema.CAUTION_MEGA_DANGER_ZONE_arrayExtensions?this.store.schema.CAUTION_MEGA_DANGER_ZONE_arrayExtensions(e.field):null,c=new be(this[Te],{get(c,d,p){const h=Pe(d)
if(s.isStale&&(null!==h||_e.has(d)||Ce(d))&&(e.manager._syncArray(p),s.isStale=!1),null!==h){const e=c[h]
return a||V(s),e&&r._instanceCache.getRecord(e)}if(d===u.A)return s
if("length"===d)return V(s),c.length
if("meta"===d)return V(s),o.meta
if("links"===d)return V(s),o.links
if("[]"===d)return V(s),p
if(Ce(d)){let e=i.get(d)
return void 0===e&&(e="forEach"===d?function(){V(s),a=!0
const e=function(e,t,n,r,i){void 0===i&&(i=null)
const o=(t=t.slice()).length
for(let a=0;a<o;a++)r.call(i,n._instanceCache.getRecord(t[a]),a,e)
return e}(p,c,r,arguments[0],arguments[1])
return a=!1,e}:function(){V(s),a=!0
const e=Reflect.apply(c[d],p,arguments)
return a=!1,e},i.set(d,e)),e}if(function(e){return Se.has(e)}(d)){let t=i.get(d)
return void 0===t&&(t=function(){if(!e.allowMutation)return
const t=Array.prototype.slice.call(arguments)
a=!0
const n=e[Ae](c,p,d,t,s)
return a=!1,n},i.set(d,t)),t}if(we(t,d)){if(d===Te)return t[d]
let e=i.get(d)
if(e)return e
const n=t[d]
return"function"==typeof n?(e=function(){return V(s),Reflect.apply(n,p,arguments)},i.set(d,e),e):(V(s),n)}return ve(l,d)?function(e,t,n,r,i,o,a){const s=t.get(r)
switch(s.kind){case"method":{let t=o.get(r)
return void 0===t&&(t=function(){V(i),a(!0)
const t=Reflect.apply(s.fn,e,arguments)
return a(!1),t},o.set(r,t)),t}case"mutable-field":case"readonly-field":return s.get.call(e)
case"readonly-value":return s.value
case"mutable-value":return z(n,e,r,s.value).value
default:return}}(p,l,n,d,s,i,e=>{a=e}):c[d]},set(r,i,c,u){if(!e.allowMutation&&!Be.includes(i))return!1
if("length"===i){if(!a&&0===c)return a=!0,e[Ae](r,u,"length 0",[],s),a=!1,!0
if(a)return Reflect.set(r,i,c)}if("links"===i)return o.links=c||null,!0
if("meta"===i)return o.meta=c||null,!0
if(ve(l,i))return function(e,t,n,r,i){const o=t.get(r)
switch(o.kind){case"method":case"readonly-value":case"readonly-field":default:return!1
case"mutable-value":{const t=z(n,e,r,o.value)
return t.value!==i&&(t.value=i),!0}case"writeonly-field":case"mutable-field":return o.set.call(e,i),!0}}(u,l,n,i,c)
const d=Pe(i)
if(null===d||d>r.length){if(null!==d&&a){const e=le(c)
return r[d]=e,!0}return!!we(t,i)&&(t[i]=c,!0)}const p=r[d],h=(f=c)?le(f):null
var f
return a?r[d]=h:e[Ae](r,u,"replace cell",[d,p,h],s),!0},deleteProperty:(e,t)=>!!a&&Reflect.deleteProperty(e,t),getPrototypeOf:()=>Array.prototype})
return s=G(n,c,u.A,void 0),c}update(){if(this.isUpdating)return this._updatingPromise
this.isUpdating=!0
const e=this._update()
return e.finally(()=>{this._updatingPromise=null,this.isDestroying||this.isDestroyed||(this.isUpdating=!1)}),this._updatingPromise=e,e}_update(){return this.store.findAll(this.modelName,{reload:!0})}save(){return Promise.all(this.map(e=>this.store.saveRecord(e))).then(()=>this)}}Object.defineProperty(Ee.prototype,"[]",{enumerable:!0,configurable:!1,get:function(){return this}}),q(Ee.prototype,"isUpdating",!1)
class ke extends Ee{constructor(e){super(e),p(this,"query",null),this.query=e.query||null,this.isLoaded=e.isLoaded||!1}_update(){const{store:e,query:t}=this
return e.query(this.modelName,t,{_recordArray:this})}destroy(e){super.destroy(e),this._manager._managed.delete(this),this._manager._pending.delete(this)}}ke.prototype.query=null
const De=(0,a.L1)("FAKE_ARR",{}),Me=1200
function Re(e,t){let n=0
const r=t.length
for(;r-n>Me;)e.push.apply(e,t.slice(n,n+Me)),n+=Me
e.push.apply(e,t.slice(n))}class Oe{constructor(e){this.store=e.store,this.isDestroying=!1,this.isDestroyed=!1,this._live=new Map,this._managed=new Set,this._pending=new Map,this._staged=new Map,this._keyedArrays=new Map,this._identifiers=new Map,this._set=new Map,this._visibilitySet=new Map,this._subscription=this.store.notifications.subscribe("document",(e,t)=>{if("updated"===t&&this._keyedArrays.has(e.lid)){const t=this._keyedArrays.get(e.lid)
this.dirtyArray(t,0,!0)}}),this._subscription=this.store.notifications.subscribe("resource",(e,t)=>{"added"===t?(this._visibilitySet.set(e,!0),this.identifierAdded(e)):"removed"===t?(this._visibilitySet.set(e,!1),this.identifierRemoved(e)):"state"===t&&this.identifierChanged(e)})}_syncArray(e){const t=this._pending.get(e),n=Fe(e)
if((n||t)&&!this.isDestroying&&!this.isDestroyed&&(t&&(function(e,t,n){const r=e[Te],i=[],o=[]
t.forEach((e,t)=>{if("add"===e){if(n.has(t))return
i.push(t),n.add(t)}else n.has(t)&&(o.push(t),n.delete(t))}),o.length&&(o.length===r.length?r.length=0:o.forEach(e=>{const t=r.indexOf(e);-1!==t&&(r.splice(t,1),n.delete(e))})),i.length&&Re(r,i)}(e,t,this._set.get(e)),this._pending.delete(e)),n)&&"cache-sync"===e[u.A].value){const t=this.store.cache.peek(e.identifier),n="data"in t&&Array.isArray(t.data)?t.data:[]
this.populateManagedArray(e,n,null)}}mutate(e){this.store.cache.mutate(e)}liveArrayFor(e){let t=this._live.get(e)
const n=[],r=this._staged.get(e)
return r&&(r.forEach((e,t)=>{"add"===e&&n.push(t)}),this._staged.delete(e)),t||(t=new Ee({type:e,identifiers:n,store:this.store,allowMutation:!1,manager:this}),this._live.set(e,t),this._set.set(t,new Set(n))),t}getCollection(e){if(e.identifier&&this._keyedArrays.has(e.identifier.lid))return this._keyedArrays.get(e.identifier.lid)
const t={type:e.type,identifier:e.identifier||null,links:e.doc?.links||null,meta:e.doc?.meta||null,query:e.query||null,identifiers:e.identifiers||[],isLoaded:!!e.identifiers?.length,allowMutation:!1,store:this.store,manager:this},n=new ke(t)
return this._managed.add(n),this._set.set(n,new Set(t.identifiers||[])),e.identifier&&this._keyedArrays.set(e.identifier.lid,n),e.identifiers&&Le(this._identifiers,n,e.identifiers),n}dirtyArray(e,t,n){if(e===De)return
const r=e[u.A];(!r.isStale||t>0)&&(U(r),r.value=n?"cache-sync":"patch")}_getPendingFor(e,t,n){if(this.isDestroying||this.isDestroyed)return
const r=this._live.get(e.type),i=this._pending,o=new Map
if(t){const t=this._identifiers.get(e)
t&&t.forEach(e=>{let t=i.get(e)
t||(t=new Map,i.set(e,t)),o.set(e,t)})}if(r&&0===r[Te].length&&n){const e=i.get(r)
if(!e||0===e.size)return o}if(r){let e=i.get(r)
e||(e=new Map,i.set(r,e)),o.set(r,e)}else{let t=this._staged.get(e.type)
t||(t=new Map,this._staged.set(e.type,t)),o.set(De,t)}return o}populateManagedArray(e,t,n){this._pending.delete(e)
const r=e[Te],i=r.slice()
r.length=0,Re(r,t),this._set.set(e,new Set(t)),Fe(e)||(U(e[u.A]),e.meta=n?.meta||null,e.links=n?.links||null),e.isLoaded=!0,function(e,t,n){for(let r=0;r<n.length;r++)Ne(e,t,n[r])}(this._identifiers,e,i),Le(this._identifiers,e,t)}identifierAdded(e){const t=this._getPendingFor(e,!1)
t&&t.forEach((t,n)=>{"del"===t.get(e)?t.delete(e):(t.set(e,"add"),this.dirtyArray(n,t.size,!1))})}identifierRemoved(e){const t=this._getPendingFor(e,!0,!0)
t&&t.forEach((t,n)=>{"add"===t.get(e)?t.delete(e):(t.set(e,"del"),this.dirtyArray(n,t.size,!1))})}identifierChanged(e){const t=this.store._instanceCache.recordIsLoaded(e,!0)
this._visibilitySet.get(e)!==t&&(t?this.identifierAdded(e):this.identifierRemoved(e))}clear(e=!0){this._live.forEach(t=>t.destroy(e)),this._managed.forEach(t=>t.destroy(e)),this._managed.clear(),this._identifiers.clear(),this._pending.clear(),this._set.forEach(e=>e.clear()),this._visibilitySet.clear()}destroy(){this.isDestroying=!0,this.clear(!1),this._live.clear(),this.isDestroyed=!0,this.store.notifications.unsubscribe(this._subscription)}}function Le(e,t,n){for(let r=0;r<n.length;r++){const i=n[r]
let o=e.get(i)
o||(o=new Set,e.set(i,o)),o.add(t)}}function Ne(e,t,n){const r=e.get(n)
r&&r.delete(t)}function Fe(e){return null!==e.identifier}const ze=(0,a.L1)("Touching",Symbol("touching")),je=(0,a.L1)("RequestPromise",Symbol("promise")),Ve=[]
class Ue{constructor(e){p(this,"_pending",new Map),p(this,"_done",new Map),p(this,"_subscriptions",new Map),p(this,"_toFlush",[]),p(this,"_store",void 0),this._store=e}_clearEntries(e){this._done.delete(e)}_enqueue(e,t){const n=t.data[0]
if("recordIdentifier"in n){const r=n.recordIdentifier,i="saveRecord"===n.op?"mutation":"query"
this._pending.has(r)||this._pending.set(r,[])
const o={state:"pending",request:t,type:i}
return o[ze]=[n.recordIdentifier],o[je]=e,this._pending.get(r).push(o),this._triggerSubscriptions(o),e.then(e=>{this._dequeue(r,o)
const n={state:"fulfilled",request:t,type:i,response:{data:e}}
return n[ze]=o[ze],this._addDone(n),this._triggerSubscriptions(n),e},e=>{this._dequeue(r,o)
const n={state:"rejected",request:t,type:i,response:{data:e}}
throw n[ze]=o[ze],this._addDone(n),this._triggerSubscriptions(n),e})}}_triggerSubscriptions(e){"pending"!==e.state?(this._toFlush.push(e),1===this._toFlush.length&&this._store.notifications._onNextFlush(()=>{this._flush()})):this._flushRequest(e)}_flush(){this._toFlush.forEach(e=>{this._flushRequest(e)}),this._toFlush=[]}_flushRequest(e){e[ze].forEach(t=>{const n=this._subscriptions.get(t)
n&&n.forEach(t=>t(e))})}_dequeue(e,t){const n=this._pending.get(e)
this._pending.set(e,n.filter(e=>e!==t))}_addDone(e){e[ze].forEach(t=>{const n=e.request.data[0].op
let r=this._done.get(t)
r&&(r=r.filter(e=>{let t
return t=Array.isArray(e.request.data)?e.request.data[0]:e.request.data,t.op!==n})),r=r||[],r.push(e),this._done.set(t,r)})}subscribeForRecord(e,t){let n=this._subscriptions.get(e)
n||(n=[],this._subscriptions.set(e,n)),n.push(t)}getPendingRequestsForRecord(e){return this._pending.get(e)||Ve}getLastRequestForRecord(e){const t=this._done.get(e)
return t?t[t.length-1]:null}}function Ge(e){return Boolean(e&&"string"==typeof e)}function He(e,t,n){if("object"==typeof e&&null!==e){const t=e
return _(t)||"id"in t&&(t.id=f(t.id)),t}{const r=f(t)
if(!Ge(r)){if(Ge(n))return{lid:n}
throw new Error("Expected either id or lid to be a valid string")}return Ge(n)?{type:e,id:r,lid:n}:{type:e,id:r}}}globalThis.setWarpDriveLogging=o.q,globalThis.getWarpDriveRuntimeConfig=o.P
const qe=class{constructor(e){}},Qe=qe.default?qe.default:qe
Qe!==qe&&(0,i.deprecate)("The Store class extending from EmberObject is deprecated.\nPlease remove usage of EmberObject APIs and mark your class as not requiring it.\n\nTo mark the class as no longer extending from EmberObject, in ember-cli-build.js\nset the following config:\n\n```js\nconst app = new EmberApp(defaults, {\n  emberData: {\n    deprecations: {\n      DEPRECATE_STORE_EXTENDS_EMBER_OBJECT: false\n    }\n  }\n});\n```\n",!1,{id:"ember-data:deprecate-store-extends-ember-object",until:"6.0",for:"ember-data",url:"https://deprecations.emberjs.com/id/ember-data-deprecate-store-extends-ember-object",since:{available:"4.13",enabled:"5.4"}})
class $e extends Qe{get schema(){return this._schema||(this._schema=this.createSchemaService()),this._schema}get isDestroying(){return this._isDestroying}set isDestroying(e){this._isDestroying=e}get isDestroyed(){return this._isDestroyed}set isDestroyed(e){this._isDestroyed=e}constructor(e){super(e),Object.assign(this,e),this.identifierCache=new D,this.notifications=new ye(this),this.recordArrayManager=new Oe({store:this}),this._requestCache=new Ue(this),this._instanceCache=new pe(this),this.isDestroying=!1,this.isDestroyed=!1}_run(e){const t=this._cbs={}
e(),t.coalesce&&t.coalesce(),t.sync&&t.sync(),t.notify&&t.notify(),this._cbs=null}_join(e){this._cbs?e():this._run(e)}_schedule(e,t){this._cbs[e]=t}getRequestStateService(){return this._requestCache}_getAllPending(){}request(e){const t={store:this,[r._q]:e[r._q]??!0}
if(e.records){const n=this.identifierCache
t.records=e.records.map(e=>n.getOrCreateRecordIdentifier(e))}const n=Object.assign({},e,t),i=this.requestManager.request(n)
return i.onFinalize(()=>{("findBelongsTo"!==e.op||e.url)&&this.notifications._flush()}),i}modelFor(e){return function(e,t){let n=fe.get(e)
n||(n=Object.create(null),fe.set(e,n))
let r=n[t]
return void 0===r&&(r=n[t]=new me(e,t)),r}(this,e)}createRecord(e,t){let n
return this._join(()=>{const r=g(e),i={...t}
let o=null
if(null===i.id||void 0===i.id){const e=this.adapterFor?.(r,!0)
o=e&&e.generateIdForRecord?i.id=f(e.generateIdForRecord(this,r,i)):i.id=null}else o=i.id=f(i.id)
const a={type:r,id:o}
a.id&&this.identifierCache.peekRecordIdentifier(a)
const s=this.identifierCache.createIdentifierForNewRecord(a),l=this.cache,c=function(e,t,n){if(void 0!==n){const{type:r}=t,i=e.schema.fields({type:r})
if(i.size){const e=Object.keys(n)
for(let t=0;t<e.length;t++){const r=e[t],o=i.get(r)
o&&("hasMany"===o.kind?n[r]=We(n[r]):"belongsTo"===o.kind&&(n[r]=Ye(n[r])))}}}return n}(this,s,i),u=l.clientDidCreate(s,c)
n=this._instanceCache.getRecord(s,u)}),n}deleteRecord(e){const t=se(e),n=this.cache
this._join(()=>{n.setIsDeleted(t,!0),n.isNew(t)&&this._instanceCache.unloadRecord(t)})}unloadRecord(e){const t=se(e)
t&&this._instanceCache.unloadRecord(t)}findRecord(e,t,n){Xe(e)?n=t:e=He(g(e),m(t))
const i=this.identifierCache.getOrCreateRecordIdentifier(e)
return(n=n||{}).preload&&(this._instanceCache.recordIsLoaded(i)||(n.reload=!0),this._join(()=>{!function(e,t,n){const r={},i=e.schema.fields(t)
Object.keys(n).forEach(e=>{const t=n[e],o=i.get(e)
!o||"hasMany"!==o.kind&&"belongsTo"!==o.kind?(r.attributes||(r.attributes={}),r.attributes[e]=t):(r.relationships||(r.relationships={}),r.relationships[e]=function(e,t){const n=e.type
return"hasMany"===e.kind?{data:t.map(e=>he(e,n))}:{data:t?he(t,n):null}}(o,t))})
const o=e.cache,a=Boolean(e._instanceCache.peek(t))
o.upsert(t,r,a)}(this,i,n.preload)})),this.request({op:"findRecord",data:{record:i,options:n},cacheOptions:{[r.ER]:!0}}).then(e=>e.content)}getReference(e,t){let n
n=1===arguments.length&&Xe(e)?e:He(g(e),m(t))
const r=this.identifierCache.getOrCreateRecordIdentifier(n)
return this._instanceCache.getReference(r)}peekRecord(e,t){if(1===arguments.length&&Xe(e)){const t=this.identifierCache.peekRecordIdentifier(e)
return t&&this._instanceCache.recordIsLoaded(t)?this._instanceCache.getRecord(t):null}const n={type:g(e),id:m(t)},r=this.identifierCache.peekRecordIdentifier(n)
return r&&this._instanceCache.recordIsLoaded(r)?this._instanceCache.getRecord(r):null}query(e,t,n={}){return this.request({op:"query",data:{type:g(e),query:t,options:n},cacheOptions:{[r.ER]:!0}}).then(e=>e.content)}queryRecord(e,t,n){return this.request({op:"queryRecord",data:{type:g(e),query:t,options:n||{}},cacheOptions:{[r.ER]:!0}}).then(e=>e.content)}findAll(e,t={}){return this.request({op:"findAll",data:{type:g(e),options:t||{}},cacheOptions:{[r.ER]:!0}}).then(e=>e.content)}peekAll(e){return this.recordArrayManager.liveArrayFor(g(e))}unloadAll(e){this._join(()=>{void 0===e?(this._graph?.identifiers.clear(),this.recordArrayManager.clear(),this._instanceCache.clear()):this._instanceCache.clear(g(e))})}push(e){const t=this._push(e,!1)
return Array.isArray(t)?t.map(e=>this._instanceCache.getRecord(e)):null===t?null:this._instanceCache.getRecord(t)}_push(e,t){let n
return t&&(this._enableAsyncFlush=!0),this._join(()=>{n=this.cache.put({content:e})}),this._enableAsyncFlush=null,"data"in n?n.data:null}saveRecord(e,t={}){const n=le(e),i=this.cache
if(!n)return Promise.reject(new Error("Record Is Disconnected"))
if(function(e,t){const n=e.cache
return!n||function(e,t){return t.isDeletionCommitted(e)||t.isNew(e)&&t.isDeleted(e)}(t,n)}(this._instanceCache,n))return Promise.resolve(e)
t||(t={})
let o="updateRecord"
i.isNew(n)?o="createRecord":i.isDeleted(n)&&(o="deleteRecord")
const a={op:o,data:{options:t,record:n},records:[n],cacheOptions:{[r.ER]:!0}}
return this.request(a).then(e=>e.content)}get cache(){let{cache:e}=this._instanceCache
return e||(e=this._instanceCache.cache=this.createCache(this._instanceCache._storeWrapper)),e}destroy(){this.isDestroyed||(this.isDestroying=!0,this._graph?.destroy(),this._graph=void 0,this.notifications.destroy(),this.recordArrayManager.destroy(),this.identifierCache.destroy(),this.unloadAll(),this.isDestroyed=!0)}static create(e){return new this(e)}}function Xe(e){return Boolean(null!==e&&"object"==typeof e&&("id"in e&&"type"in e&&e.id&&e.type||e.lid))}function We(e){return e.map(e=>Ye(e))}function Ye(e){return e?le(e):null}function Ze(e,t,n,r,i){const o=t
switch(n){case"length 0":return Reflect.set(e,"length",0),it(o,[],i),!0
case"replace cell":{const[t,n,a]=r
return e[t]=a,function(e,t,n){ot(e,{op:"replaceRelatedRecord",record:e.identifier,field:e.key,...t},n)}(o,{value:a,prior:n,index:t},i),!0}case"push":{const a=Je(r)
tt(o,e,e=>e.push(...a),"Cannot push duplicates to a hasMany's state.")
{const a=new Set(e),s=new Set
r.forEach(e=>{const t=le(e)
a.has(t)||(a.add(t),s.add(e))})
const l=Array.from(s),c=Reflect.apply(e[n],t,l)
return l.length&&nt(o,{value:Je(l)},i),c}}case"pop":{const a=Reflect.apply(e[n],t,r)
return a&&rt(o,{value:le(a)},i),a}case"unshift":{const a=Je(r)
tt(o,e,e=>e.unshift(...a),"Cannot unshift duplicates to a hasMany's state.")
{const a=new Set(e),s=new Set
r.forEach(e=>{const t=le(e)
a.has(t)||(a.add(t),s.add(e))})
const l=Array.from(s),c=Reflect.apply(e[n],t,l)
return l.length&&nt(o,{value:Je(l),index:0},i),c}}case"shift":{const a=Reflect.apply(e[n],t,r)
return a&&rt(o,{value:le(a),index:0},i),a}case"sort":{const a=Reflect.apply(e[n],t,r)
return function(e,t,n){ot(e,{op:"sortRelatedRecords",record:e.identifier,field:e.key,value:t},n)}(o,a.map(le),i),a}case"splice":{const[a,s,...l]=r
if(0===a&&s===o[Te].length){const r=Je(l)
tt(o,e,e=>e.splice(a,s,...r),"Cannot replace a hasMany's state with a new state that contains duplicates.")
{const r=new Set(l),c=Array.from(r),u=[a,s].concat(c),d=Reflect.apply(e[n],t,u)
return it(o,Je(c),i),d}}const c=Je(l)
tt(o,e,e=>e.splice(a,s,...c),"Cannot splice a hasMany's state with a new state that contains duplicates.")
{const r=e.slice()
r.splice(a,s)
const c=new Set(r),u=[]
l.forEach(e=>{const t=le(e)
c.has(t)||(c.add(t),u.push(e))})
const d=[a,s,...u],p=Reflect.apply(e[n],t,d)
return s>0&&rt(o,{value:p.map(le),index:a},i),u.length>0&&nt(o,{value:Je(u),index:a},i),p}}}}$e.prototype.getSchemaDefinitionService=function(){return(0,i.deprecate)("Use `store.schema` instead of `store.getSchemaDefinitionService()`",!1,{id:"ember-data:schema-service-updates",until:"6.0",for:"ember-data",since:{available:"4.13",enabled:"5.4"}}),this._schema},$e.prototype.registerSchemaDefinitionService=function(e){(0,i.deprecate)("Use `store.createSchemaService` instead of `store.registerSchemaDefinitionService()`",!1,{id:"ember-data:schema-service-updates",until:"6.0",for:"ember-data",since:{available:"4.13",enabled:"5.4"}}),this._schema=e},$e.prototype.registerSchema=function(e){(0,i.deprecate)("Use `store.createSchemaService` instead of `store.registerSchema()`",!1,{id:"ember-data:schema-service-updates",until:"6.0",for:"ember-data",since:{available:"4.13",enabled:"5.4"}}),this._schema=e}
class Ke extends Ee{constructor(e){e[Ae]=Ze,super(e),this.isLoaded=e.isLoaded||!1,this.isAsync=e.isAsync||!1,this.isPolymorphic=e.isPolymorphic||!1,this.identifier=e.identifier,this.key=e.key}notify(){U(this[u.A])}reload(e){return this._manager.reloadHasMany(this.key,e)}createRecord(e){const{store:t}=this,n=t.createRecord(this.modelName,e)
return this.push(n),n}destroy(){super.destroy(!1)}}function Je(e){return e.map(et)}function et(e){return le(e)}function tt(e,t,n,r){const o=t.slice()
if(n(o),o.length!==new Set(o).size){const t=o.filter((e,t)=>o.indexOf(e)!==t);(0,i.deprecate)(`${r} This behavior is deprecated. Found duplicates for the following records within the new state provided to \`<${e.identifier.type}:${e.identifier.id||e.identifier.lid}>.${e.key}\`\n\t- ${Array.from(new Set(t)).map(e=>_(e)?e.lid:le(e).lid).sort((e,t)=>e.localeCompare(t)).join("\n\t- ")}`,!1,{id:"ember-data:deprecate-many-array-duplicates",for:"ember-data",until:"6.0",since:{enabled:"5.3",available:"4.13"}})}}function nt(e,t,n){ot(e,{op:"add",record:e.identifier,field:e.key,...t},n)}function rt(e,t,n){ot(e,{op:"remove",record:e.identifier,field:e.key,...t},n)}function it(e,t,n){ot(e,{op:"replaceRelatedRecords",record:e.identifier,field:e.key,value:t},n)}function ot(e,t,n){e._manager.mutate(t),U(n)}Ke.prototype.isAsync=!1,Ke.prototype.isPolymorphic=!1,Ke.prototype.identifier=null,Ke.prototype.cache=null,Ke.prototype._inverseIsAsync=!1,Ke.prototype.key="",Ke.prototype.DEPRECATED_CLASS_NAME="ManyArray",new WeakMap
const at={}
function st(e,t,n){let r={...Object.getOwnPropertyDescriptor(e,t)}
for(let i of n)r=i(e,t,r)||r
void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(e):void 0,r.initializer=void 0),Object.defineProperty(e,t,r)}q(at,"reason",null),q(at,"value",null),q(at,"result",null),q(at,"error",null),q(at,"status","pending"),q(at,"isPending",!0),q(at,"isLoading",!0),q(at,"isSuccess",!1),q(at,"isError",!1),Symbol.for("LegacyPromiseProxy")
const lt=Symbol.dispose||Symbol.for("dispose")
class ct{constructor(e,t){p(this,"retry",async()=>{this._maybeUpdate("reload"),await this._localRequest}),p(this,"refresh",async()=>{this._maybeUpdate("refresh"),await this._latestRequest}),this._args=t,this.store=e,this._subscribedTo=null,this._subscription=null,this._intervalStart=null,this._invalidated=!1,this._nextInterval=null,this.isDestroyed=!1,this[lt]=dt,this._installListeners(),this._beginPolling()}async _beginPolling(){try{this.isIdle||await this.request}catch{}finally{this.isDestroyed||this._scheduleInterval()}}get isIdle(){const{request:e,query:t}=this._args
return Boolean(!e&&!t)}get autorefreshTypes(){const{autorefresh:e}=this._args
let t
return t=!0===e?["online","invalid"]:"string"==typeof e?e.split(","):[],new Set(t)}async _scheduleInterval(){const{autorefreshThreshold:e}=this._args
if("undefined"!=typeof window&&"number"==typeof e&&e>0&&this.autorefreshTypes.has("interval")&&null===this._intervalStart){if(this._latestRequest){try{await this._latestRequest}catch{}if(this.isDestroyed)return}this._intervalStart=Date.now(),this._nextInterval=setTimeout(()=>{this._maybeUpdate()},e)}}_clearInterval(){this._nextInterval&&(clearTimeout(this._nextInterval),this._intervalStart=null)}_updateSubscriptions(){if(this.isIdle)return
const e=this._request.lid
if(this._subscribedTo===e)return
this._removeSubscriptions()
const{store:t}=this
e&&ut(t)&&(this._subscribedTo=e,this._subscription=t.notifications.subscribe(e,(n,r)=>{if(!this._isUpdating)switch(r){case"invalidated":this.autorefreshTypes.has("invalid")&&(this._invalidated=!0,this._maybeUpdate())
break
case"state":{const n=t.requestManager._deduped.get(e),r=n?.priority,i=this.reqState
r?r.blocking&&!i.isLoading?(this.isRefreshing=!1,this._maybeUpdate("policy",!0)):this.isRefreshing=!0:this.isRefreshing=!1}}}))}_removeSubscriptions(){this._subscription&&ut(this.store)&&(this.store.notifications.unsubscribe(this._subscription),this._subscribedTo=null,this._subscription=null)}_installListeners(){"undefined"!=typeof window&&(this.isOnline=window.navigator.onLine,this._unavailableStart=this.isOnline?null:Date.now(),this.isHidden="hidden"===document.visibilityState,this._onlineChanged=e=>{this.isOnline="online"===e.type,"offline"===e.type&&null===this._unavailableStart&&(this._unavailableStart=Date.now()),this._maybeUpdate()},this._backgroundChanged=()=>{const e="hidden"===document.visibilityState
this.isHidden=e,e&&null===this._unavailableStart&&(this._unavailableStart=Date.now()),this._maybeUpdate()},window.addEventListener("online",this._onlineChanged,{passive:!0,capture:!0}),window.addEventListener("offline",this._onlineChanged,{passive:!0,capture:!0}),document.addEventListener("visibilitychange",this._backgroundChanged,{passive:!0,capture:!0}))}_maybeUpdate(e,t){if(this.isIdle)return
if(!Boolean(this.isOnline&&!this.isHidden&&(e||this.autorefreshTypes.size))){if(!t&&e&&"_invalidated"!==e)throw new Error("Reload not available: the network is not online or the tab is hidden")
return}const{autorefreshTypes:n}=this
let i=this._invalidated||Boolean(e)
if(!i&&n.has("online")){const{_unavailableStart:e}=this,{autorefreshThreshold:t}=this._args,n="number"==typeof t?t:3e4
i=Boolean(e&&Date.now()-e>n)}if(!i&&n.has("interval")){const{_intervalStart:e}=this,{autorefreshThreshold:t}=this._args
e&&"number"==typeof t&&t>0&&(i=Boolean(Date.now()-e>=t))}if(this._unavailableStart=null,this._invalidated=!1,i){this._clearInterval()
const t=Object.assign({},this.reqState.request),n=("_invalidated"===e?null:e)??this._args.autorefreshBehavior??"policy"
switch(n){case"reload":t.cacheOptions=Object.assign({},t.cacheOptions,{reload:!0})
break
case"refresh":t.cacheOptions=Object.assign({},t.cacheOptions,{backgroundReload:!0})
break
case"policy":break
default:throw new Error(`Invalid ${e?"update mode":"@autorefreshBehavior"} for <Request />: ${n}`)}const i=!0===t[r._q],o=t.store||this.store,a=i&&"requestManager"in o?o.requestManager:o
this._isUpdating=!0,this._latestRequest=a.request(t),"refresh"!==n&&(this._localRequest=this._latestRequest),this._scheduleInterval(),this._latestRequest.finally(()=>{this._isUpdating=!1})}}get errorFeatures(){return{isHidden:this.isHidden,isOnline:this.isOnline,retry:this.retry}}get contentFeatures(){const e={isHidden:this.isHidden,isOnline:this.isOnline,reload:this.retry,refresh:this.refresh,isRefreshing:this.isRefreshing,latestRequest:this._latestRequest}
return e.isRefreshing&&(e.abort=()=>{this._latestRequest?.abort()}),e}get _request(){const{request:e,query:t}=this._args,{_localRequest:n,_originalRequest:r,_originalQuery:i}=this
return n&&e===r&&t===i?n:(this._originalQuery=t,this._originalRequest=e,e||this.store.request(t))}get request(){{const e=this._request
return this._updateSubscriptions(),e}}get reqState(){return function(e){let t=pt.get(e)
return t||(t=function(e){const t=(0,d.g)(e),n=Object.create(mt)
return n._request=e,t?t.isError?(n.error=t.result,n.reason=t.result,n.status="rejected",n.isError=!0,n.isPending=!1,n.isLoading=!1,n.request=t.result.request,n.response=t.result.response):(n.result=t.result.content,n.value=t.result.content,n.status="fulfilled",n.isSuccess=!0,n.isPending=!1,n.isLoading=!1,n.request=t.result.request,n.response=t.result.response):e.then(t=>{(0,d.s)(e,{isError:!1,result:t}),n.result=t.content,n.value=t.content,n.status="fulfilled",n.isSuccess=!0,n.isPending=!1,n.isLoading=!1,n.request=t.request,n.response=t.response},t=>{(0,d.s)(e,{isError:!0,result:t}),n.error=t,n.reason=t,n.status="rejected",n.isError=!0,n.isPending=!1,n.isLoading=!1,n.request=t.request,n.response=t.response}),n}(e),pt.set(e,t)),t}(this.request)}get result(){return this.reqState.result}}function ut(e){return"requestManager"in e}function dt(){const e=this
e.isDestroyed=!0,e._removeSubscriptions(),"undefined"!=typeof window&&(e._clearInterval(),window.removeEventListener("online",e._onlineChanged,{passive:!0,capture:!0}),window.removeEventListener("offline",e._onlineChanged,{passive:!0,capture:!0}),document.removeEventListener("visibilitychange",e._backgroundChanged,{passive:!0,capture:!0}))}st((l=ct).prototype,"isIdle",[$]),st(l.prototype,"autorefreshTypes",[$]),st(l.prototype,"errorFeatures",[$]),st(l.prototype,"contentFeatures",[$]),st(l.prototype,"_request",[$]),st(l.prototype,"request",[$]),q(ct.prototype,"isOnline",!0),q(ct.prototype,"isHidden",!1),q(ct.prototype,"isRefreshing",!1),q(ct.prototype,"_localRequest",void 0),q(ct.prototype,"_latestRequest",void 0)
const pt=new WeakMap
function ht(e){return e instanceof DOMException&&"AbortError"===e.name}class ft{_trigger(){if(this._triggered)return
this._triggered=!0
const e=this._future.getStream()
e.sizeHint&&(this._sizeHint=e.sizeHint),this.promise=e.then(e=>e?async function(e,t){const n=t,r=e.getReader()
let i=0,o=null!==n._stream&&n._stream.readable.locked,a=o,s=n._stream?.writable.getWriter()
const l=[]
for(n._isPending=!1,n._isStarted=!0,n._startTime=performance.now();;){const{value:e,done:t}=await r.read()
if(t)break
if(i+=e.byteLength,n._bytesLoaded=i,n._lastPacketTime=performance.now(),o=o||null!==n._stream&&n._stream.readable.locked,o){if(!a){a=!0,s=n._stream.writable.getWriter()
for(const e of l)await s.ready,await s.write(e)
l.length=0}await s.ready,await s.write(e)}else l.push(e)}a?(await s.ready,await s.close()):n._stream&&(await n._stream.readable.cancel("The Stream Has Already Ended"),n._stream=null)
const c=performance.now()
n._endTime=c,n._isComplete=!0,n._isStarted=!1}(e,this):(this._isPending=!1,void(this._isComplete=!0)),e=>{this._isPending=!1,this._isStarted=!1,ht(e)&&(this._isCancelled=!0,this._isComplete=!0),this._isErrored=!0,this._error=e})}get isPending(){return this._trigger(),this._isPending}get sizeHint(){return this._trigger(),this._sizeHint}get stream(){if(this._trigger(),!this._stream){if(this._isComplete||this._isCancelled||this._isErrored)return null
this._stream=new TransformStream}return this._stream.readable}get isStarted(){return this._trigger(),this._isStarted}get bytesLoaded(){return this._trigger(),this._bytesLoaded}get startTime(){return this._trigger(),this._startTime}get endTime(){return this._trigger(),this._endTime}get lastPacketTime(){return this._trigger(),this._lastPacketTime}get isComplete(){return this._trigger(),this._isComplete}get isCancelled(){return this._trigger(),this._isCancelled}get isErrored(){return this._trigger(),this._isErrored}get error(){return this._trigger(),this._error}get elapsedTime(){return(this.endTime||this.lastPacketTime)-this.startTime}get completedRatio(){return this.sizeHint?this.bytesLoaded/this.sizeHint:0}get remainingRatio(){return 1-this.completedRatio}get duration(){return this.endTime-this.startTime}get speed(){return this.bytesLoaded/(this.elapsedTime/1e3)}constructor(e){p(this,"_stream",null),p(this,"_future",void 0),p(this,"_triggered",!1),p(this,"promise",null),p(this,"abort",()=>{this._future.abort()}),this._future=e}}Q(ft.prototype,"_isPending",!0),Q(ft.prototype,"_isStarted",!1),Q(ft.prototype,"_isComplete",!1),Q(ft.prototype,"_isCancelled",!1),Q(ft.prototype,"_isErrored",!1),Q(ft.prototype,"_error",null),Q(ft.prototype,"_sizeHint",0),Q(ft.prototype,"_bytesLoaded",0),Q(ft.prototype,"_startTime",0),Q(ft.prototype,"_endTime",0),Q(ft.prototype,"_lastPacketTime",0)
const mt={}
q(mt,"reason",null),q(mt,"value",null),q(mt,"result",null),q(mt,"error",null),q(mt,"status","pending"),q(mt,"isPending",!0),q(mt,"isLoading",!0),q(mt,"isSuccess",!1),q(mt,"isError",!1),q(mt,"request",null),q(mt,"response",null),Object.defineProperty(mt,"isCancelled",{get(){return this.isError&&ht(this.reason)}}),Object.defineProperty(mt,"loadingState",{get(){return this._loadingState||(this._loadingState=new ft(this._request)),this._loadingState}})},64170(e,t,n){"use strict"
n.d(t,{MD:()=>c,WG:()=>p,qp:()=>l,zj:()=>u})
var r=n(80813),i=n(32775),o=n(31727),a=n(54749),s=n(31683)
function l(e,t,n,r){for(let i=t;i<n;++i)a.Color.toArray(r,e,4*i),e[4*i+3]=255
return!0}function c(e,t,n){return e.fill(0,4*t,4*n),!0}function u(e,t,n){const a=(0,o.xg)(Math.max(1,e),4,Uint8Array,n&&n.tOverpaint.ref.value.array)
return n?(r.IQ.update(n.tOverpaint,a),r.IQ.update(n.uOverpaintTexDim,i.ZY.create(a.width,a.height)),r.IQ.updateIfChanged(n.dOverpaint,e>0),r.IQ.updateIfChanged(n.dOverpaintType,t),n):{tOverpaint:r.IQ.create(a),uOverpaintTexDim:r.IQ.create(i.ZY.create(a.width,a.height)),dOverpaint:r.IQ.create(e>0),tOverpaintGrid:r.IQ.create((0,s.z6)()),uOverpaintGridDim:r.IQ.create(i.eB.create(1,1,1)),uOverpaintGridTransform:r.IQ.create(i.Zb.create(0,0,0,1)),dOverpaintType:r.IQ.create(t),uOverpaintStrength:r.IQ.create(1)}}const d={array:new Uint8Array(4),width:1,height:1}
function p(e){return e?(r.IQ.update(e.tOverpaint,d),r.IQ.update(e.uOverpaintTexDim,i.ZY.create(1,1)),e):{tOverpaint:r.IQ.create(d),uOverpaintTexDim:r.IQ.create(i.ZY.create(1,1)),dOverpaint:r.IQ.create(!1),tOverpaintGrid:r.IQ.create((0,s.z6)()),uOverpaintGridDim:r.IQ.create(i.eB.create(1,1,1)),uOverpaintGridTransform:r.IQ.create(i.Zb.create(0,0,0,1)),dOverpaintType:r.IQ.create("groupInstance"),uOverpaintStrength:r.IQ.create(1)}}},64299(e,t,n){"use strict"
n.d(t,{B:()=>u})
var r=n(23325),i=n(39250),o=n(6539),a=n(37411),s=n(87423),l=n(92384),c=n(12288)
function u(){}!function(e){e.Type={none:0,plane:1,sphere:2,cube:3,cylinder:4,infiniteCone:5},e.Params={variant:l.t.Select("pixel",l.t.arrayToOptions(["instance","pixel"])),objects:l.t.ObjectList({type:l.t.Select("plane",l.t.objectToOptions(e.Type,e=>(0,c.Mk)(e))),invert:l.t.Boolean(!1),position:l.t.Vec3((0,a.e)()),rotation:l.t.Group({axis:l.t.Vec3(a.e.create(1,0,0)),angle:l.t.Numeric(0,{min:-180,max:180,step:1},{description:"Angle in Degrees"})},{isExpanded:!0}),scale:l.t.Vec3(a.e.create(1,1,1)),transform:l.t.Mat4(i.$.identity())},e=>(0,c.Mk)(e.type))}
const t=(0,o.k)(),n=(0,o.k)(),u=(0,a.e)(),d=(0,a.e)(),p=(0,i.$)(),h=(0,i.$)()
e.getClip=function(n,r){const l=n.objects.length,{type:c,invert:u,position:d,rotation:p,scale:h,transform:f}=(null==r?void 0:r.objects)||function(e){return{count:0,type:new Array(e).fill(1),invert:new Array(e).fill(!1),position:new Array(3*e).fill(0),rotation:new Array(4*e).fill(0),scale:new Array(3*e).fill(1),transform:new Array(16*e).fill(0)}}(l)
for(let m=0;m<l;++m){const r=n.objects[m]
c[m]=e.Type[r.type],u[m]=r.invert,a.e.toArray(r.position,d,3*m),o.k.toArray(o.k.setAxisAngle(t,r.rotation.axis,(0,s.pu)(r.rotation.angle)),p,4*m),a.e.toArray(r.scale,h,3*m),i.$.toArray(r.transform,f,16*m)}return{variant:n.variant,objects:{count:l,type:c,invert:u,position:d,rotation:p,scale:h,transform:f}}},e.areEqual=function(e,s){if(e.variant!==s.variant)return!1
if(e.objects.count!==s.objects.count)return!1
const l=e.objects,c=s.objects
for(let f=0,m=l.count;f<m;++f){if(l.invert[f]!==c.invert[f])return!1
if(l.type[f]!==c.type[f])return!1
if(a.e.fromArray(u,l.position,3*f),a.e.fromArray(d,c.position,3*f),!a.e.equals(u,d))return!1
if(a.e.fromArray(u,l.scale,3*f),a.e.fromArray(d,c.scale,3*f),!a.e.equals(u,d))return!1
if(o.k.fromArray(t,l.rotation,4*f),o.k.fromArray(n,c.rotation,4*f),!o.k.equals(t,n))return!1
if(i.$.fromArray(p,l.transform,16*f),i.$.fromArray(h,c.transform,16*f),!i.$.areEqual(p,h,r.p))return!1}return!0}}(u||(u={}))},64361(e,t,n){"use strict"
n.d(t,{My:()=>h,SM:()=>_,VH:()=>C,jg:()=>S,r7:()=>x,uo:()=>b})
var r=n(32775),i=n(40165),o=n(1654)
const a=(0,r.eB)(),s=(0,r.eB)(),l=(0,r.eB)(),c=(0,r.eB)(),u=(0,r.eB)(),d=(0,r.eB)(),p={height:1,topCap:!0,bottomCap:!0}
function h(e,t){const n=e.length/3
if(n<3)throw new Error("need at least 3 points to build a prism")
const{height:o,topCap:h,bottomCap:f}={...p,...t}
let m=2*n,g=4*n
const y=(h?1:0)+(f?1:0)
3===n?(m+=y,g+=3*y):4===n?(m+=2*y,g+=4*y):(m+=y*n,g+=y*n*3)
const v=(0,i.nT)(m,g),b=.5*o
r.eB.set(a,0,0,-b),r.eB.set(s,0,0,b)
for(let i=0;i<n;++i){const t=(i+1)%n
r.eB.set(l,e[3*i],e[3*i+1],-b),r.eB.set(c,e[3*t],e[3*t+1],-b),r.eB.set(u,e[3*t],e[3*t+1],b),r.eB.set(d,e[3*i],e[3*i+1],b),v.addQuad(l,c,u,d)}if(3===n)h&&(r.eB.set(l,e[0],e[1],-b),r.eB.set(c,e[3],e[4],-b),r.eB.set(u,e[6],e[7],-b),v.add(u,c,l)),f&&(r.eB.set(l,e[0],e[1],b),r.eB.set(c,e[3],e[4],b),r.eB.set(u,e[6],e[7],b),v.add(l,c,u))
else if(4===n)h&&(r.eB.set(l,e[0],e[1],-b),r.eB.set(c,e[3],e[4],-b),r.eB.set(u,e[6],e[7],-b),r.eB.set(d,e[9],e[10],-b),v.addQuad(d,u,c,l)),f&&(r.eB.set(l,e[0],e[1],b),r.eB.set(c,e[3],e[4],b),r.eB.set(u,e[6],e[7],b),r.eB.set(d,e[9],e[10],b),v.addQuad(l,c,u,d))
else for(let i=0;i<n;++i){const t=(i+1)%n
h&&(r.eB.set(l,e[3*i],e[3*i+1],-b),r.eB.set(c,e[3*t],e[3*t+1],-b),v.add(a,c,l)),f&&(r.eB.set(l,e[3*i],e[3*i+1],b),r.eB.set(c,e[3*t],e[3*t+1],b),v.add(l,c,s))}return v.getPrimitive()}let f,m,g,y,v
function b(){return f||(f=h((0,o.n)(4,!1))),f}function x(){return m||(m=h((0,o.n)(5,!1))),m}function S(){return g||(g=h((0,o.n)(6,!1))),g}function _(){return y||(y=h((0,o.n)(6,!0))),y}function C(){return v||(v=h((0,o.n)(7,!1))),v}},64367(e,t,n){"use strict"
n.d(t,{z:()=>r})
var r,i=n(29067),o=n(92726),a=n(87095)
!function(e){e.Descriptor={name:"index_pair_bonds"},e.Provider=o.q.create(e.Descriptor,{asDynamic:!0}),e.DefaultProps={maxDistance:-1,cacheable:!0},e.fromData=function(t,n={}){const r={...e.DefaultProps,...n},{pairs:o,count:s}=t,l=o.indexA.toArray(),c=o.indexB.toArray(),u=o.key&&o.key.toArray(),d=o.operatorA&&o.operatorA.toArray(),p=o.operatorB&&o.operatorB.toArray(),h=o.order&&o.order.toArray(),f=o.distance&&o.distance.toArray(),m=o.flag&&o.flag.toArray()
let g=!1
if(d&&p){g=!0
for(let e=0,t=d.length;e<t;++e)if(-1===d[e]||-1===p[e]){g=!1
break}}const y=function(e,t,n,r){const o=new i.O.EdgeBuilder(r,e,t),s=new Int32Array(o.slotCount),l=new Array(o.slotCount),c=new Array(o.slotCount),u=new Int8Array(o.slotCount),d=new Array(o.slotCount),p=new Array(o.slotCount)
for(let i=0,h=o.edgeCount;i<h;i++)o.addNextEdge(),o.assignProperty(s,n.key?n.key[i]:-1),o.assignDirectedProperty(l,n.operatorA?n.operatorA[i]:-1,c,n.operatorB?n.operatorB[i]:-1),o.assignProperty(u,n.order?n.order[i]:1),o.assignProperty(d,n.distance?n.distance[i]:-1),o.assignProperty(p,n.flag?n.flag[i]:a.BondType.Flag.Covalent)
return o.createGraph({key:s,operatorA:l,operatorB:c,order:u,distance:d,flag:p})}(l,c,{key:u,operatorA:d,operatorB:p,order:h,distance:f,flag:m},s),v=new Map
if(g){const{operatorA:e,operatorB:t}=y.edgeProps
for(let n=0,r=e.length;n<r;++n)if(e[n]===t[n]){const t=e[n]
v.has(t)?v.get(t).push(n):v.set(t,[n])}}return{bonds:y,maxDistance:r.maxDistance,cacheable:r.cacheable,hasOperators:g,bySameOperator:v}},e.getEdgeIndexForOperators=function(e,t,n,r,i){let o,a,s,l
t<n?(o=t,a=n,s=r,l=i):(o=n,a=t,s=i,l=r)
for(let c=e.offset[o],u=e.offset[o+1];c<u;c++)if(e.b[c]===a&&e.edgeProps.operatorA[c]===s&&e.edgeProps.operatorB[c]===l)return c
return-1}}(r||(r={}))},65081(e,t,n){"use strict"
n.d(t,{D1:()=>c})
var r=n(9043),i=n(31727),o=n(54749),a=n(32775),s=n(16159),l=n(31683)
function c(e,t,n,c){var h
const f=function(e,t,n,c){switch(n.granularity){case"uniform":return function(e,t,n){e.reset()
const i=e.hasNext?e.move():{location:s.LU,isSecondary:!1}
return function(e,t){return t?(r.IQ.update(t.uColor,o.Color.toVec3Normalized(t.uColor.ref.value,e)),r.IQ.updateIfChanged(t.dColorType,"uniform"),t):{uColor:r.IQ.create(o.Color.toVec3Normalized((0,a.eB)(),e)),tColor:r.IQ.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:r.IQ.create((0,l.z6)()),uPaletteDomain:r.IQ.create(a.ZY.create(0,1)),uPaletteDefault:r.IQ.create((0,a.eB)()),tPalette:r.IQ.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:r.IQ.create(a.ZY.create(1,1)),uColorGridDim:r.IQ.create(a.eB.create(1,1,1)),uColorGridTransform:r.IQ.create(a.Zb.create(0,0,0,1)),dColorType:r.IQ.create("uniform"),dUsePalette:r.IQ.create(!1)}}(t(i.location,i.isSecondary),n)}(e,n.color,c)
case"instance":return e.nonInstanceable?d(e,n.color,c):function(e,t,n){const{instanceCount:r}=e,a=(0,i.xg)(Math.max(1,r),3,Uint8Array,n&&n.tColor.ref.value.array)
for(e.reset();e.hasNext;){const{location:n,isSecondary:r,instanceIndex:i}=e.move()
o.Color.toArray(t(n,r),a.array,3*i),e.skipInstance()}return u(a,"instance",n)}(e,n.color,c)
case"group":return d(e,n.color,c)
case"groupInstance":return function(e,t,n){const{groupCount:r,instanceCount:a,hasLocation2:s}=e,l=a*r*(s?2:1),c=(0,i.xg)(Math.max(1,l),3,Uint8Array,n&&n.tColor.ref.value.array)
e.reset()
const d=s?6:3
for(;e.hasNext;){const{location:n,location2:r,isSecondary:i,index:a}=e.move()
o.Color.toArray(t(n,i),c.array,a*d),s&&o.Color.toArray(t(r,i),c.array,a*d+3)}return u(c,"groupInstance",n)}(e,n.color,c)
case"vertex":return function(e,t,n){const{groupCount:r,stride:a}=e,s=(0,i.xg)(Math.max(1,r),3,Uint8Array,n&&n.tColor.ref.value.array)
for(e.reset(),e.voidInstances();e.hasNext&&!e.isNextNewInstance;){const{location:n,isSecondary:r,groupIndex:i}=e.move(),l=t(n,r)
for(let e=0;e<a;++e)o.Color.toArray(l,s.array,3*(i+e))}return u(s,"vertex",n)}(t,n.color,c)
case"vertexInstance":return function(e,t,n){const{groupCount:r,instanceCount:a,stride:s}=e,l=a*r,c=(0,i.xg)(Math.max(1,l),3,Uint8Array,n&&n.tColor.ref.value.array)
for(e.reset();e.hasNext;){const{location:n,isSecondary:r,index:i}=e.move(),a=t(n,r)
for(let e=0;e<s;++e)o.Color.toArray(a,c.array,3*(i+e))}return u(c,"vertexInstance",n)}(t,n.color,c)
case"volume":return p(n.grid,"volume",c)
case"volumeInstance":return p(n.grid,"volumeInstance",c)
case"direct":return function(e){return e?(r.IQ.updateIfChanged(e.dColorType,"direct"),e):{uColor:r.IQ.create((0,a.eB)()),tColor:r.IQ.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:r.IQ.create((0,l.z6)()),uPaletteDomain:r.IQ.create(a.ZY.create(0,1)),uPaletteDefault:r.IQ.create((0,a.eB)()),tPalette:r.IQ.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:r.IQ.create(a.ZY.create(1,1)),uColorGridDim:r.IQ.create(a.eB.create(1,1,1)),uColorGridTransform:r.IQ.create(a.Zb.create(0,0,0,1)),dColorType:r.IQ.create("direct"),dUsePalette:r.IQ.create(!1)}}(c)}}(e,t,n,c)
if(n.palette){r.IQ.updateIfChanged(f.dUsePalette,!0)
const[e,t]=n.palette.domain||[0,1]
r.IQ.update(f.uPaletteDomain,a.ZY.set(f.uPaletteDomain.ref.value,e,t)),r.IQ.update(f.uPaletteDefault,o.Color.toVec3Normalized(f.uPaletteDefault.ref.value,null!==(h=n.palette.defaultColor)&&void 0!==h?h:(0,o.Color)(13421772))),function(e,t){let n=!0
const i=t.ref.value
if(e.colors.length!==i.width||i.filter!==e.filter)n=!1
else{const t=i.array
let r=0
for(const i of e.colors){const[e,a,s]=o.Color.toRgb(i)
if(t[r++]!==e||t[r++]!==a||t[r++]!==s){n=!1
break}}}if(n)return
const a=new Uint8Array(3*e.colors.length)
let s=0
for(const r of e.colors){const[e,t,n]=o.Color.toRgb(r)
a[s++]=e,a[s++]=t,a[s++]=n}r.IQ.update(t,{array:a,height:1,width:e.colors.length,filter:e.filter})}(n.palette,f.tPalette)}else r.IQ.updateIfChanged(f.dUsePalette,!1)
return f}function u(e,t,n){return n?(r.IQ.update(n.tColor,e),r.IQ.update(n.uColorTexDim,a.ZY.create(e.width,e.height)),r.IQ.updateIfChanged(n.dColorType,t),n):{uColor:r.IQ.create((0,a.eB)()),tColor:r.IQ.create(e),tColorGrid:r.IQ.create((0,l.z6)()),uPaletteDomain:r.IQ.create(a.ZY.create(0,1)),uPaletteDefault:r.IQ.create((0,a.eB)()),tPalette:r.IQ.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:r.IQ.create(a.ZY.create(e.width,e.height)),uColorGridDim:r.IQ.create(a.eB.create(1,1,1)),uColorGridTransform:r.IQ.create(a.Zb.create(0,0,0,1)),dColorType:r.IQ.create(t),dUsePalette:r.IQ.create(!1)}}function d(e,t,n){const{groupCount:r,hasLocation2:a}=e,s=(0,i.xg)(Math.max(1,r*(a?2:1)),3,Uint8Array,n&&n.tColor.ref.value.array)
e.reset()
const l=a?6:3
for(;e.hasNext&&!e.isNextNewInstance;){const{location:n,location2:r,isSecondary:i,groupIndex:c}=e.move()
o.Color.toArray(t(n,i),s.array,c*l),a&&o.Color.toArray(t(r,i),s.array,c*l+3)}return u(s,"group",n)}function p(e,t,n){const{colors:i,dimension:o,transform:s}=e,l=i.getWidth(),c=i.getHeight()
return n?(r.IQ.update(n.tColorGrid,i),r.IQ.update(n.uColorTexDim,a.ZY.create(l,c)),r.IQ.update(n.uColorGridDim,a.eB.clone(o)),r.IQ.update(n.uColorGridTransform,a.Zb.clone(s)),r.IQ.updateIfChanged(n.dColorType,t),n):{uColor:r.IQ.create((0,a.eB)()),tColor:r.IQ.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:r.IQ.create(i),uPaletteDomain:r.IQ.create(a.ZY.create(0,1)),uPaletteDefault:r.IQ.create((0,a.eB)()),tPalette:r.IQ.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:r.IQ.create(a.ZY.create(l,c)),uColorGridDim:r.IQ.create(a.eB.clone(o)),uColorGridTransform:r.IQ.create(a.Zb.clone(s)),dColorType:r.IQ.create(t),dUsePalette:r.IQ.create(!1)}}},65580(e,t,n){"use strict"
n.d(t,{O:()=>r})
var r,i=n(9043),o=n(32775),a=n(37392),s=n(65081),l=n(17782),c=n(68187),u=n(81871),d=n(92384),p=n(31727),h=n(14294),f=n(9726),m=n(64170),g=n(69858),y=n(70012),v=n(40426),b=n(22394),x=n(71905)
!function(e){function t(e,t,n,o){return o?function(e,t,n,r){return r.pointCount=n,i.IQ.update(r.centerBuffer,e),i.IQ.update(r.groupBuffer,t),r}(e,t,n,o):function(e,t,n){const o=(0,h.f8)()
let s,l=-1,c=-1
const u={kind:"points",pointCount:n,centerBuffer:i.IQ.create(e),groupBuffer:i.IQ.create(t),get boundingSphere(){const e=r(u)
if(e!==l){const t=(0,p.sL)(u.centerBuffer.ref.value,u.pointCount,1)
h.f8.copy(o,t),l=e}return o},get groupMapping(){return u.groupBuffer.ref.version!==c&&(s=(0,a.AA)(u.groupBuffer.ref.value,u.pointCount),c=u.groupBuffer.ref.version),s},setBoundingSphere(e){h.f8.copy(o,e),l=r(u)}}
return u}(e,t,n)}function n(e){return t(e?e.centerBuffer.ref.value:new Float32Array(0),e?e.groupBuffer.ref.value:new Float32Array(0),0,e)}function r(e){return(0,y.TI)([e.pointCount,e.centerBuffer.ref.version,e.groupBuffer.ref.version])}function S(e,t){const n=e.pointCount,r=t.instanceCount.ref.value,i=(0,u.tu)(),a=i.position,s=e.centerBuffer.ref.value,l=t.aTransform.ref.value
return(0,u.iQ)(n,r,1,(e,t)=>(t<0?o.eB.fromArray(a,s,3*e):o.eB.transformMat4Offset(a,s,l,0,3*e,16*t),i))}function _(e,t,n,r,a){const{instanceCount:u,groupCount:d}=n,y=S(e,t),_=(0,s.D1)(n,y,r.color),C=(0,c.v3)(n,r.size),w=a.instanceGranularity?(0,l.Km)(u,"instance"):(0,l.Km)(u*d,"groupInstance"),T=(0,m.WG)(),A=(0,g.MD)(),I=(0,x.JS)(),P=(0,b.IB)(),B=(0,v.EN)(),E={drawCount:e.pointCount,vertexCount:e.pointCount,groupCount:d,instanceCount:u},k=h.f8.clone(e.boundingSphere),D=(0,p.Ax)(k,t.aTransform.ref.value,u,0)
return{dGeometryType:i.IQ.create("points"),aPosition:e.centerBuffer,aGroup:e.groupBuffer,boundingSphere:i.IQ.create(D),invariantBoundingSphere:i.IQ.create(k),uInvariantBoundingSphere:i.IQ.create(o.Zb.ofSphere(k)),..._,...C,...w,...T,...A,...I,...P,...B,...t,...f.iy.createValues(a,E),uSizeFactor:i.IQ.create(a.sizeFactor),dPointSizeAttenuation:i.IQ.create(a.pointSizeAttenuation),dPointStyle:i.IQ.create(a.pointStyle)}}function C(e,t){f.iy.updateRenderableState(e,t),e.opaque=e.opaque&&"fuzzy"!==t.pointStyle,e.writeDepth=e.opaque}e.create=t,e.createEmpty=n,e.transform=function(e,t){const n=e.centerBuffer.ref.value;(0,a.pi)(t,n,0,e.pointCount),i.IQ.update(e.centerBuffer,n)},e.StyleTypes={square:"Square",circle:"Circle",fuzzy:"Fuzzy"},e.StyleTypeNames=Object.keys(e.StyleTypes),e.Params={...f.iy.Params,sizeFactor:d.t.Numeric(3,{min:0,max:10,step:.1}),pointSizeAttenuation:d.t.Boolean(!1),pointStyle:d.t.Select("square",d.t.objectToOptions(e.StyleTypes))},e.Utils={Params:e.Params,createEmpty:n,createValues:_,createValuesSimple:function(t,n,r,i,o){const a=f.iy.createSimple(r,i,o),s={...d.t.getDefaultValues(e.Params),...n}
return _(t,a.transform,a.locationIterator,a.theme,s)},updateValues:function(e,t){f.iy.updateValues(e,t),i.IQ.updateIfChanged(e.uSizeFactor,t.sizeFactor),i.IQ.updateIfChanged(e.dPointSizeAttenuation,t.pointSizeAttenuation),i.IQ.updateIfChanged(e.dPointStyle,t.pointStyle)},updateBoundingSphere:function(e,t){const n=h.f8.clone(t.boundingSphere),r=(0,p.Ax)(n,e.aTransform.ref.value,e.instanceCount.ref.value,0)
h.f8.equals(r,e.boundingSphere.ref.value)||i.IQ.update(e.boundingSphere,r),h.f8.equals(n,e.invariantBoundingSphere.ref.value)||(i.IQ.update(e.invariantBoundingSphere,n),i.IQ.update(e.uInvariantBoundingSphere,o.Zb.fromSphere(e.uInvariantBoundingSphere.ref.value,n)))},createRenderableState:function(e){const t=f.iy.createRenderableState(e)
return C(t,e),t},updateRenderableState:C,createPositionIterator:S}}(r||(r={}))},65746(e,t,n){"use strict"
n.d(t,{A:()=>r})
var r,i=n(87095),o=n(24762),a=n(67538),s=n(28721),l=n(11064),c=n(92726)
!function(e){function t({units:e},t){for(let n=0,r=e.length;n<r;n++)if(a.X9.indexOf(e[n].elements,t)>=0)return!0
return!1}e.Descriptor={name:"struct_conn",cifExport:{prefix:"",categories:[{name:"struct_conn",instance(n){const r=e.Provider.get(n.firstModel)
if(!r||0===r.entries.length)return s.c.Category.Empty
const i=n.structures[0],o=[]
for(const e of r.entries)t(i,e.partnerA.atomIndex)&&t(i,e.partnerB.atomIndex)&&(o[o.length]=e.rowIndex)
return s.c.Category.ofTable(r.data,o)}}]}},e.Provider=c.q.create(e.Descriptor),e.isExhaustive=function(t){const n=e.Provider.get(t)
return!!n&&n.entries.length/t.atomicConformation.atomId.rowCount>.95},e.getAtomIndexFromEntries=function(e){const t=new Map
for(const n of e){const{partnerA:{atomIndex:e},partnerB:{atomIndex:r}}=n
t.has(e)?t.get(e).push(n):t.set(e,[n]),t.has(r)?t.get(r).push(n):t.set(r,[n])}return t},e.getEntriesFromStructConn=function(e,t){const{conn_type_id:n,pdbx_dist_value:r,pdbx_value_order:a}=e,s={label_asym_id:e.ptnr1_label_asym_id,label_seq_id:e.ptnr1_label_seq_id,auth_seq_id:e.ptnr1_auth_seq_id,label_atom_id:e.ptnr1_label_atom_id,label_alt_id:e.pdbx_ptnr1_label_alt_id,ins_code:e.pdbx_ptnr1_PDB_ins_code,symmetry:e.ptnr1_symmetry},c={label_asym_id:e.ptnr2_label_asym_id,label_seq_id:e.ptnr2_label_seq_id,auth_seq_id:e.ptnr2_auth_seq_id,label_atom_id:e.ptnr2_label_atom_id,label_alt_id:e.pdbx_ptnr2_label_alt_id,ins_code:e.pdbx_ptnr2_PDB_ins_code,symmetry:e.ptnr2_symmetry},u=Array.from(t.entities.data.id.toArray()),d=(e,n)=>{if(n.label_asym_id.valueKind(e)!==o.VP.ValueKinds.Present)return
const r=n.label_asym_id.value(e),i=n.label_atom_id.value(e)
if(!i)return
const a=n.auth_seq_id.valueKind(e)===o.VP.ValueKind.Present?n.auth_seq_id.value(e):n.label_seq_id.value(e),s=n.ins_code.value(e),l=n.label_alt_id.value(e)
for(const o of u){const c=t.atomicHierarchy.index.findResidue(o,r,a,s)
if(c<0)continue
const u=t.atomicHierarchy.index.findAtomOnResidue(c,i,l)
if(!(u<0))return{residueIndex:c,atomIndex:u,symmetry:n.symmetry.value(e)}}},p=[]
for(let o=0;o<e._rowCount;o++){const t=d(o,s),u=d(o,c)
if(void 0===t||void 0===u)continue
const h=n.value(o),f=a.value(o)||""
let m=i.BondType.Flag.None,g=1
switch(f){case"sing":g=1
break
case"doub":g=2
break
case"trip":g=3
break
case"quad":g=4
break
default:g=(0,l.m)(e.ptnr1_label_comp_id.value(o),e.ptnr1_label_atom_id.value(o),e.ptnr2_label_comp_id.value(o),e.ptnr2_label_atom_id.value(o))}switch(h){case"covale":m=i.BondType.Flag.Covalent
break
case"disulf":m=i.BondType.Flag.Covalent|i.BondType.Flag.Disulfide
break
case"hydrog":m=i.BondType.Flag.HydrogenBond
break
case"metalc":m=i.BondType.Flag.MetallicCoordination}p.push({rowIndex:o,flags:m,order:g,distance:r.value(o),partnerA:t,partnerB:u})}return p}}(r||(r={}))},65939(e,t,n){"use strict"
n.d(t,{h:()=>r})
var r,i=n(20321),o=n(88434),a=n(52349)
function s(e){const t=a.X.ofSortedArray(e),n=a.X.max(t),r=new Int32Array(n)
for(let i=0,o=e.length-1;i<o;i++)for(let t=e[i],n=e[i+1];t<n;t++)r[t]=i
return{offsets:t,index:r,count:e.length-1}}function l(e,t){const n=o.I.start(t),r=new Int32Array(e.length+1)
for(let i=0,o=e.length;i<o;i++)r[i]=e[i]-n
return r[e.length]=o.I.end(t)-n,s(r)}function c({count:e}){return e}function u({index:e},t){return e[t]}function d({offsets:e},t,n){const r=n>=i.C.max(e)?-1:i.C.findPredecessorIndex(e,n-1)
return i.C.findRange(t,i.C.getAt(e,r),i.C.getAt(e,r+1)-1)}class p{move(){for(;this.hasNext;){if(this.updateValue()){this.value.index=this.segmentMin++,this.hasNext=this.segmentMax>=this.segmentMin&&o.I.size(this.setRange)>0
break}this.updateSegmentRange()}return this.value}updateValue(){const e=this.segments[this.segmentMin+1],t=i.C.findPredecessorIndexInInterval(this.set,e,this.setRange)
return this.value.start=o.I.start(this.setRange),this.value.end=t,this.setRange=o.I.ofBounds(t,o.I.end(this.setRange)),t>this.value.start}updateSegmentRange(){const e=o.I.min(this.setRange),t=o.I.max(this.setRange)
t<e?this.hasNext=!1:(this.segmentMin=this.segmentMap[i.C.getAt(this.set,e)],this.segmentMax=this.segmentMap[i.C.getAt(this.set,t)],this.hasNext=this.segmentMax>=this.segmentMin)}setSegment(e){this.setRange=o.I.ofBounds(e.start,e.end),this.updateSegmentRange()}constructor(e,t,n,r){this.segments=e,this.segmentMap=t,this.set=n,this.segmentMin=0,this.segmentMax=0,this.setRange=o.I.Empty,this.value={index:0,start:0,end:0},this.hasNext=!1,this.setRange=r,this.updateSegmentRange()}}function h(e,t,n){const r=void 0!==n?o.I.ofBounds(n.start,n.end):o.I.ofBounds(0,i.C.size(t))
return new p(e.offsets,e.index,t,r)}!function(e){e.create=s,e.ofOffsets=l,e.count=c,e.getSegment=u,e.projectValue=d,e.transientSegments=h}(r||(r={}))},66006(e,t,n){"use strict"
n.d(t,{$u:()=>s,IW:()=>l,LM:()=>o})
var r=n(37411),i=n(17370)
function o(){return o.zero()}!function(e){e.zero=function(){return{x:0,y:0,width:0,height:0}},e.create=function(e,t,n,r){return{x:e,y:t,width:n,height:r}},e.clone=function(e){return{...e}},e.copy=function(e,t){return Object.assign(e,t)},e.set=function(e,t,n,r,i){return e.x=t,e.y=n,e.width=r,e.height=i,e},e.toVec4=function(e,t){return e[0]=t.x,e[1]=t.y,e[2]=t.width,e[3]=t.height,e},e.equals=function(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}}(o||(o={}))
const a=(0,i.Z)()
function s(e,t,n,r){const{x:o,y:s,width:l,height:c}=n
i.Z.set(a,t[0],t[1],t[2],1),i.Z.transformMat4(a,a,r)
const u=a[3]
return 0!==u&&(a[0]/=u,a[1]/=u,a[2]/=u),e[0]=(a[0]+1)*l*.5+o,e[1]=(a[1]+1)*c*.5+s,e[2]=.5*(a[2]+1),e[3]=0===u?0:1/u,e}function l(e,t,n,i){const{x:o,y:a,width:s,height:l}=n,c=t[0]-o,u=t[1]-a,d=t[2]
return e[0]=2*c/s-1,e[1]=2*u/l-1,e[2]=2*d-1,r.e.transformMat4(e,e,i)}},66044(e,t,n){"use strict"
n.d(t,{C1:()=>P,Js:()=>S,Lr:()=>f,T9:()=>m,Yz:()=>D,gK:()=>_,rm:()=>k})
var r=n(32775),i=n(92384),o=n(10596),a=n(83794),s=n(96005),l=n(9726),c=n(30084),u=n(17810),d=n(47404),p=n(96458),h=n(63317)
const f={linkScale:i.t.Numeric(.45,{min:0,max:1,step:.01}),linkSpacing:i.t.Numeric(1,{min:0,max:2,step:.01}),linkCap:i.t.Boolean(!1),aromaticScale:i.t.Numeric(.3,{min:0,max:1,step:.01}),aromaticSpacing:i.t.Numeric(1.5,{min:0,max:3,step:.01}),aromaticDashCount:i.t.Numeric(2,{min:1,max:6,step:1}),dashCount:i.t.Numeric(4,{min:0,max:10,step:1}),dashScale:i.t.Numeric(.8,{min:0,max:2,step:.1}),dashCap:i.t.Boolean(!0),stubCap:i.t.Boolean(!0),radialSegments:i.t.Numeric(16,{min:2,max:56,step:2},l.iy.CustomQualityParamInfo),colorMode:i.t.Select("default",i.t.arrayToOptions(["default","interpolate"]),l.iy.ShadingCategory)},m=(i.t.getDefaultValues(f),{linkScale:i.t.Numeric(.5,{min:0,max:1,step:.1}),linkSpacing:i.t.Numeric(.1,{min:0,max:2,step:.01}),aromaticDashCount:i.t.Numeric(2,{min:1,max:6,step:1}),dashCount:i.t.Numeric(4,{min:0,max:10,step:1})}),g=(i.t.getDefaultValues(m),(0,r.eB)()),y=(0,r.eB)(),v=(0,r.eB)(),b=r.eB.create(0,1,0)
function x(e,t,n,i){r.eB.normalize(y,r.eB.sub(y,t,n)),null!==i?r.eB.sub(v,t,i):r.eB.copy(v,t),r.eB.normalize(v,v)
let o=r.eB.dot(y,v)
return 1-Math.abs(o)<1e-5&&(r.eB.set(v,1,0,0),o=r.eB.dot(y,v),1-Math.abs(o)<1e-5&&(r.eB.set(v,0,1,0),o=r.eB.dot(y,v))),r.eB.setMagnitude(y,y,o),r.eB.sub(v,v,y),r.eB.normalize(e,v)}const S={linkCount:0,position:()=>{},radius:()=>0}
var _
!function(e){e[e.Solid=0]="Solid",e[e.Dashed=1]="Dashed",e[e.Double=2]="Double",e[e.OffsetDouble=3]="OffsetDouble",e[e.Triple=4]="Triple",e[e.OffsetTriple=5]="OffsetTriple",e[e.Disk=6]="Disk",e[e.Aromatic=7]="Aromatic",e[e.MirroredAromatic=8]="MirroredAromatic"}(_||(_={}))
const C=r.eB.scale,w=r.eB.add,T=r.eB.sub,A=r.eB.setMagnitude,I=r.eB.dot
function P(e,t,n,i){const{linkCount:s,referencePosition:l,position:c,style:u,radius:d,ignore:p,stub:f}=t
if(!s)return{mesh:o.e.createEmpty(i)}
const{radialSegments:m,stubCap:g}=n,y=2*m*s*2,v=a.P.createState(y,y/4,i),b=(0,r.eB)()
let x=0,S=0
const C={builderState:v,props:n,assignNonAdjustedPosition:(e,t)=>{c(e,t,S,!1)},referencePosition:l?()=>l(S):void 0},T={a:(0,r.eB)(),b:(0,r.eB)(),group:0,linkStub:!1,linkStyle:_.Solid,linkRadius:0}
for(let r=s;S<r;++S)p&&p(S)||(c(T.a,T.b,S,!0),w(b,b,T.a),w(b,b,T.b),x+=2,T.group=S,T.linkStub=g&&!!f&&f(S),T.linkRadius=d(S),T.linkStyle=u?u(S):_.Solid,E(C,T))
const A=a.P.getMesh(v)
if(0===x)return{mesh:A}
r.eB.scale(b,b,1/x)
const I=i?h.f.clone(i.boundingSphere):void 0
return I&&r.eB.distance(b,I.center)/I.radius<.1?{mesh:A,boundingSphere:I}:{mesh:A}}const B={cylinderProps:{radiusTop:1,radiusBottom:1,radialSegments:8,topCap:!1,bottomCap:!1},vShift:(0,r.eB)(),va:(0,r.eB)(),vb:(0,r.eB)()}
function E(e,t){const{builderState:n,props:i,assignNonAdjustedPosition:o,referencePosition:a}=e,{linkRadius:l,linkStub:c,linkStyle:u,a:d,b:p}=t,{linkScale:h,linkSpacing:f,radialSegments:m,linkCap:y,aromaticScale:v,aromaticSpacing:S,aromaticDashCount:P,dashCount:E,dashScale:k,dashCap:D}=i,{cylinderProps:M,vShift:R,va:O,vb:L}=B
M.radialSegments=m,r.eB.copy(O,d),r.eB.copy(L,p),T(g,L,O)
const N=I(g,b)>0,[F,z]=N?[c,y]:[y,c]
if(n.currentGroup=t.group,u===_.Solid)M.radiusTop=M.radiusBottom=l,M.topCap=F,M.bottomCap=z,(0,s.y9)(n,O,L,.5,M)
else if(u===_.Dashed)M.radiusTop=M.radiusBottom=l*k,M.topCap=M.bottomCap=D,(0,s.GH)(n,O,L,.5,E,c,M)
else if(u===_.Double||u===_.OffsetDouble||u===_.Triple||u===_.OffsetTriple||u===_.Aromatic||u===_.MirroredAromatic){const e=u===_.Double||u===_.OffsetDouble?2:u===_.Triple||u===_.OffsetTriple?3:1.5,t=l*(h/(.5*e)),r=(l-t)*f
if(x(R,O,L,a?a():null),M.topCap=F,M.bottomCap=z,u===_.Aromatic||u===_.MirroredAromatic){M.radiusTop=M.radiusBottom=l,(0,s.y9)(n,O,L,.5,M)
const e=l+v*l+v*l*S
o&&o(O,L),A(g,T(g,L,O),.5*l),w(O,O,g),T(L,L,g),M.radiusTop=M.radiusBottom=l*v,M.topCap=M.bottomCap=D,A(R,R,e),T(O,O,R),T(L,L,R),(0,s.GH)(n,O,L,.5,P,c,M),u===_.MirroredAromatic&&(A(R,R,2*e),w(O,O,R),w(L,L,R),(0,s.GH)(n,O,L,.5,P,c,M))}else if(u===_.OffsetDouble||u===_.OffsetTriple){const r=l+t+h*l*f
A(R,R,r),M.radiusTop=M.radiusBottom=l,(0,s.y9)(n,O,L,.5,M),C(g,g,f*h*.2),w(O,O,g),T(L,L,g),M.radiusTop=M.radiusBottom=t,M.topCap=N?c:D,M.bottomCap=N?D:c,A(R,R,r),T(O,O,R),T(L,L,R),(0,s.y9)(n,O,L,.5,M),3===e&&(A(R,R,2*r),w(O,O,R),w(L,L,R),(0,s.y9)(n,O,L,.5,M))}else A(R,R,r),M.radiusTop=M.radiusBottom=t,3===e&&(0,s.y9)(n,O,L,.5,M),(0,s.Jz)(n,O,L,.5,R,M)}else u===_.Disk&&(C(g,g,.475),w(O,O,g),T(L,L,g),M.radiusTop=M.radiusBottom=l,M.topCap=F,M.bottomCap=z,(0,s.y9)(n,O,L,.5,M))}function k(e,t,n,i){const{linkCount:o,referencePosition:a,position:s,style:l,radius:c,ignore:u,stub:f}=t
if(!o)return{cylinders:d.S.createEmpty(i)}
const{linkScale:m,linkSpacing:y,linkCap:v,aromaticScale:b,aromaticSpacing:S,aromaticDashCount:I,dashCount:P,dashScale:B,dashCap:E,stubCap:k,colorMode:D}=n,M="interpolate"===D,R=!0===M?3:2,O=2*o,L=p.h.create(O,O/4,i),N=(0,r.eB)(),F=(0,r.eB)(),z=(0,r.eB)(),j=(0,r.eB)(),V=(0,r.eB)()
let U=0
for(let r=0,d=o;r<d;++r){if(u&&u(r))continue
s(N,F,r,!0),w(V,V,N),w(V,V,F),U+=2
const e=c(r),t=l?l(r):_.Solid,n=k&&!!f&&f(r)
if(t===_.Solid)C(z,w(z,N,F),.5),L.add(N[0],N[1],N[2],z[0],z[1],z[2],1,v,n,R,r)
else if(t===_.Dashed)C(z,w(z,N,F),.5),L.addFixedCountDashes(N,z,P,B,E,E,n,M,r)
else if(t===_.Double||t===_.OffsetDouble||t===_.Triple||t===_.OffsetTriple||t===_.Aromatic||t===_.MirroredAromatic){const i=t===_.Double||t===_.OffsetDouble?2:t===_.Triple||t===_.OffsetTriple?3:1.5,o=m/(.5*i),l=(e-o*e)*y
if(C(z,w(z,N,F),.5),x(j,N,F,a?a(r):null),t===_.Aromatic||t===_.MirroredAromatic){L.add(N[0],N[1],N[2],z[0],z[1],z[2],1,v,n,R,r)
const i=e+b*e+b*e*S
s(N,F,r,!1),A(g,T(g,F,N),.5*e),w(N,N,g),A(j,j,i),T(N,N,j),T(z,z,j),L.addFixedCountDashes(N,z,I,b,E,E,n,M,r),t===_.MirroredAromatic&&(A(j,j,2*i),w(N,N,j),w(z,z,j),L.addFixedCountDashes(N,z,I,b,E,E,n,M,r))}else t===_.OffsetDouble||t===_.OffsetTriple?(A(j,j,e+o*e+m*e*y),L.add(N[0],N[1],N[2],z[0],z[1],z[2],1,v,n,R,r),A(g,T(g,N,z),e/1.5),T(N,N,g),3===i&&L.add(N[0]+j[0],N[1]+j[1],N[2]+j[2],z[0]+j[0],z[1]+j[1],z[2]+j[2],o,v,n,R,r),L.add(N[0]-j[0],N[1]-j[1],N[2]-j[2],z[0]-j[0],z[1]-j[1],z[2]-j[2],o,E,n,R,r)):(A(j,j,l),3===i&&L.add(N[0],N[1],N[2],z[0],z[1],z[2],o,v,n,R,r),L.add(N[0]+j[0],N[1]+j[1],N[2]+j[2],z[0]+j[0],z[1]+j[1],z[2]+j[2],o,v,n,R,r),L.add(N[0]-j[0],N[1]-j[1],N[2]-j[2],z[0]-j[0],z[1]-j[1],z[2]-j[2],o,v,n,R,r))}else t===_.Disk&&(C(g,T(g,z,N),.475),w(N,N,g),T(z,z,g),L.add(N[0],N[1],N[2],z[0],z[1],z[2],1,v,n,R,r))}const G=L.getCylinders()
if(0===U)return{cylinders:G}
r.eB.scale(V,V,1/U)
const H=i?h.f.clone(i.boundingSphere):void 0
return H&&r.eB.distance(V,H.center)/H.radius<.1?{cylinders:G,boundingSphere:H}:{cylinders:G}}function D(e,t,n,i){const{linkCount:o,referencePosition:a,position:s,style:l,ignore:d}=t
if(!o)return{lines:c.q.createEmpty(i)}
const{linkScale:p,linkSpacing:f,aromaticDashCount:m,dashCount:y}=n,v=2*o,b=u.d.create(v,v/4,i),S=(0,r.eB)(),I=(0,r.eB)(),P=(0,r.eB)(),B=(0,r.eB)(),E=(0,r.eB)()
let k=0
for(let r=0,c=o;r<c;++r){if(d&&d(r))continue
s(S,I,r,!0),w(E,E,S),w(E,E,I),k+=2
const e=l?l(r):_.Solid
if(e===_.Solid)C(P,w(P,S,I),.5),b.add(S[0],S[1],S[2],P[0],P[1],P[2],r)
else if(e===_.Dashed)C(P,w(P,S,I),.5),b.addFixedCountDashes(S,P,y,r)
else if(e===_.Double||e===_.OffsetDouble||e===_.Triple||e===_.OffsetTriple||e===_.Aromatic||e===_.MirroredAromatic){const t=e===_.Double||e===_.OffsetDouble?2:e===_.Triple||e===_.OffsetTriple?3:1.5,n=(1-p/(.5*t)*1)*f
if(C(P,w(P,S,I),.5),x(B,S,I,a?a(r):null),e===_.Aromatic||e===_.MirroredAromatic){b.add(S[0],S[1],S[2],P[0],P[1],P[2],r)
const t=4.5*n
A(g,T(g,I,S),.5*t),w(S,S,g),A(B,B,t),T(S,S,B),T(P,P,B),b.addFixedCountDashes(S,P,m,r),e===_.MirroredAromatic&&(A(B,B,2*t),w(S,S,B),w(P,P,B),b.addFixedCountDashes(S,P,m,r))}else e===_.OffsetDouble||e===_.OffsetTriple?(A(B,B,3*n),b.add(S[0],S[1],S[2],P[0],P[1],P[2],r),C(g,T(g,S,P),f*p),T(S,S,g),3===t&&b.add(S[0]+B[0],S[1]+B[1],S[2]+B[2],P[0]+B[0],P[1]+B[1],P[2]+B[2],r),b.add(S[0]-B[0],S[1]-B[1],S[2]-B[2],P[0]-B[0],P[1]-B[1],P[2]-B[2],r)):(A(B,B,1.5*n),3===t&&b.add(S[0],S[1],S[2],P[0],P[1],P[2],r),b.add(S[0]+B[0],S[1]+B[1],S[2]+B[2],P[0]+B[0],P[1]+B[1],P[2]+B[2],r),b.add(S[0]-B[0],S[1]-B[1],S[2]-B[2],P[0]-B[0],P[1]-B[1],P[2]-B[2],r))}else e===_.Disk&&(C(g,T(g,P,S),.475),w(S,S,g),T(P,P,g),b.add(S[0],S[1],S[2],P[0],P[1],P[2],r))}const D=b.getLines()
if(0===k)return{lines:D}
r.eB.scale(E,E,1/k)
const M=i?h.f.clone(i.boundingSphere):void 0
return M&&r.eB.distance(E,M.center)/M.radius<.1?{lines:D,boundingSphere:M}:{lines:D}}},66187(e,t,n){"use strict"
n.r(t),n.d(t,{ElementSymbolQuery:()=>ee,EntityDescriptionQuery:()=>te,ResidueQuery:()=>J,StructureSelectionCategory:()=>r,StructureSelectionQueries:()=>se,StructureSelectionQuery:()=>p,StructureSelectionQueryRegistry:()=>le,applyBuiltInSelection:()=>ae,getElementQueries:()=>re,getNonStandardResidueQueries:()=>ie,getPolymerAndBranchedEntityQueries:()=>oe})
var r,i=n(48393),o=n(87095),a=n(99302),s=n(85554),l=n(42261),c=n(33241),u=n(95579),d=n(30897)
function p(e,t,n={}){var o
let a
return{label:e,expression:t,description:n.description||"",category:null!==(o=n.category)&&void 0!==o?o:r.Misc,isHidden:!!n.isHidden,priority:n.priority||0,referencesCurrent:!!n.referencesCurrent,get query(){return a||(a=(0,s.wE)(t)),a},ensureCustomProperties:n.ensureCustomProperties,async getSelection(e,r,o){const l=e.managers.structure.selection.getStructure(o),c=l?i.StructureSelection.Sequence(o,[l]):i.StructureSelection.Empty(o)
return n.ensureCustomProperties&&await n.ensureCustomProperties({runtime:r,assetManager:e.managers.asset},o),a||(a=(0,s.wE)(t)),a(new i.QueryContext(o,{currentSelection:c}))}}}!function(e){e.Type="Type",e.Structure="Structure Property",e.Atom="Atom Property",e.Bond="Bond Property",e.Residue="Residue Property",e.AminoAcid="Amino Acid",e.NucleicBase="Nucleic Base",e.Manipulate="Manipulate Selection",e.Validation="Validation",e.Misc="Miscellaneous",e.Internal="Internal"}(r||(r={}))
const h=p("All",a.MolScriptBuilder.struct.generator.all(),{category:"",priority:1e3}),f=p("Current Selection",a.MolScriptBuilder.internal.generator.current(),{category:"",referencesCurrent:!0}),m=p("Polymer",a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.generator.atomGroups({"entity-test":a.MolScriptBuilder.core.logic.and([a.MolScriptBuilder.core.rel.eq([a.MolScriptBuilder.ammp("entityType"),"polymer"]),a.MolScriptBuilder.core.str.match([a.MolScriptBuilder.re("(polypeptide|cyclic-pseudo-peptide|peptide-like|nucleotide|peptide nucleic acid)","i"),a.MolScriptBuilder.ammp("entitySubtype")])])})]),{category:r.Type}),g=p("Trace",a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.combinator.merge([a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.generator.atomGroups({"entity-test":a.MolScriptBuilder.core.rel.eq([a.MolScriptBuilder.ammp("entityType"),"polymer"]),"chain-test":a.MolScriptBuilder.core.set.has([a.MolScriptBuilder.set("sphere","gaussian"),a.MolScriptBuilder.ammp("objectPrimitive")])})]),a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.generator.atomGroups({"entity-test":a.MolScriptBuilder.core.rel.eq([a.MolScriptBuilder.ammp("entityType"),"polymer"]),"chain-test":a.MolScriptBuilder.core.rel.eq([a.MolScriptBuilder.ammp("objectPrimitive"),"atomistic"]),"atom-test":a.MolScriptBuilder.core.set.has([a.MolScriptBuilder.set("CA","P"),a.MolScriptBuilder.ammp("label_atom_id")])})])])]),{category:r.Structure}),y=a.MolScriptBuilder.core.logic.and([a.MolScriptBuilder.core.rel.eq([a.MolScriptBuilder.ammp("entityType"),"polymer"]),a.MolScriptBuilder.core.str.match([a.MolScriptBuilder.re("(polypeptide|cyclic-pseudo-peptide|peptide-like)","i"),a.MolScriptBuilder.ammp("entitySubtype")])]),v=a.MolScriptBuilder.core.logic.and([a.MolScriptBuilder.core.rel.eq([a.MolScriptBuilder.ammp("entityType"),"polymer"]),a.MolScriptBuilder.core.str.match([a.MolScriptBuilder.re("(nucleotide|peptide nucleic acid)","i"),a.MolScriptBuilder.ammp("entitySubtype")])]),b=a.MolScriptBuilder.core.str.match([a.MolScriptBuilder.re("non-polymer|(amino|carboxy) terminus|peptide-like","i"),a.MolScriptBuilder.ammp("chemCompType")]),x=p("Backbone",a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.combinator.merge([a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.generator.atomGroups({"entity-test":y,"chain-test":a.MolScriptBuilder.core.rel.eq([a.MolScriptBuilder.ammp("objectPrimitive"),"atomistic"]),"residue-test":a.MolScriptBuilder.core.logic.not([b]),"atom-test":a.MolScriptBuilder.core.set.has([a.MolScriptBuilder.set(...l.M.toArray(o.ProteinBackboneAtoms)),a.MolScriptBuilder.ammp("label_atom_id")])})]),a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.generator.atomGroups({"entity-test":v,"chain-test":a.MolScriptBuilder.core.rel.eq([a.MolScriptBuilder.ammp("objectPrimitive"),"atomistic"]),"residue-test":a.MolScriptBuilder.core.logic.not([b]),"atom-test":a.MolScriptBuilder.core.set.has([a.MolScriptBuilder.set(...l.M.toArray(o.NucleicBackboneAtoms)),a.MolScriptBuilder.ammp("label_atom_id")])})])])]),{category:r.Structure}),S=p("Sidechain",a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.combinator.merge([a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.generator.atomGroups({"entity-test":y,"chain-test":a.MolScriptBuilder.core.rel.eq([a.MolScriptBuilder.ammp("objectPrimitive"),"atomistic"]),"residue-test":a.MolScriptBuilder.core.logic.not([b]),"atom-test":a.MolScriptBuilder.core.logic.or([a.MolScriptBuilder.core.logic.not([a.MolScriptBuilder.core.set.has([a.MolScriptBuilder.set(...l.M.toArray(o.ProteinBackboneAtoms)),a.MolScriptBuilder.ammp("label_atom_id")])])])})]),a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.generator.atomGroups({"entity-test":v,"chain-test":a.MolScriptBuilder.core.rel.eq([a.MolScriptBuilder.ammp("objectPrimitive"),"atomistic"]),"residue-test":a.MolScriptBuilder.core.logic.not([b]),"atom-test":a.MolScriptBuilder.core.logic.or([a.MolScriptBuilder.core.logic.not([a.MolScriptBuilder.core.set.has([a.MolScriptBuilder.set(...l.M.toArray(o.NucleicBackboneAtoms)),a.MolScriptBuilder.ammp("label_atom_id")])])])})])])]),{category:r.Structure}),_=p("Sidechain with Trace",a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.combinator.merge([a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.generator.atomGroups({"entity-test":y,"chain-test":a.MolScriptBuilder.core.rel.eq([a.MolScriptBuilder.ammp("objectPrimitive"),"atomistic"]),"residue-test":a.MolScriptBuilder.core.logic.not([b]),"atom-test":a.MolScriptBuilder.core.logic.or([a.MolScriptBuilder.core.logic.not([a.MolScriptBuilder.core.set.has([a.MolScriptBuilder.set(...l.M.toArray(o.ProteinBackboneAtoms)),a.MolScriptBuilder.ammp("label_atom_id")])]),a.MolScriptBuilder.core.rel.eq([a.MolScriptBuilder.ammp("label_atom_id"),"CA"]),a.MolScriptBuilder.core.logic.and([a.MolScriptBuilder.core.rel.eq([a.MolScriptBuilder.ammp("auth_comp_id"),"PRO"]),a.MolScriptBuilder.core.rel.eq([a.MolScriptBuilder.ammp("label_atom_id"),"N"])])])})]),a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.generator.atomGroups({"entity-test":v,"chain-test":a.MolScriptBuilder.core.rel.eq([a.MolScriptBuilder.ammp("objectPrimitive"),"atomistic"]),"residue-test":a.MolScriptBuilder.core.logic.not([b]),"atom-test":a.MolScriptBuilder.core.logic.or([a.MolScriptBuilder.core.logic.not([a.MolScriptBuilder.core.set.has([a.MolScriptBuilder.set(...l.M.toArray(o.NucleicBackboneAtoms)),a.MolScriptBuilder.ammp("label_atom_id")])]),a.MolScriptBuilder.core.rel.eq([a.MolScriptBuilder.ammp("label_atom_id"),"P"])])})])])]),{category:r.Structure}),C=p("Protein",a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.generator.atomGroups({"entity-test":y})]),{category:r.Type}),w=p("Nucleic",a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.generator.atomGroups({"entity-test":v})]),{category:r.Type}),T=p("Helix",a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.generator.atomGroups({"entity-test":y,"residue-test":a.MolScriptBuilder.core.flags.hasAny([a.MolScriptBuilder.ammp("secondaryStructureFlags"),a.MolScriptBuilder.core.type.bitflags([o.SecondaryStructureType.Flag.Helix])])})]),{category:r.Structure,ensureCustomProperties:(e,t)=>d.v.attach(e,t)}),A=p("Beta Strand/Sheet",a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.generator.atomGroups({"entity-test":y,"residue-test":a.MolScriptBuilder.core.flags.hasAny([a.MolScriptBuilder.ammp("secondaryStructureFlags"),a.MolScriptBuilder.core.type.bitflags([o.SecondaryStructureType.Flag.Beta])])})]),{category:r.Structure,ensureCustomProperties:(e,t)=>d.v.attach(e,t)}),I=p("Water",a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.generator.atomGroups({"entity-test":a.MolScriptBuilder.core.rel.eq([a.MolScriptBuilder.ammp("entityType"),"water"])})]),{category:r.Type}),P=p("Ion",a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.generator.atomGroups({"entity-test":a.MolScriptBuilder.core.rel.eq([a.MolScriptBuilder.ammp("entitySubtype"),"ion"])})]),{category:r.Type}),B=p("Lipid",a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.generator.atomGroups({"entity-test":a.MolScriptBuilder.core.rel.eq([a.MolScriptBuilder.ammp("entitySubtype"),"lipid"])})]),{category:r.Type}),E=p("Carbohydrate",a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.generator.atomGroups({"entity-test":a.MolScriptBuilder.core.logic.or([a.MolScriptBuilder.core.rel.eq([a.MolScriptBuilder.ammp("entityType"),"branched"]),a.MolScriptBuilder.core.logic.and([a.MolScriptBuilder.core.rel.eq([a.MolScriptBuilder.ammp("entityType"),"non-polymer"]),a.MolScriptBuilder.core.str.match([a.MolScriptBuilder.re("oligosaccharide","i"),a.MolScriptBuilder.ammp("entitySubtype")])])])})]),{category:r.Type}),k=p("Carbohydrate with Connected",a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.modifier.includeConnected({0:E.expression,"layer-count":1,"as-whole-residues":!0})]),{category:r.Internal,isHidden:!0}),D=p("Connected to Carbohydrate",a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.modifier.exceptBy({0:k.expression,by:E.expression})]),{category:r.Internal,isHidden:!0}),M=p("Ligand",a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.modifier.exceptBy({0:a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.combinator.merge([a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.generator.atomGroups({"entity-test":a.MolScriptBuilder.core.logic.and([a.MolScriptBuilder.core.logic.or([a.MolScriptBuilder.core.rel.eq([a.MolScriptBuilder.ammp("entityType"),"non-polymer"]),a.MolScriptBuilder.core.rel.neq([a.MolScriptBuilder.ammp("entityPrdId"),""])]),a.MolScriptBuilder.core.logic.not([a.MolScriptBuilder.core.str.match([a.MolScriptBuilder.re("(oligosaccharide|lipid|ion)","i"),a.MolScriptBuilder.ammp("entitySubtype")])])]),"chain-test":a.MolScriptBuilder.core.rel.eq([a.MolScriptBuilder.ammp("objectPrimitive"),"atomistic"]),"residue-test":a.MolScriptBuilder.core.logic.not([a.MolScriptBuilder.core.str.match([a.MolScriptBuilder.re("saccharide","i"),a.MolScriptBuilder.ammp("chemCompType")])])})]),a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.generator.atomGroups({"entity-test":a.MolScriptBuilder.core.rel.eq([a.MolScriptBuilder.ammp("entityType"),"polymer"]),"chain-test":a.MolScriptBuilder.core.rel.eq([a.MolScriptBuilder.ammp("objectPrimitive"),"atomistic"]),"residue-test":b})])])]),by:a.MolScriptBuilder.struct.combinator.merge([a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.generator.atomGroups({"entity-test":a.MolScriptBuilder.core.rel.eq([a.MolScriptBuilder.ammp("entityType"),"polymer"]),"chain-test":a.MolScriptBuilder.core.rel.eq([a.MolScriptBuilder.ammp("objectPrimitive"),"atomistic"]),"residue-test":a.MolScriptBuilder.core.set.has([a.MolScriptBuilder.set(...l.M.toArray(o.PolymerNames)),a.MolScriptBuilder.ammp("label_comp_id")])})]),a.MolScriptBuilder.struct.generator.atomGroups({"chain-test":a.MolScriptBuilder.core.rel.eq([a.MolScriptBuilder.ammp("objectPrimitive"),"atomistic"]),"residue-test":a.MolScriptBuilder.core.set.has([a.MolScriptBuilder.set(...l.M.toArray(o.CommonProteinCaps)),a.MolScriptBuilder.ammp("label_comp_id")])})])})]),{category:r.Type}),R=p("Ligand with Connected",a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.modifier.exceptBy({0:a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.modifier.includeConnected({0:M.expression,"layer-count":1,"as-whole-residues":!0,"bond-test":a.MolScriptBuilder.core.flags.hasAny([a.MolScriptBuilder.struct.bondProperty.flags(),a.MolScriptBuilder.core.type.bitflags([o.BondType.Flag.Covalent|o.BondType.Flag.MetallicCoordination])])})]),by:E.expression})]),{category:r.Internal,isHidden:!0}),O=p("Connected to Ligand",a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.modifier.exceptBy({0:R.expression,by:M.expression})]),{category:r.Internal,isHidden:!0}),L=p("Connected to Ligand or Carbohydrate",a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.combinator.merge([D.expression,O.expression])]),{category:r.Internal,isHidden:!0}),N=p("Disulfide Bridges",a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.combinator.merge([a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.modifier.wholeResidues([a.MolScriptBuilder.struct.filter.isConnectedTo({0:a.MolScriptBuilder.struct.generator.atomGroups({"residue-test":a.MolScriptBuilder.core.set.has([a.MolScriptBuilder.set("CYS"),a.MolScriptBuilder.ammp("auth_comp_id")]),"atom-test":a.MolScriptBuilder.core.set.has([a.MolScriptBuilder.set("SG"),a.MolScriptBuilder.ammp("label_atom_id")])}),target:a.MolScriptBuilder.struct.generator.atomGroups({"residue-test":a.MolScriptBuilder.core.set.has([a.MolScriptBuilder.set("CYS"),a.MolScriptBuilder.ammp("auth_comp_id")]),"atom-test":a.MolScriptBuilder.core.set.has([a.MolScriptBuilder.set("SG"),a.MolScriptBuilder.ammp("label_atom_id")])}),"bond-test":!0})])]),a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.modifier.wholeResidues([a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.generator.bondedAtomicPairs({0:a.MolScriptBuilder.core.flags.hasAny([a.MolScriptBuilder.struct.bondProperty.flags(),a.MolScriptBuilder.core.type.bitflags([o.BondType.Flag.Disulfide])])})])])])])]),{category:r.Bond}),F=p("NOS Bridges",a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.modifier.wholeResidues([a.MolScriptBuilder.struct.filter.isConnectedTo({0:a.MolScriptBuilder.struct.generator.atomGroups({"residue-test":a.MolScriptBuilder.core.set.has([a.MolScriptBuilder.set("CSO","LYS"),a.MolScriptBuilder.ammp("auth_comp_id")]),"atom-test":a.MolScriptBuilder.core.set.has([a.MolScriptBuilder.set("OD","NZ"),a.MolScriptBuilder.ammp("label_atom_id")])}),target:a.MolScriptBuilder.struct.generator.atomGroups({"residue-test":a.MolScriptBuilder.core.set.has([a.MolScriptBuilder.set("CSO","LYS"),a.MolScriptBuilder.ammp("auth_comp_id")]),"atom-test":a.MolScriptBuilder.core.set.has([a.MolScriptBuilder.set("OD","NZ"),a.MolScriptBuilder.ammp("label_atom_id")])}),"bond-test":!0})])]),{category:r.Bond}),z=p("Non-standard Residues in Polymers",a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.generator.atomGroups({"entity-test":a.MolScriptBuilder.core.rel.eq([a.MolScriptBuilder.ammp("entityType"),"polymer"]),"chain-test":a.MolScriptBuilder.core.rel.eq([a.MolScriptBuilder.ammp("objectPrimitive"),"atomistic"]),"residue-test":a.MolScriptBuilder.ammp("isNonStandard")})]),{category:r.Residue}),j=p("Coarse Elements",a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.generator.atomGroups({"chain-test":a.MolScriptBuilder.core.set.has([a.MolScriptBuilder.set("sphere","gaussian"),a.MolScriptBuilder.ammp("objectPrimitive")])})]),{category:r.Type}),V=p("Rings in Residues",a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.generator.rings()]),{category:r.Residue}),U=p("Aromatic Rings in Residues",a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.generator.rings({"only-aromatic":!0})]),{category:r.Residue}),G=p("Surrounding Residues (5 ) of Selection",a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.modifier.exceptBy({0:a.MolScriptBuilder.struct.modifier.includeSurroundings({0:a.MolScriptBuilder.internal.generator.current(),radius:5,"as-whole-residues":!0}),by:a.MolScriptBuilder.internal.generator.current()})]),{description:"Select residues within 5  of the current selection.",category:r.Manipulate,referencesCurrent:!0}),H=p("Surrounding Ligands (5 ) of Selection",a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.modifier.surroundingLigands({0:a.MolScriptBuilder.internal.generator.current(),radius:5,"include-water":!0})]),{description:"Select ligand components within 5  of the current selection.",category:r.Manipulate,referencesCurrent:!0}),q=p("Surrounding Atoms (5 ) of Selection",a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.modifier.exceptBy({0:a.MolScriptBuilder.struct.modifier.includeSurroundings({0:a.MolScriptBuilder.internal.generator.current(),radius:5,"as-whole-residues":!1}),by:a.MolScriptBuilder.internal.generator.current()})]),{description:"Select atoms within 5  of the current selection.",category:r.Manipulate,referencesCurrent:!0}),Q=p("Inverse / Complement of Selection",a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.modifier.exceptBy({0:a.MolScriptBuilder.struct.generator.all(),by:a.MolScriptBuilder.internal.generator.current()})]),{description:"Select everything not in the current selection.",category:r.Manipulate,referencesCurrent:!0}),$=p("Residues Covalently Bonded to Selection",a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.modifier.includeConnected({0:a.MolScriptBuilder.internal.generator.current(),"layer-count":1,"as-whole-residues":!0})]),{description:"Select residues covalently bonded to current selection.",category:r.Manipulate,referencesCurrent:!0}),X=p("Covalently Bonded Component",a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.modifier.includeConnected({0:a.MolScriptBuilder.internal.generator.current(),"fixed-point":!0})]),{description:"Select covalently bonded component based on current selection.",category:r.Manipulate,referencesCurrent:!0}),W=p("Residues with Cov. or Metallic Bond to Selection",a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.modifier.includeConnected({0:a.MolScriptBuilder.internal.generator.current(),"layer-count":1,"as-whole-residues":!0,"bond-test":a.MolScriptBuilder.core.flags.hasAny([a.MolScriptBuilder.struct.bondProperty.flags(),a.MolScriptBuilder.core.type.bitflags([o.BondType.Flag.Covalent|o.BondType.Flag.MetallicCoordination])])})]),{description:"Select residues with covalent or metallic bond to current selection.",category:r.Manipulate,referencesCurrent:!0}),Y=p("Whole Residues of Selection",a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.modifier.wholeResidues({0:a.MolScriptBuilder.internal.generator.current()})]),{description:"Expand current selection to whole residues.",category:r.Manipulate,referencesCurrent:!0}),Z=[[["HIS"],"Histidine"],[["ARG"],"Arginine"],[["LYS"],"Lysine"],[["ILE"],"Isoleucine"],[["PHE"],"Phenylalanine"],[["LEU"],"Leucine"],[["TRP"],"Tryptophan"],[["ALA"],"Alanine"],[["MET"],"Methionine"],[["PRO"],"Proline"],[["CYS"],"Cysteine"],[["ASN"],"Asparagine"],[["VAL"],"Valine"],[["GLY"],"Glycine"],[["SER"],"Serine"],[["GLN"],"Glutamine"],[["TYR"],"Tyrosine"],[["ASP"],"Aspartic Acid"],[["GLU"],"Glutamic Acid"],[["THR"],"Threonine"],[["SEC"],"Selenocysteine"],[["PYL"],"Pyrrolysine"],[["UNK"],"Unknown"]].sort((e,t)=>e[1]<t[1]?-1:e[1]>t[1]?1:0),K=[[["A","DA"],"Adenosine"],[["C","DC"],"Cytidine"],[["T","DT"],"Thymidine"],[["G","DG"],"Guanosine"],[["I","DI"],"Inosine"],[["U","DU"],"Uridine"],[["N","DN"],"Unknown"]].sort((e,t)=>e[1]<t[1]?-1:e[1]>t[1]?1:0)
function J([e,t],n,r=0){const i=1!==e.length||ne.has(e[0])?`${t} (${e.join(", ")})`:`[${e[0]}] ${t}`
return p(i,a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.generator.atomGroups({"residue-test":a.MolScriptBuilder.core.set.has([a.MolScriptBuilder.set(...e),a.MolScriptBuilder.ammp("auth_comp_id")])})]),{category:n,priority:r,description:i})}function ee([e,t],n,r){const i=`${t} (${e.join(", ")})`
return p(i,a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.generator.atomGroups({"atom-test":a.MolScriptBuilder.core.set.has([a.MolScriptBuilder.set(...e),a.MolScriptBuilder.acp("elementSymbol")])})]),{category:n,priority:r,description:i})}function te([e,t],n,r){const i=`${t}`
return p(`${t}`,a.MolScriptBuilder.struct.modifier.union([a.MolScriptBuilder.struct.generator.atomGroups({"entity-test":a.MolScriptBuilder.core.list.equal([a.MolScriptBuilder.list(...e),a.MolScriptBuilder.ammp("entityDescription")])})]),{category:n,priority:r,description:i})}const ne=l.M.unionMany(o.AminoAcidNamesL,o.RnaBaseNames,o.DnaBaseNames,o.WaterNames)
function re(e){const t=new Set
for(const r of e)r.uniqueElementSymbols.forEach(e=>t.add(e))
const n=[]
return t.forEach(e=>{const t=u.Z6[e]||e
n.push(ee([[e],t],"Element Symbol",0))}),n}function ie(e){const t=new Map,n=new Set
for(const i of e){i.uniqueResidueNames.forEach(e=>n.add(e))
for(const e of i.models)i.uniqueResidueNames.forEach(n=>{const r=e.properties.chemicalComponentMap.get(n)
r&&t.set(n,r.name)})}const r=[]
return l.M.difference(n,ne).forEach(e=>{const n=t.get(e)||e
r.push(J([[e],n],"Ligand/Non-standard Residue",200))}),r}function oe(e){const t=new Map,n=i.StructureElement.Location.create()
for(const o of e){n.structure=o
for(const e of o.unitSymmetryGroups){n.unit=e.units[0],n.element=e.elements[0]
const r=i.StructureProperties.entity.type(n)
if("polymer"===r||"branched"===r){const e=i.StructureProperties.entity.pdbx_description(n)
t.set(e.join(", "),e)}}}const r=[]
return t.forEach((e,t)=>{r.push(te([e,t],"Polymer/Carbohydrate Entities",300))}),r}function ae(e,t,n){return e.apply(c.f.Model.StructureSelectionFromExpression,{expression:se[t].expression,label:se[t].label},{tags:n?[t,n]:[t]})}const se={all:h,current:f,polymer:m,trace:g,backbone:x,sidechain:S,sidechainWithTrace:_,protein:C,nucleic:w,helix:T,beta:A,water:I,ion:P,lipid:B,branched:E,branchedPlusConnected:k,branchedConnectedOnly:D,ligand:M,ligandPlusConnected:R,ligandConnectedOnly:O,connectedOnly:L,disulfideBridges:N,nosBridges:F,nonStandardPolymer:z,coarse:j,ring:V,aromaticRing:U,surroundings:G,surroundingLigands:H,surroundingAtoms:q,complement:Q,covalentlyBonded:$,covalentlyOrMetallicBonded:W,covalentlyBondedComponent:X,wholeResidues:Y}
class le{add(e){this.list.push(e),this.options.push([e,e.label,e.category]),this.version+=1}remove(e){const t=this.list.indexOf(e);-1!==t&&(this.list.splice(t,1),this.options.splice(t,1),this.version+=1)}constructor(){this.list=[],this.options=[],this.version=1,this.list.push(...Object.values(se),...Z.map(e=>J(e,r.AminoAcid)),...K.map(e=>J(e,r.NucleicBase))),this.options.push(...this.list.map(e=>[e,e.label,e.category]))}}},66588(e,t,n){"use strict"
n.d(t,{i:()=>r})
var r={}
n.r(r),n.d(r,{Bundle:()=>s.N,Location:()=>o.a,Loci:()=>a.Q,Schema:()=>l.Schema,Stats:()=>i,atomicProperty:()=>f,chainIndex:()=>y,coarseProperty:()=>m,entityIndex:()=>v,property:()=>p,residueIndex:()=>g})
var i,o=n(72146),a=n(21700),s=n(47589),l=n(71534),c=n(67538),u=n(97960)
!function(e){function t(){return{elementCount:0,conformationCount:0,residueCount:0,chainCount:0,unitCount:0,structureCount:0,firstElementLoc:o.a.create(void 0),firstConformationLoc:o.a.create(void 0),firstResidueLoc:o.a.create(void 0),firstChainLoc:o.a.create(void 0),firstUnitLoc:o.a.create(void 0),firstStructureLoc:o.a.create(void 0)}}function n(e,t,n){const r=e.get(t)||0
e.set(t,r+n)}function r(e,t,r){const{indices:i,unit:a}=r,{elements:s}=a,l=c.CD.size(i),d=new Map,p=new Map
if(l>0&&o.a.set(e.firstElementLoc,t,a,s[c.CD.start(i)]),l===s.length)e.unitCount+=1,1===e.unitCount&&o.a.set(e.firstUnitLoc,t,a,s[c.CD.start(i)])
else if(1===l){if(u.N.Traits.is(a.traits,u.N.Trait.MultiChain))return
e.elementCount+=1,1===e.elementCount&&o.a.set(e.firstElementLoc,t,a,s[c.CD.start(i)])}else if(u.N.isAtomic(a)){const{index:r,offsets:u}=a.model.atomicHierarchy.residueAtomSegments,{label_alt_id:h}=a.model.atomicHierarchy.atoms
let f=0
for(;f<l;){d.clear()
let m=0
const g=s[c.CD.getAt(i,f)],y=r[g]
for(n(d,h.value(g),1),++f,++m;f<l;){const e=s[c.CD.getAt(i,f)]
if(r[e]!==y)break
n(d,h.value(e),1),++f,++m}if(u[y+1]-u[y]===m)e.residueCount+=1,1===e.residueCount&&o.a.set(e.firstResidueLoc,t,a,u[y])
else{p.clear()
for(let e=u[y],t=u[y+1];e<t;++e)n(p,h.value(e),1)
p.get("")===d.get("")&&d.forEach((n,r)=>{if(p.get(r)===n){if(""!==r&&(e.conformationCount+=1,1===e.conformationCount))for(let n=u[y],i=u[y+1];n<i;++n)if(r===h.value(n)){o.a.set(e.firstConformationLoc,t,a,n)
break}m-=n}}),e.elementCount+=m}}}else e.elementCount+=l,1===e.elementCount&&o.a.set(e.firstElementLoc,t,a,s[c.CD.start(i)])}function i(e,t,n){const{indices:r,unit:i}=n,a=c.CD.size(r)
if(0===a)return
const{elements:s}=i
if(!u.N.Traits.is(i.traits,u.N.Trait.MultiChain))return void(a===s.length&&(e.chainCount+=1,1===e.chainCount&&o.a.set(e.firstChainLoc,t,i,s[c.CD.start(r)])))
const l=u.N.isAtomic(i)?i.model.atomicHierarchy.chainAtomSegments:u.N.isSpheres(i)?i.model.coarseHierarchy.spheres.chainElementSegments:u.N.isGaussians(i)?i.model.coarseHierarchy.gaussians.chainElementSegments:void 0
if(!l)return void console.warn("StructureElement loci stats: unknown unit type")
const{index:d,offsets:p}=l
let h=0
for(;h<a;){let n=0
const l=s[c.CD.getAt(r,h)],u=d[l]
for(++h,++n;h<a&&d[s[c.CD.getAt(r,h)]]===u;)++h,++n
p[u+1]-p[u]===n?(e.chainCount+=1,1===e.chainCount&&o.a.set(e.firstChainLoc,t,i,p[u])):1===a&&(e.elementCount+=1,1===e.elementCount&&o.a.set(e.firstElementLoc,t,i,l))}}function s(e,t,r,i,a){let s=r[i]
const l=u.N.isAtomic(s.unit)?s.unit.model.atomicHierarchy.chainAtomSegments:u.N.isSpheres(s.unit)?s.unit.model.coarseHierarchy.spheres.chainElementSegments:u.N.isGaussians(s.unit)?s.unit.model.coarseHierarchy.gaussians.chainElementSegments:void 0
if(!l)return void console.warn("StructureElement loci stats: unknown unit type")
const{index:d,offsets:p}=l,h=new Map
for(let o=i;o<a;o++){s=r[o]
const{indices:e,unit:t}=s,i=c.CD.size(e)
if(0===i)continue
const{elements:a}=t
if(!u.N.Traits.is(t.traits,u.N.Trait.MultiChain)){n(h,d[a[c.CD.start(e)]],a.length)
continue}let l=0
for(;l<i;){let t=0
const r=d[a[c.CD.getAt(e,l)]]
for(++l,++t;l<i&&d[a[c.CD.getAt(e,l)]]===r;)++l,++t
n(h,r,t)}}let f=-1
if(h.forEach((t,n)=>{p[n+1]-p[n]===t&&(e.chainCount+=1,1===e.chainCount&&(f=n))}),!(f<0))for(let n=i;n<a;n++){s=r[n]
const{indices:i,unit:a}=s,l=c.CD.size(i)
if(0===l)continue
const{elements:u}=a,p=0
for(;p<l;){const n=u[c.CD.getAt(i,p)]
if(d[n]===f)return void o.a.set(e.firstChainLoc,t,a,n)}}}e.create=t,e.ofLoci=function(e){const n=t()
if(a.Q.isEmpty(e))return n
let l=!1
if(a.Q.isWholeStructure(e)){if(n.structureCount+=1,1===n.structureCount){const{unit:t,indices:r}=e.elements[0]
o.a.set(n.firstStructureLoc,e.structure,t,t.elements[c.CD.min(r)])}}else for(const t of e.elements)r(n,e.structure,t),u.N.Traits.is(t.unit.traits,u.N.Trait.Partitioned)?l=!0:i(n,e.structure,t)
if(l)for(let t=0,r=e.elements.length;t<r;t++){const o=e.elements[t]
if(!u.N.Traits.is(o.unit.traits,u.N.Trait.Partitioned))continue
const a=t
for(;t<r&&u.N.areSameChainOperatorGroup(e.elements[t].unit,o.unit);)t++
const l=t
t--,l-a===1?i(n,e.structure,o):s(n,e.structure,e.elements,a,l)}return n},e.add=function(e,t,n){return 1===t.elementCount&&0===n.elementCount?o.a.copy(e.firstElementLoc,t.firstElementLoc):0===t.elementCount&&1===n.elementCount&&o.a.copy(e.firstElementLoc,n.firstElementLoc),1===t.conformationCount&&0===n.conformationCount?o.a.copy(e.firstConformationLoc,t.firstConformationLoc):0===t.conformationCount&&1===n.conformationCount&&o.a.copy(e.firstConformationLoc,n.firstConformationLoc),1===t.residueCount&&0===n.residueCount?o.a.copy(e.firstResidueLoc,t.firstResidueLoc):0===t.residueCount&&1===n.residueCount&&o.a.copy(e.firstResidueLoc,n.firstResidueLoc),1===t.chainCount&&0===n.chainCount?o.a.copy(e.firstChainLoc,t.firstChainLoc):0===t.chainCount&&1===n.chainCount&&o.a.copy(e.firstChainLoc,n.firstChainLoc),1===t.unitCount&&0===n.unitCount?o.a.copy(e.firstUnitLoc,t.firstUnitLoc):0===t.unitCount&&1===n.unitCount&&o.a.copy(e.firstUnitLoc,n.firstUnitLoc),1===t.structureCount&&0===n.structureCount?o.a.copy(e.firstStructureLoc,t.firstStructureLoc):0===t.structureCount&&1===n.structureCount&&o.a.copy(e.firstStructureLoc,n.firstStructureLoc),e.elementCount=t.elementCount+n.elementCount,e.conformationCount=t.conformationCount+n.conformationCount,e.residueCount=t.residueCount+n.residueCount,e.chainCount=t.chainCount+n.chainCount,e.unitCount=t.unitCount+n.unitCount,e.structureCount=t.structureCount+n.structureCount,e}}(i||(i={}))
var d=n(68329)
function p(e){return e}function h(e){throw new Error(`Property only available for ${e} models.`)}function f(e){return t=>u.N.isAtomic(t.unit)?e(t):h("atomic")}function m(e){return t=>u.N.isCoarse(t.unit)?e(t):h("coarse")}function g(e){return u.N.isAtomic(e.unit)?e.unit.residueIndex[e.element]:-1}function y(e){return u.N.isAtomic(e.unit)?e.unit.chainIndex[e.element]:-1}function v(e){return d.Z.entity.key(e)}},66706(e,t,n){"use strict"
n.d(t,{m:()=>i})
var r=n(18891)
function i(e){return e&&(0,r.T)(e.schedule)}},67151(e,t,n){"use strict"
n.d(t,{Ms:()=>y,vU:()=>h})
var r=n(76513),i=n(18891),o=n(28539),a=n(86814),s=n(17642)
function l(){}var c=u("C",void 0,void 0)
function u(e,t,n){return{kind:e,value:t,error:n}}var d=n(52234),p=n(10390),h=function(e){function t(t){var n=e.call(this)||this
return n.isStopped=!1,t?(n.destination=t,(0,o.Uv)(t)&&t.add(n)):n.destination=x,n}return(0,r.C6)(t,e),t.create=function(e,t,n){return new y(e,t,n)},t.prototype.next=function(e){this.isStopped?b(function(e){return u("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?b(u("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?b(c,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(o.yU),f=Function.prototype.bind
function m(e,t){return f.call(e,t)}var g=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver
if(t.next)try{t.next(e)}catch(e){v(e)}},e.prototype.error=function(e){var t=this.partialObserver
if(t.error)try{t.error(e)}catch(e){v(e)}else v(e)},e.prototype.complete=function(){var e=this.partialObserver
if(e.complete)try{e.complete()}catch(e){v(e)}},e}(),y=function(e){function t(t,n,r){var o,s,l=e.call(this)||this
return(0,i.T)(t)||!t?o={next:null!=t?t:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0}:l&&a.$.useDeprecatedNextContext?((s=Object.create(t)).unsubscribe=function(){return l.unsubscribe()},o={next:t.next&&m(t.next,s),error:t.error&&m(t.error,s),complete:t.complete&&m(t.complete,s)}):o=t,l.destination=new g(o),l}return(0,r.C6)(t,e),t}(h)
function v(e){a.$.useDeprecatedSynchronousErrorHandling?(0,p.l)(e):(0,s.m)(e)}function b(e,t){var n=a.$.onStoppedNotification
n&&d.f.setTimeout(function(){return n(e,t)})}var x={closed:!0,next:l,error:function(e){throw e},complete:l}},67538(e,t,n){"use strict"
n.d(t,{Yz:()=>c,IX:()=>r.I,YB:()=>s,CD:()=>i.C,hT:()=>o.h,X9:()=>a.X})
var r=n(88434),i=n(20321),o=n(65939),a=n(52349)
function s(e){return new l(e)}n(14033)
class l{remove(e){const{prev:t,next:n}=this,r=t[e],i=n[e]
r>=0&&(n[r]=i,t[e]=-1),i>=0&&(t[i]=r,n[e]=-1),e===this.head&&(this.head=r<0?i:r)}has(e){return this.prev[e]>=0||this.next[e]>=0||this.head===e}constructor(e){this.head=e>0?0:-1,this.prev=new Int32Array(e),this.next=new Int32Array(e)
for(let t=0;t<e;t++)this.next[t]=t+1,this.prev[t]=t-1
this.prev[0]=-1,this.next[e-1]=-1}}var c,u=n(41059)
!function(e){function t(){return new Map}e.Empty=new Map,e.keyArray=function(e){return(0,u.ZR)(e.keys())},e.Mutable=t,e.asImmutable=function(e){return e},e.copy=function(e){const n=t(),r=e.keys()
for(;;){const{done:t,value:i}=r.next()
if(t)break
n.set(i,e.get(i))}return n},e.addFrom=function(e,t){const n=t.keys()
for(;;){const{done:r,value:i}=n.next()
if(r)break
e.set(i,t.get(i))}return e}}(c||(c={})),n(17963)},67632(e,t,n){"use strict"
n.r(t),n.d(t,{TrackedArray:()=>_,TrackedMap:()=>s,TrackedObject:()=>N,TrackedSet:()=>u,TrackedWeakMap:()=>l,TrackedWeakSet:()=>d,tracked:()=>F})
var r=n(90473),i=n(61603),o=n(80032)
function a(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e
var t=e[Symbol.toPrimitive]
if(void 0!==t){var n=t.call(e,"string")
if("object"!=typeof n)return n
throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e)
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class s{readStorageFor(e){const{storages:t}=this
let n=t.get(e)
void 0===n&&(n=(0,o.createStorage)(null,()=>!1),t.set(e,n)),(0,o.getValue)(n)}dirtyStorageFor(e){const t=this.storages.get(e)
t&&(0,o.setValue)(t,null)}constructor(e){a(this,"collection",(0,o.createStorage)(null,()=>!1)),a(this,"storages",new Map),a(this,"vals",void 0),this.vals=e?new Map(e):new Map}get(e){return this.readStorageFor(e),this.vals.get(e)}has(e){return this.readStorageFor(e),this.vals.has(e)}entries(){return(0,o.getValue)(this.collection),this.vals.entries()}keys(){return(0,o.getValue)(this.collection),this.vals.keys()}values(){return(0,o.getValue)(this.collection),this.vals.values()}forEach(e){(0,o.getValue)(this.collection),this.vals.forEach(e)}get size(){return(0,o.getValue)(this.collection),this.vals.size}[Symbol.iterator](){return(0,o.getValue)(this.collection),this.vals[Symbol.iterator]()}get[Symbol.toStringTag](){return this.vals[Symbol.toStringTag]}set(e,t){return this.dirtyStorageFor(e),(0,o.setValue)(this.collection,null),this.vals.set(e,t),this}delete(e){return this.dirtyStorageFor(e),(0,o.setValue)(this.collection,null),this.storages.delete(e),this.vals.delete(e)}clear(){this.storages.forEach(e=>(0,o.setValue)(e,null)),this.storages.clear(),(0,o.setValue)(this.collection,null),this.vals.clear()}}Object.setPrototypeOf(s.prototype,Map.prototype)
class l{readStorageFor(e){const{storages:t}=this
let n=t.get(e)
void 0===n&&(n=(0,o.createStorage)(null,()=>!1),t.set(e,n)),(0,o.getValue)(n)}dirtyStorageFor(e){const t=this.storages.get(e)
t&&(0,o.setValue)(t,null)}constructor(e){a(this,"storages",new WeakMap),a(this,"vals",void 0),this.vals=e?new WeakMap(e):new WeakMap}get(e){return this.readStorageFor(e),this.vals.get(e)}has(e){return this.readStorageFor(e),this.vals.has(e)}set(e,t){return this.dirtyStorageFor(e),this.vals.set(e,t),this}delete(e){return this.dirtyStorageFor(e),this.storages.delete(e),this.vals.delete(e)}get[Symbol.toStringTag](){return this.vals[Symbol.toStringTag]}}function c(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e
var t=e[Symbol.toPrimitive]
if(void 0!==t){var n=t.call(e,"string")
if("object"!=typeof n)return n
throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e)
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.setPrototypeOf(l.prototype,WeakMap.prototype)
class u{storageFor(e){const t=this.storages
let n=t.get(e)
return void 0===n&&(n=(0,o.createStorage)(null,()=>!1),t.set(e,n)),n}dirtyStorageFor(e){const t=this.storages.get(e)
t&&(0,o.setValue)(t,null)}constructor(e){c(this,"collection",(0,o.createStorage)(null,()=>!1)),c(this,"storages",new Map),c(this,"vals",void 0),this.vals=new Set(e)}has(e){return(0,o.getValue)(this.storageFor(e)),this.vals.has(e)}entries(){return(0,o.getValue)(this.collection),this.vals.entries()}keys(){return(0,o.getValue)(this.collection),this.vals.keys()}values(){return(0,o.getValue)(this.collection),this.vals.values()}forEach(e){(0,o.getValue)(this.collection),this.vals.forEach(e)}get size(){return(0,o.getValue)(this.collection),this.vals.size}[Symbol.iterator](){return(0,o.getValue)(this.collection),this.vals[Symbol.iterator]()}get[Symbol.toStringTag](){return this.vals[Symbol.toStringTag]}add(e){return this.dirtyStorageFor(e),(0,o.setValue)(this.collection,null),this.vals.add(e),this}delete(e){return this.dirtyStorageFor(e),(0,o.setValue)(this.collection,null),this.storages.delete(e),this.vals.delete(e)}clear(){this.storages.forEach(e=>(0,o.setValue)(e,null)),(0,o.setValue)(this.collection,null),this.storages.clear(),this.vals.clear()}}Object.setPrototypeOf(u.prototype,Set.prototype)
class d{storageFor(e){const t=this.storages
let n=t.get(e)
return void 0===n&&(n=(0,o.createStorage)(null,()=>!1),t.set(e,n)),n}dirtyStorageFor(e){const t=this.storages.get(e)
t&&(0,o.setValue)(t,null)}constructor(e){c(this,"storages",new WeakMap),c(this,"vals",void 0),this.vals=new WeakSet(e)}has(e){return(0,o.getValue)(this.storageFor(e)),this.vals.has(e)}add(e){return this.vals.add(e),this.dirtyStorageFor(e),this}delete(e){return this.dirtyStorageFor(e),this.storages.delete(e),this.vals.delete(e)}get[Symbol.toStringTag](){return this.vals[Symbol.toStringTag]}}function p(e,t,n){h(e,t),t.set(e,n)}function h(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function f(e,t){return e.get(m(e,t))}function m(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n
throw new TypeError("Private element is not present on this object")}Object.setPrototypeOf(d.prototype,WeakSet.prototype)
const g=new Set([Symbol.iterator,"concat","entries","every","filter","find","findIndex","flat","flatMap","forEach","includes","indexOf","join","keys","lastIndexOf","map","reduce","reduceRight","slice","some","values"]),y=new Set(["fill","push","unshift"])
function v(e){if("symbol"==typeof e)return null
const t=Number(e)
return isNaN(t)?null:t%1==0?t:null}var b=new WeakMap,x=new WeakMap,S=new WeakSet
class _{static from(e,t,n){return new _(t?Array.from(e,t,n):Array.from(e))}static of(...e){return new _(e)}constructor(e=[]){var t
h(this,t=S),t.add(this),p(this,b,(0,o.createStorage)(null,()=>!1)),p(this,x,new Map)
const n=e.slice(),r=this,i=new Map
let a=!1
return new Proxy(n,{get(e,t){const n=v(t)
if(null!==n)return m(S,r,C).call(r,n),(0,o.getValue)(f(b,r)),e[n]
if("length"===t)return a?a=!1:(0,o.getValue)(f(b,r)),e[t]
if(y.has(t)&&(a=!0),g.has(t)){let n=i.get(t)
return void 0===n&&(n=(...n)=>((0,o.getValue)(f(b,r)),e[t](...n)),i.set(t,n)),n}return e[t]},set(e,t,n){e[t]=n
const i=v(t)
return null!==i?(m(S,r,w).call(r,i),m(S,r,T).call(r)):"length"===t&&m(S,r,T).call(r),!0},getPrototypeOf:()=>_.prototype})}}function C(e){let t=f(x,this).get(e)
void 0===t&&(t=(0,o.createStorage)(null,()=>!1),f(x,this).set(e,t)),(0,o.getValue)(t)}function w(e){const t=f(x,this).get(e)
t&&(0,o.setValue)(t,null)}function T(){(0,o.setValue)(f(b,this),null),f(x,this).clear()}function A(e,t,n){I(e,t),t.set(e,n)}function I(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function P(e,t){return e.get(B(e,t))}function B(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n
throw new TypeError("Private element is not present on this object")}Object.setPrototypeOf(_.prototype,Array.prototype)
var E=new WeakMap,k=new WeakMap,D=new WeakSet
class M{static fromEntries(e){return new N(Object.fromEntries(e))}constructor(e={}){var t
I(this,t=D),t.add(this),A(this,E,new Map),A(this,k,(0,o.createStorage)(null,()=>!1))
const n=Object.getPrototypeOf(e),r=Object.getOwnPropertyDescriptors(e),i=Object.create(n)
for(const o in r)Object.defineProperty(i,o,r[o])
const a=this
return new Proxy(i,{get:(e,t)=>(B(D,a,R).call(a,t),e[t]),has:(e,t)=>(B(D,a,R).call(a,t),t in e),ownKeys:e=>((0,o.getValue)(P(k,a)),Reflect.ownKeys(e)),set:(e,t,n)=>(e[t]=n,B(D,a,O).call(a,t),B(D,a,L).call(a),!0),deleteProperty:(e,t)=>(t in e&&(delete e[t],B(D,a,O).call(a,t),P(E,a).delete(t),B(D,a,L).call(a)),!0),getPrototypeOf:()=>M.prototype})}}function R(e){let t=P(E,this).get(e)
void 0===t&&(t=(0,o.createStorage)(null,()=>!1),P(E,this).set(e,t)),(0,o.getValue)(t)}function O(e){const t=P(E,this).get(e)
t&&(0,o.setValue)(t,null)}function L(){(0,o.setValue)(P(k,this),null)}const N=M
function F(e,t,n){if(void 0!==t&&void 0!==n)return(0,r.tracked)(e,t,n)
if(Array.isArray(e))return new _(e)
switch(e){case Object:return new N
case Array:return new _
case Map:return new s
case WeakMap:return new l
case Set:return new u
case WeakSet:return new d}return e instanceof Map?new s(e):e instanceof WeakMap?new l:e instanceof Set?new u(e):e instanceof WeakSet?new d:((0,i.assert)("You must either use tracked as a field decorator, or to wrap built-in class instances:\n\n      class Example {\n        @tracked field = 123;\n\n        map = tracked(Map);\n        map = tracked(new Map());\n      }","object"==typeof e&&null!==e),new N(e))}},67679(e,t,n){"use strict"
var r
n.d(t,{Q:()=>r}),function(e){e.add=function(e,t,n){e.squaredDistances[e.count]=n,e.indices[e.count++]=t},e.reset=function(e){e.count=0},e.create=function(){return{count:0,indices:[],squaredDistances:[]}},e.copy=function(e,t){for(let n=0;n<t.count;++n)e.indices[n]=t.indices[n],e.squaredDistances[n]=t.squaredDistances[n]
return e.count=t.count,e}}(r||(r={}))},67836(e,t,n){"use strict"
function r(e){return Math.max(...e)}n.r(t),n.d(t,{default:()=>i,max:()=>r})
var i=(0,n(10336).helper)(r)},68187(e,t,n){"use strict"
n.d(t,{v3:()=>c,yx:()=>d})
var r=n(9043),i=n(32775),o=n(31727),a=n(16159),s=n(22703),l=n(53138)
function c(e,t,n){switch(s.V.getGranularity(e,t.granularity)){case"uniform":return function(e,t,n){return e.reset(),function(e,t){return t?(r.IQ.update(t.uSize,e),r.IQ.updateIfChanged(t.dSizeType,"uniform"),t):{uSize:r.IQ.create(e),tSize:r.IQ.create(p),uSizeTexDim:r.IQ.create(i.ZY.create(1,1)),dSizeType:r.IQ.create("uniform")}}(t(e.hasNext?e.move().location:a.LU),n)}(e,t.size,n)
case"group":return function(e,t,n){const{groupCount:r}=e,i=(0,o.xg)(Math.max(1,r),3,Uint8Array,n&&n.tSize.ref.value.array)
for(e.reset();e.hasNext&&!e.isNextNewInstance;){const n=e.move();(0,l.Gu)(t(n.location)*u,i.array,3*n.groupIndex)}return h(i,"group",n)}(e,t.size,n)
case"groupInstance":return function(e,t,n){const{groupCount:r,instanceCount:i}=e,a=i*r,s=(0,o.xg)(Math.max(1,a),3,Uint8Array,n&&n.tSize.ref.value.array)
for(e.reset();e.hasNext;){const n=e.move();(0,l.Gu)(t(n.location)*u,s.array,3*n.index)}return h(s,"groupInstance",n)}(e,t.size,n)
case"instance":return function(e,t,n){const{instanceCount:r}=e,i=(0,o.xg)(Math.max(1,r),3,Uint8Array,n&&n.tSize.ref.value.array)
for(e.reset();e.hasNext&&!e.isNextNewInstance;){const n=e.move();(0,l.Gu)(t(n.location)*u,i.array,3*n.instanceIndex),e.skipInstance()}return h(i,"instance",n)}(e,t.size,n)}}const u=100
function d(e){switch(e.dSizeType.ref.value){case"uniform":return e.uSize.ref.value
case"instance":case"group":case"groupInstance":let t=0
const n=e.tSize.ref.value.array
for(let e=0,r=n.length;e<r;e+=3){const r=(0,l.OK)(n[e],n[e+1],n[e+2])
t<r&&(t=r)}return t/u}}const p={array:new Uint8Array(3),width:1,height:1}
function h(e,t,n){return n?(r.IQ.update(n.tSize,e),r.IQ.update(n.uSizeTexDim,i.ZY.create(e.width,e.height)),r.IQ.updateIfChanged(n.dSizeType,t),n):{uSize:r.IQ.create(0),tSize:r.IQ.create(e),uSizeTexDim:r.IQ.create(i.ZY.create(e.width,e.height)),dSizeType:r.IQ.create(t)}}},68281(e,t,n){"use strict"
n.d(t,{r:()=>l})
var r=n(92426),i=n(58558),o=n(70331),a=n(95538),s=n(63356)
class l{get childMutations(){return this._childMutations||(this._childMutations=new Map),this._childMutations}get dependencyMutations(){return this._dependencyMutations||(this._dependencyMutations=new Map),this._dependencyMutations}changeNodes(){this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable())}changeChildren(){this.changedChildren||(this.changedChildren=!0,this.children=this.children.asMutable())}changeDependencies(){this.changedDependencies||(this.changedDependencies=!0,this.dependencies=this.dependencies.asMutable())}get root(){return this.transforms.get(i.C.RootRef)}asTransient(){return this.asImmutable().asTransient()}addChild(e,t){if(this.changeChildren(),this.childMutations.has(e))this.childMutations.get(e).add(t)
else{const n=this.children.get(e).asMutable()
n.add(t),this.children.set(e,n),this.childMutations.set(e,n)}}removeChild(e,t){if(this.changeChildren(),this.childMutations.has(e))this.childMutations.get(e).remove(t)
else{const n=this.children.get(e).asMutable()
n.remove(t),this.children.set(e,n),this.childMutations.set(e,n)}}clearRoot(){const e=i.C.RootRef
if(0===this.children.get(e).size)return
this.changeChildren()
const t=(0,r.CD)()
this.children.set(e,t),this.childMutations.set(e,t)}mutateDependency(e,t,n){let i=this.dependencyMutations.get(e)
if(!i){const t=this.dependencies.get(e)
if(!t&&"remove"===n)return
this.changeDependencies(),i=t?t.asMutable():(0,r.CD)().asMutable(),this.dependencyMutations.set(e,i),this.dependencies.set(e,i)}"add"===n?i.add(t):i.remove(t)}changeParent(e,t){d(this.transforms,e)
const n=this.transforms.get(e)
this.removeChild(n.parent,e),this.addChild(t,e),this.changeNodes(),this.transforms.set(e,i.C.withParent(n,t))}add(e){const t=e.ref
this.transforms.has(e.ref)&&this.transforms.get(e.ref).parent!==e.parent&&function(e){throw new Error(`Transform '${e}' is already present in the tree.`)}(e.ref)
const n=this.children.get(e.parent)
if(n||function(e){throw new Error(`Parent '${e}' must be present in the tree.`)}(e.parent),n.has(e.ref)||this.addChild(e.parent,e.ref),this.children.has(e.ref)||(this.changedChildren||(this.changedChildren=!0,this.children=this.children.asMutable()),this.children.set(e.ref,(0,r.CD)())),this.changeNodes(),this.transforms.set(t,e),e.dependsOn)for(const r of e.dependsOn)this.mutateDependency(r,t,"add")
return this}setParams(e,t){d(this.transforms,e)
const n=this.transforms.get(e)
return!(0,a.bN)(n.params,t)&&(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(n.ref,i.C.withParams(n,t)),!0)}setTags(e,t){d(this.transforms,e)
const n=this.transforms.get(e),r=i.C.withTags(n,t)
return!(0,s.af)(n.tags,r.tags)&&(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(n.ref,r),!0)}setDependsOn(e,t){d(this.transforms,e)
const n=this.transforms.get(e),r=i.C.withDependsOn(n,t)
return!(0,s.af)(n.dependsOn,r.dependsOn)&&(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(n.ref,r),!0)}assignState(e,t){d(this.transforms,e)
const n=this.transforms.get(e)
if(this._stateUpdates&&this._stateUpdates.has(e))return i.C.assignState(n.state,t),n
{this._stateUpdates||(this._stateUpdates=new Set),this._stateUpdates.add(n.ref),this.changeNodes()
const r=i.C.withState(n,t)
return this.transforms.set(e,r),r}}remove(e){const t=this.transforms.get(e)
if(!t)return[]
const n=o.u.subtreePostOrder(this,t)
if(e===i.C.RootRef){if(n.pop(),0===n.length)return n
this.clearRoot()}else{if(0===n.length)return n
this.removeChild(t.parent,t.ref)}this.changeNodes(),this.changeChildren()
for(const i of n)this.transforms.delete(i.ref),this.children.delete(i.ref),this._childMutations&&this._childMutations.delete(i.ref)
const r=[]
for(const i of n){if(i.dependsOn)for(const e of i.dependsOn)this.transforms.has(e)&&this.mutateDependency(e,i.ref,"remove")
if(this.dependencies.has(i.ref)){const e=this.dependencies.get(i.ref).toArray()
this.changeDependencies(),this.dependencies.delete(i.ref),this._dependencyMutations&&this._dependencyMutations.delete(i.ref)
for(const t of e)if(this.transforms.has(t))for(const e of this.remove(t))r[r.length]=e}}for(const i of r)n[n.length]=i
return n}asImmutable(){return this.changedNodes||this.changedChildren||this._childMutations?(this._childMutations&&this._childMutations.forEach(c,this.children),this._dependencyMutations&&this._dependencyMutations.forEach(u,this.dependencies),o.u.create(this.changedNodes?this.transforms.asImmutable():this.transforms,this.changedChildren?this.children.asImmutable():this.children,this.changedDependencies?this.dependencies.asImmutable():this.dependencies)):this.tree}constructor(e){this.tree=e,this.transforms=this.tree.transforms,this.children=this.tree.children,this.dependencies=this.tree.dependencies,this.changedNodes=!1,this.changedChildren=!1,this.changedDependencies=!1,this._childMutations=void 0,this._dependencyMutations=void 0,this._stateUpdates=void 0}}function c(e,t){this.set(t,e.asImmutable())}function u(e,t){0===e.size?this.delete(t):this.set(t,e.asImmutable())}function d(e,t){if(!e.has(t))throw new Error(`Node '${t}' is not present in the tree.`)}},68329(e,t,n){"use strict"
n.d(t,{Z:()=>g})
var r=n(97960),i=n(87933),o=n(87095),a=n(30897),s=n(14294)
function l(){throw new Error("Property only available for atomic models.")}function c(e){if(e)throw new Error(`Property only available for coarse models (${e}).`)
throw new Error("Property only available for coarse models.")}const u={key:e=>e.element,x:e=>e.unit.conformation.x(e.element),y:e=>e.unit.conformation.y(e.element),z:e=>e.unit.conformation.z(e.element),id:e=>r.N.isAtomic(e.unit)?e.unit.model.atomicConformation.atomId.value(e.element):l(),occupancy:e=>r.N.isAtomic(e.unit)?e.unit.model.atomicConformation.occupancy.value(e.element):l(),B_iso_or_equiv:e=>r.N.isAtomic(e.unit)?e.unit.model.atomicConformation.B_iso_or_equiv.value(e.element):l(),sourceIndex:e=>r.N.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atomSourceIndex.value(e.element):e.element,type_symbol:e=>r.N.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.type_symbol.value(e.element):l(),label_atom_id:e=>r.N.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.label_atom_id.value(e.element):l(),auth_atom_id:e=>r.N.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.auth_atom_id.value(e.element):l(),label_alt_id:e=>r.N.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.label_alt_id.value(e.element):l(),label_comp_id:d,auth_comp_id:e=>r.N.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.auth_comp_id.value(e.element):l(),pdbx_formal_charge:e=>r.N.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.pdbx_formal_charge.value(e.element):l(),vdw_radius:e=>r.N.isAtomic(e.unit)?(0,i.sO)(e.unit.model.atomicHierarchy.atoms.type_symbol.value(e.element)):l()}
function d(e){return r.N.isAtomic(e.unit)||l(),e.unit.model.atomicHierarchy.atoms.label_comp_id.value(e.element)}function p(e){return r.N.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.label_seq_id.value(e.unit.residueIndex[e.element]):l()}function h(e){r.N.isAtomic(e.unit)||l()
const t=e.unit.model.sequence.byEntityKey[f(e)]
return t&&t.sequence.microHet.get(p(e))||[d(e)]}function f(e){switch(e.unit.kind){case r.N.Kind.Atomic:return e.unit.model.atomicHierarchy.index.getEntityFromChain(e.unit.chainIndex[e.element])
case r.N.Kind.Spheres:return e.unit.model.coarseHierarchy.spheres.entityKey[e.element]
case r.N.Kind.Gaussians:return e.unit.model.coarseHierarchy.gaussians.entityKey[e.element]}}const m=[],g={constant:{true:e=>!0,false:e=>!1,zero:e=>0},atom:u,residue:{key:e=>r.N.isAtomic(e.unit)?e.unit.residueIndex[e.element]:l(),group_PDB:e=>r.N.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.group_PDB.value(e.unit.residueIndex[e.element]):l(),label_comp_id:d,auth_comp_id:e=>r.N.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.auth_comp_id.value(e.element):l(),label_seq_id:p,auth_seq_id:e=>r.N.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.auth_seq_id.value(e.unit.residueIndex[e.element]):l(),pdbx_PDB_ins_code:e=>r.N.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.pdbx_PDB_ins_code.value(e.unit.residueIndex[e.element]):l(),isNonStandard:e=>r.N.isAtomic(e.unit)?h(e).some(t=>"n"===e.unit.model.properties.chemicalComponentMap.get(t).mon_nstd_flag[0]):l(),hasMicroheterogeneity:function(e){r.N.isAtomic(e.unit)||l()
const t=e.unit.model.sequence.byEntityKey[f(e)]
return t&&t.sequence.microHet.has(p(e))},microheterogeneityCompIds:h,secondary_structure_type:e=>{var t
r.N.isAtomic(e.unit)||l()
const n=null===(t=a.v.get(e.structure).value)||void 0===t?void 0:t.get(e.unit.invariantId)
return n?n.type[n.getIndex(e.unit.residueIndex[e.element])]:o.SecondaryStructureType.Flag.NA},secondary_structure_key:e=>{var t
r.N.isAtomic(e.unit)||l()
const n=null===(t=a.v.get(e.structure).value)||void 0===t?void 0:t.get(e.unit.invariantId)
return n?n.key[n.getIndex(e.unit.residueIndex[e.element])]:-1},chem_comp_type:e=>r.N.isAtomic(e.unit)?e.unit.model.properties.chemicalComponentMap.get(d(e)).type:l(),residueSourceIndex:e=>r.N.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residueSourceIndex.value(e.unit.residueIndex[e.element]):l()},chain:{key:e=>r.N.isAtomic(e.unit)?e.unit.chainIndex[e.element]:l(),label_asym_id:e=>r.N.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.label_asym_id.value(e.unit.chainIndex[e.element]):e.unit.coarseElements.asym_id.value(e.element),auth_asym_id:e=>r.N.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.auth_asym_id.value(e.unit.chainIndex[e.element]):l(),label_entity_id:e=>r.N.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.label_entity_id.value(e.unit.chainIndex[e.element]):e.unit.coarseElements.entity_id.value(e.element)},entity:{key:f,id:e=>e.unit.model.entities.data.id.value(f(e)),type:e=>e.unit.model.entities.data.type.value(f(e)),src_method:e=>e.unit.model.entities.data.src_method.value(f(e)),pdbx_description:e=>e.unit.model.entities.data.pdbx_description.value(f(e)),formula_weight:e=>e.unit.model.entities.data.formula_weight.value(f(e)),pdbx_number_of_molecules:e=>e.unit.model.entities.data.pdbx_number_of_molecules.value(f(e)),details:e=>e.unit.model.entities.data.details.value(f(e)),pdbx_mutation:e=>e.unit.model.entities.data.pdbx_mutation.value(f(e)),pdbx_fragment:e=>e.unit.model.entities.data.pdbx_fragment.value(f(e)),pdbx_ec:e=>e.unit.model.entities.data.pdbx_ec.value(f(e)),pdbx_parent_entity_id:e=>e.unit.model.entities.data.pdbx_parent_entity_id.value(f(e)),subtype:e=>e.unit.model.entities.subtype.value(f(e)),prd_id:e=>{var t,n
return null!==(n=null===(t=e.unit.model.entities.prd_id)||void 0===t?void 0:t.value(f(e)))&&void 0!==n?n:""}},unit:{id:e=>e.unit.id,chainGroupId:e=>e.unit.chainGroupId,multiChain:e=>r.N.Traits.is(e.unit.traits,r.N.Trait.MultiChain),object_primitive:e=>e.unit.objectPrimitive,operator_name:e=>e.unit.conformation.operator.name,instance_id:e=>e.unit.conformation.operator.instanceId,operator_key:e=>e.unit.conformation.operator.key,model_index:e=>e.unit.model.modelNum,model_label:e=>e.unit.model.label,model_entry_id:e=>e.unit.model.entryId,hkl:e=>e.unit.conformation.operator.hkl,spgrOp:e=>e.unit.conformation.operator.spgrOp,model_num:e=>e.unit.model.modelNum,pdbx_struct_assembly_id:e=>{var t
return(null===(t=e.unit.conformation.operator.assembly)||void 0===t?void 0:t.id)||s.JX.DefaultName},pdbx_struct_oper_list_ids:e=>{var t
return(null===(t=e.unit.conformation.operator.assembly)||void 0===t?void 0:t.operList)||m},struct_ncs_oper_id:e=>e.unit.conformation.operator.ncsId},coarse:{key:u.key,entityKey:e=>r.N.isCoarse(e.unit)?e.unit.coarseElements.entityKey[e.element]:c(),x:u.x,y:u.y,z:u.z,asym_id:e=>r.N.isCoarse(e.unit)?e.unit.coarseElements.asym_id.value(e.element):c(),entity_id:e=>r.N.isCoarse(e.unit)?e.unit.coarseElements.entity_id.value(e.element):c(),seq_id_begin:e=>r.N.isCoarse(e.unit)?e.unit.coarseElements.seq_id_begin.value(e.element):c(),seq_id_end:e=>r.N.isCoarse(e.unit)?e.unit.coarseElements.seq_id_end.value(e.element):c(),sphere_radius:e=>r.N.isSpheres(e.unit)?e.unit.coarseConformation.radius[e.element]:c("spheres"),sphere_rmsf:e=>r.N.isSpheres(e.unit)?e.unit.coarseConformation.rmsf[e.element]:c("spheres"),gaussian_weight:e=>r.N.isGaussians(e.unit)?e.unit.coarseConformation.weight[e.element]:c("gaussians"),gaussian_covariance_matrix:e=>r.N.isGaussians(e.unit)?e.unit.coarseConformation.covariance_matrix[e.element]:c("gaussians")}}},68569(e,t,n){"use strict"
n.d(t,{c:()=>c})
var r=n(91375),i=n(20610),o=n(91660),a=n(62618),s=n(85404),l=n(66706)
function c(e,t,n){void 0===t&&(t=r.E)
var c=function(e,t,n){void 0===e&&(e=0),void 0===n&&(n=r.b)
var i=-1
return null!=t&&((0,l.m)(t)?n=t:i=t),new s.c(function(t){var r,o=(r=e)instanceof Date&&!isNaN(r)?+e-n.now():e
o<0&&(o=0)
var a=0
return n.schedule(function(){t.closed||(t.next(a++),0<=i?this.schedule(void 0,i):t.complete())},o)})}(e,t)
return function(e,t){return(0,i.N)(function(e,n){var r=null!=t?t:{},i=r.leading,s=void 0===i||i,l=r.trailing,u=void 0!==l&&l,d=!1,p=null,h=null,f=!1,m=function(){null==h||h.unsubscribe(),h=null,u&&(v(),f&&n.complete())},g=function(){h=null,f&&n.complete()},y=function(e){return h=(0,a.Tg)(c).subscribe((0,o._)(n,m,g))},v=function(){if(d){d=!1
var e=p
p=null,n.next(e),!f&&y()}}
e.subscribe((0,o._)(n,function(e){d=!0,p=e,(!h||h.closed)&&(s?v():y())},function(){f=!0,(!(u&&d&&h)||h.closed)&&n.complete()}))})}(0,n)}},68867(e,t,n){"use strict"
var r=(this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}})(n(20371)),i=n(9971)
function o(e,t){var n={}
return e&&"string"==typeof e?((0,r.default)(e,function(e,r){e&&r&&(n[(0,i.camelCase)(e,t)]=r)}),n):n}o.default=o,e.exports=o},69024(e,t,n){"use strict"
n.r(t),n.d(t,{default:()=>a})
var r=n(10336),i=n.n(r),o=n(15670)
class a extends(i()){compute(e){for(let t=0,n=e.length;t<n;t++)if(!1===(0,o.A)(e[t]))return e[t]
return e[e.length-1]}}},69045(e,t,n){"use strict"
n.d(t,{J:()=>r})
var r,i=n(97564),o=n(69755),a=n(39250),s=n(6539),l=n(37411)
function c(e){return 0}!function(e){function t(t,r,i){var o
let{assembly:s,ncsId:c,hkl:u,spgrOp:d,key:p}=i||{}
const h=u?l.e.clone(u):(0,l.e)()
d=null!=d?d:-1,p=null!=p?p:-1,c=c||-1
const f=a.$.isIdentity(r),m=function(e,t){if(!e)return""
if(e.assembly)return(r=e)&&r.matrix&&r.inverse&&"string"==typeof r.name?e.suffix:t?"":`_${e.assembly.operId}`
var r
if(void 0!==e.spgrOp&&void 0!==e.hkl&&-1!==e.spgrOp){const[t,r,i]=e.hkl
return`-${n(e.spgrOp,t,r,i)}`}return-1!==e.ncsId?`_${e.ncsId}`:""}(i,f),g=null!==(o=null==i?void 0:i.instanceId)&&void 0!==o?o:t
return f?{name:t,instanceId:g,assembly:s,matrix:r,inverse:a.$.identity(),isIdentity:!0,hkl:h,spgrOp:d,ncsId:c,suffix:m,key:p}:(a.$.isRotationAndTranslation(r,e.RotationTranslationEpsilon)||console.warn(`Symmetry operator (${t}) should be a composition of rotation and translation.`),{name:t,instanceId:g,assembly:s,matrix:r,inverse:a.$.invert((0,a.$)(),r),isIdentity:!1,hkl:h,spgrOp:d,key:p,ncsId:c,suffix:m})}function n(e,t,n,r){const i=e=>e>=0&&e<=9?`${e}`:`(${e})`
return`${e+1}_${i(t+5)}${i(n+5)}${i(r+5)}`}e.DefaultName="1_555",e.Default=t(e.DefaultName,a.$.identity()),e.RotationTranslationEpsilon=.005,e.create=t,e.getSymmetryOperatorName=n,e.getAssemblyOperatorName=function(e){return"ASM-"+e.join("-")}
const r=(0,a.$)()
e.checkIfRotationAndTranslation=function(t,n){a.$.setIdentity(r)
for(let e=0;e<3;e++)for(let n=0;n<3;n++)a.$.setValue(r,e,n,o.U.getValue(t,e,n))
return a.$.setTranslation(r,n),a.$.isRotationAndTranslation(r,e.RotationTranslationEpsilon)},e.ofRotationAndOffset=function(e,n,r,i){const s=a.$.identity()
for(let t=0;t<3;t++)for(let e=0;e<3;e++)a.$.setValue(s,t,e,o.U.getValue(n,t,e))
return a.$.setTranslation(s,r),t(e,s,{ncsId:i})}
const u=s.k.identity(),d=(0,s.k)(),p=(0,s.k)(),h=(0,l.e)()
e.lerpFromIdentity=function(e,t,n){const r=t.inverse
if(t.isIdentity)return a.$.copy(e,r)
const i=1-n
a.$.getRotation(d,r),s.k.slerp(d,u,d,i)
const o=s.k.getAxisAngle(h,d)
return a.$.fromRotation(e,o,h),a.$.setValue(e,0,3,i*a.$.getValue(r,0,3)),a.$.setValue(e,1,3,i*a.$.getValue(r,1,3)),a.$.setValue(e,2,3,i*a.$.getValue(r,2,3)),e},e.slerp=function(e,t,n,r){if(Math.abs(r)<=1e-5)return a.$.copy(e,t)
if(Math.abs(r-1)<=1e-5)return a.$.copy(e,n)
a.$.getRotation(d,t),a.$.getRotation(p,n),s.k.slerp(p,d,p,r)
const o=s.k.getAxisAngle(h,p)
return a.$.fromRotation(e,o,h),a.$.setValue(e,0,3,(0,i.Cc)(a.$.getValue(t,0,3),a.$.getValue(n,0,3),r)),a.$.setValue(e,1,3,(0,i.Cc)(a.$.getValue(t,1,3),a.$.getValue(n,1,3),r)),a.$.setValue(e,2,3,(0,i.Cc)(a.$.getValue(t,2,3),a.$.getValue(n,2,3),r)),e},e.compose=function(e,n){const r=a.$.mul((0,a.$)(),n.matrix,e.matrix)
return t(n.name,r,n)}
class f{constructor(e,t,n=c){this.operator=e,this.coordinates=t,this.r=n,this._x=t.x,this._y=t.y,this._z=t.z,this._m=e.matrix}invariantPosition(e,t){return t[0]=this._x[e],t[1]=this._y[e],t[2]=this._z[e],t}position(e,t){return t[0]=this._x[e],t[1]=this._y[e],t[2]=this._z[e],l.e.transformMat4(t,t,this._m),t}x(e){const t=this._m,n=t[0],r=t[4],i=t[8],o=t[12],a=this._x[e],s=this._y[e],l=this._z[e]
return(n*a+r*s+i*l+o)/(t[3]*a+t[7]*s+t[11]*l+t[15]||1)}y(e){const t=this._m,n=t[1],r=t[5],i=t[9],o=t[13],a=this._x[e],s=this._y[e],l=this._z[e]
return(n*a+r*s+i*l+o)/(t[3]*a+t[7]*s+t[11]*l+t[15]||1)}z(e){const t=this._m,n=t[2],r=t[6],i=t[10],o=t[14],a=this._x[e],s=this._y[e],l=this._z[e]
return(n*a+r*s+i*l+o)/(t[3]*a+t[7]*s+t[11]*l+t[15]||1)}}class m{constructor(e,t,n=c){this.operator=e,this.coordinates=t,this.r=n,this._x=t.x,this._y=t.y,this._z=t.z,this._m=e.matrix}invariantPosition(e,t){return t[0]=this._x[e],t[1]=this._y[e],t[2]=this._z[e],t}position(e,t){return t[0]=this.x(e),t[1]=this.y(e),t[2]=this.z(e),t}x(e){const t=this._m
return t[0]*this._x[e]+t[4]*this._y[e]+t[8]*this._z[e]+t[12]}y(e){const t=this._m
return t[1]*this._x[e]+t[5]*this._y[e]+t[9]*this._z[e]+t[13]}z(e){const t=this._m
return t[2]*this._x[e]+t[6]*this._y[e]+t[10]*this._z[e]+t[14]}}class g{constructor(e,t,n=c){this.operator=e,this.coordinates=t,this.r=n,this._x=t.x,this._y=t.y,this._z=t.z}invariantPosition(e,t){return t[0]=this._x[e],t[1]=this._y[e],t[2]=this._z[e],t}position(e,t){return t[0]=this._x[e],t[1]=this._y[e],t[2]=this._z[e],t}x(e){return this._x[e]}y(e){return this._y[e]}z(e){return this._z[e]}}e.createMapping=function(e,t,n=c){return a.$.isIdentity(e.matrix)?new g(e,t,n):0===(r=e.matrix)[3]&&0===r[7]&&0===r[11]&&1===r[15]?new m(e,t,n):new f(e,t,n)
var r}}(r||(r={}))},69082(e,t,n){"use strict"
var r
n.d(t,{x:()=>r}),function(e){e.message=function(e){return{type:"message",timestamp:new Date,message:e}},e.error=function(e){return{type:"error",timestamp:new Date,message:e}},e.warning=function(e){return{type:"warning",timestamp:new Date,message:e}},e.info=function(e){return{type:"info",timestamp:new Date,message:e}}}(r||(r={}))},69185(e,t,n){"use strict"
n.d(t,{x:()=>r})
var r,i=n(58558),o=n(92384),a=n(34874),s=n(12288)
!function(e){let t
e.getParamDefinition=function(e,t,n){return e.definition.params?e.definition.params(t,n):{}},e.is=function(e){return!!e&&"function"==typeof e.toAction&&"function"==typeof e.apply},function(e){e[e.Unchanged=0]="Unchanged",e[e.Updated=1]="Updated",e[e.Recreate=2]="Recreate",e[e.Null=3]="Null"}(t=e.UpdateResult||(e.UpdateResult={}))
const n=new Map,r=new Map
function l(e,t){const{name:s}=t,l=`${e}.${s}`
n.has(l)&&console.warn(`A transform with id '${s}' is already registered. Please pick a unique identifier for your transforms and/or register them only once. This is to ensure that transforms can be serialized and replayed.`)
const c={apply:(e,t,n)=>i.C.create(e,c,t,n),toAction:()=>a.K.fromTransformer(c),namespace:e,id:l,definition:t,createDefaultParams:(e,n)=>t.params?o.t.getDefaultValues(t.params(e,n)):{}}
return n.set(l,c),function(e){for(const t of e.definition.from)r.has(t.type)?r.get(t.type).push(e):r.set(t.type,[e])}(c),c}let c
e.getAll=function(){return Array.from(n.values())},e.get=function(e){const t=n.get(e)
if(!t)throw new Error(`A transformer with signature '${e}' is not registered.`)
return t},e.fromType=function(e){return r.get(e)||[]},e.create=l,e.factory=function(e){return t=>l(e,t)},e.builderFactory=function(e){return c.build(e)},function(e){e.build=function(e){return t=>function(e,t){return n=>l(e,{name:t.name,from:t.from instanceof Array?t.from:[t.from],to:t.to instanceof Array?t.to:[t.to],display:"string"==typeof t.display?{name:t.display}:t.display?t.display:{name:(0,s.ZH)(t.name.replace(/[-]/g," "))},params:"object"==typeof t.params?()=>t.params:t.params?t.params:void 0,isDecorator:t.isDecorator,...n})}(e,t)}}(c=e.Builder||(e.Builder={})),e.build=function(e){return c.build(e)},e.ROOT=l("build-in",{name:"root",from:[],to:[],display:{name:"Root",description:"For internal use."},apply(){throw new Error("should never be applied")},update:()=>t.Unchanged})}(r||(r={}))},69230(e,t,n){"use strict"
function r(e,t,n){return n?.forceNumber&&("number"!=typeof e&&(e=Number(e)),"number"!=typeof t&&(t=Number(t))),e<=t}n.r(t),n.d(t,{default:()=>r})},69396(e,t,n){"use strict"
function r(e,t,n){let r,i=1
for(r=0;r<t;r++){const t=i*e
if(Math.abs(Math.round(t)-t)<=n)return r
i*=10}return-1}function i(e,t){return Math.abs(e)<t?0:Math.floor(Math.log10(Math.abs(e)))+1}function o(e,t,n){let i=1,o=0
for(let a=0,s=e.length;a<s;a++){if(i>=0){const o=r(e[a],t,n)
o<0?i=-1:o>i&&(i=o)}const s=Math.abs(e[a])
if(s>n){const e=Math.floor(Math.log10(Math.abs(s)))+1
e>o&&(o=e)}}return{mantissaDigits:i,integerDigits:o}}function a(e){e=e.trim()
const t=parseInt(e,10)
return!Number.isNaN(t)&&t.toString()===e}function s(e){if(!isFinite(e))return 0
let t=1,n=0
for(;Math.round(e*t)/t!==e;)t*=10,++n
return n}function l(e,t){return parseFloat(e.toPrecision(t))}function c(e,t){return parseFloat(e.toFixed(t))}n.d(t,{Fq:()=>a,In:()=>o,Mg:()=>c,QX:()=>l,XV:()=>s,bL:()=>i})},69441(e,t,n){"use strict"
n.d(t,{Fp:()=>p,Je:()=>f,fV:()=>a.s,il:()=>a.S,lL:()=>s.C,o:()=>a.r})
var r=n(80191),i=n(39043),o=(n(77603),n(41113)),a=n(63767),s=n(69549)
function l(e,t){return e.get(function(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n
throw new TypeError("Private element is not present on this object")}(e,t))}n(61603),n(15546)
const c="undefined"!=typeof fetch?(...e)=>fetch(...e):"undefined"!=typeof FastBoot?(...e)=>FastBoot.require("node-fetch")(...e):()=>{throw new Error("No Fetch Implementation Found")},u=new Set(["updateRecord","createRecord","deleteRecord"]),d=new Map([[400,"Bad Request"],[401,"Unauthorized"],[402,"Payment Required"],[403,"Forbidden"],[404,"Not Found"],[405,"Method Not Allowed"],[406,"Not Acceptable"],[407,"Proxy Authentication Required"],[408,"Request Timeout"],[409,"Conflict"],[410,"Gone"],[411,"Length Required"],[412,"Precondition Failed"],[413,"Payload Too Large"],[414,"URI Too Long"],[415,"Unsupported Media Type"],[416,"Range Not Satisfiable"],[417,"Expectation Failed"],[419,"Page Expired"],[420,"Enhance Your Calm"],[421,"Misdirected Request"],[422,"Unprocessable Entity"],[423,"Locked"],[424,"Failed Dependency"],[425,"Too Early"],[426,"Upgrade Required"],[428,"Precondition Required"],[429,"Too Many Requests"],[430,"Request Header Fields Too Large"],[431,"Request Header Fields Too Large"],[450,"Blocked By Windows Parental Controls"],[451,"Unavailable For Legal Reasons"],[500,"Internal Server Error"],[501,"Not Implemented"],[502,"Bad Gateway"],[503,"Service Unavailable"],[504,"Gateway Timeout"],[505,"HTTP Version Not Supported"],[506,"Variant Also Negotiates"],[507,"Insufficient Storage"],[508,"Loop Detected"],[509,"Bandwidth Limit Exceeded"],[510,"Not Extended"],[511,"Network Authentication Required"]]),p={async request(e){let t
try{t=await c(e.request.url,e.request)}catch(e){throw e instanceof DOMException&&"AbortError"===e.name?(e.statusText="Aborted",e.status=20,e.isRequestError=!0):(e.statusText="Unknown Network Error",e.status=0,e.isRequestError=!0),e}const n=!t.ok||t.status>=400,r=e.request.op,o=Boolean(r&&u.has(r))
if(!n&&!o&&204!==t.status&&!t.headers.has("date")){const e=new Headers(t.headers)
e.set("date",(new Date).toUTCString()),t=function(e,t){const n=(0,i.a)(e)
return new Response(e.body,Object.assign(n,t))}(t,{headers:e})}if(e.setResponse(t),204===t.status)return null
let a=""
{const n=t.body.getReader(),r=new TextDecoder
let i=e.hasRequestedStream,o=i?new TransformStream:null,s=o?.writable.getWriter()
for(i&&(e.request.signal?.addEventListener("abort",()=>{i&&(o.writable.abort("Request Aborted"),o.readable.cancel("Request Aborted"))}),e.setStream(o.readable));;){const{done:t,value:l}=await n.read()
if(t){i&&(i=!1,await s.ready,await s.close())
break}if(a+=r.decode(l,{stream:!0}),i)await s.ready,await s.write(l)
else if(e.hasRequestedStream){const t=new TextEncoder
i=!0,o=new TransformStream,e.request.signal?.addEventListener("abort",()=>{i&&(o.writable.abort("Request Aborted"),o.readable.cancel("Request Aborted"))}),e.setStream(o.readable),s=o.writable.getWriter(),await s.ready,await s.write(t.encode(a)),await s.ready,await s.write(l)}}i&&(i=!1,await s.ready,await s.close())}if(n){let n
try{n=JSON.parse(a)}catch{}const r=Array.isArray(n)?n:null!==(s=n)&&"object"==typeof s&&Array.isArray(n.errors)?n.errors:null,i=t.statusText||d.get(t.status)||"Unknown Request Error",o=`[${t.status} ${i}] ${e.request.method??"GET"} (${t.type}) - ${t.url}`,l=r?new AggregateError(r,o):new Error(o)
throw l.status=t.status,l.statusText=i,l.isRequestError=!0,l.code=l.status,l.name=l.statusText.replaceAll(" ","")+"Error",l.content=n,l}return JSON.parse(a)
var s}}
var h=new WeakMap
class f{constructor(e){var t,n
n=[],function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(this,t=h),t.set(this,n),Object.assign(this,e),this._pending=new Map,this._deduped=new Map}useCache(e){return e[i.I]=!0,l(h,this).unshift(e),this}use(e){return l(h,this).push(...e),this}request(e){const t=l(h,this),n=e.controller||new AbortController
e.controller&&delete e.controller
const r=(0,o.dN)("REQ_ID")??0;(0,o.ml)("REQ_ID",r+1)
const a={controller:n,response:null,stream:null,hasRequestedStream:!1,id:r,identifier:null},s=(0,i.e)(t,e,0,a),c=(0,i.d)(r),u=(0,i.u)(s.then(e=>((0,i.s)(u,{isError:!1,result:e}),(0,i.f)(r),e),e=>{throw(0,i.s)(u,{isError:!0,result:e}),(0,i.f)(r),e}),s)
return c&&(0,i.s)(u,c),u}static create(e){return new this(e)}}globalThis.setWarpDriveLogging=r.q,globalThis.getWarpDriveRuntimeConfig=r.P},69549(e,t,n){"use strict"
n.d(t,{C:()=>c})
var r=n(63767),i=n(38382)
const o=new Set(["createRecord","updateRecord","deleteRecord"])
function a(e){return Boolean(e.op&&o.has(e.op))}function s(e){const t=function(e){return e instanceof AggregateError||"AggregateError"===e.name&&Array.isArray(e.errors)}(e),n=t?new AggregateError(structuredClone(e.errors),e.message):new Error(e.message)
return n.stack=e.stack,n.error=e.error,Object.assign(n,e),n}function l(e,t,n){if(e){const n=t.get(e)
if(n)return n.priority}return n}const c={request(e,t){if(!e.request.store||e.request.cacheOptions?.[i.ER])return t(e.request)
const{store:n}=e.request,r=n.identifierCache.getOrCreateDocumentIdentifier(e.request)
r&&e.setIdentifier(r)
const a=n.requestManager._deduped,l=r&&a.get(r),c=r?n.cache.peekRequest(r):null
if(function(e,t,n,r){const{cacheOptions:i}=t
return t.op&&o.has(t.op)||i?.reload||!n||!(!e.lifetimes||!r)&&e.lifetimes.isHardExpired(r,e)}(n,e.request,!!c,r)){if(l)return l.priority={blocking:!0},l.promise
let i=d(t,e,r,{blocking:!0})
return r&&(i=i.finally(()=>{a.delete(r),n.notifications.notify(r,"state")}),a.set(r,{priority:{blocking:!0},promise:i}),n.notifications.notify(r,"state")),i}if(function(e,t,n,r){const{cacheOptions:i}=t
return i?.backgroundReload||!(!e.lifetimes||!r)&&e.lifetimes.isSoftExpired(r,e)}(n,e.request,0,r)){let i=l?.promise||d(t,e,r,{blocking:!1})
r&&!l&&(i=i.finally(()=>{a.delete(r),n.notifications.notify(r,"state")}),a.set(r,{priority:{blocking:!1},promise:i}),n.notifications.notify(r,"state")),n.requestManager._pending.set(e.id,i)}const p=e.request[i._q]||!1
if(e.setResponse(c.response),"error"in c){const t=p?u(n,e.request,{shouldHydrate:p,identifier:r},c.content):c.content,i=s(c)
throw i.content=t,i}return p?u(n,e.request,{shouldHydrate:p,identifier:r},c.content):c.content}}
function u(e,t,n,i){const{identifier:o}=n
return i&&n.shouldHydrate?o?e._instanceCache.getDocument(o):new r.J(e,null,{request:t,document:i}):i??null}function d(e,t,n,r){const{store:o}=t.request,c={shouldHydrate:t.request[i._q]||!1,identifier:n,priority:r}
let d=!1
if(a(t.request)){d=!0
const e=t.request.data?.record||t.request.records?.[0]
e&&o.cache.willCommit(e,t)}o.lifetimes?.willRequest&&o.lifetimes.willRequest(t.request,n,o)
const p=e(t.request).then(e=>function(e,t,n,r){const{request:i}=t
let o
if(e.requestManager._pending.delete(t.id),e._enableAsyncFlush=!0,e._join(()=>{o=function(e,t,n,r){let i=null
if(a(t)){const n=t.data?.record||t.records?.[0]
n?i=e.cache.didCommit(n,r):function(e){return!a(e.request)||("createRecord"===e.request.op&&201===e.response?.status?!!e.content&&Object.keys(e.content).length>0:204!==e.response?.status)}(r)&&(i=e.cache.put(r))}else i=e.cache.put(r)
return u(e,t,n,i)}(e,i,n,r)}),e._enableAsyncFlush=null,e.lifetimes?.didRequest&&e.lifetimes.didRequest(t.request,r.response,n.identifier,e),l(n.identifier,e.requestManager._deduped,n.priority).blocking)return o
e.notifications._flush()}(o,t,c,e),e=>function(e,t,n,r){if(e.requestManager._pending.delete(t.id),t.request.signal?.aborted)throw r
let i
if(e._enableAsyncFlush=!0,e._join(()=>{i=function(e,t,n,r){let i
if(!a(t.request))return i=e.cache.put(r),u(e,t.request,n,i)
{const n=r&&r.content&&"object"==typeof r.content&&"errors"in r.content&&Array.isArray(r.content.errors)?r.content.errors:void 0,i=t.request.data?.record||t.request.records?.[0]
e.cache.commitWasRejected(i,n)}}(e,t,n,r)}),e._enableAsyncFlush=null,n.identifier&&e.lifetimes?.didRequest&&e.lifetimes.didRequest(t.request,r.response,n.identifier,e),a(t.request))throw r
if(l(n.identifier,e.requestManager._deduped,n.priority).blocking){const e=s(r)
throw e.content=i,e}e.notifications._flush()}(o,t,c,e))
if(!d)return p
const h=t.request.data?.record||t.request.records?.[0]
return o._requestCache._enqueue(p,{data:[{op:"saveRecord",recordIdentifier:h,options:void 0}]})}},69755(e,t,n){"use strict"
n.d(t,{U:()=>a})
var r=n(23325),i=n(39250),o=n(37411)
function a(){return a.zero()}!function(e){function t(){const e=[.1,0,0,0,0,0,0,0,0]
return e[0]=0,e}function n(){const e=t()
return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function a(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}e.zero=t,e.identity=n,e.setIdentity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},e.toArray=function(e,t,n){return t[n+0]=e[0],t[n+1]=e[1],t[n+2]=e[2],t[n+3]=e[3],t[n+4]=e[4],t[n+5]=e[5],t[n+6]=e[6],t[n+7]=e[7],t[n+8]=e[8],t},e.fromArray=function(e,t,n){return e[0]=t[n+0],e[1]=t[n+1],e[2]=t[n+2],e[3]=t[n+3],e[4]=t[n+4],e[5]=t[n+5],e[6]=t[n+6],e[7]=t[n+7],e[8]=t[n+8],e},e.fromColumns=function(e,t,n,r){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=n[0],e[4]=n[1],e[5]=n[2],e[6]=r[0],e[7]=r[1],e[8]=r[2],e},e.fromMat4=a
const s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
e.fromEuler=function(e,t,n){return i.$.fromEuler(s,t,n),a(e,s)},e.fromRotation=function(e,t,n){return i.$.fromRotation(s,t,n),a(e,s)},e.create=function(e,n,r,i,o,a,s,l,c){const u=t()
return u[0]=e,u[1]=n,u[2]=r,u[3]=i,u[4]=o,u[5]=a,u[6]=s,u[7]=l,u[8]=c,u}
const l=n()
function c(e,t,n){for(let r=0;r<9;r++)if(Math.abs(e[r]-t[r])>n)return!1
return!0}function u(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function d(e,t){if(e===t){const n=t[1],r=t[2],i=t[5]
e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=r,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8]
return e}function p(e,t){const n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8],d=u*a-s*c,p=-u*o+s*l,h=c*o-a*l
let f=n*d+r*p+i*h
return f?(f=1/f,e[0]=d*f,e[1]=(-u*r+i*c)*f,e[2]=(s*r-i*a)*f,e[3]=p*f,e[4]=(u*n-i*l)*f,e[5]=(-s*n+i*o)*f,e[6]=h*f,e[7]=(-c*n+r*l)*f,e[8]=(a*n-r*o)*f,e):(console.warn("non-invertible matrix.",t),e)}function h(e){const t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5],s=e[6],l=e[7],c=e[8]
return t*(c*o-a*l)+n*(-c*i+a*s)+r*(l*i-o*s)}function f(e){return e[0]+e[4]+e[8]}function m(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e}function g(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e}e.isIdentity=function(e,t){return c(e,l,void 0===t?r.p:t)},e.hasNaN=function(e){for(let t=0;t<9;t++)if(Number.isNaN(e[t]))return!0
return!1},e.clone=function(e){return u(t(),e)},e.areEqual=c,e.setValue=function(e,t,n,r){e[3*n+t]=r},e.getValue=function(e,t,n){return e[3*n+t]},e.copy=u,e.transpose=d,e.invert=p,e.symmtricFromUpper=function(e,t){return e===t?(e[3]=t[1],e[6]=t[2],e[7]=t[5]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[1],e[4]=t[4],e[5]=t[5],e[6]=t[2],e[7]=t[5],e[8]=t[8]),e},e.symmtricFromLower=function(e,t){return e===t?(e[1]=t[3],e[2]=t[6],e[5]=t[7]):(e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[3],e[4]=t[4],e[5]=t[7],e[6]=t[6],e[7]=t[7],e[8]=t[8]),e},e.determinant=h,e.trace=f,e.sub=m,e.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e},e.mul=function(e,t,n){const r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],d=t[8],p=n[0],h=n[1],f=n[2],m=n[3],g=n[4],y=n[5],v=n[6],b=n[7],x=n[8]
return e[0]=p*r+h*a+f*c,e[1]=p*i+h*s+f*u,e[2]=p*o+h*l+f*d,e[3]=m*r+g*a+y*c,e[4]=m*i+g*s+y*u,e[5]=m*o+g*l+y*d,e[6]=v*r+b*a+x*c,e[7]=v*i+b*s+x*u,e[8]=v*o+b*l+x*d,e},e.subScalar=function(e,t,n){return e[0]=t[0]-n,e[1]=t[1]-n,e[2]=t[2]-n,e[3]=t[3]-n,e[4]=t[4]-n,e[5]=t[5]-n,e[6]=t[6]-n,e[7]=t[7]-n,e[8]=t[8]-n,e},e.addScalar=function(e,t,n){return e[0]=t[0]+n,e[1]=t[1]+n,e[2]=t[2]+n,e[3]=t[3]+n,e[4]=t[4]+n,e[5]=t[5]+n,e[6]=t[6]+n,e[7]=t[7]+n,e[8]=t[8]+n,e},e.mulScalar=g
const y=Math.PI/3,v=t()
e.symmetricEigenvalues=function(t,n){const r=n[1]*n[1]+n[2]*n[2]+n[5]*n[5]
if(0===r)t[0]=n[0],t[1]=n[4],t[2]=n[8]
else{const i=f(n)/3,o=n[0]-i,a=n[4]-i,s=n[8]-i,l=o*o+a*a+s*s+2*r,c=Math.sqrt(l/6)
g(v,e.Identity,i),m(v,n,v),g(v,v,1/c)
const u=h(v)/2,d=u<=-1?y:u>=1?0:Math.acos(u)/3
t[0]=i+2*c*Math.cos(d),t[2]=i+2*c*Math.cos(d+2*y),t[1]=3*i-t[0]-t[2]}return t}
const b=[.1,0,0],x=[.1,0,0],S=[.1,0,0],_=[.1,0,0],C=[.1,0,0],w=[.1,0,0]
e.eigenvector=function(e,t,n){o.e.set(b,t[0]-n,t[1],t[2]),o.e.set(x,t[1],t[4]-n,t[5]),o.e.set(S,t[2],t[5],t[8]-n),o.e.cross(_,b,x),o.e.cross(C,b,S),o.e.cross(w,x,S)
const r=o.e.dot(_,_),i=o.e.dot(C,C),a=o.e.dot(w,w)
let s=r,l=0
return i>s&&(s=i,l=1),a>s&&(l=2),0===l?o.e.scale(e,_,1/Math.sqrt(r)):1===l?o.e.scale(e,C,1/Math.sqrt(i)):o.e.scale(e,w,1/Math.sqrt(a)),e},e.directionTransform=function(e,t){return a(e,t),p(e,e),d(e,e),e},e.Identity=n(),e.innerProduct=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]+e[4]*t[4]+e[5]*t[5]+e[6]*t[6]+e[7]*t[7]+e[8]*t[8]},e.adjointFromMat4=function(e,t){const n=t[0],r=t[1],i=t[2],o=t[4],a=t[5],s=t[6],l=t[8],c=t[9],u=t[10]
return e[0]=a*u-s*c,e[1]=s*l-o*u,e[2]=o*c-a*l,e[3]=c*i-u*r,e[4]=u*n-l*i,e[5]=l*r-c*n,e[6]=r*s-i*a,e[7]=i*o-n*s,e[8]=n*a-r*o,e}}(a||(a={}))},69858(e,t,n){"use strict"
n.d(t,{Gg:()=>l,MD:()=>h,Ti:()=>d,UG:()=>s,dn:()=>c,m6:()=>u})
var r=n(80813),i=n(32775),o=n(31727),a=n(31683)
function s(e,t,n,r){for(let i=t;i<n;++i)e[i]=255*r
return!0}function l(e,t){if(0===t||e.length<t)return 0
let n=0
for(let r=0;r<t;++r)n+=e[r]
return n/(255*t)}function c(e,t){if(0===t||e.length<t)return 1
let n=255
for(let r=0;r<t;++r)e[r]>0&&e[r]<n&&(n=e[r])
return n/255}function u(e,t,n){e.fill(0,t,n)}function d(e,t,n){const s=(0,o.xg)(Math.max(1,e),1,Uint8Array,n&&n.tTransparency.ref.value.array)
return n?(r.IQ.update(n.tTransparency,s),r.IQ.update(n.uTransparencyTexDim,i.ZY.create(s.width,s.height)),r.IQ.updateIfChanged(n.dTransparency,e>0),r.IQ.updateIfChanged(n.transparencyAverage,l(s.array,e)),r.IQ.updateIfChanged(n.transparencyMin,c(s.array,e)),r.IQ.updateIfChanged(n.dTransparencyType,t),n):{tTransparency:r.IQ.create(s),uTransparencyTexDim:r.IQ.create(i.ZY.create(s.width,s.height)),dTransparency:r.IQ.create(e>0),transparencyAverage:r.IQ.create(0),transparencyMin:r.IQ.create(1),tTransparencyGrid:r.IQ.create((0,a.z6)()),uTransparencyGridDim:r.IQ.create(i.eB.create(1,1,1)),uTransparencyGridTransform:r.IQ.create(i.Zb.create(0,0,0,1)),dTransparencyType:r.IQ.create(t),uTransparencyStrength:r.IQ.create(1)}}const p={array:new Uint8Array(1),width:1,height:1}
function h(e){return e?(r.IQ.update(e.tTransparency,p),r.IQ.update(e.uTransparencyTexDim,i.ZY.create(1,1)),e):{tTransparency:r.IQ.create(p),uTransparencyTexDim:r.IQ.create(i.ZY.create(1,1)),dTransparency:r.IQ.create(!1),transparencyAverage:r.IQ.create(0),transparencyMin:r.IQ.create(1),tTransparencyGrid:r.IQ.create((0,a.z6)()),uTransparencyGridDim:r.IQ.create(i.eB.create(1,1,1)),uTransparencyGridTransform:r.IQ.create(i.Zb.create(0,0,0,1)),dTransparencyType:r.IQ.create("groupInstance"),uTransparencyStrength:r.IQ.create(1)}}},69949(e,t,n){"use strict"
n.r(t),n.d(t,{default:()=>a,sum:()=>o})
var r=n(10336),i=n(52813)
function o(e){return(0,i.add)(e)}var a=(0,r.helper)(o)},70012(e,t,n){"use strict"
var r
n.d(t,{Gm:()=>r,BI:()=>l,L9:()=>u.L9,qI:()=>u.qI,VE:()=>i.VE,m1:()=>c.m1,vc:()=>u.vc,C_:()=>c.C_,vb:()=>c.vb,TI:()=>c.TI,YZ:()=>c.YZ,Ao:()=>c.Ao,ZR:()=>u.ZR,h3:()=>a,di:()=>i.di,eh:()=>i.eh,bd:()=>c.bd}),function(e){function t(e){const t=e.growBy*e.elementSize
e.currentSize=t,e.currentIndex=0,e.currentChunk=new e.ctor(t),e.allocatedSize+=t,e.chunks[e.chunks.length]=e.currentChunk}function n(e,t){const{ctor:n,chunks:r,currentIndex:i}=e
if(!r.length)return new n(0)
if(1===r.length&&(t||i===e.allocatedSize))return r[0]
let o=0
for(let c=0,u=r.length-1;c<u;c++)o+=r[c].length
o+=e.currentIndex
const a=new n(o)
let s=0
if(a.buffer)for(let c=0,u=r.length-1;c<u;c++)a.set(r[c],s),s+=r[c].length
else for(let c=0,u=r.length-1;c<u;c++){const e=r[c]
for(let t=0,n=e.length;t<n;t++)a[s+t]=e[t]
s+=e.length}const l=r[r.length-1]
if(a.buffer&&i>=e.currentSize)a.set(l,s)
else for(let c=0,u=l.length;c<u;c++)a[s+c]=l[c]
return a}e.is=function(e){return e.creator&&e.chunkSize},e.add4=function(e,n,r,i,o){e.currentIndex>=e.currentSize&&t(e)
const a=e.currentChunk,s=e.currentIndex
return a[s]=n,a[s+1]=r,a[s+2]=i,a[s+3]=o,e.currentIndex+=4,e.elementCount++},e.add3=function(e,n,r,i){e.currentIndex>=e.currentSize&&t(e)
const o=e.currentChunk,a=e.currentIndex
return o[a]=n,o[a+1]=r,o[a+2]=i,e.currentIndex+=3,e.elementCount++},e.add2=function(e,n,r){e.currentIndex>=e.currentSize&&t(e)
const i=e.currentChunk,o=e.currentIndex
return i[o]=n,i[o+1]=r,e.currentIndex+=2,e.elementCount++},e.add=function(e,n){return e.currentIndex>=e.currentSize&&t(e),e.currentChunk[e.currentIndex]=n,e.currentIndex+=1,e.elementCount++},e.addRepeat=function(e,n,r){for(let i=0;i<n;i++)e.currentIndex>=e.currentSize&&t(e),e.currentChunk[e.currentIndex++]=r,e.elementCount++
return e.elementCount},e.addMany=function(e,n){const{elementSize:r}=e
for(let i=0,o=n.length;i<o;i+=r){e.currentIndex>=e.currentSize&&t(e)
const{currentChunk:o}=e
for(let t=0;t<r;t++)o[e.currentIndex++]=n[i+t]
e.elementCount++}return e.elementCount},e.compact=function(e,t=!1){return n(e,t)},e._compact=n,e.create=function(e,t,n,r){const i={ctor:e,elementSize:t,growBy:Math.max(1,Math.ceil(n)),allocatedSize:0,elementCount:0,currentSize:0,currentChunk:void 0,currentIndex:0,chunks:[]}
if(void 0===r)return i
if("number"==typeof r)return i.currentChunk=new e(r*t),i.allocatedSize=r*t,i.currentSize=i.currentChunk.length,i.chunks[0]=i.currentChunk,i
const o=r
if(o.length%t!==0)throw new Error("initialChunk length must be a multiple of the element size.")
return i.currentChunk=o,i.allocatedSize=o.length,i.currentSize=o.length,i.chunks[0]=o,i}}(r||(r={}))
var i=n(42988)
function o(e,t,n){return e[t].key<e[n].key?-1:1}function a(e,t,n){const r=n&&n.start||0,a=n&&n.end||e.length
if(a-r<=0)throw new Error("Can only bucket non-empty collections.")
return function(e,t,n,r,a){const s=new Map,l=[]
let c=t(e[0]),u=!0
for(let i=r;i<a;i++){const n=t(e[i])
if(s.has(n))s.get(n).count++,c!==n&&(u=!1)
else{const e={key:n,count:1,offset:i}
s.set(n,e),l[l.length]=e}c=n}const d=new Int32Array(l.length+1)
d[l.length]=a
let p=!0
if(n)for(let i=1,o=l.length;i<o;i++)if(l[i-1].key>l[i].key){p=!1
break}if(u&&p){for(let e=0;e<l.length;e++)d[e]=l[e].offset
return d}n&&!p&&(0,i.di)(l,0,l.length,o,i.VE)
let h=0
for(let i=0;i<l.length;i++){const e=l[i]
e.offset=h,h+=e.count}const f=new Int32Array(a-r)
for(let i=r;i<a;i++){const n=t(e[i])
f[s.get(n).offset++]=e[i]}for(let i=0,o=f.length;i<o;i++)e[i+r]=f[i]
d[0]=r
for(let i=1;i<l.length;i++)d[i]=l[i-1].offset+r
return d}(e,t,!(!n||!n.sort),r,a)}class s{createGroup(e,t){const n=this.id++,r=[e]
return this.groups[n]=r,{id:n,keys:r,value:t}}add(e,t){const n=this.getHash(t)
if(this.byHash.has(n)){const r=this.byHash.get(n)
for(let n=0,o=r.length;n<o;n++){const i=r[n]
if(this.areEqual(t,i.value))return i.keys[i.keys.length]=e,i.value}const i=this.createGroup(e,t)
return r[r.length]=i,i.value}{const r=this.createGroup(e,t)
return this.byHash.set(n,[r]),r.value}}constructor(e,t){this.getHash=e,this.areEqual=t,this.id=0,this.byHash=new Map,this.groups=[]}}function l(e,t){return new s(e,t)}var c=n(95472)
n(83040)
var u=n(41059)},70101(e,t,n){"use strict"
function r([e]){return Math.sign(e)}n.r(t),n.d(t,{default:()=>i,sign:()=>r})
var i=(0,n(10336).helper)(r)},70188(e,t,n){"use strict"
!function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),e.exports=n(76193)},70254(e,t,n){"use strict"
n.d(t,{ar:()=>d.ar,ND:()=>d.ND,xv:()=>r.x,D4:()=>a})
var r=n(4485),i=n(94274),o=n(91229)
function a(e){let t=e.data
for(let n=e.encoding.length-1;n>=0;n--)t=s(t,e.encoding[n])
return t}function s(e,t){switch(t.kind){case"ByteArray":switch(t.type){case r.W.IntDataType.Uint8:return e
case r.W.IntDataType.Int8:return function(e){return new Int8Array(e.buffer,e.byteOffset)}(e)
case r.W.IntDataType.Int16:return function(e){return u(e,2,Int16Array)}(e)
case r.W.IntDataType.Uint16:return function(e){return u(e,2,Uint16Array)}(e)
case r.W.IntDataType.Int32:return function(e){return u(e,4,Int32Array)}(e)
case r.W.IntDataType.Uint32:return function(e){return u(e,4,Uint32Array)}(e)
case r.W.FloatDataType.Float32:return function(e){return u(e,4,Float32Array)}(e)
case r.W.FloatDataType.Float64:return function(e){return u(e,8,Float64Array)}(e)
default:(0,o.dr)(t.type)}case"FixedPoint":return function(e,t){const n=e.length,r=c(t.srcType,n),i=1/t.factor
for(let o=0;o<n;o++)r[o]=i*e[o]
return r}(e,t)
case"IntervalQuantization":return function(e,t){const n=e.length,r=c(t.srcType,n),i=(t.max-t.min)/(t.numSteps-1),o=t.min
for(let a=0;a<n;a++)r[a]=o+i*e[a]
return r}(e,t)
case"RunLength":return function(e,t){const n=l(t.srcType,t.srcSize)
let r=0
for(let i=0,o=e.length;i<o;i+=2){const t=e[i],o=e[i+1]
for(let e=0;e<o;++e)n[r++]=t}return n}(e,t)
case"Delta":return function(e,t){const n=e.length,r=l(t.srcType,n)
if(!n)return e
r[0]=e[0]+(0|t.origin)
for(let i=1;i<n;++i)r[i]=e[i]+r[i-1]
return r}(e,t)
case"IntegerPacking":return function(e,t){return e.length===t.srcSize?e:t.isUnsigned?function(e,t){const n=1===t.byteCount?255:65535,r=e.length,i=new Int32Array(t.srcSize)
let o=0,a=0
for(;o<r;){let t=0,r=e[o]
for(;r===n;)t+=r,o++,r=e[o]
t+=r,i[a]=t,o++,a++}return i}(e,t):function(e,t){const n=1===t.byteCount?127:32767,r=-n-1,i=e.length,o=new Int32Array(t.srcSize)
let a=0,s=0
for(;a<i;){let t=0,i=e[a]
for(;i===n||i===r;)t+=i,a++,i=e[a]
t+=i,o[s]=t,a++,s++}return o}(e,t)}(e,t)
case"StringArray":return function(e,t){const n=a({encoding:t.offsetEncoding,data:t.offsets}),r=a({encoding:t.dataEncoding,data:e}),i=t.stringData,o=new Array(n.length)
o[0]=""
for(let a=1,c=n.length;a<c;a++)o[a]=i.substring(n[a-1],n[a])
let s=0
const l=new Array(r.length)
for(let a=0,c=r.length;a<c;a++)l[s++]=o[r[a]+1]
return l}(e,t)}}function l(e,t){switch(e){case r.W.IntDataType.Int8:return new Int8Array(t)
case r.W.IntDataType.Int16:return new Int16Array(t)
case r.W.IntDataType.Int32:return new Int32Array(t)
case r.W.IntDataType.Uint8:return new Uint8Array(t)
case r.W.IntDataType.Uint16:return new Uint16Array(t)
case r.W.IntDataType.Uint32:return new Uint32Array(t)
default:return new Int32Array(t)}}function c(e,t){switch(e){case r.W.FloatDataType.Float32:return new Float32Array(t)
case r.W.FloatDataType.Float64:default:return new Float64Array(t)}}function u(e,t,n){return i.vX?new n(e.buffer):new n((0,i.yw)(e,t))}var d=n(12046)
n(99153)},70292(e,t,n){"use strict"
n.r(t),n.d(t,{MultistepTask:()=>l,Progress:()=>i,RuntimeContext:()=>r,Scheduler:()=>s._,Task:()=>o.Y,chunkedSubtask:()=>c.y})
var r,i,o=n(57959),a=n(37312)
!function(e){e.Synchronous=a.f}(r||(r={})),function(e){function t(e,n=""){const r=e.progress
if(!e.children.length)return r.isIndeterminate?`${n}${r.taskName}: ${r.message}`:`${n}${r.taskName}: [${r.current}/${r.max}] ${r.message}`
const i=n+"  |_ ",o=e.children.map(e=>t(e,i))
return r.isIndeterminate?`${n}${r.taskName}: ${r.message}\n${o.join("\n")}`:`${n}${r.taskName}: [${r.current}/${r.max}] ${r.message}\n${o.join("\n")}`}e.format=function(e){return t(e.root)}}(i||(i={}))
var s=n(7888)
function l(e,t,n,r){return i=>o.Y.create(e,async e=>n(i,n=>e.update({message:`${t[n]}`,current:n+1,max:t.length}),e),r)}var c=n(21317)},70331(e,t,n){"use strict"
n.d(t,{u:()=>r})
var r,i=n(92426),o=n(58558),a=n(68281)
!function(e){class t{get root(){return this.transforms.get(o.C.RootRef)}asTransient(){return new a.r(this)}constructor(e,t,n){this.transforms=e,this.children=t,this.dependencies=n}}function n(e,n,r){return new t(e,n,r)}function r(e){s(this,this.tree.transforms.get(e))}function s(e,t){const n=e.tree.children.get(t.ref)
n&&n.size&&n.forEach(r,e),e.f(t,e.tree,e.state)}function l(e,t,n,r){const i={tree:e,state:n,f:r}
return s(i,t),i.state}function c(e){u(this,this.tree.transforms.get(e))}function u(e,t){const n=e.f(t,e.tree,e.state)
if("boolean"==typeof n&&!n)return
const r=e.tree.children.get(t.ref)
r&&r.size&&r.forEach(c,e)}function d(e,t,n,r){const i={tree:e,state:n,f:r}
return u(i,t),i.state}function p(e,t,n){n.push(e)}function h(e,t,n){n.push(o.C.toJSON(e))}function f(e,t,n){if(t===n)return!0
const r=e.children.get(t).values()
for(;;){const t=r.next()
if(t.done)return!1
if(f(e,t.value,n))return!0}}e.createEmpty=function(e){const t=e||o.C.createRoot()
return n((0,i.T5)([[t.ref,t]]),(0,i.T5)([[t.ref,(0,i.CD)()]]),(0,i.T5)())},e.create=n,e.doPostOrder=l,e.doPreOrder=d,e.subtreePostOrder=function(e,t){return l(e,t,[],p)},e.toJSON=function(e){const t=[]
return d(e,e.root,t,h),{transforms:t}},e.fromJSON=function(e){const t=(0,i.T5)().asMutable(),r=(0,i.T5)().asMutable(),a=(0,i.T5)().asMutable()
for(const n of e.transforms){const e=o.C.fromJSON(n)
t.set(e.ref,e),r.has(e.ref)||r.set(e.ref,(0,i.CD)().asMutable()),e.ref!==e.parent&&r.get(e.parent).add(e.ref)}const s=new Set
for(const n of e.transforms){const e=n.ref
if(r.set(e,r.get(e).asImmutable()),n.dependsOn)for(const t of n.dependsOn)s.add(t),a.has(t)?a.get(t).add(e):a.set(t,(0,i.CD)([e]).asMutable())}return s.forEach(e=>{a.set(e,a.get(e).asImmutable())}),n(t.asImmutable(),r.asImmutable(),a.asImmutable())},e.dump=function(e){console.log({tr:e.transforms.keySeq().toArray(),tr1:e.transforms.valueSeq().toArray().map(e=>e.ref),ch:e.children.keySeq().toArray()})},e.subtreeHasRef=function(e,t,n){return!(!e.transforms.has(t)||!e.transforms.has(n))&&f(e,t,n)},e.getDecoratorRoot=function e(t,n){const r=t.children.get(n)
if(1!==r.size)return n
const i=t.transforms.get(r.first())
return(null==i?void 0:i.transformer.definition.isDecorator)?e(t,i.ref):n},e.setParamHashVersion=function(e,t){for(const n of t){const t=e.transforms.get(n)
t&&o.C.setParamsHashVersion(t)}},e.reuseTransformParams=function(e,t){const n=new Map(t.transforms.map(e=>[e.ref,e]))
for(const r of e.transforms){const e=n.get(r.ref)
e&&r.transformer===e.transformer&&r.version===e.version&&(r.params=e.params)}}}(r||(r={}))},70429(e,t,n){"use strict"
n.d(t,{H:()=>i,t:()=>r})
const r=function(){if("undefined"!=typeof window&&window.performance){const e=window.performance
return()=>e.now()}return"undefined"!=typeof process&&"undefined"!==process.hrtime&&"function"==typeof process.hrtime?()=>{const e=process.hrtime()
return 1e3*e[0]+e[1]/1e6}:Date.now?()=>Date.now():()=>+new Date}()
function i(e,t=!0){if(isNaN(e))return"n/a"
const n=Math.floor(e/36e5),r=Math.floor(e/6e4%60),i=Math.floor(e/1e3%60)
let o=Math.floor(e%1e3).toString()
for(;o.length<3;)o="0"+o
for(;!t&&o.length>1&&"0"===o[o.length-1];)o=o.substr(0,o.length-1)
return n>0?`${n}h${r}m${i}.${o}s`:r>0?`${r}m${i}.${o}s`:i>0?`${i}.${o}s`:`${e.toFixed(0)}ms`}},70594(e,t,n){"use strict"
n.d(t,{PO:()=>d,ci:()=>u,qg:()=>c})
var r=n(54749),i=n(48393),o=n(92384),a=n(96561),s=n(93076)
const l=(0,r.Color)(13421772),c={...(0,a.U)({type:"colors",colorList:"many-distinct"})}
function u(e,t){let n,r
if(e.structure){const o=function(e){const t=new Map
for(let n=0,r=e.units.length;n<r;++n){const r=e.units[n].conformation.operator.name
t.has(r)||t.set(r,t.size)}return t}(e.structure.root),s=Array.from(o.keys()),c=e=>s[e],u=(0,a.S)(o.size,t,{valueLabel:c})
r=u.legend,n=e=>{let t
if(i.StructureElement.Location.is(e)){const n=e.unit.conformation.operator.name
t=o.get(n)}else if(i.Bond.isLocation(e)){const n=e.aUnit.conformation.operator.name
t=o.get(n)}return void 0===t?l:u.color(t)}}else n=()=>l
return{factory:u,granularity:"instance",color:n,props:t,description:"Assigns a color based on the operator name of a transformed chain.",legend:r}}const d={name:"operator-name",label:"Operator Name",category:s.N.Symmetry,factory:u,getParams:function(e){return o.t.clone(c)},defaultValues:o.t.getDefaultValues(c),isApplicable:e=>!!e.structure}},70651(e,t,n){"use strict"
function r(e,t){return e===t}n.r(t),n.d(t,{default:()=>r})},70948(e,t,n){"use strict"
n.d(t,{X:()=>r})
var r,i=n(9043),o=n(14294),a=n(92384),s=n(81871),l=n(65081),c=n(17782),u=n(9726),d=n(64170),p=n(69858),h=n(31727),f=n(31683),m=n(32775),g=n(40426),y=n(16159),v=n(22394),b=n(71905),x=n(19231)
!function(e){class t{constructor(){this.index=0,this.textures=[]}get(){return this.textures[this.index]}set(e,t,n){this.textures[this.index]=Object.assign(this.textures[this.index]||{},{vertex:e,group:t,normal:n}),this.index=(this.index+1)%2}destroy(){for(const e of this.textures)e.vertex.destroy(),e.group.destroy(),e.normal.destroy()}}function n(e,n,r,a,s,l,c){const u=r.getWidth(),d=r.getHeight()
return c?(c.vertexCount=e,c.groupCount=n,i.IQ.update(c.geoTextureDim,m.ZY.set(c.geoTextureDim.ref.value,u,d)),i.IQ.update(c.vertexTexture,r),i.IQ.update(c.groupTexture,a),i.IQ.update(c.normalTexture,s),c.doubleBuffer.set(r,a,s),o.f8.copy(c.boundingSphere,l),c):{kind:"texture-mesh",vertexCount:e,groupCount:n,geoTextureDim:i.IQ.create(m.ZY.create(u,d)),vertexTexture:i.IQ.create(r),groupTexture:i.IQ.create(a),normalTexture:i.IQ.create(s),varyingGroup:i.IQ.create(!1),doubleBuffer:new t,boundingSphere:o.f8.clone(l),meta:{}}}function r(e){return n(0,0,e?e.vertexTexture.ref.value:(0,f.z6)(),e?e.groupTexture.ref.value:(0,f.z6)(),e?e.normalTexture.ref.value:(0,f.z6)(),e?e.boundingSphere:(0,o.f8)(),e)}e.DoubleBuffer=t,e.create=n,e.createEmpty=r,e.Params={...u.iy.Params,doubleSided:a.t.Boolean(!1,u.iy.CustomQualityParamInfo),flipSided:a.t.Boolean(!1,u.iy.ShadingCategory),flatShaded:a.t.Boolean(!1,u.iy.ShadingCategory),ignoreLight:a.t.Boolean(!1,u.iy.ShadingCategory),celShaded:a.t.Boolean(!1,u.iy.ShadingCategory),xrayShaded:a.t.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],u.iy.ShadingCategory),transparentBackfaces:a.t.Select("off",a.t.arrayToOptions(["off","on","opaque"]),u.iy.ShadingCategory),bumpFrequency:a.t.Numeric(0,{min:0,max:10,step:.1},u.iy.ShadingCategory),bumpAmplitude:a.t.Numeric(1,{min:0,max:5,step:.1},u.iy.ShadingCategory),interior:(0,x.ag)()},e.Utils={Params:e.Params,createEmpty:r,createValues:_,createValuesSimple:function(t,n,r,i,o){const s=u.iy.createSimple(r,i,o),l={...a.t.getDefaultValues(e.Params),...n}
return _(t,s.transform,s.locationIterator,s.theme,l)},updateValues:function(e,t){u.iy.updateValues(e,t),i.IQ.updateIfChanged(e.uDoubleSided,t.doubleSided),i.IQ.updateIfChanged(e.dFlatShaded,t.flatShaded),i.IQ.updateIfChanged(e.dFlipSided,t.flipSided),i.IQ.updateIfChanged(e.dIgnoreLight,t.ignoreLight),i.IQ.updateIfChanged(e.dCelShaded,t.celShaded),i.IQ.updateIfChanged(e.dXrayShaded,"inverted"===t.xrayShaded?"inverted":!0===t.xrayShaded?"on":"off"),i.IQ.updateIfChanged(e.dTransparentBackfaces,t.transparentBackfaces),i.IQ.updateIfChanged(e.uBumpFrequency,t.bumpFrequency),i.IQ.updateIfChanged(e.uBumpAmplitude,t.bumpAmplitude),i.IQ.update(e.uInteriorColor,(0,x.mT)(t.interior,e.uInteriorColor.ref.value)),i.IQ.update(e.uInteriorSubstance,(0,x.Zl)(t.interior,e.uInteriorSubstance.ref.value))},updateBoundingSphere:function(e,t){const n=o.f8.clone(t.boundingSphere),r=(0,h.Ax)(n,e.aTransform.ref.value,e.instanceCount.ref.value,0)
o.f8.equals(r,e.boundingSphere.ref.value)||i.IQ.update(e.boundingSphere,r),o.f8.equals(n,e.invariantBoundingSphere.ref.value)||(i.IQ.update(e.invariantBoundingSphere,n),i.IQ.update(e.uInvariantBoundingSphere,m.Zb.fromSphere(e.uInvariantBoundingSphere.ref.value,n)))},createRenderableState:function(e){const t=u.iy.createRenderableState(e)
return C(t,e),t},updateRenderableState:C,createPositionIterator:function(e,t){const n=e.meta.webgl
if(!n)return(0,s.iQ)(1,1,1,()=>y.LU)
n.namedFramebuffers[S]||(n.namedFramebuffers[S]=n.resources.framebuffer())
const r=n.namedFramebuffers[S],[i,o]=e.geoTextureDim.ref.value
let a
const l=e.vertexCount,c=t.instanceCount.ref.value,u=(0,s.tu)(),d=u.position,p=u.normal,h=t.aTransform.ref.value
return(0,s.iQ)(l,c,1,(t,s)=>{const{vertices:l,normals:c}=(()=>{if(!a){const t=new Float32Array(i*o*4)
r.bind(),e.vertexTexture.ref.value.attachFramebuffer(r,0),n.readPixels(0,0,i,o,t)
const s=new Float32Array(i*o*4)
r.bind(),e.normalTexture.ref.value.attachFramebuffer(r,0),n.readPixels(0,0,i,o,s),a={vertices:t,normals:s}}return a})()
return s<0?(m.eB.fromArray(d,l,4*t),m.eB.fromArray(p,c,4*t)):(m.eB.transformMat4Offset(d,l,h,0,4*t,16*s),m.eB.transformDirectionOffset(p,c,h,0,4*t,16*s)),u})}}
const S="texture-mesh"
function _(t,n,r,a,s){const{instanceCount:f,groupCount:y}=r,S=e.Utils.createPositionIterator(t,n),_=(0,l.D1)(r,S,a.color),C=s.instanceGranularity?(0,c.Km)(f,"instance"):(0,c.Km)(f*y,"groupInstance"),w=(0,d.WG)(),T=(0,p.MD)(),A=(0,b.JS)(),I=(0,v.IB)(),P=(0,g.EN)(),B={drawCount:t.vertexCount,vertexCount:t.vertexCount,groupCount:y,instanceCount:f},E=o.f8.clone(t.boundingSphere),k=(0,h.Ax)(E,n.aTransform.ref.value,f,0)
return{dGeometryType:i.IQ.create("textureMesh"),uGeoTexDim:t.geoTextureDim,tPosition:t.vertexTexture,tGroup:t.groupTexture,tNormal:t.normalTexture,dVaryingGroup:t.varyingGroup,boundingSphere:i.IQ.create(k),invariantBoundingSphere:i.IQ.create(E),uInvariantBoundingSphere:i.IQ.create(m.Zb.ofSphere(E)),..._,...C,...w,...T,...A,...I,...P,...n,...u.iy.createValues(s,B),uDoubleSided:i.IQ.create(s.doubleSided),dFlatShaded:i.IQ.create(s.flatShaded),dFlipSided:i.IQ.create(s.flipSided),dIgnoreLight:i.IQ.create(s.ignoreLight),dCelShaded:i.IQ.create(s.celShaded),dXrayShaded:i.IQ.create("inverted"===s.xrayShaded?"inverted":!0===s.xrayShaded?"on":"off"),dTransparentBackfaces:i.IQ.create(s.transparentBackfaces),uBumpFrequency:i.IQ.create(s.bumpFrequency),uBumpAmplitude:i.IQ.create(s.bumpAmplitude),uInteriorColor:i.IQ.create((0,x.mT)(s.interior,(0,m.Zb)())),uInteriorSubstance:i.IQ.create((0,x.Zl)(s.interior,(0,m.Zb)())),meta:i.IQ.create(t.meta)}}function C(e,t){u.iy.updateRenderableState(e,t),e.opaque=e.opaque&&!t.xrayShaded,e.writeDepth=e.opaque}}(r||(r={}))},71196(e,t,n){"use strict"
var r
n.d(t,{$:()=>r}),function(e){e.Null=16777214,e.areSame=function(e,t){return e.objectId===t.objectId&&e.instanceId===t.instanceId&&e.groupId===t.groupId}}(r||(r={}))},71534(e,t,n){"use strict"
n.r(t),n.d(t,{Schema:()=>u})
var r=n(99302),i=n(47589),o=n(21700)
function a(e){const t=[]
return l(e,e=>t.push(function(e){const{and:t}=r.MolScriptBuilder.core.logic,{eq:n,gre:i,lte:o}=r.MolScriptBuilder.core.rel,{macromolecular:a,ihm:l,core:c}=r.MolScriptBuilder.struct.atomProperty,u={}
s(e.label_entity_id)&&(u["entity-test"]=n([a.label_entity_id(),e.label_entity_id]))
const d=[]
s(e.operator_name)&&d.push(n([c.operatorName(),e.operator_name])),s(e.instance_id)&&d.push(n([c.instanceId(),e.instance_id])),s(e.label_asym_id)&&d.push(n([a.label_asym_id(),e.label_asym_id])),s(e.auth_asym_id)&&d.push(n([a.auth_asym_id(),e.auth_asym_id])),1===d.length?u["chain-test"]=d[0]:d.length>1&&(u["chain-test"]=t(d))
const p=[]
s(e.label_seq_id)&&p.push(l.hasSeqId({0:e.label_seq_id})),s(e.auth_seq_id)&&p.push(n([a.auth_seq_id(),e.auth_seq_id])),s(e.residue_index)&&p.push(n([a.residueSourceIndex(),e.residue_index])),s(e.pdbx_PDB_ins_code)&&p.push(n([a.pdbx_PDB_ins_code(),e.pdbx_PDB_ins_code])),(s(e.beg_label_seq_id)||s(e.end_label_seq_id))&&p.push(l.overlapsSeqIdRange({beg:e.beg_label_seq_id,end:e.end_label_seq_id})),s(e.beg_auth_seq_id)&&p.push(i([a.auth_seq_id(),e.beg_auth_seq_id])),s(e.end_auth_seq_id)&&p.push(o([a.auth_seq_id(),e.end_auth_seq_id])),1===p.length?u["residue-test"]=p[0]:p.length>1&&(u["residue-test"]=t(p))
const h=[]
return s(e.label_comp_id)&&h.push(n([a.label_comp_id(),e.label_comp_id])),s(e.auth_comp_id)&&h.push(n([a.auth_comp_id(),e.auth_comp_id])),s(e.atom_id)&&h.push(n([a.id(),e.atom_id])),s(e.atom_index)&&h.push(n([r.MolScriptBuilder.struct.atomProperty.core.sourceIndex(),e.atom_index])),s(e.label_atom_id)&&h.push(n([a.label_atom_id(),e.label_atom_id])),s(e.auth_atom_id)&&h.push(n([a.auth_atom_id(),e.auth_atom_id])),s(e.type_symbol)&&h.push(n([r.MolScriptBuilder.struct.atomProperty.core.elementSymbol(),e.type_symbol.toUpperCase()])),1===h.length?u["atom-test"]=h[0]:h.length>1&&(u["atom-test"]=t(h)),r.MolScriptBuilder.struct.generator.atomGroups(u)}(e))),1===t.length?t[0]:function(e){return r.MolScriptBuilder.struct.combinator.merge(e.map(e=>r.MolScriptBuilder.struct.modifier.union([e])))}(t)}function s(e){return null!=e}function l(e,t){if(function(e){return!!e.items}(e))if(Array.isArray(e.items))if(e.prefix)for(const n of e.items)t(Object.assign({},e.prefix,n))
else for(const n of e.items)t(n)
else{const n={...e.prefix},r=Object.keys(e.items),i=e.items[r[0]].length
for(let o=0;o<i;o++){for(const t of r)n[t]=e.items[t][o]
t(n)}}else t(e)}function c(e,t,n){const r=a(t)
return o.Q.fromExpression(e,r,n)}const u={forEachItem:l,toExpression:a,toLoci:c,toBundle:function(e,t,n){const r=c(e,t,n)
return i.N.fromLoci(r)}}},71545(e,t,n){"use strict"
n.d(t,{UC:()=>v,az:()=>g,wV:()=>y})
var r=n(32775),i=n(40165),o=n(1654),a=n(34322)
const s=(0,r.eB)(),l=(0,r.eB)(),c=(0,r.eB)(),u=(0,r.eB)(),d=(0,o.n)(4,!0)
function p(e){const t=e?36:24,n=(0,i.nT)(12,t)
for(let i=0;i<4;++i){const t=(i+1)%4
r.eB.set(s,d[3*i],d[3*i+1],-.5),r.eB.set(l,d[3*t],d[3*t+1],-.5),r.eB.set(c,d[3*t],d[3*t+1],.5),r.eB.set(u,d[3*i],d[3*i+1],.5),e?n.add(s,l,c):n.addQuad(s,l,c,u)}return r.eB.set(s,d[0],d[1],-.5),r.eB.set(l,d[3],d[4],-.5),r.eB.set(c,d[6],d[7],-.5),r.eB.set(u,d[9],d[10],-.5),e?n.add(c,l,s):n.addQuad(u,c,l,s),r.eB.set(s,d[0],d[1],.5),r.eB.set(l,d[3],d[4],.5),r.eB.set(c,d[6],d[7],.5),r.eB.set(u,d[9],d[10],.5),e?n.add(s,l,c):n.addQuad(s,l,c,u),n.getPrimitive()}let h,f,m
function g(){return h||(h=p(!1)),h}function y(){return f||(f=p(!0)),f}function v(){return m||(m=(0,a.L3)([.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5],[0,4,1,5,2,6,3,7,0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4])),m}},71695(e,t,n){"use strict"
n.d(t,{bw:()=>i,th:()=>o.t})
class r{add(e){const t=this.getHash(e)
if(this.byHash.has(t)){const n=this.byHash.get(t)
for(let t=0,r=n.length;t<r;t++)if(this.areEqual(e,n[t]))return!1
return n[n.length]=e,this.size++,!0}return this.byHash.set(t,[e]),this.size++,!0}has(e){const t=this.getHash(e)
if(!this.byHash.has(t))return!1
const n=this.byHash.get(t)
for(let r=0,i=n.length;r<i;r++)if(this.areEqual(e,n[r]))return!0
return!1}constructor(e,t){this.getHash=e,this.areEqual=t,this.size=0,this.byHash=new Map}}function i(e,t){return new r(e,t)}var o=n(78660)},71712(e,t,n){"use strict"
n.d(t,{On:()=>C,_V:()=>w})
var r=n(70012),i=n(81871),o=n(31727),a=n(14294),s=n(32775),l=n(9043),c=n(92384),u=n(9726),d=n(65081),p=n(17782),h=n(64170),f=n(69858),m=n(63356),g=n(40426),y=n(16159),v=n(46357),b=n(22394),x=n(71905)
const S=new Uint32Array([0,1,2,1,3,2]),_=new Float32Array([0,1,0,0,1,1,1,0]),C={nearest:"Nearest",catmulrom:"Catmulrom (Cubic)",mitchell:"Mitchell (Cubic)",bspline:"B-Spline (Cubic)"}
var w
Object.keys(C),function(e){function t(){return{type:0,center:(0,s.eB)(),rotation:(0,s.k)(),scale:(0,s.eB)(),transform:(0,s.$I)()}}function n(e,t,n,r,i,o,c){return c?function(e,t,n,r,i,o,a){const c=e.width,u=e.height
return l.IQ.update(a.imageTexture,e),l.IQ.update(a.imageTextureDim,s.ZY.set(a.imageTextureDim.ref.value,c,u)),l.IQ.update(a.cornerBuffer,t),l.IQ.update(a.groupTexture,n),l.IQ.update(a.valueTexture,r),l.IQ.updateIfChanged(a.trimType,i.type),l.IQ.update(a.trimCenter,s.eB.copy(a.trimCenter.ref.value,i.center)),l.IQ.update(a.trimRotation,s.k.copy(a.trimRotation.ref.value,i.rotation)),l.IQ.update(a.trimScale,s.eB.copy(a.trimScale.ref.value,i.scale)),l.IQ.update(a.trimTransform,s.$I.copy(a.trimTransform.ref.value,i.transform)),l.IQ.updateIfChanged(a.isoLevel,o),a}(e,t,n,r,i,o,c):function(e,t,n,r,i,o){const c=(0,a.f8)()
let u=-1
const d=e.width,p=e.height,h={kind:"image",imageTexture:l.IQ.create(e),imageTextureDim:l.IQ.create(s.ZY.create(d,p)),cornerBuffer:l.IQ.create(t),groupTexture:l.IQ.create(n),valueTexture:l.IQ.create(r),trimType:l.IQ.create(i.type),trimCenter:l.IQ.create(i.center),trimRotation:l.IQ.create(i.rotation),trimScale:l.IQ.create(i.scale),trimTransform:l.IQ.create(i.transform),isoLevel:l.IQ.create(o),get boundingSphere(){const e=w(h)
if(e!==u){const t=function(e){const t=(0,s.eB)(),n=[]
for(let o=0,a=e.length;o<a;o+=3){const r=s.eB.fromArray((0,s.eB)(),e,o)
n.push(r),s.eB.add(t,t,r)}s.eB.scale(t,t,1/(e.length/3))
let r=0
for(const o of n){const e=s.eB.distance(t,o)
e>r&&(r=e)}const i=a.f8.create(t,r)
return a.f8.setExtrema(i,n),i}(h.cornerBuffer.ref.value)
a.f8.copy(c,t),u=e}return c},setBoundingSphere(e){a.f8.copy(c,e),u=w(h)}}
return h}(e,t,n,r,i,o)}function w(e){return(0,r.TI)([e.cornerBuffer.ref.version])}function T(e){return n((0,o.xg)(0,4,Uint8Array),e?e.cornerBuffer.ref.value:new Float32Array(24),(0,o.xg)(0,4,Uint8Array),(0,o.xg)(0,1,Float32Array),t(),-1,e)}function A(e,t){return(0,i.iQ)(1,1,1,()=>y.LU)}function I(e,t,n,r,i){const{instanceCount:c,groupCount:y}=n,C=A(),w=(0,d.D1)(n,C,r.color),T=i.instanceGranularity?(0,p.Km)(c,"instance"):(0,p.Km)(c*y,"groupInstance"),I=(0,h.WG)(),P=(0,f.MD)(),B=(0,x.JS)(),E=(0,b.IB)(),k=(0,g.EN)(),D={drawCount:S.length,vertexCount:v.Wp.length/3,groupCount:y,instanceCount:c},M=a.f8.clone(e.boundingSphere),R=(0,o.Ax)(M,t.aTransform.ref.value,c,0)
return{dGeometryType:l.IQ.create("image"),...w,...T,...I,...P,...B,...E,...k,...t,...u.iy.createValues(i,D),aPosition:e.cornerBuffer,aUv:l.IQ.create(_),elements:l.IQ.create(S),aGroup:l.IQ.create((0,m.WE)(new Float32Array(4))),boundingSphere:l.IQ.create(R),invariantBoundingSphere:l.IQ.create(M),uInvariantBoundingSphere:l.IQ.create(s.Zb.ofSphere(M)),dInterpolation:l.IQ.create(i.interpolation),uImageTexDim:e.imageTextureDim,tImageTex:e.imageTexture,tGroupTex:e.groupTexture,tValueTex:e.valueTexture,uTrimType:e.trimType,uTrimCenter:e.trimCenter,uTrimRotation:e.trimRotation,uTrimScale:e.trimScale,uTrimTransform:e.trimTransform,uIsoLevel:e.isoLevel}}e.createEmptyTrim=t,e.create=n,e.createEmpty=T,e.Params={...u.iy.Params,interpolation:c.t.Select("bspline",c.t.objectToOptions(C))},e.Utils={Params:e.Params,createEmpty:T,createValues:I,createValuesSimple:function(t,n,r,i,o){const a=u.iy.createSimple(r,i,o),s={...c.t.getDefaultValues(e.Params),...n}
return I(t,a.transform,a.locationIterator,a.theme,s)},updateValues:function(e,t){u.iy.updateValues(e,t),l.IQ.updateIfChanged(e.dInterpolation,t.interpolation)},updateBoundingSphere:function(e,t){const n=a.f8.clone(t.boundingSphere),r=(0,o.Ax)(n,e.aTransform.ref.value,e.instanceCount.ref.value,0)
a.f8.equals(r,e.boundingSphere.ref.value)||l.IQ.update(e.boundingSphere,r),a.f8.equals(n,e.invariantBoundingSphere.ref.value)||(l.IQ.update(e.invariantBoundingSphere,n),l.IQ.update(e.uInvariantBoundingSphere,s.Zb.fromSphere(e.uInvariantBoundingSphere.ref.value,n)))},createRenderableState:function(e){const t=u.iy.createRenderableState(e)
return t.opaque=!1,t},updateRenderableState:function(e,t){u.iy.updateRenderableState(e,t),e.opaque=!1},createPositionIterator:A}}(w||(w={}))},71872(e,t,n){"use strict"
n.d(t,{p:()=>o})
var r=n(20610),i=n(91660)
function o(e,t){return(0,r.N)(function(n,r){var o=0
n.subscribe((0,i._)(r,function(n){return e.call(t,n,o++)&&r.next(n)}))})}},71905(e,t,n){"use strict"
n.d(t,{JS:()=>p,Ns:()=>s,Sj:()=>u,bO:()=>l,dQ:()=>c})
var r=n(80813),i=n(32775),o=n(31727),a=n(31683)
function s(e,t,n,r){for(let i=t;i<n;++i)e[i]=255*r
return!0}function l(e,t){if(0===t||e.length<t)return 0
let n=0
for(let r=0;r<t;++r)n+=e[r]
return n/(255*t)}function c(e,t,n){e.fill(0,t,n)}function u(e,t,n){const s=(0,o.xg)(Math.max(1,e),1,Uint8Array,n&&n.tEmissive.ref.value.array)
return n?(r.IQ.update(n.tEmissive,s),r.IQ.update(n.uEmissiveTexDim,i.ZY.create(s.width,s.height)),r.IQ.updateIfChanged(n.dEmissive,e>0),r.IQ.updateIfChanged(n.emissiveAverage,l(s.array,e)),r.IQ.updateIfChanged(n.dEmissiveType,t),n):{tEmissive:r.IQ.create(s),uEmissiveTexDim:r.IQ.create(i.ZY.create(s.width,s.height)),dEmissive:r.IQ.create(e>0),emissiveAverage:r.IQ.create(0),tEmissiveGrid:r.IQ.create((0,a.z6)()),uEmissiveGridDim:r.IQ.create(i.eB.create(1,1,1)),uEmissiveGridTransform:r.IQ.create(i.Zb.create(0,0,0,1)),dEmissiveType:r.IQ.create(t),uEmissiveStrength:r.IQ.create(1)}}const d={array:new Uint8Array(1),width:1,height:1}
function p(e){return e?(r.IQ.update(e.tEmissive,d),r.IQ.update(e.uEmissiveTexDim,i.ZY.create(1,1)),e):{tEmissive:r.IQ.create(d),uEmissiveTexDim:r.IQ.create(i.ZY.create(1,1)),dEmissive:r.IQ.create(!1),emissiveAverage:r.IQ.create(0),tEmissiveGrid:r.IQ.create((0,a.z6)()),uEmissiveGridDim:r.IQ.create(i.eB.create(1,1,1)),uEmissiveGridTransform:r.IQ.create(i.Zb.create(0,0,0,1)),dEmissiveType:r.IQ.create("groupInstance"),uEmissiveStrength:r.IQ.create(1)}}},72146(e,t,n){"use strict"
n.d(t,{a:()=>r})
var r,i=n(32775)
!function(e){function t(e,t,n){return{kind:"element-location",structure:e,unit:t,element:n||0}}e.create=t,e.clone=function(e){return t(e.structure,e.unit,e.element)},e.set=function(e,t,n,r){return t&&(e.structure=t),n&&(e.unit=n),void 0!==r&&(e.element=r),e},e.copy=function(e,t){return e.unit=t.unit,e.element=t.element,e},e.is=function(e){return!!e&&"element-location"===e.kind},e.areEqual=function(e,t){return e.unit===t.unit&&e.element===t.element}
const n=(0,i.eB)(),r=(0,i.eB)()
e.distance=function(e,t){return e.unit.conformation.position(e.element,n),t.unit.conformation.position(t.element,r),i.eB.distance(n,r)},e.position=function(e,t){return t.unit.conformation.position(t.element,e)},e.residueIndex=function(e){return e.unit.model.atomicHierarchy.residueAtomSegments.index[e.element]},e.chainIndex=function(e){return e.unit.model.atomicHierarchy.chainAtomSegments.index[e.element]}}(r||(r={}))},72169(e,t,n){"use strict"
function r(){if("undefined"==typeof navigator||"undefined"==typeof window)return!1
let e=!1
var t
return t=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0),e}function i(){if("undefined"==typeof navigator||"undefined"==typeof window)return!1
const e=/iPad|iPhone|iPod/.test(navigator.userAgent),t=navigator.userAgent.includes("Macintosh"),n=navigator.maxTouchPoints>=4
return!window.MSStream&&(e||t&&n)}function o(){if("undefined"==typeof navigator)return!1
if(!("xr"in navigator))return!1
const e=navigator.userAgent||""
return/OculusBrowser\//.test(e)||/PicoBrowser\//.test(e)}n.d(t,{HE:()=>i,Z5:()=>o,rr:()=>r})},72582(e,t,n){"use strict"
n.r(t),n.d(t,{clearStructureOverpaint:()=>d,setStructureOverpaint:()=>u})
var r=n(48393),i=n(33241),o=n(43472),a=n(52408),s=n(54749),l=n(89)
const c="overpaint-controls"
async function u(e,t,n,o,u){await p(e,t,async(e,t,d)=>{if(u&&u.length>0&&!u.includes(t.params.values.type.name))return
const p=t.obj.data.sourceData,f=await o(p.root)
if(l.Loci.isEmpty(f)||(0,l.isEmptyLoci)(f))return
const m={bundle:r.StructureElement.Bundle.fromLoci(f),color:-1===n?(0,s.Color)(0):n,clear:-1===n}
if(d){const t=h([...d.params.values.layers,m],p)
e.to(d).update(a.l.toBundle(t))}else{const n=h([m],p)
e.to(t.transform.ref).apply(i.f.Representation.OverpaintStructureRepresentation3DFromBundle,a.l.toBundle(n),{tags:c})}})}async function d(e,t,n){await p(e,t,async(e,t,r)=>{n&&n.length>0&&!n.includes(t.params.values.type.name)||r&&e.delete(r.transform.ref)})}async function p(e,t,n){const r=e.state.data,a=r.build()
for(const s of t)for(const e of s.representations){const t=r.select(o.QX.Generators.ofTransformer(i.f.Representation.OverpaintStructureRepresentation3DFromBundle,e.cell.transform.ref).withTag(c))
await n(a,e.cell,t[0])}return a.commit({doNotUpdateCurrent:!0})}function h(e,t){const n=a.l.ofBundle(e,t.root),r=a.l.merge(n)
return a.l.filter(r,t)}},72866(e,t,n){"use strict"
n.d(t,{j:()=>r,s:()=>i})
var r="5.5.0",i=new Date(1766404231865)},72996(e,t,n){"use strict"
n.d(t,{MH:()=>U})
var r=n(92384),i=n(16625),o=n(32751),a=n(48393),s=n(32775),l=n(89),c=n(67538),u=n(10596),d=n(88720),p=n(66044),h=n(81444),f=n(81871),m=n(61361),g=n(56294),y=n(14294),v=n(7221),b=n(91229)
const x={sizeFactor:r.t.Numeric(.3,{min:0,max:10,step:.01}),dashCount:r.t.Numeric(6,{min:1,max:10,step:1}),dashScale:r.t.Numeric(.4,{min:0,max:2,step:.1}),ignoreHydrogens:r.t.Boolean(!1),ignoreHydrogensVariant:r.t.Select("all",r.t.arrayToOptions(["all","non-polar"])),includeParent:r.t.Boolean(!1),parentDisplay:r.t.Select("stub",r.t.arrayToOptions(["stub","full","between"]),{description:'Only has an effect when "includeParent" is enabled. "Stub" shows just the child side of interactions to the parent. "Full" shows both sides of interactions to the parent. "Between" shows only interactions to the parent.'})}
var S=n(50690)
async function _(e,t,n,r,i,o){if(!a.Unit.isAtomic(t))return u.e.createEmpty(o)
const{child:l}=n,h=null==l?void 0:l.unitMap.get(t.id)
if(l&&!h)return u.e.createEmpty(o)
const f=a.StructureElement.Location.create(n,t),m=d.r.get(n).value,x=m.unitsFeatures.get(t.id),_=m.unitsContacts.get(t.id),{x:C,y:w,z:T,members:A,offsets:I,types:P}=x,{edgeCount:B,a:E,b:k,edgeProps:{flag:D,type:M}}=_,{sizeFactor:R,ignoreHydrogens:O,ignoreHydrogensVariant:L,parentDisplay:N}=i
if(!B)return u.e.createEmpty(o)
const{elements:F,conformation:z}=t,j=(0,s.eB)(),V=(0,s.eB)(),U=(0,s.eB)(),G={linkCount:2*B,position:(e,r,i)=>{const o=M[i]
if(O&&"all"===L||o!==g.X8.HydrogenBond&&(o!==g.X8.WeakHydrogenBond||"non-polar"===L))s.eB.set(e,C[E[i]],w[E[i]],T[E[i]]),s.eB.set(r,C[k[i]],w[k[i]],T[k[i]])
else{const a=A[I[E[i]]],l=A[I[k[i]]]
z.invariantPosition(F[a],V),z.invariantPosition(F[l],U)
let c=s.eB.distance(V,U),u=c
s.eB.copy(e,V),s.eB.copy(r,U)
const d=o===g.X8.HydrogenBond?g.lo.HydrogenDonor:g.lo.WeakHydrogenDonor
P[I[E[i]]]===d?(0,S.B8)(t,a,(r,i)=>{if((0,v.v3)(n,t,F[i],"all")){z.invariantPosition(F[i],j)
const t=s.eB.distance(j,U)
t<c&&(c=t,s.eB.copy(e,j))}}):(0,S.B8)(t,l,(e,i)=>{if((0,v.v3)(n,t,F[i],"all")){z.invariantPosition(F[i],j)
const e=s.eB.distance(j,V)
e<u&&(u=e,s.eB.copy(r,j))}})}},style:e=>p.gK.Dashed,radius:e=>{f.element=F[A[I[E[e]]]]
const t=r.size.size(f)
f.element=F[A[I[k[e]]]]
const n=r.size.size(f)
return Math.min(t,n)*R},ignore:e=>{if(D[e]===g.tA.Filtered)return!0
if(h)if("stub"===N){const t=E[e]
for(let e=I[t],n=I[t+1];e<n;++e){const t=F[A[I[e]]]
if(!c.X9.has(h.elements,t))return!0}}else{if("full"===N||"between"===N){let t=!1,n=!1
const r=E[e]
for(let e=I[r],o=I[r+1];e<o;++e){const n=F[A[I[e]]]
c.X9.has(h.elements,n)||(t=!0)}const i=k[e]
for(let e=I[i],o=I[i+1];e<o;++e){const t=F[A[I[e]]]
c.X9.has(h.elements,t)||(n=!0)}return"full"===N?t&&n:t===n}(0,b.dr)(N)}return!1}},{mesh:H,boundingSphere:q}=(0,p.C1)(e,G,i,o)
if(q)H.setBoundingSphere(q)
else if(H.triangleCount>0){const e=y.f8.expand((0,y.f8)(),(null!=h?h:t).boundary.sphere,1*R)
H.setBoundingSphere(e)}return H}const C={...h.Te,...p.Lr,...x}
function w(e){return(0,h.Pv)({defaultProps:r.t.getDefaultValues(C),createGeometry:_,createLocationIterator:P,getLoci:T,eachLocation:I,setUpdateState:(e,t,n,r,i,o,a)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.dashCount!==n.dashCount||t.dashScale!==n.dashScale||t.dashCap!==n.dashCap||t.radialSegments!==n.radialSegments||t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||t.parentDisplay!==n.parentDisplay
const s=d.r.get(o.structure).version
e.info.interactionsHash!==s&&(e.createGeometry=!0,e.updateTransform=!0,e.updateColor=!0,e.info.interactionsHash=s)}},e)}function T(e,t,n){const{objectId:r,instanceId:i,groupId:o}=e
if(n===r){const{structure:e,group:n}=t,r=e.unitMap.get(n.units[i].id),a=d.r.get(e).value,{a:s,b:l}=a.unitsContacts.get(r.id)
return m.OG.Loci(e,a,[{unitA:r,indexA:s[o],unitB:r,indexB:l[o]},{unitA:r,indexA:l[o],unitB:r,indexB:s[o]}])}return l.EmptyLoci}const A=new Set
function I(e,t,n,r){let i=!1
if(m.OG.isLoci(e)){const{structure:r,group:o}=t
if(!a.Structure.areEquivalent(e.data.structure,r))return!1
const s=d.r.get(r).value
if(e.data.interactions!==s)return!1
const l=o.units[0],u=s.unitsContacts.get(l.id),p=2*u.edgeCount
for(const t of e.elements){if(t.unitA!==t.unitB)continue
const e=o.unitIndexMap.get(t.unitA.id)
if(void 0!==e){const r=u.getDirectedEdgeIndex(t.indexA,t.indexB);-1!==r&&n(c.IX.ofSingleton(e*p+r))&&(i=!0)}}}else if(a.StructureElement.Loci.is(e)){const{structure:o,group:s}=t
if(!a.Structure.areEquivalent(e.structure,o))return!1
const l=d.r.get(o).value
if(!l)return!1
const u=s.units[0],p=l.unitsContacts.get(u.id),h=l.unitsFeatures.get(u.id),f=2*p.edgeCount,{offset:m}=p,{offsets:g,indices:y}=h.elementsIndex,{members:v,offsets:b}=h
for(const t of e.elements){const e=s.unitIndexMap.get(t.unit.id)
void 0!==e&&(c.CD.forEach(t.indices,e=>{for(let t=g[e],n=g[e+1];t<n;++t){const e=y[t]
for(let t=m[e],n=m[e+1];t<n;++t)A.add(t)}}),A.forEach(o=>{if(r){const e=p.a[o]
for(let r=b[e],i=b[e+1];r<i;++r)if(!c.CD.has(t.indices,v[r]))return
const n=p.b[o]
for(let r=b[n],i=b[n+1];r<i;++r)if(!c.CD.has(t.indices,v[r]))return}n(c.IX.ofSingleton(e*f+o))&&(i=!0)}),A.clear())}}return i}function P(e){const{structure:t,group:n}=e,r=n.units[0],i=d.r.get(t).value,o=i.unitsContacts.get(r.id),a=2*o.edgeCount,s=n.units.length,l=m.OG.Location(i,t),{element:c}=l
return(0,f.iQ)(a,s,1,(e,t)=>{const r=n.units[t]
return c.unitA=r,c.indexA=o.a[e],c.unitB=r,c.indexB=o.b[e],l})}var B=n(62837),E=n(44688)
function k(e,t,n,r,i){if(!t.hasAtomic)return u.e.createEmpty(i)
const o=a.StructureElement.Location.create(t),l=d.r.get(t).value,{contacts:h,unitsFeatures:f}=l,{edgeCount:m,edges:x}=h,{sizeFactor:_,ignoreHydrogens:C,ignoreHydrogensVariant:w,parentDisplay:T}=r
if(!m)return u.e.createEmpty(i)
const{child:A}=t,I=(0,s.eB)(),P=(0,s.eB)(),B=(0,s.eB)(),E={linkCount:m,position:(e,n,r)=>{const{unitA:i,indexA:o,unitB:a,indexB:l,props:{type:c}}=x[r],u=f.get(i),d=f.get(a),p=t.unitMap.get(i),h=t.unitMap.get(a)
if(C&&"all"===w||c!==g.X8.HydrogenBond&&(c!==g.X8.WeakHydrogenBond||"non-polar"===w))s.eB.set(e,u.x[o],u.y[o],u.z[o]),s.eB.transformMat4(e,e,p.conformation.operator.matrix),s.eB.set(n,d.x[l],d.y[l],d.z[l]),s.eB.transformMat4(n,n,h.conformation.operator.matrix)
else{const r=u.members[u.offsets[o]],i=d.members[d.offsets[l]]
p.conformation.position(p.elements[r],P),h.conformation.position(h.elements[i],B)
let a=s.eB.distance(P,B),f=a
s.eB.copy(e,P),s.eB.copy(n,B)
const m=c===g.X8.HydrogenBond?g.lo.HydrogenDonor:g.lo.WeakHydrogenDonor
u.types[u.offsets[o]]===m?(0,S.LH)(t,p,r,(n,r)=>{const i=n.elements[r]
if((0,v.v3)(t,n,i,"all")){n.conformation.position(i,I)
const t=s.eB.distance(I,B)
t<a&&(a=t,s.eB.copy(e,I))}}):(0,S.LH)(t,h,i,(e,r)=>{const i=e.elements[r]
if((0,v.v3)(t,e,i,"all")){e.conformation.position(i,I)
const t=s.eB.distance(I,P)
t<f&&(f=t,s.eB.copy(n,I))}})}},style:e=>p.gK.Dashed,radius:e=>{const r=x[e],i=f.get(r.unitA)
o.unit=t.unitMap.get(r.unitA),o.element=o.unit.elements[i.members[i.offsets[r.indexA]]]
const a=n.size.size(o),s=f.get(r.unitB)
o.unit=t.unitMap.get(r.unitB),o.element=o.unit.elements[s.members[s.offsets[r.indexB]]]
const l=n.size.size(o)
return Math.min(a,l)*_},ignore:e=>{if(x[e].props.flag===g.tA.Filtered)return!0
if(A){const n=x[e]
if("stub"===T){const e=A.unitMap.get(n.unitA)
if(!e)return!0
const r=t.unitMap.get(n.unitA),{offsets:i,members:o}=f.get(n.unitA)
for(let t=i[n.indexA],a=i[n.indexA+1];t<a;++t){const n=r.elements[o[t]]
if(!c.X9.has(e.elements,n))return!0}}else{if("full"===T||"between"===T){let e=!1,r=!1
const i=A.unitMap.get(n.unitA)
if(i){const r=t.unitMap.get(n.unitA),{offsets:o,members:a}=f.get(n.unitA)
for(let t=o[n.indexA],s=o[n.indexA+1];t<s;++t){const n=r.elements[a[t]]
c.X9.has(i.elements,n)||(e=!0)}}else e=!0
const o=A.unitMap.get(n.unitB)
if(o){const e=t.unitMap.get(n.unitB),{offsets:i,members:a}=f.get(n.unitB)
for(let t=i[n.indexB],s=i[n.indexB+1];t<s;++t){const n=e.elements[a[t]]
c.X9.has(o.elements,n)||(r=!0)}}else r=!0
return"full"===T?e&&r:e===r}(0,b.dr)(T)}}return!1}},{mesh:k,boundingSphere:D}=(0,p.C1)(e,E,r,i)
if(D)k.setBoundingSphere(D)
else if(k.triangleCount>0){const{child:e}=t,n=y.f8.expand((0,y.f8)(),(null!=e?e:t).boundary.sphere,1*_)
k.setBoundingSphere(n)}return k}const D={...B.EN,...p.Lr,...x}
function M(e){return(0,B.wA)({defaultProps:r.t.getDefaultValues(D),createGeometry:k,createLocationIterator:F,getLoci:R,eachLocation:N,setUpdateState:(e,t,n,r,i,o,a)=>{e.createGeometry=t.sizeFactor!==n.sizeFactor||t.dashCount!==n.dashCount||t.dashScale!==n.dashScale||t.dashCap!==n.dashCap||t.radialSegments!==n.radialSegments||t.ignoreHydrogens!==n.ignoreHydrogens||t.ignoreHydrogensVariant!==n.ignoreHydrogensVariant||t.parentDisplay!==n.parentDisplay
const s=d.r.get(o).version
e.info.interactionsHash!==s&&(e.createGeometry=!0,e.updateTransform=!0,e.updateColor=!0,e.info.interactionsHash=s)}},e)}function R(e,t,n){const{objectId:r,groupId:i}=e
if(n===r){const e=d.r.get(t).value,n=e.contacts.edges[i],r=t.unitMap.get(n.unitA),o=t.unitMap.get(n.unitB)
return m.OG.Loci(t,e,[{unitA:r,indexA:n.indexA,unitB:o,indexB:n.indexB},{unitA:o,indexA:n.indexB,unitB:r,indexB:n.indexA}])}return l.EmptyLoci}const O=new Map,L=new Set
function N(e,t,n,r){let i=!1
if(m.OG.isLoci(e)){if(!a.Structure.areEquivalent(e.data.structure,t))return!1
const r=d.r.get(t).value
if(e.data.interactions!==r)return!1
const{contacts:o}=r
for(const t of e.elements){const e=o.getEdgeIndex(t.indexA,t.unitA.id,t.indexB,t.unitB.id);-1!==e&&n(c.IX.ofSingleton(e))&&(i=!0)}}else if(a.StructureElement.Loci.is(e)){if(!a.Structure.areEquivalent(e.structure,t))return!1
if(r&&1===e.elements.length)return!1
const o=d.r.get(t).value
if(!o)return!1
const{contacts:s,unitsFeatures:l}=o
for(const t of e.elements)O.set(t.unit.id,t.indices)
for(const t of e.elements){const{unit:e}=t
E.Nf.isAtomic(e)&&c.CD.forEach(t.indices,t=>{for(const n of s.getContactIndicesForElement(t,e))L.add(n)})}L.forEach(e=>{if(r){const{indexA:t,unitA:n,indexB:r,unitB:i}=s.edges[e],o=O.get(n),a=O.get(i)
if(!o||!a)return
const{offsets:u,members:d}=l.get(n)
for(let e=u[t],s=u[t+1];e<s;++e)if(!c.CD.has(o,d[e]))return
const{offsets:p,members:h}=l.get(i)
for(let e=p[r],s=p[r+1];e<s;++e)if(!c.CD.has(a,h[e]))return}n(c.IX.ofSingleton(e))&&(i=!0)}),O.clear(),L.clear()}return i}function F(e){const t=d.r.get(e).value,{contacts:n}=t,r=n.edgeCount,i=m.OG.Location(t,e),{element:o}=i
return(0,f.iQ)(r,1,1,t=>{const r=n.edges[t]
return o.unitA=e.unitMap.get(r.unitA),o.indexA=r.indexA,o.unitB=e.unitMap.get(r.unitB),o.indexB=r.indexB,i},!0)}var z=n(31312)
const j={"intra-unit":(e,t)=>(0,o.TP)("Intra-unit interactions cylinder",e,t,w),"inter-unit":(e,t)=>(0,o.Kp)("Inter-unit interactions cylinder",e,t,M)},V={...C,...D,unitKinds:(0,z.R8)(["atomic"]),sizeFactor:r.t.Numeric(.2,{min:.01,max:1,step:.01}),visuals:r.t.MultiSelect(["intra-unit","inter-unit"],r.t.objectToOptions(j))},U=(0,o.GT)({name:"interactions",label:"Non-covalent Interactions",description:"Displays non-covalent interactions as dashed cylinders.",factory:function(e,t){return i.YL.createMulti("Interactions",e,t,o.J1,j)},getParams:function(e,t){return r.t.clone(V)},defaultValues:r.t.getDefaultValues(V),defaultColorTheme:{name:"interaction-type"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.elementCount>0&&d.r.isApplicable(e),ensureCustomProperties:{attach:(e,t)=>d.r.attach(e,t,void 0,!0),detach:e=>d.r.ref(e,!1)},getData:(e,t)=>t.includeParent?e.asParent():e,mustRecreate:(e,t)=>e.includeParent!==t.includeParent})},75386(e,t,n){"use strict"
n.d(t,{g:()=>c})
const r={HIS:"H",ARG:"R",LYS:"K",ILE:"I",PHE:"F",LEU:"L",TRP:"W",ALA:"A",MET:"M",PRO:"P",CYS:"C",ASN:"N",VAL:"V",GLY:"G",SER:"S",GLN:"Q",TYR:"Y",ASP:"D",GLU:"E",THR:"T",SEC:"U",PYL:"O",HSD:"H",HSE:"H",HSP:"H",LSN:"K",ASPP:"D",GLUP:"E",HID:"H",HIE:"H",HIP:"H",LYN:"K",ASH:"D",GLH:"E"},i={DA:"A",DC:"C",DG:"G",DT:"T",DU:"U"},o={A:"A",C:"C",G:"G",T:"T",U:"U"}
function a(e){return r[e]||"X"}function s(e){return o[e]||"X"}function l(e){return i[e]||"X"}var c,u=n(24762),d=n(91229)
!function(e){let t
!function(e){e.Protein="protein",e.RNA="RNA",e.DNA="DNA",e.Generic="generic"}(t=e.Kind||(e.Kind={})),e.getSequenceString=function(e){const t=e.code.toArray()
return(t instanceof Array?t:Array.from(t)).join("")},e.ofResidueNames=function(e,r){if(0===r.rowCount)throw new Error("cannot be empty")
const i=function(e){for(let n=0,r=Math.min(e.rowCount,10);n<r;n++){const r=e.value(n)||""
if("X"!==a(r))return t.Protein
if("X"!==s(r))return t.RNA
if("X"!==l(r))return t.DNA}return t.Generic}(e)
return new n(i,e,r)}
class n{index(e){return this.indexMap.get(e)}constructor(e,n,r){this.kind=e,this.microHet=new Map
const i=function(e){let n
switch(e){case t.Protein:n=a
break
case t.DNA:n=l
break
case t.RNA:n=s
break
case t.Generic:n=()=>"X"
break
default:(0,d.dr)(e)}return n}(e),o=[],c=[],p=[],h=new Map
let f=0
const m=new Map
for(let t=0,a=r.rowCount;t<a;++t){const e=r.value(t)
if(m.has(e))h.has(e)?h.get(e).push(n.value(t)):h.set(e,[c[m.get(e)],n.value(t)])
else{m.set(e,f)
const r=n.value(t)
c[f]=r,p[f]=e,o[f]=i(r),f+=1}}const g=[]
for(let t=0,a=f;t<a;++t){const e=h.get(p[t])
if(e){const n=e.map(e=>{const t=i(e)
return"X"===t?e:t})
g[t]=`(${n.join("|")})`}else g[t]="X"===o[t]?c[t]:o[t]}this.length=f,this.code=u.VP.ofStringArray(o),this.compId=u.VP.ofStringArray(c),this.seqId=u.VP.ofIntArray(p),this.label=u.VP.ofStringArray(g),this.microHet=h,this.indexMap=m}}e.ofSequenceRanges=function(e,n){const i=t.Generic
return new r(i,e,n)}
class r{index(e){return e-this.minSeqId}constructor(e,t,n){this.kind=e,this.seqIdStart=t,this.seqIdEnd=n,this.microHet=new Map
let r=0,i=Number.MAX_SAFE_INTEGER
for(let a=0,s=this.seqIdStart.rowCount;a<s;a++){const e=this.seqIdStart.value(a),t=this.seqIdEnd.value(a)
e<i&&(i=e),r<t&&(r=t)}const o=r-i+1
this.code=u.VP.ofConst("X",o,u.VP.Schema.str),this.label=u.VP.ofConst("",o,u.VP.Schema.str),this.seqId=u.VP.ofLambda({value:e=>e+i+1,rowCount:o,schema:u.VP.Schema.int}),this.compId=u.VP.ofConst("",o,u.VP.Schema.str),this.length=o,this.minSeqId=i}}}(c||(c={}))},76193(e,t,n){"use strict"
var r=n(87912),i=n(25602),o=n(3203)
function a(e){var t="https://react.dev/errors/"+e
if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1])
for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(e){var t=e,n=e
if(e.alternate)for(;t.return;)t=t.return
else{e=t
do{!!(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function l(e){if(13===e.tag){var t=e.memoizedState
if(null===t&&null!==(e=e.alternate)&&(t=e.memoizedState),null!==t)return t.dehydrated}return null}function c(e){if(31===e.tag){var t=e.memoizedState
if(null===t&&null!==(e=e.alternate)&&(t=e.memoizedState),null!==t)return t.dehydrated}return null}function u(e){if(s(e)!==e)throw Error(a(188))}function d(e){var t=e.tag
if(5===t||26===t||27===t||6===t)return e
for(e=e.child;null!==e;){if(null!==(t=d(e)))return t
e=e.sibling}return null}var p=Object.assign,h=Symbol.for("react.element"),f=Symbol.for("react.transitional.element"),m=Symbol.for("react.portal"),g=Symbol.for("react.fragment"),y=Symbol.for("react.strict_mode"),v=Symbol.for("react.profiler"),b=Symbol.for("react.consumer"),x=Symbol.for("react.context"),S=Symbol.for("react.forward_ref"),_=Symbol.for("react.suspense"),C=Symbol.for("react.suspense_list"),w=Symbol.for("react.memo"),T=Symbol.for("react.lazy")
Symbol.for("react.scope")
var A=Symbol.for("react.activity")
Symbol.for("react.legacy_hidden"),Symbol.for("react.tracing_marker")
var I=Symbol.for("react.memo_cache_sentinel")
Symbol.for("react.view_transition")
var P=Symbol.iterator
function B(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=P&&e[P]||e["@@iterator"])?e:null}var E=Symbol.for("react.client.reference")
function k(e){if(null==e)return null
if("function"==typeof e)return e.$$typeof===E?null:e.displayName||e.name||null
if("string"==typeof e)return e
switch(e){case g:return"Fragment"
case v:return"Profiler"
case y:return"StrictMode"
case _:return"Suspense"
case C:return"SuspenseList"
case A:return"Activity"}if("object"==typeof e)switch(e.$$typeof){case m:return"Portal"
case x:return e.displayName||"Context"
case b:return(e._context.displayName||"Context")+".Consumer"
case S:var t=e.render
return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e
case w:return null!==(t=e.displayName||null)?t:k(e.type)||"Memo"
case T:t=e._payload,e=e._init
try{return k(e(t))}catch(e){}}return null}var D=Array.isArray,M=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,R=o.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,O={pending:!1,data:null,method:null,action:null},L=[],N=-1
function F(e){return{current:e}}function z(e){0>N||(e.current=L[N],L[N]=null,N--)}function j(e,t){N++,L[N]=e.current,e.current=t}var V,U,G=F(null),H=F(null),q=F(null),Q=F(null)
function $(e,t){switch(j(q,t),j(H,e),j(G,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?gd(e):0
break
default:if(e=t.tagName,t=t.namespaceURI)e=yd(t=gd(t),e)
else switch(e){case"svg":e=1
break
case"math":e=2
break
default:e=0}}z(G),j(G,e)}function X(){z(G),z(H),z(q)}function W(e){null!==e.memoizedState&&j(Q,e)
var t=G.current,n=yd(t,e.type)
t!==n&&(j(H,e),j(G,n))}function Y(e){H.current===e&&(z(G),z(H)),Q.current===e&&(z(Q),cp._currentValue=O)}function Z(e){if(void 0===V)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/)
V=t&&t[1]||"",U=-1<e.stack.indexOf("\n    at")?" (<anonymous>)":-1<e.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+V+e+U}var K=!1
function J(e,t){if(!e||K)return""
K=!0
var n=Error.prepareStackTrace
Error.prepareStackTrace=void 0
try{var r={DetermineComponentFrameRoot:function(){try{if(t){var n=function(){throw Error()}
if(Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(n,[])}catch(e){var r=e}Reflect.construct(e,[],n)}else{try{n.call()}catch(e){r=e}e.call(n.prototype)}}else{try{throw Error()}catch(e){r=e}(n=e())&&"function"==typeof n.catch&&n.catch(function(){})}}catch(e){if(e&&r&&"string"==typeof e.stack)return[e.stack,r.stack]}return[null,null]}}
r.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot"
var i=Object.getOwnPropertyDescriptor(r.DetermineComponentFrameRoot,"name")
i&&i.configurable&&Object.defineProperty(r.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"})
var o=r.DetermineComponentFrameRoot(),a=o[0],s=o[1]
if(a&&s){var l=a.split("\n"),c=s.split("\n")
for(i=r=0;r<l.length&&!l[r].includes("DetermineComponentFrameRoot");)r++
for(;i<c.length&&!c[i].includes("DetermineComponentFrameRoot");)i++
if(r===l.length||i===c.length)for(r=l.length-1,i=c.length-1;1<=r&&0<=i&&l[r]!==c[i];)i--
for(;1<=r&&0<=i;r--,i--)if(l[r]!==c[i]){if(1!==r||1!==i)do{if(r--,0>--i||l[r]!==c[i]){var u="\n"+l[r].replace(" at new "," at ")
return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=r&&0<=i)
break}}}finally{K=!1,Error.prepareStackTrace=n}return(n=e?e.displayName||e.name:"")?Z(n):""}function ee(e,t){switch(e.tag){case 26:case 27:case 5:return Z(e.type)
case 16:return Z("Lazy")
case 13:return e.child!==t&&null!==t?Z("Suspense Fallback"):Z("Suspense")
case 19:return Z("SuspenseList")
case 0:case 15:return J(e.type,!1)
case 11:return J(e.type.render,!1)
case 1:return J(e.type,!0)
case 31:return Z("Activity")
default:return""}}function te(e){try{var t="",n=null
do{t+=ee(e,n),n=e,e=e.return}while(e)
return t}catch(e){return"\nError generating stack: "+e.message+"\n"+e.stack}}var ne=Object.prototype.hasOwnProperty,re=r.unstable_scheduleCallback,ie=r.unstable_cancelCallback,oe=r.unstable_shouldYield,ae=r.unstable_requestPaint,se=r.unstable_now,le=r.unstable_getCurrentPriorityLevel,ce=r.unstable_ImmediatePriority,ue=r.unstable_UserBlockingPriority,de=r.unstable_NormalPriority,pe=r.unstable_LowPriority,he=r.unstable_IdlePriority,fe=r.log,me=r.unstable_setDisableYieldValue,ge=null,ye=null
function ve(e){if("function"==typeof fe&&me(e),ye&&"function"==typeof ye.setStrictMode)try{ye.setStrictMode(ge,e)}catch(e){}}var be=Math.clz32?Math.clz32:function(e){return 0==(e>>>=0)?32:31-(xe(e)/Se|0)|0},xe=Math.log,Se=Math.LN2,_e=256,Ce=262144,we=4194304
function Te(e){var t=42&e
if(0!==t)return t
switch(e&-e){case 1:return 1
case 2:return 2
case 4:return 4
case 8:return 8
case 16:return 16
case 32:return 32
case 64:return 64
case 128:return 128
case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return 261888&e
case 262144:case 524288:case 1048576:case 2097152:return 3932160&e
case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&e
case 67108864:return 67108864
case 134217728:return 134217728
case 268435456:return 268435456
case 536870912:return 536870912
case 1073741824:return 0
default:return e}}function Ae(e,t,n){var r=e.pendingLanes
if(0===r)return 0
var i=0,o=e.suspendedLanes,a=e.pingedLanes
e=e.warmLanes
var s=134217727&r
return 0!==s?0!==(r=s&~o)?i=Te(r):0!==(a&=s)?i=Te(a):n||0!==(n=s&~e)&&(i=Te(n)):0!==(s=r&~o)?i=Te(s):0!==a?i=Te(a):n||0!==(n=r&~e)&&(i=Te(n)),0===i?0:0!==t&&t!==i&&0===(t&o)&&((o=i&-i)>=(n=t&-t)||32===o&&4194048&n)?t:i}function Ie(e,t){return 0===(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)}function Pe(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250
case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3
default:return-1}}function Be(){var e=we
return!(62914560&(we<<=1))&&(we=4194304),e}function Ee(e){for(var t=[],n=0;31>n;n++)t.push(e)
return t}function ke(e,t){e.pendingLanes|=t,268435456!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function De(e,t,n){e.pendingLanes|=t,e.suspendedLanes&=~t
var r=31-be(t)
e.entangledLanes|=t,e.entanglements[r]=1073741824|e.entanglements[r]|261930&n}function Me(e,t){var n=e.entangledLanes|=t
for(e=e.entanglements;n;){var r=31-be(n),i=1<<r
i&t|e[r]&t&&(e[r]|=t),n&=~i}}function Re(e,t){var n=t&-t
return 0!==((n=42&n?1:Oe(n))&(e.suspendedLanes|t))?0:n}function Oe(e){switch(e){case 2:e=1
break
case 8:e=4
break
case 32:e=16
break
case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128
break
case 268435456:e=134217728
break
default:e=0}return e}function Le(e){return 2<(e&=-e)?8<e?134217727&e?32:268435456:8:2}function Ne(){var e=R.p
return 0!==e?e:void 0===(e=window.event)?32:Cp(e.type)}function Fe(e,t){var n=R.p
try{return R.p=e,t()}finally{R.p=n}}var ze=Math.random().toString(36).slice(2),je="__reactFiber$"+ze,Ve="__reactProps$"+ze,Ue="__reactContainer$"+ze,Ge="__reactEvents$"+ze,He="__reactListeners$"+ze,qe="__reactHandles$"+ze,Qe="__reactResources$"+ze,$e="__reactMarker$"+ze
function Xe(e){delete e[je],delete e[Ve],delete e[Ge],delete e[He],delete e[qe]}function We(e){var t=e[je]
if(t)return t
for(var n=e.parentNode;n;){if(t=n[Ue]||n[je]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=Od(e);null!==e;){if(n=e[je])return n
e=Od(e)}return t}n=(e=n).parentNode}return null}function Ye(e){if(e=e[je]||e[Ue]){var t=e.tag
if(5===t||6===t||13===t||31===t||26===t||27===t||3===t)return e}return null}function Ze(e){var t=e.tag
if(5===t||26===t||27===t||6===t)return e.stateNode
throw Error(a(33))}function Ke(e){var t=e[Qe]
return t||(t=e[Qe]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function Je(e){e[$e]=!0}var et=new Set,tt={}
function nt(e,t){rt(e,t),rt(e+"Capture",t)}function rt(e,t){for(tt[e]=t,e=0;e<t.length;e++)et.add(t[e])}var it=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),ot={},at={}
function st(e,t,n){if(i=t,ne.call(at,i)||!ne.call(ot,i)&&(it.test(i)?at[i]=!0:(ot[i]=!0,0)))if(null===n)e.removeAttribute(t)
else{switch(typeof n){case"undefined":case"function":case"symbol":return void e.removeAttribute(t)
case"boolean":var r=t.toLowerCase().slice(0,5)
if("data-"!==r&&"aria-"!==r)return void e.removeAttribute(t)}e.setAttribute(t,""+n)}var i}function lt(e,t,n){if(null===n)e.removeAttribute(t)
else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(t)}e.setAttribute(t,""+n)}}function ct(e,t,n,r){if(null===r)e.removeAttribute(n)
else{switch(typeof r){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(n)}e.setAttributeNS(t,n,""+r)}}function ut(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return e
default:return""}}function dt(e){var t=e.type
return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function pt(e){if(!e._valueTracker){var t=dt(e)?"checked":"value"
e._valueTracker=function(e,t,n){var r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t)
if(!e.hasOwnProperty(t)&&void 0!==r&&"function"==typeof r.get&&"function"==typeof r.set){var i=r.get,o=r.set
return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){n=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(e){n=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e,t,""+e[t])}}function ht(e){if(!e)return!1
var t=e._valueTracker
if(!t)return!0
var n=t.getValue(),r=""
return e&&(r=dt(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function ft(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null
try{return e.activeElement||e.body}catch(t){return e.body}}var mt=/[\n"\\]/g
function gt(e){return e.replace(mt,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function yt(e,t,n,r,i,o,a,s){e.name="",null!=a&&"function"!=typeof a&&"symbol"!=typeof a&&"boolean"!=typeof a?e.type=a:e.removeAttribute("type"),null!=t?"number"===a?(0===t&&""===e.value||e.value!=t)&&(e.value=""+ut(t)):e.value!==""+ut(t)&&(e.value=""+ut(t)):"submit"!==a&&"reset"!==a||e.removeAttribute("value"),null!=t?bt(e,a,ut(t)):null!=n?bt(e,a,ut(n)):null!=r&&e.removeAttribute("value"),null==i&&null!=o&&(e.defaultChecked=!!o),null!=i&&(e.checked=i&&"function"!=typeof i&&"symbol"!=typeof i),null!=s&&"function"!=typeof s&&"symbol"!=typeof s&&"boolean"!=typeof s?e.name=""+ut(s):e.removeAttribute("name")}function vt(e,t,n,r,i,o,a,s){if(null!=o&&"function"!=typeof o&&"symbol"!=typeof o&&"boolean"!=typeof o&&(e.type=o),null!=t||null!=n){if(("submit"===o||"reset"===o)&&null==t)return void pt(e)
n=null!=n?""+ut(n):"",t=null!=t?""+ut(t):n,s||t===e.value||(e.value=t),e.defaultValue=t}r="function"!=typeof(r=null!=r?r:i)&&"symbol"!=typeof r&&!!r,e.checked=s?e.checked:!!r,e.defaultChecked=!!r,null!=a&&"function"!=typeof a&&"symbol"!=typeof a&&"boolean"!=typeof a&&(e.name=a),pt(e)}function bt(e,t,n){"number"===t&&ft(e.ownerDocument)===e||e.defaultValue===""+n||(e.defaultValue=""+n)}function xt(e,t,n,r){if(e=e.options,t){t={}
for(var i=0;i<n.length;i++)t["$"+n[i]]=!0
for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+ut(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0))
null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function St(e,t,n){null==t||((t=""+ut(t))!==e.value&&(e.value=t),null!=n)?e.defaultValue=null!=n?""+ut(n):"":e.defaultValue!==t&&(e.defaultValue=t)}function _t(e,t,n,r){if(null==t){if(null!=r){if(null!=n)throw Error(a(92))
if(D(r)){if(1<r.length)throw Error(a(93))
r=r[0]}n=r}null==n&&(n=""),t=n}n=ut(t),e.defaultValue=n,(r=e.textContent)===n&&""!==r&&null!==r&&(e.value=r),pt(e)}function Ct(e,t){if(t){var n=e.firstChild
if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var wt=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "))
function Tt(e,t,n){var r=0===t.indexOf("--")
null==n||"boolean"==typeof n||""===n?r?e.setProperty(t,""):"float"===t?e.cssFloat="":e[t]="":r?e.setProperty(t,n):"number"!=typeof n||0===n||wt.has(t)?"float"===t?e.cssFloat=n:e[t]=(""+n).trim():e[t]=n+"px"}function At(e,t,n){if(null!=t&&"object"!=typeof t)throw Error(a(62))
if(e=e.style,null!=n){for(var r in n)!n.hasOwnProperty(r)||null!=t&&t.hasOwnProperty(r)||(0===r.indexOf("--")?e.setProperty(r,""):"float"===r?e.cssFloat="":e[r]="")
for(var i in t)r=t[i],t.hasOwnProperty(i)&&n[i]!==r&&Tt(e,i,r)}else for(var o in t)t.hasOwnProperty(o)&&Tt(e,o,t[o])}function It(e){if(-1===e.indexOf("-"))return!1
switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1
default:return!0}}var Pt=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Bt=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i
function Et(e){return Bt.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function kt(){}var Dt=null
function Mt(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Rt=null,Ot=null
function Lt(e){var t=Ye(e)
if(t&&(e=t.stateNode)){var n=e[Ve]||null
e:switch(e=t.stateNode,t.type){case"input":if(yt(e,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode
for(n=n.querySelectorAll('input[name="'+gt(""+t)+'"][type="radio"]'),t=0;t<n.length;t++){var r=n[t]
if(r!==e&&r.form===e.form){var i=r[Ve]||null
if(!i)throw Error(a(90))
yt(r,i.value,i.defaultValue,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name)}}for(t=0;t<n.length;t++)(r=n[t]).form===e.form&&ht(r)}break e
case"textarea":St(e,n.value,n.defaultValue)
break e
case"select":null!=(t=n.value)&&xt(e,!!n.multiple,t,!1)}}}var Nt=!1
function Ft(e,t,n){if(Nt)return e(t,n)
Nt=!0
try{return e(t)}finally{if(Nt=!1,(null!==Rt||null!==Ot)&&(Kc(),Rt&&(t=Rt,e=Ot,Ot=Rt=null,Lt(t),e)))for(t=0;t<e.length;t++)Lt(e[t])}}function zt(e,t){var n=e.stateNode
if(null===n)return null
var r=n[Ve]||null
if(null===r)return null
n=r[t]
e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r
break e
default:e=!1}if(e)return null
if(n&&"function"!=typeof n)throw Error(a(231,t,typeof n))
return n}var jt=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),Vt=!1
if(jt)try{var Ut={}
Object.defineProperty(Ut,"passive",{get:function(){Vt=!0}}),window.addEventListener("test",Ut,Ut),window.removeEventListener("test",Ut,Ut)}catch(e){Vt=!1}var Gt=null,Ht=null,qt=null
function Qt(){if(qt)return qt
var e,t,n=Ht,r=n.length,i="value"in Gt?Gt.value:Gt.textContent,o=i.length
for(e=0;e<r&&n[e]===i[e];e++);var a=r-e
for(t=1;t<=a&&n[r-t]===i[o-t];t++);return qt=i.slice(e,1<t?1-t:void 0)}function $t(e){var t=e.keyCode
return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function Xt(){return!0}function Wt(){return!1}function Yt(e){function t(t,n,r,i,o){for(var a in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(i):i[a])
return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?Xt:Wt,this.isPropagationStopped=Wt,this}return p(t.prototype,{preventDefault:function(){this.defaultPrevented=!0
var e=this.nativeEvent
e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=Xt)},stopPropagation:function(){var e=this.nativeEvent
e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=Xt)},persist:function(){},isPersistent:Xt}),t}var Zt,Kt,Jt,en={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},tn=Yt(en),nn=p({},en,{view:0,detail:0}),rn=Yt(nn),on=p({},nn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:gn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Jt&&(Jt&&"mousemove"===e.type?(Zt=e.screenX-Jt.screenX,Kt=e.screenY-Jt.screenY):Kt=Zt=0,Jt=e),Zt)},movementY:function(e){return"movementY"in e?e.movementY:Kt}}),an=Yt(on),sn=Yt(p({},on,{dataTransfer:0})),ln=Yt(p({},nn,{relatedTarget:0})),cn=Yt(p({},en,{animationName:0,elapsedTime:0,pseudoElement:0})),un=Yt(p({},en,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),dn=Yt(p({},en,{data:0})),pn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},hn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},fn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"}
function mn(e){var t=this.nativeEvent
return t.getModifierState?t.getModifierState(e):!!(e=fn[e])&&!!t[e]}function gn(){return mn}var yn=Yt(p({},nn,{key:function(e){if(e.key){var t=pn[e.key]||e.key
if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=$t(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?hn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:gn,charCode:function(e){return"keypress"===e.type?$t(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?$t(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),vn=Yt(p({},on,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),bn=Yt(p({},nn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:gn})),xn=Yt(p({},en,{propertyName:0,elapsedTime:0,pseudoElement:0})),Sn=Yt(p({},on,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),_n=Yt(p({},en,{newState:0,oldState:0})),Cn=[9,13,27,32],wn=jt&&"CompositionEvent"in window,Tn=null
jt&&"documentMode"in document&&(Tn=document.documentMode)
var An=jt&&"TextEvent"in window&&!Tn,In=jt&&(!wn||Tn&&8<Tn&&11>=Tn),Pn=String.fromCharCode(32),Bn=!1
function En(e,t){switch(e){case"keyup":return-1!==Cn.indexOf(t.keyCode)
case"keydown":return 229!==t.keyCode
case"keypress":case"mousedown":case"focusout":return!0
default:return!1}}function kn(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Dn=!1,Mn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0}
function Rn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase()
return"input"===t?!!Mn[e.type]:"textarea"===t}function On(e,t,n,r){Rt?Ot?Ot.push(r):Ot=[r]:Rt=r,0<(t=nd(t,"onChange")).length&&(n=new tn("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Ln=null,Nn=null
function Fn(e){Xu(e,0)}function zn(e){if(ht(Ze(e)))return e}function jn(e,t){if("change"===e)return t}var Vn=!1
if(jt){var Un
if(jt){var Gn="oninput"in document
if(!Gn){var Hn=document.createElement("div")
Hn.setAttribute("oninput","return;"),Gn="function"==typeof Hn.oninput}Un=Gn}else Un=!1
Vn=Un&&(!document.documentMode||9<document.documentMode)}function qn(){Ln&&(Ln.detachEvent("onpropertychange",Qn),Nn=Ln=null)}function Qn(e){if("value"===e.propertyName&&zn(Nn)){var t=[]
On(t,Nn,e,Mt(e)),Ft(Fn,t)}}function $n(e,t,n){"focusin"===e?(qn(),Nn=n,(Ln=t).attachEvent("onpropertychange",Qn)):"focusout"===e&&qn()}function Xn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return zn(Nn)}function Wn(e,t){if("click"===e)return zn(t)}function Yn(e,t){if("input"===e||"change"===e)return zn(t)}var Zn="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t}
function Kn(e,t){if(Zn(e,t))return!0
if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1
var n=Object.keys(e),r=Object.keys(t)
if(n.length!==r.length)return!1
for(r=0;r<n.length;r++){var i=n[r]
if(!ne.call(t,i)||!Zn(e[i],t[i]))return!1}return!0}function Jn(e){for(;e&&e.firstChild;)e=e.firstChild
return e}function er(e,t){var n,r=Jn(e)
for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e}
e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling
break e}r=r.parentNode}r=void 0}r=Jn(r)}}function tr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?tr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function nr(e){for(var t=ft((e=null!=e&&null!=e.ownerDocument&&null!=e.ownerDocument.defaultView?e.ownerDocument.defaultView:window).document);t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(e){n=!1}if(!n)break
t=ft((e=t.contentWindow).document)}return t}function rr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase()
return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var ir=jt&&"documentMode"in document&&11>=document.documentMode,or=null,ar=null,sr=null,lr=!1
function cr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument
lr||null==or||or!==ft(r)||(r="selectionStart"in(r=or)&&rr(r)?{start:r.selectionStart,end:r.selectionEnd}:{anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},sr&&Kn(sr,r)||(sr=r,0<(r=nd(ar,"onSelect")).length&&(t=new tn("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=or)))}function ur(e,t){var n={}
return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var dr={animationend:ur("Animation","AnimationEnd"),animationiteration:ur("Animation","AnimationIteration"),animationstart:ur("Animation","AnimationStart"),transitionrun:ur("Transition","TransitionRun"),transitionstart:ur("Transition","TransitionStart"),transitioncancel:ur("Transition","TransitionCancel"),transitionend:ur("Transition","TransitionEnd")},pr={},hr={}
function fr(e){if(pr[e])return pr[e]
if(!dr[e])return e
var t,n=dr[e]
for(t in n)if(n.hasOwnProperty(t)&&t in hr)return pr[e]=n[t]
return e}jt&&(hr=document.createElement("div").style,"AnimationEvent"in window||(delete dr.animationend.animation,delete dr.animationiteration.animation,delete dr.animationstart.animation),"TransitionEvent"in window||delete dr.transitionend.transition)
var mr=fr("animationend"),gr=fr("animationiteration"),yr=fr("animationstart"),vr=fr("transitionrun"),br=fr("transitionstart"),xr=fr("transitioncancel"),Sr=fr("transitionend"),_r=new Map,Cr="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ")
function wr(e,t){_r.set(e,t),nt(t,[e])}Cr.push("scrollEnd")
var Tr="function"==typeof reportError?reportError:function(e){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof e&&null!==e&&"string"==typeof e.message?String(e.message):String(e),error:e})
if(!window.dispatchEvent(t))return}else if("object"==typeof process&&"function"==typeof process.emit)return void process.emit("uncaughtException",e)
console.error(e)},Ar=[],Ir=0,Pr=0
function Br(){for(var e=Ir,t=Pr=Ir=0;t<e;){var n=Ar[t]
Ar[t++]=null
var r=Ar[t]
Ar[t++]=null
var i=Ar[t]
Ar[t++]=null
var o=Ar[t]
if(Ar[t++]=null,null!==r&&null!==i){var a=r.pending
null===a?i.next=i:(i.next=a.next,a.next=i),r.pending=i}0!==o&&Mr(n,i,o)}}function Er(e,t,n,r){Ar[Ir++]=e,Ar[Ir++]=t,Ar[Ir++]=n,Ar[Ir++]=r,Pr|=r,e.lanes|=r,null!==(e=e.alternate)&&(e.lanes|=r)}function kr(e,t,n,r){return Er(e,t,n,r),Rr(e)}function Dr(e,t){return Er(e,null,null,t),Rr(e)}function Mr(e,t,n){e.lanes|=n
var r=e.alternate
null!==r&&(r.lanes|=n)
for(var i=!1,o=e.return;null!==o;)o.childLanes|=n,null!==(r=o.alternate)&&(r.childLanes|=n),22===o.tag&&(null===(e=o.stateNode)||1&e._visibility||(i=!0)),e=o,o=o.return
return 3===e.tag?(o=e.stateNode,i&&null!==t&&(i=31-be(n),null===(r=(e=o.hiddenUpdates)[i])?e[i]=[t]:r.push(t),t.lane=536870912|n),o):null}function Rr(e){if(50<Gc)throw Gc=0,Hc=null,Error(a(185))
for(var t=e.return;null!==t;)t=(e=t).return
return 3===e.tag?e.stateNode:null}var Or={}
function Lr(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Nr(e,t,n,r){return new Lr(e,t,n,r)}function Fr(e){return!(!(e=e.prototype)||!e.isReactComponent)}function zr(e,t){var n=e.alternate
return null===n?((n=Nr(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=65011712&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n.refCleanup=e.refCleanup,n}function jr(e,t){e.flags&=65011714
var n=e.alternate
return null===n?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type,t=n.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function Vr(e,t,n,r,i,o){var s=0
if(r=e,"function"==typeof e)Fr(e)&&(s=1)
else if("string"==typeof e)s=function(e,t,n){if(1===n||null!=t.itemProp)return!1
switch(e){case"meta":case"title":return!0
case"style":if("string"!=typeof t.precedence||"string"!=typeof t.href||""===t.href)break
return!0
case"link":if("string"!=typeof t.rel||"string"!=typeof t.href||""===t.href||t.onLoad||t.onError)break
return"stylesheet"!==t.rel||(e=t.disabled,"string"==typeof t.precedence&&null==e)
case"script":if(t.async&&"function"!=typeof t.async&&"symbol"!=typeof t.async&&!t.onLoad&&!t.onError&&t.src&&"string"==typeof t.src)return!0}return!1}(e,n,G.current)?26:"html"===e||"head"===e||"body"===e?27:5
else e:switch(e){case A:return(e=Nr(31,n,t,i)).elementType=A,e.lanes=o,e
case g:return Ur(n.children,i,o,t)
case y:s=8,i|=24
break
case v:return(e=Nr(12,n,t,2|i)).elementType=v,e.lanes=o,e
case _:return(e=Nr(13,n,t,i)).elementType=_,e.lanes=o,e
case C:return(e=Nr(19,n,t,i)).elementType=C,e.lanes=o,e
default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case x:s=10
break e
case b:s=9
break e
case S:s=11
break e
case w:s=14
break e
case T:s=16,r=null
break e}s=29,n=Error(a(130,null===e?"null":typeof e,"")),r=null}return(t=Nr(s,n,t,i)).elementType=e,t.type=r,t.lanes=o,t}function Ur(e,t,n,r){return(e=Nr(7,e,r,t)).lanes=n,e}function Gr(e,t,n){return(e=Nr(6,e,null,t)).lanes=n,e}function Hr(e){var t=Nr(18,null,null,0)
return t.stateNode=e,t}function qr(e,t,n){return(t=Nr(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var Qr=new WeakMap
function $r(e,t){if("object"==typeof e&&null!==e){var n=Qr.get(e)
return void 0!==n?n:(t={value:e,source:t,stack:te(t)},Qr.set(e,t),t)}return{value:e,source:t,stack:te(t)}}var Xr=[],Wr=0,Yr=null,Zr=0,Kr=[],Jr=0,ei=null,ti=1,ni=""
function ri(e,t){Xr[Wr++]=Zr,Xr[Wr++]=Yr,Yr=e,Zr=t}function ii(e,t,n){Kr[Jr++]=ti,Kr[Jr++]=ni,Kr[Jr++]=ei,ei=e
var r=ti
e=ni
var i=32-be(r)-1
r&=~(1<<i),n+=1
var o=32-be(t)+i
if(30<o){var a=i-i%5
o=(r&(1<<a)-1).toString(32),r>>=a,i-=a,ti=1<<32-be(t)+i|n<<i|r,ni=o+e}else ti=1<<o|n<<i|r,ni=e}function oi(e){null!==e.return&&(ri(e,1),ii(e,1,0))}function ai(e){for(;e===Yr;)Yr=Xr[--Wr],Xr[Wr]=null,Zr=Xr[--Wr],Xr[Wr]=null
for(;e===ei;)ei=Kr[--Jr],Kr[Jr]=null,ni=Kr[--Jr],Kr[Jr]=null,ti=Kr[--Jr],Kr[Jr]=null}function si(e,t){Kr[Jr++]=ti,Kr[Jr++]=ni,Kr[Jr++]=ei,ti=t.id,ni=t.overflow,ei=e}var li=null,ci=null,ui=!1,di=null,pi=!1,hi=Error(a(519))
function fi(e){throw xi($r(Error(a(418,1<arguments.length&&void 0!==arguments[1]&&arguments[1]?"text":"HTML","")),e)),hi}function mi(e){var t=e.stateNode,n=e.type,r=e.memoizedProps
switch(t[je]=e,t[Ve]=r,n){case"dialog":Wu("cancel",t),Wu("close",t)
break
case"iframe":case"object":case"embed":Wu("load",t)
break
case"video":case"audio":for(n=0;n<Qu.length;n++)Wu(Qu[n],t)
break
case"source":Wu("error",t)
break
case"img":case"image":case"link":Wu("error",t),Wu("load",t)
break
case"details":Wu("toggle",t)
break
case"input":Wu("invalid",t),vt(t,r.value,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name,!0)
break
case"select":Wu("invalid",t)
break
case"textarea":Wu("invalid",t),_t(t,r.value,r.defaultValue,r.children)}"string"!=typeof(n=r.children)&&"number"!=typeof n&&"bigint"!=typeof n||t.textContent===""+n||!0===r.suppressHydrationWarning||ld(t.textContent,n)?(null!=r.popover&&(Wu("beforetoggle",t),Wu("toggle",t)),null!=r.onScroll&&Wu("scroll",t),null!=r.onScrollEnd&&Wu("scrollend",t),null!=r.onClick&&(t.onclick=kt),t=!0):t=!1,t||fi(e,!0)}function gi(e){for(li=e.return;li;)switch(li.tag){case 5:case 31:case 13:return void(pi=!1)
case 27:case 3:return void(pi=!0)
default:li=li.return}}function yi(e){if(e!==li)return!1
if(!ui)return gi(e),ui=!0,!1
var t,n=e.tag
if((t=3!==n&&27!==n)&&((t=5===n)&&(t=!("form"!==(t=e.type)&&"button"!==t)||vd(e.type,e.memoizedProps)),t=!t),t&&ci&&fi(e),gi(e),13===n){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317))
ci=Rd(e)}else if(31===n){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317))
ci=Rd(e)}else 27===n?(n=ci,Td(e.type)?(e=Md,Md=null,ci=e):ci=n):ci=li?Dd(e.stateNode.nextSibling):null
return!0}function vi(){ci=li=null,ui=!1}function bi(){var e=di
return null!==e&&(null===Bc?Bc=e:Bc.push.apply(Bc,e),di=null),e}function xi(e){null===di?di=[e]:di.push(e)}var Si=F(null),_i=null,Ci=null
function wi(e,t,n){j(Si,t._currentValue),t._currentValue=n}function Ti(e){e._currentValue=Si.current,z(Si)}function Ai(e,t,n){for(;null!==e;){var r=e.alternate
if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break
e=e.return}}function Ii(e,t,n,r){var i=e.child
for(null!==i&&(i.return=e);null!==i;){var o=i.dependencies
if(null!==o){var s=i.child
o=o.firstContext
e:for(;null!==o;){var l=o
o=i
for(var c=0;c<t.length;c++)if(l.context===t[c]){o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),Ai(o.return,n,e),r||(s=null)
break e}o=l.next}}else if(18===i.tag){if(null===(s=i.return))throw Error(a(341))
s.lanes|=n,null!==(o=s.alternate)&&(o.lanes|=n),Ai(s,n,e),s=null}else s=i.child
if(null!==s)s.return=i
else for(s=i;null!==s;){if(s===e){s=null
break}if(null!==(i=s.sibling)){i.return=s.return,s=i
break}s=s.return}i=s}}function Pi(e,t,n,r){e=null
for(var i=t,o=!1;null!==i;){if(!o)if(524288&i.flags)o=!0
else if(262144&i.flags)break
if(10===i.tag){var s=i.alternate
if(null===s)throw Error(a(387))
if(null!==(s=s.memoizedProps)){var l=i.type
Zn(i.pendingProps.value,s.value)||(null!==e?e.push(l):e=[l])}}else if(i===Q.current){if(null===(s=i.alternate))throw Error(a(387))
s.memoizedState.memoizedState!==i.memoizedState.memoizedState&&(null!==e?e.push(cp):e=[cp])}i=i.return}null!==e&&Ii(t,e,n,r),t.flags|=262144}function Bi(e){for(e=e.firstContext;null!==e;){if(!Zn(e.context._currentValue,e.memoizedValue))return!0
e=e.next}return!1}function Ei(e){_i=e,Ci=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function ki(e){return Mi(_i,e)}function Di(e,t){return null===_i&&Ei(e),Mi(e,t)}function Mi(e,t){var n=t._currentValue
if(t={context:t,memoizedValue:n,next:null},null===Ci){if(null===e)throw Error(a(308))
Ci=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else Ci=Ci.next=t
return n}var Ri="undefined"!=typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,n){e.push(n)}}
this.abort=function(){t.aborted=!0,e.forEach(function(e){return e()})}},Oi=r.unstable_scheduleCallback,Li=r.unstable_NormalPriority,Ni={$$typeof:x,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0}
function Fi(){return{controller:new Ri,data:new Map,refCount:0}}function zi(e){e.refCount--,0===e.refCount&&Oi(Li,function(){e.controller.abort()})}var ji=null,Vi=0,Ui=0,Gi=null
function Hi(){if(0===--Vi&&null!==ji){null!==Gi&&(Gi.status="fulfilled")
var e=ji
ji=null,Ui=0,Gi=null
for(var t=0;t<e.length;t++)(0,e[t])()}}var qi=M.S
M.S=function(e,t){Dc=se(),"object"==typeof t&&null!==t&&"function"==typeof t.then&&function(e,t){if(null===ji){var n=ji=[]
Vi=0,Ui=Vu(),Gi={status:"pending",value:void 0,then:function(e){n.push(e)}}}Vi++,t.then(Hi,Hi)}(0,t),null!==qi&&qi(e,t)}
var Qi=F(null)
function $i(){var e=Qi.current
return null!==e?e:hc.pooledCache}function Xi(e,t){j(Qi,null===t?Qi.current:t.pool)}function Wi(){var e=$i()
return null===e?null:{parent:Ni._currentValue,pool:e}}var Yi=Error(a(460)),Zi=Error(a(474)),Ki=Error(a(542)),Ji={then:function(){}}
function eo(e){return"fulfilled"===(e=e.status)||"rejected"===e}function to(e,t,n){switch(void 0===(n=e[n])?e.push(t):n!==t&&(t.then(kt,kt),t=n),t.status){case"fulfilled":return t.value
case"rejected":throw oo(e=t.reason),e
default:if("string"==typeof t.status)t.then(kt,kt)
else{if(null!==(e=hc)&&100<e.shellSuspendCounter)throw Error(a(482));(e=t).status="pending",e.then(function(e){if("pending"===t.status){var n=t
n.status="fulfilled",n.value=e}},function(e){if("pending"===t.status){var n=t
n.status="rejected",n.reason=e}})}switch(t.status){case"fulfilled":return t.value
case"rejected":throw oo(e=t.reason),e}throw ro=t,Yi}}function no(e){try{return(0,e._init)(e._payload)}catch(e){if(null!==e&&"object"==typeof e&&"function"==typeof e.then)throw ro=e,Yi
throw e}}var ro=null
function io(){if(null===ro)throw Error(a(459))
var e=ro
return ro=null,e}function oo(e){if(e===Yi||e===Ki)throw Error(a(483))}var ao=null,so=0
function lo(e){var t=so
return so+=1,null===ao&&(ao=[]),to(ao,e,t)}function co(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function uo(e,t){if(t.$$typeof===h)throw Error(a(525))
throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function po(e){function t(t,n){if(e){var r=t.deletions
null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null
for(;null!==r;)t(n,r),r=r.sibling
return null}function r(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling
return t}function i(e,t){return(e=zr(e,t)).index=0,e.sibling=null,e}function o(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=67108866,n):r:(t.flags|=67108866,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=67108866),t}function l(e,t,n,r){return null===t||6!==t.tag?((t=Gr(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function c(e,t,n,r){var o=n.type
return o===g?d(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===o||"object"==typeof o&&null!==o&&o.$$typeof===T&&no(o)===t.type)?(co(t=i(t,n.props),n),t.return=e,t):(co(t=Vr(n.type,n.key,n.props,null,e.mode,r),n),t.return=e,t)}function u(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=qr(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function d(e,t,n,r,o){return null===t||7!==t.tag?((t=Ur(n,e.mode,r,o)).return=e,t):((t=i(t,n)).return=e,t)}function p(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t||"bigint"==typeof t)return(t=Gr(""+t,e.mode,n)).return=e,t
if("object"==typeof t&&null!==t){switch(t.$$typeof){case f:return co(n=Vr(t.type,t.key,t.props,null,e.mode,n),t),n.return=e,n
case m:return(t=qr(t,e.mode,n)).return=e,t
case T:return p(e,t=no(t),n)}if(D(t)||B(t))return(t=Ur(t,e.mode,n,null)).return=e,t
if("function"==typeof t.then)return p(e,lo(t),n)
if(t.$$typeof===x)return p(e,Di(e,t),n)
uo(e,t)}return null}function h(e,t,n,r){var i=null!==t?t.key:null
if("string"==typeof n&&""!==n||"number"==typeof n||"bigint"==typeof n)return null!==i?null:l(e,t,""+n,r)
if("object"==typeof n&&null!==n){switch(n.$$typeof){case f:return n.key===i?c(e,t,n,r):null
case m:return n.key===i?u(e,t,n,r):null
case T:return h(e,t,n=no(n),r)}if(D(n)||B(n))return null!==i?null:d(e,t,n,r,null)
if("function"==typeof n.then)return h(e,t,lo(n),r)
if(n.$$typeof===x)return h(e,t,Di(e,n),r)
uo(e,n)}return null}function y(e,t,n,r,i){if("string"==typeof r&&""!==r||"number"==typeof r||"bigint"==typeof r)return l(t,e=e.get(n)||null,""+r,i)
if("object"==typeof r&&null!==r){switch(r.$$typeof){case f:return c(t,e=e.get(null===r.key?n:r.key)||null,r,i)
case m:return u(t,e=e.get(null===r.key?n:r.key)||null,r,i)
case T:return y(e,t,n,r=no(r),i)}if(D(r)||B(r))return d(t,e=e.get(n)||null,r,i,null)
if("function"==typeof r.then)return y(e,t,n,lo(r),i)
if(r.$$typeof===x)return y(e,t,n,Di(t,r),i)
uo(t,r)}return null}function v(l,c,u,d){if("object"==typeof u&&null!==u&&u.type===g&&null===u.key&&(u=u.props.children),"object"==typeof u&&null!==u){switch(u.$$typeof){case f:e:{for(var b=u.key;null!==c;){if(c.key===b){if((b=u.type)===g){if(7===c.tag){n(l,c.sibling),(d=i(c,u.props.children)).return=l,l=d
break e}}else if(c.elementType===b||"object"==typeof b&&null!==b&&b.$$typeof===T&&no(b)===c.type){n(l,c.sibling),co(d=i(c,u.props),u),d.return=l,l=d
break e}n(l,c)
break}t(l,c),c=c.sibling}u.type===g?((d=Ur(u.props.children,l.mode,d,u.key)).return=l,l=d):(co(d=Vr(u.type,u.key,u.props,null,l.mode,d),u),d.return=l,l=d)}return s(l)
case m:e:{for(b=u.key;null!==c;){if(c.key===b){if(4===c.tag&&c.stateNode.containerInfo===u.containerInfo&&c.stateNode.implementation===u.implementation){n(l,c.sibling),(d=i(c,u.children||[])).return=l,l=d
break e}n(l,c)
break}t(l,c),c=c.sibling}(d=qr(u,l.mode,d)).return=l,l=d}return s(l)
case T:return v(l,c,u=no(u),d)}if(D(u))return function(i,a,s,l){for(var c=null,u=null,d=a,f=a=0,m=null;null!==d&&f<s.length;f++){d.index>f?(m=d,d=null):m=d.sibling
var g=h(i,d,s[f],l)
if(null===g){null===d&&(d=m)
break}e&&d&&null===g.alternate&&t(i,d),a=o(g,a,f),null===u?c=g:u.sibling=g,u=g,d=m}if(f===s.length)return n(i,d),ui&&ri(i,f),c
if(null===d){for(;f<s.length;f++)null!==(d=p(i,s[f],l))&&(a=o(d,a,f),null===u?c=d:u.sibling=d,u=d)
return ui&&ri(i,f),c}for(d=r(d);f<s.length;f++)null!==(m=y(d,i,f,s[f],l))&&(e&&null!==m.alternate&&d.delete(null===m.key?f:m.key),a=o(m,a,f),null===u?c=m:u.sibling=m,u=m)
return e&&d.forEach(function(e){return t(i,e)}),ui&&ri(i,f),c}(l,c,u,d)
if(B(u)){if("function"!=typeof(b=B(u)))throw Error(a(150))
return function(i,s,l,c){if(null==l)throw Error(a(151))
for(var u=null,d=null,f=s,m=s=0,g=null,v=l.next();null!==f&&!v.done;m++,v=l.next()){f.index>m?(g=f,f=null):g=f.sibling
var b=h(i,f,v.value,c)
if(null===b){null===f&&(f=g)
break}e&&f&&null===b.alternate&&t(i,f),s=o(b,s,m),null===d?u=b:d.sibling=b,d=b,f=g}if(v.done)return n(i,f),ui&&ri(i,m),u
if(null===f){for(;!v.done;m++,v=l.next())null!==(v=p(i,v.value,c))&&(s=o(v,s,m),null===d?u=v:d.sibling=v,d=v)
return ui&&ri(i,m),u}for(f=r(f);!v.done;m++,v=l.next())null!==(v=y(f,i,m,v.value,c))&&(e&&null!==v.alternate&&f.delete(null===v.key?m:v.key),s=o(v,s,m),null===d?u=v:d.sibling=v,d=v)
return e&&f.forEach(function(e){return t(i,e)}),ui&&ri(i,m),u}(l,c,u=b.call(u),d)}if("function"==typeof u.then)return v(l,c,lo(u),d)
if(u.$$typeof===x)return v(l,c,Di(l,u),d)
uo(l,u)}return"string"==typeof u&&""!==u||"number"==typeof u||"bigint"==typeof u?(u=""+u,null!==c&&6===c.tag?(n(l,c.sibling),(d=i(c,u)).return=l,l=d):(n(l,c),(d=Gr(u,l.mode,d)).return=l,l=d),s(l)):n(l,c)}return function(e,t,n,r){try{so=0
var i=v(e,t,n,r)
return ao=null,i}catch(t){if(t===Yi||t===Ki)throw t
var o=Nr(29,t,null,e.mode)
return o.lanes=r,o.return=e,o}}}var ho=po(!0),fo=po(!1),mo=!1
function go(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function yo(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function vo(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function bo(e,t,n){var r=e.updateQueue
if(null===r)return null
if(r=r.shared,2&pc){var i=r.pending
return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,t=Rr(e),Mr(e,null,n),t}return Er(e,r,t,n),Rr(e)}function xo(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,4194048&n)){var r=t.lanes
n|=r&=e.pendingLanes,t.lanes=n,Me(e,n)}}function So(e,t){var n=e.updateQueue,r=e.alternate
if(null!==r&&n===(r=r.updateQueue)){var i=null,o=null
if(null!==(n=n.firstBaseUpdate)){do{var a={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null}
null===o?i=o=a:o=o.next=a,n=n.next}while(null!==n)
null===o?i=o=t:o=o.next=t}else i=o=t
return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,callbacks:r.callbacks},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}var _o=!1
function Co(){if(_o&&null!==Gi)throw Gi}function wo(e,t,n,r){_o=!1
var i=e.updateQueue
mo=!1
var o=i.firstBaseUpdate,a=i.lastBaseUpdate,s=i.shared.pending
if(null!==s){i.shared.pending=null
var l=s,c=l.next
l.next=null,null===a?o=c:a.next=c,a=l
var u=e.alternate
null!==u&&(s=(u=u.updateQueue).lastBaseUpdate)!==a&&(null===s?u.firstBaseUpdate=c:s.next=c,u.lastBaseUpdate=l)}if(null!==o){var d=i.baseState
for(a=0,u=c=l=null,s=o;;){var h=-536870913&s.lane,f=h!==s.lane
if(f?(mc&h)===h:(r&h)===h){0!==h&&h===Ui&&(_o=!0),null!==u&&(u=u.next={lane:0,tag:s.tag,payload:s.payload,callback:null,next:null})
e:{var m=e,g=s
h=t
var y=n
switch(g.tag){case 1:if("function"==typeof(m=g.payload)){d=m.call(y,d,h)
break e}d=m
break e
case 3:m.flags=-65537&m.flags|128
case 0:if(null==(h="function"==typeof(m=g.payload)?m.call(y,d,h):m))break e
d=p({},d,h)
break e
case 2:mo=!0}}null!==(h=s.callback)&&(e.flags|=64,f&&(e.flags|=8192),null===(f=i.callbacks)?i.callbacks=[h]:f.push(h))}else f={lane:h,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===u?(c=u=f,l=d):u=u.next=f,a|=h
if(null===(s=s.next)){if(null===(s=i.shared.pending))break
s=(f=s).next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}null===u&&(l=d),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,null===o&&(i.shared.lanes=0),Cc|=a,e.lanes=a,e.memoizedState=d}}function To(e,t){if("function"!=typeof e)throw Error(a(191,e))
e.call(t)}function Ao(e,t){var n=e.callbacks
if(null!==n)for(e.callbacks=null,e=0;e<n.length;e++)To(n[e],t)}var Io=F(null),Po=F(0)
function Bo(e,t){j(Po,e=Sc),j(Io,t),Sc=e|t.baseLanes}function Eo(){j(Po,Sc),j(Io,Io.current)}function ko(){Sc=Po.current,z(Io),z(Po)}var Do=F(null),Mo=null
function Ro(e){var t=e.alternate
j(zo,1&zo.current),j(Do,e),null===Mo&&(null===t||null!==Io.current||null!==t.memoizedState)&&(Mo=e)}function Oo(e){j(zo,zo.current),j(Do,e),null===Mo&&(Mo=e)}function Lo(e){22===e.tag?(j(zo,zo.current),j(Do,e),null===Mo&&(Mo=e)):No()}function No(){j(zo,zo.current),j(Do,Do.current)}function Fo(e){z(Do),Mo===e&&(Mo=null),z(zo)}var zo=F(0)
function jo(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState
if(null!==n&&(null===(n=n.dehydrated)||Ed(n)||kd(n)))return t}else if(19!==t.tag||"forwards"!==t.memoizedProps.revealOrder&&"backwards"!==t.memoizedProps.revealOrder&&"unstable_legacy-backwards"!==t.memoizedProps.revealOrder&&"together"!==t.memoizedProps.revealOrder){if(null!==t.child){t.child.return=t,t=t.child
continue}}else if(128&t.flags)return t
if(t===e)break
for(;null===t.sibling;){if(null===t.return||t.return===e)return null
t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Vo=0,Uo=null,Go=null,Ho=null,qo=!1,Qo=!1,$o=!1,Xo=0,Wo=0,Yo=null,Zo=0
function Ko(){throw Error(a(321))}function Jo(e,t){if(null===t)return!1
for(var n=0;n<t.length&&n<e.length;n++)if(!Zn(e[n],t[n]))return!1
return!0}function ea(e,t,n,r,i,o){return Vo=o,Uo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,M.H=null===e||null===e.memoizedState?ms:gs,$o=!1,o=n(r,i),$o=!1,Qo&&(o=na(t,n,r,i)),ta(e),o}function ta(e){M.H=fs
var t=null!==Go&&null!==Go.next
if(Vo=0,Ho=Go=Uo=null,qo=!1,Wo=0,Yo=null,t)throw Error(a(300))
null===e||Ds||null!==(e=e.dependencies)&&Bi(e)&&(Ds=!0)}function na(e,t,n,r){Uo=e
var i=0
do{if(Qo&&(Yo=null),Wo=0,Qo=!1,25<=i)throw Error(a(301))
if(i+=1,Ho=Go=null,null!=e.updateQueue){var o=e.updateQueue
o.lastEffect=null,o.events=null,o.stores=null,null!=o.memoCache&&(o.memoCache.index=0)}M.H=ys,o=t(n,r)}while(Qo)
return o}function ra(){var e=M.H,t=e.useState()[0]
return t="function"==typeof t.then?ca(t):t,e=e.useState()[0],(null!==Go?Go.memoizedState:null)!==e&&(Uo.flags|=1024),t}function ia(){var e=0!==Xo
return Xo=0,e}function oa(e,t,n){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n}function aa(e){if(qo){for(e=e.memoizedState;null!==e;){var t=e.queue
null!==t&&(t.pending=null),e=e.next}qo=!1}Vo=0,Ho=Go=Uo=null,Qo=!1,Wo=Xo=0,Yo=null}function sa(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null}
return null===Ho?Uo.memoizedState=Ho=e:Ho=Ho.next=e,Ho}function la(){if(null===Go){var e=Uo.alternate
e=null!==e?e.memoizedState:null}else e=Go.next
var t=null===Ho?Uo.memoizedState:Ho.next
if(null!==t)Ho=t,Go=e
else{if(null===e){if(null===Uo.alternate)throw Error(a(467))
throw Error(a(310))}e={memoizedState:(Go=e).memoizedState,baseState:Go.baseState,baseQueue:Go.baseQueue,queue:Go.queue,next:null},null===Ho?Uo.memoizedState=Ho=e:Ho=Ho.next=e}return Ho}function ca(e){var t=Wo
return Wo+=1,null===Yo&&(Yo=[]),e=to(Yo,e,t),t=Uo,null===(null===Ho?t.memoizedState:Ho.next)&&(t=t.alternate,M.H=null===t||null===t.memoizedState?ms:gs),e}function ua(e){if(null!==e&&"object"==typeof e){if("function"==typeof e.then)return ca(e)
if(e.$$typeof===x)return ki(e)}throw Error(a(438,String(e)))}function da(e){var t=null,n=Uo.updateQueue
if(null!==n&&(t=n.memoCache),null==t){var r=Uo.alternate
null!==r&&null!==(r=r.updateQueue)&&null!=(r=r.memoCache)&&(t={data:r.data.map(function(e){return e.slice()}),index:0})}if(null==t&&(t={data:[],index:0}),null===n&&(n={lastEffect:null,events:null,stores:null,memoCache:null},Uo.updateQueue=n),n.memoCache=t,void 0===(n=t.data[t.index]))for(n=t.data[t.index]=Array(e),r=0;r<e;r++)n[r]=I
return t.index++,n}function pa(e,t){return"function"==typeof t?t(e):t}function ha(e){return fa(la(),Go,e)}function fa(e,t,n){var r=e.queue
if(null===r)throw Error(a(311))
r.lastRenderedReducer=n
var i=e.baseQueue,o=r.pending
if(null!==o){if(null!==i){var s=i.next
i.next=o.next,o.next=s}t.baseQueue=i=o,r.pending=null}if(o=e.baseState,null===i)e.memoizedState=o
else{var l=s=null,c=null,u=t=i.next,d=!1
do{var p=-536870913&u.lane
if(p!==u.lane?(mc&p)===p:(Vo&p)===p){var h=u.revertLane
if(0===h)null!==c&&(c=c.next={lane:0,revertLane:0,gesture:null,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),p===Ui&&(d=!0)
else{if((Vo&h)===h){u=u.next,h===Ui&&(d=!0)
continue}p={lane:0,revertLane:u.revertLane,gesture:null,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=p,s=o):c=c.next=p,Uo.lanes|=h,Cc|=h}p=u.action,$o&&n(o,p),o=u.hasEagerState?u.eagerState:n(o,p)}else h={lane:p,revertLane:u.revertLane,gesture:u.gesture,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=h,s=o):c=c.next=h,Uo.lanes|=p,Cc|=p
u=u.next}while(null!==u&&u!==t)
if(null===c?s=o:c.next=l,!Zn(o,e.memoizedState)&&(Ds=!0,d&&null!==(n=Gi)))throw n
e.memoizedState=o,e.baseState=s,e.baseQueue=c,r.lastRenderedState=o}return null===i&&(r.lanes=0),[e.memoizedState,r.dispatch]}function ma(e){var t=la(),n=t.queue
if(null===n)throw Error(a(311))
n.lastRenderedReducer=e
var r=n.dispatch,i=n.pending,o=t.memoizedState
if(null!==i){n.pending=null
var s=i=i.next
do{o=e(o,s.action),s=s.next}while(s!==i)
Zn(o,t.memoizedState)||(Ds=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function ga(e,t,n){var r=Uo,i=la(),o=ui
if(o){if(void 0===n)throw Error(a(407))
n=n()}else n=t()
var s=!Zn((Go||i).memoizedState,n)
if(s&&(i.memoizedState=n,Ds=!0),i=i.queue,Va(ba.bind(null,r,i,e),[e]),i.getSnapshot!==t||s||null!==Ho&&1&Ho.memoizedState.tag){if(r.flags|=2048,La(9,{destroy:void 0},va.bind(null,r,i,n,t),null),null===hc)throw Error(a(349))
o||127&Vo||ya(r,t,n)}return n}function ya(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=Uo.updateQueue)?(t={lastEffect:null,events:null,stores:null,memoCache:null},Uo.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function va(e,t,n,r){t.value=n,t.getSnapshot=r,xa(t)&&Sa(e)}function ba(e,t,n){return n(function(){xa(t)&&Sa(e)})}function xa(e){var t=e.getSnapshot
e=e.value
try{var n=t()
return!Zn(e,n)}catch(e){return!0}}function Sa(e){var t=Dr(e,2)
null!==t&&$c(t,0,2)}function _a(e){var t=sa()
if("function"==typeof e){var n=e
if(e=n(),$o){ve(!0)
try{n()}finally{ve(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:pa,lastRenderedState:e},t}function Ca(e,t,n,r){return e.baseState=n,fa(e,Go,"function"==typeof r?r:pa)}function wa(e,t,n,r,i){if(ds(e))throw Error(a(485))
if(null!==(e=t.action)){var o={payload:i,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){o.listeners.push(e)}}
null!==M.T?n(!0):o.isTransition=!1,r(o),null===(n=t.pending)?(o.next=t.pending=o,Ta(t,o)):(o.next=n.next,t.pending=n.next=o)}}function Ta(e,t){var n=t.action,r=t.payload,i=e.state
if(t.isTransition){var o=M.T,a={}
M.T=a
try{var s=n(i,r),l=M.S
null!==l&&l(a,s),Aa(e,t,s)}catch(n){Pa(e,t,n)}finally{null!==o&&null!==a.types&&(o.types=a.types),M.T=o}}else try{Aa(e,t,o=n(i,r))}catch(n){Pa(e,t,n)}}function Aa(e,t,n){null!==n&&"object"==typeof n&&"function"==typeof n.then?n.then(function(n){Ia(e,t,n)},function(n){return Pa(e,t,n)}):Ia(e,t,n)}function Ia(e,t,n){t.status="fulfilled",t.value=n,Ba(t),e.state=n,null!==(t=e.pending)&&((n=t.next)===t?e.pending=null:(n=n.next,t.next=n,Ta(e,n)))}function Pa(e,t,n){var r=e.pending
if(e.pending=null,null!==r){r=r.next
do{t.status="rejected",t.reason=n,Ba(t),t=t.next}while(t!==r)}e.action=null}function Ba(e){e=e.listeners
for(var t=0;t<e.length;t++)(0,e[t])()}function Ea(e,t){return t}function ka(e,t){if(ui){var n=hc.formState
if(null!==n){e:{var r=Uo
if(ui){if(ci){t:{for(var i=ci,o=pi;8!==i.nodeType;){if(!o){i=null
break t}if(null===(i=Dd(i.nextSibling))){i=null
break t}}i="F!"===(o=i.data)||"F"===o?i:null}if(i){ci=Dd(i.nextSibling),r="F!"===i.data
break e}}fi(r)}r=!1}r&&(t=n[0])}}return(n=sa()).memoizedState=n.baseState=t,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ea,lastRenderedState:t},n.queue=r,n=ls.bind(null,Uo,r),r.dispatch=n,r=_a(!1),o=us.bind(null,Uo,!1,r.queue),i={state:t,dispatch:null,action:e,pending:null},(r=sa()).queue=i,n=wa.bind(null,Uo,i,o,n),i.dispatch=n,r.memoizedState=e,[t,n,!1]}function Da(e){return Ma(la(),Go,e)}function Ma(e,t,n){if(t=fa(e,t,Ea)[0],e=ha(pa)[0],"object"==typeof t&&null!==t&&"function"==typeof t.then)try{var r=ca(t)}catch(e){if(e===Yi)throw Ki
throw e}else r=t
var i=(t=la()).queue,o=i.dispatch
return n!==t.memoizedState&&(Uo.flags|=2048,La(9,{destroy:void 0},Ra.bind(null,i,n),null)),[r,o,e]}function Ra(e,t){e.action=t}function Oa(e){var t=la(),n=Go
if(null!==n)return Ma(t,n,e)
la(),t=t.memoizedState
var r=(n=la()).queue.dispatch
return n.memoizedState=e,[t,r,!1]}function La(e,t,n,r){return e={tag:e,create:n,deps:r,inst:t,next:null},null===(t=Uo.updateQueue)&&(t={lastEffect:null,events:null,stores:null,memoCache:null},Uo.updateQueue=t),null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Na(){return la().memoizedState}function Fa(e,t,n,r){var i=sa()
Uo.flags|=e,i.memoizedState=La(1|t,{destroy:void 0},n,void 0===r?null:r)}function za(e,t,n,r){var i=la()
r=void 0===r?null:r
var o=i.memoizedState.inst
null!==Go&&null!==r&&Jo(r,Go.memoizedState.deps)?i.memoizedState=La(t,o,n,r):(Uo.flags|=e,i.memoizedState=La(1|t,o,n,r))}function ja(e,t){Fa(8390656,8,e,t)}function Va(e,t){za(2048,8,e,t)}function Ua(e){var t=la().memoizedState
return function(e){Uo.flags|=4
var t=Uo.updateQueue
if(null===t)t={lastEffect:null,events:null,stores:null,memoCache:null},Uo.updateQueue=t,t.events=[e]
else{var n=t.events
null===n?t.events=[e]:n.push(e)}}({ref:t,nextImpl:e}),function(){if(2&pc)throw Error(a(440))
return t.impl.apply(void 0,arguments)}}function Ga(e,t){return za(4,2,e,t)}function Ha(e,t){return za(4,4,e,t)}function qa(e,t){if("function"==typeof t){e=e()
var n=t(e)
return function(){"function"==typeof n?n():t(null)}}if(null!=t)return e=e(),t.current=e,function(){t.current=null}}function Qa(e,t,n){n=null!=n?n.concat([e]):null,za(4,4,qa.bind(null,t,e),n)}function $a(){}function Xa(e,t){var n=la()
t=void 0===t?null:t
var r=n.memoizedState
return null!==t&&Jo(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Wa(e,t){var n=la()
t=void 0===t?null:t
var r=n.memoizedState
if(null!==t&&Jo(t,r[1]))return r[0]
if(r=e(),$o){ve(!0)
try{e()}finally{ve(!1)}}return n.memoizedState=[r,t],r}function Ya(e,t,n){return void 0===n||1073741824&Vo&&!(261930&mc)?e.memoizedState=t:(e.memoizedState=n,e=Qc(),Uo.lanes|=e,Cc|=e,n)}function Za(e,t,n,r){return Zn(n,t)?n:null!==Io.current?(e=Ya(e,n,r),Zn(e,t)||(Ds=!0),e):42&Vo&&(!(1073741824&Vo)||261930&mc)?(e=Qc(),Uo.lanes|=e,Cc|=e,t):(Ds=!0,e.memoizedState=n)}function Ka(e,t,n,r,i){var o=R.p
R.p=0!==o&&8>o?o:8
var a,s,l,c=M.T,u={}
M.T=u,us(e,!1,t,n)
try{var d=i(),p=M.S
null!==p&&p(u,d),null!==d&&"object"==typeof d&&"function"==typeof d.then?cs(e,t,(a=r,s=[],l={status:"pending",value:null,reason:null,then:function(e){s.push(e)}},d.then(function(){l.status="fulfilled",l.value=a
for(var e=0;e<s.length;e++)(0,s[e])(a)},function(e){for(l.status="rejected",l.reason=e,e=0;e<s.length;e++)(0,s[e])(void 0)}),l),qc()):cs(e,t,r,qc())}catch(n){cs(e,t,{then:function(){},status:"rejected",reason:n},qc())}finally{R.p=o,null!==c&&null!==u.types&&(c.types=u.types),M.T=c}}function Ja(){}function es(e,t,n,r){if(5!==e.tag)throw Error(a(476))
var i=ts(e).queue
Ka(e,i,t,O,null===n?Ja:function(){return ns(e),n(r)})}function ts(e){var t=e.memoizedState
if(null!==t)return t
var n={}
return(t={memoizedState:O,baseState:O,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:pa,lastRenderedState:O},next:null}).next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:pa,lastRenderedState:n},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function ns(e){var t=ts(e)
null===t.next&&(t=e.alternate.memoizedState),cs(e,t.next.queue,{},qc())}function rs(){return ki(cp)}function is(){return la().memoizedState}function os(){return la().memoizedState}function as(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var n=qc(),r=bo(t,e=vo(n),n)
return null!==r&&($c(r,0,n),xo(r,t,n)),t={cache:Fi()},void(e.payload=t)}t=t.return}}function ss(e,t,n){var r=qc()
n={lane:r,revertLane:0,gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null},ds(e)?ps(t,n):null!==(n=kr(e,t,n,r))&&($c(n,0,r),hs(n,t,r))}function ls(e,t,n){cs(e,t,n,qc())}function cs(e,t,n,r){var i={lane:r,revertLane:0,gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null}
if(ds(e))ps(t,i)
else{var o=e.alternate
if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var a=t.lastRenderedState,s=o(a,n)
if(i.hasEagerState=!0,i.eagerState=s,Zn(s,a))return Er(e,t,i,0),null===hc&&Br(),!1}catch(e){}if(null!==(n=kr(e,t,i,r)))return $c(n,0,r),hs(n,t,r),!0}return!1}function us(e,t,n,r){if(r={lane:2,revertLane:Vu(),gesture:null,action:r,hasEagerState:!1,eagerState:null,next:null},ds(e)){if(t)throw Error(a(479))}else null!==(t=kr(e,n,r,2))&&$c(t,0,2)}function ds(e){var t=e.alternate
return e===Uo||null!==t&&t===Uo}function ps(e,t){Qo=qo=!0
var n=e.pending
null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function hs(e,t,n){if(4194048&n){var r=t.lanes
n|=r&=e.pendingLanes,t.lanes=n,Me(e,n)}}var fs={readContext:ki,use:ua,useCallback:Ko,useContext:Ko,useEffect:Ko,useImperativeHandle:Ko,useLayoutEffect:Ko,useInsertionEffect:Ko,useMemo:Ko,useReducer:Ko,useRef:Ko,useState:Ko,useDebugValue:Ko,useDeferredValue:Ko,useTransition:Ko,useSyncExternalStore:Ko,useId:Ko,useHostTransitionStatus:Ko,useFormState:Ko,useActionState:Ko,useOptimistic:Ko,useMemoCache:Ko,useCacheRefresh:Ko}
fs.useEffectEvent=Ko
var ms={readContext:ki,use:ua,useCallback:function(e,t){return sa().memoizedState=[e,void 0===t?null:t],e},useContext:ki,useEffect:ja,useImperativeHandle:function(e,t,n){n=null!=n?n.concat([e]):null,Fa(4194308,4,qa.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Fa(4194308,4,e,t)},useInsertionEffect:function(e,t){Fa(4,2,e,t)},useMemo:function(e,t){var n=sa()
t=void 0===t?null:t
var r=e()
if($o){ve(!0)
try{e()}finally{ve(!1)}}return n.memoizedState=[r,t],r},useReducer:function(e,t,n){var r=sa()
if(void 0!==n){var i=n(t)
if($o){ve(!0)
try{n(t)}finally{ve(!1)}}}else i=t
return r.memoizedState=r.baseState=i,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:i},r.queue=e,e=e.dispatch=ss.bind(null,Uo,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},sa().memoizedState=e},useState:function(e){var t=(e=_a(e)).queue,n=ls.bind(null,Uo,t)
return t.dispatch=n,[e.memoizedState,n]},useDebugValue:$a,useDeferredValue:function(e,t){return Ya(sa(),e,t)},useTransition:function(){var e=_a(!1)
return e=Ka.bind(null,Uo,e.queue,!0,!1),sa().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,n){var r=Uo,i=sa()
if(ui){if(void 0===n)throw Error(a(407))
n=n()}else{if(n=t(),null===hc)throw Error(a(349))
127&mc||ya(r,t,n)}i.memoizedState=n
var o={value:n,getSnapshot:t}
return i.queue=o,ja(ba.bind(null,r,o,e),[e]),r.flags|=2048,La(9,{destroy:void 0},va.bind(null,r,o,n,t),null),n},useId:function(){var e=sa(),t=hc.identifierPrefix
if(ui){var n=ni
t="_"+t+"R_"+(n=(ti&~(1<<32-be(ti)-1)).toString(32)+n),0<(n=Xo++)&&(t+="H"+n.toString(32)),t+="_"}else t="_"+t+"r_"+(n=Zo++).toString(32)+"_"
return e.memoizedState=t},useHostTransitionStatus:rs,useFormState:ka,useActionState:ka,useOptimistic:function(e){var t=sa()
t.memoizedState=t.baseState=e
var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null}
return t.queue=n,t=us.bind(null,Uo,!0,n),n.dispatch=t,[e,t]},useMemoCache:da,useCacheRefresh:function(){return sa().memoizedState=as.bind(null,Uo)},useEffectEvent:function(e){var t=sa(),n={impl:e}
return t.memoizedState=n,function(){if(2&pc)throw Error(a(440))
return n.impl.apply(void 0,arguments)}}},gs={readContext:ki,use:ua,useCallback:Xa,useContext:ki,useEffect:Va,useImperativeHandle:Qa,useInsertionEffect:Ga,useLayoutEffect:Ha,useMemo:Wa,useReducer:ha,useRef:Na,useState:function(){return ha(pa)},useDebugValue:$a,useDeferredValue:function(e,t){return Za(la(),Go.memoizedState,e,t)},useTransition:function(){var e=ha(pa)[0],t=la().memoizedState
return["boolean"==typeof e?e:ca(e),t]},useSyncExternalStore:ga,useId:is,useHostTransitionStatus:rs,useFormState:Da,useActionState:Da,useOptimistic:function(e,t){return Ca(la(),0,e,t)},useMemoCache:da,useCacheRefresh:os}
gs.useEffectEvent=Ua
var ys={readContext:ki,use:ua,useCallback:Xa,useContext:ki,useEffect:Va,useImperativeHandle:Qa,useInsertionEffect:Ga,useLayoutEffect:Ha,useMemo:Wa,useReducer:ma,useRef:Na,useState:function(){return ma(pa)},useDebugValue:$a,useDeferredValue:function(e,t){var n=la()
return null===Go?Ya(n,e,t):Za(n,Go.memoizedState,e,t)},useTransition:function(){var e=ma(pa)[0],t=la().memoizedState
return["boolean"==typeof e?e:ca(e),t]},useSyncExternalStore:ga,useId:is,useHostTransitionStatus:rs,useFormState:Oa,useActionState:Oa,useOptimistic:function(e,t){var n=la()
return null!==Go?Ca(n,0,e,t):(n.baseState=e,[e,n.queue.dispatch])},useMemoCache:da,useCacheRefresh:os}
function vs(e,t,n,r){n=null==(n=n(r,t=e.memoizedState))?t:p({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}ys.useEffectEvent=Ua
var bs={enqueueSetState:function(e,t,n){e=e._reactInternals
var r=qc(),i=vo(r)
i.payload=t,null!=n&&(i.callback=n),null!==(t=bo(e,i,r))&&($c(t,0,r),xo(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals
var r=qc(),i=vo(r)
i.tag=1,i.payload=t,null!=n&&(i.callback=n),null!==(t=bo(e,i,r))&&($c(t,0,r),xo(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals
var n=qc(),r=vo(n)
r.tag=2,null!=t&&(r.callback=t),null!==(t=bo(e,r,n))&&($c(t,0,n),xo(t,e,n))}}
function xs(e,t,n,r,i,o,a){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,o,a):!(t.prototype&&t.prototype.isPureReactComponent&&Kn(n,r)&&Kn(i,o))}function Ss(e,t,n,r){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&bs.enqueueReplaceState(t,t.state,null)}function _s(e,t){var n=t
if("ref"in t)for(var r in n={},t)"ref"!==r&&(n[r]=t[r])
if(e=e.defaultProps)for(var i in n===t&&(n=p({},n)),e)void 0===n[i]&&(n[i]=e[i])
return n}function Cs(e){Tr(e)}function ws(e){console.error(e)}function Ts(e){Tr(e)}function As(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(e){setTimeout(function(){throw e})}}function Is(e,t,n){try{(0,e.onCaughtError)(n.value,{componentStack:n.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(e){setTimeout(function(){throw e})}}function Ps(e,t,n){return(n=vo(n)).tag=3,n.payload={element:null},n.callback=function(){As(e,t)},n}function Bs(e){return(e=vo(e)).tag=3,e}function Es(e,t,n,r){var i=n.type.getDerivedStateFromError
if("function"==typeof i){var o=r.value
e.payload=function(){return i(o)},e.callback=function(){Is(t,n,r)}}var a=n.stateNode
null!==a&&"function"==typeof a.componentDidCatch&&(e.callback=function(){Is(t,n,r),"function"!=typeof i&&(null===Oc?Oc=new Set([this]):Oc.add(this))
var e=r.stack
this.componentDidCatch(r.value,{componentStack:null!==e?e:""})})}var ks=Error(a(461)),Ds=!1
function Ms(e,t,n,r){t.child=null===e?fo(t,null,n,r):ho(t,e.child,n,r)}function Rs(e,t,n,r,i){n=n.render
var o=t.ref
if("ref"in r){var a={}
for(var s in r)"ref"!==s&&(a[s]=r[s])}else a=r
return Ei(t),r=ea(e,t,n,a,o,i),s=ia(),null===e||Ds?(ui&&s&&oi(t),t.flags|=1,Ms(e,t,r,i),t.child):(oa(e,t,i),rl(e,t,i))}function Os(e,t,n,r,i){if(null===e){var o=n.type
return"function"!=typeof o||Fr(o)||void 0!==o.defaultProps||null!==n.compare?((e=Vr(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Ls(e,t,o,r,i))}if(o=e.child,!il(e,i)){var a=o.memoizedProps
if((n=null!==(n=n.compare)?n:Kn)(a,r)&&e.ref===t.ref)return rl(e,t,i)}return t.flags|=1,(e=zr(o,r)).ref=t.ref,e.return=t,t.child=e}function Ls(e,t,n,r,i){if(null!==e){var o=e.memoizedProps
if(Kn(o,r)&&e.ref===t.ref){if(Ds=!1,t.pendingProps=r=o,!il(e,i))return t.lanes=e.lanes,rl(e,t,i)
131072&e.flags&&(Ds=!0)}}return Gs(e,t,n,r,i)}function Ns(e,t,n,r){var i=r.children,o=null!==e?e.memoizedState:null
if(null===e&&null===t.stateNode&&(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),"hidden"===r.mode){if(128&t.flags){if(o=null!==o?o.baseLanes|n:n,null!==e){for(r=t.child=e.child,i=0;null!==r;)i=i|r.lanes|r.childLanes,r=r.sibling
r=i&~o}else r=0,t.child=null
return zs(e,t,o,n,r)}if(!(536870912&n))return r=t.lanes=536870912,zs(e,t,null!==o?o.baseLanes|n:n,n,r)
t.memoizedState={baseLanes:0,cachePool:null},null!==e&&Xi(0,null!==o?o.cachePool:null),null!==o?Bo(t,o):Eo(),Lo(t)}else null!==o?(Xi(0,o.cachePool),Bo(t,o),No(),t.memoizedState=null):(null!==e&&Xi(0,null),Eo(),No())
return Ms(e,t,i,n),t.child}function Fs(e,t){return null!==e&&22===e.tag||null!==t.stateNode||(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),t.sibling}function zs(e,t,n,r,i){var o=$i()
return o=null===o?null:{parent:Ni._currentValue,pool:o},t.memoizedState={baseLanes:n,cachePool:o},null!==e&&Xi(0,null),Eo(),Lo(t),null!==e&&Pi(e,t,r,!0),t.childLanes=i,null}function js(e,t){return(t=Ks({mode:t.mode,children:t.children},e.mode)).ref=e.ref,e.child=t,t.return=e,t}function Vs(e,t,n){return ho(t,e.child,null,n),(e=js(t,t.pendingProps)).flags|=2,Fo(t),t.memoizedState=null,e}function Us(e,t){var n=t.ref
if(null===n)null!==e&&null!==e.ref&&(t.flags|=4194816)
else{if("function"!=typeof n&&"object"!=typeof n)throw Error(a(284))
null!==e&&e.ref===n||(t.flags|=4194816)}}function Gs(e,t,n,r,i){return Ei(t),n=ea(e,t,n,r,void 0,i),r=ia(),null===e||Ds?(ui&&r&&oi(t),t.flags|=1,Ms(e,t,n,i),t.child):(oa(e,t,i),rl(e,t,i))}function Hs(e,t,n,r,i,o){return Ei(t),t.updateQueue=null,n=na(t,r,n,i),ta(e),r=ia(),null===e||Ds?(ui&&r&&oi(t),t.flags|=1,Ms(e,t,n,o),t.child):(oa(e,t,o),rl(e,t,o))}function qs(e,t,n,r,i){if(Ei(t),null===t.stateNode){var o=Or,a=n.contextType
"object"==typeof a&&null!==a&&(o=ki(a)),o=new n(r,o),t.memoizedState=null!==o.state&&void 0!==o.state?o.state:null,o.updater=bs,t.stateNode=o,o._reactInternals=t,(o=t.stateNode).props=r,o.state=t.memoizedState,o.refs={},go(t),a=n.contextType,o.context="object"==typeof a&&null!==a?ki(a):Or,o.state=t.memoizedState,"function"==typeof(a=n.getDerivedStateFromProps)&&(vs(t,n,a,r),o.state=t.memoizedState),"function"==typeof n.getDerivedStateFromProps||"function"==typeof o.getSnapshotBeforeUpdate||"function"!=typeof o.UNSAFE_componentWillMount&&"function"!=typeof o.componentWillMount||(a=o.state,"function"==typeof o.componentWillMount&&o.componentWillMount(),"function"==typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount(),a!==o.state&&bs.enqueueReplaceState(o,o.state,null),wo(t,r,o,i),Co(),o.state=t.memoizedState),"function"==typeof o.componentDidMount&&(t.flags|=4194308),r=!0}else if(null===e){o=t.stateNode
var s=t.memoizedProps,l=_s(n,s)
o.props=l
var c=o.context,u=n.contextType
a=Or,"object"==typeof u&&null!==u&&(a=ki(u))
var d=n.getDerivedStateFromProps
u="function"==typeof d||"function"==typeof o.getSnapshotBeforeUpdate,s=t.pendingProps!==s,u||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(s||c!==a)&&Ss(t,o,r,a),mo=!1
var p=t.memoizedState
o.state=p,wo(t,r,o,i),Co(),c=t.memoizedState,s||p!==c||mo?("function"==typeof d&&(vs(t,n,d,r),c=t.memoizedState),(l=mo||xs(t,n,l,r,p,c,a))?(u||"function"!=typeof o.UNSAFE_componentWillMount&&"function"!=typeof o.componentWillMount||("function"==typeof o.componentWillMount&&o.componentWillMount(),"function"==typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"==typeof o.componentDidMount&&(t.flags|=4194308)):("function"==typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),o.props=r,o.state=c,o.context=a,r=l):("function"==typeof o.componentDidMount&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,yo(e,t),u=_s(n,a=t.memoizedProps),o.props=u,d=t.pendingProps,p=o.context,c=n.contextType,l=Or,"object"==typeof c&&null!==c&&(l=ki(c)),(c="function"==typeof(s=n.getDerivedStateFromProps)||"function"==typeof o.getSnapshotBeforeUpdate)||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(a!==d||p!==l)&&Ss(t,o,r,l),mo=!1,p=t.memoizedState,o.state=p,wo(t,r,o,i),Co()
var h=t.memoizedState
a!==d||p!==h||mo||null!==e&&null!==e.dependencies&&Bi(e.dependencies)?("function"==typeof s&&(vs(t,n,s,r),h=t.memoizedState),(u=mo||xs(t,n,u,r,p,h,l)||null!==e&&null!==e.dependencies&&Bi(e.dependencies))?(c||"function"!=typeof o.UNSAFE_componentWillUpdate&&"function"!=typeof o.componentWillUpdate||("function"==typeof o.componentWillUpdate&&o.componentWillUpdate(r,h,l),"function"==typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,h,l)),"function"==typeof o.componentDidUpdate&&(t.flags|=4),"function"==typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof o.componentDidUpdate||a===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),"function"!=typeof o.getSnapshotBeforeUpdate||a===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=h),o.props=r,o.state=h,o.context=l,r=u):("function"!=typeof o.componentDidUpdate||a===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),"function"!=typeof o.getSnapshotBeforeUpdate||a===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),r=!1)}return o=r,Us(e,t),r=!!(128&t.flags),o||r?(o=t.stateNode,n=r&&"function"!=typeof n.getDerivedStateFromError?null:o.render(),t.flags|=1,null!==e&&r?(t.child=ho(t,e.child,null,i),t.child=ho(t,null,n,i)):Ms(e,t,n,i),t.memoizedState=o.state,e=t.child):e=rl(e,t,i),e}function Qs(e,t,n,r){return vi(),t.flags|=256,Ms(e,t,n,r),t.child}var $s={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null}
function Xs(e){return{baseLanes:e,cachePool:Wi()}}function Ws(e,t,n){return e=null!==e?e.childLanes&~n:0,t&&(e|=Ac),e}function Ys(e,t,n){var r,i=t.pendingProps,o=!1,s=!!(128&t.flags)
if((r=s)||(r=(null===e||null!==e.memoizedState)&&!!(2&zo.current)),r&&(o=!0,t.flags&=-129),r=!!(32&t.flags),t.flags&=-33,null===e){if(ui){if(o?Ro(t):No(),(e=ci)?null!==(e=null!==(e=Bd(e,pi))&&"&"!==e.data?e:null)&&(t.memoizedState={dehydrated:e,treeContext:null!==ei?{id:ti,overflow:ni}:null,retryLane:536870912,hydrationErrors:null},(n=Hr(e)).return=t,t.child=n,li=t,ci=null):e=null,null===e)throw fi(t)
return kd(e)?t.lanes=32:t.lanes=536870912,null}var l=i.children
return i=i.fallback,o?(No(),l=Ks({mode:"hidden",children:l},o=t.mode),i=Ur(i,o,n,null),l.return=t,i.return=t,l.sibling=i,t.child=l,(i=t.child).memoizedState=Xs(n),i.childLanes=Ws(e,r,n),t.memoizedState=$s,Fs(null,i)):(Ro(t),Zs(t,l))}var c=e.memoizedState
if(null!==c&&null!==(l=c.dehydrated)){if(s)256&t.flags?(Ro(t),t.flags&=-257,t=Js(e,t,n)):null!==t.memoizedState?(No(),t.child=e.child,t.flags|=128,t=null):(No(),l=i.fallback,o=t.mode,i=Ks({mode:"visible",children:i.children},o),(l=Ur(l,o,n,null)).flags|=2,i.return=t,l.return=t,i.sibling=l,t.child=i,ho(t,e.child,null,n),(i=t.child).memoizedState=Xs(n),i.childLanes=Ws(e,r,n),t.memoizedState=$s,t=Fs(null,i))
else if(Ro(t),kd(l)){if(r=l.nextSibling&&l.nextSibling.dataset)var u=r.dgst
r=u,(i=Error(a(419))).stack="",i.digest=r,xi({value:i,source:null,stack:null}),t=Js(e,t,n)}else if(Ds||Pi(e,t,n,!1),r=0!==(n&e.childLanes),Ds||r){if(null!==(r=hc)&&0!==(i=Re(r,n))&&i!==c.retryLane)throw c.retryLane=i,Dr(e,i),$c(r,0,i),ks
Ed(l)||ou(),t=Js(e,t,n)}else Ed(l)?(t.flags|=192,t.child=e.child,t=null):(e=c.treeContext,ci=Dd(l.nextSibling),li=t,ui=!0,di=null,pi=!1,null!==e&&si(t,e),(t=Zs(t,i.children)).flags|=4096)
return t}return o?(No(),l=i.fallback,o=t.mode,u=(c=e.child).sibling,(i=zr(c,{mode:"hidden",children:i.children})).subtreeFlags=65011712&c.subtreeFlags,null!==u?l=zr(u,l):(l=Ur(l,o,n,null)).flags|=2,l.return=t,i.return=t,i.sibling=l,t.child=i,Fs(null,i),i=t.child,null===(l=e.child.memoizedState)?l=Xs(n):(null!==(o=l.cachePool)?(c=Ni._currentValue,o=o.parent!==c?{parent:c,pool:c}:o):o=Wi(),l={baseLanes:l.baseLanes|n,cachePool:o}),i.memoizedState=l,i.childLanes=Ws(e,r,n),t.memoizedState=$s,Fs(e.child,i)):(Ro(t),e=(n=e.child).sibling,(n=zr(n,{mode:"visible",children:i.children})).return=t,n.sibling=null,null!==e&&(null===(r=t.deletions)?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n)}function Zs(e,t){return(t=Ks({mode:"visible",children:t},e.mode)).return=e,e.child=t}function Ks(e,t){return(e=Nr(22,e,null,t)).lanes=0,e}function Js(e,t,n){return ho(t,e.child,null,n),(e=Zs(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function el(e,t,n){e.lanes|=t
var r=e.alternate
null!==r&&(r.lanes|=t),Ai(e.return,t,n)}function tl(e,t,n,r,i,o){var a=e.memoizedState
null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i,treeForkCount:o}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=i,a.treeForkCount=o)}function nl(e,t,n){var r=t.pendingProps,i=r.revealOrder,o=r.tail
r=r.children
var a=zo.current,s=!!(2&a)
if(s?(a=1&a|2,t.flags|=128):a&=1,j(zo,a),Ms(e,t,r,n),r=ui?Zr:0,!s&&null!==e&&128&e.flags)e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&el(e,n,t)
else if(19===e.tag)el(e,n,t)
else if(null!==e.child){e.child.return=e,e=e.child
continue}if(e===t)break e
for(;null===e.sibling;){if(null===e.return||e.return===t)break e
e=e.return}e.sibling.return=e.return,e=e.sibling}switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===jo(e)&&(i=n),n=n.sibling
null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),tl(t,!1,i,n,o,r)
break
case"backwards":case"unstable_legacy-backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===jo(e)){t.child=i
break}e=i.sibling,i.sibling=n,n=i,i=e}tl(t,!0,n,null,o,r)
break
case"together":tl(t,!1,null,null,void 0,r)
break
default:t.memoizedState=null}return t.child}function rl(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Cc|=t.lanes,0===(n&t.childLanes)){if(null===e)return null
if(Pi(e,t,n,!1),0===(n&t.childLanes))return null}if(null!==e&&t.child!==e.child)throw Error(a(153))
if(null!==t.child){for(n=zr(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=zr(e,e.pendingProps)).return=t
n.sibling=null}return t.child}function il(e,t){return 0!==(e.lanes&t)||!(null===(e=e.dependencies)||!Bi(e))}function ol(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps)Ds=!0
else{if(!(il(e,n)||128&t.flags))return Ds=!1,function(e,t,n){switch(t.tag){case 3:$(t,t.stateNode.containerInfo),wi(0,Ni,e.memoizedState.cache),vi()
break
case 27:case 5:W(t)
break
case 4:$(t,t.stateNode.containerInfo)
break
case 10:wi(0,t.type,t.memoizedProps.value)
break
case 31:if(null!==t.memoizedState)return t.flags|=128,Oo(t),null
break
case 13:var r=t.memoizedState
if(null!==r)return null!==r.dehydrated?(Ro(t),t.flags|=128,null):0!==(n&t.child.childLanes)?Ys(e,t,n):(Ro(t),null!==(e=rl(e,t,n))?e.sibling:null)
Ro(t)
break
case 19:var i=!!(128&e.flags)
if((r=0!==(n&t.childLanes))||(Pi(e,t,n,!1),r=0!==(n&t.childLanes)),i){if(r)return nl(e,t,n)
t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),j(zo,zo.current),r)break
return null
case 22:return t.lanes=0,Ns(e,t,n,t.pendingProps)
case 24:wi(0,Ni,e.memoizedState.cache)}return rl(e,t,n)}(e,t,n)
Ds=!!(131072&e.flags)}else Ds=!1,ui&&1048576&t.flags&&ii(t,Zr,t.index)
switch(t.lanes=0,t.tag){case 16:e:{var r=t.pendingProps
if(e=no(t.elementType),t.type=e,"function"!=typeof e){if(null!=e){var i=e.$$typeof
if(i===S){t.tag=11,t=Rs(null,t,e,r,n)
break e}if(i===w){t.tag=14,t=Os(null,t,e,r,n)
break e}}throw t=k(e)||e,Error(a(306,t,""))}Fr(e)?(r=_s(e,r),t.tag=1,t=qs(null,t,e,r,n)):(t.tag=0,t=Gs(null,t,e,r,n))}return t
case 0:return Gs(e,t,t.type,t.pendingProps,n)
case 1:return qs(e,t,r=t.type,i=_s(r,t.pendingProps),n)
case 3:e:{if($(t,t.stateNode.containerInfo),null===e)throw Error(a(387))
r=t.pendingProps
var o=t.memoizedState
i=o.element,yo(e,t),wo(t,r,null,n)
var s=t.memoizedState
if(r=s.cache,wi(0,Ni,r),r!==o.cache&&Ii(t,[Ni],n,!0),Co(),r=s.element,o.isDehydrated){if(o={element:r,isDehydrated:!1,cache:s.cache},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Qs(e,t,r,n)
break e}if(r!==i){xi(i=$r(Error(a(424)),t)),t=Qs(e,t,r,n)
break e}for(e=9===(e=t.stateNode.containerInfo).nodeType?e.body:"HTML"===e.nodeName?e.ownerDocument.body:e,ci=Dd(e.firstChild),li=t,ui=!0,di=null,pi=!0,n=fo(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(vi(),r===i){t=rl(e,t,n)
break e}Ms(e,t,r,n)}t=t.child}return t
case 26:return Us(e,t),null===e?(n=Hd(t.type,null,t.pendingProps,null))?t.memoizedState=n:ui||(n=t.type,e=t.pendingProps,(r=md(q.current).createElement(n))[je]=t,r[Ve]=e,dd(r,n,e),Je(r),t.stateNode=r):t.memoizedState=Hd(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null
case 27:return W(t),null===e&&ui&&(r=t.stateNode=Ld(t.type,t.pendingProps,q.current),li=t,pi=!0,i=ci,Td(t.type)?(Md=i,ci=Dd(r.firstChild)):ci=i),Ms(e,t,t.pendingProps.children,n),Us(e,t),null===e&&(t.flags|=4194304),t.child
case 5:return null===e&&ui&&((i=r=ci)&&(null!==(r=function(e,t,n,r){for(;1===e.nodeType;){var i=n
if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!r&&("INPUT"!==e.nodeName||"hidden"!==e.type))break}else if(r){if(!e[$e])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break
return e
case"link":if("stylesheet"===(o=e.getAttribute("rel"))&&e.hasAttribute("data-precedence"))break
if(o!==i.rel||e.getAttribute("href")!==(null==i.href||""===i.href?null:i.href)||e.getAttribute("crossorigin")!==(null==i.crossOrigin?null:i.crossOrigin)||e.getAttribute("title")!==(null==i.title?null:i.title))break
return e
case"style":if(e.hasAttribute("data-precedence"))break
return e
case"script":if(((o=e.getAttribute("src"))!==(null==i.src?null:i.src)||e.getAttribute("type")!==(null==i.type?null:i.type)||e.getAttribute("crossorigin")!==(null==i.crossOrigin?null:i.crossOrigin))&&o&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break
return e
default:return e}}else{if("input"!==t||"hidden"!==e.type)return e
var o=null==i.name?null:""+i.name
if("hidden"===i.type&&e.getAttribute("name")===o)return e}if(null===(e=Dd(e.nextSibling)))break}return null}(r,t.type,t.pendingProps,pi))?(t.stateNode=r,li=t,ci=Dd(r.firstChild),pi=!1,i=!0):i=!1),i||fi(t)),W(t),i=t.type,o=t.pendingProps,s=null!==e?e.memoizedProps:null,r=o.children,vd(i,o)?r=null:null!==s&&vd(i,s)&&(t.flags|=32),null!==t.memoizedState&&(i=ea(e,t,ra,null,null,n),cp._currentValue=i),Us(e,t),Ms(e,t,r,n),t.child
case 6:return null===e&&ui&&((e=n=ci)&&(null!==(n=function(e,t,n){if(""===t)return null
for(;3!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!n)return null
if(null===(e=Dd(e.nextSibling)))return null}return e}(n,t.pendingProps,pi))?(t.stateNode=n,li=t,ci=null,e=!0):e=!1),e||fi(t)),null
case 13:return Ys(e,t,n)
case 4:return $(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=ho(t,null,r,n):Ms(e,t,r,n),t.child
case 11:return Rs(e,t,t.type,t.pendingProps,n)
case 7:return Ms(e,t,t.pendingProps,n),t.child
case 8:case 12:return Ms(e,t,t.pendingProps.children,n),t.child
case 10:return r=t.pendingProps,wi(0,t.type,r.value),Ms(e,t,r.children,n),t.child
case 9:return i=t.type._context,r=t.pendingProps.children,Ei(t),r=r(i=ki(i)),t.flags|=1,Ms(e,t,r,n),t.child
case 14:return Os(e,t,t.type,t.pendingProps,n)
case 15:return Ls(e,t,t.type,t.pendingProps,n)
case 19:return nl(e,t,n)
case 31:return function(e,t,n){var r=t.pendingProps,i=!!(128&t.flags)
if(t.flags&=-129,null===e){if(ui){if("hidden"===r.mode)return e=js(t,r),t.lanes=536870912,Fs(null,e)
if(Oo(t),(e=ci)?null!==(e=null!==(e=Bd(e,pi))&&"&"===e.data?e:null)&&(t.memoizedState={dehydrated:e,treeContext:null!==ei?{id:ti,overflow:ni}:null,retryLane:536870912,hydrationErrors:null},(n=Hr(e)).return=t,t.child=n,li=t,ci=null):e=null,null===e)throw fi(t)
return t.lanes=536870912,null}return js(t,r)}var o=e.memoizedState
if(null!==o){var s=o.dehydrated
if(Oo(t),i)if(256&t.flags)t.flags&=-257,t=Vs(e,t,n)
else{if(null===t.memoizedState)throw Error(a(558))
t.child=e.child,t.flags|=128,t=null}else if(Ds||Pi(e,t,n,!1),i=0!==(n&e.childLanes),Ds||i){if(null!==(r=hc)&&0!==(s=Re(r,n))&&s!==o.retryLane)throw o.retryLane=s,Dr(e,s),$c(r,0,s),ks
ou(),t=Vs(e,t,n)}else e=o.treeContext,ci=Dd(s.nextSibling),li=t,ui=!0,di=null,pi=!1,null!==e&&si(t,e),(t=js(t,r)).flags|=4096
return t}return(e=zr(e.child,{mode:r.mode,children:r.children})).ref=t.ref,t.child=e,e.return=t,e}(e,t,n)
case 22:return Ns(e,t,n,t.pendingProps)
case 24:return Ei(t),r=ki(Ni),null===e?(null===(i=$i())&&(i=hc,o=Fi(),i.pooledCache=o,o.refCount++,null!==o&&(i.pooledCacheLanes|=n),i=o),t.memoizedState={parent:r,cache:i},go(t),wi(0,Ni,i)):(0!==(e.lanes&n)&&(yo(e,t),wo(t,null,null,n),Co()),i=e.memoizedState,o=t.memoizedState,i.parent!==r?(i={parent:r,cache:r},t.memoizedState=i,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=i),wi(0,Ni,r)):(r=o.cache,wi(0,Ni,r),r!==i.cache&&Ii(t,[Ni],n,!0))),Ms(e,t,t.pendingProps.children,n),t.child
case 29:throw t.pendingProps}throw Error(a(156,t.tag))}function al(e){e.flags|=4}function sl(e,t,n,r,i){if((t=!!(32&e.mode))&&(t=!1),t){if(e.flags|=16777216,(335544128&i)===i)if(e.stateNode.complete)e.flags|=8192
else{if(!nu())throw ro=Ji,Zi
e.flags|=8192}}else e.flags&=-16777217}function ll(e,t){if("stylesheet"!==t.type||4&t.state.loading)e.flags&=-16777217
else if(e.flags|=16777216,!rp(t)){if(!nu())throw ro=Ji,Zi
e.flags|=8192}}function cl(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?Be():536870912,e.lanes|=t,Ic|=t)}function ul(e,t){if(!ui)switch(e.tailMode){case"hidden":t=e.tail
for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling
null===n?e.tail=null:n.sibling=null
break
case"collapsed":n=e.tail
for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling
null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function dl(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0
if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=65011712&i.subtreeFlags,r|=65011712&i.flags,i.return=e,i=i.sibling
else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling
return e.subtreeFlags|=r,e.childLanes=n,t}function pl(e,t,n){var r=t.pendingProps
switch(ai(t),t.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return dl(t),null
case 3:return n=t.stateNode,r=null,null!==e&&(r=e.memoizedState.cache),t.memoizedState.cache!==r&&(t.flags|=2048),Ti(Ni),X(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(yi(t)?al(t):null===e||e.memoizedState.isDehydrated&&!(256&t.flags)||(t.flags|=1024,bi())),dl(t),null
case 26:var i=t.type,o=t.memoizedState
return null===e?(al(t),null!==o?(dl(t),ll(t,o)):(dl(t),sl(t,i,0,0,n))):o?o!==e.memoizedState?(al(t),dl(t),ll(t,o)):(dl(t),t.flags&=-16777217):((e=e.memoizedProps)!==r&&al(t),dl(t),sl(t,i,0,0,n)),null
case 27:if(Y(t),n=q.current,i=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==r&&al(t)
else{if(!r){if(null===t.stateNode)throw Error(a(166))
return dl(t),null}e=G.current,yi(t)?mi(t):(e=Ld(i,r,n),t.stateNode=e,al(t))}return dl(t),null
case 5:if(Y(t),i=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==r&&al(t)
else{if(!r){if(null===t.stateNode)throw Error(a(166))
return dl(t),null}if(o=G.current,yi(t))mi(t)
else{var s=md(q.current)
switch(o){case 1:o=s.createElementNS("http://www.w3.org/2000/svg",i)
break
case 2:o=s.createElementNS("http://www.w3.org/1998/Math/MathML",i)
break
default:switch(i){case"svg":o=s.createElementNS("http://www.w3.org/2000/svg",i)
break
case"math":o=s.createElementNS("http://www.w3.org/1998/Math/MathML",i)
break
case"script":(o=s.createElement("div")).innerHTML="<script><\/script>",o=o.removeChild(o.firstChild)
break
case"select":o="string"==typeof r.is?s.createElement("select",{is:r.is}):s.createElement("select"),r.multiple?o.multiple=!0:r.size&&(o.size=r.size)
break
default:o="string"==typeof r.is?s.createElement(i,{is:r.is}):s.createElement(i)}}o[je]=t,o[Ve]=r
e:for(s=t.child;null!==s;){if(5===s.tag||6===s.tag)o.appendChild(s.stateNode)
else if(4!==s.tag&&27!==s.tag&&null!==s.child){s.child.return=s,s=s.child
continue}if(s===t)break e
for(;null===s.sibling;){if(null===s.return||s.return===t)break e
s=s.return}s.sibling.return=s.return,s=s.sibling}t.stateNode=o
e:switch(dd(o,i,r),i){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus
break e
case"img":r=!0
break e
default:r=!1}r&&al(t)}}return dl(t),sl(t,t.type,null===e||e.memoizedProps,t.pendingProps,n),null
case 6:if(e&&null!=t.stateNode)e.memoizedProps!==r&&al(t)
else{if("string"!=typeof r&&null===t.stateNode)throw Error(a(166))
if(e=q.current,yi(t)){if(e=t.stateNode,n=t.memoizedProps,r=null,null!==(i=li))switch(i.tag){case 27:case 5:r=i.memoizedProps}e[je]=t,(e=!!(e.nodeValue===n||null!==r&&!0===r.suppressHydrationWarning||ld(e.nodeValue,n)))||fi(t,!0)}else(e=md(e).createTextNode(r))[je]=t,t.stateNode=e}return dl(t),null
case 31:if(n=t.memoizedState,null===e||null!==e.memoizedState){if(r=yi(t),null!==n){if(null===e){if(!r)throw Error(a(318))
if(!(e=null!==(e=t.memoizedState)?e.dehydrated:null))throw Error(a(557))
e[je]=t}else vi(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4
dl(t),e=!1}else n=bi(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=n),e=!0
if(!e)return 256&t.flags?(Fo(t),t):(Fo(t),null)
if(128&t.flags)throw Error(a(558))}return dl(t),null
case 13:if(r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(i=yi(t),null!==r&&null!==r.dehydrated){if(null===e){if(!i)throw Error(a(318))
if(!(i=null!==(i=t.memoizedState)?i.dehydrated:null))throw Error(a(317))
i[je]=t}else vi(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4
dl(t),i=!1}else i=bi(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=i),i=!0
if(!i)return 256&t.flags?(Fo(t),t):(Fo(t),null)}return Fo(t),128&t.flags?(t.lanes=n,t):(n=null!==r,e=null!==e&&null!==e.memoizedState,n&&(i=null,null!==(r=t.child).alternate&&null!==r.alternate.memoizedState&&null!==r.alternate.memoizedState.cachePool&&(i=r.alternate.memoizedState.cachePool.pool),o=null,null!==r.memoizedState&&null!==r.memoizedState.cachePool&&(o=r.memoizedState.cachePool.pool),o!==i&&(r.flags|=2048)),n!==e&&n&&(t.child.flags|=8192),cl(t,t.updateQueue),dl(t),null)
case 4:return X(),null===e&&Ku(t.stateNode.containerInfo),dl(t),null
case 10:return Ti(t.type),dl(t),null
case 19:if(z(zo),null===(r=t.memoizedState))return dl(t),null
if(i=!!(128&t.flags),null===(o=r.rendering))if(i)ul(r,!1)
else{if(0!==_c||null!==e&&128&e.flags)for(e=t.child;null!==e;){if(null!==(o=jo(e))){for(t.flags|=128,ul(r,!1),e=o.updateQueue,t.updateQueue=e,cl(t,e),t.subtreeFlags=0,e=n,n=t.child;null!==n;)jr(n,e),n=n.sibling
return j(zo,1&zo.current|2),ui&&ri(t,r.treeForkCount),t.child}e=e.sibling}null!==r.tail&&se()>Mc&&(t.flags|=128,i=!0,ul(r,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=jo(o))){if(t.flags|=128,i=!0,e=e.updateQueue,t.updateQueue=e,cl(t,e),ul(r,!0),null===r.tail&&"hidden"===r.tailMode&&!o.alternate&&!ui)return dl(t),null}else 2*se()-r.renderingStartTime>Mc&&536870912!==n&&(t.flags|=128,i=!0,ul(r,!1),t.lanes=4194304)
r.isBackwards?(o.sibling=t.child,t.child=o):(null!==(e=r.last)?e.sibling=o:t.child=o,r.last=o)}return null!==r.tail?(e=r.tail,r.rendering=e,r.tail=e.sibling,r.renderingStartTime=se(),e.sibling=null,n=zo.current,j(zo,i?1&n|2:1&n),ui&&ri(t,r.treeForkCount),e):(dl(t),null)
case 22:case 23:return Fo(t),ko(),r=null!==t.memoizedState,null!==e?null!==e.memoizedState!==r&&(t.flags|=8192):r&&(t.flags|=8192),r?!!(536870912&n)&&!(128&t.flags)&&(dl(t),6&t.subtreeFlags&&(t.flags|=8192)):dl(t),null!==(n=t.updateQueue)&&cl(t,n.retryQueue),n=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),r=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(r=t.memoizedState.cachePool.pool),r!==n&&(t.flags|=2048),null!==e&&z(Qi),null
case 24:return n=null,null!==e&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),Ti(Ni),dl(t),null
case 25:case 30:return null}throw Error(a(156,t.tag))}function hl(e,t){switch(ai(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null
case 3:return Ti(Ni),X(),65536&(e=t.flags)&&!(128&e)?(t.flags=-65537&e|128,t):null
case 26:case 27:case 5:return Y(t),null
case 31:if(null!==t.memoizedState){if(Fo(t),null===t.alternate)throw Error(a(340))
vi()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null
case 13:if(Fo(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340))
vi()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null
case 19:return z(zo),null
case 4:return X(),null
case 10:return Ti(t.type),null
case 22:case 23:return Fo(t),ko(),null!==e&&z(Qi),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null
case 24:return Ti(Ni),null
default:return null}}function fl(e,t){switch(ai(t),t.tag){case 3:Ti(Ni),X()
break
case 26:case 27:case 5:Y(t)
break
case 4:X()
break
case 31:null!==t.memoizedState&&Fo(t)
break
case 13:Fo(t)
break
case 19:z(zo)
break
case 10:Ti(t.type)
break
case 22:case 23:Fo(t),ko(),null!==e&&z(Qi)
break
case 24:Ti(Ni)}}function ml(e,t){try{var n=t.updateQueue,r=null!==n?n.lastEffect:null
if(null!==r){var i=r.next
n=i
do{if((n.tag&e)===e){r=void 0
var o=n.create,a=n.inst
r=o(),a.destroy=r}n=n.next}while(n!==i)}}catch(e){_u(t,t.return,e)}}function gl(e,t,n){try{var r=t.updateQueue,i=null!==r?r.lastEffect:null
if(null!==i){var o=i.next
r=o
do{if((r.tag&e)===e){var a=r.inst,s=a.destroy
if(void 0!==s){a.destroy=void 0,i=t
var l=n,c=s
try{c()}catch(e){_u(i,l,e)}}}r=r.next}while(r!==o)}}catch(e){_u(t,t.return,e)}}function yl(e){var t=e.updateQueue
if(null!==t){var n=e.stateNode
try{Ao(t,n)}catch(t){_u(e,e.return,t)}}}function vl(e,t,n){n.props=_s(e.type,e.memoizedProps),n.state=e.memoizedState
try{n.componentWillUnmount()}catch(n){_u(e,t,n)}}function bl(e,t){try{var n=e.ref
if(null!==n){switch(e.tag){case 26:case 27:case 5:var r=e.stateNode
break
default:r=e.stateNode}"function"==typeof n?e.refCleanup=n(r):n.current=r}}catch(n){_u(e,t,n)}}function xl(e,t){var n=e.ref,r=e.refCleanup
if(null!==n)if("function"==typeof r)try{r()}catch(n){_u(e,t,n)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"==typeof n)try{n(null)}catch(n){_u(e,t,n)}else n.current=null}function Sl(e){var t=e.type,n=e.memoizedProps,r=e.stateNode
try{e:switch(t){case"button":case"input":case"select":case"textarea":n.autoFocus&&r.focus()
break e
case"img":n.src?r.src=n.src:n.srcSet&&(r.srcset=n.srcSet)}}catch(t){_u(e,e.return,t)}}function _l(e,t,n){try{var r=e.stateNode
!function(e,t,n,r){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break
case"input":var i=null,o=null,s=null,l=null,c=null,u=null,d=null
for(f in n){var p=n[f]
if(n.hasOwnProperty(f)&&null!=p)switch(f){case"checked":case"value":break
case"defaultValue":c=p
default:r.hasOwnProperty(f)||cd(e,t,f,null,r,p)}}for(var h in r){var f=r[h]
if(p=n[h],r.hasOwnProperty(h)&&(null!=f||null!=p))switch(h){case"type":o=f
break
case"name":i=f
break
case"checked":u=f
break
case"defaultChecked":d=f
break
case"value":s=f
break
case"defaultValue":l=f
break
case"children":case"dangerouslySetInnerHTML":if(null!=f)throw Error(a(137,t))
break
default:f!==p&&cd(e,t,h,f,r,p)}}return void yt(e,s,l,c,u,d,o,i)
case"select":for(o in f=s=l=h=null,n)if(c=n[o],n.hasOwnProperty(o)&&null!=c)switch(o){case"value":break
case"multiple":f=c
default:r.hasOwnProperty(o)||cd(e,t,o,null,r,c)}for(i in r)if(o=r[i],c=n[i],r.hasOwnProperty(i)&&(null!=o||null!=c))switch(i){case"value":h=o
break
case"defaultValue":l=o
break
case"multiple":s=o
default:o!==c&&cd(e,t,i,o,r,c)}return t=l,n=s,r=f,void(null!=h?xt(e,!!n,h,!1):!!r!=!!n&&(null!=t?xt(e,!!n,t,!0):xt(e,!!n,n?[]:"",!1)))
case"textarea":for(l in f=h=null,n)if(i=n[l],n.hasOwnProperty(l)&&null!=i&&!r.hasOwnProperty(l))switch(l){case"value":case"children":break
default:cd(e,t,l,null,r,i)}for(s in r)if(i=r[s],o=n[s],r.hasOwnProperty(s)&&(null!=i||null!=o))switch(s){case"value":h=i
break
case"defaultValue":f=i
break
case"children":break
case"dangerouslySetInnerHTML":if(null!=i)throw Error(a(91))
break
default:i!==o&&cd(e,t,s,i,r,o)}return void St(e,h,f)
case"option":for(var m in n)h=n[m],n.hasOwnProperty(m)&&null!=h&&!r.hasOwnProperty(m)&&("selected"===m?e.selected=!1:cd(e,t,m,null,r,h))
for(c in r)h=r[c],f=n[c],!r.hasOwnProperty(c)||h===f||null==h&&null==f||("selected"===c?e.selected=h&&"function"!=typeof h&&"symbol"!=typeof h:cd(e,t,c,h,r,f))
return
case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var g in n)h=n[g],n.hasOwnProperty(g)&&null!=h&&!r.hasOwnProperty(g)&&cd(e,t,g,null,r,h)
for(u in r)if(h=r[u],f=n[u],r.hasOwnProperty(u)&&h!==f&&(null!=h||null!=f))switch(u){case"children":case"dangerouslySetInnerHTML":if(null!=h)throw Error(a(137,t))
break
default:cd(e,t,u,h,r,f)}return
default:if(It(t)){for(var y in n)h=n[y],n.hasOwnProperty(y)&&void 0!==h&&!r.hasOwnProperty(y)&&ud(e,t,y,void 0,r,h)
for(d in r)h=r[d],f=n[d],!r.hasOwnProperty(d)||h===f||void 0===h&&void 0===f||ud(e,t,d,h,r,f)
return}}for(var v in n)h=n[v],n.hasOwnProperty(v)&&null!=h&&!r.hasOwnProperty(v)&&cd(e,t,v,null,r,h)
for(p in r)h=r[p],f=n[p],!r.hasOwnProperty(p)||h===f||null==h&&null==f||cd(e,t,p,h,r,f)}(r,e.type,n,t),r[Ve]=t}catch(t){_u(e,e.return,t)}}function Cl(e){return 5===e.tag||3===e.tag||26===e.tag||27===e.tag&&Td(e.type)||4===e.tag}function wl(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||Cl(e.return))return null
e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(27===e.tag&&Td(e.type))continue e
if(2&e.flags)continue e
if(null===e.child||4===e.tag)continue e
e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function Tl(e,t,n){var r=e.tag
if(5===r||6===r)e=e.stateNode,t?(9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).insertBefore(e,t):((t=9===n.nodeType?n.body:"HTML"===n.nodeName?n.ownerDocument.body:n).appendChild(e),null!=(n=n._reactRootContainer)||null!==t.onclick||(t.onclick=kt))
else if(4!==r&&(27===r&&Td(e.type)&&(n=e.stateNode,t=null),null!==(e=e.child)))for(Tl(e,t,n),e=e.sibling;null!==e;)Tl(e,t,n),e=e.sibling}function Al(e,t,n){var r=e.tag
if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e)
else if(4!==r&&(27===r&&Td(e.type)&&(n=e.stateNode),null!==(e=e.child)))for(Al(e,t,n),e=e.sibling;null!==e;)Al(e,t,n),e=e.sibling}function Il(e){var t=e.stateNode,n=e.memoizedProps
try{for(var r=e.type,i=t.attributes;i.length;)t.removeAttributeNode(i[0])
dd(t,r,n),t[je]=e,t[Ve]=n}catch(t){_u(e,e.return,t)}}var Pl=!1,Bl=!1,El=!1,kl="function"==typeof WeakSet?WeakSet:Set,Dl=null
function Ml(e,t,n){var r=n.flags
switch(n.tag){case 0:case 11:case 15:$l(e,n),4&r&&ml(5,n)
break
case 1:if($l(e,n),4&r)if(e=n.stateNode,null===t)try{e.componentDidMount()}catch(e){_u(n,n.return,e)}else{var i=_s(n.type,t.memoizedProps)
t=t.memoizedState
try{e.componentDidUpdate(i,t,e.__reactInternalSnapshotBeforeUpdate)}catch(e){_u(n,n.return,e)}}64&r&&yl(n),512&r&&bl(n,n.return)
break
case 3:if($l(e,n),64&r&&null!==(e=n.updateQueue)){if(t=null,null!==n.child)switch(n.child.tag){case 27:case 5:case 1:t=n.child.stateNode}try{Ao(e,t)}catch(e){_u(n,n.return,e)}}break
case 27:null===t&&4&r&&Il(n)
case 26:case 5:$l(e,n),null===t&&4&r&&Sl(n),512&r&&bl(n,n.return)
break
case 12:$l(e,n)
break
case 31:$l(e,n),4&r&&zl(e,n)
break
case 13:$l(e,n),4&r&&jl(e,n),64&r&&null!==(e=n.memoizedState)&&null!==(e=e.dehydrated)&&function(e,t){var n=e.ownerDocument
if("$~"===e.data)e._reactRetry=t
else if("$?"!==e.data||"loading"!==n.readyState)t()
else{var r=function(){t(),n.removeEventListener("DOMContentLoaded",r)}
n.addEventListener("DOMContentLoaded",r),e._reactRetry=r}}(e,n=Au.bind(null,n))
break
case 22:if(!(r=null!==n.memoizedState||Pl)){t=null!==t&&null!==t.memoizedState||Bl,i=Pl
var o=Bl
Pl=r,(Bl=t)&&!o?Wl(e,n,!!(8772&n.subtreeFlags)):$l(e,n),Pl=i,Bl=o}break
case 30:break
default:$l(e,n)}}function Rl(e){var t=e.alternate
null!==t&&(e.alternate=null,Rl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&null!==(t=e.stateNode)&&Xe(t),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Ol=null,Ll=!1
function Nl(e,t,n){for(n=n.child;null!==n;)Fl(e,t,n),n=n.sibling}function Fl(e,t,n){if(ye&&"function"==typeof ye.onCommitFiberUnmount)try{ye.onCommitFiberUnmount(ge,n)}catch(e){}switch(n.tag){case 26:Bl||xl(n,t),Nl(e,t,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode).parentNode.removeChild(n)
break
case 27:Bl||xl(n,t)
var r=Ol,i=Ll
Td(n.type)&&(Ol=n.stateNode,Ll=!1),Nl(e,t,n),Nd(n.stateNode),Ol=r,Ll=i
break
case 5:Bl||xl(n,t)
case 6:if(r=Ol,i=Ll,Ol=null,Nl(e,t,n),Ll=i,null!==(Ol=r))if(Ll)try{(9===Ol.nodeType?Ol.body:"HTML"===Ol.nodeName?Ol.ownerDocument.body:Ol).removeChild(n.stateNode)}catch(e){_u(n,t,e)}else try{Ol.removeChild(n.stateNode)}catch(e){_u(n,t,e)}break
case 18:null!==Ol&&(Ll?(Ad(9===(e=Ol).nodeType?e.body:"HTML"===e.nodeName?e.ownerDocument.body:e,n.stateNode),Vp(e)):Ad(Ol,n.stateNode))
break
case 4:r=Ol,i=Ll,Ol=n.stateNode.containerInfo,Ll=!0,Nl(e,t,n),Ol=r,Ll=i
break
case 0:case 11:case 14:case 15:gl(2,n,t),Bl||gl(4,n,t),Nl(e,t,n)
break
case 1:Bl||(xl(n,t),"function"==typeof(r=n.stateNode).componentWillUnmount&&vl(n,t,r)),Nl(e,t,n)
break
case 21:Nl(e,t,n)
break
case 22:Bl=(r=Bl)||null!==n.memoizedState,Nl(e,t,n),Bl=r
break
default:Nl(e,t,n)}}function zl(e,t){if(null===t.memoizedState&&null!==(e=t.alternate)&&null!==(e=e.memoizedState)){e=e.dehydrated
try{Vp(e)}catch(e){_u(t,t.return,e)}}}function jl(e,t){if(null===t.memoizedState&&null!==(e=t.alternate)&&null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))try{Vp(e)}catch(e){_u(t,t.return,e)}}function Vl(e,t){var n=function(e){switch(e.tag){case 31:case 13:case 19:var t=e.stateNode
return null===t&&(t=e.stateNode=new kl),t
case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new kl),t
default:throw Error(a(435,e.tag))}}(e)
t.forEach(function(t){if(!n.has(t)){n.add(t)
var r=Iu.bind(null,e,t)
t.then(r,r)}})}function Ul(e,t){var n=t.deletions
if(null!==n)for(var r=0;r<n.length;r++){var i=n[r],o=e,s=t,l=s
e:for(;null!==l;){switch(l.tag){case 27:if(Td(l.type)){Ol=l.stateNode,Ll=!1
break e}break
case 5:Ol=l.stateNode,Ll=!1
break e
case 3:case 4:Ol=l.stateNode.containerInfo,Ll=!0
break e}l=l.return}if(null===Ol)throw Error(a(160))
Fl(o,s,i),Ol=null,Ll=!1,null!==(o=i.alternate)&&(o.return=null),i.return=null}if(13886&t.subtreeFlags)for(t=t.child;null!==t;)Hl(t,e),t=t.sibling}var Gl=null
function Hl(e,t){var n=e.alternate,r=e.flags
switch(e.tag){case 0:case 11:case 14:case 15:Ul(t,e),ql(e),4&r&&(gl(3,e,e.return),ml(3,e),gl(5,e,e.return))
break
case 1:Ul(t,e),ql(e),512&r&&(Bl||null===n||xl(n,n.return)),64&r&&Pl&&null!==(e=e.updateQueue)&&null!==(r=e.callbacks)&&(n=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===n?r:n.concat(r))
break
case 26:var i=Gl
if(Ul(t,e),ql(e),512&r&&(Bl||null===n||xl(n,n.return)),4&r){var o=null!==n?n.memoizedState:null
if(r=e.memoizedState,null===n)if(null===r)if(null===e.stateNode){e:{r=e.type,n=e.memoizedProps,i=i.ownerDocument||i
t:switch(r){case"title":(!(o=i.getElementsByTagName("title")[0])||o[$e]||o[je]||"http://www.w3.org/2000/svg"===o.namespaceURI||o.hasAttribute("itemprop"))&&(o=i.createElement(r),i.head.insertBefore(o,i.querySelector("head > title"))),dd(o,r,n),o[je]=e,Je(o),r=o
break e
case"link":var s=tp("link","href",i).get(r+(n.href||""))
if(s)for(var l=0;l<s.length;l++)if((o=s[l]).getAttribute("href")===(null==n.href||""===n.href?null:n.href)&&o.getAttribute("rel")===(null==n.rel?null:n.rel)&&o.getAttribute("title")===(null==n.title?null:n.title)&&o.getAttribute("crossorigin")===(null==n.crossOrigin?null:n.crossOrigin)){s.splice(l,1)
break t}dd(o=i.createElement(r),r,n),i.head.appendChild(o)
break
case"meta":if(s=tp("meta","content",i).get(r+(n.content||"")))for(l=0;l<s.length;l++)if((o=s[l]).getAttribute("content")===(null==n.content?null:""+n.content)&&o.getAttribute("name")===(null==n.name?null:n.name)&&o.getAttribute("property")===(null==n.property?null:n.property)&&o.getAttribute("http-equiv")===(null==n.httpEquiv?null:n.httpEquiv)&&o.getAttribute("charset")===(null==n.charSet?null:n.charSet)){s.splice(l,1)
break t}dd(o=i.createElement(r),r,n),i.head.appendChild(o)
break
default:throw Error(a(468,r))}o[je]=e,Je(o),r=o}e.stateNode=r}else np(i,e.type,e.stateNode)
else e.stateNode=Yd(i,r,e.memoizedProps)
else o!==r?(null===o?null!==n.stateNode&&(n=n.stateNode).parentNode.removeChild(n):o.count--,null===r?np(i,e.type,e.stateNode):Yd(i,r,e.memoizedProps)):null===r&&null!==e.stateNode&&_l(e,e.memoizedProps,n.memoizedProps)}break
case 27:Ul(t,e),ql(e),512&r&&(Bl||null===n||xl(n,n.return)),null!==n&&4&r&&_l(e,e.memoizedProps,n.memoizedProps)
break
case 5:if(Ul(t,e),ql(e),512&r&&(Bl||null===n||xl(n,n.return)),32&e.flags){i=e.stateNode
try{Ct(i,"")}catch(t){_u(e,e.return,t)}}4&r&&null!=e.stateNode&&_l(e,i=e.memoizedProps,null!==n?n.memoizedProps:i),1024&r&&(El=!0)
break
case 6:if(Ul(t,e),ql(e),4&r){if(null===e.stateNode)throw Error(a(162))
r=e.memoizedProps,n=e.stateNode
try{n.nodeValue=r}catch(t){_u(e,e.return,t)}}break
case 3:if(ep=null,i=Gl,Gl=jd(t.containerInfo),Ul(t,e),Gl=i,ql(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Vp(t.containerInfo)}catch(t){_u(e,e.return,t)}El&&(El=!1,Ql(e))
break
case 4:r=Gl,Gl=jd(e.stateNode.containerInfo),Ul(t,e),ql(e),Gl=r
break
case 12:default:Ul(t,e),ql(e)
break
case 31:case 19:Ul(t,e),ql(e),4&r&&null!==(r=e.updateQueue)&&(e.updateQueue=null,Vl(e,r))
break
case 13:Ul(t,e),ql(e),8192&e.child.flags&&null!==e.memoizedState!=(null!==n&&null!==n.memoizedState)&&(kc=se()),4&r&&null!==(r=e.updateQueue)&&(e.updateQueue=null,Vl(e,r))
break
case 22:i=null!==e.memoizedState
var c=null!==n&&null!==n.memoizedState,u=Pl,d=Bl
if(Pl=u||i,Bl=d||c,Ul(t,e),Bl=d,Pl=u,ql(e),8192&r)e:for(t=e.stateNode,t._visibility=i?-2&t._visibility:1|t._visibility,i&&(null===n||c||Pl||Bl||Xl(e)),n=null,t=e;;){if(5===t.tag||26===t.tag){if(null===n){c=n=t
try{if(o=c.stateNode,i)"function"==typeof(s=o.style).setProperty?s.setProperty("display","none","important"):s.display="none"
else{l=c.stateNode
var p=c.memoizedProps.style,h=null!=p&&p.hasOwnProperty("display")?p.display:null
l.style.display=null==h||"boolean"==typeof h?"":(""+h).trim()}}catch(e){_u(c,c.return,e)}}}else if(6===t.tag){if(null===n){c=t
try{c.stateNode.nodeValue=i?"":c.memoizedProps}catch(e){_u(c,c.return,e)}}}else if(18===t.tag){if(null===n){c=t
try{var f=c.stateNode
i?Id(f,!0):Id(c.stateNode,!1)}catch(e){_u(c,c.return,e)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child
continue}if(t===e)break e
for(;null===t.sibling;){if(null===t.return||t.return===e)break e
n===t&&(n=null),t=t.return}n===t&&(n=null),t.sibling.return=t.return,t=t.sibling}4&r&&null!==(r=e.updateQueue)&&null!==(n=r.retryQueue)&&(r.retryQueue=null,Vl(e,n))
case 30:case 21:}}function ql(e){var t=e.flags
if(2&t){try{for(var n,r=e.return;null!==r;){if(Cl(r)){n=r
break}r=r.return}if(null==n)throw Error(a(160))
switch(n.tag){case 27:var i=n.stateNode
Al(e,wl(e),i)
break
case 5:var o=n.stateNode
32&n.flags&&(Ct(o,""),n.flags&=-33),Al(e,wl(e),o)
break
case 3:case 4:var s=n.stateNode.containerInfo
Tl(e,wl(e),s)
break
default:throw Error(a(161))}}catch(t){_u(e,e.return,t)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Ql(e){if(1024&e.subtreeFlags)for(e=e.child;null!==e;){var t=e
Ql(t),5===t.tag&&1024&t.flags&&t.stateNode.reset(),e=e.sibling}}function $l(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)Ml(e,t.alternate,t),t=t.sibling}function Xl(e){for(e=e.child;null!==e;){var t=e
switch(t.tag){case 0:case 11:case 14:case 15:gl(4,t,t.return),Xl(t)
break
case 1:xl(t,t.return)
var n=t.stateNode
"function"==typeof n.componentWillUnmount&&vl(t,t.return,n),Xl(t)
break
case 27:Nd(t.stateNode)
case 26:case 5:xl(t,t.return),Xl(t)
break
case 22:null===t.memoizedState&&Xl(t)
break
default:Xl(t)}e=e.sibling}}function Wl(e,t,n){for(n=n&&!!(8772&t.subtreeFlags),t=t.child;null!==t;){var r=t.alternate,i=e,o=t,a=o.flags
switch(o.tag){case 0:case 11:case 15:Wl(i,o,n),ml(4,o)
break
case 1:if(Wl(i,o,n),"function"==typeof(i=(r=o).stateNode).componentDidMount)try{i.componentDidMount()}catch(e){_u(r,r.return,e)}if(null!==(i=(r=o).updateQueue)){var s=r.stateNode
try{var l=i.shared.hiddenCallbacks
if(null!==l)for(i.shared.hiddenCallbacks=null,i=0;i<l.length;i++)To(l[i],s)}catch(e){_u(r,r.return,e)}}n&&64&a&&yl(o),bl(o,o.return)
break
case 27:Il(o)
case 26:case 5:Wl(i,o,n),n&&null===r&&4&a&&Sl(o),bl(o,o.return)
break
case 12:Wl(i,o,n)
break
case 31:Wl(i,o,n),n&&4&a&&zl(i,o)
break
case 13:Wl(i,o,n),n&&4&a&&jl(i,o)
break
case 22:null===o.memoizedState&&Wl(i,o,n),bl(o,o.return)
break
case 30:break
default:Wl(i,o,n)}t=t.sibling}}function Yl(e,t){var n=null
null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==n&&(null!=e&&e.refCount++,null!=n&&zi(n))}function Zl(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&zi(e))}function Kl(e,t,n,r){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)Jl(e,t,n,r),t=t.sibling}function Jl(e,t,n,r){var i=t.flags
switch(t.tag){case 0:case 11:case 15:Kl(e,t,n,r),2048&i&&ml(9,t)
break
case 1:case 31:case 13:default:Kl(e,t,n,r)
break
case 3:Kl(e,t,n,r),2048&i&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&zi(e)))
break
case 12:if(2048&i){Kl(e,t,n,r),e=t.stateNode
try{var o=t.memoizedProps,a=o.id,s=o.onPostCommit
"function"==typeof s&&s(a,null===t.alternate?"mount":"update",e.passiveEffectDuration,-0)}catch(e){_u(t,t.return,e)}}else Kl(e,t,n,r)
break
case 23:break
case 22:o=t.stateNode,a=t.alternate,null!==t.memoizedState?2&o._visibility?Kl(e,t,n,r):tc(e,t):2&o._visibility?Kl(e,t,n,r):(o._visibility|=2,ec(e,t,n,r,!!(10256&t.subtreeFlags)||!1)),2048&i&&Yl(a,t)
break
case 24:Kl(e,t,n,r),2048&i&&Zl(t.alternate,t)}}function ec(e,t,n,r,i){for(i=i&&(!!(10256&t.subtreeFlags)||!1),t=t.child;null!==t;){var o=e,a=t,s=n,l=r,c=a.flags
switch(a.tag){case 0:case 11:case 15:ec(o,a,s,l,i),ml(8,a)
break
case 23:break
case 22:var u=a.stateNode
null!==a.memoizedState?2&u._visibility?ec(o,a,s,l,i):tc(o,a):(u._visibility|=2,ec(o,a,s,l,i)),i&&2048&c&&Yl(a.alternate,a)
break
case 24:ec(o,a,s,l,i),i&&2048&c&&Zl(a.alternate,a)
break
default:ec(o,a,s,l,i)}t=t.sibling}}function tc(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var n=e,r=t,i=r.flags
switch(r.tag){case 22:tc(n,r),2048&i&&Yl(r.alternate,r)
break
case 24:tc(n,r),2048&i&&Zl(r.alternate,r)
break
default:tc(n,r)}t=t.sibling}}var nc=8192
function rc(e,t,n){if(e.subtreeFlags&nc)for(e=e.child;null!==e;)ic(e,t,n),e=e.sibling}function ic(e,t,n){switch(e.tag){case 26:rc(e,t,n),e.flags&nc&&null!==e.memoizedState&&function(e,t,n,r){if(!("stylesheet"!==n.type||"string"==typeof r.media&&!1===matchMedia(r.media).matches||4&n.state.loading)){if(null===n.instance){var i=qd(r.href),o=t.querySelector(Qd(i))
if(o)return null!==(t=o._p)&&"object"==typeof t&&"function"==typeof t.then&&(e.count++,e=op.bind(e),t.then(e,e)),n.state.loading|=4,n.instance=o,void Je(o)
o=t.ownerDocument||t,r=$d(r),(i=Fd.get(i))&&Kd(r,i),Je(o=o.createElement("link"))
var a=o
a._p=new Promise(function(e,t){a.onload=e,a.onerror=t}),dd(o,"link",r),n.instance=o}null===e.stylesheets&&(e.stylesheets=new Map),e.stylesheets.set(n,t),(t=n.state.preload)&&!(3&n.state.loading)&&(e.count++,n=op.bind(e),t.addEventListener("load",n),t.addEventListener("error",n))}}(n,Gl,e.memoizedState,e.memoizedProps)
break
case 5:default:rc(e,t,n)
break
case 3:case 4:var r=Gl
Gl=jd(e.stateNode.containerInfo),rc(e,t,n),Gl=r
break
case 22:null===e.memoizedState&&(null!==(r=e.alternate)&&null!==r.memoizedState?(r=nc,nc=16777216,rc(e,t,n),nc=r):rc(e,t,n))}}function oc(e){var t=e.alternate
if(null!==t&&null!==(e=t.child)){t.child=null
do{t=e.sibling,e.sibling=null,e=t}while(null!==e)}}function ac(e){var t=e.deletions
if(16&e.flags){if(null!==t)for(var n=0;n<t.length;n++){var r=t[n]
Dl=r,cc(r,e)}oc(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)sc(e),e=e.sibling}function sc(e){switch(e.tag){case 0:case 11:case 15:ac(e),2048&e.flags&&gl(9,e,e.return)
break
case 3:case 12:default:ac(e)
break
case 22:var t=e.stateNode
null!==e.memoizedState&&2&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-3,lc(e)):ac(e)}}function lc(e){var t=e.deletions
if(16&e.flags){if(null!==t)for(var n=0;n<t.length;n++){var r=t[n]
Dl=r,cc(r,e)}oc(e)}for(e=e.child;null!==e;){switch((t=e).tag){case 0:case 11:case 15:gl(8,t,t.return),lc(t)
break
case 22:2&(n=t.stateNode)._visibility&&(n._visibility&=-3,lc(t))
break
default:lc(t)}e=e.sibling}}function cc(e,t){for(;null!==Dl;){var n=Dl
switch(n.tag){case 0:case 11:case 15:gl(8,n,t)
break
case 23:case 22:if(null!==n.memoizedState&&null!==n.memoizedState.cachePool){var r=n.memoizedState.cachePool.pool
null!=r&&r.refCount++}break
case 24:zi(n.memoizedState.cache)}if(null!==(r=n.child))r.return=n,Dl=r
else e:for(n=e;null!==Dl;){var i=(r=Dl).sibling,o=r.return
if(Rl(r),r===n){Dl=null
break e}if(null!==i){i.return=o,Dl=i
break e}Dl=o}}}var uc={getCacheForType:function(e){var t=ki(Ni),n=t.data.get(e)
return void 0===n&&(n=e(),t.data.set(e,n)),n},cacheSignal:function(){return ki(Ni).controller.signal}},dc="function"==typeof WeakMap?WeakMap:Map,pc=0,hc=null,fc=null,mc=0,gc=0,yc=null,vc=!1,bc=!1,xc=!1,Sc=0,_c=0,Cc=0,wc=0,Tc=0,Ac=0,Ic=0,Pc=null,Bc=null,Ec=!1,kc=0,Dc=0,Mc=1/0,Rc=null,Oc=null,Lc=0,Nc=null,Fc=null,zc=0,jc=0,Vc=null,Uc=null,Gc=0,Hc=null
function qc(){return 2&pc&&0!==mc?mc&-mc:null!==M.T?Vu():Ne()}function Qc(){if(0===Ac)if(536870912&mc&&!ui)Ac=536870912
else{var e=Ce
!(3932160&(Ce<<=1))&&(Ce=262144),Ac=e}return null!==(e=Do.current)&&(e.flags|=32),Ac}function $c(e,t,n){(e!==hc||2!==gc&&9!==gc)&&null===e.cancelPendingCommit||(eu(e,0),Zc(e,mc,Ac,!1)),ke(e,n),2&pc&&e===hc||(e===hc&&(!(2&pc)&&(wc|=n),4===_c&&Zc(e,mc,Ac,!1)),Ru(e))}function Xc(e,t,n){if(6&pc)throw Error(a(327))
for(var r=!n&&!(127&t)&&0===(t&e.expiredLanes)||Ie(e,t),i=r?function(e,t){var n=pc
pc|=2
var r=ru(),i=iu()
hc!==e||mc!==t?(Rc=null,Mc=se()+500,eu(e,t)):bc=Ie(e,t)
e:for(;;)try{if(0!==gc&&null!==fc){t=fc
var o=yc
t:switch(gc){case 1:gc=0,yc=null,du(e,t,o,1)
break
case 2:case 9:if(eo(o)){gc=0,yc=null,uu(t)
break}t=function(){2!==gc&&9!==gc||hc!==e||(gc=7),Ru(e)},o.then(t,t)
break e
case 3:gc=7
break e
case 4:gc=5
break e
case 7:eo(o)?(gc=0,yc=null,uu(t)):(gc=0,yc=null,du(e,t,o,7))
break
case 5:var s=null
switch(fc.tag){case 26:s=fc.memoizedState
case 5:case 27:var l=fc
if(s?rp(s):l.stateNode.complete){gc=0,yc=null
var c=l.sibling
if(null!==c)fc=c
else{var u=l.return
null!==u?(fc=u,pu(u)):fc=null}break t}}gc=0,yc=null,du(e,t,o,5)
break
case 6:gc=0,yc=null,du(e,t,o,6)
break
case 8:Jc(),_c=6
break e
default:throw Error(a(462))}}lu()
break}catch(t){tu(e,t)}return Ci=_i=null,M.H=r,M.A=i,pc=n,null!==fc?0:(hc=null,mc=0,Br(),_c)}(e,t):au(e,t,!0),o=r;;){if(0===i){bc&&!r&&Zc(e,t,0,!1)
break}if(n=e.current.alternate,!o||Yc(n)){if(2===i){if(o=t,e.errorRecoveryDisabledLanes&o)var s=0
else s=0!=(s=-536870913&e.pendingLanes)?s:536870912&s?536870912:0
if(0!==s){t=s
e:{var l=e
i=Pc
var c=l.current.memoizedState.isDehydrated
if(c&&(eu(l,s).flags|=256),2!==(s=au(l,s,!1))){if(xc&&!c){l.errorRecoveryDisabledLanes|=o,wc|=o,i=4
break e}o=Bc,Bc=i,null!==o&&(null===Bc?Bc=o:Bc.push.apply(Bc,o))}i=s}if(o=!1,2!==i)continue}}if(1===i){eu(e,0),Zc(e,t,0,!0)
break}e:{switch(r=e,o=i){case 0:case 1:throw Error(a(345))
case 4:if((4194048&t)!==t)break
case 6:Zc(r,t,Ac,!vc)
break e
case 2:Bc=null
break
case 3:case 5:break
default:throw Error(a(329))}if((62914560&t)===t&&10<(i=kc+300-se())){if(Zc(r,t,Ac,!vc),0!==Ae(r,0,!0))break e
zc=t,r.timeoutHandle=xd(Wc.bind(null,r,n,Bc,Rc,Ec,t,Ac,wc,Ic,vc,o,"Throttled",-0,0),i)}else Wc(r,n,Bc,Rc,Ec,t,Ac,wc,Ic,vc,o,null,-0,0)}break}i=au(e,t,!1),o=!1}Ru(e)}function Wc(e,t,n,r,i,o,a,s,l,c,u,d,p,h){if(e.timeoutHandle=-1,8192&(d=t.subtreeFlags)||!(16785408&~d)){ic(t,o,d={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:kt})
var f=(62914560&o)===o?kc-se():(4194048&o)===o?Dc-se():0
if(null!==(f=function(e,t){return e.stylesheets&&0===e.count&&sp(e,e.stylesheets),0<e.count||0<e.imgCount?function(n){var r=setTimeout(function(){if(e.stylesheets&&sp(e,e.stylesheets),e.unsuspend){var t=e.unsuspend
e.unsuspend=null,t()}},6e4+t)
0<e.imgBytes&&0===ip&&(ip=62500*function(){if("function"==typeof performance.getEntriesByType){for(var e=0,t=0,n=performance.getEntriesByType("resource"),r=0;r<n.length;r++){var i=n[r],o=i.transferSize,a=i.initiatorType,s=i.duration
if(o&&s&&pd(a)){for(a=0,s=i.responseEnd,r+=1;r<n.length;r++){var l=n[r],c=l.startTime
if(c>s)break
var u=l.transferSize,d=l.initiatorType
u&&pd(d)&&(a+=u*((l=l.responseEnd)<s?1:(s-c)/(l-c)))}if(--r,t+=8*(o+a)/(i.duration/1e3),10<++e)break}}if(0<e)return t/e/1e6}return navigator.connection&&"number"==typeof(e=navigator.connection.downlink)?e:5}())
var i=setTimeout(function(){if(e.waitingForImages=!1,0===e.count&&(e.stylesheets&&sp(e,e.stylesheets),e.unsuspend)){var t=e.unsuspend
e.unsuspend=null,t()}},(e.imgBytes>ip?50:800)+t)
return e.unsuspend=n,function(){e.unsuspend=null,clearTimeout(r),clearTimeout(i)}}:null}(d,f)))return zc=o,e.cancelPendingCommit=f(fu.bind(null,e,t,o,n,r,i,a,s,l,u,d,null,p,h)),void Zc(e,o,a,!c)}fu(e,t,o,n,r,i,a,s,l)}function Yc(e){for(var t=e;;){var n=t.tag
if((0===n||11===n||15===n)&&16384&t.flags&&null!==(n=t.updateQueue)&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],o=i.getSnapshot
i=i.value
try{if(!Zn(o(),i))return!1}catch(e){return!1}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n
else{if(t===e)break
for(;null===t.sibling;){if(null===t.return||t.return===e)return!0
t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Zc(e,t,n,r){t&=~Tc,t&=~wc,e.suspendedLanes|=t,e.pingedLanes&=~t,r&&(e.warmLanes|=t),r=e.expirationTimes
for(var i=t;0<i;){var o=31-be(i),a=1<<o
r[o]=-1,i&=~a}0!==n&&De(e,n,t)}function Kc(){return!!(6&pc)||(Ou(0,!1),!1)}function Jc(){if(null!==fc){if(0===gc)var e=fc.return
else Ci=_i=null,aa(e=fc),ao=null,so=0,e=fc
for(;null!==e;)fl(e.alternate,e),e=e.return
fc=null}}function eu(e,t){var n=e.timeoutHandle;-1!==n&&(e.timeoutHandle=-1,Sd(n)),null!==(n=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,n()),zc=0,Jc(),hc=e,fc=n=zr(e.current,null),mc=t,gc=0,yc=null,vc=!1,bc=Ie(e,t),xc=!1,Ic=Ac=Tc=wc=Cc=_c=0,Bc=Pc=null,Ec=!1,8&t&&(t|=32&t)
var r=e.entangledLanes
if(0!==r)for(e=e.entanglements,r&=t;0<r;){var i=31-be(r),o=1<<i
t|=e[i],r&=~o}return Sc=t,Br(),n}function tu(e,t){Uo=null,M.H=fs,t===Yi||t===Ki?(t=io(),gc=3):t===Zi?(t=io(),gc=4):gc=t===ks?8:null!==t&&"object"==typeof t&&"function"==typeof t.then?6:1,yc=t,null===fc&&(_c=1,As(e,$r(t,e.current)))}function nu(){var e=Do.current
return null===e||((4194048&mc)===mc?null===Mo:!!((62914560&mc)===mc||536870912&mc)&&e===Mo)}function ru(){var e=M.H
return M.H=fs,null===e?fs:e}function iu(){var e=M.A
return M.A=uc,e}function ou(){_c=4,vc||(4194048&mc)!==mc&&null!==Do.current||(bc=!0),!(134217727&Cc)&&!(134217727&wc)||null===hc||Zc(hc,mc,Ac,!1)}function au(e,t,n){var r=pc
pc|=2
var i=ru(),o=iu()
hc===e&&mc===t||(Rc=null,eu(e,t)),t=!1
var a=_c
e:for(;;)try{if(0!==gc&&null!==fc){var s=fc,l=yc
switch(gc){case 8:Jc(),a=6
break e
case 3:case 2:case 9:case 6:null===Do.current&&(t=!0)
var c=gc
if(gc=0,yc=null,du(e,s,l,c),n&&bc){a=0
break e}break
default:c=gc,gc=0,yc=null,du(e,s,l,c)}}su(),a=_c
break}catch(t){tu(e,t)}return t&&e.shellSuspendCounter++,Ci=_i=null,pc=r,M.H=i,M.A=o,null===fc&&(hc=null,mc=0,Br()),a}function su(){for(;null!==fc;)cu(fc)}function lu(){for(;null!==fc&&!oe();)cu(fc)}function cu(e){var t=ol(e.alternate,e,Sc)
e.memoizedProps=e.pendingProps,null===t?pu(e):fc=t}function uu(e){var t=e,n=t.alternate
switch(t.tag){case 15:case 0:t=Hs(n,t,t.pendingProps,t.type,void 0,mc)
break
case 11:t=Hs(n,t,t.pendingProps,t.type.render,t.ref,mc)
break
case 5:aa(t)
default:fl(n,t),t=ol(n,t=fc=jr(t,Sc),Sc)}e.memoizedProps=e.pendingProps,null===t?pu(e):fc=t}function du(e,t,n,r){Ci=_i=null,aa(t),ao=null,so=0
var i=t.return
try{if(function(e,t,n,r,i){if(n.flags|=32768,null!==r&&"object"==typeof r&&"function"==typeof r.then){if(null!==(t=n.alternate)&&Pi(t,n,i,!0),null!==(n=Do.current)){switch(n.tag){case 31:case 13:return null===Mo?ou():null===n.alternate&&0===_c&&(_c=3),n.flags&=-257,n.flags|=65536,n.lanes=i,r===Ji?n.flags|=16384:(null===(t=n.updateQueue)?n.updateQueue=new Set([r]):t.add(r),Cu(e,r,i)),!1
case 22:return n.flags|=65536,r===Ji?n.flags|=16384:(null===(t=n.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([r])},n.updateQueue=t):null===(n=t.retryQueue)?t.retryQueue=new Set([r]):n.add(r),Cu(e,r,i)),!1}throw Error(a(435,n.tag))}return Cu(e,r,i),ou(),!1}if(ui)return null!==(t=Do.current)?(!(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=i,r!==hi&&xi($r(e=Error(a(422),{cause:r}),n))):(r!==hi&&xi($r(t=Error(a(423),{cause:r}),n)),(e=e.current.alternate).flags|=65536,i&=-i,e.lanes|=i,r=$r(r,n),So(e,i=Ps(e.stateNode,r,i)),4!==_c&&(_c=2)),!1
var o=Error(a(520),{cause:r})
if(o=$r(o,n),null===Pc?Pc=[o]:Pc.push(o),4!==_c&&(_c=2),null===t)return!0
r=$r(r,n),n=t
do{switch(n.tag){case 3:return n.flags|=65536,e=i&-i,n.lanes|=e,So(n,e=Ps(n.stateNode,r,e)),!1
case 1:if(t=n.type,o=n.stateNode,!(128&n.flags||"function"!=typeof t.getDerivedStateFromError&&(null===o||"function"!=typeof o.componentDidCatch||null!==Oc&&Oc.has(o))))return n.flags|=65536,i&=-i,n.lanes|=i,Es(i=Bs(i),e,n,r),So(n,i),!1}n=n.return}while(null!==n)
return!1}(e,i,t,n,mc))return _c=1,As(e,$r(n,e.current)),void(fc=null)}catch(t){if(null!==i)throw fc=i,t
return _c=1,As(e,$r(n,e.current)),void(fc=null)}32768&t.flags?(ui||1===r?e=!0:bc||536870912&mc?e=!1:(vc=e=!0,(2===r||9===r||3===r||6===r)&&null!==(r=Do.current)&&13===r.tag&&(r.flags|=16384)),hu(t,e)):pu(t)}function pu(e){var t=e
do{if(32768&t.flags)return void hu(t,vc)
e=t.return
var n=pl(t.alternate,t,Sc)
if(null!==n)return void(fc=n)
if(null!==(t=t.sibling))return void(fc=t)
fc=t=e}while(null!==t)
0===_c&&(_c=5)}function hu(e,t){do{var n=hl(e.alternate,e)
if(null!==n)return n.flags&=32767,void(fc=n)
if(null!==(n=e.return)&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!t&&null!==(e=e.sibling))return void(fc=e)
fc=e=n}while(null!==e)
_c=6,fc=null}function fu(e,t,n,r,i,o,s,l,c){e.cancelPendingCommit=null
do{bu()}while(0!==Lc)
if(6&pc)throw Error(a(327))
if(null!==t){if(t===e.current)throw Error(a(177))
if(o=t.lanes|t.childLanes,function(e,t,n,r,i,o){var a=e.pendingLanes
e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=n,e.entangledLanes&=n,e.errorRecoveryDisabledLanes&=n,e.shellSuspendCounter=0
var s=e.entanglements,l=e.expirationTimes,c=e.hiddenUpdates
for(n=a&~n;0<n;){var u=31-be(n),d=1<<u
s[u]=0,l[u]=-1
var p=c[u]
if(null!==p)for(c[u]=null,u=0;u<p.length;u++){var h=p[u]
null!==h&&(h.lane&=-536870913)}n&=~d}0!==r&&De(e,r,0),0!==o&&0===i&&0!==e.tag&&(e.suspendedLanes|=o&~(a&~t))}(e,n,o|=Pr,s,l,c),e===hc&&(fc=hc=null,mc=0),Fc=t,Nc=e,zc=n,jc=o,Vc=i,Uc=r,10256&t.subtreeFlags||10256&t.flags?(e.callbackNode=null,e.callbackPriority=0,re(de,function(){return xu(),null})):(e.callbackNode=null,e.callbackPriority=0),r=!!(13878&t.flags),13878&t.subtreeFlags||r){r=M.T,M.T=null,i=R.p,R.p=2,s=pc,pc|=4
try{!function(e,t){if(e=e.containerInfo,hd=gp,rr(e=nr(e))){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd}
else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection()
if(r&&0!==r.rangeCount){n=r.anchorNode
var i=r.anchorOffset,o=r.focusNode
r=r.focusOffset
try{n.nodeType,o.nodeType}catch(e){n=null
break e}var s=0,l=-1,c=-1,u=0,d=0,p=e,h=null
t:for(;;){for(var f;p!==n||0!==i&&3!==p.nodeType||(l=s+i),p!==o||0!==r&&3!==p.nodeType||(c=s+r),3===p.nodeType&&(s+=p.nodeValue.length),null!==(f=p.firstChild);)h=p,p=f
for(;;){if(p===e)break t
if(h===n&&++u===i&&(l=s),h===o&&++d===r&&(c=s),null!==(f=p.nextSibling))break
h=(p=h).parentNode}p=f}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null
for(fd={focusedElem:e,selectionRange:n},gp=!1,Dl=t;null!==Dl;)if(e=(t=Dl).child,1028&t.subtreeFlags&&null!==e)e.return=t,Dl=e
else for(;null!==Dl;){switch(o=(t=Dl).alternate,e=t.flags,t.tag){case 0:if(4&e&&null!==(e=null!==(e=t.updateQueue)?e.events:null))for(n=0;n<e.length;n++)(i=e[n]).ref.impl=i.nextImpl
break
case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break
case 1:if(1024&e&&null!==o){e=void 0,n=t,i=o.memoizedProps,o=o.memoizedState,r=n.stateNode
try{var m=_s(n.type,i)
e=r.getSnapshotBeforeUpdate(m,o),r.__reactInternalSnapshotBeforeUpdate=e}catch(e){_u(n,n.return,e)}}break
case 3:if(1024&e)if(9===(n=(e=t.stateNode.containerInfo).nodeType))Pd(e)
else if(1===n)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":Pd(e)
break
default:e.textContent=""}break
default:if(1024&e)throw Error(a(163))}if(null!==(e=t.sibling)){e.return=t.return,Dl=e
break}Dl=t.return}}(e,t)}finally{pc=s,R.p=i,M.T=r}}Lc=1,mu(),gu(),yu()}}function mu(){if(1===Lc){Lc=0
var e=Nc,t=Fc,n=!!(13878&t.flags)
if(13878&t.subtreeFlags||n){n=M.T,M.T=null
var r=R.p
R.p=2
var i=pc
pc|=4
try{Hl(t,e)
var o=fd,a=nr(e.containerInfo),s=o.focusedElem,l=o.selectionRange
if(a!==s&&s&&s.ownerDocument&&tr(s.ownerDocument.documentElement,s)){if(null!==l&&rr(s)){var c=l.start,u=l.end
if(void 0===u&&(u=c),"selectionStart"in s)s.selectionStart=c,s.selectionEnd=Math.min(u,s.value.length)
else{var d=s.ownerDocument||document,p=d&&d.defaultView||window
if(p.getSelection){var h=p.getSelection(),f=s.textContent.length,m=Math.min(l.start,f),g=void 0===l.end?m:Math.min(l.end,f)
!h.extend&&m>g&&(a=g,g=m,m=a)
var y=er(s,m),v=er(s,g)
if(y&&v&&(1!==h.rangeCount||h.anchorNode!==y.node||h.anchorOffset!==y.offset||h.focusNode!==v.node||h.focusOffset!==v.offset)){var b=d.createRange()
b.setStart(y.node,y.offset),h.removeAllRanges(),m>g?(h.addRange(b),h.extend(v.node,v.offset)):(b.setEnd(v.node,v.offset),h.addRange(b))}}}}for(d=[],h=s;h=h.parentNode;)1===h.nodeType&&d.push({element:h,left:h.scrollLeft,top:h.scrollTop})
for("function"==typeof s.focus&&s.focus(),s=0;s<d.length;s++){var x=d[s]
x.element.scrollLeft=x.left,x.element.scrollTop=x.top}}gp=!!hd,fd=hd=null}finally{pc=i,R.p=r,M.T=n}}e.current=t,Lc=2}}function gu(){if(2===Lc){Lc=0
var e=Nc,t=Fc,n=!!(8772&t.flags)
if(8772&t.subtreeFlags||n){n=M.T,M.T=null
var r=R.p
R.p=2
var i=pc
pc|=4
try{Ml(e,t.alternate,t)}finally{pc=i,R.p=r,M.T=n}}Lc=3}}function yu(){if(4===Lc||3===Lc){Lc=0,ae()
var e=Nc,t=Fc,n=zc,r=Uc
10256&t.subtreeFlags||10256&t.flags?Lc=5:(Lc=0,Fc=Nc=null,vu(e,e.pendingLanes))
var i=e.pendingLanes
if(0===i&&(Oc=null),Le(n),t=t.stateNode,ye&&"function"==typeof ye.onCommitFiberRoot)try{ye.onCommitFiberRoot(ge,t,void 0,!(128&~t.current.flags))}catch(e){}if(null!==r){t=M.T,i=R.p,R.p=2,M.T=null
try{for(var o=e.onRecoverableError,a=0;a<r.length;a++){var s=r[a]
o(s.value,{componentStack:s.stack})}}finally{M.T=t,R.p=i}}3&zc&&bu(),Ru(e),i=e.pendingLanes,261930&n&&42&i?e===Hc?Gc++:(Gc=0,Hc=e):Gc=0,Ou(0,!1)}}function vu(e,t){0===(e.pooledCacheLanes&=t)&&null!=(t=e.pooledCache)&&(e.pooledCache=null,zi(t))}function bu(){return mu(),gu(),yu(),xu()}function xu(){if(5!==Lc)return!1
var e=Nc,t=jc
jc=0
var n=Le(zc),r=M.T,i=R.p
try{R.p=32>n?32:n,M.T=null,n=Vc,Vc=null
var o=Nc,s=zc
if(Lc=0,Fc=Nc=null,zc=0,6&pc)throw Error(a(331))
var l=pc
if(pc|=4,sc(o.current),Jl(o,o.current,s,n),pc=l,Ou(0,!1),ye&&"function"==typeof ye.onPostCommitFiberRoot)try{ye.onPostCommitFiberRoot(ge,o)}catch(e){}return!0}finally{R.p=i,M.T=r,vu(e,t)}}function Su(e,t,n){t=$r(n,t),null!==(e=bo(e,t=Ps(e.stateNode,t,2),2))&&(ke(e,2),Ru(e))}function _u(e,t,n){if(3===e.tag)Su(e,e,n)
else for(;null!==t;){if(3===t.tag){Su(t,e,n)
break}if(1===t.tag){var r=t.stateNode
if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&(null===Oc||!Oc.has(r))){e=$r(n,e),null!==(r=bo(t,n=Bs(2),2))&&(Es(n,r,t,e),ke(r,2),Ru(r))
break}}t=t.return}}function Cu(e,t,n){var r=e.pingCache
if(null===r){r=e.pingCache=new dc
var i=new Set
r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i))
i.has(n)||(xc=!0,i.add(n),e=wu.bind(null,e,t,n),t.then(e,e))}function wu(e,t,n){var r=e.pingCache
null!==r&&r.delete(t),e.pingedLanes|=e.suspendedLanes&n,e.warmLanes&=~n,hc===e&&(mc&n)===n&&(4===_c||3===_c&&(62914560&mc)===mc&&300>se()-kc?!(2&pc)&&eu(e,0):Tc|=n,Ic===mc&&(Ic=0)),Ru(e)}function Tu(e,t){0===t&&(t=Be()),null!==(e=Dr(e,t))&&(ke(e,t),Ru(e))}function Au(e){var t=e.memoizedState,n=0
null!==t&&(n=t.retryLane),Tu(e,n)}function Iu(e,t){var n=0
switch(e.tag){case 31:case 13:var r=e.stateNode,i=e.memoizedState
null!==i&&(n=i.retryLane)
break
case 19:r=e.stateNode
break
case 22:r=e.stateNode._retryCache
break
default:throw Error(a(314))}null!==r&&r.delete(t),Tu(e,n)}var Pu=null,Bu=null,Eu=!1,ku=!1,Du=!1,Mu=0
function Ru(e){e!==Bu&&null===e.next&&(null===Bu?Pu=Bu=e:Bu=Bu.next=e),ku=!0,Eu||(Eu=!0,Cd(function(){6&pc?re(ce,Lu):Nu()}))}function Ou(e,t){if(!Du&&ku){Du=!0
do{for(var n=!1,r=Pu;null!==r;){if(!t)if(0!==e){var i=r.pendingLanes
if(0===i)var o=0
else{var a=r.suspendedLanes,s=r.pingedLanes
o=(1<<31-be(42|e)+1)-1,o=201326741&(o&=i&~(a&~s))?201326741&o|1:o?2|o:0}0!==o&&(n=!0,ju(r,o))}else o=mc,!(3&(o=Ae(r,r===hc?o:0,null!==r.cancelPendingCommit||-1!==r.timeoutHandle)))||Ie(r,o)||(n=!0,ju(r,o))
r=r.next}}while(n)
Du=!1}}function Lu(){Nu()}function Nu(){ku=Eu=!1
var e,t=0
0!==Mu&&((e=window.event)&&"popstate"===e.type?e!==bd&&(bd=e,1):(bd=null,0))&&(t=Mu)
for(var n=se(),r=null,i=Pu;null!==i;){var o=i.next,a=Fu(i,n)
0===a?(i.next=null,null===r?Pu=o:r.next=o,null===o&&(Bu=r)):(r=i,(0!==t||3&a)&&(ku=!0)),i=o}0!==Lc&&5!==Lc||Ou(t,!1),0!==Mu&&(Mu=0)}function Fu(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,o=-62914561&e.pendingLanes;0<o;){var a=31-be(o),s=1<<a,l=i[a];-1===l?0!==(s&n)&&0===(s&r)||(i[a]=Pe(s,t)):l<=t&&(e.expiredLanes|=s),o&=~s}if(n=mc,n=Ae(e,e===(t=hc)?n:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle),r=e.callbackNode,0===n||e===t&&(2===gc||9===gc)||null!==e.cancelPendingCommit)return null!==r&&null!==r&&ie(r),e.callbackNode=null,e.callbackPriority=0
if(!(3&n)||Ie(e,n)){if((t=n&-n)===e.callbackPriority)return t
switch(null!==r&&ie(r),Le(n)){case 2:case 8:n=ue
break
case 32:default:n=de
break
case 268435456:n=he}return r=zu.bind(null,e),n=re(n,r),e.callbackPriority=t,e.callbackNode=n,t}return null!==r&&null!==r&&ie(r),e.callbackPriority=2,e.callbackNode=null,2}function zu(e,t){if(0!==Lc&&5!==Lc)return e.callbackNode=null,e.callbackPriority=0,null
var n=e.callbackNode
if(bu()&&e.callbackNode!==n)return null
var r=mc
return 0===(r=Ae(e,e===hc?r:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle))?null:(Xc(e,r,t),Fu(e,se()),null!=e.callbackNode&&e.callbackNode===n?zu.bind(null,e):null)}function ju(e,t){if(bu())return null
Xc(e,t,!0)}function Vu(){if(0===Mu){var e=Ui
0===e&&(e=_e,!(261888&(_e<<=1))&&(_e=256)),Mu=e}return Mu}function Uu(e){return null==e||"symbol"==typeof e||"boolean"==typeof e?null:"function"==typeof e?e:Et(""+e)}function Gu(e,t){var n=t.ownerDocument.createElement("input")
return n.name=t.name,n.value=t.value,e.id&&n.setAttribute("form",e.id),t.parentNode.insertBefore(n,t),e=new FormData(e),n.parentNode.removeChild(n),e}for(var Hu=0;Hu<Cr.length;Hu++){var qu=Cr[Hu]
wr(qu.toLowerCase(),"on"+(qu[0].toUpperCase()+qu.slice(1)))}wr(mr,"onAnimationEnd"),wr(gr,"onAnimationIteration"),wr(yr,"onAnimationStart"),wr("dblclick","onDoubleClick"),wr("focusin","onFocus"),wr("focusout","onBlur"),wr(vr,"onTransitionRun"),wr(br,"onTransitionStart"),wr(xr,"onTransitionCancel"),wr(Sr,"onTransitionEnd"),rt("onMouseEnter",["mouseout","mouseover"]),rt("onMouseLeave",["mouseout","mouseover"]),rt("onPointerEnter",["pointerout","pointerover"]),rt("onPointerLeave",["pointerout","pointerover"]),nt("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),nt("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),nt("onBeforeInput",["compositionend","keypress","textInput","paste"]),nt("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),nt("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),nt("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "))
var Qu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),$u=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Qu))
function Xu(e,t){t=!!(4&t)
for(var n=0;n<e.length;n++){var r=e[n],i=r.event
r=r.listeners
e:{var o=void 0
if(t)for(var a=r.length-1;0<=a;a--){var s=r[a],l=s.instance,c=s.currentTarget
if(s=s.listener,l!==o&&i.isPropagationStopped())break e
o=s,i.currentTarget=c
try{o(i)}catch(e){Tr(e)}i.currentTarget=null,o=l}else for(a=0;a<r.length;a++){if(l=(s=r[a]).instance,c=s.currentTarget,s=s.listener,l!==o&&i.isPropagationStopped())break e
o=s,i.currentTarget=c
try{o(i)}catch(e){Tr(e)}i.currentTarget=null,o=l}}}}function Wu(e,t){var n=t[Ge]
void 0===n&&(n=t[Ge]=new Set)
var r=e+"__bubble"
n.has(r)||(Ju(t,e,2,!1),n.add(r))}function Yu(e,t,n){var r=0
t&&(r|=4),Ju(n,e,r,t)}var Zu="_reactListening"+Math.random().toString(36).slice(2)
function Ku(e){if(!e[Zu]){e[Zu]=!0,et.forEach(function(t){"selectionchange"!==t&&($u.has(t)||Yu(t,!1,e),Yu(t,!0,e))})
var t=9===e.nodeType?e:e.ownerDocument
null===t||t[Zu]||(t[Zu]=!0,Yu("selectionchange",!1,t))}}function Ju(e,t,n,r){switch(Cp(t)){case 2:var i=yp
break
case 8:i=vp
break
default:i=bp}n=i.bind(null,t,n,e),i=void 0,!Vt||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function ed(e,t,n,r,i){var o=r
if(!(1&t||2&t||null===r))e:for(;;){if(null===r)return
var a=r.tag
if(3===a||4===a){var l=r.stateNode.containerInfo
if(l===i)break
if(4===a)for(a=r.return;null!==a;){var c=a.tag
if((3===c||4===c)&&a.stateNode.containerInfo===i)return
a=a.return}for(;null!==l;){if(null===(a=We(l)))return
if(5===(c=a.tag)||6===c||26===c||27===c){r=o=a
continue e}l=l.parentNode}}r=r.return}Ft(function(){var r=o,i=Mt(n),a=[]
e:{var l=_r.get(e)
if(void 0!==l){var c=tn,u=e
switch(e){case"keypress":if(0===$t(n))break e
case"keydown":case"keyup":c=yn
break
case"focusin":u="focus",c=ln
break
case"focusout":u="blur",c=ln
break
case"beforeblur":case"afterblur":c=ln
break
case"click":if(2===n.button)break e
case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=an
break
case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=sn
break
case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=bn
break
case mr:case gr:case yr:c=cn
break
case Sr:c=xn
break
case"scroll":case"scrollend":c=rn
break
case"wheel":c=Sn
break
case"copy":case"cut":case"paste":c=un
break
case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=vn
break
case"toggle":case"beforetoggle":c=_n}var d=!!(4&t),p=!d&&("scroll"===e||"scrollend"===e),h=d?null!==l?l+"Capture":null:l
d=[]
for(var f,m=r;null!==m;){var g=m
if(f=g.stateNode,5!==(g=g.tag)&&26!==g&&27!==g||null===f||null===h||null!=(g=zt(m,h))&&d.push(td(m,g,f)),p)break
m=m.return}0<d.length&&(l=new c(l,u,null,n,i),a.push({event:l,listeners:d}))}}if(!(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(l="mouseover"===e||"pointerover"===e)||n===Dt||!(u=n.relatedTarget||n.fromElement)||!We(u)&&!u[Ue])&&(c||l)&&(l=i.window===i?i:(l=i.ownerDocument)?l.defaultView||l.parentWindow:window,c?(c=r,null!==(u=(u=n.relatedTarget||n.toElement)?We(u):null)&&(p=s(u),d=u.tag,u!==p||5!==d&&27!==d&&6!==d)&&(u=null)):(c=null,u=r),c!==u)){if(d=an,g="onMouseLeave",h="onMouseEnter",m="mouse","pointerout"!==e&&"pointerover"!==e||(d=vn,g="onPointerLeave",h="onPointerEnter",m="pointer"),p=null==c?l:Ze(c),f=null==u?l:Ze(u),(l=new d(g,m+"leave",c,n,i)).target=p,l.relatedTarget=f,g=null,We(i)===r&&((d=new d(h,m+"enter",u,n,i)).target=f,d.relatedTarget=p,g=d),p=g,c&&u)e:{for(d=rd,m=u,f=0,g=h=c;g;g=d(g))f++
g=0
for(var y=m;y;y=d(y))g++
for(;0<f-g;)h=d(h),f--
for(;0<g-f;)m=d(m),g--
for(;f--;){if(h===m||null!==m&&h===m.alternate){d=h
break e}h=d(h),m=d(m)}d=null}else d=null
null!==c&&id(a,l,c,d,!1),null!==u&&null!==p&&id(a,p,u,d,!0)}if("select"===(c=(l=r?Ze(r):window).nodeName&&l.nodeName.toLowerCase())||"input"===c&&"file"===l.type)var v=jn
else if(Rn(l))if(Vn)v=Yn
else{v=Xn
var b=$n}else!(c=l.nodeName)||"input"!==c.toLowerCase()||"checkbox"!==l.type&&"radio"!==l.type?r&&It(r.elementType)&&(v=jn):v=Wn
switch(v&&(v=v(e,r))?On(a,v,n,i):(b&&b(e,l,r),"focusout"===e&&r&&"number"===l.type&&null!=r.memoizedProps.value&&bt(l,"number",l.value)),b=r?Ze(r):window,e){case"focusin":(Rn(b)||"true"===b.contentEditable)&&(or=b,ar=r,sr=null)
break
case"focusout":sr=ar=or=null
break
case"mousedown":lr=!0
break
case"contextmenu":case"mouseup":case"dragend":lr=!1,cr(a,n,i)
break
case"selectionchange":if(ir)break
case"keydown":case"keyup":cr(a,n,i)}var x
if(wn)e:{switch(e){case"compositionstart":var S="onCompositionStart"
break e
case"compositionend":S="onCompositionEnd"
break e
case"compositionupdate":S="onCompositionUpdate"
break e}S=void 0}else Dn?En(e,n)&&(S="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(S="onCompositionStart")
S&&(In&&"ko"!==n.locale&&(Dn||"onCompositionStart"!==S?"onCompositionEnd"===S&&Dn&&(x=Qt()):(Ht="value"in(Gt=i)?Gt.value:Gt.textContent,Dn=!0)),0<(b=nd(r,S)).length&&(S=new dn(S,e,null,n,i),a.push({event:S,listeners:b}),(x||null!==(x=kn(n)))&&(S.data=x))),(x=An?function(e,t){switch(e){case"compositionend":return kn(t)
case"keypress":return 32!==t.which?null:(Bn=!0,Pn)
case"textInput":return(e=t.data)===Pn&&Bn?null:e
default:return null}}(e,n):function(e,t){if(Dn)return"compositionend"===e||!wn&&En(e,t)?(e=Qt(),qt=Ht=Gt=null,Dn=!1,e):null
switch(e){case"paste":default:return null
case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char
if(t.which)return String.fromCharCode(t.which)}return null
case"compositionend":return In&&"ko"!==t.locale?null:t.data}}(e,n))&&0<(S=nd(r,"onBeforeInput")).length&&(b=new dn("onBeforeInput","beforeinput",null,n,i),a.push({event:b,listeners:S}),b.data=x),function(e,t,n,r,i){if("submit"===t&&n&&n.stateNode===i){var o=Uu((i[Ve]||null).action),a=r.submitter
a&&null!==(t=(t=a[Ve]||null)?Uu(t.formAction):a.getAttribute("formAction"))&&(o=t,a=null)
var s=new tn("action","action",null,r,i)
e.push({event:s,listeners:[{instance:null,listener:function(){if(r.defaultPrevented){if(0!==Mu){var e=a?Gu(i,a):new FormData(i)
es(n,{pending:!0,data:e,method:i.method,action:o},null,e)}}else"function"==typeof o&&(s.preventDefault(),e=a?Gu(i,a):new FormData(i),es(n,{pending:!0,data:e,method:i.method,action:o},o,e))},currentTarget:i}]})}}(a,e,r,n,i)}Xu(a,t)})}function td(e,t,n){return{instance:e,listener:t,currentTarget:n}}function nd(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,o=i.stateNode
if(5!==(i=i.tag)&&26!==i&&27!==i||null===o||(null!=(i=zt(e,n))&&r.unshift(td(e,i,o)),null!=(i=zt(e,t))&&r.push(td(e,i,o))),3===e.tag)return r
e=e.return}return[]}function rd(e){if(null===e)return null
do{e=e.return}while(e&&5!==e.tag&&27!==e.tag)
return e||null}function id(e,t,n,r,i){for(var o=t._reactName,a=[];null!==n&&n!==r;){var s=n,l=s.alternate,c=s.stateNode
if(s=s.tag,null!==l&&l===r)break
5!==s&&26!==s&&27!==s||null===c||(l=c,i?null!=(c=zt(n,o))&&a.unshift(td(n,c,l)):i||null!=(c=zt(n,o))&&a.push(td(n,c,l))),n=n.return}0!==a.length&&e.push({event:t,listeners:a})}var od=/\r\n?/g,ad=/\u0000|\uFFFD/g
function sd(e){return("string"==typeof e?e:""+e).replace(od,"\n").replace(ad,"")}function ld(e,t){return t=sd(t),sd(e)===t}function cd(e,t,n,r,i,o){switch(n){case"children":"string"==typeof r?"body"===t||"textarea"===t&&""===r||Ct(e,r):("number"==typeof r||"bigint"==typeof r)&&"body"!==t&&Ct(e,""+r)
break
case"className":lt(e,"class",r)
break
case"tabIndex":lt(e,"tabindex",r)
break
case"dir":case"role":case"viewBox":case"width":case"height":lt(e,n,r)
break
case"style":At(e,r,o)
break
case"data":if("object"!==t){lt(e,"data",r)
break}case"src":case"href":if(""===r&&("a"!==t||"href"!==n)){e.removeAttribute(n)
break}if(null==r||"function"==typeof r||"symbol"==typeof r||"boolean"==typeof r){e.removeAttribute(n)
break}r=Et(""+r),e.setAttribute(n,r)
break
case"action":case"formAction":if("function"==typeof r){e.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')")
break}if("function"==typeof o&&("formAction"===n?("input"!==t&&cd(e,t,"name",i.name,i,null),cd(e,t,"formEncType",i.formEncType,i,null),cd(e,t,"formMethod",i.formMethod,i,null),cd(e,t,"formTarget",i.formTarget,i,null)):(cd(e,t,"encType",i.encType,i,null),cd(e,t,"method",i.method,i,null),cd(e,t,"target",i.target,i,null))),null==r||"symbol"==typeof r||"boolean"==typeof r){e.removeAttribute(n)
break}r=Et(""+r),e.setAttribute(n,r)
break
case"onClick":null!=r&&(e.onclick=kt)
break
case"onScroll":null!=r&&Wu("scroll",e)
break
case"onScrollEnd":null!=r&&Wu("scrollend",e)
break
case"dangerouslySetInnerHTML":if(null!=r){if("object"!=typeof r||!("__html"in r))throw Error(a(61))
if(null!=(n=r.__html)){if(null!=i.children)throw Error(a(60))
e.innerHTML=n}}break
case"multiple":e.multiple=r&&"function"!=typeof r&&"symbol"!=typeof r
break
case"muted":e.muted=r&&"function"!=typeof r&&"symbol"!=typeof r
break
case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break
case"xlinkHref":if(null==r||"function"==typeof r||"boolean"==typeof r||"symbol"==typeof r){e.removeAttribute("xlink:href")
break}n=Et(""+r),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n)
break
case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=r&&"function"!=typeof r&&"symbol"!=typeof r?e.setAttribute(n,""+r):e.removeAttribute(n)
break
case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":r&&"function"!=typeof r&&"symbol"!=typeof r?e.setAttribute(n,""):e.removeAttribute(n)
break
case"capture":case"download":!0===r?e.setAttribute(n,""):!1!==r&&null!=r&&"function"!=typeof r&&"symbol"!=typeof r?e.setAttribute(n,r):e.removeAttribute(n)
break
case"cols":case"rows":case"size":case"span":null!=r&&"function"!=typeof r&&"symbol"!=typeof r&&!isNaN(r)&&1<=r?e.setAttribute(n,r):e.removeAttribute(n)
break
case"rowSpan":case"start":null==r||"function"==typeof r||"symbol"==typeof r||isNaN(r)?e.removeAttribute(n):e.setAttribute(n,r)
break
case"popover":Wu("beforetoggle",e),Wu("toggle",e),st(e,"popover",r)
break
case"xlinkActuate":ct(e,"http://www.w3.org/1999/xlink","xlink:actuate",r)
break
case"xlinkArcrole":ct(e,"http://www.w3.org/1999/xlink","xlink:arcrole",r)
break
case"xlinkRole":ct(e,"http://www.w3.org/1999/xlink","xlink:role",r)
break
case"xlinkShow":ct(e,"http://www.w3.org/1999/xlink","xlink:show",r)
break
case"xlinkTitle":ct(e,"http://www.w3.org/1999/xlink","xlink:title",r)
break
case"xlinkType":ct(e,"http://www.w3.org/1999/xlink","xlink:type",r)
break
case"xmlBase":ct(e,"http://www.w3.org/XML/1998/namespace","xml:base",r)
break
case"xmlLang":ct(e,"http://www.w3.org/XML/1998/namespace","xml:lang",r)
break
case"xmlSpace":ct(e,"http://www.w3.org/XML/1998/namespace","xml:space",r)
break
case"is":st(e,"is",r)
break
case"innerText":case"textContent":break
default:(!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])&&st(e,n=Pt.get(n)||n,r)}}function ud(e,t,n,r,i,o){switch(n){case"style":At(e,r,o)
break
case"dangerouslySetInnerHTML":if(null!=r){if("object"!=typeof r||!("__html"in r))throw Error(a(61))
if(null!=(n=r.__html)){if(null!=i.children)throw Error(a(60))
e.innerHTML=n}}break
case"children":"string"==typeof r?Ct(e,r):("number"==typeof r||"bigint"==typeof r)&&Ct(e,""+r)
break
case"onScroll":null!=r&&Wu("scroll",e)
break
case"onScrollEnd":null!=r&&Wu("scrollend",e)
break
case"onClick":null!=r&&(e.onclick=kt)
break
case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break
default:tt.hasOwnProperty(n)||("o"!==n[0]||"n"!==n[1]||(i=n.endsWith("Capture"),t=n.slice(2,i?n.length-7:void 0),"function"==typeof(o=null!=(o=e[Ve]||null)?o[n]:null)&&e.removeEventListener(t,o,i),"function"!=typeof r)?n in e?e[n]=r:!0===r?e.setAttribute(n,""):st(e,n,r):("function"!=typeof o&&null!==o&&(n in e?e[n]=null:e.hasAttribute(n)&&e.removeAttribute(n)),e.addEventListener(t,r,i)))}}function dd(e,t,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break
case"img":Wu("error",e),Wu("load",e)
var r,i=!1,o=!1
for(r in n)if(n.hasOwnProperty(r)){var s=n[r]
if(null!=s)switch(r){case"src":i=!0
break
case"srcSet":o=!0
break
case"children":case"dangerouslySetInnerHTML":throw Error(a(137,t))
default:cd(e,t,r,s,n,null)}}return o&&cd(e,t,"srcSet",n.srcSet,n,null),void(i&&cd(e,t,"src",n.src,n,null))
case"input":Wu("invalid",e)
var l=r=s=o=null,c=null,u=null
for(i in n)if(n.hasOwnProperty(i)){var d=n[i]
if(null!=d)switch(i){case"name":o=d
break
case"type":s=d
break
case"checked":c=d
break
case"defaultChecked":u=d
break
case"value":r=d
break
case"defaultValue":l=d
break
case"children":case"dangerouslySetInnerHTML":if(null!=d)throw Error(a(137,t))
break
default:cd(e,t,i,d,n,null)}}return void vt(e,r,l,c,u,s,o,!1)
case"select":for(o in Wu("invalid",e),i=s=r=null,n)if(n.hasOwnProperty(o)&&null!=(l=n[o]))switch(o){case"value":r=l
break
case"defaultValue":s=l
break
case"multiple":i=l
default:cd(e,t,o,l,n,null)}return t=r,n=s,e.multiple=!!i,void(null!=t?xt(e,!!i,t,!1):null!=n&&xt(e,!!i,n,!0))
case"textarea":for(s in Wu("invalid",e),r=o=i=null,n)if(n.hasOwnProperty(s)&&null!=(l=n[s]))switch(s){case"value":i=l
break
case"defaultValue":o=l
break
case"children":r=l
break
case"dangerouslySetInnerHTML":if(null!=l)throw Error(a(91))
break
default:cd(e,t,s,l,n,null)}return void _t(e,i,o,r)
case"option":for(c in n)n.hasOwnProperty(c)&&null!=(i=n[c])&&("selected"===c?e.selected=i&&"function"!=typeof i&&"symbol"!=typeof i:cd(e,t,c,i,n,null))
return
case"dialog":Wu("beforetoggle",e),Wu("toggle",e),Wu("cancel",e),Wu("close",e)
break
case"iframe":case"object":Wu("load",e)
break
case"video":case"audio":for(i=0;i<Qu.length;i++)Wu(Qu[i],e)
break
case"image":Wu("error",e),Wu("load",e)
break
case"details":Wu("toggle",e)
break
case"embed":case"source":case"link":Wu("error",e),Wu("load",e)
case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(u in n)if(n.hasOwnProperty(u)&&null!=(i=n[u]))switch(u){case"children":case"dangerouslySetInnerHTML":throw Error(a(137,t))
default:cd(e,t,u,i,n,null)}return
default:if(It(t)){for(d in n)n.hasOwnProperty(d)&&void 0!==(i=n[d])&&ud(e,t,d,i,n,void 0)
return}}for(l in n)n.hasOwnProperty(l)&&null!=(i=n[l])&&cd(e,t,l,i,n,null)}function pd(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0
default:return!1}}var hd=null,fd=null
function md(e){return 9===e.nodeType?e:e.ownerDocument}function gd(e){switch(e){case"http://www.w3.org/2000/svg":return 1
case"http://www.w3.org/1998/Math/MathML":return 2
default:return 0}}function yd(e,t){if(0===e)switch(t){case"svg":return 1
case"math":return 2
default:return 0}return 1===e&&"foreignObject"===t?0:e}function vd(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"bigint"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var bd=null,xd="function"==typeof setTimeout?setTimeout:void 0,Sd="function"==typeof clearTimeout?clearTimeout:void 0,_d="function"==typeof Promise?Promise:void 0,Cd="function"==typeof queueMicrotask?queueMicrotask:void 0!==_d?function(e){return _d.resolve(null).then(e).catch(wd)}:xd
function wd(e){setTimeout(function(){throw e})}function Td(e){return"head"===e}function Ad(e,t){var n=t,r=0
do{var i=n.nextSibling
if(e.removeChild(n),i&&8===i.nodeType)if("/$"===(n=i.data)||"/&"===n){if(0===r)return e.removeChild(i),void Vp(t)
r--}else if("$"===n||"$?"===n||"$~"===n||"$!"===n||"&"===n)r++
else if("html"===n)Nd(e.ownerDocument.documentElement)
else if("head"===n){Nd(n=e.ownerDocument.head)
for(var o=n.firstChild;o;){var a=o.nextSibling,s=o.nodeName
o[$e]||"SCRIPT"===s||"STYLE"===s||"LINK"===s&&"stylesheet"===o.rel.toLowerCase()||n.removeChild(o),o=a}}else"body"===n&&Nd(e.ownerDocument.body)
n=i}while(n)
Vp(t)}function Id(e,t){var n=e
e=0
do{var r=n.nextSibling
if(1===n.nodeType?t?(n._stashedDisplay=n.style.display,n.style.display="none"):(n.style.display=n._stashedDisplay||"",""===n.getAttribute("style")&&n.removeAttribute("style")):3===n.nodeType&&(t?(n._stashedText=n.nodeValue,n.nodeValue=""):n.nodeValue=n._stashedText||""),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===e)break
e--}else"$"!==n&&"$?"!==n&&"$~"!==n&&"$!"!==n||e++
n=r}while(n)}function Pd(e){var t=e.firstChild
for(t&&10===t.nodeType&&(t=t.nextSibling);t;){var n=t
switch(t=t.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":Pd(n),Xe(n)
continue
case"SCRIPT":case"STYLE":continue
case"LINK":if("stylesheet"===n.rel.toLowerCase())continue}e.removeChild(n)}}function Bd(e,t){for(;8!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!t)return null
if(null===(e=Dd(e.nextSibling)))return null}return e}function Ed(e){return"$?"===e.data||"$~"===e.data}function kd(e){return"$!"===e.data||"$?"===e.data&&"loading"!==e.ownerDocument.readyState}function Dd(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType
if(1===t||3===t)break
if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t||"$~"===t||"&"===t||"F!"===t||"F"===t)break
if("/$"===t||"/&"===t)return null}}return e}var Md=null
function Rd(e){e=e.nextSibling
for(var t=0;e;){if(8===e.nodeType){var n=e.data
if("/$"===n||"/&"===n){if(0===t)return Dd(e.nextSibling)
t--}else"$"!==n&&"$!"!==n&&"$?"!==n&&"$~"!==n&&"&"!==n||t++}e=e.nextSibling}return null}function Od(e){e=e.previousSibling
for(var t=0;e;){if(8===e.nodeType){var n=e.data
if("$"===n||"$!"===n||"$?"===n||"$~"===n||"&"===n){if(0===t)return e
t--}else"/$"!==n&&"/&"!==n||t++}e=e.previousSibling}return null}function Ld(e,t,n){switch(t=md(n),e){case"html":if(!(e=t.documentElement))throw Error(a(452))
return e
case"head":if(!(e=t.head))throw Error(a(453))
return e
case"body":if(!(e=t.body))throw Error(a(454))
return e
default:throw Error(a(451))}}function Nd(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0])
Xe(e)}var Fd=new Map,zd=new Set
function jd(e){return"function"==typeof e.getRootNode?e.getRootNode():9===e.nodeType?e:e.ownerDocument}var Vd=R.d
R.d={f:function(){var e=Vd.f(),t=Kc()
return e||t},r:function(e){var t=Ye(e)
null!==t&&5===t.tag&&"form"===t.type?ns(t):Vd.r(e)},D:function(e){Vd.D(e),Gd("dns-prefetch",e,null)},C:function(e,t){Vd.C(e,t),Gd("preconnect",e,t)},L:function(e,t,n){Vd.L(e,t,n)
var r=Ud
if(r&&e&&t){var i='link[rel="preload"][as="'+gt(t)+'"]'
"image"===t&&n&&n.imageSrcSet?(i+='[imagesrcset="'+gt(n.imageSrcSet)+'"]',"string"==typeof n.imageSizes&&(i+='[imagesizes="'+gt(n.imageSizes)+'"]')):i+='[href="'+gt(e)+'"]'
var o=i
switch(t){case"style":o=qd(e)
break
case"script":o=Xd(e)}Fd.has(o)||(e=p({rel:"preload",href:"image"===t&&n&&n.imageSrcSet?void 0:e,as:t},n),Fd.set(o,e),null!==r.querySelector(i)||"style"===t&&r.querySelector(Qd(o))||"script"===t&&r.querySelector(Wd(o))||(dd(t=r.createElement("link"),"link",e),Je(t),r.head.appendChild(t)))}},m:function(e,t){Vd.m(e,t)
var n=Ud
if(n&&e){var r=t&&"string"==typeof t.as?t.as:"script",i='link[rel="modulepreload"][as="'+gt(r)+'"][href="'+gt(e)+'"]',o=i
switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":o=Xd(e)}if(!Fd.has(o)&&(e=p({rel:"modulepreload",href:e},t),Fd.set(o,e),null===n.querySelector(i))){switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(Wd(o)))return}dd(r=n.createElement("link"),"link",e),Je(r),n.head.appendChild(r)}}},X:function(e,t){Vd.X(e,t)
var n=Ud
if(n&&e){var r=Ke(n).hoistableScripts,i=Xd(e),o=r.get(i)
o||((o=n.querySelector(Wd(i)))||(e=p({src:e,async:!0},t),(t=Fd.get(i))&&Jd(e,t),Je(o=n.createElement("script")),dd(o,"link",e),n.head.appendChild(o)),o={type:"script",instance:o,count:1,state:null},r.set(i,o))}},S:function(e,t,n){Vd.S(e,t,n)
var r=Ud
if(r&&e){var i=Ke(r).hoistableStyles,o=qd(e)
t=t||"default"
var a=i.get(o)
if(!a){var s={loading:0,preload:null}
if(a=r.querySelector(Qd(o)))s.loading=5
else{e=p({rel:"stylesheet",href:e,"data-precedence":t},n),(n=Fd.get(o))&&Kd(e,n)
var l=a=r.createElement("link")
Je(l),dd(l,"link",e),l._p=new Promise(function(e,t){l.onload=e,l.onerror=t}),l.addEventListener("load",function(){s.loading|=1}),l.addEventListener("error",function(){s.loading|=2}),s.loading|=4,Zd(a,t,r)}a={type:"stylesheet",instance:a,count:1,state:s},i.set(o,a)}}},M:function(e,t){Vd.M(e,t)
var n=Ud
if(n&&e){var r=Ke(n).hoistableScripts,i=Xd(e),o=r.get(i)
o||((o=n.querySelector(Wd(i)))||(e=p({src:e,async:!0,type:"module"},t),(t=Fd.get(i))&&Jd(e,t),Je(o=n.createElement("script")),dd(o,"link",e),n.head.appendChild(o)),o={type:"script",instance:o,count:1,state:null},r.set(i,o))}}}
var Ud="undefined"==typeof document?null:document
function Gd(e,t,n){var r=Ud
if(r&&"string"==typeof t&&t){var i=gt(t)
i='link[rel="'+e+'"][href="'+i+'"]',"string"==typeof n&&(i+='[crossorigin="'+n+'"]'),zd.has(i)||(zd.add(i),e={rel:e,crossOrigin:n,href:t},null===r.querySelector(i)&&(dd(t=r.createElement("link"),"link",e),Je(t),r.head.appendChild(t)))}}function Hd(e,t,n,r){var i,o,s,l,c=(c=q.current)?jd(c):null
if(!c)throw Error(a(446))
switch(e){case"meta":case"title":return null
case"style":return"string"==typeof n.precedence&&"string"==typeof n.href?(t=qd(n.href),(r=(n=Ke(c).hoistableStyles).get(t))||(r={type:"style",instance:null,count:0,state:null},n.set(t,r)),r):{type:"void",instance:null,count:0,state:null}
case"link":if("stylesheet"===n.rel&&"string"==typeof n.href&&"string"==typeof n.precedence){e=qd(n.href)
var u=Ke(c).hoistableStyles,d=u.get(e)
if(d||(c=c.ownerDocument||c,d={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},u.set(e,d),(u=c.querySelector(Qd(e)))&&!u._p&&(d.instance=u,d.state.loading=5),Fd.has(e)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},Fd.set(e,n),u||(i=c,o=e,s=n,l=d.state,i.querySelector('link[rel="preload"][as="style"]['+o+"]")?l.loading=1:(o=i.createElement("link"),l.preload=o,o.addEventListener("load",function(){return l.loading|=1}),o.addEventListener("error",function(){return l.loading|=2}),dd(o,"link",s),Je(o),i.head.appendChild(o))))),t&&null===r)throw Error(a(528,""))
return d}if(t&&null!==r)throw Error(a(529,""))
return null
case"script":return t=n.async,"string"==typeof(n=n.src)&&t&&"function"!=typeof t&&"symbol"!=typeof t?(t=Xd(n),(r=(n=Ke(c).hoistableScripts).get(t))||(r={type:"script",instance:null,count:0,state:null},n.set(t,r)),r):{type:"void",instance:null,count:0,state:null}
default:throw Error(a(444,e))}}function qd(e){return'href="'+gt(e)+'"'}function Qd(e){return'link[rel="stylesheet"]['+e+"]"}function $d(e){return p({},e,{"data-precedence":e.precedence,precedence:null})}function Xd(e){return'[src="'+gt(e)+'"]'}function Wd(e){return"script[async]"+e}function Yd(e,t,n){if(t.count++,null===t.instance)switch(t.type){case"style":var r=e.querySelector('style[data-href~="'+gt(n.href)+'"]')
if(r)return t.instance=r,Je(r),r
var i=p({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null})
return Je(r=(e.ownerDocument||e).createElement("style")),dd(r,"style",i),Zd(r,n.precedence,e),t.instance=r
case"stylesheet":i=qd(n.href)
var o=e.querySelector(Qd(i))
if(o)return t.state.loading|=4,t.instance=o,Je(o),o
r=$d(n),(i=Fd.get(i))&&Kd(r,i),Je(o=(e.ownerDocument||e).createElement("link"))
var s=o
return s._p=new Promise(function(e,t){s.onload=e,s.onerror=t}),dd(o,"link",r),t.state.loading|=4,Zd(o,n.precedence,e),t.instance=o
case"script":return o=Xd(n.src),(i=e.querySelector(Wd(o)))?(t.instance=i,Je(i),i):(r=n,(i=Fd.get(o))&&Jd(r=p({},n),i),Je(i=(e=e.ownerDocument||e).createElement("script")),dd(i,"link",r),e.head.appendChild(i),t.instance=i)
case"void":return null
default:throw Error(a(443,t.type))}else"stylesheet"===t.type&&!(4&t.state.loading)&&(r=t.instance,t.state.loading|=4,Zd(r,n.precedence,e))
return t.instance}function Zd(e,t,n){for(var r=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),i=r.length?r[r.length-1]:null,o=i,a=0;a<r.length;a++){var s=r[a]
if(s.dataset.precedence===t)o=s
else if(o!==i)break}o?o.parentNode.insertBefore(e,o.nextSibling):(t=9===n.nodeType?n.head:n).insertBefore(e,t.firstChild)}function Kd(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.title&&(e.title=t.title)}function Jd(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.integrity&&(e.integrity=t.integrity)}var ep=null
function tp(e,t,n){if(null===ep){var r=new Map,i=ep=new Map
i.set(n,r)}else(r=(i=ep).get(n))||(r=new Map,i.set(n,r))
if(r.has(e))return r
for(r.set(e,null),n=n.getElementsByTagName(e),i=0;i<n.length;i++){var o=n[i]
if(!(o[$e]||o[je]||"link"===e&&"stylesheet"===o.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==o.namespaceURI){var a=o.getAttribute(t)||""
a=e+a
var s=r.get(a)
s?s.push(o):r.set(a,[o])}}return r}function np(e,t,n){(e=e.ownerDocument||e).head.insertBefore(n,"title"===t?e.querySelector("head > title"):null)}function rp(e){return!!("stylesheet"!==e.type||3&e.state.loading)}var ip=0
function op(){if(this.count--,0===this.count&&(0===this.imgCount||!this.waitingForImages))if(this.stylesheets)sp(this,this.stylesheets)
else if(this.unsuspend){var e=this.unsuspend
this.unsuspend=null,e()}}var ap=null
function sp(e,t){e.stylesheets=null,null!==e.unsuspend&&(e.count++,ap=new Map,t.forEach(lp,e),ap=null,op.call(e))}function lp(e,t){if(!(4&t.state.loading)){var n=ap.get(e)
if(n)var r=n.get(null)
else{n=new Map,ap.set(e,n)
for(var i=e.querySelectorAll("link[data-precedence],style[data-precedence]"),o=0;o<i.length;o++){var a=i[o]
"LINK"!==a.nodeName&&"not all"===a.getAttribute("media")||(n.set(a.dataset.precedence,a),r=a)}r&&n.set(null,r)}a=(i=t.instance).getAttribute("data-precedence"),(o=n.get(a)||r)===r&&n.set(null,i),n.set(a,i),this.count++,r=op.bind(this),i.addEventListener("load",r),i.addEventListener("error",r),o?o.parentNode.insertBefore(i,o.nextSibling):(e=9===e.nodeType?e.head:e).insertBefore(i,e.firstChild),t.state.loading|=4}}var cp={$$typeof:x,Provider:null,Consumer:null,_currentValue:O,_currentValue2:O,_threadCount:0}
function up(e,t,n,r,i,o,a,s,l){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ee(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ee(0),this.hiddenUpdates=Ee(null),this.identifierPrefix=r,this.onUncaughtError=i,this.onCaughtError=o,this.onRecoverableError=a,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=l,this.incompleteTransitions=new Map}function dp(e,t,n,r,i,o){i=function(e){return e?e=Or:Or}(i),null===r.context?r.context=i:r.pendingContext=i,(r=vo(t)).payload={element:n},null!==(o=void 0===o?null:o)&&(r.callback=o),null!==(n=bo(e,r,t))&&($c(n,0,t),xo(n,e,t))}function pp(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane
e.retryLane=0!==n&&n<t?n:t}}function hp(e,t){pp(e,t),(e=e.alternate)&&pp(e,t)}function fp(e){if(13===e.tag||31===e.tag){var t=Dr(e,67108864)
null!==t&&$c(t,0,67108864),hp(e,67108864)}}function mp(e){if(13===e.tag||31===e.tag){var t=qc(),n=Dr(e,t=Oe(t))
null!==n&&$c(n,0,t),hp(e,t)}}var gp=!0
function yp(e,t,n,r){var i=M.T
M.T=null
var o=R.p
try{R.p=2,bp(e,t,n,r)}finally{R.p=o,M.T=i}}function vp(e,t,n,r){var i=M.T
M.T=null
var o=R.p
try{R.p=8,bp(e,t,n,r)}finally{R.p=o,M.T=i}}function bp(e,t,n,r){if(gp){var i=xp(r)
if(null===i)ed(e,t,r,Sp,n),Dp(e,r)
else if(function(e,t,n,r,i){switch(t){case"focusin":return Tp=Mp(Tp,e,t,n,r,i),!0
case"dragenter":return Ap=Mp(Ap,e,t,n,r,i),!0
case"mouseover":return Ip=Mp(Ip,e,t,n,r,i),!0
case"pointerover":var o=i.pointerId
return Pp.set(o,Mp(Pp.get(o)||null,e,t,n,r,i)),!0
case"gotpointercapture":return o=i.pointerId,Bp.set(o,Mp(Bp.get(o)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r))r.stopPropagation()
else if(Dp(e,r),4&t&&-1<kp.indexOf(e)){for(;null!==i;){var o=Ye(i)
if(null!==o)switch(o.tag){case 3:if((o=o.stateNode).current.memoizedState.isDehydrated){var a=Te(o.pendingLanes)
if(0!==a){var s=o
for(s.pendingLanes|=2,s.entangledLanes|=2;a;){var l=1<<31-be(a)
s.entanglements[1]|=l,a&=~l}Ru(o),!(6&pc)&&(Mc=se()+500,Ou(0,!1))}}break
case 31:case 13:null!==(s=Dr(o,2))&&$c(s,0,2),Kc(),hp(o,2)}if(null===(o=xp(r))&&ed(e,t,r,Sp,n),o===i)break
i=o}null!==i&&r.stopPropagation()}else ed(e,t,r,null,n)}}function xp(e){return _p(e=Mt(e))}var Sp=null
function _p(e){if(Sp=null,null!==(e=We(e))){var t=s(e)
if(null===t)e=null
else{var n=t.tag
if(13===n){if(null!==(e=l(t)))return e
e=null}else if(31===n){if(null!==(e=c(t)))return e
e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null
e=null}else t!==e&&(e=null)}}return Sp=e,null}function Cp(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2
case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8
case"message":switch(le()){case ce:return 2
case ue:return 8
case de:case pe:return 32
case he:return 268435456
default:return 32}default:return 32}}var wp=!1,Tp=null,Ap=null,Ip=null,Pp=new Map,Bp=new Map,Ep=[],kp="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ")
function Dp(e,t){switch(e){case"focusin":case"focusout":Tp=null
break
case"dragenter":case"dragleave":Ap=null
break
case"mouseover":case"mouseout":Ip=null
break
case"pointerover":case"pointerout":Pp.delete(t.pointerId)
break
case"gotpointercapture":case"lostpointercapture":Bp.delete(t.pointerId)}}function Mp(e,t,n,r,i,o){return null===e||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:o,targetContainers:[i]},null!==t&&null!==(t=Ye(t))&&fp(t),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function Rp(e){var t=We(e.target)
if(null!==t){var n=s(t)
if(null!==n)if(13===(t=n.tag)){if(null!==(t=l(n)))return e.blockedOn=t,void Fe(e.priority,function(){mp(n)})}else if(31===t){if(null!==(t=c(n)))return e.blockedOn=t,void Fe(e.priority,function(){mp(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Op(e){if(null!==e.blockedOn)return!1
for(var t=e.targetContainers;0<t.length;){var n=xp(e.nativeEvent)
if(null!==n)return null!==(t=Ye(n))&&fp(t),e.blockedOn=n,!1
var r=new(n=e.nativeEvent).constructor(n.type,n)
Dt=r,n.target.dispatchEvent(r),Dt=null,t.shift()}return!0}function Lp(e,t,n){Op(e)&&n.delete(t)}function Np(){wp=!1,null!==Tp&&Op(Tp)&&(Tp=null),null!==Ap&&Op(Ap)&&(Ap=null),null!==Ip&&Op(Ip)&&(Ip=null),Pp.forEach(Lp),Bp.forEach(Lp)}function Fp(e,t){e.blockedOn===t&&(e.blockedOn=null,wp||(wp=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Np)))}var zp=null
function jp(e){zp!==e&&(zp=e,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){zp===e&&(zp=null)
for(var t=0;t<e.length;t+=3){var n=e[t],r=e[t+1],i=e[t+2]
if("function"!=typeof r){if(null===_p(r||n))continue
break}var o=Ye(n)
null!==o&&(e.splice(t,3),t-=3,es(o,{pending:!0,data:i,method:n.method,action:r},r,i))}}))}function Vp(e){function t(t){return Fp(t,e)}null!==Tp&&Fp(Tp,e),null!==Ap&&Fp(Ap,e),null!==Ip&&Fp(Ip,e),Pp.forEach(t),Bp.forEach(t)
for(var n=0;n<Ep.length;n++){var r=Ep[n]
r.blockedOn===e&&(r.blockedOn=null)}for(;0<Ep.length&&null===(n=Ep[0]).blockedOn;)Rp(n),null===n.blockedOn&&Ep.shift()
if(null!=(n=(e.ownerDocument||e).$$reactFormReplay))for(r=0;r<n.length;r+=3){var i=n[r],o=n[r+1],a=i[Ve]||null
if("function"==typeof o)a||jp(n)
else if(a){var s=null
if(o&&o.hasAttribute("formAction")){if(i=o,a=o[Ve]||null)s=a.formAction
else if(null!==_p(i))continue}else s=a.action
"function"==typeof s?n[r+1]=s:(n.splice(r,3),r-=3),jp(n)}}}function Up(){function e(e){e.canIntercept&&"react-transition"===e.info&&e.intercept({handler:function(){return new Promise(function(e){return i=e})},focusReset:"manual",scroll:"manual"})}function t(){null!==i&&(i(),i=null),r||setTimeout(n,20)}function n(){if(!r&&!navigation.transition){var e=navigation.currentEntry
e&&null!=e.url&&navigation.navigate(e.url,{state:e.getState(),info:"react-transition",history:"replace"})}}if("object"==typeof navigation){var r=!1,i=null
return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",t),navigation.addEventListener("navigateerror",t),setTimeout(n,100),function(){r=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",t),navigation.removeEventListener("navigateerror",t),null!==i&&(i(),i=null)}}}function Gp(e){this._internalRoot=e}function Hp(e){this._internalRoot=e}Hp.prototype.render=Gp.prototype.render=function(e){var t=this._internalRoot
if(null===t)throw Error(a(409))
dp(t.current,qc(),e,t,null,null)},Hp.prototype.unmount=Gp.prototype.unmount=function(){var e=this._internalRoot
if(null!==e){this._internalRoot=null
var t=e.containerInfo
dp(e.current,2,null,e,null,null),Kc(),t[Ue]=null}},Hp.prototype.unstable_scheduleHydration=function(e){if(e){var t=Ne()
e={blockedOn:null,target:e,priority:t}
for(var n=0;n<Ep.length&&0!==t&&t<Ep[n].priority;n++);Ep.splice(n,0,e),0===n&&Rp(e)}}
var qp=i.version
if("19.2.3"!==qp)throw Error(a(527,qp,"19.2.3"))
R.findDOMNode=function(e){var t=e._reactInternals
if(void 0===t){if("function"==typeof e.render)throw Error(a(188))
throw e=Object.keys(e).join(","),Error(a(268,e))}return e=function(e){var t=e.alternate
if(!t){if(null===(t=s(e)))throw Error(a(188))
return t!==e?null:e}for(var n=e,r=t;;){var i=n.return
if(null===i)break
var o=i.alternate
if(null===o){if(null!==(r=i.return)){n=r
continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===n)return u(i),e
if(o===r)return u(i),t
o=o.sibling}throw Error(a(188))}if(n.return!==r.return)n=i,r=o
else{for(var l=!1,c=i.child;c;){if(c===n){l=!0,n=i,r=o
break}if(c===r){l=!0,r=i,n=o
break}c=c.sibling}if(!l){for(c=o.child;c;){if(c===n){l=!0,n=o,r=i
break}if(c===r){l=!0,r=o,n=i
break}c=c.sibling}if(!l)throw Error(a(189))}}if(n.alternate!==r)throw Error(a(190))}if(3!==n.tag)throw Error(a(188))
return n.stateNode.current===n?e:t}(t),null===(e=null!==e?d(e):null)?null:e.stateNode}
var Qp={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:M,reconcilerVersion:"19.2.3"}
if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var $p=__REACT_DEVTOOLS_GLOBAL_HOOK__
if(!$p.isDisabled&&$p.supportsFiber)try{ge=$p.inject(Qp),ye=$p}catch(e){}}t.createRoot=function(e,t){if(!(n=e)||1!==n.nodeType&&9!==n.nodeType&&11!==n.nodeType)throw Error(a(299))
var n,r=!1,i="",o=Cs,s=ws,l=Ts
return null!=t&&(!0===t.unstable_strictMode&&(r=!0),void 0!==t.identifierPrefix&&(i=t.identifierPrefix),void 0!==t.onUncaughtError&&(o=t.onUncaughtError),void 0!==t.onCaughtError&&(s=t.onCaughtError),void 0!==t.onRecoverableError&&(l=t.onRecoverableError)),t=function(e,t,n,r,i,o,a,s,l,c,u,d){return e=new up(e,t,n,a,l,c,u,d,null),t=1,!0===o&&(t|=24),o=Nr(3,null,null,t),e.current=o,o.stateNode=e,(t=Fi()).refCount++,e.pooledCache=t,t.refCount++,o.memoizedState={element:null,isDehydrated:n,cache:t},go(o),e}(e,1,!1,0,0,r,i,0,o,s,l,Up),e[Ue]=t.current,Ku(e),new Gp(t)}},76242(e,t,n){"use strict"
n.d(t,{c:()=>s})
var r=n(57523),i=n(37411)
function o(e,t,n,r){r=e[t],e[t]=e[n],e[n]=r}function a(e,t){return(e=Math.abs(e))>(t=Math.abs(t))?(t/=e,e*Math.sqrt(1+t*t)):t>0?(e/=t,t*Math.sqrt(1+e*e)):0}var s,l=n(76677),c=n(23325)
!function(e){function t(e){if(3===e.length)return l.n.create(i.e.fromArray((0,i.e)(),e,0),i.e.create(1,0,0),i.e.create(0,1,0),i.e.create(0,0,1))
const t=r.u.fromArray(e,3,e.length/3),n=t.rows,s=n/3,c=r.u.create(3,3),u=r.u.create(1,3),d=r.u.create(3,3),p=r.u.create(3,3),h=r.u.meanRows(t),f=r.u.subRows(r.u.clone(t),h),m=r.u.transpose(r.u.create(n,3),f)
r.u.multiplyABt(c,m,m),function(e,t,n,i){let s=0,l=0
const c=e.rows,u=e.cols
let d=c,p=u
d<p&&(s=1,l=d,d=p,p=l)
const h=r.u.create(d,d),f=r.u.create(1,p),m=r.u.create(p,p)
if(0===s)r.u.transpose(h,e)
else{for(l=0;l<u*c;l++)h.data[l]=e.data[l]
for(;l<p*d;l++)h.data[l]=0}if(function(e,t,n,r,i,s,l,c){let u=0,d=0,p=0,h=0
const f=Math.max(s,30)
let m=0,g=0,y=0,v=0,b=0,x=0,S=0,_=0,C=0,w=0,T=0,A=0,I=0,P=0,B=0,E=0,k=0,D=4660,M=0,R=0,O=0
const L=new Float64Array(l<<3)
for(;u<l;u++){for(p=0,T=0;p<s;p++)_=e[u*t+p],T+=_*_
if(L[u]=T,r){for(p=0;p<l;p++)r[u*i+p]=0
r[u*i+u]=1}}for(;h<f;h++){for(b=0,u=0;u<l-1;u++)for(d=u+1;d<l;d++){for(m=u*t|0,g=d*t|0,B=L[u],E=0,k=L[d],p=2,E+=e[m]*e[g],E+=e[m+1]*e[g+1];p<s;p++)E+=e[m+p]*e[g+p]
if(!(Math.abs(E)<=2.384185792e-7*Math.sqrt(B*k))){for(E*=2,A=B-k,I=a(E,A),A<0?(P=.5*(I-A),S=Math.sqrt(P/I),x=E/(I*S*2)):(x=Math.sqrt((I+A)/(2*I)),S=E/(I*x*2)),B=0,k=0,p=2,C=x*e[m]+S*e[g],w=-S*e[m]+x*e[g],e[m]=C,e[g]=w,B+=C*C,k+=w*w,C=x*e[m+1]+S*e[g+1],w=-S*e[m+1]+x*e[g+1],e[m+1]=C,e[g+1]=w,B+=C*C,k+=w*w;p<s;p++)C=x*e[m+p]+S*e[g+p],w=-S*e[m+p]+x*e[g+p],e[m+p]=C,e[g+p]=w,B+=C*C,k+=w*w
if(L[u]=B,L[d]=k,b=1,r)for(y=u*i|0,v=d*i|0,p=2,C=x*r[y]+S*r[v],w=-S*r[y]+x*r[v],r[y]=C,r[v]=w,C=x*r[y+1]+S*r[v+1],w=-S*r[y+1]+x*r[v+1],r[y+1]=C,r[v+1]=w;p<l;p++)C=x*r[y+p]+S*r[v+p],w=-S*r[y+p]+x*r[v+p],r[y+p]=C,r[v+p]=w}}if(0===b)break}for(u=0;u<l;u++){for(p=0,T=0;p<s;p++)_=e[u*t+p],T+=_*_
L[u]=Math.sqrt(T)}for(u=0;u<l-1;u++){for(d=u,p=u+1;p<l;p++)L[d]<L[p]&&(d=p)
if(u!==d&&(o(L,u,d,T),r)){for(p=0;p<s;p++)o(e,u*t+p,d*t+p,_)
for(p=0;p<l;p++)o(r,u*i+p,d*i+p,_)}}for(u=0;u<l;u++)n[u]=L[u]
if(r)for(u=0;u<c;u++){for(T=u<l?L[u]:0;T<=1e-37;){for(R=1/s,p=0;p<s;p++)D=214013*D+2531011,M=256&D>>16?R:-R,e[u*t+p]=M
for(h=0;h<2;h++)for(d=0;d<u;d++){for(T=0,p=0;p<s;p++)T+=e[u*t+p]*e[d*t+p]
for(O=0,p=0;p<s;p++)_=e[u*t+p]-T*e[d*t+p],e[u*t+p]=_,O+=Math.abs(_)
for(O=O?1/O:0,p=0;p<s;p++)e[u*t+p]*=O}for(T=0,p=0;p<s;p++)_=e[u*t+p],T+=_*_
T=Math.sqrt(T)}for(S=1/T,p=0;p<s;p++)e[u*t+p]*=S}}(h.data,d,f.data,m.data,p,d,p,d),t){for(l=0;l<p;l++)t.data[l]=f.data[l]
for(;l<u;l++)t.data[l]=0}0===s?(n&&r.u.transpose(n,h),i&&r.u.transpose(i,m)):(n&&r.u.transpose(n,m),i&&r.u.transpose(i,h))}(c,u,d,p)
const g=i.e.create(h[0],h[1],h[2]),y=i.e.create(d.data[0],d.data[3],d.data[6]),v=i.e.create(d.data[1],d.data[4],d.data[7]),b=i.e.create(d.data[2],d.data[5],d.data[8])
return i.e.scale(y,y,Math.sqrt(u.data[0]/s)),i.e.scale(v,v,Math.sqrt(u.data[1]/s)),i.e.scale(b,b,Math.sqrt(u.data[2]/s)),l.n.create(g,y,v,b)}function n(e){const t=l.n.clone(e)
return i.e.magnitude(t.dirC)<c.p&&i.e.cross(t.dirC,t.dirA,t.dirB),l.n.normalize(t,t)}e.ofPositions=function(e){const n=t(e)
return{momentsAxes:n,boxAxes:u(e,n)}},e.calculateMomentsAxes=t,e.calculateNormalizedAxes=n
const s=(0,i.e)()
function u(e,t){if(3===e.length)return l.n.clone(t)
let r=-1/0,o=-1/0,a=-1/0,c=-1/0,u=-1/0,d=-1/0
const p=(0,i.e)(),h=(0,i.e)(),f=t.origin,m=n(t)
for(let n=0,s=e.length;n<s;n+=3){i.e.projectPointOnVector(p,i.e.fromArray(p,e,n),m.dirA,f)
const t=i.e.dot(m.dirA,i.e.normalize(h,i.e.sub(h,p,f))),s=i.e.distance(p,f)
t>0?s>r&&(r=s):s>o&&(o=s),i.e.projectPointOnVector(p,i.e.fromArray(p,e,n),m.dirB,f)
const l=i.e.dot(m.dirB,i.e.normalize(h,i.e.sub(h,p,f))),g=i.e.distance(p,f)
l>0?g>a&&(a=g):g>c&&(c=g),i.e.projectPointOnVector(p,i.e.fromArray(p,e,n),m.dirC,f)
const y=i.e.dot(m.dirC,i.e.normalize(h,i.e.sub(h,p,f))),v=i.e.distance(p,f)
y>0?v>u&&(u=v):v>d&&(d=v)}const g=i.e.setMagnitude((0,i.e)(),m.dirA,(r+o)/2),y=i.e.setMagnitude((0,i.e)(),m.dirB,(a+c)/2),v=i.e.setMagnitude((0,i.e)(),m.dirC,(u+d)/2),b=i.e.isFinite(g),x=i.e.isFinite(y),S=i.e.isFinite(v),_=(0,i.e)(),C=function(e,t,n){i.e.copy(s,f),b&&i.e.scaleAndAdd(s,s,m.dirA,e),x&&i.e.scaleAndAdd(s,s,m.dirB,t),S&&i.e.scaleAndAdd(s,s,m.dirC,n),i.e.add(_,_,s)}
return C(r,a,u),C(r,a,-d),C(r,-c,-d),C(r,-c,u),C(-o,-c,-d),C(-o,-c,u),C(-o,a,u),C(-o,a,-d),i.e.scale(_,_,1/8),l.n.create(_,g,y,v)}e.calculateBoxAxes=u}(s||(s={}))},76513(e,t,n){"use strict"
n.d(t,{AQ:()=>d,C6:()=>i,Ju:()=>s,N3:()=>u,YH:()=>a,fX:()=>c,sH:()=>o,xN:()=>p,zs:()=>l})
var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)}
function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null")
function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function o(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t
e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}l((r=r.apply(e,t||[])).next())})}function a(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1]
return i[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype)
return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a
function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.")
for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i
switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s
break
case 4:return o.label++,{value:s[1],done:!1}
case 5:o.label++,r=s[1],s=[0]
continue
case 7:s=o.ops.pop(),o.trys.pop()
continue
default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0
continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1]
break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s
break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s)
break}i[2]&&o.ops.pop(),o.trys.pop()
continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1]
return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}}function s(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0
if(n)return n.call(e)
if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}
throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function l(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator]
if(!n)return e
var r,i,o=n.call(e),a=[]
try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function c(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i])
return e.concat(r||Array.prototype.slice.call(t))}function u(e){return this instanceof u?(this.v=e,this):new u(e)}function d(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.")
var r,i=n.apply(e,t||[]),o=[]
return r=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",function(e){return function(t){return Promise.resolve(t).then(e,c)}}),r[Symbol.asyncIterator]=function(){return this},r
function a(e,t){i[e]&&(r[e]=function(t){return new Promise(function(n,r){o.push([e,t,n,r])>1||s(e,t)})},t&&(r[e]=t(r[e])))}function s(e,t){try{(n=i[e](t)).value instanceof u?Promise.resolve(n.value.v).then(l,c):d(o[0][2],n)}catch(e){d(o[0][3],e)}var n}function l(e){s("next",e)}function c(e){s("throw",e)}function d(e,t){e(t),o.shift(),o.length&&s(o[0][0],o[0][1])}}function p(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.")
var t,n=e[Symbol.asyncIterator]
return n?n.call(e):(e=s(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t)
function r(n){t[n]=e[n]&&function(t){return new Promise(function(r,i){!function(e,t,n,r){Promise.resolve(r).then(function(t){e({value:t,done:n})},t)}(r,i,(t=e[n](t)).done,t.value)})}}}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError},76515(e,t,n){"use strict"
n.d(t,{c:()=>r})
var r,i=n(9043)
!function(e){e.create=function(e,t,n,r){return{id:i.kk.create22(),label:e,basic:t,sourceData:r,bonds:n}}}(r||(r={}))},76677(e,t,n){"use strict"
n.d(t,{n:()=>i})
var r=n(32775)
function i(){return i.empty()}!function(e){function t(){return{origin:(0,r.eB)(),dirA:(0,r.eB)(),dirB:(0,r.eB)(),dirC:(0,r.eB)()}}function n(e,t){return r.eB.copy(e.origin,t.origin),r.eB.copy(e.dirA,t.dirA),r.eB.copy(e.dirB,t.dirB),r.eB.copy(e.dirC,t.dirC),e}function i(e,t){return r.eB.set(e,2*r.eB.magnitude(t.dirA),2*r.eB.magnitude(t.dirB),2*r.eB.magnitude(t.dirC))}e.create=function(e,t,n,r){return{origin:e,dirA:t,dirB:n,dirC:r}},e.empty=t,e.copy=n,e.clone=function(e){return n(t(),e)},e.size=i
const o=(0,r.eB)()
e.volume=function(e){return i(o,e),o[0]*o[1]*o[2]},e.normalize=function(e,t){return r.eB.copy(e.origin,t.origin),r.eB.normalize(e.dirA,t.dirA),r.eB.normalize(e.dirB,t.dirB),r.eB.normalize(e.dirC,t.dirC),e}
const a=(0,r.U)()
e.transform=function(e,t,n){r.eB.transformMat4(e.origin,t.origin,n)
const i=r.U.directionTransform(a,n)
return r.eB.transformMat3(e.dirA,t.dirA,i),r.eB.transformMat3(e.dirB,t.dirB,i),r.eB.transformMat3(e.dirC,t.dirC,i),e},e.scale=function(e,t,n){return r.eB.scale(e.dirA,t.dirA,n),r.eB.scale(e.dirB,t.dirB,n),r.eB.scale(e.dirC,t.dirC,n),e}}(i||(i={}))},76715(e,t,n){"use strict"
var r=n(25602)
function i(e){var t="https://react.dev/errors/"+e
if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1])
for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(){}var a={d:{f:o,r:function(){throw Error(i(522))},D:o,C:o,L:o,m:o,X:o,S:o,M:o},p:0,findDOMNode:null},s=Symbol.for("react.portal"),l=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE
function c(e,t){return"font"===e?"":"string"==typeof t?"use-credentials"===t?t:"":void 0}t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=a,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null
if(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)throw Error(i(299))
return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null
return{$$typeof:s,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.flushSync=function(e){var t=l.T,n=a.p
try{if(l.T=null,a.p=2,e)return e()}finally{l.T=t,a.p=n,a.d.f()}},t.preconnect=function(e,t){"string"==typeof e&&(t=t?"string"==typeof(t=t.crossOrigin)?"use-credentials"===t?t:"":void 0:null,a.d.C(e,t))},t.prefetchDNS=function(e){"string"==typeof e&&a.d.D(e)},t.preinit=function(e,t){if("string"==typeof e&&t&&"string"==typeof t.as){var n=t.as,r=c(n,t.crossOrigin),i="string"==typeof t.integrity?t.integrity:void 0,o="string"==typeof t.fetchPriority?t.fetchPriority:void 0
"style"===n?a.d.S(e,"string"==typeof t.precedence?t.precedence:void 0,{crossOrigin:r,integrity:i,fetchPriority:o}):"script"===n&&a.d.X(e,{crossOrigin:r,integrity:i,fetchPriority:o,nonce:"string"==typeof t.nonce?t.nonce:void 0})}},t.preinitModule=function(e,t){if("string"==typeof e)if("object"==typeof t&&null!==t){if(null==t.as||"script"===t.as){var n=c(t.as,t.crossOrigin)
a.d.M(e,{crossOrigin:n,integrity:"string"==typeof t.integrity?t.integrity:void 0,nonce:"string"==typeof t.nonce?t.nonce:void 0})}}else null==t&&a.d.M(e)},t.preload=function(e,t){if("string"==typeof e&&"object"==typeof t&&null!==t&&"string"==typeof t.as){var n=t.as,r=c(n,t.crossOrigin)
a.d.L(e,n,{crossOrigin:r,integrity:"string"==typeof t.integrity?t.integrity:void 0,nonce:"string"==typeof t.nonce?t.nonce:void 0,type:"string"==typeof t.type?t.type:void 0,fetchPriority:"string"==typeof t.fetchPriority?t.fetchPriority:void 0,referrerPolicy:"string"==typeof t.referrerPolicy?t.referrerPolicy:void 0,imageSrcSet:"string"==typeof t.imageSrcSet?t.imageSrcSet:void 0,imageSizes:"string"==typeof t.imageSizes?t.imageSizes:void 0,media:"string"==typeof t.media?t.media:void 0})}},t.preloadModule=function(e,t){if("string"==typeof e)if(t){var n=c(t.as,t.crossOrigin)
a.d.m(e,{as:"string"==typeof t.as&&"script"!==t.as?t.as:void 0,crossOrigin:n,integrity:"string"==typeof t.integrity?t.integrity:void 0})}else a.d.m(e)},t.requestFormReset=function(e){a.d.r(e)},t.unstable_batchedUpdates=function(e,t){return e(t)},t.useFormState=function(e,t,n){return l.H.useFormState(e,t,n)},t.useFormStatus=function(){return l.H.useHostTransitionStatus()},t.version="19.2.3"},76840(e,t,n){"use strict"
n.d(t,{S:()=>r})
var r,i=n(92384),o=n(9043),a=n(33205),s=n(12288)
!function(e){function t(e){const t=e.descriptor.name,n="root"===e.type?"inheritedPropertyData":"currentPropertyData",r=r=>(t in r[n]||(r[n][t]={props:{...i.t.getDefaultValues(e.getParams(r))},data:o.xv.create(void 0)}),r[n][t]),a=(e,i,a)=>{const s=r(e)
e[n][t]={props:i,data:o.xv.withValue(s.data,a)}}
return{label:e.label,descriptor:e.descriptor,isHidden:e.isHidden,getParams:t=>{const n=i.t.clone(e.getParams(t))
return i.t.setDefaultValues(n,r(t).props),n},defaultParams:e.defaultParams,isApplicable:e.isApplicable,attach:async(t,n,o={},s)=>{s&&n.customPropertyDescriptors.reference(e.descriptor,!0),"root"===e.type&&(n=n.root)
const l=r(n.root).props,c=r(n),u=i.t.merge(e.defaultParams,l,o)
if(c.data.value&&i.t.areEqual(e.defaultParams,c.props,u))return
const{value:d,assets:p}=await e.obtain(t,n,u)
n.customPropertyDescriptors.add(e.descriptor),n.customPropertyDescriptors.assets(e.descriptor,p),a(n,u,d)},ref:(t,n)=>t.customPropertyDescriptors.reference(e.descriptor,n),get:e=>r(e).data,set:(t,n={},o)=>{"root"===e.type&&(t=t.root)
const s=r(t),l=i.t.merge(e.defaultParams,s.props,n)
i.t.areEqual(e.defaultParams,s.props,l)||(a(t,l,o),t.customPropertyDescriptors.assets(e.descriptor))},props:e=>r(e).props}}e.createProvider=t,e.createSimple=function(e,n,r){const o={value:i.t.Value(r,{isHidden:!0})}
return t({label:(0,s.Mk)(e),descriptor:(0,a.e)({name:e}),isHidden:!0,type:n,defaultParams:o,getParams:()=>({value:i.t.Value(r,{isHidden:!0})}),isApplicable:()=>!0,obtain:async(e,t,n)=>({...i.t.getDefaultValues(o),...n})})}}(r||(r={}))},77323(e,t,n){"use strict"
function r(){return new o}function i(e){return{previous:null,next:null,inList:!0,value:e}}n.d(t,{w:()=>r})
class o{constructor(){this.count=0,this.first=null,this.last=null}addFirst(e){const t=i(e)
return t.inList=!0,this.first&&(this.first.previous=t),t.next=this.first,this.first=t,this.count++,this.last||(this.last=t),t}addLast(e){const t=i(e)
return null!==this.last&&(this.last.next=t),t.previous=this.last,this.last=t,null===this.first&&(this.first=t),t.inList=!0,this.count++,t}removeFirst(){const e=this.first
if(e)return this.remove(e),e.value}removeLast(){const e=this.last
if(e)return this.remove(e),e.value}remove(e){e.inList&&(e.inList=!1,null!==e.previous?e.previous.next=e.next:null===e.previous&&(this.first=e.next),null!==e.next?e.next.previous=e.previous:null===e.next&&(this.last=e.previous),e.next=null,e.previous=null,this.count--)}find(e){let t=this.first
for(;null!==t;){if(t.value===e)return t
t=t.next}}}},77472(e,t,n){"use strict"
n.r(t),n.d(t,{camelize:()=>I,capitalize:()=>E,classify:()=>P,dasherize:()=>A,decamelize:()=>T,getString:()=>s,getStrings:()=>a,setStrings:()=>o,underscore:()=>B,w:()=>w})
class r{constructor(e,t,n){this.limit=e,this.func=t,this.store=n,this.size=0,this.misses=0,this.hits=0,this.store=n||new Map}get(e){let t=this.store.get(e)
return this.store.has(e)?(this.hits++,this.store.get(e)):(this.misses++,t=this.set(e,this.func(e)),t)}set(e,t){return this.limit>this.size&&(this.size++,this.store.set(e,t)),t}purge(){this.store.clear(),this.size=0,this.hits=0,this.misses=0}}let i={}
function o(e){i=e}function a(){return i}function s(e){return i[e]}const l=/[ _]/g,c=new r(1e3,e=>T(e).replace(l,"-")),u=/(\-|\_|\.|\s)+(.)?/g,d=/(^|\/)([A-Z])/g,p=new r(1e3,e=>e.replace(u,(e,t,n)=>n?n.toUpperCase():"").replace(d,e=>e.toLowerCase())),h=/^(\-|_)+(.)?/,f=/(.)(\-|\_|\.|\s)+(.)?/g,m=/(^|\/|\.)([a-z])/g,g=new r(1e3,e=>{const t=(e,t,n)=>n?`_${n.toUpperCase()}`:"",n=(e,t,n,r)=>t+(r?r.toUpperCase():""),r=e.split("/")
for(let i=0;i<r.length;i++)r[i]=r[i].replace(h,t).replace(f,n)
return r.join("/").replace(m,e=>e.toUpperCase())}),y=/([a-z\d])([A-Z]+)/g,v=/\-|\s+/g,b=new r(1e3,e=>e.replace(y,"$1_$2").replace(v,"_").toLowerCase()),x=/(^|\/)([a-z\u00C0-\u024F])/g,S=new r(1e3,e=>e.replace(x,e=>e.toUpperCase())),_=/([a-z\d])([A-Z])/g,C=new r(1e3,e=>e.replace(_,"$1_$2").toLowerCase())
function w(e){return e.split(/\s+/)}function T(e){return C.get(e)}function A(e){return c.get(e)}function I(e){return p.get(e)}function P(e){return g.get(e)}function B(e){return b.get(e)}function E(e){return S.get(e)}},77603(e,t,n){"use strict"
n.d(t,{A:()=>i,a:()=>a,b:()=>s,c:()=>c,d:()=>u,n:()=>l,s:()=>o})
var r=n(41113)
const i=(0,r.L1)("#[]",Symbol("#[]"))
function o(e){const t=e({wellknown:{Array:i}});(0,r.dV)("signalHooks",t)}function a(e,t){return(0,r.Yj)("signalHooks").createSignal(e,t)}function s(e){return(0,r.Yj)("signalHooks").consumeSignal(e)}function l(e){return(0,r.Yj)("signalHooks").notifySignal(e)}function c(e,t,n){return(0,r.Yj)("signalHooks").createMemo(e,t,n)}function u(){return(0,r.Yj)("signalHooks").willSyncFlushWatchers()}(0,r.L1)("#{}",Symbol("#{}"))},77675(e,t,n){"use strict"
function r(e,t,n){const r=new Float32Array(e)
for(let i=0;i<r.length;i++)r[i]=t+n*i
return r}n.d(t,{o:()=>r}),n(37411),n(52057)},77853(e,t,n){"use strict"
n.r(t),n.d(t,{default:()=>l,modifier:()=>u})
var r=n(32294),i=n(2377),o=n(31130)
function a(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e
var t=e[Symbol.toPrimitive]
if(void 0!==t){var n=t.call(e,"string")
if("object"!=typeof n)return n
throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e)
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class s{constructor(e){a(this,"capabilities",(0,i.capabilities)("3.22")),this.owner=e}createModifier(e,t){return{instance:new e(this.owner,t),element:null}}installModifier(e,t,n){const r=function(e,t){const n=e
return n.element=t,n}(e,t)
r.instance.modify(t,n.positional,n.named)}updateModifier(e,t){e.instance.modify(e.element,t.positional,t.named)}destroyModifier({instance:e}){(0,o.destroy)(e)}}class l{constructor(e,t){(0,r.setOwner)(this,e)}modify(e,t,n){}}(0,i.setModifierManager)(e=>new s(e),l)
const c=new class{constructor(){a(this,"capabilities",(0,i.capabilities)("3.22"))}createModifier(e){return{element:null,instance:e}}installModifier(e,t,n){const r=function(e,t){const n=e
return n.element=t,n}(e,t),{positional:i,named:o}=n,a=e.instance(t,i,o)
"function"==typeof a&&(r.teardown=a)}updateModifier(e,t){"function"==typeof e.teardown&&e.teardown()
const n=e.instance(e.element,t.positional,t.named)
"function"==typeof n&&(e.teardown=n)}destroyModifier(e){"function"==typeof e.teardown&&e.teardown()}getDebugName(e){return e.instance.toString()}getDebugInstance(e){return e}}
function u(e,t){return e.toString=()=>t?.name||e.name,(0,i.setModifierManager)(()=>c,e)}},78450(e,t,n){"use strict"
n.d(t,{Q:()=>r})
var r,i=n(96156),o=n(58558)
!function(e){function t(e,t){return n(e)(t)}function n(e){const t=e||l.root
let n
return n=void 0!==t.compile?t.compile():void 0!==(r=t).transform&&void 0!==r.status?l.byValue(t).compile():function(e){return"function"==typeof e}(t)?t:l.byRef(t).compile(),n
var r}e.select=t,e.compile=n
const r={select(e){return t(this,e||this.state)}}
function a(e,t){r[e]=function(...e){return t.call(void 0,this,...e)}}function s(e){return Object.create(r,{compile:{writable:!1,configurable:!1,value:e}})}let l
function c(e,t){const r=n(e)
return s(()=>e=>{const n=[]
for(const i of r(e))for(const r of t(i,e))n.push(r)
return n})}function u(e,t){const r=n(e)
return s(()=>e=>{const n=[]
for(const i of r(e)){const r=t(i,e)
r&&n.push(r)}return n})}function d(e){const t=n(e)
return s(()=>e=>{const n=new Set,r=[]
for(const i of t(e))i&&(n.has(i.transform.ref)||(n.add(i.transform.ref),r.push(i)))
return r})}function p(e){const t=n(e)
return s(()=>e=>{const n=t(e)
return n.length?[n[0]]:[]})}function h(e,t){return c(e,e=>t(e)?[e]:[])}function f(e,t){return h(e,e=>e.status===t)}function m(e,t){return h(e,e=>!!e.transform.tags&&e.transform.tags.indexOf(t)>=0)}function g(e){return c(e,(e,t)=>{const n=[]
return i.u.doPreOrder(t.tree,t.tree.transforms.get(e.transform.ref),n,(e,t,n)=>{n.push(e.ref)}),n.map(e=>t.cells.get(e))})}function y(e){return c(e,(e,t)=>{const n=[]
return t.tree.children.get(e.transform.ref).forEach(e=>n.push(t.cells.get(e))),n})}function v(e,t){return h(e,e=>!!e.obj&&e.obj.type===t.type)}function b(e,t){return d(u(e,(e,n)=>I(n.tree,n.cells,e.transform.ref,t)))}function x(e,t){return d(u(e,(e,n)=>E(n.tree,n.cells,e.transform.ref,t)))}function S(e,t){return d(u(e,(e,n)=>B(n.tree,n.cells,e.transform.ref,t)))}function _(e,t){return h(e,e=>e.transform.transformer===t)}function C(e,t){return d(u(e,(e,n)=>P(n.tree,n.cells,e.transform.ref,t)))}function w(e,t){return d(u(e,(e,n)=>k(n.tree,n.cells,e.transform.ref,t)))}function T(e){return d(u(e,(e,t)=>t.cells.get(t.tree.transforms.get(e.transform.ref).parent)))}function A(e,t,n,r,i){let a,s=e.transforms.get(n)
for(;;){s=e.transforms.get(s.parent)
const n=t.get(s.ref)
if(n.obj&&r(n)&&(a=n,i))return a
if(s.ref===o.C.RootRef)return a}}function I(e,t,n,r){return A(e,t,n,r,!0)}function P(e,t,n,r){return A(e,t,n,r,!1)}function B(e,t,n,r){return I(e,t,n,Array.isArray(r)?e=>r.indexOf(e.transform.transformer)>=0:e=>e.transform.transformer===r)}function E(e,t,n,r){return I(e,t,n,D(r))}function k(e,t,n,r){return P(e,t,n,D(r))}function D(e){return Array.isArray(e)?t=>{for(const n of e)if(n.type===t.obj.type)return!0}:t=>t.obj.type===e.type}function M(e,t,n){if(e.tags)for(const r of e.tags)if(n.tags.has(r)){n.refs[r]=e.ref
break}return!0}function R(e,t,n){return!(e.tags&&e.tags.indexOf(n.tag)>=0&&(n.ref=e.ref,1))}function O(e,t,n){if(e.tags){const t=n.tags.size
let r=0
for(const i of e.tags)if(n.tags.has(i)&&(r++,r===t)){n.refs.push(e)
break}}else 0===n.tags.size&&n.refs.push(e)}!function(e){function t(e,t,n){const r=n.cells.get(e.ref)
return!r||!r.obj||r.obj.type!==n.type||(n.roots.push(r),!1)}function n(e,t,n){const r=n.cells.get(e.ref)
return r&&r.obj&&r.obj.type===n.type&&n.ret.push(r),!0}function r(e,t,n){const r=n.cells.get(e.ref)
return r&&r.obj&&r.transform.transformer===n.t&&n.ret.push(r),!0}function a(e,t,n){const r=n.cells.get(e.ref)
return r&&"error"===r.status&&r.transform.transformer===n.t&&n.ret.push(r),!0}e.root=s(()=>e=>[e.cells.get(e.tree.root.ref)]),e.byRef=function(...e){return s(()=>t=>{const n=[]
for(const r of e){const e=t.cells.get(r)
e&&n.push(e)}return n})},e.byValue=function(...e){return s(()=>t=>e)},e.rootsOfType=function(e,n=o.C.RootRef){return s(()=>r=>{const o={roots:[],cells:r.cells,type:e.type}
return i.u.doPreOrder(r.tree,r.tree.transforms.get(n),o,t),o.roots})},e.ofType=function(e,t=o.C.RootRef){return s(()=>r=>{const o={ret:[],cells:r.cells,type:e.type}
return i.u.doPreOrder(r.tree,r.tree.transforms.get(t),o,n),o.ret})},e.ofTransformer=function(e,t=o.C.RootRef){return s(()=>n=>{const o={ret:[],cells:n.cells,t:e}
return i.u.doPreOrder(n.tree,n.tree.transforms.get(t),o,r),o.ret})},e.ofTransformerWithError=function(e,t=o.C.RootRef){return s(()=>n=>{const r={ret:[],cells:n.cells,t:e}
return i.u.doPreOrder(n.tree,n.tree.transforms.get(t),r,a),r.ret})}}(l=e.Generators||(e.Generators={})),a("flatMap",c),e.flatMap=c,a("mapObject",u),e.mapObject=u,a("unique",d),e.unique=d,a("first",p),e.first=p,a("filter",h),e.filter=h,a("withStatus",f),e.withStatus=f,a("withTag",m),e.withTag=m,a("subtree",g),e.subtree=g,a("children",y),e.children=y,a("ofType",v),e.ofType=v,a("ancestor",b),e.ancestor=b,a("ancestorOfType",x),e.ancestorOfType=x,a("ancestorWithTransformer",S),e.ancestorWithTransformer=S,a("withTransformer",_),e.withTransformer=_,a("root",C),e.root=C,a("rootOfType",w),e.rootOfType=w,a("parent",T),e.parent=T,e.findAncestor=I,e.findRoot=P,e.findAncestorWithTransformer=B,e.findAncestorOfType=E,e.findRootOfType=k,e.findUniqueTagsInSubtree=function(e,t,n){return i.u.doPreOrder(e,e.transforms.get(t),{refs:{},tags:n},M).refs},e.findTagInSubtree=function(e,t,n){return i.u.doPreOrder(e,e.transforms.get(t),{ref:void 0,tag:n},R).ref},e.findWithAllTags=function(e,t,n){return i.u.doPreOrder(e,e.transforms.get(t),{refs:[],tags:n},O).refs},e.tryFindDecorator=function e(t,n,r){if(t.transforms.get(n).transformer===r)return t.cells.get(n)
const i=t.tree.children.get(n)
if(1!==i.size)return
const o=i.first()
return o&&t.transforms.get(o).transformer.definition.isDecorator?e(t,o,r):void 0},e.getDecorated=function e(t,n){const r=t.tree.children.get(n)
if(1!==r.size)return t.cells.get(n)
const i=r.first()
return i&&t.transforms.get(i).transformer.definition.isDecorator?e(t,i):t.cells.get(n)}}(r||(r={}))},78660(e,t,n){"use strict"
var r
n.d(t,{t:()=>r}),function(e){e.create=function(){return{keys:new Set,array:[]}},e.add=function({keys:e,array:t},n,r){return!e.has(n)&&(e.add(n),t[t.length]=r,!0)},e.has=function({keys:e},t){return e.has(t)}}(r||(r={}))},78679(e,t,n){"use strict"
function r([e]){return Math.asin(e)}n.r(t),n.d(t,{asin:()=>r,default:()=>i})
var i=(0,n(10336).helper)(r)},79111(e,t,n){"use strict"
n.d(t,{$:()=>r.$,y:()=>r.y})
var r=n(99809)},80012(e,t,n){"use strict"
n.d(t,{J:()=>i})
var r=n(4800)
function i(e){return c({buffer:e,offset:0,dataView:new DataView(e.buffer)})}function o(e,t){const n={}
for(let r=0;r<t;r++)n[c(e)]=c(e)
return n}function a(e,t){const n=new Uint8Array(t),r=e.offset
for(let i=0;i<t;i++)n[i]=e.buffer[i+r]
return e.offset+=t,n}function s(e,t){const n=(0,r.ss)(e.buffer,e.offset,t)
return e.offset+=t,n}function l(e,t){const n=new Array(t)
for(let r=0;r<t;r++)n[r]=c(e)
return n}function c(e){const t=e.buffer[e.offset]
let n,r
if(!(128&t))return e.offset++,t
if(128==(240&t))return r=15&t,e.offset++,o(e,r)
if(144==(240&t))return r=15&t,e.offset++,l(e,r)
if(160==(224&t))return r=31&t,e.offset++,s(e,r)
if(!(224&~t))return n=e.dataView.getInt8(e.offset),e.offset++,n
switch(t){case 192:return e.offset++,null
case 194:return e.offset++,!1
case 195:return e.offset++,!0
case 196:return r=e.dataView.getUint8(e.offset+1),e.offset+=2,a(e,r)
case 197:return r=e.dataView.getUint16(e.offset+1),e.offset+=3,a(e,r)
case 198:return r=e.dataView.getUint32(e.offset+1),e.offset+=5,a(e,r)
case 202:return n=e.dataView.getFloat32(e.offset+1),e.offset+=5,n
case 203:return n=e.dataView.getFloat64(e.offset+1),e.offset+=9,n
case 204:return n=e.buffer[e.offset+1],e.offset+=2,n
case 205:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,n
case 206:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,n
case 208:return n=e.dataView.getInt8(e.offset+1),e.offset+=2,n
case 209:return n=e.dataView.getInt16(e.offset+1),e.offset+=3,n
case 210:return n=e.dataView.getInt32(e.offset+1),e.offset+=5,n
case 217:return r=e.dataView.getUint8(e.offset+1),e.offset+=2,s(e,r)
case 218:return r=e.dataView.getUint16(e.offset+1),e.offset+=3,s(e,r)
case 219:return r=e.dataView.getUint32(e.offset+1),e.offset+=5,s(e,r)
case 220:return r=e.dataView.getUint16(e.offset+1),e.offset+=3,l(e,r)
case 221:return r=e.dataView.getUint32(e.offset+1),e.offset+=5,l(e,r)
case 222:return r=e.dataView.getUint16(e.offset+1),e.offset+=3,o(e,r)
case 223:return r=e.dataView.getUint32(e.offset+1),e.offset+=5,o(e,r)}throw new Error("Unknown type 0x"+t.toString(16))}},80122(e,t,n){"use strict"
function r([e]){return Math.log(e)}n.r(t),n.d(t,{default:()=>i,logE:()=>r})
var i=(0,n(10336).helper)(r)},80178(e,t,n){"use strict"
n.d(t,{z:()=>h})
var r=n(48393),i=n(12288),o=n(14294),a=n(92384),s=n(32775),l=n(60566),c=n(39298),u=n(10212),d=n(91229)
const p={dynamicBonds:a.t.Optional(a.t.Boolean(!1,{description:"Ensure bonds are recalculated upon model changes. Also enables calculation of inter-unit bonds in water molecules and ions."}))}
var h
!function(e){async function t(e,t,n,i,o){let a
const s=u.i.Provider.get(n)
!i&&s&&0!==s.assemblies.length&&(i=s.assemblies[0].id),s&&0!==s.assemblies.length?(a=l.v.findAssembly(n,i||""),a||e.log.warn(`Model '${n.entryId}' has no assembly called '${i}', returning model structure.`)):e.log.warn(`Model '${n.entryId}' has no assembly, returning model structure.`)
const d=r.Structure.ofModel(n,o)
if(!a){const e={label:"Model",description:r.Structure.elementDescription(d)}
return new c.O.Molecule.Structure(d,e)}i=a.id
const p=await r.StructureSymmetry.buildAssembly(d,i).runInContext(t),h={label:`Assembly ${i}`,description:r.Structure.elementDescription(p)}
return new c.O.Molecule.Structure(p,h)}e.getParams=function(e,t){const n=e&&u.i.Provider.get(e),r=n?n.assemblies.map(e=>[e.id,`${e.id}: ${(0,i.Mk)(e.details)}`]):[],l=!n||!o.O8.isZero(n.spacegroup.cell),c=[]
if(n){const{operators:e}=n.spacegroup
for(let t=0,n=e.length;t<n;t++)c.push([t,`${t+1}: ${o.is.getOperatorXyz(e[t])}`])}const d=[]
e&&e.properties.structAsymMap.forEach(e=>{const t=e.id===e.auth_id?e.id:`${e.id} [auth ${e.auth_id}]`
d.push([e.id,t])})
const h={auto:a.t.Group(p),model:a.t.Group(p),assembly:a.t.Group({id:a.t.Optional(e?a.t.Select(r.length?r[0][0]:"",r,{label:"Asm Id",description:"Assembly Id"}):a.t.Text("",{label:"Asm Id",description:"Assembly Id (use empty for the 1st assembly)"})),...p},{isFlat:!0}),"symmetry-mates":a.t.Group({radius:a.t.Numeric(5,{min:0,max:50,step:1}),...p},{isFlat:!0}),symmetry:a.t.Group({ijkMin:a.t.Vec3(s.eB.create(-1,-1,-1),{step:1},{label:"Min IJK",fieldLabels:{x:"I",y:"J",z:"K"}}),ijkMax:a.t.Vec3(s.eB.create(1,1,1),{step:1},{label:"Max IJK",fieldLabels:{x:"I",y:"J",z:"K"}}),...p},{isFlat:!0}),"symmetry-assembly":a.t.Group({generators:a.t.ObjectList({operators:a.t.ObjectList({index:a.t.Select(0,c),shift:a.t.Vec3((0,s.eB)(),{step:1},{label:"IJK",fieldLabels:{x:"I",y:"J",z:"K"}})},e=>`${e.index+1}_${e.shift.map(e=>e+5).join("")}`,{defaultValue:[]}),asymIds:a.t.MultiSelect([],d)},e=>`${e.asymIds.length} asym ids, ${e.operators.length} operators`,{defaultValue:[]}),...p},{isFlat:!0})},f=[]
return"auto"===t&&f.push(["auto","Auto"]),f.push(["model","Model"]),r.length>0&&f.push(["assembly","Assembly"]),l&&(f.push(["symmetry-mates","Symmetry Mates"]),f.push(["symmetry","Symmetry (indices)"]),f.push(["symmetry-assembly","Symmetry (assembly)"])),{type:a.t.MappedStatic(t||"model",h,{options:f})}},e.canAutoUpdate=function(e,t){return"symmetry-assembly"!==t.name&&("symmetry"!==t.name||"symmetry"!==e.name)},e.create=async function(e,n,i,o){const a=null==o?void 0:o.params,s=u.i.Provider.get(i)
if(!s||!o||"model"===o.name){const e=r.Structure.ofModel(i,a)
return new c.O.Molecule.Structure(e,{label:"Model",description:r.Structure.elementDescription(e)})}if("auto"===o.name){if(0===s.assemblies.length){const e=r.Structure.ofModel(i,a)
return new c.O.Molecule.Structure(e,{label:"Model",description:r.Structure.elementDescription(e)})}return t(e,n,i,void 0,a)}return"assembly"===o.name?t(e,n,i,o.params.id,a):"symmetry"===o.name?async function(e,t,n,i,o){const a=r.Structure.ofModel(t,o),s=await r.StructureSymmetry.buildSymmetryRange(a,n,i).runInContext(e),l={label:`Symmetry [${n}] to [${i}]`,description:r.Structure.elementDescription(s)}
return new c.O.Molecule.Structure(s,l)}(n,i,o.params.ijkMin,o.params.ijkMax,a):"symmetry-mates"===o.name?async function(e,t,n,i){const o=r.Structure.ofModel(t,i),a=await r.StructureSymmetry.builderSymmetryMates(o,n).runInContext(e),s={label:"Symmetry Mates",description:r.Structure.elementDescription(a)}
return new c.O.Molecule.Structure(a,s)}(n,i,o.params.radius,a):"symmetry-assembly"===o.name?async function(e,t,n,i,o){const a=r.Structure.ofModel(t,o),s=await r.StructureSymmetry.buildSymmetryAssembly(a,n,i).runInContext(e),l={label:"Symmetry Assembly",description:r.Structure.elementDescription(s)}
return new c.O.Molecule.Structure(s,l)}(n,i,o.params.generators,s,a):void(0,d.dr)(o)}}(h||(h={}))},80191(e,t,n){"use strict"
n.d(t,{P:()=>a,q:()=>s})
const r=(0,n(41113).vs)("WarpDriveRuntimeConfig",{debug:{}}),i=function(){try{return globalThis.sessionStorage}catch{return}}(),o=i?.getItem("WarpDriveRuntimeConfig")
function a(){return r}function s(e){Object.assign(r.debug,e),i?.setItem("WarpDriveRuntimeConfig",JSON.stringify(r))}o&&Object.assign(r,JSON.parse(o))},80509(e,t,n){"use strict"
n.r(t),n.d(t,{renderReact18:()=>i})
var r=n(70188)
function i(e,t){(0,r.createRoot)(t).render(e)}},80813(e,t,n){"use strict"
n.d(t,{IQ:()=>s,xv:()=>a})
var r,i=n(9959)
!function(e){e.create=function(e){return{ref:e}},e.set=function(e,t){return e.ref=t,e}}(r||(r={}))
const o=(0,i.q)(0,2147483647)
var a,s
!function(e){e.create=function(e,t){return{id:o(),version:0,value:e,metadata:t}},e.withValue=function(e,t){return{id:e.id,version:e.version+1,value:t,metadata:e.metadata}}}(a||(a={})),function(e){function t(e,t){return r.set(e,a.withValue(e.ref,t))}e.create=function(e,t){return r.create(a.create(e,t))},e.update=t,e.set=function(e,t){return r.set(e,t)},e.updateIfChanged=function(e,n){return e.ref.value!==n?t(e,n):e}}(s||(s={}))},80856(e,t,n){"use strict"
n.d(t,{Fu:()=>d,K8:()=>f,ki:()=>h,oq:()=>p,xB:()=>u})
var r=n(9959),i=n(91229),o=n(24060),a=n(31683)
const s=(0,r.q)()
function l(e){const t=e.createBuffer()
if(null===t)throw new Error("Could not create WebGL buffer")
return t}function c(e,t,n,r){let a=l(e)
const c=function(e,t){switch(t){case"static":return e.STATIC_DRAW
case"dynamic":return e.DYNAMIC_DRAW
case"stream":return e.STREAM_DRAW
default:(0,i.dr)(t)}}(e,n),u=function(e,t){switch(t){case"attribute":return e.ARRAY_BUFFER
case"elements":return e.ELEMENT_ARRAY_BUFFER
case"uniform":if((0,o.C6)(e))return e.UNIFORM_BUFFER
throw new Error("WebGL2 is required for uniform buffers")
case"pixel-pack":if((0,o.C6)(e))return e.PIXEL_PACK_BUFFER
throw new Error("WebGL2 is required for pixel-pack buffers")}}(e,r),d=function(e,t){return t instanceof Uint8Array?e.UNSIGNED_BYTE:t instanceof Int8Array?e.BYTE:t instanceof Uint16Array?e.UNSIGNED_SHORT:t instanceof Int16Array?e.SHORT:t instanceof Uint32Array?e.UNSIGNED_INT:t instanceof Int32Array?e.INT:t instanceof Float32Array?e.FLOAT:void(0,i.dr)(t)}(e,t),p=t.BYTES_PER_ELEMENT,h=t.length
function f(t){e.bindBuffer(u,a),e.bufferData(u,t,c)}f(t)
let m=!1
return{id:s(),_usageHint:c,_bufferType:u,_dataType:d,_bpe:p,length:h,getByteCount:()=>p*h,getBuffer:()=>a,updateData:f,updateSubData:(t,n,r)=>{e.bindBuffer(u,a),r-n===t.length?e.bufferSubData(u,0,t):e.bufferSubData(u,n*p,t.subarray(n,n+r))},reset:()=>{a=l(e),f(t)},destroy:()=>{m||(e.deleteBuffer(a),m=!0)}}}function u(e,t,n){if("float32"===t)switch(n){case 1:return e.FLOAT
case 2:return e.FLOAT_VEC2
case 3:return e.FLOAT_VEC3
case 4:return e.FLOAT_VEC4
case 16:return e.FLOAT_MAT4}(0,i.dr)(t)}function d(e,t,n,r,i,o,a="static"){const{instancedArrays:s}=n,l=c(e,r,a,"attribute"),{_bufferType:u,_dataType:d,_bpe:p}=l
return{...l,divisor:o,bind:n=>{if(e.bindBuffer(u,l.getBuffer()),16===i)for(let r=0;r<4;++r)t.enableVertexAttrib(n+r),e.vertexAttribPointer(n+r,4,d,!1,16*p,4*r*p),s.vertexAttribDivisor(n+r,o)
else t.enableVertexAttrib(n),e.vertexAttribPointer(n,i,d,!1,0,0),s.vertexAttribDivisor(n,o)},changeOffset:(t,n)=>{const r=n*p*i
if(e.bindBuffer(u,l.getBuffer()),16===i)for(let i=0;i<4;++i)e.vertexAttribPointer(t+i,4,d,!1,16*p,4*i*p+r)
else e.vertexAttribPointer(t,i,d,!1,0,r)}}}function p(e,t,n){const r=[]
return Object.keys(t).forEach(i=>{const o=t[i]
"attribute"===o.type&&(r[r.length]=[i,e.resources.attribute(n[i].ref.value,o.itemSize,o.divisor)])}),r}function h(e,t,n="static"){const r=c(e,t,n,"elements")
return{...r,bind:()=>{e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r.getBuffer())}}}function f(e,t,n,r){let i=l(e)
const o=(0,a.Pw)(e,t,r),c=(0,a.gV)(e,n,r),u=(0,a.Zb)(n,r)
let d=0,p=0,h=!1
return{id:s(),_type:o,_format:c,_bpe:u,getByteCount:()=>u*d*p,read:function(t,n,r,a){d=r,p=a,e.bindBuffer(e.PIXEL_PACK_BUFFER,i),e.bufferData(e.PIXEL_PACK_BUFFER,r*a*u,e.STREAM_READ),e.readPixels(t,n,r,a,c,o,0),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)},getSubData:function(t){e.bindBuffer(e.PIXEL_PACK_BUFFER,i),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,t),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)},reset:()=>{i=l(e)},destroy:()=>{h||(e.deleteBuffer(i),h=!0)}}}},81357(e,t,n){"use strict"
n.d(t,{l:()=>r})
var r="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"},81444(e,t,n){"use strict"
n.d(t,{Ny:()=>z,O$:()=>U,PJ:()=>O,Pi:()=>j,Pv:()=>E,Te:()=>B,Vb:()=>R,fm:()=>L,ii:()=>V,lm:()=>M,qg:()=>k,uF:()=>D,zK:()=>F,zj:()=>N})
var r=n(48393),i=n(17684),o=n(22703),a=n(3111),s=n(7221),l=n(23729),c=n(89),u=n(67538),d=n(41036),p=n(42529),h=n(17782),f=n(40038),m=n(9043),g=n(68187),y=n(65081),v=n(10596),b=n(55165),x=n(32520),S=n(47404),_=n(65580),C=n(30084),w=(n(88524),n(40362)),T=n(70948),A=(n(71712),n(31312)),I=n(91229)
function P(e,t){const{defaultProps:n,createGeometry:v,createLocationIterator:x,getLoci:S,eachLocation:_,setUpdateState:C,initUpdateState:w,mustRecreate:T,processValues:A,dispose:P}=e,{createEmpty:B,updateValues:E,updateBoundingSphere:k,updateRenderableState:D,createPositionIterator:M}=e.geometryUtils,R=d.rj.create(),O={loci:c.EmptyLoci,action:f.xi.None,status:-1}
let L,N,F,z,j,V,U,G,H=Object.assign({},n),q=a.S.createEmpty(),Q=-1
function $(e){if(R.createNew){if(U=x(N,H),!e)throw new Error("expected geometry to be given")
L=function(e,t,n,r,i,a){const{createValues:c,createRenderableState:u}=o.V.getUtils(t),d=c(t,(0,s.yS)(e,i.includeParent,t.boundingSphere,i.cellSize,i.batchSize),n,r,i),p=u(i)
return(0,l.o)(t.kind,d,p,a)}(N,e,U,q,H,t),G=M(e,L.values)}else{if(!L)throw new Error("expected renderObject to be available")
if((R.updateColor||R.updateSize||R.updateTransform)&&(U=x(N,H)),R.updateTransform){const{instanceCount:e,groupCount:t}=U
H.instanceGranularity?(0,h.Km)(e,"instance",L.values):(0,h.Km)(e*t,"groupInstance",L.values)}if(R.updateMatrix&&((0,s.yS)(N,H.includeParent,(null==e?void 0:e.boundingSphere)||L.values.invariantBoundingSphere.ref.value,H.cellSize,H.batchSize,L.values),"lodLevels"in L.values&&m.IQ.update(L.values.lodLevels,L.values.lodLevels.ref.value)),R.createGeometry){if(!e)throw new Error("expected geometry to be given")
m.IQ.updateIfChanged(L.values.drawCount,o.V.getDrawCount(e)),m.IQ.updateIfChanged(L.values.uVertexCount,o.V.getVertexCount(e)),m.IQ.updateIfChanged(L.values.uGroupCount,U.groupCount)}(R.updateTransform||R.createGeometry)&&(k(L.values,e||V),G=M(e||V,L.values)),R.updateSize&&"uSize"in L.values&&(0,g.v3)(U,q.size,L.values),R.updateColor&&(0,y.D1)(U,G,q.color,L.values),E(L.values,H),D(L.state,H)}F=H,z=q,j=N,e&&(V=e,Q+=1)}function X(e,t,n){return function(e){return!!(0,c.isEveryLoci)(e)||!(!r.Structure.isLoci(e)||!r.Structure.areRootsEquivalent(e.structure,j.structure))||!!(r.StructureElement.Loci.is(e)&&r.Structure.areRootsEquivalent(e.structure,j.structure)&&r.StructureElement.Loci.isWholeStructure(e))}(e)?F.instanceGranularity?t(u.IX.ofBounds(0,U.instanceCount)):t(u.IX.ofBounds(0,U.groupCount*U.instanceCount)):F.instanceGranularity?function(e,t,n){let i=!1
if(r.Bond.isLoci(e)){const{structure:o,group:a}=t
if(!r.Structure.areEquivalent(e.structure,o))return!1
for(const t of e.bonds){if(t.aUnit!==t.bUnit)continue
const e=a.unitIndexMap.get(t.aUnit.id)
void 0!==e&&n(u.IX.ofSingleton(e))&&(i=!0)}}else if(r.StructureElement.Loci.is(e)){const{structure:o,group:a}=t
if(!r.Structure.areEquivalent(e.structure,o))return!1
for(const t of e.elements){const e=a.unitIndexMap.get(t.unit.id)
void 0!==e&&n(u.IX.ofSingleton(e))&&(i=!0)}}return i}(e,j,t):_(e,j,t,n)}function W(e){L&&(null==A||A(L.values,V,F,z,e.webgl))}return{get groupCount(){return U?U.count:0},get renderObject(){return U&&U.count?L:void 0},get geometryVersion(){return Q},createOrUpdate(e,t,n,i){if(function(e,t,n){if(!n&&!j)throw new Error("missing structureGroup")
if(H=t,q=e,N=n,d.rj.reset(R),!L||!j)return null==w||w(R,H,q,N),R.createNew=!0,void(R.createGeometry=!0)
C(R,H,F,q,z,N,j),r.Structure.areHierarchiesEqual(j.structure,N.structure)||(R.updateTransform=!0,R.updateColor=!0,R.updateSize=!0),p.J.areEqual(q.color,z.color)||(R.updateColor=!0),b.F.areEqual(q.size,z.size)||(R.updateSize=!0),j.structure.child!==N.structure.child&&(R.createGeometry=!0,R.updateTransform=!0),H.instanceGranularity===F.instanceGranularity&&H.cellSize===F.cellSize&&H.batchSize===F.batchSize||(R.updateTransform=!0),(0,m.bD)(H.unitKinds,F.unitKinds)||(R.createGeometry=!0),N.group.transformHash!==j.group.transformHash&&(N.group.units.length!==j.group.units.length||R.updateColor?R.updateTransform=!0:R.updateMatrix=!0)
const i=N.group.units[0],o=j.group.units[0]
r.Unit.areOperatorsEqual(i,o)||(R.updateTransform=!0),r.Unit.areConformationsEqual(i,o)||(R.createGeometry=!0),R.updateTransform&&(R.updateMatrix=!0),R.updateSize&&!("uSize"in L.values)&&(R.createGeometry=!0),(R.createGeometry||R.updateTransform)&&(j.structure.hashCode!==N.structure.hashCode&&(R.updateColor=!0,R.updateSize=!0),(q.color.granularity.startsWith("vertex")||L.values.dColorType.ref.value.startsWith("vertex")||q.color.granularity.startsWith("volume")||L.values.dColorType.ref.value.startsWith("volume"))&&(R.updateColor=!0))}(t,n,i||j),R.createGeometry){const t=function(e,t,n,r,i,o){return(0,s.AR)(i.unitKinds,t)?v(e,t,n,r,i,o):B(o)}(e,N.group.units[0],N.structure,q,H,V)
if((0,I.$X)(t))return t.then(t=>{$(t),W(e)})
$(t)}else $()
W(e)},getLoci:e=>L?S(e,j,L.id):c.EmptyLoci,eachLocation(e){for(U.reset();U.hasNext;){const{location:t,isSecondary:n}=U.move()
e(t,n)}},mark(e,t){let n=!0
if(r.StructureElement.Loci.is(e)){n=!1
const{invariantId:t}=j.group.units[0]
for(const r of e.elements)if(r.unit.invariantId===t){n=!0
break}}return!!n&&i.b.mark(L,e,t,X,O)},setVisibility(e){i.b.setVisibility(L,e)},setAlphaFactor(e){i.b.setAlphaFactor(L,e)},setPickable(e){i.b.setPickable(L,e)},setColorOnly(e){i.b.setColorOnly(L,e)},setTransform(e,t){i.b.setTransform(L,e,t)},setOverpaint(e,t){const n={geometry:V,props:F,webgl:t}
i.b.setOverpaint(L,e,X,!0,n)},setTransparency(e,t){const n={geometry:V,props:F,webgl:t}
i.b.setTransparency(L,e,X,!0,n)},setEmissive(e,t){const n={geometry:V,props:F,webgl:t}
i.b.setEmissive(L,e,X,!0,n)},setSubstance(e,t){const n={geometry:V,props:F,webgl:t}
i.b.setSubstance(L,e,X,!0,n)},setClipping(e){i.b.setClipping(L,e,X,!0)},setThemeStrength(e){i.b.setThemeStrength(L,e)},destroy(){null==P||P(V),L&&(L.state.disposed=!0,L=void 0)},mustRecreate:T}}const B={...A.nF,...A.a2}
function E(e,t){return P({...e,setUpdateState:(t,n,r,i,o,a,s)=>{e.setUpdateState(t,n,r,i,o,a,s),b.F.areEqual(i.size,o.size)||(t.createGeometry=!0)},geometryUtils:v.e.Utils},t)}const k={...A.Op,...A.a2}
function D(e,t){return P({...e,setUpdateState:(t,n,r,i,o,a,s)=>{e.setUpdateState(t,n,r,i,o,a,s),b.F.areEqual(i.size,o.size)||(t.updateSize=!0)},geometryUtils:x.v.Utils},t)}const M={...A.DG,...A.a2}
function R(e,t){return P({...e,setUpdateState:(t,n,r,i,o,a,s)=>{e.setUpdateState(t,n,r,i,o,a,s),b.F.areEqual(i.size,o.size)||(t.updateSize=!0)},geometryUtils:S.S.Utils},t)}const O={...A.fy,...A.a2}
function L(e,t){return P({...e,setUpdateState:(t,n,r,i,o,a,s)=>{e.setUpdateState(t,n,r,i,o,a,s),b.F.areEqual(i.size,o.size)||(t.updateSize=!0)},geometryUtils:_.O.Utils},t)}const N={...A.Rb,...A.a2}
function F(e,t){return P({...e,setUpdateState:(t,n,r,i,o,a,s)=>{e.setUpdateState(t,n,r,i,o,a,s),b.F.areEqual(i.size,o.size)||(t.updateSize=!0)},geometryUtils:C.q.Utils},t)}A.xl,A.a2
const z={...A.Vv,...A.a2}
function j(e,t){return P({...e,setUpdateState:(t,n,r,i,o,a,s)=>{e.setUpdateState(t,n,r,i,o,a,s),b.F.areEqual(i.size,o.size)||(t.createGeometry=!0)},geometryUtils:w.E.Utils},t)}const V={...A.MQ,...A.a2}
function U(e,t){return P({...e,setUpdateState:(t,n,r,i,o,a,s)=>{e.setUpdateState(t,n,r,i,o,a,s),b.F.areEqual(i.size,o.size)||(t.createGeometry=!0)},geometryUtils:T.X.Utils},t)}A.nH,A.a2},81501(e,t,n){"use strict"
e.exports=n(18271)},81871(e,t,n){"use strict"
n.d(t,{FL:()=>a,ZC:()=>l,iQ:()=>o,tu:()=>s})
var r=n(32775),i=n(16159)
function o(e,t,n,r,o=!1,a=()=>!1,s){if(e%n!==0)throw new Error("incompatible groupCount and stride")
const l={location:i.LU,location2:i.LU,index:0,groupIndex:0,instanceIndex:0,isSecondary:!1}
let c=l.groupIndex<e,u=!1,d=0,p=0,h=!1
const f=!!s
return{get hasNext(){return c},get isNextNewInstance(){return u},groupCount:e,instanceCount:t,count:e*t,stride:n,nonInstanceable:o,hasLocation2:f,move:()=>(c&&(l.groupIndex=d,l.instanceIndex=p,l.index=p*e+d,l.location=r(d,h?-1:p),f&&(l.location2=s(d,h?-1:p)),l.isSecondary=a(d,h?-1:p),d+=n,d===e?(++p,u=!0,p<t&&(d=0)):u=!1,c=d<e),l),reset(){l.location=i.LU,l.location2=i.LU,l.index=0,l.groupIndex=0,l.instanceIndex=0,l.isSecondary=!1,c=l.groupIndex<e,u=!1,d=0,p=0,h=!1},skipInstance(){c&&l.instanceIndex===p&&(++p,d=0,c=p<t)},voidInstances(){h=!0}}}const a={get hasNext(){return!1},get isNextNewInstance(){return!1},groupCount:0,instanceCount:0,count:0,stride:0,nonInstanceable:!1,hasLocation2:!1,move:()=>({location:i.LU,location2:i.LU,index:0,groupIndex:0,instanceIndex:0,isSecondary:!1}),reset(){},skipInstance(){},voidInstances(){}}
function s(e,t){return{kind:"position-location",position:e?r.eB.clone(e):(0,r.eB)(),normal:t?r.eB.clone(t):(0,r.eB)()}}function l(e){return!!e&&"position-location"===e.kind}},81916(e,t,n){"use strict"
n.d(t,{HR:()=>i,br:()=>a,ec:()=>o})
var r=n(6941)
function i(e,t,n){return(0,r.EX)("",e,t,n)}function o(e){l("","",e)}function a(e){const t=[]
return c(e,t),t}function s(e){const t=/([a-z])([A-Z])([a-z]|$)/g
return e.replace(t,(e,t,n,r)=>`${t}-${n.toLocaleLowerCase()}${r}`).replace(t,(e,t,n,r)=>`${t}-${n.toLocaleLowerCase()}${r}`)}function l(e,t,n){if((0,r.Bm)(n))return n.info.namespace=e,n.info.name=n.info.name||s(t),void(n.id=`${n.info.namespace}.${n.info.name}`)
const i=`${n["@namespace"]||s(t)}`,o=e?`${e}.${i}`:i
for(const a of Object.keys(n))("object"==typeof n[a]||(0,r.Bm)(n[a]))&&l(o,a,n[a])}function c(e,t){if((0,r.Bm)(e))t.push(e)
else for(const n of Object.keys(e))("object"==typeof e[n]||(0,r.Bm)(e[n]))&&c(e[n],t)}},81972(e,t,n){"use strict"
function r([e]){return Math.acosh(e)}n.r(t),n.d(t,{acosh:()=>r,default:()=>i})
var i=(0,n(10336).helper)(r)},82094(e,t,n){"use strict"
n.d(t,{E:()=>u})
var r=n(67679),i=n(52057),o=n(32775),a=n(67538),s=n(26028),l=n(28269),c=n(55920)
function u(e,t,n){return new d(e,t,n)}class d{find(e,t,n,r,i){this.ctx.x=e,this.ctx.y=t,this.ctx.z=n,this.ctx.radius=r,this.ctx.isCheck=!1
const o=null!=i?i:this.result
return h(this.ctx,o),o}nearest(e,t,n,s=1,l,u){this.ctx.x=e,this.ctx.y=t,this.ctx.z=n,this.ctx.k=s,this.ctx.stopIf=l
const d=null!=u?u:this.result
return function(e,t){const{min:n,expandedBox:s,boundingSphere:{center:l},size:[u,d,p],bucketOffset:h,bucketCounts:f,bucketArray:_,grid:C,data:{x:w,y:T,z:A,indices:I,radius:P},delta:B,maxRadius:E}=e.grid,{x:k,y:D,z:M,k:R,stopIf:O}=e,L=a.CD.size(I)
if(r.Q.reset(t),0===L||R<=0)return!1
let N,F,z,j,V=!1,U=1,G=!0,H=0,q=v,Q=b,$=0,X=!0,W=!1
const Y=x,Z=E*E
q.length=0,Y.length=0,g.clear(),S.clear(),o.eB.set(m.origin,k,D,M),i.D.containsVec3(s,m.origin)?(N=Math.floor((k-n[0])/B[0]),F=Math.floor((D-n[1])/B[1]),z=Math.floor((M-n[2])/B[2])):(c.U.targetTo(m,m,l),c.U.intersectBox3D(m.origin,m,s),N=Math.max(0,Math.min(u-1,Math.floor((m.origin[0]-n[0])/B[0]))),F=Math.max(0,Math.min(d-1,Math.floor((m.origin[1]-n[1])/B[1]))),z=Math.max(0,Math.min(p-1,Math.floor((m.origin[2]-n[2])/B[2]))))
const K=0!==E?Math.max(1,Math.min(u-1,Math.ceil(E/B[0]))):1,J=0!==E?Math.max(1,Math.min(d-1,Math.ceil(E/B[1]))):1,ee=0!==E?Math.max(1,Math.min(p-1,Math.ceil(E/B[2]))):1
for(q.push(N,F,z,(N*d+F)*p+z);t.count<L;){const e=4*U
for(let t=0;t<e;t+=4)if(j=q[t+3],!g.has(j)){g.add(j),W=g.size>=C.length
const e=C[j]
if(0!==e){const t=$,n=e-1,r=h[n],i=r+f[n]
for(let e=r;e<i;e++){const t=_[e],n=a.CD.getAt(I,t),r=w[n]-k,i=T[n]-D,o=A[n]-M
let s=r*r+i*i+o*o
if(0!==E){const e=P[n]
s-=e*e}X&&s>$&&($=s),S.insert(s,t)}t<$&&(X=!1)}}Q.length=0,H=0,y.clear()
for(let t=0;t<e;t+=4){N=q[t],F=q[t+1],z=q[t+2]
for(let e=-K;e<=K;e++){const t=N+e
if(!(t<0||t>=u))for(let e=-J;e<=J;e++){const r=F+e
if(!(r<0||r>=d))for(let e=-ee;e<=ee;e++){const i=z+e
if(!(i<0||i>=p||(j=(t*d+r)*p+i,y.has(j)||(y.add(j),g.has(j))))){if(!G){const e=n[0]+t*B[0]-k,o=n[1]+r*B[1]-D,a=n[2]+i*B[2]-M
if(e*e+o*o+a*a-Z>$){Y.push(t,r,i,j)
continue}}Q.push(t,r,i,j),H++}}}}}if(G=!1,0===H){if(1===R){const e=S.findMinimum()
if(e){const{key:n,value:i}=e
return r.Q.add(t,i,n),!0}}else for(;!S.isEmpty()&&(W||S.findMinimum().key<=$)&&t.count<R;){const e=S.extractMinimum(),n=e.key,i=e.value
r.Q.add(t,i,n),O&&!V&&(V=O(i,n))}if(t.count>=R||V||t.count>=L)return t.count>0
if(G=!0,X=!0,Y.length>0){for(let e=0,t=Y.length;e<t;e++)q.push(Y[e])
Y.length=0,U=q.length}}else{const e=q
q=Q,Q=e,U=H}}t.count}(this.ctx,d),d}check(e,t,n,r){return this.ctx.x=e,this.ctx.y=t,this.ctx.z=n,this.ctx.radius=r,this.ctx.isCheck=!0,h(this.ctx,this.result)}approxNearest(e,t,n,i,o){this.ctx.x=e,this.ctx.y=t,this.ctx.z=n,this.ctx.radius=i,this.ctx.isCheck=!1
const s=null!=o?o:this.result
return function(e,t){const{min:n,size:[i,o,s],bucketOffset:l,bucketCounts:c,bucketArray:u,grid:d,data:{x:p,y:h,z:m,indices:g},delta:y}=e.grid,{radius:v,x:b,y:x,z:S}=e,_=v*v
r.Q.reset(t)
const C=Math.max(0,Math.floor((b-v-n[0])/y[0])),w=Math.max(0,Math.floor((x-v-n[1])/y[1])),T=Math.max(0,Math.floor((S-v-n[2])/y[2])),A=Math.min(i-1,Math.floor((b+v-n[0])/y[0])),I=Math.min(o-1,Math.floor((x+v-n[1])/y[1])),P=Math.min(s-1,Math.floor((S+v-n[2])/y[2]))
if(C>A||w>I||T>P)return!1
const B=Math.floor((b-n[0])/y[0]),E=Math.floor((x-n[1])/y[1]),k=Math.floor((S-n[2])/y[2]),D=f(Math.max(A-C,I-w,P-T)+1)
for(let f=0,M=D.length;f<M;f+=3){const e=B+D[f],n=E+D[f+1],i=k+D[f+2]
if(e<C||e>A||n<w||n>I||i<T||i>P)continue
const y=d[(e*o+n)*s+i]
if(0===y)continue
const v=y-1,M=l[v],R=M+c[v]
let O=Number.MAX_VALUE
for(let o=M;o<R;o++){const e=a.CD.getAt(g,u[o]),n=p[e]-b,i=h[e]-x,s=m[e]-S,l=n*n+i*i+s*s
l<=_&&l<O&&(r.Q.add(t,u[o],l),O=l)}if(O!==Number.MAX_VALUE)return!0}t.count}(this.ctx,s),s}constructor(e,t,n){const s=function(e,t,n){const r=i.D.expand((0,i.D)(),t.box,o.eB.create(.5,.5,.5)),{indices:s}=e,l=i.D.size((0,o.eB)(),r)
let c,u
const d=a.CD.size(s),h="number"==typeof n?n:32,f=Array.isArray(n)&&n
if(f&&!o.eB.isZero(f))u=[Math.ceil(l[0]/f[0]),Math.ceil(l[1]/f[1]),Math.ceil(l[2]/f[2])],c=f
else if(d>0){const e=Math.ceil(d/h),t=Math.pow(e/(l[0]*l[1]*l[2]),1/3)
u=[Math.ceil(l[0]*t),Math.ceil(l[1]*t),Math.ceil(l[2]*t)],c=[l[0]/u[0],l[1]/u[1],l[2]/u[2]]}else c=l,u=[1,1,1]
const m=u[0]*u[1]*u[2]
if(m>p){const e=Math.cbrt(m/p)
u=[Math.ceil(u[0]/e),Math.ceil(u[1]/e),Math.ceil(u[2]/e)],c=[l[0]/u[0],l[1]/u[1],l[2]/u[2]]}return function(e){const{expandedBox:t,size:[n,r,i],data:{x:o,y:s,z:l,radius:c,indices:u},elementCount:d,delta:p}=e,h=n*r*i,{min:[f,m,g]}=t
let y=0,v=0
const b=new Uint32Array(h),x=new Int32Array(d)
for(let T=0;T<d;T++){const e=a.CD.getAt(u,T),t=(Math.floor((o[e]-f)/p[0])*r+Math.floor((s[e]-m)/p[1]))*i+Math.floor((l[e]-g)/p[2])
1===(b[t]+=1)&&(v+=1),x[T]=t}if(c)for(let T=0;T<d;T++){const e=a.CD.getAt(u,T)
c[e]>y&&(y=c[e])}const S=new Int32Array(v)
for(let a=0,T=0;a<h;a++){const e=b[a]
e>0&&(b[a]=T+1,S[T]=e,T+=1)}const _=new Uint32Array(v)
for(let a=1;a<v;++a)_[a]+=_[a-1]+S[a-1]
const C=new Int32Array(v),w=new Int32Array(d)
for(let a=0;a<d;a++){const e=b[x[a]]
if(e>0){const t=e-1
w[_[t]+C[t]]=a,C[t]+=1}}return{size:e.size,bucketArray:w,bucketCounts:S,bucketOffset:_,grid:b,delta:p,min:e.expandedBox.min,data:e.data,maxRadius:y,expandedBox:e.expandedBox,boundingBox:e.boundingBox,boundingSphere:e.boundingSphere}}({size:u,data:{x:e.x,y:e.y,z:e.z,indices:s,radius:e.radius},expandedBox:r,boundingBox:t.box,boundingSphere:t.sphere,elementCount:d,delta:c})}(e,t,n)
this.ctx={grid:s,x:.1,y:.1,z:.1,k:1,stopIf:void 0,radius:.1,isCheck:!1},this.boundary={box:s.boundingBox,sphere:s.boundingSphere},this.buckets={offset:s.bucketOffset,count:s.bucketCounts,array:s.bucketArray},this.result=r.Q.create()}}const p=2**24
function h(e,t){const{min:n,size:[i,o,s],bucketOffset:l,bucketCounts:c,bucketArray:u,grid:d,data:{x:p,y:h,z:f,indices:m,radius:g},delta:y,maxRadius:v}=e.grid,{radius:b,isCheck:x,x:S,y:_,z:C}=e,w=b+v,T=w*w
r.Q.reset(t)
const A=Math.max(0,Math.floor((S-w-n[0])/y[0])),I=Math.max(0,Math.floor((_-w-n[1])/y[1])),P=Math.max(0,Math.floor((C-w-n[2])/y[2])),B=Math.min(i-1,Math.floor((S+w-n[0])/y[0])),E=Math.min(o-1,Math.floor((_+w-n[1])/y[1])),k=Math.min(s-1,Math.floor((C+w-n[2])/y[2]))
if(A>B||I>E||P>k)return!1
for(let D=A;D<=B;D++)for(let e=I;e<=E;e++)for(let n=P;n<=k;n++){const i=d[(D*o+e)*s+n]
if(0===i)continue
const y=i-1,w=l[y],A=w+c[y]
for(let e=w;e<A;e++){const n=a.CD.getAt(m,u[e]),i=p[n]-S,o=h[n]-_,s=f[n]-C,l=i*i+o*o+s*s
if(l<=T){if(v>0&&Math.sqrt(l)-g[n]>b)continue
if(x)return!0
r.Q.add(t,u[e],l)}}}return t.count>0}const f=(0,l.E)(function(e){const t=[],n=2*e+1
for(let r=0;r<n;++r)for(let i=0;i<n;++i)for(let a=0;a<n;++a)t.push(o.eB.create(r-e,i-e,a-e))
return t.sort((e,t)=>o.eB.squaredMagnitude(e)-o.eB.squaredMagnitude(t)),t.flat()}),m=(0,c.U)(),g=new Set,y=new Set,v=[.1],b=[.1],x=[.1],S=new s.h},82139(e,t,n){"use strict"
function r(e,t){let n=e.load(t)
if(!n)throw new Error(t+" must export an initializer.")
let r=n.default
if(!r)throw new Error(t+" must have a default export")
return r.name||(r.name=t.slice(t.lastIndexOf("/")+1)),r}function i(e,t,n){var i=t+"/initializers/",o=t+"/instance-initializers/",a=[],s=[]
let l
l=n?{names:()=>Object.keys(n),load:e=>n[e]}:{names(){let e=globalThis.requirejs
if(!e||!e._eak_seen)throw new Error("No global AMD loader found. To use loadInitializers without a global AMD loader you must provide explicit modules")
return Object.keys(e._eak_seen)},load:e=>globalThis.require(e,null,null,!0)}
for(let r of l.names())r.startsWith(i)&&!r.endsWith("-test")?a.push(r):r.startsWith(o)&&!r.endsWith("-test")&&s.push(r)
!function(e,t,n){for(let i of n)e.initializer(r(t,i))}(e,l,a),function(e,t,n){for(let i of n)e.instanceInitializer(r(t,i))}(e,l,s)}n.r(t),n.d(t,{default:()=>i})},83040(e,t,n){"use strict"
n.d(t,{V:()=>r})
var r,i=n(20924),o=n(42095),a=n(97016)
function s(e,t,n,o){return{schema:n,__array:void 0,isDefined:o===r.ValueKinds.Present,rowCount:t,value:t=>e,valueKind:e=>o,toArray:n=>{const{array:r}=i.createArray(t,n)
for(let t=0,i=r.length;t<i;t++)r[t]=e
return r},areValuesEqual:(e,t)=>!0}}function l({value:e,valueKind:t,areValuesEqual:n,rowCount:o,schema:a}){return{schema:a,__array:void 0,isDefined:!0,rowCount:o,value:e,valueKind:t||(e=>r.ValueKinds.Present),toArray:t=>{const{array:n,start:r}=i.createArray(o,t)
for(let i=0,o=n.length;i<o;i++)n[i]=e(i+r)
return n},areValuesEqual:n||((t,n)=>e(t)===e(n))}}function c({array:e,schema:t,valueKind:n}){const o=e.length,a=t.T,s="str"===t.valueType?"lowercase"===t.transform?t=>{const n=e[t]
return"string"==typeof n?n.toLowerCase():`${null!=n?n:a}`.toLowerCase()}:"uppercase"===t.transform?t=>{const n=e[t]
return"string"==typeof n?n.toUpperCase():`${null!=n?n:a}`.toUpperCase()}:t=>{const n=e[t]
return"string"==typeof n?n:`${null!=n?n:a}`}:t=>e[t],l=i.isTypedArray(e)
return{schema:t,__array:e,isDefined:!0,rowCount:o,value:s,valueKind:n||(e=>r.ValueKinds.Present),toArray:"str"===t.valueType?"lowercase"===t.transform?t=>{const{start:n,end:r}=i.getArrayBounds(o,t),s=new(t&&void 0!==t.array?t.array:e.constructor)(r-n)
for(let i=0,o=r-n;i<o;i++){const t=e[n+i]
s[i]="string"==typeof t?t.toLowerCase():`${null!=t?t:a}`.toLowerCase()}return s}:"uppercase"===t.transform?t=>{const{start:n,end:r}=i.getArrayBounds(o,t),s=new(t&&void 0!==t.array?t.array:e.constructor)(r-n)
for(let i=0,o=r-n;i<o;i++){const t=e[n+i]
s[i]="string"==typeof t?t.toUpperCase():`${null!=t?t:a}`.toUpperCase()}return s}:t=>{const{start:n,end:r}=i.getArrayBounds(o,t),s=new(t&&void 0!==t.array?t.array:e.constructor)(r-n)
for(let i=0,o=r-n;i<o;i++){const t=e[n+i]
s[i]="string"==typeof t?t:`${null!=t?t:a}`}return s}:l?t=>i.typedArrayWindow(e,t):t=>{const{start:n,end:r}=i.getArrayBounds(o,t)
if(0===n&&r===e.length)return e
const a=new(t&&void 0!==t.array?t.array:e.constructor)(r-n)
for(let i=0,o=r-n;i<o;i++)a[i]=e[n+i]
return a},areValuesEqual:(t,n)=>e[t]===e[n]}}function u(e,t,n){return e.isDefined?0===t&&n===e.rowCount?e:e.__array&&i.isTypedArray(e.__array)?function(e,t,n){const r=i.typedArrayWindow(e.__array,{start:t,end:n}),o=e.valueKind
return c({array:r,schema:e.schema,valueKind:e=>o(t+e)})}(e,t,n):function(e,t,n){const r=e.value,o=e.valueKind,a=e.areValuesEqual,s=0===t?r:e=>r(e+t),l=n-t
return{schema:e.schema,__array:void 0,isDefined:e.isDefined,rowCount:l,value:s,valueKind:0===t?o:e=>o(e+t),toArray:e=>{const{array:n}=i.createArray(l,e)
for(let i=0,o=n.length;i<o;i++)n[i]=r(i+t)
return n},areValuesEqual:0===t?a:(e,n)=>a(e+t,n+t)}}(e,t,n):r.Undefined(n-t,e.schema)}!function(e){let t,n
function r(e,t){return s(t.T,e,t,n.NotPresent)}function d(e){return l(e)}!function(e){function t(t,n=e.float){return{"@type":"tensor",T:t.create(),space:t,valueType:"tensor",baseType:n}}e.str={"@type":"str",T:"",valueType:"str"},e.ustr={"@type":"str",T:"",valueType:"str",transform:"uppercase"},e.lstr={"@type":"str",T:"",valueType:"str",transform:"lowercase"},e.int={"@type":"int",T:0,valueType:"int"},e.coord={"@type":"coord",T:0,valueType:"float"},e.float={"@type":"float",T:0,valueType:"float"},e.Str=function(e){var t
return{"@type":"str",T:null!==(t=null==e?void 0:e.defaultValue)&&void 0!==t?t:"",transform:null==e?void 0:e.transform,valueType:"str"}},e.Int=function(e=0){return{"@type":"int",T:e,valueType:"int"}},e.Float=function(e=0){return{"@type":"float",T:e,valueType:"float"}},e.Tensor=t,e.Vector=function(n,r=e.float){return t(o.q.Vector(n,"int"===r["@type"]?Int32Array:Float64Array),r)},e.Matrix=function(n,r,i=e.float){return t(o.q.ColumnMajorMatrix(n,r,"int"===i["@type"]?Int32Array:Float64Array),i)},e.Aliased=function(e){return e},e.List=function(e,t,n=[]){return{"@type":"list",T:n,separator:e,itemParse:t,valueType:"list"}}}(t=e.Schema||(e.Schema={})),e.is=function(e){return!!e&&!!e.schema&&!!e.value},function(e){e[e.Present=0]="Present",e[e.NotPresent=1]="NotPresent",e[e.Unknown=2]="Unknown"}(n=e.ValueKinds||(e.ValueKinds={})),e.ValueKind={Present:n.Present,NotPresent:n.NotPresent,Unknown:n.Unknown},e.Undefined=r,e.ofConst=function(e,t,r){return s(e,t,r,n.Present)},e.ofLambda=d,e.range=function(e,n){return d({value:t=>t+e,rowCount:Math.max(n-e+1,0),schema:t.int})},e.ofArray=function(e){return c(e)},e.ofIntArray=function(e){return c({array:e,schema:t.int})},e.ofFloatArray=function(e){return c({array:e,schema:t.float})},e.ofStringArray=function(e){return c({array:e,schema:t.str})},e.ofStringAliasArray=function(e){return c({array:e,schema:t.Aliased(t.str)})},e.ofStringListArray=function(e,n=","){return c({array:e,schema:t.List(n,e=>e)})},e.ofIntTokens=function(e){const{count:n,data:r,indices:i}=e
return l({value:e=>(0,a.H9)(r,i[2*e],i[2*e+1])||0,rowCount:n,schema:t.int})},e.ofFloatTokens=function(e){const{count:n,data:r,indices:i}=e
return l({value:e=>(0,a.sS)(r,i[2*e],i[2*e+1])||0,rowCount:n,schema:t.float})},e.ofStringTokens=function(e){const{count:n,data:r,indices:i}=e
return l({value:e=>{const t=r.substring(i[2*e],i[2*e+1])
return"."===t||"?"===t?"":t},rowCount:n,schema:t.str})},e.window=function(e,t,n){return u(e,t,n)},e.view=function(e,t,n=!0){return o=t,a=n,0===(r=e).rowCount||a&&function(e,t){if(e.length!==t)return!1
for(let n=0,r=e.length;n<r;n++)if(e[n]!==n)return!1
return!0}(o,r.rowCount)?r:r.__array&&typeof r.value(0)==typeof r.__array[0]?function(e,t){const n=e.__array,r=new n.constructor(t.length)
for(let o=0,a=t.length;o<a;o++)r[o]=n[t[o]]
const i=e.valueKind
return c({array:r,schema:e.schema,valueKind:e=>i(t[e])})}(r,o):function(e,t){const n=e.value,r=e.valueKind,o=e.areValuesEqual,a=t.length
return{schema:e.schema,__array:void 0,isDefined:e.isDefined,rowCount:a,value:e=>n(t[e]),valueKind:e=>r(t[e]),toArray:e=>{const{array:r}=i.createArray(a,e)
for(let i=0,o=r.length;i<o;i++)r[i]=n(t[i])
return r},areValuesEqual:(e,n)=>o(t[e],t[n])}}(r,o)
var r,o,a},e.createFirstIndexMap=function(e){return function(e){const t=new Map
for(let n=0,r=e.rowCount;n<r;n++){const r=e.value(n)
t.has(r)||t.set(e.value(n),n)}return t}(e)},e.createIndexer=function(e){return function(e){const t=new Map
for(let n=0,r=e.rowCount;n<r;n++){const r=e.value(n)
t.has(r)||t.set(e.value(n),n)}return e=>t.has(e)?t.get(e):-1}(e)},e.mapToArray=function(e,t,n){return function(e,t,n){const r=new n(e.rowCount)
for(let i=0,o=e.rowCount;i<o;i++)r[i]=t(e.value(i))
return r}(e,t,n||Array)},e.areEqual=function(e,t){return function(e,t){return e===t||e.rowCount===t.rowCount&&e.isDefined===t.isDefined&&e.schema.valueType===t.schema.valueType&&(e.__array&&t.__array?function(e,t){const n=e.__array,r=t.__array
for(let i=0,o=e.rowCount;i<o;i++)if(n[i]!==r[i])return!1
return!0}(e,t):function(e,t){const n=e.value,r=t.value
for(let i=0,o=e.rowCount;i<o;i++)if(n(i)!==r(i))return!1
return!0}(e,t))}(e,t)},e.indicesOf=function(e,t){return function(e,t){const n=[],r=e.value
for(let i=0,o=e.rowCount;i<o;i++)t(r(i))&&(n[n.length]=i)
return n}(e,t)},e.asArrayColumn=function(e,t){return e.__array?e:e.isDefined?c({array:e.toArray({array:t}),schema:e.schema,valueKind:e.valueKind}):r(e.rowCount,e.schema)},e.copyToArray=function(e,t,n=0){if(!e.isDefined)return
const r=e.__array
if(r)for(let i=0,o=r.length;i<o;i++)t[n+i]=r[i]
else for(let i=0,o=e.rowCount;i<o;i++)t[n+i]=e.value(i)},e.isIdentity=function(e){for(let t=0,n=e.rowCount;t<n;t++)if(t!==e.value(t))return!1
return!0}}(r||(r={}))},83164(e,t,n){"use strict"
n.d(t,{$h:()=>v,vC:()=>y})
var r=n(80856),i=n(31683),o=n(19708),a=n(9959),s=n(9043),l=n(5638),c=n(63356),u=n(95538),d=n(37088)
const p=(0,a.q)(),h=Object.keys({color:"",pick:"",depth:"",marking:"",emissive:"",tracing:""}),f=Object.keys({compute:""})
function m(e,t,n,r,i){return n={...n,dRenderVariant:s.IQ.create(t)},void 0===i.dRenderVariant&&Object.defineProperty(i,"dRenderVariant",{value:(0,o.$F)("string")}),e.resources.program(n,r,i)}function g(e,t){if("color"===e)switch(t){case"blended":return"colorBlended"
case"wboit":return"colorWboit"
case"dpoit":return"colorDpoit"}return e}function y(e,t,n,r,i,o,a){return b(e,t,n,r,i,o,h,a)}function v(e,t,n,r,i,o=-1){return b(e,t,n,r,i,o,f,void 0)}function b(e,t,n,a,h,f,y,v){const b=p(),{stats:x,state:S,resources:_}=e,{instancedArrays:C,vertexArrayObject:w,multiDrawInstancedBaseVertexBaseInstance:T,drawInstancedBaseVertexBaseInstance:A}=e.extensions
if(y=y.filter(t=>"tracing"!==t||!!e.extensions.drawBuffers),h.uVertexCount&&!e.extensions.noNonInstancedActiveAttribs){const e=h.uVertexCount.ref.value
h.aVertex=s.IQ.create((0,c.WE)(new Float32Array(e))),a.aVertex=(0,o.Yz)("float32",1,0)}const{attributeValues:I,defineValues:P,textureValues:B,materialTextureValues:E,uniformValues:k,materialUniformValues:D,bufferedUniformValues:M}=(0,o.tC)(a,h),R=Object.entries(k),O=Object.entries(D),L=Object.entries(M),N=Object.entries((0,d.kB)(M)),F=Object.entries(P),z=(0,o.fb)(h),j=function(e,t){const{gl:n}=e
switch(t){case"points":return n.POINTS
case"lines":return n.LINES
case"line-strip":return n.LINE_STRIP
case"line-loop":return n.LINE_LOOP
case"triangles":return n.TRIANGLES
case"triangle-strip":return n.TRIANGLE_STRIP
case"triangle-fan":return n.TRIANGLE_FAN}}(e,t),V={}
for(const r of y)V[r]=m(e,g(r,v),P,n,a)
const U=(0,i.z1)(e,a,B),G=(0,i.z1)(e,a,E),H=(0,r.oq)(e,a,I),q=[]
for(let r=0,i=H.length;r<i;++r){const e=H[r]
1===e[1].divisor&&q.push(e)}let Q
const $=h.elements
$&&$.ref.value&&(Q=_.elements($.ref.value))
const X={}
for(const r of y)X[r]=w?_.vertexArray(V[r],H,Q):null
let W=h.drawCount.ref.value,Y=h.instanceCount.ref.value
x.drawCount+=W,x.instanceCount+=Y,x.instancedDrawCount+=Y*W
const Z={attributes:!1,defines:!1,elements:!1,textures:!1}
let K=!1,J=-1
return{id:b,materialId:f,getByteCount(){let e=0
for(let t=0,n=H.length;t<n;++t)e+=H[t][1].getByteCount()
Q&&(e+=Q.getByteCount())
for(let t=0,n=U.length;t<n;++t)e+=U[t][1].getByteCount()
for(let t=0,n=G.length;t<n;++t)e+=G[t][1].getByteCount()
return e},getProgram:e=>V[e],setTransparency:t=>{if(t!==v){v=t
for(const t of y)V[t].destroy(),V[t]=m(e,g(t,v),P,n,a)}},render:(t,n,r)=>{if(0===W||0===Y)return
const i=V[t]
if(i.id===J&&S.currentRenderItemId===b)i.setUniforms(R),i.bindTextures(U,n)
else{const e=X[t]
i.id===S.currentProgramId&&i.id===J&&-1!==f&&f===S.currentMaterialId||(i.id!==S.currentProgramId&&i.use(),i.setUniforms(O),i.bindTextures(G,n+U.length),S.currentMaterialId=f,J=i.id),i.setUniforms(R),i.setUniforms(N),i.bindTextures(U,n),e?(e.bind(),Q&&Q.bind()):(Q&&Q.bind(),i.bindAttributes(H)),S.currentRenderItemId=b}if(l.Bb&&e.checkFramebufferStatus(`Framebuffer error rendering item id ${b}`),r){for(const e of r)if(0!==e.count){if(i.setUniforms(e.uniforms),T)Q?T.multiDrawElementsInstancedBaseVertexBaseInstance(j,e.counts,0,Q._dataType,e.offsets,0,e.instanceCounts,0,e.baseVertices,0,e.baseInstances,0,e.count):T.multiDrawArraysInstancedBaseInstance(j,e.firsts,0,e.counts,0,e.instanceCounts,0,e.baseInstances,0,e.count)
else if(A)if(Q)for(let t=0;t<e.count;++t)e.counts[t]>0&&(i.uniform("uDrawId",t),A.drawElementsInstancedBaseVertexBaseInstance(j,e.counts[t],Q._dataType,e.offsets[t],e.instanceCounts[t],e.baseVertices[t],e.baseInstances[t]))
else for(let t=0;t<e.count;++t)e.counts[t]>0&&(i.uniform("uDrawId",t),A.drawArraysInstancedBaseInstance(j,e.firsts[t],e.counts[t],e.instanceCounts[t],e.baseInstances[t]))
else if(Q)for(let t=0;t<e.count;++t)e.counts[t]>0&&(i.uniform("uDrawId",t),i.offsetAttributes(q,e.baseInstances[t]),C.drawElementsInstanced(j,e.counts[t],Q._dataType,e.offsets[t],e.instanceCounts[t]))
else for(let t=0;t<e.count;++t)e.counts[t]>0&&(i.uniform("uDrawId",t),i.offsetAttributes(q,e.baseInstances[t]),C.drawArraysInstanced(j,0,e.counts[t],e.instanceCounts[t]))
if(l.g$){T?x.calls.multiDrawInstancedBase+=1:A?x.calls.drawInstancedBase+=e.count:x.calls.drawInstanced+=e.count
for(let t=0;t<e.count;++t)x.calls.counts+=e.instanceCounts[t]}}}else{let e=0
for(;;){const t=Math.min(W-e,3e7)
if(Q?C.drawElementsInstanced(j,t,Q._dataType,e*Q._bpe,Y):C.drawArraysInstanced(j,e,t,Y),e+=t,e>=W)break}l.g$&&(x.calls.drawInstanced+=1,x.calls.counts+=Y)}l.Bb&&e.checkError(`Draw error rendering item id ${b}`)},update:()=>{if(function(e){e.attributes=!1,e.defines=!1,e.elements=!1,e.textures=!1}(Z),h.aVertex){const e=h.uVertexCount.ref.value
h.aVertex.ref.value.length<e&&s.IQ.update(h.aVertex,(0,c.WE)(new Float32Array(e)))}for(let e=0,t=F.length;e<t;++e){const[t,n]=F[e]
n.ref.version!==z[t]&&(Z.defines=!0,z[t]=n.ref.version)}if(Z.defines)for(const t of y)V[t].destroy(),V[t]=m(e,g(t,v),P,n,a)
h.drawCount.ref.version!==z.drawCount&&(x.drawCount+=h.drawCount.ref.value-W,x.instancedDrawCount+=Y*h.drawCount.ref.value-Y*W,W=h.drawCount.ref.value,z.drawCount=h.drawCount.ref.version),h.instanceCount.ref.version!==z.instanceCount&&(x.instanceCount+=h.instanceCount.ref.value-Y,x.instancedDrawCount+=h.instanceCount.ref.value*W-Y*W,Y=h.instanceCount.ref.value,z.instanceCount=h.instanceCount.ref.version)
for(let e=0,t=H.length;e<t;++e){const[t,n]=H[e],r=I[t]
if(r.ref.version!==z[t]){if(n.length>=r.ref.value.length)n.updateSubData(r.ref.value,0,n.length)
else{n.destroy()
const{itemSize:i,divisor:o}=a[t]
H[e][1]=_.attribute(r.ref.value,i,o),Z.attributes=!0}z[t]=r.ref.version}}if(Q&&h.elements.ref.version!==z.elements&&(Q.length>=h.elements.ref.value.length?Q.updateSubData(h.elements.ref.value,0,Q.length):(Q.destroy(),Q=_.elements(h.elements.ref.value),Z.elements=!0),z.elements=h.elements.ref.version),Z.attributes||Z.defines||Z.elements)for(const e of y){const t=X[e]
t&&t.destroy(),X[e]=w?_.vertexArray(V[e],H,Q):null}for(let e=0,t=U.length;e<t;++e){const[t,n]=U[e],r=B[t]
r.ref.version!==z[t]&&("texture"!==a[t].kind?(n.load(r.ref.value),Z.textures=!0):U[e][1]=r.ref.value,z[t]=r.ref.version)}for(let e=0,t=G.length;e<t;++e){const[t,n]=G[e],r=E[t]
r.ref.version!==z[t]&&("texture"!==a[t].kind?(n.load(r.ref.value),Z.textures=!0):G[e][1]=r.ref.value,z[t]=r.ref.version)}for(let e=0,t=L.length;e<t;++e){const[t,n]=L[e]
n.ref.version!==z[t]&&(s.IQ.update(N[e][1],(0,u.Go)(n.ref.value)),z[t]=n.ref.version)}},destroy:()=>{if(!K){for(const e of y){V[e].destroy()
const t=X[e]
t&&t.destroy()}U.forEach(([e,t])=>{"texture"!==a[e].kind&&t.destroy()}),G.forEach(([e,t])=>{"texture"!==a[e].kind&&t.destroy()}),H.forEach(([e,t])=>t.destroy()),Q&&Q.destroy(),x.drawCount-=W,x.instanceCount-=Y,x.instancedDrawCount-=Y*W,K=!0}}}}},83569(e,t,n){"use strict"
function r(e){return e}n.d(t,{D:()=>r})},83689(e,t,n){"use strict"
n.d(t,{Bg:()=>u,TO:()=>c,oY:()=>o,wE:()=>h})
var r=n(18207),i=n(48393)
const o=new class{constructor(){this.map=new Map}removeSymbol(e){this.map.delete(e.symbol.id)}addSymbol(e){this.map.has(e.symbol.id)&&console.warn(`Symbol '${e.symbol.id}' already added. Call removeSymbol/removeCustomProps re-adding the symbol.`),this.map.set(e.symbol.id,e)}addCustomProp(e){if(e.symbols)for(const t of Object.keys(e.symbols))this.addSymbol(e.symbols[t])}removeCustomProp(e){if(e.symbols)for(const t of Object.keys(e.symbols))this.removeSymbol(e.symbols[t])}getRuntime(e){return this.map.get(e)}}
class a{constructor(e){this.table=e,this.constQueryContext=new i.QueryContext(i.Structure.Empty)}}var s,l,c,u
!function(e){e.Const=function(e){return{kind:"const",value:e}},e.Dynamic=function(e){return{kind:"dynamic",runtime:e}}}(s||(s={})),function(e){e.Const=function(e){return{isConst:!0,fn:function(t){return e}}},e.Dynamic=function(e){return{isConst:!1,fn:e}}}(l||(l={})),function(e){e.forEachEval=function(e,t,n,r){if("number"==typeof e.length)for(let i=0,o=e.length;i<o;i++)n(e[i](t),i,r)
else{let i=0
for(const o of Object.keys(e))n(e[o](t),i++,r)}return r}}(c||(c={})),function(e){e.Const=function(e,t){return new d(e,t,!0)},e.Dynamic=function(e,t){return new d(e,t,!1)}}(u||(u={}))
class d{compile(e,t){let n,i=!1
if(t)if(r.Expression.isArgumentsArray(t)){n=[],i=!0
for(const r of t){const t=p(e,r)
i=i&&t.isConst,n.push(t.fn)}}else{n=Object.create(null),i=!0
for(const r of Object.keys(t)){const o=p(e,t[r])
i=i&&o.isConst,n[r]=o.fn}}else n=void 0,i=!0
return this.isConst&&this.isConst&&i?l.Const(this.fn(e.constQueryContext,n)):l.Dynamic(function(e,t){return function(n){return e(n,t)}}(this.fn,n))}constructor(e,t,n){this.symbol=e,this.fn=t,this.isConst=n}}function p(e,t){if(r.Expression.isLiteral(t))return l.Const(t)
if(r.Expression.isSymbol(t)){const n=e.table.getRuntime(t.name)
return n?n.compile(e):l.Const(t.name)}if(!r.Expression.isSymbol(t.head))throw new Error("Can only apply symbols.")
const n=e.table.getRuntime(t.head.name)
if(!n)throw new Error(`Symbol '${t.head.name}' is not implemented.`)
return n.compile(e,t.args)}function h(e){return p(new a(o),e).fn}},83748(e,t,n){"use strict"
n.d(t,{BB:()=>b,CR:()=>y,W8:()=>S,YQ:()=>p,d_:()=>m,k0:()=>_,k7:()=>g,kd:()=>C})
var r=n(48393),i=n(89),o=n(20321),a=n(12288),s=n(83040),l=n(32775),c=n(87423),u=n(90050)
const d={granularity:"element",condensed:!1,reverse:!1,countsOnly:!1,hidePrefix:!1,htmlStyling:!0}
function p(e,t={}){var n
switch(e.kind){case"structure-loci":return e.structure.models.map(e=>e.entry).filter(e=>!!e).join(", ")
case"element-loci":return m(r.StructureElement.Stats.ofLoci(e),t)
case"bond-loci":const i=e.bonds[0]
return i?y(i,t):""
case"shape-loci":return e.shape.name
case"group-loci":const a=e.groups[0]
return a?e.shape.getLabel(o.C.start(a.ids),a.instance):""
case"every-loci":return"Everything"
case"empty-loci":return"Nothing"
case"data-loci":return e.getLabel()
case"volume-loci":return e.volume.label||"Volume"
case"isosurface-loci":return[`${e.volume.label||"Volume"}`,`Isosurface at ${u.f.IsoValue.toString(e.isoValue)}`].join(" | ")
case"cell-loci":const s=u.f.Cell.getLociSize(e),l=o.C.start(e.elements[0].indices),c=u.f.IsoValue.absolute(e.volume.grid.cells.data[l]),d=u.f.IsoValue.toRelative(c,e.volume.grid.stats),p=[`${e.volume.label||"Volume"}`,1===s?`Cell #${l}`:`${s} Cells`]
return 1===s&&(e.volume.instances.length>1&&p.push(`Instance #${o.C.start(e.elements[0].instances)+1}`),p.push(`${u.f.IsoValue.toString(c)} (${u.f.IsoValue.toString(d)})`)),p.join(" | ")
case"segment-loci":const h=u.f.Segment.getLociSize(e),f=null===(n=u.f.Segmentation.get(e.volume))||void 0===n?void 0:n.labels,g=o.C.start(e.elements[0].segments)
if(f&&1===h){const e=f[g]
if(e)return e}return[`${e.volume.label||"Volume"}`,1===h?`Segment ${g}`:`${h} Segments`].join(" | ")}}function h(e,t){return 1===e?`1 ${t}`:`${e} ${t}s`}function f(e,t,n,r,i,o){return`${b(t,{granularity:n,hidePrefix:r,reverse:i,condensed:o})} <small>[+ ${h(e-1,`other ${(0,a.ZH)(n)}`)}]</small>`}function m(e,t={}){const n={...d,...t},i=function(e,t=!1,n=!1,i=!1,o=!1){const{structureCount:a,chainCount:s,residueCount:l,conformationCount:c,elementCount:u}=e
if(t||1!==u||0!==l||0!==s){if(t||0!==u||1!==l||0!==s){if(t||0!==u||0!==l||1!==s){if(t){const e=[]
return a>0&&e.push(h(a,"Structure")),s>0&&e.push(h(s,"Chain")),l>0&&e.push(h(l,"Residue")),c>0&&e.push(h(c,"Conformation")),u>0&&e.push(h(u,"Element")),e.join("<small> + </small>")}{const t=[]
return a>0&&t.push(1===a?b(e.firstStructureLoc,{hidePrefix:n,condensed:i,granularity:"structure",reverse:o}):f(a,e.firstStructureLoc,"structure",n,o,i)),s>0&&(t.push(1===s?b(e.firstChainLoc,{condensed:i,granularity:"chain",hidePrefix:n,reverse:o}):f(s,e.firstChainLoc,"chain",n,o,i)),n=!0),l>0&&(t.push(1===l?b(e.firstResidueLoc,{condensed:i,granularity:"residue",hidePrefix:n,reverse:o}):f(l,e.firstResidueLoc,"residue",n,o,i)),n=!0),c>0&&(t.push(1===c?b(e.firstConformationLoc,{condensed:i,granularity:"conformation",hidePrefix:n,reverse:o}):f(c,e.firstConformationLoc,"conformation",n,o,i)),n=!0),u>0&&t.push(1===u?b(e.firstElementLoc,{condensed:i,granularity:"element",hidePrefix:n,reverse:o}):f(u,e.firstElementLoc,"element",n,o,i)),t.join("<small> + </small>")}}{const{unit:t}=e.firstChainLoc,a=r.Unit.isAtomic(t)&&1===function(e){const{elements:t,model:n}=e,{chainAtomSegments:r,residueAtomSegments:i}=n.atomicHierarchy,o=r.offsets[r.index[t[0]]],a=r.offsets[r.index[t[t.length-1]]+1]-1
return i.index[a]-i.index[o]+1}(t)||r.Unit.Traits.is(t.traits,r.Unit.Trait.MultiChain)?"residue":"chain"
return b(e.firstChainLoc,{hidePrefix:n,condensed:i,granularity:a,reverse:o})}}return b(e.firstResidueLoc,{hidePrefix:n,condensed:i,granularity:"residue",reverse:o})}return b(e.firstElementLoc,{hidePrefix:n,condensed:i,granularity:"element",reverse:o})}(e,n.countsOnly,n.hidePrefix,n.condensed,n.reverse)
return n.htmlStyling?i:(0,a.Kq)(i)}function g(e,t={}){const n=r.StructureElement.Stats.create()
for(const i of e)r.StructureElement.Stats.add(n,n,r.StructureElement.Stats.ofLoci(i))
return m(n,t)}function y(e,t={}){return v({loci:[r.StructureElement.Loci(e.aStructure,[{unit:e.aUnit,indices:o.C.ofSingleton(e.aIndex)}]),r.StructureElement.Loci(e.bStructure,[{unit:e.bUnit,indices:o.C.ofSingleton(e.bIndex)}])]},t)}function v(e,t={}){const n={...d,...t},i=function(e,t){const{granularity:n,hidePrefix:i,reverse:a,condensed:s}=t
let l=!0
for(const o of e.loci)if(!r.StructureElement.Loci.is(o)||1!==r.StructureElement.Loci.size(o)){l=!1
break}if(l){const t=e.loci.map(e=>{const{unit:t,indices:n}=e.elements[0]
return r.StructureElement.Location.create(e.structure,t,t.elements[o.C.start(n)])}).map(e=>x(e,n,i,a||s))
if(s)return t.map(e=>e[0].replace(/\[.*\]/g,"").trim()).filter(e=>!!e).join("  ")
let l=0
for(let e=0,n=Math.min(...t.map(e=>e.length))-1;e<n;++e){let n=!0
for(let r=1,i=t.length;r<i;++r)if(t[0][e]!==t[r][e]){n=!1
break}if(!n)break
l+=1}if(l>0){const e=[t[0].join(" | ")]
for(let n=1,r=t.length;n<r;++n)e.push(t[n].slice(l).filter(e=>!!e).join(" | "))
return e.join("  ")}return t.map(e=>e.filter(e=>!!e).join(" | ")).filter(e=>!!e).join("</br>")}return e.loci.map(e=>p(e,t)).filter(e=>!!e).join(s?"  ":"</br>")}(e,n)
return n.htmlStyling?i:(0,a.Kq)(i)}function b(e,t={}){var n,r
const i={...d,...t},o=x(e,i.granularity,i.hidePrefix,i.reverse||i.condensed),s=i.condensed?null!==(r=null===(n=o[0])||void 0===n?void 0:n.replace(/\[.*\]/g,"").trim())&&void 0!==r?r:"":o.filter(e=>!!e).join(" | ")
return i.htmlStyling?s:(0,a.Kq)(s)}function x(e,t="element",n=!1,i=!1){const o=[]
if(!n){let n=e.unit.model.entry
n.length>30&&(n=n.substr(0,27)+""),o.push(`<small>${n}</small>`),"structure"!==t&&(o.push(`<small>Model ${e.unit.model.modelNum}</small>`),o.push(`<small>Instance ${e.unit.conformation.operator.instanceId}</small>`))}return r.Unit.isAtomic(e.unit)?o.push(...function(e,t,n=!1){const i=r.StructureElement.Location.residueIndex(e),o=r.StructureProperties.chain.label_asym_id(e),a=r.StructureProperties.chain.auth_asym_id(e),l=e.unit.model.atomicHierarchy.residues.label_seq_id.valueKind(i)===s.V.ValueKinds.Present,c=r.StructureProperties.residue.label_seq_id(e),u=r.StructureProperties.residue.auth_seq_id(e),d=r.StructureProperties.residue.pdbx_PDB_ins_code(e),p=r.StructureProperties.atom.label_comp_id(e),h=r.StructureProperties.atom.label_atom_id(e),f=r.StructureProperties.atom.label_alt_id(e),m=r.StructureProperties.atom.occupancy(e),g=r.StructureProperties.atom.sourceIndex(e),y=r.StructureProperties.residue.microheterogeneityCompIds(e),v="residue"===t&&y.length>1?`(${y.join("|")})`:p,b=[]
switch(t){case"element":{const e=`<b>${h}</b>${f?`%${f}`:""}`,t=`<small style='margin-left: 4px'>[idx <b>${g+1}</b>]</small>`
b.push(`${e}${t}`)}case"conformation":"conformation"===t&&f&&b.push(`<small>Conformation</small> <b>${f}</b>`)
case"residue":const n=c!==u&&l?c:u
b.push(`<b>${v} ${n}</b>${n!==u?` <small>[auth</small> <b>${u}</b><small>]</small>`:""}<b>${d||""}</b>`)
case"chain":o===a?b.push(`<b>${o}</b>`):"chain"===t&&r.Unit.Traits.is(e.unit.traits,r.Unit.Trait.MultiChain)?b.push(`<small>[auth</small> <b>${a}</b><small>]</small>`):b.push(`<b>${o}</b> <small>[auth</small> <b>${a}</b><small>]</small>`)}return b.length>0&&1!==m&&!n&&(b[0]=`${b[0]} <small>[occupancy</small> <b>${Math.round(100*m)/100}</b><small>]</small>`),b.reverse()}(e,t,i)):r.Unit.isCoarse(e.unit)?o.push(...function(e,t){const n=r.StructureProperties.coarse.asym_id(e),i=r.StructureProperties.coarse.seq_id_begin(e),o=r.StructureProperties.coarse.seq_id_end(e),a=[]
switch(t){case"element":case"conformation":case"residue":if(i===o){const t=r.StructureProperties.coarse.entityKey(e),n=e.unit.model.sequence.byEntityKey[t].sequence.compId.value(i-1)
a.push(`<b>${n} ${i}</b>`)}else a.push(`<b>${i}-${o}</b>`)
case"chain":a.push(`<b>${n}</b>`)}return a.reverse()}(e,t)):o.push("Unknown"),i?o.reverse():o}function S(e,t={}){const n={...d,measureOnly:!1,unitLabel:"",...t},[r,o]=e.loci.map(e=>i.Loci.getCenter(e)),a=`${l.eB.distance(r,o).toFixed(2)} ${n.unitLabel}`
if(n.measureOnly)return a
const s=v(e,n)
return n.condensed?`${a} | ${s}`:`Distance ${a}</br>${s}`}function _(e,t={}){const n={...d,measureOnly:!1,...t},[r,o,a]=e.loci.map(e=>i.Loci.getCenter(e)),s=l.eB.sub((0,l.eB)(),r,o),u=l.eB.sub((0,l.eB)(),a,o),p=`${(0,c.H)(l.eB.angle(s,u)).toFixed(2)}`
if(n.measureOnly)return p
const h=v(e,n)
return n.condensed?`${p} | ${h}`:`Angle ${p}</br>${h}`}function C(e,t={}){const n={...d,measureOnly:!1,...t},[r,o,a,s]=e.loci.map(e=>i.Loci.getCenter(e)),u=`${(0,c.H)(l.eB.dihedralAngle(r,o,a,s)).toFixed(2)}`
if(n.measureOnly)return u
const p=v(e,n)
return n.condensed?`${u} | ${p}`:`Dihedral ${u}</br>${p}`}},83794(e,t,n){"use strict"
n.d(t,{P:()=>_})
var r=n(32775),i=n(70012),o=n(10596),a=n(10268),s=n(96005)
const l=(0,r.eB)(),c=(0,r.U)(),u=(0,r.eB)(),d=(0,r.eB)(),p=(0,r.eB)(),h=(0,r.eB)(),f=r.eB.fromArray,m=r.eB.triangleNormal,g=r.eB.copy,y=r.eB.transformMat4,v=r.eB.transformMat3,b=r.U.directionTransform,x=i.Gm.add3,S=i.Gm.add
var _
!function(e){function t(e,t,n,r){const{vertices:i,normals:o,indices:a,groups:s,currentGroup:c}=e,u=i.elementCount
x(i,t[0],t[1],t[2]),x(i,n[0],n[1],n[2]),x(i,r[0],r[1],r[2]),m(l,t,n,r)
for(let d=0;d<3;++d)x(o,l[0],l[1],l[2]),S(s,c)
x(a,u,u+1,u+2)}function n(e,t,n,r,i){const{vertices:o,normals:a,indices:s,groups:l,currentGroup:c}=e,u=o.elementCount
x(o,t[0],t[1],t[2]),x(o,n[0],n[1],n[2]),x(o,r[0],r[1],r[2])
for(let d=0;d<3;++d)x(a,i[0],i[1],i[2]),S(l,c)
x(s,u,u+1,u+2)}function r(e,t,n){const{vertices:r,normals:i,indices:o}=n,{vertices:a,normals:s,indices:u,groups:d,currentGroup:p}=e,h=a.elementCount,m=b(c,t)
for(let c=0,g=r.length;c<g;c+=3)y(l,f(l,r,c),t),x(a,l[0],l[1],l[2]),v(l,f(l,i,c),m),x(s,l[0],l[1],l[2]),S(d,p)
for(let l=0,c=o.length;l<c;l+=3)x(u,o[l]+h,o[l+1]+h,o[l+2]+h)}e.createState=function(e=2048,t=1024,n){return{currentGroup:-1,vertices:i.Gm.create(Float32Array,3,t,n?n.vertexBuffer.ref.value:e),normals:i.Gm.create(Float32Array,3,t,n?n.normalBuffer.ref.value:e),indices:i.Gm.create(Uint32Array,3,3*t,n?n.indexBuffer.ref.value:3*e),groups:i.Gm.create(Float32Array,1,t,n?n.groupBuffer.ref.value:e),mesh:n}},e.addTriangle=t,e.addTriangleWithNormal=n,e.addTriangleStrip=function(e,n,r){f(p,n,3*r[0]),f(h,n,3*r[1])
for(let i=2,o=r.length;i<o;i+=2)g(u,p),g(d,h),f(p,n,3*r[i]),f(h,n,3*r[i+1]),t(e,u,d,p),t(e,d,h,p)},e.addTriangleFan=function(e,n,r){f(u,n,3*r[0])
for(let i=2,o=r.length;i<o;++i)f(d,n,3*r[i-1]),f(p,n,3*r[i]),t(e,u,p,d)},e.addTriangleFanWithNormal=function(e,t,r,i){f(u,t,3*r[0])
for(let o=2,a=r.length;o<a;++o)f(d,t,3*r[o-1]),f(p,t,3*r[o]),n(e,u,p,d,i)},e.addPrimitive=r,e.addPrimitiveFlipped=function(e,t,n){const{vertices:r,normals:i,indices:o}=n,{vertices:a,normals:s,indices:u,groups:d,currentGroup:p}=e,h=a.elementCount,m=b(c,t)
for(let c=0,g=r.length;c<g;c+=3)y(l,f(l,r,c),t),x(a,l[0],l[1],l[2]),v(l,f(l,i,c),m),x(s,-l[0],-l[1],-l[2]),S(d,p)
for(let l=0,c=o.length;l<c;l+=3)x(u,o[l+2]+h,o[l+1]+h,o[l]+h)},e.addCage=function(e,t,n,r,i,o){const{vertices:l,edges:c}=n,p={radiusTop:r,radiusBottom:r,radialSegments:o}
for(let h=0,m=c.length;h<m;h+=2)f(u,l,3*c[h]),f(d,l,3*c[h+1]),y(u,u,t),y(d,d,t),(0,a.X)(e,u,r,i),(0,a.X)(e,d,r,i),(0,s.y9)(e,u,d,1,p)},e.addMesh=function(e,t,n){r(e,t,{vertices:n.vertexBuffer.ref.value.subarray(0,3*n.vertexCount),normals:n.normalBuffer.ref.value.subarray(0,3*n.vertexCount),indices:n.indexBuffer.ref.value.subarray(0,3*n.triangleCount)})},e.getMesh=function(e){const{vertices:t,normals:n,indices:r,groups:a,mesh:s}=e,l=i.Gm.compact(t,!0),c=i.Gm.compact(r,!0),u=i.Gm.compact(n,!0),d=i.Gm.compact(a,!0)
return o.e.create(l,c,u,d,e.vertices.elementCount,e.indices.elementCount,s)}}(_||(_={}))},83842(e,t,n){"use strict"
n.d(t,{x:()=>a})
var r=n(89),i=n(48393),o=n(7928)
function a(e,t){return{kind:e,layers:t}}!function(e){function t(e){return 0===e.layers.length}e.Empty={kind:"empty-loci",layers:[]},e.areEqual=function(e,t){if(0===e.layers.length&&0===t.layers.length)return!0
if(e.layers.length!==t.layers.length)return!1
for(let n=0,i=e.layers.length;n<i;++n){if(e.layers[n].value!==t.layers[n].value)return!1
if(!r.Loci.areEqual(e.layers[n].loci,t.layers[n].loci))return!1}return!0},e.isEmpty=t,e.remap=function(e,t){if("element-loci"===e.kind){const n=[]
for(const r of e.layers){const e=i.StructureElement.Loci.remap(r.loci,t)
i.StructureElement.Loci.isEmpty(e)||n.push({loci:e,value:r.value})}return{kind:"element-loci",layers:n}}return e},e.merge=function(e){if(t(e))return e
if("element-loci"===e.kind){const{structure:t}=e.layers[0].loci,n=new Map
let r=i.StructureElement.Loci.none(t)
for(let a=0,s=e.layers.length;a<s;++a){let{loci:t,value:o}=e.layers[s-a-1]
t=i.StructureElement.Loci.subtract(t,r),r=i.StructureElement.Loci.union(t,r),i.StructureElement.Loci.isEmpty(t)||(n.has(o)&&(t=i.StructureElement.Loci.union(t,n.get(o))),n.set(o,t))}const o=[]
return n.forEach((e,t)=>{o.push({loci:e,value:t})}),{kind:"element-loci",layers:o}}return e},e.filter=function(e,n){if(t(e))return e
if("element-loci"===e.kind){const{structure:t}=e.layers[0].loci,r=[]
for(const o of e.layers){let{loci:e,value:a}=o
const s=i.StructureElement.Loci.remap(e,n)
e=i.StructureElement.Loci.remap(s,t),i.StructureElement.Loci.isEmpty(e)||r.push({loci:e,value:a})}return{kind:"element-loci",layers:r}}return e},e.ofScript=function(e,t){const n=[]
for(let r=0,a=e.length;r<a;++r){const{script:a,value:s}=e[r],l=o.Script.toLoci(a,t)
i.StructureElement.Loci.isEmpty(l)||n.push({loci:l,value:s})}return{kind:"element-loci",layers:n}},e.ofBundle=function(e,t){const n=[]
for(let r=0,o=e.length;r<o;++r){const{bundle:o,value:a}=e[r],s=i.StructureElement.Bundle.toLoci(o,t.root)
n.push({loci:s,value:a})}return{kind:"element-loci",layers:n}},e.toBundle=function(e){const t=[]
for(let n=0,r=e.layers.length;n<r;++n){const{loci:r,value:o}=e.layers[n],a=i.StructureElement.Bundle.fromLoci(r)
t.push({bundle:a,value:o})}return{kind:"element-loci",layers:t}}}(a||(a={}))},83854(e,t,n){"use strict"
n.d(t,{TA:()=>u,Wr:()=>d,vz:()=>c})
var r=n(54749),i=n(92384),o=n(85032),a=n(9043),s=n(93076)
const l=(0,r.Color)(13421772),c={value:i.t.Color(l),saturation:i.t.Numeric(0,{min:-6,max:6,step:.1}),lightness:i.t.Numeric(0,{min:-6,max:6,step:.1})}
function u(e,t){let n=(0,a.NT)(t.value,l)
return n=r.Color.saturate(n,t.saturation),n=r.Color.lighten(n,t.lightness),{factory:u,granularity:"uniform",color:()=>n,props:t,description:"Gives everything the same, uniform color.",legend:(0,o.h)([["uniform",n]])}}const d={name:"uniform",label:"Uniform",category:s.N.Misc,factory:u,getParams:function(e){return c},defaultValues:i.t.getDefaultValues(c),isApplicable:e=>!0}},83939(e,t,n){"use strict"
n.d(t,{l:()=>o})
var r=n(62626),i=n(18891)
function o(e){return(0,i.T)(e[r.s])}},84238(e,t,n){"use strict"
function r([e]){return Math.acos(e)}n.r(t),n.d(t,{acos:()=>r,default:()=>i})
var i=(0,n(10336).helper)(r)},84512(e,t,n){"use strict"
n.d(t,{Z:()=>o})
var r=n(71695),i=n(70012)
class o{getConnectedUnits(e){return this.map.has(e)?this.map.get(e):a}getEdgeIndex(e,t,n,r){const i=this.edgeKeyIndex.get(o.getEdgeUnitKey(t,r))
if(void 0===i)return-1
const a=i.get(o.getEdgeIndexKey(e,n))
return void 0!==a?a:-1}hasEdge(e,t,n,r){return-1!==this.getEdgeIndex(e,t,n,r)}getEdge(e,t,n,r){const i=this.getEdgeIndex(e,t,n,r)
return-1!==i?this.edges[i]:void 0}getEdgeIndices(e,t){return this.vertexKeyIndex.get(o.getVertexKey(e,t))||[]}constructor(e){this.map=e
let t=0
const n=[],r=new Map,i=new Map
this.map.forEach(e=>{e.forEach(e=>{t+=e.edgeCount,e.connectedIndices.forEach(t=>{e.getEdges(t).forEach(a=>{const{unitA:s,unitB:l}=e,c=o.getEdgeIndexKey(s,l),u=o.getEdgeIndexKey(t,a.indexB),d=r.get(c)
void 0===d?r.set(c,new Map([[u,n.length]])):d.set(u,n.length)
const p=o.getVertexKey(t,s),h=i.get(p)
void 0===h?i.set(p,[n.length]):h.push(n.length),n.push({...a,indexA:t,unitA:s,unitB:l})})})})}),this.edgeCount=t,this.edges=n,this.edgeKeyIndex=r,this.vertexKeyIndex=i}}!function(e){class t{hasEdges(e){return this.edgeMap.has(e)}getEdges(e){return this.edgeMap.has(e)?this.edgeMap.get(e):a}get areUnitsOrdered(){return this.unitA<this.unitB}constructor(e,t,n,r,i){this.unitA=e,this.unitB=t,this.edgeCount=n,this.connectedIndices=r,this.edgeMap=i}}function n(e,t,n){e.has(t)?e.get(t).push(n):e.set(t,[n])}e.UnitPairEdges=t,e.getEdgeUnitKey=function(e,t){return(0,i.m1)(e,t)},e.getEdgeIndexKey=function(e,t){return(0,i.m1)(e,t)},e.getVertexKey=function(e,t){return(0,i.m1)(e,t)},e.Builder=class{constructor(){this.map=new Map}startUnitPair(e,t){this.uA=e,this.uB=t,this.mapAB=new Map,this.mapBA=new Map,this.linkedA=r.th.create(),this.linkedB=r.th.create(),this.linkCount=0}finishUnitPair(){0!==this.linkCount&&(n(this.map,this.uA,new t(this.uA,this.uB,this.linkCount,this.linkedA.array,this.mapAB)),n(this.map,this.uB,new t(this.uB,this.uA,this.linkCount,this.linkedB.array,this.mapBA)))}add(e,t,i){n(this.mapAB,e,{indexB:t,props:i}),n(this.mapBA,t,{indexB:e,props:i}),r.th.add(this.linkedA,e,e),r.th.add(this.linkedB,t,t),this.linkCount+=1}getMap(){return this.map}}}(o||(o={}))
const a=[]},84645(e,t,n){"use strict"
n.d(t,{x:()=>s})
var r=n(14294),i=n(32775),o=n(63356)
function a(e,t,n,r){let i=(r-n)/t
0===i&&(i=1)
const o=new Int32Array(t)
for(let a=0,s=e.length;a<s;a++){let r=Math.floor((e[a]-n)/i)
r>=t?r=t-1:r<0&&(r=0),o[r]++}return{min:n,max:r,binWidth:i,counts:o}}var s,l=n(97564)
!function(e){e.One={transform:{kind:"matrix",matrix:i.$I.identity()},cells:i.qY.create(i.qY.Space([1,1,1],[0,1,2]),i.qY.Data1([0])),stats:{min:0,max:0,mean:0,sigma:0}}
const t=(0,i.$I)(),n=(0,i.$I)()
e.getGridToCartesianTransform=function(e){if("matrix"===e.transform.kind)return i.$I.copy((0,i.$I)(),e.transform.matrix)
if("spacegroup"===e.transform.kind){const{cells:{space:o}}=e,a=i.$I.fromScaling(t,i.eB.div((0,i.eB)(),r.DJ.size((0,i.eB)(),e.transform.fractionalBox),i.eB.ofArray(o.dimensions))),s=i.$I.fromTranslation(n,e.transform.fractionalBox.min)
return i.$I.mul3((0,i.$I)(),e.transform.cell.fromFractional,s,a)}return i.$I.identity()},e.areEquivalent=function(e,t){return e===t},e.isEmpty=function(e){return 0===e.cells.data.length},e.getBoundingSphere=function(t,n){n||(n=(0,r.f8)())
const i=t.cells.space.dimensions,o=e.getGridToCartesianTransform(t)
return r.f8.fromDimensionsAndTransform(n,i,o)},e.getHistogram=function(e,t){let n=e._historams
return n||(n=e._historams={}),n[t]||(n[t]=function(e,t,n){if(n)return a(e,t,n.min,n.max)
{const[n,r]=(0,o.em)(e)
return a(e,t,n,r)}}(e.cells.data,t,{min:e.stats.min,max:e.stats.max})),n[t]},e.makeGetTrilinearlyInterpolated=function(t,n){const r=e.getGridToCartesianTransform(t)
i.$I.invert(r,r)
const o=(0,i.eB)(),{stats:a}=t,{dimensions:s,get:c}=t.cells.space,u=t.cells.data,[d,p,h]=s
return function(e){i.eB.copy(o,e),i.eB.transformMat4(o,o,r)
const t=Math.trunc(o[0]),s=Math.trunc(o[1]),f=Math.trunc(o[2])
if(t<0||t>=d||s<0||s>=p||f<0||f>=h)return Number.NaN
const m=o[0]-t,g=o[1]-s,y=o[2]-f,v=Math.min(t+1,d-1),b=Math.min(s+1,p-1),x=Math.min(f+1,h-1)
let S=c(u,t,s,f),_=c(u,v,s,f),C=c(u,t,b,f),w=c(u,v,b,f)
const T=(0,l.Cc)((0,l.Cc)(S,_,m),(0,l.Cc)(C,w,m),g)
S=c(u,t,s,x),_=c(u,v,s,x),C=c(u,t,b,x),w=c(u,v,b,x)
const A=(0,l.Cc)((0,l.Cc)(S,_,m),(0,l.Cc)(C,w,m),g),I=(0,l.Cc)(T,A,y)
return"relative"===n?(I-a.mean)/a.sigma:I}}}(s||(s={}))},85032(e,t,n){"use strict"
function r(e){return{kind:"table-legend",table:e}}function i(e,t,n){return{kind:"scale-legend",minLabel:e,maxLabel:t,colors:n}}n.d(t,{A:()=>i,h:()=>r})},85266(e,t,n){"use strict"
n.r(t),n.d(t,{default:()=>d})
var r,i,o,a=n(50081),s=n(82735),l=n(10336),c=n.n(l),u=n(24666)
let d=(r=(0,s.service)("page-title"),i=class extends(c()){constructor(e){super(e),(0,a.a)(this,"tokens",o,this),(0,a.b)(this,"tokenId",(0,u.guidFor)(this)),this.tokens.push({id:this.tokenId})}compute(e,t){const n={...t,id:this.tokenId,title:e.join("")}
return this.tokens.push(n),this.tokens.scheduleTitleUpdate(),""}willDestroy(){super.willDestroy(),this.tokens.remove(this.tokenId),this.tokens.scheduleTitleUpdate()}},o=(0,a._)(i.prototype,"tokens",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i)},85362(e,t,n){"use strict"
n.d(t,{e:()=>r})
const r="\nprecision highp float;\n\nattribute vec2 aPosition;\nuniform vec2 uQuadScale;\n\nvoid main(void) {\n    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;\n    gl_Position = vec4(position, 0.0, 1.0);\n}\n"},85404(e,t,n){"use strict"
n.d(t,{c:()=>u})
var r=n(67151),i=n(28539),o=n(62626),a=n(83569),s=n(86814),l=n(18891),c=n(10390),u=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e
return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var o,a=this,s=(o=e)&&o instanceof r.vU||function(e){return e&&(0,l.T)(e.next)&&(0,l.T)(e.error)&&(0,l.T)(e.complete)}(o)&&(0,i.Uv)(o)?e:new r.Ms(e,t,n)
return(0,c.Y)(function(){var e=a,t=e.operator,n=e.source
s.add(t?t.call(s,n):n?a._subscribe(s):a._trySubscribe(s))}),s},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this
return new(t=d(t))(function(t,i){var o=new r.Ms({next:function(t){try{e(t)}catch(e){i(e),o.unsubscribe()}},error:i,complete:t})
n.subscribe(o)})},e.prototype._subscribe=function(e){var t
return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[o.s]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]
return(0===(n=e).length?a.D:1===n.length?n[0]:function(e){return n.reduce(function(e,t){return t(e)},e)})(this)
var n},e.prototype.toPromise=function(e){var t=this
return new(e=d(e))(function(e,n){var r
t.subscribe(function(e){return r=e},function(e){return n(e)},function(){return e(r)})})},e.create=function(t){return new e(t)},e}()
function d(e){var t
return null!==(t=null!=e?e:s.$.Promise)&&void 0!==t?t:Promise}},85554(e,t,n){"use strict"
n.d(t,{oY:()=>r.oY,Bg:()=>r.Bg,wE:()=>r.wE})
var r=n(83689),i=n(25176),o=n(48393),a=n(87095),s=n(42261),l=n(12288),c=n(87933),u=n(95472),d=n(34431),p=n(63356)
const h=r.Bg.Const,f=r.Bg.Dynamic,m=[h(i.AN.core.type.bool,function(e,t){return!!t[0](e)}),h(i.AN.core.type.num,function(e,t){return+t[0](e)}),h(i.AN.core.type.str,function(e,t){return""+t[0](e)}),h(i.AN.core.type.list,function(e,t){return r.TO.forEachEval(t,e,(e,t,n)=>n[t]=e,[])}),h(i.AN.core.type.set,function(e,t){return r.TO.forEachEval(t,e,function(e,t,n){return n.add(e)},new Set)}),h(i.AN.core.type.regex,function(e,t){return new RegExp(t[0](e),t[1]&&t[1](e)||"")}),h(i.AN.core.type.bitflags,function(e,t){return+t[0](e)}),h(i.AN.core.type.compositeKey,function(e,t){return r.TO.forEachEval(t,e,(e,t,n)=>n[t]=""+e,[]).join("-")}),h(i.AN.core.logic.not,(e,t)=>!t[0](e)),h(i.AN.core.logic.and,(e,t)=>{if("number"==typeof t.length){for(let n=0,r=t.length;n<r;n++)if(!t[n](e))return!1}else for(const n of Object.keys(t))if(!t[n](e))return!1
return!0}),h(i.AN.core.logic.or,(e,t)=>{if("number"==typeof t.length){for(let n=0,r=t.length;n<r;n++)if(t[n](e))return!0}else for(const n of Object.keys(t))if(t[n](e))return!0
return!1}),h(i.AN.core.rel.eq,(e,t)=>t[0](e)===t[1](e)),h(i.AN.core.rel.neq,(e,t)=>t[0](e)!==t[1](e)),h(i.AN.core.rel.lt,(e,t)=>t[0](e)<t[1](e)),h(i.AN.core.rel.lte,(e,t)=>t[0](e)<=t[1](e)),h(i.AN.core.rel.gr,(e,t)=>t[0](e)>t[1](e)),h(i.AN.core.rel.gre,(e,t)=>t[0](e)>=t[1](e)),h(i.AN.core.rel.inRange,(e,t)=>{const n=t[0](e)
return n>=t[1](e)&&n<=t[2](e)}),h(i.AN.core.math.add,(e,t)=>{let n=0
if("number"==typeof t.length)for(let r=0,i=t.length;r<i;r++)n+=t[r](e)
else for(const r of Object.keys(t))n+=t[r](e)
return n}),h(i.AN.core.math.sub,(e,t)=>{let n=0
if("number"==typeof t.length){if(1===t.length)return-t[0](e)
n=t[0](e)||0
for(let r=1,i=t.length;r<i;r++)n-=t[r](e)}else{const r=Object.keys(t)
if(1===r.length)return-t[r[0]](e)
n=t[r[0]](e)||0
for(let i=1,o=r.length;i<o;i++)n-=t[r[i]](e)}return n}),h(i.AN.core.math.mult,(e,t)=>{let n=1
if("number"==typeof t.length)for(let r=0,i=t.length;r<i;r++)n*=t[r](e)
else for(const r of Object.keys(t))n*=t[r](e)
return n}),h(i.AN.core.math.div,(e,t)=>t[0](e)/t[1](e)),h(i.AN.core.math.pow,(e,t)=>Math.pow(t[0](e),t[1](e))),h(i.AN.core.math.mod,(e,t)=>t[0](e)%t[1](e)),h(i.AN.core.math.min,(e,t)=>{let n=Number.POSITIVE_INFINITY
if("number"==typeof t.length)for(let r=0,i=t.length;r<i;r++)n=Math.min(t[r](e),n)
else for(const r of Object.keys(t))n=Math.min(t[r](e),n)
return n}),h(i.AN.core.math.max,(e,t)=>{let n=Number.NEGATIVE_INFINITY
if("number"==typeof t.length)for(let r=0,i=t.length;r<i;r++)n=Math.max(t[r](e),n)
else for(const r of Object.keys(t))n=Math.max(t[r](e),n)
return n}),h(i.AN.core.math.cantorPairing,(e,t)=>(0,u.m1)(t[0](e),t[1](e))),h(i.AN.core.math.sortedCantorPairing,(e,t)=>(0,u.bd)(t[0](e),t[1](e))),h(i.AN.core.math.invertCantorPairing,(e,t)=>(0,u.Ao)([0,0],t[0](e))),h(i.AN.core.math.floor,(e,t)=>Math.floor(t[0](e))),h(i.AN.core.math.ceil,(e,t)=>Math.ceil(t[0](e))),h(i.AN.core.math.roundInt,(e,t)=>Math.round(t[0](e))),h(i.AN.core.math.trunc,(e,t)=>Math.trunc(t[0](e))),h(i.AN.core.math.abs,(e,t)=>Math.abs(t[0](e))),h(i.AN.core.math.sign,(e,t)=>Math.sign(t[0](e))),h(i.AN.core.math.sqrt,(e,t)=>Math.sqrt(t[0](e))),h(i.AN.core.math.cbrt,(e,t)=>Math.cbrt(t[0](e))),h(i.AN.core.math.sin,(e,t)=>Math.sin(t[0](e))),h(i.AN.core.math.cos,(e,t)=>Math.cos(t[0](e))),h(i.AN.core.math.tan,(e,t)=>Math.tan(t[0](e))),h(i.AN.core.math.asin,(e,t)=>Math.asin(t[0](e))),h(i.AN.core.math.acos,(e,t)=>Math.acos(t[0](e))),h(i.AN.core.math.atan,(e,t)=>Math.atan(t[0](e))),h(i.AN.core.math.sinh,(e,t)=>Math.sinh(t[0](e))),h(i.AN.core.math.cosh,(e,t)=>Math.cosh(t[0](e))),h(i.AN.core.math.tanh,(e,t)=>Math.tanh(t[0](e))),h(i.AN.core.math.exp,(e,t)=>Math.exp(t[0](e))),h(i.AN.core.math.log,(e,t)=>Math.log(t[0](e))),h(i.AN.core.math.log10,(e,t)=>Math.log10(t[0](e))),h(i.AN.core.math.atan2,(e,t)=>Math.atan2(t[0](e),t[1](e))),h(i.AN.core.str.match,(e,t)=>t[0](e).test(t[1](e))),h(i.AN.core.str.concat,(e,t)=>{const n=[]
if("number"==typeof t.length)for(let r=0,i=t.length;r<i;r++)n.push(t[r](e).toString())
else for(const r of Object.keys(t))n.push(t[r](e).toString())
return n.join("")}),h(i.AN.core.list.getAt,(e,t)=>t[0](e)[t[1](e)]),h(i.AN.core.list.equal,(e,t)=>(0,p.af)(t[0](e),t[1](e))),h(i.AN.core.set.has,function(e,t){return t[0](e).has(t[1](e))}),h(i.AN.core.set.isSubset,function(e,t){return s.M.isSuperset(t[1](e),t[0](e))}),h(i.AN.core.flags.hasAny,(e,t)=>{const n=t[1](e),r=t[0](e)
return n?0!==(r&n):!!r}),h(i.AN.core.flags.hasAll,(e,t)=>{const n=t[1](e),r=t[0](e)
return n?(r&n)===n:!r}),h(i.AN.structureQuery.type.elementSymbol,(e,t)=>(0,a.ElementSymbol)(t[0](e))),h(i.AN.structureQuery.type.atomName,(e,t)=>(0,l.r4)(t[0](e))),h(i.AN.structureQuery.type.bondFlags,(e,t)=>{let n=a.BondType.Flag.None
if("number"==typeof t.length)for(let r=0,i=t.length;r<i;r++)n=y(n,t[r](e))
else for(const r of Object.keys(t))n=y(n,t[r](e))
return n}),h(i.AN.structureQuery.type.ringFingerprint,(e,t)=>o.UnitRing.elementFingerprint(function(e,t){const n=[]
if(!t)return n
if("number"==typeof t.length)for(let r=0,i=t.length;r<i;r++)n.push(t[r](e))
else{const r=Object.keys(t)
for(let i=1,o=r.length;i<o;i++)n.push(t[r[i]](e))}return n}(e,t))),h(i.AN.structureQuery.type.secondaryStructureFlags,(e,t)=>{let n=a.SecondaryStructureType.Flag.None
if("number"==typeof t.length)for(let r=0,i=t.length;r<i;r++)n=v(n,t[r](e))
else for(const r of Object.keys(t))n=v(n,t[r](e))
return n}),f(i.AN.structureQuery.filter.pick,(e,t)=>o.Queries.filters.pick(t[0],t.test)(e)),f(i.AN.structureQuery.filter.first,(e,t)=>o.Queries.filters.first(t[0])(e)),f(i.AN.structureQuery.filter.withSameAtomProperties,(e,t)=>o.Queries.filters.withSameAtomProperties(t[0],t.source,t.property)(e)),f(i.AN.structureQuery.filter.intersectedBy,(e,t)=>o.Queries.filters.areIntersectedBy(t[0],t.by)(e)),f(i.AN.structureQuery.filter.within,(e,t)=>{var n,r,i
return o.Queries.filters.within({query:t[0],target:t.target,minRadius:null===(n=t["min-radius"])||void 0===n?void 0:n.call(t,e),maxRadius:null===(r=t["max-radius"])||void 0===r?void 0:r.call(t,e),elementRadius:t["atom-radius"],invert:null===(i=t.invert)||void 0===i?void 0:i.call(t,e)})(e)}),f(i.AN.structureQuery.filter.isConnectedTo,(e,t)=>{var n,r
return o.Queries.filters.isConnectedTo({query:t[0],target:t.target,disjunct:null===(n=t.disjunct)||void 0===n?void 0:n.call(t,e),invert:null===(r=t.invert)||void 0===r?void 0:r.call(t,e),bondTest:t["bond-test"]})(e)}),f(i.AN.structureQuery.generator.atomGroups,function(e,t){return o.Queries.generators.atoms({entityTest:t["entity-test"],chainTest:t["chain-test"],residueTest:t["residue-test"],atomTest:t["atom-test"],groupBy:t["group-by"]})(e)}),f(i.AN.structureQuery.generator.all,function(e){return o.Queries.generators.all(e)}),f(i.AN.structureQuery.generator.empty,function(e){return o.Queries.generators.none(e)}),f(i.AN.structureQuery.generator.bondedAtomicPairs,function(e,t){return o.Queries.generators.bondedAtomicPairs(t&&t[0])(e)}),f(i.AN.structureQuery.generator.rings,function(e,t){var n,r
return o.Queries.generators.rings(null===(n=null==t?void 0:t.fingerprint)||void 0===n?void 0:n.call(t,e),null===(r=null==t?void 0:t["only-aromatic"])||void 0===r?void 0:r.call(t,e))(e)}),f(i.AN.structureQuery.generator.queryInSelection,function(e,t){var n
return o.Queries.generators.querySelection(t[0],t.query,null===(n=t["in-complement"])||void 0===n?void 0:n.call(t,e))(e)}),f(i.AN.structureQuery.modifier.includeSurroundings,function(e,t){return o.Queries.modifiers.includeSurroundings(t[0],{radius:t.radius(e),wholeResidues:!(!t["as-whole-residues"]||!t["as-whole-residues"](e)),elementRadius:t["atom-radius"]})(e)}),f(i.AN.structureQuery.modifier.surroundingLigands,function(e,t){return o.Queries.modifiers.surroundingLigands({query:t[0],radius:t.radius(e),includeWater:!(!t["include-water"]||!t["include-water"](e))})(e)}),f(i.AN.structureQuery.modifier.wholeResidues,function(e,t){return o.Queries.modifiers.wholeResidues(t[0])(e)}),f(i.AN.structureQuery.modifier.union,function(e,t){return o.Queries.modifiers.union(t[0])(e)}),f(i.AN.structureQuery.modifier.expandProperty,function(e,t){return o.Queries.modifiers.expandProperty(t[0],t.property)(e)}),f(i.AN.structureQuery.modifier.exceptBy,function(e,t){return o.Queries.modifiers.exceptBy(t[0],t.by)(e)}),f(i.AN.structureQuery.modifier.includeConnected,function(e,t){var n,r
return o.Queries.modifiers.includeConnected({query:t[0],bondTest:t["bond-test"],wholeResidues:!(!t["as-whole-residues"]||!t["as-whole-residues"](e)),layerCount:t["layer-count"]&&t["layer-count"](e)||1,fixedPoint:null!==(r=null===(n=t["fixed-point"])||void 0===n?void 0:n.call(t,e))&&void 0!==r&&r})(e)}),f(i.AN.structureQuery.modifier.intersectBy,function(e,t){return o.Queries.modifiers.intersectBy(t[0],t.by)(e)}),f(i.AN.structureQuery.combinator.merge,(e,t)=>o.Queries.combinators.merge(t)(e)),f(i.AN.structureQuery.atomProperty.core.elementSymbol,g(o.StructureProperties.atom.type_symbol)),f(i.AN.structureQuery.atomProperty.core.vdw,(e,t)=>(0,c.sO)(o.StructureProperties.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))),f(i.AN.structureQuery.atomProperty.core.mass,(e,t)=>(0,c.A9)(o.StructureProperties.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))),f(i.AN.structureQuery.atomProperty.core.atomicNumber,(e,t)=>(0,c.PR)(o.StructureProperties.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))),f(i.AN.structureQuery.atomProperty.core.x,g(o.StructureProperties.atom.x)),f(i.AN.structureQuery.atomProperty.core.y,g(o.StructureProperties.atom.y)),f(i.AN.structureQuery.atomProperty.core.z,g(o.StructureProperties.atom.z)),f(i.AN.structureQuery.atomProperty.core.sourceIndex,g(o.StructureProperties.atom.sourceIndex)),f(i.AN.structureQuery.atomProperty.core.operatorName,g(o.StructureProperties.unit.operator_name)),f(i.AN.structureQuery.atomProperty.core.instanceId,g(o.StructureProperties.unit.instance_id)),f(i.AN.structureQuery.atomProperty.core.operatorKey,g(o.StructureProperties.unit.operator_key)),f(i.AN.structureQuery.atomProperty.core.modelIndex,g(o.StructureProperties.unit.model_index)),f(i.AN.structureQuery.atomProperty.core.modelLabel,g(o.StructureProperties.unit.model_label)),f(i.AN.structureQuery.atomProperty.core.modelEntryId,g(o.StructureProperties.unit.model_entry_id)),f(i.AN.structureQuery.atomProperty.core.atomKey,(e,t)=>{const n=t&&t[0]&&t[0](e)||e.element
return(0,u.m1)(n.unit.id,n.element)}),f(i.AN.structureQuery.atomProperty.macromolecular.residueKey,(e,t)=>o.StructureElement.residueIndex(t&&t[0]&&t[0](e)||e.element)),f(i.AN.structureQuery.atomProperty.macromolecular.chainKey,(e,t)=>o.StructureElement.chainIndex(t&&t[0]&&t[0](e)||e.element)),f(i.AN.structureQuery.atomProperty.macromolecular.entityKey,(e,t)=>o.StructureElement.entityIndex(t&&t[0]&&t[0](e)||e.element)),f(i.AN.structureQuery.atomProperty.macromolecular.id,g(o.StructureProperties.atom.id)),f(i.AN.structureQuery.atomProperty.macromolecular.isHet,(e,t)=>"ATOM"!==o.StructureProperties.residue.group_PDB(t&&t[0]&&t[0](e)||e.element)),f(i.AN.structureQuery.atomProperty.macromolecular.label_atom_id,g(o.StructureProperties.atom.label_atom_id)),f(i.AN.structureQuery.atomProperty.macromolecular.label_alt_id,g(o.StructureProperties.atom.label_alt_id)),f(i.AN.structureQuery.atomProperty.macromolecular.label_comp_id,g(o.StructureProperties.atom.label_comp_id)),f(i.AN.structureQuery.atomProperty.macromolecular.label_seq_id,g(o.StructureProperties.residue.label_seq_id)),f(i.AN.structureQuery.atomProperty.macromolecular.label_asym_id,g(o.StructureProperties.chain.label_asym_id)),f(i.AN.structureQuery.atomProperty.macromolecular.label_entity_id,g(o.StructureProperties.entity.id)),f(i.AN.structureQuery.atomProperty.macromolecular.auth_atom_id,g(o.StructureProperties.atom.auth_atom_id)),f(i.AN.structureQuery.atomProperty.macromolecular.auth_comp_id,g(o.StructureProperties.atom.auth_comp_id)),f(i.AN.structureQuery.atomProperty.macromolecular.auth_seq_id,g(o.StructureProperties.residue.auth_seq_id)),f(i.AN.structureQuery.atomProperty.macromolecular.auth_asym_id,g(o.StructureProperties.chain.auth_asym_id)),f(i.AN.structureQuery.atomProperty.macromolecular.pdbx_PDB_ins_code,g(o.StructureProperties.residue.pdbx_PDB_ins_code)),f(i.AN.structureQuery.atomProperty.macromolecular.pdbx_formal_charge,g(o.StructureProperties.atom.pdbx_formal_charge)),f(i.AN.structureQuery.atomProperty.macromolecular.occupancy,g(o.StructureProperties.atom.occupancy)),f(i.AN.structureQuery.atomProperty.macromolecular.B_iso_or_equiv,g(o.StructureProperties.atom.B_iso_or_equiv)),f(i.AN.structureQuery.atomProperty.macromolecular.entityType,g(o.StructureProperties.entity.type)),f(i.AN.structureQuery.atomProperty.macromolecular.entitySubtype,g(o.StructureProperties.entity.subtype)),f(i.AN.structureQuery.atomProperty.macromolecular.entityPrdId,g(o.StructureProperties.entity.prd_id)),f(i.AN.structureQuery.atomProperty.macromolecular.entityDescription,g(o.StructureProperties.entity.pdbx_description)),f(i.AN.structureQuery.atomProperty.macromolecular.objectPrimitive,g(o.StructureProperties.unit.object_primitive)),f(i.AN.structureQuery.atomProperty.macromolecular.isNonStandard,g(o.StructureProperties.residue.isNonStandard)),f(i.AN.structureQuery.atomProperty.macromolecular.secondaryStructureKey,g(o.StructureProperties.residue.secondary_structure_key)),f(i.AN.structureQuery.atomProperty.macromolecular.secondaryStructureFlags,g(o.StructureProperties.residue.secondary_structure_type)),f(i.AN.structureQuery.atomProperty.macromolecular.chemCompType,g(o.StructureProperties.residue.chem_comp_type)),f(i.AN.structureQuery.atomProperty.macromolecular.residueSourceIndex,g(o.StructureProperties.residue.residueSourceIndex)),f(i.AN.structureQuery.atomProperty.ihm.hasSeqId,function(e,t){const n=e.element,r=t&&t[0]&&t[0](e)
return n.unit.kind===o.Unit.Kind.Atomic?r===o.StructureProperties.residue.label_seq_id(n):r>=o.StructureProperties.coarse.seq_id_begin(n)&&r<=o.StructureProperties.coarse.seq_id_end(n)}),f(i.AN.structureQuery.atomProperty.ihm.overlapsSeqIdRange,function(e,t){var n,r
const i=e.element,a=null!==(n=t&&t.beg&&t.beg(e))&&void 0!==n?n:-Number.MAX_VALUE,s=null!==(r=t&&t.end&&t.end(e))&&void 0!==r?r:Number.MAX_VALUE
if(i.unit.kind===o.Unit.Kind.Atomic){const e=o.StructureProperties.residue.label_seq_id(i)
return e>=a&&e<=s}const l=o.StructureProperties.coarse.seq_id_begin(i),c=o.StructureProperties.coarse.seq_id_end(i)
return l>=a&&l<=s||c>=a&&c<=s||l<=a&&c>=s}),f(i.AN.structureQuery.atomSet.atomCount,function(e,t){return o.Queries.atomset.atomCount(e)}),f(i.AN.structureQuery.atomSet.countQuery,function(e,t){return o.Queries.atomset.countQuery(t[0])(e)}),f(i.AN.structureQuery.atomSet.propertySet,function(e,t){return o.Queries.atomset.propertySet(t[0])(e)}),f(i.AN.structureQuery.bondProperty.order,(e,t)=>e.atomicBond.order),f(i.AN.structureQuery.bondProperty.flags,(e,t)=>e.atomicBond.type),f(i.AN.structureQuery.bondProperty.key,(e,t)=>e.atomicBond.key),f(i.AN.structureQuery.bondProperty.atomA,(e,t)=>e.atomicBond.a),f(i.AN.structureQuery.bondProperty.atomB,(e,t)=>e.atomicBond.b),f(i.AN.structureQuery.bondProperty.length,(e,t)=>e.atomicBond.length),f(i.AN.internal.generator.bundleElement,function(e,t){return(0,d.bundleElementImpl)(t.groupedUnits(e),t.ranges(e),t.set(e))}),f(i.AN.internal.generator.bundle,function(e,t){return(0,d.bundleGenerator)(t.elements(e))(e)}),f(i.AN.internal.generator.current,function(e,t){return e.tryGetCurrentSelection()})]
function g(e){return(t,n)=>e(n&&n[0]&&n[0](t)||t.element)}function y(e,t){return e|(a.BondType.isName(t)?a.BondType.fromName(t):a.BondType.Flag.None)}function v(e,t){switch(t.toLowerCase()){case"helix":return e|a.SecondaryStructureType.Flag.Helix
case"alpha":return e|a.SecondaryStructureType.Flag.Helix|a.SecondaryStructureType.Flag.HelixAlpha
case"pi":return e|a.SecondaryStructureType.Flag.Helix|a.SecondaryStructureType.Flag.HelixPi
case"310":return e|a.SecondaryStructureType.Flag.Helix|a.SecondaryStructureType.Flag.Helix3Ten
case"beta":return e|a.SecondaryStructureType.Flag.Beta
case"strand":return e|a.SecondaryStructureType.Flag.Beta|a.SecondaryStructureType.Flag.BetaStrand
case"sheet":return e|a.SecondaryStructureType.Flag.Beta|a.SecondaryStructureType.Flag.BetaSheet
case"turn":return e|a.SecondaryStructureType.Flag.Turn
case"bend":return e|a.SecondaryStructureType.Flag.Bend
case"coil":return e|a.SecondaryStructureType.Flag.NA
default:return e}}!function(){for(const e of m)r.oY.addSymbol(e)}()},85672(e,t,n){"use strict"
n.d(t,{HQ:()=>m,RB:()=>o})
var r=n(33241),i=n(41736)
const o="Trajectory"
function a(e,t){return e.builders.structure.hierarchy.applyPreset(t.trajectory,"default")}const s={label:"mmCIF",description:"mmCIF",category:o,stringExtensions:["cif","mmcif","mcif"],binaryExtensions:["bcif"],isApplicable:(e,t)=>"mmcif"===e.ext||"mcif"===e.ext||("cif"===e.ext||"bcif"===e.ext)&&-1===(0,i.v)(e,t),parse:async(e,t,n)=>{var i,o
const a=e.state.data.build().to(t).apply(r.f.Data.ParseCif,void 0,{state:{isGhost:!0}}),s=await a.apply(r.f.Model.TrajectoryFromMmCif,void 0,{tags:null==n?void 0:n.trajectoryTags}).commit({revertOnError:!0})
return((null===(o=null===(i=a.selector.cell)||void 0===i?void 0:i.obj)||void 0===o?void 0:o.data.blocks.length)||0)>1&&e.state.data.updateCellState(a.ref,{isGhost:!1}),{trajectory:s}},visuals:a},l={label:"cifCore",description:"CIF Core",category:o,stringExtensions:["cif"],isApplicable:(e,t)=>"cif"===e.ext&&"coreCif"===(0,i.v)(e,t),parse:async(e,t,n)=>{var i,o
const a=e.state.data.build().to(t).apply(r.f.Data.ParseCif,void 0,{state:{isGhost:!0}}),s=await a.apply(r.f.Model.TrajectoryFromCifCore,void 0,{tags:null==n?void 0:n.trajectoryTags}).commit({revertOnError:!0})
return((null===(o=null===(i=a.selector.cell)||void 0===i?void 0:i.obj)||void 0===o?void 0:o.data.blocks.length)||0)>1&&e.state.data.updateCellState(a.ref,{isGhost:!1}),{trajectory:s}},visuals:a}
function c(e,t){return async(n,r,i)=>{const o=n.state.data
return{trajectory:await o.build().to(r).apply(e,t,{tags:null==i?void 0:i.trajectoryTags}).commit({revertOnError:!0})}}}const u={label:"PDB",description:"PDB",category:o,stringExtensions:["pdb","ent"],parse:c(r.f.Model.TrajectoryFromPDB),visuals:a},d={label:"PDBQT",description:"PDBQT",category:o,stringExtensions:["pdbqt"],parse:c(r.f.Model.TrajectoryFromPDB,{isPdbqt:!0}),visuals:a},p={label:"XYZ",description:"XYZ",category:o,stringExtensions:["xyz"],parse:c(r.f.Model.TrajectoryFromXYZ),visuals:a},h={label:"Lammps Data",description:"Lammps Data",category:o,stringExtensions:["data"],parse:c(r.f.Model.TrajectoryFromLammpsData),visuals:a},f={label:"Lammps Trajectory Data",description:"Lammps Trajectory Data",category:o,stringExtensions:["lammpstrj"],parse:c(r.f.Model.TrajectoryFromLammpsTrajData),visuals:a},m=[["mmcif",s],["cifCore",l],["pdb",u],["pdbqt",d],["gro",{label:"GRO",description:"GRO",category:o,stringExtensions:["gro"],binaryExtensions:[],parse:c(r.f.Model.TrajectoryFromGRO),visuals:a}],["xyz",p],["lammps_data",h],["lammps_traj_data",f],["mol",{label:"MOL",description:"MOL",category:o,stringExtensions:["mol"],parse:c(r.f.Model.TrajectoryFromMOL),visuals:a}],["sdf",{label:"SDF",description:"SDF",category:o,stringExtensions:["sdf","sd"],parse:c(r.f.Model.TrajectoryFromSDF),visuals:a}],["mol2",{label:"MOL2",description:"MOL2",category:o,stringExtensions:["mol2"],parse:c(r.f.Model.TrajectoryFromMOL2),visuals:a}]]},86752(e,t,n){"use strict"
function r(e){return e.reduce((e,t)=>Number(e)-Number(t))}n.r(t),n.d(t,{default:()=>i,sub:()=>r})
var i=(0,n(10336).helper)(r)},86814(e,t,n){"use strict"
n.d(t,{$:()=>r})
var r={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}},87095(e,t,n){"use strict"
n.r(t),n.d(t,{AminoAcidNames:()=>R,AminoAcidNamesD:()=>M,AminoAcidNamesL:()=>D,BaseNames:()=>V,BetaProteinComponentTypeNames:()=>S,BondType:()=>re,CommonProteinCaps:()=>O,DNAComponentTypeNames:()=>T,DProteinComponentTypeNames:()=>v,DefaultMaxAsa:()=>ne,DefaultResidueHydrophobicity:()=>oe,DnaBaseNames:()=>N,ElementSymbol:()=>c,EntityType:()=>p,GammaProteinComponentTypeNames:()=>x,IonComponentTypeNames:()=>B,LProteinComponentTypeNames:()=>b,LipidComponentTypeNames:()=>E,MaxAsa:()=>te,MoleculeType:()=>h,NucleicBackboneAtoms:()=>y,OtherComponentTypeNames:()=>P,OtherProteinComponentTypeNames:()=>C,PeptideBaseNames:()=>F,PolymerNames:()=>H,PolymerType:()=>f,PolymerTypeAtomRoleId:()=>m,ProteinBackboneAtoms:()=>g,ProteinComponentTypeNames:()=>w,ProteinTerminusComponentTypeNames:()=>_,PurineBaseNames:()=>z,PyrimidineBaseNames:()=>j,RNAComponentTypeNames:()=>A,ResidueHydrophobicity:()=>ie,RnaBaseNames:()=>L,SaccharideComponentTypeNames:()=>I,SecondaryStructureType:()=>ee,WaterNames:()=>k,getComponentType:()=>$,getDefaultChemicalComponent:()=>X,getElementFromAtomicNumber:()=>d,getEntitySubtype:()=>Y,getEntityType:()=>W,getMoleculeType:()=>q,getPolymerType:()=>Q,isNucleic:()=>K,isPolymer:()=>Z,isProtein:()=>J,isPurineBase:()=>U,isPyrimidineBase:()=>G})
var r=n(36432),i=n(11350),o=n(42261)
const a=new Set(["DAPC","DBPC","DFPC","DGPC","DIPC","DLPC","DNPC","DOPC","DPPC","DRPC","DTPC","DVPC","DXPC","DYPC","LPPC","PAPC","PEPC","PGPC","PIPC","POPC","PRPC","PUPC","DAPE","DBPE","DFPE","DGPE","DIPE","DLPE","DNPE","DOPE","DPPE","DRPE","DTPE","DUPE","DVPE","DXPE","DYPE","LPPE","PAPE","PGPE","PIPE","POPE","PQPE","PRPE","PUPE","DAPS","DBPS","DFPS","DGPS","DIPS","DLPS","DNPS","DOPS","DPPS","DRPS","DTPS","DUPS","DVPS","DXPS","DYPS","LPPS","PAPS","PGPS","PIPS","POPS","PQPS","PRPS","PUPS","DAPA","DBPA","DFPA","DGPA","DIPA","DLPA","DNPA","DOPA","DPPA","DRPA","DTPA","DVPA","DXPA","DYPA","LPPA","PAPA","PGPA","PIPA","POPA","PRPA","PUPA","DAPG","DBPG","DFPG","DGPG","DIPG","DLPG","DNPG","DOPG","DPPG","DRPG","DTPG","DVPG","DXPG","DYPG","LPPG","PAPG","PGPG","PIPG","POPG","PRPG","DMPC","DPP","DPPI","PAPI","PIPI","POP","POPI","PUPI","PVP","PVPI","PADG","PIDG","PODG","PUDG","PVDG","APC","CPC","IPC","LPC","OPC","PPC","TPC","UPC","VPC","BNSM","DBSM","DPSM","DXSM","PGSM","PNSM","POSM","PVSM","XNSM","DPCE","DXCE","PNCE","XNCE"]),s=new Set(["118","119","543","1AL","1CU","2FK","2HP","2OF","3CO","3MT","3NI","3OF","3P8","4MO","4PU","4TI","6MO","ACT","AG","AL","ALF","AM","ATH","AU","AU3","AUC","AZI","BA","BCT","BEF","BF4","BO4","BR","BS3","BSY","CA","CAC","CD","CD1","CD3","CD5","CE","CF","CHT","CL","CO","CO3","CO5","CON","CR","CS","CSB","CU","CU1","CU3","CUA","CUZ","CYN","DME","DMI","DSC","DTI","DY","E4N","EDR","EMC","ER3","EU","EU3","F","FE","FE2","FPO","GA","GD3","GEP","HAI","HG","HGC","IN","IOD","IR","IR3","IRI","IUM","K","KO4","LA","LCO","LCP","LI","LU","MAC","MG","MH2","MH3","MLI","MMC","MN","MN3","MN5","MN6","MO1","MO2","MO3","MO4","MO5","MO6","MOO","MOS","MOW","MW1","MW2","MW3","NA","NA2","NA5","NA6","NAO","NAW","ND","NET","NH4","NI","NI1","NI2","NI3","NO2","NO3","NRU","NT3","O4M","OAA","OC1","OC2","OC3","OC4","OC5","OC6","OC7","OC8","OCL","OCM","OCN","OCO","OF1","OF2","OF3","OH","OS","OS4","OXL","PB","PBM","PD","PDV","PER","PI","PO3","PO4","PR","PT","PT4","PTN","RB","RH3","RHD","RHF","RU","SB","SCN","SE4","SEK","SM","SMO","SO3","SO4","SR","T1A","TB","TBA","TCN","TEA","TH","THE","TL","TMA","TRA","UNX","V","VN3","VO4","W","WO5","Y1","YB","YB2","YH","YT3","ZCM","ZN","ZN2","ZN3","ZNO","ZO3","ZR","ZTM","NCO","OHX"]),l=function(){const e=Object.create(null),t=[]
for(let n="A".charCodeAt(0);n<="Z".charCodeAt(0);n++)t[t.length]=String.fromCharCode(n)
for(let n="a".charCodeAt(0);n<="z".charCodeAt(0);n++)t[t.length]=String.fromCharCode(n)
for(let n="0".charCodeAt(0);n<="9".charCodeAt(0);n++)t[t.length]=String.fromCharCode(n)
for(const n of t){e[n]=n.toUpperCase()
for(const r of t){e[n+r]=(n+r).toUpperCase()
for(const i of t)e[n+r+i]=(n+r+i).toUpperCase()}}return e}()
function c(e){return l[e]||e.toUpperCase()}const u=new Map([[1,"H"],[2,"He"],[3,"Li"],[4,"Be"],[5,"B"],[6,"C"],[7,"N"],[8,"O"],[9,"F"],[10,"Ne"],[11,"Na"],[12,"Mg"],[13,"Al"],[14,"Si"],[15,"P"],[16,"S"],[17,"Cl"],[18,"Ar"],[19,"K"],[20,"Ca"],[21,"Sc"],[22,"Ti"],[23,"V"],[24,"Cr"],[25,"Mn"],[26,"Fe"],[27,"Co"],[28,"Ni"],[29,"Cu"],[30,"Zn"],[31,"Ga"],[32,"Ge"],[33,"As"],[34,"Se"],[35,"Br"],[36,"Kr"],[37,"Rb"],[38,"Sr"],[39,"Y"],[40,"Zr"],[41,"Nb"],[42,"Mo"],[43,"Tc"],[44,"Ru"],[45,"Rh"],[46,"Pd"],[47,"Ag"],[48,"Cd"],[49,"In"],[50,"Sn"],[51,"Sb"],[52,"Te"],[53,"I"],[54,"Xe"],[55,"Cs"],[56,"Ba"],[57,"La"],[58,"Ce"],[59,"Pr"],[60,"Nd"],[61,"Pm"],[62,"Sm"],[63,"Eu"],[64,"Gd"],[65,"Tb"],[66,"Dy"],[67,"Ho"],[68,"Er"],[69,"Tm"],[70,"Yb"],[71,"Lu"],[72,"Hf"],[73,"Ta"],[74,"W"],[75,"Re"],[76,"Os"],[77,"Ir"],[78,"Pt"],[79,"Au"],[80,"Hg"],[81,"Tl"],[82,"Pb"],[83,"Bi"],[84,"Po"],[85,"At"],[86,"Rn"],[87,"Fr"],[88,"Ra"],[89,"Ac"],[90,"Th"],[91,"Pa"],[92,"U"],[93,"Np"],[94,"Pu"],[95,"Am"],[96,"Cm"],[97,"Bk"],[98,"Cf"],[99,"Es"],[100,"Fm"],[101,"Md"],[102,"No"],[103,"Lr"],[104,"Rf"],[105,"Db"],[106,"Sg"],[107,"Bh"],[108,"Hs"],[109,"Mt"],[110,"Ds"],[111,"Rg"],[112,"Cn"],[113,"Uut"],[114,"Fl"],[115,"Uup"],[116,"Lv"],[117,"Uus"],[118,"Uuo"]].map(e=>[e[0],c(e[1])]))
function d(e){return u.has(e)?u.get(e):c("H")}var p,h,f
!function(e){e[e.unknown=0]="unknown",e[e.polymer=1]="polymer",e[e["non-polymer"]=2]="non-polymer",e[e.macrolide=3]="macrolide",e[e.water=4]="water",e[e.branched=5]="branched"}(p||(p={})),function(e){e[e.Unknown=0]="Unknown",e[e.Other=1]="Other",e[e.Water=2]="Water",e[e.Ion=3]="Ion",e[e.Lipid=4]="Lipid",e[e.Protein=5]="Protein",e[e.RNA=6]="RNA",e[e.DNA=7]="DNA",e[e.PNA=8]="PNA",e[e.Saccharide=9]="Saccharide"}(h||(h={})),function(e){e[e.NA=0]="NA",e[e.Protein=1]="Protein",e[e.GammaProtein=2]="GammaProtein",e[e.BetaProtein=3]="BetaProtein",e[e.RNA=4]="RNA",e[e.DNA=5]="DNA",e[e.PNA=6]="PNA"}(f||(f={}))
const m={[f.NA]:{trace:new Set,directionFrom:new Set,directionTo:new Set,backboneStart:new Set,backboneEnd:new Set,coarseBackbone:new Set},[f.Protein]:{trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O","OC1","O1","OX1","OXT","OT1"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["C"]),coarseBackbone:new Set(["CA","CA1","BB","BAS"])},[f.GammaProtein]:{trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["CD"]),coarseBackbone:new Set(["CA"])},[f.BetaProtein]:{trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["CG"]),coarseBackbone:new Set(["CA"])},[f.RNA]:{trace:new Set(["O3'","O3*"]),directionFrom:new Set(["C4'","C4*"]),directionTo:new Set(["C3'","C3*"]),backboneStart:new Set(["P"]),backboneEnd:new Set(["O3'","O3*"]),coarseBackbone:new Set(["P"])},[f.DNA]:{trace:new Set(["O3'","O3*"]),directionFrom:new Set(["C3'","C3*"]),directionTo:new Set(["C1'","C1*"]),backboneStart:new Set(["P"]),backboneEnd:new Set(["O3'","O3*"]),coarseBackbone:new Set(["P"])},[f.PNA]:{trace:new Set(["N4'","N4*"]),directionFrom:new Set(["N4'","N4*"]),directionTo:new Set(["C7'","C7*"]),backboneStart:new Set(["N1'","N1*"]),backboneEnd:new Set(["C'","C*"]),coarseBackbone:new Set(["P"])}},g=new Set(["CA","C","N","O","O1","O2","OC1","OC2","OT1","OT2","OX1","OXT","H","H1","H2","H3","HA","HN","HXT","BB"]),y=new Set(["P","OP1","OP2","HOP2","HOP3","O2'","O3'","O4'","O5'","C1'","C2'","C3'","C4'","C5'","H1'","H2'","H2''","HO2'","H3'","H4'","H5'","H5''","HO3'","HO5'","O2*","O3*","O4*","O5*","C1*","C2*","C3*","C4*","C5*"]),v=new Set(["d-peptide linking","d-peptide nh3 amino terminus","d-peptide cooh carboxy terminus","d-gamma-peptide, c-delta linking","d-beta-peptide, c-gamma linking"]),b=new Set(["l-peptide linking","l-peptide nh3 amino terminus","l-peptide cooh carboxy terminus","l-gamma-peptide, c-delta linking","l-beta-peptide, c-gamma linking"]),x=new Set(["d-gamma-peptide, c-delta linking","l-gamma-peptide, c-delta linking"]),S=new Set(["d-beta-peptide, c-gamma linking","l-beta-peptide, c-gamma linking"]),_=new Set(["d-peptide nh3 amino terminus","d-peptide cooh carboxy terminus","l-peptide nh3 amino terminus","l-peptide cooh carboxy terminus"]),C=new Set(["peptide linking","peptide-like"]),w=o.M.unionMany(v,b,C),T=new Set(["dna linking","l-dna linking","dna oh 5 prime terminus","dna oh 3 prime terminus"]),A=new Set(["rna linking","l-rna linking","rna oh 5 prime terminus","rna oh 3 prime terminus"]),I=o.M.unionMany(new Set(["d-saccharide, beta linking","l-saccharide, beta linking","d-saccharide, alpha linking","l-saccharide, alpha linking","l-saccharide","d-saccharide","saccharide"]),new Set(["d-saccharide 1,4 and 1,4 linking","l-saccharide 1,4 and 1,4 linking","d-saccharide 1,4 and 1,6 linking","l-saccharide 1,4 and 1,6 linking"])),P=new Set(["non-polymer","other"]),B=new Set(["ion"]),E=new Set(["lipid"]),k=new Set(["SOL","WAT","HOH","H2O","W","DOD","D3O","TIP","TIP3","TIP4","SPC"]),D=new Set(["HIS","ARG","LYS","ILE","PHE","LEU","TRP","ALA","MET","PRO","CYS","ASN","VAL","GLY","SER","GLN","TYR","ASP","GLU","THR","SEC","PYL","UNK","MSE","SEP","TPO","PTR","PCA","HYP","HSD","HSE","HSP","LSN","ASPP","GLUP","HID","HIE","HIP","LYN","ASH","GLH"]),M=new Set(["DAL","DAR","DSG","DAS","DCY","DGL","DGN","DHI","DIL","DLE","DLY","MED","DPN","DPR","DSN","DTH","DTR","DTY","DVA","DNE"]),R=o.M.unionMany(D,M),O=new Set(["NME","ACE","NH2","FOR","FMT"]),L=new Set(["A","C","T","G","I","U","N"]),N=new Set(["DA","DC","DT","DG","DI","DU","DN"]),F=new Set(["APN","CPN","TPN","GPN"]),z=new Set(["A","G","I","DA","DG","DI","APN","GPN"]),j=new Set(["C","T","U","DC","DT","DU","CPN","TPN"]),V=o.M.unionMany(L,N,F),U=e=>z.has(e.toUpperCase()),G=e=>j.has(e.toUpperCase()),H=o.M.unionMany(R,V)
function q(e,t){return t=t.toUpperCase(),F.has(t)?h.PNA:w.has(e)?h.Protein:A.has(e)?h.RNA:T.has(e)?h.DNA:I.has(e)?h.Saccharide:k.has(t)?h.Water:s.has(t)?h.Ion:a.has(t)?h.Lipid:P.has(e)?i.yt.has(t)?h.Saccharide:R.has(t)?h.Protein:L.has(t)?h.RNA:N.has(t)?h.DNA:h.Other:h.Unknown}function Q(e,t){return t===h.Protein?x.has(e)?f.GammaProtein:S.has(e)?f.BetaProtein:_.has(e)?f.NA:f.Protein:t===h.RNA?f.RNA:t===h.DNA?f.DNA:t===h.PNA?f.PNA:f.NA}function $(e){return e=e.toUpperCase(),R.has(e)?"peptide linking":L.has(e)?"rna linking":N.has(e)?"dna linking":i.yt.has(e)?"saccharide":"other"}function X(e){return{formula:"",formula_weight:0,id:e,name:e,mon_nstd_flag:H.has(e)?"y":"n",pdbx_synonyms:[],type:$(e)}}function W(e){return e=e.toUpperCase(),k.has(e)?"water":H.has(e)?"polymer":i.yt.has(e)?"branched":"non-polymer"}function Y(e,t){return e=e.toUpperCase(),b.has(t)?"polypeptide(L)":v.has(t)?"polypeptide(D)":A.has(t)?"polyribonucleotide":T.has(t)?"polydeoxyribonucleotide":I.has(t)||i.yt.has(e)?"oligosaccharide":F.has(e)?"peptide nucleic acid":D.has(e)?"polypeptide(L)":M.has(e)?"polypeptide(D)":L.has(e)?"polyribonucleotide":N.has(e)?"polydeoxyribonucleotide":B.has(t)||s.has(e)?"ion":E.has(t)||a.has(e)?"lipid":C.has(t)?"peptide-like":"other"}function Z(e){return K(e)||J(e)}function K(e){return e===h.DNA||e===h.RNA||e===h.PNA}function J(e){return e===h.Protein}var ee
!function(e){let t
e.is=r.N.has,e.create=r.N.create,function(e){e[e.None=0]="None",e[e.DoubleHelix=1]="DoubleHelix",e[e.Helix=2]="Helix",e[e.Beta=4]="Beta",e[e.Bend=8]="Bend",e[e.Turn=16]="Turn",e[e.LeftHanded=32]="LeftHanded",e[e.RightHanded=64]="RightHanded",e[e.ClassicTurn=128]="ClassicTurn",e[e.InverseTurn=256]="InverseTurn",e[e.HelixOther=512]="HelixOther",e[e.Helix27=1024]="Helix27",e[e.Helix3Ten=2048]="Helix3Ten",e[e.HelixAlpha=4096]="HelixAlpha",e[e.HelixGamma=8192]="HelixGamma",e[e.HelixOmega=16384]="HelixOmega",e[e.HelixPi=32768]="HelixPi",e[e.HelixPolyproline=65536]="HelixPolyproline",e[e.DoubleHelixOther=131072]="DoubleHelixOther",e[e.DoubleHelixZ=262144]="DoubleHelixZ",e[e.DoubleHelixA=524288]="DoubleHelixA",e[e.DoubleHelixB=1048576]="DoubleHelixB",e[e.BetaOther=2097152]="BetaOther",e[e.BetaStrand=4194304]="BetaStrand",e[e.BetaSheet=8388608]="BetaSheet",e[e.BetaBarell=16777216]="BetaBarell",e[e.TurnOther=33554432]="TurnOther",e[e.Turn1=67108864]="Turn1",e[e.Turn2=134217728]="Turn2",e[e.Turn3=268435456]="Turn3",e[e.NA=536870912]="NA"}(t=e.Flag||(e.Flag={})),e.SecondaryStructureMmcif={helx_lh_27_p:t.Helix|t.LeftHanded|t.Helix27,helx_lh_3t_p:t.Helix|t.LeftHanded|t.Helix3Ten,helx_lh_al_p:t.Helix|t.LeftHanded|t.HelixAlpha,helx_lh_a_n:t.DoubleHelix|t.LeftHanded|t.DoubleHelixA,helx_lh_b_n:t.DoubleHelix|t.LeftHanded|t.DoubleHelixB,helx_lh_ga_p:t.Helix|t.LeftHanded|t.HelixGamma,helx_lh_n:t.DoubleHelix|t.LeftHanded,helx_lh_om_p:t.Helix|t.LeftHanded|t.HelixOmega,helx_lh_ot_n:t.DoubleHelix|t.LeftHanded|t.DoubleHelixOther,helx_lh_ot_p:t.Helix|t.LeftHanded|t.HelixOther,helx_lh_p:t.Helix|t.LeftHanded,helx_lh_pi_p:t.Helix|t.LeftHanded|t.HelixPi,helx_lh_pp_p:t.Helix|t.LeftHanded|t.HelixPolyproline,helx_lh_z_n:t.DoubleHelix|t.LeftHanded|t.DoubleHelixZ,helx_n:t.DoubleHelix,helx_ot_n:t.DoubleHelix,helx_ot_p:t.Helix,helx_p:t.Helix,helx_rh_27_p:t.Helix|t.RightHanded|t.Helix27,helx_rh_3t_p:t.Helix|t.RightHanded|t.Helix3Ten,helx_rh_al_p:t.Helix|t.RightHanded|t.HelixAlpha,helx_rh_a_n:t.DoubleHelix|t.RightHanded|t.DoubleHelixA,helx_rh_b_n:t.DoubleHelix|t.RightHanded|t.DoubleHelixB,helx_rh_ga_p:t.Helix|t.RightHanded|t.HelixGamma,helx_rh_n:t.DoubleHelix|t.RightHanded,helx_rh_om_p:t.Helix|t.RightHanded|t.HelixOmega,helx_rh_ot_n:t.DoubleHelix|t.RightHanded|t.DoubleHelixOther,helx_rh_ot_p:t.Helix|t.RightHanded|t.HelixOther,helx_rh_p:t.Helix|t.RightHanded,helx_rh_pi_p:t.Helix|t.RightHanded|t.HelixPi,helx_rh_pp_p:t.Helix|t.RightHanded|t.HelixPolyproline,helx_rh_z_n:t.DoubleHelix|t.RightHanded|t.DoubleHelixZ,strn:t.Beta|t.BetaStrand,turn_ot_p:t.Turn|t.TurnOther,turn_p:t.Turn,turn_ty1p_p:t.Turn|t.InverseTurn|t.Turn1,turn_ty1_p:t.Turn|t.ClassicTurn|t.Turn1,turn_ty2p_p:t.Turn|t.InverseTurn|t.Turn2,turn_ty2_p:t.Turn|t.ClassicTurn|t.Turn2,turn_ty3p_p:t.Turn|t.InverseTurn|t.Turn3,turn_ty3_p:t.Turn|t.ClassicTurn|t.Turn3,bend:t.Bend,other:t.None},e.SecondaryStructurePdb={1:t.Helix|t.RightHanded|t.HelixAlpha,2:t.Helix|t.RightHanded|t.HelixOmega,3:t.Helix|t.RightHanded|t.HelixPi,4:t.Helix|t.RightHanded|t.HelixGamma,5:t.Helix|t.RightHanded|t.Helix3Ten,6:t.Helix|t.LeftHanded|t.HelixAlpha,7:t.Helix|t.LeftHanded|t.HelixOmega,8:t.Helix|t.LeftHanded|t.HelixGamma,9:t.Helix|t.Helix27,10:t.Helix|t.HelixPolyproline},e.SecondaryStructureStride={H:t.Helix|t.HelixAlpha,G:t.Helix|t.Helix3Ten,I:t.Helix|t.HelixPi,E:t.Beta|t.BetaSheet,B:t.Beta|t.BetaStrand,T:t.Turn,C:t.NA},e.SecondaryStructureDssp={H:t.Helix|t.HelixAlpha,B:t.Beta|t.BetaStrand,E:t.Beta|t.BetaSheet,G:t.Helix|t.Helix3Ten,I:t.Helix|t.HelixPi,T:t.Turn,S:t.Bend}}(ee||(ee={}))
const te={ALA:121,ARG:265,ASN:187,ASP:187,CYS:148,GLU:214,GLN:214,GLY:97,HIS:216,ILE:195,LEU:191,LYS:230,MET:203,PHE:228,PRO:154,SER:143,THR:163,TRP:264,TYR:255,VAL:165,HSD:216,HSE:216,HSP:216,HID:216,HIE:216,HIP:216,ASH:187,GLH:214},ne=121
var re
!function(e){let t
function n(e){switch(e){case"covalent":return t.Covalent
case"metal-coordination":return t.MetallicCoordination
case"hydrogen-bond":return t.HydrogenBond
case"disulfide":return t.Disulfide
case"aromatic":return t.Aromatic
case"computed":return t.Computed}}e.is=r.N.has,function(e){e[e.None=0]="None",e[e.Covalent=1]="Covalent",e[e.MetallicCoordination=2]="MetallicCoordination",e[e.HydrogenBond=4]="HydrogenBond",e[e.Disulfide=8]="Disulfide",e[e.Aromatic=16]="Aromatic",e[e.Computed=32]="Computed"}(t=e.Flag||(e.Flag={})),e.create=function(e){return r.N.create(e)},e.isCovalent=function(t){return 0!==(t&e.Flag.Covalent)},e.isAll=function(e){return e===Math.pow(2,6)-1},e.Names={covalent:t.Covalent,"metal-coordination":t.MetallicCoordination,"hydrogen-bond":t.HydrogenBond,disulfide:t.Disulfide,aromatic:t.Aromatic,computed:t.Computed},e.isName=function(t){return t in e.Names},e.fromName=n,e.fromNames=function(e){let r=t.None
for(let t=0,i=e.length;t<i;++t)r|=n(e[t])
return r}}(re||(re={}))
const ie={ALA:[.17,.5,.33],ARG:[.81,1.81,1],ASN:[.42,.85,.43],ASP:[1.23,3.64,2.41],ASH:[-.07,.43,.5],CYS:[-.24,-.02,.22],GLN:[.58,.77,.19],GLU:[2.02,3.63,1.61],GLH:[-.01,.11,.12],GLY:[.01,1.15,1.14],HIS:[.17,.11,-.06],ILE:[-.31,-1.12,-.81],LEU:[-.56,-1.25,-.69],LYS:[.99,2.8,1.81],MET:[-.23,-.67,-.44],PHE:[-1.13,-1.71,-.58],PRO:[.45,.14,-.31],SER:[.13,.46,.33],THR:[.14,.25,.11],TRP:[-1.85,-2.09,-.24],TYR:[-.94,-.71,.23],VAL:[.07,-.46,-.53],HSD:[.17,.11,-.06],HSE:[.17,.11,-.06],HSP:[.96,2.33,1.37],HID:[.17,.11,-.06],HIE:[.17,.11,-.06],HIP:[.96,2.33,1.37]},oe=[0,0,0]},87166(e,t,n){"use strict"
function r([e,t]){return Math.atan2(e,t)}n.r(t),n.d(t,{atan2:()=>r,default:()=>i})
var i=(0,n(10336).helper)(r)},87423(e,t,n){"use strict"
n.d(t,{H:()=>a,N7:()=>c,TY:()=>l,fC:()=>r,k4:()=>u,pu:()=>o,r6:()=>s})
const r=Math.PI/2,i=Math.PI/180
function o(e){return e*i}function a(e){return e/i}function s(e){return 0!==e&&!(e&e-1)}function l(...e){let t=0,n=0
for(let r=0,i=e.length;r<i;++r){const i=e[r],o=Math.abs(i)
o>n&&(t=i,n=o)}return t}function c(e,t){return e*t}function u(e){let t=0,n=0,r=0,i=-1
const o=2*e+1,a=o/2,s=[]
for(let l=Math.pow(o,2);l>0;--l){if(-a<t&&t<=a&&-a<n&&n<=a&&s.push([t,n]),t===n||t<0&&t===-n||t>0&&t===1-n){const e=r
r=-i,i=e}t+=r,n+=i}return s}},87852(e,t,n){"use strict"
n.d(t,{N:()=>r})
var r,i=n(9043)
!function(e){function t(e){const t=new DataView(e.buffer)
return Object.assign(e.subarray(0),{readInt8:e=>t.getInt8(e),readUInt8:e=>t.getUint8(e),writeInt8:(e,n)=>t.setInt8(n,e),writeUInt8:(e,n)=>t.setUint8(n,e),readInt16LE:e=>t.getInt16(e,!0),readInt32LE:e=>t.getInt32(e,!0),readUInt16LE:e=>t.getUint16(e,!0),readUInt32LE:e=>t.getUint32(e,!0),readFloatLE:e=>t.getFloat32(e,!0),readDoubleLE:e=>t.getFloat64(e,!0),writeInt16LE:(e,n)=>t.setInt16(n,e,!0),writeInt32LE:(e,n)=>t.setInt32(n,e,!0),writeUInt16LE:(e,n)=>t.setUint16(n,e,!0),writeUInt32LE:(e,n)=>t.setUint32(n,e,!0),writeFloatLE:(e,n)=>t.setFloat32(n,e,!0),writeDoubleLE:(e,n)=>t.setFloat64(n,e,!0),readInt16BE:e=>t.getInt16(e,!1),readInt32BE:e=>t.getInt32(e,!1),readUInt16BE:e=>t.getUint16(e,!1),readUInt32BE:e=>t.getUint32(e,!1),readFloatBE:e=>t.getFloat32(e,!1),readDoubleBE:e=>t.getFloat64(e,!1),writeInt16BE:(e,n)=>t.setInt16(n,e,!1),writeInt32BE:(e,n)=>t.setInt32(n,e,!1),writeUInt16BE:(e,n)=>t.setUint16(n,e,!1),writeUInt32BE:(e,n)=>t.setUint32(n,e,!1),writeFloatBE:(e,n)=>t.setFloat32(n,e,!1),writeDoubleBE:(e,n)=>t.setFloat64(n,e,!1),copy:(t,n,r,o)=>(n=(0,i.NT)(n,0),r=(0,i.NT)(r,0),o=(0,i.NT)(o,e.length),t.set(e.subarray(r,o),n),o-r)})}function n(e,t,n,r,i){for(let o=0,a=n;o<a;o+=r)for(let n=0;n<r;n++)t[i+o+r-n-1]=e[i+o+n]}e.fromUint8Array=t,e.fromArrayBuffer=function(e){return t(new Uint8Array(e))},e.fromBuffer=function(e){return e},e.IsNativeEndianLittle=13330===new Uint16Array(new Uint8Array([18,52]).buffer)[0],e.flipByteOrder=n,e.flipByteOrderInPlace2=function(e,t=0,n){const r=new Int16Array(e,t,n)
for(let i=0,o=r.length;i<o;++i){const e=r[i]
r[i]=(255&e)<<8|e>>8&255}},e.ensureLittleEndian=function(t,r,i,o,a){e.IsNativeEndianLittle||!i||o<=1||n(t,r,i,o,a)}}(r||(r={}))},87877(e,t,n){"use strict"
n.d(t,{Ap:()=>l,Mm:()=>c})
var r=n(28074),i=n(25602),o=n(38981),a=n(9043),s=n(99321)
class l extends i.Component{constructor(){super(...arguments),this.state={isChanging:!1,current:0},this.begin=()=>{this.setState({isChanging:!0})},this.end=e=>{this.setState({isChanging:!1}),this.props.onChange(e)},this.updateCurrent=e=>{var t,n
this.setState({current:e}),null===(n=(t=this.props).onChangeImmediate)||void 0===n||n.call(t,e)},this.updateManually=e=>{this.setState({isChanging:!0})
let t=e
1===this.props.step&&(t=Math.round(t)),t<this.props.min&&(t=this.props.min),t>this.props.max&&(t=this.props.max),this.setState({current:t,isChanging:!0})},this.onManualBlur=()=>{this.setState({isChanging:!1}),this.props.onChange(this.state.current)},this.onMouseWheel=e=>{const{dx:t,dy:n,dz:r}=(0,s.j)(e),i=(t>=0?1:-1)*(n>=0?1:-1)*(r>=0?1:-1),o=e.getModifierState("Shift"),a=i*(this.props.max-this.props.min)/(o?100:25)
this.updateCurrent(this.state.current+a)}}static getDerivedStateFromProps(e,t){return t.isChanging||e.value===t.current?null:{current:e.value}}render(){let e=this.props.step
return void 0===e&&(e=1),(0,r.jsxs)("div",{className:this.props.hideInput?"msp-slider msp-slider-no-input":"msp-slider",children:[(0,r.jsx)("div",{children:(0,r.jsx)(y,{min:this.props.min,max:this.props.max,step:e,value:this.state.current,disabled:this.props.disabled,onBeforeChange:this.begin,onWheel:this.onMouseWheel,onChange:this.updateCurrent,onAfterChange:this.end})}),(0,r.jsx)("div",{children:(0,r.jsx)(o.ks,{numeric:!0,delayMs:50,value:this.state.current,blurOnEnter:!0,onBlur:this.onManualBlur,isDisabled:this.props.disabled,onChange:this.updateManually})})]})}}class c extends i.Component{constructor(){super(...arguments),this.state={isChanging:!1,current:[0,1]},this.begin=()=>{this.setState({isChanging:!0})},this.end=e=>{this.setState({isChanging:!1}),this.props.onChange(e)},this.updateCurrent=e=>{this.setState({current:e})},this.updateMax=e=>{let t=e
1===this.props.step&&(t=Math.round(t)),t<this.state.current[0]?t=this.state.current[0]:t<this.props.min&&(t=this.props.min),t>this.props.max&&(t=this.props.max),this.props.onChange([this.state.current[0],t])},this.updateMin=e=>{let t=e
1===this.props.step&&(t=Math.round(t)),t<this.props.min&&(t=this.props.min),t>this.state.current[1]?t=this.state.current[1]:t>this.props.max&&(t=this.props.max),this.props.onChange([t,this.state.current[1]])}}static getDerivedStateFromProps(e,t){return t.isChanging||e.value[0]===t.current[0]&&e.value[1]===t.current[1]?null:{current:e.value}}render(){let e=this.props.step
return void 0===e&&(e=1),(0,r.jsxs)("div",{className:"msp-slider2",children:[(0,r.jsx)("div",{children:(0,r.jsx)(o.ks,{numeric:!0,delayMs:50,value:this.state.current[0],onEnter:this.props.onEnter,blurOnEnter:!0,isDisabled:this.props.disabled,onChange:this.updateMin})}),(0,r.jsx)("div",{children:(0,r.jsx)(y,{min:this.props.min,max:this.props.max,step:e,value:this.state.current,disabled:this.props.disabled,onBeforeChange:this.begin,onChange:this.updateCurrent,onAfterChange:this.end,range:!0,allowCross:!0})}),(0,r.jsx)("div",{children:(0,r.jsx)(o.ks,{numeric:!0,delayMs:50,value:this.state.current[1],onEnter:this.props.onEnter,blurOnEnter:!0,isDisabled:this.props.disabled,onChange:this.updateMax})})]})}}function u(e){const t=[],n={}.hasOwnProperty
for(let r=0;r<arguments.length;r++){const e=arguments[r]
if(!e)continue
const i=typeof e
if("string"===i||"number"===i)t.push(e)
else if(Array.isArray(e))t.push(u.apply(null,e))
else if("object"===i)for(const r in e)n.call(e,r)&&e[r]&&t.push(r)}return t.join(" ")}function d(e){return e.touches.length>1||"touchend"===e.type.toLowerCase()&&e.touches.length>0}function p(e,t){return e?t.touches[0].clientY:t.touches[0].pageX}function h(e,t){return e?t.clientY:t.pageX}function f(e,t){const n=t.getBoundingClientRect()
return e?n.top+.5*n.height:n.left+.5*n.width}function m(e){e.stopPropagation(),e.preventDefault()}class g extends i.Component{render(){const{className:e,tipFormatter:t,vertical:n,offset:i,value:o,index:a}=this.props,s=n?{bottom:`${i}%`}:{left:`${i}%`}
return(0,r.jsx)("div",{className:e,style:s,title:t(o,a)})}}class y extends i.Component{constructor(e){super(e),this.sliderElement=i.createRef(),this.handleElements=[],this.dragOffset=0,this.startPosition=0,this.startValue=0,this._getPointsCache=void 0,this.onMouseDown=e=>{if(0!==e.button)return
let t=h(this.props.vertical,e)
if(this.isEventFromHandle(e)){const n=f(this.props.vertical,e.target)
this.dragOffset=t-n,t=n}else this.dragOffset=0
this.onStart(t),this.addDocumentEvents("mouse"),m(e)},this.onTouchMove=e=>{if(d(e))return void this.end("touch")
const t=p(this.props.vertical,e)
this.onMove(e,t-this.dragOffset)},this.onTouchStart=e=>{if(d(e))return
let t=p(this.props.vertical,e)
if(this.isEventFromHandle(e)){const n=f(this.props.vertical,e.target)
this.dragOffset=t-n,t=n}else this.dragOffset=0
this.onStart(t),this.addDocumentEvents("touch"),m(e)},this.eventHandlers={touchmove:e=>this.onTouchMove(e),touchend:e=>this.end("touch"),mousemove:e=>this.onMouseMove(e),mouseup:e=>this.end("mouse")},this.calcOffset=e=>{const{min:t,max:n}=this.props
return(e-t)/(n-t)*100}
const{range:t,min:n,max:r}=e,o=t?Array.apply(null,Array(+t+1)).map(()=>n):n,a="defaultValue"in e?e.defaultValue:o,s=void 0!==e.value?e.value:a,l=(t?s:[n,s]).map(e=>this.trimAlignValue(e))
let c
c=t&&l[0]===l[l.length-1]&&l[0]===r?0:l.length-1,this.state={handle:null,recent:c,bounds:l}}componentDidUpdate(e){if(!("value"in this.props||"min"in this.props||"max"in this.props))return
const{bounds:t}=this.state
if(e.range){const e=(this.props.value||t).map(e=>this.trimAlignValue(e,this.props))
if(e.every((e,n)=>e===t[n]))return
this.setState({bounds:e}),t.some(e=>this.isValueOutOfBounds(e,this.props))&&this.props.onChange(e)}else{const n=void 0!==this.props.value?this.props.value:t[1],r=this.trimAlignValue(n,this.props)
if(r===t[1]&&t[0]===e.min)return
this.setState({bounds:[e.min,r]}),this.isValueOutOfBounds(t[1],this.props)&&this.props.onChange(r)}}onChange(e){const t=this.props
"value"in t?void 0!==e.handle&&this.setState({handle:e.handle}):this.setState(e)
const n={...this.state,...e},r=t.range?n.bounds:n.bounds[1]
t.onChange(r)}onMouseMove(e){const t=h(this.props.vertical,e)
this.onMove(e,t-this.dragOffset)}onMove(e,t){m(e)
const n=this.props,r=this.state
let i=t-this.startPosition
i=this.props.vertical?-i:i
const o=i/this.getSliderLength()*(n.max-n.min),a=this.trimAlignValue(this.startValue+o)
if(a===r.bounds[r.handle])return
const s=[...r.bounds]
s[r.handle]=a
let l=r.handle
if(n.pushable){const e=r.bounds[l]
this.pushSurroundingHandles(s,l,e)}else n.allowCross&&(s.sort((e,t)=>e-t),l=s.indexOf(a))
this.onChange({handle:l,bounds:s})}onStart(e){this.props.onBeforeChange(this.getValue())
const t=this.calcValueByPos(e)
this.startValue=t,this.startPosition=e
const n=this.state,{bounds:r}=n
let i=1
if(this.props.range){let e=0
for(let n=1;n<r.length-1;++n)t>r[n]&&(e=n)
Math.abs(r[e+1]-t)<Math.abs(r[e]-t)&&(e+=1),i=e
const o=r[e+1]===r[e]
o&&(i=n.recent),o&&t!==r[e+1]&&(i=t<r[e+1]?e:e+1)}if(this.setState({handle:i,recent:i}),t===n.bounds[i])return
const o=[...n.bounds]
o[i]=t,this.onChange({bounds:o})}getPoints(){const{marks:e,step:t,min:n,max:r}=this.props,i=this._getPointsCache
if(!i||i.marks!==e||i.step!==t){const i={...e}
if(null!==t)for(let e=n;e<=r;e+=t)i[e]=e
const o=Object.keys(i).map(parseFloat)
o.sort((e,t)=>e-t),this._getPointsCache={marks:e,step:t,points:o}}return this._getPointsCache.points}getPrecision(e){const t=e.toString()
let n=0
return t.indexOf(".")>=0&&(n=t.length-t.indexOf(".")-1),n}getSliderLength(){const e=this.sliderElement.current
return e?this.props.vertical?e.clientHeight:e.clientWidth:0}getSliderStart(){const e=this.sliderElement.current.getBoundingClientRect()
return this.props.vertical?e.top:e.left}getValue(){const{bounds:e}=this.state
return this.props.range?e:e[1]}addDocumentEvents(e){"touch"===e?(document.addEventListener("touchmove",this.eventHandlers.touchmove),document.addEventListener("touchend",this.eventHandlers.touchend)):"mouse"===e&&(document.addEventListener("mousemove",this.eventHandlers.mousemove),document.addEventListener("mouseup",this.eventHandlers.mouseup))}calcValue(e){const{vertical:t,min:n,max:r}=this.props,i=Math.abs(e/this.getSliderLength())
return t?(1-i)*(r-n)+n:i*(r-n)+n}calcValueByPos(e){const t=e-this.getSliderStart()
return this.trimAlignValue(this.calcValue(t))}end(e){this.removeEvents(e),this.props.onAfterChange(this.getValue()),this.setState({handle:null})}isEventFromHandle(e){for(const t of this.handleElements)if(t.current===e.target)return!0
return!1}isValueOutOfBounds(e,t){return e<t.min||e>t.max}pushHandle(e,t,n,r){const i=e[t]
let o=e[t]
for(;n*(o-i)<r;){if(!this.pushHandleOnePoint(e,t,n))return e[t]=i,!1
o=e[t]}return!0}pushHandleOnePoint(e,t,n){const r=this.getPoints(),i=r.indexOf(e[t])+n
if(i>=r.length||i<0)return!1
const o=t+n,a=r[i],{pushable:s}=this.props,l=n*(e[o]-a)
return!!this.pushHandle(e,o,n,+s-l)&&(e[t]=a,!0)}pushSurroundingHandles(e,t,n){const{pushable:r}=this.props,i=e[t]
let o=0
if(e[t+1]-i<+r?o=1:i-e[t-1]<+r&&(o=-1),0===o)return
const a=t+o,s=o*(e[a]-i)
this.pushHandle(e,a,o,+r-s)||(e[t]=n)}removeEvents(e){"touch"===e?(document.removeEventListener("touchmove",this.eventHandlers.touchmove),document.removeEventListener("touchend",this.eventHandlers.touchend)):"mouse"===e&&(document.removeEventListener("mousemove",this.eventHandlers.mousemove),document.removeEventListener("mouseup",this.eventHandlers.mouseup))}trimAlignValue(e,t){const{handle:n,bounds:r}=this.state||{},{marks:i,step:o,min:a,max:s,allowCross:l}={...this.props,...t||{}}
let c=e
c<=a&&(c=a),c>=s&&(c=s),!l&&null!=n&&n>0&&c<=r[n-1]&&(c=r[n-1]),!l&&null!=n&&n<r.length-1&&c>=r[n+1]&&(c=r[n+1])
const u=Object.keys(i).map(parseFloat)
if(null!==o){const e=Math.round((c-a)/o)*o+a
u.push(e)}const d=u.map(e=>Math.abs(c-e)),p=u[d.indexOf(Math.min.apply(Math,d))]
return null!==o?parseFloat(p.toFixed(this.getPrecision(o))):p}render(){const{handle:e,bounds:t}=this.state,{className:n,prefixCls:o,disabled:s,vertical:l,range:c,step:d,marks:p,tipFormatter:h}=this.props,f=this.props.handle,m=t.map(this.calcOffset),g=`${o}-handle`,y=t.map((e,n)=>u({[g]:!0,[`${g}-${n+1}`]:!0,[`${g}-lower`]:0===n,[`${g}-upper`]:n===t.length-1})),v={prefixCls:o,noTip:null===d||null===h,tipFormatter:h,vertical:l}
if(this.handleElements.length!==t.length){this.handleElements=[]
for(let e=0;e<t.length;e++)this.handleElements.push(i.createRef())}const b=t.map((t,n)=>i.cloneElement(f,{...v,className:y[n],value:t,offset:m[n],dragging:e===n,index:n,key:n,ref:this.handleElements[n]}))
c||b.shift()
const x=u({[o]:!0,[`${o}-with-marks`]:Object.keys(p).length,[`${o}-disabled`]:s,[`${o}-vertical`]:this.props.vertical,[n]:!!n})
return(0,r.jsxs)("div",{ref:this.sliderElement,className:x,onTouchStart:s?a.lQ:this.onTouchStart,onMouseDown:s?a.lQ:this.onMouseDown,onWheel:s?a.lQ:this.props.onWheel,children:[(0,r.jsx)("div",{className:`${o}-rail`}),b]})}}y.defaultProps={prefixCls:"msp-slider-base",className:"",min:0,max:100,step:1,marks:{},handle:(0,r.jsx)(g,{className:"",vertical:!1,offset:0,tipFormatter:e=>e,value:0,index:0}),onBeforeChange:a.lQ,onChange:a.lQ,onAfterChange:a.lQ,tipFormatter:(e,t)=>e,disabled:!1,range:!1,vertical:!1,allowCross:!0,pushable:!1}},87912(e,t,n){"use strict"
e.exports=n(61379)},87933(e,t,n){"use strict"
n.d(t,{A9:()=>i.A9,K9:()=>i.K9,PR:()=>i.PR,c1:()=>r.c1,sO:()=>i.sO,vE:()=>r.vE,wi:()=>r.wi,yA:()=>r.yA})
var r=n(45477),i=n(54509)},87949(e,t,n){"use strict"
n.d(t,{X:()=>r})
var r=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e}},87958(e,t,n){"use strict"
n.d(t,{i:()=>i})
var r=n(37411)
function i(){return i.create(r.e.create(1,0,0),0)}!function(e){function t(e,t){return r.e.copy(e.normal,t.normal),e.constant=t.constant,e}function n(e,t,n){return r.e.copy(e.normal,t),e.constant=-r.e.dot(e.normal,n),e}e.create=function(e,t){return{normal:e,constant:t}},e.copy=t,e.clone=function(n){return t(e(),n)},e.normalize=function(e,t){const n=1/r.e.magnitude(t.normal)
return r.e.scale(e.normal,t.normal,n),e.constant=t.constant*n,e},e.negate=function(e,t){return r.e.negate(e.normal,t.normal),e.constant=-t.constant,e},e.toArray=function(e,t,n){return r.e.toArray(e.normal,t,n),t[n+3]=e.constant,t},e.fromArray=function(e,t,n){return r.e.fromArray(e.normal,t,n),e.constant=t[n+3],e},e.fromNormalAndCoplanarPoint=n,e.fromCoplanarPoints=function(e,t,i,o){return n(e,r.e.triangleNormal((0,r.e)(),t,i,o),t),e}
const i=(0,r.e)()
function o(e,t){return r.e.dot(e.normal,t)+e.constant}e.setUnnormalized=function(e,t,n,o,a){r.e.set(i,t,n,o)
const s=1/r.e.magnitude(i)
return r.e.scale(e.normal,i,s),e.constant=a*s,e},e.distanceToPoint=o,e.distanceToSphere3D=function(e,t){return o(e,t.center)-t.radius},e.projectPoint=function(e,t,n){return r.e.scaleAndAdd(e,n,t.normal,-o(t,n))},e.intersectRay3D=function(e,t,n){const i=r.e.dot(t.normal,n.direction)
if(0===i)return!1
const o=-(r.e.dot(t.normal,n.origin)+t.constant)/i
return!(o<0||(r.e.scaleAndAdd(e,n.origin,n.direction,o),0))}}(i||(i={}))},88288(e,t,n){"use strict"
function r(e,t,n,r){return{type:e,key:t,elements:n,getIndex:r}}n.d(t,{M:()=>r})},88411(e,t,n){"use strict"
n.r(t),n.d(t,{ModuleRegistry:()=>g,default:()=>y})
class r{constructor(e,t,n){this.limit=e,this.func=t,this.store=n,this.size=0,this.misses=0,this.hits=0,this.store=n||new Map}get(e){let t=this.store.get(e)
return this.store.has(e)?(this.hits++,this.store.get(e)):(this.misses++,t=this.set(e,this.func(e)),t)}set(e,t){return this.limit>this.size&&(this.size++,this.store.set(e,t)),t}purge(){this.store.clear(),this.size=0,this.hits=0,this.misses=0}}const i=/[ _]/g,o=new r(1e3,e=>{return(t=e,f.get(t)).replace(i,"-")
var t}),a=/^(\-|_)+(.)?/,s=/(.)(\-|\_|\.|\s)+(.)?/g,l=/(^|\/|\.)([a-z])/g,c=new r(1e3,e=>{const t=(e,t,n)=>n?`_${n.toUpperCase()}`:"",n=(e,t,n,r)=>t+(r?r.toUpperCase():""),r=e.split("/")
for(let i=0;i<r.length;i++)r[i]=r[i].replace(a,t).replace(s,n)
return r.join("/").replace(l,e=>e.toUpperCase())}),u=/([a-z\d])([A-Z]+)/g,d=/\-|\s+/g,p=new r(1e3,e=>e.replace(u,"$1_$2").replace(d,"_").toLowerCase()),h=/([a-z\d])([A-Z])/g,f=new r(1e3,e=>e.replace(h,"$1_$2").toLowerCase())
function m(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e
var t=e[Symbol.toPrimitive]
if(void 0!==t){var n=t.call(e,"string")
if("object"!=typeof n)return n
throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e)
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class g{constructor(e){this._entries=e||globalThis.requirejs.entries}moduleNames(){return Object.keys(this._entries)}has(e){return e in this._entries}get(...e){return globalThis.require(...e)}}class y{static create(e){return new this(e)}static withModules(e){var t
return m(t=class extends(this){},"explicitModules",e),t}constructor(e){if(m(this,"moduleBasedResolver",!0),m(this,"_deprecatedPodModulePrefix",!1),m(this,"_normalizeCache",Object.create(null)),m(this,"moduleNameLookupPatterns",[this.podBasedModuleName,this.podBasedComponentsInSubdir,this.mainModuleName,this.defaultModuleName,this.nestedColocationComponentModuleName]),Object.assign(this,e),!this._moduleRegistry){let e=this.constructor.explicitModules
e?this._moduleRegistry={moduleNames:()=>Object.keys(e),has:t=>Boolean(e[t]),get:t=>e[t],addModules(t){e=Object.assign({},e,t)}}:(void 0===globalThis.requirejs.entries&&(globalThis.requirejs.entries=globalThis.requirejs._eak_seen),this._moduleRegistry=new g)}this.pluralizedTypes=this.pluralizedTypes||Object.create(null),this.pluralizedTypes.config||(this.pluralizedTypes.config="config")}makeToString(e,t){return this.namespace.modulePrefix+"@"+t+":"}shouldWrapInClassFactory(){return!1}parseName(e){if(!0===e.parsedName)return e
let t,n,r,i=e.split("@")
if(3===i.length){if(0===i[0].length){t=`@${i[1]}`
let e=i[2].split(":")
n=e[0],r=e[1]}else t=`@${i[1]}`,n=i[0].slice(0,-1),r=i[2]
"template:components"===n&&(r=`components/${r}`,n="template")}else if(2===i.length){let e=i[0].split(":")
if(2===e.length)0===e[1].length?(n=e[0],r=`@${i[1]}`):(t=e[1],n=e[0],r=i[1])
else{let e=i[1].split(":")
t=i[0],n=e[0],r=e[1]}"template"===n&&0===t.lastIndexOf("components/",0)&&(r=`components/${r}`,t=t.slice(11))}else i=e.split(":"),n=i[0],r=i[1]
let o=r,a=this.namespace
return{parsedName:!0,fullName:e,prefix:t||this.prefix({type:n}),type:n,fullNameWithoutType:o,name:r,root:a,resolveMethodName:"resolve"+(s=n,c.get(s))}
var s}resolveOther(e){v("`modulePrefix` must be defined",this.namespace.modulePrefix)
let t=this.findModuleName(e)
if(t){let r=this._extractDefaultExport(t,e)
if(void 0===r)throw new Error(` Expected to find: '${e.fullName}' within '${t}' but got 'undefined'. Did you forget to 'export default' within '${t}'?`)
return this.shouldWrapInClassFactory(r,e)&&(n=r,r={create:e=>"function"==typeof n.extend?n.extend(e):n}),r}var n}normalize(e){return this._normalizeCache[e]||(this._normalizeCache[e]=this._normalize(e))}resolve(e){if("resolver:current"===e)return{create:()=>this}
let t,n=this.parseName(e),r=n.resolveMethodName
return"function"==typeof this[r]&&(t=this[r](n)),null==t&&(t=this.resolveOther(n)),t}addModules(e){if(!this._moduleRegistry.addModules)throw new Error("addModules is only supported when your Resolver has been configured to use static modules via Resolver.withModules()")
this._moduleRegistry.addModules(e)}_normalize(e){let t=e.split(":")
if(t.length>1){let e=t[0]
return"component"===e||"helper"===e||"modifier"===e||"template"===e&&0===t[1].indexOf("components/")?e+":"+t[1].replace(/_/g,"-"):e+":"+(n=t[1].replace(/\./g,"/"),o.get(n))}return e
var n}pluralize(e){return this.pluralizedTypes[e]||(this.pluralizedTypes[e]=e+"s")}podBasedLookupWithPrefix(e,t){let n=t.fullNameWithoutType
return"template"===t.type&&(n=n.replace(/^components\//,"")),e+"/"+n+"/"+t.type}podBasedModuleName(e){let t=this.namespace.podModulePrefix||this.namespace.modulePrefix
return this.podBasedLookupWithPrefix(t,e)}podBasedComponentsInSubdir(e){let t=this.namespace.podModulePrefix||this.namespace.modulePrefix
if(t+="/components","component"===e.type||/^components/.test(e.fullNameWithoutType))return this.podBasedLookupWithPrefix(t,e)}resolveEngine(e){let t=e.fullNameWithoutType+"/engine"
if(this._moduleRegistry.has(t))return this._extractDefaultExport(t)}resolveRouteMap(e){let t=e.fullNameWithoutType,n=t+"/routes"
if(this._moduleRegistry.has(n)){let e=this._extractDefaultExport(n)
return v(`The route map for ${t} should be wrapped by 'buildRoutes' before exporting.`,e.isRouteMap),e}}resolveTemplate(e){return this.resolveOther(e)}mainModuleName(e){if("main"===e.fullNameWithoutType)return e.prefix+"/"+e.type}defaultModuleName(e){return e.prefix+"/"+this.pluralize(e.type)+"/"+e.fullNameWithoutType}nestedColocationComponentModuleName(e){if("component"===e.type)return e.prefix+"/"+this.pluralize(e.type)+"/"+e.fullNameWithoutType+"/index"}prefix(e){let t=this.namespace.modulePrefix
return this.namespace[e.type+"Prefix"]&&(t=this.namespace[e.type+"Prefix"]),t}findModuleName(e){let t,n=this.moduleNameLookupPatterns
for(let r=0,i=n.length;r<i;r++){let i=n[r].call(this,e)
if(i&&(i=this.chooseModuleName(i)),i&&this._moduleRegistry.has(i)&&(t=i),t)return t}}chooseModuleName(e){let t=(n=e,p.get(n))
var n
if(e!==t&&this._moduleRegistry.has(e)&&this._moduleRegistry.has(t))throw new TypeError(`Ambiguous module names: '${e}' and '${t}'`)
return this._moduleRegistry.has(e)?e:this._moduleRegistry.has(t)?t:void 0}knownForType(e){let t=this._moduleRegistry.moduleNames(),n=Object.create(null)
for(let r=0,i=t.length;r<i;r++){let i=t[r],o=this.translateToContainerFullname(e,i)
o&&(n[o]=!0)}return n}translateToContainerFullname(e,t){let n=this.prefix({type:e}),r=n+"/",i="/"+e,o=t.indexOf(r),a=t.indexOf(i)
if(0===o&&a===t.length-i.length&&t.length>r.length+i.length)return e+":"+t.slice(o+r.length,a)
let s=n+"/"+this.pluralize(e)+"/"
return 0===t.indexOf(s)&&t.length>s.length?e+":"+t.slice(s.length):void 0}_extractDefaultExport(e){let t=this._moduleRegistry.get(e,null,null,!0)
return t&&t.default&&(t=t.default),t}}function v(e,t){if(!t)throw new Error(e)}m(y,"moduleBasedResolver",!0)},88434(e,t,n){"use strict"
n.d(t,{I:()=>P})
var r=n(14033)
const i=r.U.Zero
function o(e,t){return t<e?r.U.create(e,e):r.U.create(e,t+1)}function a(e,t){return t<=e?r.U.create(e,e):r.U.create(e,t)}function s(e){return e<0?r.U.create(0,0):r.U.create(0,e)}const l=r.U.is,c=r.U.fst,u=r.U.snd,d=r.U.fst
function p(e){return r.U.snd(e)-1}const h=r.U.diff,f=r.U.hashCode,m=r.U.toString
function g(e,t){return r.U.fst(e)<=t&&t<r.U.snd(e)}function y(e,t){const n=c(e)
return t>=n&&t<u(e)?t-n:-1}function v(e,t){return r.U.fst(e)+t}const b=r.U.areEqual
function x(e,t){const n=h(e),r=h(t)
return 0===n&&0===r||n>0&&r>0&&p(e)>=d(t)&&d(e)<=p(t)}function S(e,t){return h(e)?!h(t)||c(e)<=c(t)&&u(e)>=u(t):0===h(t)}function _(e,t){const n=c(e)
if(t<=n)return 0
const r=u(e)
return t>=r?r-n:t-n}function C(e,t,n){const r=c(n),i=c(e)
if(t<=r+i)return r
const o=u(n)
return t>=o+i?o:t-i}function w(e,t,n){return a(_(e,t),_(e,n+1))}function T(e,t){return x(e,t)?a(Math.max(c(e),c(t)),Math.min(u(e),u(t))):i}function A(e,t){return h(w(e,d(t),p(t)))}function I(e,t){return r.U.create(c(e)+t,u(e)+t)}var P
!function(e){e.Empty=i,e.ofSingleton=e=>o(e,e),e.ofRange=o,e.ofBounds=a,e.ofLength=s,e.is=l,e.has=g,e.indexOf=y,e.getAt=v,e.start=c,e.end=u,e.min=d,e.max=p,e.size=h,e.hashCode=f,e.toString=m,e.areEqual=b,e.areIntersecting=x,e.isSubInterval=S,e.findPredecessorIndex=_,e.findPredecessorIndexInInterval=C,e.findRange=w,e.intersectionSize=A,e.intersect=T,e.offset=I}(P||(P={}))},88524(e,t,n){"use strict"
n.d(t,{E:()=>r})
var r,i=n(92384),o=n(9043),a=n(81871),s=n(65081),l=n(68187),c=n(17782),u=n(50709),d=n(14294),p=n(31727),h=n(54749),f=n(32775),m=n(59457),g=n(97564),y=n(9726),v=n(64170),b=n(69858),x=n(70012),S=n(37392),_=n(40426),C=n(22394),w=n(71905)
function T(e,t,n,r){let i=0,o=0
for(let a=0,s=4*n;a<s;++a){const n=2*a,r=Math.abs(e[n])
r>i&&(i=r)
const s=Math.abs(e[n+1])
s>i&&(i=s)
const l=Math.abs(t[a])
l>o&&(o=l)}return Math.max(o,r*i)}!function(e){function t(e,t,n,i,a,s,l,c,u){return u?function(e,t,n,r,i,a,s,l,c){return c.charCount=l,o.IQ.update(c.fontTexture,e),o.IQ.update(c.centerBuffer,t),o.IQ.update(c.mappingBuffer,n),o.IQ.update(c.depthBuffer,r),o.IQ.update(c.indexBuffer,i),o.IQ.update(c.groupBuffer,a),o.IQ.update(c.tcoordBuffer,s),c}(e,t,n,i,a,s,l,c,u):function(e,t,n,i,a,s,l,c){const u=(0,d.f8)()
let h,f=-1,m=-1
const g={kind:"text",charCount:c,fontTexture:o.IQ.create(e),centerBuffer:o.IQ.create(t),mappingBuffer:o.IQ.create(n),depthBuffer:o.IQ.create(i),indexBuffer:o.IQ.create(a),groupBuffer:o.IQ.create(s),tcoordBuffer:o.IQ.create(l),get boundingSphere(){const e=r(g)
if(e!==f){const t=(0,p.sL)(g.centerBuffer.ref.value,4*g.charCount,4)
d.f8.copy(u,t),f=e}return u},get groupMapping(){return g.groupBuffer.ref.version!==m&&(h=(0,S.AA)(g.groupBuffer.ref.value,g.charCount,4),m=g.groupBuffer.ref.version),h},setBoundingSphere(e){d.f8.copy(u,e),f=r(g)}}
return g}(e,t,n,i,a,s,l,c)}function n(e){return t(e?e.fontTexture.ref.value:(0,p.xg)(0,1,Uint8Array),e?e.centerBuffer.ref.value:new Float32Array(0),e?e.mappingBuffer.ref.value:new Float32Array(0),e?e.depthBuffer.ref.value:new Float32Array(0),e?e.indexBuffer.ref.value:new Uint32Array(0),e?e.groupBuffer.ref.value:new Float32Array(0),e?e.tcoordBuffer.ref.value:new Float32Array(0),0,e)}function r(e){return(0,x.TI)([e.charCount,e.fontTexture.ref.version,e.centerBuffer.ref.version,e.mappingBuffer.ref.version,e.depthBuffer.ref.version,e.indexBuffer.ref.version,e.groupBuffer.ref.version,e.tcoordBuffer.ref.version])}function A(e,t){const n=4*e.charCount,r=t.instanceCount.ref.value,i=(0,a.tu)(),o=i.position,s=e.centerBuffer.ref.value,l=t.aTransform.ref.value
return(0,a.iQ)(n,r,4,(e,t)=>(t<0?f.eB.fromArray(o,s,3*e):f.eB.transformMat4Offset(o,s,l,0,3*e,16*t),i))}function I(e,t,n,r,i){const{instanceCount:a,groupCount:u}=n,m=A(e,t),x=(0,s.D1)(n,m,r.color),S=(0,l.v3)(n,r.size),I=i.instanceGranularity?(0,c.Km)(a,"instance"):(0,c.Km)(a*u,"groupInstance"),P=(0,v.WG)(),B=(0,b.MD)(),E=(0,w.JS)(),k=(0,C.IB)(),D=(0,_.EN)(),M={drawCount:2*e.charCount*3,vertexCount:4*e.charCount,groupCount:u,instanceCount:a},R=(0,l.yx)(S)*i.sizeFactor,O=T(e.mappingBuffer.ref.value,e.depthBuffer.ref.value,e.charCount,R),L=d.f8.expand((0,d.f8)(),e.boundingSphere,O),N=(0,p.Ax)(L,t.aTransform.ref.value,a,0)
return{dGeometryType:o.IQ.create("text"),aPosition:e.centerBuffer,aMapping:e.mappingBuffer,aDepth:e.depthBuffer,aGroup:e.groupBuffer,elements:e.indexBuffer,boundingSphere:o.IQ.create(N),invariantBoundingSphere:o.IQ.create(L),uInvariantBoundingSphere:o.IQ.create(f.Zb.ofSphere(L)),...x,...S,...I,...P,...B,...E,...k,...D,...t,aTexCoord:e.tcoordBuffer,tFont:e.fontTexture,padding:o.IQ.create(O),...y.iy.createValues(i,M),uSizeFactor:o.IQ.create(i.sizeFactor),uBorderWidth:o.IQ.create((0,g.qE)(i.borderWidth,0,.5)),uBorderColor:o.IQ.create(h.Color.toArrayNormalized(i.borderColor,f.eB.zero(),0)),uOffsetX:o.IQ.create(i.offsetX),uOffsetY:o.IQ.create(i.offsetY),uOffsetZ:o.IQ.create(i.offsetZ),uBackgroundColor:o.IQ.create(h.Color.toArrayNormalized(i.backgroundColor,f.eB.zero(),0)),uBackgroundOpacity:o.IQ.create(i.backgroundOpacity)}}function P(e,t){y.iy.updateRenderableState(e,t),e.pickable=!1,e.opaque=!1,e.writeDepth=!0}e.create=t,e.createEmpty=n,e.Params={...y.iy.Params,...m.nZ,sizeFactor:i.t.Numeric(1,{min:0,max:10,step:.1}),borderWidth:i.t.Numeric(0,{min:0,max:.5,step:.01}),borderColor:i.t.Color(u.ColorNames.grey),offsetX:i.t.Numeric(0,{min:0,max:10,step:.1}),offsetY:i.t.Numeric(0,{min:0,max:10,step:.1}),offsetZ:i.t.Numeric(0,{min:0,max:10,step:.1}),background:i.t.Boolean(!1),backgroundMargin:i.t.Numeric(.2,{min:0,max:1,step:.01}),backgroundColor:i.t.Color(u.ColorNames.grey),backgroundOpacity:i.t.Numeric(1,{min:0,max:1,step:.01}),tether:i.t.Boolean(!1),tetherLength:i.t.Numeric(1,{min:0,max:5,step:.1}),tetherBaseWidth:i.t.Numeric(.3,{min:0,max:1,step:.01}),attachment:i.t.Select("middle-center",[["bottom-left","bottom-left"],["bottom-center","bottom-center"],["bottom-right","bottom-right"],["middle-left","middle-left"],["middle-center","middle-center"],["middle-right","middle-right"],["top-left","top-left"],["top-center","top-center"],["top-right","top-right"]])},e.Utils={Params:e.Params,createEmpty:n,createValues:I,createValuesSimple:function(t,n,r,o,a){const s=y.iy.createSimple(r,o,a),l={...i.t.getDefaultValues(e.Params),...n}
return I(t,s.transform,s.locationIterator,s.theme,l)},updateValues:function(e,t){y.iy.updateValues(e,t),o.IQ.updateIfChanged(e.uSizeFactor,t.sizeFactor),o.IQ.updateIfChanged(e.uBorderWidth,t.borderWidth),h.Color.fromNormalizedArray(e.uBorderColor.ref.value,0)!==t.borderColor&&(h.Color.toArrayNormalized(t.borderColor,e.uBorderColor.ref.value,0),o.IQ.update(e.uBorderColor,e.uBorderColor.ref.value)),o.IQ.updateIfChanged(e.uOffsetX,t.offsetX),o.IQ.updateIfChanged(e.uOffsetY,t.offsetY),o.IQ.updateIfChanged(e.uOffsetZ,t.offsetZ),h.Color.fromNormalizedArray(e.uBackgroundColor.ref.value,0)!==t.backgroundColor&&(h.Color.toArrayNormalized(t.backgroundColor,e.uBackgroundColor.ref.value,0),o.IQ.update(e.uBackgroundColor,e.uBackgroundColor.ref.value)),o.IQ.updateIfChanged(e.uBackgroundOpacity,t.backgroundOpacity)},updateBoundingSphere:function(e,t){const n=(0,l.yx)(e)*e.uSizeFactor.ref.value,r=T(e.aMapping.ref.value,e.aDepth.ref.value,t.charCount,n),i=d.f8.expand((0,d.f8)(),t.boundingSphere,r),a=(0,p.Ax)(i,e.aTransform.ref.value,e.instanceCount.ref.value,0)
d.f8.equals(a,e.boundingSphere.ref.value)||o.IQ.update(e.boundingSphere,a),d.f8.equals(i,e.invariantBoundingSphere.ref.value)||(o.IQ.update(e.invariantBoundingSphere,i),o.IQ.update(e.uInvariantBoundingSphere,f.Zb.fromSphere(e.uInvariantBoundingSphere.ref.value,i))),o.IQ.update(e.padding,r)},createRenderableState:function(e){const t=y.iy.createRenderableState(e)
return P(t,e),t},updateRenderableState:P,createPositionIterator:A}}(r||(r={}))},88604(e){var t
t=function(){"use strict"
function e(e,t){return e(t={exports:{}},t.exports),t.exports}"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self
var t=e(function(e){e.exports&&(e.exports=function(){var e=3,t=4,n=12,r=13,i=16,o=17
function a(e,t){return 55296<=e.charCodeAt(t)&&e.charCodeAt(t)<=56319&&56320<=e.charCodeAt(t+1)&&e.charCodeAt(t+1)<=57343}function s(e,t){void 0===t&&(t=0)
var n=e.charCodeAt(t)
if(55296<=n&&n<=56319&&t<e.length-1){var r=n
return 56320<=(i=e.charCodeAt(t+1))&&i<=57343?1024*(r-55296)+(i-56320)+65536:r}if(56320<=n&&n<=57343&&t>=1){var i=n
return 55296<=(r=e.charCodeAt(t-1))&&r<=56319?1024*(r-55296)+(i-56320)+65536:i}return n}function l(a,s,l){var c=[a].concat(s).concat([l]),u=c[c.length-2],d=l,p=c.lastIndexOf(14)
if(p>1&&c.slice(1,p).every(function(t){return t==e})&&-1==[e,r,o].indexOf(a))return 2
var h=c.lastIndexOf(t)
if(h>0&&c.slice(1,h).every(function(e){return e==t})&&-1==[n,t].indexOf(u))return c.filter(function(e){return e==t}).length%2==1?3:4
if(0==u&&1==d)return 0
if(2==u||0==u||1==u)return 14==d&&s.every(function(t){return t==e})?2:1
if(2==d||0==d||1==d)return 1
if(6==u&&(6==d||7==d||9==d||10==d))return 0
if(!(9!=u&&7!=u||7!=d&&8!=d))return 0
if((10==u||8==u)&&8==d)return 0
if(d==e||15==d)return 0
if(5==d)return 0
if(u==n)return 0
var f=-1!=c.indexOf(e)?c.lastIndexOf(e)-1:c.length-2
return-1!=[r,o].indexOf(c[f])&&c.slice(f+1,-1).every(function(t){return t==e})&&14==d||15==u&&-1!=[i,o].indexOf(d)?0:-1!=s.indexOf(t)?2:u==t&&d==t?0:1}function c(a){return 1536<=a&&a<=1541||1757==a||1807==a||2274==a||3406==a||69821==a||70082<=a&&a<=70083||72250==a||72326<=a&&a<=72329||73030==a?n:13==a?0:10==a?1:0<=a&&a<=9||11<=a&&a<=12||14<=a&&a<=31||127<=a&&a<=159||173==a||1564==a||6158==a||8203==a||8206<=a&&a<=8207||8232==a||8233==a||8234<=a&&a<=8238||8288<=a&&a<=8292||8293==a||8294<=a&&a<=8303||55296<=a&&a<=57343||65279==a||65520<=a&&a<=65528||65529<=a&&a<=65531||113824<=a&&a<=113827||119155<=a&&a<=119162||917504==a||917505==a||917506<=a&&a<=917535||917632<=a&&a<=917759||918e3<=a&&a<=921599?2:768<=a&&a<=879||1155<=a&&a<=1159||1160<=a&&a<=1161||1425<=a&&a<=1469||1471==a||1473<=a&&a<=1474||1476<=a&&a<=1477||1479==a||1552<=a&&a<=1562||1611<=a&&a<=1631||1648==a||1750<=a&&a<=1756||1759<=a&&a<=1764||1767<=a&&a<=1768||1770<=a&&a<=1773||1809==a||1840<=a&&a<=1866||1958<=a&&a<=1968||2027<=a&&a<=2035||2070<=a&&a<=2073||2075<=a&&a<=2083||2085<=a&&a<=2087||2089<=a&&a<=2093||2137<=a&&a<=2139||2260<=a&&a<=2273||2275<=a&&a<=2306||2362==a||2364==a||2369<=a&&a<=2376||2381==a||2385<=a&&a<=2391||2402<=a&&a<=2403||2433==a||2492==a||2494==a||2497<=a&&a<=2500||2509==a||2519==a||2530<=a&&a<=2531||2561<=a&&a<=2562||2620==a||2625<=a&&a<=2626||2631<=a&&a<=2632||2635<=a&&a<=2637||2641==a||2672<=a&&a<=2673||2677==a||2689<=a&&a<=2690||2748==a||2753<=a&&a<=2757||2759<=a&&a<=2760||2765==a||2786<=a&&a<=2787||2810<=a&&a<=2815||2817==a||2876==a||2878==a||2879==a||2881<=a&&a<=2884||2893==a||2902==a||2903==a||2914<=a&&a<=2915||2946==a||3006==a||3008==a||3021==a||3031==a||3072==a||3134<=a&&a<=3136||3142<=a&&a<=3144||3146<=a&&a<=3149||3157<=a&&a<=3158||3170<=a&&a<=3171||3201==a||3260==a||3263==a||3266==a||3270==a||3276<=a&&a<=3277||3285<=a&&a<=3286||3298<=a&&a<=3299||3328<=a&&a<=3329||3387<=a&&a<=3388||3390==a||3393<=a&&a<=3396||3405==a||3415==a||3426<=a&&a<=3427||3530==a||3535==a||3538<=a&&a<=3540||3542==a||3551==a||3633==a||3636<=a&&a<=3642||3655<=a&&a<=3662||3761==a||3764<=a&&a<=3769||3771<=a&&a<=3772||3784<=a&&a<=3789||3864<=a&&a<=3865||3893==a||3895==a||3897==a||3953<=a&&a<=3966||3968<=a&&a<=3972||3974<=a&&a<=3975||3981<=a&&a<=3991||3993<=a&&a<=4028||4038==a||4141<=a&&a<=4144||4146<=a&&a<=4151||4153<=a&&a<=4154||4157<=a&&a<=4158||4184<=a&&a<=4185||4190<=a&&a<=4192||4209<=a&&a<=4212||4226==a||4229<=a&&a<=4230||4237==a||4253==a||4957<=a&&a<=4959||5906<=a&&a<=5908||5938<=a&&a<=5940||5970<=a&&a<=5971||6002<=a&&a<=6003||6068<=a&&a<=6069||6071<=a&&a<=6077||6086==a||6089<=a&&a<=6099||6109==a||6155<=a&&a<=6157||6277<=a&&a<=6278||6313==a||6432<=a&&a<=6434||6439<=a&&a<=6440||6450==a||6457<=a&&a<=6459||6679<=a&&a<=6680||6683==a||6742==a||6744<=a&&a<=6750||6752==a||6754==a||6757<=a&&a<=6764||6771<=a&&a<=6780||6783==a||6832<=a&&a<=6845||6846==a||6912<=a&&a<=6915||6964==a||6966<=a&&a<=6970||6972==a||6978==a||7019<=a&&a<=7027||7040<=a&&a<=7041||7074<=a&&a<=7077||7080<=a&&a<=7081||7083<=a&&a<=7085||7142==a||7144<=a&&a<=7145||7149==a||7151<=a&&a<=7153||7212<=a&&a<=7219||7222<=a&&a<=7223||7376<=a&&a<=7378||7380<=a&&a<=7392||7394<=a&&a<=7400||7405==a||7412==a||7416<=a&&a<=7417||7616<=a&&a<=7673||7675<=a&&a<=7679||8204==a||8400<=a&&a<=8412||8413<=a&&a<=8416||8417==a||8418<=a&&a<=8420||8421<=a&&a<=8432||11503<=a&&a<=11505||11647==a||11744<=a&&a<=11775||12330<=a&&a<=12333||12334<=a&&a<=12335||12441<=a&&a<=12442||42607==a||42608<=a&&a<=42610||42612<=a&&a<=42621||42654<=a&&a<=42655||42736<=a&&a<=42737||43010==a||43014==a||43019==a||43045<=a&&a<=43046||43204<=a&&a<=43205||43232<=a&&a<=43249||43302<=a&&a<=43309||43335<=a&&a<=43345||43392<=a&&a<=43394||43443==a||43446<=a&&a<=43449||43452==a||43493==a||43561<=a&&a<=43566||43569<=a&&a<=43570||43573<=a&&a<=43574||43587==a||43596==a||43644==a||43696==a||43698<=a&&a<=43700||43703<=a&&a<=43704||43710<=a&&a<=43711||43713==a||43756<=a&&a<=43757||43766==a||44005==a||44008==a||44013==a||64286==a||65024<=a&&a<=65039||65056<=a&&a<=65071||65438<=a&&a<=65439||66045==a||66272==a||66422<=a&&a<=66426||68097<=a&&a<=68099||68101<=a&&a<=68102||68108<=a&&a<=68111||68152<=a&&a<=68154||68159==a||68325<=a&&a<=68326||69633==a||69688<=a&&a<=69702||69759<=a&&a<=69761||69811<=a&&a<=69814||69817<=a&&a<=69818||69888<=a&&a<=69890||69927<=a&&a<=69931||69933<=a&&a<=69940||70003==a||70016<=a&&a<=70017||70070<=a&&a<=70078||70090<=a&&a<=70092||70191<=a&&a<=70193||70196==a||70198<=a&&a<=70199||70206==a||70367==a||70371<=a&&a<=70378||70400<=a&&a<=70401||70460==a||70462==a||70464==a||70487==a||70502<=a&&a<=70508||70512<=a&&a<=70516||70712<=a&&a<=70719||70722<=a&&a<=70724||70726==a||70832==a||70835<=a&&a<=70840||70842==a||70845==a||70847<=a&&a<=70848||70850<=a&&a<=70851||71087==a||71090<=a&&a<=71093||71100<=a&&a<=71101||71103<=a&&a<=71104||71132<=a&&a<=71133||71219<=a&&a<=71226||71229==a||71231<=a&&a<=71232||71339==a||71341==a||71344<=a&&a<=71349||71351==a||71453<=a&&a<=71455||71458<=a&&a<=71461||71463<=a&&a<=71467||72193<=a&&a<=72198||72201<=a&&a<=72202||72243<=a&&a<=72248||72251<=a&&a<=72254||72263==a||72273<=a&&a<=72278||72281<=a&&a<=72283||72330<=a&&a<=72342||72344<=a&&a<=72345||72752<=a&&a<=72758||72760<=a&&a<=72765||72767==a||72850<=a&&a<=72871||72874<=a&&a<=72880||72882<=a&&a<=72883||72885<=a&&a<=72886||73009<=a&&a<=73014||73018==a||73020<=a&&a<=73021||73023<=a&&a<=73029||73031==a||92912<=a&&a<=92916||92976<=a&&a<=92982||94095<=a&&a<=94098||113821<=a&&a<=113822||119141==a||119143<=a&&a<=119145||119150<=a&&a<=119154||119163<=a&&a<=119170||119173<=a&&a<=119179||119210<=a&&a<=119213||119362<=a&&a<=119364||121344<=a&&a<=121398||121403<=a&&a<=121452||121461==a||121476==a||121499<=a&&a<=121503||121505<=a&&a<=121519||122880<=a&&a<=122886||122888<=a&&a<=122904||122907<=a&&a<=122913||122915<=a&&a<=122916||122918<=a&&a<=122922||125136<=a&&a<=125142||125252<=a&&a<=125258||917536<=a&&a<=917631||917760<=a&&a<=917999?e:127462<=a&&a<=127487?t:2307==a||2363==a||2366<=a&&a<=2368||2377<=a&&a<=2380||2382<=a&&a<=2383||2434<=a&&a<=2435||2495<=a&&a<=2496||2503<=a&&a<=2504||2507<=a&&a<=2508||2563==a||2622<=a&&a<=2624||2691==a||2750<=a&&a<=2752||2761==a||2763<=a&&a<=2764||2818<=a&&a<=2819||2880==a||2887<=a&&a<=2888||2891<=a&&a<=2892||3007==a||3009<=a&&a<=3010||3014<=a&&a<=3016||3018<=a&&a<=3020||3073<=a&&a<=3075||3137<=a&&a<=3140||3202<=a&&a<=3203||3262==a||3264<=a&&a<=3265||3267<=a&&a<=3268||3271<=a&&a<=3272||3274<=a&&a<=3275||3330<=a&&a<=3331||3391<=a&&a<=3392||3398<=a&&a<=3400||3402<=a&&a<=3404||3458<=a&&a<=3459||3536<=a&&a<=3537||3544<=a&&a<=3550||3570<=a&&a<=3571||3635==a||3763==a||3902<=a&&a<=3903||3967==a||4145==a||4155<=a&&a<=4156||4182<=a&&a<=4183||4228==a||6070==a||6078<=a&&a<=6085||6087<=a&&a<=6088||6435<=a&&a<=6438||6441<=a&&a<=6443||6448<=a&&a<=6449||6451<=a&&a<=6456||6681<=a&&a<=6682||6741==a||6743==a||6765<=a&&a<=6770||6916==a||6965==a||6971==a||6973<=a&&a<=6977||6979<=a&&a<=6980||7042==a||7073==a||7078<=a&&a<=7079||7082==a||7143==a||7146<=a&&a<=7148||7150==a||7154<=a&&a<=7155||7204<=a&&a<=7211||7220<=a&&a<=7221||7393==a||7410<=a&&a<=7411||7415==a||43043<=a&&a<=43044||43047==a||43136<=a&&a<=43137||43188<=a&&a<=43203||43346<=a&&a<=43347||43395==a||43444<=a&&a<=43445||43450<=a&&a<=43451||43453<=a&&a<=43456||43567<=a&&a<=43568||43571<=a&&a<=43572||43597==a||43755==a||43758<=a&&a<=43759||43765==a||44003<=a&&a<=44004||44006<=a&&a<=44007||44009<=a&&a<=44010||44012==a||69632==a||69634==a||69762==a||69808<=a&&a<=69810||69815<=a&&a<=69816||69932==a||70018==a||70067<=a&&a<=70069||70079<=a&&a<=70080||70188<=a&&a<=70190||70194<=a&&a<=70195||70197==a||70368<=a&&a<=70370||70402<=a&&a<=70403||70463==a||70465<=a&&a<=70468||70471<=a&&a<=70472||70475<=a&&a<=70477||70498<=a&&a<=70499||70709<=a&&a<=70711||70720<=a&&a<=70721||70725==a||70833<=a&&a<=70834||70841==a||70843<=a&&a<=70844||70846==a||70849==a||71088<=a&&a<=71089||71096<=a&&a<=71099||71102==a||71216<=a&&a<=71218||71227<=a&&a<=71228||71230==a||71340==a||71342<=a&&a<=71343||71350==a||71456<=a&&a<=71457||71462==a||72199<=a&&a<=72200||72249==a||72279<=a&&a<=72280||72343==a||72751==a||72766==a||72873==a||72881==a||72884==a||94033<=a&&a<=94078||119142==a||119149==a?5:4352<=a&&a<=4447||43360<=a&&a<=43388?6:4448<=a&&a<=4519||55216<=a&&a<=55238?7:4520<=a&&a<=4607||55243<=a&&a<=55291?8:44032==a||44060==a||44088==a||44116==a||44144==a||44172==a||44200==a||44228==a||44256==a||44284==a||44312==a||44340==a||44368==a||44396==a||44424==a||44452==a||44480==a||44508==a||44536==a||44564==a||44592==a||44620==a||44648==a||44676==a||44704==a||44732==a||44760==a||44788==a||44816==a||44844==a||44872==a||44900==a||44928==a||44956==a||44984==a||45012==a||45040==a||45068==a||45096==a||45124==a||45152==a||45180==a||45208==a||45236==a||45264==a||45292==a||45320==a||45348==a||45376==a||45404==a||45432==a||45460==a||45488==a||45516==a||45544==a||45572==a||45600==a||45628==a||45656==a||45684==a||45712==a||45740==a||45768==a||45796==a||45824==a||45852==a||45880==a||45908==a||45936==a||45964==a||45992==a||46020==a||46048==a||46076==a||46104==a||46132==a||46160==a||46188==a||46216==a||46244==a||46272==a||46300==a||46328==a||46356==a||46384==a||46412==a||46440==a||46468==a||46496==a||46524==a||46552==a||46580==a||46608==a||46636==a||46664==a||46692==a||46720==a||46748==a||46776==a||46804==a||46832==a||46860==a||46888==a||46916==a||46944==a||46972==a||47e3==a||47028==a||47056==a||47084==a||47112==a||47140==a||47168==a||47196==a||47224==a||47252==a||47280==a||47308==a||47336==a||47364==a||47392==a||47420==a||47448==a||47476==a||47504==a||47532==a||47560==a||47588==a||47616==a||47644==a||47672==a||47700==a||47728==a||47756==a||47784==a||47812==a||47840==a||47868==a||47896==a||47924==a||47952==a||47980==a||48008==a||48036==a||48064==a||48092==a||48120==a||48148==a||48176==a||48204==a||48232==a||48260==a||48288==a||48316==a||48344==a||48372==a||48400==a||48428==a||48456==a||48484==a||48512==a||48540==a||48568==a||48596==a||48624==a||48652==a||48680==a||48708==a||48736==a||48764==a||48792==a||48820==a||48848==a||48876==a||48904==a||48932==a||48960==a||48988==a||49016==a||49044==a||49072==a||49100==a||49128==a||49156==a||49184==a||49212==a||49240==a||49268==a||49296==a||49324==a||49352==a||49380==a||49408==a||49436==a||49464==a||49492==a||49520==a||49548==a||49576==a||49604==a||49632==a||49660==a||49688==a||49716==a||49744==a||49772==a||49800==a||49828==a||49856==a||49884==a||49912==a||49940==a||49968==a||49996==a||50024==a||50052==a||50080==a||50108==a||50136==a||50164==a||50192==a||50220==a||50248==a||50276==a||50304==a||50332==a||50360==a||50388==a||50416==a||50444==a||50472==a||50500==a||50528==a||50556==a||50584==a||50612==a||50640==a||50668==a||50696==a||50724==a||50752==a||50780==a||50808==a||50836==a||50864==a||50892==a||50920==a||50948==a||50976==a||51004==a||51032==a||51060==a||51088==a||51116==a||51144==a||51172==a||51200==a||51228==a||51256==a||51284==a||51312==a||51340==a||51368==a||51396==a||51424==a||51452==a||51480==a||51508==a||51536==a||51564==a||51592==a||51620==a||51648==a||51676==a||51704==a||51732==a||51760==a||51788==a||51816==a||51844==a||51872==a||51900==a||51928==a||51956==a||51984==a||52012==a||52040==a||52068==a||52096==a||52124==a||52152==a||52180==a||52208==a||52236==a||52264==a||52292==a||52320==a||52348==a||52376==a||52404==a||52432==a||52460==a||52488==a||52516==a||52544==a||52572==a||52600==a||52628==a||52656==a||52684==a||52712==a||52740==a||52768==a||52796==a||52824==a||52852==a||52880==a||52908==a||52936==a||52964==a||52992==a||53020==a||53048==a||53076==a||53104==a||53132==a||53160==a||53188==a||53216==a||53244==a||53272==a||53300==a||53328==a||53356==a||53384==a||53412==a||53440==a||53468==a||53496==a||53524==a||53552==a||53580==a||53608==a||53636==a||53664==a||53692==a||53720==a||53748==a||53776==a||53804==a||53832==a||53860==a||53888==a||53916==a||53944==a||53972==a||54e3==a||54028==a||54056==a||54084==a||54112==a||54140==a||54168==a||54196==a||54224==a||54252==a||54280==a||54308==a||54336==a||54364==a||54392==a||54420==a||54448==a||54476==a||54504==a||54532==a||54560==a||54588==a||54616==a||54644==a||54672==a||54700==a||54728==a||54756==a||54784==a||54812==a||54840==a||54868==a||54896==a||54924==a||54952==a||54980==a||55008==a||55036==a||55064==a||55092==a||55120==a||55148==a||55176==a?9:44033<=a&&a<=44059||44061<=a&&a<=44087||44089<=a&&a<=44115||44117<=a&&a<=44143||44145<=a&&a<=44171||44173<=a&&a<=44199||44201<=a&&a<=44227||44229<=a&&a<=44255||44257<=a&&a<=44283||44285<=a&&a<=44311||44313<=a&&a<=44339||44341<=a&&a<=44367||44369<=a&&a<=44395||44397<=a&&a<=44423||44425<=a&&a<=44451||44453<=a&&a<=44479||44481<=a&&a<=44507||44509<=a&&a<=44535||44537<=a&&a<=44563||44565<=a&&a<=44591||44593<=a&&a<=44619||44621<=a&&a<=44647||44649<=a&&a<=44675||44677<=a&&a<=44703||44705<=a&&a<=44731||44733<=a&&a<=44759||44761<=a&&a<=44787||44789<=a&&a<=44815||44817<=a&&a<=44843||44845<=a&&a<=44871||44873<=a&&a<=44899||44901<=a&&a<=44927||44929<=a&&a<=44955||44957<=a&&a<=44983||44985<=a&&a<=45011||45013<=a&&a<=45039||45041<=a&&a<=45067||45069<=a&&a<=45095||45097<=a&&a<=45123||45125<=a&&a<=45151||45153<=a&&a<=45179||45181<=a&&a<=45207||45209<=a&&a<=45235||45237<=a&&a<=45263||45265<=a&&a<=45291||45293<=a&&a<=45319||45321<=a&&a<=45347||45349<=a&&a<=45375||45377<=a&&a<=45403||45405<=a&&a<=45431||45433<=a&&a<=45459||45461<=a&&a<=45487||45489<=a&&a<=45515||45517<=a&&a<=45543||45545<=a&&a<=45571||45573<=a&&a<=45599||45601<=a&&a<=45627||45629<=a&&a<=45655||45657<=a&&a<=45683||45685<=a&&a<=45711||45713<=a&&a<=45739||45741<=a&&a<=45767||45769<=a&&a<=45795||45797<=a&&a<=45823||45825<=a&&a<=45851||45853<=a&&a<=45879||45881<=a&&a<=45907||45909<=a&&a<=45935||45937<=a&&a<=45963||45965<=a&&a<=45991||45993<=a&&a<=46019||46021<=a&&a<=46047||46049<=a&&a<=46075||46077<=a&&a<=46103||46105<=a&&a<=46131||46133<=a&&a<=46159||46161<=a&&a<=46187||46189<=a&&a<=46215||46217<=a&&a<=46243||46245<=a&&a<=46271||46273<=a&&a<=46299||46301<=a&&a<=46327||46329<=a&&a<=46355||46357<=a&&a<=46383||46385<=a&&a<=46411||46413<=a&&a<=46439||46441<=a&&a<=46467||46469<=a&&a<=46495||46497<=a&&a<=46523||46525<=a&&a<=46551||46553<=a&&a<=46579||46581<=a&&a<=46607||46609<=a&&a<=46635||46637<=a&&a<=46663||46665<=a&&a<=46691||46693<=a&&a<=46719||46721<=a&&a<=46747||46749<=a&&a<=46775||46777<=a&&a<=46803||46805<=a&&a<=46831||46833<=a&&a<=46859||46861<=a&&a<=46887||46889<=a&&a<=46915||46917<=a&&a<=46943||46945<=a&&a<=46971||46973<=a&&a<=46999||47001<=a&&a<=47027||47029<=a&&a<=47055||47057<=a&&a<=47083||47085<=a&&a<=47111||47113<=a&&a<=47139||47141<=a&&a<=47167||47169<=a&&a<=47195||47197<=a&&a<=47223||47225<=a&&a<=47251||47253<=a&&a<=47279||47281<=a&&a<=47307||47309<=a&&a<=47335||47337<=a&&a<=47363||47365<=a&&a<=47391||47393<=a&&a<=47419||47421<=a&&a<=47447||47449<=a&&a<=47475||47477<=a&&a<=47503||47505<=a&&a<=47531||47533<=a&&a<=47559||47561<=a&&a<=47587||47589<=a&&a<=47615||47617<=a&&a<=47643||47645<=a&&a<=47671||47673<=a&&a<=47699||47701<=a&&a<=47727||47729<=a&&a<=47755||47757<=a&&a<=47783||47785<=a&&a<=47811||47813<=a&&a<=47839||47841<=a&&a<=47867||47869<=a&&a<=47895||47897<=a&&a<=47923||47925<=a&&a<=47951||47953<=a&&a<=47979||47981<=a&&a<=48007||48009<=a&&a<=48035||48037<=a&&a<=48063||48065<=a&&a<=48091||48093<=a&&a<=48119||48121<=a&&a<=48147||48149<=a&&a<=48175||48177<=a&&a<=48203||48205<=a&&a<=48231||48233<=a&&a<=48259||48261<=a&&a<=48287||48289<=a&&a<=48315||48317<=a&&a<=48343||48345<=a&&a<=48371||48373<=a&&a<=48399||48401<=a&&a<=48427||48429<=a&&a<=48455||48457<=a&&a<=48483||48485<=a&&a<=48511||48513<=a&&a<=48539||48541<=a&&a<=48567||48569<=a&&a<=48595||48597<=a&&a<=48623||48625<=a&&a<=48651||48653<=a&&a<=48679||48681<=a&&a<=48707||48709<=a&&a<=48735||48737<=a&&a<=48763||48765<=a&&a<=48791||48793<=a&&a<=48819||48821<=a&&a<=48847||48849<=a&&a<=48875||48877<=a&&a<=48903||48905<=a&&a<=48931||48933<=a&&a<=48959||48961<=a&&a<=48987||48989<=a&&a<=49015||49017<=a&&a<=49043||49045<=a&&a<=49071||49073<=a&&a<=49099||49101<=a&&a<=49127||49129<=a&&a<=49155||49157<=a&&a<=49183||49185<=a&&a<=49211||49213<=a&&a<=49239||49241<=a&&a<=49267||49269<=a&&a<=49295||49297<=a&&a<=49323||49325<=a&&a<=49351||49353<=a&&a<=49379||49381<=a&&a<=49407||49409<=a&&a<=49435||49437<=a&&a<=49463||49465<=a&&a<=49491||49493<=a&&a<=49519||49521<=a&&a<=49547||49549<=a&&a<=49575||49577<=a&&a<=49603||49605<=a&&a<=49631||49633<=a&&a<=49659||49661<=a&&a<=49687||49689<=a&&a<=49715||49717<=a&&a<=49743||49745<=a&&a<=49771||49773<=a&&a<=49799||49801<=a&&a<=49827||49829<=a&&a<=49855||49857<=a&&a<=49883||49885<=a&&a<=49911||49913<=a&&a<=49939||49941<=a&&a<=49967||49969<=a&&a<=49995||49997<=a&&a<=50023||50025<=a&&a<=50051||50053<=a&&a<=50079||50081<=a&&a<=50107||50109<=a&&a<=50135||50137<=a&&a<=50163||50165<=a&&a<=50191||50193<=a&&a<=50219||50221<=a&&a<=50247||50249<=a&&a<=50275||50277<=a&&a<=50303||50305<=a&&a<=50331||50333<=a&&a<=50359||50361<=a&&a<=50387||50389<=a&&a<=50415||50417<=a&&a<=50443||50445<=a&&a<=50471||50473<=a&&a<=50499||50501<=a&&a<=50527||50529<=a&&a<=50555||50557<=a&&a<=50583||50585<=a&&a<=50611||50613<=a&&a<=50639||50641<=a&&a<=50667||50669<=a&&a<=50695||50697<=a&&a<=50723||50725<=a&&a<=50751||50753<=a&&a<=50779||50781<=a&&a<=50807||50809<=a&&a<=50835||50837<=a&&a<=50863||50865<=a&&a<=50891||50893<=a&&a<=50919||50921<=a&&a<=50947||50949<=a&&a<=50975||50977<=a&&a<=51003||51005<=a&&a<=51031||51033<=a&&a<=51059||51061<=a&&a<=51087||51089<=a&&a<=51115||51117<=a&&a<=51143||51145<=a&&a<=51171||51173<=a&&a<=51199||51201<=a&&a<=51227||51229<=a&&a<=51255||51257<=a&&a<=51283||51285<=a&&a<=51311||51313<=a&&a<=51339||51341<=a&&a<=51367||51369<=a&&a<=51395||51397<=a&&a<=51423||51425<=a&&a<=51451||51453<=a&&a<=51479||51481<=a&&a<=51507||51509<=a&&a<=51535||51537<=a&&a<=51563||51565<=a&&a<=51591||51593<=a&&a<=51619||51621<=a&&a<=51647||51649<=a&&a<=51675||51677<=a&&a<=51703||51705<=a&&a<=51731||51733<=a&&a<=51759||51761<=a&&a<=51787||51789<=a&&a<=51815||51817<=a&&a<=51843||51845<=a&&a<=51871||51873<=a&&a<=51899||51901<=a&&a<=51927||51929<=a&&a<=51955||51957<=a&&a<=51983||51985<=a&&a<=52011||52013<=a&&a<=52039||52041<=a&&a<=52067||52069<=a&&a<=52095||52097<=a&&a<=52123||52125<=a&&a<=52151||52153<=a&&a<=52179||52181<=a&&a<=52207||52209<=a&&a<=52235||52237<=a&&a<=52263||52265<=a&&a<=52291||52293<=a&&a<=52319||52321<=a&&a<=52347||52349<=a&&a<=52375||52377<=a&&a<=52403||52405<=a&&a<=52431||52433<=a&&a<=52459||52461<=a&&a<=52487||52489<=a&&a<=52515||52517<=a&&a<=52543||52545<=a&&a<=52571||52573<=a&&a<=52599||52601<=a&&a<=52627||52629<=a&&a<=52655||52657<=a&&a<=52683||52685<=a&&a<=52711||52713<=a&&a<=52739||52741<=a&&a<=52767||52769<=a&&a<=52795||52797<=a&&a<=52823||52825<=a&&a<=52851||52853<=a&&a<=52879||52881<=a&&a<=52907||52909<=a&&a<=52935||52937<=a&&a<=52963||52965<=a&&a<=52991||52993<=a&&a<=53019||53021<=a&&a<=53047||53049<=a&&a<=53075||53077<=a&&a<=53103||53105<=a&&a<=53131||53133<=a&&a<=53159||53161<=a&&a<=53187||53189<=a&&a<=53215||53217<=a&&a<=53243||53245<=a&&a<=53271||53273<=a&&a<=53299||53301<=a&&a<=53327||53329<=a&&a<=53355||53357<=a&&a<=53383||53385<=a&&a<=53411||53413<=a&&a<=53439||53441<=a&&a<=53467||53469<=a&&a<=53495||53497<=a&&a<=53523||53525<=a&&a<=53551||53553<=a&&a<=53579||53581<=a&&a<=53607||53609<=a&&a<=53635||53637<=a&&a<=53663||53665<=a&&a<=53691||53693<=a&&a<=53719||53721<=a&&a<=53747||53749<=a&&a<=53775||53777<=a&&a<=53803||53805<=a&&a<=53831||53833<=a&&a<=53859||53861<=a&&a<=53887||53889<=a&&a<=53915||53917<=a&&a<=53943||53945<=a&&a<=53971||53973<=a&&a<=53999||54001<=a&&a<=54027||54029<=a&&a<=54055||54057<=a&&a<=54083||54085<=a&&a<=54111||54113<=a&&a<=54139||54141<=a&&a<=54167||54169<=a&&a<=54195||54197<=a&&a<=54223||54225<=a&&a<=54251||54253<=a&&a<=54279||54281<=a&&a<=54307||54309<=a&&a<=54335||54337<=a&&a<=54363||54365<=a&&a<=54391||54393<=a&&a<=54419||54421<=a&&a<=54447||54449<=a&&a<=54475||54477<=a&&a<=54503||54505<=a&&a<=54531||54533<=a&&a<=54559||54561<=a&&a<=54587||54589<=a&&a<=54615||54617<=a&&a<=54643||54645<=a&&a<=54671||54673<=a&&a<=54699||54701<=a&&a<=54727||54729<=a&&a<=54755||54757<=a&&a<=54783||54785<=a&&a<=54811||54813<=a&&a<=54839||54841<=a&&a<=54867||54869<=a&&a<=54895||54897<=a&&a<=54923||54925<=a&&a<=54951||54953<=a&&a<=54979||54981<=a&&a<=55007||55009<=a&&a<=55035||55037<=a&&a<=55063||55065<=a&&a<=55091||55093<=a&&a<=55119||55121<=a&&a<=55147||55149<=a&&a<=55175||55177<=a&&a<=55203?10:9757==a||9977==a||9994<=a&&a<=9997||127877==a||127938<=a&&a<=127940||127943==a||127946<=a&&a<=127948||128066<=a&&a<=128067||128070<=a&&a<=128080||128110==a||128112<=a&&a<=128120||128124==a||128129<=a&&a<=128131||128133<=a&&a<=128135||128170==a||128372<=a&&a<=128373||128378==a||128400==a||128405<=a&&a<=128406||128581<=a&&a<=128583||128587<=a&&a<=128591||128675==a||128692<=a&&a<=128694||128704==a||128716==a||129304<=a&&a<=129308||129310<=a&&a<=129311||129318==a||129328<=a&&a<=129337||129341<=a&&a<=129342||129489<=a&&a<=129501?r:127995<=a&&a<=127999?14:8205==a?15:9792==a||9794==a||9877<=a&&a<=9878||9992==a||10084==a||127752==a||127806==a||127859==a||127891==a||127908==a||127912==a||127979==a||127981==a||128139==a||128187<=a&&a<=128188||128295==a||128300==a||128488==a||128640==a||128658==a?i:128102<=a&&a<=128105?o:11}return this.nextBreak=function(e,t){if(void 0===t&&(t=0),t<0)return 0
if(t>=e.length-1)return e.length
for(var n=c(s(e,t)),r=[],i=t+1;i<e.length;i++)if(!a(e,i-1)){var o=c(s(e,i))
if(l(n,r,o))return i
r.push(o)}return e.length},this.splitGraphemes=function(e){for(var t,n=[],r=0;(t=this.nextBreak(e,r))<e.length;)n.push(e.slice(r,t)),r=t
return r<e.length&&n.push(e.slice(r)),n},this.iterateGraphemes=function(e){var t=0,n={next:function(){var n,r
return(r=this.nextBreak(e,t))<e.length?(n=e.slice(t,r),t=r,{value:n,done:!1}):t<e.length?(n=e.slice(t),t=e.length,{value:n,done:!1}):{value:void 0,done:!0}}.bind(this)}
return"undefined"!=typeof Symbol&&Symbol.iterator&&(n[Symbol.iterator]=function(){return n}),n},this.countGraphemes=function(e){for(var t,n=0,r=0;(t=this.nextBreak(e,r))<e.length;)r=t,n++
return r<e.length&&n++,n},this})}),n=new t,r=function(e,t,r){for(var i=n.iterateGraphemes(e.substring(t)),o="",a=0;a<r-t;a++){var s=i.next()
if(o+=s.value,s.done)break}return o},i=function(e,t,n,r,i,o,a){return{start:{line:e,column:t,offset:n},end:{line:r,column:i,offset:o},source:a||null}},o=e(function(e,t){e.exports=function(){var e,t="",n=function(n,r){if("string"!=typeof n)throw new TypeError("expected a string")
if(1===r)return n
if(2===r)return n+n
var i=n.length*r
if(e!==n||void 0===e)e=n,t=""
else if(t.length>=i)return t.substr(0,i)
for(;i>t.length&&r>1;)1&r&&(t+=n),r>>=1,n+=n
return t=(t+=n).substr(0,i)},r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]
for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}
function i(e,t,r,i){var o=function(e,t){if(null==e||null==t)return e
var n=String(e),r="number"==typeof t?t:parseInt(t,10)
if(isNaN(r)||!isFinite(r))return n
var i=n.length
if(i>=r)return n
var o=String(" ")
""===o&&(o=" ")
for(var a=r-i;o.length<a;)o+=o
return(o.length>a?o.substr(0,a):o)+n}(String(t),r),a=n(" ",i.tabSize)
return o+" | "+e.replace(/\t/g,a)}function o(e,t,n,r,o){return e.slice(t,n).map(function(e,n){return i(e,t+n+1,r,o)}).join("\n")}var a={extraLines:2,tabSize:4}
return function(e,t,s,l){l=r({},a,l)
var c=e.split(/\r\n?|\n|\f/),u=Math.max(1,t-l.extraLines)-1,d=Math.min(t+l.extraLines,c.length),p=String(d).length,h=o(c,u,t,p,l),f=i(c[t-1].substring(0,s-1),t,p,l)
return[h,n(" ",f.length)+"^",o(c,t,d,p,l)].filter(Boolean).join("\n")}}()}),a=(new Error).stack,s=function(e,t,n,r,i){throw function(e){var t=Object.create(SyntaxError.prototype)
return Object.assign(t,e,{name:"SyntaxError"}),Object.defineProperty(t,"stack",{get:function(){return a?a.replace(/^(.+\n){1,3}/,String(t)+"\n"):""}}),t}({message:r?e+"\n"+o(t,r,i):e,rawMessage:e,source:n,line:r,column:i})},l=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r]
return"Unexpected token <"+e+"> at "+n.filter(Boolean).join(":")},c=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r]
return"Unexpected symbol <"+e+"> at "+n.filter(Boolean).join(":")},u={"{":0,"}":1,"[":2,"]":3,":":4,",":5},d={true:8,false:9,null:10},p={'"':0,"\\":1,"/":2,b:3,f:4,n:5,r:6,t:7,u:8}
function h(e){return e>="1"&&e<="9"}function f(e){return e>="0"&&e<="9"}function m(e){return f(e)||e>="a"&&e<="f"||e>="A"&&e<="F"}function g(e){return"e"===e||"E"===e}function y(e,t,n,r){var i=e.charAt(t)
if("\r"===i)t++,n++,r=1,"\n"===e.charAt(t)&&t++
else if("\n"===i)t++,n++,r=1
else{if("\t"!==i&&" "!==i)return null
t++,r++}return{index:t,line:n,column:r}}function v(e,t,n,r){var i=e.charAt(t)
return i in u?{type:u[i],line:n,column:r+1,index:t+1,value:null}:null}function b(e,t,n,r){for(var i in d)if(d.hasOwnProperty(i)&&e.substr(t,i.length)===i)return{type:d[i],line:n,column:r+i.length,index:t+i.length,value:i}
return null}function x(e,t,n,r){for(var i=t,o=0;t<e.length;){var a=e.charAt(t)
switch(o){case 0:if('"'!==a)return null
t++,o=1
break
case 1:if("\\"===a)t++,o=2
else{if('"'===a)return{type:6,line:n,column:r+ ++t-i,index:t,value:e.slice(i,t)}
t++}break
case 2:if(!(a in p))return null
if(t++,"u"===a)for(var s=0;s<4;s++){var l=e.charAt(t)
if(!l||!m(l))return null
t++}o=1}}}function S(e,t,n,r){var i=t,o=t,a=0
e:for(;t<e.length;){var s=e.charAt(t)
switch(a){case 0:if("-"===s)a=1
else if("0"===s)o=t+1,a=2
else{if(!h(s))return null
o=t+1,a=3}break
case 1:if("0"===s)o=t+1,a=2
else{if(!h(s))return null
o=t+1,a=3}break
case 2:if("."===s)a=4
else{if(!g(s))break e
a=6}break
case 3:if(f(s))o=t+1
else if("."===s)a=4
else{if(!g(s))break e
a=6}break
case 4:if(!f(s))break e
o=t+1,a=5
break
case 5:if(f(s))o=t+1
else{if(!g(s))break e
a=6}break
case 6:if("+"===s||"-"===s)a=7
else{if(!f(s))break e
o=t+1,a=7}break
case 7:if(!f(s))break e
o=t+1}t++}return o>0?{type:7,line:n,column:r+o-i,index:o,value:e.slice(i,o)}:null}var _={loc:!0,source:null}
function C(e,t,n){var r=t.length>0?t[t.length-1].loc.end:{line:1,column:1}
s("Unexpected end of input",e,n.source,r.line,r.column)}function w(e){for(var t=0,n=0;n<4;n++)t=16*t+parseInt(e[n],16)
return String.fromCharCode(t)}var T={b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},A=['"',"\\","/"]
function I(e){for(var t="",n=0;n<e.length;n++){var r=e.charAt(n)
if("\\"===r){n++
var i=e.charAt(n)
if("u"===i)t+=w(e.substr(n+1,4)),n+=4
else if(-1!==A.indexOf(i))t+=i
else{if(!(i in T))break
t+=T[i]}}else t+=r}return t}function P(e,t,n,o){for(var a=void 0,c={type:"Object",children:[]},u=0;n<t.length;){var d=t[n]
switch(u){case 0:if(0!==d.type)return null
a=d,u=1,n++
break
case 1:if(1===d.type)return o.loc&&(c.loc=i(a.loc.start.line,a.loc.start.column,a.loc.start.offset,d.loc.end.line,d.loc.end.column,d.loc.end.offset,o.source)),{value:c,index:n+1}
var p=B(e,t,n,o)
c.children.push(p.value),u=2,n=p.index
break
case 2:if(1===d.type)return o.loc&&(c.loc=i(a.loc.start.line,a.loc.start.column,a.loc.start.offset,d.loc.end.line,d.loc.end.column,d.loc.end.offset,o.source)),{value:c,index:n+1}
5===d.type?(u=3,n++):s(l(r(e,d.loc.start.offset,d.loc.end.offset),o.source,d.loc.start.line,d.loc.start.column),e,o.source,d.loc.start.line,d.loc.start.column)
break
case 3:var h=B(e,t,n,o)
h?(n=h.index,c.children.push(h.value),u=2):s(l(r(e,d.loc.start.offset,d.loc.end.offset),o.source,d.loc.start.line,d.loc.start.column),e,o.source,d.loc.start.line,d.loc.start.column)}}C(e,t,o)}function B(e,t,n,o){for(var a=void 0,c={type:"Property",key:null,value:null},u=0;n<t.length;){var d=t[n]
switch(u){case 0:if(6!==d.type)return null
var p={type:"Identifier",value:I(e.slice(d.loc.start.offset+1,d.loc.end.offset-1)),raw:d.value}
o.loc&&(p.loc=d.loc),a=d,c.key=p,u=1,n++
break
case 1:4===d.type?(u=2,n++):s(l(r(e,d.loc.start.offset,d.loc.end.offset),o.source,d.loc.start.line,d.loc.start.column),e,o.source,d.loc.start.line,d.loc.start.column)
break
case 2:var h=D(e,t,n,o)
return c.value=h.value,o.loc&&(c.loc=i(a.loc.start.line,a.loc.start.column,a.loc.start.offset,h.value.loc.end.line,h.value.loc.end.column,h.value.loc.end.offset,o.source)),{value:c,index:h.index}}}}function E(e,t,n,o){for(var a=void 0,c={type:"Array",children:[]},u=0,d=void 0;n<t.length;)switch(d=t[n],u){case 0:if(2!==d.type)return null
a=d,u=1,n++
break
case 1:if(3===d.type)return o.loc&&(c.loc=i(a.loc.start.line,a.loc.start.column,a.loc.start.offset,d.loc.end.line,d.loc.end.column,d.loc.end.offset,o.source)),{value:c,index:n+1}
var p=D(e,t,n,o)
n=p.index,c.children.push(p.value),u=2
break
case 2:if(3===d.type)return o.loc&&(c.loc=i(a.loc.start.line,a.loc.start.column,a.loc.start.offset,d.loc.end.line,d.loc.end.column,d.loc.end.offset,o.source)),{value:c,index:n+1}
5===d.type?(u=3,n++):s(l(r(e,d.loc.start.offset,d.loc.end.offset),o.source,d.loc.start.line,d.loc.start.column),e,o.source,d.loc.start.line,d.loc.start.column)
break
case 3:var h=D(e,t,n,o)
n=h.index,c.children.push(h.value),u=2}C(e,t,o)}function k(e,t,n,r){var i=t[n],o=null
switch(i.type){case 6:o=I(e.slice(i.loc.start.offset+1,i.loc.end.offset-1))
break
case 7:o=Number(i.value)
break
case 8:o=!0
break
case 9:o=!1
break
case 10:o=null
break
default:return null}var a={type:"Literal",value:o,raw:i.value}
return r.loc&&(a.loc=i.loc),{value:a,index:n+1}}function D(e,t,n,i){var o=t[n],a=k.apply(void 0,arguments)||P.apply(void 0,arguments)||E.apply(void 0,arguments)
if(a)return a
s(l(r(e,o.loc.start.offset,o.loc.end.offset),i.source,o.loc.start.line,o.loc.start.column),e,i.source,o.loc.start.line,o.loc.start.column)}return function(e,t){var n=function(e,t){for(var n=1,o=1,a=0,l=[];a<e.length;){var u=[e,a,n,o],d=y.apply(void 0,u)
if(d)a=d.index,n=d.line,o=d.column
else{var p=v.apply(void 0,u)||b.apply(void 0,u)||x.apply(void 0,u)||S.apply(void 0,u)
if(p){var h={type:p.type,value:p.value,loc:i(n,o,a,p.line,p.column,p.index,t.source)}
l.push(h),a=p.index,n=p.line,o=p.column}else s(c(r(e,a,a+1),t.source,n,o),e,t.source,n,o)}}return l}(e,t=Object.assign({},_,t))
0===n.length&&C(e,n,t)
var o=D(e,n,0,t)
if(o.index===n.length)return o.value
var a=n[o.index]
s(l(r(e,a.loc.start.offset,a.loc.end.offset),t.source,a.loc.start.line,a.loc.start.column),e,t.source,a.loc.start.line,a.loc.start.column)}},e.exports=t()},88696(e,t,n){"use strict"
n.r(t),n.d(t,{default:()=>Xt})
var r=n(61603),i=n(63767),o=n(38382),a=(n(15546),n(77603)),s=n(41113)
function l(e){return e._store}function c(e,t,n){return(e[t]=e[t]||Object.create(null))[n]}function u(e,t,n,r){(e[t]=e[t]||Object.create(null))[n]=r}function d(e){if(!e.id)return!0
const t=(0,i.p)(e)
return Boolean(t?.isNew(e))}function p(e){return"belongsTo"===e.definition.kind}function h(e){return e.definition.isImplicit}function f(e){return"hasMany"===e.definition.kind}function m(e,t){if(p(e))e.remoteState&&t(e.remoteState),e.localState&&e.localState!==e.remoteState&&t(e.localState)
else if(f(e)){for(let n=0;n<e.remoteState.length;n++){const r=e.remoteState[n]
t(r)}e.additions?.forEach(t)}else e.localMembers.forEach(t),e.remoteMembers.forEach(n=>{e.localMembers.has(n)||t(n)})}function g(e,t,n,r){if(p(t))t.remoteState===n&&(t.remoteState=null),t.localState===n&&(t.localState=null,y(e,t))
else if(f(t)){t.remoteMembers.delete(n),t.additions?.delete(n)
const r=t.removals?.delete(n),i=t.remoteState.indexOf(n)
if(-1!==i&&t.remoteState.splice(i,1),!r){const r=t.localState?.indexOf(n);-1!==r&&void 0!==r&&(t.localState.splice(r,1),y(e,t))}}else t.remoteMembers.delete(n),t.localMembers.delete(n)}function y(e,t){if(!t.accessed)return
const n=t.identifier,r=t.definition.key
n!==e._removing&&e.store.notifyChange(n,"relationships",r)}function v(e){return"belongsTo"===e.kind||"hasMany"===e.kind}const b=null,x=Date.now()
function S(e,t){return`implicit-${e}:${t}${x}`}function _(e,t){e.inverseKind=t.kind,e.inverseKey=t.key,e.inverseType=t.type,e.inverseIsAsync=t.isAsync,e.inverseIsCollection=t.isCollection,e.inverseIsPolymorphic=t.isPolymorphic,e.inverseIsImplicit=t.isImplicit,e.inverseIsLinksMode=t.isLinksMode
const n=!1!==e.resetOnRemoteUpdate&&!1!==t.resetOnRemoteUpdate
e.resetOnRemoteUpdate=n,t.resetOnRemoteUpdate=n}function C(e){var t
v(e)||(e={kind:"resource"===(t=e).kind?"belongsTo":"hasMany",name:t.name,type:t.type,options:Object.assign({},{async:!1,inverse:null,resetOnRemoteUpdate:!1},t.options)})
const n={},r=e.options
return n.kind=e.kind,n.key=e.name,n.type=e.type,n.isAsync=r.async,n.isImplicit=!1,n.isCollection="hasMany"===e.kind,n.isPolymorphic=r&&!!r.polymorphic,n.isLinksMode=r.linksMode??!1,n.inverseKey=r&&r.inverse||"",n.inverseType="",n.inverseIsAsync=b,n.inverseIsImplicit=r&&null===r.inverse||b,n.inverseIsCollection=b,n.inverseIsLinksMode=b,n.resetOnRemoteUpdate=!!v(e)&&!e.options?.linksMode&&!1!==e.options?.resetOnRemoteUpdate,n}function w(e,t,n){n?function(e,t,n){const i=t.value,o=e.get(t.record,t.field)
n&&e._addToTransaction(o)
const a=o.isDirty
o.state.hasReceivedData||(o.isDirty=!0),o.state.hasReceivedData=!0
const{definition:s}=o,{type:l}=o.definition,c=B(i,o,r=>{l!==r.type&&e.registerPolymorphicType(l,r.type),o.additions?.has(r)&&o.additions.delete(r),T(e,r,s.inverseKey,t.record,n)},r=>{o.removals?.has(r)&&o.removals.delete(r),A(e,r,s.inverseKey,t.record,n)})
if(o.remoteMembers=c.finalSet,o.remoteState=c.finalState,c.changed&&(o.isDirty=!0),o._diff=c,"hasMany"===o.definition.kind&&!1!==o.definition.resetOnRemoteUpdate&&(c.changed||a)){const n={removals:[],additions:[],triggered:!1}
o.removals&&(o.isDirty=!0,o.removals.forEach(r=>{n.triggered=!0,n.removals.push(r),T(e,r,s.inverseKey,t.record,!1)}),o.removals=null),o.additions&&(o.additions.forEach(r=>{d(r)||(n.triggered=!0,n.additions.push(r),o.isDirty=!0,o.additions.delete(r),A(e,r,s.inverseKey,t.record,!1))}),0===o.additions.size&&(o.additions=null)),n.triggered&&(0,r.deprecate)(`WarpDrive is changing the default semantics of updates to the remote state of relationships.\n\nThe following local state was cleared from the <${o.identifier.type}>.${o.definition.key} hasMany relationship but will not be once this deprecation is resolved by opting into the new behavior:\n\n\tAdded: [${n.additions.map(e=>e.lid).join(", ")}]\n\tRemoved: [${n.removals.map(e=>e.lid).join(", ")}]`,!1,{id:"ember-data:deprecate-relationship-remote-update-clearing-local-state",for:"ember-data",since:{enabled:"5.3",available:"4.13"},until:"6.0",url:"https://deprecations.emberjs.com/v5.x#ember-data-deprecate-relationship-remote-update-clearing-local-state"})}o.isDirty&&!a&&I(e,o)}(e,t,n):function(e,t,n){const r=t.value,i=e.get(t.record,t.field)
i.state.hasReceivedData=!0
const{additions:o,removals:a}=i,{inverseKey:s,type:l}=i.definition,{record:c}=t,u=i.isDirty
let d=!1
const p=r=>{const i=a?.has(r)
!i&&o?.has(r)||(l!==r.type&&e.registerPolymorphicType(l,r.type),d=!0,T(e,r,s,t.record,n),i&&a.delete(r))},h=t=>{const r=o?.has(t)
!r&&a?.has(t)||(d=!0,A(e,t,s,c,n),r&&o.delete(t))},f=B(r,i,p,h)
o&&o.size>0&&o.forEach(e=>{f.add.has(e)||(d=!0,h(e))}),a&&a.size>0&&a.forEach(e=>{f.del.has(e)||(d=!0,p(e))})
const m=f.changed||d
i.additions=f.add,i.removals=f.del,i.localState=f.finalState,m&&!u&&y(e,i)}(e,t,n)}function T(e,t,n,r,i){const o=e.get(t,n),{type:a}=o.definition
a!==r.type&&e.registerPolymorphicType(a,r.type),p(o)?(o.state.hasReceivedData=!0,o.state.isEmpty=!1,i&&(e._addToTransaction(o),null!==o.remoteState&&A(e,o.remoteState,o.definition.inverseKey,t,i),o.remoteState=r),o.localState!==r&&(!i&&o.localState&&A(e,o.localState,o.definition.inverseKey,t,i),o.localState=r,y(e,o))):f(o)?i?o.remoteMembers.has(r)||(e._addToTransaction(o),o.remoteState.push(r),o.remoteMembers.add(r),o.additions?.has(r)?o.additions.delete(r):(o.isDirty=!0,o.state.hasReceivedData=!0,I(e,o))):(o.isDirty||o.localState||(o.localState=[]),E(e,0,o,r,null,i)&&y(e,o)):i?o.remoteMembers.has(r)||(o.remoteMembers.add(r),o.localMembers.add(r)):o.localMembers.has(r)||o.localMembers.add(r)}function A(e,t,n,r,i){const o=e.get(t,n)
p(o)?(o.state.isEmpty=!0,i&&(e._addToTransaction(o),o.remoteState=null),o.localState===r&&(o.localState=null,y(e,o))):f(o)?i?(e._addToTransaction(o),D(o,r)&&y(e,o)):k(o,r)&&y(e,o):i?(o.remoteMembers.delete(r),o.localMembers.delete(r)):r&&o.localMembers.has(r)&&o.localMembers.delete(r)}function I(e,t){t.accessed&&e._scheduleLocalSync(t)}function P(e,t,n=!1){const i=e.get(t.record,t.field)
n&&e._addToTransaction(i)
const{definition:o,state:a}=i,s=n?"remoteState":"localState",l=i[s]
if(t.value!==l)if(l&&A(e,l,o.inverseKey,t.record,n),i[s]=t.value,a.hasReceivedData=!0,a.isEmpty=null===t.value,a.isStale=!1,a.hasFailedLoadAttempt=!1,t.value&&(o.type!==t.value.type&&e.registerPolymorphicType(o.type,t.value.type),T(e,t.value,o.inverseKey,t.record,n)),n){const{localState:t,remoteState:n}=i
if(t&&d(t)&&!n)return
t!==n&&t===l?(i.localState=n,y(e,i)):t!==n&&t!==l&&!1!==i.definition.resetOnRemoteUpdate&&(i.localState=n,(0,r.deprecate)(`WarpDrive is changing the default semantics of updates to the remote state of relationships.\n\nThe following local state was cleared from the <${i.identifier.type}>.${i.definition.key} belongsTo relationship but will not be once this deprecation is resolved:\n\n\t${t?"Added: "+t.lid+"\n\t":""}${l?"Removed: "+l.lid:""}`,!1,{id:"ember-data:deprecate-relationship-remote-update-clearing-local-state",for:"ember-data",since:{enabled:"5.3",available:"4.13"},until:"6.0",url:"https://deprecations.emberjs.com/v5.x#ember-data-deprecate-relationship-remote-update-clearing-local-state"}),y(e,i))}else y(e,i)
else if(a.hasReceivedData=!0,n){const{localState:a}=i
if(a&&d(a)&&!l)return
l&&a===l?function(e,t,n,r,i){const o=e.get(t,n)
f(o)&&i&&o.remoteMembers.has(r)&&y(e,o)}(e,l,o.inverseKey,t.record,n):a!==t.value&&!1!==i.definition.resetOnRemoteUpdate&&(i.localState=l,(0,r.deprecate)(`WarpDrive is changing the default semantics of updates to the remote state of relationships.\n\nThe following local state was cleared from the <${i.identifier.type}>.${i.definition.key} belongsTo relationship but will not be once this deprecation is resolved:\n\n\t${a?"Added: "+a.lid+"\n\t":""}${l?"Removed: "+l.lid:""}`,!1,{id:"ember-data:deprecate-relationship-remote-update-clearing-local-state",for:"ember-data",since:{enabled:"5.3",available:"4.13"},until:"6.0",url:"https://deprecations.emberjs.com/v5.x#ember-data-deprecate-relationship-remote-update-clearing-local-state"}),y(e,i))}}function B(e,t,n,r){const i=new Set(e),{localState:o,remoteState:a,remoteMembers:s}=t
if(e.length!==i.size){const{diff:l,duplicates:c}=function(e,t,n,r,i,o,a,s){const l=t.length,c=r.length,u=Math.max(l,c)
let d=n.size!==i.size,p=!1
const h=new Set,f=new Set,m=new Map,g=new Set,y=[],v=e?.length??0
for(let b=0,x=0;b<u;b++){let u,S=!1
if(b<l)if(u=t[b],g.has(u)){let e=m.get(u)
void 0===e&&(e=[],m.set(u,e)),e.push(b)}else y[x]=u,g.add(u),S=!0,i.has(u)||(b<v&&e[b]!==u&&(d=!0),h.add(u),o(u))
if(b<c){const t=r[b]
u!==r[x]?(p=!0,!s&&b<v?e[x]!==u&&(d=!0):d=!0):s&&!d&&x<v&&e[x]!==u&&(d=!0),n.has(t)||(d=!0,f.add(t),a(t))}else S&&x<c&&u!==r[x]&&(d=!0)
S&&x++}return{diff:{add:h,del:f,finalState:y,finalSet:g,changed:d,remoteOrderChanged:p},duplicates:m}}(o,e,i,a,s,n,r,t.definition.resetOnRemoteUpdate)
return l}return function(e,t,n,r,i,o,a,s){const l=t.length,c=r.length,u=Math.max(l,c),d=e?l===e.length:l===c
let p=n.size!==i.size,h=e?n.size!==e.length:p
const f=new Set,m=new Set,g=e?.length??0
for(let y=0;y<u;y++){let u
if(y<l&&(u=t[y],!i.has(u))&&(y<g&&e[y]!==u&&(h=!0),f.add(u),o(u)),y<c){const t=r[y]
d&&u!==t?(p=!0,y<g?e[y]!==u&&(h=!0):y<l&&(h=!0)):s&&d&&!h&&y<g&&e[y]!==t&&(h=!0),n.has(t)||(p=!0,m.add(t),a(t))}}return{add:f,del:m,finalState:t,finalSet:n,changed:h,remoteOrderChanged:p}}(o,e,i,a,s,n,r,t.definition.resetOnRemoteUpdate)}function E(e,t,n,r,i,o){return o?function(e,t,n,r,i){const{remoteMembers:o,additions:a,removals:s,remoteState:l}=n
if(o.has(r))return!1
o.add(r)
const c=null!==i&&i>=0&&i<l.length
return c?l.splice(i,0,r):l.push(r),a?.has(r)?(a.delete(r),!1):(n.isDirty||n.localState&&(c?0===i?n.localState.unshift(r):s?.size?n.isDirty=!0:n.localState.splice(i,0,r):n.localState.push(r)),!0)}(0,0,n,r,i):function(e,t,n,r,i){const{remoteMembers:o,removals:a}=n
let s=n.additions
if((o.has(r)||s?.has(r))&&!a?.has(r))return!1
if(a?.has(r))a.delete(r)
else{s||(s=n.additions=new Set),n.state.hasReceivedData=!0,s.add(r)
const{type:t}=n.definition
t!==r.type&&e.registerPolymorphicType(r.type,t)}return n.localState&&(null!==i?n.localState.splice(i,0,r):n.localState.push(r)),!0}(e,0,n,r,i)}function k(e,t){const{remoteMembers:n,additions:r}=e
let i=e.removals
if(!n.has(t)&&!r?.has(t)||i?.has(t))return!1
if(r?.has(t)?r.delete(t):(i||(i=e.removals=new Set),i.add(t)),e.localState){const n=e.localState.indexOf(t)
e.localState.splice(n,1)}return!0}function D(e,t){const{remoteMembers:n,additions:r,removals:i,remoteState:o}=e
if(!n.has(t))return!1
n.delete(t)
let a=o.indexOf(t)
return o.splice(a,1),i?.has(t)?(i.delete(t),!1):(e.localState&&(a=e.localState.indexOf(t),e.localState.splice(a,1)),!0)}function M(e,t,n,r){p(r)?P(e,{op:"replaceRelatedRecord",record:t,field:n,value:r.remoteState},!1):(w(e,{op:"replaceRelatedRecords",record:t,field:n,value:r.remoteState.slice()},!1),y(e,r))}function R(e,t){e.accessed=!0
const n={}
return e.state.hasReceivedData&&(n.data=t?e.remoteState.slice():function(e){if(!e.isDirty)return e.localState
const t=e.remoteState.slice()
return e.removals?.forEach(e=>{const n=t.indexOf(e)
t.splice(n,1)}),e.additions?.forEach(e=>{t.push(e)}),e.localState=t,e.isDirty=!1,t}(e)),e.links&&(n.links=e.links),e.meta&&(n.meta=e.meta),n}function O(e,t){let n
e.accessed=!0
const r={}
return t&&e.remoteState?n=e.remoteState:!t&&e.localState&&(n=e.localState),(t&&null===e.remoteState||null===e.localState)&&e.state.hasReceivedData&&(n=null),e.links&&(r.links=e.links),void 0!==n&&(r.data=n),e.meta&&(r.meta=e.meta),r}function L(e,t,n,r,i,o){E(e,0,t,r,i,o)&&T(e,r,t.definition.inverseKey,n,o)}function N(e,t,n,r,i,o){(function(e,t,n,r,i,o){return o?D(n,r):k(n,r)})(0,0,n,r,0,o)&&A(e,r,n.definition.inverseKey,t,o)}function F(e){switch(typeof e){case"object":return e
case"string":return{href:e}}}function z(e,t){for(let n=0;n<e.length;n++)e[n]=t.upgradeIdentifier(e[n])
return e}const j=(0,s.L1)("Graphs",new Map)
class V{constructor(e){this._definitionCache=Object.create(null),this._metaCache=Object.create(null),this._potentialPolymorphicTypes=Object.create(null),this.identifiers=new Map,this.store=e,this.isDestroyed=!1,this._willSyncRemote=!1,this._willSyncLocal=!1,this._pushedUpdates={belongsTo:void 0,hasMany:void 0,deletions:[]},this._updatedRelationships=new Set,this._transaction=null,this._removing=null,this.silenceNotifications=!1}has(e,t){const n=this.identifiers.get(e)
return!!n&&void 0!==n[t]}getDefinition(e,t){let n=this._metaCache[e.type],r=n?.[t]
if(!r){const i=function(e,t,n){const r=e._definitionCache,i=e.store,o=e._potentialPolymorphicTypes,{type:a}=t
let s=c(r,a,n)
if(void 0!==s)return s
const d=i.schema.fields(t).get(n)
if(!d){if(o[a]){const e=Object.keys(o[a])
for(let t=0;t<e.length;t++){const i=c(r,e[t],n)
if(i)return u(r,a,n,i),i.rhs_modelNames.push(a),i}}return r[a][n]=null,null}const p=C(d)
let h,f
const m=p.type
if(null===p.inverseKey?h=null:(f=function(e,t,n){const r=e.schema.fields(t).get(n)
return r?r.options.inverse:null}(l(i),t,n),h=!f&&p.isPolymorphic&&p.inverseKey?{kind:"belongsTo",key:p.inverseKey,type:a,isAsync:!1,isImplicit:!1,isCollection:!1,isPolymorphic:!1}:f?C(i.schema.fields({type:m}).get(f)):null),!h){f=S(a,n),h={kind:"implicit",key:f,type:a,isAsync:!1,isImplicit:!0,isCollection:!0,isPolymorphic:!1},_(p,h),_(h,p)
const e={lhs_key:`${a}:${n}`,lhs_modelNames:[a],lhs_baseModelName:a,lhs_relationshipName:n,lhs_definition:p,lhs_isPolymorphic:p.isPolymorphic,rhs_key:h.key,rhs_modelNames:[m],rhs_baseModelName:m,rhs_relationshipName:h.key,rhs_definition:h,rhs_isPolymorphic:!1,hasInverse:!1,isSelfReferential:a===m,isReflexive:!1}
return u(r,m,f,e),u(r,a,n,e),e}const g=h.type
if(s=c(r,g,n)||c(r,m,f),s)return(s.lhs_baseModelName===g?s.lhs_modelNames:s.rhs_modelNames).push(a),u(r,a,n,s),s
_(p,h),_(h,p)
const y=[a]
a!==g&&y.push(g)
const v=g===m,b={lhs_key:`${g}:${n}`,lhs_modelNames:y,lhs_baseModelName:g,lhs_relationshipName:n,lhs_definition:p,lhs_isPolymorphic:p.isPolymorphic,rhs_key:`${m}:${f}`,rhs_modelNames:[m],rhs_baseModelName:m,rhs_relationshipName:f,rhs_definition:h,rhs_isPolymorphic:h.isPolymorphic,hasInverse:!0,isSelfReferential:v,isReflexive:v&&n===f}
return u(r,g,n,b),u(r,a,n,b),u(r,m,f,b),b}(this,e,t)
r=function(e,t,n){const r=e.isSelfReferential
return 1==(n===e.lhs_relationshipName)&&(!0===r||t===e.lhs_baseModelName||e.rhs_isPolymorphic&&e.lhs_modelNames.includes(t))}(i,e.type,t)?i.lhs_definition:i.rhs_definition,n=this._metaCache[e.type]=n||{},n[t]=r}return r}get(e,t){let n=this.identifiers.get(e)
n||(n=Object.create(null),this.identifiers.set(e,n))
let r=n[t]
if(!r){const i=this.getDefinition(e,t)
r="belongsTo"===i.kind?n[t]=function(e,t){return{definition:e,identifier:t,state:{hasReceivedData:!1,isEmpty:!0,isStale:!1,hasFailedLoadAttempt:!1,shouldForceReload:!1,hasDematerializedInverse:!1},transactionRef:0,localState:null,remoteState:null,meta:null,links:null,accessed:!1}}(i,e):"hasMany"===i.kind?n[t]=function(e,t){return{definition:e,identifier:t,state:{hasReceivedData:!1,isEmpty:!0,isStale:!1,hasFailedLoadAttempt:!1,shouldForceReload:!1,hasDematerializedInverse:!1},remoteMembers:new Set,remoteState:[],additions:null,removals:null,meta:null,links:null,localState:null,isDirty:!1,transactionRef:0,accessed:!1,_diff:void 0}}(i,e):n[t]=function(e,t){return{definition:e,identifier:t,localMembers:new Set,remoteMembers:new Set}}(i,e)}return r}getData(e,t){const n=this.get(e,t)
return p(n)?O(n,!1):R(n,!1)}getRemoteData(e,t){const n=this.get(e,t)
return p(n)?O(n,!0):R(n,!0)}registerPolymorphicType(e,t){const n=this._potentialPolymorphicTypes
let r=n[e]
r||(r=n[e]=Object.create(null)),r[t]=!0
let i=n[t]
i||(i=n[t]=Object.create(null)),i[e]=!0}isReleasable(e){const t=this.identifiers.get(e)
if(!t)return!0
const n=Object.keys(t)
for(let r=0;r<n.length;r++){const i=t[n[r]]
if(void 0!==i&&i.definition.inverseIsAsync&&!d(e))return!1}return!0}unload(e,t){const n=this.identifiers.get(e)
n&&Object.keys(n).forEach(e=>{const r=n[e]
r&&(function(e,t,n){if(h(t))return void(e.isReleasable(t.identifier)&&H(e,t))
const{identifier:r}=t,{inverseKey:i}=t.definition
t.definition.inverseIsImplicit||m(t,t=>function(e,t,n,r,i){if(!e.has(t,n))return
const o=e.get(t,n)
p(o)&&o.localState&&r!==o.localState||function(e,t,n,r){if(p(t)){const n=t.localState
!t.definition.isAsync||n&&d(n)?(t.localState===n&&null!==n&&(t.localState=null),t.remoteState===n&&null!==n&&(t.remoteState=null,t.state.hasReceivedData=!0,t.state.isEmpty=!0,t.localState&&!d(t.localState)&&(t.localState=null))):t.state.hasDematerializedInverse=!0,r||y(e,t)}else!t.definition.isAsync||n&&d(n)?g(e,t,n):t.state.hasDematerializedInverse=!0,r||y(e,t)}(e,o,r,i)}(e,t,i,r,n)),t.definition.inverseIsImplicit||t.definition.inverseIsAsync||(t.state.isStale=!0,G(t),t.definition.isAsync||n||y(e,t))}(this,r,t),h(r)&&(n[e]=void 0))})}_isDirty(e,t){const n=this.identifiers.get(e)
if(!n)return!1
const r=n[t]
if(!r)return!1
if(p(r))return r.localState!==r.remoteState
if(f(r)){const e=null!==r.additions&&r.additions.size>0,t=null!==r.removals&&r.removals.size>0
return e||t||q(r)}return!1}getChanged(e){const t=this.identifiers.get(e),n=new Map
if(!t)return n
const r=Object.keys(t)
for(let i=0;i<r.length;i++){const e=r[i],o=t[e]
if(o)if(p(o))o.localState!==o.remoteState&&n.set(e,{kind:"resource",remoteState:o.remoteState,localState:o.localState})
else if(f(o)){const t=null!==o.additions&&o.additions.size>0,r=null!==o.removals&&o.removals.size>0,i=q(o);(t||r||i)&&n.set(e,{kind:"collection",additions:new Set(o.additions),removals:new Set(o.removals),remoteState:o.remoteState,localState:R(o,!1).data||[],reordered:i})}}return n}hasChanged(e){const t=this.identifiers.get(e)
if(!t)return!1
const n=Object.keys(t)
for(let r=0;r<n.length;r++)if(this._isDirty(e,n[r]))return!0
return!1}rollback(e){const t=this.identifiers.get(e),n=[]
if(!t)return n
const r=Object.keys(t)
for(let i=0;i<r.length;i++){const o=r[i],a=t[o]
a&&this._isDirty(e,o)&&(M(this,e,o,a),n.push(o))}return n}remove(e){this._removing=e,this.unload(e),this.identifiers.delete(e),this._removing=null}push(e){if("deleteRecord"===e.op)this._pushedUpdates.deletions.push(e)
else{const t=this.getDefinition(e.record,e.field)
!function(e,t,n){const r=e[t.kind]=e[t.kind]||new Map
let i=r.get(t.inverseType)
i||(i=new Map,r.set(t.inverseType,i))
let o=i.get(n.field)
o||(o=[],i.set(n.field,o)),o.push(n)}(this._pushedUpdates,t,e)}if(!this._willSyncRemote){this._willSyncRemote=!0
const e=l(this.store)
e._cbs?e._schedule("coalesce",()=>this._flushRemoteQueue()):e._run(()=>this._flushRemoteQueue())}}update(e,t=!1){switch(e.op){case"mergeIdentifiers":{const t=this.identifiers.get(e.record)
t&&function(e,t,n){Object.keys(n).forEach(r=>{const i=n[r]
i&&function(e,t,n){n.identifier=t.value,m(n,r=>{const i=e.get(r,n.definition.inverseKey)
!function(e,t,n){p(t)?function(e,t,n){t.remoteState===n.record&&(t.remoteState=n.value),t.localState===n.record&&(t.localState=n.value,y(e,t))}(e,t,n):f(t)?function(e,t,n){if(t.remoteMembers.has(n.record)){t.remoteMembers.delete(n.record),t.remoteMembers.add(n.value)
const e=t.remoteState.indexOf(n.record)
t.remoteState.splice(e,1,n.value),t.isDirty=!0}t.additions?.has(n.record)&&(t.additions.delete(n.record),t.additions.add(n.value),t.isDirty=!0),t.removals?.has(n.record)&&(t.removals.delete(n.record),t.removals.add(n.value),t.isDirty=!0),t.isDirty&&y(e,t)}(e,t,n):function(e,t,n){t.remoteMembers.has(n.record)&&(t.remoteMembers.delete(n.record),t.remoteMembers.add(n.value)),t.localMembers.has(n.record)&&(t.localMembers.delete(n.record),t.localMembers.add(n.value))}(0,t,n)}(e,i,t)})}(e,t,i)})}(this,e,t)
break}case"update":case"updateRelationship":(function(e,t){const n=e.get(t.record,t.field),{definition:i,state:o,identifier:a}=n,{isCollection:s}=i,l=t.value
let c=!1,u=!1
if(l.meta&&(n.meta=l.meta),void 0!==l.data)if(c=!0,s){null===l.data&&(l.data=[])
const n=e.store.identifierCache
e.update({op:"replaceRelatedRecords",record:a,field:t.field,value:z(l.data,n)},!0)}else e.update({op:"replaceRelatedRecord",record:a,field:t.field,value:l.data?e.store.identifierCache.upgradeIdentifier(l.data):null},!0)
else!1!==i.isAsync||o.hasReceivedData||(c=!0,s?e.update({op:"replaceRelatedRecords",record:a,field:t.field,value:[]},!0):e.update({op:"replaceRelatedRecord",record:a,field:t.field,value:null},!0))
if(l.links){const e=n.links
if(n.links=l.links,l.links.related){const t=F(l.links.related),n=e&&e.related?F(e.related):null,s=n?n.href:null
t&&t.href&&t.href!==s&&((0,r.warn)(`You pushed a record of type '${a.type}' with a relationship '${i.key}' configured as 'async: false'. You've included a link but no primary data, this may be an error in your payload. WarpDrive will treat this relationship as known-to-be-empty.`,i.isAsync||o.hasReceivedData,{id:"ds.store.push-link-for-sync-relationship"}),u=!0)}}if(n.state.hasFailedLoadAttempt=!1,c){const e=null===l.data||Array.isArray(l.data)&&0===l.data.length
n.state.hasReceivedData=!0,n.state.isStale=!1,n.state.hasDematerializedInverse=!1,n.state.isEmpty=e}else u&&(s||!n.state.hasReceivedData||(d=n.transactionRef,p=e._transaction,0===d||null===p||d<p)?(n.state.isStale=!0,y(e,n)):n.state.isStale=!1)
var d,p})(this,e)
break
case"deleteRecord":{const t=e.record,n=this.identifiers.get(t)
n&&(Object.keys(n).forEach(e=>{const t=n[e]
t&&(n[e]=void 0,H(this,t))}),this.identifiers.delete(t))
break}case"replaceRelatedRecord":P(this,e,t)
break
case"add":(function(e,t,n){const{record:r,value:i,index:o}=t,a=e.get(r,t.field),s=p(a)
if(n&&s){if(i!==a.remoteState)P(e,{op:"replaceRelatedRecord",record:r,field:t.field,value:i},n)}else{if(a.isDirty||a.localState||(a.localState=[]),Array.isArray(i))for(let t=0;t<i.length;t++)L(e,a,r,i[t],void 0!==o?o+t:null,n)
else L(e,a,r,i,o??null,n)
y(e,a)}})(this,e,t)
break
case"remove":(function(e,t,n){const{record:r,value:i}=t,o=e.get(r,t.field),a=p(o)
if(n&&a){if(i===o.remoteState)P(e,{op:"replaceRelatedRecord",record:r,field:t.field,value:null},n)}else{if(Array.isArray(i))for(let a=0;a<i.length;a++)N(e,r,o,i[a],t.index,n)
else N(e,r,o,i,t.index,n)
y(e,o)}})(this,e,t)
break
case"replaceRelatedRecords":w(this,e,t)}}_scheduleLocalSync(e){this._updatedRelationships.add(e),this._willSyncLocal||(this._willSyncLocal=!0,l(this.store)._schedule("sync",()=>this._flushLocalQueue()))}_flushRemoteQueue(){if(!this._willSyncRemote)return
let e=(0,s.Yj)("transactionRef")??0
this._transaction=++e,(0,s.dV)("transactionRef",e),this._willSyncRemote=!1
const t=this._pushedUpdates,{deletions:n,hasMany:r,belongsTo:i}=t
t.deletions=[],t.hasMany=void 0,t.belongsTo=void 0
for(let o=0;o<n.length;o++)this.update(n[o],!0)
r&&U(this,r),i&&U(this,i),this._transaction=null}_addToTransaction(e){e.transactionRef=this._transaction}_flushLocalQueue(){if(!this._willSyncLocal)return
if(this.silenceNotifications)return this.silenceNotifications=!1,void(this._updatedRelationships=new Set)
this._willSyncLocal=!1
const e=this._updatedRelationships
this._updatedRelationships=new Set,e.forEach(e=>y(this,e))}destroy(){j.delete(this.store),this.identifiers.clear(),this.store=null,this.isDestroyed=!0}}function U(e,t){t.forEach(t=>{t.forEach(t=>{!function(e,t){for(let n=0;n<t.length;n++)e.update(t[n],!0)}(e,t)})})}function G(e){p(e)?(e.localState=null,e.remoteState=null,e.state.hasReceivedData=!1,e.state.isEmpty=!0):(e.remoteMembers.clear(),e.remoteState=[],e.additions=null,e.removals=null,e.localState=null)}function H(e,t){const{identifier:n}=t,{inverseKey:r}=t.definition
m(t,t=>{e.has(t,r)&&g(e,e.get(t,r),n)}),p(t)?(t.definition.isAsync||G(t),t.localState=null):f(t)?t.definition.isAsync||(G(t),y(e,t)):(t.remoteMembers.clear(),t.localMembers.clear())}function q(e){if(e.isDirty)return!1
const{remoteState:t,localState:n,additions:r,removals:i}=e
if(null===n)return!1
for(let o=0,a=0;o<t.length;o++){const e=t[o],s=n[a]
if(e!==s){if(i&&i.has(e))continue
if(r&&r.has(s)){a++,o--
continue}return!0}a++}return!1}function Q(e){return void 0!==e._instanceCache?e._instanceCache._storeWrapper:e}function $(e){return j.get(Q(e))}function X(e){return e instanceof Error}n(69549),n(88604),new Map
const W={iterator:()=>({next:()=>({done:!0,value:void 0})})}
class Y{constructor(e){this.version="2",this._capabilities=e,this.__cache=new Map,this.__graph=function(e){const t=Q(e)
let n=j.get(t)
return n||(n=new V(t),j.set(t,n),l(t)._graph=n),n}(e),this.__destroyedCache=new Map,this.__documents=new Map}put(e){if(X(e))return this._putDocument(e,void 0,void 0)
if(function(e){return!(e instanceof Error)&&e.content&&!("data"in e.content)&&!("included"in e.content)&&"meta"in e.content}(e))return this._putDocument(e,void 0,void 0)
const t=e.content,n=t.included
let r,i
const{identifierCache:o}=this._capabilities
if(n)for(r=0,i=n.length;r<i;r++)n[r]=ce(this,o,n[r])
if(Array.isArray(t.data)){i=t.data.length
const a=[]
for(r=0;r<i;r++)a.push(ce(this,o,t.data[r]))
return this._putDocument(e,a,n)}if(null===t.data)return this._putDocument(e,null,n)
const a=ce(this,o,t.data)
return this._putDocument(e,a,n)}_putDocument(e,t,n){const r=X(e)?function(e){const t={}
return e.content&&(de(t,e.content),"errors"in e.content?t.errors=e.content.errors:"object"==typeof e.error&&"errors"in e.error?t.errors=e.error.errors:t.errors=[{title:e.message}]),t}(e):function(e){const t={},n=e.content
return n&&de(t,n),t}(e)
void 0!==t&&(r.data=t),void 0!==n&&(r.included=n)
const i=e.request,o=i?this._capabilities.identifierCache.getOrCreateDocumentIdentifier(i):null
if(o){r.lid=o.lid,e.content=r
const t=this.__documents.has(o.lid)
this.__documents.set(o.lid,e),this._capabilities.notifyChange(o,t?"updated":"added",null)}if("findHasMany"===e.request?.op){const t=e.request.options?.identifier,n=e.request.options?.field
n&&t&&this.__graph.push({op:"updateRelationship",record:t,field:n.name,value:r})}return r}patch(e){Array.isArray(e)?(this._capabilities,this._capabilities._store._join(()=>{for(const t of e)he(this,t)})):he(this,e)}mutate(e){this.__graph.update(e,!1)}peek(e){if("type"in e){const t=this.__safePeek(e,!1)
if(!t)return null
const{type:n,id:r,lid:i}=e,o=Object.assign({},t.remoteAttrs,t.inflightAttrs,t.localAttrs),a={},s=this.__graph.identifiers.get(e)
s&&Object.keys(s).forEach(t=>{s[t].definition.isImplicit||(a[t]=this.__graph.getData(e,t))}),this._capabilities
const l=this._capabilities._store
return this._capabilities.schema.fields(e).forEach((t,n)=>{if("alias"===t.kind)return
if(n in o&&void 0!==o[n])return
const r=te(t,e,l)
void 0!==r&&(o[n]=r)}),{type:n,id:r,lid:i,attributes:o,relationships:a}}const t=this.peekRequest(e)
return t&&"content"in t?t.content:null}peekRemoteState(e){if("type"in e){const t=this.__safePeek(e,!1)
if(!t)return null
const{type:n,id:r,lid:i}=e,o=Object.assign({},t.remoteAttrs),a={},s=this.__graph.identifiers.get(e)
s&&Object.keys(s).forEach(t=>{s[t].definition.isImplicit||(a[t]=this.__graph.getData(e,t))}),this._capabilities
const l=this._capabilities._store
return this._capabilities.schema.fields(e).forEach((t,n)=>{if(n in o&&void 0!==o[n])return
const r=te(t,e,l)
void 0!==r&&(o[n]=r)}),{type:n,id:r,lid:i,attributes:o,relationships:a}}const t=this.peekRequest(e)
return t&&"content"in t?t.content:null}peekRequest(e){return this.__documents.get(e.lid)||null}upsert(e,t,n){this._capabilities
const r=this._capabilities._store
if(!r._cbs){let i
return r._run(()=>{i=pe(this,e,t,n)}),i}return pe(this,e,t,n)}fork(){throw new Error("Not Implemented")}merge(e){throw new Error("Not Implemented")}diff(){throw new Error("Not Implemented")}dump(){throw new Error("Not Implemented")}hydrate(e){throw new Error("Not Implemented")}clientDidCreate(e,t){this._createCache(e).isNew=!0
const n={}
if(void 0!==t){const r=this._capabilities.schema.fields(e),i=this.__graph,o=Object.keys(t)
for(let a=0;a<o.length;a++){const s=o[a],l=t[s]
if("id"===s)continue
const c=r.get(s)
let u
switch(void 0!==c?"kind"in c?c.kind:"attribute":null){case"attribute":this.setAttr(e,s,l),n[s]=l
break
case"belongsTo":this.mutate({op:"replaceRelatedRecord",field:s,record:e,value:l}),u=i.get(e,s),u.state.hasReceivedData=!0,u.state.isEmpty=!1
break
case"hasMany":this.mutate({op:"replaceRelatedRecords",field:s,record:e,value:l}),u=i.get(e,s),u.state.hasReceivedData=!0,u.state.isEmpty=!1
break
default:n[s]=l}}}return this._capabilities.notifyChange(e,"added",null),n}willCommit(e){const t=this.__peek(e,!1)
t.inflightAttrs?t.localAttrs&&Object.assign(t.inflightAttrs,t.localAttrs):t.inflightAttrs=t.localAttrs,t.localAttrs=null}didCommit(e,t){const n=t.content,r=t.request.op,i=n&&n.data,{identifierCache:o}=this._capabilities,a=e.id,s="deleteRecord"!==r&&i?o.updateRecordIdentifier(e,i):e,l=this.__peek(s,!1)
l.isDeleted&&(this.__graph.push({op:"deleteRecord",record:s,isNew:!1}),l.isDeletionCommitted=!0,this._capabilities.notifyChange(s,"removed",null))
const c=this._capabilities.schema.fields(s)
let u
l.isNew=!1,i&&(i.id&&!l.id&&(l.id=i.id),s===e&&s.id!==a&&this._capabilities.notifyChange(s,"identity",null),i.relationships&&ae(this.__graph,c,s,i),u=i.attributes)
const d=u&&re(l,u,c)
l.remoteAttrs=Object.assign(l.remoteAttrs||Object.create(null),l.inflightAttrs,u),l.inflightAttrs=null,le(l,d),l.errors&&(l.errors=null,this._capabilities.notifyChange(s,"errors",null)),d?.size&&ne(this._capabilities,s,d),this._capabilities.notifyChange(s,"state",null)
const p=n&&n.included
if(p)for(let h=0,f=p.length;h<f;h++)ce(this,o,p[h])
return{data:s}}commitWasRejected(e,t){const n=this.__peek(e,!1)
if(n.inflightAttrs){const e=Object.keys(n.inflightAttrs)
if(e.length>0){const t=n.localAttrs=n.localAttrs||Object.create(null)
for(let r=0;r<e.length;r++)void 0===t[e[r]]&&(t[e[r]]=n.inflightAttrs[e[r]])}n.inflightAttrs=null}t&&(n.errors=t),this._capabilities.notifyChange(e,"errors",null)}unloadRecord(e){const t=this._capabilities
if(!this.__cache.has(e))return void $(t)?.unload(e)
const n=!this.isDeletionCommitted(e)
let r=!1
const i=this.__peek(e,!1)
i.isNew||i.isDeletionCommitted?$(t)?.push({op:"deleteRecord",record:e,isNew:i.isNew}):$(t)?.unload(e),i.localAttrs=null,i.remoteAttrs=null,i.defaultAttrs=null,i.inflightAttrs=null
const o=function(e,t){const n=[],r=[],i=new Set
for(r.push(t);r.length>0;){const o=r.shift()
n.push(o),i.add(o)
const a=ue(e,t).iterator()
for(let e=a.next();!e.done;e=a.next()){const t=e.value
t&&!i.has(t)&&(i.add(t),r.push(t))}}return n}(t,e)
if(function(e,t){for(let n=0;n<t.length;++n){const r=t[n]
if(e.hasRecord(r))return!1}return!0}(t,o))for(let a=0;a<o.length;++a){const e=o[a]
t.notifyChange(e,"removed",null),r=!0,t.disconnectRecord(e)}this.__cache.delete(e),this.__destroyedCache.set(e,i),1===this.__destroyedCache.size&&setTimeout(()=>{this.__destroyedCache.clear()},100),!r&&n&&t.notifyChange(e,"removed",null)}getAttr(e,t){const n=!Array.isArray(t)||1===t.length
if(Array.isArray(t)&&1===t.length&&(t=t[0]),n){const n=t,r=this.__peek(e,!0)
if(!r)return
if(r.localAttrs&&n in r.localAttrs)return r.localAttrs[n]
if(r.inflightAttrs&&n in r.inflightAttrs)return r.inflightAttrs[n]
if(r.remoteAttrs&&n in r.remoteAttrs)return r.remoteAttrs[n]
if(r.defaultAttrs&&n in r.defaultAttrs)return r.defaultAttrs[n]
{const t=this._capabilities.schema.fields(e).get(n)
this._capabilities
const i=te(t,e,this._capabilities._store)
return J(t)&&(r.defaultAttrs=r.defaultAttrs||Object.create(null),r.defaultAttrs[n]=i),i}}const r=t,i=this.__peek(e,!0),o=r[0]
let a=i.localAttrs&&o in i.localAttrs?i.localAttrs[o]:void 0
if(void 0===a&&(a=i.inflightAttrs&&o in i.inflightAttrs?i.inflightAttrs[o]:void 0),void 0===a&&(a=i.remoteAttrs&&o in i.remoteAttrs?i.remoteAttrs[o]:void 0),void 0!==a){for(let e=1;e<r.length;e++)if(a=a[r[e]],void 0===a)return
return a}}getRemoteAttr(e,t){const n=!Array.isArray(t)||1===t.length
if(Array.isArray(t)&&1===t.length&&(t=t[0]),n){const n=t,r=this.__peek(e,!0)
if(!r)return
if(r.remoteAttrs&&n in r.remoteAttrs)return r.remoteAttrs[n]
if(r.defaultAttrs&&n in r.defaultAttrs)return r.defaultAttrs[n]
{const t=this._capabilities.schema.fields(e).get(n)
this._capabilities
const i=te(t,e,this._capabilities._store)
return J(t)&&(r.defaultAttrs=r.defaultAttrs||Object.create(null),r.defaultAttrs[n]=i),i}}const r=t,i=this.__peek(e,!0),o=r[0]
let a=i.remoteAttrs&&o in i.remoteAttrs?i.remoteAttrs[o]:void 0
if(void 0!==a){for(let e=1;e<r.length;e++)if(a=a[r[e]],void 0===a)return
return a}}setAttr(e,t,n){const r=!Array.isArray(t)||1===t.length
if(Array.isArray(t)&&1===t.length&&(t=t[0]),r){const r=this.__peek(e,!1),i=t,o=r.inflightAttrs&&i in r.inflightAttrs?r.inflightAttrs[i]:r.remoteAttrs&&i in r.remoteAttrs?r.remoteAttrs[i]:void 0
return o!==n?(r.localAttrs=r.localAttrs||Object.create(null),r.localAttrs[i]=n,r.changes=r.changes||Object.create(null),r.changes[i]=[o,n]):r.localAttrs&&(delete r.localAttrs[i],delete r.changes[i]),r.defaultAttrs&&i in r.defaultAttrs&&delete r.defaultAttrs[i],void this._capabilities.notifyChange(e,"attributes",i)}const i=t,o=this.__peek(e,!1),a=i[0],s=o.inflightAttrs&&a in o.inflightAttrs?o.inflightAttrs[a]:o.remoteAttrs&&a in o.remoteAttrs?o.remoteAttrs[a]:void 0
let l
if(s){l=s[i[1]]
for(let e=2;e<i.length;e++)l=l[i[e]]}if(l!==n){o.localAttrs=o.localAttrs||Object.create(null),o.localAttrs[a]=o.localAttrs[a]||structuredClone(s),o.changes=o.changes||Object.create(null)
let e=o.localAttrs[a],t=1
for(;t<i.length-1;)e=e[i[t++]]
e[i[t]]=n,o.changes[a]=[s,o.localAttrs[a]]}else if(o.localAttrs)try{if(!s)return
JSON.stringify(s)!==JSON.stringify(o.localAttrs[a])&&(delete o.localAttrs[a],delete o.changes[a])}catch{}this._capabilities.notifyChange(e,"attributes",a)}changedAttrs(e){const t=this.__peek(e,!1)
return t&&t.changes||Object.create(null)}hasChangedAttrs(e){const t=this.__peek(e,!0)
return!!t&&(null!==t.inflightAttrs&&Object.keys(t.inflightAttrs).length>0||null!==t.localAttrs&&Object.keys(t.localAttrs).length>0)}rollbackAttrs(e){const t=this.__peek(e,!1)
let n
return t.isDeleted=!1,null!==t.localAttrs&&(n=Object.keys(t.localAttrs),t.localAttrs=null,t.changes=null),t.isNew&&(t.isDeletionCommitted=!0,t.isDeleted=!0,t.isNew=!1),t.inflightAttrs=null,t.defaultAttrs=null,t.errors&&(t.errors=null,this._capabilities.notifyChange(e,"errors",null)),this._capabilities.notifyChange(e,"state",null),n&&n.length&&ne(this._capabilities,e,new Set(n)),n||[]}changedRelationships(e){return this.__graph.getChanged(e)}hasChangedRelationships(e){return this.__graph.hasChanged(e)}rollbackRelationships(e){let t
return this._capabilities,this._capabilities._store._join(()=>{t=this.__graph.rollback(e)}),t}getRelationship(e,t){return this.__graph.getData(e,t)}getRemoteRelationship(e,t){return this.__graph.getRemoteData(e,t)}setIsDeleted(e,t){this.__peek(e,!1).isDeleted=t,this._capabilities.notifyChange(e,"state",null)}getErrors(e){return this.__peek(e,!0).errors||[]}isEmpty(e){const t=this.__safePeek(e,!0)
return!t||null===t.remoteAttrs&&null===t.inflightAttrs&&null===t.localAttrs}isNew(e){return this.__safePeek(e,!0)?.isNew||!1}isDeleted(e){return this.__safePeek(e,!0)?.isDeleted||!1}isDeletionCommitted(e){return this.__safePeek(e,!0)?.isDeletionCommitted||!1}_createCache(e){const t={id:null,remoteAttrs:null,localAttrs:null,defaultAttrs:null,inflightAttrs:null,changes:null,errors:null,isNew:!1,isDeleted:!1,isDeletionCommitted:!1}
return this.__cache.set(e,t),t}__safePeek(e,t){let n=this.__cache.get(e)
return!n&&t&&(n=this.__destroyedCache.get(e)),n}__peek(e,t){return this.__safePeek(e,t)}}function Z(e){return p(e)?e.localState?[e.localState]:[]:e.additions?[...e.additions]:[]}function K(e){return p(e)?e.remoteState?[e.remoteState]:[]:e.remoteState}function J(e){return!!e&&ee(e.options)}function ee(e){return!!e&&"function"==typeof e.defaultValue}function te(e,t,n){const r=e?.options
if(e&&(r||e.type)&&("attribute"===e.kind||"field"===e.kind)){if(ee(r))return r.defaultValue()
if(r&&"defaultValue"in r)return r.defaultValue
if("attribute"!==e.kind&&e.type){const i=n.schema.transformation(e)
if(i?.defaultValue)return i.defaultValue(r||null,t)}}}function ne(e,t,n){if(n)for(const r of n)e.notifyChange(t,"attributes",r)
else e.notifyChange(t,"attributes",null)}function re(e,t,n){const r=new Set,i=Object.keys(t),o=i.length,a=e.localAttrs,s=Object.assign(Object.create(null),e.remoteAttrs,e.inflightAttrs)
for(let l=0;l<o;l++){const e=i[l]
if(!n.has(e))continue
const o=t[e]
a&&void 0!==a[e]||s[e]!==o&&r.add(e)}return r}function ie(e){return!e||null===e.remoteAttrs&&null===e.inflightAttrs&&null===e.localAttrs}function oe(e,t=!1){if(!e)return!1
const n=e.isNew,r=ie(e)
return n?!e.isDeleted:!(t&&e.isDeletionCommitted||r)}function ae(e,t,n,r){for(const i in r.relationships){const o=r.relationships[i],a=t.get(i)
o&&a&&se(a)&&e.push({op:"updateRelationship",record:n,field:i,value:o})}}function se(e){const{kind:t}=e
return"hasMany"===t||"belongsTo"===t||"resource"===t||"collection"===t}function le(e,t){const{localAttrs:n,remoteAttrs:r,inflightAttrs:i,defaultAttrs:o,changes:a}=e
if(!n)return e.changes=null,!1
let s=!1
const l=Object.keys(n)
for(let c=0,u=l.length;c<u;c++){const e=l[c];(i&&e in i?i[e]:r&&e in r?r[e]:void 0)===n[e]&&(s=!0,t?.delete(e),delete n[e],delete a[e]),o&&e in o&&delete o[e]}return s}function ce(e,t,n){let r=t.peekRecordIdentifier(n)
return r=r?t.updateRecordIdentifier(r,n):t.getOrCreateRecordIdentifier(n),e.upsert(r,n,e._capabilities.hasRecord(r)),r}function ue(e,t){const n=$(e),r=n?.identifiers.get(t)
if(!r)return W
const i=[]
Object.keys(r).forEach(e=>{const t=r[e]
t&&!t.definition.isImplicit&&i.push(t)})
let o=0,a=0,s=0
return{iterator:()=>({next:()=>{const e=(()=>{for(;o<i.length;){for(;a<2;){const e=0===a?Z(i[o]):K(i[o])
for(;s<e.length;){const t=e[s++]
if(null!==t)return t}s=0,a++}a=0,o++}})()
return{value:e,done:void 0===e}}})}}function de(e,t){"links"in t&&(e.links=t.links),"meta"in t&&(e.meta=t.meta)}function pe(e,t,n,r){let i
const o=e.__safePeek(t,!1),a=!!o,s=o||e._createCache(t),l=function(e,t,n){const r=t._store.getRequestStateService()
return!oe(e)&&r.getPendingRequestsForRecord(n).some(e=>"query"===e.type)}(o,e._capabilities,t)||!oe(o),c=!function(e){if(!e)return!0
const t=e.isNew,n=e.isDeleted,r=ie(e)
return(!t||n)&&r}(o)&&!l
s.isNew&&(s.isNew=!1,e._capabilities.notifyChange(t,"identity",null),e._capabilities.notifyChange(t,"state",null))
const u=e._capabilities.schema.fields(t)
return r&&a&&n.attributes&&(i=re(s,n.attributes,u)),s.remoteAttrs=Object.assign(s.remoteAttrs||Object.create(null),n.attributes),s.localAttrs&&le(s,i)&&e._capabilities.notifyChange(t,"state",null),c||e._capabilities.notifyChange(t,"added",null),n.id&&(s.id=n.id),n.relationships&&ae(e.__graph,u,t,n),i?.size&&ne(e._capabilities,t,i),i?.size?Array.from(i):void 0}function he(e,t){const n=(0,i.i)(t.record)
switch(!n&&(0,i.a)(t.record),t.op){case"mergeIdentifiers":{const n=e.__cache.get(t.record)
n&&(e.__cache.set(t.value,n),e.__cache.delete(t.record)),e.__graph.update(t,!0)
break}case"update":n&&("field"in t?se(e._capabilities.schema.fields(t.record).get(t.field))?e.__graph.push(t):e.upsert(t.record,{type:t.record.type,id:t.record.id,attributes:{[t.field]:t.value}},e._capabilities.hasRecord(t.record)):e.upsert(t.record,t.value,e._capabilities.hasRecord(t.record)))
break
case"add":n?"field"in t?e.__graph.push(t):e.upsert(t.record,t.value,e._capabilities.hasRecord(t.record)):function(e,t){const n=e.__documents.get(t.record.lid),{content:r}=n
if("data"===t.field){let n=!1
return Array.isArray(r.data)?Array.isArray(t.value)?void 0!==t.index?(n=!0,r.data.splice(t.index,0,...t.value)):(n=!0,r.data.push(...t.value)):void 0!==t.index?(n=!0,r.data.splice(t.index,0,t.value)):(n=!0,r.data.push(t.value)):(n=r.data!==t.value,n&&(r.data=t.value)),void(n&&e._capabilities.notifyChange(t.record,"updated",null))}r.included=r.included||[],Array.isArray(t.value)?r.included=r.included.concat(t.value):r.included.push(t.value)}(e,t)
break
case"remove":if(n)if("field"in t)e.__graph.push(t)
else{const n=e.__safePeek(t.record,!1)
n?(n.isDeleted=!0,n.isDeletionCommitted=!0,e.unloadRecord(t.record)):$(e._capabilities)?.push({op:"deleteRecord",record:t.record,isNew:!1})}else"field"in t&&function(e,t){const n=e.__documents.get(t.record.lid),{content:r}=n
if("data"===t.field){let n=!1
if(Array.isArray(r.data)){const e=Array.isArray(t.value)?t.value:[t.value]
for(let i=0;i<e.length;i++){const o=e[i]
if(void 0!==t.index){const e=t.index<r.data.length&&r.data[t.index]===o?t.index:r.data.indexOf(o);-1!==e&&(n=!0,r.data.splice(e,1))}else{const e=r.data.indexOf(o);-1!==e&&(n=!0,r.data.splice(e,1))}}}else n=r.data===t.value,n&&(r.data=null)
n&&e._capabilities.notifyChange(t.record,"updated",null)}else{r.included=r.included||[]
const e=Array.isArray(t.value)?t.value:[t.value]
for(const t of e){const e=r.included.indexOf(t);-1!==e&&r.included.splice(e,1)}}}(e,t)}}var fe=n(32294),me=n(69441),ge=n(39043)
class ye{constructor(e,t,n={}){this.__store=e,this._snapshots=null,this.modelName=t,this.adapterOptions=n.adapterOptions,this.include=n.include}get _recordArray(){return this.__store.peekAll(this.modelName)}get length(){return this._recordArray.length}snapshots(){if(null!==this._snapshots)return this._snapshots
this.__store
const{_fetchManager:e}=this.__store
return this._snapshots=this._recordArray[i.d].map(t=>e.createSnapshot(t)),this._snapshots}}function ve(e){}function be(e,t,n,r,i,o){return e?e.normalizeResponse(t,n,r,i,o):r}class xe{constructor(e,t,n){this._store=n,this.__attributes=null,this._belongsToRelationships=Object.create(null),this._belongsToIds=Object.create(null),this._hasManyRelationships=Object.create(null),this._hasManyIds=Object.create(null)
const r=!!n._instanceCache.peek(t)
if(this.modelName=t.type,this.identifier=t,r&&this._attributes,this.id=t.id,this.adapterOptions=e.adapterOptions,this.include=e.include,this.modelName=t.type,r){const e=this._store.cache
this._changedAttributes=e.changedAttrs(t)}}get record(){return this._store.peekRecord(this.identifier)}get _attributes(){if(null!==this.__attributes)return this.__attributes
const e=this.__attributes=Object.create(null),{identifier:t}=this,n=this._store.schema.fields(t),r=this._store.cache
return n.forEach((n,i)=>{"attribute"===n.kind&&(e[i]=r.getAttr(t,i))}),e}get isNew(){const e=this._store.cache
return e?.isNew(this.identifier)||!1}attr(e){if(e in this._attributes)return this._attributes[e]}attributes(){return{...this._attributes}}changedAttributes(){const e=Object.create(null)
if(!this._changedAttributes)return e
const t=Object.keys(this._changedAttributes)
for(let n=0,r=t.length;n<r;n++){const r=t[n]
e[r]=this._changedAttributes[r].slice()}return e}belongsTo(e,t){const n=!(!t||!t.id)
let r
const i=this._store
if(!0===n&&e in this._belongsToIds)return this._belongsToIds[e]
if(!1===n&&e in this._belongsToRelationships)return this._belongsToRelationships[e]
i.schema.fields({type:this.modelName}).get(e)
const{identifier:o}=this,a=this._store.cache.getRelationship(o,e),s=a&&a.data,l=s?i.identifierCache.getOrCreateRecordIdentifier(s):null
if(a&&void 0!==a.data){const e=i.cache
r=l&&!e.isDeleted(l)?n?l.id:i._fetchManager.createSnapshot(l):null}return n?this._belongsToIds[e]=r:this._belongsToRelationships[e]=r,r}hasMany(e,t){const n=!(!t||!t.ids)
let r
const i=this._hasManyIds[e],o=this._hasManyRelationships[e]
if(!0===n&&e in this._hasManyIds)return i
if(!1===n&&e in this._hasManyRelationships)return o
const a=this._store,{identifier:s}=(a.schema.fields({type:this.modelName}).get(e),this),l=this._store.cache.getRelationship(s,e)
return l.data&&(r=[],l.data.forEach(e=>{const t=a.identifierCache.getOrCreateRecordIdentifier(e)
a.cache.isDeleted(t)||(n?r.push(t.id):r.push(a._fetchManager.createSnapshot(t)))})),n?this._hasManyIds[e]=r:this._hasManyRelationships[e]=r,r}eachAttribute(e,t){this._store.schema.fields(this.identifier).forEach((n,r)=>{"attribute"===n.kind&&e.call(t,r,n)})}eachRelationship(e,t){this._store.schema.fields(this.identifier).forEach((n,r)=>{"belongsTo"!==n.kind&&"hasMany"!==n.kind||e.call(t,r,n)})}serialize(e){return this._store,this._store.serializerFor(this.modelName).serialize(this,e)}}const Se=(0,s.L1)("SaveOp",Symbol("SaveOp"))
class _e{constructor(e){this._store=e,this._pendingFetch=new Map,this.requestCache=e.getRequestStateService(),this.isDestroyed=!1}createSnapshot(e,t={}){return new xe(t,e,this._store)}scheduleSave(e,t){const n=(0,ge.c)(),r={data:[{op:"saveRecord",recordIdentifier:e,options:t}]},i={snapshot:this.createSnapshot(e,t),resolver:n,identifier:e,options:t,queryRequest:r},o=this.requestCache._enqueue(n.promise,i.queryRequest)
return function(e,t){const{snapshot:n,resolver:r,identifier:i,options:o}=t,a=e.adapterFor(i.type),s=o[Se],l=n.modelName,c=e.modelFor(l)
let u=Promise.resolve().then(()=>a[s](e,c,n))
const d=e.serializerFor(l)
u=u.then(t=>{if(t)return be(d,e,c,t,n.id,s)}),r.resolve(u)}(this._store,i),o}scheduleFetch(e,t,n){const r={data:[{op:"findRecord",recordIdentifier:e,options:t}]},i=this.getPendingFetch(e,t)
if(i)return i
const o=e.type,a=(0,ge.c)(),s={identifier:e,resolver:a,options:t,queryRequest:r},l=a.promise,c=this._store,u=!c._instanceCache.recordIsLoaded(e)
let d=this.requestCache._enqueue(l,s.queryRequest).then(n=>{n.data&&!Array.isArray(n.data)&&(n.data.lid=e.lid)
const r=c._push(n,t.reload)
return r&&!Array.isArray(r)?r:e},t=>{const n=c.cache
if(!n||n.isEmpty(e)||u){let t=!0
if(c._graph){const r=c._graph
n||(t=r.isReleasable(e),t||r.unload(e,!0))}(n||t)&&(c._enableAsyncFlush=!0,c._instanceCache.unloadRecord(e),c._enableAsyncFlush=null)}throw t})
0===this._pendingFetch.size&&new Promise(e=>setTimeout(e,0)).then(()=>{this.flushAllPendingFetches()})
const p=this._pendingFetch
let h=p.get(o)
h||(h=new Map,p.set(o,h))
let f=h.get(e)
return f||(f=[],h.set(e,f)),f.push(s),s.promise=d,d}getPendingFetch(e,t){const n=this._pendingFetch.get(e.type)?.get(e)
if(n){const e=n.find(e=>function(e={},t={}){return n=e.adapterOptions,r=t.adapterOptions,(!n||n===r||0===Object.keys(n).length)&&function(e,t){if(!e?.length)return!0
if(!t?.length)return!1
const n=(Array.isArray(e)?e:e.split(",")).sort(),r=(Array.isArray(t)?t:t.split(",")).sort()
if(n.join(",")===r.join(","))return!0
for(let i=0;i<n.length;i++)if(!r.includes(n[i]))return!1
return!0}(e.include,t.include)
var n,r}(t,e.options))
if(e)return e.promise}}flushAllPendingFetches(){if(this.isDestroyed)return
const e=this._store
this._pendingFetch.forEach((t,n)=>function(e,t,n){const r=e.adapterFor(n)
if(r.findMany&&r.coalesceFindRequests){const i=[]
t.forEach((e,n)=>{e.length>1||(t.delete(n),i.push(e[0]))})
const o=i.length
if(o>1){const t=new Array(o),a=new Map
for(let n=0;n<o;n++){const r=i[n]
t[n]=e._fetchManager.createSnapshot(r.identifier,r.options),a.set(t[n],r)}let s
s=r.groupRecordsForFindMany?r.groupRecordsForFindMany(e,t):[t]
for(let i=0,o=s.length;i<o;i++)Te(e,a,s[i],r,n)}else 1===o&&we(e,r,i[0])}t.forEach(t=>{t.forEach(t=>{we(e,r,t)})})}(e,t,n)),this._pendingFetch.clear()}fetchDataIfNeededForIdentifier(e,t={},n){const r=function(e,t){const n=e.cache
if(!n)return!0
const r=n.isNew(t),i=n.isDeleted(t),o=n.isEmpty(t)
return(!r||i)&&o}(this._store._instanceCache,e),i=function(e,t){const n=e.store.getRequestStateService()
return!e.recordIsLoaded(t)&&n.getPendingRequestsForRecord(t).some(e=>"query"===e.type)}(this._store._instanceCache,e)
let o
return r?(t.reload=!0,o=this.scheduleFetch(e,t,n)):o=i?this.getPendingFetch(e,t):Promise.resolve(e),o}destroy(){this.isDestroyed=!0}}function Ce(e,t,n){for(let r=0,i=t.length;r<i;r++){const i=t[r],o=e.get(i)
o&&o.resolver.reject(n||new Error(`Expected: '<${i.modelName}:${i.id}>' to be present in the adapter provided payload, but it was not found.`))}}function we(e,t,n){const o=n.identifier,a=o.type,s=e._fetchManager.createSnapshot(o,n.options),l=e.modelFor(o.type),c=o.id
let u=Promise.resolve().then(()=>t.findRecord(e,l,o.id,s))
u=u.then(t=>{const n=be(e.serializerFor(a),e,l,t,c,"findRecord")
return(0,r.warn)(`You requested a record of type '${a}' with id '${c}' but the adapter returned a payload with primary data having an id of '${n.data.id}'. Use 'store.findRecord()' when the requested id is the same as the one returned by the adapter. In other cases use 'store.queryRecord()' instead.`,(0,i.b)(n.data.id)===(0,i.b)(c),{id:"ds.store.findRecord.id-mismatch"}),n}),n.resolver.resolve(u)}function Te(e,t,n,i,o){n.length>1?function(e,t,n,r){const i=e.modelFor(n)
return Promise.resolve().then(()=>{const n=r.map(e=>e.id)
return t.findMany(e,i,n,r)}).then(t=>be(e.serializerFor(n),e,i,t,null,"findMany"))}(e,i,o,n).then(i=>{!function(e,t,n,i){const o=new Map
for(let r=0;r<n.length;r++){const e=n[r].id
let t=o.get(e)
t||(t=[],o.set(e,t)),t.push(n[r])}const a=Array.isArray(i.included)?i.included:[],s=i.data
for(let r=0,c=s.length;r<c;r++){const e=s[r],n=o.get(e.id)
o.delete(e.id),n?n.forEach(n=>{t.get(n).resolver.resolve({data:e})}):a.push(e)}if(a.length>0&&e._push({data:null,included:a},!0),0===o.size)return
const l=[]
o.forEach(e=>{l.push(...e)}),(0,r.warn)('Ember Data expected to find records with the following ids in the adapter response from findMany but they were missing: [ "'+[...o.values()].map(e=>e[0].id).join('", "')+'" ]',{id:"ds.store.missing-records-from-adapter"}),Ce(t,l)}(e,t,n,i)}).catch(e=>{Ce(t,n,e)}):1===n.length&&we(e,i,t.get(n[0]))}function Ae(e,t,n,r){const i=t.data?(o=t.data,a=(t,i)=>{const{id:o,type:a}=t
return function(e,t,n,r){const{id:i,type:o}=e
e.relationships||(e.relationships={})
const{relationships:a}=e,s=function(e,t,n,r){const{name:i}=n,{type:o}=t,a=function(e,t,n){const r=e.schema.fields(t).get(n)
return r?r.options.inverse:null}(e,{type:o},i)
if(a)return{inverseKey:a,kind:e.schema.fields({type:r}).get(a).kind}}(n,t,r,o)
if(s){const{inverseKey:e,kind:n}=s,r=a[e]?.data
"hasMany"===n&&void 0===r||(a[e]=a[e]||{},a[e].data=function(e,t,{id:n,type:r}){const i={id:n,type:r}
let o=null
if("hasMany"===t){const t=e||[]
e&&e.find(e=>e.type===i.type&&e.id===i.id)||t.push(i),o=t}else{const t=e||{}
Object.assign(t,i),o=t}return o}(r??null,n,t))}}(t,n,e,r),{id:o,type:a}},Array.isArray(o)?o.map(a):a(o)):null
var o,a
const s={}
"meta"in t&&(s.meta=t.meta),"links"in t&&(s.links=t.links),"data"in t&&(s.data=i)
const l={id:n.id,type:n.type,relationships:{[r.name]:s}}
return Array.isArray(t.included)||(t.included=[]),t.included.push(l),t}const Ie=new Set(["findRecord","findAll","query","queryRecord","findBelongsTo","findHasMany","updateRecord","createRecord","deleteRecord"]),Pe={request(e,t){if(e.request.url||!e.request.op||!Ie.has(e.request.op))return t(e.request)
const{store:n}=e.request
switch(n._fetchManager||(n._fetchManager=new _e(n)),e.request.op){case"findRecord":return function(e){const{store:t,data:n}=e.request,{record:r,options:i}=n
let o
if(t._instanceCache.recordIsLoaded(r))if(i.reload)o=t._fetchManager.scheduleFetch(r,i,e.request)
else{let n=null
const a=t.adapterFor(r.type)
void 0===i.reload&&a.shouldReloadRecord&&a.shouldReloadRecord(t,n=t._fetchManager.createSnapshot(r,i))?(i.reload=!0,o=t._fetchManager.scheduleFetch(r,i,e.request)):(!1===i.backgroundReload||!i.backgroundReload&&a.shouldBackgroundReloadRecord&&!a.shouldBackgroundReloadRecord(t,n=n||t._fetchManager.createSnapshot(r,i))||(i.backgroundReload=!0,t._fetchManager.scheduleFetch(r,i,e.request)),o=Promise.resolve(r))}else o=t._fetchManager.fetchDataIfNeededForIdentifier(r,i,e.request)
return o.then(e=>t.peekRecord(e))}(e)
case"findAll":return function(e){const{store:t,data:n}=e.request,{type:r,options:i}=n,o=t.adapterFor(r),a=t.recordArrayManager._live.get(r),s=new ye(t,r,i)
let l
return i.reload||!1!==i.reload&&(o.shouldReloadAll&&o.shouldReloadAll(t,s)||!o.shouldReloadAll&&0===s.length)?(a&&(a.isUpdating=!0),l=Ee(o,t,r,s,e.request,!0)):(l=Promise.resolve(t.peekAll(r)),(i.backgroundReload||!1!==i.backgroundReload&&(!o.shouldBackgroundReloadAll||o.shouldBackgroundReloadAll(t,s)))&&(a&&(a.isUpdating=!0),Ee(o,t,r,s,e.request,!1))),l}(e)
case"query":return function(e){const{store:t,data:n}=e.request
let{options:r}=n
const{type:i,query:o}=n,a=t.adapterFor(i),s=r._recordArray||t.recordArrayManager.getCollection({type:i,query:o})
delete r._recordArray
const l=t.modelFor(i)
return Promise.resolve().then(()=>a.query(t,l,o,s,r)).then(e=>{const n=be(t.serializerFor(i),t,l,e,null,"query"),r=t._push(n,!0)
return t.recordArrayManager.populateManagedArray(s,r,n),s})}(e)
case"queryRecord":return function(e){const{store:t,data:n}=e.request,{type:r,query:i,options:o}=n,a=t.adapterFor(r),s=t.modelFor(r)
return Promise.resolve().then(()=>a.queryRecord(t,s,i,o)).then(e=>{const n=be(t.serializerFor(r),t,s,e,null,"queryRecord"),i=t._push(n,!0)
return i?t.peekRecord(i):null})}(e)
case"findBelongsTo":return function(e){const{store:t,data:n,records:r}=e.request,{options:i,record:o,links:a,useLink:s,field:l}=n,c=r?.[0],u=c&&t._fetchManager.getPendingFetch(c,i)
if(u)return u
if(s)return function(e,t,n,r,i){return Promise.resolve().then(()=>{const o=e.adapterFor(t.type),a=e._fetchManager.createSnapshot(t,i),s=n&&"string"!=typeof n?n.href:n
return o.findBelongsTo(e,a,s,r)}).then(n=>{const i=e.modelFor(r.type)
let o=be(e.serializerFor(r.type),e,i,n,null,"findBelongsTo")
return o.data||o.links||o.meta?(o=Ae(e,o,t,r),e._push(o,!0)):null},null)}(t,o,a.related,l,i)
const d=t._fetchManager
return i.reload?d.scheduleFetch(c,i,e.request):d.fetchDataIfNeededForIdentifier(c,i,e.request)}(e)
case"findHasMany":return function(e){const{store:t,data:n,records:r}=e.request,{options:i,record:o,links:a,useLink:s,field:l}=n
if(s)return function(e,t,n,r,i,o){return Promise.resolve().then(()=>{const a=t._fetchManager.createSnapshot(n,o),s=r&&"string"!=typeof r?r.href:r
return e.findHasMany(t,a,s,i)}).then(e=>{const r=t.modelFor(i.type)
let o=be(t.serializerFor(i.type),t,r,e,null,"findHasMany")
return o=Ae(t,o,n,i),t._push(o,!0)},null)}(t.adapterFor(o.type),t,o,a.related,l,i)
const c=new Array(r.length),u=t._fetchManager
for(let d=0;d<r.length;d++){const t=r[d]
ve(),c[d]=i.reload?u.scheduleFetch(t,i,e.request):u.fetchDataIfNeededForIdentifier(t,i,e.request)}return Promise.all(c)}(e)
case"updateRecord":case"createRecord":case"deleteRecord":return function(e){const{store:t,data:n,op:r}=e.request,{options:i,record:o}=n
t.cache.willCommit(o,e)
const a=Object.assign({[Se]:r},i)
return t._fetchManager.scheduleSave(o,a).then(n=>{let i
return t._join(()=>{i=t.cache.didCommit(o,{request:e.request,content:n})}),t.lifetimes?.didRequest&&"createRecord"===r&&t.lifetimes.didRequest(e.request,{status:201},null,t),t.peekRecord(i.data)}).catch(e=>{let n=e
throw e?"string"==typeof e&&(n=new Error(e)):n=new Error("Unknown Error Occurred During Request"),function(e,t,n){if(n&&!0===n.isAdapterError&&"InvalidError"===n.code){const r=e.serializerFor(t.type)
if(r&&"function"==typeof r.extractErrors){const i=r.extractErrors(e,e.modelFor(t.type),n,t.id)
n.errors=function(e){const t=[]
return e&&Object.keys(e).forEach(n=>{const r=(i=e[n],Array.isArray(i)?i:[i])
var i
for(let e=0;e<r.length;e++){let i="Invalid Attribute",o=`/data/attributes/${n}`
n===Be&&(i="Invalid Document",o="/data"),t.push({title:i,detail:r[e],source:{pointer:o}})}}),t}(i)}}const r=e.cache
if(n.errors){let e=n.errors
0===e.length&&(e=[{title:"Invalid Error",detail:"",source:{pointer:"/data"}}]),r.commitWasRejected(t,e)}else r.commitWasRejected(t)}(t,o,n),n})}(e)
default:return t(e.request)}}},Be="base"
function Ee(e,t,n,r,i,o){const a=t.modelFor(n)
let s=Promise.resolve().then(()=>e.findAll(t,a,null,r))
return s=s.then(e=>{const i=be(t.serializerFor(n),t,a,e,null,"findAll")
return t._push(i,o),r._recordArray.isUpdating=!1,r._recordArray}),s}function ke(e,t){this._adapterCache=this._adapterCache||Object.create(null)
const n=(0,i.n)(e),{_adapterCache:r}=this
let o=r[n]
if(o)return o
const a=(0,fe.getOwner)(this)
return o=a.lookup(`adapter:${n}`),void 0!==o?(r[n]=o,o):(o=r.application||a.lookup("adapter:application"),void 0!==o?(r[n]=o,r.application=o,o):void 0)}function De(e){this._serializerCache=this._serializerCache||Object.create(null)
const t=(0,i.n)(e),{_serializerCache:n}=this
let r=n[t]
if(r)return r
const o=(0,fe.getOwner)(this)
return r=o.lookup(`serializer:${t}`),void 0!==r?(n[t]=r,r):(r=n.application||o.lookup("serializer:application"),void 0!==r?(n[t]=r,n.application=r,r):null)}function Me(e,t){const n=(0,i.n)(e),r=this.serializerFor(n),o=this.modelFor(n)
return r.normalize(o,t)}function Re(e,t){const n=t||e,r=t?(0,i.n)(e):"application"
this.serializerFor(r).pushPayload(this,n)}function Oe(e,t){return this._fetchManager||(this._fetchManager=new _e(this)),this._fetchManager.createSnapshot((0,me.o)(e)).serialize(t)}function Le(){for(const e in this._adapterCache){const t=this._adapterCache[e]
"function"==typeof t.destroy&&t.destroy()}for(const e in this._serializerCache){const t=this._serializerCache[e]
"function"==typeof t.destroy&&t.destroy()}}var Ne=n(4471),Fe=n.n(Ne)
const ze=(0,s.L1)("Store",Symbol("Store"));(0,s.L1)("$type",Symbol("$type")),(0,s.L1)("RequestSignature",Symbol("RequestSignature"))
var je=n(99280),Ve=n.n(je),Ue=n(17104),Ge=n.n(Ue)
const He=new WeakMap
function qe(e,t,n,r){let i={configurable:!0,enumerable:!0,writable:!0,initializer:null}
r&&(i.initializer=r)
for(let o of n)i=o(e,t,i)||i
void 0===i.initializer?Object.defineProperty(e,t,i):function(e,t,n){let r=He.get(e)
r||(r=new Map,He.set(e,r)),r.set(t,n)}(e,t,i)}function Qe(e,t,n){let r={...Object.getOwnPropertyDescriptor(e,t)}
for(let i of n)r=i(e,t,r)||r
void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(e):void 0,r.initializer=void 0),Object.defineProperty(e,t,r)}function $e(e,t){let n=function(e,t){var n
let r=e.prototype
for(;r;){let e=null==(n=He.get(r))?void 0:n.get(t)
if(e)return e
r=r.prototype}}(e.constructor,t)
n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(e):void 0})}var Xe,We,Ye,Ze=n(81389),Ke=n(88410),Je=n.n(Ke),et=n(63991)
function tt(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function nt(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e
var t=e[Symbol.toPrimitive]
if(void 0!==t){var n=t.call(e,"string")
if("object"!=typeof n)return n
throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e)
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const rt=Ge().extend(Ve()),it=Symbol.for("LegacyPromiseProxy"),ot=rt
class at extends ot{get id(){const{key:e,legacySupport:t}=this._belongsToState
return t.referenceFor("belongsTo",e).id()}get meta(){}async reload(e){const{key:t,legacySupport:n}=this._belongsToState
return await n.reloadBelongsTo(t,e),this}}Qe((Xe=at).prototype,"id",[i.v]),Qe(Xe.prototype,"meta",[(0,Ne.computed)()]),at.prototype[it]=!0
class st{constructor(e,t){this._update(e,t),this.isDestroyed=!1,this[it]=!0}get length(){return this["[]"],this.content?this.content.length:0}get"[]"(){return this.content?.length&&this.content}forEach(e){this.content&&this.length&&this.content.forEach(e)}reload(e){return this.content.reload(e),this}then(e,t){return this.promise.then(e,t)}catch(e){return this.promise.catch(e)}finally(e){return this.promise.finally(e)}destroy(){this.isDestroyed=!0,this.content=null,this.promise=null}get links(){return this.content?this.content.links:void 0}get meta(){return this.content?this.content.meta:void 0}_update(e,t){void 0!==t&&(this.content=t),this.promise=function(e,t){return e.isPending=!0,e.isSettled=!1,e.isFulfilled=!1,e.isRejected=!1,Promise.resolve(t).then(t=>(e.isPending=!1,e.isFulfilled=!0,e.isSettled=!0,e.content=t,t),t=>{throw e.isPending=!1,e.isFulfilled=!1,e.isRejected=!0,e.isSettled=!0,t})}(this,e)}static create({promise:e,content:t}){return new this(e,t)}}Qe((We=st).prototype,"length",[i.v]),Qe(We.prototype,"[]",[i.v]),Qe(We.prototype,"links",[i.v]),Qe(We.prototype,"meta",[i.v]),(0,i.y)(st.prototype,"content",null),(0,i.y)(st.prototype,"isPending",!1),(0,i.y)(st.prototype,"isRejected",!1),(0,i.y)(st.prototype,"isFulfilled",!1),(0,i.y)(st.prototype,"isSettled",!1)
class lt{constructor(e,t,n,r,i){nt(this,"___token",void 0),nt(this,"___identifier",void 0),nt(this,"___relatedTokenMap",void 0),this.graph=t,this.key=i,this.hasManyRelationship=r,this.type=r.definition.type,this.store=e,this.___identifier=n,this.___token=e.notifications.subscribe(n,(e,t,n)=>{"relationships"===t&&n===i&&this._ref++}),this.___relatedTokenMap=new Map}destroy(){this.store.notifications.unsubscribe(this.___token),this.___relatedTokenMap.forEach(e=>{this.store.notifications.unsubscribe(e)}),this.___relatedTokenMap.clear()}get identifiers(){ut(this),this._ref
const e=this._resource(),t=this.___relatedTokenMap
return this.___relatedTokenMap=new Map,e&&e.data?e.data.map(e=>{const n=this.store.identifierCache.getOrCreateRecordIdentifier(e)
let r=t.get(n)
return r?t.delete(n):r=this.store.notifications.subscribe(n,(e,t,n)=>{("identity"===t||"attributes"===t&&"id"===n)&&this._ref++}),this.___relatedTokenMap.set(n,r),n}):(t.forEach(e=>{this.store.notifications.unsubscribe(e)}),t.clear(),[])}_resource(){return this.store.cache.getRelationship(this.___identifier,this.key)}remoteType(){const e=this._resource()
return e&&e.links&&e.links.related?"link":"ids"}ids(){return this.identifiers.map(e=>e.id)}link(){const e=this._resource()
if(t=e,Boolean(t&&t.links&&t.links.related)&&e.links){const t=e.links.related
return t&&"string"!=typeof t?t.href:t}var t
return null}links(){const e=this._resource()
return e&&e.links?e.links:null}meta(){let e=null
const t=this._resource()
return t&&t.meta&&"object"==typeof t.meta&&(e=t.meta),e}async push(e,t){const{store:n}=this,r=Array.isArray(e)?{data:e}:e,i=Array.isArray(r.data)&&r.data.length>0&&ct(r.data[0]),o=Array.isArray(r.data)?i?n._push(r,!0):r.data.map(e=>n.identifierCache.getOrCreateRecordIdentifier(e)):[],{identifier:a}=this.hasManyRelationship,s={}
if(Array.isArray(r.data)&&(s.data=o),"links"in r&&(s.links=r.links),"meta"in r&&(s.meta=r.meta),n._join(()=>{this.graph.push({op:"updateRelationship",record:a,field:this.key,value:s})}),!t)return this.load()}_isLoaded(){if(!this.hasManyRelationship.state.hasReceivedData)return!1
const e=this.graph.getData(this.hasManyRelationship.identifier,this.key)
return!!e.data&&e.data.every(e=>!0===this.store._instanceCache.recordIsLoaded(e,!0))}value(){const e=ht.get(this.___identifier)
return ut(this)?e.getManyArray(this.key):(this._ref,null)}async load(e){const t=ht.get(this.___identifier)
return this.hasManyRelationship.definition.isAsync||vt(this.store,this._resource())?t.getHasMany(this.key,e):t.reloadHasMany(this.key,e)}reload(e){return ht.get(this.___identifier).reloadHasMany(this.key,e)}}function ct(e){return Object.keys(e).filter(e=>"id"!==e&&"type"!==e&&"lid"!==e).length>0}function ut(e){return!!e._isLoaded()||(e.graph.get(e.___identifier,e.key).accessed=!0,!1)}function dt(e){return Boolean(e&&e.links&&e.links.related)}Qe(lt.prototype,"identifiers",[i.v]),(0,i.z)(lt.prototype,"_ref",0)
class pt{constructor(e,t,n,r,i){this.graph=t,this.key=i,this.belongsToRelationship=r,this.type=r.definition.type,this.store=e,this.___identifier=n,this.___relatedToken=null,this.___token=e.notifications.subscribe(n,(e,t,n)=>{"relationships"===t&&n===i&&this._ref++})}destroy(){this.store.notifications.unsubscribe(this.___token),this.___token=null,this.___relatedToken&&(this.store.notifications.unsubscribe(this.___relatedToken),this.___relatedToken=null)}get identifier(){this.___relatedToken&&(this.store.notifications.unsubscribe(this.___relatedToken),this.___relatedToken=null)
const e=this._resource()
if(e&&e.data){const t=this.store.identifierCache.getOrCreateRecordIdentifier(e.data)
return this.___relatedToken=this.store.notifications.subscribe(t,(e,t,n)=>{("identity"===t||"attributes"===t&&"id"===n)&&this._ref++}),t}return null}id(){return this.identifier?.id||null}link(){const e=this._resource()
if(dt(e)&&e.links){const t=e.links.related
return t&&"string"!=typeof t?t.href:t}return null}links(){const e=this._resource()
return e&&e.links?e.links:null}meta(){let e=null
const t=this._resource()
return t&&t.meta&&"object"==typeof t.meta&&(e=t.meta),e}_resource(){return this._ref,this.store.cache.getRelationship(this.___identifier,this.key)}remoteType(){return dt(this._resource())?"link":"id"}async push(e,t){const{store:n}=this,r=e.data&&ct(e.data)?n._push(e,!0):e.data?n.identifierCache.getOrCreateRecordIdentifier(e.data):null,{identifier:i}=this.belongsToRelationship,o={}
if((e.data||null===e.data)&&(o.data=r),"links"in e&&(o.links=e.links),"meta"in e&&(o.meta=e.meta),n._join(()=>{this.graph.push({op:"updateRelationship",record:i,field:this.key,value:o})}),!t)return this.load()}value(){const e=this._resource()
return e&&e.data?this.store.peekRecord(e.data):null}async load(e){const t=ht.get(this.___identifier)
return this.belongsToRelationship.definition.isAsync||vt(this.store,this._resource())?t.getBelongsTo(this.key,e):t.reloadBelongsTo(this.key,e).then(()=>this.value())}reload(e){return ht.get(this.___identifier).reloadBelongsTo(this.key,e).then(()=>this.value())}}Qe(pt.prototype,"identifier",[i.v]),(0,i.z)(pt.prototype,"_ref",0)
const ht=(0,s.L1)("LEGACY_SUPPORT",new Map)
function ft(e){const t=(0,i.r)(e)
let n=ht.get(t)
return n||(n=new mt(e),ht.set(t,n),ht.set(e,n)),n}class mt{constructor(e){this.record=e,this.store=(0,i.s)(e),this.identifier=(0,i.r)(e),this.cache=(0,i.p)(e),this.store._graph&&(this.graph=this.store._graph),this._manyArrayCache=Object.create(null),this._relationshipPromisesCache=Object.create(null),this._relationshipProxyCache=Object.create(null),this._pending=Object.create(null),this.references=Object.create(null)}_syncArray(e){if(this.isDestroyed||this.isDestroying)return
const t=e[i.d],n=this.identifier,[r,o]=this._getCurrentState(n,e.key)
o.meta&&(e.meta=o.meta),o.links&&(e.links=o.links),t.length=0,(0,i.f)(t,r)}mutate(e){this.cache.mutate(e)}_findBelongsTo(e,t,n,r){return this._findBelongsToByJsonApiResource(t,this.identifier,n,r).then(t=>yt(this,e,n,t),t=>yt(this,e,n,null,t))}reloadBelongsTo(e,t){const n=this._relationshipPromisesCache[e]
if(n)return n
const r=this.graph.get(this.identifier,e),i=this.cache.getRelationship(this.identifier,e)
r.state.hasFailedLoadAttempt=!1,r.state.shouldForceReload=!0
const o=this._findBelongsTo(e,i,r,t)
return this._relationshipProxyCache[e]?this._updatePromiseProxyFor("belongsTo",e,{promise:o}):o}getBelongsTo(e,t){const{identifier:n,cache:r}=this,i=r.getRelationship(this.identifier,e),o=i&&i.data?i.data:null,a=this.store,s=this.graph.get(this.identifier,e),l=s.definition.isAsync,c={key:e,store:a,legacySupport:this,modelName:s.definition.type}
if(l){if(s.state.hasFailedLoadAttempt)return this._relationshipProxyCache[e]
const n=this._findBelongsTo(e,i,s,t),r=o&&a._instanceCache.recordIsLoaded(o)
return this._updatePromiseProxyFor("belongsTo",e,{promise:n,content:r?a._instanceCache.getRecord(o):null,_belongsToState:c})}return null===o?null:a._instanceCache.getRecord(o)}setDirtyBelongsTo(e,t){return this.cache.mutate({op:"replaceRelatedRecord",record:this.identifier,field:e,value:(n=t,n?(0,i.r)(n):null)},!0)
var n}_getCurrentState(e,t){const n=this.cache.getRelationship(e,t),r=this.store._instanceCache,i=[]
if(n.data)for(let o=0;o<n.data.length;o++){const e=n.data[o]
r.recordIsLoaded(e,!0)&&i.push(e)}return[i,n]}getManyArray(e,t){if(this.graph){let n=this._manyArrayCache[e]
if(t||(t=this.graph.get(this.identifier,e).definition),!n){const[r,o]=this._getCurrentState(this.identifier,e)
n=new i.l({store:this.store,type:t.type,identifier:this.identifier,cache:this.cache,field:this.store.schema.fields(this.identifier).get(e),identifiers:r,key:e,meta:o.meta||null,links:o.links||null,isPolymorphic:t.isPolymorphic,isAsync:t.isAsync,_inverseIsAsync:t.inverseIsAsync,manager:this,isLoaded:!t.isAsync,allowMutation:!0}),this._manyArrayCache[e]=n}return n}}fetchAsyncHasMany(e,t,n,r){if(this.graph){let i=this._relationshipPromisesCache[e]
if(i)return i
const o=this.cache.getRelationship(this.identifier,e),a=this._findHasManyByJsonApiResource(o,this.identifier,t,r)
return a?(i=a.then(()=>yt(this,e,t,n),r=>yt(this,e,t,n,r)),this._relationshipPromisesCache[e]=i,i):(n.isLoaded=!0,Promise.resolve(n))}}reloadHasMany(e,t){if(this.graph){const n=this._relationshipPromisesCache[e]
if(n)return n
const r=this.graph.get(this.identifier,e),{definition:i,state:o}=r
o.hasFailedLoadAttempt=!1,o.shouldForceReload=!0
const a=this.getManyArray(e,i),s=this.fetchAsyncHasMany(e,r,a,t)
return this._relationshipProxyCache[e]?this._updatePromiseProxyFor("hasMany",e,{promise:s}):s}}getHasMany(e,t){if(this.graph){const n=this.graph.get(this.identifier,e),{definition:r,state:i}=n,o=this.getManyArray(e,r)
if(r.isAsync){if(i.hasFailedLoadAttempt)return this._relationshipProxyCache[e]
const r=this.fetchAsyncHasMany(e,n,o,t)
return this._updatePromiseProxyFor("hasMany",e,{promise:r,content:o})}return o}}_updatePromiseProxyFor(e,t,n){let r=this._relationshipProxyCache[t]
if("hasMany"===e){const{promise:e,content:i}=n
return r?r._update(e,i):r=this._relationshipProxyCache[t]=new st(e,i),r}if(r){const{promise:e,content:t}=n
void 0!==t&&r.set("content",t),r.set("promise",e)}else r=at.create(n),this._relationshipProxyCache[t]=r
return r}referenceFor(e,t){let n=this.references[t]
if(!n){this.graph
const{graph:e,identifier:r}=this,i=e.get(r,t),o=i.definition.kind
"belongsTo"===o?n=new pt(this.store,e,r,i,t):"hasMany"===o&&(n=new lt(this.store,e,r,i,t)),this.references[t]=n}return n}_findHasManyByJsonApiResource(e,t,n,r={}){if(this.graph){if(!e)return
const{definition:i,state:a}=n
this.store
const s=this.store.adapterFor?.(i.type),{isStale:l,hasDematerializedInverse:c,hasReceivedData:u,isEmpty:d,shouldForceReload:p}=a,h=vt(this.store,e),f=e.data,m=e.links&&e.links.related&&("function"==typeof s?.findHasMany||void 0===f)&&(p||c||l||!h&&!d),g=this.store.schema.fields({type:i.inverseType}).get(i.key),y={useLink:m,field:g,links:e.links,meta:e.meta,options:r,record:t}
if(m){const t=g.options.linksMode?{url:gt(e),op:"findHasMany",method:"GET",records:f||[],data:y,[o._q]:!1}:{op:"findHasMany",records:f||[],data:y,cacheOptions:{[Symbol.for("wd:skip-cache")]:!0}}
return this.store.request(t)}const v=u&&!d,b=c||d&&Array.isArray(f)&&f.length>0,x=!p&&!l&&(v||b)
if(x&&h)return
return x||u&&!d||b?(r.reload=r.reload||!x||void 0,this.store.request({op:"findHasMany",records:f,data:y,cacheOptions:{[Symbol.for("wd:skip-cache")]:!0}})):void 0}}_findBelongsToByJsonApiResource(e,t,n,r={}){if(!e)return Promise.resolve(null)
const i=n.definition.key
if(this._pending[i])return this._pending[i]
const a=e.data?e.data:null,{isStale:s,hasDematerializedInverse:l,hasReceivedData:c,isEmpty:u,shouldForceReload:d}=n.state,p=vt(this.store,e),h=e.links?.related&&(d||l||s||!p&&!u),f=this.store.schema.fields(this.identifier).get(n.definition.key),m={useLink:h,field:f,links:e.links,meta:e.meta,options:r,record:t}
if(h){const t=f.options.linksMode?{url:gt(e),op:"findBelongsTo",method:"GET",records:a?[a]:[],data:m,[o._q]:!1}:{op:"findBelongsTo",records:a?[a]:[],data:m,cacheOptions:{[Symbol.for("wd:skip-cache")]:!0}},n=this.store.request(t)
return this._pending[i]=n.then(e=>f.options.linksMode?e.content.data:e.content).finally(()=>{this._pending[i]=void 0}),this._pending[i]}const g=c&&p&&!u,y=l||u&&e.data,v=!d&&!s&&(g||y)
return v&&!a?Promise.resolve(null):v&&p||null===a?.id?Promise.resolve(a):a?(r.reload=r.reload||!v||void 0,this._pending[i]=this.store.request({op:"findBelongsTo",records:[a],data:m,cacheOptions:{[Symbol.for("wd:skip-cache")]:!0}}).then(e=>e.content).finally(()=>{this._pending[i]=void 0}),this._pending[i]):Promise.resolve(null)}destroy(){this.isDestroying=!0
let e=this._manyArrayCache
this._manyArrayCache=Object.create(null),Object.keys(e).forEach(t=>{e[t].destroy()}),e=this._relationshipProxyCache,this._relationshipProxyCache=Object.create(null),Object.keys(e).forEach(t=>{const n=e[t]
n.destroy&&n.destroy()}),e=this.references,this.references=Object.create(null),Object.keys(e).forEach(t=>{e[t].destroy()}),this.isDestroyed=!0}}function gt(e){const t=e.links?.related
return"object"==typeof t?t.href:t}function yt(e,t,n,r,o){delete e._relationshipPromisesCache[t],n.state.shouldForceReload=!1
const s="hasMany"===n.definition.kind
if(s&&(0,i.F)(r[a.A]),o){n.state.hasFailedLoadAttempt=!0
const r=e._relationshipProxyCache[t]
throw r&&!s&&(r.content&&r.content.isDestroying&&r.set("content",null),e.store.notifications._flush()),o}return s?r.isLoaded=!0:e.store.notifications._flush(),n.state.hasFailedLoadAttempt=!1,n.state.isStale=!1,s||!r?r:e.store.peekRecord(r)}function vt(e,t){const n=e._instanceCache,r=t.data
return Array.isArray(r)?r.every(e=>n.recordIsLoaded(e)):!r||n.recordIsLoaded(r)}const bt=Je()
var xt=new WeakMap,St=new WeakMap
class _t extends bt{constructor(...e){super(...e),tt(this,xt,void $e(this,"messages")),tt(this,St,void $e(this,"isEmpty"))}get errorsByAttributeName(){return new Map}errorsFor(e){const t=this.errorsByAttributeName
let n=t.get(e)
return void 0===n&&(n=(0,Ze.A)(),t.set(e,n)),(0,Ne.get)(n,"[]"),n}get content(){return(0,Ze.A)()}unknownProperty(e){const t=this.errorsFor(e)
if(0!==t.length)return t}add(e,t){const n=this._findOrCreateMessages(e,t)
this.addObjects(n),this.errorsFor(e).addObjects(n),this.__record.currentState.notify("isValid"),this.notifyPropertyChange(e)}_findOrCreateMessages(e,t){const n=this.errorsFor(e),r=Array.isArray(t)?t:[t],i=new Array(r.length)
for(let o=0;o<r.length;o++){const t=r[o],a=n.findBy("message",t)
i[o]=a||{attribute:e,message:t}}return i}remove(e){if(this.isEmpty)return
const t=this.rejectBy("attribute",e)
this.content.setObjects(t)
const n=this.errorsFor(e)
for(let r=0;r<n.length;r++)n[r].attribute===e&&n.replace(r,1)
this.errorsByAttributeName.delete(e),this.__record.currentState.notify("isValid"),this.notifyPropertyChange(e),this.notifyPropertyChange("length")}clear(){if(this.isEmpty)return
const e=this.errorsByAttributeName,t=[]
e.forEach(function(e,n){t.push(n)}),e.clear(),t.forEach(e=>{this.notifyPropertyChange(e)}),this.__record.currentState.notify("isValid"),super.clear()}has(e){return this.errorsFor(e).length>0}}Qe((Ye=_t).prototype,"errorsByAttributeName",[(0,Ne.computed)()]),qe(Ye.prototype,"messages",[(0,et.mapBy)("content","message")]),Qe(Ye.prototype,"content",[(0,Ne.computed)()]),qe(Ye.prototype,"isEmpty",[(0,et.not)("length")])
var Ct,wt,Tt=n(24666),At=n(43227)
function It(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e
var t=e[Symbol.toPrimitive]
if(void 0!==t){var n=t.call(e,"string")
if("object"!=typeof n)return n
throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e)
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Pt(e){{const t=(0,At._k)(e)
return(0,r.deprecate)(`The resource type '${e}' is not normalized. Update your application code to use '${t}' instead of '${e}'.`,t===e,{id:"ember-data:deprecate-non-strict-types",until:"6.0",for:"ember-data",since:{available:"4.13",enabled:"5.3"}}),t}}function Bt(e,t,n,r){if("belongsTo"===r.kind)n.notifyPropertyChange(t)
else if("hasMany"===r.kind){const o=ht.get(e),s=o&&o._manyArrayCache[t],l=o&&o._relationshipPromisesCache[t]
if(s&&l)return
s&&((0,i.F)(s[a.A]),r.options.async&&n.notifyPropertyChange(t))}}function Et(e,t,n,r){(0,Tt.cacheFor)(r,n)!==e.cache.getAttr(t,n)&&r.notifyPropertyChange(n)}const kt=/^\/?data\/(attributes|relationships)\/(.*)/,Dt=/^\/?data/
function Mt(e){return!!e&&e instanceof Error&&"isAdapterError"in e&&!0===e.isAdapterError&&"code"in e&&"InvalidError"===e.code}class Rt{constructor(e){const t=(0,me.fV)(e),n=(0,i.r)(e)
this.identifier=n,this.record=e,this.cache=t.cache,this.pendingCount=0,this.fulfilledCount=0,this.rejectedCount=0,this._errorRequests=[],this._lastError=null
const r=t.getRequestStateService(),o=t.notifications,a=e=>{if("mutation"===e.type)switch(e.state){case"pending":this.isSaving=!0
break
case"rejected":this.isSaving=!1,this._lastError=e,e.response&&Mt(e.response.data)||this._errorRequests.push(e),Ot(this)
break
case"fulfilled":this._errorRequests=[],this._lastError=null,this.isSaving=!1,this.notify("isDirty"),Ot(this)}else switch(e.state){case"pending":this.pendingCount++,this.notify("isLoading")
break
case"rejected":this.pendingCount--,this._lastError=e,e.response&&Mt(e.response.data)||this._errorRequests.push(e),this.notify("isLoading"),Ot(this)
break
case"fulfilled":this.pendingCount--,this.fulfilledCount++,this.notify("isLoading"),this.notify("isDirty"),Ot(this),this._errorRequests=[],this._lastError=null}}
r.subscribeForRecord(n,a)
const s=r.getLastRequestForRecord(n)
s&&a(s),this.handler=o.subscribe(n,(e,t,n)=>{switch(t){case"state":this.notify("isSaved"),this.notify("isNew"),this.notify("isDeleted"),this.notify("isDirty")
break
case"attributes":this.notify("isEmpty"),this.notify("isDirty")
break
case"errors":this.updateInvalidErrors(this.record.errors),this.notify("isValid")}})}destroy(){(0,me.fV)(this.record).notifications.unsubscribe(this.handler)}notify(e){const t=(0,i.E)(this),n=(0,i.B)(t,e)
n&&(0,i.F)(n)}updateInvalidErrors(e){const t=this.cache.getErrors(this.identifier)
e.clear()
for(let n=0;n<t.length;n++){const r=t[n]
if(r.source&&r.source.pointer){const t=r.source.pointer.match(kt)
let n
if(t?n=t[2]:-1!==r.source.pointer.search(Dt)&&(n="base"),n){const t=r.detail||r.title
e.add(n,t)}}}}cleanErrorRequests(){this.notify("isValid"),this.notify("isError"),this.notify("adapterError"),this._errorRequests=[],this._lastError=null}get isLoading(){return!this.isLoaded&&this.pendingCount>0&&0===this.fulfilledCount}get isLoaded(){return!!this.isNew||this.fulfilledCount>0||!this.isEmpty}get isSaved(){const e=this.cache
return this.isDeleted?e.isDeletionCommitted(this.identifier):!(this.isNew||this.isEmpty||!this.isValid||this.isDirty||this.isLoading)}get isEmpty(){const e=this.cache
return!this.isNew&&e.isEmpty(this.identifier)}get isNew(){return this.cache.isNew(this.identifier)}get isDeleted(){return this.cache.isDeleted(this.identifier)}get isValid(){return 0===this.record.errors.length}get isDirty(){const e=this.cache
return!(this.isEmpty||e.isDeletionCommitted(this.identifier)||this.isDeleted&&this.isNew)&&(this.isDeleted||this.isNew||e.hasChangedAttrs(this.identifier))}get isError(){return!!this._errorRequests[this._errorRequests.length-1]}get adapterError(){const e=this._lastError
return e?"rejected"===e.state&&e.response.data:null}get isPreloaded(){return!this.isEmpty&&this.isLoading}get stateName(){return this.isLoading?"root.loading":this.isEmpty?"root.empty":this.isDeleted?this.isSaving?"root.deleted.inFlight":this.isSaved?"root.deleted.saved":this.isValid?"root.deleted.uncommitted":"root.deleted.invalid":this.isNew?this.isSaving?"root.loaded.created.inFlight":this.isValid?"root.loaded.created.uncommitted":"root.loaded.created.invalid":this.isSaving?"root.loaded.updated.inFlight":this.isValid?this.isDirty?"root.loaded.updated.uncommitted":"root.loaded.saved":"root.loaded.updated.invalid"}get dirtyType(){return this.isLoading||this.isEmpty?"":this.isDirty&&this.isDeleted?"deleted":this.isNew?"created":this.isSaving||!this.isValid||this.isDirty?"updated":""}}function Ot(e){e.notify("isValid"),e.notify("isError"),e.notify("adapterError")}function Lt(e,t,n){const r=new WeakMap,i=n.get
return n.get=function(){let e=r.get(this)
return e||(e={hasComputed:!1,value:void 0},r.set(this,e)),e.hasComputed||(e.value=i.call(this),e.hasComputed=!0),e.value},n}Qe((Ct=Rt).prototype,"isLoading",[i.w]),Qe(Ct.prototype,"isLoaded",[i.w]),Qe(Ct.prototype,"isSaved",[i.w]),Qe(Ct.prototype,"isEmpty",[i.w]),Qe(Ct.prototype,"isNew",[i.w]),Qe(Ct.prototype,"isDeleted",[i.w]),Qe(Ct.prototype,"isValid",[i.w]),Qe(Ct.prototype,"isDirty",[i.w]),Qe(Ct.prototype,"isError",[i.w]),Qe(Ct.prototype,"adapterError",[i.w]),Qe(Ct.prototype,"isPreloaded",[i.v]),Qe(Ct.prototype,"stateName",[i.v]),Qe(Ct.prototype,"dirtyType",[i.v]),(0,i.y)(Rt.prototype,"isSaving",!1)
class Nt extends(Fe()){init(e){const t=e._createProps,n=e._secretInit
e._createProps=null,e._secretInit=null
const r=this.store=n.store
super.init(e),this[ze]=r
const o=n.identifier
n.cb(this,n.cache,o,n.store),this.___recordState=null,this.setProperties(t)
const a=r.notifications
this.___private_notifications=a.subscribe(o,(e,t,n)=>{!function(e,t,n,r,o){switch(t){case"added":case"attributes":n?Et(o,e,n,r):r.eachAttribute(t=>{Et(o,e,t,r)})
break
case"relationships":if(n){const t=r.constructor.relationshipsByName.get(n)
Bt(e,n,r,t)}else r.eachRelationship((t,n)=>{Bt(e,t,r,n)})
break
case"identity":(0,i.F)((0,i.B)((0,i.E)(r),"id"))}}(e,t,n,this,r)})}destroy(){const e=(0,me.o)(this)
this.___recordState?.destroy(),(0,me.fV)(this).notifications.unsubscribe(this.___private_notifications),ht.get(this)?.destroy(),ht.delete(this),ht.delete(e),super.destroy()}get isEmpty(){return this.currentState.isEmpty}get isLoading(){return this.currentState.isLoading}get isLoaded(){return this.currentState.isLoaded}get hasDirtyAttributes(){return this.currentState.isDirty}get isSaving(){return this.currentState.isSaving}get isDeleted(){return this.currentState.isDeleted}get isNew(){return this.currentState.isNew}get isValid(){return this.currentState.isValid}get dirtyType(){return this.currentState.dirtyType}get isError(){return this.currentState.isError}set isError(e){}get id(){return(0,me.o)(this).id}set id(e){const t=(0,i.b)(e),n=(0,me.o)(this),r=t!==n.id
null!==t&&r&&(this.store._instanceCache.setRecordId(n,t),this.store.notifications.notify(n,"identity"))}toString(){return`<model::${this.constructor.modelName}:${this.id}>`}get currentState(){return this.___recordState||(this.___recordState=new Rt(this)),this.___recordState}set currentState(e){throw new Error("cannot set currentState")}get errors(){const e=_t.create({__record:this})
return this.currentState.updateInvalidErrors(e),e}get adapterError(){return this.currentState.adapterError}set adapterError(e){throw new Error("adapterError is not directly settable")}notifyPropertyChange(e){const t=(0,i.E)(this);(0,i.x)(t,this,e,void 0),super.notifyPropertyChange(e)}attr(){}eachRelationship(e,t){this.constructor.eachRelationship(e,t)}relationshipFor(e){return this.constructor.relationshipsByName.get(e)}inverseFor(e){return this.constructor.inverseFor(e,(0,me.fV)(this))}eachAttribute(e,t){this.constructor.eachAttribute(e,t)}static typeForRelationship(e,t){const n=this.relationshipsByName.get(e)
return n&&t.modelFor(n.type)}static get inverseMap(){return Object.create(null)}static inverseFor(e,t){const n=this.inverseMap
if(n[e])return n[e]
{const r=this._findInverseFor(e,t)
return n[e]=r,r}}static _findInverseFor(e,t){const n=this.relationshipsByName.get(e)
if(!n)return null
const{options:r}=n
return null===r.inverse?null:t.schema.hasResource(n)&&t.schema.fields(n).get(r.inverse)||null}static get relationships(){const e=new Map
return this.relationshipsByName.forEach(t=>{const{type:n}=t
e.has(n)||e.set(n,[]),e.get(n).push(t)}),e}static get relationshipNames(){const e={hasMany:[],belongsTo:[]}
return this.eachComputedProperty((t,n)=>{Ft(n)&&e[n.kind].push(t)}),e}static get relatedTypes(){const e=[],t=this.relationshipsObject,n=Object.keys(t)
for(let r=0;r<n.length;r++){const i=t[n[r]].type
e.includes(i)||e.push(i)}return e}static get relationshipsByName(){const e=new Map,t=this.relationshipsObject,n=Object.keys(t)
for(let r=0;r<n.length;r++){const i=t[n[r]]
e.set(i.name,i)}return e}static get relationshipsObject(){const e=Object.create(null)
return this.modelName,this.eachComputedProperty((t,n)=>{Ft(n)&&(n.key=t,n.name=t,e[t]=n)}),e}static get fields(){const e=new Map
return this.eachComputedProperty((t,n)=>{Ft(n)?e.set(t,n.kind):zt(n)&&e.set(t,"attribute")}),e}static eachRelationship(e,t){this.relationshipsByName.forEach((n,r)=>{e.call(t,r,n)})}static eachRelatedType(e,t){const n=this.relatedTypes
for(let r=0;r<n.length;r++){const i=n[r]
e.call(t,i)}}static determineRelationshipType(e,t){const n=e.name,r=e.kind,i=this.inverseFor(n,t)
return i?"belongsTo"===i.kind?"belongsTo"===r?"oneToOne":"manyToOne":"belongsTo"===r?"oneToMany":"manyToMany":"belongsTo"===r?"oneToNone":"manyToNone"}static get attributes(){const e=new Map
return this.eachComputedProperty((t,n)=>{zt(n)&&(n.key=t,n.name=t,e.set(t,n))}),e}static get transformedAttributes(){const e=new Map
return this.eachAttribute((t,n)=>{n.type&&e.set(t,n.type)}),e}static eachAttribute(e,t){this.attributes.forEach((n,r)=>{e.call(t,r,n)})}static eachTransformedAttribute(e,t){this.transformedAttributes.forEach((n,r)=>{e.call(t,r,n)})}static toString(){return`model:${this.modelName}`}}function Ft(e){return"object"==typeof e&&null!==e&&"kind"in e&&"options"in e&&("hasMany"===e.kind||"belongsTo"===e.kind)}function zt(e){return"object"==typeof e&&null!==e&&"kind"in e&&"attribute"===e.kind}Qe((wt=Nt).prototype,"isEmpty",[i.v]),Qe(wt.prototype,"isLoading",[i.v]),Qe(wt.prototype,"isLoaded",[i.v]),Qe(wt.prototype,"hasDirtyAttributes",[i.v]),Qe(wt.prototype,"isSaving",[i.v]),Qe(wt.prototype,"isDeleted",[i.v]),Qe(wt.prototype,"isNew",[i.v]),Qe(wt.prototype,"isValid",[i.v]),Qe(wt.prototype,"dirtyType",[i.v]),Qe(wt.prototype,"isError",[i.v]),Qe(wt.prototype,"id",[i.w]),Qe(wt.prototype,"currentState",[i.w]),Qe(wt.prototype,"errors",[Lt]),Qe(wt.prototype,"adapterError",[i.v]),It(Nt,"isModel",!0),It(Nt,"modelName",null),Qe(wt,"inverseMap",[Lt]),Qe(wt,"relationships",[Lt]),Qe(wt,"relationshipNames",[Lt]),Qe(wt,"relatedTypes",[Lt]),Qe(wt,"relationshipsByName",[Lt]),Qe(wt,"relationshipsObject",[Lt]),Qe(wt,"fields",[Lt]),Qe(wt,"attributes",[Lt]),Qe(wt,"transformedAttributes",[Lt]),Nt.prototype.save=function(e){let t
return this.currentState.isNew&&this.currentState.isDeleted?t=Promise.resolve(this):(this.errors.clear(),t=this[ze].saveRecord(this,e)),t},Nt.prototype.destroyRecord=function(e){const{isNew:t}=this.currentState
return this.deleteRecord(),t?Promise.resolve(this):this.save(e).then(e=>(this.unloadRecord(),this))},Nt.prototype.unloadRecord=function(){this.currentState.isNew&&(this.isDestroyed||this.isDestroying)||this[ze].unloadRecord(this)},Nt.prototype.hasMany=function(e){return ft(this).referenceFor("hasMany",e)},Nt.prototype.belongsTo=function(e){return ft(this).referenceFor("belongsTo",e)},Nt.prototype.serialize=function(e){return this[ze],this[ze].serializeRecord(this,e)},Nt.prototype._createSnapshot=function(){const e=this[ze]
return e._fetchManager||(e._fetchManager=new _e(e)),e._fetchManager.createSnapshot((0,me.o)(this))},Nt.prototype.deleteRecord=function(){this.currentState&&this[ze].deleteRecord(this)},Nt.prototype.changedAttributes=function(){return(0,i.p)(this).changedAttrs((0,me.o)(this))},Nt.prototype.rollbackAttributes=function(){const{currentState:e}=this,{isNew:t}=e
this[ze]._join(()=>{(0,i.p)(this).rollbackAttrs((0,me.o)(this)),this.errors.clear(),e.cleanErrorRequests(),t&&this.unloadRecord()})},Nt.prototype.reload=function(e={}){e.isReloading=!0,e.reload=!0
const t=(0,me.o)(this)
return this.isReloading=!0,this[ze].request({op:"findRecord",data:{options:e,record:t},cacheOptions:{[Symbol.for("wd:skip-cache")]:!0}}).then(()=>this).finally(()=>{this.isReloading=!1})},(0,i.y)(Nt.prototype,"isReloading",!1),Nt.prototype._createProps=null,Nt.prototype._secretInit=null
class jt{constructor(e){this.store=e,this._schemas=new Map,this._typeMisses=new Set}resourceTypes(){return Array.from(this._schemas.keys())}hasTrait(e){return!1}resourceHasTrait(e,t){return!1}transformation(e){}derivation(e){}hashFn(e){}resource(e){const t=Pt(e.type)
return this._schemas.has(t)||this._loadModelSchema(t),this._schemas.get(t).schema}registerResources(e){}registerResource(e){}registerTransformation(e){}registerDerivation(e){}registerHashFn(e){}_loadModelSchema(e){const t=this.store.modelFor(e),n=t.attributes,r=Object.create(null)
n.forEach((e,t)=>r[t]=e)
const i=t.relationshipsObject||null,o=new Map
for(const s of Object.values(r))o.set(s.name,s)
for(const s of Object.values(i))o.set(s.name,s)
const a={schema:{legacy:!0,identity:{name:"id",kind:"@id"},type:e,fields:Array.from(o.values())},attributes:r,relationships:i,fields:o}
return this._schemas.set(e,a),a}fields(e){const t=Pt(e.type)
return this._schemas.has(t)||this._loadModelSchema(t),this._schemas.get(t).fields}hasResource(e){const t=Pt(e.type)
return!!this._schemas.has(t)||!this._typeMisses.has(t)&&!(null===Vt(this.store,t)&&(this._typeMisses.add(t),1))}}function Vt(e,t){e._modelFactoryCache||(e._modelFactoryCache=Object.create(null))
const n=e._modelFactoryCache
let r=n[t]
if(!r){if(r=(0,fe.getOwner)(e).factoryFor(`model:${t}`),r||(r=function(e,t){const n=(0,fe.getOwner)(e),r=n.factoryFor(`mixin:${t}`),i=r&&r.class
if(i){const e=Nt.extend(i)
e.__isMixin=!0,e.__mixin=i,n.register(`model:${t}`,e)}return n.factoryFor(`model:${t}`)}(e,t)),!r)return null
const i=r.class
i.isModel&&(i.modelName&&Object.prototype.hasOwnProperty.call(i,"modelName")||Object.defineProperty(i,"modelName",{value:t})),n[t]=r}return r}function Ut(e,t){const n=e.type,r={_createProps:t,_secretInit:{identifier:e,cache:this.cache,store:this,cb:qt}}
return(0,fe.setOwner)(r,(0,fe.getOwner)(this)),Vt(this,n).class.create(r)}function Gt(e){e.destroy()}function Ht(e){const t=Vt(this,Pt(e)),n=t&&t.class?t.class:null
if(n&&n.isModel&&!this._forceShim)return n}function qt(e,t,n,r){(0,i.h)(e,n),i.j.set(e,r),(0,i.k)(e,t)}jt.prototype.doesTypeExist=function(e){return(0,r.deprecate)("Use `schema.hasResource({ type })` instead of `schema.doesTypeExist(type)`",!1,{id:"ember-data:schema-service-updates",until:"6.0",for:"ember-data",since:{available:"4.13",enabled:"5.4"}}),this.hasResource({type:e})},jt.prototype.attributesDefinitionFor=function(e){(0,r.deprecate)("Use `schema.fields({ type })` instead of `schema.attributesDefinitionFor({ type })`",!1,{id:"ember-data:schema-service-updates",until:"6.0",for:"ember-data",since:{available:"4.13",enabled:"5.4"}})
const t=Pt(e.type)
return this._schemas.has(t)||this._loadModelSchema(t),this._schemas.get(t).attributes},jt.prototype.relationshipsDefinitionFor=function(e){(0,r.deprecate)("Use `schema.fields({ type })` instead of `schema.relationshipsDefinitionFor({ type })`",!1,{id:"ember-data:schema-service-updates",until:"6.0",for:"ember-data",since:{available:"4.13",enabled:"5.4"}})
const t=Pt(e.type)
return this._schemas.has(t)||this._loadModelSchema(t),this._schemas.get(t).relationships}
var Qt=n(30466)
function $t(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e
var t=e[Symbol.toPrimitive]
if(void 0!==t){var n=t.call(e,"string")
if("object"!=typeof n)return n
throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e)
return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Xt extends Qt.Ay{constructor(e){super(e),$t(this,"adapterFor",ke),$t(this,"serializerFor",De),$t(this,"pushPayload",Re),$t(this,"normalize",Me),$t(this,"serializeRecord",Oe),"requestManager"in this||(this.requestManager=new me.Je,this.requestManager.use([Pe,me.Fp])),this.requestManager.useCache(Qt.lL)}createSchemaService(){return new jt(this)}createCache(e){return new Y(e)}instantiateRecord(e,t){return Ut.call(this,e,t)}teardownRecord(e){return Gt.call(this,e)}modelFor(e){return Ht.call(this,e)||super.modelFor(e)}destroy(){Le.call(this),super.destroy()}}},88720(e,t,n){"use strict"
n.d(t,{r:()=>l})
var r=n(92384),i=n(61361),o=n(76840),a=n(33205)
const s={...i.yB},l=o.S.createProvider({label:"Interactions",descriptor:(0,a.e)({name:"molstar_computed_interactions"}),type:"local",defaultParams:s,getParams:e=>s,isApplicable:e=>!e.isCoarseGrained,obtain:async(e,t,n)=>{const o={...r.t.getDefaultValues(s),...n}
return{value:await(0,i.h3)(e,t,o)}}})},89432(e,t,n){"use strict"
n.d(t,{td:()=>A,w6:()=>_,sz:()=>w,tO:()=>T,Md:()=>I,bk:()=>S,Ud:()=>C})
var r=n(90050),i=n(23325),o=n(37411),a=n(53138),s=n(42261),l=n(14294),c=n(97564)
const u=function(){const e=new ArrayBuffer(4),t=new Float32Array(e),n=new Uint32Array(e),r=new Uint32Array(512),i=new Uint32Array(512)
for(let l=0;l<256;++l){const e=l-127
e<-27?(r[l]=0,r[256|l]=32768,i[l]=24,i[256|l]=24):e<-14?(r[l]=1024>>-e-14,r[256|l]=1024>>-e-14|32768,i[l]=-e-1,i[256|l]=-e-1):e<=15?(r[l]=e+15<<10,r[256|l]=e+15<<10|32768,i[l]=13,i[256|l]=13):e<128?(r[l]=31744,r[256|l]=64512,i[l]=24,i[256|l]=24):(r[l]=31744,r[256|l]=64512,i[l]=13,i[256|l]=13)}const o=new Uint32Array(2048),a=new Uint32Array(64),s=new Uint32Array(64)
for(let l=1;l<1024;++l){let e=l<<13,t=0
for(;!(8388608&e);)e<<=1,t-=8388608
e&=-8388609,t+=947912704,o[l]=e|t}for(let l=1024;l<2048;++l)o[l]=939524096+(l-1024<<13)
for(let l=1;l<31;++l)a[l]=l<<23
a[31]=1199570944,a[32]=2147483648
for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23)
a[63]=3347054592
for(let l=1;l<64;++l)32!==l&&(s[l]=1024)
return{floatView:t,uint32View:n,baseTable:r,shiftTable:i,mantissaTable:o,exponentTable:a,offsetTable:s}}()
function d(e){e=(0,c.qE)(e,-65504,65504),u.floatView[0]=e
const t=u.uint32View[0],n=t>>23&511
return u.baseTable[n]+((8388607&t)>>u.shiftTable[n])}var p=n(81871),h=n(88434),f=n(20321)
const m=o.e.set,g=o.e.normalize,y=o.e.sub,v=o.e.addScalar,b=o.e.scale,x=o.e.toArray
function S(e,t,n,o){let a=!1
const l=t.grid.cells.data.length
if(r.f.isLoci(e)){if(!r.f.areEquivalent(e.volume,t))return!1
if(h.I.is(e.instances)){const t=h.I.start(e.instances)*l,n=h.I.end(e.instances)*l
o(h.I.ofBounds(t,n))&&(a=!0)}else for(let t=0,n=e.instances.length;t<n;++t){const n=e.instances[t]*l
o(h.I.ofBounds(n,n+l))&&(a=!0)}}else if(r.f.Isosurface.isLoci(e)){if(!r.f.areEquivalent(e.volume,t))return!1
if(null==n?void 0:n.isoValue){if(!r.f.IsoValue.areSame(e.isoValue,n.isoValue,t.grid.stats))return!1
if(h.I.is(e.instances)){const t=h.I.start(e.instances)*l,n=h.I.end(e.instances)*l
o(h.I.ofBounds(t,n))&&(a=!0)}else for(let t=0,n=e.instances.length;t<n;++t){const n=e.instances[t]*l
o(h.I.ofBounds(n,n+l))&&(a=!0)}}else{const{stats:n,cells:{data:s}}=t.grid,c=n.sigma,u=r.f.IsoValue.toAbsolute(e.isoValue,n).absoluteValue
for(let t=0,r=s.length;t<r;++t)(0,i.T)(u,s[t],c)&&f.C.forEach(e.instances,e=>{const n=e*l
o(h.I.ofSingleton(n+t))&&(a=!0)})}}else if(r.f.Cell.isLoci(e)){if(!r.f.areEquivalent(e.volume,t))return!1
for(const{indices:t,instances:n}of e.elements)h.I.is(t)?f.C.forEach(n,e=>{const n=e*l
o(h.I.offset(t,n))&&(a=!0)}):f.C.forEach(t,e=>{f.C.forEach(n,t=>{const n=t*l
o(h.I.ofSingleton(n+e))&&(a=!0)})})}else if(r.f.Segment.isLoci(e)){if(!r.f.areEquivalent(e.volume,t))return!1
if(null==n?void 0:n.segments)for(const{segments:t,instances:r}of e.elements)f.C.areIntersecting(t,n.segments)&&f.C.forEach(r,e=>{const t=e*l
o(h.I.ofBounds(t,t+l))&&(a=!0)})
else{const n=r.f.Segmentation.get(t)
if(n){const r=new Set
for(const{segments:i,instances:c}of e.elements){for(let t=0,o=f.C.size(i);t<o;t++){const e=f.C.getAt(i,t)
s.M.add(r,n.segments.get(e))}const e=Array.from(r.values()),u=t.grid.cells.data
for(let t=0,n=u.length;t<n;++t)if(e.includes(u[t]))for(let e=0,r=f.C.size(c);e<r;e++){const n=e*l
o(h.I.ofSingleton(t+n))&&(a=!0)}}}}}return a}function _(e){const[t,n,i]=e.grid.cells.space.dimensions,o=t*n*i,a=e.instances.length,s=r.f.Cell.Location(e)
return(0,p.iQ)(o,a,1,(e,t)=>(s.cell=e,s.instance=t,s))}function C(e,t=0){const n=e[0]*e[1]*e[2],r=Math.sqrt(n),i=Math.pow(2,Math.ceil(Math.log(r)/Math.log(2)))
let o=e[0]+t,a=e[1]+t,s=1,l=o
return i<o*e[2]?(l=Math.floor(i/o),s=Math.ceil(e[2]/l),o*=l,a*=s):o*=e[2],{width:o,height:a,columns:l,rows:s,powerOfTwoSize:a<i?i:2*i}}function w(e,t,n=0,r="byte"){const{cells:{space:i,data:s},stats:{max:l,min:u}}=e.grid,p=i.dimensions,{dataOffset:h}=i,{width:f,height:S}=C(p,n),_="data"===t?1:4,w="byte"===r?new Uint8Array(f*S*_):"halfFloat"===r?new Uint16Array(f*S*_):new Float32Array(f*S*_),T={array:w,width:f,height:S},A=l-u,[I,P,B]=p,E=I+n,k=P+n,D=(0,o.e)(),M=(0,o.e)(),R=I-1,O=P-1,L=B-1
for(let o=0;o<B;++o)for(let e=0;e<P;++e)for(let n=0;n<I;++n){const i=Math.floor(o*E%f/E),l=_*(Math.floor(o*E/f)*k*f+e*f+(i*E+n)),p=h(n,e,o)
let S
if(S="byte"===r?Math.round((s[p]-u)/A*255):"halfFloat"===r?d((s[p]-u)/A):(s[p]-u)/A,"data"===t)w[l]=S
else{if("groups"===t)if("halfFloat"===r){let e=(0,c.qE)(Math.round(p),0,16777215)+1
w[l+2]=d(e%256),e=Math.floor(e/256),w[l+1]=d(e%256),e=Math.floor(e/256),w[l]=d(e%256)}else(0,a.Gu)(p,w,l)
else m(D,s[h(Math.max(0,n-1),e,o)],s[h(n,Math.max(0,e-1),o)],s[h(n,e,Math.max(0,o-1))]),m(M,s[h(Math.min(R,n+1),e,o)],s[h(n,Math.min(O,e+1),o)],s[h(n,e,Math.min(L,o+1))]),g(D,y(D,D,M)),v(D,b(D,D,.5),.5),"byte"===r?x(b(D,D,255),w,l):"halfFloat"===r?(w[l]=d(D[0]),w[l+1]=d(D[1]),w[l+2]=d(D[2])):x(D,w,l)
w[l+3]=S}}return T}function T(e,t="byte"){const{cells:{space:n,data:r},stats:{max:i,min:a}}=e.grid,[s,l,c]=n.dimensions,{dataOffset:u}=n,p="byte"===t?new Uint8Array(s*l*c*4):"halfFloat"===t?new Uint16Array(s*l*c*4):new Float32Array(s*l*c*4),h={array:p,width:s,height:l,depth:c},f=i-a,S=(0,o.e)(),_=(0,o.e)(),C=s-1,w=l-1,T=c-1
let A=0
for(let o=0;o<c;++o)for(let e=0;e<l;++e)for(let n=0;n<s;++n){const i=u(n,e,o)
m(S,r[u(Math.max(0,n-1),e,o)],r[u(n,Math.max(0,e-1),o)],r[u(n,e,Math.max(0,o-1))]),m(_,r[u(Math.min(C,n+1),e,o)],r[u(n,Math.min(w,e+1),o)],r[u(n,e,Math.min(T,o+1))]),g(S,y(S,S,_)),v(S,b(S,S,.5),.5),"byte"===t?(x(b(S,S,255),p,A),p[A+3]=Math.round((r[i]-a)/f*255)):"halfFloat"===t?(p[A]=d(S[0]),p[A+1]=d(S[1]),p[A+2]=d(S[2]),p[A+3]=d((r[i]-a)/f)):(x(S,p,A),p[A+3]=(r[i]-a)/f),A+=4}return h}function A(e,t,n,r=0){const i=e.grid.cells.data,a=l.DJ.size((0,o.e)(),n),s=e.grid.cells.space.dataOffset,{width:c,height:u}=C(a,r),d=new Uint8Array(c*u*1),p={array:d,width:c,height:u},[h,f,m]=a,g=h-1,y=f-1,v=m-1,b=h+r,x=f+r,[S,_,w]=n.min,[T,A,I]=n.max
for(let o=0;o<m;++o)for(let e=0;e<f;++e)for(let n=0;n<h;++n){const r=Math.floor(o*b%c/b),a=1*(Math.floor(o*b/c)*x*c+e*c+(r*b+n)),l=t.includes(i[s(n+S,e+_,o+w)])?255:0,u=t.includes(i[s(Math.min(g+T,n+1+S),e+_,o+w)])?255:0,p=t.includes(i[s(Math.max(0,n-1+S),e+_,o+w)])?255:0,h=t.includes(i[s(n+S,Math.min(y+A,e+1+_),o+w)])?255:0,f=t.includes(i[s(n+S,Math.max(0,e-1+_),o+w)])?255:0,m=t.includes(i[s(n+S,e+_,Math.min(v+I,o+1+w))])?255:0,C=t.includes(i[s(n+S,e+_,Math.max(0,o-1+w))])?255:0
d[a]=Math.round((l+l+u+p+h+f+m+C)/8)}return p}function I(e){const{grid:t}=e,{space:n}=t.cells,{get:i,set:a,add:s,dataOffset:l}=n,[c,u,d]=n.dimensions,p=o.e.create(c+1,u+1,d+1),h={...n,dimensions:p,get:(e,t,n,r)=>i(e,t%c,n%u,r%d),set:(e,t,n,r,i)=>a(e,t%c,n%u,r%d,i),add:(e,t,n,r,i)=>s(e,t%c,n%u,r%d,i),dataOffset:(e,t,n)=>l(e%c,t%u,n%d)},f={kind:"matrix",matrix:r.x.getGridToCartesianTransform(e.grid)},m={...t,transform:f,cells:{...t.cells,space:h}}
return{...e,grid:m}}},89748(e,t,n){"use strict"
n.d(t,{f$:()=>ge,xA:()=>i.xA,RF:()=>i.RF,j1:()=>i.j1})
var r,i=n(48298),o=n(10134),a=n(10196),s=n(70292)
function l(e){for(;e.position<e.length;)switch(e.data.charCodeAt(e.position)){case 9:case 10:case 13:case 32:return void(e.tokenEnd=e.position)
default:++e.position}e.tokenEnd=e.position}function c(e){return!(e.length-e.position<2)&&39===e.data.charCodeAt(e.position+1)&&39===e.data.charCodeAt(e.position+2)}function u(e,t,n){let r
const i=n-t,o=e.tokenStart-t,a=e.tokenEnd-e.tokenStart
if(a<i)return!1
for(r=t;r<n;++r)if(e.data.charCodeAt(r)!==e.data.charCodeAt(r+o))return!1
return i===a||46===e.data.charCodeAt(r+o)}function d(e){let t
for(t=e.tokenStart;t<e.tokenEnd;++t)if(46===e.data.charCodeAt(t))return t
return t}function p(e,t){return e.data.substring(e.tokenStart,t)}function h(e){return e.data.substring(e.tokenStart,e.tokenEnd)}function f(e){const t=function(e){let t=10
for(;e.position<e.length;){const n=e.data.charCodeAt(e.position)
switch(n){case 9:case 32:t=n,++e.position
break
case 10:13!==t&&++e.lineNumber,t=n,++e.position
break
case 13:t=n,++e.position,++e.lineNumber
break
default:return t}}return t}(e)
if(e.position>=e.length)return void(e.tokenType=r.End)
e.tokenStart=e.position,e.tokenEnd=e.position,e.isEscaped=!1
const n=e.data.charCodeAt(e.position)
switch(n){case 35:!function(e){for(;e.position<e.length;){const t=e.data.charCodeAt(e.position)
if(10===t||13===t)return;++e.position}}(e),e.tokenType=r.Comment
break
case 39:if(c(e)){!function(e){for(e.position+=3;e.position<e.length;){if(39===e.data.charCodeAt(e.position)&&c(e))return e.tokenStart+=3,e.tokenEnd=e.position,e.isEscaped=!0,void(e.position+=3);++e.position}e.tokenEnd=e.position}(e),e.tokenType=r.Value
break}case 34:!function(e,t){let n,r
for(++e.position;e.position<e.length;)if(r=e.data.charCodeAt(e.position),r===t)switch(n=e.data.charCodeAt(e.position+1),n){case 9:case 10:case 13:case 32:return e.tokenStart++,e.tokenEnd=e.position,e.isEscaped=!0,void++e.position
default:if(!Number.isFinite(n))return e.tokenStart++,e.tokenEnd=e.position,e.isEscaped=!0,void++e.position;++e.position}else{if(10===r||13===r)return void(e.tokenEnd=e.position);++e.position}e.tokenEnd=e.position}(e,n),e.tokenType=r.Value
break
case 59:10===t||13===t?function(e){let t,n=59,r=e.position+1
for(;r<e.length;){if(t=e.data.charCodeAt(r),59===t&&(10===n||13===n)){for(e.position=r+1,e.tokenStart++,r--,t=e.data.charCodeAt(r);10===t||13===t;)r--,t=e.data.charCodeAt(r)
return e.tokenEnd=r+1,void(e.isEscaped=!0)}(13===t||10===t&&13!==n)&&e.lineNumber++,n=t,++r}e.position=r}(e):l(e),e.tokenType=r.Value
break
default:e.isImportGet?function(e){for(;e.position<e.length;){if(93===e.data.charCodeAt(e.position))return++e.position,e.tokenEnd=e.position,void(e.isImportGet=!1);++e.position}}(e):l(e),e.isEscaped?e.tokenType=r.Value:95===e.data.charCodeAt(e.tokenStart)?(e.inSaveFrame&&function(e){return e.tokenEnd-e.tokenStart===11&&105===e.data.charCodeAt(e.tokenStart+1)&&109===e.data.charCodeAt(e.tokenStart+2)&&112===e.data.charCodeAt(e.tokenStart+3)&&111===e.data.charCodeAt(e.tokenStart+4)&&114===e.data.charCodeAt(e.tokenStart+5)&&116===e.data.charCodeAt(e.tokenStart+6)&&46===e.data.charCodeAt(e.tokenStart+7)&&103===e.data.charCodeAt(e.tokenStart+8)&&101===e.data.charCodeAt(e.tokenStart+9)&&116===e.data.charCodeAt(e.tokenStart+10)}(e)&&(e.isImportGet=!0),e.tokenType=r.ColumnName):e.tokenEnd-e.tokenStart>=5&&95===e.data.charCodeAt(e.tokenStart+4)?function(e){let t=e.data.charCodeAt(e.tokenStart)
return!(68!==t&&100!==t||(t=e.data.charCodeAt(e.tokenStart+1),65!==t&&97!==t||(t=e.data.charCodeAt(e.tokenStart+2),84!==t&&116!==t||(t=e.data.charCodeAt(e.tokenStart+3),65!==t&&97!==t))))}(e)?e.tokenType=r.Data:function(e){let t=e.data.charCodeAt(e.tokenStart)
return!(83!==t&&115!==t||(t=e.data.charCodeAt(e.tokenStart+1),65!==t&&97!==t||(t=e.data.charCodeAt(e.tokenStart+2),86!==t&&118!==t||(t=e.data.charCodeAt(e.tokenStart+3),69!==t&&101!==t))))}(e)?e.tokenType=r.Save:function(e){if(e.tokenEnd-e.tokenStart!==5)return!1
let t=e.data.charCodeAt(e.tokenStart)
return!(76!==t&&108!==t||(t=e.data.charCodeAt(e.tokenStart+1),79!==t&&111!==t||(t=e.data.charCodeAt(e.tokenStart+2),79!==t&&111!==t||(t=e.data.charCodeAt(e.tokenStart+3),80!==t&&112!==t))))}(e)?e.tokenType=r.Loop:e.tokenType=r.Value:e.tokenType=r.Value}}function m(e){for(f(e);e.tokenType===r.Comment;)f(e)}function g(){return{categoryNames:[],categoryData:Object.create(null)}}function y(e,t){const n=Object.create(null)
for(const r of e){const e=t[r]
n[r]=i.xA(e.name,e.rowCount,e.fieldNames,e.fields)}return n}function v(e,t,n){return i.IU(e.categoryNames,y(e.categoryNames,e.categoryData),t,n)}function b(e,t){return i.IU(e.categoryNames,y(e.categoryNames,e.categoryData),t)}function x(e,t,n,r,i){if(t in e.categoryData){const n=e.categoryData[t]
n.fieldNames.push(...r),Object.assign(n.fields,i)}else e.categoryData[t]={name:t,rowCount:n,fieldNames:r,fields:i},e.categoryNames.push(t)}function S(e,t){const n=e.tokenStart,o=d(e),a=p(e,o),s=Object.create(null),l=[]
let c=!0
for(;c;){if(e.tokenType!==r.ColumnName||!u(e,n,o)){c=!1
break}const t=h(e).substring(a.length+1)
if(m(e),e.tokenType!==r.Value)return{hasError:!0,errorLine:e.lineNumber,errorMessage:"Expected value."}
s[t]=i.RF.ofTokens({data:e.data,indices:[e.tokenStart,e.tokenEnd],count:1}),l[l.length]=t,m(e)}return x(t,a.substr(1),1,l,s),{hasError:!1,errorLine:0,errorMessage:""}}function _(e,t){const{tokenizer:n,tokens:i,fieldCount:a}=t
let s=t.tokenCount,l=0
for(;n.tokenType===r.Value&&l<e;)o.tM.add(i[s++%a],n.tokenStart,n.tokenEnd),m(n),l++
return t.tokenCount=s,l}function C(e,t){return e.update({message:"Parsing...",current:t.tokenizer.position,max:t.tokenizer.data.length})}async function w(e,t){const n=e.lineNumber
m(e)
const a=p(e,d(e)),l=function(e){let t
for(t=e.tokenStart;t<e.tokenEnd;++t)if(46===e.data.charCodeAt(t))return!1
return!0}(e),c=[]
for(;e.tokenType===r.ColumnName;)c[c.length]=l?h(e):h(e).substring(a.length+1),m(e)
const u="_atom_site"===a?e.data.length/100|0:32,f=[],g=c.length
for(let r=0;r<g;r++)f[r]=o.tM.create(e.data,u)
const y={fieldCount:g,tokenCount:0,tokenizer:e,tokens:f}
if(await(0,s.chunkedSubtask)(e.runtimeCtx,1e6,y,_,C),y.tokenCount%g!==0)return{hasError:!0,errorLine:e.lineNumber,errorMessage:`The number of values for loop starting at line ${n} is not a multiple of the number of columns.`}
const v=y.tokenCount/g|0
if(l)for(let r=0;r<g;r++){const e={"":i.RF.ofTokens(f[r])}
x(t,c[r].substr(1),v,[""],e)}else{const e=Object.create(null)
for(let t=0;t<g;t++)e[c[t]]=i.RF.ofTokens(f[t])
x(t,a.substr(1),v,c,e)}return{hasError:!1,errorLine:0,errorMessage:""}}function T(e,t){return a.H.error(t,e)}function A(e){return s.Task.create("Parse CIF",async t=>await async function(e,t){const n=[],s=function(e,t){return{data:e,length:e.length,position:0,tokenStart:0,tokenEnd:0,tokenType:r.End,lineNumber:1,isEscaped:!1,isImportGet:!1,inSaveFrame:!1,runtimeCtx:t}}(e,t)
let l="",c=g(),u=[],d=g()
const p=i.p4(d.categoryNames,y(d.categoryNames,d.categoryData),"")
let h=""
for(t.update({message:"Parsing...",current:0,max:e.length}),m(s);s.tokenType!==r.End;){const t=s.tokenType
if(t===r.Data){if(s.inSaveFrame)return T(s.lineNumber,"Unexpected data block inside a save frame.")
c.categoryNames.length>0&&n.push(v(c,l,u)),l=e.substring(s.tokenStart+5,s.tokenEnd),c=g(),u=[],m(s)}else if(t===r.Save){if(s.tokenEnd-s.tokenStart===5)d.categoryNames.length>0&&(u[u.length]=b(d,h)),s.inSaveFrame=!1
else{if(s.inSaveFrame)return T(s.lineNumber,"Save frames cannot be nested.")
s.inSaveFrame=!0,h=e.substring(s.tokenStart+5,s.tokenEnd),d=g()}m(s)}else if(t===r.Loop){const e=await w(s,s.inSaveFrame?d:c)
if(e.hasError)return T(e.errorLine,e.errorMessage)}else{if(t!==r.ColumnName)return console.log(s.tokenType,o._F.getTokenString(s)),T(s.lineNumber,"Unexpected token. Expected data_, loop_, or data name.")
{const e=S(s,s.inSaveFrame?d:c)
if(e.hasError)return T(e.errorLine,e.errorMessage)}}}return s.inSaveFrame?T(s.lineNumber,`Unfinished save frame (${p.header}).`):((c.categoryNames.length>0||u.length>0)&&n.push(v(c,l,u)),function(e){return a.H.success(e)}(i.jG(n)))}(e,t))}!function(e){e[e.Data=0]="Data",e[e.Save=1]="Save",e[e.Loop=2]="Loop",e[e.Value=3]="Value",e[e.ColumnName=4]="ColumnName",e[e.Comment=5]="Comment",e[e.End=6]="End"}(r||(r={}))
var I=n(24762),P=n(70254),B=n(97016),E=n(80012)
function k(e){const t=Object.create(null),n=Object.create(null)
for(const r of e.columns)t[r.name]=r
return{rowCount:e.rowCount,name:e.name.substring(1),fieldNames:e.columns.map(e=>e.name),getField(e){const r=t[e]
if(r)return n[e]||(n[e]=function(e){const t=e.mask?(0,P.D4)(e.mask):void 0,n=(0,P.D4)(e.data),r=I.iu.isTypedArray(n),i=r?t?e=>t[e]===I.VP.ValueKinds.Present?""+n[e]:"":e=>""+n[e]:t?e=>t[e]===I.VP.ValueKinds.Present?n[e]:"":e=>n[e],o=r?e=>n[e]:e=>{const t=n[e]
return(0,B.H9)(t,0,t.length)},a=r?e=>n[e]:e=>{const t=n[e]
return(0,B.sS)(t,0,t.length)},s=t?e=>t[e]:e=>I.VP.ValueKinds.Present,l=n.length
return{__array:n,binaryEncoding:e.data.encoding,isDefined:!0,rowCount:l,str:i,int:o,float:a,valueKind:s,areValuesEqual:(e,t)=>n[e]===n[t],toStringArray:e=>I.iu.createAndFillArray(l,i,e),toIntArray:r?e=>I.iu.typedArrayWindow(n,e):e=>I.iu.createAndFillArray(l,o,e),toFloatArray:r?e=>I.iu.typedArrayWindow(n,e):e=>I.iu.createAndFillArray(l,a,e)}}(r)),n[e]}}}function D(e){return s.Task.create("Parse BinaryCIF",async t=>{const n=[0,3]
try{const t=(0,E.J)(e)
if(!function(e,t){for(let n=0;n<2;n++)if(e[n]>t[n])return!1
return!0}(n,t.version.match(/(\d)\.(\d)\.\d/).slice(1).map(e=>+e)))return a.H.error(`Unsupported format version. Current ${t.version}, required ${n.join(".")}.`)
const r=i.jG(t.dataBlocks.map(e=>{const t=Object.create(null)
for(const n of e.categories)t[n.name.substring(1)]=k(n)
return i.IU(e.categories.map(e=>e.name.substring(1)),t,e.header)}))
return a.H.success(r)}catch(e){return a.H.error(""+e)}})}var M=n(28901),R=n(29282),O=I.VP.Schema
const L=O.str,N=O.float,F=O.List,z=O.lstr,j=O.Aliased,V=O.int,U=O.coord,G={chem_comp:{formula:L,formula_weight:N,id:L,mon_nstd_parent_comp_id:F(",",e=>e),name:L,one_letter_code:L,three_letter_code:L,type:j(z),pdbx_synonyms:F(";",e=>e),pdbx_type:L,pdbx_ambiguous_flag:L,pdbx_replaced_by:L,pdbx_replaces:L,pdbx_formal_charge:V,pdbx_model_coordinates_details:L,pdbx_model_coordinates_db_code:L,pdbx_ideal_coordinates_details:L,pdbx_ideal_coordinates_missing_flag:j(z),pdbx_model_coordinates_missing_flag:j(z),pdbx_initial_date:L,pdbx_modified_date:L,pdbx_release_status:j(L),pdbx_processing_site:j(L)},chem_comp_atom:{alt_atom_id:L,atom_id:L,charge:V,model_Cartn_x:U,model_Cartn_y:U,model_Cartn_z:U,comp_id:L,type_symbol:L,pdbx_align:V,pdbx_ordinal:V,pdbx_model_Cartn_x_ideal:U,pdbx_model_Cartn_y_ideal:U,pdbx_model_Cartn_z_ideal:U,pdbx_stereo_config:j(z),pdbx_aromatic_flag:j(z),pdbx_leaving_atom_flag:j(z)},chem_comp_bond:{atom_id_1:L,atom_id_2:L,comp_id:L,value_order:j(z),pdbx_ordinal:V,pdbx_stereo_config:j(z),pdbx_aromatic_flag:j(z)},pdbx_chem_comp_descriptor:{comp_id:L,descriptor:L,type:j(z),program:L,program_version:L},pdbx_chem_comp_identifier:{comp_id:L,identifier:L,type:j(L),program:L,program_version:L}}
var H=I.VP.Schema
const q=H.str,Q=H.float,$=H.lstr,X=H.Aliased,W=H.int,Y={pdbx_reference_molecule:{prd_id:q,formula_weight:Q,formula:q,type:X($),type_evidence_code:q,class:X($),class_evidence_code:q,name:q,represent_as:X($),chem_comp_id:q,compound_details:q,description:q,representative_PDB_id_code:q,release_status:X($),replaces:q,replaced_by:q},pdbx_reference_entity_list:{prd_id:q,ref_entity_id:q,type:X($),details:q,component_id:W},pdbx_reference_entity_nonpoly:{prd_id:q,ref_entity_id:q,name:q,chem_comp_id:q},pdbx_reference_entity_link:{link_id:W,prd_id:q,details:q,ref_entity_id_1:q,ref_entity_id_2:q,entity_seq_num_1:W,entity_seq_num_2:W,comp_id_1:q,comp_id_2:q,atom_id_1:q,atom_id_2:q,value_order:X($),component_1:W,component_2:W,link_class:X(q)},pdbx_reference_entity_poly_link:{link_id:W,prd_id:q,ref_entity_id:q,component_id:W,entity_seq_num_1:W,entity_seq_num_2:W,comp_id_1:q,comp_id_2:q,atom_id_1:q,atom_id_2:q,value_order:X($)},pdbx_reference_entity_poly:{prd_id:q,ref_entity_id:q,type:X(q),db_code:q,db_name:q},pdbx_reference_entity_poly_seq:{prd_id:q,ref_entity_id:q,mon_id:q,parent_mon_id:q,num:W,observed:X($),hetero:X($)},pdbx_reference_entity_sequence:{prd_id:q,ref_entity_id:q,type:X(q),NRP_flag:X(q),one_letter_codes:q},pdbx_reference_entity_src_nat:{prd_id:q,ref_entity_id:q,ordinal:W,organism_scientific:q,taxid:q,db_code:q,db_name:q},pdbx_prd_audit:{prd_id:q,date:q,processing_site:X(q),action_type:X(q)}}
var Z=I.VP.Schema
const K=Z.str,J={datablock:{id:K,description:K},dictionary:{title:K,datablock_id:K,version:K},dictionary_history:{version:K,update:K,revision:K},sub_category:{id:K,description:K},category_group_list:{id:K,parent_id:K,description:K},item_type_list:{code:K,primitive_code:K,construct:K,detail:K},item_units_list:{code:K,detail:K},item_units_conversion:{from_code:K,to_code:K,operator:K,factor:Z.float}}
var ee=I.VP.Schema
const te=ee.str,ne=ee.int,re=ee.float,ie=ee.Aliased,oe=ee.Vector,ae=(ie(te),ie(te),ie(te),ie(te),oe(3),oe(3),{volume_data_3d_info:{name:te,axis_order:oe(3,ne),origin:oe(3),dimensions:oe(3),sample_rate:ne,sample_count:oe(3,ne),spacegroup_number:ne,spacegroup_cell_size:oe(3),spacegroup_cell_angles:oe(3),mean_source:re,mean_sampled:re,sigma_source:re,sigma_sampled:re,min_source:re,min_sampled:re,max_source:re,max_sampled:re},volume_data_3d:{values:re}})
var se=I.VP.Schema
const le=se.float,ce=se.str,ue=se.int,de={cell:{angle_alpha:le,angle_beta:le,angle_gamma:le,formula_units_z:le,length_a:le,length_b:le,length_c:le,volume:le},chemical:{melting_point:le,name_common:ce,name_systematic:ce},chemical_formula:{moiety:ce,sum:ce,weight:le},space_group:{crystal_system:ce,it_number:ue,"name_h-m_full":ce},space_group_symop:{operation_xyz:ce},geom_bond:{atom_site_label_1:ce,atom_site_label_2:ce,distance:le,publ_flag:ce,site_symmetry_1:ce,site_symmetry_2:ce,valence:le},audit:{block_doi:ce},database_code:{cod:ce,csd:ce,depnum_ccdc_archive:ce,depnum_ccdc_fiz:ce,icsd:ce,mdf:ce,nbs:ce},atom_site:{adp_type:ce,calc_flag:ce,disorder_assembly:ce,disorder_group:ce,fract_x:le,fract_y:le,fract_z:le,label:ce,occupancy:le,refinement_flags:ce,site_symmetry_multiplicity:ue,type_symbol:ce,u_iso_or_equiv:le},atom_site_aniso:{label:ce,u_11:le,u:(0,se.Matrix)(3,3),u_12:le,u_13:le,u_22:le,u_23:le,u_33:le},atom_type:{description:ce,symbol:ce},atom_type_scat:{dispersion_imag:le,dispersion_real:le,source:ce}},pe={"cell.formula_units_z":["cell_formula_units_Z"],"space_group.it_number":["space_group_IT_number","symmetry_Int_Tables_number"],"space_group.name_h-m_full":["symmetry_space_group_name_H-M"],"space_group_symop.operation_xyz":["symmetry_equiv_pos_as_xyz"],"geom_bond.atom_site_label_1":["geom_bond_atom_site_id_1"],"geom_bond.atom_site_label_2":["geom_bond_atom_site_id_2"],"geom_bond.distance":["geom_bond_dist"],"audit.block_doi":["audit_block_DOI"],"database_code.cod":["database_code_COD"],"database_code.csd":["database_code_CSD"],"database_code.depnum_ccdc_archive":["database_code_depnum_CCDC_archive"],"database_code.depnum_ccdc_fiz":["database_code_depnum_CCDC_fiz"],"database_code.icsd":["database_code_ICSD"],"database_code.mdf":["database_code_MDF"],"database_code.nbs":["database_code_NBS"],"atom_site.adp_type":["atom_site_ADP_type","atom_site_thermal_displace_type"],"atom_site.label":["atom_site_id"],"atom_site.site_symmetry_multiplicity":["atom_site_symmetry_multiplicity"],"atom_site.u_iso_or_equiv":["atom_site_U_iso_or_equiv"],"atom_site_aniso.label":["atom_site_anisotrop_id"],"atom_site_aniso.u_11":["atom_site_aniso_U_11","atom_site_anisotrop_U_11"],"atom_site_aniso.u_12":["atom_site_aniso_U_12","atom_site_anisotrop_U_12"],"atom_site_aniso.u_13":["atom_site_aniso_U_13","atom_site_anisotrop_U_13"],"atom_site_aniso.u_22":["atom_site_aniso_U_22","atom_site_anisotrop_U_22"],"atom_site_aniso.u_23":["atom_site_aniso_U_23","atom_site_anisotrop_U_23"],"atom_site_aniso.u_33":["atom_site_aniso_U_33","atom_site_anisotrop_U_33"]},he=I.VP.Schema.int,fe={volume_data_3d_info:ae.volume_data_3d_info,segmentation_data_table:{set_id:he,segment_id:he},segmentation_data_3d:{values:he}}
var me=n(46712)
const ge={parse:e=>me.LQ.is(e)?A(e):D(e),parseText:A,parseBinary:D,toDatabaseCollection:M.nN,toDatabase:M.Pd,schema:{mmCIF:e=>(0,M.Pd)(R.r,e),CCD:e=>(0,M.Pd)(G,e),BIRD:e=>(0,M.Pd)(Y,e),dic:e=>(0,M.Pd)(J,e),cifCore:e=>(0,M.Pd)(de,e,pe),densityServer:e=>(0,M.Pd)(ae,e),segmentation:e=>(0,M.Pd)(fe,e)}}},90050(e,t,n){"use strict"
n.d(t,{f:()=>r.f,x:()=>i.x})
var r=n(60939),i=n(84645)},90756(e,t,n){"use strict"
n.d(t,{B:()=>a})
var r=n(91375),i=n(20610),o=n(91660)
function a(e,t){return void 0===t&&(t=r.E),(0,i.N)(function(n,r){var i=null,a=null,s=null,l=function(){if(i){i.unsubscribe(),i=null
var e=a
a=null,r.next(e)}}
function c(){var n=s+e,o=t.now()
if(o<n)return i=this.schedule(void 0,n-o),void r.add(i)
l()}n.subscribe((0,o._)(r,function(n){a=n,s=t.now(),i||(i=t.schedule(c,e),r.add(i))},function(){l(),r.complete()},void 0,function(){a=i=null}))})}},91030(e,t,n){"use strict"
n.d(t,{l:()=>s})
var r=n(89),i=n(48393),o=n(7928),a=n(36432)
function s(e,t){return{kind:e,layers:t}}!function(e){let t
function n(e){return 0===e.layers.length}e.Empty={kind:"empty-loci",layers:[]},function(e){let t
function n(e){switch(e){case"one":return t.One
case"two":return t.Two
case"three":return t.Three
case"four":return t.Four
case"five":return t.Five
case"six":return t.Six}}e.is=a.N.has,function(e){e[e.None=0]="None",e[e.One=1]="One",e[e.Two=2]="Two",e[e.Three=4]="Three",e[e.Four=8]="Four",e[e.Five=16]="Five",e[e.Six=32]="Six"}(t=e.Flag||(e.Flag={})),e.create=function(e){return a.N.create(e)},e.Names={one:t.One,two:t.Two,three:t.Three,four:t.Four,five:t.Five,six:t.Six},e.isName=function(t){return t in e.Names},e.fromName=n,e.fromNames=function(e){let r=t.None
for(let t=0,i=e.length;t<i;++t)r|=n(e[t])
return r},e.toNames=function(n){const r=[]
return e.is(n,t.One)&&r.push("one"),e.is(n,t.Two)&&r.push("two"),e.is(n,t.Three)&&r.push("three"),e.is(n,t.Four)&&r.push("four"),e.is(n,t.Five)&&r.push("five"),e.is(n,t.Six)&&r.push("six"),r}}(t=e.Groups||(e.Groups={})),e.areEqual=function(e,t){if(e.layers.length!==t.layers.length)return!1
for(let n=0,i=e.layers.length;n<i;++n){if(e.layers[n].groups!==t.layers[n].groups)return!1
if(!r.Loci.areEqual(e.layers[n].loci,t.layers[n].loci))return!1}return!0},e.isEmpty=n,e.remap=function(e,t){if("element-loci"===e.kind){const n=[]
for(const r of e.layers){let{loci:e,groups:o}=r
e=i.StructureElement.Loci.remap(e,t),i.StructureElement.Loci.isEmpty(e)||n.push({loci:e,groups:o})}return{kind:"element-loci",layers:n}}return e},e.merge=function(e){if(n(e))return e
if("element-loci"===e.kind){const{structure:t}=e.layers[0].loci,n=new Map
let r=i.StructureElement.Loci.none(t)
for(let a=0,s=e.layers.length;a<s;++a){let{loci:t,groups:o}=e.layers[s-a-1]
t=i.StructureElement.Loci.subtract(t,r),r=i.StructureElement.Loci.union(t,r),i.StructureElement.Loci.isEmpty(t)||(n.has(o)&&(t=i.StructureElement.Loci.union(t,n.get(o))),n.set(o,t))}const o=[]
return n.forEach((e,t)=>{o.push({loci:e,groups:t})}),{kind:"element-loci",layers:o}}return e},e.filter=function(e,t){if(n(e))return e
if("element-loci"===e.kind){const{structure:n}=e.layers[0].loci,r=[]
for(const o of e.layers){let{loci:e,groups:a}=o
const s=i.StructureElement.Loci.remap(e,t)
e=i.StructureElement.Loci.remap(s,n),i.StructureElement.Loci.isEmpty(e)||r.push({loci:e,groups:a})}return{kind:"element-loci",layers:r}}return e},e.ofScript=function(e,t){const n=[]
for(let r=0,a=e.length;r<a;++r){const{script:a,groups:s}=e[r],l=o.Script.toLoci(a,t)
i.StructureElement.Loci.isEmpty(l)||n.push({loci:l,groups:s})}return{kind:"element-loci",layers:n}},e.ofBundle=function(e,t){const n=[]
for(let r=0,o=e.length;r<o;++r){const{bundle:o,groups:a}=e[r],s=i.StructureElement.Bundle.toLoci(o,t.root)
n.push({loci:s,groups:a})}return{kind:"element-loci",layers:n}},e.toBundle=function(e){const t=[]
for(let n=0,r=e.layers.length;n<r;++n){const{loci:r,groups:o}=e.layers[n],a=i.StructureElement.Bundle.fromLoci(r)
t.push({bundle:a,groups:o})}return{kind:"element-loci",layers:t}}}(s||(s={}))},91229(e,t,n){"use strict"
function r(e){return Object.keys(e)}function i(e){throw new Error("unreachable")}function o(e){return"function"==typeof(null==e?void 0:e.then)}n.d(t,{$X:()=>o,dr:()=>i,mX:()=>r})},91375(e,t,n){"use strict"
n.d(t,{b:()=>d,E:()=>u})
var r=n(76513),i=function(e){function t(t,n){return e.call(this)||this}return(0,r.C6)(t,e),t.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},t}(n(28539).yU),o={setInterval:function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i]
var a=o.delegate
return(null==a?void 0:a.setInterval)?a.setInterval.apply(a,(0,r.fX)([e,t],(0,r.zs)(n))):setInterval.apply(void 0,(0,r.fX)([e,t],(0,r.zs)(n)))},clearInterval:function(e){var t=o.delegate
return((null==t?void 0:t.clearInterval)||clearInterval)(e)},delegate:void 0},a=n(13352),s=function(e){function t(t,n){var r=e.call(this,t,n)||this
return r.scheduler=t,r.work=n,r.pending=!1,r}return(0,r.C6)(t,e),t.prototype.schedule=function(e,t){var n
if(void 0===t&&(t=0),this.closed)return this
this.state=e
var r=this.id,i=this.scheduler
return null!=r&&(this.id=this.recycleAsyncId(i,r,t)),this.pending=!0,this.delay=t,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(i,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),o.setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!=n&&this.delay===n&&!1===this.pending)return t
null!=t&&o.clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action")
this.pending=!1
var n=this._execute(e,t)
if(n)return n
!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n,r=!1
try{this.work(e)}catch(e){r=!0,n=e||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),n},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,n=this.scheduler,r=n.actions
this.work=this.state=this.scheduler=null,this.pending=!1,(0,a.o)(r,this),null!=t&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(i),l={now:function(){return(l.delegate||Date).now()},delegate:void 0},c=function(){function e(t,n){void 0===n&&(n=e.now),this.schedulerActionCtor=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(n,t)},e.now=l.now,e}(),u=new(function(e){function t(t,n){void 0===n&&(n=c.now)
var r=e.call(this,t,n)||this
return r.actions=[],r._active=!1,r}return(0,r.C6)(t,e),t.prototype.flush=function(e){var t=this.actions
if(this._active)t.push(e)
else{var n
this._active=!0
do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift())
if(this._active=!1,n){for(;e=t.shift();)e.unsubscribe()
throw n}}},t}(c))(s),d=u},91660(e,t,n){"use strict"
n.d(t,{_:()=>i})
var r=n(76513)
function i(e,t,n,r,i){return new o(e,t,n,r,i)}var o=function(e){function t(t,n,r,i,o,a){var s=e.call(this,t)||this
return s.onFinalize=o,s.shouldUnsubscribe=a,s._next=n?function(e){try{n(e)}catch(e){t.error(e)}}:e.prototype._next,s._error=i?function(e){try{i(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,s._complete=r?function(){try{r()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,s}return(0,r.C6)(t,e),t.prototype.unsubscribe=function(){var t
if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed
e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(n(67151).vU)},91763(e,t,n){"use strict"
n.d(t,{i:()=>f})
var r=n(66006),i=n(97564),o=n(6539),a=n(37411)
class s{get source(){return this._source}get target(){return this._target}apply(e,t=0,n){(!this.inTransition||t>0)&&f.copySnapshot(this._source,this.camera.state),this.inTransition||f.copySnapshot(this._target,this.camera.state),f.copySnapshot(this._target,e),this._target.radius>this._target.radiusMax&&(this._target.radius=this._target.radiusMax),this._target.radius<.01&&(this._target.radius=.01),this._target.radiusMax<.01&&(this._target.radiusMax=.01),!this.inTransition&&t<=0||void 0!==e.mode&&e.mode!==this.camera.state.mode?this.finish(this._target):(this.inTransition=!0,this.func=n||s.defaultTransition,(!this.inTransition||t>0)&&(this.start=this.t,this.durationMs=t))}tick(e){this.t=e,this.update()}finish(e){f.copySnapshot(this.camera.state,e),this.inTransition=!1}update(){if(!this.inTransition)return
const e=Math.min((this.t-this.start)/this.durationMs,1)
1!==e?(this.func(this._current,e,this._source,this._target),f.copySnapshot(this.camera.state,this._current)):this.finish(this._target)}constructor(e){this.camera=e,this.t=0,this.func=s.defaultTransition,this.start=0,this.inTransition=!1,this.durationMs=0,this._source=f.createDefaultSnapshot(),this._target=f.createDefaultSnapshot(),this._current=f.createDefaultSnapshot()}}!function(e){const t=o.k.identity(),n=o.k.identity(),r=(0,a.e)(),s=(0,a.e)()
e.defaultTransition=function(e,l,c,u){f.copySnapshot(e,u),o.k.slerp(t,o.k.Identity,o.k.rotationTo(t,c.up,u.up),l),a.e.transformQuat(e.up,c.up,t),a.e.lerp(e.target,c.target,u.target,l)
const d=a.e.distance(c.target,c.position),p=a.e.distance(u.target,u.position),h=(0,i.Cc)(d,p,l)
a.e.sub(r,c.position,c.target),a.e.normalize(r,r),a.e.sub(s,u.position,u.target),a.e.normalize(s,s),o.k.rotationTo(n,r,s),o.k.slerp(n,o.k.Identity,n,l),a.e.transformQuat(r,r,n),a.e.scale(r,r,h),a.e.add(e.position,e.target,r),e.radius=(0,i.Cc)(c.radius,u.radius,l),e.radiusMax=(0,i.Cc)(c.radiusMax,u.radiusMax,l),e.fov=(0,i.Cc)(c.fov,u.fov,l),e.fog=(0,i.Cc)(c.fog,u.fog,l)}}(s||(s={}))
var l=n(15376),c=n(91229),u=n(39250),d=n(17370),p=n(23325)
const h=(0,d.Z)()
class f{get position(){return this.state.position}set position(e){a.e.copy(this.state.position,e)}get up(){return this.state.up}set up(e){a.e.copy(this.state.up,e)}get target(){return this.state.target}set target(e){a.e.copy(this.state.target,e)}update(){const e=this.state
if(0===e.radiusMax)return!1
const t=a.e.distance(e.position,e.target),n=this.minTargetDistance/this.scale
t<n&&(a.e.sub(this.deltaDirection,e.target,e.position),a.e.setMagnitude(this.deltaDirection,this.deltaDirection,n),a.e.sub(e.position,e.target,this.deltaDirection))
const r=2*Math.tan(e.fov/2)*a.e.distance(e.position,e.target)*this.scale
switch(this.zoom=this.viewport.height/r,function(e){const{forceFull:t,scale:n}=e
let{radius:r,radiusMax:i,mode:o,fog:s,clipFar:l,minNear:c,minFar:u}=e.state
i*=n,u*=n,c*=n,r*=n,t&&(r=i)
const d=.01*n
r<d&&(r=d)
const p=Math.max(l?r:i,u)
a.e.scale(g,e.state.target,n),a.e.scale(m,e.state.position,n)
const h=a.e.distance(m,g)
let f=t?.01:h-r,y=h+p
t&&(c=f),f=Math.max(Math.min(i,c),f),y=Math.max(c,y),f===y&&(y=f+.01*n)
const v=h-p*(-(50-s)/50),b=y
e.near=f,e.far=y,e.fogNear=v,e.fogFar=b}(this),this.state.mode){case"orthographic":!function(e){const{viewport:t,zoom:n,near:r,far:i,viewOffset:o}=e,a=-t.width/2,s=t.width/2,l=t.height/2,c=-t.height/2,d=(s-a)/(2*n),p=(l-c)/(2*n),h=(s+a)/2,f=(l+c)/2
let m=h-d,g=h+d,v=f+p,b=f-p
if(o.enabled){const e=n/(o.width/o.fullWidth),t=n/(o.height/o.fullHeight),r=(s-a)/o.width,i=(l-c)/o.height
m+=r*(o.offsetX/e),g=m+r*(o.width/e),v-=i*(o.offsetY/t),b=v-i*(o.height/t)}u.$.ortho(e.projection,m,g,v,b,r,i),y(e)}(this)
break
case"perspective":!function(e){const t=e.viewport.width/e.viewport.height,{near:n,far:r,viewOffset:i}=e
let o=n*Math.tan(.5*e.state.fov),a=2*o,s=t*a,l=-.5*s
i.enabled&&(l+=i.offsetX*s/i.fullWidth,o-=i.offsetY*a/i.fullHeight,s*=i.width/i.fullWidth,a*=i.height/i.fullHeight),u.$.perspective(e.projection,l,l+s,o,o-a,n,r),y(e)}(this)
break
default:(0,c.dr)(this.state.mode)}const i=!u.$.areEqual(this.projection,this.prevProjection,p.p)||!u.$.areEqual(this.view,this.prevView,p.p)
if(i){if(u.$.mul(this.projectionView,this.projection,this.view),!u.$.tryInvert(this.inverseProjectionView,this.projectionView))return u.$.copy(this.view,this.prevView),u.$.copy(this.projection,this.prevProjection),u.$.mul(this.projectionView,this.projection,this.view),!1
u.$.copy(this.prevView,this.view),u.$.copy(this.prevProjection,this.projection)}return i}setState(e,t){this.transition.apply(e,t),this.stateChanged.next(e)}getSnapshot(){return f.copySnapshot(f.createDefaultSnapshot(),this.state)}getTargetDistance(e){return Math.max(this.minTargetDistance/this.scale,f.targetDistance(e,this.state.mode,this.state.fov,this.viewport.width,this.viewport.height))}getFocus(e,t,n,r,i){var o,s
const l=Math.max(t,.01),c=this.getTargetDistance(l)
a.e.sub(this.deltaDirection,null!==(o=null==i?void 0:i.target)&&void 0!==o?o:this.target,null!==(s=null==i?void 0:i.position)&&void 0!==s?s:this.position),r&&a.e.matchDirection(this.deltaDirection,r,this.deltaDirection),a.e.setMagnitude(this.deltaDirection,this.deltaDirection,c),a.e.sub(this.newPosition,e,this.deltaDirection)
const u=f.copySnapshot(f.createDefaultSnapshot(),this.state)
return u.target=a.e.clone(e),u.radius=l,u.position=a.e.clone(this.newPosition),n&&a.e.matchDirection(u.up,n,u.up),u}getCenter(e,t){a.e.sub(this.deltaDirection,this.target,this.position),a.e.sub(this.newPosition,e,this.deltaDirection)
const n=f.copySnapshot(f.createDefaultSnapshot(),this.state)
return n.target=a.e.clone(e),n.position=a.e.clone(this.newPosition),t&&(n.radius=Math.max(t,.01)),n}getInvariantFocus(e,t,n,r){const i=Math.max(t,.01),o=this.getTargetDistance(i)
a.e.copy(this.deltaDirection,r),a.e.setMagnitude(this.deltaDirection,this.deltaDirection,o),a.e.sub(this.newPosition,e,this.deltaDirection)
const s=f.copySnapshot(f.createDefaultSnapshot(),this.state)
return s.target=a.e.clone(e),s.radius=i,s.position=a.e.clone(this.newPosition),a.e.copy(s.up,n),s}focus(e,t,n,r,i){t>0&&this.setState(this.getFocus(e,t,r,i),n)}center(e,t){this.setState(this.getCenter(e),t)}project(e,t){return(0,r.$u)(e,t,this.viewport,this.projectionView)}unproject(e,t){return(0,r.IW)(e,t,this.viewport,this.inverseProjectionView)}getPixelSize(e){this.project(h,e)
const t=h[3],n=this.viewport.width,r=this.projection[0]
return 2/t/(n*Math.abs(r))}getRay(e,t,n){return"orthographic"===this.state.mode?(a.e.set(e.origin,t,n,0),this.unproject(e.origin,e.origin),a.e.normalize(e.direction,a.e.sub(e.direction,this.target,this.position)),a.e.scaleAndAdd(e.origin,e.origin,e.direction,-this.near)):(a.e.copy(e.origin,this.state.position),a.e.scale(e.origin,e.origin,this.scale),a.e.set(e.direction,t,n,.5),this.unproject(e.direction,e.direction),a.e.normalize(e.direction,a.e.sub(e.direction,e.direction,e.origin))),e}constructor(e,t=r.LM.create(0,0,128,128)){this.view=u.$.identity(),this.projection=u.$.identity(),this.projectionView=u.$.identity(),this.inverseProjectionView=u.$.identity(),this.headRotation=u.$.zero(),this.viewEye=u.$.zero(),this.isAsymmetricProjection=!1,this.state=f.createDefaultSnapshot(),this.viewOffset=f.ViewOffset(),this.disabled=!1,this.near=1,this.far=1e4,this.fogNear=5e3,this.fogFar=1e4,this.zoom=1,this.forceFull=!1,this.scale=1,this.minTargetDistance=0,this.transition=new s(this),this.stateChanged=new l.t(this.state),this.prevProjection=u.$.identity(),this.prevView=u.$.identity(),this.deltaDirection=(0,a.e)(),this.newPosition=(0,a.e)(),this.viewport=t,f.copySnapshot(this.state,e)}}!function(e){e.ViewOffset=function(){return{enabled:!1,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}},e.setViewOffset=function(e,t,n,r,i,o,a){e.fullWidth=t,e.fullHeight=n,e.offsetX=r,e.offsetY=i,e.width=o,e.height=a},e.copyViewOffset=function(e,t){e.enabled=t.enabled,e.fullWidth=t.fullWidth,e.fullHeight=t.fullHeight,e.offsetX=t.offsetX,e.offsetY=t.offsetY,e.width=t.width,e.height=t.height},e.targetDistance=function(e,t,n,r,i){const o=Math.max(e,.01),a=i<r?1:r/i
return"orthographic"===t?Math.abs(o/a/Math.tan(n/2)):Math.abs(o/a/Math.sin(n/2))},e.createDefaultSnapshot=function(){return{mode:"perspective",fov:Math.PI/4,position:a.e.create(0,0,100),up:a.e.create(0,1,0),target:a.e.create(0,0,0),radius:0,radiusMax:10,fog:50,clipFar:!0,minNear:5,minFar:0}},e.copySnapshot=function(e,t){return t?(void 0!==t.mode&&(e.mode=t.mode),void 0!==t.fov&&(e.fov=t.fov),void 0!==t.position&&a.e.copy(e.position,t.position),void 0!==t.up&&a.e.copy(e.up,t.up),void 0!==t.target&&a.e.copy(e.target,t.target),void 0!==t.radius&&(e.radius=t.radius),void 0!==t.radiusMax&&(e.radiusMax=t.radiusMax),void 0!==t.fog&&(e.fog=t.fog),void 0!==t.clipFar&&(e.clipFar=t.clipFar),void 0!==t.minNear&&(e.minNear=t.minNear),void 0!==t.minFar&&(e.minFar=t.minFar),e):e},e.areSnapshotsEqual=function(e,t){return e.mode===t.mode&&e.fov===t.fov&&e.radius===t.radius&&e.radiusMax===t.radiusMax&&e.fog===t.fog&&e.clipFar===t.clipFar&&e.minNear===t.minNear&&e.minFar===t.minFar&&a.e.exactEquals(e.position,t.position)&&a.e.exactEquals(e.up,t.up)&&a.e.exactEquals(e.target,t.target)}}(f||(f={}))
const m=(0,a.e)(),g=(0,a.e)()
function y(e){1===e.scale?u.$.lookAt(e.view,e.state.position,e.state.target,e.state.up):(a.e.scale(m,e.state.position,e.scale),a.e.scale(g,e.state.target,e.scale),u.$.lookAt(e.view,m,g,e.state.up))}},92219(e,t,n){"use strict"
n.d(t,{RL:()=>s,ey:()=>p})
const r=new ArrayBuffer(4)
new Int32Array(r),new Float32Array(r)
const i=new ArrayBuffer(4),o=new Int32Array(i),a=new Float32Array(i)
function s(e){return function(e){const t=e<-126?-126:e
return o[0]=(1<<23)*(t+126.94269504),a[0]}(1.44269504*e)}const l=new ArrayBuffer(8)
new Int32Array(l),new Float32Array(l)
const c=new ArrayBuffer(4),u=new Int32Array(c),d=new Float32Array(c)
function p(e){return d[0]=e,1.1920928955078125e-7*u[0]-126.94269504}Math.PI,Math.PI,Math.PI,Math.PI,Math.PI,Math.PI,Math.PI,Math.PI,Math.PI
const h=new ArrayBuffer(16)
new Int32Array(h),new Float32Array(h)
const f=new ArrayBuffer(8)
new Int32Array(f),new Float32Array(f)
const m=new ArrayBuffer(4)
new Int32Array(m),new Float32Array(m),Math.PI},92384(e,t,n){"use strict"
n.d(t,{t:()=>r})
var r,i=n(9043),o=n(16124),a=n(37411),s=n(39250),l=n(95538),c=n(12288),u=n(1712),d=n(32372),p=n(23325)
!function(e){function t(e,t){return t?(t.label&&(e.label=t.label),t.description&&(e.description=t.description),t.legend&&(e.legend=t.legend),t.fieldLabels&&(e.fieldLabels=t.fieldLabels),t.isHidden&&(e.isHidden=t.isHidden),t.shortLabel&&(e.shortLabel=t.shortLabel),t.twoColumns&&(e.twoColumns=t.twoColumns),t.isEssential&&(e.isEssential=t.isEssential),t.category&&(e.category=t.category),t.hideIf&&(e.hideIf=t.hideIf),t.help&&(e.help=t.help),e):e}function n(e,n,r){return t({type:"select",defaultValue:B(e,n),options:n,cycle:null==r?void 0:r.cycle},r)}function r(e,t){return t?(void 0!==t.min&&(e.min=t.min),void 0!==t.max&&(e.max=t.max),void 0!==t.step&&(e.step=t.step),e):e}function h(e,n){const r=t({type:"group",defaultValue:(null==n?void 0:n.customDefault)||g(e),params:e},n)
return(null==n?void 0:n.presets)&&(r.presets=n.presets),(null==n?void 0:n.isExpanded)&&(r.isExpanded=n.isExpanded),(null==n?void 0:n.isFlat)&&(r.isFlat=n.isFlat),(null==n?void 0:n.pivot)&&(r.pivot=n.pivot),r}function f(){return g(this.element)}function m(){throw new Error("getValue not set. Fix runtime.")}function g(e){const t={}
for(const n of Object.keys(e))e[n].isOptional||(t[n]=e[n].defaultValue)
return t}function y(e,t,n){return()=>e(t,n)}function v(e,t,n){if(t)if("value-ref"===e.type){const r=t
r.ref?r.getValue=y(e.resolveRef,r.ref,n):r.getValue=()=>{throw new Error("Unset ref in ValueRef value.")}}else if("data-ref"===e.type){const e=t
e.ref?e.getValue=y(n,e.ref,n):e.getValue=()=>{throw new Error("Unset ref in ValueRef value.")}}else if("group"===e.type)S(e.params,t,n)
else if("mapped"===e.type){const r=t
v(e.map(r.name),r.params,n)}else if("object-list"===e.type){if(!x(e.element))return
for(const r of t)S(e.element,r,n)}}function b(e){if("value-ref"===e.type||"data-ref"===e.type)return!0
if("group"===e.type){if(x(e.params))return!0}else if("mapped"===e.type){for(const[t]of e.select.options)if(b(e.map(t)))return!0}else if("object-list"===e.type)return x(e.element)
return!1}function x(e){for(const t of Object.keys(e))if(b(e[t]))return!0
return!1}function S(e,t,n){for(const r of Object.keys(e))v(e[r],null==t?void 0:t[r],n)}function _(e,t,n){if(t===n)return!0
if("object"!=typeof t||"object"!=typeof n)return!1
for(const r of Object.keys(e))if(!C(e[r],t[r],n[r]))return!1
return!0}function C(e,t,n){if(t===n)return!0
if("group"===e.type)return _(e.params,t,n)
if("mapped"===e.type){const r=t,i=n
return r.name===i.name&&C(e.map(r.name),r.params,i.params)}if("multi-select"===e.type){const e=t,r=n
if(e.length!==r.length)return!1
if(e.length<10){for(let t=0,n=e.length;t<n;t++)if(e[t]!==r[t]&&r.indexOf(e[t])<0)return!1}else{const t=new Set(r)
for(let n=0,i=e.length;n<i;n++)if(e[n]!==r[n]&&!t.has(e[n]))return!1}return!0}if("interval"===e.type)return t[0]===n[0]&&t[1]===n[1]
if("line-graph"===e.type){const e=t,r=n
if(e.length!==r.length)return!1
for(let t=0,n=e.length;t<n;t++)if(!o.Z.areEqual(e[t],r[t]))return!1
return!0}if("vec3"===e.type)return a.e.equals(t,n)
if("mat4"===e.type)return s.$.areEqual(t,n,p.p)
if("script"===e.type){const e=t,r=n
return e.language===r.language&&e.expression===r.expression}if("object-list"===e.type){const r=t,i=n,o=r.length
if(o!==i.length)return!1
for(let t=0;t<o;t++)if(!_(e.element,r[t],i[t]))return!1
return!0}return"object"==typeof t&&"object"==typeof n&&(0,i.f8)(t,n)}function w(e,t,n){if(void 0===t)return{...n}
if(void 0===n)return{...t}
const r={}
for(const i of Object.keys(e))r[i]=T(e[i],t[i],n[i])
return r}function T(e,t,n){if(void 0===t)return"object"!=typeof n||Array.isArray(n)?n:{...n}
if(void 0===n)return"object"!=typeof t||Array.isArray(t)?t:{...t}
if("group"===e.type)return w(e.params,t,n)
if("mapped"===e.type){const r=t,i=n
if(r.name!==i.name)return{...i}
const o=e.map(i.name)
return{name:i.name,params:T(o,r.params,i.params)}}return"value"===e.type?n:"object"==typeof t&&"object"==typeof n?Array.isArray(n)?n:{...t,...n}:n}function A(e,t){for(const n of e.options)if(n[0]===t)return!0
return!1}function I(e,t,n){if(null==t)return n?e.defaultValue:void 0
if("value"===e.type)return t
if("group"===e.type){const r={}
for(const i of Object.keys(e.params)){const o=e.params[i]
void 0===t[i]?n&&(r[i]=o.defaultValue):r[i]=I(o,t[i],n)}return r}if("mapped"===e.type){const r=t
if("string"!=typeof r.name)return e.defaultValue
if(void 0===r.params)return n?e.defaultValue:void 0
if(!A(e.select,r.name))return e.defaultValue
const i=e.map(r.name)
return{name:r.name,params:I(i,r.params,n)}}if("select"===e.type)return A(e,t)?t:e.defaultValue
if("multi-select"===e.type){if(!Array.isArray(t))return e.defaultValue
const n=t.filter(function(e){return A(this,e)},e)
return t.length>0&&0===n.length?e.defaultValue:n}return"object-list"===e.type?Array.isArray(t)?t.map(t=>P(e.element,t,n?"all":"skip")):e.defaultValue:t}function P(e,t,n){if("object"!=typeof t||null===t)return n?g(e):t
const r={}
for(const i of Object.keys(e)){const o=e[i]
void 0===t[i]?"all"===n&&(r[i]=o.defaultValue):r[i]=I(o,t[i],"skip"!==n)}return r}function B(e,t){for(const n of t)if(n[0]===e)return e
return t.length>0?t[0][0]:void 0}e.Essential={isEssential:!0},e.Optional=function(e){const t={...e}
return t.isOptional=!0,t},e.Value=function(e,n){return t({type:"value",defaultValue:e},n)},e.Select=n,e.MultiSelect=function(e,n,r){const i=t({type:"multi-select",defaultValue:e,options:n},r)
return(null==r?void 0:r.emptyValue)&&(i.emptyValue=r.emptyValue),i},e.Boolean=function(e,n){return t({type:"boolean",defaultValue:e},n)},e.Text=function(e="",n){return t({type:"text",defaultValue:e,multiline:null==n?void 0:n.multiline,placeholder:null==n?void 0:n.placeholder,disableInteractiveUpdates:null==n?void 0:n.disableInteractiveUpdates},n)},e.Color=function(e,n){const r=t({type:"color",defaultValue:e},n)
return(null==n?void 0:n.isExpanded)&&(r.isExpanded=n.isExpanded),r},e.ColorList=function(e,n){let r
if("string"==typeof e){const t=(0,u.JA)(e)
r={kind:"qualitative"!==t.type?"interpolate":"set",colors:t.list}}else r=e
return t({type:"color-list",presetKind:(null==n?void 0:n.presetKind)||"all",defaultValue:r,offsets:!!(null==n?void 0:n.offsets)},n)},e.Vec3=function(e,n,i){return t(r({type:"vec3",defaultValue:e},n),i)},e.Mat4=function(e,n){return t({type:"mat4",defaultValue:e},n)},e.Url=function(e,n){return t({type:"url",defaultValue:"string"==typeof e?d.V.Url(e):d.V.Url(e.url,{body:e.body})},n)},e.File=function(e){const n=t({type:"file",defaultValue:null},e)
return(null==e?void 0:e.accept)&&(n.accept=e.accept),n},e.FileList=function(e){const n=t({type:"file-list",defaultValue:null},e)
return(null==e?void 0:e.accept)&&(n.accept=e.accept),n},e.Numeric=function(e,n,i){const o=t(r({type:"number",defaultValue:e},n),i)
return(null==i?void 0:i.immediateUpdate)&&(o.immediateUpdate=!0),o},e.Interval=function(e,n,i){return t(r({type:"interval",defaultValue:e},n),i)},e.LineGraph=function(e,n){const r=t({type:"line-graph",defaultValue:e},n)
return(null==n?void 0:n.getVolume)&&(r.getVolume=n.getVolume),r},e.Group=h,e.EmptyGroup=function(e){return h({},e)},e.Mapped=function(e,r,i,o){const a=B(e,r)
return t({type:"mapped",defaultValue:{name:a,params:i(a).defaultValue},select:n(a,r,o),map:i},o)},e.MappedStatic=function(e,r,i){const o=(null==i?void 0:i.options)?i.options:Object.keys(r).map(e=>[e,r[e].label||(0,c.Mk)(e)]),a=B(e,o)
return t({type:"mapped",defaultValue:{name:a,params:r[a].defaultValue},select:n(a,o,i),map:e=>r[e]},i)},e.ObjectList=function(e,n,r){return t({type:"object-list",element:e,getLabel:n,ctor:f,defaultValue:(null==r?void 0:r.defaultValue)||[]},r)},e.ValueRef=function(e,n,r){var i
return t({type:"value-ref",defaultValue:{ref:null!==(i=null==r?void 0:r.defaultRef)&&void 0!==i?i:"",getValue:m},getOptions:e,resolveRef:n},r)},e.DataRef=function(e){var n
return t({type:"data-ref",defaultValue:{ref:null!==(n=null==e?void 0:e.defaultRef)&&void 0!==n?n:"",getValue:m}},e)},e.Converted=function(e,n,r){return t({type:"converted",defaultValue:n(r.defaultValue),converted:r,fromValue:e,toValue:n},r)},e.Conditioned=function(e,r,i,o,a){const s=Object.keys(r).map(e=>[e,e])
return t({type:"conditioned",select:n(i(e),s,a),defaultValue:e,conditionParams:r,conditionForValue:i,conditionedValue:o},a)},e.Script=function(e,n){return t({type:"script",defaultValue:e},n)},e.For=function(e){return 0},e.getDefaultValues=g,e.resolveRefs=S,e.setDefaultValues=function(e,t){for(const n of Object.keys(e))e[n].isOptional||(e[n].defaultValue=t[n])},e.clone=function(e){return(0,l.Go)(e)},e.validate=function(e,t){},e.areEqual=_,e.isParamEqual=C,e.merge=w,e.mergeParam=T,e.normalizeParams=P,e.objectToOptions=function(e,t){const n=[]
for(const r of Object.keys(e))if(t){const i=t(r,e[r])
n.push("string"==typeof i?[r,i]:[r,i[0],i[1]])}else"string"==typeof e[r]?n.push([r,e[r]]):n.push([r,null===t?r:(0,c.Mk)(r)])
return n},e.arrayToOptions=function(e,t){const n=[]
for(const r of e)t?n.push([r,t(r)]):n.push([r,null===t?r:(0,c.Mk)(r)])
return n},e.optionLabel=function(e,t){for(const n of e.options)if(n[0]===t)return n[1]
return""},e.withDefaults=function(e,t){const n={}
for(const r of Object.keys(t)){const i=t[r]
e[r]&&null!=i&&e[r].defaultValue!==i&&(n[r]={...e[r],defaultValue:i})}return{...e,...n}}}(r||(r={}))},92426(e,t,n){"use strict"
n.d(t,{B8:()=>Xt,CD:()=>Wn,T5:()=>vt,uY:()=>cn})
var r="@@__IMMUTABLE_INDEXED__@@"
function i(e){return Boolean(e&&e[r])}var o="@@__IMMUTABLE_KEYED__@@"
function a(e){return Boolean(e&&e[o])}function s(e){return a(e)||i(e)}var l="@@__IMMUTABLE_ITERABLE__@@"
function c(e){return Boolean(e&&e[l])}var u=function(e){return c(e)?e:$(e)},d=function(e){function t(e){return a(e)?e:X(e)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(u),p=function(e){function t(e){return i(e)?e:W(e)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(u),h=function(e){function t(e){return c(e)&&!s(e)?e:Y(e)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(u)
u.Keyed=d,u.Indexed=p,u.Set=h
var f="function"==typeof Symbol&&Symbol.iterator,m="@@iterator",g=f||m,y=function(e){this.next=e}
function v(e,t,n,r){var i=0===e?t:1===e?n:[t,n]
return r?r.value=i:r={value:i,done:!1},r}function b(){return{value:void 0,done:!0}}function x(e){return!!Array.isArray(e)||!!C(e)}function S(e){return!(!e||"function"!=typeof e.next)}function _(e){var t=C(e)
return t&&t.call(e)}function C(e){var t=e&&(f&&e[f]||e[m])
if("function"==typeof t)return t}y.prototype.toString=function(){return"[Iterator]"},y.KEYS=0,y.VALUES=1,y.ENTRIES=2,y.prototype.inspect=y.prototype.toSource=function(){return this.toString()},y.prototype[g]=function(){return this}
var w="delete",T=32,A=31,I={}
function P(e){e&&(e.value=!0)}function B(){}function E(e){return void 0===e.size&&(e.size=e.__iterate(D)),e.size}function k(e,t){if("number"!=typeof t){var n=t>>>0
if(""+n!==t||4294967295===n)return NaN
t=n}return t<0?E(e)+t:t}function D(){return!0}function M(e,t,n){return(0===e&&!N(e)||void 0!==n&&e<=-n)&&(void 0===t||void 0!==n&&t>=n)}function R(e,t){return L(e,t,0)}function O(e,t){return L(e,t,t)}function L(e,t,n){return void 0===e?n:N(e)?t===1/0?t:0|Math.max(0,t+e):void 0===t||t===e?e:0|Math.min(t,e)}function N(e){return e<0||0===e&&1/e==-1/0}var F="@@__IMMUTABLE_RECORD__@@"
function z(e){return Boolean(e&&e[F])}function j(e){return c(e)||z(e)}var V="@@__IMMUTABLE_ORDERED__@@"
function U(e){return Boolean(e&&e[V])}var G="@@__IMMUTABLE_SEQ__@@"
function H(e){return Boolean(e&&e[G])}var q=Object.prototype.hasOwnProperty
function Q(e){return!(!Array.isArray(e)&&"string"!=typeof e)||e&&"object"==typeof e&&Number.isInteger(e.length)&&e.length>=0&&(0===e.length?1===Object.keys(e).length:e.hasOwnProperty(e.length-1))}var $=function(e){function t(e){return null==e?te():j(e)?e.toSeq():function(e){var t,n,r=ie(e)
if(r)return(n=C(t=e))&&n===t.entries?r.fromEntrySeq():function(e){var t=C(e)
return t&&t===e.keys}(e)?r.toSetSeq():r
if("object"==typeof e)return new K(e)
throw new TypeError("Expected Array or collection object of values, or keyed object: "+e)}(e)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toSeq=function(){return this},t.prototype.toString=function(){return this.__toString("Seq {","}")},t.prototype.cacheResult=function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},t.prototype.__iterate=function(e,t){var n=this._cache
if(n){for(var r=n.length,i=0;i!==r;){var o=n[t?r-++i:i++]
if(!1===e(o[1],o[0],this))break}return i}return this.__iterateUncached(e,t)},t.prototype.__iterator=function(e,t){var n=this._cache
if(n){var r=n.length,i=0
return new y(function(){if(i===r)return{value:void 0,done:!0}
var o=n[t?r-++i:i++]
return v(e,o[0],o[1])})}return this.__iteratorUncached(e,t)},t}(u),X=function(e){function t(e){return null==e?te().toKeyedSeq():c(e)?a(e)?e.toSeq():e.fromEntrySeq():z(e)?e.toSeq():ne(e)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toKeyedSeq=function(){return this},t}($),W=function(e){function t(e){return null==e?te():c(e)?a(e)?e.entrySeq():e.toIndexedSeq():z(e)?e.toSeq().entrySeq():re(e)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return t(arguments)},t.prototype.toIndexedSeq=function(){return this},t.prototype.toString=function(){return this.__toString("Seq [","]")},t}($),Y=function(e){function t(e){return(c(e)&&!s(e)?e:W(e)).toSetSeq()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return t(arguments)},t.prototype.toSetSeq=function(){return this},t}($)
$.isSeq=H,$.Keyed=X,$.Set=Y,$.Indexed=W,$.prototype[G]=!0
var Z=function(e){function t(e){this._array=e,this.size=e.length}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(e,t){return this.has(e)?this._array[k(this,e)]:t},t.prototype.__iterate=function(e,t){for(var n=this._array,r=n.length,i=0;i!==r;){var o=t?r-++i:i++
if(!1===e(n[o],o,this))break}return i},t.prototype.__iterator=function(e,t){var n=this._array,r=n.length,i=0
return new y(function(){if(i===r)return{value:void 0,done:!0}
var o=t?r-++i:i++
return v(e,o,n[o])})},t}(W),K=function(e){function t(e){var t=Object.keys(e).concat(Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e):[])
this._object=e,this._keys=t,this.size=t.length}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(e,t){return void 0===t||this.has(e)?this._object[e]:t},t.prototype.has=function(e){return q.call(this._object,e)},t.prototype.__iterate=function(e,t){for(var n=this._object,r=this._keys,i=r.length,o=0;o!==i;){var a=r[t?i-++o:o++]
if(!1===e(n[a],a,this))break}return o},t.prototype.__iterator=function(e,t){var n=this._object,r=this._keys,i=r.length,o=0
return new y(function(){if(o===i)return{value:void 0,done:!0}
var a=r[t?i-++o:o++]
return v(e,a,n[a])})},t}(X)
K.prototype[V]=!0
var J,ee=function(e){function t(e){this._collection=e,this.size=e.length||e.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.__iterateUncached=function(e,t){if(t)return this.cacheResult().__iterate(e,t)
var n=_(this._collection),r=0
if(S(n))for(var i;!(i=n.next()).done&&!1!==e(i.value,r++,this););return r},t.prototype.__iteratorUncached=function(e,t){if(t)return this.cacheResult().__iterator(e,t)
var n=_(this._collection)
if(!S(n))return new y(b)
var r=0
return new y(function(){var t=n.next()
return t.done?t:v(e,r++,t.value)})},t}(W)
function te(){return J||(J=new Z([]))}function ne(e){var t=ie(e)
if(t)return t.fromEntrySeq()
if("object"==typeof e)return new K(e)
throw new TypeError("Expected Array or collection object of [k, v] entries, or keyed object: "+e)}function re(e){var t=ie(e)
if(t)return t
throw new TypeError("Expected Array or collection object of values: "+e)}function ie(e){return Q(e)?new Z(e):x(e)?new ee(e):void 0}function oe(){return this.__ensureOwner()}function ae(){return this.__ownerID?this:this.__ensureOwner(new B)}var se="function"==typeof Math.imul&&-2===Math.imul(4294967295,2)?Math.imul:function(e,t){var n=65535&(e|=0),r=65535&(t|=0)
return n*r+((e>>>16)*r+n*(t>>>16)<<16>>>0)|0}
function le(e){return e>>>1&1073741824|3221225471&e}var ce=Object.prototype.valueOf
function ue(e){if(null==e)return de(e)
if("function"==typeof e.hashCode)return le(e.hashCode(e))
var t,n,r,i=(t=e).valueOf!==ce&&"function"==typeof t.valueOf?t.valueOf(t):t
if(null==i)return de(i)
switch(typeof i){case"boolean":return i?1108378657:1108378656
case"number":return function(e){if(e!=e||e===1/0)return 0
var t=0|e
for(t!==e&&(t^=4294967295*e);e>4294967295;)t^=e/=4294967295
return le(t)}(i)
case"string":return i.length>Se?(void 0===(r=we[n=i])&&(r=pe(n),Ce===_e&&(Ce=0,we={}),Ce++,we[n]=r),r):pe(i)
case"object":case"function":return function(e){var t
if(ye&&void 0!==(t=ge.get(e)))return t
if(void 0!==(t=e[xe]))return t
if(!fe){if(void 0!==(t=e.propertyIsEnumerable&&e.propertyIsEnumerable[xe]))return t
if(void 0!==(t=function(e){if(e&&e.nodeType>0)switch(e.nodeType){case 1:return e.uniqueID
case 9:return e.documentElement&&e.documentElement.uniqueID}}(e)))return t}if(t=me(),ye)ge.set(e,t)
else{if(void 0!==he&&!1===he(e))throw new Error("Non-extensible objects are not allowed as keys.")
if(fe)Object.defineProperty(e,xe,{enumerable:!1,configurable:!1,writable:!1,value:t})
else if(void 0!==e.propertyIsEnumerable&&e.propertyIsEnumerable===e.constructor.prototype.propertyIsEnumerable)e.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},e.propertyIsEnumerable[xe]=t
else{if(void 0===e.nodeType)throw new Error("Unable to set a non-enumerable property on object.")
e[xe]=t}}return t}(i)
case"symbol":return function(e){var t=ve[e]
return void 0!==t||(t=me(),ve[e]=t),t}(i)
default:if("function"==typeof i.toString)return pe(i.toString())
throw new Error("Value type "+typeof i+" cannot be hashed.")}}function de(e){return null===e?1108378658:1108378659}function pe(e){for(var t=0,n=0;n<e.length;n++)t=31*t+e.charCodeAt(n)|0
return le(t)}var he=Object.isExtensible,fe=function(){try{return Object.defineProperty({},"@",{}),!0}catch(e){return!1}}()
function me(){var e=++be
return 1073741824&be&&(be=0),e}var ge,ye="function"==typeof WeakMap
ye&&(ge=new WeakMap)
var ve=Object.create(null),be=0,xe="__immutablehash__"
"function"==typeof Symbol&&(xe=Symbol(xe))
var Se=16,_e=255,Ce=0,we={},Te=function(e){function t(e,t){this._iter=e,this._useKeys=t,this.size=e.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(e,t){return this._iter.get(e,t)},t.prototype.has=function(e){return this._iter.has(e)},t.prototype.valueSeq=function(){return this._iter.valueSeq()},t.prototype.reverse=function(){var e=this,t=ke(this,!0)
return this._useKeys||(t.valueSeq=function(){return e._iter.toSeq().reverse()}),t},t.prototype.map=function(e,t){var n=this,r=Ee(this,e,t)
return this._useKeys||(r.valueSeq=function(){return n._iter.toSeq().map(e,t)}),r},t.prototype.__iterate=function(e,t){var n=this
return this._iter.__iterate(function(t,r){return e(t,r,n)},t)},t.prototype.__iterator=function(e,t){return this._iter.__iterator(e,t)},t}(X)
Te.prototype[V]=!0
var Ae=function(e){function t(e){this._iter=e,this.size=e.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.includes=function(e){return this._iter.includes(e)},t.prototype.__iterate=function(e,t){var n=this,r=0
return t&&E(this),this._iter.__iterate(function(i){return e(i,t?n.size-++r:r++,n)},t)},t.prototype.__iterator=function(e,t){var n=this,r=this._iter.__iterator(1,t),i=0
return t&&E(this),new y(function(){var o=r.next()
return o.done?o:v(e,t?n.size-++i:i++,o.value,o)})},t}(W),Ie=function(e){function t(e){this._iter=e,this.size=e.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.has=function(e){return this._iter.includes(e)},t.prototype.__iterate=function(e,t){var n=this
return this._iter.__iterate(function(t){return e(t,t,n)},t)},t.prototype.__iterator=function(e,t){var n=this._iter.__iterator(1,t)
return new y(function(){var t=n.next()
return t.done?t:v(e,t.value,t.value,t)})},t}(Y),Pe=function(e){function t(e){this._iter=e,this.size=e.size}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.entrySeq=function(){return this._iter.toSeq()},t.prototype.__iterate=function(e,t){var n=this
return this._iter.__iterate(function(t){if(t){Ue(t)
var r=c(t)
return e(r?t.get(1):t[1],r?t.get(0):t[0],n)}},t)},t.prototype.__iterator=function(e,t){var n=this._iter.__iterator(1,t)
return new y(function(){for(;;){var t=n.next()
if(t.done)return t
var r=t.value
if(r){Ue(r)
var i=c(r)
return v(e,i?r.get(0):r[0],i?r.get(1):r[1],t)}}})},t}(X)
function Be(e){var t=He(e)
return t._iter=e,t.size=e.size,t.flip=function(){return e},t.reverse=function(){var t=e.reverse.apply(this)
return t.flip=function(){return e.reverse()},t},t.has=function(t){return e.includes(t)},t.includes=function(t){return e.has(t)},t.cacheResult=qe,t.__iterateUncached=function(t,n){var r=this
return e.__iterate(function(e,n){return!1!==t(n,e,r)},n)},t.__iteratorUncached=function(t,n){if(2===t){var r=e.__iterator(t,n)
return new y(function(){var e=r.next()
if(!e.done){var t=e.value[0]
e.value[0]=e.value[1],e.value[1]=t}return e})}return e.__iterator(1===t?0:1,n)},t}function Ee(e,t,n){var r=He(e)
return r.size=e.size,r.has=function(t){return e.has(t)},r.get=function(r,i){var o=e.get(r,I)
return o===I?i:t.call(n,o,r,e)},r.__iterateUncached=function(r,i){var o=this
return e.__iterate(function(e,i,a){return!1!==r(t.call(n,e,i,a),i,o)},i)},r.__iteratorUncached=function(r,i){var o=e.__iterator(2,i)
return new y(function(){var i=o.next()
if(i.done)return i
var a=i.value,s=a[0]
return v(r,s,t.call(n,a[1],s,e),i)})},r}function ke(e,t){var n=this,r=He(e)
return r._iter=e,r.size=e.size,r.reverse=function(){return e},e.flip&&(r.flip=function(){var t=Be(e)
return t.reverse=function(){return e.flip()},t}),r.get=function(n,r){return e.get(t?n:-1-n,r)},r.has=function(n){return e.has(t?n:-1-n)},r.includes=function(t){return e.includes(t)},r.cacheResult=qe,r.__iterate=function(n,r){var i=this,o=0
return r&&E(e),e.__iterate(function(e,a){return n(e,t?a:r?i.size-++o:o++,i)},!r)},r.__iterator=function(r,i){var o=0
i&&E(e)
var a=e.__iterator(2,!i)
return new y(function(){var e=a.next()
if(e.done)return e
var s=e.value
return v(r,t?s[0]:i?n.size-++o:o++,s[1],e)})},r}function De(e,t,n,r){var i=He(e)
return r&&(i.has=function(r){var i=e.get(r,I)
return i!==I&&!!t.call(n,i,r,e)},i.get=function(r,i){var o=e.get(r,I)
return o!==I&&t.call(n,o,r,e)?o:i}),i.__iterateUncached=function(i,o){var a=this,s=0
return e.__iterate(function(e,o,l){if(t.call(n,e,o,l))return s++,i(e,r?o:s-1,a)},o),s},i.__iteratorUncached=function(i,o){var a=e.__iterator(2,o),s=0
return new y(function(){for(;;){var o=a.next()
if(o.done)return o
var l=o.value,c=l[0],u=l[1]
if(t.call(n,u,c,e))return v(i,r?c:s++,u,o)}})},i}function Me(e,t,n,r){var i=e.size
if(M(t,n,i))return e
if(void 0===i&&(t<0||n<0))return Me(e.toSeq().cacheResult(),t,n,r)
var o,a=R(t,i),s=O(n,i)-a
s==s&&(o=s<0?0:s)
var l=He(e)
return l.size=0===o?o:e.size&&o||void 0,!r&&H(e)&&o>=0&&(l.get=function(t,n){return(t=k(this,t))>=0&&t<o?e.get(t+a,n):n}),l.__iterateUncached=function(t,n){var i=this
if(0===o)return 0
if(n)return this.cacheResult().__iterate(t,n)
var s=0,l=!0,c=0
return e.__iterate(function(e,n){if(!l||!(l=s++<a))return c++,!1!==t(e,r?n:c-1,i)&&c!==o}),c},l.__iteratorUncached=function(t,n){if(0!==o&&n)return this.cacheResult().__iterator(t,n)
if(0===o)return new y(b)
var i=e.__iterator(t,n),s=0,l=0
return new y(function(){for(;s++<a;)i.next()
if(++l>o)return{value:void 0,done:!0}
var e=i.next()
return r||1===t||e.done?e:v(t,l-1,0===t?void 0:e.value[1],e)})},l}function Re(e,t,n,r){var i=He(e)
return i.__iterateUncached=function(i,o){var a=this
if(o)return this.cacheResult().__iterate(i,o)
var s=!0,l=0
return e.__iterate(function(e,o,c){if(!s||!(s=t.call(n,e,o,c)))return l++,i(e,r?o:l-1,a)}),l},i.__iteratorUncached=function(i,o){var a=this
if(o)return this.cacheResult().__iterator(i,o)
var s=e.__iterator(2,o),l=!0,c=0
return new y(function(){var e,o,u
do{if((e=s.next()).done)return r||1===i?e:v(i,c++,0===i?void 0:e.value[1],e)
var d=e.value
o=d[0],u=d[1],l&&(l=t.call(n,u,o,a))}while(l)
return 2===i?e:v(i,o,u,e)})},i}Ae.prototype.cacheResult=Te.prototype.cacheResult=Ie.prototype.cacheResult=Pe.prototype.cacheResult=qe
var Oe=function(e){function t(e){this._wrappedIterables=e.flatMap(function(e){return e._wrappedIterables?e._wrappedIterables:[e]}),this.size=this._wrappedIterables.reduce(function(e,t){if(void 0!==e){var n=t.size
if(void 0!==n)return e+n}},0),this[o]=this._wrappedIterables[0][o],this[r]=this._wrappedIterables[0][r],this[V]=this._wrappedIterables[0][V]}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.__iterateUncached=function(e,t){if(0!==this._wrappedIterables.length){if(t)return this.cacheResult().__iterate(e,t)
for(var n=0,r=a(this),i=r?2:1,o=this._wrappedIterables[n].__iterator(i,t),s=!0,l=0;s;){for(var c=o.next();c.done;){if(++n===this._wrappedIterables.length)return l
c=(o=this._wrappedIterables[n].__iterator(i,t)).next()}s=!1!==(r?e(c.value[1],c.value[0],this):e(c.value,l,this)),l++}return l}},t.prototype.__iteratorUncached=function(e,t){var n=this
if(0===this._wrappedIterables.length)return new y(b)
if(t)return this.cacheResult().__iterator(e,t)
var r=0,i=this._wrappedIterables[r].__iterator(e,t)
return new y(function(){for(var o=i.next();o.done;){if(++r===n._wrappedIterables.length)return o
o=(i=n._wrappedIterables[r].__iterator(e,t)).next()}return o})},t}($)
function Le(e,t,n){var r=He(e)
return r.__iterateUncached=function(i,o){if(o)return this.cacheResult().__iterate(i,o)
var a=0,s=!1
return function e(l,u){l.__iterate(function(o,l){return(!t||u<t)&&c(o)?e(o,u+1):(a++,!1===i(o,n?l:a-1,r)&&(s=!0)),!s},o)}(e,0),a},r.__iteratorUncached=function(r,i){if(i)return this.cacheResult().__iterator(r,i)
var o=e.__iterator(r,i),a=[],s=0
return new y(function(){for(;o;){var e=o.next()
if(!1===e.done){var l=e.value
if(2===r&&(l=l[1]),t&&!(a.length<t)||!c(l))return n?e:v(r,s++,l,e)
a.push(o),o=l.__iterator(r,i)}else o=a.pop()}return{value:void 0,done:!0}})},r}function Ne(e,t,n){t||(t=Qe)
var r=a(e),o=0,s=e.toSeq().map(function(t,r){return[r,t,o++,n?n(t,r,e):t]}).valueSeq().toArray()
return s.sort(function(e,n){return t(e[3],n[3])||e[2]-n[2]}).forEach(r?function(e,t){s[t].length=2}:function(e,t){s[t]=e[1]}),r?X(s):i(e)?W(s):Y(s)}function Fe(e,t,n){if(t||(t=Qe),n){var r=e.toSeq().map(function(t,r){return[t,n(t,r,e)]}).reduce(function(e,n){return ze(t,e[1],n[1])?n:e})
return r&&r[0]}return e.reduce(function(e,n){return ze(t,e,n)?n:e})}function ze(e,t,n){var r=e(n,t)
return 0===r&&n!==t&&(null==n||n!=n)||r>0}function je(e,t,n,r){var i=He(e),o=new Z(n).map(function(e){return e.size})
return i.size=r?o.max():o.min(),i.__iterate=function(e,t){for(var n,r=this.__iterator(1,t),i=0;!(n=r.next()).done&&!1!==e(n.value,i++,this););return i},i.__iteratorUncached=function(e,i){var o=n.map(function(e){return e=u(e),_(i?e.reverse():e)}),a=0,s=!1
return new y(function(){var n
return s||(n=o.map(function(e){return e.next()}),s=r?n.every(function(e){return e.done}):n.some(function(e){return e.done})),s?{value:void 0,done:!0}:v(e,a++,t.apply(null,n.map(function(e){return e.value})))})},i}function Ve(e,t){return e===t?e:H(e)?t:e.constructor(t)}function Ue(e){if(e!==Object(e))throw new TypeError("Expected [K, V] tuple: "+e)}function Ge(e){return a(e)?d:i(e)?p:h}function He(e){return Object.create((a(e)?X:i(e)?W:Y).prototype)}function qe(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):$.prototype.cacheResult.call(this)}function Qe(e,t){return void 0===e&&void 0===t?0:void 0===e?1:void 0===t?-1:e>t?1:e<t?-1:0}function $e(e){return Boolean(e&&"function"==typeof e.equals&&"function"==typeof e.hashCode)}function Xe(e,t){if(e===t||e!=e&&t!=t)return!0
if(!e||!t)return!1
if("function"==typeof e.valueOf&&"function"==typeof t.valueOf){if((e=e.valueOf())===(t=t.valueOf())||e!=e&&t!=t)return!0
if(!e||!t)return!1}return!!($e(e)&&$e(t)&&e.equals(t))}function We(e,t,n,r){return Gt(e,[t],n,r)}function Ye(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t]
return Ke(this,e)}function Ze(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1]
if("function"!=typeof e)throw new TypeError("Invalid merger function: "+e)
return Ke(this,t,e)}function Ke(e,t,n){for(var r=[],i=0;i<t.length;i++){var o=d(t[i])
0!==o.size&&r.push(o)}return 0===r.length?e:0!==e.toSeq().size||e.__ownerID||1!==r.length?e.withMutations(function(e){for(var t=n?function(t,r){We(e,r,I,function(e){return e===I?t:n(e,t,r)})}:function(t,n){e.set(n,t)},i=0;i<r.length;i++)r[i].forEach(t)}):z(e)?e:e.constructor(r[0])}var Je=Object.prototype.toString
function et(e){return"object"==typeof e&&(j(e)||Array.isArray(e)||function(e){if(!e||"object"!=typeof e||"[object Object]"!==Je.call(e))return!1
var t=Object.getPrototypeOf(e)
if(null===t)return!0
for(var n=t,r=Object.getPrototypeOf(t);null!==r;)n=r,r=Object.getPrototypeOf(n)
return n===t}(e))}function tt(e,t){t=t||0
for(var n=Math.max(0,e.length-t),r=new Array(n),i=0;i<n;i++)r[i]=e[i+t]
return r}function nt(e){if(Array.isArray(e))return tt(e)
var t={}
for(var n in e)q.call(e,n)&&(t[n]=e[n])
return t}function rt(e,t,n){return it(e,t,function(e){return function t(n,r,o){return et(n)&&et(r)&&(s=r,l=$(n),c=$(s),i(l)===i(c)&&a(l)===a(c))?it(n,[r],t):e?e(n,r,o):r
var s,l,c}}(n))}function it(e,t,n){if(!et(e))throw new TypeError("Cannot merge into non-data-structure value: "+e)
if(j(e))return"function"==typeof n&&e.mergeWith?e.mergeWith.apply(e,[n].concat(t)):e.merge?e.merge.apply(e,t):e.concat.apply(e,t)
for(var r=Array.isArray(e),i=e,o=r?p:d,a=r?function(t){i===e&&(i=nt(i)),i.push(t)}:function(t,r){var o=q.call(i,r),a=o&&n?n(i[r],t,r):t
o&&a===i[r]||(i===e&&(i=nt(i)),i[r]=a)},s=0;s<t.length;s++)o(t[s]).forEach(a)
return i}function ot(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t]
return rt(this,e)}function at(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1]
return rt(this,t,e)}function st(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1]
return Gt(this,e,Et(),function(e){return rt(e,t)})}function lt(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1]
return Gt(this,e,Et(),function(e){return it(e,t)})}function ct(e,t){return function(e,t,n){return Gt(e,t,I,function(){return n})}(this,e,t)}function ut(e,t,n){return 1===arguments.length?e(this):We(this,e,t,n)}function dt(e,t,n){return Gt(this,e,t,n)}function pt(){return this.__altered}function ht(e){var t=this.asMutable()
return e(t),t.wasAltered()?t.__ensureOwner(this.__ownerID):this}var ft="@@__IMMUTABLE_MAP__@@"
function mt(e){return Boolean(e&&e[ft])}function gt(e,t){if(!e)throw new Error(t)}function yt(e){gt(e!==1/0,"Cannot perform this action with an infinite size.")}var vt=function(e){function t(t){return null==t?Et():mt(t)&&!U(t)?t:Et().withMutations(function(n){var r=e(t)
yt(r.size),r.forEach(function(e,t){return n.set(t,e)})})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toString=function(){return this.__toString("Map {","}")},t.prototype.get=function(e,t){return this._root?this._root.get(0,void 0,e,t):t},t.prototype.set=function(e,t){return kt(this,e,t)},t.prototype.remove=function(e){return kt(this,e,I)},t.prototype.deleteAll=function(e){var t=u(e)
return 0===t.size?this:this.withMutations(function(e){t.forEach(function(t){return e.remove(t)})})},t.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):Et()},t.prototype.sort=function(e){return cn(Ne(this,e))},t.prototype.sortBy=function(e,t){return cn(Ne(this,t,e))},t.prototype.map=function(e,t){var n=this
return this.withMutations(function(r){r.forEach(function(i,o){r.set(o,e.call(t,i,o,n))})})},t.prototype.__iterator=function(e,t){return new At(this,e,t)},t.prototype.__iterate=function(e,t){var n=this,r=0
return this._root&&this._root.iterate(function(t){return r++,e(t[1],t[0],n)},t),r},t.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?Bt(this.size,this._root,e,this.__hash):0===this.size?Et():(this.__ownerID=e,this.__altered=!1,this)},t}(d)
vt.isMap=mt
var bt=vt.prototype
bt[ft]=!0,bt[w]=bt.remove,bt.removeAll=bt.deleteAll,bt.setIn=ct,bt.removeIn=bt.deleteIn=qt,bt.update=ut,bt.updateIn=dt,bt.merge=bt.concat=Ye,bt.mergeWith=Ze,bt.mergeDeep=ot,bt.mergeDeepWith=at,bt.mergeIn=lt,bt.mergeDeepIn=st,bt.withMutations=ht,bt.wasAltered=pt,bt.asImmutable=oe,bt["@@transducer/init"]=bt.asMutable=ae,bt["@@transducer/step"]=function(e,t){return e.set(t[0],t[1])},bt["@@transducer/result"]=function(e){return e.asImmutable()}
var xt=function(e,t){this.ownerID=e,this.entries=t}
xt.prototype.get=function(e,t,n,r){for(var i=this.entries,o=0,a=i.length;o<a;o++)if(Xe(n,i[o][0]))return i[o][1]
return r},xt.prototype.update=function(e,t,n,r,i,o,a){for(var s=i===I,l=this.entries,c=0,u=l.length;c<u&&!Xe(r,l[c][0]);c++);var d=c<u
if(d?l[c][1]===i:s)return this
if(P(a),(s||!d)&&P(o),!s||1!==l.length){if(!d&&!s&&l.length>=Nt)return function(e,t,n,r){e||(e=new B)
for(var i=new wt(e,ue(n),[n,r]),o=0;o<t.length;o++){var a=t[o]
i=i.update(e,0,void 0,a[0],a[1])}return i}(e,l,r,i)
var p=e&&e===this.ownerID,h=p?l:tt(l)
return d?s?c===u-1?h.pop():h[c]=h.pop():h[c]=[r,i]:h.push([r,i]),p?(this.entries=h,this):new xt(e,h)}}
var St=function(e,t,n){this.ownerID=e,this.bitmap=t,this.nodes=n}
St.prototype.get=function(e,t,n,r){void 0===t&&(t=ue(n))
var i=1<<((0===e?t:t>>>e)&A),o=this.bitmap
return 0===(o&i)?r:this.nodes[Ot(o&i-1)].get(e+5,t,n,r)},St.prototype.update=function(e,t,n,r,i,o,a){void 0===n&&(n=ue(r))
var s=(0===t?n:n>>>t)&A,l=1<<s,c=this.bitmap,u=0!==(c&l)
if(!u&&i===I)return this
var d=Ot(c&l-1),p=this.nodes,h=u?p[d]:void 0,f=Dt(h,e,t+5,n,r,i,o,a)
if(f===h)return this
if(!u&&f&&p.length>=Ft)return function(e,t,n,r,i){for(var o=0,a=new Array(T),s=0;0!==n;s++,n>>>=1)a[s]=1&n?t[o++]:void 0
return a[r]=i,new _t(e,o+1,a)}(e,p,c,s,f)
if(u&&!f&&2===p.length&&Mt(p[1^d]))return p[1^d]
if(u&&f&&1===p.length&&Mt(f))return f
var m=e&&e===this.ownerID,g=u?f?c:c^l:c|l,y=u?f?Lt(p,d,f,m):function(e,t,n){var r=e.length-1
if(n&&t===r)return e.pop(),e
for(var i=new Array(r),o=0,a=0;a<r;a++)a===t&&(o=1),i[a]=e[a+o]
return i}(p,d,m):function(e,t,n,r){var i=e.length+1
if(r&&t+1===i)return e[t]=n,e
for(var o=new Array(i),a=0,s=0;s<i;s++)s===t?(o[s]=n,a=-1):o[s]=e[s+a]
return o}(p,d,f,m)
return m?(this.bitmap=g,this.nodes=y,this):new St(e,g,y)}
var _t=function(e,t,n){this.ownerID=e,this.count=t,this.nodes=n}
_t.prototype.get=function(e,t,n,r){void 0===t&&(t=ue(n))
var i=(0===e?t:t>>>e)&A,o=this.nodes[i]
return o?o.get(e+5,t,n,r):r},_t.prototype.update=function(e,t,n,r,i,o,a){void 0===n&&(n=ue(r))
var s=(0===t?n:n>>>t)&A,l=i===I,c=this.nodes,u=c[s]
if(l&&!u)return this
var d=Dt(u,e,t+5,n,r,i,o,a)
if(d===u)return this
var p=this.count
if(u){if(!d&&--p<zt)return function(e,t,n,r){for(var i=0,o=0,a=new Array(n),s=0,l=1,c=t.length;s<c;s++,l<<=1){var u=t[s]
void 0!==u&&s!==r&&(i|=l,a[o++]=u)}return new St(e,i,a)}(e,c,p,s)}else p++
var h=e&&e===this.ownerID,f=Lt(c,s,d,h)
return h?(this.count=p,this.nodes=f,this):new _t(e,p,f)}
var Ct=function(e,t,n){this.ownerID=e,this.keyHash=t,this.entries=n}
Ct.prototype.get=function(e,t,n,r){for(var i=this.entries,o=0,a=i.length;o<a;o++)if(Xe(n,i[o][0]))return i[o][1]
return r},Ct.prototype.update=function(e,t,n,r,i,o,a){void 0===n&&(n=ue(r))
var s=i===I
if(n!==this.keyHash)return s?this:(P(a),P(o),Rt(this,e,t,n,[r,i]))
for(var l=this.entries,c=0,u=l.length;c<u&&!Xe(r,l[c][0]);c++);var d=c<u
if(d?l[c][1]===i:s)return this
if(P(a),(s||!d)&&P(o),s&&2===u)return new wt(e,this.keyHash,l[1^c])
var p=e&&e===this.ownerID,h=p?l:tt(l)
return d?s?c===u-1?h.pop():h[c]=h.pop():h[c]=[r,i]:h.push([r,i]),p?(this.entries=h,this):new Ct(e,this.keyHash,h)}
var wt=function(e,t,n){this.ownerID=e,this.keyHash=t,this.entry=n}
wt.prototype.get=function(e,t,n,r){return Xe(n,this.entry[0])?this.entry[1]:r},wt.prototype.update=function(e,t,n,r,i,o,a){var s=i===I,l=Xe(r,this.entry[0])
return(l?i===this.entry[1]:s)?this:(P(a),s?void P(o):l?e&&e===this.ownerID?(this.entry[1]=i,this):new wt(e,this.keyHash,[r,i]):(P(o),Rt(this,e,t,ue(r),[r,i])))},xt.prototype.iterate=Ct.prototype.iterate=function(e,t){for(var n=this.entries,r=0,i=n.length-1;r<=i;r++)if(!1===e(n[t?i-r:r]))return!1},St.prototype.iterate=_t.prototype.iterate=function(e,t){for(var n=this.nodes,r=0,i=n.length-1;r<=i;r++){var o=n[t?i-r:r]
if(o&&!1===o.iterate(e,t))return!1}},wt.prototype.iterate=function(e,t){return e(this.entry)}
var Tt,At=function(e){function t(e,t,n){this._type=t,this._reverse=n,this._stack=e._root&&Pt(e._root)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.next=function(){for(var e=this._type,t=this._stack;t;){var n=t.node,r=t.index++,i=void 0
if(n.entry){if(0===r)return It(e,n.entry)}else if(n.entries){if(r<=(i=n.entries.length-1))return It(e,n.entries[this._reverse?i-r:r])}else if(r<=(i=n.nodes.length-1)){var o=n.nodes[this._reverse?i-r:r]
if(o){if(o.entry)return It(e,o.entry)
t=this._stack=Pt(o,t)}continue}t=this._stack=this._stack.__prev}return{value:void 0,done:!0}},t}(y)
function It(e,t){return v(e,t[0],t[1])}function Pt(e,t){return{node:e,index:0,__prev:t}}function Bt(e,t,n,r){var i=Object.create(bt)
return i.size=e,i._root=t,i.__ownerID=n,i.__hash=r,i.__altered=!1,i}function Et(){return Tt||(Tt=Bt(0))}function kt(e,t,n){var r,i
if(e._root){var o={value:!1},a={value:!1}
if(r=Dt(e._root,e.__ownerID,0,void 0,t,n,o,a),!a.value)return e
i=e.size+(o.value?n===I?-1:1:0)}else{if(n===I)return e
i=1,r=new xt(e.__ownerID,[[t,n]])}return e.__ownerID?(e.size=i,e._root=r,e.__hash=void 0,e.__altered=!0,e):r?Bt(i,r):Et()}function Dt(e,t,n,r,i,o,a,s){return e?e.update(t,n,r,i,o,a,s):o===I?e:(P(s),P(a),new wt(t,r,[i,o]))}function Mt(e){return e.constructor===wt||e.constructor===Ct}function Rt(e,t,n,r,i){if(e.keyHash===r)return new Ct(t,r,[e.entry,i])
var o,a=(0===n?e.keyHash:e.keyHash>>>n)&A,s=(0===n?r:r>>>n)&A,l=a===s?[Rt(e,t,n+5,r,i)]:(o=new wt(t,r,i),a<s?[e,o]:[o,e])
return new St(t,1<<a|1<<s,l)}function Ot(e){return e=(e=(858993459&(e-=e>>1&1431655765))+(e>>2&858993459))+(e>>4)&252645135,127&(e+=e>>8)+(e>>16)}function Lt(e,t,n,r){var i=r?e:tt(e)
return i[t]=n,i}var Nt=8,Ft=16,zt=8
function jt(e){if(Q(e)&&"string"!=typeof e)return e
if(U(e))return e.toArray()
throw new TypeError("Invalid keyPath: expected Ordered Collection or Array: "+e)}function Vt(e){try{return"string"==typeof e?JSON.stringify(e):String(e)}catch(t){return JSON.stringify(e)}}function Ut(e,t,n){return j(e)?e.get(t,n):function(e,t){return j(e)?e.has(t):et(e)&&q.call(e,t)}(e,t)?"function"==typeof e.get?e.get(t):e[t]:n}function Gt(e,t,n,r){r||(r=n,n=void 0)
var i=Ht(j(e),e,jt(t),0,n,r)
return i===I?n:i}function Ht(e,t,n,r,i,o){var a=t===I
if(r===n.length){var s=a?i:t,l=o(s)
return l===s?t:l}if(!a&&!et(t))throw new TypeError("Cannot update within non-data-structure value in path ["+Array.from(n).slice(0,r).map(Vt)+"]: "+t)
var c=n[r],u=a?I:Ut(t,c,I),d=Ht(u===I?e:j(u),u,n,r+1,i,o)
return d===u?t:d===I?function(e,t){if(!et(e))throw new TypeError("Cannot update non-data-structure value: "+e)
if(j(e)){if(!e.remove)throw new TypeError("Cannot update immutable value without .remove() method: "+e)
return e.remove(t)}if(!q.call(e,t))return e
var n=nt(e)
return Array.isArray(n)?n.splice(t,1):delete n[t],n}(t,c):function(e,t,n){if(!et(e))throw new TypeError("Cannot update non-data-structure value: "+e)
if(j(e)){if(!e.set)throw new TypeError("Cannot update immutable value without .set() method: "+e)
return e.set(t,n)}if(q.call(e,t)&&n===e[t])return e
var r=nt(e)
return r[t]=n,r}(a?e?Et():{}:t,c,d)}function qt(e){return function(e,t){return Gt(e,t,function(){return I})}(this,e)}var Qt="@@__IMMUTABLE_LIST__@@"
function $t(e){return Boolean(e&&e[Qt])}var Xt=function(e){function t(t){var n=en()
if(null==t)return n
if($t(t))return t
var r=e(t),i=r.size
return 0===i?n:(yt(i),i>0&&i<T?Jt(0,i,5,null,new Yt(r.toArray())):n.withMutations(function(e){e.setSize(i),r.forEach(function(t,n){return e.set(n,t)})}))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.prototype.toString=function(){return this.__toString("List [","]")},t.prototype.get=function(e,t){if((e=k(this,e))>=0&&e<this.size){var n=rn(this,e+=this._origin)
return n&&n.array[e&A]}return t},t.prototype.set=function(e,t){return function(e,t,n){if((t=k(e,t))!=t)return e
if(t>=e.size||t<0)return e.withMutations(function(e){t<0?on(e,t).set(0,n):on(e,0,t+1).set(t,n)})
t+=e._origin
var r=e._tail,i=e._root,o={value:!1}
return t>=an(e._capacity)?r=tn(r,e.__ownerID,0,t,n,o):i=tn(i,e.__ownerID,e._level,t,n,o),o.value?e.__ownerID?(e._root=i,e._tail=r,e.__hash=void 0,e.__altered=!0,e):Jt(e._origin,e._capacity,e._level,i,r):e}(this,e,t)},t.prototype.remove=function(e){return this.has(e)?0===e?this.shift():e===this.size-1?this.pop():this.splice(e,1):this},t.prototype.insert=function(e,t){return this.splice(e,0,t)},t.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=5,this._root=this._tail=this.__hash=void 0,this.__altered=!0,this):en()},t.prototype.push=function(){var e=arguments,t=this.size
return this.withMutations(function(n){on(n,0,t+e.length)
for(var r=0;r<e.length;r++)n.set(t+r,e[r])})},t.prototype.pop=function(){return on(this,0,-1)},t.prototype.unshift=function(){var e=arguments
return this.withMutations(function(t){on(t,-e.length)
for(var n=0;n<e.length;n++)t.set(n,e[n])})},t.prototype.shift=function(){return on(this,1)},t.prototype.shuffle=function(e){return void 0===e&&(e=Math.random),this.withMutations(function(t){for(var n,r,i=t.size;i;)n=Math.floor(e()*i--),r=t.get(n),t.set(n,t.get(i)),t.set(i,r)})},t.prototype.concat=function(){for(var t=arguments,n=[],r=0;r<arguments.length;r++){var i=t[r],o=e("string"!=typeof i&&x(i)?i:[i])
0!==o.size&&n.push(o)}return 0===n.length?this:0!==this.size||this.__ownerID||1!==n.length?this.withMutations(function(e){n.forEach(function(t){return t.forEach(function(t){return e.push(t)})})}):this.constructor(n[0])},t.prototype.setSize=function(e){return on(this,0,e)},t.prototype.map=function(e,t){var n=this
return this.withMutations(function(r){for(var i=0;i<n.size;i++)r.set(i,e.call(t,r.get(i),i,n))})},t.prototype.slice=function(e,t){var n=this.size
return M(e,t,n)?this:on(this,R(e,n),O(t,n))},t.prototype.__iterator=function(e,t){var n=t?this.size:0,r=Kt(this,t)
return new y(function(){var i=r()
return i===Zt?{value:void 0,done:!0}:v(e,t?--n:n++,i)})},t.prototype.__iterate=function(e,t){for(var n,r=t?this.size:0,i=Kt(this,t);(n=i())!==Zt&&!1!==e(n,t?--r:r++,this););return r},t.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?Jt(this._origin,this._capacity,this._level,this._root,this._tail,e,this.__hash):0===this.size?en():(this.__ownerID=e,this.__altered=!1,this)},t}(p)
Xt.isList=$t
var Wt=Xt.prototype
Wt[Qt]=!0,Wt[w]=Wt.remove,Wt.merge=Wt.concat,Wt.setIn=ct,Wt.deleteIn=Wt.removeIn=qt,Wt.update=ut,Wt.updateIn=dt,Wt.mergeIn=lt,Wt.mergeDeepIn=st,Wt.withMutations=ht,Wt.wasAltered=pt,Wt.asImmutable=oe,Wt["@@transducer/init"]=Wt.asMutable=ae,Wt["@@transducer/step"]=function(e,t){return e.push(t)},Wt["@@transducer/result"]=function(e){return e.asImmutable()}
var Yt=function(e,t){this.array=e,this.ownerID=t}
Yt.prototype.removeBefore=function(e,t,n){if(!(n&(1<<t+5)-1)||0===this.array.length)return this
var r=n>>>t&A
if(r>=this.array.length)return new Yt([],e)
var i,o=0===r
if(t>0){var a=this.array[r]
if((i=a&&a.removeBefore(e,t-5,n))===a&&o)return this}if(o&&!i)return this
var s=nn(this,e)
if(!o)for(var l=0;l<r;l++)s.array[l]=void 0
return i&&(s.array[r]=i),s},Yt.prototype.removeAfter=function(e,t,n){if(n===(t?1<<t+5:T)||0===this.array.length)return this
var r,i=n-1>>>t&A
if(i>=this.array.length)return this
if(t>0){var o=this.array[i]
if((r=o&&o.removeAfter(e,t-5,n))===o&&i===this.array.length-1)return this}var a=nn(this,e)
return a.array.splice(i+1),r&&(a.array[i]=r),a}
var Zt={}
function Kt(e,t){var n=e._origin,r=e._capacity,i=an(r),o=e._tail
return function e(a,s,l){return 0===s?function(e,a){var s=a===i?o&&o.array:e&&e.array,l=a>n?0:n-a,c=r-a
return c>T&&(c=T),function(){if(l===c)return Zt
var e=t?--c:l++
return s&&s[e]}}(a,l):function(i,o,a){var s,l=i&&i.array,c=a>n?0:n-a>>o,u=1+(r-a>>o)
return u>T&&(u=T),function(){for(;;){if(s){var n=s()
if(n!==Zt)return n
s=null}if(c===u)return Zt
var r=t?--u:c++
s=e(l&&l[r],o-5,a+(r<<o))}}}(a,s,l)}(e._root,e._level,0)}function Jt(e,t,n,r,i,o,a){var s=Object.create(Wt)
return s.size=t-e,s._origin=e,s._capacity=t,s._level=n,s._root=r,s._tail=i,s.__ownerID=o,s.__hash=a,s.__altered=!1,s}function en(){return Jt(0,0,5)}function tn(e,t,n,r,i,o){var a,s=r>>>n&A,l=e&&s<e.array.length
if(!l&&void 0===i)return e
if(n>0){var c=e&&e.array[s],u=tn(c,t,n-5,r,i,o)
return u===c?e:((a=nn(e,t)).array[s]=u,a)}return l&&e.array[s]===i?e:(o&&P(o),a=nn(e,t),void 0===i&&s===a.array.length-1?a.array.pop():a.array[s]=i,a)}function nn(e,t){return t&&e&&t===e.ownerID?e:new Yt(e?e.array.slice():[],t)}function rn(e,t){if(t>=an(e._capacity))return e._tail
if(t<1<<e._level+5){for(var n=e._root,r=e._level;n&&r>0;)n=n.array[t>>>r&A],r-=5
return n}}function on(e,t,n){void 0!==t&&(t|=0),void 0!==n&&(n|=0)
var r=e.__ownerID||new B,i=e._origin,o=e._capacity,a=i+t,s=void 0===n?o:n<0?o+n:i+n
if(a===i&&s===o)return e
if(a>=s)return e.clear()
for(var l=e._level,c=e._root,u=0;a+u<0;)c=new Yt(c&&c.array.length?[void 0,c]:[],r),u+=1<<(l+=5)
u&&(a+=u,i+=u,s+=u,o+=u)
for(var d=an(o),p=an(s);p>=1<<l+5;)c=new Yt(c&&c.array.length?[c]:[],r),l+=5
var h=e._tail,f=p<d?rn(e,s-1):p>d?new Yt([],r):h
if(h&&p>d&&a<o&&h.array.length){for(var m=c=nn(c,r),g=l;g>5;g-=5){var y=d>>>g&A
m=m.array[y]=nn(m.array[y],r)}m.array[d>>>5&A]=h}if(s<o&&(f=f&&f.removeAfter(r,0,s)),a>=p)a-=p,s-=p,l=5,c=null,f=f&&f.removeBefore(r,0,a)
else if(a>i||p<d){for(u=0;c;){var v=a>>>l&A
if(v!==p>>>l&A)break
v&&(u+=(1<<l)*v),l-=5,c=c.array[v]}c&&a>i&&(c=c.removeBefore(r,l,a-u)),c&&p<d&&(c=c.removeAfter(r,l,p-u)),u&&(a-=u,s-=u)}return e.__ownerID?(e.size=s-a,e._origin=a,e._capacity=s,e._level=l,e._root=c,e._tail=f,e.__hash=void 0,e.__altered=!0,e):Jt(a,s,l,c,f)}function an(e){return e<T?0:e-1>>>5<<5}function sn(e){return mt(e)&&U(e)}var ln,cn=function(e){function t(e){return null==e?dn():sn(e)?e:dn().withMutations(function(t){var n=d(e)
yt(n.size),n.forEach(function(e,n){return t.set(n,e)})})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.prototype.toString=function(){return this.__toString("OrderedMap {","}")},t.prototype.get=function(e,t){var n=this._map.get(e)
return void 0!==n?this._list.get(n)[1]:t},t.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this.__altered=!0,this):dn()},t.prototype.set=function(e,t){return pn(this,e,t)},t.prototype.remove=function(e){return pn(this,e,I)},t.prototype.__iterate=function(e,t){var n=this
return this._list.__iterate(function(t){return t&&e(t[1],t[0],n)},t)},t.prototype.__iterator=function(e,t){return this._list.fromEntrySeq().__iterator(e,t)},t.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this
var t=this._map.__ensureOwner(e),n=this._list.__ensureOwner(e)
return e?un(t,n,e,this.__hash):0===this.size?dn():(this.__ownerID=e,this.__altered=!1,this._map=t,this._list=n,this)},t}(vt)
function un(e,t,n,r){var i=Object.create(cn.prototype)
return i.size=e?e.size:0,i._map=e,i._list=t,i.__ownerID=n,i.__hash=r,i.__altered=!1,i}function dn(){return ln||(ln=un(Et(),en()))}function pn(e,t,n){var r,i,o=e._map,a=e._list,s=o.get(t),l=void 0!==s
if(n===I){if(!l)return e
a.size>=T&&a.size>=2*o.size?(r=(i=a.filter(function(e,t){return void 0!==e&&s!==t})).toKeyedSeq().map(function(e){return e[0]}).flip().toMap(),e.__ownerID&&(r.__ownerID=i.__ownerID=e.__ownerID)):(r=o.remove(t),i=s===a.size-1?a.pop():a.set(s,void 0))}else if(l){if(n===a.get(s)[1])return e
r=o,i=a.set(s,[t,n])}else r=o.set(t,a.size),i=a.set(a.size,[t,n])
return e.__ownerID?(e.size=r.size,e._map=r,e._list=i,e.__hash=void 0,e.__altered=!0,e):un(r,i)}cn.isOrderedMap=sn,cn.prototype[V]=!0,cn.prototype[w]=cn.prototype.remove
var hn="@@__IMMUTABLE_STACK__@@"
function fn(e){return Boolean(e&&e[hn])}var mn=function(e){function t(e){return null==e?bn():fn(e)?e:bn().pushAll(e)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.prototype.toString=function(){return this.__toString("Stack [","]")},t.prototype.get=function(e,t){var n=this._head
for(e=k(this,e);n&&e--;)n=n.next
return n?n.value:t},t.prototype.peek=function(){return this._head&&this._head.value},t.prototype.push=function(){var e=arguments
if(0===arguments.length)return this
for(var t=this.size+arguments.length,n=this._head,r=arguments.length-1;r>=0;r--)n={value:e[r],next:n}
return this.__ownerID?(this.size=t,this._head=n,this.__hash=void 0,this.__altered=!0,this):vn(t,n)},t.prototype.pushAll=function(t){if(0===(t=e(t)).size)return this
if(0===this.size&&fn(t))return t
yt(t.size)
var n=this.size,r=this._head
return t.__iterate(function(e){n++,r={value:e,next:r}},!0),this.__ownerID?(this.size=n,this._head=r,this.__hash=void 0,this.__altered=!0,this):vn(n,r)},t.prototype.pop=function(){return this.slice(1)},t.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):bn()},t.prototype.slice=function(t,n){if(M(t,n,this.size))return this
var r=R(t,this.size)
if(O(n,this.size)!==this.size)return e.prototype.slice.call(this,t,n)
for(var i=this.size-r,o=this._head;r--;)o=o.next
return this.__ownerID?(this.size=i,this._head=o,this.__hash=void 0,this.__altered=!0,this):vn(i,o)},t.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?vn(this.size,this._head,e,this.__hash):0===this.size?bn():(this.__ownerID=e,this.__altered=!1,this)},t.prototype.__iterate=function(e,t){var n=this
if(t)return new Z(this.toArray()).__iterate(function(t,r){return e(t,r,n)},t)
for(var r=0,i=this._head;i&&!1!==e(i.value,r++,this);)i=i.next
return r},t.prototype.__iterator=function(e,t){if(t)return new Z(this.toArray()).__iterator(e,t)
var n=0,r=this._head
return new y(function(){if(r){var t=r.value
return r=r.next,v(e,n++,t)}return{value:void 0,done:!0}})},t}(p)
mn.isStack=fn
var gn,yn=mn.prototype
function vn(e,t,n,r){var i=Object.create(yn)
return i.size=e,i._head=t,i.__ownerID=n,i.__hash=r,i.__altered=!1,i}function bn(){return gn||(gn=vn(0))}function xn(e,t,n,r,i,o){return yt(e.size),e.__iterate(function(e,o,a){i?(i=!1,n=e):n=t.call(r,n,e,o,a)},o),n}function Sn(e,t){return t}function _n(e,t){return[t,e]}function Cn(e){return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n]
return!e.apply(this,t)}}function wn(e){return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n]
return-e.apply(this,t)}}function Tn(e,t){return e<t?1:e>t?-1:0}function An(e,t){if(e===t)return!0
if(!c(t)||void 0!==e.size&&void 0!==t.size&&e.size!==t.size||void 0!==e.__hash&&void 0!==t.__hash&&e.__hash!==t.__hash||a(e)!==a(t)||i(e)!==i(t)||U(e)!==U(t))return!1
if(0===e.size&&0===t.size)return!0
var n=!s(e)
if(U(e)){var r=e.entries()
return t.every(function(e,t){var i=r.next().value
return i&&Xe(i[1],e)&&(n||Xe(i[0],t))})&&r.next().done}var o=!1
if(void 0===e.size)if(void 0===t.size)"function"==typeof e.cacheResult&&e.cacheResult()
else{o=!0
var l=e
e=t,t=l}var u=!0,d=t.__iterate(function(t,r){if(n?!e.has(t):o?!Xe(t,e.get(r,I)):!Xe(e.get(r,I),t))return u=!1,!1})
return u&&e.size===d}yn[hn]=!0,yn.shift=yn.pop,yn.unshift=yn.push,yn.unshiftAll=yn.pushAll,yn.withMutations=ht,yn.wasAltered=pt,yn.asImmutable=oe,yn["@@transducer/init"]=yn.asMutable=ae,yn["@@transducer/step"]=function(e,t){return e.unshift(t)},yn["@@transducer/result"]=function(e){return e.asImmutable()}
var In,Pn=function(e){function t(e,n,r){if(void 0===r&&(r=1),!(this instanceof t))return new t(e,n,r)
if(gt(0!==r,"Cannot step a Range by 0"),gt(void 0!==e,"You must define a start value when using Range"),gt(void 0!==n,"You must define an end value when using Range"),r=Math.abs(r),n<e&&(r=-r),this._start=e,this._end=n,this._step=r,this.size=Math.max(0,Math.ceil((n-e)/r-1)+1),0===this.size){if(In)return In
In=this}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.toString=function(){return 0===this.size?"Range []":"Range [ "+this._start+"..."+this._end+(1!==this._step?" by "+this._step:"")+" ]"},t.prototype.get=function(e,t){return this.has(e)?this._start+k(this,e)*this._step:t},t.prototype.includes=function(e){var t=(e-this._start)/this._step
return t>=0&&t<this.size&&t===Math.floor(t)},t.prototype.slice=function(e,n){return M(e,n,this.size)?this:(e=R(e,this.size),(n=O(n,this.size))<=e?new t(0,0):new t(this.get(e,this._end),this.get(n,this._end),this._step))},t.prototype.indexOf=function(e){var t=e-this._start
if(t%this._step===0){var n=t/this._step
if(n>=0&&n<this.size)return n}return-1},t.prototype.lastIndexOf=function(e){return this.indexOf(e)},t.prototype.__iterate=function(e,t){for(var n=this.size,r=this._step,i=t?this._start+(n-1)*r:this._start,o=0;o!==n&&!1!==e(i,t?n-++o:o++,this);)i+=t?-r:r
return o},t.prototype.__iterator=function(e,t){var n=this.size,r=this._step,i=t?this._start+(n-1)*r:this._start,o=0
return new y(function(){if(o===n)return{value:void 0,done:!0}
var a=i
return i+=t?-r:r,v(e,t?n-++o:o++,a)})},t.prototype.equals=function(e){return e instanceof t?this._start===e._start&&this._end===e._end&&this._step===e._step:An(this,e)},t}(W),Bn="@@__IMMUTABLE_SET__@@"
function En(e){return Boolean(e&&e[Bn])}var kn=function(e){function t(t){return null==t?Ln():En(t)&&!U(t)?t:Ln().withMutations(function(n){var r=e(t)
yt(r.size),r.forEach(function(e){return n.add(e)})})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.fromKeys=function(e){return this(d(e).keySeq())},t.intersect=function(e){return(e=u(e).toArray()).length?Mn.intersect.apply(t(e.pop()),e):Ln()},t.union=function(e){return(e=u(e).toArray()).length?Mn.union.apply(t(e.pop()),e):Ln()},t.prototype.toString=function(){return this.__toString("Set {","}")},t.prototype.has=function(e){return this._map.has(e)},t.prototype.add=function(e){return Rn(this,this._map.set(e,e))},t.prototype.remove=function(e){return Rn(this,this._map.remove(e))},t.prototype.clear=function(){return Rn(this,this._map.clear())},t.prototype.map=function(e,t){var n=this,r=!1,i=Rn(this,this._map.mapEntries(function(i){var o=i[1],a=e.call(t,o,o,n)
return a!==o&&(r=!0),[a,a]},t))
return r?i:this},t.prototype.union=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n]
return 0===(t=t.filter(function(e){return 0!==e.size})).length?this:0!==this.size||this.__ownerID||1!==t.length?this.withMutations(function(n){for(var r=0;r<t.length;r++)"string"==typeof t[r]?n.add(t[r]):e(t[r]).forEach(function(e){return n.add(e)})}):this.constructor(t[0])},t.prototype.intersect=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n]
if(0===t.length)return this
t=t.map(function(t){return e(t)})
var r=[]
return this.forEach(function(e){t.every(function(t){return t.includes(e)})||r.push(e)}),this.withMutations(function(e){r.forEach(function(t){e.remove(t)})})},t.prototype.subtract=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n]
if(0===t.length)return this
t=t.map(function(t){return e(t)})
var r=[]
return this.forEach(function(e){t.some(function(t){return t.includes(e)})&&r.push(e)}),this.withMutations(function(e){r.forEach(function(t){e.remove(t)})})},t.prototype.sort=function(e){return Wn(Ne(this,e))},t.prototype.sortBy=function(e,t){return Wn(Ne(this,t,e))},t.prototype.wasAltered=function(){return this._map.wasAltered()},t.prototype.__iterate=function(e,t){var n=this
return this._map.__iterate(function(t){return e(t,t,n)},t)},t.prototype.__iterator=function(e,t){return this._map.__iterator(e,t)},t.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this
var t=this._map.__ensureOwner(e)
return e?this.__make(t,e):0===this.size?this.__empty():(this.__ownerID=e,this._map=t,this)},t}(h)
kn.isSet=En
var Dn,Mn=kn.prototype
function Rn(e,t){return e.__ownerID?(e.size=t.size,e._map=t,e):t===e._map?e:0===t.size?e.__empty():e.__make(t)}function On(e,t){var n=Object.create(Mn)
return n.size=e?e.size:0,n._map=e,n.__ownerID=t,n}function Ln(){return Dn||(Dn=On(Et()))}function Nn(e,t,n){for(var r=jt(t),i=0;i!==r.length;)if((e=Ut(e,r[i++],I))===I)return n
return e}function Fn(e,t){return Nn(this,e,t)}function zn(){yt(this.size)
var e={}
return this.__iterate(function(t,n){e[n]=t}),e}function jn(e){if(!e||"object"!=typeof e)return e
if(!c(e)){if(!et(e))return e
e=$(e)}if(a(e)){var t={}
return e.__iterate(function(e,n){t[n]=jn(e)}),t}var n=[]
return e.__iterate(function(e){n.push(jn(e))}),n}function Vn(e,t){return e^t+2654435769+(e<<6)+(e>>2)|0}function Un(e,t){var n=function(n){e.prototype[n]=t[n]}
return Object.keys(t).forEach(n),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(t).forEach(n),e}Mn[Bn]=!0,Mn[w]=Mn.remove,Mn.merge=Mn.concat=Mn.union,Mn.withMutations=ht,Mn.asImmutable=oe,Mn["@@transducer/init"]=Mn.asMutable=ae,Mn["@@transducer/step"]=function(e,t){return e.add(t)},Mn["@@transducer/result"]=function(e){return e.asImmutable()},Mn.__empty=Ln,Mn.__make=On,u.Iterator=y,Un(u,{toArray:function(){yt(this.size)
var e=new Array(this.size||0),t=a(this),n=0
return this.__iterate(function(r,i){e[n++]=t?[i,r]:r}),e},toIndexedSeq:function(){return new Ae(this)},toJS:function(){return jn(this)},toKeyedSeq:function(){return new Te(this,!0)},toMap:function(){return vt(this.toKeyedSeq())},toObject:zn,toOrderedMap:function(){return cn(this.toKeyedSeq())},toOrderedSet:function(){return Wn(a(this)?this.valueSeq():this)},toSet:function(){return kn(a(this)?this.valueSeq():this)},toSetSeq:function(){return new Ie(this)},toSeq:function(){return i(this)?this.toIndexedSeq():a(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return mn(a(this)?this.valueSeq():this)},toList:function(){return Xt(a(this)?this.valueSeq():this)},toString:function(){return"[Collection]"},__toString:function(e,t){return 0===this.size?e+t:e+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+t},concat:function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t]
return Ve(this,function(e,t){var n=a(e),r=[e].concat(t).map(function(e){return c(e)?n&&(e=d(e)):e=n?ne(e):re(Array.isArray(e)?e:[e]),e}).filter(function(e){return 0!==e.size})
if(0===r.length)return e
if(1===r.length){var o=r[0]
if(o===e||n&&a(o)||i(e)&&i(o))return o}return new Oe(r)}(this,e))},includes:function(e){return this.some(function(t){return Xe(t,e)})},entries:function(){return this.__iterator(2)},every:function(e,t){yt(this.size)
var n=!0
return this.__iterate(function(r,i,o){if(!e.call(t,r,i,o))return n=!1,!1}),n},filter:function(e,t){return Ve(this,De(this,e,t,!0))},partition:function(e,t){return function(e,t,n){var r=a(e),i=[[],[]]
e.__iterate(function(o,a){i[t.call(n,o,a,e)?1:0].push(r?[a,o]:o)})
var o=Ge(e)
return i.map(function(t){return Ve(e,o(t))})}(this,e,t)},find:function(e,t,n){var r=this.findEntry(e,t)
return r?r[1]:n},forEach:function(e,t){return yt(this.size),this.__iterate(t?e.bind(t):e)},join:function(e){yt(this.size),e=void 0!==e?""+e:","
var t="",n=!0
return this.__iterate(function(r){n?n=!1:t+=e,t+=null!=r?r.toString():""}),t},keys:function(){return this.__iterator(0)},map:function(e,t){return Ve(this,Ee(this,e,t))},reduce:function(e,t,n){return xn(this,e,t,n,arguments.length<2,!1)},reduceRight:function(e,t,n){return xn(this,e,t,n,arguments.length<2,!0)},reverse:function(){return Ve(this,ke(this,!0))},slice:function(e,t){return Ve(this,Me(this,e,t,!0))},some:function(e,t){yt(this.size)
var n=!1
return this.__iterate(function(r,i,o){if(e.call(t,r,i,o))return n=!0,!1}),n},sort:function(e){return Ve(this,Ne(this,e))},values:function(){return this.__iterator(1)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return void 0!==this.size?0===this.size:!this.some(function(){return!0})},count:function(e,t){return E(e?this.toSeq().filter(e,t):this)},countBy:function(e,t){return function(e,t,n){var r=vt().asMutable()
return e.__iterate(function(i,o){r.update(t.call(n,i,o,e),0,function(e){return e+1})}),r.asImmutable()}(this,e,t)},equals:function(e){return An(this,e)},entrySeq:function(){var e=this
if(e._cache)return new Z(e._cache)
var t=e.toSeq().map(_n).toIndexedSeq()
return t.fromEntrySeq=function(){return e.toSeq()},t},filterNot:function(e,t){return this.filter(Cn(e),t)},findEntry:function(e,t,n){var r=n
return this.__iterate(function(n,i,o){if(e.call(t,n,i,o))return r=[i,n],!1}),r},findKey:function(e,t){var n=this.findEntry(e,t)
return n&&n[0]},findLast:function(e,t,n){return this.toKeyedSeq().reverse().find(e,t,n)},findLastEntry:function(e,t,n){return this.toKeyedSeq().reverse().findEntry(e,t,n)},findLastKey:function(e,t){return this.toKeyedSeq().reverse().findKey(e,t)},first:function(e){return this.find(D,null,e)},flatMap:function(e,t){return Ve(this,function(e,t,n){var r=Ge(e)
return e.toSeq().map(function(i,o){return r(t.call(n,i,o,e))}).flatten(!0)}(this,e,t))},flatten:function(e){return Ve(this,Le(this,e,!0))},fromEntrySeq:function(){return new Pe(this)},get:function(e,t){return this.find(function(t,n){return Xe(n,e)},void 0,t)},getIn:Fn,groupBy:function(e,t){return function(e,t,n){var r=a(e),i=(U(e)?cn():vt()).asMutable()
e.__iterate(function(o,a){i.update(t.call(n,o,a,e),function(e){return(e=e||[]).push(r?[a,o]:o),e})})
var o=Ge(e)
return i.map(function(t){return Ve(e,o(t))}).asImmutable()}(this,e,t)},has:function(e){return this.get(e,I)!==I},hasIn:function(e){return Nn(this,e,I)!==I},isSubset:function(e){return e="function"==typeof e.includes?e:u(e),this.every(function(t){return e.includes(t)})},isSuperset:function(e){return(e="function"==typeof e.isSubset?e:u(e)).isSubset(this)},keyOf:function(e){return this.findKey(function(t){return Xe(t,e)})},keySeq:function(){return this.toSeq().map(Sn).toIndexedSeq()},last:function(e){return this.toSeq().reverse().first(e)},lastKeyOf:function(e){return this.toKeyedSeq().reverse().keyOf(e)},max:function(e){return Fe(this,e)},maxBy:function(e,t){return Fe(this,t,e)},min:function(e){return Fe(this,e?wn(e):Tn)},minBy:function(e,t){return Fe(this,t?wn(t):Tn,e)},rest:function(){return this.slice(1)},skip:function(e){return 0===e?this:this.slice(Math.max(0,e))},skipLast:function(e){return 0===e?this:this.slice(0,-Math.max(0,e))},skipWhile:function(e,t){return Ve(this,Re(this,e,t,!0))},skipUntil:function(e,t){return this.skipWhile(Cn(e),t)},sortBy:function(e,t){return Ve(this,Ne(this,t,e))},take:function(e){return this.slice(0,Math.max(0,e))},takeLast:function(e){return this.slice(-Math.max(0,e))},takeWhile:function(e,t){return Ve(this,function(e,t,n){var r=He(e)
return r.__iterateUncached=function(r,i){var o=this
if(i)return this.cacheResult().__iterate(r,i)
var a=0
return e.__iterate(function(e,i,s){return t.call(n,e,i,s)&&++a&&r(e,i,o)}),a},r.__iteratorUncached=function(r,i){var o=this
if(i)return this.cacheResult().__iterator(r,i)
var a=e.__iterator(2,i),s=!0
return new y(function(){if(!s)return{value:void 0,done:!0}
var e=a.next()
if(e.done)return e
var i=e.value,l=i[0],c=i[1]
return t.call(n,c,l,o)?2===r?e:v(r,l,c,e):(s=!1,{value:void 0,done:!0})})},r}(this,e,t))},takeUntil:function(e,t){return this.takeWhile(Cn(e),t)},update:function(e){return e(this)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=function(e){if(e.size===1/0)return 0
var t=U(e),n=a(e),r=t?1:0
return e.__iterate(n?t?function(e,t){r=31*r+Vn(ue(e),ue(t))|0}:function(e,t){r=r+Vn(ue(e),ue(t))|0}:t?function(e){r=31*r+ue(e)|0}:function(e){r=r+ue(e)|0}),function(e,t){return t=se(t,3432918353),t=se(t<<15|t>>>-15,461845907),t=se(t<<13|t>>>-13,5),t=se((t=(t+3864292196|0)^e)^t>>>16,2246822507),le((t=se(t^t>>>13,3266489909))^t>>>16)}(e.size,r)}(this))}})
var Gn=u.prototype
Gn[l]=!0,Gn[g]=Gn.values,Gn.toJSON=Gn.toArray,Gn.__toStringMapper=Vt,Gn.inspect=Gn.toSource=function(){return this.toString()},Gn.chain=Gn.flatMap,Gn.contains=Gn.includes,Un(d,{flip:function(){return Ve(this,Be(this))},mapEntries:function(e,t){var n=this,r=0
return Ve(this,this.toSeq().map(function(i,o){return e.call(t,[o,i],r++,n)}).fromEntrySeq())},mapKeys:function(e,t){var n=this
return Ve(this,this.toSeq().flip().map(function(r,i){return e.call(t,r,i,n)}).flip())}})
var Hn=d.prototype
Hn[o]=!0,Hn[g]=Gn.entries,Hn.toJSON=zn,Hn.__toStringMapper=function(e,t){return Vt(t)+": "+Vt(e)},Un(p,{toKeyedSeq:function(){return new Te(this,!1)},filter:function(e,t){return Ve(this,De(this,e,t,!1))},findIndex:function(e,t){var n=this.findEntry(e,t)
return n?n[0]:-1},indexOf:function(e){var t=this.keyOf(e)
return void 0===t?-1:t},lastIndexOf:function(e){var t=this.lastKeyOf(e)
return void 0===t?-1:t},reverse:function(){return Ve(this,ke(this,!1))},slice:function(e,t){return Ve(this,Me(this,e,t,!1))},splice:function(e,t){var n=arguments.length
if(t=Math.max(t||0,0),0===n||2===n&&!t)return this
e=R(e,e<0?this.count():this.size)
var r=this.slice(0,e)
return Ve(this,1===n?r:r.concat(tt(arguments,2),this.slice(e+t)))},findLastIndex:function(e,t){var n=this.findLastEntry(e,t)
return n?n[0]:-1},first:function(e){return this.get(0,e)},flatten:function(e){return Ve(this,Le(this,e,!1))},get:function(e,t){return(e=k(this,e))<0||this.size===1/0||void 0!==this.size&&e>this.size?t:this.find(function(t,n){return n===e},void 0,t)},has:function(e){return(e=k(this,e))>=0&&(void 0!==this.size?this.size===1/0||e<this.size:-1!==this.indexOf(e))},interpose:function(e){return Ve(this,function(e,t){var n=He(e)
return n.size=e.size&&2*e.size-1,n.__iterateUncached=function(n,r){var i=this,o=0
return e.__iterate(function(e){return(!o||!1!==n(t,o++,i))&&!1!==n(e,o++,i)},r),o},n.__iteratorUncached=function(n,r){var i,o=e.__iterator(1,r),a=0
return new y(function(){return(!i||a%2)&&(i=o.next()).done?i:a%2?v(n,a++,t):v(n,a++,i.value,i)})},n}(this,e))},interleave:function(){var e=[this].concat(tt(arguments)),t=je(this.toSeq(),W.of,e),n=t.flatten(!0)
return t.size&&(n.size=t.size*e.length),Ve(this,n)},keySeq:function(){return Pn(0,this.size)},last:function(e){return this.get(-1,e)},skipWhile:function(e,t){return Ve(this,Re(this,e,t,!1))},zip:function(){return Ve(this,je(this,$n,[this].concat(tt(arguments))))},zipAll:function(){return Ve(this,je(this,$n,[this].concat(tt(arguments)),!0))},zipWith:function(e){var t=tt(arguments)
return t[0]=this,Ve(this,je(this,e,t))}})
var qn=p.prototype
qn[r]=!0,qn[V]=!0,Un(h,{get:function(e,t){return this.has(e)?e:t},includes:function(e){return this.has(e)},keySeq:function(){return this.valueSeq()}})
var Qn=h.prototype
function $n(){return tt(arguments)}function Xn(e){return En(e)&&U(e)}Qn.has=Gn.includes,Qn.contains=Qn.includes,Qn.keys=Qn.values,Un(X,Hn),Un(W,qn),Un(Y,Qn)
var Wn=function(e){function t(e){return null==e?Jn():Xn(e)?e:Jn().withMutations(function(t){var n=h(e)
yt(n.size),n.forEach(function(e){return t.add(e)})})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.of=function(){return this(arguments)},t.fromKeys=function(e){return this(d(e).keySeq())},t.prototype.toString=function(){return this.__toString("OrderedSet {","}")},t}(kn)
Wn.isOrderedSet=Xn
var Yn,Zn=Wn.prototype
function Kn(e,t){var n=Object.create(Zn)
return n.size=e?e.size:0,n._map=e,n.__ownerID=t,n}function Jn(){return Yn||(Yn=Kn(dn()))}Zn[V]=!0,Zn.zip=qn.zip,Zn.zipWith=qn.zipWith,Zn.zipAll=qn.zipAll,Zn.__empty=Jn,Zn.__make=Kn
var er=function(e,t){var n
!function(e){if(z(e))throw new Error("Can not call `Record` with an immutable Record as default values. Use a plain javascript object instead.")
if(j(e))throw new Error("Can not call `Record` with an immutable Collection as default values. Use a plain javascript object instead.")
if(null===e||"object"!=typeof e)throw new Error("Can not call `Record` with a non-object as default values. Use a plain javascript object instead.")}(e)
var r=function(o){var a=this
if(o instanceof r)return o
if(!(this instanceof r))return new r(o)
if(!n){n=!0
var s=Object.keys(e),l=i._indices={}
i._name=t,i._keys=s,i._defaultValues=e
for(var c=0;c<s.length;c++){var u=s[c]
l[u]=c,i[u]?"object"==typeof console&&console.warn&&console.warn("Cannot define "+rr(this)+' with property "'+u+'" since that property name is part of the Record API.'):or(i,u)}}return this.__ownerID=void 0,this._values=Xt().withMutations(function(e){e.setSize(a._keys.length),d(o).forEach(function(t,n){e.set(a._indices[n],t===a._defaultValues[n]?void 0:t)})}),this},i=r.prototype=Object.create(tr)
return i.constructor=r,t&&(r.displayName=t),r}
er.prototype.toString=function(){for(var e,t=rr(this)+" { ",n=this._keys,r=0,i=n.length;r!==i;r++)t+=(r?", ":"")+(e=n[r])+": "+Vt(this.get(e))
return t+" }"},er.prototype.equals=function(e){return this===e||z(e)&&ir(this).equals(ir(e))},er.prototype.hashCode=function(){return ir(this).hashCode()},er.prototype.has=function(e){return this._indices.hasOwnProperty(e)},er.prototype.get=function(e,t){if(!this.has(e))return t
var n=this._indices[e],r=this._values.get(n)
return void 0===r?this._defaultValues[e]:r},er.prototype.set=function(e,t){if(this.has(e)){var n=this._values.set(this._indices[e],t===this._defaultValues[e]?void 0:t)
if(n!==this._values&&!this.__ownerID)return nr(this,n)}return this},er.prototype.remove=function(e){return this.set(e)},er.prototype.clear=function(){var e=this._values.clear().setSize(this._keys.length)
return this.__ownerID?this:nr(this,e)},er.prototype.wasAltered=function(){return this._values.wasAltered()},er.prototype.toSeq=function(){return ir(this)},er.prototype.toJS=function(){return jn(this)},er.prototype.entries=function(){return this.__iterator(2)},er.prototype.__iterator=function(e,t){return ir(this).__iterator(e,t)},er.prototype.__iterate=function(e,t){return ir(this).__iterate(e,t)},er.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this
var t=this._values.__ensureOwner(e)
return e?nr(this,t,e):(this.__ownerID=e,this._values=t,this)},er.isRecord=z,er.getDescriptiveName=rr
var tr=er.prototype
function nr(e,t,n){var r=Object.create(Object.getPrototypeOf(e))
return r._values=t,r.__ownerID=n,r}function rr(e){return e.constructor.displayName||e.constructor.name||"Record"}function ir(e){return ne(e._keys.map(function(t){return[t,e.get(t)]}))}function or(e,t){try{Object.defineProperty(e,t,{get:function(){return this.get(t)},set:function(e){gt(this.__ownerID,"Cannot set on an immutable record."),this.set(t,e)}})}catch(e){}}tr[F]=!0,tr[w]=tr.remove,tr.deleteIn=tr.removeIn=qt,tr.getIn=Fn,tr.hasIn=Gn.hasIn,tr.merge=Ye,tr.mergeWith=Ze,tr.mergeIn=lt,tr.mergeDeep=ot,tr.mergeDeepWith=at,tr.mergeDeepIn=st,tr.setIn=ct,tr.update=ut,tr.updateIn=dt,tr.withMutations=ht,tr.asMutable=ae,tr.asImmutable=oe,tr[g]=tr.entries,tr.toJSON=tr.toObject=Gn.toObject,tr.inspect=tr.toSource=function(){return this.toString()}},92726(e,t,n){"use strict"
n.d(t,{q:()=>i})
class r{constructor(){this.map=new Map,this.applicable=new Map}add(e,t,n){this.map.set(e,t),n&&this.applicable.set(e,n)}remove(e){this.map.delete(e),this.applicable.delete(e)}get(e){return this.map.get(e)}isApplicable(e){if(!this.map.has(e.sourceData.kind))return!1
const t=this.applicable.get(e.sourceData.kind)
return!t||t(e)}}var i
!function(e){e.create=function(e,t){const{name:n}=e,i=new r
return{descriptor:e,formatRegistry:i,isApplicable:e=>i.isApplicable(e),get(r){const o=(null==t?void 0:t.asDynamic)?r._dynamicPropertyData:r._staticPropertyData
if(o[n])return o[n]
if(r.customProperties.has(e))return
const a=i.get(r.sourceData.kind)
return a?(o[n]=a(r),r.customProperties.add(e),o[n]):void 0},set(e,r){(null==t?void 0:t.asDynamic)?e._dynamicPropertyData[n]=r:e._staticPropertyData[n]=r},delete(e){(null==t?void 0:t.asDynamic)?delete e._dynamicPropertyData[n]:delete e._staticPropertyData[n]}}}}(i||(i={}))},92867(e,t,n){"use strict"
n.r(t),n.d(t,{default:()=>Pe})
var r=n(61603),i=n(31130)
const o=["top","right","bottom","left"],a=Math.min,s=Math.max,l=Math.round,c=Math.floor,u=e=>({x:e,y:e}),d={left:"right",right:"left",bottom:"top",top:"bottom"},p={start:"end",end:"start"}
function h(e,t,n){return s(e,a(t,n))}function f(e,t){return"function"==typeof e?e(t):e}function m(e){return e.split("-")[0]}function g(e){return e.split("-")[1]}function y(e){return"x"===e?"y":"x"}function v(e){return"y"===e?"height":"width"}const b=new Set(["top","bottom"])
function x(e){return b.has(m(e))?"y":"x"}function S(e){return y(x(e))}function _(e){return e.replace(/start|end/g,e=>p[e])}const C=["left","right"],w=["right","left"],T=["top","bottom"],A=["bottom","top"]
function I(e){return e.replace(/left|right|bottom|top/g,e=>d[e])}function P(e){const{x:t,y:n,width:r,height:i}=e
return{width:r,height:i,top:n,left:t,right:t+r,bottom:n+i,x:t,y:n}}function B(e,t,n){let{reference:r,floating:i}=e
const o=x(t),a=S(t),s=v(a),l=m(t),c="y"===o,u=r.x+r.width/2-i.width/2,d=r.y+r.height/2-i.height/2,p=r[s]/2-i[s]/2
let h
switch(l){case"top":h={x:u,y:r.y-i.height}
break
case"bottom":h={x:u,y:r.y+r.height}
break
case"right":h={x:r.x+r.width,y:d}
break
case"left":h={x:r.x-i.width,y:d}
break
default:h={x:r.x,y:r.y}}switch(g(t)){case"start":h[a]-=p*(n&&c?-1:1)
break
case"end":h[a]+=p*(n&&c?-1:1)}return h}async function E(e,t){var n
void 0===t&&(t={})
const{x:r,y:i,platform:o,rects:a,elements:s,strategy:l}=e,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:p=!1,padding:h=0}=f(t,e),m=function(e){return"number"!=typeof e?function(e){return{top:0,right:0,bottom:0,left:0,...e}}(e):{top:e,right:e,bottom:e,left:e}}(h),g=s[p?"floating"===d?"reference":"floating":d],y=P(await o.getClippingRect({element:null==(n=await(null==o.isElement?void 0:o.isElement(g)))||n?g:g.contextElement||await(null==o.getDocumentElement?void 0:o.getDocumentElement(s.floating)),boundary:c,rootBoundary:u,strategy:l})),v="floating"===d?{x:r,y:i,width:a.floating.width,height:a.floating.height}:a.reference,b=await(null==o.getOffsetParent?void 0:o.getOffsetParent(s.floating)),x=await(null==o.isElement?void 0:o.isElement(b))&&await(null==o.getScale?void 0:o.getScale(b))||{x:1,y:1},S=P(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({elements:s,rect:v,offsetParent:b,strategy:l}):v)
return{top:(y.top-S.top+m.top)/x.y,bottom:(S.bottom-y.bottom+m.bottom)/x.y,left:(y.left-S.left+m.left)/x.x,right:(S.right-y.right+m.right)/x.x}}function k(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function D(e){return o.some(t=>e[t]>=0)}const M=new Set(["left","top"])
function R(){return"undefined"!=typeof window}function O(e){return F(e)?(e.nodeName||"").toLowerCase():"#document"}function L(e){var t
return(null==e||null==(t=e.ownerDocument)?void 0:t.defaultView)||window}function N(e){var t
return null==(t=(F(e)?e.ownerDocument:e.document)||window.document)?void 0:t.documentElement}function F(e){return!!R()&&(e instanceof Node||e instanceof L(e).Node)}function z(e){return!!R()&&(e instanceof Element||e instanceof L(e).Element)}function j(e){return!!R()&&(e instanceof HTMLElement||e instanceof L(e).HTMLElement)}function V(e){return!(!R()||"undefined"==typeof ShadowRoot)&&(e instanceof ShadowRoot||e instanceof L(e).ShadowRoot)}const U=new Set(["inline","contents"])
function G(e){const{overflow:t,overflowX:n,overflowY:r,display:i}=te(e)
return/auto|scroll|overlay|hidden|clip/.test(t+r+n)&&!U.has(i)}const H=new Set(["table","td","th"])
function q(e){return H.has(O(e))}const Q=[":popover-open",":modal"]
function $(e){return Q.some(t=>{try{return e.matches(t)}catch(e){return!1}})}const X=["transform","translate","scale","rotate","perspective"],W=["transform","translate","scale","rotate","perspective","filter"],Y=["paint","layout","strict","content"]
function Z(e){const t=K(),n=z(e)?te(e):e
return X.some(e=>!!n[e]&&"none"!==n[e])||!!n.containerType&&"normal"!==n.containerType||!t&&!!n.backdropFilter&&"none"!==n.backdropFilter||!t&&!!n.filter&&"none"!==n.filter||W.some(e=>(n.willChange||"").includes(e))||Y.some(e=>(n.contain||"").includes(e))}function K(){return!("undefined"==typeof CSS||!CSS.supports)&&CSS.supports("-webkit-backdrop-filter","none")}const J=new Set(["html","body","#document"])
function ee(e){return J.has(O(e))}function te(e){return L(e).getComputedStyle(e)}function ne(e){return z(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function re(e){if("html"===O(e))return e
const t=e.assignedSlot||e.parentNode||V(e)&&e.host||N(e)
return V(t)?t.host:t}function ie(e){const t=re(e)
return ee(t)?e.ownerDocument?e.ownerDocument.body:e.body:j(t)&&G(t)?t:ie(t)}function oe(e,t,n){var r
void 0===t&&(t=[]),void 0===n&&(n=!0)
const i=ie(e),o=i===(null==(r=e.ownerDocument)?void 0:r.body),a=L(i)
if(o){const e=ae(a)
return t.concat(a,a.visualViewport||[],G(i)?i:[],e&&n?oe(e):[])}return t.concat(i,oe(i,[],n))}function ae(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function se(e){const t=te(e)
let n=parseFloat(t.width)||0,r=parseFloat(t.height)||0
const i=j(e),o=i?e.offsetWidth:n,a=i?e.offsetHeight:r,s=l(n)!==o||l(r)!==a
return s&&(n=o,r=a),{width:n,height:r,$:s}}function le(e){return z(e)?e:e.contextElement}function ce(e){const t=le(e)
if(!j(t))return u(1)
const n=t.getBoundingClientRect(),{width:r,height:i,$:o}=se(t)
let a=(o?l(n.width):n.width)/r,s=(o?l(n.height):n.height)/i
return a&&Number.isFinite(a)||(a=1),s&&Number.isFinite(s)||(s=1),{x:a,y:s}}const ue=u(0)
function de(e){const t=L(e)
return K()&&t.visualViewport?{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}:ue}function pe(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=!1)
const i=e.getBoundingClientRect(),o=le(e)
let a=u(1)
t&&(r?z(r)&&(a=ce(r)):a=ce(e))
const s=function(e,t,n){return void 0===t&&(t=!1),!(!n||t&&n!==L(e))&&t}(o,n,r)?de(o):u(0)
let l=(i.left+s.x)/a.x,c=(i.top+s.y)/a.y,d=i.width/a.x,p=i.height/a.y
if(o){const e=L(o),t=r&&z(r)?L(r):r
let n=e,i=ae(n)
for(;i&&r&&t!==n;){const e=ce(i),t=i.getBoundingClientRect(),r=te(i),o=t.left+(i.clientLeft+parseFloat(r.paddingLeft))*e.x,a=t.top+(i.clientTop+parseFloat(r.paddingTop))*e.y
l*=e.x,c*=e.y,d*=e.x,p*=e.y,l+=o,c+=a,n=L(i),i=ae(n)}}return P({width:d,height:p,x:l,y:c})}function he(e,t){const n=ne(e).scrollLeft
return t?t.left+n:pe(N(e)).left+n}function fe(e,t){const n=e.getBoundingClientRect()
return{x:n.left+t.scrollLeft-he(e,n),y:n.top+t.scrollTop}}const me=new Set(["absolute","fixed"])
function ge(e,t,n){let r
if("viewport"===t)r=function(e,t){const n=L(e),r=N(e),i=n.visualViewport
let o=r.clientWidth,a=r.clientHeight,s=0,l=0
if(i){o=i.width,a=i.height
const e=K();(!e||e&&"fixed"===t)&&(s=i.offsetLeft,l=i.offsetTop)}const c=he(r)
if(c<=0){const e=r.ownerDocument,t=e.body,n=getComputedStyle(t),i="CSS1Compat"===e.compatMode&&parseFloat(n.marginLeft)+parseFloat(n.marginRight)||0,a=Math.abs(r.clientWidth-t.clientWidth-i)
a<=25&&(o-=a)}else c<=25&&(o+=c)
return{width:o,height:a,x:s,y:l}}(e,n)
else if("document"===t)r=function(e){const t=N(e),n=ne(e),r=e.ownerDocument.body,i=s(t.scrollWidth,t.clientWidth,r.scrollWidth,r.clientWidth),o=s(t.scrollHeight,t.clientHeight,r.scrollHeight,r.clientHeight)
let a=-n.scrollLeft+he(e)
const l=-n.scrollTop
return"rtl"===te(r).direction&&(a+=s(t.clientWidth,r.clientWidth)-i),{width:i,height:o,x:a,y:l}}(N(e))
else if(z(t))r=function(e,t){const n=pe(e,!0,"fixed"===t),r=n.top+e.clientTop,i=n.left+e.clientLeft,o=j(e)?ce(e):u(1)
return{width:e.clientWidth*o.x,height:e.clientHeight*o.y,x:i*o.x,y:r*o.y}}(t,n)
else{const n=de(e)
r={x:t.x-n.x,y:t.y-n.y,width:t.width,height:t.height}}return P(r)}function ye(e,t){const n=re(e)
return!(n===t||!z(n)||ee(n))&&("fixed"===te(n).position||ye(n,t))}function ve(e,t,n){const r=j(t),i=N(t),o="fixed"===n,a=pe(e,!0,o,t)
let s={scrollLeft:0,scrollTop:0}
const l=u(0)
function c(){l.x=he(i)}if(r||!r&&!o)if(("body"!==O(t)||G(i))&&(s=ne(t)),r){const e=pe(t,!0,o,t)
l.x=e.x+t.clientLeft,l.y=e.y+t.clientTop}else i&&c()
o&&!r&&i&&c()
const d=!i||r||o?u(0):fe(i,s)
return{x:a.left+s.scrollLeft-l.x-d.x,y:a.top+s.scrollTop-l.y-d.y,width:a.width,height:a.height}}function be(e){return"static"===te(e).position}function xe(e,t){if(!j(e)||"fixed"===te(e).position)return null
if(t)return t(e)
let n=e.offsetParent
return N(e)===n&&(n=n.ownerDocument.body),n}function Se(e,t){const n=L(e)
if($(e))return n
if(!j(e)){let t=re(e)
for(;t&&!ee(t);){if(z(t)&&!be(t))return t
t=re(t)}return n}let r=xe(e,t)
for(;r&&q(r)&&be(r);)r=xe(r,t)
return r&&ee(r)&&be(r)&&!Z(r)?n:r||function(e){let t=re(e)
for(;j(t)&&!ee(t);){if(Z(t))return t
if($(t))return null
t=re(t)}return null}(e)||n}const _e={convertOffsetParentRelativeRectToViewportRelativeRect:function(e){let{elements:t,rect:n,offsetParent:r,strategy:i}=e
const o="fixed"===i,a=N(r),s=!!t&&$(t.floating)
if(r===a||s&&o)return n
let l={scrollLeft:0,scrollTop:0},c=u(1)
const d=u(0),p=j(r)
if((p||!p&&!o)&&(("body"!==O(r)||G(a))&&(l=ne(r)),j(r))){const e=pe(r)
c=ce(r),d.x=e.x+r.clientLeft,d.y=e.y+r.clientTop}const h=!a||p||o?u(0):fe(a,l)
return{width:n.width*c.x,height:n.height*c.y,x:n.x*c.x-l.scrollLeft*c.x+d.x+h.x,y:n.y*c.y-l.scrollTop*c.y+d.y+h.y}},getDocumentElement:N,getClippingRect:function(e){let{element:t,boundary:n,rootBoundary:r,strategy:i}=e
const o=[..."clippingAncestors"===n?$(t)?[]:function(e,t){const n=t.get(e)
if(n)return n
let r=oe(e,[],!1).filter(e=>z(e)&&"body"!==O(e)),i=null
const o="fixed"===te(e).position
let a=o?re(e):e
for(;z(a)&&!ee(a);){const t=te(a),n=Z(a)
n||"fixed"!==t.position||(i=null),(o?!n&&!i:!n&&"static"===t.position&&i&&me.has(i.position)||G(a)&&!n&&ye(e,a))?r=r.filter(e=>e!==a):i=t,a=re(a)}return t.set(e,r),r}(t,this._c):[].concat(n),r],l=o[0],c=o.reduce((e,n)=>{const r=ge(t,n,i)
return e.top=s(r.top,e.top),e.right=a(r.right,e.right),e.bottom=a(r.bottom,e.bottom),e.left=s(r.left,e.left),e},ge(t,l,i))
return{width:c.right-c.left,height:c.bottom-c.top,x:c.left,y:c.top}},getOffsetParent:Se,getElementRects:async function(e){const t=this.getOffsetParent||Se,n=this.getDimensions,r=await n(e.floating)
return{reference:ve(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}},getClientRects:function(e){return Array.from(e.getClientRects())},getDimensions:function(e){const{width:t,height:n}=se(e)
return{width:t,height:n}},getScale:ce,isElement:z,isRTL:function(e){return"rtl"===te(e).direction}}
function Ce(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}const we=function(e){return void 0===e&&(e={}),{name:"shift",options:e,async fn(t){const{x:n,y:r,placement:i}=t,{mainAxis:o=!0,crossAxis:a=!1,limiter:s={fn:e=>{let{x:t,y:n}=e
return{x:t,y:n}}},...l}=f(e,t),c={x:n,y:r},u=await E(t,l),d=x(m(i)),p=y(d)
let g=c[p],v=c[d]
if(o){const e="y"===p?"bottom":"right"
g=h(g+u["y"===p?"top":"left"],g,g-u[e])}if(a){const e="y"===d?"bottom":"right"
v=h(v+u["y"===d?"top":"left"],v,v-u[e])}const b=s.fn({...t,[p]:g,[d]:v})
return{...b,data:{x:b.x-n,y:b.y-r,enabled:{[p]:o,[d]:a}}}}}},Te=function(e){return void 0===e&&(e={}),{name:"flip",options:e,async fn(t){var n,r
const{placement:i,middlewareData:o,rects:a,initialPlacement:s,platform:l,elements:c}=t,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:p,fallbackStrategy:h="bestFit",fallbackAxisSideDirection:y="none",flipAlignment:b=!0,...P}=f(e,t)
if(null!=(n=o.arrow)&&n.alignmentOffset)return{}
const B=m(i),k=x(s),D=m(s)===s,M=await(null==l.isRTL?void 0:l.isRTL(c.floating)),R=p||(D||!b?[I(s)]:function(e){const t=I(e)
return[_(e),t,_(t)]}(s)),O="none"!==y
!p&&O&&R.push(...function(e,t,n,r){const i=g(e)
let o=function(e,t,n){switch(e){case"top":case"bottom":return n?t?w:C:t?C:w
case"left":case"right":return t?T:A
default:return[]}}(m(e),"start"===n,r)
return i&&(o=o.map(e=>e+"-"+i),t&&(o=o.concat(o.map(_)))),o}(s,b,y,M))
const L=[s,...R],N=await E(t,P),F=[]
let z=(null==(r=o.flip)?void 0:r.overflows)||[]
if(u&&F.push(N[B]),d){const e=function(e,t,n){void 0===n&&(n=!1)
const r=g(e),i=S(e),o=v(i)
let a="x"===i?r===(n?"end":"start")?"right":"left":"start"===r?"bottom":"top"
return t.reference[o]>t.floating[o]&&(a=I(a)),[a,I(a)]}(i,a,M)
F.push(N[e[0]],N[e[1]])}if(z=[...z,{placement:i,overflows:F}],!F.every(e=>e<=0)){var j,V
const e=((null==(j=o.flip)?void 0:j.index)||0)+1,t=L[e]
if(t&&("alignment"!==d||k===x(t)||z.every(e=>x(e.placement)!==k||e.overflows[0]>0)))return{data:{index:e,overflows:z},reset:{placement:t}}
let n=null==(V=z.filter(e=>e.overflows[0]<=0).sort((e,t)=>e.overflows[1]-t.overflows[1])[0])?void 0:V.placement
if(!n)switch(h){case"bestFit":{var U
const e=null==(U=z.filter(e=>{if(O){const t=x(e.placement)
return t===k||"y"===t}return!0}).map(e=>[e.placement,e.overflows.filter(e=>e>0).reduce((e,t)=>e+t,0)]).sort((e,t)=>e[1]-t[1])[0])?void 0:U[0]
e&&(n=e)
break}case"initialPlacement":n=s}if(i!==n)return{reset:{placement:n}}}return{}}}},Ae=function(e){return void 0===e&&(e={}),{name:"hide",options:e,async fn(t){const{rects:n}=t,{strategy:r="referenceHidden",...i}=f(e,t)
switch(r){case"referenceHidden":{const e=k(await E(t,{...i,elementContext:"reference"}),n.reference)
return{data:{referenceHiddenOffsets:e,referenceHidden:D(e)}}}case"escaped":{const e=k(await E(t,{...i,altBoundary:!0}),n.floating)
return{data:{escapedOffsets:e,escaped:D(e)}}}default:return{}}}}}
var Ie=n(77853)
class Pe extends Ie.default{modify(e,[t],{strategy:n="fixed",offsetOptions:o=0,placement:l="bottom",flipOptions:u,shiftOptions:d,middleware:p=[],setVelcroData:h}){const y="string"==typeof t?document.querySelector(t):t;(0,r.assert)("no reference element defined",y instanceof HTMLElement||y instanceof SVGElement),(0,r.assert)("no floating element defined",e instanceof HTMLElement||t instanceof SVGElement),(0,r.assert)("reference and floating elements cannot be the same element",e!==t),(0,r.assert)("@middleware must be an array of one or more objects",Array.isArray(p)),Object.assign(e.style,{position:n,top:"0",left:"0"})
let v=async()=>{let{middlewareData:t,x:r,y:i}=await((e,t,n)=>{const r=new Map,i={platform:_e,...n},o={...i.platform,_c:r}
return(async(e,t,n)=>{const{placement:r="bottom",strategy:i="absolute",middleware:o=[],platform:a}=n,s=o.filter(Boolean),l=await(null==a.isRTL?void 0:a.isRTL(t))
let c=await a.getElementRects({reference:e,floating:t,strategy:i}),{x:u,y:d}=B(c,r,l),p=r,h={},f=0
for(let m=0;m<s.length;m++){const{name:n,fn:o}=s[m],{x:g,y:y,data:v,reset:b}=await o({x:u,y:d,initialPlacement:r,placement:p,strategy:i,middlewareData:h,rects:c,platform:a,elements:{reference:e,floating:t}})
u=null!=g?g:u,d=null!=y?y:d,h={...h,[n]:{...h[n],...v}},b&&f<=50&&(f++,"object"==typeof b&&(b.placement&&(p=b.placement),b.rects&&(c=!0===b.rects?await a.getElementRects({reference:e,floating:t,strategy:i}):b.rects),({x:u,y:d}=B(c,p,l))),m=-1)}return{x:u,y:d,placement:p,strategy:i,middlewareData:h}})(e,t,{...i,platform:o})})(y,e,{middleware:[(a=o,void 0===a&&(a=0),{name:"offset",options:a,async fn(e){var t,n
const{x:r,y:i,placement:o,middlewareData:s}=e,l=await async function(e,t){const{placement:n,platform:r,elements:i}=e,o=await(null==r.isRTL?void 0:r.isRTL(i.floating)),a=m(n),s=g(n),l="y"===x(n),c=M.has(a)?-1:1,u=o&&l?-1:1,d=f(t,e)
let{mainAxis:p,crossAxis:h,alignmentAxis:y}="number"==typeof d?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis}
return s&&"number"==typeof y&&(h="end"===s?-1*y:y),l?{x:h*u,y:p*c}:{x:p*c,y:h*u}}(e,a)
return o===(null==(t=s.offset)?void 0:t.placement)&&null!=(n=s.arrow)&&n.alignmentOffset?{}:{x:r+l.x,y:i+l.y,data:{...l,placement:o}}}}),Te(u),we(d),...p,Ae({strategy:"referenceHidden"}),Ae({strategy:"escaped"}),{name:"metadata",fn:e=>({data:e})}],placement:l,strategy:n})
var a
const{referenceHidden:s}=t.hide
Object.assign(e.style,{top:`${i}px`,left:`${r}px`,margin:0,visibility:s?"hidden":"visible"}),h?.(t.metadata)}
v()
let b=function(e,t,n,r){void 0===r&&(r={})
const{ancestorScroll:i=!0,ancestorResize:o=!0,elementResize:l="function"==typeof ResizeObserver,layoutShift:u="function"==typeof IntersectionObserver,animationFrame:d=!1}=r,p=le(e),h=i||o?[...p?oe(p):[],...oe(t)]:[]
h.forEach(e=>{i&&e.addEventListener("scroll",n,{passive:!0}),o&&e.addEventListener("resize",n)})
const f=p&&u?function(e,t){let n,r=null
const i=N(e)
function o(){var e
clearTimeout(n),null==(e=r)||e.disconnect(),r=null}return function l(u,d){void 0===u&&(u=!1),void 0===d&&(d=1),o()
const p=e.getBoundingClientRect(),{left:h,top:f,width:m,height:g}=p
if(u||t(),!m||!g)return
const y={rootMargin:-c(f)+"px "+-c(i.clientWidth-(h+m))+"px "+-c(i.clientHeight-(f+g))+"px "+-c(h)+"px",threshold:s(0,a(1,d))||1}
let v=!0
function b(t){const r=t[0].intersectionRatio
if(r!==d){if(!v)return l()
r?l(!1,r):n=setTimeout(()=>{l(!1,1e-7)},1e3)}1!==r||Ce(p,e.getBoundingClientRect())||l(),v=!1}try{r=new IntersectionObserver(b,{...y,root:i.ownerDocument})}catch(e){r=new IntersectionObserver(b,y)}r.observe(e)}(!0),o}(p,n):null
let m,g=-1,y=null
l&&(y=new ResizeObserver(e=>{let[r]=e
r&&r.target===p&&y&&(y.unobserve(t),cancelAnimationFrame(g),g=requestAnimationFrame(()=>{var e
null==(e=y)||e.observe(t)})),n()}),p&&!d&&y.observe(p),y.observe(t))
let v=d?pe(e):null
return d&&function t(){const r=pe(e)
v&&!Ce(v,r)&&n(),v=r,m=requestAnimationFrame(t)}(),n(),()=>{var e
h.forEach(e=>{i&&e.removeEventListener("scroll",n),o&&e.removeEventListener("resize",n)}),null==f||f(),null==(e=y)||e.disconnect(),y=null,d&&cancelAnimationFrame(m)}}(y,e,v);(0,i.registerDestructor)(this,b)}}},93036(e,t,n){"use strict"
n.d(t,{b:()=>d,r:()=>h})
var r=n(32775),i=n(20321),o=n(10314),a=n(52057),s=n(63317)
const l=r.eB.set,c=new o.Z("14"),u=new o.Z("98")
function d(e){const t=a.D.computeBounding(e)
return{box:t,sphere:s.f.fromBox3D((0,s.f)(),t)}}const p=(0,r.eB)()
function h(e){const{x:t,y:n,z:o,radius:a,indices:h}=e,f=i.C.size(h)
if(f>25e4)return d(e)
const m=f>1e4?c:u
m.reset()
for(let r=0;r<f;r++){const e=i.C.getAt(h,r)
l(p,t[e],n[e],o[e]),m.includePositionRadius(p,a&&a[e]||0)}m.finishedIncludeStep()
for(let r=0;r<f;r++){const e=i.C.getAt(h,r)
l(p,t[e],n[e],o[e]),m.radiusPositionRadius(p,a&&a[e]||0)}const g=m.getSphere()
if(!a&&s.f.hasExtrema(g)&&f<=g.extrema.length){const e=[]
for(let a=0;a<f;a++){const s=i.C.getAt(h,a)
e.push(r.eB.create(t[s],n[s],o[s]))}s.f.setExtrema(g,e)}return{box:m.getBox(),sphere:g}}},93076(e,t,n){"use strict"
n.d(t,{N:()=>r})
const r={Atom:"Atom Property",Chain:"Chain Property",Residue:"Residue Property",Symmetry:"Symmetry",Validation:"Validation",Misc:"Miscellaneous"}},93104(e,t,n){"use strict"
n.d(t,{K:()=>r})
var r,i=n(22750),o=n(87933),a=n(33205),s=n(32775),l=n(63356),c=n(1496),u=n(70292),d=n(64367),p=n(23968),h=n(717),f=n(10212),m=n(24762),g=n(99852),y=n(94603),v=n(87095),b=n(15769)
!function(e){function t(t,o){const s=[],{frames:l}=o,c=n(t),u=I(t),d=t.atomicHierarchy.atoms._rowCount
for(let n=0,p=l.length;n<p;++n){const o=l[n]
if(o.elementCount!==d)throw new Error(`Frame element count mismatch, got ${o.elementCount} but expected ${d}.`)
const c={...t,id:i.k.create22(),modelNum:n,atomicConformation:r(t,o),customProperties:new a.v,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)}
if(o.cell){const e=f.i.fromCell(o.cell.size,o.cell.anglesInRadians)
f.i.Provider.set(c,e)}e.TrajectoryInfo.set(c,{index:n,size:l.length}),e.CoarseGrained.set(c,u),s.push(c)}return{trajectory:s,srcIndexArray:c}}function n(e){const t=e.atomicHierarchy.atomSourceIndex
let n
return"__srcIndexArray__"in e._staticPropertyData?n=e._dynamicPropertyData.__srcIndexArray__:(n=m.VP.isIdentity(t)?void 0:t.toArray({array:Int32Array}),e._dynamicPropertyData.__srcIndexArray__=n),n}function r(e,t){return c.E.getAtomicConformation(t,{atomId:e.atomicConformation.atomId,occupancy:e.atomicConformation.occupancy,B_iso_or_equiv:e.atomicConformation.B_iso_or_equiv},n(e))}e.trajectoryFromModelAndCoordinates=function(e,n){return new y.P(t(e,n).trajectory)},e.trajectoryFromTopologyAndCoordinates=function(n,r){return u.Task.create("Create Trajectory",async i=>{const o=await(0,p.X)(n.basic,n.sourceData,i)
if(0===o.frameCount)throw new Error("found no model")
const a=o.representative,{trajectory:s}=t(a,r),l={pairs:n.bonds,count:a.atomicHierarchy.atoms._rowCount},c=d.z.fromData(l),u=I(a)
let h=0
for(const t of s)d.z.Provider.set(t,c),e.TrajectoryInfo.set(t,{index:h++,size:s.length}),e.CoarseGrained.set(t,u)
return new y.P(s)})},e.getAtomicConformationFromFrame=r
const x="__Center__"
e.getCenter=function(e){if(e._dynamicPropertyData[x])return e._dynamicPropertyData[x]
const t=function(e,t){const n=[],r=[],i=[]
e.x.length&&(n.push(...(0,l.em)(e.x)),r.push(...(0,l.em)(e.y)),i.push(...(0,l.em)(e.z))),t&&(t.spheres.x.length&&(n.push(...(0,l.em)(t.spheres.x)),r.push(...(0,l.em)(t.spheres.y)),i.push(...(0,l.em)(t.spheres.z))),t.gaussians.x.length&&(n.push(...(0,l.em)(t.gaussians.x)),r.push(...(0,l.em)(t.gaussians.y)),i.push(...(0,l.em)(t.gaussians.z))))
const[o,a]=(0,l.em)(n),[c,u]=(0,l.em)(r),[d,p]=(0,l.em)(i),h=o+(a-o)/2,f=c+(u-c)/2,m=d+(p-d)/2
return s.eB.create(h,f,m)}(e.atomicConformation,e.coarseConformation)
return e._dynamicPropertyData[x]=t,t}
const S="__AtomicRadii__"
e.getAtomicRadii=function(e){if(e._dynamicPropertyData[S])return e._dynamicPropertyData[S]
const t=e.atomicHierarchy.atoms._rowCount,n=e.atomicHierarchy.atoms.type_symbol.value,r=new Float32Array(t)
for(let i=0;i<t;i++)r[i]=(0,o.sO)(n(i))
return e._dynamicPropertyData[S]=r,r}
const _="__InvertedAtomSrcIndex__"
e.getInvertedAtomSourceIndex=function(e){if(e._staticPropertyData[_])return e._staticPropertyData[_]
const t=function(e){const t=new Int32Array(e.rowCount)
let n=!1
for(let r=0,i=e.rowCount;r<i;r++){const i=e.value(r)
i!==r&&(n=!1),t[i]=r}return{isIdentity:n,invertedIndex:t}}(e.atomicHierarchy.atomSourceIndex)
return e._staticPropertyData[_]=t,t}
const C="__TrajectoryInfo__"
e.TrajectoryInfo={get:e=>e._dynamicPropertyData[C]||{index:0,size:1},set:(e,t)=>e._dynamicPropertyData[C]=t}
const w="__AsymIdCount__"
e.AsymIdCount={get(e){if(e._dynamicPropertyData[w])return e._dynamicPropertyData[w]
const t=function(e){const t=new Set,n=new Set
return e.properties.structAsymMap.forEach(({auth_id:e},r)=>{t.add(e),n.add(r)}),{auth:t.size,label:n.size}}(e)
return e._dynamicPropertyData[w]=t,t}},e.AsymIdOffset=g._.createSimple("asym_id_offset","static"),e.Index=g._.createSimple("index","static"),e.MaxIndex=g._.createSimple("max_index","static"),e.getRoot=function(e){return e.parent||e},e.areHierarchiesEqual=function(e,t){return e.atomicHierarchy===t.atomicHierarchy&&e.coarseHierarchy===t.coarseHierarchy}
const T="__CoordinatesHistory__"
e.CoordinatesHistory={get:e=>e._staticPropertyData[T],set:(e,t)=>e._staticPropertyData[T]=t}
const A="__CoarseGrained__"
function I(t){let n=e.CoarseGrained.get(t)
if(void 0===n){let r=0,i=0
const{polymerType:o,directionToElementIndex:a}=t.atomicHierarchy.derived.residue
for(let e=0;e<o.length;++e)o[e]!==v.PolymerType.NA&&(r+=1,-1!==a[e]&&(i+=1))
let s=!1,l=!1
const{label_atom_id:c,_rowCount:u}=t.atomicHierarchy.atoms
for(let e=0;e<u;++e){const t=c.value(e)
if(s||"BB"!==t||(s=!0),l||"SC1"!==t||(l=!0),s&&l)break}n=!1,u>0&&r>0&&(s&&l||u/r<3||0===i)&&(n=!0),e.CoarseGrained.set(t,n)}return n}function P(e){return!!h.K4.is(e.sourceData)&&(null!==e.entryId.match(/^[1-9][a-z0-9]{3,3}$/i)||null!==e.entryId.match(/^pdb_[0-9]{4,4}[1-9][a-z0-9]{3,3}$/i))}e.CoarseGrained={get:e=>e._staticPropertyData[A],set:(e,t)=>e._staticPropertyData[A]=t},e.isCoarseGrained=I,e.hasCarbohydrate=function(e){return e.properties.saccharideComponentMap.size>0},e.hasProtein=function(e){const{subtype:t}=e.entities
for(let n=0,r=t.rowCount;n<r;++n)if(t.value(n).startsWith("polypeptide"))return!0
return!1},e.hasNucleic=function(e){const{subtype:t}=e.entities
for(let n=0,r=t.rowCount;n<r;++n){const e=t.value(n)
if(e.endsWith("ribonucleotide hybrid")||e.endsWith("ribonucleotide"))return!0}return!1},e.isFromPdbArchive=function(e){if(!h.K4.is(e.sourceData))return!1
const{db:t}=e.sourceData.data
for(let n=0,r=t.database_2.database_id.rowCount;n<r;++n)if("pdb"===t.database_2.database_id.value(n))return!0
return!1},e.hasPdbId=P,e.hasSecondaryStructure=function(e){if(h.K4.is(e.sourceData)){const{db:t}=e.sourceData.data
return t.struct_conf.id.isDefined||t.struct_sheet_range.id.isDefined}return b.v.Provider.isApplicable(e)}
const B=s.eB.create(1.5707963,1.5707963,1.5707963),E=s.eB.create(1,1,1)
function k(e){if(!h.K4.is(e.sourceData))return!1
const{db:t}=e.sourceData.data
for(let n=0;n<t.exptl.method.rowCount;n++)if(t.exptl.method.value(n).toUpperCase().indexOf("DIFFRACTION")>=0)return!0
return!1}function D(e){if(!h.K4.is(e.sourceData))return!1
const{db:t}=e.sourceData.data
for(let n=0;n<t.exptl.method.rowCount;n++)if(t.exptl.method.value(n).toUpperCase().indexOf("MICROSCOPY")>=0)return!0
return!1}function M(e){if(!h.K4.is(e.sourceData))return!1
if(!k(e))return!1
const{db:t}=e.sourceData.data,{status_code_sf:n}=t.pdbx_database_status
return n.isDefined&&"REL"===n.value(0)}function R(e){if(!h.K4.is(e.sourceData))return!1
const{db:t}=e.sourceData.data,{db_name:n,content_type:r}=t.pdbx_database_related
for(let i=0,o=t.pdbx_database_related._rowCount;i<o;++i)if("EMDB"===n.value(i).toUpperCase()&&"associated EM volume"===r.value(i))return!0
return!1}function O(e){return!!h.K4.is(e.sourceData)&&(M(e)||R(e))}e.hasCrystalSymmetry=function(e){var t
const n=null===(t=f.i.Provider.get(e))||void 0===t?void 0:t.spacegroup
return!(!n||1===n.num&&s.eB.equals(n.cell.anglesInRadians,B)&&s.eB.equals(n.cell.size,E))},e.isFromXray=k,e.isFromEm=D,e.isFromNmr=function(e){if(!h.K4.is(e.sourceData))return!1
const{db:t}=e.sourceData.data
for(let n=0;n<t.exptl.method.rowCount;n++)if(t.exptl.method.value(n).toUpperCase().indexOf("NMR")>=0)return!0
return!1},e.isExperimental=function(e){if(!h.K4.is(e.sourceData))return!1
const{db:t}=e.sourceData.data
for(let n=0;n<t.struct.pdbx_structure_determination_methodology.rowCount;n++)if("experimental"===t.struct.pdbx_structure_determination_methodology.value(n).toLowerCase())return!0
return!1},e.isIntegrative=function(e){if(!h.K4.is(e.sourceData))return!1
const{db:t}=e.sourceData.data
for(let n=0;n<t.struct.pdbx_structure_determination_methodology.rowCount;n++)if("integrative"===t.struct.pdbx_structure_determination_methodology.value(n).toLowerCase())return!0
return!1},e.isComputational=function(e){if(!h.K4.is(e.sourceData))return!1
const{db:t}=e.sourceData.data
for(let n=0;n<t.struct.pdbx_structure_determination_methodology.rowCount;n++)if("computational"===t.struct.pdbx_structure_determination_methodology.value(n).toLowerCase())return!0
return!1},e.hasXrayMap=M,e.hasEmMap=R,e.hasDensityMap=O,e.probablyHasDensityMap=function(t){if(!h.K4.is(t.sourceData))return!1
if(e.isIntegrative(t))return!1
const{db:n}=t.sourceData.data
return O(t)||P(t)&&(!n.exptl.method.isDefined||k(t)&&(!n.pdbx_database_status.status_code_sf.isDefined||n.pdbx_database_status.status_code_sf.valueKind(0)===m.VP.ValueKinds.Unknown)||D(t)&&!n.pdbx_database_related.db_name.isDefined)}}(r||(r={}))},93362(e,t,n){"use strict"
n.d(t,{$Z:()=>y,Ci:()=>g,Fc:()=>l,G0:()=>r,UV:()=>u,W_:()=>v,kx:()=>c})
var r,i=n(87423),o=n(32775),a=n(50690),s=n(95579)
function l(e){switch(e){case r.Spherical:return"Spherical"
case r.Terminal:return"Terminal"
case r.Linear:return"Linear"
case r.Trigonal:return"Trigonal"
case r.Tetrahedral:return"Tetrahedral"
case r.TrigonalBiPyramidal:return"Trigonal Bi-Pyramidal"
case r.Octahedral:return"Octahedral"
case r.SquarePlanar:return"Square Planar"
case r.Unknown:return"Unknown"}}function c(e){switch(e){case 0:return r.Spherical
case 1:return r.Terminal
case 2:return r.Linear
case 3:return r.Trigonal
case 4:return r.Tetrahedral
default:return r.Unknown}}!function(e){e[e.Spherical=0]="Spherical",e[e.Terminal=1]="Terminal",e[e.Linear=2]="Linear",e[e.Trigonal=3]="Trigonal",e[e.Tetrahedral=4]="Tetrahedral",e[e.TrigonalBiPyramidal=5]="TrigonalBiPyramidal",e[e.Octahedral=6]="Octahedral",e[e.SquarePlanar=7]="SquarePlanar",e[e.Unknown=8]="Unknown"}(r||(r={}))
const u=new Map([[r.Linear,(0,i.pu)(180)],[r.Trigonal,(0,i.pu)(120)],[r.Tetrahedral,(0,i.pu)(109.4721)],[r.Octahedral,(0,i.pu)(90)]]),d=(0,o.eB)(),p=(0,o.eB)(),h=(0,o.eB)(),f=(0,o.eB)(),m=(0,o.eB)()
function g(e,t,n,r,i,l=!0){const c=[],u=[]
return t.conformation.position(t.elements[n],h),r.conformation.position(r.elements[i],f),o.eB.sub(d,f,h),(0,a.LH)(e,t,n,(e,t)=>{(0,a.$X)(e,t)!==s.S8.H?(e.conformation.position(e.elements[t],m),o.eB.sub(p,m,h),c.push(o.eB.angle(d,p))):l||(e.conformation.position(e.elements[t],m),o.eB.sub(p,m,h),u.push(o.eB.angle(d,p)))}),[c,u]}function y(e,t,n,r,i){t.conformation.position(t.elements[n],h),r.conformation.position(r.elements[i],f),o.eB.sub(d,f,h)
const l=[(0,o.eB)(),(0,o.eB)()]
let c,u,g=0
if((0,a.LH)(e,t,n,(e,t)=>{g>1||(0,a.$X)(e,t)!==s.S8.H&&(c=e,u=t,e.conformation.position(e.elements[t],m),o.eB.sub(l[g++],m,h))}),1===g&&c&&u&&(0,a.LH)(e,c,u,(e,r)=>{g>1||e===t&&r===n||(0,a.$X)(e,r)!==s.S8.H&&(e.conformation.position(e.elements[r],m),o.eB.sub(l[g++],m,h))}),2===g)return o.eB.cross(p,l[0],l[1]),Math.abs(Math.PI/2-o.eB.angle(p,d))}function v(e,t,n,r,i){let l=n
t.conformation.position(t.elements[n],h),r.conformation.position(r.elements[i],f),o.eB.sub(d,f,h)
let c=o.eB.squaredDistance(h,f)
return(0,a.LH)(e,t,n,(e,t)=>{if((0,a.$X)(e,t)===s.S8.H){e.conformation.position(e.elements[t],m)
const n=o.eB.squaredDistance(m,f)
n<c&&(c=n,l=t)}}),l}},93588(e,t,n){"use strict"
n.r(t),n.d(t,{default:()=>a})
var r=n(15670),i=n(10336),o=n.n(i)
class a extends(o()){compute(e){for(let t=0,n=e.length;t<n;t++)if(!0===(0,r.A)(e[t]))return e[t]
return e[e.length-1]}}},93981(e,t,n){"use strict"
function r([e]){return Math.tan(e)}n.r(t),n.d(t,{default:()=>i,tan:()=>r})
var i=(0,n(10336).helper)(r)},94050(e,t,n){"use strict"
n.d(t,{iY:()=>r,Kx:()=>i.K,VP:()=>s.V,vw:()=>a.v,Or:()=>o})
var r,i=n(93104),o=n(87095),a=n(60566),s=n(51473),l=n(44688),c=n(67538),u=n(9043)
function d(e){const t=new Map
for(let n=0,r=e.length;n<r;n++)t.set(n,e[n])
return t}!function(e){e.getCifDataSource=function(e,t,n){if(!t)return{rowCount:0}
if(n&&n[t.id])return n[t.id]
const r=t.getElements(e),i={data:r,rowCount:r.elements.length}
return n&&(n[t.id]=i),i},e.fromAtomMap=function(e){return new h(e)},e.fromAtomArray=function(e){return new h(d(e))}
const t=e=>e.atomicHierarchy.residueAtomSegments
e.fromResidueMap=function(e){return new p("residue",e,t,l.Nf.Kind.Atomic)},e.fromResidueArray=function(e){return new p("residue",d(e),t,l.Nf.Kind.Atomic)}
const n=e=>e.atomicHierarchy.chainAtomSegments
e.fromChainMap=function(e){return new p("chain",e,n,l.Nf.Kind.Atomic)},e.fromChainArray=function(e){return new p("chain",d(e),n,l.Nf.Kind.Atomic)},e.fromEntityMap=function(e){return new f(e)}}(r||(r={}))
class p{has(e){return this.map.has(e)}get(e){return this.map.get(e)}getStructureElements(e){const t=e.models
if(1!==t.length)throw new Error("Only works on structures with a single model.")
const n=new Set,r=e.unitSymmetryGroups,i=[],o=this.segmentGetter(t[0])
for(const a of r){const t=a.units[0]
if(t.kind!==this.kind)continue
const r=c.hT.transientSegments(o,t.elements)
for(;r.hasNext;){const o=r.move()
this.has(o.index)&&!n.has(o.index)&&(n.add(o.index),i[i.length]=l.iZ.Location.create(e,t,t.elements[o.start]))}}return i.sort((e,t)=>e.element-t.element),i}getElements(e){const t=this.segmentGetter(e.model).index,n=this.getStructureElements(e)
return{elements:n,property:e=>this.get(t[n[e].element])}}constructor(e,t,n,r){this.level=e,this.map=t,this.segmentGetter=n,this.id=u.kk.create22(),this.kind=r}}class h{has(e){return this.map.has(e)}get(e){return this.map.get(e)}getStructureElements(e){if(1!==e.models.length)throw new Error("Only works on structures with a single model.")
const t=new Set,n=e.unitSymmetryGroups,r=[]
for(const i of n){const n=i.units[0]
if(n.kind!==this.kind)continue
const o=n.elements
for(let i=0,a=o.length;i<a;i++){const a=o[i]
this.has(a)&&!t.has(a)&&(t.add(o[i]),r[r.length]=l.iZ.Location.create(e,n,a))}}return r.sort((e,t)=>e.element-t.element),r}getElements(e){const t=this.getStructureElements(e)
return{elements:t,property:e=>this.get(t[e].element)}}constructor(e){this.map=e,this.id=u.kk.create22(),this.level="atom",this.kind=l.Nf.Kind.Atomic}}class f{has(e){return this.map.has(e)}get(e){return this.map.get(e)}getStructureElements(e){const t=e.models
if(1!==t.length)throw new Error("Only works on structures with a single model.")
const n=t[0].atomicHierarchy.index,r=new Set,i=e.unitSymmetryGroups,o=[],a=t[0].atomicHierarchy.chainAtomSegments
for(const s of i){const t=s.units[0]
if(t.kind!==this.kind)continue
const i=c.hT.transientSegments(a,t.elements)
for(;i.hasNext;){const a=i.move(),s=n.getEntityFromChain(a.index)
this.has(s)&&!r.has(s)&&(r.add(s),o[o.length]=l.iZ.Location.create(e,t,t.elements[a.start]))}}return o.sort((e,t)=>e.element-t.element),o}getElements(e){const t=this.getStructureElements(e),n=e.model.atomicHierarchy.chainAtomSegments.index,r=e.model.atomicHierarchy.index
return{elements:t,property:e=>this.get(r.getEntityFromChain(n[t[e].element]))}}constructor(e){this.map=e,this.id=u.kk.create22(),this.level="entity",this.kind=l.Nf.Kind.Atomic}}},94274(e,t,n){"use strict"
n.d(t,{$q:()=>a,vX:()=>r,yw:()=>i})
const r=13330===new Uint16Array(new Uint8Array([18,52]).buffer)[0]
function i(e,t){const n=new ArrayBuffer(e.length),r=new Uint8Array(n)
for(let i=0,o=e.length;i<o;i+=t)for(let n=0;n<t;n++)r[i+t-n-1]=e[i+n]
return n}const o=28672
function a(e){if(e.length>o){const t=[]
for(let n=0;n<e.length;n+=o)t.push(String.fromCharCode.apply(null,e.subarray(n,n+o)))
return t.join("")}return String.fromCharCode.apply(null,e)}},94528(e,t,n){"use strict"
n.d(t,{h:()=>B})
var r,i=n(92384),o=n(39298),a=n(90050),s=n(14294),l=n(32775),c=n(54749),u=n(48187),d=n(77323)
!function(e){e.create=function(e){return{entries:(0,d.w)(),capacity:Math.max(1,e)}},e.get=function(e,t){for(let n=e.entries.first;n;n=n.next)if(n.value.key===t)return e.entries.remove(n),e.entries.addLast(n.value),n.value.data},e.set=function(e,t,n){let r
if(e.entries.count>=e.capacity){const t=e.entries.first
r=t.value.data,e.entries.remove(t)}return e.entries.addLast(function(e,t){return{key:e,data:t}}(t,n)),r},e.remove=function(e,t){for(let n=e.entries.first;n;n=n.next)if(n.value.key===t){e.entries.remove(n)
break}}}(r||(r={}))
var p=n(32896),h=n(89748),f=n(46448),m=n(15382),g=n(43472),y=n(48393),v=n(89),b=n(32372),x=n(23782),S=n(68569),_=n(8726),C=n(83569),w=n(20610),T=n(91660)
function A(e,t){return e===t}var I=n(71872)
class P{constructor(e=!1){this.isRunning=!1,this.queue=[],this.counter=0,this.log=e}enqueue(e){this.log&&console.log("SingleAsyncQueue enqueue",this.counter),this.queue[0]={id:this.counter,func:e},this.counter++,this.run()}async run(){if(this.isRunning)return
const e=this.queue.pop()
if(e){this.isRunning=!0
try{this.log&&console.log("SingleAsyncQueue run",e.id),await e.func(),this.log&&console.log("SingleAsyncQueue complete",e.id)}finally{this.isRunning=!1,this.run()}}}}class B extends(o.O.CreateBehavior({name:"Volume Streaming"})){}!function(e){function t(e,t,n,r,o={}){var s,l,c,u
return i.t.Group({isoValue:a.f.createIsoValueParam(null!==(s=o.isoValue)&&void 0!==s?s:n,r),color:i.t.Color(null!==(l=o.color)&&void 0!==l?l:t),wireframe:i.t.Boolean(null!==(c=o.wireframe)&&void 0!==c&&c),opacity:i.t.Numeric(null!==(u=o.opacity)&&void 0!==u?u:.3,{min:0,max:1,step:.01})},{label:e,isExpanded:!0})}e.RootTag="volume-streaming-info"
const n={byteOffset:0,rate:1,sampleCount:[1,1,1],valuesInfo:[{mean:0,min:-1,max:1,sigma:.1},{mean:0,min:-1,max:1,sigma:.1}]}
function d(r){const{entryData:o,defaultView:u,structure:d,channelParams:p={}}=r,h=o||{kind:"em",header:{sampling:[n],availablePrecisions:[{precision:0,maxVoxels:0}]},emDefaultContourLevel:a.f.IsoValue.relative(0)},f=d&&d.boundary.box||(0,s.DJ)()
return{view:i.t.MappedStatic(u||("em"===h.kind?"auto":"selection-box"),{off:i.t.Group({}),box:i.t.Group({bottomLeft:i.t.Vec3(f.min),topRight:i.t.Vec3(f.max)},{description:"Static box defined by cartesian coords.",isFlat:!0}),"selection-box":i.t.Group({radius:i.t.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in  within which the volume is shown."}),bottomLeft:i.t.Vec3(l.eB.create(0,0,0),{},{isHidden:!0}),topRight:i.t.Vec3(l.eB.create(0,0,0),{},{isHidden:!0})},{description:"Box around focused element.",isFlat:!0}),"camera-target":i.t.Group({radius:i.t.Numeric(.5,{min:0,max:1,step:.05},{description:"Radius within which the volume is shown (relative to the field of view)."}),dynamicDetailLevel:B(h.header.availablePrecisions,0,{label:"Dynamic Detail"}),bottomLeft:i.t.Vec3(l.eB.create(0,0,0),{},{isHidden:!0}),topRight:i.t.Vec3(l.eB.create(0,0,0),{},{isHidden:!0})},{description:"Box around camera target.",isFlat:!0}),cell:i.t.Group({}),auto:i.t.Group({radius:i.t.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in  within which the volume is shown."}),selectionDetailLevel:B(h.header.availablePrecisions,6,{label:"Selection Detail"}),isSelection:i.t.Boolean(!1,{isHidden:!0}),bottomLeft:i.t.Vec3(f.min,{},{isHidden:!0}),topRight:i.t.Vec3(f.max,{},{isHidden:!0})},{description:"Box around focused element.",isFlat:!0})},{options:e.ViewTypeOptions,description:'Controls what of the volume is displayed. "Off" hides the volume alltogether. "Bounded box" shows the volume inside the given box. "Around Interaction" shows the volume around the focused element/atom. "Whole Structure" shows the volume for the whole structure.'}),detailLevel:B(h.header.availablePrecisions,3),channels:"em"===h.kind?i.t.Group({em:t("EM",(0,c.Color)(6524815),h.emDefaultContourLevel||a.f.IsoValue.relative(1),h.header.sampling[0].valuesInfo[0],p.em)},{isFlat:!0}):i.t.Group({"2fo-fc":t("2Fo-Fc",(0,c.Color)(3367602),a.f.IsoValue.relative(1.5),h.header.sampling[0].valuesInfo[0],p["2fo-fc"]),"fo-fc(+ve)":t("Fo-Fc(+ve)",(0,c.Color)(3390259),a.f.IsoValue.relative(3),h.header.sampling[0].valuesInfo[1],p["fo-fc(+ve)"]),"fo-fc(-ve)":t("Fo-Fc(-ve)",(0,c.Color)(12268339),a.f.IsoValue.relative(-3),h.header.sampling[0].valuesInfo[1],p["fo-fc(-ve)"])},{isFlat:!0})}}function B(e,t,n){return i.t.Select(Math.min(t,e.length-1),e.map((e,t)=>[t,`${t+1} [ ${0|Math.pow(e.maxVoxels,1/3)}^3 cells ]`]),{description:"Determines the maximum number of voxels. Depending on the size of the volume options are in the range from 1 (0.52M voxels) to 7 (25.17M voxels).",...n})}function E(e){return{entry:{name:e.entry.name,params:{detailLevel:e.entry.params.detailLevel,channels:e.entry.params.channels,view:{name:e.entry.params.view.name,params:{...e.entry.params.view.params}}}}}}e.createParams=function(e={}){const{data:t,defaultView:n,channelParams:r}=e,o=new Map
t&&t.entries.forEach(e=>o.set(e.dataId,e))
const a=t?t.entries.map(e=>[e.dataId,e.dataId]):[],s=t?t.entries[0].dataId:""
return{entry:i.t.Mapped(s,a,e=>i.t.Group(d({entryData:o.get(e),defaultView:n,structure:t&&t.structure,channelParams:r})))}},e.createEntryParams=d,e.copyParams=E,e.ViewTypeOptions=[["off","Off"],["box","Bounded Box"],["selection-box","Around Focus"],["camera-target","Around Camera"],["cell","Whole Structure"],["auto","Auto"]],e.ChannelTypeOptions=[["em","em"],["2fo-fc","2fo-fc"],["fo-fc(+ve)","fo-fc(+ve)"],["fo-fc(-ve)","fo-fc(-ve)"]]
class k extends u.A.WithSubscribers{get info(){return this.infoMap.get(this.params.entry.name)}async queryData(e){let t=(0,p.r)(this.data.serverUrl,`${this.info.kind}/${this.info.dataId.toLowerCase()}`)
if(e){const{min:n,max:r}=e
t+=`/box/${n.map(e=>Math.round(1e3*e)/1e3).join(",")}/${r.map(e=>Math.round(1e3*e)/1e3).join(",")}`}else t+="/cell"
let n=this.params.entry.params.detailLevel
"auto"===this.params.entry.params.view.name&&this.params.entry.params.view.params.isSelection&&(n=this.params.entry.params.view.params.selectionDetailLevel),"camera-target"===this.params.entry.params.view.name&&e&&(n=this.decideDetail(e,this.params.entry.params.view.params.dynamicDetailLevel)),t+=`?detail=${n}`
const i=r.get(this.cache,t)
if(i)return i.data
const o=b.V.getUrlAsset(this.plugin.managers.asset,t),a=await this.plugin.runTask(this.plugin.managers.asset.resolve(o,"binary")),s=await this.parseCif(a.data)
if(!s)return
const l=r.set(this.cache,t,{data:s,asset:a})
return l&&l.asset.dispose(),s}async parseCif(e){const t=await this.plugin.runTask(h.f$.parseBinary(e))
if(t.isError)return void this.plugin.log.error("VolumeStreaming, parsing CIF: "+t.toString())
if(t.result.blocks.length<2)return void this.plugin.log.error("VolumeStreaming: Invalid data.")
const n={}
for(let r=1;r<t.result.blocks.length;r++){const e=t.result.blocks[r],i=h.f$.schema.densityServer(e),o=await this.plugin.runTask((0,f.G)(i))
n[e.header]=o}return n}async updateParams(e,t=!1){const n=E(this.params),r=n.entry.params.view.name
"off"!==r&&"cell"!==r&&(n.entry.params.view.params.bottomLeft=(null==e?void 0:e.min)||l.eB.zero(),n.entry.params.view.params.topRight=(null==e?void 0:e.max)||l.eB.zero()),"auto"===r&&(n.entry.params.view.params.isSelection=t)
const i=this.plugin.state.data,o=i.build().to(this.ref).update(n)
await m.PluginCommands.State.Update(this.plugin,{state:i,tree:o,options:{doNotUpdateCurrent:!0}})}getStructureRoot(){return this.plugin.state.data.select(g.QX.Generators.byRef(this.ref).rootOfType(o.O.Molecule.Structure))[0]}register(e){this.ref=e,this.subscribeObservable(this.plugin.state.events.object.removed,e=>{o.O.Molecule.Structure.is(e.obj)&&y.StructureElement.Loci.is(this.lastLoci)&&this.lastLoci.structure===e.obj.data&&(this.lastLoci=v.EmptyLoci)}),this.subscribeObservable(this.plugin.state.events.object.updated,e=>{o.O.Molecule.Structure.is(e.oldObj)&&y.StructureElement.Loci.is(this.lastLoci)&&this.lastLoci.structure===e.oldObj.data&&(this.lastLoci=v.EmptyLoci)}),this.subscribeObservable(this.plugin.managers.structure.focus.behaviors.current,e=>{if(!this.plugin.state.data.tree.children.has(this.ref))return
const t=e?e.loci:v.EmptyLoci
switch(this.params.entry.params.view.name){case"auto":this.updateAuto(t)
break
case"selection-box":this.updateSelectionBox(t)
break
default:this.lastLoci=t}})}unregister(){let e=this.cache.entries.first
for(;e;)e.value.data.asset.dispose(),e=e.next}isCameraTargetSame(e,t){if(!e||!t)return!1
const n=l.eB.equals(e.target,t.target),r=l.eB.squaredDistance(e.target,e.position),i=l.eB.squaredDistance(t.target,t.position),o=Math.abs(r-i)/r<.001
return n&&o}cameraTargetDistance(e){return l.eB.distance(e.target,e.position)}getBoxFromLoci(e){var t,n,r
if(v.Loci.isEmpty(e)||(0,v.isEmptyLoci)(e))return(0,s.DJ)()
const i=this.plugin.helpers.substructureParent.get(e.structure,!0)
if(!i)return(0,s.DJ)()
const o=this.getStructureRoot()
if(!o||(null===(t=o.obj)||void 0===t?void 0:t.data)!==(null===(n=i.obj)||void 0===n?void 0:n.data))return(0,s.DJ)()
const a=x.T.get(null===(r=o.obj)||void 0===r?void 0:r.data.models[0])
a&&l.$I.invert(this._invTransform,a)
const c=y.StructureElement.Loci.extendToWholeResidues(e),u=y.StructureElement.Loci.getBoundary(c,a&&!Number.isNaN(this._invTransform[0])?this._invTransform:void 0).box
return 1===y.StructureElement.Loci.size(c)&&s.DJ.expand(u,u,l.eB.create(1,1,1)),u}updateAuto(e){this.updateQueue.enqueue(async()=>{this.lastLoci=e,(0,v.isEmptyLoci)(e)?await this.updateParams("x-ray"===this.info.kind?this.data.structure.boundary.box:void 0,!1):await this.updateParams(this.getBoxFromLoci(e),!0)})}updateSelectionBox(e){this.updateQueue.enqueue(async()=>{v.Loci.areEqual(this.lastLoci,e)?this.lastLoci=v.EmptyLoci:this.lastLoci=e
const t=this.getBoxFromLoci(this.lastLoci)
await this.updateParams(t)})}updateCameraTarget(e){this.updateQueue.enqueue(async()=>{var t,n,r
const i=null===(t=this.plugin.canvas3d)||void 0===t?void 0:t.props.camera.manualReset
try{i||null===(n=this.plugin.canvas3d)||void 0===n||n.setProps({camera:{manualReset:!0}})
const t=this.boxFromCameraTarget(e,!0)
await this.updateParams(t)}finally{i||null===(r=this.plugin.canvas3d)||void 0===r||r.setProps({camera:{manualReset:i}})}})}boxFromCameraTarget(e,t){var n
const r=e.target,i=this.cameraTargetDistance(e)
let o=Math.tan(.5*e.fov)*i
const a=null===(n=this.plugin.canvas3d)||void 0===n?void 0:n.camera.viewport
let c,u,d
if(a&&a.width>a.height&&(o*=a.width/a.height),o*="camera-target"===this.params.entry.params.view.name?this.params.entry.params.view.params.radius:.5,t){const e=l.eB.zero()
s.DJ.size(e,this.data.structure.boundary.box),c=Math.min(o,.5*e[0]),u=Math.min(o,.5*e[1]),d=Math.min(o,.5*e[2])}else c=u=d=o
return s.DJ.create(l.eB.create(r[0]-c,r[1]-u,r[2]-d),l.eB.create(r[0]+c,r[1]+u,r[2]+d))}decideDetail(e,t){const n="x-ray"===this.info.kind?s.DJ.volume(this.data.structure.boundary.box):this.info.header.spacegroup.size.reduce((e,t)=>e*t,1)
let r=s.DJ.volume(e)/n
const i=this.info.header.availablePrecisions.length-1
let o=t
for(;r<=.5&&o<i;)r*=2,o+=1
return o}async update(e){const t="selection-box"===e.entry.params.view.name&&this.params&&this.params.entry&&this.params.entry.params&&this.params.entry.params.view&&"selection-box"!==this.params.entry.params.view.name
this.params=e
let n,r=!1
switch("camera-target"!==e.entry.params.view.name&&this.cameraTargetSubscription&&(this.cameraTargetSubscription.unsubscribe(),this.cameraTargetSubscription=void 0),e.entry.params.view.name){case"off":r=!0
break
case"box":n=s.DJ.create(e.entry.params.view.params.bottomLeft,e.entry.params.view.params.topRight),r=s.DJ.volume(n)<1e-4
break
case"selection-box":{n=t?this.getBoxFromLoci(this.lastLoci)||(0,s.DJ)():s.DJ.create(l.eB.clone(e.entry.params.view.params.bottomLeft),l.eB.clone(e.entry.params.view.params.topRight))
const i=e.entry.params.view.params.radius
r=s.DJ.volume(n)<1e-4,s.DJ.expand(n,n,l.eB.create(i,i,i))
break}case"camera-target":this.cameraTargetSubscription||(this.cameraTargetSubscription=this.subscribeObservable(this.cameraTargetObservable,e=>this.updateCameraTarget(e))),n=this.boxFromCameraTarget(this.plugin.canvas3d.camera.getSnapshot(),!0)
break
case"cell":n="x-ray"===this.info.kind?this.data.structure.boundary.box:void 0
break
case"auto":if(n=e.entry.params.view.params.isSelection||"x-ray"===this.info.kind?s.DJ.create(l.eB.clone(e.entry.params.view.params.bottomLeft),l.eB.clone(e.entry.params.view.params.topRight)):void 0,n&&(r=s.DJ.volume(n)<1e-4,e.entry.params.view.params.isSelection)){const t=e.entry.params.view.params.radius
s.DJ.expand(n,n,l.eB.create(t,t,t))}}const i=r?{}:await this.queryData(n)
if(!i)return!1
const o=e.entry.params.channels
return"x-ray"===this.info.kind?(this.channels["2fo-fc"]=this.createChannel(i["2FO-FC"]||a.f.One,o["2fo-fc"],this.info.header.sampling[0].valuesInfo[0]),this.channels["fo-fc(+ve)"]=this.createChannel(i["FO-FC"]||a.f.One,o["fo-fc(+ve)"],this.info.header.sampling[0].valuesInfo[1]),this.channels["fo-fc(-ve)"]=this.createChannel(i["FO-FC"]||a.f.One,o["fo-fc(-ve)"],this.info.header.sampling[0].valuesInfo[1])):this.channels.em=this.createChannel(i.EM||a.f.One,o.em,this.info.header.sampling[0].valuesInfo[0]),!0}createChannel(e,t,n){const r=t
return{data:e,color:r.color,wireframe:r.wireframe,opacity:r.opacity,isoValue:"relative"===r.isoValue.kind?r.isoValue:a.f.IsoValue.toRelative(r.isoValue,n)}}getDescription(){return"selection-box"===this.params.entry.params.view.name?"Selection":"camera-target"===this.params.entry.params.view.name?"Camera":"box"===this.params.entry.params.view.name?"Static Box":"cell"===this.params.entry.params.view.name?"Cell":""}constructor(e,t){var n,i
super(e,{}),this.plugin=e,this.data=t,this.cache=r.create(25),this.params={},this.lastLoci=v.EmptyLoci,this.ref="",this.cameraTargetObservable=this.plugin.canvas3d.didDraw.pipe((0,S.c)(500,void 0,{leading:!0,trailing:!0}),(0,_.T)(()=>{var e
return null===(e=this.plugin.canvas3d)||void 0===e?void 0:e.camera.getSnapshot()}),(n=(e,t)=>this.isCameraTargetSame(e,t),void 0===i&&(i=C.D),n=null!=n?n:A,(0,w.N)(function(e,t){var r,o=!0
e.subscribe((0,T._)(t,function(e){var a=i(e)
!o&&n(r,a)||(o=!1,r=a,t.next(e))}))})),(0,I.p)(e=>void 0!==e)),this.cameraTargetSubscription=void 0,this.channels={},this._invTransform=(0,l.$I)(),this.infoMap=new Map,this.data.entries.forEach(e=>this.infoMap.set(e.dataId,e)),this.updateQueue=new P}}e.Behavior=k}(B||(B={}))},94603(e,t,n){"use strict"
n.d(t,{P:()=>r})
class r{getFrameAtIndex(e){return this.frames[e]}constructor(e){this.frames=e,this.frameCount=e.length,this.representative=e[0],this.duration=e.length}}},95207(e,t,n){"use strict"
n.d(t,{g:()=>g})
var r=n(92426),i=n(9043),o=n(22063),a=n(95921),s=n(4800),l=n(47944),c=n(59455),u=n(95538),d=n(72866),p=n(28252),h=n(70292),f=n(46712)
class m{constructor(){this.queue=[]}run(e){this.queue.length<2?this.queue.push(e):this.queue[this.queue.length-1]=e,1===this.queue.length&&this.next()}async next(){for(;this.queue.length>0;)try{const e=this.queue[0]
await e()}catch(e){console.error("Error in SingleTaskQueue execution:",e)}finally{this.queue.shift()}}}class g extends a.e{updateState(e){return"current"in e&&!("currentAnimationTimeMs"in e)?super.updateState({...e,currentAnimationTimeMs:0}):super.updateState(e)}get current(){const e=this.state.current
return this.state.entries.find(t=>t.snapshot.id===e)}getIndex(e){return this.state.entries.indexOf(e)}getEntry(e){if(e)return this.entryMap.get(e)}remove(e){const t=this.entryMap.get(e)
t&&((null==t?void 0:t.image)&&this.plugin.managers.asset.delete(t.image),this.entryMap.delete(e),this.updateState({current:this.state.current===e?void 0:this.state.current,entries:this.state.entries.delete(this.getIndex(t))}),this.events.changed.next(void 0))}add(e){this.entryMap.set(e.snapshot.id,e),this.updateState({current:e.snapshot.id,entries:this.state.entries.push(e)}),this.events.changed.next(void 0)}replace(e,t,n){var r,i,o,a
const s=this.getEntry(e)
if(!s)return
this.defaultSnapshotId=void 0,(null==s?void 0:s.image)&&this.plugin.managers.asset.delete(s.image)
const l=this.getIndex(s),c=g.Entry(t,{key:null!==(r=null==n?void 0:n.key)&&void 0!==r?r:s.key,name:null!==(i=null==n?void 0:n.name)&&void 0!==i?i:s.name,description:null!==(o=null==n?void 0:n.description)&&void 0!==o?o:s.description,descriptionFormat:null!==(a=null==n?void 0:n.descriptionFormat)&&void 0!==a?a:s.descriptionFormat,image:null==n?void 0:n.image})
this.entryMap.set(t.id,c),this.updateState({current:c.snapshot.id,entries:this.state.entries.set(l,c)}),this.events.changed.next(void 0)}move(e,t){const n=this.state.entries.size
if(n<2)return
const r=this.getEntry(e)
if(!r)return
const i=this.getIndex(r)
let o=(i+t)%n
o<0&&(o+=n)
const a=this.state.entries.get(o),s=this.state.entries.asMutable()
s.set(o,r),s.set(i,a),this.updateState({current:r.snapshot.id,entries:s.asImmutable()}),this.events.changed.next(void 0)}update(e,t){var n,r,i
const o=this.getIndex(e)
if(o<0)return
const a=this.state.entries.set(o,{...e,key:(null===(n=t.key)||void 0===n?void 0:n.trim())||void 0,name:(null===(r=t.name)||void 0===r?void 0:r.trim())||void 0,description:(null===(i=t.description)||void 0===i?void 0:i.trim())||void 0,descriptionFormat:t.descriptionFormat})
this.updateState({entries:a}),this.entryMap.set(e.snapshot.id,this.state.entries.get(o)),this.events.changed.next(void 0)}clear(){0!==this.state.entries.size&&(this.entryMap.forEach(e=>{(null==e?void 0:e.image)&&this.plugin.managers.asset.delete(e.image)}),this.entryMap.clear(),this.updateState({current:void 0,entries:(0,r.B8)()}),this.events.changed.next(void 0))}applyKey(e){const t=this.state.entries.find(t=>t.key===e)
t&&(this.updateState({current:t.snapshot.id}),this.events.changed.next(void 0),this.plugin.state.setSnapshot(t.snapshot))}setCurrent(e){const t=this.getEntry(e)
return t&&(this.updateState({current:e}),this.events.changed.next(void 0)),t&&t.snapshot}setSnapshotAnimationFrame(e,t=!1){var n
const r=this.getEntry(this.state.current)
if(!r)return
const i=null!==(n=o.p.getStateTransitionFrameIndex(r.snapshot,e))&&void 0!==n?n:0
return this.updateState({currentAnimationTimeMs:e})&&this.events.changed.next(void 0),t&&this.animationFrameQueue.run(()=>this.plugin.state.setAnimationSnapshot(r.snapshot,null!=i?i:0)),i}getNextId(e,t){const n=this.state.entries.size
if(!e){if(0===n)return
const e=-1===t?n-1:0
return this.state.entries.get(e).snapshot.id}const r=this.getEntry(e)
if(!r)return
let i=this.getIndex(r)
return i<0?void 0:(i=(i+t)%n,i<0&&(i+=n),this.state.entries.get(i).snapshot.id)}applyNext(e){const t=this.getNextId(this.state.current,e)
if(t){const e=this.setCurrent(t)
if(e)return this.plugin.state.setSnapshot(e)}}async setStateSnapshot(e){var t
this.clear()
const n=(0,r.B8)().asMutable()
for(const r of e.entries)this.entryMap.set(r.snapshot.id,r),n.push(r)
const i=e.current?e.current:e.entries.length>0?e.entries[0].snapshot.id:void 0
if(this.updateState({current:i,entries:n.asImmutable(),isPlaying:!1,nextSnapshotDelayInMs:e.playback?e.playback.nextSnapshotDelayInMs:g.DefaultNextSnapshotDelayInMs}),this.events.changed.next(void 0),!i)return
const o=this.getEntry(i),a=o&&o.snapshot
return a?(await this.plugin.state.setSnapshot(a),(null===(t=e.playback)||void 0===t?void 0:t.isPlaying)&&this.play({delayFirst:!0}),a):void 0}async syncCurrent(e){var t,n
const r=0===this.state.entries.size,i=1===this.state.entries.size&&this.state.current&&(!this.defaultSnapshotId||this.state.current===this.defaultSnapshotId)
if(!r&&!i)return
const o=this.plugin.state.getSnapshot(null==e?void 0:e.params),a=(null!==(n=null===(t=null==e?void 0:e.params)||void 0===t?void 0:t.image)&&void 0!==n?n:this.plugin.state.snapshotParams.value.image)?await g.getCanvasImageAsset(this.plugin,`${o.id}-image.png`):void 0
if(r)this.add(g.Entry(o,{name:null==e?void 0:e.name,description:null==e?void 0:e.description,descriptionFormat:null==e?void 0:e.descriptionFormat,image:a}))
else if(i){const e=this.getEntry(this.state.current);(null==e?void 0:e.image)&&this.plugin.managers.asset.delete(e.image),this.replace(this.state.current,o,{image:a})}this.defaultSnapshotId=o.id}async getStateSnapshot(e){await this.syncCurrent(e)
const t=this.state.entries.valueSeq().toArray()
for(let n=0;n<t.length;n++)t[n]._transientData&&(t[n]={...t[n]},delete t[n]._transientData)
return{timestamp:+new Date,version:d.j,name:e&&e.name,description:e&&e.description,current:this.state.current,playback:{isPlaying:!(!e||!e.playOnLoad),nextSnapshotDelayInMs:this.state.nextSnapshotDelayInMs},entries:t}}async serialize(e){const t=JSON.stringify(await this.getStateSnapshot({params:null==e?void 0:e.params}),null,2)
if((null==e?void 0:e.type)&&"json"!==e.type&&"molj"!==e.type){const e=new Uint8Array((0,s.VH)(t));(0,s.rj)(e,0,t)
const n={"state.json":e},r=[]
for(const{asset:t,file:o}of this.plugin.managers.asset.assets)r.push([t.id,t]),n[`assets/${t.id}`]=new Uint8Array(await o.arrayBuffer())
if(r.length>0){const e=JSON.stringify(r,null,2),t=new Uint8Array((0,s.VH)(e));(0,s.rj)(t,0,e),n["assets.json"]=t}const i=await this.plugin.runTask((0,l.qQ)(n))
return new Blob([i],{type:"application/zip"})}return new Blob([t],{type:"application/json;charset=utf-8"})}async open(e){try{const t=e.name.toLowerCase()
if(t.endsWith("json")||t.endsWith("molj")){const t=await this.plugin.runTask((0,c.dH)(e,"string")),n=JSON.parse(f.LQ.toString(t))
g.isStateSnapshot(n)?await this.setStateSnapshot(n):g.isStateSnapshot(n.data)?await this.setStateSnapshot(n.data):await this.plugin.state.setSnapshot(n)}else{const t=await this.plugin.runTask((0,c.dH)(e,"zip")),n=Object.create(null);(0,u.IF)(t,(e,t)=>{if("state.json"===t||"assets.json"===t)return
const r=t.substring(t.indexOf("/")+1)
n[r]=e})
const r=new File([t["state.json"]],"state.json"),i=await this.plugin.runTask((0,c.dH)(r,"json"))
if(t["assets.json"]){const e=new File([t["assets.json"]],"assets.json"),r=await this.plugin.runTask((0,c.dH)(e,"json"))
for(const[t,i]of r)this.plugin.managers.asset.set(i,new File([n[t]],i.name))}await this.setStateSnapshot(i)}this.events.opened.next(void 0)}catch(e){console.error(e),this.plugin.log.error("Error reading state")}}async startPlayback(){const{current:e}=this
if(e){if(!e.snapshot.transition)return this.next()
{const e=this.setCurrent(this.state.current)
await this.plugin.state.setSnapshot(e)
const t=void 0!==e.durationInMs?e.durationInMs:this.state.nextSnapshotDelayInMs
this.state.isPlaying&&(this.timeoutHandle=setTimeout(this.next,t))}}}async play(e){if(this.state.isPlaying&&!(null==e?void 0:e.delayFirst)){if(!(null==e?void 0:e.restart))return
await this.stop()}if(this.updateState({isPlaying:!0}),null==e?void 0:e.delayFirst){const e=this.getEntry(this.state.current)
if(!e)return void this.next()
this.events.changed.next(void 0)
const t=e.snapshot,n=void 0!==t.durationInMs?t.durationInMs:this.state.nextSnapshotDelayInMs
this.timeoutHandle=setTimeout(this.next,n)}else this.startPlayback()}async stop(){await this.plugin.managers.animation.stop(),this.updateState({isPlaying:!1}),void 0!==this.timeoutHandle&&clearTimeout(this.timeoutHandle),this.timeoutHandle=void 0,this.events.changed.next(void 0)}async togglePlay(){this.state.isPlaying?(await this.stop(),this.plugin.managers.markdownExtensions.audio.pause()):await this.play()}dispose(){super.dispose(),this.entryMap.clear()}constructor(e){super({current:void 0,entries:(0,r.B8)(),isPlaying:!1,nextSnapshotDelayInMs:g.DefaultNextSnapshotDelayInMs}),this.plugin=e,this.entryMap=new Map,this.defaultSnapshotId=void 0,this.events={changed:this.ev(),opened:this.ev()},this.animationFrameQueue=new m,this.timeoutHandle=void 0,this.next=async()=>{this.timeoutHandle=void 0
const e=this.getNextId(this.state.current,1)
if(!e||e===this.state.current)return void this.stop()
const t=this.setCurrent(e)
await this.plugin.state.setSnapshot(t)
const n=void 0!==t.durationInMs?t.durationInMs:this.state.nextSnapshotDelayInMs
this.state.isPlaying&&(this.timeoutHandle=setTimeout(this.next,n))}}}g.DefaultNextSnapshotDelayInMs=1500,function(e){e.Entry=function(e,t){return{timestamp:+new Date,snapshot:e,...t}},e.isStateSnapshot=function(e){const t=e
return!!t&&!!t.timestamp&&!!t.entries},e.getCanvasImageAsset=async function(e,t){const n=h.Task.create("Render Screenshot",async n=>{if(!e.helpers.viewportScreenshot)return
const r=await e.helpers.viewportScreenshot.getPreview(n,512)
if(!r)return
const o=await(0,p.PG)(r.canvas,"png"),a=new File([o],t),s={kind:"file",id:i.kk.create22(),name:t}
return e.managers.asset.set(s,a),s})
return e.runTask(n)}}(g||(g={}))},95408(e,t,n){"use strict"
n.d(t,{W:()=>s})
var r=n(28074),i=n(25602),o=n(38981),a=n(41288)
class s extends i.PureComponent{constructor(){super(...arguments),this.hide=()=>this.props.onSelect(void 0)}render(){const e=this.props,t=(0,r.jsx)(l,{items:e.items,onSelect:e.onSelect,current:e.current,multiselect:this.props.multiselect,noOffset:this.props.noOffset,noAccent:this.props.noAccent})
return(0,r.jsxs)("div",{className:"msp-action-menu-options"+(e.header?"":" msp-action-menu-options-no-header"),children:[e.header&&(0,r.jsx)(o.tW,{header:e.header,title:e.title,initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.hide,topRightIcon:a.X6,children:t}),!e.header&&t]})}}!function(e){function t(t,n){const{label:r,value:i,category:o,selected:a,icon:s,addOn:l,description:c}=n||{}
let u
const d=[]
for(let p=0;p<t.length;p++){const h=t[p]
if((null==n?void 0:n.filter)&&!n.filter(h))continue
const f=null==o?void 0:o(h),m=r?r(h):""+h,g=i?i(h):h,y=c?c(h):"string"==typeof h?h:void 0
let v
f?(u||(u=new Map),v=u.get(f),v||(v=[e.Header(f,{description:f})],u.set(f,v),d.push(v))):v=d
const b=null==l?void 0:l(h)
v.push({kind:"item",label:m,value:g,icon:s?s(h):void 0,selected:a?a(h):void 0,addOn:b,description:y})}return d}e.Header=function(e,t){return t?{kind:"header",label:e,...t}:{kind:"header",label:e}},e.Item=function(e,t,n){return{kind:"item",label:e,value:t,...n}},e.createItems=t
const n={value:e=>e[0],label:e=>e[1],category:e=>e[2]}
e.createItemsFromSelectOptions=function(e,r){return t(e,r?{...n,...r}:n)},e.hasSelectedItem=function e(t){if(p(t))return!1
if(d(t))return!!t.selected
for(const n of t)if(e(n))return!0
return!1},e.findItem=function e(t,n){if(!p(t)){if(d(t))return t.value===n?t:void 0
for(const r of t){const t=e(r,n)
if(t)return t}}},e.getFirstItem=function e(t){if(!p(t)){if(d(t))return t
for(const n of t){const t=e(n)
if(t)return t}}}}(s||(s={}))
class l extends i.PureComponent{constructor(){super(...arguments),this.state=l.createState(this.props),this.toggleExpanded=e=>{this.setState({isExpanded:!this.state.isExpanded}),e.currentTarget.blur()},this.selectAll=()=>{const e=h(this.props.items,[]).filter(e=>!e.selected)
this.props.onSelect(e)},this.selectNone=()=>{const e=h(this.props.items,[]).filter(e=>!!e.selected)
this.props.onSelect(e)}}static createState(e,t){const n=u(e.items)&&p(e.items[0])?e.items[0]:void 0,r=!(null==n?void 0:n.isIndependent)&&(e.multiselect?s.hasSelectedItem(e.items):!!e.current&&!!s.findItem(e.items,e.current.value)||s.hasSelectedItem(e.items))
return{header:n,hasCurrent:r,isExpanded:r||(null!=t?t:!!(null==n?void 0:n.initiallyExpanded))}}componentDidUpdate(e){if(this.props.items!==e.items||this.props.current!==e.current){const t=u(this.props.items)&&u(e.items)&&p(this.props.items[0])&&p(e.items[0])&&this.props.items[0].label===e.items[0].label?this.state.isExpanded:void 0
this.setState(l.createState(this.props,t))}}get multiselectHeader(){const{header:e,hasCurrent:t}=this.state
return(0,r.jsxs)("div",{className:"msp-flex-row msp-control-group-header",children:[(0,r.jsx)(o.$n,{icon:this.state.isExpanded?a.DM:a.Cp,flex:!0,noOverflow:!0,onClick:this.toggleExpanded,title:`Click to ${this.state.isExpanded?"collapse":"expand"}.${(null==e?void 0:e.description)?` ${null==e?void 0:e.description}`:""}`,children:t?(0,r.jsx)("b",{children:null==e?void 0:e.label}):null==e?void 0:e.label}),(0,r.jsx)(o.$n,{icon:a.Xq,flex:!0,onClick:this.selectAll,style:{flex:"0 0 50px",textAlign:"right"},children:"All"}),(0,r.jsx)(o.$n,{icon:a.X6,flex:!0,onClick:this.selectNone,style:{flex:"0 0 50px",textAlign:"right"},children:"None"})]})}get basicHeader(){const{header:e,hasCurrent:t}=this.state
return(0,r.jsx)("div",{className:"msp-control-group-header",style:{marginTop:"1px"},children:(0,r.jsx)(o.$n,{noOverflow:!0,icon:this.state.isExpanded?a.DM:a.Cp,onClick:this.toggleExpanded,title:`Click to ${this.state.isExpanded?"collapse":"expand"}. ${(null==e?void 0:e.description)?null==e?void 0:e.description:""}`,children:t?(0,r.jsx)("b",{children:null==e?void 0:e.label}):null==e?void 0:e.label})})}render(){const{items:e,onSelect:t,current:n}=this.props
if(p(e))return null
if(d(e))return(0,r.jsx)(c,{item:e,onSelect:t,current:n,multiselect:this.props.multiselect})
const{header:i}=this.state
return(0,r.jsxs)(r.Fragment,{children:[i&&(this.props.multiselect&&this.state.isExpanded?this.multiselectHeader:this.basicHeader),(0,r.jsx)("div",{className:this.props.noOffset?void 0:this.props.noAccent?"msp-control-offset":"msp-accent-offset",children:(!i||this.state.isExpanded)&&e.map((e,i)=>p(e)?null:d(e)?(0,r.jsx)(c,{item:e,onSelect:t,current:n,multiselect:this.props.multiselect},i):(0,r.jsx)(l,{items:e,onSelect:t,current:n,multiselect:this.props.multiselect,noAccent:!0},i))})]})}}const c=({item:e,onSelect:t,current:n,multiselect:i})=>{const a=n===e,s=e.addOn?{position:"relative"}:void 0
return(0,r.jsxs)(o.$n,{icon:e.icon,noOverflow:!0,className:"msp-action-menu-button",onClick:n=>t(i?[e]:e,n),disabled:e.disabled,style:s,title:e.description,children:[a||e.selected?(0,r.jsx)("b",{children:e.label}):e.label,e.addOn]})}
function u(e){return!!e&&Array.isArray(e)}function d(e){return e&&"item"===e.kind}function p(e){return e&&"header"===e.kind}function h(e,t){if(p(e))return t
if(d(e))return t.push(e),t
for(const n of e)h(n,t)
return t}},95472(e,t,n){"use strict"
function r(e){let t=e^e>>4
return t=(3735928559^t)+(t<<5),t^=t>>11,t}function i(e,t){let n=23
return n=31*n+e|0,n=31*n+t|0,n^=n>>4,n=(3735928559^n)+(n<<5),n^=n>>11,n}function o(e,t,n){let r=23
return r=31*r+e|0,r=31*r+t|0,r=31*r+n|0,r^=r>>4,r=(3735928559^r)+(r<<5),r^=r>>11,r}function a(e,t,n,r){let i=23
return i=31*i+e|0,i=31*i+t|0,i=31*i+n|0,i=31*i+r|0,i^=i>>4,i=(3735928559^i)+(i<<5),i^=i>>11,i}function s(e){let t=0
for(let n=0,r=e.length;n<r;n++)t=(t<<5)-t+e.charCodeAt(n)|0
return t}function l(e,t){return(e+t)*(e+t+1)/2+t}function c(e,t){return e<t?l(e,t):l(t,e)}function u(e,t){const n=Math.floor((Math.sqrt(8*t+1)-1)/2),r=t-(n*n+n)/2
return e[0]=n-r,e[1]=r,e}function d(e){let t=2166136261
for(let n=0,r=e.length;n<r;++n)t^=e[n],t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24)
return t>>>0}n.d(t,{Ao:()=>u,CP:()=>o,C_:()=>r,TI:()=>d,XS:()=>y,YZ:()=>s,bd:()=>c,hX:()=>a,m1:()=>l,vb:()=>i}),new class{constructor(){this.hashTarget=new Uint32Array(8),this.numberBytes=new Uint8Array(8),this.numberView=new DataView(this.numberBytes.buffer)}hash(e){return this.hashTarget.set(p),this.hashValue(e,0),function(e){let t=""
for(let n=7;n>=0;n--)t+=g(e[n])
return t}(this.hashTarget)}hashValue(e,t){if(t>50)return
const n=typeof e
switch(this.addByte(n.charCodeAt(0)),n){case"string":this.addString(e)
break
case"number":this.addNumber(e)
break
case"boolean":this.addByte(e?1:0)
break
case"object":null===e?this.addByte(0):Array.isArray(e)?this.addArray(e,t):this.addObject(e,t)
break
case"undefined":this.addByte(255)}}addByte(e){this.hashTarget[0]^=255&e,function(e){h[0]=0,h[1]=0,h[2]=e[0]<<24,h[3]=e[0]>>>8|e[1]<<24,h[4]=e[1]>>>8|e[2]<<24,h[5]=e[2]>>>8|e[3]<<24,h[6]=e[3]>>>8|e[4]<<24,h[7]=e[4]>>>8|e[5]<<24,f[0]=e[0]<<8,f[1]=e[0]>>>24|e[1]<<8,f[2]=e[1]>>>24|e[2]<<8,f[3]=e[2]>>>24|e[3]<<8,f[4]=e[3]>>>24|e[4]<<8,f[5]=e[4]>>>24|e[5]<<8,f[6]=e[5]>>>24|e[6]<<8,f[7]=e[6]>>>24|e[7]<<8
let t=0
for(let n=0;n<8;n++){const r=59*e[n]+t
e[n]=r>>>0,t=Math.floor(r/4294967296)}t=0
for(let n=0;n<8;n++){const r=e[n]+h[n]+f[n]+t
e[n]=r>>>0,t=r>=4294967296?1:0}}(this.hashTarget)}addString(e){for(let t=0;t<e.length;t++){const n=e.charCodeAt(t)
n<128?this.addByte(n):n<2048?(this.addByte(192|n>>6),this.addByte(128|63&n)):(this.addByte(224|n>>12),this.addByte(128|n>>6&63),this.addByte(128|63&n))}}addNumber(e){if(Number.isNaN(e))this.addByte(127),this.addByte(192),this.addByte(0),this.addByte(0),this.addByte(0),this.addByte(0),this.addByte(0),this.addByte(0)
else if(Number.isFinite(e)){this.numberView.setFloat64(0,e,!1)
for(let e=0;e<8;e++)this.addByte(this.numberBytes[e])}else e>0?(this.addByte(127),this.addByte(128),this.addByte(0),this.addByte(0)):(this.addByte(255),this.addByte(128),this.addByte(0),this.addByte(0)),this.addByte(0),this.addByte(0),this.addByte(0),this.addByte(0)}addArray(e,t){this.addNumber(e.length)
for(let n=0;n<e.length;n++)this.addNumber(n),this.hashValue(e[n],t+1)}addObject(e,t){const n=Object.keys(e).sort()
this.addNumber(n.length)
for(const r of n)this.addString(r),this.hashValue(e[r],t+1)}}
const p=new Uint32Array([1818371886,129696066,1656234357,1653982605,383153456,3715178979,3004645376,256]),h=new Uint32Array(8),f=new Uint32Array(8),m=["00000000","0000000","000000","00000","0000","000","00","0"]
function g(e){const t=e.toString(16)
return t.length>=8?t:m[t.length]+t}function y(e,t=42){return function(e,t){let n=t>>>0,r=t>>>0,i=t>>>0,o=t>>>0
const a=e.length%16,s=e.length-a
for(let p=0;p<s;p+=16){let t=255&e.charCodeAt(p)|(255&e.charCodeAt(p+1))<<8|(255&e.charCodeAt(p+2))<<16|(255&e.charCodeAt(p+3))<<24,a=255&e.charCodeAt(p+4)|(255&e.charCodeAt(p+5))<<8|(255&e.charCodeAt(p+6))<<16|(255&e.charCodeAt(p+7))<<24,s=255&e.charCodeAt(p+8)|(255&e.charCodeAt(p+9))<<8|(255&e.charCodeAt(p+10))<<16|(255&e.charCodeAt(p+11))<<24,l=255&e.charCodeAt(p+12)|(255&e.charCodeAt(p+13))<<8|(255&e.charCodeAt(p+14))<<16|(255&e.charCodeAt(p+15))<<24
t=Math.imul(t,597399067),t=t<<15|t>>>17,t=Math.imul(t,2869860233),n^=t,n=n<<19|n>>>13,n+=r,n=Math.imul(n,5)+1444728091,a=Math.imul(a,2869860233),a=a<<16|a>>>16,a=Math.imul(a,951274213),r^=a,r=r<<17|r>>>15,r+=i,r=Math.imul(r,5)+197830471,s=Math.imul(s,951274213),s=s<<17|s>>>15,s=Math.imul(s,2716044179),i^=s,i=i<<15|i>>>17,i+=o,i=Math.imul(i,5)+2530024501,l=Math.imul(l,2716044179),l=l<<13|l>>>19,l=Math.imul(l,597399067),o^=l,o=o<<13|o>>>19,o+=n,o=Math.imul(o,5)+850148119}let l=0,c=0,u=0,d=0
switch(a){case 15:d^=e.charCodeAt(s+14)<<16
case 14:d^=e.charCodeAt(s+13)<<8
case 13:d^=e.charCodeAt(s+12),d=Math.imul(d,2716044179),d=d<<13|d>>>19,d=Math.imul(d,597399067),o^=d
case 12:u^=e.charCodeAt(s+11)<<24
case 11:u^=e.charCodeAt(s+10)<<16
case 10:u^=e.charCodeAt(s+9)<<8
case 9:u^=e.charCodeAt(s+8),u=Math.imul(u,951274213),u=u<<17|u>>>15,u=Math.imul(u,2716044179),i^=u
case 8:c^=e.charCodeAt(s+7)<<24
case 7:c^=e.charCodeAt(s+6)<<16
case 6:c^=e.charCodeAt(s+5)<<8
case 5:c^=e.charCodeAt(s+4),c=Math.imul(c,2869860233),c=c<<16|c>>>16,c=Math.imul(c,951274213),r^=c
case 4:l^=e.charCodeAt(s+3)<<24
case 3:l^=e.charCodeAt(s+2)<<16
case 2:l^=e.charCodeAt(s+1)<<8
case 1:l^=e.charCodeAt(s),l=Math.imul(l,597399067),l=l<<15|l>>>17,l=Math.imul(l,2869860233),n^=l}return n^=e.length,r^=e.length,i^=e.length,o^=e.length,n+=r,n+=i,n+=o,r+=n,i+=n,o+=n,n^=n>>>16,n=Math.imul(n,2246822507),n^=n>>>13,n=Math.imul(n,3266489909),n^=n>>>16,r^=r>>>16,r=Math.imul(r,2246822507),r^=r>>>13,r=Math.imul(r,3266489909),r^=r>>>16,i^=i>>>16,i=Math.imul(i,2246822507),i^=i>>>13,i=Math.imul(i,3266489909),i^=i>>>16,o^=o>>>16,o=Math.imul(o,2246822507),o^=o>>>13,o=Math.imul(o,3266489909),o^=o>>>16,n+=r,n+=i,n+=o,r+=n,i+=n,o+=n,(n>>>0).toString(16).padStart(8,"0")+(r>>>0).toString(16).padStart(8,"0")+(i>>>0).toString(16).padStart(8,"0")+(o>>>0).toString(16).padStart(8,"0")}(JSON.stringify(e),t)}},95538(e,t,n){"use strict"
n.d(t,{Go:()=>l,IF:()=>c,JW:()=>i,Wv:()=>s,bN:()=>a})
const r=Object.prototype.hasOwnProperty
function i(e,t){for(const n of Object.keys(t))r.call(t,n)&&void 0===e[n]&&(e[n]=t[n])
return e}function o(e,t){let n=!1
for(const i of Object.keys(t))if(r.call(t,i)&&t[i]!==e[i]){n=!0
break}return n?Object.assign({},e,t):e}function a(e,t){if(!e)return!t
if(!t)return!1
const n=Object.keys(e)
if(Object.keys(t).length!==n.length)return!1
for(const i of n)if(!r.call(e,i)||e[i]!==t[i])return!1
return!0}function s(e,t){let n=e
for(let r=0;r<t.length;r++)if(t[r]&&(n=o(e,t[r]),n!==e)){for(let e=r+1;e<t.length;e++)n=Object.assign(n,t[e])
break}return n}function l(e){if(null===e||"object"!=typeof e)return e
if(e instanceof Array){const t=[]
for(let n=0,r=e.length;n<r;n++)t[n]=l(e[n])
return t}if("object"==typeof e&&!("prototype"in e)){const t={}
for(const n in e)r.call(e,n)&&(t[n]=l(e[n]))
return t}throw new Error(`Can't clone, type "${typeof e}" unsupported`)}function c(e,t){if(e)for(const n of Object.keys(e))t(e[n],n)}},95579(e,t,n){"use strict"
n.d(t,{Hx:()=>d,S8:()=>r,Z6:()=>o,kV:()=>p,lb:()=>u})
var r,i=n(54509)
!function(e){e.H="H",e.D="D",e.T="T",e.HE="HE",e.LI="LI",e.BE="BE",e.B="B",e.C="C",e.N="N",e.O="O",e.F="F",e.NE="NE",e.NA="NA",e.MG="MG",e.AL="AL",e.SI="SI",e.P="P",e.S="S",e.CL="CL",e.AR="AR",e.K="K",e.CA="CA",e.SC="SC",e.TI="TI",e.V="V",e.CR="CR",e.MN="MN",e.FE="FE",e.CO="CO",e.NI="NI",e.CU="CU",e.ZN="ZN",e.GA="GA",e.GE="GE",e.AS="AS",e.SE="SE",e.BR="BR",e.KR="KR",e.RB="RB",e.SR="SR",e.Y="Y",e.ZR="ZR",e.NB="NB",e.MO="MO",e.TC="TC",e.RU="RU",e.RH="RH",e.PD="PD",e.AG="AG",e.CD="CD",e.IN="IN",e.SN="SN",e.SB="SB",e.TE="TE",e.I="I",e.XE="XE",e.CS="CS",e.BA="BA",e.LA="LA",e.CE="CE",e.PR="PR",e.ND="ND",e.PM="PM",e.SM="SM",e.EU="EU",e.GD="GD",e.TB="TB",e.DY="DY",e.HO="HO",e.ER="ER",e.TM="TM",e.YB="YB",e.LU="LU",e.HF="HF",e.TA="TA",e.W="W",e.RE="RE",e.OS="OS",e.IR="IR",e.PT="PT",e.AU="AU",e.HG="HG",e.TL="TL",e.PB="PB",e.BI="BI",e.PO="PO",e.AT="AT",e.RN="RN",e.FR="FR",e.RA="RA",e.AC="AC",e.TH="TH",e.PA="PA",e.U="U",e.NP="NP",e.PU="PU",e.AM="AM",e.CM="CM",e.BK="BK",e.CF="CF",e.ES="ES",e.FM="FM",e.MD="MD",e.NO="NO",e.LR="LR",e.RF="RF",e.DB="DB",e.SG="SG",e.BH="BH",e.HS="HS",e.MT="MT",e.DS="DS",e.RG="RG",e.CN="CN",e.NH="NH",e.FL="FL",e.MC="MC",e.LV="LV",e.TS="TS",e.OG="OG"}(r||(r={}))
const o={H:"Hydrogen",HE:"Helium",LI:"Lithium",BE:"Beryllium",B:"Boron",C:"Carbon",N:"Nitrogen",O:"Oxygen",F:"Fluorine",NE:"Neon",NA:"Sodium",MG:"Magnesium",AL:"Aluminum",SI:"Silicon",P:"Phosphorus",S:"Sulfur",CL:"Chlorine",AR:"Argon",K:"Potassium",CA:"Calcium",SC:"Scandium",TI:"Titanium",V:"Vanadium",CR:"Chromium",MN:"Manganese",FE:"Iron",CO:"Cobalt",NI:"Nickel",CU:"Copper",ZN:"Zinc",GA:"Gallium",GE:"Germanium",AS:"Arsenic",SE:"Selenium",BR:"Bromine",KR:"Krypton",RB:"Rubidium",SR:"Strontium",Y:"Yttrium",ZR:"Zirconium",NB:"Niobium",MO:"Molybdenum",TC:"Technetium",RU:"Ruthenium",RH:"Rhodium",PD:"Palladium",AG:"Silver",CD:"Cadmium",IN:"Indium",SN:"Tin",SB:"Antimony",TE:"Tellurium",I:"Iodine",XE:"Xenon",CS:"Cesium",BA:"Barium",LA:"Lanthanum",CE:"Cerium",PR:"Praseodymium",ND:"Neodymium",PM:"Promethium",SM:"Samarium",EU:"Europium",GD:"Gadolinium",TB:"Terbium",DY:"Dysprosium",HO:"Holmium",ER:"Erbium",TM:"Thulium",YB:"Ytterbium",LU:"Lutetium",HF:"Hafnium",TA:"Tantalum",W:"Wolfram",RE:"Rhenium",OS:"Osmium",IR:"Iridium",PT:"Platinum",AU:"Gold",HG:"Mercury",TL:"Thallium",PB:"Lead",BI:"Bismuth",PO:"Polonium",AT:"Astatine",RN:"Radon",FR:"Francium",RA:"Radium",AC:"Actinium",TH:"Thorium",PA:"Protactinium",U:"Uranium",NP:"Neptunium",PU:"Plutonium",AM:"Americium",CM:"Curium",BK:"Berkelium",CF:"Californium",ES:"Einsteinium",FM:"Fermium",MD:"Mendelevium",NO:"Nobelium",LR:"Lawrencium",RF:"Rutherfordium",DB:"Dubnium",SG:"Seaborgium",BH:"Bohrium",HS:"Hassium",MT:"Meitnerium",DS:"Darmstadtium",RG:"Roentgenium",CN:"Copernicium",NH:"Nihonium",FL:"Flerovium",MC:"Moscovium",LV:"Livermorium",TS:"Tennessine",OG:"Oganesson"},a=new Set(["LI","NA","K","RB","CS","FR"]),s=new Set(["BE","MG","CA","SR","BA","RA"])
new Set(["C","P","S","SE"]),new Set(["H","N","O","F","CL","BR","I"]),new Set(["HE","NE","AR","KR","XE","RN"])
const l=new Set(["ZN","GA","CD","IN","SN","HG","TI","PB","BI","PO","CN"])
new Set(["B","SI","GE","AS","SB","TE","AT"])
const c=new Set(["F","CL","BR","I","AT"])
function u(e){return c.has(e)}function d(e){const t=(0,i.PR)(e)
return t>=21&&t<=29||t>=39&&t<=47||t>=72&&t<=79||t>=104&&t<=108}function p(e){return function(e){return a.has(e)}(e)||function(e){return s.has(e)}(e)||function(e){const t=(0,i.PR)(e)
return t>=57&&t<=71}(e)||function(e){const t=(0,i.PR)(e)
return t>=89&&t<=103}(e)||d(e)||function(e){return l.has(e)}(e)}},95916(e,t,n){"use strict"
n.d(t,{UT:()=>S,m5:()=>T,u3:()=>A,wv:()=>C,uO:()=>w,g2:()=>b,NG:()=>g,n5:()=>x,G7:()=>_,NB:()=>P})
var r=n(9959),i=n(24060),o=n(91229)
const a=(0,r.q)(),s={apply_fog:"\nfloat preFogAlpha = gl_FragColor.a;\nif (uFog) {\n    float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);\n    float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));\n    float fogAlpha = (1.0 - fogFactor) * gl_FragColor.a;\n    if (!uTransparentBackground) {\n        if (gl_FragColor.a < 1.0) {\n            // transparent objects are blended with background color\n            gl_FragColor.a = fogAlpha;\n        } else {\n            // mix opaque objects with background color\n            gl_FragColor.rgb = mix(gl_FragColor.rgb, uFogColor, fogFactor);\n        }\n    } else {\n        #if defined(dRenderVariant_colorDpoit) && !defined(dGeometryType_directVolume)\n            if (gl_FragColor.a < 1.0) {\n                // transparent objects are blended with background color\n                gl_FragColor.a = fogAlpha;\n            } else {\n                // opaque objects need to be pre-multiplied alpha\n                gl_FragColor.rgb *= fogAlpha;\n                gl_FragColor.a = fogAlpha;\n            }\n        #else\n            // pre-multiplied alpha expected for transparent background\n            gl_FragColor.rgb *= fogAlpha;\n            gl_FragColor.a = fogAlpha;\n        #endif\n    }\n} else if (uTransparentBackground) {\n    #if !defined(dRenderVariant_colorDpoit) && !defined(dGeometryType_directVolume)\n        // pre-multiplied alpha expected for transparent background\n        gl_FragColor.rgb *= gl_FragColor.a;\n    #endif\n}\n",apply_interior_color:"\nif (interior) {\n    material.rgb = mix(material.rgb, uInteriorColor.rgb, uInteriorColor.a);\n\n    float isf = clamp(uInteriorSubstance.a, 0.0, 0.99); // clamp to avoid artifacts\n    metalness = mix(metalness, uInteriorSubstance.r, isf);\n    roughness = mix(roughness, uInteriorSubstance.g, isf);\n    bumpiness = mix(bumpiness, uInteriorSubstance.b, isf);\n\n    #ifdef dTransparentBackfaces_opaque\n        material.a = 1.0;\n    #endif\n}\n",apply_light_color:"\n#if defined(dIgnoreLight)\n    #ifdef bumpEnabled\n        if (uBumpFrequency > 0.0 && uBumpAmplitude > 0.0 && bumpiness > 0.0) {\n            material.rgb += fbm(vModelPosition * uBumpFrequency) * uBumpAmplitude * bumpiness;\n            material.rgb -= 0.5 * uBumpAmplitude * bumpiness;\n        }\n    #endif\n\n    #if defined(dRenderVariant_color)\n        material.rgb += material.rgb * emissive;\n    #endif\n\n    gl_FragColor = material;\n#else\n    #ifdef bumpEnabled\n        if (uBumpFrequency > 0.0 && uBumpAmplitude > 0.0 && bumpiness > 0.0) {\n            normal = perturbNormal(-vViewPosition, normal, fbm(vModelPosition * uBumpFrequency), (uBumpAmplitude * bumpiness) / uBumpFrequency);\n        }\n    #endif\n\n    vec4 color = material;\n\n    #if defined(dCelShaded)\n        // clamp to avoid artifacts\n        metalness = clamp(metalness, 0.0, 0.99);\n        roughness = clamp(roughness, 0.05, 1.0);\n    #endif\n\n    GeometricContext geometry;\n    geometry.position = -vViewPosition;\n    geometry.normal = normal;\n    geometry.viewDir = normalize(vViewPosition);\n\n    PhysicalMaterial physicalMaterial;\n    physicalMaterial.diffuseColor = color.rgb * (1.0 - metalness);\n    #ifdef enabledFragDepth\n        physicalMaterial.roughness = min(max(roughness, 0.0525), 1.0);\n    #else\n        vec3 dxy = max(abs(dFdx(normal)), abs(dFdy(normal)));\n        float geometryRoughness = max(max(dxy.x, dxy.y), dxy.z);\n        physicalMaterial.roughness = min(max(roughness, 0.0525) + geometryRoughness, 1.0);\n    #endif\n    physicalMaterial.specularColor = mix(vec3(0.04), color.rgb, metalness);\n    physicalMaterial.specularF90 = 1.0;\n\n    IncidentLight directLight;\n\n    vec3 outgoingLight = vec3(0.0);\n\n    #if defined(dCelShaded)\n        float celDiffuse;\n        float celSpecular;\n        float celIntensity;\n\n        #pragma unroll_loop_start\n        for (int i = 0; i < dLightCount; ++i) {\n            directLight.direction = uLightDirection[i];\n            directLight.color = uLightColor[i] * PI; // * PI for punctual light\n\n            celDiffuse = RECIPROCAL_PI * max(dot(geometry.normal, directLight.direction), 0.0) * (1.0 - metalness);\n            celSpecular = luminance(saturate(dot(geometry.normal, directLight.direction)) * BRDF_GGX(directLight.direction, geometry.viewDir, geometry.normal, physicalMaterial.specularColor, physicalMaterial.specularF90, roughness));\n\n            celIntensity = celDiffuse + celSpecular;\n            celIntensity = ceil(celIntensity * uCelSteps) / uCelSteps;\n\n            outgoingLight += color.rgb * directLight.color * celIntensity;\n        }\n        #pragma unroll_loop_end\n\n        outgoingLight += physicalMaterial.diffuseColor * luminance(uAmbientColor);\n    #else\n        ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\n\n        #pragma unroll_loop_start\n        for (int i = 0; i < dLightCount; ++i) {\n            directLight.direction = uLightDirection[i];\n            directLight.color = uLightColor[i] * PI; // * PI for punctual light\n            RE_Direct_Physical(directLight, geometry, physicalMaterial, reflectedLight);\n        }\n        #pragma unroll_loop_end\n\n        vec3 irradiance = uAmbientColor * PI; // * PI for punctual light\n        RE_IndirectDiffuse_Physical(irradiance, geometry, physicalMaterial, reflectedLight);\n\n        // indirect specular only metals\n        vec3 radiance = uAmbientColor * metalness;\n        vec3 iblIrradiance = uAmbientColor * metalness;\n        vec3 clearcoatRadiance = vec3(0.0);\n        RE_IndirectSpecular_Physical(radiance, iblIrradiance, clearcoatRadiance, geometry, physicalMaterial, reflectedLight);\n\n        outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n    #endif\n    outgoingLight = clamp(outgoingLight, 0.01, 0.99); // prevents black artifacts on specular highlight with transparent background\n\n    #if defined(dRenderVariant_color)\n        outgoingLight += color.rgb * emissive;\n    #endif\n\n    gl_FragColor = vec4(outgoingLight, color.a);\n#endif\n\ngl_FragColor.rgb *= uExposure;\n",apply_marker_color:"\n\n#if defined(dColorMarker)\n    if (marker > 0.0) {\n        if ((uMarkerPriority == 1 && marker != 2.0) || (uMarkerPriority != 1 && marker == 1.0)) {\n            gl_FragColor.rgb = mix(gl_FragColor.rgb, uHighlightColor, uHighlightStrength);\n            gl_FragColor.a = max(gl_FragColor.a, uHighlightStrength * 0.002); // for direct-volume rendering\n        } else {\n            gl_FragColor.rgb = mix(gl_FragColor.rgb, uSelectColor, uSelectStrength);\n            gl_FragColor.a = max(gl_FragColor.a, uSelectStrength * 0.002); // for direct-volume rendering\n        }\n    } else if (uMarkerAverage > 0.0) {\n        gl_FragColor.rgb = mix(gl_FragColor.rgb, uDimColor, uDimStrength);\n        gl_FragColor.a = max(gl_FragColor.a, uDimStrength * 0.002); // for direct-volume rendering\n    }\n#endif\n",assign_clipping_varying:"\n#if dClipObjectCount != 0 && defined(dClipping)\n    #if defined(dClippingType_instance)\n        vClipping = readFromTexture(tClipping, aInstance, uClippingTexDim).a;\n    #elif defined(dMarkerType_groupInstance)\n        vClipping = readFromTexture(tClipping, aInstance * float(uGroupCount) + group, uClippingTexDim).a;\n    #endif\n#endif\n",assign_color_varying:"\n#if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)\n    #if defined(dColorType_attribute)\n        vColor.rgb = aColor;\n    #elif defined(dColorType_instance)\n        vColor.rgb = readFromTexture(tColor, aInstance, uColorTexDim).rgb;\n    #elif defined(dColorType_group)\n        #if defined(dDualColor)\n            vec4 color2;\n            if (aColorMode == 2.0) {\n                vColor.rgb = readFromTexture(tColor, group, uColorTexDim).rgb;\n            } else {\n                vColor.rgb = readFromTexture(tColor, group * 2.0, uColorTexDim).rgb;\n                color2.rgb = readFromTexture(tColor, group * 2.0 + 1.0, uColorTexDim).rgb;\n            }\n        #else\n            vColor.rgb = readFromTexture(tColor, group, uColorTexDim).rgb;\n        #endif\n    #elif defined(dColorType_groupInstance)\n        #if defined(dDualColor)\n            vec4 color2;\n            if (aColorMode == 2.0) {\n                vColor.rgb = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim).rgb;\n            } else {\n                vColor.rgb = readFromTexture(tColor, (aInstance * float(uGroupCount) + group) * 2.0, uColorTexDim).rgb;\n                color2.rgb = readFromTexture(tColor, (aInstance * float(uGroupCount) + group) * 2.0 + 1.0, uColorTexDim).rgb;\n            }\n        #else\n            vColor.rgb = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim).rgb;\n        #endif\n    #elif defined(dColorType_vertex)\n        vColor.rgb = readFromTexture(tColor, vertexId, uColorTexDim).rgb;\n    #elif defined(dColorType_vertexInstance)\n        vColor.rgb = readFromTexture(tColor, int(aInstance) * uVertexCount + vertexId, uColorTexDim).rgb;\n    #elif defined(dColorType_volume)\n        vec3 cgridPos = (uColorGridTransform.w * (position - uColorGridTransform.xyz)) / uColorGridDim;\n        vColor.rgb = texture3dFrom2dLinear(tColorGrid, cgridPos, uColorGridDim, uColorTexDim).rgb;\n    #elif defined(dColorType_volumeInstance)\n        vec3 cgridPos = (uColorGridTransform.w * (vModelPosition / uModelScale - uColorGridTransform.xyz)) / uColorGridDim;\n        vColor.rgb = texture3dFrom2dLinear(tColorGrid, cgridPos, uColorGridDim, uColorTexDim).rgb;\n    #endif\n\n    #ifdef dUsePalette\n        vPaletteV = ((vColor.r * 256.0 * 256.0 * 255.0 + vColor.g * 256.0 * 255.0 + vColor.b * 255.0) - 1.0) / PALETTE_SCALE;\n    #endif\n\n    #ifdef dOverpaint\n        #if defined(dOverpaintType_instance)\n            vOverpaint = readFromTexture(tOverpaint, aInstance, uOverpaintTexDim);\n        #elif defined(dOverpaintType_groupInstance)\n            vOverpaint = readFromTexture(tOverpaint, aInstance * float(uGroupCount) + group, uOverpaintTexDim);\n        #elif defined(dOverpaintType_vertexInstance)\n            vOverpaint = readFromTexture(tOverpaint, int(aInstance) * uVertexCount + vertexId, uOverpaintTexDim);\n        #elif defined(dOverpaintType_volumeInstance)\n            vec3 ogridPos = (uOverpaintGridTransform.w * (vModelPosition / uModelScale - uOverpaintGridTransform.xyz)) / uOverpaintGridDim;\n            vOverpaint = texture3dFrom2dLinear(tOverpaintGrid, ogridPos, uOverpaintGridDim, uOverpaintTexDim);\n        #endif\n\n        // pre-mix to avoid darkening due to empty overpaint\n        #ifdef dColorType_uniform\n            vOverpaint.rgb = mix(uColor.rgb, vOverpaint.rgb, vOverpaint.a);\n        #else\n            vOverpaint.rgb = mix(vColor.rgb, vOverpaint.rgb, vOverpaint.a);\n        #endif\n        vOverpaint *= uOverpaintStrength;\n    #endif\n\n    #ifdef dEmissive\n        #if defined(dEmissiveType_instance)\n            vEmissive = readFromTexture(tEmissive, aInstance, uEmissiveTexDim).a;\n        #elif defined(dEmissiveType_groupInstance)\n            vEmissive = readFromTexture(tEmissive, aInstance * float(uGroupCount) + group, uEmissiveTexDim).a;\n        #elif defined(dEmissiveType_vertexInstance)\n            vEmissive = readFromTexture(tEmissive, int(aInstance) * uVertexCount + vertexId, uEmissiveTexDim).a;\n        #elif defined(dEmissiveType_volumeInstance)\n            vec3 egridPos = (uEmissiveGridTransform.w * (vModelPosition / uModelScale - uEmissiveGridTransform.xyz)) / uEmissiveGridDim;\n            vEmissive = texture3dFrom2dLinear(tEmissiveGrid, egridPos, uEmissiveGridDim, uEmissiveTexDim).a;\n        #endif\n        vEmissive *= uEmissiveStrength;\n    #endif\n\n    #ifdef dSubstance\n        #if defined(dSubstanceType_instance)\n            vSubstance = readFromTexture(tSubstance, aInstance, uSubstanceTexDim);\n        #elif defined(dSubstanceType_groupInstance)\n            vSubstance = readFromTexture(tSubstance, aInstance * float(uGroupCount) + group, uSubstanceTexDim);\n        #elif defined(dSubstanceType_vertexInstance)\n            vSubstance = readFromTexture(tSubstance, int(aInstance) * uVertexCount + vertexId, uSubstanceTexDim);\n        #elif defined(dSubstanceType_volumeInstance)\n            vec3 sgridPos = (uSubstanceGridTransform.w * (vModelPosition / uModelScale - uSubstanceGridTransform.xyz)) / uSubstanceGridDim;\n            vSubstance = texture3dFrom2dLinear(tSubstanceGrid, sgridPos, uSubstanceGridDim, uSubstanceTexDim);\n        #endif\n\n        // pre-mix to avoid artifacts due to empty substance\n        vSubstance.rgb = mix(vec3(uMetalness, uRoughness, uBumpiness), vSubstance.rgb, vSubstance.a);\n        vSubstance *= uSubstanceStrength;\n    #endif\n#elif defined(dRenderVariant_emissive)\n    #ifdef dEmissive\n        #if defined(dEmissiveType_instance)\n            vEmissive = readFromTexture(tEmissive, aInstance, uEmissiveTexDim).a;\n        #elif defined(dEmissiveType_groupInstance)\n            vEmissive = readFromTexture(tEmissive, aInstance * float(uGroupCount) + group, uEmissiveTexDim).a;\n        #elif defined(dEmissiveType_vertexInstance)\n            vEmissive = readFromTexture(tEmissive, int(aInstance) * uVertexCount + vertexId, uEmissiveTexDim).a;\n        #elif defined(dEmissiveType_volumeInstance)\n            vec3 egridPos = (uEmissiveGridTransform.w * (vModelPosition / uModelScale - uEmissiveGridTransform.xyz)) / uEmissiveGridDim;\n            vEmissive = texture3dFrom2dLinear(tEmissiveGrid, egridPos, uEmissiveGridDim, uEmissiveTexDim).a;\n        #endif\n        vEmissive *= uEmissiveStrength;\n    #endif\n#elif defined(dRenderVariant_pick)\n    #ifdef requiredDrawBuffers\n        vObject = vec4(packIntToRGB(float(uObjectId)), 1.0);\n        vInstance = vec4(packIntToRGB(aInstance), 1.0);\n        vGroup = vec4(packIntToRGB(group), 1.0);\n    #else\n        if (uPickType == 1) {\n            vColor = vec4(packIntToRGB(float(uObjectId)), 1.0);\n        } else if (uPickType == 2) {\n            vColor = vec4(packIntToRGB(aInstance), 1.0);\n        } else {\n            vColor = vec4(packIntToRGB(group), 1.0);\n        }\n    #endif\n#endif\n\n#ifdef dTransparency\n    #if defined(dTransparencyType_instance)\n        vTransparency = readFromTexture(tTransparency, aInstance, uTransparencyTexDim).a;\n    #elif defined(dTransparencyType_groupInstance)\n        vTransparency = readFromTexture(tTransparency, aInstance * float(uGroupCount) + group, uTransparencyTexDim).a;\n    #elif defined(dTransparencyType_vertexInstance)\n        vTransparency = readFromTexture(tTransparency, int(aInstance) * uVertexCount + vertexId, uTransparencyTexDim).a;\n    #elif defined(dTransparencyType_volumeInstance)\n        vec3 tgridPos = (uTransparencyGridTransform.w * (vModelPosition / uModelScale - uTransparencyGridTransform.xyz)) / uTransparencyGridDim;\n        vTransparency = texture3dFrom2dLinear(tTransparencyGrid, tgridPos, uTransparencyGridDim, uTransparencyTexDim).a;\n    #endif\n    vTransparency *= uTransparencyStrength;\n#endif\n",assign_group:"\n#ifdef dGeometryType_textureMesh\n    float group = unpackRGBToInt(readFromTexture(tGroup, vertexId, uGeoTexDim).rgb);\n#else\n    float group = aGroup;\n#endif\n",assign_marker_varying:"\n#if defined(dNeedsMarker)\n    #if defined(dMarkerType_instance)\n        vMarker = readFromTexture(tMarker, aInstance, uMarkerTexDim).a;\n    #elif defined(dMarkerType_groupInstance)\n        vMarker = readFromTexture(tMarker, aInstance * float(uGroupCount) + group, uMarkerTexDim).a;\n    #endif\n#endif\n",assign_material_color:"\n#if defined(dNeedsMarker)\n    float marker = uMarker;\n    if (uMarker == -1.0) {\n        marker = floor(vMarker * 255.0 + 0.5); // rounding required to work on some cards on win\n    }\n#endif\n\n#if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)\n    #if defined(dUsePalette)\n        vec4 material = vec4(texture2D(tPalette, vec2(vPaletteV, 0.5)).rgb, uAlpha);\n    #elif defined(dColorType_uniform)\n        vec4 material = vec4(uColor, uAlpha);\n    #elif defined(dColorType_varying)\n        vec4 material = vec4(vColor.rgb, uAlpha);\n    #endif\n\n    // mix material with overpaint\n    #if defined(dOverpaint)\n        material.rgb = mix(material.rgb, vOverpaint.rgb, vOverpaint.a);\n    #endif\n\n    float emissive = uEmissive;\n    #ifdef dEmissive\n        emissive += vEmissive;\n    #endif\n\n    float metalness = uMetalness;\n    float roughness = uRoughness;\n    float bumpiness = uBumpiness;\n    #ifdef dSubstance\n        float sf = clamp(vSubstance.a, 0.0, 0.99); // clamp to avoid artifacts\n        metalness = mix(metalness, vSubstance.r, sf);\n        roughness = mix(roughness, vSubstance.g, sf);\n        bumpiness = mix(bumpiness, vSubstance.b, sf);\n    #endif\n\n    #if defined(dXrayShaded)\n        material.a = calcXrayShadedAlpha(material.a, normal);\n    #endif\n#elif defined(dRenderVariant_depth)\n    if (fragmentDepth > getDepth(gl_FragCoord.xy / uDrawingBufferSize)) {\n        discard;\n    }\n    vec4 material;\n    if (uRenderMask == MaskOpaque) {\n        #if defined(dXrayShaded)\n            discard;\n        #endif\n        #if defined(dTransparency)\n            float dta = 1.0 - vTransparency;\n            #if __VERSION__ == 100 || defined(dVaryingGroup)\n                if (vTransparency < 0.1) dta = 1.0; // hard cutoff to avoid artifacts\n            #endif\n\n            if (uAlpha * dta < 1.0) {\n                discard;\n            }\n        #else\n            if (uAlpha < 1.0) {\n                discard;\n            }\n        #endif\n        material = packDepthToRGBA(fragmentDepth);\n    } else if (uRenderMask == MaskTransparent) {\n        float alpha = uAlpha;\n        #if defined(dTransparency)\n            float dta = 1.0 - vTransparency;\n            alpha *= dta;\n        #endif\n\n        #ifdef dXrayShaded\n            alpha = calcXrayShadedAlpha(alpha, normal);\n        #else\n            if (alpha == 1.0) {\n                discard;\n            }\n        #endif\n        material = packDepthWithAlphaToRGBA(fragmentDepth, alpha);\n    }\n#elif defined(dRenderVariant_marking)\n    vec4 material;\n    if(uMarkingType == 1) {\n        if (marker > 0.0)\n            discard;\n        #ifdef enabledFragDepth\n            material = packDepthToRGBA(gl_FragDepthEXT);\n        #else\n            material = packDepthToRGBA(gl_FragCoord.z);\n        #endif\n    } else {\n        if (marker == 0.0)\n            discard;\n        float depthTest = 1.0;\n        if (uMarkingDepthTest) {\n            depthTest = (fragmentDepth >= getDepthPacked(gl_FragCoord.xy / uDrawingBufferSize)) ? 1.0 : 0.0;\n        }\n        bool isHighlight = intMod(marker, 2.0) > 0.1;\n        float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);\n        float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));\n        if (fogFactor == 1.0)\n            discard;\n        material = vec4(0.0, depthTest, isHighlight ? 1.0 : 0.0, 1.0 - fogFactor);\n    }\n#elif defined(dRenderVariant_emissive)\n    float emissive = uEmissive;\n    #ifdef dEmissive\n        emissive += vEmissive;\n    #endif\n    vec4 material = vec4(emissive);\n#endif\n\n// apply per-group transparency\n#if defined(dTransparency) && (defined(dRenderVariant_pick) || defined(dRenderVariant_color) || defined(dRenderVariant_emissive) || defined(dRenderVariant_tracing))\n    float ta = 1.0 - vTransparency;\n    if (vTransparency < 0.09) ta = 1.0; // hard cutoff looks better\n\n    #if defined(dRenderVariant_pick)\n        if (ta * uAlpha < uPickingAlphaThreshold)\n            discard; // ignore so the element below can be picked\n    #elif defined(dRenderVariant_emissive)\n        if (ta < 1.0)\n            discard; // emissive not supported with transparency\n    #elif defined(dRenderVariant_color) || defined(dRenderVariant_tracing)\n        material.a *= ta;\n    #endif\n#endif\n",assign_position:"\nmat4 model = uModel * aTransform;\nmat4 modelView = uView * model;\n#ifdef dGeometryType_textureMesh\n    vec3 position = readFromTexture(tPosition, vertexId, uGeoTexDim).xyz;\n#else\n    vec3 position = aPosition;\n#endif\nvec4 position4 = vec4(position, 1.0);\n// for accessing tColorGrid in vert shader and for clipping in frag shader\nvModelPosition = (model * position4).xyz;\nvec4 mvPosition = modelView * position4;\nvViewPosition = mvPosition.xyz;\ngl_Position = uProjection * mvPosition;\n",assign_size:"\n#if defined(dSizeType_uniform)\n    float size = uSize;\n#elif defined(dSizeType_attribute)\n    float size = aSize;\n#elif defined(dSizeType_instance)\n    float size = unpackRGBToInt(readFromTexture(tSize, aInstance, uSizeTexDim).rgb);\n#elif defined(dSizeType_group)\n    float size = unpackRGBToInt(readFromTexture(tSize, group, uSizeTexDim).rgb);\n#elif defined(dSizeType_groupInstance)\n    float size = unpackRGBToInt(readFromTexture(tSize, aInstance * float(uGroupCount) + group, uSizeTexDim).rgb);\n#endif\n\n#if defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)\n    size /= 100.0; // NOTE factor also set in TypeScript\n#endif\n\nsize *= uSizeFactor;\n",check_picking_alpha:"\nfloat viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);\nfloat fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));\nfloat fogAlpha = (1.0 - fogFactor) * uAlpha;\nfloat alpha = uAlpha;\n#ifdef dXrayShaded\n    // add bias to make picking xray shaded elements easier\n    alpha = calcXrayShadedAlpha(alpha, normal) + (0.3 * uPickingAlphaThreshold);\n#endif\n// if not opaque enough ignore so the element below can be picked\nif (alpha < uPickingAlphaThreshold || fogAlpha < 0.1) {\n    #ifdef dTransparentBackfaces_opaque\n        if (!interior) discard;\n    #else\n        discard;\n    #endif\n}\n",check_transparency:"\n#if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)\n    #if defined(dTransparentBackfaces_off)\n        if (interior && material.a < 1.0) discard;\n    #elif defined(dTransparentBackfaces_opaque)\n        if (interior) material.a = 1.0;\n    #endif\n\n    #if !defined(dXrayShaded)\n        if ((uRenderMask == MaskOpaque && material.a < 1.0) ||\n            (uRenderMask == MaskTransparent && material.a == 1.0)\n        ) {\n            discard;\n        }\n    #endif\n#endif\n\n#if defined(dRenderVariant_depth)\n    #if defined(dTransparentBackfaces_off)\n        if (interior) discard;\n    #endif\n#endif\n",clip_instance:"\n#if defined(dClipVariant_instance) && dClipObjectCount != 0\n    vec3 mCenter = (uModel * aTransform * vec4(uInvariantBoundingSphere.xyz, 1.0)).xyz;\n    if (clipTest(mCenter / uModelScale)) {\n        // move out of [ -w, +w ] to 'discard' in vert shader\n        gl_Position.z = 2.0 * gl_Position.w;\n    }\n#endif\n",clip_pixel:"\n#if defined(dClipVariant_pixel) && dClipObjectCount != 0\n    if (clipTest(vModelPosition / uModelScale))\n        discard;\n#endif\n",color_frag_params:"\nuniform float uMetalness;\nuniform float uRoughness;\nuniform float uBumpiness;\n#ifdef bumpEnabled\n    uniform float uBumpFrequency;\n    uniform float uBumpAmplitude;\n#endif\nuniform float uEmissive;\n\n// Density value to estimate object thickness\nuniform float uDensity;\n\n#if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)\n    #if defined(dColorType_uniform)\n        uniform vec3 uColor;\n    #elif defined(dColorType_varying)\n        varying vec4 vColor;\n    #endif\n\n    #ifdef dUsePalette\n        uniform sampler2D tPalette;\n        varying float vPaletteV;\n    #endif\n\n    #ifdef dOverpaint\n        varying vec4 vOverpaint;\n    #endif\n\n    #ifdef dEmissive\n        varying float vEmissive;\n    #endif\n\n    #ifdef dSubstance\n        varying vec4 vSubstance;\n    #endif\n#elif defined(dRenderVariant_emissive)\n    #ifdef dEmissive\n        varying float vEmissive;\n    #endif\n#elif defined(dRenderVariant_pick)\n    #if __VERSION__ == 100 || !defined(dVaryingGroup)\n        #ifdef requiredDrawBuffers\n            varying vec4 vObject;\n            varying vec4 vInstance;\n            varying vec4 vGroup;\n        #else\n            varying vec4 vColor;\n        #endif\n    #else\n        #ifdef requiredDrawBuffers\n            flat in vec4 vObject;\n            flat in vec4 vInstance;\n            flat in vec4 vGroup;\n        #else\n            flat in vec4 vColor;\n        #endif\n    #endif\n#endif\n\n#ifdef dTransparency\n    varying float vTransparency;\n#endif\n",color_vert_params:"\nuniform float uMetalness;\nuniform float uRoughness;\nuniform float uBumpiness;\n\n#if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)\n    #if defined(dColorType_uniform)\n        uniform vec3 uColor;\n    #elif defined(dColorType_attribute)\n        varying vec4 vColor;\n        attribute vec3 aColor;\n    #elif defined(dColorType_texture)\n        varying vec4 vColor;\n        uniform vec2 uColorTexDim;\n        uniform sampler2D tColor;\n    #elif defined(dColorType_grid)\n        varying vec4 vColor;\n        uniform vec2 uColorTexDim;\n        uniform vec3 uColorGridDim;\n        uniform vec4 uColorGridTransform;\n        uniform sampler2D tColorGrid;\n    #elif defined(dColorType_direct)\n        varying vec4 vColor;\n    #endif\n\n    #ifdef dUsePalette\n        varying float vPaletteV;\n    #endif\n\n    #ifdef dOverpaint\n        #if defined(dOverpaintType_instance) || defined(dOverpaintType_groupInstance) || defined(dOverpaintType_vertexInstance)\n            varying vec4 vOverpaint;\n            uniform vec2 uOverpaintTexDim;\n            uniform sampler2D tOverpaint;\n        #elif defined(dOverpaintType_volumeInstance)\n            varying vec4 vOverpaint;\n            uniform vec2 uOverpaintTexDim;\n            uniform vec3 uOverpaintGridDim;\n            uniform vec4 uOverpaintGridTransform;\n            uniform sampler2D tOverpaintGrid;\n        #endif\n        uniform float uOverpaintStrength;\n    #endif\n\n    #ifdef dEmissive\n        #if defined(dEmissiveType_instance) || defined(dEmissiveType_groupInstance) || defined(dEmissiveType_vertexInstance)\n            varying float vEmissive;\n            uniform vec2 uEmissiveTexDim;\n            uniform sampler2D tEmissive;\n        #elif defined(dEmissiveType_volumeInstance)\n            varying float vEmissive;\n            uniform vec2 uEmissiveTexDim;\n            uniform vec3 uEmissiveGridDim;\n            uniform vec4 uEmissiveGridTransform;\n            uniform sampler2D tEmissiveGrid;\n        #endif\n        uniform float uEmissiveStrength;\n    #endif\n\n    #ifdef dSubstance\n        #if defined(dSubstanceType_instance) || defined(dSubstanceType_groupInstance) || defined(dSubstanceType_vertexInstance)\n            varying vec4 vSubstance;\n            uniform vec2 uSubstanceTexDim;\n            uniform sampler2D tSubstance;\n        #elif defined(dSubstanceType_volumeInstance)\n            varying vec4 vSubstance;\n            uniform vec2 uSubstanceTexDim;\n            uniform vec3 uSubstanceGridDim;\n            uniform vec4 uSubstanceGridTransform;\n            uniform sampler2D tSubstanceGrid;\n        #endif\n        uniform float uSubstanceStrength;\n    #endif\n#elif defined(dRenderVariant_emissive)\n    #ifdef dEmissive\n        #if defined(dEmissiveType_instance) || defined(dEmissiveType_groupInstance) || defined(dEmissiveType_vertexInstance)\n            varying float vEmissive;\n            uniform vec2 uEmissiveTexDim;\n            uniform sampler2D tEmissive;\n        #elif defined(dEmissiveType_volumeInstance)\n            varying float vEmissive;\n            uniform vec2 uEmissiveTexDim;\n            uniform vec3 uEmissiveGridDim;\n            uniform vec4 uEmissiveGridTransform;\n            uniform sampler2D tEmissiveGrid;\n        #endif\n        uniform float uEmissiveStrength;\n    #endif\n#elif defined(dRenderVariant_pick)\n    #if __VERSION__ == 100 || !defined(dVaryingGroup)\n        #ifdef requiredDrawBuffers\n            varying vec4 vObject;\n            varying vec4 vInstance;\n            varying vec4 vGroup;\n        #else\n            varying vec4 vColor;\n        #endif\n    #else\n        #ifdef requiredDrawBuffers\n            flat out vec4 vObject;\n            flat out vec4 vInstance;\n            flat out vec4 vGroup;\n        #else\n            flat out vec4 vColor;\n        #endif\n    #endif\n#endif\n\n#ifdef dTransparency\n    #if defined(dTransparencyType_instance) || defined(dTransparencyType_groupInstance) || defined(dTransparencyType_vertexInstance)\n        varying float vTransparency;\n        uniform vec2 uTransparencyTexDim;\n        uniform sampler2D tTransparency;\n    #elif defined(dTransparencyType_volumeInstance)\n        varying float vTransparency;\n        uniform vec2 uTransparencyTexDim;\n        uniform vec3 uTransparencyGridDim;\n        uniform vec4 uTransparencyGridTransform;\n        uniform sampler2D tTransparencyGrid;\n    #endif\n    uniform float uTransparencyStrength;\n#endif\n",common_clip:"\nvec3 quaternionTransform(const in vec4 q, const in vec3 v) {\n    vec3 t = 2.0 * cross(q.xyz, v);\n    return v + q.w * t + cross(q.xyz, t);\n}\n\nvec4 computePlane(const in vec3 normal, const in vec3 inPoint) {\n    return vec4(normalize(normal), -dot(normal, inPoint));\n}\n\nfloat planeSD(const in vec4 plane, const in vec3 center) {\n    return -dot(plane.xyz, center - plane.xyz * -plane.w);\n}\n\nfloat sphereSD(const in vec3 position, const in vec4 rotation, const in vec3 size, const in vec3 center) {\n    return (\n        length(quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position) / size) - 1.0\n    ) * min(min(size.x, size.y), size.z);\n}\n\nfloat cubeSD(const in vec3 position, const in vec4 rotation, const in vec3 size, const in vec3 center) {\n    vec3 d = abs(quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position)) - size;\n    return min(max(d.x, max(d.y, d.z)), 0.0) + length(max(d, 0.0));\n}\n\nfloat cylinderSD(const in vec3 position, const in vec4 rotation, const in vec3 size, const in vec3 center) {\n    vec3 t = quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position);\n\n    vec2 d = abs(vec2(length(t.xz), t.y)) - size.xy;\n    return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n}\n\nfloat infiniteConeSD(const in vec3 position, const in vec4 rotation, const in vec3 size, const in vec3 center) {\n    vec3 t = quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position);\n\n    float q = length(t.xy);\n    return dot(size.xy, vec2(q, t.z));\n}\n\nfloat getSignedDistance(const in vec3 center, const in int type, const in vec3 position, const in vec4 rotation, const in vec3 scale, const in mat4 transform) {\n    vec3 c = (transform * vec4(center, 1.0)).xyz;\n    if (type == 1) {\n        vec3 normal = quaternionTransform(rotation, vec3(0.0, 1.0, 0.0));\n        vec4 plane = computePlane(normal, position);\n        return planeSD(plane, c);\n    } else if (type == 2) {\n        return sphereSD(position, rotation, scale * 0.5, c);\n    } else if (type == 3) {\n        return cubeSD(position, rotation, scale * 0.5, c);\n    } else if (type == 4) {\n        return cylinderSD(position, rotation, scale * 0.5, c);\n    } else if (type == 5) {\n        return infiniteConeSD(position, rotation, scale * 0.5, c);\n    } else {\n        return 0.1;\n    }\n}\n\n#if __VERSION__ == 100\n    // 8-bit\n    int bitwiseAnd(in int a, in int b) {\n        int d = 128;\n        int result = 0;\n        for (int i = 0; i < 8; ++i) {\n            if (d <= 0) break;\n            if (a >= d && b >= d) result += d;\n            if (a >= d) a -= d;\n            if (b >= d) b -= d;\n            d /= 2;\n        }\n        return result;\n    }\n\n    bool hasBit(const in int mask, const in int bit) {\n        return bitwiseAnd(mask, bit) == 0;\n    }\n#else\n    bool hasBit(const in int mask, const in int bit) {\n        return (mask & bit) == 0;\n    }\n#endif\n\n#if dClipObjectCount != 0\n    bool clipTest(const in vec3 center) {\n        // flag is a bit-flag for clip-objects to ignore (note, object ids start at 1 not 0)\n        #if defined(dClipping)\n            int flag = int(floor(vClipping * 255.0 + 0.5));\n        #else\n            int flag = 0;\n        #endif\n\n        #pragma unroll_loop_start\n        for (int i = 0; i < dClipObjectCount; ++i) {\n            if (flag == 0 || hasBit(flag, UNROLLED_LOOP_INDEX + 1)) {\n                bool test = getSignedDistance(center, uClipObjectType[i], uClipObjectPosition[i], uClipObjectRotation[i], uClipObjectScale[i], uClipObjectTransform[i]) <= 0.0;\n                if ((!uClipObjectInvert[i] && test) || (uClipObjectInvert[i] && !test)) {\n                    return true;\n                }\n            }\n        }\n        #pragma unroll_loop_end\n        return false;\n    }\n#endif\n",common_frag_params:'\nuniform int uObjectId;\nuniform int uInstanceCount;\nuniform int uGroupCount;\n\nuniform int uPickType;\nuniform int uMarkingType;\n\nuniform vec4 uCameraPlane;\nuniform vec4 uLod;\n\n#if dClipObjectCount != 0\n    uniform int uClipObjectType[dClipObjectCount];\n    uniform bool uClipObjectInvert[dClipObjectCount];\n    uniform vec3 uClipObjectPosition[dClipObjectCount];\n    uniform vec4 uClipObjectRotation[dClipObjectCount];\n    uniform vec3 uClipObjectScale[dClipObjectCount];\n    uniform mat4 uClipObjectTransform[dClipObjectCount];\n\n    #if defined(dClipping)\n        #if __VERSION__ == 100 || defined(dClippingType_instance) || !defined(dVaryingGroup)\n            varying float vClipping;\n        #else\n            flat in float vClipping;\n        #endif\n    #endif\n#endif\n\n#if defined(dColorMarker)\n    uniform vec3 uHighlightColor;\n    uniform vec3 uSelectColor;\n    uniform vec3 uDimColor;\n    uniform float uHighlightStrength;\n    uniform float uSelectStrength;\n    uniform float uDimStrength;\n    uniform int uMarkerPriority;\n    uniform float uMarkerAverage;\n#endif\n\n#if defined(dNeedsMarker)\n    uniform float uMarker;\n    #if __VERSION__ == 100 || defined(dMarkerType_instance) || !defined(dVaryingGroup)\n        varying float vMarker;\n    #else\n        flat in float vMarker;\n    #endif\n#endif\n\n#if defined(dRenderVariant_colorDpoit)\n    #define MAX_DPOIT_DEPTH 99999.0 // NOTE constant also set in TypeScript\n    uniform sampler2D tDpoitDepth;\n    uniform sampler2D tDpoitFrontColor;\n#endif\n\nvarying vec3 vModelPosition;\nvarying vec3 vViewPosition;\n\nuniform vec2 uViewOffset;\nuniform float uModelScale;\n\nuniform float uNear;\nuniform float uFar;\nuniform float uIsOrtho;\n\nuniform bool uFog;\nuniform float uFogNear;\nuniform float uFogFar;\nuniform vec3 uFogColor;\n\nuniform float uAlpha;\nuniform float uPickingAlphaThreshold;\nuniform bool uTransparentBackground;\n\nuniform bool uDoubleSided;\nbool interior;\n\nuniform float uXrayEdgeFalloff;\nuniform float uCelSteps;\nuniform float uExposure;\n\nuniform mat4 uProjection;\n\nuniform int uRenderMask;\nuniform bool uMarkingDepthTest;\n\nuniform sampler2D tDepth;\nuniform vec2 uDrawingBufferSize;\n\nfloat getDepthPacked(const in vec2 coords) {\n    return unpackRGBAToDepth(texture2D(tDepth, coords));\n}\n\nfloat getDepth(const in vec2 coords) {\n    #ifdef depthTextureSupport\n        return texture2D(tDepth, coords).r;\n    #else\n        return unpackRGBAToDepth(texture2D(tDepth, coords));\n    #endif\n}\n\nfloat calcDepth(const in vec3 pos) {\n    vec2 clipZW = pos.z * uProjection[2].zw + uProjection[3].zw;\n    return 0.5 + 0.5 * clipZW.x / clipZW.y;\n}\n\n// "Bump Mapping Unparametrized Surfaces on the GPU" Morten S. Mikkelsen\n// https://mmikk.github.io/papers3d/mm_sfgrad_bump.pdf\nvec3 perturbNormal(in vec3 position, in vec3 normal, in float height, in float scale) {\n    vec3 sigmaS = dFdx(position);\n    vec3 sigmaT = dFdy(position);\n\n    vec3 r1 = cross(sigmaT, normal);\n    vec3 r2 = cross(normal, sigmaS);\n    float det = dot(sigmaS, r1);\n    if (det == 0.0) return normal;\n\n    float bs = dFdx(height);\n    float bt = dFdy(height);\n\n    vec3 surfGrad = sign(det) * (bs * r1 + bt * r2);\n    return normalize(abs(det) * normal - scale * surfGrad);\n}\n\nfloat hash(in float h) {\n    return fract(sin(h) * 43758.5453123);\n}\n\nfloat noise(in vec3 x) {\n    vec3 p = floor(x);\n    vec3 f = fract(x);\n    f = f * f * (3.0 - 2.0 * f);\n\n    float n = p.x + p.y * 157.0 + 113.0 * p.z;\n    return mix(\n        mix(mix(hash(n + 0.0), hash(n + 1.0), f.x),\n            mix(hash(n + 157.0), hash(n + 158.0), f.x), f.y),\n        mix(mix(hash(n + 113.0), hash(n + 114.0), f.x),\n            mix(hash(n + 270.0), hash(n + 271.0), f.x), f.y), f.z);\n}\n\nfloat fbm(in vec3 p) {\n    float f = 0.0;\n    f += 0.5 * noise(p);\n    p *= 2.01;\n    f += 0.25 * noise(p);\n    p *= 2.02;\n    f += 0.125 * noise(p);\n\n    return f;\n}\n\n#ifdef dXrayShaded\n    float calcXrayShadedAlpha(in float alpha, const in vec3 normal) {\n        #if defined(dXrayShaded_on)\n            alpha *= 1.0 - pow(abs(dot(normal, vec3(0.0, 0.0, 1.0))), uXrayEdgeFalloff);\n        #elif defined(dXrayShaded_inverted)\n            alpha *= pow(abs(dot(normal, vec3(0.0, 0.0, 1.0))), uXrayEdgeFalloff);\n        #endif\n        return clamp(alpha, 0.001, 0.999);\n    }\n#endif\n',common_vert_params:"\nuniform mat4 uProjection, uModel, uView;\nuniform vec3 uCameraPosition;\nuniform vec4 uCameraPlane;\n\nuniform int uObjectId;\nuniform int uVertexCount;\nuniform int uInstanceCount;\nuniform int uGroupCount;\nuniform vec4 uInvariantBoundingSphere;\nuniform vec4 uLod;\n\nuniform bool uDoubleSided;\nuniform int uPickType;\n\n#if dClipObjectCount != 0\n    uniform int uClipObjectType[dClipObjectCount];\n    uniform bool uClipObjectInvert[dClipObjectCount];\n    uniform vec3 uClipObjectPosition[dClipObjectCount];\n    uniform vec4 uClipObjectRotation[dClipObjectCount];\n    uniform vec3 uClipObjectScale[dClipObjectCount];\n    uniform mat4 uClipObjectTransform[dClipObjectCount];\n\n    #if defined(dClipping)\n        uniform vec2 uClippingTexDim;\n        uniform sampler2D tClipping;\n        #if __VERSION__ == 100 || defined(dClippingType_instance) || !defined(dVaryingGroup)\n            varying float vClipping;\n        #else\n            flat out float vClipping;\n        #endif\n    #endif\n#endif\n\n#if defined(dNeedsMarker)\n    uniform float uMarker;\n    uniform vec2 uMarkerTexDim;\n    uniform sampler2D tMarker;\n    #if __VERSION__ == 100 || defined(dMarkerType_instance) || !defined(dVaryingGroup)\n        varying float vMarker;\n    #else\n        flat out float vMarker;\n    #endif\n#endif\n\nvarying vec3 vModelPosition;\nvarying vec3 vViewPosition;\n\nuniform float uModelScale;\n\n#if defined(noNonInstancedActiveAttribs)\n    // int() is needed for some Safari versions\n    // see https://bugs.webkit.org/show_bug.cgi?id=244152\n    #define VertexID int(gl_VertexID)\n#else\n    attribute float aVertex;\n    #define VertexID int(aVertex)\n#endif\n\n#if defined(enabledMultiDraw)\n    #define DrawID gl_DrawID\n#else\n    #define DrawID uDrawId\n#endif\n",common:"\n// TODO find a better place for these convenience defines\n\n#if defined(dRenderVariant_colorBlended) || defined(dRenderVariant_colorWboit) || defined(dRenderVariant_colorDpoit)\n    #define dRenderVariant_color\n#endif\n\n#if defined(dColorType_instance) || defined(dColorType_group) || defined(dColorType_groupInstance) || defined(dColorType_vertex) || defined(dColorType_vertexInstance)\n    #define dColorType_texture\n#endif\n\n#if defined(dColorType_volume) || defined(dColorType_volumeInstance)\n    #define dColorType_grid\n#endif\n\n#if defined(dColorType_attribute) || defined(dColorType_texture) || defined(dColorType_grid)\n    #define dColorType_varying\n#endif\n\n#if ((defined(dRenderVariant_color) || defined(dRenderVariant_tracing)) && defined(dColorMarker)) || defined(dRenderVariant_marking)\n    #define dNeedsMarker\n#endif\n\n#if defined(dXrayShaded_on) || defined(dXrayShaded_inverted)\n    #define dXrayShaded\n#endif\n\n#if defined(dRenderVariant_color) || defined(dRenderVariant_tracing) || ((defined(dRenderVariant_depth) || defined(dRenderVariant_pick)) && defined(dXrayShaded))\n    #define dNeedsNormal\n#endif\n\n#define MaskAll 0\n#define MaskOpaque 1\n#define MaskTransparent 2\n\n//\n\n#define PI 3.14159265\n#define RECIPROCAL_PI 0.31830988618\n#define EPSILON 1e-6\n#define ONE_MINUS_EPSILON 1.0 - EPSILON\n#define TWO_PI 6.2831853\n#define HALF_PI 1.570796325\n\n#define PALETTE_SCALE 16777214.0 // (1 << 24) - 2\n\n#define saturate(a) clamp(a, 0.0, 1.0)\n\n#if __VERSION__ == 100\n    #define round(x) floor((x) + 0.5)\n#endif\n\nfloat intDiv(const in float a, const in float b) { return float(int(a) / int(b)); }\nvec2 ivec2Div(const in vec2 a, const in vec2 b) { return vec2(ivec2(a) / ivec2(b)); }\nfloat intMod(const in float a, const in float b) { return a - b * float(int(a) / int(b)); }\nint imod(const in int a, const in int b) { return a - b * (a / b); }\n\nfloat pow2(const in float x) { return x * x; }\n\nvec3 packIntToRGB(in float value) {\n    value = clamp(round(value), 0.0, 16777216.0 - 1.0) + 1.0;\n    vec3 c = vec3(0.0);\n    c.b = mod(value, 256.0);\n    value = floor(value / 256.0);\n    c.g = mod(value, 256.0);\n    value = floor(value / 256.0);\n    c.r = mod(value, 256.0);\n    return c / 255.0;\n}\nfloat unpackRGBToInt(const in vec3 rgb) {\n    return (floor(rgb.r * 255.0 + 0.5) * 256.0 * 256.0 + floor(rgb.g * 255.0 + 0.5) * 256.0 + floor(rgb.b * 255.0 + 0.5)) - 1.0;\n}\n\nvec2 packUnitIntervalToRG(const in float v) {\n    vec2 enc;\n    enc.xy = vec2(fract(v * 256.0), v);\n    enc.y -= enc.x * (1.0 / 256.0);\n    enc.xy *=  256.0 / 255.0;\n\n    return enc;\n}\n\nfloat unpackRGToUnitInterval(const in vec2 enc) {\n    return dot(enc, vec2(255.0 / (256.0 * 256.0), 255.0 / 256.0));\n}\n\nfloat pack2x4(vec2 v) {\n    vec2 clamped_v = clamp(v, 0.0, 1.0);\n    vec2 scaled_v = floor(clamped_v * 15.0 + 0.5); // round to 015\n    float c = scaled_v.x + scaled_v.y * 16.0;\n    return c / 255.0;\n}\n\nvec2 unpack2x4(float f) {\n    float c = floor(f * 255.0 + 0.5);\n    float lo = mod(c, 16.0);\n    float hi = floor(c / 16.0);\n    return vec2(lo, hi) / 15.0;\n}\n\nvec3 screenSpaceToViewSpace(const in vec3 ssPos, const in mat4 invProjection) {\n    vec4 p = vec4(ssPos * 2.0 - 1.0, 1.0);\n    p = invProjection * p;\n    return p.xyz / p.w;\n}\n\nconst float PackUpscale = 256.0 / 255.0; // fraction -> 0..1 (including 1)\nconst float UnpackDownscale = 255.0 / 256.0; // 0..1 -> fraction (excluding 1)\nconst vec3 PackFactors = vec3(256.0 * 256.0 * 256.0, 256.0 * 256.0,  256.0);\nconst vec4 UnpackFactors = UnpackDownscale / vec4(PackFactors, 1.0);\nconst float ShiftRight8 = 1.0 / 256.0;\n\nvec4 packDepthToRGBA(const in float v) {\n    vec4 r = vec4(fract(v * PackFactors), v);\n    r.yzw -= r.xyz * ShiftRight8; // tidy overflow\n    return r * PackUpscale;\n}\nfloat unpackRGBAToDepth(const in vec4 v) {\n    return dot(v, UnpackFactors);\n}\n\nvec4 packDepthWithAlphaToRGBA(const in float depth, const in float alpha){\n    vec3 r = vec3(fract(depth * PackFactors.yz), depth);\n    r.yz -= r.xy * ShiftRight8; // tidy overflow\n    return vec4(r * PackUpscale, alpha);\n}\nvec2 unpackRGBAToDepthWithAlpha(const in vec4 v) {\n    return vec2(dot(v.xyz, UnpackFactors.yzw), v.w);\n}\n\nvec4 sRGBToLinear(const in vec4 c) {\n    return vec4(mix(pow(c.rgb * 0.9478672986 + vec3(0.0521327014), vec3(2.4)), c.rgb * 0.0773993808, vec3(lessThanEqual(c.rgb, vec3(0.04045)))), c.a);\n}\nvec4 linearTosRGB(const in vec4 c) {\n    return vec4(mix(pow(c.rgb, vec3(0.41666)) * 1.055 - vec3(0.055), c.rgb * 12.92, vec3(lessThanEqual(c.rgb, vec3(0.0031308)))), c.a);\n}\n\nfloat luminance(vec3 c) {\n    // https://www.w3.org/TR/WCAG21/#dfn-relative-luminance\n    const vec3 W = vec3(0.2125, 0.7154, 0.0721);\n    return dot(c, W);\n}\n\nfloat linearizeDepth(const in float depth, const in float near, const in float far) {\n    return (2.0 * near) / (far + near - depth * (far - near));\n}\n\nfloat perspectiveDepthToViewZ(const in float invClipZ, const in float near, const in float far) {\n    return (near * far) / ((far - near) * invClipZ - far);\n}\n\nfloat orthographicDepthToViewZ(const in float linearClipZ, const in float near, const in float far) {\n    return linearClipZ * (near - far) - near;\n}\n\nfloat depthToViewZ(const in float isOrtho, const in float linearClipZ, const in float near, const in float far) {\n    return isOrtho == 1.0 ? orthographicDepthToViewZ(linearClipZ, near, far) : perspectiveDepthToViewZ(linearClipZ, near, far);\n}\n\n// see https://github.com/graphitemaster/normals_revisited and https://www.shadertoy.com/view/3s33zj\nmat3 adjoint(const in mat4 m) {\n    return mat3(\n        cross(m[1].xyz, m[2].xyz),\n        cross(m[2].xyz, m[0].xyz),\n        cross(m[0].xyz, m[1].xyz)\n    );\n}\n\n#if __VERSION__ == 100\n    // transpose\n\n    float transpose(const in float m) {\n        return m;\n    }\n\n    mat2 transpose2(const in mat2 m) {\n        return mat2(\n            m[0][0], m[1][0],\n            m[0][1], m[1][1]\n        );\n    }\n\n    mat3 transpose3(const in mat3 m) {\n        return mat3(\n            m[0][0], m[1][0], m[2][0],\n            m[0][1], m[1][1], m[2][1],\n            m[0][2], m[1][2], m[2][2]\n        );\n    }\n\n    mat4 transpose4(const in mat4 m) {\n        return mat4(\n            m[0][0], m[1][0], m[2][0], m[3][0],\n            m[0][1], m[1][1], m[2][1], m[3][1],\n            m[0][2], m[1][2], m[2][2], m[3][2],\n            m[0][3], m[1][3], m[2][3], m[3][3]\n        );\n    }\n\n    // inverse\n\n    float inverse(const in float m) {\n        return 1.0 / m;\n    }\n\n    mat2 inverse2(const in mat2 m) {\n        return mat2(m[1][1],-m[0][1],\n                -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);\n    }\n\n    mat3 inverse3(const in mat3 m) {\n        float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n        float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n        float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n        float b01 = a22 * a11 - a12 * a21;\n        float b11 = -a22 * a10 + a12 * a20;\n        float b21 = a21 * a10 - a11 * a20;\n\n        float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n        return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n                    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n                    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n    }\n\n    mat4 inverse4(const in mat4 m) {\n        float\n            a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n            a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n            a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n            a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n            b00 = a00 * a11 - a01 * a10,\n            b01 = a00 * a12 - a02 * a10,\n            b02 = a00 * a13 - a03 * a10,\n            b03 = a01 * a12 - a02 * a11,\n            b04 = a01 * a13 - a03 * a11,\n            b05 = a02 * a13 - a03 * a12,\n            b06 = a20 * a31 - a21 * a30,\n            b07 = a20 * a32 - a22 * a30,\n            b08 = a20 * a33 - a23 * a30,\n            b09 = a21 * a32 - a22 * a31,\n            b10 = a21 * a33 - a23 * a31,\n            b11 = a22 * a33 - a23 * a32,\n\n            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n        return mat4(\n            a11 * b11 - a12 * b10 + a13 * b09,\n            a02 * b10 - a01 * b11 - a03 * b09,\n            a31 * b05 - a32 * b04 + a33 * b03,\n            a22 * b04 - a21 * b05 - a23 * b03,\n            a12 * b08 - a10 * b11 - a13 * b07,\n            a00 * b11 - a02 * b08 + a03 * b07,\n            a32 * b02 - a30 * b05 - a33 * b01,\n            a20 * b05 - a22 * b02 + a23 * b01,\n            a10 * b10 - a11 * b08 + a13 * b06,\n            a01 * b08 - a00 * b10 - a03 * b06,\n            a30 * b04 - a31 * b02 + a33 * b00,\n            a21 * b02 - a20 * b04 - a23 * b00,\n            a11 * b07 - a10 * b09 - a12 * b06,\n            a00 * b09 - a01 * b07 + a02 * b06,\n            a31 * b01 - a30 * b03 - a32 * b00,\n            a20 * b03 - a21 * b01 + a22 * b00) / det;\n    }\n\n    #define isNaN(x) ((x) != (x))\n    #define isInf(x) ((x) == (x) + 1.0)\n#else\n    #define transpose2(m) transpose(m)\n    #define transpose3(m) transpose(m)\n    #define transpose4(m) transpose(m)\n\n    #define inverse2(m) inverse(m)\n    #define inverse3(m) inverse(m)\n    #define inverse4(m) inverse(m)\n\n    #define isNaN isnan\n    #define isInf isinf\n#endif\n",fade_lod:"\nif (uLod.w == 0.0 && (uLod.x != 0.0 || uLod.y != 0.0)) {\n    float d = (dot(uCameraPlane.xyz, vModelPosition) + uCameraPlane.w) / uModelScale;\n    float ta = min(\n        smoothstep(uLod.x, uLod.x + uLod.z, d),\n        1.0 - smoothstep(uLod.y - uLod.z, uLod.y, d)\n    );\n\n    #if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)\n        float at = 0.0;\n\n        // shift by view-offset during multi-sample rendering to allow for blending\n        vec2 coord = gl_FragCoord.xy + uViewOffset * 0.25;\n\n        const mat4 thresholdMatrix = mat4(\n            1.0 / 17.0,  9.0 / 17.0,  3.0 / 17.0, 11.0 / 17.0,\n            13.0 / 17.0,  5.0 / 17.0, 15.0 / 17.0,  7.0 / 17.0,\n            4.0 / 17.0, 12.0 / 17.0,  2.0 / 17.0, 10.0 / 17.0,\n            16.0 / 17.0,  8.0 / 17.0, 14.0 / 17.0,  6.0 / 17.0\n        );\n        int ci = int(intMod(coord.x, 4.0));\n        int ri = int(intMod(coord.y, 4.0));\n        #if __VERSION__ == 100\n            vec4 i = vec4(float(ci * 4 + ri));\n            vec4 v = thresholdMatrix[0] * vec4(equal(i, vec4(0.0, 1.0, 2.0, 3.0))) +\n                thresholdMatrix[1] * vec4(equal(i, vec4(4.0, 5.0, 6.0, 7.0))) +\n                thresholdMatrix[2] * vec4(equal(i, vec4(8.0, 9.0, 10.0, 11.0))) +\n                thresholdMatrix[3] * vec4(equal(i, vec4(12.0, 13.0, 14.0, 15.0)));\n            at = v.x + v.y + v.z + v.w;\n        #else\n            at = thresholdMatrix[ci][ri];\n        #endif\n\n        if (ta < 0.99 && (ta < 0.01 || ta < at)) {\n            discard;\n        }\n    #else\n        if (ta < uPickingAlphaThreshold) {\n            discard;\n        }\n    #endif\n}\n",float_to_rgba:"\n    // floatToRgba adapted from https://github.com/equinor/glsl-float-to-rgba\n    // MIT License, Copyright (c) 2020 Equinor\n\n    float shiftRight (float v, float amt) {\n    v = floor(v) + 0.5;\n    return floor(v / exp2(amt));\n    }\n    float shiftLeft (float v, float amt) {\n        return floor(v * exp2(amt) + 0.5);\n    }\n    float maskLast (float v, float bits) {\n        return mod(v, shiftLeft(1.0, bits));\n    }\n    float extractBits (float num, float from, float to) {\n        from = floor(from + 0.5); to = floor(to + 0.5);\n        return maskLast(shiftRight(num, from), to - from);\n    }\n\n    vec4 floatToRgba(float texelFloat, bool littleEndian) {\n        if (texelFloat == 0.0) return vec4(0.0, 0.0, 0.0, 0.0);\n        float sign = texelFloat > 0.0 ? 0.0 : 1.0;\n        texelFloat = abs(texelFloat);\n        float exponent = floor(log2(texelFloat));\n        float biased_exponent = exponent + 127.0;\n        float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;\n        float t = biased_exponent / 2.0;\n        float last_bit_of_biased_exponent = fract(t) * 2.0;\n        float remaining_bits_of_biased_exponent = floor(t);\n        float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;\n        float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;\n        float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;\n        float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\n        return (\n            littleEndian\n                ? vec4(byte4, byte3, byte2, byte1)\n                : vec4(byte1, byte2, byte3, byte4)\n        );\n    }\n",light_frag_params:"\n#if dLightCount != 0\n    uniform vec3 uLightDirection[dLightCount];\n    uniform vec3 uLightColor[dLightCount];\n#endif\nuniform vec3 uAmbientColor;\n\nstruct PhysicalMaterial {\n    vec3 diffuseColor;\n    float roughness;\n    vec3 specularColor;\n    float specularF90;\n};\n\nstruct IncidentLight {\n    vec3 color;\n    vec3 direction;\n};\n\nstruct ReflectedLight {\n    vec3 directDiffuse;\n    vec3 directSpecular;\n    vec3 indirectDiffuse;\n    vec3 indirectSpecular;\n};\n\nstruct GeometricContext {\n    vec3 position;\n    vec3 normal;\n    vec3 viewDir;\n};\n\nvec3 BRDF_Lambert(const in vec3 diffuseColor) {\n    return RECIPROCAL_PI * diffuseColor;\n}\n\nvec3 F_Schlick(const in vec3 f0, const in float f90, const in float dotVH) {\n    // Original approximation by Christophe Schlick '94\n    // float fresnel = pow( 1.0 - dotVH, 5.0 );\n    // Optimized variant (presented by Epic at SIGGRAPH '13)\n    // https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf\n    float fresnel = exp2((-5.55473 * dotVH - 6.98316) * dotVH);\n    return f0 * (1.0 - fresnel) + (f90 * fresnel);\n}\n\n// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2\n// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat V_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {\n    float a2 = pow2(alpha);\n    float gv = dotNL * sqrt(a2 + (1.0 - a2) * pow2(dotNV));\n    float gl = dotNV * sqrt(a2 + (1.0 - a2) * pow2(dotNL));\n    return 0.5 / max(gv + gl, EPSILON);\n}\n\n// Microfacet Models for Refraction through Rough Surfaces - equation (33)\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\n// alpha is \"roughness squared\" in Disneys reparameterization\nfloat D_GGX(const in float alpha, const in float dotNH) {\n    float a2 = pow2(alpha);\n    float denom = pow2(dotNH) * (a2 - 1.0) + 1.0; // avoid alpha = 0 with dotNH = 1\n    return RECIPROCAL_PI * a2 / pow2(denom);\n}\n\n// GGX Distribution, Schlick Fresnel, GGX_SmithCorrelated Visibility\nvec3 BRDF_GGX(const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness) {\n    float alpha = pow2(roughness); // UE4's roughness\n    vec3 halfDir = normalize( lightDir + viewDir);\n    float dotNL = saturate(dot(normal, lightDir));\n    float dotNV = saturate(dot(normal, viewDir));\n    float dotNH = saturate(dot(normal, halfDir));\n    float dotVH = saturate(dot(viewDir, halfDir));\n    vec3 F = F_Schlick(f0, f90, dotVH);\n    float V = V_GGX_SmithCorrelated(alpha, dotNL, dotNV);\n    float D = D_GGX(alpha, dotNH);\n    return F * (V * D);\n}\n\n// Analytical approximation of the DFG LUT, one half of the\n// split-sum approximation used in indirect specular lighting.\n// via 'environmentBRDF' from \"Physically Based Shading on Mobile\"\n// https://www.unrealengine.com/blog/physically-based-shading-on-mobile\nvec2 DFGApprox(const in vec3 normal, const in vec3 viewDir, const in float roughness) {\n    float dotNV = saturate(dot(normal, viewDir));\n    const vec4 c0 = vec4(-1, -0.0275, -0.572, 0.022);\n    const vec4 c1 = vec4(1, 0.0425, 1.04, -0.04);\n    vec4 r = roughness * c0 + c1;\n    float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;\n    vec2 fab = vec2(-1.04, 1.04) * a004 + r.zw;\n    return fab;\n}\n\n// Fdez-Agera's \"Multiple-Scattering Microfacet Model for Real-Time Image Based Lighting\"\n// Approximates multiscattering in order to preserve energy.\n// http://www.jcgt.org/published/0008/01/03/\nvoid computeMultiscattering(const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter) {\n    vec2 fab = DFGApprox(normal, viewDir, roughness);\n    vec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n    float Ess = fab.x + fab.y;\n    float Ems = 1.0 - Ess;\n    vec3 Favg = specularColor + (1.0 - specularColor) * 0.047619; // 1/21\n    vec3 Fms = FssEss * Favg / (1.0 - Ems * Favg);\n    singleScatter += FssEss;\n    multiScatter += Fms * Ems;\n}\n\nvoid RE_Direct_Physical(const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n    float dotNL = saturate(dot(geometry.normal, directLight.direction));\n    vec3 irradiance = dotNL * directLight.color;\n    reflectedLight.directSpecular += irradiance * BRDF_GGX(directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness);\n    reflectedLight.directDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);\n}\n\nvoid RE_IndirectDiffuse_Physical(const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n    reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);\n}\n\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n    // Both indirect specular and indirect diffuse light accumulate here\n    vec3 singleScattering = vec3(0.0);\n    vec3 multiScattering = vec3(0.0);\n    vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n    computeMultiscattering(geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering);\n    vec3 diffuse = material.diffuseColor * (1.0 - ( singleScattering + multiScattering));\n    reflectedLight.indirectSpecular += radiance * singleScattering;\n    reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n    reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n",normal_frag_params:"\nvarying vec3 vNormal;\n",read_from_texture:"\nvec4 readFromTexture(const in sampler2D tex, const in float i, const in vec2 dim) {\n    float x = intMod(i, dim.x);\n    float y = floor(intDiv(i, dim.x));\n    vec2 uv = (vec2(x, y) + 0.5) / dim;\n    return texture2D(tex, uv);\n}\n\nvec4 readFromTexture(const in sampler2D tex, const in int i, const in vec2 dim) {\n    int x = imod(i, int(dim.x));\n    int y = i / int(dim.x);\n    vec2 uv = (vec2(x, y) + 0.5) / dim;\n    return texture2D(tex, uv);\n}\n",rgba_to_float:'\n    // rgbaToFloat adapted from https://github.com/ihmeuw/glsl-rgba-to-float\n    // BSD 3-Clause License\n    //\n    // Copyright (c) 2019, Institute for Health Metrics and Evaluation All rights reserved.\n    // Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:\n    //  - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.\n    //  - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.\n    //  - Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.\n    //\n    // THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n    // INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\n    // IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,\n    // OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,\n    // OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n    // OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED\n    // OF THE POSSIBILITY OF SUCH DAMAGE.\n\n    ivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n        ivec4 bytes = ivec4(inputFloats * 255.0);\n        return (\n            littleEndian\n                ? bytes.abgr\n                : bytes\n        );\n    }\n\n    // Break the four bytes down into an array of 32 bits.\n    void bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n        for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n            float acc = float(bytes[channelIndex]);\n            for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n                float powerOfTwo = exp2(float(indexInByte));\n                bool bit = acc >= powerOfTwo;\n                bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n                acc = mod(acc, powerOfTwo);\n            }\n        }\n    }\n\n    // Compute the exponent of the 32-bit float.\n    float getExponent(bool bits[32]) {\n        const int startIndex = 1;\n        const int bitStringLength = 8;\n        const int endBeforeIndex = startIndex + bitStringLength;\n        float acc = 0.0;\n        int pow2 = bitStringLength - 1;\n        for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n            acc += float(bits[bitIndex]) * exp2(float(pow2--));\n        }\n        return acc;\n    }\n\n    // Compute the mantissa of the 32-bit float.\n    float getMantissa(bool bits[32], bool subnormal) {\n        const int startIndex = 9;\n        const int bitStringLength = 23;\n        const int endBeforeIndex = startIndex + bitStringLength;\n        // Leading/implicit/hidden bit convention:\n        // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n        float acc = float(!subnormal) * exp2(float(bitStringLength));\n        int pow2 = bitStringLength - 1;\n        for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n            acc += float(bits[bitIndex]) * exp2(float(pow2--));\n        }\n        return acc;\n    }\n\n    // Parse the float from its 32 bits.\n    float bitsToFloat(bool bits[32]) {\n        float signBit = float(bits[0]) * -2.0 + 1.0;\n        float exponent = getExponent(bits);\n        bool subnormal = abs(exponent - 0.0) < 0.01;\n        float mantissa = getMantissa(bits, subnormal);\n        float exponentBias = 127.0;\n        return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n    }\n\n    float rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n        ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n        bool bits[32];\n        bytesToBits(rgbaBytes, bits);\n        return bitsToFloat(bits);\n    }\n',size_vert_params:"\n#if defined(dSizeType_uniform)\n    uniform float uSize;\n#elif defined(dSizeType_attribute)\n    attribute float aSize;\n#elif defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)\n    uniform vec2 uSizeTexDim;\n    uniform sampler2D tSize;\n#endif\n\nuniform float uSizeFactor;\n",texture3d_from_1d_trilinear:"\nvec4 texture3dFrom1dTrilinear(const in sampler2D tex, const in vec3 pos, const in vec3 gridDim, const in vec2 texDim, const in float offset) {\n    float gdYZ = gridDim.z * gridDim.y;\n    float gdZ = gridDim.z;\n    vec3 p0 = floor(pos * gridDim);\n    vec3 p1 = ceil(pos * gridDim);\n    vec3 pd = (pos * gridDim - p0) / (p1 - p0);\n    vec4 s000 = readFromTexture(tex, offset + p0.z + p0.y * gdZ + p0.x * gdYZ, texDim);\n    vec4 s100 = readFromTexture(tex, offset + p0.z + p0.y * gdZ + p1.x * gdYZ, texDim);\n    vec4 s001 = readFromTexture(tex, offset + p1.z + p0.y * gdZ + p0.x * gdYZ, texDim);\n    vec4 s101 = readFromTexture(tex, offset + p1.z + p0.y * gdZ + p1.x * gdYZ, texDim);\n    vec4 s010 = readFromTexture(tex, offset + p0.z + p1.y * gdZ + p0.x * gdYZ, texDim);\n    vec4 s110 = readFromTexture(tex, offset + p0.z + p1.y * gdZ + p1.x * gdYZ, texDim);\n    vec4 s011 = readFromTexture(tex, offset + p1.z + p1.y * gdZ + p0.x * gdYZ, texDim);\n    vec4 s111 = readFromTexture(tex, offset + p1.z + p1.y * gdZ + p1.x * gdYZ, texDim);\n    vec4 s00 = mix(s000, s100, pd.x);\n    vec4 s01 = mix(s001, s101, pd.x);\n    vec4 s10 = mix(s010, s110, pd.x);\n    vec4 s11 = mix(s011, s111, pd.x);\n    vec4 s0 = mix(s00, s10, pd.y);\n    vec4 s1 = mix(s01, s11, pd.y);\n    return mix(s0, s1, pd.z);\n}\n",texture3d_from_2d_linear:"\nvec4 texture3dFrom2dLinear(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {\n    float zSlice0 = floor(pos.z * gridDim.z);\n    float column0 = intMod(zSlice0 * gridDim.x, texDim.x) / gridDim.x;\n    float row0 = floor(intDiv(zSlice0 * gridDim.x, texDim.x));\n    vec2 coord0 = (vec2(column0 * gridDim.x, row0 * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;\n    vec4 color0 = texture2D(tex, coord0);\n\n    float zSlice1 = zSlice0 + 1.0;\n    float column1 = intMod(zSlice1 * gridDim.x, texDim.x) / gridDim.x;\n    float row1 = floor(intDiv(zSlice1 * gridDim.x, texDim.x));\n    vec2 coord1 = (vec2(column1 * gridDim.x, row1 * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;\n    vec4 color1 = texture2D(tex, coord1);\n\n    float delta0 = abs((pos.z * gridDim.z) - zSlice0);\n    return mix(color0, color1, delta0);\n}\n",texture3d_from_2d_nearest:"\nvec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {\n    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice\n    float column = intMod(zSlice * gridDim.x, texDim.x) / gridDim.x;\n    float row = floor(intDiv(zSlice * gridDim.x, texDim.x));\n    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;\n    return texture2D(tex, coord);\n}\n",wboit_write:"\n#if defined(dRenderVariant_colorWboit)\n    if (uRenderMask == MaskOpaque) {\n        if (preFogAlpha < 1.0) {\n            discard;\n        }\n    } else if (uRenderMask == MaskTransparent) {\n        if (preFogAlpha != 1.0 && fragmentDepth < getDepth(gl_FragCoord.xy / uDrawingBufferSize)) {\n            #ifdef dTransparentBackfaces_off\n                if (interior) discard;\n            #endif\n            float alpha = gl_FragColor.a;\n            float wboitWeight = alpha * clamp(pow(1.0 - fragmentDepth, 2.0), 0.01, 1.0);\n            gl_FragColor = vec4(gl_FragColor.rgb * alpha * wboitWeight, alpha);\n            // extra alpha is to handle pre-multiplied alpha\n            #ifndef dGeometryType_directVolume\n                gl_FragData[1] = vec4((uTransparentBackground ? alpha : 1.0) * alpha * wboitWeight);\n            #else\n                gl_FragData[1] = vec4(alpha * alpha * wboitWeight);\n            #endif\n        } else {\n            discard;\n        }\n    }\n#endif\n",dpoit_write:"\n#if defined(dRenderVariant_colorDpoit)\n    if (uRenderMask == MaskOpaque) {\n        if (preFogAlpha < 1.0) {\n            discard;\n        }\n    } else if (uRenderMask == MaskTransparent) {\n        vec2 coords = gl_FragCoord.xy / uDrawingBufferSize;\n        if (preFogAlpha != 1.0 && fragmentDepth < getDepth(coords)) {\n            #ifdef dTransparentBackfaces_off\n                if (interior) discard;\n            #endif\n\n            // adapted from https://github.com/tsherif/webgl2examples\n            // The MIT License, Copyright 2017 Tarek Sherif, Shuai Shao\n\n            vec2 lastDepth = texture2D(tDpoitDepth, coords).rg;\n            vec4 lastFrontColor = texture2D(tDpoitFrontColor, coords);\n\n            vec4 fragColor = gl_FragColor;\n\n            // depth value always increases\n            // so we can use MAX blend equation\n            gl_FragData[2].rg = vec2(-MAX_DPOIT_DEPTH);\n\n            // front color always increases\n            // so we can use MAX blend equation\n            gl_FragColor = lastFrontColor;\n\n            // back color is separately blend afterwards each pass\n            gl_FragData[1] = vec4(0.0);\n\n            float nearestDepth = -lastDepth.x;\n            float furthestDepth = lastDepth.y;\n            float alphaMultiplier = 1.0 - lastFrontColor.a;\n\n            if (fragmentDepth < nearestDepth || fragmentDepth > furthestDepth) {\n                // Skip this depth since it's been peeled.\n                return;\n            }\n\n            if (fragmentDepth > nearestDepth && fragmentDepth < furthestDepth) {\n                // This needs to be peeled.\n                // The ones remaining after MAX blended for\n                // all need-to-peel will be peeled next pass.\n                gl_FragData[2].rg = vec2(-fragmentDepth, fragmentDepth);\n                return;\n            }\n\n            // write to back and front color buffer\n            if (fragmentDepth == nearestDepth) {\n                gl_FragColor.rgb += fragColor.rgb * fragColor.a * alphaMultiplier;\n                gl_FragColor.a = 1.0 - alphaMultiplier * (1.0 - fragColor.a);\n            } else {\n                gl_FragData[1] += fragColor;\n            }\n\n        } else {\n            discard;\n        }\n    }\n#endif\n"},l=/^(?!\/\/)\s*#include\s+(\S+)/gm,c=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*\+\+i\s*\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g,u=/[ \t]*\/\/.*\n/g,d=/[ \t]*\/\*[\s\S]*?\*\//g,p=/\n{2,}/g
function h(e){return e.replace(l,(e,t)=>{const n=s[t]
if(!n)throw new Error(`empty chunk, '${t}'`)
return n}).trim().replace(u,"\n").replace(d,"\n").replace(p,"\n")}function f(e,t,n,r){let i=""
for(let o=parseInt(t);o<parseInt(n);++o)i+=r.replace(/\[\s*i\s*\]/g,`[${o}]`).replace(/UNROLLED_LOOP_INDEX/g,`${o}`)
return i}function m(e,t){return function(e){return e.replace(c,f)}(function(e,t){return t.dLightCount&&(e=e.replace(/dLightCount/g,`${t.dLightCount.ref.value}`)),t.dClipObjectCount&&(e=e.replace(/dClipObjectCount/g,`${t.dClipObjectCount.ref.value}`)),e}(e,t))}function g(e,t,n,r={},i={},o){return{id:a(),name:e,vert:h(t),frag:h(n),extensions:r,outTypes:i,ignoreDefine:o}}function y(e,t,n){var r
if(!t.startsWith("color")&&"tracing"!==t){const n=["dColorType","dUsePalette","dOverpaintType","dOverpaint","dSubstanceType","dSubstance","dColorMarker","dCelShaded","dLightCount"]
return"depth"===t||t.startsWith("pick")||n.push("dXrayShaded"),"emissive"!==t&&n.push("dEmissiveType","dEmissive"),n.includes(e)}return"dLightCount"===e&&!!(null===(r=n.dIgnoreLight)||void 0===r?void 0:r.ref.value)}function v(e,t,n){return"dLightCount"===e||y(e,t,n)}const b=g("points","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include read_from_texture\n#include common_vert_params\n#include color_vert_params\n#include size_vert_params\n#include common_clip\n\nuniform float uPixelRatio;\nuniform vec4 uViewport;\n\nattribute vec3 aPosition;\nattribute mat4 aTransform;\nattribute float aInstance;\nattribute float aGroup;\n\nvoid main(){\n    int vertexId = VertexID;\n\n    #include assign_group\n    #include assign_color_varying\n    #include assign_marker_varying\n    #include assign_clipping_varying\n    #include assign_position\n    #include assign_size\n\n    #ifdef dPointSizeAttenuation\n        gl_PointSize = size * uPixelRatio * ((uViewport.w / 2.0) / -mvPosition.z) * 5.0;\n    #else\n        gl_PointSize = size * uPixelRatio;\n    #endif\n    gl_PointSize = max(1.0, gl_PointSize);\n\n    gl_Position = uProjection * mvPosition;\n\n    #include clip_instance\n}\n","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include common_frag_params\n#include color_frag_params\n#include common_clip\n\nconst vec2 center = vec2(0.5);\nconst float radius = 0.5;\n\nvoid main(){\n    #include fade_lod\n    #include clip_pixel\n\n    float fragmentDepth = gl_FragCoord.z;\n    #include assign_material_color\n\n    #if defined(dPointStyle_circle)\n        float dist = distance(gl_PointCoord, center);\n        if (dist > radius) discard;\n    #elif defined(dPointStyle_fuzzy)\n        float dist = distance(gl_PointCoord, center);\n        float fuzzyAlpha = 1.0 - smoothstep(0.0, radius, dist);\n        if (fuzzyAlpha < 0.0001) discard;\n    #endif\n\n    #if defined(dPointStyle_fuzzy) && (defined(dRenderVariant_color) || defined(dRenderVariant_tracing))\n        material.a *= fuzzyAlpha;\n    #endif\n\n    #include check_transparency\n\n    #if defined(dRenderVariant_pick)\n        #include check_picking_alpha\n        #ifdef requiredDrawBuffers\n            gl_FragColor = vObject;\n            gl_FragData[1] = vInstance;\n            gl_FragData[2] = vGroup;\n            gl_FragData[3] = packDepthToRGBA(fragmentDepth);\n        #else\n            gl_FragColor = vColor;\n        #endif\n    #elif defined(dRenderVariant_depth)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_marking)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_emissive)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_color) || defined(dRenderVariant_tracing)\n        gl_FragColor = material;\n        #include apply_marker_color\n\n        #if defined(dRenderVariant_color)\n            #include apply_fog\n            #include wboit_write\n            #include dpoit_write\n        #elif defined(dRenderVariant_tracing)\n            gl_FragData[1] = vec4(normalize(vViewPosition), emissive);\n            gl_FragData[2] = vec4(material.rgb, uDensity);\n        #endif\n    #endif\n}\n",{drawBuffers:"optional"},{},v),x=g("spheres","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include read_from_texture\n#include common_vert_params\n#include color_vert_params\n#include size_vert_params\n#include common_clip\n\nuniform mat4 uModelView;\nuniform mat4 uInvProjection;\nuniform float uIsOrtho;\nuniform bool uIsAsymmetricProjection;\n\nuniform vec2 uTexDim;\nuniform sampler2D tPositionGroup;\n\nattribute mat4 aTransform;\nattribute float aInstance;\n\nvarying float vRadius;\nvarying vec3 vPoint;\nvarying vec3 vPointViewPosition;\n\n/**\n * Bounding rectangle of a clipped, perspective-projected 3D Sphere.\n * Michael Mara, Morgan McGuire. 2013\n *\n * Specialization by Arseny Kapoulkine, MIT License Copyright (c) 2018\n * https://github.com/zeux/niagara\n *\n * Only works for for symmetric projections.\n */\nvoid sphereProjection(const in vec3 p, const in float r, const in vec2 mapping) {\n    vec3 pr = p * r;\n    float pzr2 = p.z * p.z - r * r;\n\n    float vx = sqrt(p.x * p.x + pzr2);\n    float minx = ((vx * p.x - pr.z) / (vx * p.z + pr.x)) * uProjection[0][0];\n    float maxx = ((vx * p.x + pr.z) / (vx * p.z - pr.x)) * uProjection[0][0];\n\n    float vy = sqrt(p.y * p.y + pzr2);\n    float miny = ((vy * p.y - pr.z) / (vy * p.z + pr.y)) * uProjection[1][1];\n    float maxy = ((vy * p.y + pr.z) / (vy * p.z - pr.y)) * uProjection[1][1];\n\n    gl_Position.xy = vec2(maxx + minx, maxy + miny) * -0.5;\n    gl_Position.xy -= mapping * vec2(maxx - minx, maxy - miny) * 0.5;\n    gl_Position.xy *= gl_Position.w;\n}\n\nconst mat4 D = mat4(\n    1.0, 0.0, 0.0, 0.0,\n    0.0, 1.0, 0.0, 0.0,\n    0.0, 0.0, 1.0, 0.0,\n    0.0, 0.0, 0.0, -1.0\n);\n\n/**\n * Compute point size and center using the technique described in:\n * \"GPU-Based Ray-Casting of Quadratic Surfaces\" http://dl.acm.org/citation.cfm?id=2386396\n * by Christian Sigg, Tim Weyrich, Mario Botsch, Markus Gross.\n */\nvoid quadraticProjection(const in vec3 position, const in float radius, const in vec2 mapping) {\n    vec2 xbc, ybc;\n\n    mat4 T = mat4(\n        radius, 0.0, 0.0, 0.0,\n        0.0, radius, 0.0, 0.0,\n        0.0, 0.0, radius, 0.0,\n        position.x, position.y, position.z, 1.0\n    );\n\n    mat4 R = transpose4(uProjection * uModelView * aTransform * T);\n    float A = dot(R[3], D * R[3]);\n    float B = -2.0 * dot(R[0], D * R[3]);\n    float C = dot(R[0], D * R[0]);\n    xbc[0] = (-B - sqrt(B * B - 4.0 * A * C)) / (2.0 * A);\n    xbc[1] = (-B + sqrt(B * B - 4.0 * A * C)) / (2.0 * A);\n    float sx = abs(xbc[0] - xbc[1]) * 0.5;\n\n    A = dot(R[3], D * R[3]);\n    B = -2.0 * dot(R[1], D * R[3]);\n    C = dot(R[1], D * R[1]);\n    ybc[0] = (-B - sqrt(B * B - 4.0 * A * C)) / (2.0 * A);\n    ybc[1] = (-B + sqrt(B * B - 4.0 * A * C)) / (2.0 * A);\n    float sy = abs(ybc[0] - ybc[1]) * 0.5;\n\n    gl_Position.xy = vec2(0.5 * (xbc.x + xbc.y), 0.5 * (ybc.x + ybc.y));\n    gl_Position.xy -= mapping * vec2(sx, sy);\n    gl_Position.xy *= gl_Position.w;\n}\n\nvoid main(void){\n    vec2 mapping = vec2(1.0, 1.0); // vertices 2 and 5\n    #if __VERSION__ == 100\n        int m = imod(VertexID, 6);\n    #else\n        int m = VertexID % 6;\n    #endif\n    if (m == 0) {\n        mapping = vec2(-1.0, 1.0);\n    } else if (m == 1 || m == 3) {\n        mapping = vec2(-1.0, -1.0);\n    } else if (m == 4) {\n        mapping = vec2(1.0, -1.0);\n    }\n\n    int vertexId = VertexID / 6;\n\n    vec4 positionGroup = readFromTexture(tPositionGroup, vertexId, uTexDim);\n    vec3 position = positionGroup.rgb;\n    float group = positionGroup.a;\n\n    #include assign_color_varying\n    #include assign_marker_varying\n    #include assign_clipping_varying\n    #include assign_size\n\n    vRadius = size * uModelScale;\n\n    vec4 position4 = vec4(position, 1.0);\n    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader\n\n    float d;\n    if (uLod.w != 0.0 && (uLod.x != 0.0 || uLod.y != 0.0)) {\n        if (uModelScale != 1.0) {\n            vRadius *= uLod.w;\n        } else {\n            d = (dot(uCameraPlane.xyz, vModelPosition) + uCameraPlane.w) / uModelScale;\n            float f = min(\n                smoothstep(uLod.x, uLod.x + uLod.z, d),\n                1.0 - smoothstep(uLod.y - uLod.z, uLod.y, d)\n            ) * uLod.w;\n            vRadius *= f;\n        }\n    }\n\n    vec4 mvPosition = uModelView * aTransform * position4;\n\n    #ifdef dApproximate\n        vec4 mvCorner = vec4(mvPosition.xyz, 1.0);\n        mvCorner.xy += mapping * vRadius;\n        gl_Position = uProjection * mvCorner;\n    #else\n        if (uIsOrtho == 1.0) {\n            vec4 mvCorner = vec4(mvPosition.xyz, 1.0);\n            mvCorner.xy += mapping * vRadius;\n            gl_Position = uProjection * mvCorner;\n        } else if (uIsAsymmetricProjection) {\n            gl_Position = uProjection * vec4(mvPosition.xyz, 1.0);\n            quadraticProjection(position, vRadius / uModelScale, mapping);\n        } else {\n            gl_Position = uProjection * vec4(mvPosition.xyz, 1.0);\n            sphereProjection(mvPosition.xyz, vRadius, mapping);\n        }\n    #endif\n\n    vec4 vPoint4 = uInvProjection * gl_Position;\n    vPoint = vPoint4.xyz / vPoint4.w;\n    vPointViewPosition = -mvPosition.xyz / mvPosition.w;\n\n    if (gl_Position.z < -gl_Position.w) {\n        mvPosition.z -= 2.0 * vRadius; // avoid clipping\n        gl_Position.z = (uProjection * vec4(mvPosition.xyz, 1.0)).z;\n    }\n\n    if (uModelScale == 1.0) {\n        if (uLod.w != 0.0 && (uLod.x != 0.0 || uLod.y != 0.0)) {\n            if (d < uLod.x || d > uLod.y) {\n                // move out of [ -w, +w ] to 'discard' in vert shader\n                gl_Position.z = 2.0 * gl_Position.w;\n            }\n        }\n    }\n\n    #if defined(dClipPrimitive) && !defined(dClipVariant_instance) && dClipObjectCount != 0\n        if (clipTest(vModelPosition / uModelScale)) {\n            // move out of [ -w, +w ] to 'discard' in vert shader\n            gl_Position.z = 2.0 * gl_Position.w;\n        }\n    #else\n        #include clip_instance\n    #endif\n}\n","\nprecision highp float;\nprecision highp int;\n\n#define bumpEnabled\n\n#include common\n#include common_frag_params\n#include color_frag_params\n#include light_frag_params\n#include common_clip\n\nuniform mat4 uInvView;\nuniform float uAlphaThickness;\n\nuniform vec4 uInteriorColor;\nuniform vec4 uInteriorSubstance;\n\nvarying float vRadius;\nvarying vec3 vPoint;\nvarying vec3 vPointViewPosition;\n\n#ifdef dSolidInterior\n    const bool solidInterior = true;\n#else\n    const bool solidInterior = false;\n#endif\n\nbool SphereImpostor(out vec3 modelPos, out vec3 cameraPos, out vec3 cameraNormal, out bool interior, out float fragmentDepth){\n    vec3 cameraSpherePos = -vPointViewPosition;\n\n    vec3 rayOrigin = mix(vec3(0.0, 0.0, 0.0), vPoint, uIsOrtho);\n    vec3 rayDirection = mix(normalize(vPoint), vec3(0.0, 0.0, 1.0), uIsOrtho);\n    vec3 cameraSphereDir = mix(cameraSpherePos, rayOrigin - cameraSpherePos, uIsOrtho);\n\n    float B = dot(rayDirection, cameraSphereDir);\n    float det = B * B + vRadius * vRadius - dot(cameraSphereDir, cameraSphereDir);\n\n    if (det < 0.0) return false;\n\n    float sqrtDet = sqrt(det);\n    float posT = mix(B + sqrtDet, B - sqrtDet, uIsOrtho);\n    float negT = mix(B - sqrtDet, B + sqrtDet, uIsOrtho);\n\n    cameraPos = rayDirection * negT + rayOrigin;\n    modelPos = (uInvView * vec4(cameraPos, 1.0)).xyz;\n    fragmentDepth = calcDepth(cameraPos);\n\n    bool objectClipped = false;\n\n    #if !defined(dClipPrimitive) && defined(dClipVariant_pixel) && dClipObjectCount != 0\n        if (clipTest(modelPos)) {\n            objectClipped = true;\n            fragmentDepth = -1.0;\n        }\n    #endif\n\n    if (fragmentDepth > 0.0) {\n        cameraNormal = normalize(cameraPos - cameraSpherePos);\n        interior = false;\n        return true;\n    } else if (uDoubleSided || solidInterior) {\n        cameraPos = rayDirection * posT + rayOrigin;\n        modelPos = (uInvView * vec4(cameraPos, 1.0)).xyz;\n        fragmentDepth = calcDepth(cameraPos);\n        cameraNormal = -normalize(cameraPos - cameraSpherePos);\n        interior = true;\n        if (fragmentDepth > 0.0) {\n            #ifdef dSolidInterior\n                if (!objectClipped) {\n                    fragmentDepth = 0.0 + (0.0000001 / vRadius);\n                    cameraNormal = -mix(normalize(vPoint), vec3(0.0, 0.0, -1.0), uIsOrtho);\n\n                    // intersection of ray with near plane\n                    float nearT = - (uNear + dot(rayOrigin, vec3(0.0, 0.0, 1.0))) / dot(rayDirection, vec3(0.0, 0.0, 1.0));\n                    cameraPos = rayDirection * nearT + rayOrigin;\n                    modelPos = (uInvView * vec4(cameraPos, 1.0)).xyz;\n                }\n            #endif\n            return true;\n        }\n    }\n\n    return false;\n}\n\nvoid main(void){\n    vec3 cameraNormal;\n    float fragmentDepth;\n\n    #ifdef dApproximate\n        vec3 pointDir = -vPointViewPosition - vPoint;\n        if (dot(pointDir, pointDir) > vRadius * vRadius) discard;\n        vec3 vViewPosition = -vPointViewPosition;\n        fragmentDepth = gl_FragCoord.z;\n        #if !defined(dIgnoreLight) || defined(dXrayShaded) || defined(dRenderVariant_tracing)\n            pointDir.z -= cos(length(pointDir)) * vRadius * 0.5;\n            cameraNormal = -normalize(pointDir);\n        #endif\n        interior = false;\n    #else\n        vec3 modelPos;\n        vec3 cameraPos;\n        bool hit = SphereImpostor(modelPos, cameraPos, cameraNormal, interior, fragmentDepth);\n        if (!hit) discard;\n\n        if (fragmentDepth < 0.0) discard;\n        if (fragmentDepth > 1.0) discard;\n\n        gl_FragDepthEXT = fragmentDepth;\n\n        vec3 vModelPosition = modelPos;\n        vec3 vViewPosition = cameraPos;\n    #endif\n\n    #include fade_lod\n    #if !defined(dClipPrimitive) && defined(dClipVariant_pixel) && dClipObjectCount != 0\n        #include clip_pixel\n    #endif\n\n    #ifdef dNeedsNormal\n        vec3 normal = -cameraNormal;\n    #endif\n\n    #include assign_material_color\n\n    #if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)\n        if (uRenderMask == MaskTransparent && uAlphaThickness > 0.0) {\n            material.a *= min(1.0, vRadius / (uAlphaThickness * uModelScale));\n        }\n    #endif\n\n    #include check_transparency\n\n    #if defined(dRenderVariant_pick)\n        #include check_picking_alpha\n        #ifdef requiredDrawBuffers\n            gl_FragColor = vObject;\n            gl_FragData[1] = vInstance;\n            gl_FragData[2] = vGroup;\n            gl_FragData[3] = packDepthToRGBA(fragmentDepth);\n        #else\n            gl_FragColor = vColor;\n        #endif\n    #elif defined(dRenderVariant_depth)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_marking)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_emissive)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_color) || defined(dRenderVariant_tracing)\n        #include apply_interior_color\n        #include apply_light_color\n        #include apply_marker_color\n\n        #if defined(dRenderVariant_color)\n            #include apply_fog\n            #include wboit_write\n            #include dpoit_write\n        #elif defined(dRenderVariant_tracing)\n            gl_FragData[1] = vec4(normal, emissive);\n            gl_FragData[2] = vec4(material.rgb, uDensity);\n        #endif\n    #endif\n}\n",{fragDepth:"required",drawBuffers:"optional"},{},y),S=g("cylinders","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include read_from_texture\n#include common_vert_params\n#include color_vert_params\n#include size_vert_params\n#include common_clip\n\nuniform mat4 uModelView;\n\nattribute mat4 aTransform;\nattribute float aInstance;\nattribute float aGroup;\n\nattribute vec3 aMapping;\nattribute vec3 aStart;\nattribute vec3 aEnd;\nattribute float aScale;\nattribute float aCap;\nattribute float aColorMode;\n\nvarying mat4 vTransform;\nvarying vec3 vStart;\nvarying vec3 vEnd;\nvarying float vSize;\nvarying float vCap;\n\nuniform float uIsOrtho;\nuniform vec3 uCameraDir;\n\nvoid main() {\n    int vertexId = VertexID;\n\n    #include assign_group\n    #include assign_color_varying\n    #include assign_marker_varying\n    #include assign_clipping_varying\n    #include assign_size\n\n    mat4 modelTransform = uModel * aTransform;\n\n    vTransform = modelTransform;\n    vStart = (modelTransform * vec4(aStart, 1.0)).xyz;\n    vEnd = (modelTransform * vec4(aEnd, 1.0)).xyz;\n    vSize = size * aScale * uModelScale;\n    vCap = aCap;\n\n    vModelPosition = (vStart + vEnd) * 0.5;\n    vec3 camDir = -mix(normalize(vModelPosition - uCameraPosition), uCameraDir, uIsOrtho);\n    vec3 dir = vEnd - vStart;\n    float f = aMapping.x > 0.0 ? 1.0 : 0.0;\n    // ensure cylinder 'dir' is pointing towards the camera\n    if(dot(camDir, dir) < 0.0) {\n        dir = -dir;\n        f = 1.0 - f;\n    }\n\n    vec3 left = cross(camDir, dir);\n    vec3 up = cross(left, dir);\n    left = vSize * normalize(left);\n    up = vSize * normalize(up);\n\n    // move vertex in object-space from center to corner\n    vModelPosition += aMapping.x * dir + aMapping.y * left + aMapping.z * up;\n\n    vec4 mvPosition = uView * vec4(vModelPosition, 1.0);\n    vViewPosition = mvPosition.xyz;\n    gl_Position = uProjection * mvPosition;\n\n    if (gl_Position.z < -gl_Position.w) {\n        mvPosition.z -= 2.0 * (length(vEnd - vStart) + vSize); // avoid clipping\n        gl_Position.z = (uProjection * mvPosition).z;\n    }\n\n    #if defined(dDualColor) && defined(dRenderVariant_color) && (defined(dColorType_group) || defined(dColorType_groupInstance))\n        // dual-color mixing\n        // - for aColorMode between 0 and 1 use aColorMode to interpolate\n        // - for aColorMode == 2 do nothing, i.e., use vColor\n        // - for aColorMode == 3 use position on cylinder axis to interpolate\n        if (aColorMode <= 1.0){\n            vColor.rgb = mix(vColor.rgb, color2.rgb, aColorMode);\n        } else if (aColorMode == 3.0) {\n            vColor.rgb = mix(vColor.rgb, color2.rgb, mix(-0.25, 1.25, f / 1.5));\n        }\n    #endif\n\n    #include clip_instance\n}\n","\nprecision highp float;\nprecision highp int;\n\n#define bumpEnabled\n\nuniform mat4 uView;\n\nvarying mat4 vTransform;\nvarying vec3 vStart;\nvarying vec3 vEnd;\nvarying float vSize;\nvarying float vCap;\n\nuniform vec3 uCameraDir;\nuniform vec3 uCameraPosition;\nuniform mat4 uInvView;\n\nuniform vec4 uInteriorColor;\nuniform vec4 uInteriorSubstance;\n\n#include common\n#include common_frag_params\n#include color_frag_params\n#include light_frag_params\n#include common_clip\n\n#ifdef dSolidInterior\n    const bool solidInterior = true;\n#else\n    const bool solidInterior = false;\n#endif\n\n// adapted from https://www.shadertoy.com/view/4lcSRn\n// The MIT License, Copyright 2016 Inigo Quilez\nbool CylinderImpostor(\n    in vec3 rayOrigin, in vec3 rayDir,\n    in vec3 start, in vec3 end, in float radius,\n    out vec3 cameraNormal, out bool interior,\n    out vec3 modelPosition, out vec3 viewPosition, out float fragmentDepth\n){\n    vec3 ba = end - start;\n    vec3 oc = rayOrigin - start;\n\n    float baba = dot(ba, ba);\n    float bard = dot(ba, rayDir);\n    float baoc = dot(ba, oc);\n\n    float k2 = baba - bard * bard;\n    float k1 = baba * dot(oc, rayDir) - baoc * bard;\n    float k0 = baba * dot(oc, oc) - baoc * baoc - radius * radius * baba;\n\n    float h = k1 * k1 - k2 * k0;\n    if (h < 0.0) return false;\n\n    bool topCap = (vCap > 0.9 && vCap < 1.1) || vCap >= 2.9;\n    bool bottomCap = (vCap > 1.9 && vCap < 2.1) || vCap >= 2.9;\n\n    #ifdef dSolidInterior\n        bool topInterior = !topCap;\n        bool bottomInterior = !bottomCap;\n        topCap = true;\n        bottomCap = true;\n    #else\n        bool topInterior = false;\n        bool bottomInterior = false;\n    #endif\n\n    bool clipped = false;\n    bool objectClipped = false;\n\n    // body outside\n    h = sqrt(h);\n    float t = (-k1 - h) / k2;\n    float y = baoc + t * bard;\n    if (y > 0.0 && y < baba) {\n        interior = false;\n        cameraNormal = (oc + t * rayDir - ba * y / baba) / radius;\n        modelPosition = rayOrigin + t * rayDir;\n        viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;\n        fragmentDepth = calcDepth(viewPosition);\n        #if defined(dClipVariant_pixel) && dClipObjectCount != 0\n            if (clipTest(modelPosition)) {\n                objectClipped = true;\n                fragmentDepth = -1.0;\n                #ifdef dSolidInterior\n                    topCap = !topInterior;\n                    bottomCap = !bottomInterior;\n                #endif\n            }\n        #endif\n        if (fragmentDepth > 0.0) return true;\n        clipped = true;\n    }\n\n    if (!clipped) {\n        if (topCap && y < 0.0) {\n            // top cap\n            t = -baoc / bard;\n            if (abs(k1 + k2 * t) < h) {\n                interior = topInterior;\n                cameraNormal = -ba / baba;\n                modelPosition = rayOrigin + t * rayDir;\n                viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;\n                fragmentDepth = calcDepth(viewPosition);\n                #if defined(dClipVariant_pixel) && dClipObjectCount != 0\n                    if (clipTest(modelPosition)) {\n                        objectClipped = true;\n                        fragmentDepth = -1.0;\n                        #ifdef dSolidInterior\n                            topCap = !topInterior;\n                            bottomCap = !bottomInterior;\n                        #endif\n                    }\n                #endif\n                if (fragmentDepth > 0.0) {\n                    #ifdef dSolidInterior\n                        if (interior) cameraNormal = -rayDir;\n                    #endif\n                    #if defined(dClipVariant_pixel) && dClipObjectCount != 0\n                        return true;\n                    #else\n                        return !interior;\n                    #endif\n                }\n            }\n        } else if (bottomCap && y >= 0.0) {\n            // bottom cap\n            t = (baba - baoc) / bard;\n            if (abs(k1 + k2 * t) < h) {\n                interior = bottomInterior;\n                cameraNormal = ba / baba;\n                modelPosition = rayOrigin + t * rayDir;\n                viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;\n                fragmentDepth = calcDepth(viewPosition);\n                #if defined(dClipVariant_pixel) && dClipObjectCount != 0\n                    if (clipTest(modelPosition)) {\n                        objectClipped = true;\n                        fragmentDepth = -1.0;\n                        #ifdef dSolidInterior\n                            topCap = !topInterior;\n                            bottomCap = !bottomInterior;\n                        #endif\n                    }\n                #endif\n                if (fragmentDepth > 0.0) {\n                    #ifdef dSolidInterior\n                        if (interior) cameraNormal = -rayDir;\n                    #endif\n                    #if defined(dClipVariant_pixel) && dClipObjectCount != 0\n                        return true;\n                    #else\n                        return !interior;\n                    #endif\n                }\n            }\n        }\n    }\n\n    if (uDoubleSided || solidInterior) {\n        // body inside\n        h = -h;\n        t = (-k1 - h) / k2;\n        y = baoc + t * bard;\n        if (y > 0.0 && y < baba) {\n            interior = true;\n            cameraNormal = -(oc + t * rayDir - ba * y / baba) / radius;\n            modelPosition = rayOrigin + t * rayDir;\n            viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;\n            fragmentDepth = calcDepth(viewPosition);\n            if (fragmentDepth > 0.0) {\n                #ifdef dSolidInterior\n                    if (!objectClipped) {\n                        fragmentDepth = 0.0 + (0.0000002 / vSize);\n                        cameraNormal = -rayDir;\n\n                        // intersection of ray in model space with near plane in camera space\n                        vec3 cameraRayOrigin = (uView * vec4(rayOrigin, 1.0)).xyz;\n                        vec3 cameraRayDir = (uView * vec4(rayDir, 0.0)).xyz;\n                        float nearT = - (uNear + cameraRayOrigin.z) / cameraRayDir.z;\n                        viewPosition = cameraRayOrigin + nearT * cameraRayDir;\n                        modelPosition = (uInvView * vec4(viewPosition, 1.0)).xyz;\n                    }\n                #endif\n                return true;\n            }\n        }\n\n        if (topCap && y < 0.0) {\n            // top cap\n            t = -baoc / bard;\n            if (abs(k1 + k2 * t) < -h) {\n                interior = true;\n                cameraNormal = ba / baba;\n                modelPosition = rayOrigin + t * rayDir;\n                viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;\n                fragmentDepth = calcDepth(viewPosition);\n                if (fragmentDepth > 0.0) {\n                    #ifdef dSolidInterior\n                        if (!objectClipped) {\n                            fragmentDepth = 0.0 + (0.0000002 / vSize);\n                            cameraNormal = -rayDir;\n\n                            // intersection of ray in model space with near plane in camera space\n                            vec3 cameraRayOrigin = (uView * vec4(rayOrigin, 1.0)).xyz;\n                            vec3 cameraRayDir = (uView * vec4(rayDir, 0.0)).xyz;\n                            float nearT = - (uNear + cameraRayOrigin.z) / cameraRayDir.z;\n                            viewPosition = cameraRayOrigin + nearT * cameraRayDir;\n                            modelPosition = (uInvView * vec4(viewPosition, 1.0)).xyz;\n                        }\n                    #endif\n                    return true;\n                }\n            }\n        } else if (bottomCap && y >= 0.0) {\n            // bottom cap\n            t = (baba - baoc) / bard;\n            if (abs(k1 + k2 * t) < -h) {\n                interior = true;\n                cameraNormal = -ba / baba;\n                modelPosition = rayOrigin + t * rayDir;\n                viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;\n                fragmentDepth = calcDepth(viewPosition);\n                if (fragmentDepth > 0.0) {\n                    #ifdef dSolidInterior\n                        if (!objectClipped) {\n                            fragmentDepth = 0.0 + (0.0000002 / vSize);\n                            cameraNormal = -rayDir;\n\n                            // intersection of ray in model space with near plane in camera space\n                            vec3 cameraRayOrigin = (uView * vec4(rayOrigin, 1.0)).xyz;\n                            vec3 cameraRayDir = (uView * vec4(rayDir, 0.0)).xyz;\n                            float nearT = - (uNear + cameraRayOrigin.z) / cameraRayDir.z;\n                            viewPosition = cameraRayOrigin + nearT * cameraRayDir;\n                            modelPosition = (uInvView * vec4(viewPosition, 1.0)).xyz;\n                        }\n                    #endif\n                    return true;\n                }\n            }\n        }\n    }\n\n    return false;\n}\n\nvoid main() {\n    vec3 rayOrigin = vModelPosition;\n    vec3 rayDir = mix(normalize(vModelPosition - uCameraPosition), uCameraDir, uIsOrtho);\n\n    vec3 cameraNormal;\n    vec3 modelPosition;\n    vec3 viewPosition;\n    float fragmentDepth;\n    bool hit = CylinderImpostor(rayOrigin, rayDir, vStart, vEnd, vSize, cameraNormal, interior, modelPosition, viewPosition, fragmentDepth);\n    if (!hit) discard;\n\n    if (fragmentDepth < 0.0) discard;\n    if (fragmentDepth > 1.0) discard;\n\n    gl_FragDepthEXT = fragmentDepth;\n\n    vec3 vViewPosition = viewPosition;\n    vec3 vModelPosition = modelPosition;\n\n    #include fade_lod\n    #include clip_pixel\n\n    #ifdef dNeedsNormal\n        mat3 normalMatrix = adjoint(uView);\n        vec3 normal = normalize(normalMatrix * -normalize(cameraNormal));\n    #endif\n\n    #include assign_material_color\n    #include check_transparency\n\n    #if defined(dRenderVariant_pick)\n        #include check_picking_alpha\n        #ifdef requiredDrawBuffers\n            gl_FragColor = vObject;\n            gl_FragData[1] = vInstance;\n            gl_FragData[2] = vGroup;\n            gl_FragData[3] = packDepthToRGBA(fragmentDepth);\n        #else\n            gl_FragColor = vColor;\n        #endif\n    #elif defined(dRenderVariant_depth)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_marking)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_emissive)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_color) || defined(dRenderVariant_tracing)\n        #include apply_interior_color\n        #include apply_light_color\n        #include apply_marker_color\n\n        #if defined(dRenderVariant_color)\n            #include apply_fog\n            #include wboit_write\n            #include dpoit_write\n        #elif defined(dRenderVariant_tracing)\n            gl_FragData[1] = vec4(normal, emissive);\n            gl_FragData[2] = vec4(material.rgb, uDensity);\n        #endif\n    #endif\n}\n",{fragDepth:"required",drawBuffers:"optional"},{},y),_=g("text","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include read_from_texture\n#include common_vert_params\n#include color_vert_params\n#include size_vert_params\n#include common_clip\n\nuniform mat4 uModelView;\n\nattribute vec3 aPosition;\nattribute vec2 aMapping;\nattribute float aDepth;\nattribute vec2 aTexCoord;\nattribute mat4 aTransform;\nattribute float aInstance;\nattribute float aGroup;\n\nuniform float uOffsetX;\nuniform float uOffsetY;\nuniform float uOffsetZ;\n\nuniform float uIsOrtho;\nuniform float uPixelRatio;\nuniform vec4 uViewport;\nuniform mat4 uInvHeadRotation;\nuniform bool uHasHeadRotation;\nuniform mat4 uModelViewEye;\nuniform mat4 uInvModelViewEye;\nuniform bool uHasEyeCamera;\n\nvarying vec2 vTexCoord;\n\nvoid main(void){\n    int vertexId = VertexID;\n\n    #include assign_group\n    #include assign_color_varying\n    #include assign_marker_varying\n    #include assign_clipping_varying\n    #include assign_size\n\n    vTexCoord = aTexCoord;\n\n    float scale = uModelScale;\n\n    float offsetX = uOffsetX * scale;\n    float offsetY = uOffsetY * scale;\n    float offsetZ = (uOffsetZ + aDepth * 0.95) * scale;\n\n    vec4 position4 = vec4(aPosition, 1.0);\n    vec4 mvPosition = uHasEyeCamera\n         ? uModelViewEye * aTransform * position4\n         : uModelView * aTransform * position4;\n\n    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader\n\n    // TODO\n    // #ifdef FIXED_SIZE\n    //     if (ortho) {\n    //         scale /= pixelRatio * ((uViewport.w / 2.0) / -uCameraPosition.z) * 0.1;\n    //     } else {\n    //         scale /= pixelRatio * ((uViewport.w / 2.0) / -mvPosition.z) * 0.1;\n    //     }\n    // #endif\n\n    vec4 mvCorner = vec4(mvPosition.xyz, 1.0);\n\n    if (vTexCoord.x == 10.0) { // indicates background plane\n        // move a bit to the back, taking distance to camera into account to avoid z-fighting\n        offsetZ -= 0.001 * distance(uCameraPosition, (uProjection * mvCorner).xyz);\n    }\n\n    vec3 cornerOffset = vec3(0.0);\n    cornerOffset.xy += aMapping * size * scale;\n    cornerOffset.x += offsetX;\n    cornerOffset.y += offsetY;\n\n    if (uHasHeadRotation) {\n        mvCorner.xyz += (uInvHeadRotation * vec4(cornerOffset, 1.0)).xyz;\n    } else {\n        mvCorner.xyz += cornerOffset;\n    }\n\n    if (!uHasEyeCamera) {\n        if (uIsOrtho == 1.0) {\n            mvCorner.z += offsetZ;\n        } else {\n            mvCorner.xyz += normalize(-mvCorner.xyz) * offsetZ;\n        }\n    }\n\n    if (uHasEyeCamera) {\n        mvCorner = uModelView * uInvModelViewEye * mvCorner;\n    }\n\n    gl_Position = uProjection * mvCorner;\n\n    vViewPosition = -mvCorner.xyz;\n\n    #include clip_instance\n}\n","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include common_frag_params\n#include color_frag_params\n#include common_clip\n\nuniform sampler2D tFont;\n\nuniform vec3 uBorderColor;\nuniform float uBorderWidth;\nuniform vec3 uBackgroundColor;\nuniform float uBackgroundOpacity;\n\nvarying vec2 vTexCoord;\n\nvoid main(){\n    #include fade_lod\n    #include clip_pixel\n\n    float fragmentDepth = gl_FragCoord.z;\n    #include assign_material_color\n\n    if (vTexCoord.x > 1.0) {\n        #if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)\n            material = vec4(uBackgroundColor, uBackgroundOpacity * material.a);\n        #endif\n    } else {\n        // retrieve signed distance\n        float sdf = texture2D(tFont, vTexCoord).a + uBorderWidth;\n\n        if (sdf < 0.5) discard;\n\n        #if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)\n            // add border\n            float t = 0.5 + uBorderWidth;\n            if (uBorderWidth > 0.0 && sdf < t) {\n                material.xyz = uBorderColor;\n            }\n        #endif\n    }\n\n    #include check_transparency\n\n    #if defined(dRenderVariant_pick)\n        #include check_picking_alpha\n        #ifdef requiredDrawBuffers\n            gl_FragColor = vObject;\n            gl_FragData[1] = vInstance;\n            gl_FragData[2] = vGroup;\n            gl_FragData[3] = packDepthToRGBA(fragmentDepth);\n        #else\n            gl_FragColor = vColor;\n        #endif\n    #elif defined(dRenderVariant_depth)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_marking)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_emissive)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_color) || defined(dRenderVariant_tracing)\n        gl_FragColor = material;\n        #include apply_marker_color\n\n        #if defined(dRenderVariant_color)\n            #include apply_fog\n            #include wboit_write\n            #include dpoit_write\n        #elif defined(dRenderVariant_tracing)\n            gl_FragData[1] = vec4(-normalize(vViewPosition), emissive);\n            gl_FragData[2] = vec4(material.rgb, uDensity);\n        #endif\n    #endif\n}\n",{drawBuffers:"optional"},{},v),C=g("lines","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include read_from_texture\n#include common_vert_params\n#include color_vert_params\n#include size_vert_params\n#include common_clip\n\nuniform float uPixelRatio;\nuniform vec4 uViewport;\n\nattribute mat4 aTransform;\nattribute float aInstance;\nattribute float aGroup;\n\nattribute vec2 aMapping;\nattribute vec3 aStart;\nattribute vec3 aEnd;\n\nvoid trimSegment(const in vec4 start, inout vec4 end) {\n    // trim end segment so it terminates between the camera plane and the near plane\n    // conservative estimate of the near plane\n    float a = uProjection[2][2];  // 3rd entry in 3rd column\n    float b = uProjection[3][2];  // 3rd entry in 4th column\n    float nearEstimate = -0.5 * b / a;\n    float alpha = (nearEstimate - start.z) / (end.z - start.z);\n    end.xyz = mix(start.xyz, end.xyz, alpha);\n}\n\nvoid main(){\n    float aspect = uViewport.z / uViewport.w;\n    int vertexId = VertexID;\n\n    #include assign_group\n    #include assign_color_varying\n    #include assign_marker_varying\n    #include assign_clipping_varying\n    #include assign_size\n\n    mat4 modelView = uView * uModel * aTransform;\n\n    // camera space\n    vec4 start = modelView * vec4(aStart, 1.0);\n    vec4 end = modelView * vec4(aEnd, 1.0);\n\n    // assign position\n    vec4 position4 = vec4((aMapping.y < 0.5) ? aStart : aEnd, 1.0);\n    vec4 mvPosition = modelView * position4;\n    vViewPosition = mvPosition.xyz;\n\n    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader\n\n    // special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n    // clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n    // but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n    // perhaps there is a more elegant solution -- WestLangley\n    bool perspective = (uProjection[2][3] == -1.0); // 4th entry in the 3rd column\n    if (perspective) {\n        if (start.z < 0.0 && end.z >= 0.0) {\n            trimSegment(start, end);\n        } else if (end.z < 0.0 && start.z >= 0.0) {\n            trimSegment(end, start);\n        }\n    }\n\n    // clip space\n    vec4 clipStart = uProjection * start;\n    vec4 clipEnd = uProjection * end;\n\n    // ndc space\n    vec2 ndcStart = clipStart.xy / clipStart.w;\n    vec2 ndcEnd = clipEnd.xy / clipEnd.w;\n\n    // direction\n    vec2 dir = ndcEnd - ndcStart;\n\n    // account for clip-space aspect ratio\n    dir.x *= aspect;\n    dir = normalize(dir);\n\n    // perpendicular to dir\n    vec2 offset = vec2(dir.y, - dir.x);\n\n    // undo aspect ratio adjustment\n    dir.x /= aspect;\n    offset.x /= aspect;\n\n    // sign flip\n    if (aMapping.x < 0.0) offset *= -1.0;\n\n    // calculate linewidth\n    float linewidth;\n    #ifdef dLineSizeAttenuation\n        linewidth = size * uPixelRatio * ((uViewport.w / 2.0) / -start.z) * 5.0;\n    #else\n        linewidth = size * uPixelRatio;\n    #endif\n    linewidth = max(1.0, linewidth);\n\n    // adjust for linewidth\n    offset *= linewidth;\n\n    // adjust for clip-space to screen-space conversion\n    offset /= uViewport.w;\n\n    // select end\n    vec4 clip = (aMapping.y < 0.5) ? clipStart : clipEnd;\n\n    // back to clip space\n    offset *= clip.w;\n    clip.xy += offset;\n    gl_Position = clip;\n\n    #include clip_instance\n}\n","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include common_frag_params\n#include color_frag_params\n#include common_clip\n\nvoid main(){\n    #include fade_lod\n    #include clip_pixel\n\n    float fragmentDepth = gl_FragCoord.z;\n    #include assign_material_color\n    #include check_transparency\n\n    #if defined(dRenderVariant_pick)\n        #include check_picking_alpha\n        #ifdef requiredDrawBuffers\n            gl_FragColor = vObject;\n            gl_FragData[1] = vInstance;\n            gl_FragData[2] = vGroup;\n            gl_FragData[3] = packDepthToRGBA(fragmentDepth);\n        #else\n            gl_FragColor = vColor;\n        #endif\n    #elif defined(dRenderVariant_depth)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_marking)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_emissive)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_color) || defined(dRenderVariant_tracing)\n        gl_FragColor = material;\n        #include apply_marker_color\n\n        #if defined(dRenderVariant_color)\n            #include apply_fog\n            #include wboit_write\n            #include dpoit_write\n        #elif defined(dRenderVariant_tracing)\n            gl_FragData[1] = vec4(normalize(vViewPosition), emissive);\n            gl_FragData[2] = vec4(material.rgb, uDensity);\n        #endif\n    #endif\n}\n",{drawBuffers:"optional"},{},v),w=g("mesh","\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\n#include common\n#include read_from_texture\n#include common_vert_params\n#include color_vert_params\n#include common_clip\n#include texture3d_from_2d_linear\n\n#ifdef dGeometryType_textureMesh\n    uniform vec2 uGeoTexDim;\n    uniform sampler2D tPosition;\n    uniform sampler2D tGroup;\n    uniform sampler2D tNormal;\n#else\n    attribute vec3 aPosition;\n    attribute float aGroup;\n    attribute vec3 aNormal;\n#endif\nattribute mat4 aTransform;\nattribute float aInstance;\n\nvarying vec3 vNormal;\n\nvoid main(){\n    int vertexId = VertexID;\n\n    #include assign_group\n    #include assign_marker_varying\n    #include assign_clipping_varying\n    #include assign_position\n    #include assign_color_varying\n    #include clip_instance\n\n    #ifdef dGeometryType_textureMesh\n        vec3 normal = readFromTexture(tNormal, vertexId, uGeoTexDim).xyz;\n    #else\n        vec3 normal = aNormal;\n    #endif\n    mat3 normalMatrix = adjoint(modelView);\n    vec3 transformedNormal = normalize(normalMatrix * normalize(normal));\n    #if defined(dFlipSided)\n        if (!uDoubleSided) { // TODO checking uDoubleSided should not be required, ASR\n            transformedNormal = -transformedNormal;\n        }\n    #endif\n    vNormal = transformedNormal;\n}\n","\nprecision highp float;\nprecision highp int;\n\n#define bumpEnabled\n\n#include common\n#include common_frag_params\n#include color_frag_params\n#include light_frag_params\n#include normal_frag_params\n#include common_clip\n\nuniform vec4 uInteriorColor;\nuniform vec4 uInteriorSubstance;\n\nvoid main() {\n    #include fade_lod\n    #include clip_pixel\n\n    interior = !gl_FrontFacing;\n\n    float fragmentDepth = gl_FragCoord.z;\n\n    #ifdef dNeedsNormal\n        #if defined(dFlatShaded)\n            vec3 fdx = dFdx(vViewPosition);\n            vec3 fdy = dFdy(vViewPosition);\n            vec3 normal = -normalize(cross(fdx,fdy));\n        #else\n            vec3 normal = -normalize(vNormal);\n            if (uDoubleSided) normal *= float(gl_FrontFacing) * 2.0 - 1.0;\n        #endif\n\n        #if defined(dFlipSided)\n            normal *= -1.0;\n        #endif\n    #endif\n\n    #include assign_material_color\n    #include check_transparency\n\n    #if defined(dRenderVariant_pick)\n        #include check_picking_alpha\n        #ifdef requiredDrawBuffers\n            gl_FragColor = vObject;\n            gl_FragData[1] = vInstance;\n            gl_FragData[2] = vGroup;\n            gl_FragData[3] = packDepthToRGBA(fragmentDepth);\n        #else\n            gl_FragColor = vColor;\n        #endif\n    #elif defined(dRenderVariant_depth)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_marking)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_emissive)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_color) || defined(dRenderVariant_tracing)\n        #include apply_interior_color\n        #include apply_light_color\n        #include apply_marker_color\n\n        #if defined(dRenderVariant_color)\n            #include apply_fog\n            #include wboit_write\n            #include dpoit_write\n        #elif defined(dRenderVariant_tracing)\n            gl_FragData[1] = vec4(normal, emissive);\n            gl_FragData[2] = vec4(material.rgb, uDensity);\n        #endif\n    #endif\n}\n",{drawBuffers:"optional"},{},y),T=g("direct-volume","\nprecision highp float;\n\nattribute vec3 aPosition;\nattribute mat4 aTransform;\nattribute float aInstance;\n\nuniform mat4 uModel;\nuniform mat4 uModelView;\nuniform mat4 uProjection;\nuniform vec4 uInvariantBoundingSphere;\nuniform float uModelScale;\n\nvarying vec3 vModelPosition;\nvarying float vInstance;\nvarying vec4 vBoundingSphere;\nvarying mat4 vTransform;\n\nuniform vec3 uBboxSize;\nuniform vec3 uBboxMin;\nuniform vec3 uBboxMax;\nuniform vec3 uGridDim;\nuniform mat4 uTransform;\n\nuniform mat4 uUnitToCartn;\n\nvoid main() {\n    vec4 unitCoord = vec4(aPosition + vec3(0.5), 1.0);\n    vec4 mvPosition = uModelView * aTransform * uUnitToCartn * unitCoord;\n\n    vModelPosition = (uModel * aTransform * uUnitToCartn * unitCoord).xyz;\n    vInstance = aInstance;\n    vBoundingSphere = vec4(\n        (uModel * aTransform * vec4(uInvariantBoundingSphere.xyz, 1.0)).xyz,\n        uModelScale * uInvariantBoundingSphere.w\n    );\n    vTransform = aTransform;\n\n    gl_Position = uProjection * mvPosition;\n\n    // move z position to near clip plane (but not too close to get precision issues)\n    gl_Position.z = gl_Position.w - 0.01;\n}\n","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include light_frag_params\n\n#if dClipObjectCount != 0\n    uniform int uClipObjectType[dClipObjectCount];\n    uniform bool uClipObjectInvert[dClipObjectCount];\n    uniform vec3 uClipObjectPosition[dClipObjectCount];\n    uniform vec4 uClipObjectRotation[dClipObjectCount];\n    uniform vec3 uClipObjectScale[dClipObjectCount];\n    uniform mat4 uClipObjectTransform[dClipObjectCount];\n#endif\n#include common_clip\n\n#include read_from_texture\n#include texture3d_from_1d_trilinear\n#include texture3d_from_2d_nearest\n#include texture3d_from_2d_linear\n\nuniform mat4 uProjection, uTransform, uModelView, uModel, uView;\nuniform vec3 uCameraDir;\nuniform float uModelScale;\n\nuniform sampler2D tDepth;\nuniform vec2 uDrawingBufferSize;\n\nvarying vec3 vModelPosition;\nvarying float vInstance;\nvarying vec4 vBoundingSphere;\nvarying mat4 vTransform;\n\nuniform mat4 uInvView;\nuniform vec3 uGridDim;\nuniform vec3 uBboxSize;\nuniform sampler2D tTransferTex;\nuniform float uTransferScale;\nuniform float uStepScale;\nuniform float uJumpLength;\n\nuniform int uObjectId;\nuniform int uVertexCount;\nuniform int uInstanceCount;\nuniform int uGroupCount;\n\n#if defined(dColorMarker)\n    uniform vec3 uHighlightColor;\n    uniform vec3 uSelectColor;\n    uniform vec3 uDimColor;\n    uniform float uHighlightStrength;\n    uniform float uSelectStrength;\n    uniform float uDimStrength;\n    uniform int uMarkerPriority;\n    uniform float uMarkerAverage;\n\n    uniform float uMarker;\n    uniform vec2 uMarkerTexDim;\n    uniform sampler2D tMarker;\n#endif\n\nuniform float uMetalness;\nuniform float uRoughness;\nuniform float uEmissive;\n\n// Density value to estimate object thickness\nuniform float uDensity;\n\nuniform bool uFog;\nuniform float uFogNear;\nuniform float uFogFar;\nuniform vec3 uFogColor;\n\nuniform float uAlpha;\nuniform bool uTransparentBackground;\nuniform float uXrayEdgeFalloff;\nuniform float uCelSteps;\nuniform float uExposure;\n\nuniform int uRenderMask;\n\nuniform float uNear;\nuniform float uFar;\nuniform float uIsOrtho;\n\nuniform vec3 uCellDim;\nuniform vec3 uCameraPosition;\nuniform mat4 uCartnToUnit;\n\n#if __VERSION__ != 100\n    // for webgl1 this is given as a 'define'\n    uniform int uMaxSteps;\n#endif\n\n#if defined(dGridTexType_2d)\n    precision highp sampler2D;\n    uniform sampler2D tGridTex;\n    uniform vec3 uGridTexDim;\n#elif defined(dGridTexType_3d)\n    precision highp sampler3D;\n    uniform sampler3D tGridTex;\n#endif\n\n#if defined(dColorType_uniform)\n    uniform vec3 uColor;\n#elif defined(dColorType_texture)\n    uniform vec2 uColorTexDim;\n    uniform sampler2D tColor;\n#endif\n\n#ifdef dOverpaint\n    #if defined(dOverpaintType_groupInstance) || defined(dOverpaintType_vertexInstance)\n        uniform vec2 uOverpaintTexDim;\n        uniform sampler2D tOverpaint;\n    #endif\n#endif\n\n#ifdef dUsePalette\n    uniform vec2 uPaletteDomain;\n    uniform sampler2D tPalette;\n#endif\n\n#if defined(dGridTexType_2d)\n    vec4 textureVal(vec3 pos) {\n        return texture3dFrom2dLinear(tGridTex, pos + (vec3(0.5, 0.5, 0.0) / uGridDim), uGridDim, uGridTexDim.xy);\n    }\n    vec4 textureGroup(vec3 pos) {\n        return texture3dFrom2dNearest(tGridTex, pos + (vec3(0.5, 0.5, 0.0) / uGridDim), uGridDim, uGridTexDim.xy);\n    }\n#elif defined(dGridTexType_3d)\n    vec4 textureVal(vec3 pos) {\n        return texture(tGridTex, pos + (vec3(0.5) / uGridDim));\n    }\n    vec4 textureGroup(vec3 pos) {\n        return texelFetch(tGridTex, ivec3(pos * uGridDim), 0);\n    }\n#endif\n\nfloat calcDepth(const in vec3 pos) {\n    vec2 clipZW = pos.z * uProjection[2].zw + uProjection[3].zw;\n    return 0.5 + 0.5 * clipZW.x / clipZW.y;\n}\n\nfloat transferFunction(float value) {\n    return texture2D(tTransferTex, vec2(value, 0.0)).a;\n}\n\nfloat getDepth(const in vec2 coords) {\n    #ifdef depthTextureSupport\n        return texture2D(tDepth, coords).r;\n    #else\n        return unpackRGBAToDepth(texture2D(tDepth, coords));\n    #endif\n}\n\nconst float gradOffset = 0.5;\n\nvec3 v3m4(vec3 p, mat4 m) {\n    return (m * vec4(p, 1.0)).xyz;\n}\n\nfloat preFogAlphaBlended = 0.0;\n\nvec4 raymarch(vec3 startLoc, vec3 step, vec3 rayDir) {\n    mat3 normalMatrix = adjoint(uModelView * vTransform);\n    mat4 cartnToUnit = uCartnToUnit * inverse4(vTransform);\n    #if defined(dClipVariant_pixel) && dClipObjectCount != 0\n        mat4 modelTransform = uModel * vTransform * uTransform;\n    #endif\n    mat4 modelViewTransform = uModelView * vTransform * uTransform;\n\n    vec3 scaleVol = vec3(1.0) / uGridDim;\n    vec3 pos = startLoc;\n    vec4 cell;\n    float prevValue = -1.0;\n    float value = 0.0;\n    vec4 src = vec4(0.0);\n    vec4 dst = vec4(0.0);\n    float fragmentDepth;\n\n    vec3 posMin = vec3(0.0);\n    vec3 posMax = vec3(1.0) - vec3(1.0) / uGridDim;\n\n    vec3 unitPos;\n\n    vec3 nextPos;\n    float nextValue;\n\n    vec4 material;\n    vec4 overpaint;\n    float metalness = uMetalness;\n    float roughness = uRoughness;\n    float emissive = uEmissive;\n\n    vec3 gradient = vec3(1.0);\n    vec3 dx = vec3(gradOffset * scaleVol.x, 0.0, 0.0);\n    vec3 dy = vec3(0.0, gradOffset * scaleVol.y, 0.0);\n    vec3 dz = vec3(0.0, 0.0, gradOffset * scaleVol.z);\n\n    float maxDist = min(vBoundingSphere.w * 2.0, uFar - uNear);\n    float maxDistSq = maxDist * maxDist;\n\n    for (int i = 0; i < uMaxSteps; ++i) {\n        // break when beyond bounding-sphere or far-plane\n        vec3 distVec = startLoc - pos;\n        if (dot(distVec, distVec) > maxDistSq) break;\n\n        unitPos = v3m4(pos / uModelScale, cartnToUnit);\n\n        // continue when outside of grid\n        if (unitPos.x > posMax.x || unitPos.y > posMax.y || unitPos.z > posMax.z ||\n            unitPos.x < posMin.x || unitPos.y < posMin.y || unitPos.z < posMin.z\n        ) {\n            prevValue = value;\n            pos += step;\n            continue;\n        }\n\n        cell = textureVal(unitPos);\n        value = cell.a; // current voxel value\n\n        if (uJumpLength > 0.0 && value < 0.01) {\n            nextPos = pos + rayDir * uJumpLength;\n            nextValue = textureVal(v3m4(nextPos / uModelScale, cartnToUnit)).a;\n            if (nextValue < 0.01) {\n                prevValue = nextValue;\n                pos = nextPos;\n                continue;\n            }\n        }\n\n        vec4 mvPosition = modelViewTransform * vec4(unitPos * uGridDim, 1.0);\n        if (calcDepth(mvPosition.xyz) > getDepth(gl_FragCoord.xy / uDrawingBufferSize))\n            break;\n\n        #if defined(dClipVariant_pixel) && dClipObjectCount != 0\n            vec3 modelPosition = v3m4(unitPos * uGridDim, modelTransform);\n            if (clipTest(modelPosition)) {\n                prevValue = value;\n                pos += step;\n                continue;\n            }\n        #endif\n\n        vec3 vViewPosition = mvPosition.xyz;\n        material.a = transferFunction(value);\n\n        #ifdef dPackedGroup\n            float group = unpackRGBToInt(textureGroup(floor(unitPos * uGridDim + 0.5) / uGridDim).rgb);\n        #else\n            vec3 g = floor(unitPos * uGridDim + 0.5);\n            // note that we swap x and z because the texture is flipped around y\n            #if defined(dAxisOrder_012)\n                float group = g.z + g.y * uGridDim.z + g.x * uGridDim.z * uGridDim.y; // 210\n            #elif defined(dAxisOrder_021)\n                float group = g.y + g.z * uGridDim.y + g.x * uGridDim.y * uGridDim.z; // 120\n            #elif defined(dAxisOrder_102)\n                float group = g.z + g.x * uGridDim.z + g.y * uGridDim.z * uGridDim.x; // 201\n            #elif defined(dAxisOrder_120)\n                float group = g.x + g.z * uGridDim.x + g.y * uGridDim.x * uGridDim.z; // 021\n            #elif defined(dAxisOrder_201)\n                float group = g.y + g.x * uGridDim.y + g.z * uGridDim.y * uGridDim.x; // 102\n            #elif defined(dAxisOrder_210)\n                float group = g.x + g.y * uGridDim.x + g.z * uGridDim.x * uGridDim.y; // 012\n            #endif\n        #endif\n\n        #if defined(dColorType_direct) && defined(dUsePalette)\n            float paletteValue = (value - uPaletteDomain[0]) / (uPaletteDomain[1] - uPaletteDomain[0]);\n            material.rgb = texture2D(tPalette, vec2(clamp(paletteValue, 0.0, 1.0), 0.0)).rgb;\n        #elif defined(dColorType_uniform)\n            material.rgb = uColor;\n        #elif defined(dColorType_instance)\n            material.rgb = readFromTexture(tColor, vInstance, uColorTexDim).rgb;\n        #elif defined(dColorType_group)\n            material.rgb = readFromTexture(tColor, group, uColorTexDim).rgb;\n        #elif defined(dColorType_groupInstance)\n            material.rgb = readFromTexture(tColor, vInstance * float(uGroupCount) + group, uColorTexDim).rgb;\n        #elif defined(dColorType_vertex)\n            material.rgb = texture3dFrom1dTrilinear(tColor, unitPos, uGridDim, uColorTexDim, 0.0).rgb;\n        #elif defined(dColorType_vertexInstance)\n            material.rgb = texture3dFrom1dTrilinear(tColor, unitPos, uGridDim, uColorTexDim, vInstance * float(uVertexCount)).rgb;\n        #endif\n\n        #ifdef dOverpaint\n            #if defined(dOverpaintType_groupInstance)\n                overpaint = readFromTexture(tOverpaint, vInstance * float(uGroupCount) + group, uOverpaintTexDim);\n            #elif defined(dOverpaintType_vertexInstance)\n                overpaint = texture3dFrom1dTrilinear(tOverpaint, unitPos, uGridDim, uOverpaintTexDim, vInstance * float(uVertexCount));\n            #endif\n\n            material.rgb = mix(material.rgb, overpaint.rgb, overpaint.a);\n        #endif\n\n        #if defined(dIgnoreLight)\n            gl_FragColor.rgb = material.rgb;\n        #else\n            if (material.a >= 0.01) {\n                #ifdef dPackedGroup\n                    // compute gradient by central differences\n                    gradient.x = textureVal(unitPos - dx).a - textureVal(unitPos + dx).a;\n                    gradient.y = textureVal(unitPos - dy).a - textureVal(unitPos + dy).a;\n                    gradient.z = textureVal(unitPos - dz).a - textureVal(unitPos + dz).a;\n                #else\n                    gradient = cell.xyz * 2.0 - 1.0;\n                #endif\n                vec3 normal = -normalize(normalMatrix * normalize(gradient));\n                #include apply_light_color\n            } else {\n                gl_FragColor.rgb = material.rgb;\n            }\n        #endif\n\n        gl_FragColor.a = material.a * uAlpha * uTransferScale;\n\n        #if defined(dColorMarker)\n            float marker = uMarker;\n            if (uMarker == -1.0) {\n                marker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;\n                marker = floor(marker * 255.0 + 0.5); // rounding required to work on some cards on win\n            }\n        #endif\n        #include apply_marker_color\n\n        preFogAlphaBlended = (1.0 - preFogAlphaBlended) * gl_FragColor.a + preFogAlphaBlended;\n        fragmentDepth = calcDepth(mvPosition.xyz);\n        #include apply_fog\n\n        src = gl_FragColor;\n\n        if (!uTransparentBackground || !uFog) {\n            // done in 'apply_fog' otherwise\n            src.rgb *= src.a;\n        }\n        dst = (1.0 - dst.a) * src + dst; // standard blending\n\n        // break if the color is opaque enough\n        if (dst.a > 0.95)\n            break;\n\n        pos += step;\n    }\n\n    return dst;\n}\n\n// TODO: support float texture for higher precision values???\n// TODO: support clipping exclusion texture support\n\nvoid main() {\n    #if defined(dRenderVariant_tracing) || defined(dRenderVariant_emissive)\n        discard;\n    #else\n        if (gl_FrontFacing)\n            discard;\n\n        vec3 rayDir = mix(normalize(vModelPosition - uCameraPosition), uCameraDir, uIsOrtho);\n        vec3 step = rayDir * uStepScale * uModelScale;\n\n        float boundingSphereNear = distance(vBoundingSphere.xyz, uCameraPosition) - vBoundingSphere.w;\n        float d = max(uNear, boundingSphereNear) - mix(0.0, distance(vModelPosition, uCameraPosition), uIsOrtho);\n        vec3 start = mix(uCameraPosition, vModelPosition, uIsOrtho) + (d * rayDir);\n        gl_FragColor = raymarch(start, step, rayDir);\n\n        float fragmentDepth = calcDepth((uView * vec4(start, 1.0)).xyz);\n        float preFogAlpha = clamp(preFogAlphaBlended, 0.0, 1.0);\n        #include wboit_write\n    #endif\n}\n",{fragDepth:"optional",drawBuffers:"optional"},{},y),A=g("image","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include common_vert_params\n\nattribute vec3 aPosition;\nattribute vec2 aUv;\nattribute mat4 aTransform;\nattribute float aInstance;\n\nvarying vec2 vUv;\nvarying float vInstance;\n\nvoid main() {\n    int vertexId = VertexID;\n\n    #include assign_position\n\n    vUv = aUv;\n    vInstance = aInstance;\n}\n","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include read_from_texture\n#include common_frag_params\n#include common_clip\n\nuniform float uEmissive;\n\n// Density value to estimate object thickness\nuniform float uDensity;\n\n#if defined(dRenderVariant_color) || defined(dRenderVariant_tracing)\n    #ifdef dOverpaint\n        #if defined(dOverpaintType_instance) || defined(dOverpaintType_groupInstance)\n            varying vec4 vOverpaint;\n            uniform vec2 uOverpaintTexDim;\n            uniform sampler2D tOverpaint;\n        #endif\n        uniform float uOverpaintStrength;\n    #endif\n#endif\n\n#if defined(dRenderVariant_color) || defined(dRenderVariant_tracing) || defined(dRenderVariant_emissive)\n    #ifdef dEmissive\n        #if defined(dEmissiveType_instance) || defined(dEmissiveType_groupInstance)\n            varying float vEmissive;\n            uniform vec2 uEmissiveTexDim;\n            uniform sampler2D tEmissive;\n        #endif\n        uniform float uEmissiveStrength;\n    #endif\n#endif\n\n#ifdef dTransparency\n    #if defined(dTransparencyType_instance) || defined(dTransparencyType_groupInstance)\n        varying float vTransparency;\n        uniform vec2 uTransparencyTexDim;\n        uniform sampler2D tTransparency;\n    #endif\n    uniform float uTransparencyStrength;\n#endif\n\nuniform vec2 uImageTexDim;\nuniform sampler2D tImageTex;\nuniform sampler2D tGroupTex;\nuniform sampler2D tValueTex;\n\nuniform vec2 uMarkerTexDim;\nuniform sampler2D tMarker;\n\nvarying vec2 vUv;\nvarying float vInstance;\n\n#ifdef dUsePalette\n    uniform sampler2D tPalette;\n    uniform vec3 uPaletteDefault;\n#endif\n\nuniform int uTrimType;\nuniform vec3 uTrimCenter;\nuniform vec4 uTrimRotation;\nuniform vec3 uTrimScale;\nuniform mat4 uTrimTransform;\n\nuniform float uIsoLevel;\n\n#if defined(dInterpolation_catmulrom) || defined(dInterpolation_mitchell) || defined(dInterpolation_bspline)\n    #define dInterpolation_cubic\n#endif\n\n#if defined(dInterpolation_cubic)\n    #if defined(dInterpolation_catmulrom) || defined(dInterpolation_mitchell)\n        #if defined(dInterpolation_catmulrom)\n            const float B = 0.0;\n            const float C = 0.5;\n        #elif defined(dInterpolation_mitchell)\n            const float B = 0.333;\n            const float C = 0.333;\n        #endif\n\n        float cubicFilter(float x){\n            float f = x;\n            if (f < 0.0) {\n                f = -f;\n            }\n            if (f < 1.0) {\n                return ((12.0 - 9.0 * B - 6.0 * C) * (f * f * f) +\n                    (-18.0 + 12.0 * B + 6.0 * C) * (f * f) +\n                    (6.0 - 2.0 * B)) / 6.0;\n            }else if (f >= 1.0 && f < 2.0){\n                return ((-B - 6.0 * C) * ( f * f * f)\n                    + (6.0 * B + 30.0 * C) * (f * f) +\n                    (-(12.0 * B) - 48.0 * C) * f +\n                    8.0 * B + 24.0 * C) / 6.0;\n            }else{\n                return 0.0;\n            }\n        }\n    #elif defined(dInterpolation_bspline)\n        float cubicFilter(float x) {\n            float f = x;\n            if (f < 0.0) {\n                f = -f;\n            }\n            if (f >= 0.0 && f <= 1.0){\n                return (2.0 / 3.0) + (0.5) * (f * f * f) - (f * f);\n            } else if (f > 1.0 && f <= 2.0) {\n                return 1.0 / 6.0 * pow((2.0 - f), 3.0);\n            }\n            return 1.0;\n        }\n    #endif\n\n    vec4 biCubic(sampler2D tex, vec2 texCoord) {\n        vec2 texelSize = 1.0 / uImageTexDim;\n        texCoord -= texelSize / 2.0;\n        vec4 nSum = vec4(0.0);\n        float nDenom = 0.0;\n        vec2 cell = fract(texCoord * uImageTexDim);\n        for (float m = -1.0; m <= 2.0; ++m) {\n            for (float n = -1.0; n <= 2.0; ++n) {\n                vec4 vecData = texture2D(tex, texCoord + texelSize * vec2(m, n));\n                float c = abs(cubicFilter(m - cell.x) * cubicFilter(-n + cell.y));\n                nSum += vecData * c;\n                nDenom += c;\n            }\n        }\n        return nSum / nDenom;\n    }\n#endif\n\nvoid main() {\n    if (uTrimType != 0 && getSignedDistance(vModelPosition, uTrimType, uTrimCenter, uTrimRotation, uTrimScale, uTrimTransform) > 0.0) discard;\n\n    #include fade_lod\n    #include clip_pixel\n\n    #if defined(dInterpolation_cubic)\n        #ifdef dUsePalette\n            vec4 material = texture2D(tImageTex, vUv);\n            if (material.rgb != vec3(1.0)) {\n                material = biCubic(tImageTex, vUv);\n            }\n        #else\n            vec4 material = biCubic(tImageTex, vUv);\n        #endif\n    #else\n        vec4 material = texture2D(tImageTex, vUv);\n    #endif\n\n    if (uIsoLevel >= 0.0) {\n        if (texture2D(tValueTex, vUv).r < uIsoLevel) discard;\n\n        material.a = uAlpha;\n    } else {\n        if (material.a == 0.0) discard;\n\n        material.a *= uAlpha;\n    }\n\n    float fragmentDepth = gl_FragCoord.z;\n\n    vec3 packedGroup = texture2D(tGroupTex, vUv).rgb;\n    float group = packedGroup == vec3(0.0) ? -1.0 : unpackRGBToInt(packedGroup);\n\n    // apply per-group transparency\n    #if defined(dTransparency) && (defined(dRenderVariant_pick) || defined(dRenderVariant_color) || defined(dRenderVariant_emissive) || defined(dRenderVariant_tracing))\n        float transparency = 0.0;\n        #if defined(dTransparencyType_instance)\n            transparency = readFromTexture(tTransparency, vInstance, uTransparencyTexDim).a;\n        #elif defined(dTransparencyType_groupInstance)\n            transparency = readFromTexture(tTransparency, vInstance * float(uGroupCount) + group, uTransparencyTexDim).a;\n        #endif\n        transparency *= uTransparencyStrength;\n\n        float ta = 1.0 - transparency;\n        if (transparency < 0.09) ta = 1.0; // hard cutoff looks better\n\n        #if defined(dRenderVariant_pick)\n            if (ta * uAlpha < uPickingAlphaThreshold)\n                discard; // ignore so the element below can be picked\n        #elif defined(dRenderVariant_emissive)\n            if (ta < 1.0)\n                discard; // emissive not supported with transparency\n        #elif defined(dRenderVariant_color) || defined(dRenderVariant_tracing)\n            material.a *= ta;\n        #endif\n    #endif\n\n    if ((uRenderMask == MaskOpaque && material.a < 1.0) ||\n        (uRenderMask == MaskTransparent && material.a == 1.0)\n    ) {\n        discard;\n    }\n\n    #if defined(dNeedsMarker)\n        float marker = uMarker;\n        if (group == -1.0) {\n            marker = 0.0;\n        } else if (uMarker == -1.0) {\n            marker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;\n            marker = floor(marker * 255.0 + 0.5); // rounding required to work on some cards on win\n        }\n    #endif\n\n    #if defined(dRenderVariant_color) || defined(dRenderVariant_tracing) || defined(dRenderVariant_emissive)\n        float emissive = uEmissive;\n        if (group == -1.0) {\n            emissive = 0.0;\n        } else {\n            #ifdef dEmissive\n                #if defined(dEmissiveType_instance)\n                    emissive += readFromTexture(tEmissive, vInstance, uEmissiveTexDim).a * uEmissiveStrength;\n                #elif defined(dEmissiveType_groupInstance)\n                    emissive += readFromTexture(tEmissive, vInstance * float(uGroupCount) + group, uEmissiveTexDim).a * uEmissiveStrength;\n                #endif\n            #endif\n        }\n    #endif\n\n    #if defined(dRenderVariant_pick)\n        if (group == -1.0) discard;\n\n        #include check_picking_alpha\n        #ifdef requiredDrawBuffers\n            gl_FragColor = vec4(packIntToRGB(float(uObjectId)), 1.0);\n            gl_FragData[1] = vec4(packIntToRGB(vInstance), 1.0);\n            gl_FragData[2] = vec4(packIntToRGB(group), 1.0);\n            gl_FragData[3] = packDepthToRGBA(fragmentDepth);\n        #else\n            gl_FragColor = vColor;\n            if (uPickType == 1) {\n                gl_FragColor = vec4(packIntToRGB(float(uObjectId)), 1.0);\n            } else if (uPickType == 2) {\n                gl_FragColor = vec4(packIntToRGB(vInstance), 1.0);\n            } else {\n                gl_FragColor = vec4(packIntToRGB(group), 1.0);\n            }\n        #endif\n    #elif defined(dRenderVariant_depth)\n        if (uRenderMask == MaskOpaque) {\n            gl_FragColor = packDepthToRGBA(fragmentDepth);\n        } else if (uRenderMask == MaskTransparent) {\n            gl_FragColor = packDepthWithAlphaToRGBA(fragmentDepth, material.a);\n        }\n    #elif defined(dRenderVariant_marking)\n        if (uMarkingType == 1) {\n            if (marker > 0.0)\n                discard;\n            gl_FragColor = packDepthToRGBA(fragmentDepth);\n        } else {\n            if (marker == 0.0)\n                discard;\n            float depthTest = 1.0;\n            if (uMarkingDepthTest) {\n                depthTest = (fragmentDepth >= getDepthPacked(gl_FragCoord.xy / uDrawingBufferSize)) ? 1.0 : 0.0;\n            }\n            bool isHighlight = intMod(marker, 2.0) > 0.1;\n            float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);\n            float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));\n            if (fogFactor == 1.0)\n                discard;\n            gl_FragColor = vec4(0.0, depthTest, isHighlight ? 1.0 : 0.0, 1.0 - fogFactor);\n        }\n    #elif defined(dRenderVariant_emissive)\n        gl_FragColor = vec4(emissive);\n    #elif defined(dRenderVariant_color) || defined(dRenderVariant_tracing)\n        #ifdef dUsePalette\n            if (material.rgb == vec3(1.0)) {\n                material.rgb = uPaletteDefault;\n            } else {\n                float v = ((material.r * 256.0 * 256.0 * 255.0 + material.g * 256.0 * 255.0 + material.b * 255.0) - 1.0) / PALETTE_SCALE;\n                material.rgb = texture2D(tPalette, vec2(v, 0.0)).rgb;\n            }\n        #endif\n\n        // mix material with overpaint\n        #if defined(dOverpaint)\n            vec4 overpaint = vec4(0.0);\n            if (group != -1.0) {\n                #if defined(dOverpaintType_instance)\n                    overpaint = readFromTexture(tOverpaint, vInstance, uOverpaintTexDim);\n                #elif defined(dOverpaintType_groupInstance)\n                    overpaint = readFromTexture(tOverpaint, vInstance * float(uGroupCount) + group, uOverpaintTexDim);\n                #endif\n                overpaint *= uOverpaintStrength;\n            }\n            material.rgb = mix(material.rgb, overpaint.rgb, overpaint.a);\n        #endif\n\n        gl_FragColor = material;\n        #include apply_marker_color\n\n        #if defined(dRenderVariant_color)\n            #include apply_fog\n            #include wboit_write\n            #include dpoit_write\n        #elif defined(dRenderVariant_tracing)\n            gl_FragData[1] = vec4(normalize(vViewPosition), emissive);\n            gl_FragData[2] = vec4(material.rgb, uDensity);\n        #endif\n    #endif\n}\n",{drawBuffers:"optional"},{},v)
function I(e,t){var n
if(void 0===e)return""
const r=(null===(n=e.dRenderVariant)||void 0===n?void 0:n.ref.value)||"",i=[]
for(const a in e){if(null==t?void 0:t(a,r,e))continue
const n=e[a].ref.value
void 0!==n&&("string"==typeof n?i.push(`#define ${a}_${n}`):"number"==typeof n?i.push(`#define ${a} ${n}`):"boolean"==typeof n?n&&i.push(`#define ${a}`):(0,o.dr)(n))}return i.join("\n")+"\n"}function P(e,t,n,r,o){const s=I(r,o.ignoreDefine),l=I(r,o.ignoreDefine),c=(0,i.C6)(e)?function(e,t){const n=["#version 300 es"]
if(t.drawBuffers&&e.drawBuffers&&n.push("#define requiredDrawBuffers"),t.multiDraw)if(e.multiDraw)n.push("#extension GL_ANGLE_multi_draw : require"),n.push("#define enabledMultiDraw")
else if("required"===t.multiDraw)throw new Error("required 'GL_ANGLE_multi_draw' extension not available")
if(t.clipCullDistance)if(e.clipCullDistance)n.push("#extension GL_ANGLE_clip_cull_distance : enable"),n.push("#define enabledClipCullDistance")
else if("required"===t.clipCullDistance)throw new Error("required 'GL_ANGLE_clip_cull_distance' extension not available")
if(t.conservativeDepth)if(e.conservativeDepth)n.push("#extension GL_EXT_conservative_depth : enable"),n.push("#define enabledConservativeDepth")
else if("required"===t.conservativeDepth)throw new Error("required 'GL_EXT_conservative_depth' extension not available")
if(t.multiview2)if(e.multiview2)n.push("#extension GL_OVR_multiview2 : require"),n.push("#define enabledMultiview2")
else if("required"===t.multiview2)throw new Error("required 'GL_OVR_multiview2' extension not available")
return e.noNonInstancedActiveAttribs&&n.push("#define noNonInstancedActiveAttribs"),n.push("\n#define attribute in\n#define varying out\n#define texture2D texture\n"),n.join("\n")+"\n"}(t,o.extensions):function(e,t){const n=[]
if(t.drawBuffers)if(e.drawBuffers)n.push("#define requiredDrawBuffers")
else if("required"===t.drawBuffers)throw new Error("required 'GL_EXT_draw_buffers' extension not available")
if(t.multiDraw)if(e.multiDraw)n.push("#extension GL_ANGLE_multi_draw : require"),n.push("#define enabledMultiDraw")
else if("required"===t.multiDraw)throw new Error("required 'GL_ANGLE_multi_draw' extension not available")
return n.join("\n")+"\n"}(t,o.extensions),u=(0,i.C6)(e)?function(e,t,n,r){const i=["#version 300 es",`layout(location = 0) out highp ${r[0]||"vec4"} out_FragData0;`]
if(n.fragDepth&&e.fragDepth&&i.push("#define enabledFragDepth"),n.drawBuffers&&e.drawBuffers){i.push("#define requiredDrawBuffers")
for(let e=1,n=t.maxDrawBuffers;e<n;++e)i.push(`layout(location = ${e}) out highp ${r[e]||"vec4"} out_FragData${e};`)}return n.shaderTextureLod&&e.shaderTextureLod&&i.push("#define enabledShaderTextureLod"),e.depthTexture&&i.push("#define depthTextureSupport"),i.push("\n#define varying in\n#define texture2D texture\n#define textureCube texture\n#define texture2DLodEXT textureLod\n#define textureCubeLodEXT textureLod\n\n#define gl_FragColor out_FragData0\n#define gl_FragDepthEXT gl_FragDepth\n"),i.join("\n")+"\n"}(t,n,o.extensions,o.outTypes):function(e,t){const n=["#extension GL_OES_standard_derivatives : enable"]
if(t.fragDepth)if(e.fragDepth)n.push("#extension GL_EXT_frag_depth : enable"),n.push("#define enabledFragDepth")
else if("required"===t.fragDepth)throw new Error("required 'GL_EXT_frag_depth' extension not available")
if(t.drawBuffers)if(e.drawBuffers)n.push("#extension GL_EXT_draw_buffers : require"),n.push("#define requiredDrawBuffers"),n.push("#define gl_FragColor gl_FragData[0]")
else if("required"===t.drawBuffers)throw new Error("required 'GL_EXT_draw_buffers' extension not available")
if(t.shaderTextureLod)if(e.shaderTextureLod)n.push("#extension GL_EXT_shader_texture_lod : enable"),n.push("#define enabledShaderTextureLod")
else if("required"===t.shaderTextureLod)throw new Error("required 'GL_EXT_shader_texture_lod' extension not available")
return e.depthTexture&&n.push("#define depthTextureSupport"),n.join("\n")+"\n"}(t,o.extensions),d=(0,i.C6)(e)?function(e){return e.replace(/gl_FragData\[([0-9]+)\]/g,"out_FragData$1")}(o.frag):o.frag
return{id:a(),name:o.name,vert:`${c}${s}${m(o.vert,r)}`,frag:`${u}${l}${m(d,r)}`,extensions:o.extensions,outTypes:o.outTypes}}},95921(e,t,n){"use strict"
n.d(t,{N:()=>a,e:()=>s})
var r=n(95538),i=n(17487),o=n(63356)
class a{constructor(){this.subs=void 0}subscribe(e,t){if(!e)return{unsubscribe:()=>{}}
void 0===this.subs&&(this.subs=[])
let n=e.subscribe(t)
return this.subs.push(n),{unsubscribe:()=>{n&&this.subs&&(0,o.K3)(this.subs,n)&&(n.unsubscribe(),n=void 0)}}}get ev(){return this._ev||(this._ev=i.V.create())}dispose(){if(this._ev&&this._ev.dispose(),this.subs){for(const e of this.subs)e.unsubscribe()
this.subs=void 0}}}class s extends a{updateState(...e){const t=this.state,n=(0,r.Wv)(t,e)
return n!==t&&(this._state=n,!0)}get state(){return this._state}constructor(e){super(),this._state=e}}},96005(e,t,n){"use strict"
n.d(t,{y9:()=>w,Hb:()=>C,Jz:()=>T,GH:()=>A})
var r=n(32775),i=n(83794),o=n(40165)
const a={radiusTop:1,radiusBottom:1,height:1,radialSegments:8,heightSegments:1,topCap:!1,bottomCap:!1,thetaStart:0,thetaLength:2*Math.PI}
var s=n(64361),l=n(1654),c=n(70012)
const u=new Map,d=r.eB.create(0,1,0),p=(0,r.eB)(),h=(0,r.eB)(),f=(0,r.eB)(),m=(0,r.$I)(),g=(0,r.$I)(),y=(0,r.eB)(),v=(0,r.eB)(),b=(0,r.eB)()
function x(e,t,n,i,o){return r.eB.setMagnitude(h,n,i/2),r.eB.add(f,t,h),o?r.eB.matchDirection(b,d,h):r.eB.copy(b,d),r.eB.set(y,1,i,1),r.eB.makeRotation(g,b,h),r.$I.scale(e,g,y),r.$I.setTranslation(e,f)}const S=new Int32Array(9)
function _(e){const t=function(e){var t,n,r,i,o,s,l,u,d
return S[0]=Math.round(1e3*(null!==(t=e.radiusTop)&&void 0!==t?t:a.radiusTop)),S[1]=Math.round(1e3*(null!==(n=e.radiusBottom)&&void 0!==n?n:a.radiusBottom)),S[2]=Math.round(1e3*(null!==(r=e.height)&&void 0!==r?r:a.height)),S[3]=null!==(i=e.radialSegments)&&void 0!==i?i:a.radialSegments,S[4]=null!==(o=e.heightSegments)&&void 0!==o?o:a.heightSegments,S[5]=(null!==(s=e.topCap)&&void 0!==s?s:a.topCap)?1:0,S[6]=(null!==(l=e.bottomCap)&&void 0!==l?l:a.bottomCap)?1:0,S[7]=Math.round(1e3*(null!==(u=e.thetaStart)&&void 0!==u?u:a.thetaStart)),S[8]=Math.round(1e3*(null!==(d=e.thetaLength)&&void 0!==d?d:a.thetaLength)),(0,c.TI)(S)}(e)
let n=u.get(t)
if(void 0===n){if(e.radialSegments&&e.radialSegments<=4){const t=Math.max(3,e.radialSegments),i=(0,s.My)((0,l.n)(t,!0,e.radiusTop),e)
n=(0,o._2)(i,r.$I.rotX90)}else n=function(e){const{radiusTop:t,radiusBottom:n,height:i,radialSegments:o,heightSegments:s,topCap:l,bottomCap:c,thetaStart:u,thetaLength:d}={...a,...e},p=[],h=[],f=[]
let m=0
const g=[],y=i/2
return function(){const e=r.eB.zero(),a=(n-t)/i
for(let l=0;l<=s;++l){const c=[],p=l/s,v=p*(n-t)+t
for(let t=0;t<=o;++t){const n=t/o*d+u,s=Math.sin(n),l=Math.cos(n)
h.push(v*s,-p*i+y,v*l),r.eB.normalize(e,r.eB.set(e,s,a,l)),f.push(...e),c.push(m++)}g.push(c)}for(let t=0;t<o;++t)for(let e=0;e<s;++e){const n=g[e][t],r=g[e+1][t],i=g[e+1][t+1],o=g[e][t+1]
p.push(n,r,o),p.push(r,i,o)}}(),l&&t>0&&v(!0),c&&n>0&&v(!1),{vertices:new Float32Array(h),normals:new Float32Array(f),indices:new Uint32Array(p)}
function v(e){const r=!0===e?t:n,i=!0===e?1:-1,a=m
for(let t=1;t<=o;++t)h.push(0,y*i,0),f.push(0,i,0),++m
const s=m
for(let t=0;t<=o;++t){const e=t/o*d+u,n=Math.cos(e),a=Math.sin(e)
h.push(r*a,y*i,r*n),f.push(0,i,0),++m}for(let t=0;t<o;++t){const n=a+t,r=s+t
!0===e?p.push(r,r+1,n):p.push(r+1,r,n)}}}(e)
u.set(t,n)}return n}function C(e,t,n,r){x(m,t.origin,t.direction,n,!1),i.P.addPrimitive(e,m,_(r))}function w(e,t,n,o,a){const s=r.eB.distance(t,n)*o
r.eB.sub(p,n,t),x(m,t,p,s,!0),i.P.addPrimitive(e,m,_(a))}function T(e,t,n,o,a,s){const l=r.eB.distance(t,n)*o,c=_(s)
r.eB.sub(p,n,t),r.eB.add(v,t,a),x(m,v,p,l,!0),i.P.addPrimitive(e,m,c),r.eB.sub(v,t,a),x(m,v,p,l,!0),i.P.addPrimitive(e,m,c)}function A(e,t,n,o,a,s,l){const c=r.eB.distance(t,n)*o,u=a%2!=0,d=Math.floor((a+1)/2)
let h=c/(a+.5),f=_(l)
r.eB.setMagnitude(p,r.eB.sub(p,n,t),h),r.eB.copy(v,t)
for(let g=0;g<d;++g)r.eB.add(v,v,p),u&&g===d-1&&(!s&&l.topCap&&(l.topCap=!1,f=_(l)),h/=2),x(m,v,p,h,!1),i.P.addPrimitive(e,m,f),r.eB.add(v,v,p)}},96156(e,t,n){"use strict"
n.d(t,{u:()=>r.u})
var r=n(70331)
n(68281)},96174(e,t,n){"use strict"
n.d(t,{kk:()=>a,ru:()=>o})
var r=n(92384)
const i={value:r.t.Numeric(1,{min:0,max:20,step:.1})}
function o(e,t){const n=t.value
return{factory:o,granularity:"uniform",size:()=>n,props:t,description:"Gives everything the same, uniform size."}}const a={name:"uniform",label:"Uniform",category:"",factory:o,getParams:function(e){return i},defaultValues:r.t.getDefaultValues(i),isApplicable:e=>!0}},96458(e,t,n){"use strict"
n.d(t,{h:()=>d})
var r=n(70012),i=n(47404),o=n(32775)
const a=(0,o.eB)(),s=(0,o.eB)(),l=(0,o.eB)(),c=r.Gm.add,u=r.Gm.add3
var d
!function(e){e.create=function(e=2048,t=1024,n){const d=r.Gm.create(Float32Array,1,t,n?n.groupBuffer.ref.value:e),p=r.Gm.create(Float32Array,3,t,n?n.startBuffer.ref.value:e),h=r.Gm.create(Float32Array,3,t,n?n.endBuffer.ref.value:e),f=r.Gm.create(Float32Array,1,t,n?n.scaleBuffer.ref.value:e),m=r.Gm.create(Float32Array,1,t,n?n.capBuffer.ref.value:e),g=r.Gm.create(Float32Array,1,t,n?n.colorModeBuffer.ref.value:e),y=(e,t,n,r,i,o,a,s,l,y,v)=>{for(let b=0;b<6;++b)u(p,e,t,n),u(h,r,i,o),c(d,v),c(f,a),c(m,(s?1:0)+(l?2:0)),c(g,y)},v=(e,t,n,r,i,c,u,d,p)=>{const h=o.eB.distance(e,t),f=n%2!=0,m=Math.floor((n+1)/2),g=h/(n+.5)
let v=2
o.eB.setMagnitude(l,o.eB.sub(l,t,e),g),o.eB.copy(a,e)
for(let b=0;b<m;++b)o.eB.add(a,a,l),f&&b===m-1?(o.eB.copy(s,t),u||(c=!1)):o.eB.add(s,a,l),d&&(v=o.eB.distance(e,s)/(2*h)),y(a[0],a[1],a[2],s[0],s[1],s[2],r,i,c,v,p),o.eB.add(a,a,l)}
return{add:y,addFixedCountDashes:v,addFixedLengthDashes:(e,t,n,r,i,a,s,l)=>{const c=o.eB.distance(e,t)
v(e,t,c/n,r,i,a,!0,s,l)},getCylinders:()=>{const e=d.elementCount/6,t=r.Gm.compact(d,!0),o=r.Gm.compact(p,!0),a=r.Gm.compact(h,!0),s=r.Gm.compact(f,!0),l=r.Gm.compact(m,!0),c=r.Gm.compact(g,!0),u=n&&e<=n.cylinderCount?n.mappingBuffer.ref.value:new Float32Array(18*e),y=n&&e<=n.cylinderCount?n.indexBuffer.ref.value:new Uint32Array(12*e)
return(!n||e>n.cylinderCount)&&function(e,t,n){for(let r=0;r<e;++r){const e=18*r
t[e]=-1,t[e+1]=1,t[e+2]=-1,t[e+3]=-1,t[e+4]=-1,t[e+5]=-1,t[e+6]=1,t[e+7]=1,t[e+8]=-1,t[e+9]=1,t[e+10]=1,t[e+11]=1,t[e+12]=1,t[e+13]=-1,t[e+14]=-1,t[e+15]=1,t[e+16]=-1,t[e+17]=1}for(let r=0;r<e;++r){const e=6*r,t=12*r
n[t]=e,n[t+1]=e+1,n[t+2]=e+2,n[t+3]=e+1,n[t+4]=e+4,n[t+5]=e+2,n[t+6]=e+2,n[t+7]=e+4,n[t+8]=e+3,n[t+9]=e+4,n[t+10]=e+5,n[t+11]=e+3}}(e,u,y),i.S.create(u,y,t,o,a,s,l,c,e,n)}}}}(d||(d={}))},96561(e,t,n){"use strict"
n.d(t,{S:()=>x,U:()=>v})
var r=n(85032),i=n(92384),o=n(47546),a=n(48866),s=n(95538),l=n(9043),c=n(50709)
const u={hue:i.t.Interval([1,360],{min:0,max:360,step:1}),chroma:i.t.Interval([40,70],{min:0,max:100,step:1}),luminance:i.t.Interval([15,85],{min:0,max:100,step:1}),sort:i.t.Select("contrast",i.t.arrayToOptions(["none","contrast"]),{description:"no sorting leaves colors approximately ordered by hue"}),clusteringStepCount:i.t.Numeric(50,{min:10,max:200,step:1},{isHidden:!0}),minSampleCount:i.t.Numeric(800,{min:100,max:5e3,step:100},{isHidden:!0}),sampleCountFactor:i.t.Numeric(5,{min:1,max:100,step:1},{isHidden:!0})},d=[0,0,0],p=[0,0,0]
function h(e,t){return o.E.toHcl(d,e),o.E.fromColor(p,o.E.toColor(e)),d[0]>=t.hue[0]&&d[0]<=t.hue[1]&&d[1]>=t.chroma[0]&&d[1]<=t.chroma[1]&&d[2]>=t.luminance[0]&&d[2]<=t.luminance[1]&&p[0]>=e[0]-2&&p[0]<=e[0]+2&&p[1]>=e[1]-2&&p[1]<=e[1]+2&&p[2]>=e[2]-2&&p[2]<=e[2]+2}function f(e,t){let n=1/0,r=0
for(let i=0;i<e.length;i++){const a=o.E.distance(t,e[i])
a<n&&(n=a,r=i)}return r}var m=n(1712),g=n(53123)
const y={type:"generate",colorList:"red-yellow-blue"}
function v(e={}){const t={...y,...e}
return{palette:i.t.MappedStatic(t.type,{colors:i.t.Group({list:i.t.ColorList(t.colorList)},{isFlat:!0}),generate:i.t.Group({...u,maxCount:i.t.Numeric(75,{min:1,max:250,step:1})},{isFlat:!0})},{options:[["colors","Color List"],["generate","Generate Distinct"]]})}}i.t.getDefaultValues(v())
const b={valueLabel:e=>`${e+1}`,minLabel:"Start",maxLabel:"End"}
function x(e,t,n={}){var d
let p,v
if("colors"===t.palette.name&&"interpolate"===t.palette.params.list.kind){const{list:r}=t.palette.params,i=[0,e-1],{minLabel:o,maxLabel:a}={...b,...n}
let s=r.colors
0===s.length&&(s=(0,m.JA)(y.colorList).list)
const l=g.w.create({listOrName:s,domain:i,minLabel:o,maxLabel:a})
v=l.legend,p=l.color}else{let g
"colors"===t.palette.name?(g=t.palette.params.list.colors.map(e=>Array.isArray(e)?e[0]:e),0===g.length&&(g=(0,m.JA)("dark-2").list.map(e=>Array.isArray(e)?e[0]:e))):(e=Math.min(e,t.palette.params.maxCount),g=function(e,t={}){const n={...i.t.getDefaultValues(u),...t}
if(e<=0)return[]
const r=function(e,t){const n=new Map,r=Math.ceil(Math.cbrt(e)),i=(0,a.G)(),s=Math.max((t.hue[1]-t.hue[0])/r,1),l=Math.max((t.chroma[1]-t.chroma[0])/r,1),c=Math.max((t.luminance[1]-t.luminance[0])/r,1)
for(let u=t.hue[0]+s/2;u<=t.hue[1];u+=s)for(let e=t.chroma[0]+l/2;e<=t.chroma[1];e+=l)for(let r=t.luminance[0]+c/2;r<=t.luminance[1];r+=c){const s=o.E.fromHcl((0,o.E)(),a.G.set(i,u,e,r))
h(s,t)&&n.set(o.E.toColor(s),s)}return Array.from(n.values())}(Math.max(n.minSampleCount,e*n.sampleCountFactor),n)
if(r.length<e)return console.warn("Not enough samples to generate distinct colors, increase sample count."),new Array(e).fill(c.ColorNames.lightgrey)
const d=[],p=[],m=Math.floor(r.length/e)
for(let i=0;i<r.length&&(d.push(r[i]),p.push([]),!(d.length>=e));i+=m);for(let i=1;i<=n.clusteringStepCount;++i){const e=(0,s.Go)(p),t=(0,s.Go)(r)
for(let i=0;i<d.length;++i){const n=f(t,d[i])
e[i].push(r[n]),t.splice(n,1)}for(let i=0;i<t.length;++i)e[f(d,r[i])].push(r[i])
const n=(0,s.Go)(d)
for(let r=0;r<e.length;++r){const t=e[r],n=t.length
if(0===n)continue
let i=0,o=0,a=0
for(const e of t)i+=e[0],o+=e[1],a+=e[2]
const s=i/n,l=o/n,c=a/n
d[r]=[s,l,c]}if((0,l.bD)(n,d))break}const g="contrast"===n.sort?function(e){const t=e.slice(0),n=[t.shift()]
for(;t.length>0;){const e=n[n.length-1]
let r=0,i=Number.NEGATIVE_INFINITY
for(let n=0;n<t.length;++n){const a=o.E.distance(e,t[n])
a>i&&(i=a,r=n)}n.push(t.splice(r,1)[0])}return n}(d):d
return g.map(e=>o.E.toColor(e))}(e,t.palette.params))
const y=null!==(d=n.valueLabel)&&void 0!==d?d:b.valueLabel,x=g.length,S=[]
for(let t=0;t<e;++t){const e=t%x
void 0===S[e]?S[e]=[y(t),g[e]]:S[e][0]+=`, ${y(t)}`}v=(0,r.h)(S),p=e=>g[e%x]}return{color:p,legend:v}}},96883(e,t,n){"use strict"
n.d(t,{E7:()=>a,Yb:()=>l,do:()=>o,k5:()=>s})
var r=n(24762),i=n(97016)
function o(e){return function(t){return a(e,t)}}function a(e,t){const{data:n,indices:o,count:a}=e,{valueType:l}=t,c="str"===l?e=>n.substring(o[2*e],o[2*e+1]):"int"===l?e=>(0,i.H9)(n,o[2*e],o[2*e+1])||0:e=>(0,i.sS)(n,o[2*e],o[2*e+1])||0
return{schema:t,__array:void 0,isDefined:!0,rowCount:a,value:c,valueKind:e=>r.VP.ValueKinds.Present,toArray:e=>r.iu.createAndFillArray(a,c,e),areValuesEqual:s(e)}}function s(e){const{data:t,indices:n}=e
return function(e,r){const i=n[2*e],o=n[2*r],a=n[2*e+1]-i
if(a!==n[2*r+1]-o)return!1
for(let n=0;n<a;n++)if(t.charCodeAt(n+i)!==t.charCodeAt(n+o))return!1
return!0}}function l(e){const{count:t,indices:n}=e
for(let r=0;r<t;++r)if(n[2*r]!==n[2*r+1])return!1
return!0}},97016(e,t,n){"use strict"
function r(e,t,n){for(;t<n&&32===e.charCodeAt(t);)t++
return i(e,t,n)}function i(e,t,n){let r=t,i=0,o=1
for(45===e.charCodeAt(r)?(o=-1,++r):43===e.charCodeAt(r)&&++r;r<n;r++){const t=e.charCodeAt(r)-48
if(t>9||t<0)return o*i|0
i=10*i+t|0}return o*i}function o(e,t,n,r){return 43===t.charCodeAt(n)&&n++,e*Math.pow(10,i(t,n,r))}function a(e,t,n){for(;t<n&&32===e.charCodeAt(t);)t++
return s(e,t,n)}function s(e,t,n){let r=t,i=1,a=0,s=0,l=1
for(45===e.charCodeAt(r)?(i=-1,++r):43===e.charCodeAt(r)&&++r;r<n;){let t=e.charCodeAt(r)-48
if(!(t>=0&&t<10)){if(-2===t){for(++r;r<n;){if(t=e.charCodeAt(r)-48,!(t>=0&&t<10))return 53===t||21===t?o(i*(a+s/l),e,r+1,n):i*(a+s/l)
s=10*s+t,l*=10,++r}return i*(a+s/l)}if(53===t||21===t)return o(i*a,e,r+1,n)
break}a=10*a+t,++r}return i*a}var l
function c(e,t,n){return 43===e.charCodeAt(t)&&t++,function(e,t,n){for(45===e.charCodeAt(t)&&t++;t<n;t++){const n=e.charCodeAt(t)-48
if(n>9||n<0)return!1}return!0}(e,t,n)?l.Scientific:l.NaN}function u(e){let t=0
const n=e.length
if(45===e.charCodeAt(t)&&++t,46===e.charCodeAt(t)&&n-t===1)return l.NaN
for(;t<n;){let r=e.charCodeAt(t)-48
if(!(r>=0&&r<10)){if(-2===r){++t
let i=!1
for(;t<n;){if(r=e.charCodeAt(t)-48,!(r>=0&&r<10))return 53===r||21===r?c(e,t+1,n):l.NaN
i=!0,++t}return i?l.Float:l.Int}if(53===r||21===r)return 0===t||1===t&&45===e.charCodeAt(0)?l.NaN:c(e,t+1,n)
break}++t}return t===n?l.Int:l.NaN}n.d(t,{Al:()=>a,H9:()=>i,bt:()=>l,jj:()=>r,o_:()=>u,sS:()=>s}),function(e){e[e.Int=0]="Int",e[e.Float=1]="Float",e[e.Scientific=2]="Scientific",e[e.NaN=3]="NaN"}(l||(l={})),l.Int,l.Float,l.Scientific,l.NaN},97270(e,t,n){"use strict"
n.d(t,{y:()=>i})
var r=n(18891)
function i(e){return(0,r.T)(null==e?void 0:e.then)}},97564(e,t,n){"use strict"
function r(e,t,n){return(e-t)/(n-t)}function i(e,t,n){return Math.max(t,Math.min(n,e))}function o(e,t,n){return e+(t-e)*n}function a(e,t,n,r,i,o){const a=(n-e)*o,s=(r-t)*o,l=i*i
return(2*t-2*n+a+s)*(i*l)+(-3*t+3*n-2*a-s)*l+a*i+t}function s(e,t,n,r){const i=1-r
return i*i*e+2*i*r*t+r*r*n}function l(e,t,n){return(n=i(r(n,e,t),0,1))*n*(3-2*n)}n.d(t,{Cc:()=>o,S8:()=>r,TF:()=>l,Y7:()=>a,iD:()=>s,qE:()=>i})},97573(e,t,n){"use strict"
function r(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(t){const r=document.createEvent("MouseEvents")
r.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(r)}}function i(e,t="download"){if(e)if("download"in HTMLAnchorElement.prototype){const n=document.createElement("a")
n.download=t,n.rel="noopener","string"==typeof e?(n.href=e,r(n)):(n.href=URL.createObjectURL(e),setTimeout(()=>URL.revokeObjectURL(n.href),4e4),setTimeout(()=>r(n)))}else if("undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(e,t)
else{const t=window.navigator.userAgent,n=/Safari/i.test(t),r=/CriOS\/[\d]+/.test(t),i=e=>{var t
t=r?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),window.open(t,"_blank")||(window.location.href=t)}
if((n||r)&&FileReader)if(e instanceof Blob){const t=new FileReader
t.onloadend=()=>i(t.result),t.readAsDataURL(e)}else i(e)
else{const t=URL.createObjectURL("string"==typeof e?new Blob([e]):e)
location.href=t,setTimeout(()=>URL.revokeObjectURL(t),4e4)}}}n.d(t,{R:()=>i})},97895(e,t,n){"use strict"
n.r(t),n.d(t,{default:()=>c,random:()=>l})
var r=n(81389),i=n(10336)
const{min:o,max:a}=Math,s={decimals:0}
function l(e,{decimals:t}=s){if("object"==typeof e&&!(0,r.isArray)(e))return t=void 0!==e.decimals?e.decimals:s.decimals,+Math.random().toFixed(a(0,o(20,t)))
if(e&&1===e.length){const[n]=e
if("number"==typeof n)return+(Math.random()*n).toFixed(a(0,o(20,t??0)))}if(e&&2===e.length){let[n,r]=e
if("number"==typeof r&&"number"==typeof n)return r<n&&([n,r]=[r,n]),+(n+Math.random()*(r-n)).toFixed(a(0,o(20,t??0)))}return+Math.random().toFixed(a(0,o(20,t??0)))}var c=(0,i.helper)(l)},97960(e,t,n){"use strict"
n.d(t,{N:()=>I})
var r=n(69045),i=n(94050),o=n(14294),a=n(28626),s=n(87933),l=n(9043),c=n(9014),u=n(67538),d=n(70012),p=n(48393),h=n(10773),f=n(87095),m=n(76242),g=n(32775)
const y=(0,g.eB)()
function v(e){const t=function(e){const{elements:t,conformation:n}=e,r=new Float32Array(3*t.length)
for(let i=0,o=t.length;i<o;i++)n.invariantPosition(t[i],y),g.eB.toArray(y,r,3*i)
return r}(e)
return m.c.ofPositions(t)}var b=n(93036),x=n(64367)
class S{constructor(){this.data=new Map}get(e){const t=u.X9.hashCode(e)
if(this.data.has(t))for(const[n,r]of this.data.get(t))if(u.X9.areEqual(e,n))return r}set(e,t){const n=u.X9.hashCode(e)
if(this.data.has(n)){const r=this.data.get(n)
for(const n of r)if(u.X9.areEqual(e,n[0]))return void(n[1]=t)
r.push([e,t])}else this.data.set(n,[[e,t]])}static get(e){return e._dynamicPropertyData.ElementSetIntraBondCache||(e._dynamicPropertyData.ElementSetIntraBondCache=new S),e._dynamicPropertyData.ElementSetIntraBondCache}}var _=n(10212),C=n(52349)
const w={delocalizedTriplets:{getThirdElement:()=>{},getTripletIndices:()=>{},triplets:[]}}
function T(e){return I.Traits.is(e.traits,I.Trait.Water)||I.Traits.is(e.traits,I.Trait.CoarseGrained)?w:{delocalizedTriplets:A(e)}}function A(e){const t=e.bonds,{b:n,edgeProps:r,offset:i}=t,{order:o,flags:a}=r,{elementAromaticRingIndices:s}=e.rings,l=[],c=new Map,u=new Map,p=(e,t,n)=>{const r=l.length
l.push(C.X.ofUnsortedArray([e,t,n])),c.set((0,d.bd)(e,t),n),u.has(e)?u.get(e).push(r):u.set(e,[r])}
for(let d=0;d<e.elements.length;d++){if(s.has(d))continue
if(i[d+1]-i[d]+1<2)continue
const e=[]
for(let t=i[d],r=i[d+1];t<r;t++){const r=a[t]
f.BondType.is(r,f.BondType.Flag.Aromatic)&&e.push(n[t])}if(e.length>=2){p(d,e[0],e[1])
for(let t=1,n=e.length;t<n;t++)p(d,e[t],e[0])}}return{getThirdElement:(e,t)=>c.get((0,d.bd)(e,t)),getTripletIndices:e=>u.get(e),triplets:l}}var I
!function(e){let t,n,m,y
function C(e){const t=[]
for(let n=0,r=e.length;n<r;n++)t.push(e[n].id)
return(0,d.TI)(t)}function w(e){const t={}
return{elements:e[0].elements,units:e,get unitIndexMap(){return t.unitIndexMap||(t.unitIndexMap=function(e){const t=u.Yz.Mutable()
for(let n=0,r=e.length;n<r;n++)t.set(e[n].id,n)
return t}(e)),t.unitIndexMap},hashCode:A(e[0]),transformHash:C(e)}}function A(e){return(0,d.vb)(e.invariantId,u.X9.hashCode(e.elements))}function I(e){const t=e.atomicHierarchy.atoms.type_symbol.value
return e=>(0,s.sO)(t(e))}function P(e){const t=e.coarseConformation.spheres.radius
return e=>t[e]}!function(e){e[e.Atomic=0]="Atomic",e[e.Spheres=1]="Spheres",e[e.Gaussians=2]="Gaussians"}(t=e.Kind||(e.Kind={})),function(e){e[e.Atomic=0]="Atomic",e[e.Spheres=1]="Spheres",e[e.Gaussians=2]="Gaussians"}(n=e.Kinds||(e.Kinds={})),e.isAtomic=function(e){return e.kind===t.Atomic},e.isCoarse=function(e){return e.kind===t.Spheres||e.kind===t.Gaussians},e.isSpheres=function(e){return e.kind===t.Spheres},e.isGaussians=function(e){return e.kind===t.Gaussians},e.create=function(e,n,i,o,a,s,l,c,u){switch(a){case t.Atomic:return new B(e,n,i,o,s,c,r.J.createMapping(l,s.atomicConformation,I(s)),null!=u?u:{})
case t.Spheres:return D(e,n,i,o,s,t.Spheres,c,r.J.createMapping(l,s.coarseConformation.spheres,P(s)),null!=u?u:{})
case t.Gaussians:return D(e,n,i,o,s,t.Gaussians,c,r.J.createMapping(l,s.coarseConformation.gaussians,e=>0),null!=u?u:{})}},e.SymmetryGroup=w,function(e){e.areInvariantElementsEqual=function(e,t){return e.hashCode===t.hashCode&&u.X9.areEqual(e.elements,t.elements)},e.getUnitSymmetryGroupsIndexMap=function(e){const t=u.Yz.Mutable()
for(let n=0,r=e.length;n<r;++n){const r=e[n]
for(let e=0,i=r.units.length;e<i;++e)t.set(r.units[e].id,n)}return t}}(w=e.SymmetryGroup||(e.SymmetryGroup={})),e.conformationId=function(t){return e.isAtomic(t)?t.model.atomicConformation.id:t.model.coarseConformation.id},e.hashUnit=A,function(e){e[e.None=0]="None",e[e.MultiChain=1]="MultiChain",e[e.Partitioned=2]="Partitioned",e[e.FastBoundary=4]="FastBoundary",e[e.Water=8]="Water",e[e.CoarseGrained=16]="CoarseGrained"}(m=e.Trait||(e.Trait={})),function(e){e.is=l.NJ.has,e.create=l.NJ.create}(y=e.Traits||(e.Traits={}))
class B{get transientCache(){return void 0===this._transientCache&&(this._transientCache=new Map),this._transientCache}getChild(e){return e.length===this.elements.length?this:new B(this.id,this.invariantId,this.chainGroupId,this.traits,this.model,e,this.conformation,{})}getCopy(e,t,n,r){const i=new B(e,t,n,this.traits,this.model,this.elements,this.conformation,this.props)
return(null==r?void 0:r.propagateTransientCache)&&(i._transientCache=this._transientCache),i}applyOperator(e,t,n=!1){const i=n?t:r.J.compose(this.conformation.operator,t)
return new B(e,this.invariantId,this.chainGroupId,this.traits,this.model,this.elements,r.J.createMapping(i,this.model.atomicConformation,this.conformation.r),this.props)}remapModel(t,n,a){var s,l
a||(a={...this.props,bonds:n&&!(null===(l=null===(s=this.props.bonds)||void 0===s?void 0:s.props)||void 0===l?void 0:l.canRemap)?void 0:M(this,this.props.bonds,t,n)},e.isSameConformation(this,t)||(a.boundary=void 0,a.lookup3d=void 0,a.principalAxes=void 0))
let c=this.conformation.operator
const u=_.i.Provider.get(t)
if(-1!==c.spgrOp&&u&&u!==_.i.Provider.get(this.model)){const[e,n,r]=c.hkl,{toFractional:a}=u.spacegroup.cell,s=g.eB.transformMat4((0,g.eB)(),i.Kx.getCenter(t),a)
c=o.is.getSymmetryOperatorRef(u.spacegroup,c.spgrOp,e,n,r,s)}const d=this.model.atomicConformation!==t.atomicConformation||c!==this.conformation.operator?r.J.createMapping(c,t.atomicConformation,I(t)):this.conformation
return new B(this.id,this.invariantId,this.chainGroupId,this.traits,t,this.elements,d,a)}get boundary(){if(this.props.boundary)return this.props.boundary
const{x:e,y:t,z:n}=this.model.atomicConformation,r=i.Kx.getAtomicRadii(this.model)
return this.props.boundary=y.is(this.traits,m.FastBoundary)?(0,b.b)({x:e,y:t,z:n,radius:r,indices:this.elements}):(0,b.r)({x:e,y:t,z:n,radius:r,indices:this.elements}),this.props.boundary}get lookup3d(){if(this.props.lookup3d)return this.props.lookup3d
const{x:e,y:t,z:n}=this.model.atomicConformation
return this.props.lookup3d=(0,o.Eh)({x:e,y:t,z:n,indices:this.elements},this.boundary),this.props.lookup3d}get principalAxes(){return this.props.principalAxes||(this.props.principalAxes=v(this)),this.props.principalAxes}get bonds(){var e
if(this.props.bonds)return this.props.bonds
const t=S.get(this.model)
let n=t.get(this.elements)
return n||(n=(0,a.MQ)(this),(null===(e=n.props)||void 0===e?void 0:e.cacheable)&&t.set(this.elements,n)),this.props.bonds=n,this.props.bonds}get rings(){return this.props.rings||(this.props.rings=c.g.create(this)),this.props.rings}get resonance(){return this.props.resonance||(this.props.resonance=T(this)),this.props.resonance}get polymerElements(){return this.props.polymerElements||(this.props.polymerElements=function(e){const t=[],{elements:n,model:r}=e,{residueAtomSegments:i}=e.model.atomicHierarchy,{traceElementIndex:o}=r.atomicHierarchy.derived.residue,a=h.m.transientSegments(e.model.atomicRanges.polymerRanges,n),s=u.hT.transientSegments(i,n)
for(;a.hasNext;){const e=a.move()
for(s.setSegment(e);s.hasNext;){const e=s.move(),{start:r,end:a,index:l}=e
if(u.CD.areIntersecting(u.IX.ofRange(n[r],n[a-1]),n)){const e=o[l]
t.push(-1===e?i.offsets[l]:e)}}}return u.X9.ofSortedArray(t)}(this)),this.props.polymerElements}get gapElements(){return this.props.gapElements||(this.props.gapElements=function(e){const t=[],{elements:n,model:r,residueIndex:i}=e,{residueAtomSegments:o}=e.model.atomicHierarchy,{traceElementIndex:a}=r.atomicHierarchy.derived.residue,s=h.m.transientSegments(e.model.atomicRanges.gapRanges,e.elements)
for(;s.hasNext;){const e=s.move(),r=i[n[e.start]],l=i[n[e.end-1]],c=a[r],u=a[l]
t.push(-1===c?o.offsets[r]:c),t.push(-1===u?o.offsets[l]:u)}return u.X9.ofSortedArray(t)}(this)),this.props.gapElements}get nucleotideElements(){return this.props.nucleotideElements||(this.props.nucleotideElements=function(e){const t=[],{elements:n,model:r}=e,{chainAtomSegments:i,residueAtomSegments:o}=r.atomicHierarchy,{moleculeType:a,traceElementIndex:s}=r.atomicHierarchy.derived.residue,l=u.hT.transientSegments(i,n),c=u.hT.transientSegments(o,n)
for(;l.hasNext;)for(c.setSegment(l.move());c.hasNext;){const{index:e}=c.move()
if((0,f.isNucleic)(a[e])){const n=s[e]
t.push(-1===n?o.offsets[e]:n)}}return u.X9.ofSortedArray(t)}(this)),this.props.nucleotideElements}get proteinElements(){return this.props.proteinElements||(this.props.proteinElements=function(e){const t=[],{elements:n,model:r}=e,{chainAtomSegments:i,residueAtomSegments:o}=r.atomicHierarchy,{moleculeType:a,traceElementIndex:s}=r.atomicHierarchy.derived.residue,l=u.hT.transientSegments(i,n),c=u.hT.transientSegments(o,n)
for(;l.hasNext;)for(c.setSegment(l.move());c.hasNext;){const{index:e}=c.move()
if((0,f.isProtein)(a[e])){const n=s[e]
t.push(-1===n?o.offsets[e]:n)}}return u.X9.ofSortedArray(t)}(this)),this.props.proteinElements}get residueCount(){if(void 0!==this.props.residueCount)return this.props.residueCount
let e=0
const t=u.hT.transientSegments(this.model.atomicHierarchy.residueAtomSegments,this.elements)
for(;t.hasNext;)t.move(),e+=1
return this.props.residueCount=e,this.props.residueCount}getResidueIndex(e){return this.residueIndex[this.elements[e]]}constructor(e,n,r,i,o,a,s,l){this.kind=t.Atomic,this.objectPrimitive="atomistic",this._transientCache=void 0,this.id=e,this.invariantId=n,this.chainGroupId=r,this.traits=i,this.model=o,this.elements=a,this.conformation=s,this.residueIndex=o.atomicHierarchy.residueAtomSegments.index,this.chainIndex=o.atomicHierarchy.chainAtomSegments.index,this.props=l}}e.Atomic=B
class E{get transientCache(){return void 0===this._transientCache&&(this._transientCache=new Map),this._transientCache}getChild(e){return e.length===this.elements.length?this:D(this.id,this.invariantId,this.chainGroupId,this.traits,this.model,this.kind,e,this.conformation,{})}getCopy(e,t,n,r){const i=D(e,t,n,this.traits,this.model,this.kind,this.elements,this.conformation,this.props)
return(null==r?void 0:r.propagateTransientCache)&&(i._transientCache=this._transientCache),i}applyOperator(e,t,n=!1){const i=n?t:r.J.compose(this.conformation.operator,t)
return D(e,this.invariantId,this.chainGroupId,this.traits,this.model,this.kind,this.elements,r.J.createMapping(i,this.getCoarseConformation(),this.conformation.r),this.props)}remapModel(t,n,i){const o=this.getCoarseConformation(),a=k(this.kind,t)
i||(i={...this.props},e.isSameConformation(this,t)||(i.boundary=void 0,i.lookup3d=void 0,i.principalAxes=void 0))
const s=o!==a?r.J.createMapping(this.conformation.operator,a,this.kind===e.Kind.Spheres?P(t):e=>0):this.conformation
return new E(this.id,this.invariantId,this.chainGroupId,this.traits,t,this.kind,this.elements,s,i)}get boundary(){if(this.props.boundary)return this.props.boundary
const{x:e,y:t,z:n}=this.getCoarseConformation(),r=this.getCoarseRadii()
return this.props.boundary=y.is(this.traits,m.FastBoundary)?(0,b.b)({x:e,y:t,z:n,radius:r,indices:this.elements}):(0,b.r)({x:e,y:t,z:n,radius:r,indices:this.elements}),this.props.boundary}get lookup3d(){if(this.props.lookup3d)return this.props.lookup3d
const{x:e,y:t,z:n}=this.getCoarseConformation()
return this.props.lookup3d=(0,o.Eh)({x:e,y:t,z:n,indices:this.elements},this.boundary),this.props.lookup3d}get principalAxes(){return this.props.principalAxes||(this.props.principalAxes=v(this)),this.props.principalAxes}get polymerElements(){return this.props.polymerElements||(this.props.polymerElements=function(e){const t=[],{elements:n,model:r}=e,{spheres:i,gaussians:o}=r.coarseHierarchy,a=p.Unit.isSpheres(e)?i.polymerRanges:o.polymerRanges,s=h.m.transientSegments(a,n)
for(;s.hasNext;){const{start:e,end:r}=s.move()
for(let i=e;i<r;++i)t.push(n[i])}return u.X9.ofSortedArray(t)}(this)),this.props.polymerElements}get gapElements(){return this.props.gapElements||(this.props.gapElements=function(e){const t=[],{elements:n,model:r}=e,{spheres:i,gaussians:o}=r.coarseHierarchy,a=p.Unit.isSpheres(e)?i.gapRanges:o.gapRanges,s=h.m.transientSegments(a,n)
for(;s.hasNext;){const{start:e,end:r}=s.move()
t.push(n[e],n[r-1])}return u.X9.ofSortedArray(t)}(this)),this.props.gapElements}getCoarseConformation(){return k(this.kind,this.model)}getCoarseRadii(){return e=this.kind,n=this.model,e===t.Spheres?n.coarseConformation.spheres.radius:void 0
var e,n}constructor(e,n,r,i,o,a,s,l,c){this._transientCache=void 0,this.kind=a,this.objectPrimitive=a===t.Spheres?"sphere":"gaussian",this.id=e,this.invariantId=n,this.chainGroupId=r,this.traits=i,this.model=o,this.elements=s,this.conformation=l,this.coarseElements=a===t.Spheres?o.coarseHierarchy.spheres:o.coarseHierarchy.gaussians,this.coarseConformation=a===t.Spheres?o.coarseConformation.spheres:o.coarseConformation.gaussians,this.props=c}}function k(e,n){return e===t.Spheres?n.coarseConformation.spheres:n.coarseConformation.gaussians}function D(e,t,n,r,i,o,a,s,l){return new E(e,t,n,r,i,o,a,s,l)}function M(e,t,n,r){var i
if(!t)return
if(e.model.atomicConformation.id===n.atomicConformation.id)return t
const o=x.z.Provider.get(e.model)
if(o){const e=x.z.Provider.get(n)
return e&&o!==e?void 0:t}return(null===(i=t.props)||void 0===i?void 0:i.canRemap)||!r||R(e,n)?t:void 0}function R(e,t){const n=i.Kx.CoordinatesHistory.get(i.Kx.getRoot(t))
if(n)return n.areEqual(e.elements,e.kind,t)
const r=e.elements,{x:o,y:a,z:s}=e.conformation.coordinates,{x:l,y:c,z:u}=O(e.kind,t)
for(let i=0,d=r.length;i<d;i++){const e=r[i]
if(o[e]!==l[e]||a[e]!==c[e]||s[e]!==u[e])return!1}return!0}function O(e,n){return e===t.Atomic?n.atomicConformation:e===t.Spheres?n.coarseConformation.spheres:n.coarseConformation.gaussians}function L(e,n){return e===t.Atomic?n.atomicHierarchy:e===t.Spheres?n.coarseHierarchy.spheres:n.coarseHierarchy.gaussians}e.Spheres=class extends E{},e.Gaussians=class extends E{},e.areSameChainOperatorGroup=function(e,t){return e.chainGroupId===t.chainGroupId&&e.conformation.operator.name===t.conformation.operator.name},e.areOperatorsEqual=function(e,t){return g.$I.areEqual(e.conformation.operator.matrix,t.conformation.operator.matrix,1e-6)},e.areConformationsEqual=function(e,t){return e===t||!!u.X9.areEqual(e.elements,t.elements)&&R(e,t.model)},e.isSameConformation=R,e.getModelConformationOfKind=O,e.getConformation=function(e){return O(e.kind,e.model)},e.getModelHierarchyOfKind=L,e.getHierarchy=function(e){return L(e.kind,e.model)}}(I||(I={}))},98529(e,t,n){"use strict"
n.d(t,{Cn:()=>f,WT:()=>d,XP:()=>u,_j:()=>p,bj:()=>h})
var r=n(31727),i=n(14294),o=n(97564),a=n(32775),s=n(89432),l=n(9043)
function c(e,t,n,l,c){const{colorType:u,vertexCount:d,groupCount:p,positionBuffer:h,instanceBuffer:f,transformBuffer:m,groupBuffer:g,itemSize:y}=e,v=u.endsWith("Instance"),b=i.DJ.fromSphere3D((0,i.DJ)(),v?e.boundingSphere:e.invariantBoundingSphere),x=1+t,S=i.DJ.expand((0,i.DJ)(),b,a.eB.create(x,x,x)),_=1/t,C=i.DJ.scale((0,i.DJ)(),S,_),w=i.DJ.size((0,a.eB)(),C)
a.eB.ceil(w,w),a.eB.add(w,w,a.eB.create(2,2,2))
const{min:T}=S,[A,I]=w,{width:P,height:B}=(0,s.Ud)(w),E=new Float32Array(P*B*y),k=new Float32Array(P*B),D=new Uint8Array(P*B*y),M={array:D,width:P,height:B,filter:"linear"},R=v?e.instanceCount:1,O=e.colorData.array
function L(e,t,n){const r=Math.floor(n*A%P/A),i=Math.floor(n*A/P)
return y*(i*I*P+t*P+(r*A+e))}const[N,F,z]=w,j=(0,a.eB)()
for(let r=0;r<R;++r){const e=l?f[r]:r
for(let t=0;t<d;t+=n){a.eB.fromArray(j,h,3*t),v&&a.eB.transformMat4Offset(j,j,m,0,0,16*r),a.eB.sub(j,j,T),a.eB.scale(j,j,_)
const[n,i,o]=j,s=Math.floor(n),l=Math.floor(i),c=Math.floor(o),u=(e*p+g[t])*y,d=Math.max(0,s-2),f=Math.max(0,l-2),b=Math.max(0,c-2),x=Math.min(N,s+2+2),S=Math.min(F,l+2+2),C=Math.min(z,c+2+2)
for(let e=d;e<x;++e){const t=e-n
for(let n=f;n<S;++n){const r=n-i
for(let i=b;i<C;++i){const a=i-o,s=Math.sqrt(t*t+r*r+a*a)
if(s>2)continue
const l=2-s,c=L(e,n,i)
for(let e=0;e<y;++e)E[c+e]+=O[u+e]*l
k[c/y]+=l}}}}}for(let r=0,i=k.length;r<i;++r){const e=r*y,t=k[r]
for(let n=0;n<y;++n)D[e+n]=Math.round(E[e+n]/t)}const V=a.ZY.create(P,B),U=a.Zb.create(T[0],T[1],T[2],_),G=v?"volumeInstance":"volume"
if(l){if(!c){const e=4===y?"rgba":3===y?"rgb":"alpha"
c=l.resources.texture("image-uint8",e,"ubyte","linear")}return c.load(M),{kind:"volume",texture:c,gridTexDim:V,gridDim:w,gridTransform:U,type:G}}{const e=function(e){const{vertexCount:t,positionBuffer:n,transformBuffer:i,grid:s,gridDim:l,gridTexDim:c,gridTransform:u,vertexStride:d,colorStride:p}=e,h=e.itemOffset||0,f=e.outputStride
if(f+h>p)throw new Error("outputStride + itemOffset must NOT be larger than colorStride")
const m=e.colorType.endsWith("Instance"),g=m?e.instanceCount:1,y=(0,r.xg)(Math.max(1,g*t),f,Uint8Array),{array:v}=y,[b,x]=l,S=c[0],_=a.eB.fromArray((0,a.eB)(),u,0),C=u[3]
function w(e,t,n){const r=Math.floor(n*b%S/b),i=Math.floor(n*b/S)
return p*(i*x*S+t*S+(r*b+e))}const T=(0,a.eB)(),A=(0,a.eB)(),I=(0,a.eB)(),P=(0,a.eB)()
for(let r=0;r<g;++r)for(let e=0;e<t;++e){a.eB.fromArray(T,n,e*d),m&&a.eB.transformMat4Offset(T,T,i,0,0,16*r),a.eB.sub(T,T,_),a.eB.scale(T,T,C),a.eB.floor(A,T),a.eB.ceil(I,T),a.eB.sub(P,T,A),a.eB.sub(T,I,A),a.eB.div(P,P,T)
const[l,c,u]=A,[p,g,y]=I,[b,x,S]=P,B=w(l,c,u)+h,E=w(p,c,u)+h,k=w(l,c,y)+h,D=w(p,c,y)+h,M=w(l,g,u)+h,R=w(p,g,u)+h,O=w(l,g,y)+h,L=w(p,g,y)+h,N=(r*t+e)*f
for(let e=0;e<f;++e){const t=s[B+e],n=s[E+e],r=s[k+e],i=s[D+e],a=s[M+e],l=s[R+e],c=s[O+e],u=s[L+e],d=(0,o.Cc)(t,n,b),p=(0,o.Cc)(r,i,b),h=(0,o.Cc)(a,l,b),f=(0,o.Cc)(c,u,b),m=(0,o.Cc)(d,h,x),g=(0,o.Cc)(p,f,x)
v[N+e]=(0,o.Cc)(m,g,S)}}return y}({vertexCount:d,instanceCount:R,transformBuffer:m,positionBuffer:h,colorType:G,grid:D,gridDim:w,gridTexDim:V,gridTransform:U,vertexStride:3,colorStride:y,outputStride:y})
return{kind:"vertex",texture:e,texDim:a.ZY.create(e.width,e.height),type:v?"vertexInstance":"vertex"}}}function u(e,t,n,r,i){if("group"!==(o=e.dColorType.ref.value)&&"groupInstance"!==o)return
var o
const a=c({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tColor.ref.value,colorType:e.dColorType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:3},t,n,r,i)
"volume"===a.kind?(l.IQ.updateIfChanged(e.dColorType,a.type),l.IQ.update(e.tColorGrid,a.texture),l.IQ.update(e.uColorTexDim,a.gridTexDim),l.IQ.update(e.uColorGridDim,a.gridDim),l.IQ.update(e.uColorGridTransform,a.gridTransform)):"vertex"===a.kind&&(l.IQ.updateIfChanged(e.dColorType,a.type),l.IQ.update(e.tColor,a.texture),l.IQ.update(e.uColorTexDim,a.texDim))}function d(e,t,n,r,i){if("groupInstance"!==e.dOverpaintType.ref.value)return
const o=c({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tOverpaint.ref.value,colorType:e.dOverpaintType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:4},t,n,r,i)
"volume"===o.kind?(l.IQ.updateIfChanged(e.dOverpaintType,o.type),l.IQ.update(e.tOverpaintGrid,o.texture),l.IQ.update(e.uOverpaintTexDim,o.gridTexDim),l.IQ.update(e.uOverpaintGridDim,o.gridDim),l.IQ.update(e.uOverpaintGridTransform,o.gridTransform)):"vertex"===o.kind&&(l.IQ.updateIfChanged(e.dOverpaintType,o.type),l.IQ.update(e.tOverpaint,o.texture),l.IQ.update(e.uOverpaintTexDim,o.texDim))}function p(e,t,n,r,i){if("groupInstance"!==e.dTransparencyType.ref.value)return
const o=c({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tTransparency.ref.value,colorType:e.dTransparencyType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:1},t,n,r,i)
"volume"===o.kind?(l.IQ.updateIfChanged(e.dTransparencyType,o.type),l.IQ.update(e.tTransparencyGrid,o.texture),l.IQ.update(e.uTransparencyTexDim,o.gridTexDim),l.IQ.update(e.uTransparencyGridDim,o.gridDim),l.IQ.update(e.uTransparencyGridTransform,o.gridTransform)):"vertex"===o.kind&&(l.IQ.updateIfChanged(e.dTransparencyType,o.type),l.IQ.update(e.tTransparency,o.texture),l.IQ.update(e.uTransparencyTexDim,o.texDim))}function h(e,t,n,r,i){if("groupInstance"!==e.dEmissiveType.ref.value)return
const o=c({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tEmissive.ref.value,colorType:e.dEmissiveType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:1},t,n,r,i)
"volume"===o.kind?(l.IQ.updateIfChanged(e.dEmissiveType,o.type),l.IQ.update(e.tEmissiveGrid,o.texture),l.IQ.update(e.uEmissiveTexDim,o.gridTexDim),l.IQ.update(e.uEmissiveGridDim,o.gridDim),l.IQ.update(e.uEmissiveGridTransform,o.gridTransform)):"vertex"===o.kind&&(l.IQ.updateIfChanged(e.dEmissiveType,o.type),l.IQ.update(e.tEmissive,o.texture),l.IQ.update(e.uEmissiveTexDim,o.texDim))}function f(e,t,n,r,i){if("groupInstance"!==e.dSubstanceType.ref.value)return
const o=c({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tSubstance.ref.value,colorType:e.dSubstanceType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:4},t,n,r,i)
"volume"===o.kind?(l.IQ.updateIfChanged(e.dSubstanceType,o.type),l.IQ.update(e.tSubstanceGrid,o.texture),l.IQ.update(e.uSubstanceTexDim,o.gridTexDim),l.IQ.update(e.uSubstanceGridDim,o.gridDim),l.IQ.update(e.uSubstanceGridTransform,o.gridTransform)):"vertex"===o.kind&&(l.IQ.updateIfChanged(e.dSubstanceType,o.type),l.IQ.update(e.tSubstance,o.texture),l.IQ.update(e.uSubstanceTexDim,o.texDim))}},98973(e,t,n){"use strict"
function r(e){return e.reduce((e,t)=>Number(e)/Number(t))}n.r(t),n.d(t,{default:()=>i,div:()=>r})
var i=(0,n(10336).helper)(r)},99153(e,t,n){"use strict"
n.d(t,{O:()=>c,P:()=>l})
var r,i,o=n(12046),a=n(69396),s=n(91229)
function l(e){return r.classify(e)}function c(e){return i.classify(e)}!function(e){function t(e,t){return e>=0?Math.ceil((e+1)/t):Math.ceil((e+1)/(-t-1))}function n({limit8:e,limit16:n},r,i){r.pack8+=t(i,e),r.pack16+=t(i,n),r.count+=1}function r(e,n){e.pack8+=t(n,127),e.pack16+=t(n,32767),e.count+=1}function i(e){return 4*e.count<2*e.pack16?{length:4*e.count,elem:4}:2*e.pack16<e.pack8?{length:2*e.pack16,elem:2}:{length:e.pack8,elem:1}}function a(e,t){const r={pack8:0,pack16:0,count:0}
for(let i=0,o=e.length;i<o;i++)n(t,r,e[i])
return{...i(r),kind:"pack"}}function l(e,t){const n={pack8:0,pack16:0,count:0}
let o=e[0]
for(let i=1,a=e.length;i<a;i++)r(n,e[i]-o),o=e[i]
return{...i(n),kind:"delta"}}function c(e,t){const r={pack8:0,pack16:0,count:0}
let o=1
for(let i=1,a=e.length;i<a;i++)e[i-1]!==e[i]?(n(t,r,e[i-1]),n(t,r,o),o=1):o++
return n(t,r,e[e.length-1]),n(t,r,o),{...i(r),kind:"rle"}}function u(e,t){const n={pack8:0,pack16:0,count:0}
let o=1,a=0,s=0
for(let i=1,l=e.length;i<l;i++){const t=e[i]-a
s!==t?(r(n,s),r(n,o),o=1):o++,s=t,a=e[i]}return r(n,s),r(n,o),{...i(n),kind:"delta-rle"}}function d(e){const t=function(e){let t=!1
for(let n=0,r=e.length;n<r;n++)if(e[n]<0){t=!0
break}return t?{signed:t,limit8:127,limit16:32767}:{signed:t,limit8:255,limit16:65535}}(e),n=[a(e,t),c(e,t),l(e),u(e)]
return n.sort((e,t)=>e.length-t.length),n}e.getSize=d,e.classify=function(e){if(e.length<2)return o.ND.by(o.ND.byteArray)
const t=d(e)[0]
switch(t.kind){case"pack":return o.ND.by(o.ND.integerPacking)
case"rle":return o.ND.by(o.ND.runLength).and(o.ND.integerPacking)
case"delta":return o.ND.by(o.ND.delta).and(o.ND.integerPacking)
case"delta-rle":return o.ND.by(o.ND.delta).and(o.ND.runLength).and(o.ND.integerPacking)
default:(0,s.dr)(t)}}}(r||(r={})),function(e){e.classify=function(e){const{mantissaDigits:t,integerDigits:n}=(0,a.In)(e,4,1e-6)
if(t<0||t+n>10)return o.ND.by(o.ND.byteArray)
if(0===t)return r.classify(e)
const i=function(e){let t=1
for(let n=0;n<e;n++)t*=10
return t}(t),l=new Int32Array(e.length)
for(let r=0,o=e.length;r<o;r++)l[r]=Math.round(i*e[r])
const c=r.getSize(l)[0],u=o.ND.by(o.ND.fixedPoint(i))
switch(c.kind){case"pack":return u.and(o.ND.integerPacking)
case"rle":return u.and(o.ND.runLength).and(o.ND.integerPacking)
case"delta":return u.and(o.ND.delta).and(o.ND.integerPacking)
case"delta-rle":return u.and(o.ND.delta).and(o.ND.runLength).and(o.ND.integerPacking)
default:(0,s.dr)(c)}}}(i||(i={}))},99302(e,t,n){"use strict"
n.r(t),n.d(t,{MolScriptBuilder:()=>r})
var r,i=n(25176)
!function(e){e.core=i.AN.core,e.struct=i.AN.structureQuery,e.internal=i.AN.internal,e.atomName=function(t){return e.struct.type.atomName([t])},e.es=function(t){return e.struct.type.elementSymbol([t])},e.list=function(...t){return e.core.type.list(t)},e.set=function(...t){return e.core.type.set(t)},e.re=function(t,n){return e.core.type.regex([t,n])},e.fn=function(t){return e.core.ctrl.fn([t])},e.evaluate=function(t){return e.core.ctrl.eval([t])}
const t=e.struct.atomProperty.core,n=e.struct.atomProperty.macromolecular,r=e.struct.atomProperty.topology
function o(e){return t[e]()}function a(e){return r[e]()}function s(e){return n[e]()}e.acp=o,e.atp=a,e.ammp=s
const l=e.struct.atomSet.propertySet
e.acpSet=function(e){return l([o(e)])},e.atpSet=function(e){return l([a(e)])},e.ammpSet=function(e){return l([s(e)])}}(r||(r={}))},99321(e,t,n){"use strict"
n.d(t,{Fs:()=>f,RN:()=>p,Vl:()=>g,Y7:()=>u,bP:()=>x,j:()=>S,qt:()=>m,vq:()=>d})
var r=n(30372),i=n(66006),o=n(16124),a=n(37411),s=n(23325),l=n(36432),c=n(9043)
function u(e){if("object"==typeof e){if("buttons"in e)return e.buttons
if("which"in e){const t=e.which
if(2===t)return 4
if(3===t)return 2
if(t>0)return 1<<t-1}}return 0}function d(e){if("object"==typeof e&&"button"in e){const t=e.button
if(1===t)return 4
if(2===t)return 2
if(t>=0)return 1<<t}return 0}function p(e){return{alt:"altKey"in e&&e.altKey,shift:"shiftKey"in e&&e.shiftKey,control:"ctrlKey"in e&&e.ctrlKey,meta:"metaKey"in e&&e.metaKey}}const h={noScroll:!0,noMiddleClickScroll:!0,noContextMenu:!0,noPinchZoom:!0,noTextSelect:!0,preventGestures:!1,mask:(e,t)=>!0,pixelScale:1}
var f,m
!function(e){function t(e,t){return e.shift===t.shift&&e.alt===t.alt&&e.control===t.control&&e.meta===t.meta}function n(e={}){return{shift:!!e.shift,alt:!!e.alt,control:!!e.control,meta:!!e.meta}}e.None=n(),e.areEqual=t,e.areNone=function(n){return t(n,e.None)},e.size=function(e){if(!e)return 0
let t=0
return e.shift&&t++,e.alt&&t++,e.control&&t++,e.meta&&t++,t},e.create=n}(f||(f={})),function(e){let t
e.has=l.N.has,e.create=l.N.create,function(e){e[e.None=0]="None",e[e.Primary=1]="Primary",e[e.Secondary=2]="Secondary",e[e.Auxilary=4]="Auxilary",e[e.Forth=8]="Forth",e[e.Five=16]="Five",e[e.Trigger=32]="Trigger",e[e.Squeeze=48]="Squeeze"}(t=e.Flag||(e.Flag={}))}(m||(m={}))
const g={key:"",code:"",modifiers:f.None,x:-1,y:-1,pageX:-1,pageY:-1,preventDefault:c.lQ}
var y
function v(){return{drag:new r.B,interactionEnd:new r.B,click:new r.B,move:new r.B,wheel:new r.B,pinch:new r.B,gesture:new r.B,resize:new r.B,leave:new r.B,enter:new r.B,modifiers:new r.B,key:new r.B,keyUp:new r.B,keyDown:new r.B,lock:new r.B,trackedPointers:new r.B}}!function(e){e[e.Stopped=0]="Stopped",e[e.Started=1]="Started",e[e.Moving=2]="Moving"}(y||(y={}))
const b=["Backspace","Delete"]
var x
function S(e){let t=0,n=0,r=0,i=0,o=0
return"detail"in e&&(n=e.detail),"wheelDelta"in e&&(n=-e.wheelDelta/120),"wheelDeltaY"in e&&(n=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(t=-e.wheelDeltaX/120),"axis"in e&&e.axis===e.HORIZONTAL_AXIS&&(t=n,n=0),r=10*t,i=10*n,"deltaY"in e&&(i=e.deltaY),"deltaX"in e&&(r=e.deltaX),"deltaZ"in e&&(o=e.deltaZ),(r||i||o)&&e.deltaMode&&(1===e.deltaMode?(r*=40,i*=40,o*=40):(r*=800,i*=800,o*=800)),r&&!t&&(t=r<0?-1:1),i&&!n&&(n=i<0?-1:1),{spinX:t,spinY:n,dx:r,dy:i,dz:o}}!function(e){e.create=function(e={}){const{noScroll:t,noContextMenu:n}={...h,...e}
return{noScroll:t,noContextMenu:n,pointerLock:!1,width:0,height:0,pixelRatio:1,...v(),setPixelScale:c.lQ,updateTrackedPointers:c.lQ,updateScreenTouches:c.lQ,requestPointerLock:c.lQ,exitPointerLock:c.lQ,dispose:c.lQ}},e.fromElement=function(e,t={}){let{noScroll:n,noMiddleClickScroll:r,noContextMenu:l,noPinchZoom:c,noTextSelect:p,mask:g,pixelScale:x,preventGestures:_}={...h,...t},C=e.clientWidth*R(),w=e.clientHeight*R(),T=!1,A=(0,i.LM)()
const I=(0,o.Z)(),P=(0,o.Z)(),B=(0,o.Z)(),E=(0,o.Z)(),k=(0,o.Z)(),D={shift:!1,alt:!1,control:!1,meta:!1},M={x:-1,y:-1,pageX:-1,pageY:-1}
function R(){return window.devicePixelRatio*x}function O(){return{...D}}function L(t){return t.target===document.body||t.target===e}let N,F=y.Stopped,z=!1,j=m.create(m.Flag.None),V=m.Flag.None,U=!1,G=!1
void 0!==window.ResizeObserver&&(N=new window.ResizeObserver(We))
const H=v(),{drag:q,interactionEnd:Q,wheel:$,pinch:X,gesture:W,click:Y,move:Z,leave:K,enter:J,resize:ee,modifiers:te,key:ne,keyUp:re,keyDown:ie,lock:oe,trackedPointers:ae}=H
function se(){T=e.ownerDocument.pointerLockElement===e,tt(T),oe.next(T)}function le(){console.error("Unable to use Pointer Lock API"),T=!1,tt(T),oe.next(T)}function ce(e){g(e.clientX,e.clientY)&&l&&e.preventDefault()}function ue(e){D.alt=e.altKey,D.shift=e.shiftKey,D.control=e.ctrlKey,D.meta=e.metaKey}function de(){(j||D.shift||D.alt||D.meta||D.control)&&(j=0,D.shift=D.alt=D.control=D.meta=!1)}function pe(e){let t=!1
!D.alt&&e.altKey&&(t=!0,D.alt=!0),!D.shift&&e.shiftKey&&(t=!0,D.shift=!0),!D.control&&e.ctrlKey&&(t=!0,D.control=!0),!D.meta&&e.metaKey&&(t=!0,D.meta=!0),t&&U&&te.next(O()),L(e)&&U&&ie.next({key:e.key,code:e.code,modifiers:O(),...M,preventDefault:()=>e.preventDefault()})}function he(e){let t=!1
D.alt&&!e.altKey&&(t=!0,D.alt=!1),D.shift&&!e.shiftKey&&(t=!0,D.shift=!1),D.control&&!e.ctrlKey&&(t=!0,D.control=!1),D.meta&&!e.metaKey&&(t=!0,D.meta=!1),t&&U&&te.next(O()),b.includes(e.key)&&fe(e),L(e)&&U&&re.next({key:e.key,code:e.code,modifiers:O(),...M,preventDefault:()=>e.preventDefault()})}function fe(e){L(e)&&U&&ne.next({key:e.key,code:e.code,modifiers:O(),...M,preventDefault:()=>e.preventDefault()})}e.addEventListener("contextmenu",ce,!1),e.addEventListener("wheel",Ve,!1),e.addEventListener("mousedown",Oe,!1),window.addEventListener("mousemove",Le,!1),window.addEventListener("mouseup",Ne,!1),e.addEventListener("touchstart",De,!1),e.addEventListener("touchmove",Re,!1),e.addEventListener("touchend",Me,!1),e.addEventListener("gesturechange",$e,!1),e.addEventListener("gesturestart",qe,!1),e.addEventListener("gestureend",Xe,!1),window.addEventListener("blur",de),window.addEventListener("keyup",he,!1),window.addEventListener("keydown",pe,!1),window.addEventListener("keypress",fe,!1),document.addEventListener("pointerlockchange",se,!1),document.addEventListener("pointerlockerror",le,!1),null!=N?N.observe(e.parentElement):window.addEventListener("resize",We,!1)
const me={primary:{prev:void 0,down:(0,o.Z)(),end:(0,o.Z)(),axes:[]},secondary:{prev:void 0,down:(0,o.Z)(),end:(0,o.Z)(),axes:[]},distance:-1}
function ge(e,t,n){const r=m.has(t,e)
return!!n&&m.has(n,e)&&!r}function ye(e,t){const{x:n,y:r,dx:i,dy:a,ray:s,buttons:l,axes:c}=e,[u,d]=[n,r],p=f.create(),h=t?me.secondary:me.primary,{prev:g}=h
l===m.Flag.Secondary?Z.next({x:n,y:r,pageX:u,pageY:d,buttons:m.Flag.None,button:m.Flag.None,modifiers:p,inside:!0,onElement:!0,ray:s}):(null==g?void 0:g.buttons)===m.Flag.Secondary&&K.next(void 0)
const y=m.has(l,m.Flag.Primary),v=!!g&&m.has(g.buttons,m.Flag.Primary)
if(v&&!y&&(o.Z.set(h.end,n,r),o.Z.distance(h.end,h.down)<20&&Y.next({x:n,y:r,pageX:u,pageY:d,buttons:m.Flag.Trigger,button:m.Flag.Trigger,modifiers:p,ray:s}),Q.next(void 0)),y){const e=!v
q.next({x:n,y:r,dx:i,dy:a,pageX:u,pageY:d,buttons:m.Flag.Trigger,button:m.Flag.Trigger,modifiers:p,isStart:e,useDelta:!0}),e&&o.Z.set(h.down,n,r)}const b={x:0,y:0,pageX:0,pageY:0,modifiers:p,preventDefault:()=>{}}
if(ge(m.Flag.Forth,l,null==g?void 0:g.buttons)){const e=t?"GamepadX":"GamepadA"
re.next({...b,code:e,key:e})}if(ge(m.Flag.Five,l,null==g?void 0:g.buttons)){const e=t?"GamepadY":"GamepadB"
re.next({...b,code:e,key:e})}c&&(c[2]<0?(ie.next({...b,code:"GamepadLeft",key:"GamepadLeft"}),re.next({...b,code:"GamepadRight",key:"GamepadRight"})):c[2]>0?(ie.next({...b,code:"GamepadRight",key:"GamepadRight"}),re.next({...b,code:"GamepadLeft",key:"GamepadLeft"})):c[2]!==h.axes[2]&&(re.next({...b,code:"GamepadLeft",key:"GamepadLeft"}),re.next({...b,code:"GamepadRight",key:"GamepadRight"})),c[3]<0?(ie.next({...b,code:"GamepadUp",key:"GamepadUp"}),re.next({...b,code:"GamepadDown",key:"GamepadDown"})):c[3]>0?(ie.next({...b,code:"GamepadDown",key:"GamepadDown"}),re.next({...b,code:"GamepadUp",key:"GamepadUp"})):c[3]!==h.axes[3]&&(re.next({...b,code:"GamepadUp",key:"GamepadUp"}),re.next({...b,code:"GamepadDown",key:"GamepadDown"}))),h.axes=c||[],h.prev=e}function ve(e,t,n){const r=a.e.distance(e.ray.origin,t.ray.origin)
if(me.distance>0){const e=r/me.distance
W.next({scale:e,rotation:0,deltaScale:0,deltaRotation:0,buttons:n,button:n,modifiers:O()})}me.distance=r}let be,xe,Se=-1
function _e(e){const t=e.touches[0],n=e.touches[1]
return{clientX:(t.clientX+n.clientX)/2,clientY:(t.clientY+n.clientY)/2,pageX:(t.pageX+n.pageX)/2,pageY:(t.pageY+n.pageY)/2,target:e.target}}function Ce(e){const t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY
return Math.sqrt(t*t+n*n)}let we,Te=-1
const Ae=(0,o.Z)(),Ie=(0,o.Z)(),Pe=(0,o.Z)()
let Be=!1,Ee=0,ke=1
function De(e){if(e.preventDefault(),we=void 0,Te=-1,1===e.touches.length)j=V=m.Flag.Primary,Te=0,o.Z.set(Ae,e.touches[0].pageX,e.touches[0].pageY),we=e.touches[0],ze(e.touches[0]),o.Z.copy(Pe,P),Be=!0
else if(2===e.touches.length){j=m.Flag.Secondary|m.Flag.Auxilary,V=m.Flag.Secondary,ue(e),ke=1,Ee=Ce(e)
const{pageX:t,pageY:n}=Ke(_e(e))
Be||(Ze(Pe,_e(e)),Be=!0),X.next({isStart:!0,distance:Ee,delta:0,fraction:ke,fractionDelta:0,startX:Pe[0],startY:Pe[1],centerPageX:t,centerPageY:n,buttons:j,button:V,modifiers:O()})}else 3===e.touches.length&&(j=V=m.Flag.Forth,ze(_e(e)))}function Me(e){if(Fe(),we&&Te<=4){const e=we
if(!g(e.clientX,e.clientY))return
Ze(Ie,e)
const{pageX:t,pageY:n}=Ke(e),[r,i]=Ie
Y.next({x:r,y:i,pageX:t,pageY:n,buttons:j,button:V,modifiers:O()})}we=void 0,Be=!1}function Re(e){if(V=m.Flag.None,c&&(e.preventDefault(),e.stopPropagation(),e.originalEvent&&(e.originalEvent.preventDefault(),e.originalEvent.stopPropagation())),we=void 0,1===e.touches.length)j=m.Flag.Primary,we=e.touches[0],function(e){Te<0||(o.Z.set(Ie,e.touches[0].pageX,e.touches[0].pageY),Te+=o.Z.distance(Ae,Ie),o.Z.copy(Ae,Ie))}(e),je(e.touches[0])
else if(2===e.touches.length){j=m.Flag.Secondary|m.Flag.Auxilary,V=m.Flag.Secondary,ue(e)
const{pageX:t,pageY:n}=Ke(_e(e)),r=Ce(e),i=Ee-r,o=Ee/r,a=o-ke
ke=o,X.next({isStart:!1,distance:r,delta:i,fraction:o,fractionDelta:a,startX:Pe[0],startY:Pe[1],centerPageX:t,centerPageY:n,buttons:j,button:V,modifiers:O()})}else 3===e.touches.length&&(j=m.Flag.Forth,je(_e(e)))}function Oe(e){ue(e),j=u(e),V=d(e),r&&j===m.Flag.Auxilary&&e.preventDefault,ze(e)}function Le(e){ue(e),j=u(e),V=m.Flag.None,je(e)}function Ne(e){ue(e),j=u(e),V=d(e),function(e){if(F=y.Stopped,g(e.clientX,e.clientY)){if(Ze(B,e),!G&&o.Z.distance(B,I)<4){const{pageX:t,pageY:n}=Ke(e),[r,i]=B
Y.next({x:r,y:i,pageX:t,pageY:n,buttons:j,button:V,modifiers:O()})}G=!1}}(e),Fe()}function Fe(){Q.next(void 0)}function ze(e){g(e.clientX,e.clientY)&&(Ze(P,e),o.Z.copy(I,P),Ye(P)&&(F=y.Started))}function je(t){var n
Ze(B,t)
const{pageX:r,pageY:i}=Ke(t),[a,l]=B,{movementX:c,movementY:u}=t,d=Ye(B)&&g(t.clientX,t.clientY)
if(U&&!d?K.next(void 0):!U&&d&&J.next(void 0),U=d,M.x=a,M.y=l,M.pageX=r,M.pageY=i,Z.next({x:a,y:l,pageX:r,pageY:i,movementX:c,movementY:u,buttons:j,button:V,modifiers:O(),inside:d,onElement:t.target===e}),F===y.Stopped)return
var h
if(p&&(null===(n=t.preventDefault)||void 0===n||n.call(t)),o.Z.div(E,o.Z.sub(E,B,P),((h=k)[0]=e.clientWidth,h[1]=e.clientHeight,h)),o.Z.magnitude(E)<s.p)return
const f=F===y.Started
if(f&&!g(t.clientX,t.clientY))return
o.Z.distance(B,I)>=4&&(G=!0)
const[m,v]=E
q.next({x:a,y:l,dx:m,dy:v,pageX:r,pageY:i,buttons:j,button:V,modifiers:O(),isStart:f}),o.Z.copy(P,B),F=y.Moving}function Ve(e){if(!g(e.clientX,e.clientY))return
Ze(B,e)
const{pageX:t,pageY:r}=Ke(e),[i,o]=B
n&&e.preventDefault()
const a=S(e)
j=V=m.Flag.Auxilary,(a.dx||a.dy||a.dz)&&$.next({x:i,y:o,pageX:t,pageY:r,...a,buttons:j,button:V,modifiers:O()})}function Ue(e){var t,n
_&&(e.preventDefault(),null===(t=e.stopImmediatePropagation)||void 0===t||t.call(e),null===(n=e.stopPropagation)||void 0===n||n.call(e))}let Ge=0,He=0
function qe(e){Ue(e),Ge=e.scale,He=e.rotation,W.next({scale:e.scale,rotation:e.rotation,deltaRotation:0,deltaScale:0,isStart:!0,buttons:j,button:V,modifiers:O()})}function Qe(e,t){W.next({scale:e.scale,rotation:e.rotation,deltaRotation:He-e.rotation,deltaScale:Ge-e.scale,isEnd:t,buttons:j,button:V,modifiers:O()}),He=e.rotation,Ge=e.scale}function $e(e){Ue(e),Qe(e)}function Xe(e){Ue(e),Qe(e,!0)}function We(){C=e.clientWidth*R(),w=e.clientHeight*R(),ee.next({})}function Ye(t){if(e instanceof Window||e instanceof Document||e===document.body)return!0
{const n=e.getBoundingClientRect()
return t[0]>=0&&t[1]>=0&&t[0]<n.width&&t[1]<n.height}}function Ze(t,n){if(C=e.clientWidth*R(),w=e.clientHeight*R(),T){const e=R()
t[0]=(A.x+A.width/2)/e,t[1]=(w-(A.y+A.height/2))/e}else{const r=e.getBoundingClientRect()
t[0]=(n.clientX||0)-r.left,t[1]=(n.clientY||0)-r.top}return t}function Ke(e){return T?{pageX:Math.round(window.innerWidth/2)+A.x,pageY:Math.round(window.innerHeight/2)+A.y}:{pageX:e.pageX,pageY:e.pageY}}const Je=30,et=function(){var t
const n=document.createElement("div"),r="#000 30%, #0000 0 calc(100% - 30%), #000 0",i=`linear-gradient(0deg, ${r}) 50%/10% 100% no-repeat`,o=`linear-gradient(90deg, ${r}) 50%/100% 10% no-repeat`
return Object.assign(n.style,{width:`${Je}px`,aspectRatio:1,background:`${i}, ${o}, radial-gradient(circle at 50%, #000 5%, #0000 5%)`,display:"none",zIndex:1e3,position:"absolute",mixBlendMode:"difference",filter:"invert(1)"}),null===(t=e.parentElement)||void 0===t||t.appendChild(n),n}()
function tt(e){if(et.style.display=e?"block":"none",e){const e=R(),t=(A.x+A.width/2)/e,n=(A.y+A.height/2)/e
et.style.width=`${Je}px`,et.style.left=`calc(${t}px - ${Je/2}px)`,et.style.bottom=`calc(${n}px - ${Je/2}px)`}}return{get noScroll(){return n},set noScroll(e){n=e},get noContextMenu(){return l},set noContextMenu(e){l=e},get width(){return C},get height(){return w},get pixelRatio(){return R()},get pointerLock(){return T},...H,setPixelScale:t=>{x=t,C=e.clientWidth*R(),w=e.clientHeight*R()},updateTrackedPointers:e=>{!function(e){let t,n
for(const r of e)"right"===r.handedness?t=r:"left"===r.handedness&&(n=r)
!t&&n&&(t=n,n=void 0),(null==t?void 0:t.buttons)===m.Flag.Primary&&(null==n?void 0:n.buttons)===m.Flag.Primary?ve(t,n,m.Flag.Trigger):(null==t?void 0:t.buttons)===m.Flag.Secondary&&(null==n?void 0:n.buttons)===m.Flag.Secondary?ve(t,n,m.Flag.Squeeze):(-1===me.distance&&(t&&ye(t,!1),n&&ye(n,!0)),(null==t?void 0:t.buttons)||(null==n?void 0:n.buttons)||(me.distance=-1))}(e),ae.next(e)},updateScreenTouches:e=>{!function(e){if(2===e.length){const t=o.Z.fromObj(e[0]),n=o.Z.fromObj(e[1]),r=o.Z.distance(t,n),i=m.Flag.Trigger
if(Se>0){const e=r/Se
W.next({scale:e,rotation:0,deltaScale:0,deltaRotation:0,buttons:i,button:i,modifiers:O()})}return Se=r,void(be=void 0)}Se=-1
const t=e[0]
if(!t){if(xe&&be){const e=o.Z.fromObj(xe),t=o.Z.fromObj(be)
if(o.Z.distance(e,t)<10){const[t,n]=e,[r,i]=[t,n],o=f.create(),a=m.Flag.Trigger,{ray:s}=xe
Y.next({x:t,y:n,pageX:r,pageY:i,buttons:a,button:a,modifiers:o,ray:s})}Q.next(void 0)}return be=void 0,void(xe=void 0)}const n=o.Z.fromObj(t),[r,i]=n,[a,s]=[r,i],l=f.create(),c=m.Flag.Trigger,u=void 0===be,d=be?r-be.x:0,p=be?i-be.y:0
be=t,u&&(xe=t),q.next({x:r,y:i,dx:d,dy:p,pageX:a,pageY:s,buttons:c,button:c,modifiers:l,isStart:u,useDelta:!0})}(e)},requestPointerLock:t=>{A=t,T||e.requestPointerLock()},exitPointerLock:()=>{T&&e.ownerDocument.exitPointerLock()},dispose:function(){z||(z=!0,e.removeEventListener("contextmenu",ce,!1),e.removeEventListener("wheel",Ve,!1),e.removeEventListener("mousedown",Oe,!1),window.removeEventListener("mousemove",Le,!1),window.removeEventListener("mouseup",Ne,!1),e.removeEventListener("touchstart",De,!1),e.removeEventListener("touchmove",Re,!1),e.removeEventListener("touchend",Me,!1),e.removeEventListener("gesturechange",$e,!1),e.removeEventListener("gesturestart",qe,!1),e.removeEventListener("gestureend",Xe,!1),window.removeEventListener("blur",de),window.removeEventListener("keyup",he,!1),window.removeEventListener("keydown",pe,!1),window.removeEventListener("keypress",fe,!1),document.removeEventListener("pointerlockchange",se,!1),document.removeEventListener("pointerlockerror",le,!1),et.remove(),null!=N?(N.unobserve(e.parentElement),N.disconnect()):window.removeEventListener("resize",We,!1))}}}}(x||(x={}))},99507(e,t,n){"use strict"
n.r(t),n.d(t,{ApplyAction:()=>m,ClearHighlights:()=>_,Highlight:()=>S,RemoveObject:()=>g,SetCurrentObject:()=>h,Snapshots:()=>C,SyncBehaviors:()=>p,ToggleExpanded:()=>y,ToggleVisibility:()=>v,Update:()=>f,registerDefault:()=>d,setSubtreeVisibility:()=>b})
var r=n(48393),i=n(95207),o=n(39298),a=n(43472),s=n(97573),l=n(32896),c=n(15382),u=n(19288)
function d(e){p(e),h(e),f(e),m(e),g(e),y(e),v(e),S(e),_(e),C(e)}function p(e){e.state.events.object.created.subscribe(e=>{o.O.isBehavior(e.obj)&&e.obj.data.register(e.ref)}),e.state.events.object.removed.subscribe(e=>{var t,n,r,i
o.O.isBehavior(e.obj)&&(null===(n=(t=e.obj.data).unregister)||void 0===n||n.call(t),null===(i=(r=e.obj.data).dispose)||void 0===i||i.call(r))}),e.state.events.object.updated.subscribe(e=>{var t,n,r,i
"recreate"===e.action&&(e.oldObj&&o.O.isBehavior(e.oldObj)&&(null===(n=(t=e.oldObj.data).unregister)||void 0===n||n.call(t),null===(i=(r=e.oldObj.data).dispose)||void 0===i||i.call(r)),e.obj&&o.O.isBehavior(e.obj)&&e.obj.data.register(e.ref))})}function h(e){c.PluginCommands.State.SetCurrentObject.subscribe(e,({state:e,ref:t})=>e.setCurrent(t))}function f(e){c.PluginCommands.State.Update.subscribe(e,({state:t,tree:n,options:r})=>e.runTask(t.updateTree(n,r)))}function m(e){c.PluginCommands.State.ApplyAction.subscribe(e,({state:t,action:n,ref:r})=>e.runTask(t.applyAction(n.action,n.params,r)))}function g(e){function t(t,n){const r=t.build().delete(n)
return e.runTask(t.updateTree(r))}c.PluginCommands.State.RemoveObject.subscribe(e,({state:e,ref:n,removeParentGhosts:r})=>{if(!r)return t(e,n)
{const r=e.tree
let i=r.transforms.get(n)
if(i.parent===n)return t(e,n)
for(;;){const n=r.children.get(i.parent)
if(i.parent===i.ref||n.size>1)return t(e,i.ref)
const o=r.transforms.get(i.parent)
if(!o.state.isGhost)return t(e,i.ref)
i=o}}})}function y(e){c.PluginCommands.State.ToggleExpanded.subscribe(e,({state:e,ref:t})=>e.updateCellState(t,({isCollapsed:e})=>({isCollapsed:!e})))}function v(e){c.PluginCommands.State.ToggleVisibility.subscribe(e,({state:e,ref:t})=>b(e,t,!e.cells.get(t).state.isHidden))}function b(e,t,n){a.uF.doPreOrder(e.tree,e.transforms.get(t),{state:e,value:n},x)}function x(e,t,n){n.state.updateCellState(e.ref,{isHidden:n.value})}function S(e){c.PluginCommands.Interactivity.Object.Highlight.subscribe(e,({state:t,ref:n})=>{if(!e.canvas3d||e.isBusy)return
e.managers.interactivity.lociHighlights.clearHighlights()
const i="string"==typeof n?[n]:n
for(const a of i){const n=t.cells.get(a)
if(n)if(o.O.Molecule.Structure.is(n.obj))e.managers.interactivity.lociHighlights.highlight({loci:r.Structure.Loci(n.obj.data)},!1)
else if(n&&o.O.isRepresentation3D(n.obj)){const{repr:t}=n.obj.data
for(const n of t.getAllLoci())e.managers.interactivity.lociHighlights.highlight({loci:n,repr:t},!1)}else if(o.O.Molecule.Structure.Selections.is(n.obj))for(const t of n.obj.data)e.managers.interactivity.lociHighlights.highlight({loci:t.loci},!1)}})}function _(e){c.PluginCommands.Interactivity.ClearHighlights.subscribe(e,()=>{e.managers.interactivity.lociHighlights.clearHighlights()})}function C(e){e.config.set(u.PluginConfig.State.CurrentServer,e.config.get(u.PluginConfig.State.DefaultServer)),c.PluginCommands.State.Snapshots.Clear.subscribe(e,()=>{e.managers.snapshot.clear()}),c.PluginCommands.State.Snapshots.Remove.subscribe(e,({id:t})=>{e.managers.snapshot.remove(t)}),c.PluginCommands.State.Snapshots.Add.subscribe(e,async({key:t,name:n,description:r,descriptionFormat:o,params:a})=>{var s
const l=e.state.getSnapshot(a),c=(null!==(s=null==a?void 0:a.image)&&void 0!==s?s:e.state.snapshotParams.value.image)?await i.g.getCanvasImageAsset(e,`${l.id}-image.png`):void 0,u=i.g.Entry(l,{key:t,name:n,description:r,descriptionFormat:o,image:c})
e.managers.snapshot.add(u)}),c.PluginCommands.State.Snapshots.Replace.subscribe(e,async({id:t,params:n})=>{var r
const o=e.state.getSnapshot(n),a=(null!==(r=null==n?void 0:n.image)&&void 0!==r?r:e.state.snapshotParams.value.image)?await i.g.getCanvasImageAsset(e,`${o.id}-image.png`):void 0
e.managers.snapshot.replace(t,e.state.getSnapshot(n),{image:a})}),c.PluginCommands.State.Snapshots.Move.subscribe(e,({id:t,dir:n})=>{e.managers.snapshot.move(t,n)}),c.PluginCommands.State.Snapshots.Apply.subscribe(e,({id:t})=>{const n=e.managers.snapshot.setCurrent(t)
if(n)return e.state.setSnapshot(n)}),c.PluginCommands.State.Snapshots.Upload.subscribe(e,async({name:t,description:n,playOnLoad:r,serverUrl:i,params:o})=>fetch((0,l.r)(i,`set?name=${encodeURIComponent(t||"")}&description=${encodeURIComponent(n||"")}`),{method:"POST",mode:"cors",referrer:"no-referrer",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(await e.managers.snapshot.getStateSnapshot({name:t,description:n,playOnLoad:r}))})),c.PluginCommands.State.Snapshots.Fetch.subscribe(e,async({url:t})=>{const n=await e.runTask(e.fetch({url:t,type:"json"}))
await e.managers.snapshot.setStateSnapshot(n.data)}),c.PluginCommands.State.Snapshots.DownloadToFile.subscribe(e,async({name:t,type:n,params:r})=>{const i=`mol-star_state_${t||function(){const e=new Date
return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+"-"+e.getHours()+"-"+e.getMinutes()+"-"+e.getSeconds()}()}.${"json"===n?"molj":"molx"}`,o=await e.managers.snapshot.serialize({type:n,params:r});(0,s.R)(o,`${i}`)}),c.PluginCommands.State.Snapshots.OpenFile.subscribe(e,({file:t})=>e.managers.snapshot.open(t)),c.PluginCommands.State.Snapshots.OpenUrl.subscribe(e,async({url:t,type:n})=>{const r=await e.runTask(e.fetch({url:t,type:"binary"}))
return e.managers.snapshot.open(new File([r],`state.${n}`))})}},99809(e,t,n){"use strict"
n.d(t,{$:()=>i,y:()=>r})
var r,i,o=n(9043),a=n(67538),s=n(22703),l=n(32775),c=n(14294),u=n(25919),d=n(19613),p=n(40253),h=n(42594),f=n(23729),m=n(81871)
!function(e){function t(e){return{color:(0,p.h2)({shape:e},{}),size:(0,d.$d)({shape:e},{})}}function n(e){const t=e.transforms.length,n=i.Location(e)
return(0,m.iQ)(e.groupCount,t,1,(e,t)=>(n.group=e,n.instance=t,n))}function r(e,t,n,r,i){const o=i&&i.aTransform.ref.value.length>=16*e.length?i.aTransform.ref.value:new Float32Array(16*e.length)
for(let a=0,s=e.length;a<s;++a)l.$I.toArray(e[a],o,16*a)
return(0,h.l1)(o,e.length,t,n,r,i)}e.create=function(e,t,n,r,i,a,c,u){return{id:o.kk.create22(),name:e,sourceData:t,geometry:n,transforms:c||[l.$I.identity()],get groupCount(){return null!=u?u:s.V.getGroupCount(n)},getColor:r,getSize:i,getLabel:a}},e.getTheme=t,e.groupIterator=n,e.createTransform=r,e.createRenderObject=function(e,i){const o=t(e),a=s.V.getUtils(e.geometry),l=(0,f.Q0)(),c=n(e),u=r(e.transforms,e.geometry.boundingSphere,i.cellSize,i.batchSize),d=a.createValues(e.geometry,u,c,o,i),p=a.createRenderableState(i)
return(0,f.o)(e.geometry.kind,d,p,l)},e.Loci=function(e){return{kind:"shape-loci",shape:e}},e.isLoci=function(e){return!!e&&"shape-loci"===e.kind},e.areLociEqual=function(e,t){return e.shape===t.shape},e.isLociEmpty=function(e){return 0===e.shape.groupCount}}(r||(r={})),function(e){function t(e){let t=0
for(const n of e.groups)t+=a.CD.size(n.ids)
return t}e.Location=function(e,t=0,n=0){return{kind:"group-location",shape:e,group:t,instance:n}},e.isLocation=function(e){return!!e&&"group-location"===e.kind},e.Loci=function(e,t){return{kind:"group-loci",shape:e,groups:t}},e.isLoci=function(e){return!!e&&"group-loci"===e.kind},e.areLociEqual=function(e,t){if(e.shape!==t.shape)return!1
if(e.groups.length!==t.groups.length)return!1
for(let n=0,r=e.groups.length;n<r;++n){const{ids:r,instance:i}=e.groups[n],{ids:o,instance:s}=t.groups[n]
if(i!==s)return!1
if(!a.CD.areEqual(r,o))return!1}return!0},e.isLociEmpty=function(e){return 0===t(e)},e.size=t
const n=new u.p,r=l.eB.zero()
function i(e,t,i,o){const{indices:s,offsets:c}=t
for(const{ids:u,instance:d}of e)a.CD.forEach(u,e=>{for(let t=c[e],a=c[e+1];t<a;++t)l.eB.fromArray(r,i,3*s[t]),l.eB.transformMat4(r,r,o[d]),n.includeStep(r)})}function o(e,t,i,o){const{indices:s,offsets:c}=t
for(const{ids:u,instance:d}of e)a.CD.forEach(u,e=>{for(let t=c[e],a=c[e+1];t<a;++t)l.eB.fromArray(r,i,3*s[t]),l.eB.transformMat4(r,r,o[d]),n.radiusStep(r)})}e.getBoundingSphere=function(e,t){t||(t=(0,c.f8)()),n.reset()
let r=0
const{geometry:s,transforms:u}=e.shape
if("mesh"===s.kind||"points"===s.kind){const t="mesh"===s.kind?s.vertexBuffer.ref.value:s.centerBuffer.ref.value
i(e.groups,s.groupMapping,t,u),n.finishedIncludeStep(),o(e.groups,s.groupMapping,t,u)}else if("lines"===s.kind){const t=s.startBuffer.ref.value,r=s.endBuffer.ref.value
i(e.groups,s.groupMapping,t,u),i(e.groups,s.groupMapping,r,u),n.finishedIncludeStep(),o(e.groups,s.groupMapping,t,u),o(e.groups,s.groupMapping,r,u)}else{if("spheres"!==s.kind&&"text"!==s.kind)return c.f8.copy(t,s.boundingSphere)
{const t=s.centerBuffer.ref.value
i(e.groups,s.groupMapping,t,u),n.finishedIncludeStep(),o(e.groups,s.groupMapping,t,u)
for(const{ids:n,instance:i}of e.groups)a.CD.forEach(n,t=>{const n=e.shape.getSize(t,i)
r<n&&(r=n)})}}return l.eB.copy(t.center,n.center),t.radius=Math.sqrt(n.radiusSq),c.f8.expand(t,t,r),t}}(i||(i={}))},99852(e,t,n){"use strict"
n.d(t,{_:()=>r})
var r,i=n(92384),o=n(9043),a=n(33205),s=n(12288)
!function(e){function t(e){const t=e.descriptor.name,n="static"===e.type?"_staticPropertyData":"_dynamicPropertyData",r=r=>(t in r[n]||(r[n][t]={props:{...i.t.getDefaultValues(e.getParams(r))},data:o.xv.create(void 0)}),r[n][t]),a=(e,i,a)=>{const s=r(e)
e[n][t]={props:i,data:o.xv.withValue(s.data,a)}}
return{label:e.label,descriptor:e.descriptor,isHidden:e.isHidden,getParams:t=>{const n=i.t.clone(e.getParams(t))
return i.t.setDefaultValues(n,r(t).props),n},defaultParams:e.defaultParams,isApplicable:e.isApplicable,attach:async(t,n,o={},s)=>{s&&n.customProperties.reference(e.descriptor,!0)
const l=r(n),c=i.t.merge(e.defaultParams,l.props,o)
if(l.data.value&&i.t.areEqual(e.defaultParams,l.props,c))return
const{value:u,assets:d}=await e.obtain(t,n,c)
n.customProperties.add(e.descriptor),n.customProperties.assets(e.descriptor,d),a(n,c,u)},ref:(t,n)=>t.customProperties.reference(e.descriptor,n),get:e=>{var t
return null===(t=r(e))||void 0===t?void 0:t.data},set:(t,n={},o)=>{const s=r(t),l=i.t.merge(e.defaultParams,s.props,n)
i.t.areEqual(e.defaultParams,s.props,l)||(a(t,l,o),t.customProperties.assets(e.descriptor))},props:e=>r(e).props}}e.createProvider=t,e.createSimple=function(e,n,r){const o={value:i.t.Value(r,{isHidden:!0})}
return t({label:(0,s.Mk)(e),descriptor:(0,a.e)({name:e}),isHidden:!0,type:n,defaultParams:o,getParams:()=>({value:i.t.Value(r,{isHidden:!0})}),isApplicable:()=>!0,obtain:async(e,t,n)=>({...i.t.getDefaultValues(o),...n})})}}(r||(r={}))}}])
